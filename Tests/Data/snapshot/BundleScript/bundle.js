(()=>{var e,t,s,n={36964:(e,t,s)=>{"use strict";s.d(t,{Z:()=>i});var n=s(33638);const i=new class{composerSearchListId;setSearchListId(e){this.composerSearchListId=e}addAttachments(e){n.Z.dispatch({actionType:"MAIL_ACTIVE_COMPOSER_ADD_ATTACHMENTS",newAttachments:e})}}},43630:(e,t,s)=>{"use strict";s.d(t,{Z:()=>he});var n=s(39005),i=s(99827),a=s(98611),o=s(36943),r=s(2431),l=s(54162),d=s(46382),c=s(96951),h=s(29087),u=s(81538),p=s(33638),g=s(56371),m=s(78347),f=s(2711),v=s(48868),b=s(83204),C=s(10671),w=s(5267),y=s(97823),x=s(68906),I=s(20570),A=s(35489),S=s(93043),Z=s(93789),T=s(5204),E=s(5863),k=s(51501),N=s(77312),_=s(89175);const P={call:async function(e,t){const s={},n=[],o=await y.Z.loadAllAccounts(),r=[],l=new Map,d=new k.RW,c=[];for(const i of e){const{id:e,messageId:u,sources:p}=i,g=t.get(e);if(!g)return;p.size===g.length?l.set(e,i):d.add(g,e);for(const[t,l]of p){const d=a.Z.get(t);if(!d)continue;const{accountId:p,path:g}=d;if(p===E.of&&[E.J8,E.Wb].includes(g))c.push(i.id);else if(p===E.u4){const e=h.Z.get(_.kRssSettings).find((e=>g.endsWith(e.feedId)));e&&r.push({feedId:e.feedId,messageId:u})}else{const t=o.find((e=>e.MAIL_EMAIL===p));t?t.accountType===E.s9.POP?s[p]?s[p].push(e):s[p]=[e]:!1===l.deleted&&!1===l.internal&&C.Z.isOnline(p,g)&&n.push({accountId:p,path:g,searchListId:e}):console.warn("Account "+p+" not found")}}}let u=[];c.length>0&&(u=await(0,N.TP)(c));const p=[v.Z.messages,v.Z.searchList,v.Z.threading,v.Z.filteringQueue,v.Z.viewIds,v.Z.hasRaw];(n.length>0||Object.keys(s).length>0)&&(p.push(v.Z.buffer),n.length>0&&p.push(v.Z.imap),Object.keys(s).length>0&&p.push(v.Z.pop)),r.length>0&&p.push(v.Z.deletedFeedItems);const g=[],m=[...l.keys()],P=[];await v.Z.transaction("rw",p,(async()=>{for(const{filterIds:e,searchListIds:t}of d.batches){const s=[...e],{fileKeys:n,sleUpdates:i}=await Z.Z.call(t,s);g.push(...n),P.push(...i);const a=new Map(s.map((e=>[e,void 0])));x.Z.call({type:"UPDATE_SLE",priority:E.Un.HIGH,searchListIds:t,sources:a})}if(r.length>0&&v.Z.deletedFeedItems.bulkAdd(r),m.length>0){const e=await A.Z.getBySearchListIds(m);for(const t of e){const{accountId:e,searchListId:s,hasRaw:n}=t;if(1===n){const t=l.get(s);if(!t)throw new Error("Item not found "+s);const{sentDate:n}=t;g.push({accountId:e,searchListId:s,sentDate:n})}}S.Z.call(m)}n.length>0&&I.Z.addDelete(n);const e=Object.keys(s);if(e.length>0){const t=[];for(const n of e)t.push({accountId:n,searchListIds:s[n],operation:"BUFFER_OPERATION_DELETE_POP"});t.length>0&&v.Z.buffer.bulkAdd(t)}})),m.length>0&&w.Z.deleteMessages(m),i.Z.updateIndex({removedSles:m,sleUpdates:P}),f.Z.flushBuffer(),T.Z.filter();for(const e of g){const{accountId:t,searchListId:s,sentDate:n}=e;await b.Z.call(t,s,n).catch((()=>console.warn("Error deleting file. May not exist!",e)))}for(const e of u)await(0,N.MT)(e)}};var M=s(71320),D=s(45709),O=s(26036),j=s(84283),L=s(45660),R=s(47482),B=s(59552),F=s(35458),W=s(13248),U=s(8684);const V="VIVALDI_MAIL_MESSAGES_TRASHED";const H={call:async function(e,t){const s=new Map,n=[],o=[],r=new Map,l=new Set,d=[],c=new Set,h=new Map;function u(e,t,n){const i=s.get(t),{id:a,accountId:o,path:r}=e,l={deleted:n,read:!0,internal:!C.Z.isOnline(o,r)||n};i?i.set(a,l):s.set(t,new Map([[a,l]]))}function p(e,t,s){const{id:n,sources:i}=e;c.add(e),i.forEach(((e,i)=>{let o=e.read?{}:{read:!0};if(t.has(i)){const e=a.Z.get(i);if(!e)throw new Error("Filter not found "+i);const{accountId:t,path:n}=e,r=!C.Z.isOnline(t,n)||s;o={...o,deleted:s,internal:r}}if(Object.keys(o).length>0){const e=h.get(n);e?e.set(i,o):h.set(n,new Map([[i,o]]))}}))}function b(e,t,s){const n=t.find((t=>{const s=e.sources.get(t);return s&&!s.internal}));if(n){const{accountId:t,path:i}=a.Z.get(n),d=[t,i,e.id];o.push({key:d,destinationPath:s});const c=e.sources.get(n);c&&!c.read&&(r.set(e.id,new Map([[n,{read:!0}]])),l.add(e.id))}}const w=new Set;e.forEach((e=>{const{id:i}=e;w.add(i);const o=t.get(i),r=new Map;o&&0!==o.length?(o.forEach((e=>{const t=a.Z.get(e),{accountId:s}=t,n=r.get(s);n?n.push(e):r.set(s,[e])})),r.forEach(((t,o)=>{const r=(0,W.ZA)(o)&&m.Z.getFoldersOfType(o,E.uT);if(r&&r.length>0){const l=new Set;r.forEach((n=>{const{path:r}=n,c=a.Z.getByFolder(o,r),{id:h}=c,g=e.sources.get(h);if(g)if(g.internal)b(e,t,r),g.deleted&&u(c,i,!1);else if(g.deleted){const t=new Set([h]);p(e,t,!1)}else d.push(e);else!function(e,t,n){const i=s.get(t),{id:a,accountId:o,path:r}=e,l={deleted:n,internal:!C.Z.isOnline(o,r)||n,read:!0};i?i.set(a,l):s.set(t,new Map([[a,l]]))}(c,i,!1),b(e,t,r);l.add(h)}));const c=t.filter((e=>!l.has(e)));p(e,new Set(c),!0),c.forEach((t=>{const s=e.sources.get(t),r=a.Z.get(t);if(!r)throw new Error("Filter not found "+t);s.internal||n.push([o,r.path,i]),u(r,i,!0)}))}else p(e,new Set(t),!0)}))):console.warn("No deleteSourceFilterIds for id "+i)}));const y=new Set;if(s.size>0&&(y.add(v.Z.searchList),y.add(v.Z.filteringQueue),y.add(v.Z.filters)),(n.length>0||o.length>0||r.size>0)&&(y.add(v.Z.imap),y.add(v.Z.buffer)),c.size>0&&y.add(v.Z.flaggingQueue),y.size>0){const e=[];await v.Z.transaction("rw",[...y],(async()=>{if(c.size>0){const{sleUpdates:t}=D.Z.setCustomFlags([...c],{},h);e.push(...t)}if(s.size>0){const t=await F.Z.call(s);e.push(...t);const n=new k.RW;s.forEach(((e,t)=>{const s=[...e.keys()];n.add(s,t)}));for(const{filterIds:e,searchListIds:t}of n.batches)x.Z.call({type:"RE_RUN_SLES",priority:E.Un.HIGH,searchListIds:t,filterIds:[...e],folderIds:[[E.of,E.cm]]})}if(r.size>0&&await I.Z.addSourceFlags(r),o.length>0){const e=[];for(const t of o){const{key:s,destinationPath:n}=t,[i,a,o]=s;e.push({accountId:i,path:a,searchListId:o,destinationPath:n})}await I.Z.addCopy(e)}if(n.length>0){const e=[];for(const t of n){const[s,n,i]=t;e.push({accountId:s,path:n,searchListId:i})}await I.Z.addDelete(e)}})),T.Z.filter(),f.Z.flushBuffer(),e.length>0&&i.Z.updateIndex({sleUpdates:e})}return d.length>0&&(e.length===d.length?(0,U.c)({title:(0,g.Z)("Already in trash"),icon:"resources/mail_notification_icon.png",timeout:3e4,tag:V}):(0,U.c)({title:(0,g.Z)("Some were already in trash"),icon:"resources/mail_notification_icon.png",timeout:3e4,tag:V})),{operation:"delete",searchListIds:w,markUnread:l}}};var G=s(307),K=s(67103),z=s(1407),$=s(49168),Y=s(81744),X=s(70752),Q=s(83065),q=s(19842),J=s(86088),ee=s(59275);const te={Red:"#f01",Orange:"#f80",Yellow:"#fd0",Green:"#3c0",Blue:"#08f",Purple:"#a09",Gray:"#666"},se=new Image;se.src=`data:image/svg+xml;base64,${btoa(J.nyn.medium)}`;const ne=[E.e9,E.Nz,E.hn,E.Hd,E.uT,E.Oi];function ie(e){const t=document.createElement("canvas");t.width=32,t.height=32;const s=t.getContext("2d");return s.drawImage(se,0,0),s.globalCompositeOperation="source-in",s.fillStyle=te[e]??te.Red,s.fillRect(0,0,32,32),t.toDataURL("image/png").replace("data:image/png;base64,","")}function ae(e,t){e.push(t),t.children&&t.children.forEach((t=>ae(e,t)))}function oe(e,t,s){const a=e.filter((e=>e&&(void 0===s||s(e))));if(0===a.length)return;const{sleUpdates:o,undoItem:r}=t(a);i.Z.updateIndex({sleUpdates:o}),i.Z.pushUndoItem(r);const l=n.Z.getActiveListEntry();if(l){const e=a.find((e=>e.id===l.id));e&&(l.flags=e.flags)}}function re(e){return Boolean(c.ZP.getActivePage(e)?.isMailPage)}function le(e){return h.Z.get(e?_.kMailDeleteInOtherLocations:_.kMailMarkDeleteInOtherLocations)}async function de(e){let t=n.Z.getActiveMessage();if(!t)return;let s=n.Z.getRenderingMethod();"raw"===s&&(s=h.Z.get(_.kMailPreferredRendering));const i=n.Z.getRaw();if(i&&!t.bodyParts){let n=await i.parseMainPart(s);e&&(n=n.concat(await i.parseAttachments())),t={...t,bodyParts:[...n]}}return t}const ce=new class{getSelectedEntries(e,t){const s=(0,q.Rr)(e);let i=[];if(!s){const e=u.Z.get(z.uP);if(!e)return i;e.selectedIds.forEach((e=>{const s=a.Z.getListEntry(e.id);s&&(t?ae(i,s):i.push(s))}))}if(!i.length||s){const e=n.Z.getActiveListEntry();if(e){const t=a.Z.getListEntry(e.id);t&&(i=[t])}}return i}markSelected(e,t,s){oe(this.getSelectedEntries(e),t,s)}enableThreadedView(e){if(!re(e))return;const t=this.getSelectedEntries(e);t&&t.length>0&&t[0]&&i.Z.selectThread(t[0])}enableCorrespondentView(e,t){if(re(e))if(t)i.Z.selectContactByAddress(e,t);else{const t=n.Z.getActiveMessage(),s=l.Z.getSelectedFolder();if(t&&s){const n=C.Z.getFolderType(s.accountId,s.path),{from:a,to:o,cc:r,bcc:l=[]}=t,d=n===E.Nz?o[0]||r[0]||l[0]:a[0];d&&d.address&&i.Z.selectContactByAddress(e,d.address)}}}enableContactView(e,t,s){re(e)&&(s?i.Z.selectContactByIdAndAddress(e,t,s):i.Z.selectContactById(e,t))}setActiveMailDetail(e){p.Z.dispatch({actionType:"MAIL_SET_ACTIVE_COMPONENT",mailDetail:e})}setActiveMessage(e){p.Z.dispatch({actionType:"MAIL_SET_ACTIVE_MESSAGE",message:e})}markAsReadAndGoToNextUnread(e){re(e)&&(ce.markRead(e),p.Z.dispatch({actionType:"MAIL_GOTO_UNREAD"}))}goToNextUnread(e){re(e)&&p.Z.dispatch({actionType:"MAIL_GOTO_NEXT_UNREAD"})}goToPreviousUnread(e){re(e)&&p.Z.dispatch({actionType:"MAIL_GOTO_PREVIOUS_UNREAD"})}openMessage=e=>{const t=n.Z.getActiveListEntry(),s=n.Z.getActiveMessage();if(!t||!s)return;const i=M.Z.getByIds(t.sourceFilterIds);if(i.some((e=>e.accountId===E.of&&(e.path===E.Wb||e.path===E.J8))))return r.Z.open(s,t.threadKey);const a=C.Z.getFolderTypes(i),o=a.has(E.kY);if(a.has(E.Nz)||o)return ce.createDraft();(0,G.Z)(e,s)};clearIfActive(e){setTimeout((()=>{p.Z.dispatch({actionType:"MAIL_CLEAR_IF_ACTIVE",mailDetail:e})}),100)}refreshActiveMessage=()=>{p.Z.dispatch({actionType:"MAIL_REFRESH_ACTIVE_MESSAGE"})};async createDraft(){const e=await de(!0);e&&r.Z.createDraftFromParsedMessage(e)}async reply(){const e=await de(!1);e&&await r.Z.reply(e)}async replyAll(){const e=await de(!1);e&&await r.Z.replyToAll(e)}async replyList(){const e=await de(!1);e&&await r.Z.replyToList(e)}async forward(){const e=await de(!0);e&&await r.Z.forward(e)}markRead(e){re(e)&&this.markSelected(e,(e=>D.Z.setRead(e,!0)))}markUnread(e){re(e)&&this.markSelected(e,(e=>D.Z.setRead(e,!1)))}markThreadRead(e){if(!re(e))return;oe(this.getSelectedEntries(e,!0),(e=>D.Z.setRead(e,!0)))}markThreadUnread(e){if(!re(e))return;oe(this.getSelectedEntries(e,!0),(e=>D.Z.setRead(e,!1)))}markFlagged(e){this.markSelected(e,(e=>D.Z.setFlagged(e,!0)),(e=>!(0,$.u9)(e)))}markUnflagged(e){this.markSelected(e,(e=>D.Z.setFlagged(e,!1)),(e=>(0,$.u9)(e)))}setCustomFlags(e,t){this.markSelected(e,(e=>D.Z.setCustomFlags(e,t,new Map)))}async prepareDelete(e,t,s,n){const i=s||this.getSelectedEntries(e);let o;if(o=t?i.some((e=>e.sources.size>1)):i.some((e=>[...e.sources.entries()].filter((([e,t])=>!j.Z.isSourceDeleted(e,t))).length>1)),o||n){const n=l.Z.getSelectedFolder();if(!n)return void L.Z.warn("Mail",["prepareDelete"],"No folder selected");const{accountId:o,path:r=E.ym}=n,c=a.Z.getByFolderId([o,r]),h=i.some((e=>e.sources.has(c.id))),u=le(t);if(h){if("ask"===u){const s=new Set,n=new Set;for(const{sources:e}of i){const t=M.Z.getByIds([...e.keys()]);for(const{accountId:e,path:i}of t)s.add(e),c.accountId===e&&n.add(i)}const a=s.size>1,o=n.size>1,r=a||o||t;if(r)return void d.Z.showMailDeleteDialogSetting(e,{entries:i,deletePermanently:t,showSelected:r,showFolders:o,showAccounts:a})}}else{if(s)return void d.Z.showMailDeleteDialogConfirmAll(e,{entries:i,deletePermanently:t});if(i.length>1){if(["selected","folders","ask"].includes(u))return void d.Z.showMailDeleteDialogConfirmAll(e,{entries:i,deletePermanently:t})}else{if("selected"===u)return void d.Z.showMailDeleteDialogFolders(e,{entries:i,deletePermanently:t});if(["folders","ask"].includes(u)){const s=new Set;if(i[0].sources.forEach(((e,t)=>{if(!j.Z.isSourceDeleted(t,e)){const e=M.Z.get(t);if(!e)throw new Error("Filter not found "+t);s.add(e.accountId)}})),s.size>1)return void d.Z.showMailDeleteDialogAccounts(e,{entries:i,deletePermanently:t})}}}}await this.delete(e,i,t)}async delete(e,t,s,n={}){const{setting:o,accountIds:d,sourceFilterIds:c}=n,h=o||le(s),u=new Map,p=l.Z.getSelectedFolder();if(!p)return void console.warn("No folder selected");const{accountId:g,path:m=E.ym}=p,f=a.Z.getByFolderId([g,m]),v=f&&t.some((e=>e.sources.has(f.id)));if(t.forEach((e=>{const t=[];e.sources.forEach(((e,n)=>{if(!s&&j.Z.isSourceDeleted(n,e))return void L.Z.log("Mail",["delete"],`No need to re-delete - sourceFilterId: ${n}`);const i=a.Z.get(n);if(i)return d||c?d&&!d.get(i.accountId)?void L.Z.log("Mail",["delete"],`Accounts selected to delete from do not match filter - sourceFilterId: ${i.id}`):c&&!c.get(n)?void L.Z.log("Mail",["delete"],`Folders selected to delete from do not match filter - sourceFilterId: ${n}`):void t.push(n):void("selected"===h&&v?f?.id===n?t.push(n):L.Z.log("Mail",["delete"],`filter not found - selectedFilter: ${f?f.id:"undefined"} - sourceFilterId: ${n}`):"folders"===h&&v?i.accountId===g?t.push(n):L.Z.log("Mail",["delete"],`filter not found -  source accountId: ${i.accountId} - selected accountId: ${g} - sourceFilterId: ${n}`):t.push(n));L.Z.log("Mail",["delete"],`sourceFilter not found! sourceFilterId: ${n}`)})),t.length>0&&u.set(e.id,t)})),0===u.size)return void L.Z.log("Mail",["delete"],"Nothing to delete");const b=t.filter((e=>u.has(e.id)));if(b.forEach((t=>{r.Z.closeComposer(e,t.id)})),b.length>0)if(s)P.call(b,u);else{const e=await H.call(b,u);i.Z.pushUndoItem(e)}}undelete(e){const t=this.getSelectedEntries(e);(0,K.Z)(t)}getMoveToFolderMenu=e=>{const t=this.getSelectedEntries(e),s=t.map((e=>{const t=[];return e.sources.forEach(((e,s)=>{e.deleted||t.push(s)})),t}));if(0===s.length)return[];const n=s.reduce(((e,t)=>e.filter((e=>t.includes(e)))));let i=[];if(M.Z.getByIds(n).forEach((e=>{const{accountId:t,path:s}=e,n=C.Z.getFolderType(t,s);m.Z.isMailAccount(t)&&ne.includes(n)&&i.push([t,s])})),0===i.length){return[{...1===t.length?(0,O.Z)("Can not move from this folder."):(0,O.Z)("No common folder. Can not move this selection."),isEnabled:()=>!1,mnemonic:!1}]}let a=!1;const o=l.Z.getSelectedFolder();if(o){const e=i.find((([e,t])=>e===o.accountId&&t===o.path));e&&(i=[e],a=!0)}const r=m.Z.getAccounts(),d=[];return i.forEach((([s,n])=>{const i=m.Z.getFolderName(s,n);let o=[];for(const e of ne)o.push(...C.Z.getPathsByType(s,e));if(o=o.filter((e=>e!==n)),o.length>0){const l=o.map((i=>{const a=(0,Q.kF)(i);return{handler:()=>(0,B.Z)(e,t,[{accountId:s,path:n}],s,i),label:(0,ee.e)(a),labelEnglish:a}})),c=[];for(const i in r)if(i!==s){const a=r[i].folders;for(const o in a)for(const r of a[o].sort(((e,t)=>e.name.localeCompare(t.name)))){const a=r.path;if(ne.includes(o)){const o=m.Z.getFolderName(i,a);c.push({handler:()=>(0,B.Z)(e,t,[{accountId:s,path:n}],i,a),label:`${i}/${(0,ee.e)(o)}`,labelEnglish:`${i}/${o}`})}}}if(a)d.push(...l,...c);else{const e=l.concat(c);d.push({items:e,label:(0,g.Z)("Move from $1 to",[s+"/"+(0,ee.e)(i)]),labelEnglish:`Move from ${s}/${i} to ...`})}}})),d};getCustomLabelsMenu=(e,t)=>{const s=(0,$.lN)(),n=[];return s.forEach((s=>{n.push({type:"checkbox",checked:t.indexOf(s)>-1,handler:this.toggleLabel(e,s,t),...(0,O.Z)((0,Y.X)(s))})})),n};clearAllLabels=(e,t)=>{const s=Object.fromEntries(t.map((e=>[e,!1])));this.setCustomFlags(e,s)};toggleLabel=(e,t,s)=>()=>{const n=-1===s.indexOf(t);this.setCustomFlags(e,{[t]:n})};setLabel=(e,t)=>{this.setCustomFlags(e,{[t]:!0})};setLabels=(e,t)=>{this.setCustomFlags(e,t)};getReplyMenu=()=>[{type:"command",handler:()=>this.replyList(),label:(0,g.Z)("Reply to Mailing List"),labelEnglish:"Reply to Mailing List"},{type:"command",handler:()=>this.replyAll(),label:(0,g.Z)("Reply All"),labelEnglish:"Reply All"}];getStandardFlagsMenu=(e,t)=>{const s=[];for(const n of D.Z.getStandardFlagList()){let i=ie(n);n===E.T4.CLEAR_FLAGS&&(s.push({type:"separator",label:"",labelEnglish:""}),i=void 0),s.push({type:"checkbox",checked:n===t,handler:()=>this.toggleStandardFlag(e,n,t),label:(0,X.M)(n),labelEnglish:n,iconPNG:i,iconPNGWhite:i})}return s};toggleStandardFlag=(e,t,s)=>{const n=s===t?(0,$.KR)(E.T4.CLEAR_FLAGS):(0,$.KR)(t);this.setCustomFlags(e,n)};async _updateFlags(e,t){const s=e.map((e=>({searchListId:e.id})));await R.Z.call(s,t),e.forEach((e=>{const s=(0,$.hY)(e.flags,t);i.Z.updateIndex({sleUpdates:[{id:e.id,updates:{flags:s}}]})}));const n=e.map((e=>e.id));await I.Z.addImapFlags(n,t)}setStandardFlag=(e,t)=>{const s=(0,$.KR)(t);this.setCustomFlags(e,s)};async markAsJunk(e){const t=this.getSelectedEntries(e);await o.Z.moveToJunk(t)}async markAsNotJunk(e){const t=this.getSelectedEntries(e);await o.Z.restoreFromJunk(t)}async clearJunkFlags(e,t,s){const n=s?t:t.filter((e=>[...e.flags].some((e=>e===E.T4.JUNK)))),i={[E.T4.JUNK]:!1,[E.T4.NOT_JUNK]:!0,Junk:!1};n.length>0&&await this._updateFlags(n,i)}async clearDeletedFlags(e,t){const s=t.filter((e=>[...e.flags].some((e=>e===E.T4.DELETED)))),n={[E.T4.DELETED]:!1};s.length>0&&await this._updateFlags(s,n)}moveToArchive(e){const t=this.getSelectedEntries(e);o.Z.moveToArchive(t)}restoreFromArchive(e){const t=this.getSelectedEntries(e);o.Z.restoreFromArchive(t)}},he=ce},59720:(e,t,s)=>{"use strict";s.d(t,{Z:()=>i});var n=s(33638);const i=new class{setActiveWebView(e,t){n.Z.dispatch({actionType:"WEBVIEW_SET_ACTIVE",windowId:e,component:t})}clearIfActive(e,t){n.Z.dispatch({actionType:"WEBVIEW_CLEAR_IF_ACTIVE",windowId:e,component:t})}}},48603:(e,t,s)=>{"use strict";s.d(t,{Z:()=>$});var n=s(27770),i=s(68247),a=s(29087),o=s(80822),r=s(92292),l=s(7064),d=s(89175);const c="[bookmark update]",h=function(){return new Promise((e=>{l.Z.bookmarksPrivate.updatePartners(((t,s,n)=>{r.Z.runtime.lastError&&(console.warn(c,"failed to call vivaldi.bookmarksPrivate.updatePartners:",r.Z.runtime.lastError.message),t=!1,s=!1),e([t,s,n])}))}))},u=function(e){const t=function(e,s){for(let n=0;n<e.length;n++){const i=e[n];i.url&&(i.partner?console.warn(c,"partner id in bookmark tree without version:",i.partner,i.url):s.set(i.url,i.id)),i.children&&t(i.children,s)}};return Promise.all([new Promise((e=>{r.Z.bookmarks.getTree((t=>{r.Z.runtime.lastError&&console.warn(c,"failed to call chrome.bookmarks.getTree:",r.Z.runtime.lastError.message),e(t)}))})).then((e=>{const s=new Map;return e&&t(e,s),s})),fetch("./default-bookmarks/fallback-partner-ids.json",{method:"GET"}).then((e=>e.json())).then((t=>{let s=t[e];return s||(s=t[o.Z.getFallbackLocale()]),s}))]).then((([e,t])=>{const s={numMatch:0,size:0};return t?Promise.all(function*(e,t,s){const n=Object.keys(t);e:for(const i of n){const n=t[i];s.size+=1;for(const t of n){const n=e.get(t);if(n){console.warn(c,"Match",i,t),s.numMatch+=1,yield new Promise((e=>{r.Z.bookmarks.update(n,{partner:i},(()=>{r.Z.runtime.lastError&&console.warn(c,"failed to update partner:",i,r.Z.runtime.lastError.message),e()}))}));continue e}}console.warn(c,"No match for",i,n.join(" "))}}(e,t,s)).then((()=>s)):s})).then((e=>{console.warn(c,"Urls matched",e.numMatch,"of",e.size)}))},p={init:()=>h().then((([e,t,s])=>t?u(s).then((()=>(i.Z.set(d.kBookmarksVersion,"0"),h().then((([e])=>e))))):e)).catch((e=>(console.warn(c,"error while updating bookmarks:",e),!1))).then((e=>(e||console.warn(c,"failed to update bookmarks, current version:",a.Z.get(d.kBookmarksVersion)),e)))};var g=s(59486),m=s(96951),f=s(57049),v=s(33638),b=s(56371),C=s(28773),w=s(30381),y=s.n(w),x=s(58379),I=s(35369),A=s(30460),S=s(44850),Z=s(59322);const T=f.t;let E=!0,k=!0;function N(){E=!0}function _(){E=!1,O()}function P(){v.Z.dispatch({actionType:"BOOKMARKS_SET_BATCH_MODE",edit:!0})}function M(){v.Z.dispatch({actionType:"BOOKMARKS_SET_BATCH_MODE",edit:!1})}function D(e){const t=[],s=[];for(const n of e)s.push(n.url),t.push({...n,faviconUrl:void 0,partner:""});if(!a.Z.get(d.kDashboardTopSitesHideSuggestions))for(const e of T){if(t.length>=10)break;s.includes(e.url)||t.push({...e,partner:e.url})}return t}async function O(e=!1){const t=fetch("./default-bookmarks/partners.json").then((e=>e.json())).catch((()=>(console.warn("Failed to load partner bookmarks"),{bookmarks:[],folders:[]}))),[s,n,i,a]=await Promise.all([r.Z.bookmarks.getTree(),t,l.Z.bookmarksPrivate.getFolderIds(),(0,x.Z)().then(D)]);v.Z.dispatch({actionType:"BOOKMARKS_INIT",bookmarks:s,folderIds:i,topSites:a,failedUpgrade:e,partnerDB:n})}function j(e,t){E||v.Z.dispatch({actionType:"BOOKMARKS_ADD_ITEM",id:e,changes:t})}function L(e,t){E||v.Z.dispatch({actionType:"BOOKMARKS_CHANGE_ITEM",id:e,changes:t})}function R(e,t){E||v.Z.dispatch({actionType:"BOOKMARKS_MOVE_ITEM",id:e,changes:t})}function B(e){v.Z.dispatch({actionType:"BOOKMARKS_REMOVE_ITEM",id:e})}function F(e,t){E||O()}function W(e,t){if(E)return;g.Z.getItemById(e)&&v.Z.dispatch({actionType:"BOOKMARKS_CHANGE_ITEM",id:e,changes:{faviconUrl:t}})}function U(e,t){E||v.Z.dispatch({actionType:"BOOKMARKS_CHANGE_ITEM",id:e,changes:t})}function V(){!1===k&&(k=!0,l.Z.bookmarksPrivate.onFaviconChanged.removeListener(W))}function H(){!0===k&&(k=!1,l.Z.bookmarksPrivate.onFaviconChanged.addListener(W))}async function G(e){const t=(0,m.NK)(e.pages).map((e=>({page:"group"===e.type?void 0:e.page,url:"group"===e.type?void 0:e.page.url,title:"group"===e.type?e.page?.vivExtData.fixedGroupTitle??(0,b.Z)("Stack"):e.page?.vivExtData.fixedTitle??(0,S.D1)(e.page),children:"group"===e.type?e.pages.map((e=>({page:e,url:e.url,title:(0,S.D1)(e)}))).toArray():void 0}))).filter((e=>e.children||e.url));if(!t.size)return;const{parentId:s,index:n}=e;if(1!==t.size||e.forceFolder){if(e.isStack){return await Promise.all(t.map((async({children:e,title:t})=>{if(!e?.length)return"";const n=await r.Z.bookmarks.create({parentId:s,title:t});return await z.createBookmarks(e,n.id,0,"none"),n.id}))).then((e=>e.filter(Boolean)[0]))}{const i={parentId:s,..."number"==typeof n?{index:n}:null},a=await r.Z.bookmarks.create(i),o=y()(a.dateAdded).format("YYYY-MM-DD, HH:mm:ss"),l=e.isSelection?(0,b.Z)("Saved Tab Selection ($1)",[o]):(0,b.Z)("Saved Tabs ($1)",[o]);return await r.Z.bookmarks.update(a.id,{title:l}),await Promise.all(t.map((async e=>{const{children:t,title:s,url:n}=e;if(t?.length){const e=await r.Z.bookmarks.create({parentId:a.id,title:s});await z.createBookmarks(t,e.id,0,"none")}else await r.Z.bookmarks.create({parentId:a.id,title:s,url:n})}))),a.id}}{const{children:e,title:i,page:a}=t.first();if(e?.length){const t={parentId:s,title:i,..."number"==typeof n?{index:n}:null},a=await r.Z.bookmarks.create(t);return await z.createBookmarks(e,a.id,0,"none"),a.id}return a&&!e?z.bookmarkPageInFolder(a,s,n):void 0}}function K({clipboardData:e},t,s){e&&(t=g.Z.validateForClipboard(t),e.setData("vivaldi/x-cut",s),e.setData(n.yR,JSON.stringify(t)),e.setData("text/plain",g.Z.getDragData("text/plain",t)))}const z=new class{loadPromise=()=>p.init().then((e=>O(!e))).then((()=>{E=!1,k=!1,r.Z.bookmarks.onImportBegan.addListener(N),r.Z.bookmarks.onImportEnded.addListener(_),r.Z.bookmarks.onChanged.addListener(L),r.Z.bookmarks.onCreated.addListener(j),r.Z.bookmarks.onRemoved.addListener(B),r.Z.bookmarks.onMoved.addListener(R),r.Z.bookmarks.onChildrenReordered.addListener(F),l.Z.bookmarkContextMenu.onOpen.addListener(V),l.Z.bookmarkContextMenu.onClose.addListener(H),l.Z.menubarMenu.onOpen.addListener(V),l.Z.menubarMenu.onClose.addListener(H),l.Z.bookmarksPrivate.onFaviconChanged.addListener(W),l.Z.bookmarksPrivate.onMetaInfoChanged.addListener(U),l.Z.utilities.onTopSitesChanged.addListener(this.setTopSites)}));setTopSites=async()=>{v.Z.dispatch({actionType:"BOOKMARKS_SET_TOPSITES",topSites:D(await(0,x.Z)())})};setBookmarkBarFolderAndToggleVisibility(e){const t=g.Z.getBookmarkBarFolderId()!==e||!a.Z.get(d.kBookmarksBarVisible);return z.setBookmarkBarFolder(e).then((e=>{e&&i.Z.set(d.kBookmarksBarVisible,t)}))}setBookmarkBarFolderAndShow(e){return z.setBookmarkBarFolder(e).then((e=>{e&&i.Z.set(d.kBookmarksBarVisible,!0)}))}async setBookmarkBarFolder(e){const t=g.Z.getItemById(e);if(!t||!g.Z.isFolder(t))return!1;const s=g.Z.getBookmarkBarFolderId();if(s===e)return!0;P();try{void 0!==s&&s!==g.Z.getRootId()&&await r.Z.bookmarks.update(s,{bookmarkbar:!1}),await r.Z.bookmarks.update(e,{bookmarkbar:!0})}catch(e){console.warn(`BookmarkActions: Failed to set bookmark bar folder: ${e}`)}finally{M()}return!0}addSpeeddialGroup(e){g.Z.isFolder(e)&&(r.Z.bookmarks.update(e.id,{speeddial:!0}),i.Z.set(d.kStartpageSpeedDialOrder,a.Z.get(d.kStartpageSpeedDialOrder).concat([e.id])))}removeSpeeddialGroup(e){g.Z.isFolder(e)&&(r.Z.bookmarks.update(e.id,{speeddial:!1}),i.Z.set(d.kStartpageSpeedDialOrder,a.Z.get(d.kStartpageSpeedDialOrder).filter((t=>t!==e.id))))}setActiveGroup(e,t){v.Z.dispatch({actionType:"BOOKMARKS_SET_ACTIVE_GROUP",windowId:e,id:t})}setCutIds=e=>{v.Z.dispatch({actionType:"BOOKMARKS_SET_CUT_IDS",ids:e})};installTopSites(){v.Z.dispatch({actionType:"BOOKMARKS_INSTALL_TOPSITES"})}async move(e,t,s){const n=g.Z.validateForDrag(e).map((e=>g.Z.getItemById(e)?.id)).filter(Boolean);P();const i=await function(e,{parentId:t,index:s}){return e.reduce((async(e,n)=>{const i=await e,a=i[i.length-1]?.index,o=await r.Z.bookmarks.move(n,{parentId:t,index:void 0!==a?a+1:s});return i.push(o),Promise.resolve(i)}),Promise.resolve([]))}(n,{parentId:t,index:s});return M(),i.map((e=>e.id))}reorder(e,t){return e=g.Z.validateForDrag(e),P(),Promise.all(e.reverse().map((e=>r.Z.bookmarks.move(e,{parentId:t,index:0}).then((e=>e.id))))).then((e=>(M(),e)))}async duplicate(e,t,s){const n=structuredClone(e.map((e=>g.Z.getItemById(e))).filter((e=>e&&!e.trash)).filter(Boolean));P();const i=await Promise.all(n.map((async e=>{const{title:n,url:i,description:a,nickname:o,children:l}=e,d=await r.Z.bookmarks.create({index:s++,parentId:t,title:n,...(0,C.Z)(i?{url:i}:null),...(0,C.Z)(a?{description:a}:null),...(0,C.Z)(o?{nickname:o}:null)});if(!d)throw new Error("Bookmark was not created");if(l?.length){const e=l.map((({id:e})=>e));await this.duplicate(e,d.id,0)}return d.id})));return M(),i}async createWithPromise(e,t,s){P();const n=await Promise.all(e.map((async e=>{if(e.separator)return this.createSeparator(t,void 0===s?void 0:s++);const n=await r.Z.bookmarks.create({title:e.title,url:e.url||(e.children?void 0:A.p),parentId:t,description:e.description,nickname:e.nickname,index:void 0===s?void 0:s++});return e.children?.length&&await z.createWithPromise(e.children,n.id,0),n})));return M(),n}createSeparator(e,t){return r.Z.bookmarks.create({title:"---",url:A.p,parentId:e,description:"separator",nickname:"",index:t})}async createBookmarks(e,t,s,n){if(P(),"none"!==n){const e={parentId:t,..."number"==typeof s?{index:s}:null},i=await r.Z.bookmarks.create(e),a=y()(i.dateAdded).format("YYYY-MM-DD, HH:mm:ss");let o;switch(n){case"history":o=(0,b.Z)("Saved History ($1)",[a]);break;case"sync":o=(0,b.Z)("Saved Synced Tabs ($1)",[a])}o&&await r.Z.bookmarks.update(i.id,{title:o}),t=i.id}const i=await Promise.all(e.map((({url:e,title:n})=>r.Z.bookmarks.create({parentId:t,url:e,title:n,index:s++}).then((({id:e})=>e)))));return M(),i}remove=e=>(P(),Promise.all(e.map((e=>{const t=g.Z.getItemById(e);return t&&g.Z.isFolder(t)&&t.id===a.Z.get(d.kBookmarksSaveFolder)&&i.Z.set(d.kBookmarksSaveFolder,g.Z.getRootId()),t&&g.Z.isFolder(t)?r.Z.bookmarks.removeTree(e).catch((()=>console.warn(`Error removing bookmark tree: ${e}`))):r.Z.bookmarks.remove(e).catch((()=>console.warn(`Error removing bookmark: ${e}`)))}))).then((()=>M())));async emptyTrash(){!1===await new Promise((e=>{l.Z.bookmarksPrivate.emptyTrash(e),l.Z.utilities.cleanUnusedImages(0)}))&&console.warn("Empty trash failed.")}bookmarkAllOpenPages(e,t,s){const n=m.ZP.getActiveWorkspace(e);return G({pages:m.ZP.getPages(e,{workspaceId:n}),parentId:t,index:s,isStack:!1,isSelection:!1,forceFolder:!0})}bookmarkPages(e,t,s,n){return G({pages:(0,Z.nq)(e)?e:I.aV.of(e),parentId:s,index:n,isStack:t,isSelection:!0,forceFolder:(0,Z.nq)(e)})}async bookmarkPageInFolder(e,t,s){const{url:n}=e,i=(0,S.D1)(e),{id:a}=await r.Z.bookmarks.create({parentId:t,url:n,title:i,..."number"==typeof s?{index:s}:null});return a}cut(e,t){K(e,t,"true"),z.setCutIds(t),e.stopPropagation(),e.preventDefault()}copy(e,t){K(e,t,"false"),e.stopPropagation(),e.preventDefault()}paste({clipboardData:e},t,s){const i=g.Z.getItemById(t);if(!i||!e)return Promise.resolve({isCut:!1,ids:[]});let a,o;if(g.Z.isFolder(i))a=i.id,!0===s&&i.children?(o=i.children.length,o>0&&i.children[o-1].trash&&o--):o=0;else if(a=i.parentId,o=(i.index||0)+1,void 0===a)return console.log("error","Can not paste, target has no parent"),Promise.resolve({isCut:!1,ids:[]});const r=-1!==e.types.findIndex((e=>e===n.yR))?JSON.parse(e.getData(n.yR)):[];if(0===r.length)return Promise.resolve({isCut:!1,ids:[]});return g.Z.getCutIds().length>0&&"true"===e.getData("vivaldi/x-cut")?z.move(r,a,o).then((e=>(z.setCutIds([]),{isCut:!0,ids:e}))):z.duplicate(r,a,o).then((e=>({isCut:!1,ids:e})))}async onDropEvent(e,t,s,i){if(e.dataTransfer.types.includes(n.yR)){const a=JSON.parse(e.nativeEvent.dataTransfer.getData(n.yR));n.ZP.isCopyModifierPressed(e)||i&&i.disableMove?await z.duplicate(a,t,s):await z.move(a,t,s)}else{const i=await n.ZP.getUrlsFromEventPromise(e,!0);await z.createBookmarks(i,t,s,"none")}}},$=z},15590:(e,t,s)=>{"use strict";s.d(t,{Z:()=>l});var n=s(27508),i=s(59322),a=s(33638),o=s(92292),r=s(63164);const l={toggleBreakMode:async function(e){const t=!n.Z.getState().isActive;await async function(e,t){const s=t?"mute":"unmute";t&&a.Z.dispatch({actionType:"TOOLTIP_SET",id:null});await i.ZP.setMuting(e,"all",s),a.Z.dispatch({actionType:"BREAKMODE",isActive:t});const n=await o.Z.tabs.query({});await Promise.all(n.map((async e=>e.id&&e.id>=0?(0,r.VN)(e.id,{type:"BREAK_MODE_SET",value:t}):Promise.resolve())))}(e,t)}}},2934:(e,t,s)=>{"use strict";s.d(t,{z:()=>H,ZP:()=>Q});var n=s(39005),i=s(50522),a=s(51525),o=s(82649),r=s(12442),l=s(15800),d=s(34930),c=s(1712),h=s(46382),u=s(33499),p=s(17673),g=s(96951),m=s(24367),f=s(68247),v=s(29087),b=s(60331),C=s(33638),w=s(15489),y=s(56371),x=s(78347),I=s(92292),A=s(98035),S=s(45660),Z=s(28773),T=s(80008),E=s.n(T),k=s(41851),N=s(7064),_=s(89175);const P={1:[{name:(0,y.Z)("One hour meeting"),ical:"BEGIN:VCALENDAR\nBEGIN:VEVENT\nUID:X-VIV-TEMPLATE-1\nDURATION:PT1H\nBEGIN:VALARM\nACTION:DISPLAY\nDESCRIPTION:\nTRIGGER:-PT15M\nEND:VALARM\nEND:VEVENT\nEND:VCALENDAR\n"},{name:(0,y.Z)("Doctor's appointment"),ical:"BEGIN:VCALENDAR\nBEGIN:VEVENT\nUID:X-VIV-TEMPLATE-2\nDURATION:PT15M\nBEGIN:VALARM\nACTION:DISPLAY\nDESCRIPTION:\nTRIGGER:-PT24H\nEND:VALARM\nEND:VEVENT\nEND:VCALENDAR\n"},{name:(0,y.Z)("calendar","Birthday"),ical:"BEGIN:VCALENDAR\nBEGIN:VEVENT\nUID:X-VIV-TEMPLATE-3\nX-VIV-ALLDAY:TRUE\nRRULE:FREQ=YEARLY;INTERVAL=1\nBEGIN:VALARM\nACTION:DISPLAY\nDESCRIPTION:\nTRIGGER:PT7H\nEND:VALARM\nEND:VEVENT\nEND:VCALENDAR\n"}]};var M=s(24522),D=s(87852),O=s(58228),j=s(47543),L=s(90870),R=s(13289),B=s(58821),F=s(34155);const{getPollResultText:W,validateEventTypes:U,getGeneratedSourceEvent:V}=l.ZP,H=new Set(E().tz.names());function G(){return{title:(0,y.Z)("Change External Event"),body:(0,y.Z)("You’re changing an external event. Changes you make will only show locally and may be overwritten by changes from event organiser."),actions:[{title:(0,y.Z)("Apply Change"),action:"confirm"}],cancelAction:{title:(0,y.Z)("Cancel"),action:"cancel",default:!0}}}function K(e){let t="",s="";switch(e){case"save":t=(0,y.Z)("Change Recurring Event"),s=(0,y.Z)("You’re changing a repeating event. Do you want to change this occurrence only, this and upcoming events or change all events from start?");break;case"trash":t=(0,y.Z)("Delete Recurring Event"),s=(0,y.Z)("You’re deleting a repeating event. Do you want to delete this occurrence only, this and upcoming events or delete all events from start?");break;case"move":t=(0,y.Z)("Reschedule Recurring Event"),s=(0,y.Z)("You’re rescheduling a repeating event. Do you want to change this occurrence only, this and upcoming events or reschedule all events from start by same amount?");break;case"copy":t=(0,y.Z)("Copy Recurring Event"),s=(0,y.Z)("You’re copying a repeating event. Do you want to copy this occurrence only, this and upcoming events or copy all events from start?")}return{title:t,body:s,actions:[{title:(0,y.Z)("Only this Event"),action:"single",default:!0},{title:(0,y.Z)("This and Upcoming"),action:"upcoming"},{title:(0,y.Z)("All Events"),action:"all"}],cancelAction:{title:(0,y.Z)("Cancel"),action:"cancel"}}}function z(e,t){const s={start:0,end:0},n=E()(t.start),i=t.end&&E()(t.end);return e.task?i?t.byDateOnly?(s.start=e.start?E()(e.start).year(n.year()).month(n.month()).date(n.date()).valueOf():t.start,s.end=e.end?E()(e.end).year(i.year()).month(i.month()).date(i.date()).valueOf():i.valueOf()):(s.start=t.start,s.end=i.valueOf()):(t.byDateOnly?s.end=e.end?E()(e.end).year(n.year()).month(n.month()).date(n.date()).valueOf():t.start:s.end=t.start,s.start=e.start&&e.end?s.end-(e.end-e.start):0):t.byDateOnly?(s.start=E()(e.start).year(n.year()).month(n.month()).date(n.date()).valueOf(),s.end=i?E()(e.end).year(i.year()).month(i.month()).date(i.date()).valueOf():e.end?s.start+e.end-e.start:0):(s.start=t.start,s.end=t.end||(e.end?s.start+e.end-e.start:0)),t.hasOwnProperty("allDay")&&(s.allDay=t.allDay),s}function $(e,t=!0){return t&&l.ZP.isCalDAV(l.ZP.getAccountAndCalendar(e.calendarId)?.account?.account_type)}function Y(e,t,s){s===_.kFeaturesCalendar&&(t?X.startAPIChangeListeners():X.stopAPIChangeListeners())}const X=new class{#e=!1;async loadEvents(){return X.transformVivaldiEvents(await N.Z.calendar.getAllEvents())}loadDatabase=async()=>{if(m.Z.isCalendarOn()){const[e,t,s]=await Promise.all([N.Z.calendar.getAllAccounts(),X.loadEvents(),N.Z.calendar.getAll(),u.ZP.loadNotifications()]);C.Z.dispatch({actionType:"CALENDAR_INIT",accounts:e,events:t,calendars:s})}};async loadTemplates(){const e=await k.Z.loadTemplatesList();C.Z.dispatch({actionType:"CALENDAR_INIT_TEMPLATES",templates:e})}async loadPromise(){this.loadDatabase(),this.loadTemplates()}transformVivaldiEvents(e){const t=(0,B.EP)()||"",s=E().tz.zone(t);return e.map((e=>{const{start:n,end:i,attachment:a,...o}=e;let r=0,d=0;e.timezone===M.$T||e.allDay?s&&(r=s.utcOffset(n||0)*M.lb,d=s.utcOffset(i||0)*M.lb):e.timezone&&H.has(e.timezone)||(o.timezone=t);const c=n?n+r:0;return{...o,start:c,end:i?i+d:c,attachment:l.ZP.stringToAttachments(a)}}))}async trimExceptions(e,t){const s=e.recurrenceExceptions;if(!s)return;let n=0;e.start&&t.start?n=e.start-t.start:e.end&&t.end&&(n=e.end-t.end);const i=e.start??0;let a=-1/0;const o=(0,j.Qj)(e.rrule);o&&(a=o.options.until?o.options.until.valueOf():o.options.count?o.all().pop()?.valueOf()??1/0:1/0);for(const t of s){const{date:s,exception_id:o,parent_event_id:r}=t;o&&r===e.id&&(s+n<i||s+n>a)&&await N.Z.calendar.deleteEventException(o)}}updateEditState(e,t,s){C.Z.dispatch({actionType:"CALENDAR_EVENT_EDIT",edit:{windowId:e,pageId:t,eventId:s}})}async createEventTemplate(e){const t=await k.Z.saveTemplate("",e);C.Z.dispatch({actionType:"CALENDAR_ADD_TEMPLATE",template:t})}async updateTemplate(e,t){const s=await k.Z.saveTemplate(e,t);C.Z.dispatch({actionType:"CALENDAR_UPDATE_TEMPLATE",templateId:e,template:s})}async removeTemplate(e){await k.Z.deleteTemplate(e),C.Z.dispatch({actionType:"CALENDAR_REMOVE_TEMPLATE",templateId:e})}async createEvent(e,t=!0,s=!0){const n=(0,B.sG)(e),a=i.Z.getCalendars().find((e=>e.id===n.calendarId));if(!a)throw"Can not create event, calendar not found";a.hidden&&X.updateCalendar(a.id,{hidden:!1}),n.syncPending=$(n,t);const r=(0,j.jw)(n.rrule,n.timezone);r&&(n.end_recurring=r);const l=await A.Z.createEvent(n);return s&&C.Z.dispatch({actionType:"CALENDAR_SET_EVENTS",events:[l]}),l.syncPending&&o.Z.createEvent(l),u.ZP.updateAlarmsForEvent(l),l}createEvents(e){if(!e.length)return Promise.resolve({created_count:0,failed_count:0});const t=e.map((e=>{const{exceptionEvents:t,...s}=e;return{...s,syncPending:!1}})).map(B.sG);return A.Z.createEvents(t)}eventToCreateDetails(e){const{alarmId:t,id:s,recurrenceExceptions:n,trash:i,trash_time:a,notifications:o,filteredOut:r,invites:d,attachment:c,recurrenceId:h,...u}=e,p={...u,attachment:l.ZP.attachmentsToString(c),is_template:!1};return p.timezone=p.timezone||(0,B.EP)(),p.notifications=o?.map((e=>({name:e.name,when:e.when}))),p.invites=d?.map((e=>({address:e.address,name:e.name||"",partstat:e.partstat||"NEEDS-ACTION"}))),p}async updateEvent(e,t,s=!1,n){const a={...e},r=i.Z.getEvent(a.id.split(":")[0])??{...a};async function c(e){let t=parseInt(a.id.split(":")[1]);e.start&&!a.start?t+=e.end-e.start:!e.start&&a.start&&(t-=a.end-a.start);let s=0,n=a.rrule??"",i=e.recurrenceExceptions;const o=(0,j.Qj)(n);let r=(0,j.jw)(n,a.timezone);const l=a.start||a.end;if(o&&t!==l){s=l-t,r&&(r+=s);const a=(0,j.EE)(o.origOptions,s,e);n=(0,j.Ns)({...a,...(0,Z.Z)(a.dtstart?{dtstart:new Date((0,B.FL)(a.dtstart).valueOf()+s)}:null)}),e.recurrenceExceptions?.length&&(i=e.recurrenceExceptions.map((e=>({...e,date:e.date+s}))))}let d,c;a.task?(c=e.end+s,d=a.start?c-(a.end-a.start):0):(d=e.start+v,c=d+a.end-a.start);const h={...a,uid:e.uid,id:e.id,start:d,end:c,rrule:n,end_recurring:r,recurrenceExceptions:i};return await X.trimExceptions(h,e),h}let g,m=(0,B.sG)(a);m.id=m.id.split("-")[0],m.syncPending||(m.syncPending=$(m,s));const f=parseInt(m.id.split(":")[1]),v=(a.start||a.end)-f;try{if(X.stopAPIChangeListeners(),l.ZP.isGeneratedRecurringEvent(a)){const e=m.id.split(":")[0],n=l.ZP.getGeneratedSourceEvent(a);switch(t){case"single":if(l.ZP.getBaseEventIfException(m)){const e=n.recurrenceExceptions?.find((e=>e.date===m.recurrenceId))?.exception_event_id;if(!e)throw new Error("Could not find exception event id");m.id=e,m.rrule="",m.recurrenceExceptions=[],g=await A.Z.updateEvent(m),u.ZP.updateAlarmsForEvent(g),m=n}else{const t=X.eventToCreateDetails({...a,calendarId:a.calendarId,start:a.start,sequence:0,rrule:""});g=await X.createEvent(t,!1,!1),m=await A.Z.createException(e,!1,f,g.id)}g.recurrenceId=f;break;case"upcoming":if(!f||!n)throw new Error(`Invalid event id to update, ${m.id}`);const{rrule:t}=n,i=new Date(f),d=(0,j.Qj)(t,n.timezone,n.start);if(!d)throw new Error(`No recurrence on event to update, ${m.id}`);const h=(0,j._v)(d,i,m.timezone);if(!h){m=await c(n);break}const{origOptions:p}=d;let b;if(p.dtstart=p.dtstart&&(0,B.FL)(p.dtstart),p.until=p.until&&(0,B.FL)(p.until),m.rrule){const{rrule:e,start:t,timezone:s}=m;b=(0,j.Qj)(e,s,t)?.origOptions,v&&(b=(0,j.EE)(b,v,n))}const C=(0,j.Zm)({...p,until:h});let w,y;const x=p.count;if(x){const e=C.all().length;w=(0,j.Ns)({...p,count:e});const t=x-e;y=b&&(0,j.Ns)({...b,count:t,dtstart:new Date(m.start||m.end)})}else w=(0,j.Ns)({...p,until:h}),y=b&&(0,j.Ns)({...b,dtstart:new Date(m.start||m.end)});const[I,S]=(0,L.Z)(m.recurrenceExceptions??[],(e=>e.date>=f));v&&I.forEach((e=>e.date=e.date+v));const Z=await A.Z.updateEvent({...n,rrule:w});if(l.ZP.isRemoteCalendar(Z.calendarId)&&s){const e={...Z,recurrenceExceptions:S};r?o.Z.updateEvent(e,{originalEvent:r}):o.Z.updateEvent(e)}u.ZP.updateAlarmsForEvent(Z),m.uid=crypto.randomUUID(),m.href="",m.etag="",m.end_recurring=(0,j.jw)(y,m.timezone),m.trash||(m.rrule=y,m=await X.createEvent({...X.eventToCreateDetails(m),recurrenceExceptions:I}));const T=await A.Z.updateExceptions(I.map((e=>({exception_id:e.exception_id,parent_event_id:m.id,date:e.date}))));if(T){m=T;for(const e of I)e.exception_event_id&&A.Z.updateEvent({id:e.exception_event_id,uid:m.uid})}return await this.trimExceptions(m,a),m;default:if(!n)throw new Error(`Source event for ${a.id} not found`);m=await c(n)}}const e=i.Z.getEvents().find((e=>e.id===m.id)),b=l.ZP.isOwnEvent(m),x=l.ZP.shouldIncrementSequence(m,e);if(b&&x){const{sequence:e}=m;m.sequence=e?e+1:1}let I=[];if(m.trash||(!async function(e){const t=e.notifications||[];if(!e.id)throw new Error("Can not save event reminders, invalid event Id.");const s=p.Z.getState().notifications.filter((t=>t.event_id===e.id)),[n,i]=(0,L.Z)(t,(e=>!e.id)),a=s.filter((e=>!i.some((t=>t.id===e.id)))),o=n.filter((e=>!i.some((t=>e.when===t.when))));for(const t of o)await u.ZP.createNotification({event_id:e.id,when:t.when,period:t.period||0,delay:t.delay||0,name:t.name||"",description:t.description||""},e);for(const t of i)await u.ZP.updateNotification(t,e);for(const e of a)await u.ZP.deleteNotification(e)}(m),(x||e?.title!==m.title||e?.description!==m.description||e?.location!==m.location)&&(I=await async function(e,t,s,n=!1){if(!(t.invites&&0!==t.invites.length||s?.invites&&0!==s.invites.length))return[];if(!t.invites||!e)throw new Error("Missing invites from draft or invalid event Id");const i=s?.invites??[],a=(0,R.Z)(t.invites,i,"address"),o=(0,R.Z)(i,t.invites,"address"),r=(0,R.Z)(i,o,"address");for(const t of a)await N.Z.calendar.createInvite({event_id:e,name:t.name||"",address:t.address,partstat:t.partstat});for(const e of r){const s=t.invites&&t.invites.find((t=>t.address===e.address));s&&await N.Z.calendar.updateInvite({id:e.id,address:s.address,name:s.name,partstat:s.partstat})}for(const e of o)await N.Z.calendar.deleteInvite(e.id);if(l.ZP.isOwnEvent(t)){const e=[];return a.length&&e.push(["create",a]),n&&r.length&&e.push(["update",r]),o.length&&e.push(["cancel",o]),e}return[]}(m.id,m,e,!0))),m.recurrenceExceptions?.length&&v)for(const e of m.recurrenceExceptions){if(!e.exception_id)throw Error("Inconsistent data. Exception missing ID.");await N.Z.calendar.updateRecurrenceException(e.exception_id,{date:e.date})}let Z=await A.Z.updateEvent(m);const T=[Z];if(g&&T.push(g),C.Z.dispatch({actionType:"CALENDAR_SET_EVENTS",events:T}),u.ZP.updateAlarmsForEvent(Z),s&&I.length)try{await d.Z.sendAttendeeMails(n,Z,I)}catch(e){S.Z.warn("Calendar",["update","event","invite"],e.message)}if(s){let i;if(e&&e.calendarId!==Z.calendarId)l.ZP.isRemoteCalendar(e.calendarId)&&await o.Z.deleteEvent(e.id),i=l.ZP.isRemoteCalendar(Z.calendarId)?await o.Z.createEvent(o.Z.resetEventRemoteData(Z)):Z;else if(l.ZP.isRemoteCalendar(Z.calendarId))try{i=await o.Z.updateEvent(Z,{exceptionEvent:g,originalEvent:r})}catch(e){if(!(e instanceof o.t))throw e;{const a=w.ZP.getLastActiveBrowserWindowId(),{action:o}=await h.Z.showModal(a,{modal:{title:(0,y.Z)("Conflict when Saving Event"),body:(0,y.Z)("There is an updated version of the event on the calendar server. Which action do you want to take?"),actions:[{title:(0,y.Z)("Use Local Event"),action:"local"}],cancelAction:{title:(0,y.Z)("Use Server Event"),action:"server",default:!0}}}),r="local"===o?e.local:e.incoming;i=await X.updateEvent(r,t,s,n)}}i&&(Z=i)}return Z}finally{X.startAPIChangeListeners()}}showAddEvent(e){const{winId:t,listEntry:s,message:i,...a}=e,o=l.ZP.minimalCreateEvent(a);if(e.message||g.ZP.getActivePage(e.winId)?.isMailPage){o.url||(o.url=i?.id?n.Z.getMessageUrl(i.id):n.Z.getActiveMessageUrl());const e=s??n.Z.getActiveListEntry();e&&(o.title=o.title||e.subject,o.description=e.preview)}X.addEventCommand(t,o)}showAddInvite(e){let t=[],s="";const i=e.message??n.Z.getActiveMessage();if(i){t=[...i.from,...i.to,...i.cc].map((({address:e,name:t})=>({address:e,name:t||"",partstat:"NEEDS-ACTION"})));const e=x.Z.getAccounts(),n=t.find((t=>e[t.address]));n&&(s=n.address,t=t.filter((e=>e.address!==n.address)))}if(!s){const e=v.Z.get(_.kMailAccounts);v.Z.get(_.kCalendarMailAccount)?s=v.Z.get(_.kCalendarMailAccount):e.length>0&&(s=e[0].MAIL_EMAIL)}X.showAddEvent({invites:t,organizer:s,...e})}showAddTask(e){X.showAddEvent({task:!0,...e})}async addEventCommand(e,t){t.task||t.start||(t.start=(0,B.zX)(Date.now())),t.url?.startsWith("data:")&&(t.url=""),X.updateEditState(e,D.W$,""),h.Z.showCalendarEditEvent(e,t)}async pollAllCalDAVAccountsWithStatus(){const e=await X.pollAllCalDAVAccounts({interactive:!0});b.Z.setStatus(w.Ex,W(e),6e3)}async pollAllCalDAVAccounts(e){const{interactive:t,throttle:s}=e??{},n=i.Z.getState().accounts.filter((e=>e.url)).map((e=>e.id)),a={didPoll:!1,calendars:[],message:"",error:!1};if(0===n.length)return a.didPoll=!0,a;const r=i.Z.getState().calendars.filter((e=>n.some((t=>t===e.accountId)))).filter((e=>e.active)).map((e=>e.lastChecked)).filter(Boolean).reduce(((e,t)=>t>e?t:e),0)+6e4<=Date.now();return s&&!r?a:await o.Z.pollCalDAV({accountIds:n,interactive:t||!1})}async saveEvent(e,t,s){if(!e)return{clearDraft:!1};const n=w.ZP.getLastActiveBrowserWindowId();if(!l.ZP.doesCalendarsExistsAndShowWarning(n))return{clearDraft:!1};e.calendarId||(e.calendarId=l.ZP.getDefaultCalendar(e.task)?.id||""),e.id=e.id.split("-")[0],e.task&&(e.invites=[]);const i=l.ZP.shouldSaveEvent(e,t);if("IGNORE"===i||"DELETE"===i&&!e.id)return{clearDraft:!0};if("DELETE"===i){return{clearDraft:await X.trashEvent(e.id)}}if(!e.id){const t=await X.createEvent(U(X.eventToCreateDetails(e)));let n="sent";if(t?.invites?.length){const e=[...t.invites];if(!e.some((e=>e.address===t.organizer))){const s=d.Z.getOrganizerAsAttendee(t);s&&e.push(s)}try{n=await d.Z.sendAttendeeMails(s,t,[["create",e]])}catch(e){S.Z.warn("Calendar",["create","event","invite"],e.message)}}return{clearDraft:"edit"!==n,event:t}}{if("SAVE_INVITED"!==i&&!l.ZP.isOwnEvent(e)){const{action:e}=await h.Z.showModal(n,{modal:G()});if("cancel"===e)return{clearDraft:!0}}let a="all";if(t&&l.ZP.isRecurringEvent(t)){const{action:e}=await h.Z.showModal(n,{modal:K("save")});a=e}if("all"===a||"upcoming"===a||"single"===a){return{clearDraft:!0,event:await X.updateEvent(e,a,!0,s)}}}return{clearDraft:!0}}async moveEvent(e,t,s){const n=i.Z.getEvent(e);if(!n)return;const a=w.ZP.getLastActiveBrowserWindowId();if(!l.ZP.isOwnEvent(n)){const{action:e}=await h.Z.showModal(a,{modal:G()});if("cancel"===e)return n}const o=z(n,t);!1===t.allDay&&n.allDay&&n.end-n.start===M.hd&&(o.end=o.start+v.Z.get(_.kCalendarDefaultDuration));const r={...n,...o};if(!l.ZP.isRecurringEvent(n))return X.updateEvent(r,"single",!0,s);{const{action:e}=await h.Z.showModal(a,{modal:K("move")});if("all"===e||"upcoming"===e||"single"===e)return X.updateEvent(r,e,!0,s)}}async copyEvent(e,t,s){const n=i.Z.getEvent(e);if(n){const e=z(n,t),i={...n,...e,uid:crypto.randomUUID(),etag:"",href:""},{rrule:a}=n;if(a){const t=w.ZP.getLastActiveBrowserWindowId(),{action:s}=await h.Z.showModal(t,{modal:K("copy")});if("cancel"===s)return;if("single"===s)i.rrule=void 0;else{const t=e.start-n.start,a=V(n),o=(0,j.Qj)(a.rrule,a.timezone,a.start),r=(0,j.EE)(o?.origOptions,t,n);if("upcoming"===s){r.dtstart=new Date(i.start);const e=o?.origOptions.count;if(e){let t=0;const s=(0,B.VV)(new Date(n.start));o?.all(((e,n)=>!(e>=s)||(t=n,!1))),r.count=e-t}}else"all"===s&&o?.origOptions.dtstart&&(r.dtstart=(0,B.FL)(new Date(o.origOptions.dtstart.valueOf()+t),i.timezone),i.start=r.dtstart?.valueOf()||0,i.end=i.start+n.end-n.start);o?.origOptions.until&&(r.until=(0,B.FL)(new Date(o.origOptions.until.valueOf()+t),i.timezone)),i.rrule=(0,j.Ns)(r)}}const o=d.Z.getOrganizerForEvent(i);i.organizer&&i.organizer!==o&&(i.organizer=o,i.invites=[]);const r=await X.createEvent(X.eventToCreateDetails(i));if(r.invites?.length)try{await d.Z.sendAttendeeMails(s,r,[["create",r.invites]])}catch(e){S.Z.warn("Calendar",["create","event","invite"],e.message)}return r}}async deleteExceptions(e,t){const s=e.id.split(":")[0],{recurrenceExceptions:n}=e;if(n)for(const e of n){const{exception_id:n,exception_event_id:i,parent_event_id:a,date:o,cancelled:r}=e;!r&&i&&parseInt(i)&&s===a&&(void 0===t?.after||o&&o>=t?.after)&&(void 0===t?.at||o===t?.at)&&await X.deleteEvent(i),n&&N.Z.calendar.deleteEventException(n)}}async trashEvent(e,t){function s(e){return e.invites?.length&&!1!==t?.sendEmails}async function n(e){X.deleteExceptions(e);const t=await X.updateEvent({...e,trash:!0,syncPending:$(e,!0)},"all");if(t.syncPending){(await o.Z.deleteEvent(e.id)).ok&&await A.Z.updateEvent({id:e.id,syncPending:!1})}if(s(e))if(l.ZP.isOwnEvent(e))try{await d.Z.sendAttendeeMails(null,e,[["cancel",e.invites??[]]])}catch(e){S.Z.warn("Calendar",["delete","event","invite"],e.message)}else{const t=d.Z.getOrganizerForEvent(e);t&&await a.Z.replyToInvite(w.ZP.getActiveWindowId(),{...X.eventToCreateDetails(e),exceptionEvents:[]},t,t,"DECLINED")}return t}if(!e)return S.Z.debug("Can not delete event, no id given."),!1;const r=i.Z.getEvent(e);try{X.stopAPIChangeListeners();const[a,c]=e.split("-")[0].split(":"),p=parseInt(c),g=i.Z.getEvent(a);if(!g)return!1;let m;if(l.ZP.isRecurringEvent(g)){const c=w.ZP.getLastActiveBrowserWindowId();switch(t?.saveMode??(await h.Z.showModal(c,{modal:K("trash")})).action){case"single":{const t=i.Z.getEvent(e);if(t?.recurrenceId&&X.deleteExceptions(g,{at:t.recurrenceId}),m=await A.Z.createException(a,!0,t?.recurrenceId??p),l.ZP.isRemoteCalendar(m.calendarId)){const e=parseInt(m.sequence)+1,t=await A.Z.updateEvent({id:m.id,sequence:e});o.Z.updateEvent(t,{...(0,Z.Z)(r?{originalEvent:r}:null)})}if(s(g)){const{rrule:e,...t}=g;try{await d.Z.sendAttendeeMails(null,t,[["cancel",g.invites??[]]],!0)}catch(e){S.Z.warn("Calendar",["delete","event","invite"],e.message)}}break}case"upcoming":{const{rrule:e,start:t,end:i,timezone:c}=g,h=t||i,u=(0,j.Qj)(e,c,h);if(!u||!h)return!1;const f=(0,j._v)(u,new Date(p));if(!f){n(g);break}const{count:v,...b}=u.origOptions,C=(0,j.Ns)({...b,until:f}),w=parseInt(g.sequence)+1;if(m=await A.Z.updateEvent({id:a,rrule:C,sequence:w}),X.deleteExceptions(g,{after:f.valueOf()}),s(m))try{await d.Z.sendAttendeeMails(null,m,[["update",m.invites??[]]])}catch(e){S.Z.warn("Calendar",["create","event","invite"],e.message)}l.ZP.isRemoteCalendar(m.calendarId)&&o.Z.updateEvent(m,{...(0,Z.Z)(r?{originalEvent:r}:null)});break}case"all":m=await n(g)}}else m=await n(g);m&&u.ZP.updateAlarmsForEvent(m)}finally{X.startAPIChangeListeners()}return!0}async restoreEvent(e,t){if(await X.updateEvent({...t,etag:"",href:"",trash:!1},"single",!0,e),t.invites?.length)try{await d.Z.sendAttendeeMails(e,t,[["create",t.invites]])}catch(e){S.Z.warn("Calendar",["restore","event","invite"],e.message)}r.Z.selectEvent(e,{event:t})}createAccount(e){return new Promise(((t,s)=>{N.Z.calendar.createAccount(e,(n=>{const i=I.Z.runtime.lastError;if(i)return S.Z.error("Calendar",["create","account"],e,new Error(i.message)),s(i.message);if(!["local","ical"].includes(n.account_type)){const e=c.Z.getEmptyLocalAccount();e&&this.deleteAccount(e.id)}m.Z.ensureCalendarIsOn(),t(n)}))}))}updateAccount(e){const{id:t,...s}=e;N.Z.calendar.updateAccount(t,s,(()=>{I.Z.runtime.lastError&&S.Z.error("Calendar",["update","account"],new Error(I.Z.runtime.lastError.message))}))}async updateCalendar(e,t,s=!0){const{account:n}=l.ZP.getAccountAndCalendar(e);return!!n&&(l.ZP.isCalDAV(n.account_type)&&s&&await o.Z.updateCalendar(e,t),(async(e,t)=>new Promise((s=>{N.Z.calendar.update(e,t,(t=>{const n=I.Z.runtime.lastError;if(n){const t=i.Z.getCalendars().find((t=>t.id===e)),s=t?.description??t?.name??"Calendar not found";S.Z.error("Calendar",["update","calendar"],s,t,new Error(n.message))}s(t)}))})))(e,t))}toggleCalendarVisibility(e){const t=i.Z.getCalendars().find((t=>t.id===e));t&&this.updateCalendar(e,{hidden:!t.hidden},!1)}setDefaultCalendarId(e,t=!1){const s=t?_.kCalendarDefaultTaskCalendarId:_.kCalendarDefaultCalendarId;v.Z.get(s)!==e&&f.Z.set(s,e)}async createCalendar(e,t,s=!1,n=!1){if(!n&&"ical"===t?.account_type)return{result:{status:!1,message:(0,y.Z)("Can not create a calendar in a web calendar account")}};const i=!(!e||!t?.url);if(t&&s&&i){const{status:s,message:n,name:i,ctag:a}=await o.Z.createCalendar(t,e);if(!s)return{result:{status:s,message:n}};e.name=i,e.ctag=a||""}try{e.color||(e.color=l.ZP.getCalendarCreateColor());const t=await N.Z.calendar.create(e);return{result:{status:!0,message:(0,y.Z)("Success")},calendar:t}}catch(n){return S.Z.error("Calendar",["create","calendar"],n),s&&t&&i&&await o.Z.deleteCalendar(t,e.name),{result:{status:!1,message:n}}}}async deleteAccount(e){const t=i.Z.getAccounts().find((t=>t.id===e));if(!t)return!1;let s;try{s=await N.Z.calendar.deleteAccount(e),s&&(0,O.l)(t.username,"calendar")}catch(t){throw S.Z.error("Calendar",["delete","account"],e,new Error(t)),t}return s}async deleteCalendar(e,t=!1){const s=i.Z.getAccounts().find((t=>t.id===e.accountId));if(!s)return{status:!1,message:(0,y.Z)("No account found")};const n=!!s.url,a="ical"===s.account_type;if(t&&s&&n&&!a){const t=await o.Z.deleteCalendar(s,e.name);if(!t.status)return t}try{const t=await N.Z.calendar.delete(e.id);if(a){return{status:await X.deleteAccount(s.id),message:""}}return{status:t,message:""}}catch(t){const s=e.description??e.name;return S.Z.error("Calendar",["delete","calendar"],s,t),{status:!1,message:t}}}async deleteEvent(e){const t=e.split("-")[0].split(":")[0];if(!t)return;const{notifications:s}=p.Z.getState();s.filter((e=>e.event_id===t)).forEach((e=>{u.ZP.deleteNotification(e)}));try{await N.Z.calendar.deleteEvent(t)}catch(t){S.Z.error("Calendar",["delete","event"],e,new Error(t.message))}}importEventsDialog=e=>{const t=w.ZP.getLastActiveBrowserWindowId();h.Z.showCalendarImportEvents(t,e)};init(){v.Z.addListener(_.kFeaturesCalendar,Y),X.startAPIChangeListeners(!0),o.Z.calendarServiceStart(),N.Z.calendar.onIcsFileOpened.addListener(X.importEventsDialog),N.Z.calendar.onWebcalUrlOpened.addListener(X.importEventsDialog),async function(){const e=v.Z.get(_.kCalendarTemplatesVersion);if(e<1)for(let t=e+1;t<=1;t++)for(const e of P[t])await N.Z.calendar.createEventTemplate(e.name,e.ical);f.Z.set(_.kCalendarTemplatesVersion,1)}()}startListeners(){X.startAPIChangeListeners(),o.Z.calendarServiceStart()}stopListeners(){o.Z.calendarServiceStop(),X.stopAPIChangeListeners()}startAPIChangeListeners(e=!1){this.#e||m.Z.isCalendarOn()&&(N.Z.calendar.onCalendarDataChanged.addListener(X.loadDatabase),e?F.nextTick((()=>X.loadPromise())):X.loadPromise(),u.ZP.startAPIChangeListeners(),this.#e=!0)}stopAPIChangeListeners(){this.#e&&(N.Z.calendar.onCalendarDataChanged.removeListener(X.loadDatabase),u.ZP.stopAPIChangeListeners(),this.#e=!1)}},Q=X},51525:(e,t,s)=>{"use strict";s.d(t,{Z:()=>b});var n=s(43630),i=s(39005),a=s(2934),o=s(50522),r=s(15800),l=s(34930),d=s(98035),c=s(45660),h=s(48868);function u(e,t){return h.Z.messages.update(e,{rsvpState:t})}var p=s(7064),g=s(93513),m=s(34006);function f(e="Undefined"){const t=(o.Z.getEvents()||[]).find((t=>t.uid===e&&!t.trash));if(!t)throw new Error(`Event with uid "${e}" not found.`);return t}function v(e){const{exceptionEvents:t,...s}=e;return a.ZP.createEvent(s)}const b=new class{async replyToInvite(e,t,s,a,c,h){if("DECLINECOUNTER"===c)throw new Error(`Can not reply to invite with method ${c}`);t=function(e,t,s,n){const i=e.invites?.find((e=>e.address===t));if(!i)throw new Error("Attendee not found");return t===s?i.partstat=n:e.invites?.push({...i,address:s,partstat:n}),e}(t,s,a,c);const b="ACCEPTED"===c||"TENTATIVE"===c;let C;try{C=f(t.uid)}catch(e){}let w,y=!1;if(C)if(y="ical"===r.ZP.getAccountAndCalendar(C.calendarId)?.account?.account_type,h?.value){const e=(0,m.Uq)(h),n=C.recurrenceExceptions?.find((t=>t.date===e));if(!n&&b){const s=await v(t);d.Z.createException(C.id,!1,e,s.id),C=s}else if(n?.exception_event_id){const e=o.Z.getEvent(n.exception_event_id);if(!e)throw new Error("Database inconsistency. Exception event not found.");!async function(e,t,s,n){const{invites:i}=e,a=i?.findIndex((e=>e.address===t));if(!i||"number"!=typeof a||-1===a)throw new Error("Attendee not found");if(t===s){const{event_id:t,...s}=i[a],o=await p.Z.calendar.updateInvite({...s,partstat:n});return(0,g.Uy)(e,(e=>{e.invites&&(e.invites[a]=o)}))}{const{id:t,...o}=i[a],r=await p.Z.calendar.createInvite({...o,name:o.name??"",event_id:o.event_id,address:s,partstat:n});(0,g.Uy)(e,(e=>{e.invites&&e.invites.push(r)}))}}(e,s,a,c),C=e}}else C.invites&&!y&&(C=await this.updateEventInCalendar(t,C));else b&&(C=await v(t));C||(C=function(e){const t=(e.invites||[]).map((e=>({...e,event_id:"",id:""}))),s=(e.notifications||[]).map((e=>({...e,id:""}))),{is_template:n,exceptionEvents:i,...a}=e;return{...a,id:"",start:e.start||0,end:e.end||0,notifications:s,invites:t,attachment:r.ZP.stringToAttachments(e.attachment)}}(t)),w=C.invites?.length?C.invites:t.invites?.map((e=>({...e,id:"",event_id:C?.id??""})));const x=w?.find((e=>e.address===a));if(!x)throw new Error("Attendee email address not found");const I={...C,invites:[x],organizer:C.organizer||t.organizer};await l.Z.sendReplyMails(e,I,s,a,c);const A=i.Z.getActiveMessage();A&&(A.rsvpState=c,u(A.id,A.rsvpState),n.Z.setActiveMessage(A))}async declineCounter(e,t,s,a){let o;try{o=f(t.uid)}catch(e){return void c.Z.error("Calendar",["invite"],"Error finding existing event to decline counter for",t)}await l.Z.sendReplyMails(e,o,s,a,"DECLINECOUNTER");const r=i.Z.getActiveMessage();if(r){const e={...r,rsvpState:"DECLINECOUNTER"};u(e.id,e.rsvpState),n.Z.setActiveMessage(e)}}addEventToCalendar(e,t){return v(e)}updateEventInCalendar(e,t){const{is_template:s,exceptionEvents:n,...i}=e,o=t.invites||[],l=i.invites||[],d=o.map((e=>{const t=l.find((t=>t.address===e.address));if(t)return{...e,partstat:t.partstat,name:t.name}})).filter(Boolean);l.forEach((e=>{o.find((t=>t.address===e.address))||d.push({...e,event_id:t.id,id:""})}));const c={...i,id:t.id,start:i.start||t.start,end:i.end||t.end,notifications:t.notifications,invites:d,attachment:r.ZP.stringToAttachments(i.attachment)},h=c.rrule?"all":"single";return a.ZP.updateEvent(c,h)}handleCancellation(e,t){const s=f(e.uid);if(t){const e=(0,m.Uq)(t),n=`${s.id}:${e}`;a.ZP.trashEvent(n,{sendEmails:!1,saveMode:"single"})}else a.ZP.trashEvent(s.id,{sendEmails:!1})}handleReply(e){const t=f(e.uid);if(!t.invites)throw new Error("Target event missing invites data.");if(!e.invites)throw new Error("Incoming event missing invites data.");const s=e.invites[0];let n=!1;t.invites.forEach((e=>{e.address===s.address&&(p.Z.calendar.updateInvite({id:e.id,partstat:s.partstat}),n=!0)})),n&&a.ZP.loadPromise()}}},12442:(e,t,s)=>{"use strict";s.d(t,{Z:()=>y});var n=s(50522),i=s(6320),a=s(15800),o=s(68247),r=s(33638),l=s(45660),d=s(30381),c=s.n(d),h=s(9126),u=s(87852),p=s(47543),g=s(58821),m=s(93513);const f=["day","week","multiweek","month","year","agenda"],v=["day","week","agenda"];function b(e,t,s){const n=s??i.Z.getStateForPage(e),o=!s;if(t.displayMode||t.selectedDate){const e=t.selectedDate??n.selectedDate,s=t.anchorDate??n.anchorDate,i=t.displayMode??n.displayMode;if(e&&s&&i){a.ZP.getDisplayRange(s,i).contains(e)||(t={...t,anchorDate:e.clone(),selectedDate:e})}}const l=(0,m.Uy)(n,(e=>(e.anchorDate.localeData()!==c().localeData()&&(e.anchorDate.locale(c().locale()),e.selectedDate?.locale(c().locale())),{...e,...t})));return o&&r.Z.dispatch({actionType:"CALENDAR_UPDATE_UI",filter:l,pageId:e}),l}function C(e,t,s){const n=s?.filter??i.Z.getStateForPage(e),{anchorDate:o,displayMode:r,selectedDate:l}=n;if(!l)return n;let d;switch(r){case"agenda":case"multiweek":d="week";break;default:d=r}const c="previous"===t?o.clone().subtract(1,d):o.clone().add(1,d),h=s?.overrideSelected;let u;if(h&&a.ZP.getDisplayRange(c,r).contains(h))u=h.clone();else if("month"===r){const e=a.ZP.getDisplayRange(c,r),t=(0,g.Xq)(l,o);u=(0,g.FY)(t,l.weekday(),c,!1),u.isAfter(e.end,"day")&&(u=(0,g.Ro)(l.weekday(),c,!0))}else u="previous"===t?l.clone().subtract(1,d):l.clone().add(1,d);return b(e,{anchorDate:c,selectedDate:u},s?.filter)}const w=new class{init(e,t){b(e,t??(0,h.l)(e))}selectEvent(e,t){const{event:s,eventId:o,date:r,allDay:l,edit:d}=t,c=t.filter??i.Z.getStateForPage(e);let h=s?.id??o??"",u=s;!u&&h&&(u=n.Z.getEvent(h));const m=u?.rrule;if(r&&m&&-1===h?.indexOf(":")){const e=r.clone(),t=(0,p.YE)(m,{from:e.startOf("day").valueOf(),to:e.endOf("day").valueOf(),timezone:u?.timezone??""});t.length&&(h=`${h}:${(0,g.FL)(t[0]).valueOf()}`)}if(h===c.selectedEvent&&(void 0===d||d===c.editing))return c;const f={selectedEvent:h};if(t.hasOwnProperty("date")&&(f.selectedDate=r),u){if(!t.hasOwnProperty("date")){const e=a.ZP.getEventRange(u);!e||c.selectedDate&&e.contains(c.selectedDate)||(f.selectedDate=e.start)}f.editing=d??c.editing;!(u.start||u.end)&&"agenda"!==c.displayMode&&(f.displayMode="agenda")}return void 0!==l&&(f.allDaySelected=l),b(e,f,t.filter)}selectDate(e,t,s={}){const n=s.filter??i.Z.getStateForPage(e);if(t&&!t.isValid())return l.Z.error("Calendar",["actions"],new Error("Invalid date selected")),n;const{allDay:a,setToday:o}=s,{displayMode:r}=n;let d={allDaySelected:a??!1,selectedEvent:""};return d=t&&o&&"agenda"===r?{...d,anchorDate:t,selectedDate:t}:{...d,selectedDate:t},b(e,d,s.filter)}selectToday(e,t){const s=c()((0,g.zX)(Date.now()));return w.selectDate(e,s,{setToday:!0,filter:t?.filter})}viewPreviousPeriod(e,t){return C(e,"previous",t)}viewNextPeriod(e,t){return C(e,"next",t)}setViewMode(e,t,s){const n=s?.filter??i.Z.getStateForPage(e);if(e===u.G6&&!v.includes(t))return n;if((s?.save??!0)&&t!==n.displayMode){const s=(0,h.R)(e);s.displayMode=t;const n=a.ZP.getCalendarFilterPrefsKey(e);o.Z.set(n,s)}return b(e,{displayMode:t},s?.filter)}zoomViewMode(e,t,s){const n=i.Z.getStateForPage(e).displayMode,a=e===u.G6?v:f;let o=a.findIndex((e=>e===n))+t;return o<0?o=0:o>=a.length&&(o=a.length-1),b(e,{displayMode:a[o]},s?.filter)}showCompletedTasks(e,t){const s=t?.filter??i.Z.getStateForPage(e),n=t?.state??!s.showCompletedTasks,r=(0,h.R)(e);if(n!==s.showCompletedTasks){r.showCompletedTasks=n;const t=a.ZP.getCalendarFilterPrefsKey(e);o.Z.set(t,r)}return b(e,{showCompletedTasks:n},t?.filter)}search(e,t,s){return b(e,{filterText:t},s?.filter)}setCalendarIds(e,t,s){return b(e,{calendarIds:t},s?.filter)}},y=w},29717:(e,t,s)=>{"use strict";s.d(t,{Z:()=>i});var n=s(33638);const i={enableCapture:function(e,t){n.Z.dispatch({actionType:"CAPTURE_ENABLE",winId:e,noteId:t})},disableCapture:function(e){n.Z.dispatch({actionType:"CAPTURE_DISABLE",winId:e})}}},21788:(e,t,s)=>{"use strict";s.d(t,{Z:()=>m});var n=s(21838),i=s(96951),a=s(29087),o=s(83526),r=s(15489),l=s(2497),d=s(94595),c=s(7064),h=s(89175);const u=["INPUT","FRAME","IFRAME","OBJECT","SELECT","TEXTAREA","EMBED"],p=[{className:"url",action:"urlPasteAndGo"},{className:"vivaldi-searchfield",action:"searchPasteAndGo"},{className:"quick-command-search",action:"qcPasteAndGo"}];function g(){let e;const t=function(t){const{clipboardData:s}=t;s&&s.types.indexOf("text/plain")>-1&&(e=s.getData("text/plain"),t.preventDefault())};return document.addEventListener("paste",t),document.execCommand("paste"),document.removeEventListener("paste",t),e}const m=new class{undo(e){c.Z.editcommand.execute("undo",e)}redo(e){c.Z.editcommand.execute("redo",e)}cut(e){c.Z.editcommand.execute("cut",e)}copy(e){c.Z.editcommand.execute("copy",e)}paste(e){c.Z.editcommand.execute("paste",e)}selectAll(e){c.Z.editcommand.execute("selectAll",e)}set(e){const{body:t}=document;if(!e||!t)return;const s=document.createElement("input");s.style.position="absolute",s.style.zIndex="-1",s.value=e,t.appendChild(s),s.select(),document.execCommand("copy")||console.error("Failed to copy text."),t.removeChild(s)}pasteAsPlainText(e){c.Z.editcommand.execute("pasteAndMatchStyle",e)}pasteAsPlainTextOrPasteAndGo(e,t){let s=g();if(!r.ZP.isPopup(e)){const n=(0,l.Z)(e),{activeElement:i}=n.document,a=p.find((e=>i?.classList.contains(e.className)));if(a&&i instanceof n.HTMLInputElement)return s=(0,d.Z)({textToStrip:s??"",caretPosition:i?.selectionStart??0,selectionEnd:i?.selectionEnd??0,currentValue:i?.value??""}),void o.Z.doAction(e,t,a.action,{clipboardText:s});if(u.indexOf(i?.tagName)>-1||i?.isContentEditable)return void c.Z.editcommand.execute("pasteAndMatchStyle",e)}c.Z.windowPrivate.getFocusedElementInfo(e).then((({editable:n})=>{n?c.Z.editcommand.execute("pasteAndMatchStyle",e):(a.Z.get(h.kAddressBarStripJavascriptOnPaste)&&(s=(0,d.Z)({textToStrip:s??"",caretPosition:0,selectionEnd:0,currentValue:""})),o.Z.doAction(e,t,"urlPasteAndGo",{clipboardText:s}))}))}copyWithFilter(e){const t=e.indexOf("?");-1!==t&&(e=e.slice(0,t)),this.copyTextToClipboard(e)}async createNoteFromSelection(e){const t=i.ZP.getActivePage(e);if(t){const s=g(),i=await c.Z.utilities.getSelectedText(t.id);await n.Z.createNote(e,{content:s,url:i===s?t.url:void 0,type:"note"})}}copyUrlToClipboard(e){const t=function(t){t.clipboardData&&(t.clipboardData.setData("text/plain",e),t.stopPropagation(),t.preventDefault())};document.addEventListener("copy",t),document.execCommand("copy"),document.removeEventListener("copy",t)}copyTextToClipboard=e=>{const t=t=>{t.clipboardData&&(t.clipboardData.setData("text/plain",e),t.stopPropagation(),t.preventDefault())};return document.addEventListener("copy",t),document.execCommand("copy"),document.removeEventListener("copy",t),Promise.resolve()}}},47995:(e,t,s)=>{"use strict";s.d(t,{Z:()=>x});var n=s(25795),i=s(68247),a=s(29087),o=s(33638),r=s(56371),l=s(92292),d=s(7064),c=s(10334),h=s(93196),u=s(47380),p=s(89175);const g={version:1,chains:[{category:"CATEGORY_COMMAND_CHAIN",key:"ckqjhvf430003c5429ni7i7bz",label:(0,r.Z)("command chain",(0,r.Z)("Close Other and Open Defined Tab")),name:"COMMAND_ckqjhvf430003c5429ni7i7bz",chain:[{defaultValue:"https://vivaldi.com",key:"f57b8092-9426-4bc8-8e39-fcf3e315b065",param:"https://vivaldi.com",label:"COMMAND_OPEN_LINK_DEFAULT",name:(0,r.Z)("Open Link in New Tab")},{key:"275ca3f7-ecfb-4445-bf87-686cd473536e"}]},{category:"CATEGORY_COMMAND_CHAIN",key:"ckqkoqycf0003wv4210uduu8n",label:(0,r.Z)("command chain",(0,r.Z)("Toggle Fullscreen and Reader Mode")),name:"COMMAND_ckqkoqycf0003wv4210uduu8n",chain:[{key:"7420368f-565e-409f-8eec-5b5c578429af"},{key:"8dd47fc9-4c1f-4487-a475-f55bfa61aaf2"}]},{category:"CATEGORY_COMMAND_CHAIN",key:"ckqjdk4o7000001l58zh17egm",label:(0,r.Z)("command chain",(0,r.Z)("Open Links and Tile")),name:"COMMAND_ckqjdk4o7000001l58zh17egm",chain:[{defaultValue:"https://vivaldi.com",key:"0b01337b-4c13-4197-90c8-179c5c91cfff",param:"https://vivaldi.com",label:"COMMAND_OPEN_LINK_CURRENT"},{defaultValue:"https://vivaldi.net",key:"f57b8092-9426-4bc8-8e39-fcf3e315b065",param:"https://vivaldi.net",label:"COMMAND_OPEN_LINK_DEFAULT"},{defaultValue:"https://help.vivaldi.com",key:"f57b8092-9426-4bc8-8e39-fcf3e315b065",param:"https://help.vivaldi.com",label:"COMMAND_OPEN_LINK_DEFAULT"},{defaultValue:1e3,key:"2eb81004-6703-46db-9933-6afcfde924e4",param:150},{key:"e245bce5-20a7-481f-910e-23bf1de86748"},{key:"e245bce5-20a7-481f-910e-23bf1de86748"},{defaultValue:1e3,key:"2eb81004-6703-46db-9933-6afcfde924e4",param:125},{key:"cdd99010-5477-4508-aa28-d671de35dcb2"},{key:"854f8a44-50bd-41bc-8277-acd51e719d1b"}]}]},m=function(e){n.Z.isNamedMenuAvailable(e)&&d.Z.menuContent.get(e,((t,s,n)=>{o.Z.dispatch({actionType:"COMMAND_SET_NAMED_MENU",name:e,content:n})}))},f=function(e){if(!e){const e=n.Z.getMenuContentName();e&&m(e)}},v=function(e,t,s){const n=C(e);if(!n)return;const i={shortcuts:t,gestures:s,feature:h.CN.concat(a.Z.get(p.kChainedCommandsCommandList)).find((t=>t.name===e))?.feature||"browser"};o.Z.dispatch({actionType:"COMMAND_UPDATE_COMMAND",item:{key:n,value:i}})},b=function(){const e=h.CN.concat(a.Z.get(p.kChainedCommandsCommandList)),t=a.Z.get(p.kActions)[0],s=e.map((e=>{const s=t[e.name];if(s)return{key:e.name,value:{...s,feature:e.feature||"browser"}}})).filter(Boolean);o.Z.dispatch({actionType:"COMMAND_RESET",items:s})};function C(e){if(e.startsWith("COMMAND_"))return e}function w(e,t){if(t.length<e.length){const s=e.filter((e=>-1===t.findIndex((t=>t.key===e.key))));if(1===s.length){const e=C(s[0].name);e&&o.Z.dispatch({actionType:"COMMAND_REMOVE_COMMAND",key:e})}else console.warn("Wrong number of elements removed")}}const y=new class{loadPromise=()=>{const{version:e}=g;e!==a.Z.get(p.kChainedCommandsVersion)&&(e=>{const{chains:t}=g,s=a.Z.get(p.kChainedCommandsDeletedCommandList),n=a.Z.get(p.kChainedCommandsCommandList),o=n.map((e=>e.key)),r=t.filter((e=>!s.includes(e.key)&&!o.includes(e.key))),l=[...n,...r];i.Z.set(p.kChainedCommandsCommandList,l),i.Z.set(p.kChainedCommandsVersion,e)})(e);const t=h.CN.concat(a.Z.get(p.kChainedCommandsCommandList)),s=a.Z.get(p.kActions)[0],n=t.map((e=>{const t=s[e.name];if(t)return{key:e.name,value:{...t,feature:e.feature||"browser"}}})).filter(Boolean);return o.Z.dispatch({actionType:"COMMAND_INITIALIZE",items:n}),d.Z.menuContent.onChanged.addListener(m),d.Z.menuContent.onResetAll.addListener(f),a.Z.addListener(p.kChainedCommandsCommandList,w),Promise.resolve()};requestNamedMenu(e){n.Z.getIsInitialized()&&!n.Z.isNamedMenuAvailable(e)&&d.Z.menuContent.get(e,((t,s,n)=>{l.Z.runtime.lastError?(o.Z.dispatch({actionType:"COMMAND_SET_NAMED_MENU",name:e,content:[]}),console.warn("Failed to read menu spec. Attempting fallback.",e),d.Z.menuContent.reset(e,!1,void 0,(()=>{}))):o.Z.dispatch({actionType:"COMMAND_SET_NAMED_MENU",name:e,content:n})}))}restoreShortcuts(){const e=structuredClone(a.Z.getDefault(p.kActions))[0];n.Z.getUserEditableCommands().forEach((t=>{const s=n.Z.getCommandConfiguration(t.name)?.gestures;s?e[t.name]={...e[t.name],gestures:s}:e[t.name]?.gestures&&delete e[t.name].gestures})),i.Z.set(p.kActions,[e]),b()}restoreGestures(){const e=structuredClone(a.Z.getDefault(p.kActions))[0];n.Z.getUserEditableCommands().forEach((t=>{const s=n.Z.getCommandConfiguration(t.name)?.shortcuts;s?e[t.name]={...e[t.name],shortcuts:s}:e[t.name]?.shortcuts&&delete e[t.name].shortcuts})),i.Z.set(p.kActions,[e]),b()}setShortcuts(e,t){const s=a.Z.get(p.kActions)[0],n={...s};n[e]={...s[e]},t&&t.length>0?n[e].shortcuts=t:delete n[e].shortcuts,i.Z.set(p.kActions,[n]),v(e,t,n[e].gestures)}setGestures(e,t){const s=a.Z.get(p.kActions)[0],n={...s};n[e]={...s[e]},t&&t.length>0?n[e].gestures=t:delete n[e].gestures,i.Z.set(p.kActions,[n]),v(e,n[e].shortcuts,t)}executeActions(e,t,s,i){const o=(0,u.m)(e,t),r=n.Z.getCommands().find((e=>e.name===s));if(!r){const e=a.Z.get(p.kChainedCommandsCommandList);for(let t=e.length-1;t>=0;t--)if(e[t].name===s){(0,c.hT)(o,e[t].chain);break}return void console.warn("[execute actions]: Lookup failed for command",s)}let l=i;void 0===l&&(l=(0,h.xU)(r.name)?.defaultValue),void 0!==l&&(o.param=l),r.action(o)}handleRockerGesture(e,t){const s=a.Z.get(t?p.kMouseGesturesRockerGesturesRightToLeft:p.kMouseGesturesRockerGesturesLeftToRight),i=n.Z.getCommandByGuid(s);i?y.executeActions("gesture",e,i.name):console.warn("[Rocker Gesture]: No command for guid",s)}},x=y},17751:(e,t,s)=>{"use strict";s.d(t,{Z:()=>i});var n=s(33638);const i={log:function(e){n.Z.dispatch({actionType:"COMPONENT_LOGGER_LOG",entry:e})},prune:function(e,t,s){n.Z.dispatch({actionType:"COMPONENT_LOGGER_PRUNE",components:e,tags:t,levels:s})}}},4660:(e,t,s)=>{"use strict";s.d(t,{Z:()=>h});var n=s(73132),i=s(72010),a=s(33638),o=s(7064);async function r(e){const t=await o.Z.contacts.getAll();a.Z.dispatch({actionType:"CONTACT_INITIALIZE",contacts:t.map((e=>(0,n.Z)(e))),newContact:e})}function l(e){a.Z.dispatch({actionType:"CONTACT_UPDATE_CONTACT",contact:e})}function d(e){a.Z.dispatch({actionType:"CONTACT_ADD_CONTACTS",contacts:e.map((e=>(0,n.Z)(e)))})}async function c(e,t){Object.keys(t).length>0&&await o.Z.contacts.update(e,t,(e=>l((0,n.Z)(e))))}const h={initialize:r,updateContact:l,addGeneratedContacts:d,addContact:async function(e){const t=await o.Z.contacts.create({name:e.name,birthday:e.birthday,note:e.note,generatedFromSentMail:e.generatedFromSentMail,avatarUrl:e.avatarUrl,separator:e.separator,trusted:e.trusted});for(const s of e.emailAddresses)await o.Z.contacts.addEmailAddress({contactId:t.id,emailAddress:s.emailAddress,type:s.type});for(const s of e.postalAddresses)await o.Z.contacts.addPropertyItem({propertyName:"postalAddress",contactId:t.id,propertyValue:s.postalAddress,type:s.type});for(const s of e.phoneNumbers)await o.Z.contacts.addPropertyItem({propertyName:"phoneNumber",contactId:t.id,propertyValue:s.phoneNumber,type:s.type});e.id=t.id,a.Z.dispatch({actionType:"CONTACT_ADD_CONTACT",contact:e})},selectContact:function(e,t=!1){a.Z.dispatch({actionType:"CONTACT_SELECT_CONTACT",contact:e,focusContactView:t})},deleteContactsByIds:function(e){const t=[],s=[];for(const n of e)"string"==typeof n&&(t.push(n),s.push(o.Z.contacts.delete(n)));return Promise.all(s).then((()=>{a.Z.dispatch({actionType:"CONTACT_DELETE_CONTACTS",ids:t})}))},newEmptyContact:function(){return new Promise((e=>{o.Z.contacts.create({},(t=>{const s=(0,n.Z)(t);return r(s),e(s)}))}))},newContactFromMailAddress:function(e,t){o.Z.contacts.create({name:e.name||""},(t=>o.Z.contacts.addEmailAddress({contactId:t.id,emailAddress:e.address},(e=>{r((0,n.Z)(e))}))))},putTrustedEmailAddress:function(e){let t=!1;i.Z.getAsArray().forEach((s=>s.emailAddresses.forEach((n=>{e.address===n.emailAddress&&(t=!0,c(s.id,{trusted:!0}))})))),!1===t&&o.Z.contacts.create({name:e.name||"",generatedFromSentMail:!0,trusted:!0},(t=>o.Z.contacts.addEmailAddress({contactId:t.id,emailAddress:e.address},(e=>d([e])))))},update:c,updatePropertyItem:function(e){o.Z.contacts.updatePropertyItem(e,(e=>l((0,n.Z)(e))))},updateEmailAddress:function(e,t){o.Z.contacts.updateEmailAddress(e,t,(e=>l((0,n.Z)(e))))},addPropertyItem:function(e){o.Z.contacts.addPropertyItem(e,(e=>l((0,n.Z)(e))))},removePropertyItem:function(e){o.Z.contacts.removePropertyItem(e,(e=>l((0,n.Z)(e))))},addEmailAddress:function(e){o.Z.contacts.addEmailAddress(e,(e=>l((0,n.Z)(e))))},removeEmailAddress:function(e){o.Z.contacts.removeEmailAddress(e,(e=>l((0,n.Z)(e))))},addIfNotAddressExists:function(e){o.Z.contacts.getAll((t=>{const s=new Set;t.forEach((e=>e.emailAddresses.forEach((e=>{e.emailAddress&&s.add(e.emailAddress.toLowerCase())}))));const n=[];e.forEach((e=>{s.has(e.address.toLowerCase())||(o.Z.contacts.create({name:e.name||"",generatedFromSentMail:!0},(t=>{o.Z.contacts.addEmailAddress({contactId:t.id,emailAddress:e.address},(e=>d([e])))})),n.push(e))}))}))}}},83784:(e,t,s)=>{"use strict";s.d(t,{Z:()=>Z});var n=s(47995),i=s(49777),a=s(46382),o=s(18350),r=s(15285),l=s(24367),d=s(29087),c=s(86461),h=s(33638),u=s(63153),p=s(15489),g=s(56371),m=s(92292),f=s(2497),v=s(28773),b=s(7064),C=s(82786),w=s(8874),y=s(86662),x=s(89175),I=s(8684);function A(e){return new Promise((t=>{m.Z.downloads.search(e,t)}))}const S=(0,C.M)();const Z=new class{_isPolling=!1;_dispatchUpdate=e=>{h.Z.dispatch({actionType:"DOWNLOAD_PANEL_UPDATED",downloadItems:e})};_replaceDownloadItem=(e,t)=>{const s=i.ZP.getItems({isIncognitoWindow:!1}),n=s.find((t=>t.id===e.id));if(!n)return;const a=s.indexOf(n),o=[...s.slice(0,a),t,...s.slice(a+1)];this._dispatchUpdate(o)};_startPolling=()=>{this._isPolling||(this._intervalId=setInterval(this._pollInProgressDownloads,500),this._isPolling=!0)};_stopPolling=()=>{this._isPolling=!1,clearInterval(this._intervalId)};_handleNewDownloadItem=e=>{const t=i.ZP.getFilter(),s=i.ZP.getOrderBy(),n={...(0,v.Z)(t?{query:t.split(" ")}:null),...(0,v.Z)(s?{orderBy:[s]}:null)};m.Z.downloads.search(n,(t=>{this._dispatchUpdate(t);const s=i.ZP.getItems({isIncognitoWindow:!1}).find((t=>t.id===e));s&&h.Z.dispatch({actionType:"DOWNLOAD_STARTED",downloadItem:s})}))};_updateState=e=>{const t=i.ZP.getItems({isIncognitoWindow:!1}),s=t.findIndex((t=>t.id===e.id));if(-1===s)return void this._handleNewDownloadItem(e.id);const n=t.with(s,e);this._dispatchUpdate(n),i.mb.append(e.id,e.currentSpeed)};_updateStateForDownloadItems=e=>{e.forEach(this._updateState)};_handleInProgressSearch=e=>{e.filter((e=>!e.paused)).length||this._stopPolling(),this._setTotalProgress(e),this._updateStateForDownloadItems(e)};_handleFileDeleted=(e,t)=>{this._pollInProgressDownloads(),e?m.Z.downloads.search({id:e,limit:1},(s=>{if(!s||!Array.isArray(s))return void console.warn(`DownloadActions: _handleFileDeleted: Failed to search downloads for ID ${e} (${t})`);const n=s[0];n&&this._updateState(n)})):console.warn(`DownloadActions: _handleFileDeleted: Invalid download ID ${e} (${t})`)};_pollInProgressDownloads=()=>{m.Z.downloads.search({state:"in_progress"},this._handleInProgressSearch)};_setTotalProgress=e=>{const t=e.filter((e=>!e.paused)),s=t.length,n=function(e){return e.length?e.map((e=>e.bytesReceived/e.totalBytes)).reduce(((e,t)=>e*t)):0}(t);h.Z.dispatch({actionType:"DOWNLOAD_SET_TOTAL_PROGRESS",totalNumberOfDownloads:s,totalProgress:n})};_handleDangerousFileDownload=e=>{const t=p.ZP.getLastActiveBrowserWindowId();p.ZP.isMinimized(t)&&u.Z.restore(t),async function(e,t){const s=await S();try{const{chrome:n}=(0,f.Z)(e);await n.downloads.acceptDanger(t)}catch(e){}finally{s()}}(t,e)};_onTransferChanged=e=>{e.paused&&e.paused.previous&&!e.paused.current?this._onTransferCreated():(e.filename&&this._handleNewDownloadItem(e.id),e.danger&&e.danger.current!==e.danger.previous&&this._handleDangerousFileDownload(e.id),e.exists&&!e.exists.current&&this._handleFileDeleted(e.id,"Deleted from disk"),e.state&&("interrupted"===e.state.current?(this._handleFileDeleted(e.id,"Interrupted"),m.Z.downloads.search({id:e.id,limit:1},(([e])=>{h.Z.dispatch({actionType:"DOWNLOAD_STOPPED",downloadItem:e}),this.#t(e)}))):"complete"===e.state.current&&(m.Z.downloads.search({id:e.id,limit:1},(([e])=>{this._updateState(e),this._pollInProgressDownloads(),h.Z.dispatch({actionType:"DOWNLOAD_COMPLETED",downloadItem:e}),this.#t(e)})),i.ZP.openAfterDownload.has(e.id)&&(m.Z.downloads.open(e.id),i.ZP.openAfterDownload.delete(e.id)))))};#t(e){if(!d.Z.get(x.kDownloadsNotifyOnComplete))return;const t=e.error?(0,w.U)(e.error):function(e){let{filename:t,extension:s}=(0,y.QQ)(e);return t.length>65&&(t=t.substring(0,65)+".."),t+s}(e.filename),s=e.error?(0,g.Z)("Download Failed"):(0,g.Z)("Download Complete"),n=this.showDownload.bind(null,e.id);m.Z.downloads.getFileIcon(e.id,{size:32},(i=>{(0,I.c)({title:s,body:t,icon:i,timeout:54e6,onClick:n,tag:`VIVALDI_DOWNLOAD_COMPLETE_ID_${e.finalUrl}`})}))}_onTransferErased=e=>{const t=i.ZP.getItems({isIncognitoWindow:!1}),s=t.findIndex((t=>t.id===e));if(-1===s)return;const n=[...t.slice(0,s),...t.slice(s+1)];this._dispatchUpdate(n)};_onTransferCreated=()=>{this._startPolling()};_showDownload=e=>{m.Z.downloads.show(e)};_openDownload=e=>{m.Z.downloads.open(e)};_pauseDownload=e=>{i.mb.clear(e),m.Z.downloads.pause(e)};_resumeDownload=e=>{m.Z.downloads.resume(e)};_eraseDownload=e=>{m.Z.downloads.erase({id:e})};_dragDownloads=e=>{const t=p.ZP.getLastActiveBrowserWindowId();b.Z.utilities.downloadsDrag(t,e)};_restartDownload=e=>A({id:e}).then((([t])=>{return(s={url:t.url},new Promise((e=>{m.Z.downloads.download(s,e)}))).then((e=>A({id:e}))).then((([e])=>this._replaceDownloadItem(t,e))).then((()=>{return t={id:e},new Promise((e=>{m.Z.downloads.erase(t,e)}));var t}));var s}));_searchDownloads({filter:e,orderBy:t}){return new Promise((s=>{const n={...(0,v.Z)(e?{query:e.split(" ")}:null),...(0,v.Z)(t?{orderBy:[t]}:null)};m.Z.downloads.search(n,(e=>{s(e)}))}))}_setSearchFilter(e){if(e===i.ZP.getFilter())return Promise.resolve();const t=i.ZP.getOrderBy();return this._searchDownloads({filter:e,orderBy:t}).then((t=>{h.Z.dispatch({actionType:"DOWNLOAD_SET_FILTER",downloadItems:t,filter:e})}))}_setOrderBy(e){if(e===i.ZP.getOrderBy())return Promise.resolve();const t=i.ZP.getFilter();return this._searchDownloads({filter:t,orderBy:e}).then((t=>{h.Z.dispatch({actionType:"DOWNLOAD_SET_ORDER_BY",downloadItems:t,orderBy:e})}))}_validateDownload=e=>{m.Z.downloads.acceptMixed(e)};forceUpdate=()=>{const e=i.ZP.getFilter(),t=i.ZP.getOrderBy();this._searchDownloads({filter:e,orderBy:t}).then((e=>{h.Z.dispatch({actionType:"DOWNLOAD_SET_ORDER_BY",downloadItems:e,orderBy:t})}))};startResolvingReady=()=>{let e,t,s;return Promise.race([function(){let t=0;return new Promise((s=>{!function n(){b.Z.utilities.isDownloadManagerReady((e=>{e&&s()})),t++,e=setTimeout(n,1e3*t)}()}))}(),new Promise((e=>{s=()=>{e()},b.Z.utilities.onDownloadManagerReady.addListener(s)})),new Promise((e=>{t=setTimeout(e,2e4)}))]).then((()=>{clearTimeout(e),clearTimeout(t),b.Z.utilities.onDownloadManagerReady.removeListener(s),i.ZP.resolveReady()}))};doDownload=(e,t,s)=>{const i=t.vivaldiWindowId;if(e.suggestedFilename.endsWith(".ics")&&l.Z.isCalendarOn()&&d.Z.get(x.kCalendarHandleIcsDownloads))e.request.allow("open");else if(d.Z.get(x.kDownloadsStartAutomatically)&&!1===e.mixedDownload)e.request.allow(),d.Z.get(x.kDownloadsOpenPanelOnNew)&&(c.ZP.isComponentVisible("DownloadButton",i)?n.Z.executeActions("event",t,"COMMAND_SHOW_DOWNLOADS_POPOUT"):r.ZP.canAutoOpen(i,"PanelDownloads")&&o.Z.toggleContent(i,"PanelDownloads"));else{if(!s)return;e.dialogtype=e.permission;const t=s;e.webview=t,e.dialogtype=e.permission,a.Z.showDialog(i,e,null)}};addOpenAfterDownload=e=>{i.ZP.openAfterDownload.add(e)};setSearchFilter=e=>i.ZP.ready.then((()=>this._setSearchFilter(e)));setOrderBy=e=>i.ZP.ready.then((()=>this._setOrderBy(e)));showDownload=e=>{i.ZP.ready.then((()=>{this._showDownload(e)}))};eraseDownload=e=>{i.ZP.ready.then((()=>{this._eraseDownload(e)}))};openDownload=e=>{i.ZP.ready.then((()=>{this._openDownload(e)}))};pauseDownload=e=>{i.ZP.ready.then((()=>{this._pauseDownload(e)}))};resumeDownload=e=>{i.ZP.ready.then((()=>{this._resumeDownload(e)}))};dragDownloads=e=>{i.ZP.ready.then((()=>{this._dragDownloads(e)}))};restartDownload=e=>i.ZP.ready.then((()=>this._restartDownload(e)));validateMixedDownload=e=>{i.ZP.ready.then((()=>{this._validateDownload(e)}))};load=()=>(m.Z.downloads.setShelfEnabled(!1),m.Z.downloads.onChanged.addListener(this._onTransferChanged),m.Z.downloads.onCreated.addListener(this._onTransferCreated),m.Z.downloads.onErased.addListener(this._onTransferErased),this.startResolvingReady(),i.ZP.ready.then(this._startPolling))}},87210:(e,t,s)=>{"use strict";s.d(t,{Z:()=>u});var n=s(16875),i=s(96951),a=s(29087),o=s(33638),r=s(83526),l=s(92292),d=s(63164),c=s(89175);const h=new class{setFastForwardUrl(e,t,s){o.Z.dispatch({actionType:"FAST_FORWARD_SET_FORWARD_URL",pageId:e,forwardUrl:t})}_updateRewindInfo(e,t,s){o.Z.dispatch({actionType:"FAST_FORWARD_SET_REWIND_INFO",pageId:e,history:s,currentIndex:t})}setRewindInfo(e,t){e.getPageHistory(((e,s)=>{l.Z.runtime.lastError||h._updateRewindInfo(t,e,s)}))}navigateRewind(e){const t=i.ZP.getActivePage(e);if(t){const s=n.Z.getRewindRelativeIndex(t.id);r.Z.go(e,t.id,-1*s)}}navigateFastforward(e){const t=i.ZP.getActivePage(e);t&&(0,d.VN)(t.id,{type:"FFW_NAVIGATE"})}isFFWEnabled(){return a.Z.get(c.kKeyboardShortcutsSpaceFastForwards)}onIsFFWEnabled(e){this.isFFWEnabled()&&(0,d.VN)(e,{type:"FFW_GO_FORWARD"})}initFastForward(){(0,d.Tg)(((e,t)=>{if(!t.tab?.id||0!==t.frameId)return;const{type:s}=e;"FFW_URL_CHANGED"===s&&"string"==typeof e.nextUrl?h.setFastForwardUrl(t.tab.id,e.nextUrl,t.url):"FFW_CAN_GO_FORWARD"===s&&h.onIsFFWEnabled(t.tab.id)}))}},u=h},22616:(e,t,s)=>{"use strict";s.d(t,{Z:()=>i});var n=s(33638);class i{static setImportProgress(e,t,s,i,a){n.Z.dispatch({actionType:"IMPORT_PROGRESS",importType:e,importItemType:t,current:s,total:i,key:a})}static addImportWarning(e,t,s){n.Z.dispatch({actionType:"IMPORT_PROGRESS_WARN",importType:e,importItemType:t,message:s})}static addImportError(e,t,s){n.Z.dispatch({actionType:"IMPORT_PROGRESS_ERROR",importType:e,importItemType:t,message:s})}static clearImportProgress(e,t){n.Z.dispatch({actionType:"IMPORT_PROGRESS_CLEAR",importType:e,importItemType:t})}}},99827:(e,t,s)=>{"use strict";s.d(t,{Z:()=>We});var n=s(39045),i=s(2711),a=s(72010),o=s(82227),r=s(3184),l=s(65093),d=s(98611),c=s(36943),h=s(54162),u=s(98484),p=s(46382),g=s(29087),m=s(60331),f=s(33638),v=s(56371),b=s(78347),C=s(31857),w=s(91834),y=s(48868),x=s(71320),I=s(51501),A=s(45709),S=s(10671),Z=s(60308),T=s(9982),E=s(25100),k=s(45660),N=s(20570),_=s(93818),P=s(24651),M=s(5204),D=s(16445),O=s(40348),j=s(7064),L=s(99895),R=s(13519),B=s(32593),F=s(3664);async function W(e,t,s,n,a,o,r){const l=await function(e){const t=D.Z.call(e);return(0,E.Z)(t,[],e)}(t);if(l.from.length+l.to.length+l.cc.length===0&&!l.subject){k.Z.warn("Mail",["import file",s,n,a],"Selected file does not seem to be a mail file");const t=(0,v.Z)("Selected file does not seem to be a mail file: $1",[a]);return r?p.Z.showModalInfo(e,{title:(0,v.Z)("Mail Import File"),body:t}):m.Z.setStatus(e,t),!1}const d=S.Z.getFolderType(s,n),{indexUpdates:c}=await Z.Z.call(s,n,d,[l]);We.updateIndex(c);const{addedSles:h,sleUpdates:u}=c;let g;if(h&&h.length>0?g=h[0]:u&&u.length>0&&(g=await(0,_.Z)(u[0].id),k.Z.info("Mail",["import file",s,n,a],"Message already exists but was also added to this folder -",l.subject)),g){const{id:e,sentDate:t}=g;return await L.Z.call(s,t,e,l.raw),await P.Z.setHasRaw(s,e),await(0,T.Z)(s,n,[l]),M.Z.filter(),i.Z.updateThreads(),o&&(await N.Z.addUpload([{accountId:s,path:n,searchListId:e,flags:[]}]),i.Z.flushBuffer()),!0}{k.Z.warn("Mail",["import file",s,n,a],"Message already exists in this folder -",l.subject," - ",(0,R.Qe)(l.bodyParts));const t=(0,v.Z)("Message already exists in this folder - $1",[l.subject]);return r?p.Z.showModalInfo(e,{title:(0,v.Z)("Mail Import File"),body:t}):m.Z.setStatus(e,t),!1}}async function U(e,t,s,n,i,a){const o=await async function(e,t){return new Promise((s=>{j.Z.importData.openThunderbirdMailbox(e,String(t),(e=>{s(Number(e))}))}))}(t,0);let r=await(0,B.tP)();if(r){let l=r.seekPosition,d=r.message,c=0,h=0;const u=(0,F.sy)(d);for(await W(e,u,s,n,t,i,a&&-1===l)?c+=1:h+=1;l>-1;){if(m.Z.setStatus(e,`${t}: ${Math.floor(l/1e3)}/${Math.floor(o/1e3)} kB (${c} messages)`,5e3),r=await(0,B.tP)(),!r){h+=1,k.Z.warn("Mail",["import file",s,n,t],"Failed to read file");break}{l=r.seekPosition,d=r.message;const a=(0,F.sy)(d);await W(e,a,s,n,t,i,!1)?c+=1:h+=1}}return j.Z.importData.closeThunderbirdMailbox(),{numAdded:c,numFailed:h}}j.Z.importData.closeThunderbirdMailbox();const l=await(0,O.Z)(t);return await W(e,l,s,n,t,i,a)?{numAdded:1,numFailed:0}:{numAdded:0,numFailed:1}}var V=s(95752),H=s(28918),G=s(68906),K=s(33956);const z=async function(e,t){const{id:s}=e;return await y.Z.searchList.update(s,{unseen:t}),[{id:s,updates:{unseen:t}}]};var $=s(15489),Y=s(92292),X=s(54773),Q=s(25051),q=s(16152),J=s(89175),ee=s(78614),te=s(8684),se=s(44850);const ne=new Set,ie=(0,q.Z)((async function(){const e=[...ne].filter((e=>!V.Z.call(e.sources)));if(ne.clear(),e.length<=5)for(const t of e)await re(t);else await async function(e){const t=()=>{const e=$.ZP.getMailWindowId();p.Z.showMail(e)};(0,te.c)({title:(0,v.Z)("You have $1 new mail","You have $1 new mails",[e.length]),icon:"resources/mail_notification_icon.png",silent:!g.Z.get(J.kMailNotificationsSoundOn),onClick:t,timeout:oe,tag:ae})}(e)}),5e3),ae="VIVALDI_MAIL_BATCHED_MULTIMAIL",oe=36e5;function re(e){const t=(0,ee.Rz)(X.Z.get(e.fromIds)),s=(0,ee.Rz)(X.Z.get(e.toIds));(0,te.c)({title:e.subject,body:(0,v.Z)("New mail from $1 to $2",[t,s]),icon:"resources/mail_notification_icon.png",silent:!g.Z.get(J.kMailNotificationsSoundOn),onClick:()=>{const t=`message/${e.id}`,s=se.jk.internalUrl("mailpage",t,(0,v.Z)("Mail")),n=$.ZP.getMailWindowId();Q.QJ.openURL(n,s),Y.Z.windows.update(n,{drawAttention:!0})},timeout:108e5,tag:`VIVALDI_MAIL_MESSAGE_ID_${e.id}`})}const le={newMail:function(e){ne.add(e),ie()}};var de=s(95538),ce=s(34198),he=s(26219),ue=s(81830),pe=s(67103),ge=s(5863),me=s(65741),fe=s(1407),ve=s(58228);function be(e,t){const s=I.ZP.parseQuery(e),n=Date.now();return m.Z.setStatus(fe.A4,(0,v.Z)("Searching for $1...",[s])),k.Z.log("Mail",["search"],`query:${e}, refined:${s}`),async function(e){return new Promise((t=>{try{j.Z.mailPrivate.searchMessages(e,t)}catch(t){k.Z.error("Mail",["searchMessages"],`Search failed for query: ${e}`,t)}}))}(s).then((e=>{const i=e.search_list_ids;if(t()){const e=`Discarding results for outdated query: ${s}`;throw k.Z.log("Mail",["search"],`${e}`),new Error(e)}{const e=Date.now()-n;return m.Z.setStatus(fe.A4,(0,v.Z)("Search for $2 returned $1 result in $3ms.","Search for $2 returned $1 results in $3ms.",[i.length,s,e])),k.Z.log("Mail",["search"],`search for ${s} returned ${i.length} results in ${e}ms`),i}}))}var Ce=s(49168),we=s(93986),ye=s(13248);function xe(e){const{sleUpdates:t,undoItem:s}=A.Z.setRead(e,!0);Ne({sleUpdates:t}),Ie(s)}function Ie(e){e&&f.Z.dispatch({actionType:"MAIL_UNDO_ADD_ITEM",undoItem:e,folder:h.Z.getSelectedFolder()})}async function Ae(e,t){await y.Z.transaction("rw",[y.Z.buffer,y.Z.accounts],(async()=>{await(0,H.Z)({accountId:e,path:t,operation:"BUFFER_OPERATION_REMOVE_ACCOUNT_PATH",deleteFiles:!0}),(0,ye.ZA)(e)&&(await n.Z.removeFolder(e,t),await b.Z.removeFolder(e,t))})),i.Z.flushBuffer()}async function Se(e,t){const s=ge.wC,n=[ge.W4,ge.cs],i=[{senderIsMailingList:t}],a=n.map((e=>d.Z.getByFolder(s,[e,t].join("/")))).find((e=>void 0!==e));if(a)await o.Z.remove([a.id]),await x.Z.updateFilters([a.id]);else{const e={name:t,accountId:s,path:`${ge.W4}/${t}`,filterValue:{include:[i],exclude:[[{flag:ge.T4.DELETED}]],...I.ZP.getSearchListButtons(ge.wC)}},n=await be(`from:${t}`,(()=>!1)),a=await o.Z.add(e,ge.Un.LOW,n);await x.Z.updateFilters(a)}M.Z.filter()}function Ze(e,t){function s(e="",t){return"anywhere"===t.queryType?e:I.ZP.getAddedQuery({conjunction:"",condition:"include",ruleName:t.queryType??"anywhere",rule:e})}const n=I.ZP.joinQueries(s(e.query,e),e.queryAddition,e.contactQuery,e.from,e.to,e.cc);if(e.queryFolder||I.ZP.isValidSearch(e)){const i=e.queryOptions,a=e.queryFolder,o=e.attachments,r=e.sentDate,l=e.sentDateEnd,c=a||h.Z.getSelectedFolder(),u={actionType:"MAIL_UPDATE_QUERY_RESULTS",threadPrefix:e.threadPrefix,...c&&{folder:c},filterOptions:i,attachments:o,sentDate:r,sentDateEnd:l,updateScrollPosition:t};!n||n.length<3?f.Z.dispatch({...u,queryResults:d.Z.getIndexSearchListIds()}):be(n,(function(){const e=h.Z.getOptions(),t=I.ZP.joinQueries(s(e.query??"",e),e.queryAddition,e.contactQuery,e.from,e.to,e.cc);return n!==t})).then((e=>{f.Z.dispatch({...u,queryResults:e})})).catch((()=>{}))}}async function Te(e,t=!1){const s=d.Z.getByAccountId(ge.wC),n=ce.ZP.mailingListGroupToFilters(s,e);await Ee(n,t)}async function Ee(e,t=!1){let s;if(!t){const t=e.map((e=>I.ZP.getTotalViewIdByFilterId(e.id)));s=d.Z.getListEntryIdsByViewIds(t)}await o.Z.remove(e.map((({id:e})=>e)));const n=new Set;for(const t of e)n.add(t.id);await x.Z.updateFilters([...n]),await G.Z.call({priority:ge.Un.LOW,type:"RE_RUN_SLES",searchListIds:s,runMailingLists:!0}),M.Z.filter()}async function ke(){await G.Z.call({priority:ge.Un.LOW,type:"RE_RUN_SLES",runMailingLists:!0}),M.Z.filter()}function Ne(e){f.Z.dispatch({actionType:"MAIL_INDEX_UPDATE",updates:e});const{sleUpdates:t=[]}=e,s=h.Z.getQuery(),n=Le();let i=!1;const a=new Set(g.Z.get(J.kMailAccounts).filter((e=>e.offline)).map((e=>e.MAIL_EMAIL))),o=new Map,r=new Map,l=[],u=[],p=[];function m(e,t){let s;switch(t.type){case"ADD_LABEL":s=o.get(t.label),s?s.push(e):o.set(t.label,[e]);break;case"REMOVE_LABEL":s=r.get(t.label),s?s.push(e):r.set(t.label,[e]);break;case"MARK_READ":l.push(e);break;case"SET_FLAG":const n=(0,Ce.KR)(t.flag);for(const t of Object.keys(n))n[t]?(s=o.get(t),s?s.push(e):o.set(t,[e])):(s=r.get(t),s?s.push(e):r.set(t,[e]));break;case"MARK_AS_SPAM":u.push(e);break;case"ARCHIVE":p.push(e)}}function v(e,t){const s=x.Z.get(e);if(!s)throw new Error("Filter not found "+e);const n=s.triggers;if(n){const e=Le({accountId:s.accountId,path:s.path,name:s.name,id:I.ZP.toFolderPath(s.accountId,s.path)});for(const s of n)e&&!d.Z.matchesViewIntersection(t.viewIds,e,t.totalViewIds)||m(t,s)}}t.forEach((e=>{const t=d.Z.getListEntry(e.id),{addedViewIds:o,runTriggerFilterIds:r}=e.updates;if(t){if(s&&n&&(i=d.Z.matchesViewIntersection(t.viewIds,n,t.totalViewIds)),g.Z.get(J.kMailNotifications)){const e=o?.some((e=>{if(e%ge.XN!=0)return!1;const s=e/ge.XN,n=x.Z.get(s);if(!n)return!1;const{accountId:i,path:o}=n;if(a.has(i))return!1;if(!(S.Z.getFolderType(i,o)===ge.e9))return!1;const r=(0,we.Ps)(i);return!r||t.sentDate>r}));e&&le.newMail(t)}if(o)for(const e of o){if(e%ge.XN!=0)continue;v(e/ge.XN,t)}r&&r.forEach((e=>{v(e,t)}))}else k.Z.warn("Mail",["updateIndex"],"ListEntry not found "+JSON.stringify(e))})),i&&Ze(h.Z.getOptions()),o.forEach(((e,t)=>{A.Z.setCustomFlags(e,{[t]:!0})})),r.forEach(((e,t)=>{A.Z.setCustomFlags(e,{[t]:!1})})),l.length>0&&A.Z.setRead(l,!0,!1),u.length>0&&c.Z.moveToJunk(u),p.length>0&&c.Z.moveToArchive(p)}function _e(e,t){const s=h.Z.getOptionsFromHistory(t);f.Z.dispatch({actionType:"MAIL_FOLDER_SELECT_HISTORY_INDEX",historyIndex:t}),I.ZP.isValidSearch(s)?Fe.updateQueryResults(s):s.threadPrefix?Re(s.threadPrefix,s.query):Be(s.queryFolder)}function Pe(e,t={}){f.Z.dispatch({actionType:"MAIL_SELECT_FOLDER",folder:e,options:t}),t.threadPrefix?Re(t.threadPrefix):Be()}function Me(e,t){const s={...e,subscribed:t};Pe(s,{query:(e&&x.Z.getByFolderId([s.accountId,s.path]))?.filterValue.query||""})}function De(e){if(e.accountId!==ge.Ry)return e;const t=e.path.indexOf("/"),s=e.path.slice(0,t),n=e.path.slice(t+1);return{...e,accountId:s,path:n}}async function Oe(e,t,s,n){let i=!1;(0,ye.mq)(s)&&(i=await async function(){return new Promise((t=>{p.Z.showMailUploadConfirmation(e,s,t)}))}());let a=0,o=0;for(const r of t){const l=await j.Z.mailPrivate.getFullPath(r.filesystem.name,r.fullPath);m.Z.setStatus(e,(0,v.Z)("Importing message from file $1",[l]));try{const{numAdded:r,numFailed:d}=await U(e,l,s,n,i,1===t.length);a+=r,o+=d}catch(t){m.Z.setStatus(e,(0,v.Z)("Failed to import mail file: $1",[t])),k.Z.error("Mail",["import file",s,n],t)}}const r=(0,v.Z)("Finished importing $1 message.","Finished importing $1 messages.",[a]);let l=r;if(o>0){l=`${r} ${(0,v.Z)("Failed adding $1 message. See logs in Mail Status for details.","Failed adding $1 messages. See logs in Mail Status for details.",[o])}`}p.Z.showModalInfo(e,{title:(0,v.Z)("Mail Import File"),body:l})}function je(e,t,s){let n="",i=[];const o=t?a.Z.getNodeById(t):void 0;s?(i=[s],n=s):o&&(n=o.name,i=o.emailAddresses.map((e=>e.emailAddress)));const r={accountId:ge.of,path:ge.ym,id:n,name:n},l={forSender:s,forContact:t,contactQuery:I.ZP.getContactQuery(i,new Set(["to","from"])),queryFolder:r,queryType:"anywhere"};f.Z.dispatch({actionType:"MAIL_SELECT_FOLDER",folder:r,options:l}),Fe.updateQueryResults(l)}function Le(e){if(e||(e=h.Z.getSelectedFolder()),!e)return;const{accountId:t,path:s=ge.ym}=e,n=d.Z.getByFolder(t,s);return n?I.ZP.getViewIntersections(n):void 0}function Re(e,t){f.Z.dispatch({actionType:"MAIL_SELECT_THREAD",threadPrefix:e,query:t})}function Be(e){f.Z.dispatch({actionType:"MAIL_INIT_MESSAGES",folderIntersections:Le(e)})}const Fe={init:function(){x.Z.addListener((e=>{"updateFilters"===e.target&&Fe.updateFilters(e.filterIds)}))},updateThreadKeys:function(e){f.Z.dispatch({actionType:"MAIL_UPDATE_THREAD_KEYS",updates:e})},markSeenReadDebounced:(0,q.Z)((async e=>{const t=function(){const e=h.Z.getSelectedFolder();if(e){const{accountId:t,path:s}=e;return d.Z.getByFolderId([t,s])}}();if(t&&I.ZP.getFilterOptions(t).showRead&&g.Z.get(J.kMailAutoMarkAsRead)){const{sleUpdates:t}=A.Z.setRead([e],!0,!1);Ne({sleUpdates:t})}else if(e.unseen){const t=await z(e,!1);await G.Z.call({priority:ge.Un.HIGH,type:"RE_RUN_SLES",searchListIds:[e.id]}),Ne({sleUpdates:t}),M.Z.filter()}}),1e3),setDisconnected:function(e,t){f.Z.dispatch({actionType:"MAIL_IS_DISCONNECTED",accountId:e,isDisconnected:t})},setConnecting:function(e,t){f.Z.dispatch({actionType:"MAIL_IS_CONNECTING",accountId:e,isConnecting:t})},setSyncing:function(e,t){f.Z.dispatch({actionType:"MAIL_IS_SYNCING",accountId:e,isSyncing:t})},setSyncingFlags:function(e,t){f.Z.dispatch({actionType:"MAIL_IS_SYNCING_FLAGS",accountId:e,isSyncingFlags:t})},setPreFetching:function(e,t){f.Z.dispatch({actionType:"MAIL_IS_PRE_FETCHING",accountId:e,isPreFetching:t})},pausePrefetching:function(e,t){t||l.Z.canResumePrefetch(e)?(f.Z.dispatch({actionType:"MAIL_PAUSE_PRE_FETCHING",requester:e,pause:t}),r.Z.pausePrefetching(t)):k.Z.info("Mail",["resume prefetching"],`Can not resume prefetching for ${e} as it is also paused for another requester`)},markAllReadCmd:function(){const e=h.Z.getSelectedFolder();let t;if(e){const{accountId:s,path:n}=e;t=d.Z.getByFolderId([s,n])}xe(d.Z.getListEntries().filter((e=>!V.Z.call(e.sources,t))))},markAllRead:function(e,t){const s=e===ge.Ry&&t!==ge.ym?I.ZP.fromCustomFolderPath(t):[e,t],n=d.Z.getListEntriesByFolder(...s),i=d.Z.getByFolderId(s);if(!i)throw new Error("Filter not found");xe(n.filter((e=>!V.Z.call(e.sources,i))))},markAllListEntriesRead:xe,pushUndoItem:Ie,removeAccount:async function(e,t,s,n){await y.Z.transaction("rw",[y.Z.buffer,y.Z.accounts],(async()=>{await(0,H.Z)({accountId:e,path:"",operation:"BUFFER_OPERATION_REMOVE_ACCOUNT",deleteFiles:t,deletePasswords:s}),await y.Z.accounts.delete(e)})),n===ge.s9.IMAP&&await r.Z.disconnectIMAPClient(e),await b.Z.removeAccount(e),M.Z.removeFolders(e),i.Z.flushBuffer(),(0,ve.l)(e,"mail")},removeAccountPath:Ae,setSearchOptions:function(e){f.Z.dispatch({actionType:"MAIL_SEARCH_SET_OPTIONS",options:e})},addLabelsFilter:async function(e){const t={name:e,accountId:ge.ut,path:e,filterValue:{include:[[{flag:e}]],...I.ZP.getSearchListButtons(ge.ut)}},s=await o.Z.add(t,ge.Un.NORMAL);await x.Z.updateFilters(s)},addFilter:async function(e,t=!0,s){const{query:n}=e.filterValue;let i;n&&!s&&(s=await(0,ue.Z)(n),i=!0);const a=await y.Z.transaction("rw",[y.Z.filters,y.Z.filteringQueue],(async()=>t?await o.Z.add(e,ge.Un.LOW,s,i):await o.Z.add(e)));return await x.Z.updateFilters(a),t&&M.Z.filter(),a},putFilter:async function(e,t,s){const n=s||function(e,t){if(e.filterValue.query!==t.filterValue.query)return!0;const{filterValue:s}=e,{filterValue:n}=t;return!(0,me.Z)(s.include,n.include)||!(0,me.Z)(s.exclude||[],n.exclude||[])||s.sentDate!==n.sentDate||s.sentDateEnd!==n.sentDateEnd||s.attachments!==n.attachments||!(0,me.Z)(e.triggers||[],t.triggers||[])}(e,t),i=await y.Z.transaction("rw",[y.Z.filters,y.Z.filteringQueue],(async()=>{const t=await o.Z.put(e);return n&&G.Z.call({type:"RUN_FILTERS",priority:ge.Un.LOW,filterIds:[e.id],triggerFilterIdCandidates:[e.id]}),t}));await x.Z.updateFilters(i),n&&M.Z.filter()},removeFilter:async function(e){await o.Z.remove([e]),x.Z.updateFilters([e]),M.Z.filter()},rerunFilter:async function(e,t){await G.Z.call({type:"RUN_FILTERS",priority:ge.Un.LOW,folderIds:[[e,t]]}),M.Z.filter()},reSyncFolder:async function(e,t){(0,ye.mq)(e)&&await r.Z.reSyncFolder(e,t)},reSyncAccount:async function(e){(0,ye.mq)(e)&&await r.Z.reSyncAccount(e)},reconnectAccount:async function(e){(0,ye.mq)(e)&&await r.Z.reconnectIMAPClient(e)},runStoredFilters:async function(){const e=d.Z.getByAccountId(ge.Kz);if(0===e.length)return;const t=e.map((e=>e.id));await G.Z.call({type:"RUN_FILTERS",priority:ge.Un.NORMAL,filterIds:t}),M.Z.filter()},runStoredFiltersForMessages:async function(e){const t=d.Z.getByAccountId(ge.Kz);if(0===t.length)return;const s=t.map((e=>[e.accountId,e.path]));await G.Z.call({type:"FILTERS_SLES",priority:ge.Un.NORMAL,folderIds:s,searchListIds:e}),M.Z.filter()},updateFilters:async function(e){f.Z.dispatch({actionType:"MAIL_FILTERS_CHANGED",filterIds:e});const t=[];e.forEach((e=>I.ZP.getAllViewTypes().forEach((s=>t.push(e*ge.XN+s))))),function(e){const t=Date.now(),s=d.Z.getCounterFolders(e);if(0===s.length)return;d.Z.getIndex().forEach((e=>{const{viewIds:t,totalViewIds:n}=e;w.Z.updateCounterFolders(t,n,1,s)})),f.Z.dispatch({actionType:"MAIL_UPDATE_COUNTERS",countedFolders:s,deltaValues:!1}),k.Z.log("Mail",["counters"],`updateCounters took ${Date.now()-t}ms.`)}(t)},toggleMoveToOther:async function(e){const t=e.path;let s,n,i;t.startsWith(ge.cs)?(n=ge.W4,s=ge.cs,i=t.substr(ge.cs.length+1)):(n=ge.cs,s=ge.W4,i=t.substr(ge.W4.length+1));const a=await o.Z.move(e.accountId,s,n,i);await x.Z.updateFilters(a),Fe.selectFolder({...e,path:[n,i].join("/"),id:ge.jT+"_"+[n,i].join("/")},h.Z.getOptions()),M.Z.filter()},removeMailingListFilter:async function(e,t){const s=t.filterValue.include,n=s&&s[0],i=n&&n[0];if(i?.listId){const e=i.listId,s={listId:e,name:e,parentFolderType:"matches",subFolderType:"none",isIgnored:!0};await M.Z.updateMailingListGroup(s),await o.Z.remove([t.id]),await x.Z.updateFilters([t.id]),f.Z.dispatch({actionType:"MAILING_LIST_GROUP_CHANGED",mailingListGroup:s}),M.Z.filter()}else i?.senderIsMailingList&&await Se(e,i.senderIsMailingList)},toggleSenderAsMailingList:Se,addSearchToHistory:function(e){if(!I.ZP.isMailSearching(h.Z.getOptions())){const t=h.Z.getSelectedFolder();let s,n;if(t&&"current"===g.Z.get(J.kMailSearchFolder)){s=t;const e=x.Z.getByFolderId([s.accountId,s.path]);n=I.ZP.getFilterOptions(e)}else{const e=h.Z.getSelectedFolder()?.accountId===ge.u4,t=I.ZP.getDefaultFilterForPath(e?ge.u4:ge.of,ge.ym);n=I.ZP.getFilterOptions(t),s={name:t.accountId,accountId:t.accountId,path:t.path,id:ge.i4+"_"+t.accountId}}Fe.setSearchOptions({forContact:e.forContact,forSender:e.forSender,threadPrefix:e.threadPrefix}),Pe(t||s,e={queryFolder:s,queryOptions:n,...e})}Fe.setSearchOptions(e),Fe.updateQueryResults(e,!0)},updateQueryResults:Ze,clearSearch:function(){f.Z.dispatch({actionType:"MAIL_CLEAR_SEARCH"})},showMailSearchOptions:function(){f.Z.dispatch({actionType:"SHOW_MAIL_SEARCH_OPTION"})},regenerateAllMailingLists:async function(){const e=d.Z.getByAccountId(ge.wC),t=ce.ZP.mailingListGroupToFilters(e);await Ee(t,!0)},removeMailingListGroup:async function(e){await M.Z.removeMailingListGroup(e),await Te(e),f.Z.dispatch({actionType:"MAILING_LIST_GROUP_CHANGED",mailingListGroup:e})},removeIgnoredMailingList:async function(e){await M.Z.removeMailingListGroup(e),await ke(),f.Z.dispatch({actionType:"MAILING_LIST_GROUP_CHANGED",mailingListGroup:e})},initIndex:async function(){const e=await y.Z.searchList.count();let t=1e3,s=-1;await async function n(){const i=Date.now(),[a,o]=await Promise.all([y.Z.searchList.where("id").above(s).limit(t).toArray(),y.Z.viewIds.where("searchListId").above(s).limit(t).toArray()]);if(f.Z.dispatch({actionType:"MAIL_INIT_INDEX_BATCH",sleBatch:a,viewIdsBatch:o,total:e}),a.length===t){const{id:e}=a[t-1];s=e;const o=Date.now();t=C.Z.adjustBatchSize(1e3,1e5,50,t,o-i),await n()}}(),f.Z.dispatch({actionType:"MAIL_INIT_INDEX_FINISHED"})},updateIndex:Ne,updateMailingListGroupName:async function(e){await M.Z.updateMailingListGroup(e);const t=await o.Z.updateName([[ge.wC,ge.W4+"/"+e.listId],[ge.wC,ge.cs+"/"+e.listId]],e.name);x.Z.updateFilters(t),f.Z.dispatch({actionType:"MAILING_LIST_GROUP_CHANGED",mailingListGroup:e})},updateMailingListGroup:async function(e){const t=de.Z.get(e.listId);if(await M.Z.updateMailingListGroup(e),"uncategorized"===e.parentFolderType)await async function(){const e=d.Z.getByAccountId(ge.wC),t=ce.ZP.mailingListGroupToFilters(e),s=de.Z.getGroups(),n=t.filter((e=>!s.some((t=>t.listId===e.path.split("/")[1]))));await Ee(n,!0)}();else if(t?.isIgnored&&!e.isIgnored)await ke();else if(t)await async function(e,t){const s=d.Z.getByAccountId(ge.wC),n=ce.ZP.mailingListGroupToFilters(s,t);if(de.Z.get(ge.ZW)?.isIgnored)await Ee(n,!0);else{const e=ce.ZP.mailingListGroupToFilters(s,t),i=[...new Set([...n,...e])];await Ee(i,!1)}}(0,e);else{const t=!0;await Te(e,t)}f.Z.dispatch({actionType:"MAILING_LIST_GROUP_CHANGED",mailingListGroup:e})},stop:function(){f.Z.dispatch({actionType:"MAIL_STOP"})},setAccountIndicator:function(e,t,s=0,n=0,i=0){f.Z.dispatch({actionType:"MAIL_INDICATOR_ADD_ACCOUNT",accountId:e,indicatorType:t,priority:s,current:n,total:i})},setPathIndicator:function(e,t,s,n,i,a){f.Z.dispatch({actionType:"MAIL_INDICATOR_ADD_PATH",accountId:e,path:t,indicatorType:s,priority:n,current:i,total:a})},removeAccountIndicator:function(e,t){f.Z.dispatch({actionType:"MAIL_INDICATOR_REMOVE_ACCOUNT",accountId:e,indicatorType:t})},removePathIndicator:function(e,t){f.Z.dispatch({actionType:"MAIL_INDICATOR_REMOVE_PATH",accountId:e,path:t})},removeAllIndicators:function(e){f.Z.dispatch({actionType:"MAIL_INDICATOR_REMOVE_ALL",accountId:e})},pageForward:function(e){if(h.Z.canGoForward()){_e(e,h.Z.getHistoryIndex()+1)}},pageBack:function(e){if(h.Z.canGoBack()){_e(e,h.Z.getHistoryIndex()-1)}},selectFolderFromHistory:_e,selectFolder:Pe,importMailFiles:Oe,selectAndImportMailFiles:async function(e,t){const s=await(0,he.Z)(e,["eml","mbs","mbox"]),{accountId:n,path:i}=t;Oe(e.vivaldiWindowId,s,n,i)},subscribeMailbox:async function(e,t){const s=De(t);Me(s,!0);try{await r.Z.subscribeMailbox(s)}catch(n){Me(s,!1),m.Z.setStatus(e,(0,v.Z)("Failed to subscribe to mailbox: $1",[n])),k.Z.error("Mail",["subscribeMailbox",t.accountId,t.path],n)}},unsubscribeMailbox:async function(e,t,s){const n=De(t);try{Me(n,!1);try{await r.Z.unsubscribeMailbox(n,s)}catch(e){throw Me(n,!0),e}s&&Ae(n.accountId,n.path)}catch(s){m.Z.setStatus(e,(0,v.Z)("Failed to unsubscribe from mailbox: $1",[s])),k.Z.error("Mail",["unsubscribeMailbox",t.accountId,t.path],s)}},selectThread:function(e){const t=[e.threadKey[0],e.threadKey[1]];Pe({accountId:ge.tQ,path:String(t),id:String(t),name:e.subject},{threadPrefix:t})},rerunThreading:async function(e,t){const s=b.Z.getFolderName(e,t);m.Z.setStatus(fe.A4,(0,v.Z)("Re-threading - $1 $2",[e,s]),5e3);const n=x.Z.getByFolderId([e,t]);if(!n)throw new Error(`Filter not found for ${e} ${s}`);const a=I.ZP.getTotalViewIdByFilterId(n.id),o=d.Z.getListEntryIdsByViewIds([a]);await(0,K.Z)(o),i.Z.updateThreads()},selectContactById:function(e,t){je(e,t)},selectContactByAddress:function(e,t){je(e,void 0,t)},selectContactByIdAndAddress:function(e,t,s){je(e,t,s)},sortListEntries:function(){if(f.Z.dispatch({actionType:"MAIL_SORT_LIST_ENTRIES"}),h.Z.getQuery()){const e=h.Z.getOptions();Fe.updateQueryResults(e)}},getViewIntersections:Le,undo:function(e){if(e||(e=u.Z.getLatestUndoAction()),!e)return;const{undoItem:t}=e;switch(t.operation){case"setFlags":Fe.undoSetFlags(t);break;case"delete":Fe.undoDelete(t)}f.Z.dispatch({actionType:"MAIL_UNDO_DELETE_ITEM",undoAction:e})},undoSetFlags:function(e){const{updates:t,searchListIds:s,sourcesPerSle:n}=e;if(0===s.size)return;const i=d.Z.getListEntriesByIds(s),{sleUpdates:a}=A.Z.setCustomFlags(i,t,n);Ne({sleUpdates:a})},undoDelete:function(e){const{searchListIds:t,markUnread:s}=e,n=d.Z.getListEntriesByIds(t);(0,pe.Z)(n,s)},fetchPreviews:async function(e){await Promise.all(e.map((e=>(0,H.Z)({operation:"BUFFER_OPERATION_FETCH_RAW_FOR_ALL_SOURCES",searchListId:e})))),await i.Z.flushBuffer()},restoreFullTextSearchDb:async function(){await j.Z.mailPrivate.deleteMailSearchDB(),await y.Z.systemTasks.add({taskName:"restore_full_text_search_db",currentPosition:0}),i.Z.runSystemTasks()}},We=Fe},43623:(e,t,s)=>{"use strict";s.d(t,{Z:()=>i});var n=s(33638);const i={set:function(e,t,s,i,a){n.Z.dispatch({actionType:"MAIL_ERROR_SET",accountId:e,category:t,error:s,code:i,level:a})},remove:function(e,t){n.Z.dispatch({actionType:"MAIL_ERROR_DELETE",category:t,accountId:e})}}},97698:(e,t,s)=>{"use strict";s.d(t,{Z:()=>X});var n=s(2711),i=s(4660),a=s(99827),o=s(88630),r=s(43623),l=s(98611),d=s(60331),c=s(56371),h=s(24600),u=s(45660),p=s(5863),g=(s(20244),s(6271));let m=!1;async function f(e){if(e.useOAuth){const t=await async function(e){const{accessToken:t}=await n.Z.getOAuthAccessToken(e.MAIL_EMAIL,(0,g.dn)(e),!1);return{user:e.MAIL_EMAIL,xoauth2:t}}(e);return(0,h.Z)(e,t)}return(0,h.Z)(e)}const v=function(e,t,s,n){if(this.alreadySending)return void u.Z.log("Mail",["smtp","onidle"],`[${e.MAIL_EMAIL}]Already Sending!`);u.Z.log("Mail",["smtp","onidle"],`[${e.MAIL_EMAIL}]`),this.alreadySending=!0;const i=[...t,...s,...n].map((e=>e.address));this.useEnvelope({from:e.MAIL_EMAIL,to:i})},b=function(e,t,s){u.Z.log("Mail",["smtp","onready"],"failedRecipients:",s.length),s.length>0?t({message:(0,c.Z)("Rejected recipients: $1",[s.join()])}):(this.send(e),this.end())},C=function(e,t,s,n,i){u.Z.log("Mail",["smtp","ondone"],`subject:"${t}" success:${i}`),m=!1,i?d.Z.setStatus(e,(0,c.Z)("Sent message: $1",[t]),p.QM):d.Z.setStatus(e,(0,c.Z)("Failed to send message: $1",[t])),this.quit(),i?s():n((0,c.Z)("Failed to send message: $1",[t]))},w=function(e,t,s,n){n||m?(u.Z.log("Mail",["smtp","onclose"],"Closed because of an error!"),d.Z.setStatus(e,(0,c.Z)("Failed to send message")),m=!1,s({message:(0,c.Z)("SMTP client closed on error")})):(u.Z.log("Mail",["smtp","onclose"],""),t())},y=function(e,t,s,i){u.Z.log("Mail",["smtp","onclose"],`[${t.MAIL_EMAIL}]${i.message}`),t.useOAuth&&n.Z.fetchAccessTokenAndRefreshToken(t.MAIL_EMAIL,(0,g.dn)(t),!0),m=!1;const a=t.MAIL_SMTP_SERVER||"",o=t.MAIL_SMTP_USER||"";d.Z.setStatus(e,(0,c.Z)("$1 - Server: $2 - User: $3",[i.message,a,o])),this.quit(),s(i)},x={send:function(e,t,s,n,i,a,o){return u.Z.log("Mail",["smtp","send"],`[${t.MAIL_EMAIL}]subject:"${s}"`),-1===t.MAIL_SMTP_PORT?(console.warn("not gonna send as the smtp port is missing"),d.Z.setStatus(e,(0,c.Z)("SMTP client not configured for sending mail")),Promise.reject()):(d.Z.setStatus(e,(0,c.Z)("Sending")),new Promise(((r,l)=>{f(t).then((d=>{m=`subject: ${s||""}, from: ${t.MAIL_EMAIL}`,d.onidle=v.bind(d,t,n,i,a),d.onready=b.bind(d,o,l),d.ondone=C.bind(d,e,s,r,l),d.onerror=y.bind(d,e,t,l),d.onclose=w.bind(d,e,r,l),d.connect()})).catch((e=>l(e)))})))}};var I=s(46382),A=s(68247),S=s(29087),Z=s(78347),T=s(45709),E=s(97823),k=s(21285),N=s(61839);var _=s(68906),P=s(33956),M=s(20570),D=s(55346),O=s(93818),j=s(89846),L=s(24651),R=s(5204),B=s(30628),F=s(40382),W=s(77312),U=s(22288),V=s(89175),H=s(8684);let G=!1;async function K(e,t){t||(e.queued=!0);const s=await async function(e){const{addedSles:t,forSearchDb:s}=await(0,k.Z)(p.of,p.J8,p.fZ,[e],{filteringPriority:p.Un.HIGH});(0,N.Z)(s);const[n]=t;if(!n)throw new Error("Failed to store message in outbox folder");return n}(e);return a.Z.updateIndex({addedSles:[s]}),R.Z.filter(),n.Z.updateThreads(),s}async function z(e,t){if(!t.from||0===t.from.length)throw new Error((0,c.Z)("Can not send. No sender specified!"));const s=await E.Z.loadAllAccountsAndAliases(),l=t.from.map((e=>e.address)),d=s.find((e=>e.MAIL_EMAIL===l[0]));if(!d)throw new Error((0,c.Z)("Can not send. No account set up for sender $1",[l[0]]));const h=E.Z.getAccountIdForEmail(d.MAIL_EMAIL)||d.MAIL_EMAIL,g=Z.Z.getFoldersOfType(h,p.Nz);let m,f,v=!1;g.length?(m=h,f=g[0].path,v=!0):(m=p.of,f=p.N1);let b=0;if(t.bodyParts?.forEach((e=>{e.fileSize?b+=e.fileSize:b+=e.content.length})),b>p.gh){const{action:t}=await I.Z.showModal(e,{modal:{title:(0,c.Z)("A Large Message in Outbox"),body:(0,c.Z)("A large message ($1MB) is about to be sent. The mail servers might not accomodate it and sending may fail.",[Number(b/1e6).toFixed(1)]),actions:[{title:(0,c.Z)("mail","Send anyway"),action:"continue"}],cancelAction:{title:(0,c.Z)("mail","Do not send"),action:"cancel",default:!0}}});if("cancel"===t)return void u.Z.log("Mail",["outbox"],"Sending of large message cancelled by user")}const C=t.bodyParts&&t.bodyParts[0];if(!C)throw new Error("No bodyPart found in message");const w=C.content;if("string"!=typeof w)throw new Error("The first bodyPart must be of type string, it is of type: "+typeof w);const y=1e3*Math.floor(Date.now()/1e3),k=(0,U.yN)(t.bodyParts),N=await o.Z.build({...t,sentDate:y},w,k),{id:D,subject:B,to:H,cc:G,bcc:K}=t;try{await x.send(e,d,B,H,G,K||[],N),r.Z.remove(d.MAIL_EMAIL,"SMTP")}catch(e){throw r.Z.set(d.MAIL_EMAIL,"SMTP",e),e}const z={searchList:{sentDate:y},messages:{sentDate:y},threading:{sentDate:y}},$={searchList:["queued"]};v&&(await(0,F.Z)(h,y,t.id,N),await L.Z.setHasRaw(h,t.id),$.messages=["bodyParts"],await(0,W.fN)(D));const Y={addedProperties:z,removedProperties:$,filteringPriority:p.Un.HIGH},{sleUpdate:X}=await(0,j.Z)(t.id,p.of,p.J8,m,f,Y);m!==p.of&&_.Z.call({type:"FILTERS_SLES",priority:p.Un.HIGH,searchListIds:[t.id],folderIds:[[p.of,p.N1]]}),await(0,P.Z)([t.id]),a.Z.updateIndex({sleUpdates:[X]}),R.Z.filter(),A.Z.set(V.kMailLastSentFrom,d.MAIL_EMAIL),v&&d.accountType===p.s9.IMAP&&(d.uploadSent??1)?(await M.Z.addUpload([{accountId:h,path:f,searchListId:t.id,flags:[p.T4.SEEN]}]),n.Z.flushBuffer()):d.accountType===p.s9.IMAP&&(d.uploadSent??1)&&console.warn("No sent folder found for account",h);const Q=t.forwarded||t.replied;if(void 0!==Q){const e=await(0,O.Z)(Q);if(!e)return void console.warn(`Referenced message with id ${Q} not found`);const{sleUpdates:s}=t.forwarded?T.Z.setForwarded([e],!0):T.Z.setReplied([e],!0);a.Z.updateIndex({sleUpdates:s})}S.Z.get(V.kMailAutoGenerateContacts)&&i.Z.addIfNotAddressExists(t.to)}async function $(e,t,s){if(0===t.length)return void d.Z.setStatus(e,(0,c.Z)("No messages to send"),2e3);if(G)return;G=!0;let n=0,i=0;const a=l.Z.getByFolder(p.of,p.J8);if(a){d.Z.setStatus(e,(0,c.Z)("Preparing to send $1 message","Preparing to send $1 messages",[t.length]),2e3);try{for(const o of t){const t=o.sources.get(a.id);if(t&&!t.deleted&&(s||!o.queued)){const t=await D.Z.call(o.id);if(t)try{await z(e,t),++n}catch(e){++i,u.Z.error("Mail",["outbox"],"Failed to send:",e.message||e)}}}if(n+i>0){const t=[];n>0&&t.push((0,c.Z)("$1 message successfully sent","$1 messages successfully sent",[n])),i>0&&t.push((0,c.Z)("Failed to send $1 message","Failed to send $1 messages",[i])),(i>0||S.Z.get(V.kMailNotifications)&&S.Z.get(V.kMailNotificationsOnSuccessfullySent))&&(0,H.c)({title:(0,c.Z)("Sending mail"),body:t.join("\n"),icon:"resources/mail_notification_icon.png",timeout:3e4,tag:"VIVALDI_MAIL_OUTBOX_SENT_MESSAGES"}),d.Z.setStatus(e,t.join(" ")),u.Z.info("Mail",["outbox"],t.join(" "))}}catch(e){u.Z.error("Mail",["outbox"],e)}finally{G=!1}}else u.Z.error("Mail",["outbox"],"Outbox filter missing!")}const Y={sendAll:function(e,t=!0){B.Z.m3GetAll().then((s=>$(e,s,t)))},sendExternalMessage:async function(e,t,s=!0){const n=await K(t,s);s&&Y.sendSelected(e,[n])},sendForAccount:function(e,t){B.Z.m3GetAll().then((s=>$(e,s.filter((e=>e.from&&e.from[0]&&e.from[0].address===t)),!0)))},sendSelected:function(e,t){$(e,t,!0)},storeMessage:K},X=Y},2431:(e,t,s)=>{"use strict";s.d(t,{J:()=>P,Z:()=>W});var n=s(72010),i=s(13933),a=s(98611),o=s(54162),r=s(59322),l=s(96951),d=s(29087),c=s(15489),h=s(56371),u=s(71320),p=s(10671),g=s(88951),m=s(50399),f=s(97823),v=s(55346),b=s(93818),C=s(30381),w=s.n(C),y=s(51370),x=s(5863),I=s(44850),A=s(22288),S=s(78614),Z=s(89175),T=s(97781);function E(e){const t=a.Z.getListEntry(e.id),s=t?t.sourceFilterIds.map((e=>u.Z.get(e))):[],n=s.some((e=>e&&p.Z.getFolderType(e.accountId,e.path)===x.Nz)),i=s.some((e=>e&&p.Z.getFolderType(e.accountId,e.path)!==x.Nz));let o;return o=n&&!i?e.to:e.replyTo&&e.replyTo.length>0?e.replyTo:e.from,o}function k(e){const{listPost:t}=e,s=t.match(/mailto:\s*([^>,]+)/);return s?[{address:s[1]}]:[]}function N(e,t){const{from:s,to:n,replyTo:i,cc:a}=e,o=(0,S.Yn)(...i,...s,...n).filter((e=>e.address!==t)),r=(0,S.Yn)(...a).filter((e=>e.address!==t));return o.length+r.length===0&&(i.length>0?o.push(i[0]):s.length>0?o.push(s[0]):n.length>0?o.push(n[0]):a.length>0&&r.push(a[0])),{uniqueTo:o,uniqueCc:r}}function _(e,t,s){const{inReplyTo:n,references:i}=D(e),{bodyParts:a=[]}=e,o=B(a),[r,,l]=R(e),d=function(e,t,s,n){if(t=(0,A.$P)(s,t)){const i=w()(e.sentDate).format("LLLL (Z)"),a=e.from,o=a.length>0?a[0].name||a[0].address:"unknown",r=s?"\n\n":"<br><br>",l=(0,h.Z)("On $1, $2 wrote:",[i,o])+r;return s?n+r+l+"> "+t.replace(/\r?\n/g,"\n> "):`${n}${r}${l}<blockquote style="margin: 0 0 0.80ex; border-left: #0000FF 2px solid; padding-left: 1ex">${t}</blockquote>`}return n}(e,r,o,t),{selectedAccount:c,from:u,messageId:p}=F(e),g=[],m=[];if("sender"===s)g.push(...E(e));else if("all"===s){const{uniqueTo:t,uniqueCc:s}=N(e,c?.MAIL_EMAIL);g.push(...t),m.push(...s)}else"list"===s&&g.push(...k(e));const f=Date.now();return{selectedAccount:c,messageId:p,from:u,subject:L(e,"Re: "),sentDate:f,threadKey:[f,e.id,f],attachments:[],to:g,cc:m,bcc:[],plaintext:o,cidAttachments:l,body:d,inReplyTo:n,references:i,focusOnBody:!0,replied:e.id,fromDraft:!1,replyScope:s}}function P(e){const{from:t,messageId:s,selectedAccount:n}=F(void 0,"account");return{bcc:[],body:"",cc:[],subject:"",to:[],...(0,y.Z)(e),attachments:[],from:t,messageId:s,plaintext:!0,selectedAccount:n,sentDate:Date.now(),replyScope:""}}function M(e,t){const{bodyParts:s=[]}=e,n=B(s),[i,a,o]=R(e),{inReplyTo:r,references:l,messageId:d,to:c,cc:h,bcc:u,subject:p,sentDate:g,replied:m}=e,{selectedAccount:f,from:v}=F(e,"message");return{plaintext:n,attachments:a,cidAttachments:o,body:i,inReplyTo:r,references:l,messageId:d,to:c,cc:h,bcc:u||[],subject:p,sentDate:g,selectedAccount:f,from:[...v],threadKey:t,replied:m,replyScope:""}}function D(e){const{messageId:t,inReplyTo:s,references:n}=e,i={inReplyTo:t,references:n?n.slice():[]};return 0===i.references.length&&s&&i.references.push(s),t&&i.references.push(t),i}async function O(e){const t=c.ZP.getMailWindowId(),s=j(e);await r.ZP.openURL(t,s,{singleton:Boolean(e)})}function j(e){return I.jk.internalUrl("mailpage","composer/draft",(0,h.Z)("Mail - Draft"),e?JSON.stringify({id:e}):void 0)}function L(e,t=""){if(!e)return"";const s=e.subject||"";return 0===s.toLowerCase().indexOf(t.toLowerCase())?s:t+s}function R(e){const{bodyParts:t=[]}=e,s=(0,m.Z)(!0,t),i=(0,A.yN)(t);return"html"===s?.type?function(){const a={};i.forEach((e=>{e.id&&(a["cid:"+e.id]=e)}));const o=(c=e.from,c&&c.length>0&&n.Z.isTrustedEmailAddress(c[0].address)),r=(0,T.Nw)(s?.content??"",{attachments:a,blockHTTPLeaks:!e.trusted&&!o}),{attachments:l,cidAttachments:d}=function(e){const t=[],s=[];return(0,A.yN)(e).forEach((e=>{if(e.inUse)s.push(e);else{const{id:s,inUse:n,...i}=e;t.push(i)}})),{attachments:t,cidAttachments:s}}(t);var c;return[r.sanitized,l,d]}():(i.forEach((e=>{e.id&&delete e.id})),[s?.content??"",i,[]])}function B(e){const t=(0,m.Z)(!0,e);return!t||"html"!==t.type}function F(e,t){const s=d.Z.get(Z.kMailDefaultAccount)||x.Y6,n=d.Z.get(Z.kMailLastSentFrom),i=f.Z.getAccountsAndAliases();let r,l,c;if(i.length>0){const l=o.Z.getSelectedFolder();if("account"===t){if(l?.accountId&&(r=i.find((e=>e.MAIL_EMAIL===l.accountId))),!r&&l?.accountId===x.Ry){const e=l?.path.split("/")[0];r=i.find((t=>t.MAIL_EMAIL===e))}}else if(e){const{from:s,to:n,cc:o}=e,d=s.map((e=>e.address)),c=n.map((e=>e.address)),h=o.map((e=>e.address));if("message"===t)d.length>0&&(r=i.find((e=>d.includes(e.MAIL_EMAIL))));else if(c.length>0||h.length>0){const e=c.concat(h),t=i.filter((t=>e.includes(t.MAIL_EMAIL)));r=t.find((e=>e.MAIL_EMAIL===l?.accountId))||t[0]}if(!r){const t=a.Z.getSourceFilters(e.id),s=new Set(t.map((e=>e.accountId)));r=i.find((e=>s.has(e.MAIL_EMAIL)))}}!r&&s===x.Y6&&n&&(r=i.find((e=>e.MAIL_EMAIL===n))),r||s===x.Y6||(r=i.find((e=>e.MAIL_EMAIL===s))),r||(r=i[0])}return r?(l=[{name:r.MAIL_NAME,address:r.MAIL_EMAIL}],c=(0,g.Z)(r.MAIL_EMAIL)):(l=[],c=(0,g.Z)()),{selectedAccount:r,from:l,messageId:c}}const W={closeComposer:function(e,t){const s=j(t);r.ZP.closeUrl(e,s)},createDraft:async function(e={}){const{selectedAccount:t,from:s,messageId:n}=F(void 0,"account"),{to:a,cc:o,bcc:r,subject:l="",body:d=""}=e;if(!t)return;const c={selectedAccount:t,messageId:n,subject:l,body:d,from:[...s],sentDate:Date.now(),to:a||[],cc:o||[],bcc:r||[],plaintext:!0,attachments:[],fromDraft:!1,replyScope:""};i.Z.set(c),await O()},createDraftFromParsedMessage:function(e){const{bodyParts:t=[]}=e,s=B(t),[n,a,o]=R(e),{selectedAccount:r,from:l,messageId:d}=F(e,"message"),{to:c,cc:h,bcc:u}=e,p={to:c,cc:h,bcc:u||[],sentDate:Date.now(),subject:L(e),plaintext:s,attachments:a,cidAttachments:o,body:n,focusOnBody:!0,selectedAccount:r,from:[...l],messageId:d,fromDraft:!1,replyScope:""};i.Z.set(p),O()},forward:async function(e){const{inReplyTo:t,references:s}=D(e),{bodyParts:n=[]}=e,a=B(n),[o,r,l]=R(e),d=function(e,t){const s=w()(e.sentDate).format("LLLL (Z)"),n=(0,S.Rz)(e.from),i=(0,S.Rz)(e.to),a=(0,S.Rz)(e.cc);let r=`\n\n----- ${(0,h.Z)("Forwarded message")} -----\n`;n&&(r+=(0,h.Z)("From: $1",[n])+"\n");i&&(r+=(0,h.Z)("To: $1",[i])+"\n");a&&(r+=(0,h.Z)("Cc: $1",[a])+"\n");e.subject&&(r+=(0,h.Z)("Subject: $1",[e.subject])+"\n");return r+=(0,h.Z)("Date: $1",[s])+"\n\n\n",(t?r:r.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>"))+o}(e,a),{selectedAccount:c,from:u,messageId:p}=F(e),g=Date.now(),m={selectedAccount:c,messageId:p,from:[...u],sentDate:g,threadKey:[g,e.id,g],to:[],cc:[],bcc:[],subject:L(e,"Fwd: "),plaintext:a,attachments:r,cidAttachments:l,body:d,inReplyTo:t,references:s,forwarded:e.id,fromDraft:!1,replyScope:""};i.Z.set(m),await O()},open:function(e,t){const s=M(e,t);i.Z.set(s),O(e.id)},prepareDraft:async function(e){const[t,s]=await Promise.all([v.Z.call(e),(0,b.Z)(e)]);if(!t||!s)return!1;const n=M(t,s.threadKey);return i.Z.set(n),!0},reply:async function(e){const t=_(e,"","sender");i.Z.set(t),await O()},replyToAll:async function(e){const t=_(e,"","all");i.Z.set(t),await O()},replyToList:async function(e){const t=_(e,"","list");i.Z.set(t),await O()},closeMailPages:function(){const e=I.xy.mailpage,t=l.ZP.filterPagesInAllWindows((t=>t.url.startsWith(e)));r.ZP.closePage(t)},createQuickReply:function(e,t,s){return _(e,t,s?"all":"sender")},getTo:E,getUniqueReceivers:N,getListPostAddress:k}},46382:(e,t,s)=>{"use strict";s.d(t,{Z:()=>w});var n=s(12442),i=s(59322),a=s(29087),o=s(33638),r=s(63153),l=s(15489),d=s(56371),c=s(2497),h=s(7064),u=s(1407),p=s(12964),g=s(89175),m=s(44850);const f="window.html";let v;function b(e){const{screen:t}=(0,c.Z)(e),s=Math.max(a.Z.get(g.kSettingsSizeWidth),u.MK),n=Math.max(a.Z.get(g.kSettingsSizeHeight),u.mR),i=a.Z.get(g.kSettingsSizeLeft),o=a.Z.get(g.kSettingsSizeTop),r=n<=t.height?n:t.height;let l=i>=0?i:t.availLeft+s/2,d=o>=0?o:t.availTop+(t.height-n)/2;d<0&&(d=0);l+s>t.availLeft+t.width&&(l=t.availLeft+(t.width-s),l<0&&(l=0));return{left:Math.round(l),top:Math.round(d),width:Math.round(s),height:Math.round(r)}}const C=new class{openGuestWindow(){h.Z.runtimePrivate.switchToGuestSession((e=>{e||console.warn("Guest mode is disabled.")}))}closeGuestSession(){h.Z.runtimePrivate.closeGuestSession((e=>{e||console.warn("Guest mode is disabled.")}))}managePeople(){return h.Z.runtimePrivate.openProfileSelectionWindow()}closeActiveProfile(){h.Z.runtimePrivate.closeActiveProfile((e=>{e||console.warn("Failed to open profile window.")}))}showAddFeed(e,t){o.Z.dispatch({actionType:"MAIN_SHOW_ADD_FEED",winId:e,options:t})}showAddMailFolder(e,t){o.Z.dispatch({actionType:"MAIN_SHOW_ADD_MAIL_FOLDER",winId:e,options:t})}showDeleteMailFolder(e,t){o.Z.dispatch({actionType:"MAIN_SHOW_DELETE_MAIL_FOLDER",winId:e,options:t})}showAddFeedFolder(e,t){o.Z.dispatch({actionType:"MAIN_SHOW_ADD_FEED_FOLDER",winId:e,options:t})}showDeleteFeedFolder(e,t){o.Z.dispatch({actionType:"MAIN_SHOW_DELETE_FEED_FOLDER",winId:e,options:t})}showDeleteWorkspace(e,t){o.Z.dispatch({actionType:"MAIN_SHOW_DELETE_WORKSPACE",winId:e,options:t})}showQuickCommand(e){o.Z.dispatch({actionType:"MAIN_SHOW_QUICKCOMMANDS",winId:e})}async showCalendar(e,t){try{const s=await i.ZP.openURL(e,"vivaldi://calendar",{singleton:!0});t&&n.Z.selectEvent(s.pageId,{eventId:t})}catch(e){console.error(e)}}showCalendarNotification(e,t){o.Z.dispatch({actionType:"MAIN_SHOW_CALENDAR_ALARM",winId:e,options:t})}showCalendarEditEvent(e,t){o.Z.dispatch({actionType:"MAIN_SHOW_CALENDAR_EDIT_EVENT",winId:e,options:{event:t}})}showEditEventTemplate(e,t){o.Z.dispatch({actionType:"MAIN_SHOW_CALENDAR_EDIT_TEMPLATE",winId:e,options:t})}showCalendarImportEvents(e,t){o.Z.dispatch({actionType:"MAIN_SHOW_CALENDAR_IMPORT_EVENTS_DIALOG",winId:e,options:{uri:t}})}showKeyboardShortcuts(e){o.Z.dispatch({actionType:"MAIN_SHOW_KEYBOARDS_SHORTCUTS",winId:e})}showPageAccessKeys(e){o.Z.dispatch({actionType:"MAIN_SHOW_PAGE_ACCESS_KEYS",winId:e})}showConfirmOpenLinksDialog(e,t){o.Z.dispatch({actionType:"MAIN_SHOW_CONFIRM_OPEN_LINKS_DIALOG",winId:e,options:t})}showConfirmCloseOtherTabsDialog(e,t){o.Z.dispatch({actionType:"MAIN_SHOW_CONFIRM_CLOSE_OTHER_TABS_DIALOG",winId:e,options:t})}showClearBrowsingHistoryDialog(e){o.Z.dispatch({actionType:"MAIN_SHOW_CLEAR_BROWSING_HISTORY_DIALOG",winId:e})}showModal(e,t){return new Promise((s=>o.Z.dispatch({actionType:"MAIN_SHOW_MODAL_DIALOG",winId:e,options:{...t,resolve:s}})))}showModalInfo(e,t){o.Z.dispatch({actionType:"MAIN_SHOW_MODAL_INFO",winId:e,options:t})}showImportDataDialog(e){o.Z.dispatch({actionType:"MAIN_SHOW_IMPORT_DATA_DIALOG",winId:e})}showMailInfoDialog(e){o.Z.dispatch({actionType:"MAIN_SHOW_MAIL_INFO_DIALOG",winId:e})}showBookmarkDialog(e,t){o.Z.dispatch({actionType:"MAIN_SHOW_BOOKMARK_DIALOG",winId:e,options:t})}showBookmarkAddedPopup(e,t){o.Z.dispatch({actionType:"MAIN_SHOW_BOOKMARK_ADDED_POPUP",winId:e,options:t})}showContextDialog(e,t,s){o.Z.dispatch({actionType:"MAIN_SHOW_CONTEXT_DIALOG",winId:e,options:{id:t,force:s??!1}})}async showMail(e){await i.ZP.openURL(e,m.jk.internals.mailpage,{singleton:!0})}showMailUnsubscribeDialog(e,t){const s={actionType:"MAIN_SHOW_MAIL_UNSUBSCRIBE_DIALOG",winId:e,options:t};o.Z.dispatch(s)}showMailAuthenticationDialog(e,t){const s={actionType:"MAIN_SHOW_MAIL_AUTHENTICATION_DIALOG",winId:e,options:t};o.Z.dispatch(s)}showMailDeleteDialogSetting(e,t){const s={actionType:"MAIN_SHOW_MAIL_DELETE_DIALOG_SETTING",winId:e,options:t};o.Z.dispatch(s)}showMailDeleteDialogFolders(e,t){const s={actionType:"MAIN_SHOW_MAIL_DELETE_DIALOG_FOLDERS",winId:e,options:t};o.Z.dispatch(s)}showMailDeleteDialogAccounts(e,t){const s={actionType:"MAIN_SHOW_MAIL_DELETE_DIALOG_ACCOUNTS",winId:e,options:t};o.Z.dispatch(s)}showMailDeleteDialogConfirmAll(e,t){const s={actionType:"MAIN_SHOW_MAIL_DELETE_DIALOG_CONFIRM_ALL",winId:e,options:t};o.Z.dispatch(s)}showSaveSessionDialog(e,t){o.Z.dispatch({actionType:"MAIN_SHOW_SAVE_SESSION_DIALOG",winId:e,options:t})}showOpenSessionDialog(e){o.Z.dispatch({actionType:"MAIN_SHOW_OPEN_SESSION_DIALOG",winId:e})}showDialog(e,t,s){const n={actionType:"MAIN_SHOW_DIALOG",winId:e,options:t,onAfterClose:s};o.Z.dispatch(n)}async showExtensions(e){await i.ZP.openURL(e,"vivaldi://extensions",{singleton:!0})}async showHistory(e){await i.ZP.openURL(e,"vivaldi://history",{singleton:!0})}async showNotes(e){await i.ZP.openURL(e,"vivaldi://notes",{singleton:!0})}async showBookmarks(e,t=""){await i.ZP.openURL(e,`vivaldi://bookmarks/${t}`,{singleton:!0})}async showWelcome(e){await i.ZP.openURL(e,"vivaldi://welcome")}async showSettings(e,t="general",s,n=!1){const o=s&&!(0,p.Z)(s)?Object.keys(s).map((e=>`${e}=${s[e]??""}`)).join("&"):"";if(a.Z.get(g.kSettingsInTab)&&!n)await i.ZP.openURL(e,`vivaldi://settings/${t}/?${o}`,{singleton:!0,skipParams:!0});else{l.ZP.settingsCategory=`${t}&${o}`;const s={bounds:b(e),windowKey:"settings"};await r.Z.openWindow(e,f,"settings",s)}}showAccountSheet(e,t="login"){const s={actionType:"MAIN_SHOW_ACCOUNT_SHEET",winId:e,options:t};o.Z.dispatch(s)}showAddCustomLabel(e){o.Z.dispatch({actionType:"MAIN_SHOW_CREATE_LABEL",winId:e})}showCustomLabelDialog(e){o.Z.dispatch({actionType:"MAIN_SHOW_LABEL_FLAG_DIALOG",winId:e})}showShareVivaldiDialog(e){o.Z.dispatch({actionType:"MAIN_SHOW_SHARE_VIVALDI_DIALOG",winId:e})}showDeleteCustomLabelConfirmation(e,t,s){o.Z.dispatch({actionType:"MAIN_SHOW_DELETE_LABEL_CONFIRMATION",winId:e,options:{label:t,callback:s}})}showDeleteFilterConfirmation(e,t,s){o.Z.dispatch({actionType:"MAIN_SHOW_DELETE_FILTER_CONFIRMATION",winId:e,options:{label:t,callback:s}})}showDeleteFeedConfirmation(e,t,s){o.Z.dispatch({actionType:"MAIN_SHOW_DELETE_FEED_CONFIRMATION",winId:e,options:{label:t,callback:s}})}showMailFilterViewConfirmation(e,t,s){o.Z.dispatch({actionType:"MAIN_SHOW_MAIL_VIEW_FILTER_CONFIRMATION",winId:e,options:{label:t,callback:s}})}showMailUploadConfirmation(e,t,s){o.Z.dispatch({actionType:"MAIN_SHOW_MAIL_UPLOAD_CONFIRMATION",winId:e,options:{accountId:t,callback:s}})}showMessageMoveConfirmation(e,t,s,n){o.Z.dispatch({actionType:"MAIN_SHOW_MAIL_MESSAGE_MOVE_CONFIRMATION",winId:e,options:{callback:t,title:s,body:n}})}showCreateArchiveFolderConfirmation(e,t,s,n){o.Z.dispatch({actionType:"MAIN_SHOW_MAIL_CREATE_ARCHIVE_FOLDER_CONFIRMATION",winId:e,options:{callback:t,title:s,body:n}})}showMailAccountDialog(e){const t={actionType:"MAIN_SHOW_MAIL_ACCOUNT_DIALOG",winId:e};o.Z.dispatch(t)}showCalendarAccountDialog(e){const t={actionType:"MAIN_SHOW_CALENDAR_ACCOUNT_DIALOG",winId:e};o.Z.dispatch(t)}showCreateCalendarDialog(e){o.Z.dispatch({actionType:"MAIN_SHOW_CREATE_CALENDAR_DIALOG",winId:e})}updateToolbarSpacer(e){o.Z.dispatch({actionType:"MAIN_TOOLBAR_SPACER_UPDATE",winId:e})}showResetToolbarConfirmation(e,t,s,n){o.Z.dispatch({actionType:"MAIN_SHOW_TOOLBAR_RESET",winId:e,options:{callback:t,title:s,body:n}})}showPrivacyStatsDialog(e){o.Z.dispatch({actionType:"MAIN_SHOW_PRIVACY_STATS",winId:e})}showWorkspaceDialog(e,t){o.Z.dispatch({actionType:"MAIN_SHOW_WORKSPACE_DIALOG",winId:e,options:t||{createInBackground:!1,withPages:void 0}})}showNoteSelectionDialog(e,t){o.Z.dispatch({actionType:"MAIN_SHOW_NOTE_SELECTION_DIALOG",winId:e,options:t})}showEnableWorkspaceDialog(e,t){o.Z.dispatch({actionType:"MAIN_SHOW_ENABLE_WORKSPACE_DIALOG",winId:e,options:t})}showIncludeWorkspaceDialog(e,t){o.Z.dispatch({actionType:"MAIN_SHOW_INCLUDE_WORKSPACE_DIALOG",winId:e,options:t})}showEnableSessionAutosaveDialog(e,t){o.Z.dispatch({actionType:"MAIN_SHOW_ENABLE_SESSION_AUTOSAVE_DIALOG",winId:e,options:t})}async openNewPopAsTabOrWindow(e,t,s){if(a.Z.get(g.kPopupsShowInTab))t.window.accept(e+";1");else{const n={bounds:{left:t.initialLeft,top:t.initialTop,width:t.initialWidth,height:t.initialHeight},incognito:s},a=await r.Z.openWindow(e,f,"popup",n);t.window?t.window.accept(a+";1"):i.ZP.openURL(a,t.targetUrl)}}startCasting(e){h.Z.utilities.startChromecast(e)}setPaneFocus(e,t){o.Z.dispatch({actionType:"MAIN_SELECTING_TOOLBAR",winId:e,options:{enable:t}})}stepFocus(e,t){const n=e.vivaldiWindowId,{document:a,HTMLElement:o}=e;i.ZP.clearSelection(n);const r=function(e,t){return Array.from(a.querySelectorAll(e)).map((e=>{const t=e.getBoundingClientRect(),s=function(e){let t=0,s=0;for(;e instanceof o&&(t+=e.offsetTop,s+=e.offsetLeft,e.offsetParent);)e=e.offsetParent;return{left:s,top:t}}(e);return{elm:e,rect:{left:s.left,top:s.top,width:t.width,height:t.height}}})).sort(((e,s)=>t?e.rect.left<s.rect.left?-1:e.rect.left>s.rect.left?1:e.rect.top<s.rect.top?-1:e.rect.top>s.rect.top?1:0:e.rect.top<s.rect.top?-1:e.rect.top>s.rect.top?1:e.rect.left<s.rect.left?-1:e.rect.left>s.rect.left?1:0))},l=function(e,t){const s=t.children;let n=!1;for(let t=0;t<s.length;t++){if(s[t]===e)return!0;if(l(e,s[t])){n=!0;break}}return n},d=r(".pagefocusstop",!0),c=r(".uifocusstop",!1).concat(d);if(c.length>0){let o=-1;const r=a.activeElement;for(let e=0;e<c.length;e++)if(c[e].elm===r||l(r,c[e].elm)){o=e;break}o=-1===o?t?0:c.length-1:t?o+1<c.length?o+1:0:0===o?c.length-1:o-1;if(-1!==d.findIndex((e=>e===c[o]))){const t=parseInt(c[o].elm.getAttribute("data-id"));i.ZP.activateTab(t,n),s(47995).Z.executeActions("event",e,"COMMAND_FOCUS_WEBVIEW"),v=setTimeout((()=>C.setPaneFocus(n,!1)),1e3)}else c[o].elm.focus(),v&&clearTimeout(v);C.setPaneFocus(n,!0)}}async showLargeAttachmentWarning(e,t){const{action:s}=await C.showModal(l.ZP.getMailWindowId(),{modal:{title:(0,d.Z)("A large file is being attached"),body:(0,d.Z)(`Sending a message with a large attachment may fail: file: "${e}" size: ${Number(t/1e6).toFixed(1)}MB`),actions:[{title:"Do not attach",action:"cancel",default:!0}],cancelAction:{title:(0,d.Z)("mail","Attach anyway"),action:"continue"}}});return s}},w=C},8074:(e,t,s)=>{"use strict";s.d(t,{Z:()=>i});var n=s(33638);const i=new class{setNavigationState(e,t,s,i){n.Z.dispatch({actionType:"NAVIGATION_SET_STATE",pageId:e,windowId:t,navigationState:s,isUrlFieldFocused:i})}setSSLState(e,t){n.Z.dispatch({actionType:"PAGE_SET_SSL_STATE",pageId:e,info:t})}addBlockedPopupEvent(e,t){n.Z.dispatch({actionType:"NAVIGATION_ADD_POPUP",pageId:e,popupEvent:t})}removeBlockedPopup(e,t){n.Z.dispatch({actionType:"NAVIGATION_REMOVE_POPUP",pageId:e,targetUrl:t})}resetBlockedPopups(e){n.Z.dispatch({actionType:"NAVIGATION_RESET_BLOCKED_POPUPS",pageId:e})}setPermission(e,t,s,i,a,o,r){n.Z.dispatch({actionType:"NAVIGATION_SET_PERMISSION",pageId:e,origin:t,permission:s,requestEvent:i,state:a,promptPermission:o,suppressedPrompt:r})}resetPermissions(e){n.Z.dispatch({actionType:"NAVIGATION_RESET_PERMISSIONS",pageId:e})}setPageHasBlockedContent(e,t){n.Z.dispatch({actionType:"NAVIGATION_SET_BLOCKED_CONTENT",pageId:e,contentType:t})}resetPageHasBlockedContent(e){n.Z.dispatch({actionType:"NAVIGATION_RESET_BLOCKED_CONTENT",pageId:e})}}},21838:(e,t,s)=>{"use strict";s.d(t,{Z:()=>M});var n=s(30626),i=s(62882),a=s(59322),o=s(96951),r=s(18350),l=s(15285),d=s(29087),c=s(60331),h=s(33638),u=s(15489),p=s(56371),g=s(92292),m=s(25372),f=s(7064),v=s(89175),b=s(8684),C=s(44850);let w=!0,y=!1;function x(e){const t=(0,m.Z)(e);return t?t.hostname+t.pathname:e}function I(){w=!0}function A(){w=!1,S()}async function S(){const e=await f.Z.notes.getTree();h.Z.dispatch({actionType:"NOTES_INIT",notes:e})}function Z(e,t){if(w)return;if(h.Z.dispatch({actionType:"NOTES_ADD_ITEM",id:e,item:t}),u.ZP.getActiveWindowId()===u.Ex||"note"!==t.type)return;const s=u.ZP.getLastActiveBrowserWindowId(),n=o.ZP.getActivePage(s);n&&C.jk.getDisplayUrlFromMapping(n.url).startsWith("vivaldi://notes")||(d.Z.get(v.kNotesCreationNotify)&&!l.ZP.getIsVisible(s,"PanelNotes")&&(0,b.c)({title:(0,p.Z)("New Note Created"),onClick:()=>r.Z.showContent(s,"PanelNotes",{setFocus:!0,selectId:e,reason:""}),timeout:3e4,tag:"VIVALDI_NOTES_NEW_CREATED"}),d.Z.get(v.kNotesCreationShowPanel)&&r.Z.showContent(s,"PanelNotes"))}function T(e,t){w||h.Z.dispatch({actionType:"NOTES_MOVE_ITEM",id:e,targetFolder:t.parentId,targetIndex:t.index})}function E(e,t){w||(h.Z.dispatch({actionType:"NOTES_CHANGE_ITEM",id:e,changes:t}),y&&(y=!1,c.Z.setStatus(u.ZP.getActiveWindowId(),(0,p.Z)("Text has been appended to note."),5e3)))}function k(e){w||h.Z.dispatch({actionType:"NOTES_REMOVE_ITEM",id:e})}const N={scale:1,width:0,height:0};async function _({id:e,dataURL:t,title:s,url:n}){if(!t)throw new Error("Missing dataURL parameter");const a=i.ZP.getNodeById(e);if(!a||"note"!==a.type)throw new Error("Not a valid node for attachments");const o=t.indexOf(",");if(-1===o)throw new Error("data url is lacking a comma");const r=t.slice(o+1);n&&await f.Z.notes.update(e,{url:n}),await f.Z.notes.create({parentId:e,content:r,url:n,title:s,type:"attachment"})}function P(e){return new Promise(((t,s)=>{const n=new FileReader;n.onloadend=({target:e})=>{t(e.result)},n.onerror=()=>{n.abort(),s()},n.readAsDataURL(e)}))}const M={loadPromise:async function(){await S(),w=!1,f.Z.notes.onImportBegan.addListener(I),f.Z.notes.onImportEnded.addListener(A),f.Z.notes.onCreated.addListener(Z),f.Z.notes.onMoved.addListener(T),f.Z.notes.onChanged.addListener(E),f.Z.notes.onRemoved.addListener(k)},emptyTrash:function(){return new Promise(((e,t)=>{f.Z.notes.emptyTrash((s=>{!1===s&&(console.warn("Empty trash failed."),t("Empty trash failed.")),e()}))}))},addScreenshotToNote:function(e,t,s){const n=o.ZP.getActivePage(e)?.url??"";_({id:t,url:n,dataURL:s,title:(0,p.Z)("Capture: $1",x(n))})},addFile:async function(e,t){return _({id:e,dataURL:await P(t),title:t.name})},appendToNode:async function(e,t){const s=i.ZP.getNodeById(e);if(0===t.trim().length||!s)return;const n=`${s.content??""}\r\n${t}`;y=!0;try{await f.Z.notes.update(e,{content:n})}catch{y=!1}},createNoteFromCapture:async function(e,t){if(!t)throw new Error("Missing capture content");const s=o.ZP.getActivePage(e)?.url??"",n=await f.Z.notes.create({type:"note",url:s}),i=l.ZP.hasPanel(e,"PanelNotes");if(n)if(await _({id:n.id,dataURL:t,url:s,title:(0,p.Z)("Capture: $1",[x(s)])}),i){const t={selectId:n.id,setFocus:!0,reason:""};r.Z.showContent(e,"PanelNotes",t)}else{const t=C.jk.internalUrl("notes",n.id);a.ZP.openURL(e,t,{inCurrent:!1})}},readFileAsDataURL:P,createNotesFromTreeNodes:async function e(t,s="",n){return Promise.all(t.map((async(t,a)=>{const o=n?n+a:void 0;if("separator"===t.type){return await f.Z.notes.create({index:o,parentId:s,type:"separator"})}const r=await f.Z.notes.create({parentId:s,index:o,type:i.ZP.isFolder(t)?"folder":t.type,content:t.content,title:t.title,url:t.url});return t.children&&(r.children=await e(t.children,r.id,0)),r})))},createNote:async function(e,t,s=!0){const{content:i,url:a}=t,o=await f.Z.notes.create({type:"note",content:i,url:a});return a&&d.Z.get(v.kNotesCreationAddScreenshot)&&s?async function(e,t){const s=n.Z.getActiveWebView(e);if(!s)return;const i=["richtexteditor","markdowneditor"].includes(s.name)||"data:text/html,<html/>"===s.src?void 0:s.src,a=await function(e,t=N){return new Promise(((s,n)=>{e.getThumbnail(t,(e=>{g.Z.runtime.lastError&&n(g.Z.runtime.lastError.message),s(e)}))}))}(s);return _({id:t,url:i,dataURL:a,title:(0,p.Z)("Screenshot: $1",x(i??""))})}(e,o.id):o},removeNode:async function(e){await f.Z.notes.remove(e)},setCutIds:function(e){h.Z.dispatch({actionType:"NOTES_SET_CUT_IDS",ids:e})},setClipboard:function({clipboardData:e},t,s){if(!e)return;const n=t.map((e=>e.id));let a="";!function e(t){for(const s of t){const{content:t,url:n}=s;a+=[t,n].filter(Boolean).join("\n")+"\n\n",i.ZP.isFolder(s)&&s.children&&e(s.children)}}(t),e.setData("vivaldi/x-cut",s?"true":"false"),e.setData(i.d0,JSON.stringify(n)),e.setData("text/plain",a)}}},33499:(e,t,s)=>{"use strict";function n(e){return Math.floor((e-1)/2)}s.d(t,{ZP:()=>_,y6:()=>Z});const i=class{#s=[];constructor(e){this.comparator=e}_swap(e,t){const s=this.#s[e];this.#s[e]=this.#s[t],this.#s[t]=s}_heapify(e){const t=2*e+1;if(t>=this.#s.length)return;const s=t+1;let n=e;this.comparator(this.#s[t],this.#s[n])&&(n=t),s<this.#s.length&&this.comparator(this.#s[s],this.#s[n])&&(n=s),n!==e&&(this._swap(e,n),this._heapify(n))}peek(){return this.#s[0]}push(...e){e.forEach((e=>{let t=this.#s.length;this.#s.push(e);let s=n(t);for(;s>=0&&this.comparator(this.#s[t],this.#s[s]);)this._swap(s,t),t=s,s=n(s)}))}pop(){const e=this.#s.shift();return this._heapify(0),e}clear(){this.#s=[]}get size(){return this.#s.length}};var a=s(50522),o=s(46382),r=s(24367),l=s(68247),d=s(29087),c=s(33638),h=s(63153),u=s(15489),p=s(45660),g=s(30381),m=s.n(g),f=s(7064),v=s(24522),b=s(25765),C=s(47543),w=s(58821),y=s(89175),x=s(8684),I=s(34155);const A=5*v.hd,S=20*v.QI;function Z(e,t){let s="LT";return t?s="L":e.isSame(Date.now(),"day")||(s="L LT"),s}const T=(e,t)=>e.alarmTime<t.alarmTime;function E(e,t){const{id:s,event_id:n,when:i}=e,o=t??(n&&a.Z.getEvent(n));if(!o)return p.Z.warn("Calendar",["reminders"],"Can not create alarms, event not found",e),void f.Z.calendar.deleteNotification(s);if(o.trash||o.task&&o.complete)return;const r=Date.now(),l=Math.max(d.Z.get(y.kCalendarLastNotificationTime)??0,r-v.hd);let c=0,h=0;if(e.period){const t=r+v.QI;if(i>l&&i<=t)return{alarmTime:i,notification:e,eventTime:(0,w.oJ)(o)}}else if(o.rrule){const{rrule:e}=o,t=parseInt(n?.split(":")[1]),s=new Set((o.recurrenceExceptions??[]).map((e=>e.date))),a=l+i+1e3,d=r+i+v.QI;c=(0,C.YE)(e,{from:a,to:d,eventStart:o.start,timezone:o.timezone}).map((e=>e.valueOf())).filter((e=>!t||e+i===t)).filter((e=>!s.has(e))).map((e=>e-i)).sort(((e,t)=>t-e))[0],h=c+i}else{const e=r+v.QI,t=(0,w.oJ)(o)-i;t>=l&&t<=e&&(c=t)}return c?{alarmTime:c,notification:e,eventTime:h||(0,w.oJ)(o)}:void 0}async function k(e){const t=Date.now();e.timeoutId&&clearTimeout(e.timeoutId);const s=v.lb-(t+1)%v.lb;e.timeoutId=setTimeout(k,s,e),!e.alarms.size&&t>=e.nextBuildAlarms&&(N.updateAllAlarms(),e.nextBuildAlarms=(0,w.zX)(t));const n=d.Z.get(y.kCalendarNotificationType);if("none"===n)return;const i=e.alarms.peek();if(i&&!(i.alarmTime>t))try{const s=u.ZP.getLastActiveBrowserWindowId();for(;(e.alarms.peek()?.alarmTime??1/0)<=t;){const t=e.alarms.pop();t&&N.showNotification(t,n,s)}}catch(e){console.error("checkAlarms: Failed to retrive window id",e)}}const N=new class{#n={alarms:new i(T),nextBuildAlarms:0};loadNotifications=async()=>{const e=await f.Z.calendar.getAllNotifications();c.Z.dispatch({actionType:"NOTIFICATIONS_INIT",notifications:e})};deleteAlarmsForNotification(e){const t=new i(T);for(;this.#n.alarms.size;){const s=this.#n.alarms.pop();s&&s.notification.id!==e&&t.push(s)}this.#n.alarms=t}deleteNotification(e){const{id:t,event_id:s}=e;s&&(f.Z.calendar.deleteNotification(t),this.deleteAlarmsForNotification(t))}async createNotification(e,t){e.event_id&&(e.event_id=e.event_id.split(":")[0]);const s=await f.Z.calendar.createNotification(e);if(s.event_id){const e=E(s,t);e&&this.#n.alarms.push(e)}return s}snooze(e,t){const{id:s,delay:n,eventTime:i,title:a,allDay:o,...r}=e;r.when=Date.now()+t*v.lb,r.period=e.eventTime,this.createNotification(r)}async updateNotification(e,t){let{id:s,event_id:n,...i}=e;n&&(n=n.split(":")[0]);const a=await f.Z.calendar.updateNotification(s,i);if(a.event_id){this.deleteAlarmsForNotification(s);const e=E(a,t);e&&this.#n.alarms.push(e)}}updateAlarmsForEvent(e){c.Z.dispatch({actionType:"NOTIFICATIONS_FOR_EVENT",event:e}),(e.notifications??[]).forEach((t=>this.updateAlarmsForNotification(t,e)))}updateAlarmsForNotification(e,t){this.deleteAlarmsForNotification(e.id);const s=E(e,t);s&&this.#n.alarms.push(s)}async updateAllAlarms(){this.#n.alarms.clear();const e=await f.Z.calendar.getAllNotifications();for(const t of e){const e=E(t);e&&this.#n.alarms.push(e)}}startAPIChangeListeners(){r.Z.isCalendarOn&&(f.Z.calendar.onNotificationChanged.addListener(N.loadNotifications),this.#n.alarms.clear(),this.#n.nextBuildAlarms=Date.now(),this.#n.timeoutId&&clearTimeout(this.#n.timeoutId),this.#n.timeoutId=setTimeout(k,5e3,this.#n))}stopAPIChangeListeners(){f.Z.calendar.onNotificationChanged.removeListener(N.loadNotifications),this.#n.timeoutId&&(clearTimeout(this.#n.timeoutId),delete this.#n.timeoutId)}async showNotification(e,t,s){const{notification:n,eventTime:i}=e,r=a.Z.getEvent(n.event_id||"");if(!r)return;if(d.Z.get(y.kCalendarHiddenHidesNotifications)){if(a.Z.getCalendars().find((e=>e.id===r.calendarId))?.hidden)return}const c=r.title||n.name||b.gT;if("system"===t){const e=m()(i),t=Z(e,r.allDay??!1),n=e.format(t);(0,x.c)({title:`${n} - ${c}`,onClick:()=>{o.Z.showCalendar(s,r.id)},timeout:r.task?A:S,tag:`VIVALDI_CALENDAR_EVENT_ID_${r.id}`})}else{let e;const a="dialog"!==t&&d.Z.get(y.kCalendarNotificationFullscreen);if(a){const t=u.ZP.getWindowState(s);"normal"!==t?.state&&"minimized"!==t?.state||(h.Z.setFullscreen(s),e=s,await new Promise(I.nextTick))}const l={reminder:{...n,eventTime:i,allDay:r.allDay??!1,title:c},fullscreen:a,windowToRestore:e};o.Z.showCalendarNotification(s,l)}const p=d.Z.get(y.kCalendarNotificationSound);if(p){const e=new Audio(p);e.volume=d.Z.get(y.kCalendarNotificationVolume)/100,e.play()}l.Z.set(y.kCalendarLastNotificationTime,Date.now()),n.period&&f.Z.calendar.deleteNotification(n.id)}},_=N},59322:(e,t,s)=>{"use strict";s.d(t,{ZP:()=>Fe,nq:()=>Se});var n=s(7065),i=s(19789),a=s(46382),o=s(33638);var r=s(7168),l=s(8074),d=s(96951),c=s(17434),h=s(14481),u=s(68247),p=s(29087),g=s(18237),m=s(14022),f=s(70864),v=s(63153),b=s(15489),C=s(29104),w=s(53454),y=s(92292),x=s(2497),I=s(71193),A=s(84847),S=s(4027),Z=s(7064),T=s(1407),E=s(44850),k=s(35369),N=s(69046),_=s(751),P=s(82786),M=s(16152),D=s(42941),O=s(42578),j=s(36436),L=s(58821),R=s(89175),B=s(721),F=s(14789),W=s(80419),U=s(37441),V=s(34155);let H=0;async function G(){const e=b.ZP.getLastActiveBrowserWindowId();if(e===b.Ex)return void console.warn("showWhatsNewTab: Expected a valid windowId");if(b.ZP.isIncognitoOrGuest(e))return;const t=await async function(e){return(await y.Z.windows.getAll({populate:!0})).some((t=>t.tabs?.some((t=>t.url===e||t.pendingUrl===e))))}(E.xy.welcome),s=await Z.Z.utilities.canShowWhatsNewPage();if(!s.show)return;if(s.firstrun)return;const{vivaldiVersion:n}=Z.Z.utilities.getVersion();return $(e,"https://vivaldi.com/newfeatures?hl="+i.ZP.UI_LANGUAGE+"&version="+n+"&os=W",{inCurrent:!1,inBackground:t})}const K=(0,M.Z)((()=>{const e=new Date;let t=p.Z.get(R.kStartupActiveDays);t.length>0&&(0,L.KC)(e,new Date(t[t.length-1]))||(t=t.filter((t=>e-t<12096e5)),t.push(e.getTime()),u.Z.set(R.kStartupActiveDays,t))}),1e4),z=(0,M.Z)((e=>{const{toStart:t,windowId:s}=e,n=d.ZP.getActivePage(s);if(!n)return;const i=d.ZP.getSelectionOrActivePage(s),a=(0,N.av)(n),o=d.ZP.getPages(s);if(a){const e=o.flatMap(((e,t)=>(0,N.av)(e)===a?[t]:[])),r=i.filter((e=>(0,N.av)(e)===a)),l=t?e.get(0):e.get(e.size-1);"number"==typeof l&&Be.moveDroppedTabs(s,r,n.id,l,a)}else{const e=t?0:o.size-1;if(i.isEmpty())return;Be.moveDroppedTabs(s,i,n.id,e,void 0)}}),50);async function $(e,t="",s={}){K();const n=(0,E.Gr)(t),i=n&&"_blank"!==n?n:d.ZP.getDefaultStartpage(e);if(!b.ZP.getWindowState(e))return Promise.reject("Unknown window");if(b.ZP.isSettings(e)&&!0!==s.inNewWindow){let t=b.ZP.getLastActiveBrowserWindowId();if(t!==b.Ex&&b.ZP.isGuest()&&(t=b.Ex),t===b.Ex){const e=b.ZP.getIds("normal").filter((e=>!b.ZP.isGuest()));e.length>0&&(t=e[0])}t===b.Ex?(e=b.Ex,s.inNewWindow=!0,s.inBackground=!1):(e=t,s.inNewWindow=!1,s.inCurrent=!1)}if(b.ZP.isGuest()&&(0,E.YC)(i))return Promise.reject("Illegal URL for Guest mode");if(b.ZP.isIncognito(e)&&(0,E.CS)(i)){const t=b.ZP.getIds("normal").filter((e=>!b.ZP.isIncognitoOrGuest(e)));s.incognito=!1,t.length>0?e=t[0]:s.inNewWindow=!0}if(b.ZP.isPopup(e)&&(s.inNewWindow=!0,s.inBackground=!1),s.inNewWindow)return v.Z.openBrowserWindow(e,i,{incognito:s.incognito,transition:s.transition,fromUrlField:s.fromUrlField}).then((e=>{if(e&&e.tabs&&e.tabs.length>0){const t=e.tabs[0];return{windowId:parseInt(e.id),pageId:parseInt(t.id)}}return{windowId:-1,pageId:-1}}));let a="";if(s.contentType&&(a="Content-Type: "+s.contentType+"\r\n\r\n",console.assert(s.postParams)),s.singleton){const t=d.ZP.getPages(e).find((e=>(0,j.uu)(i,e.url,s.skipParams)));if(t){if(!s.inBackground){const s=d.ZP.getActiveWorkspace(e);(0,N.cm)(t)!==s&&await(0,U.V)(t.id,{workspaceId:s}),(0,E.Z7)(i)&&o.Z.dispatch({actionType:"PAGE_OPEN_URL",windowId:e,pageId:t.id,url:i}),o.Z.dispatch({actionType:"PAGE_OPEN",windowId:e,pageId:t.id})}return Promise.resolve({windowId:e,pageId:t.id})}}const r=s.inSpecificPageId?d.ZP.getPageInWindow(e,s.inSpecificPageId):d.ZP.getActivePage(e);if((s.inCurrent||s.inSpecificPageId)&&r&&!b.ZP.isPopup(e)){const t=r.vivExtData.ext_id;return h.Z.destroyPeriodicAlarm({ids:[t],from:"tab"}),o.Z.dispatch({actionType:"PAGE_OPEN_URL",pageId:r.id,windowId:e,url:i,postParams:s.postParams,headers:a,transition:s.transition,fromUrlField:s.fromUrlField,bookmarkId:s.bookmarkId}),Promise.resolve({windowId:e,pageId:r.id})}const l={url:s.postParams?T.f4:i,windowId:e,active:!s.inBackground,transition:s.transition,fromUrlField:s.fromUrlField,openerTabId:s.addOpenerTabId&&r&&!(0,E.$0)(r.url)?r.id:void 0};s.groupId&&(l.vivExtData=JSON.stringify({group:s.groupId,fixedGroupTitle:s.fixedGroupTitle}),l.pinned=d.ZP.isPinnedGroup(s.groupId,e));const c=(await y.Z.tabs.create(l)).id;return void 0===c?Promise.reject("Failed to create tab"):(s.postParams&&V.nextTick((()=>{o.Z.dispatch({actionType:"PAGE_OPEN_URL",pageId:c,windowId:e,url:i,postParams:s.postParams,headers:a,transition:s.transition,fromUrlField:s.fromUrlField,bookmarkId:s.bookmarkId})})),s.inBackground||await function(e,t){return new Promise((s=>{y.Z.windows.update(e,t,s)}))}(e,{focused:!0}),{windowId:e,pageId:c})}function Y(e,t,s){if(c.Z.offerUpdatedTab(s))return;const n=s.windowId;if(s.url&&!(0,E.$0)(s.url)&&c.Z.closeAssociatedTabs(e),"complete"===t.status&&(t.title=s.title),o.Z.dispatch({actionType:"CHROME_TABS_UPDATED",tabId:e,windowId:n,changeInfo:t}),p.Z.get(R.kWorkspacesEnabled)&&t.url&&t.vivExtData&&"loading"===t.status){const i=JSON.parse(t.vivExtData).workspaceId,a=d.ZP.getActiveWorkspace(n),o=b.ZP.getActiveWindowId();o!==n?i===a?v.Z.focus(n).then((()=>Be.activateTab(e,n))):Ee(o,i).then((()=>Be.activateTab(e,o))).catch((()=>{Ee(n,i),Be.activateTab(e,n)})):s.active&&i!==a&&X(n,a).then((()=>Ee(n,i)))}}function X(e,t){if(d.ZP.getPages(e,{workspaceId:t}).isEmpty()){const s=d.ZP.getActiveWorkspace(e)!==t;return Be.openURL(e,"",{inBackground:s})}return Promise.resolve()}function Q(e){return e.some((e=>e.active))?(0,d.yz)(e)?.id:void 0}function q(e,t,s){(class{static setMediaState(e,t){o.Z.dispatch({actionType:"PAGE_SET_MEDIASTATE",tabId:e,mediastate:t})}}).setMediaState(e,s)}function J(e,t,s,n){let i="undecided";switch(n){case"allow":i="allowed";break;case"block":i="blocked";break;default:i="undecided"}let a=null;try{a=new URL(s)}catch(e){return}l.Z.setPermission(e,a.origin,t,null,i)}function ee(e,t,s){o.Z.dispatch({actionType:"VIVALDI_TABS_UPDATED",pageId:e,windowId:t,tabInfo:s})}function te(e){o.Z.dispatch({actionType:"VIVALDI_TABRESOURCE_INFO_UPDATED",memoryInfo:e})}async function se(e,t){if(!b.ZP.getWindowState(e))return;const s=d.ZP.getPageInWindow(e,t),n=s?(0,N.cm)(s):void 0;n!==d.ZP.getActiveWorkspace(e)&&await Ee(e,n);const i=d.ZP.getActivePage(e);i&&i.id===t||fe(t,e)}function ne(e,t){if(c.Z.eraseTabId(e,t.parentTabId))return;Z.Z.utilities.cleanUnusedImages(50);const s={actionType:"CHROME_TABS_REMOVED",tabId:e,removeInfo:t};o.Z.dispatch(s)}function ie(e,t){const s=f.Z.findPanelByTabId(t);if(s){f.Z.replaceTabId(e,t);const n=s.lastIndexOf("_"),i=s.substring(0,n),a=s.substring(n+1),r={actionType:"PANEL_TAB_REPLACED",addedTabId:e,removedTabId:t,panelId:i,windowId:Number(a)};return void o.Z.dispatch(r)}const n={actionType:"CHROME_TABS_REPLACED",addedTabId:e,removedTabId:t};o.Z.dispatch(n)}let ae=Promise.resolve();function oe(){return"off"!==p.Z.get(R.kTabsStackingMode)}function re(e){if(c.Z.offerNewTab(e))return;const t=n.ZP.tabToPage(e),{openerTabId:s,windowId:i}=t,a=d.ZP.getActivePage(i),r=d.ZP.getActiveWorkspace(i),l={ext_id:(0,N._o)(t)||crypto.randomUUID()},h=[...d.ZP.getPageHistory(i)];t.active?(0,F.AL)(h,t.id):(0,F.EQ)(h,t.id);const u=t.index;if(!be&&!t.pinned){const s=e.vivExtData?.includes("ext_id")??!1;(!s||s&&r!==(0,N.cm)(t))&&(t.index=function(e,t,s){const{windowId:n}=e,i=d.ZP.getPages(n),a=s?"alwayslast":p.Z.get(R.kTabsNewPlacement),o="number"==typeof e.openerTabId?d.ZP.getPageById(e.openerTabId):null;let r;switch(r=s?void 0:o?(0,N.av)(o):(0,N.av)(e),a){case"openintabstackwithrelated":case"rightofcurrent":{if("number"!=typeof e.openerTabId)return r&&d.ZP.isGroup(r,n)?d.ZP.getGroup(r,n).last().index+1:e.index;if(o?.pinned)return d.ZP.getPinnedCount(o.windowId);const t=t=>t.id!==e.openerTabId&&t.openerTabId!==e.openerTabId,s=i.skipWhile(t).takeUntil(t).last();return s?s.index+1:e.index}case"alwayslast":{if(r&&p.Z.get(R.kTabsStackingOpenInCurrent)&&d.ZP.isGroup(r,n))return d.ZP.getGroup(r,n).last().index+1;const e=i.last();if(e)return e.index+1}}if(!t)return e.index;const l=(0,N.av)(t);if(r&&r!==l&&d.ZP.isGroup(l,t.windowId))return d.ZP.getGroup(l,t.windowId).last().index+1;return t.pinned?d.ZP.getPinnedCount(t.windowId):t.index+1}(t,a,s))}let f,v=t.pinned;if("number"==typeof s&&oe()){const e=d.ZP.getPageById(s);if(e){const t="openintabstackwithrelated"===p.Z.get(R.kTabsNewPlacement)&&!(0,E.pM)(e.url)&&!e.pinned;if(t||p.Z.get(R.kTabsStackingOpenInCurrent)){let n=(0,N.av)(e);if(!n&&t&&(n=d.ZP.getNewGroupId(),f=s),n){v=d.ZP.isPinnedGroup(n,i);if(t||d.ZP.getGroup(n,e.windowId).size>1){l.group=n,(0,N.XN)(e)&&(l.fixedGroupTitle=(0,N.XN)(e));const{tiling:s}=e.vivExtData;!t&&s&&d.ZP.getTiles(s.id,i).size>1&&(l.tiling=s)}}}}}if(g.ZP.getIsLoading()){if(t.vivExtData?.group&&(l.group=g.ZP.getLoadGroup(i,t.vivExtData.group),!(0,N.XN)(t))){const e=g.ZP.getLoadGroupNameMap();if(e.size&&l.group){const t=e.get(l.group);t&&(l.fixedGroupTitle=t.name.substring(0,50))}}if(g.ZP.getLoadPersistentTabs())l.workspaceId=t.vivExtData?.workspaceId;else if(g.ZP.getLoadWorkspaceAsTabs())l.workspaceId=void 0;else{let e=p.Z.get(R.kWorkspacesEnabled)?(0,N.cm)(t):void 0;if(void 0!==e){const t=g.ZP.getLoadWorkspaceId(e);if(void 0!==t&&!w.Z.getWorkspaceById(t)){const s=g.ZP.getWorkspace(e);C.Z.addWorkspaceWithId(t,m.Z.getLoadingWorkspaceName(e),s?.icon??"",s?.emoji.length?s?.emoji:void 0)}e=t}l.workspaceId=e??r}}else b.ZP.initializingWindowId===i||b.ZP.isPopulatingEmptyWorkspace||g.ZP.inSessionRecovery()?l.workspaceId=(0,N.cm)(t):l.workspaceId=r;t.vivExtData=(0,k.TS)(t.vivExtData,l),o.Z.dispatch({actionType:"CHROME_TABS_CREATE",page:t,tabActivationHistory:h,deactivatePageId:t.active?a?.id:void 0,windowId:i,openerMissingGroupId:f});const x=Promise.all([(0,U.V)(t.id,l),f&&(0,U.V)(f,{group:l.group}),y.Z.windows.update(i,{focused:!0,drawAttention:!0}),u!==t.index&&y.Z.tabs.move([t.id],{index:t.index}),v!==t.pinned&&y.Z.tabs.update(t.id,{pinned:v})]).catch((e=>{console.warn("handleChromeTabsCreated:",e)}));ae=ae.then((()=>x))}function le(e){const t=e.windowId;if(f.Z.findPanelByTabId(e.tabId)){const s=d.ZP.getPageHistory(t);if(s.length>1){const n=s[s.length-1],i=d.ZP.getPageInWindow(t,n);i&&(e.tabId=i.id)}}o.Z.dispatch({actionType:"PAGE_OPEN",pageId:e.tabId,windowId:t,activatedByChrome:!0,selectGroup:!0})}function de(e,t,s){if(void 0!==s.parentTabId)return;let n=e.get(t);if(!n)return;e.delete(t);const i=n.windowId,a=s.newWindowId;n={...n,index:s.newPosition,windowId:a,active:!1};const r=[...d.ZP.getPageHistory(a)];if(n.active?(0,F.AL)(r,n.id):(0,F.EQ)(r,n.id),a!==i){X(i,d.ZP.getActiveWorkspace(i)).catch((()=>{}))}o.Z.dispatch({actionType:"CHROME_TABS_CREATE",page:n,tabActivationHistory:r,deactivatePageId:n.active?d.ZP.getActivePage(a)?.id:void 0,windowId:a})}function ce(e,t,s){if(void 0!==s.parentTabId)return;const n=s.oldWindowId,i=d.ZP.getPageInWindow(n,t);if(!i){const e=s.parentTabId?s.parentTabId:"n/a";return void console.error(`Expected to find page ${t} in window ${n}; parent=${e}`)}const a=i.active?(0,d.yz)(i)?.id:void 0;e.set(t,i),o.Z.dispatch({actionType:"CHROME_TABS_REMOVED",tabId:t,removeInfo:{isWindowClosing:!1,windowId:n}}),a&&setTimeout((()=>{d.ZP.getPageInWindow(n,a)&&y.Z.tabs.update(a,{active:!0})}))}function he(e,t){const s=t.windowId;o.Z.dispatch({actionType:"CHROME_TABS_MOVED",tabId:e,windowId:s,index:t.toIndex})}function ue(){y.Z.tabs.onReplaced.addListener(ie),y.Z.tabs.onCreated.addListener(re),y.Z.tabs.onUpdated.addListener(Y),y.Z.tabs.onRemoved.addListener(ne),y.Z.tabs.onMoved.addListener(he),y.Z.tabs.onActivated.addListener(le);const e=new Map;y.Z.tabs.onDetached.addListener(ce.bind(null,e)),y.Z.tabs.onAttached.addListener(de.bind(null,e))}async function pe(e,t,s){o.Z.dispatch({actionType:"UNLOAD_DIALOG_CLOSED",windowId:e,tabId:t,proceed:s}),s||(Ce=(0,P.M)(),void 0!==d.ZP.replacementTab?.id&&(await y.Z.tabs.remove(d.ZP.replacementTab.id),d.ZP.replacementTab=void 0))}async function ge(){const e=p.Z.get(R.kTabsStackingNameMap)||{};if(Object.keys(e).length){(await y.Z.tabs.query({})).forEach((async t=>{const s=n.ZP.tabToPage(t);if(s.vivExtData.group){const t=e[s.vivExtData.group];void 0!==t&&await(0,U.V)(s.id,{fixedGroupTitle:t.substring(0,50)})}})),u.Z.set(R.kTabsStackingNameMap,{})}}async function me(e,t,s){const n=s?s.substring(0,50):void 0,i=d.ZP.getPages(e).filter((e=>(0,N.av)(e)===t));await Promise.all(i.map((({id:e})=>(0,U.V)(e,{fixedGroupTitle:n}))))}function fe(e,t,s=!0){o.Z.dispatch({actionType:"PAGE_OPEN",pageId:e,windowId:t,selectGroup:s})}function ve(e){o.Z.dispatch({actionType:"PAGE_MINIMIZE",windowId:e,workspaceId:d.ZP.getActiveWorkspace(e)})}let be=!1;let Ce=(0,P.M)();async function we(e,t){for(let s=0;s<e.size;s++){const n=e.get(s);if(n){const s=(0,N.av)(n);if(s){const i=e.first().windowId,a=d.ZP.getPages(i).filter((t=>!e.find((e=>e.id===t.id))&&(0,N.av)(t)===s));1===a.size&&await Promise.all(a.map((e=>(0,U.V)(e.id,{fixedGroupTitle:void 0,group:void 0,tiling:void 0})))),t||await(0,U.V)(n.id,{fixedGroupTitle:void 0,group:void 0,tiling:void 0})}else t||await(0,U.V)(n.id,{tiling:void 0})}}}async function ye(e,t){const{bypassConfirm:s=!1,forceClosePinned:n=!1}=t??{},i=Se(e)?e:k.aV.of(e);if(0===i.size)return;const r=n?"on":p.Z.get(R.kTabsClosePinned),l=i.first().windowId,c=function(e,t,s){const n=d.ZP.getPages(t);if(1===n.size&&!d.ZP.canClosePage(n.first()))return(0,k.aV)([]);let i=e;if("off"===s||"bury"===s){const t=p.Z.get(R.kTabsClosePinnedInStack);i=e.filter((e=>!e.pinned||(0,N.av)(e)&&t))}return i}(i,l,r);if(!s&&p.Z.get(R.kTabsConfirmClosingTabs)&&c.size>=p.Z.get(R.kTabsConfirmClosingThreshold))return void a.Z.showConfirmCloseOtherTabsDialog(l,{pages:i});await we(i,!0),o.Z.dispatch({actionType:"PAGE_CLOSE",windowId:l,pages:c});i.some((e=>e.pinned&&e.active))&&"bury"===r&&ve(l);let h=!1,u=!1;for(const[e,t]of c.groupBy(N.cm)){if(t.size===d.ZP.getPages(l,{workspaceId:e}).size&&(u=void 0===e&&!p.Z.get(R.kTabsNeverCloseLast),h=void 0!==e&&!p.Z.get(R.kTabsNeverCloseLast),p.Z.get(R.kTabsNeverCloseLast)&&!d.ZP.replacementTab)){b.ZP.isPopulatingEmptyWorkspace=!0;const t=await y.Z.tabs.create({url:d.ZP.getDefaultStartpage(l),active:!1,transition:Z.Z.historyPrivate.TransitionType.AUTO_TOPLEVEL,windowId:l,vivExtData:JSON.stringify({workspaceId:e})});b.ZP.isPopulatingEmptyWorkspace=!1,d.ZP.replacementTab=t}}const g=c.map((e=>e.id)).toArray(),m=d.ZP.replacementTab?void 0:Q(i);m&&Be.activateTab(m,l),await y.Z.tabs.remove(g);const f=d.ZP.replacementTab?.id;d.ZP.replacementTab=void 0;const C=i.get(0);await async function(e,t){d.ZP.getPageInWindow(e.windowId,e.id)&&await new Promise((s=>{const n=setTimeout(a,t);d.ZP.addListener(o,(t=>t.get(e.windowId)));let i=!1;function a(){i||(s(),i=!0,d.ZP.removeListener(o),clearTimeout(n))}function o(){d.ZP.getPageInWindow(e.windowId,e.id)||a()}}))}(C,100),void 0!==f?await y.Z.tabs.update(f,{active:!0}):m&&d.ZP.getActivePage(l)?.id!==m&&Be.activateTab(m,l),h&&Ee(l,void 0),u&&await v.Z.close(l)}function xe(e,t){const{windowId:s}=e,n=d.ZP.getActiveWorkspace(s),i=(0,N.av)(e);let a=d.ZP.getPages(s).filter((e=>(0,N.cm)(e)===n&&!e.pinned));return a=t?a.skipUntil((e=>(0,N.av)(e)===i)).takeUntil((t=>t.id===e.id)):d.ZP.isGroup((0,N.av)(e),e.windowId)?a.takeUntil((t=>t.id===e.id)).filter((e=>(0,N.av)(e)!==i)):a.takeUntil((t=>t.id===e.id)),a}function Ie(e,t){const{windowId:s}=e,n=d.ZP.getActiveWorkspace(s),i=(0,N.av)(e);let a=d.ZP.getPages(s,{workspaceId:n}).skipUntil((t=>t.id===e.id)).skip(1);return t?a=a.takeUntil((e=>(0,N.av)(e)!==i)):d.ZP.isGroup((0,N.av)(e),e.windowId)&&(a=a.filter((e=>(0,N.av)(e)!==i))),a}async function Ae(e,t,s,n){if(0!==H)return;let i;if("other"===t){const t=d.ZP.getActivePage(e);if(!t)return;i=d.ZP.getPages(e).filter((e=>e.id!==t.id))}else if("all"===t)i=d.ZP.getPages(e);else if(n&&"selection"===t)i=n;else{const t=d.ZP.getActivePage(e);if(!t)return;i=k.aV.of(t)}await Promise.all(i.map((async e=>{H++;try{await Z.Z.tabsPrivate.update(e.id,{muteTab:"mute"===s})}finally{H--}})))}function Se(e){return e instanceof k.aV}async function Ze(e,t,s){if(Se(t)){const n=t;let i=n.some((e=>e.index<s))?s+1:s,a=!1;for(let t=0;t<n.size;t+=1){const o=n.get(t);if(!o)break;e!==o.windowId?await y.Z.tabs.move(o.id,{index:s+t,windowId:e}):(0===t&&i>o.index?i--:t>0&&(i<o.index||a)&&(i++,a=!0),o.index!==i&&await y.Z.tabs.move(o.id,{index:i,windowId:e}))}}else{const n=t;await y.Z.tabs.move(n.id,{windowId:e,index:s})}}async function Te(e,t,s){const n={updateWorkspace:!0,keepActiveTab:!1,...s};if(n.updateWorkspace){const s=d.ZP.getActiveWorkspace(t);await Promise.all(e.map((e=>(0,U.V)(e.id,{workspaceId:s}))))}const i=e.first().windowId;e.some((e=>e.active))&&!function(e,t){const s=Q(e);return!!s&&(Be.activateTab(s,t),!0)}(e,i)&&$(i);const a=await y.Z.tabs.move(e.map((e=>e.id)).toArray(),{windowId:t,index:-1});if(n.keepActiveTab)Be.openLastPage(t);else{await new Promise((e=>{y.Z.windows.update(t,{focused:!0},e)}));const s=e.find((e=>e.active));s&&await y.Z.tabs.update(s.id,{active:!0})}return a}async function Ee(e,t){for(const[s]of d.ZP.getState())if((s===e||void 0!==t)&&t===d.ZP.getActiveWorkspace(s))return void v.Z.focus(s);let s;const n=void 0===t?e:d.ZP.findPageInAllWindows((e=>(0,N.cm)(e)===t))?.windowId;if(n){const e=d.ZP.getState().get(n);if(e){const{list:n,history:i}=e,a=n.filter((e=>(0,N.cm)(e)===t));for(let e=i.length-1;e>=0;e--){const t=i[e];if(s=a.find((e=>e.id===t)),s)break}s||(s=a.first())}}if(void 0!==t&&await function(e,t){const s=d.ZP.getWorkspacePages(t);if(s.size>0&&s.some((t=>t.windowId!==e)))return Te(s,e,{updateWorkspace:!1});return Promise.resolve()}(e,t),s)fe(s.id,e);else{const s={url:d.ZP.getDefaultStartpage(e),windowId:e,index:0,active:!0,vivExtData:JSON.stringify({workspaceId:t})};b.ZP.isPopulatingEmptyWorkspace=!0,await y.Z.tabs.create(s),b.ZP.isPopulatingEmptyWorkspace=!1}}async function ke(e,t,s=!1){const n=Se(e)?e:k.aV.of(e),i=n.first().windowId,a=d.ZP.getActiveWorkspace(i);let o=i;const r=n.groupBy(N.av).map(((e,t)=>void 0===t||d.ZP.getGroup(t,i).size===e.size?(0,k.aV)():e)).flatten().toList();if(await _e(r),t&&(o=w.Z.getWindowId(t)??i,o!==i))return await Ee(o,t),void await Te(n,o);const l=(d.ZP.getPages(o,{workspaceId:t}).map((e=>e.index)).max()??-1)+1,c={workspaceId:t};if(await Promise.all(n.map((e=>(0,U.V)(e.id,c)))),s||await Be.moveToIndex(o,n,l),0===d.ZP.getPages(i,{workspaceId:a}).size){const{pageId:e}=await Be.openURL(i,"",{inBackground:!0});Be.activateTab(e,i)}}async function Ne(e,t,s){if(!oe())return"";const n=e.count((e=>e.pinned));if(n>0&&n<e.size)return console.warn("Can't group a combination of pinned and unpinned pages."),"";const i=e.find(N.av),a=i?(0,N.av)(i):"",r=s||a||d.ZP.getNewGroupId(),l=i&&r===a?(0,N.XN)(i):void 0;await Promise.all(e.filter((e=>(0,N.av)(e)!==r)).map((({id:e})=>(0,U.V)(e,{group:r,fixedGroupTitle:l}))));const c="number"==typeof t?t:e.first().index,h=e.first().windowId;return await Ze(h,e,c),o.Z.dispatch({actionType:"PAGE_TABSTACK_CREATE",windowId:h,pages:e}),r}async function _e(e){const t=Se(e)?e:k.aV.of(e);if(t.isEmpty())return;const s=t.first().windowId;o.Z.dispatch({actionType:"PAGE_TABSTACK_REMOVE_FROM",windowId:s,pages:t}),await we(t,!1);const n=d.ZP.getPages(s).last().index+1;await Be.moveToIndex(s,t,n)}function Pe(e,t=(0,k.aV)()){const s=function(s){const{clipboardData:n}=s;if(!n)return;const i=e.map((e=>E.jk.getHoverUrl(e.url))).concat(t).join("\n");n.setData("text/plain",i),n.setData("text/uri-list",i),n.setData("vivaldi/x-uri-list",i),s.preventDefault()};document.addEventListener("copy",s),document.execCommand("copy"),document.removeEventListener("copy",s)}async function Me(e,t){await Promise.all(e.map((e=>y.Z.tabs.update(e.id,{pinned:t}))))}async function De(e,t){let s,n;"always"===t?(s=!0,n=!1):"cache"===t?(s=!0,n=!0):"never"===t&&(s=!1,n=!1),await Z.Z.tabsPrivate.update(e.id,{showImages:s,loadFromCacheOnly:n}),u.Z.set(R.kPageImageLoading,t)}async function Oe(e,t,s="selection"){if(0===e.size)return;const n=e.first().windowId,i=t||(e.count()<4?"row":"grid"),a=crypto.randomUUID();await Promise.all(e.map((e=>(0,U.V)(e.id,{tiling:{layout:i,type:s,id:a}})))),o.Z.dispatch({actionType:"PAGE_TILE_PAGES",windowId:n,pages:e,id:a})}function je(e,t){const s=d.ZP.getTiles(t,e);s&&Le(s)}async function Le(e){if(e.isEmpty())return;const t=e.first().windowId;o.Z.dispatch({actionType:"PAGE_TILE_REMOVE_PAGES",windowId:t,pages:e}),await Promise.all(e.map((e=>(0,U.V)(e.id,{tiling:void 0}))))}function Re(e){o.Z.dispatch({actionType:"PAGE_SELECTION_CLEAR",windowId:e})}const Be={clear:function(){o.Z.dispatch({actionType:"PAGE_CLEAR"})},clearSelection:Re,clonePages:async function(e){if(be)return[];be=!0;const t=[];try{const s=e.sort(((e,t)=>e.index-t.index)).filter((e=>!(0,E.m7)(e)));let i=-1;for(const e of s){i++;const s=e.index,a=await y.Z.tabs.duplicate(e.id);if(!a)continue;const o=a.id;if(!o)continue;"alwayslast"===p.Z.get(R.kTabsActivationOnClone)?await y.Z.tabs.move(o,{index:-1}):await y.Z.tabs.move(o,{index:s+1+i});const r=(0,N.av)(e);if(r&&d.ZP.getGroup(r,e.windowId).size>1){const t=n.ZP.tabToPage(a);await Ne((0,k.aV)([e,t]))}t.push(o)}}finally{be=!1}return t},close:async function(e){const t=await Ce();try{if(b.ZP.isTabbedBrowser(e)){const t=d.ZP.getSelectionOrActivePage(e);await Be.closePage(t)}else await v.Z.close(e)}finally{t()}},closeOther:function(e,t,s){const n=Se(e)?e:k.aV.of(e),i=n.first().windowId;let a;if(s){const e=n.flatMap((e=>(d.ZP.isGroup((0,N.av)(e),e.windowId)?d.ZP.getGroup((0,N.av)(e),e.windowId):k.aV.of(e)).map((e=>e.id))));a=d.ZP.getPages(i,{workspaceId:t}).filter((e=>!e.pinned)).filter((t=>!e.includes(t.id)))}else{const e=n.map(N.av).toSet();a=1===e.size&&void 0!==e.first()?d.ZP.getPages(i,{workspaceId:t}).filter((t=>(0,N.av)(t)===e.first())).filter((e=>!n.some((t=>t.id===e.id)))):d.ZP.getPages(i,{workspaceId:t}).filter((e=>!e.pinned)).filter((e=>!n.some((t=>t.id===e.id))))}return ye(a)},closePage:ye,closeTabStack:async function(e){const t=d.ZP.getPageById(e);if(!t)return;const s=(0,N.av)(t);ye(d.ZP.getGroup(s,t.windowId))},closeToLeft:async function(e,t){const s=xe(e,t);if(!s.isEmpty())return ye(s)},closeToRight:async function(e,t){const s=Ie(e,t);if(!s.isEmpty())return ye(s)},closeUrl:function(e,t){ye(d.ZP.getPages(e).filter((e=>(0,j.uu)(t,e.url))))},closeDuplicateTabs:function(e){const t=b.ZP.getActiveWindowId();let s=(0,k.aV)();for(const[n,i]of d.ZP.getState()){const a=new Map(i.list.filter((t=>t.url===e)).map((e=>[e.id,e])).toArray()),o=i.history.reduce(((e,t)=>{const s=a.get(t);return s?e.push(s):e}),(0,k.aV)());s=n===t?o.concat(s):s.concat(o)}Be.closePage(s.rest())},copyUrls:Pe,copyAllUrls:function(e,t){Pe(d.ZP.getPages(e,{workspaceId:t}))},createStackFromActiveTab:async function(e){if(!oe())return;const t=d.ZP.getSelectedPages(e);if(t.size>1)return Be.createTabStack(t);const s=d.ZP.getActiveWorkspace(e),n=d.ZP.getPages(e,{workspaceId:s}).filter((e=>!e.pinned&&!(0,N.av)(e)));if(n.size>1){const[t,i]=(0,O.d)(d.ZP.unsafeGetActivePage(e),d.ZP.getWorkspaceTabsInWindow(e,s,!1));if(i.size>1){const s=d.ZP.getNewGroupId();return await me(e,s,t),Be.createTabStack(i,void 0,s)}return Be.createTabStack(n)}},createTabStack:Ne,createGroupByHost:async function(e,t,s){const n=d.ZP.getGroupsForHosts(e,t).get(s);if(n){const t=d.ZP.getNewGroupId();return await Be.createTabStack(n,void 0,t),await me(e,t,s),t}},createGroupByHosts:function(e,t){d.ZP.getGroupsForHosts(e,t).forEach((async(t,s)=>{const n=d.ZP.getNewGroupId();await Be.createTabStack(t,void 0,n),await me(e,n,s)}))},changePeriodicReloadForPages:async function(e,t){await Promise.all(e.map((e=>(0,U.V)(e,{interval:t}))))},cycleByHistory:function(e,t,s={goBack:!1}){const n=(0,x.Z)(e),i=t instanceof n.WheelEvent&&t.buttons===S.Z.kRight,a=(0,A.Z)(t)||i;if(a){const s=()=>{o.Z.dispatch({actionType:"PAGE_CYCLE_HISTORY_MODIFIER_UP",windowId:e,workspaceId:d.ZP.getActiveWorkspace(e)})};i&&t instanceof n.WheelEvent?(0,W.g)(t,s,n.document):(0,B.Kz)(t,s)}o.Z.dispatch({actionType:"PAGE_SET_CYCLE_BY_HISTORY",windowId:e,goBack:s.goBack,activateEventModifierUp:a,workspaceId:d.ZP.getActiveWorkspace(e)})},cycleByOrder:function(e,t,s={goBack:!1}){const n=d.ZP.getActiveWorkspace(e),i=d.ZP.getCyclePageByOrder(e,n,s.goBack);i&&fe(i,e)},detachPage:async function(e,t,s){const n=Se(e)?e:k.aV.of(e),i=n.first().windowId,a=n.map((e=>e.id)),o=(0,I.Z)(i).find((e=>!a.includes(e.id)));o&&fe(o.id,i),1===n.size&&await _e(n),await ke(n,void 0,!0);const r=n.first(),l=n.rest(),d=(await v.Z.openBrowserWindow(i,[],{tabId:r.id,left:t,top:s}))?.id;"number"==typeof d&&l.count()&&await Te(l,d)},detachWorkspace:async function(e,t){const s=d.ZP.getWorkspacePages(t).first(),n=await v.Z.openBrowserWindow(s?s.windowId:e,[]);n?.id&&await Ee(n.id,t)},discardPage:function(e){e.isInspected||y.Z.tabs.discard(e.id)},exitPictureInPicture:function(e){y.Z.scripting.executeScript({target:{tabId:e},function:()=>{document.pictureInPictureElement&&document.exitPictureInPicture()}}).catch((e=>{}))},expandSelectionNext:function(e){o.Z.dispatch({actionType:"PAGE_SELECTION_EXPAND_NEXT",page:e})},expandSelectionPrevious:function(e){o.Z.dispatch({actionType:"PAGE_SELECTION_EXPAND_PREVIOUS",page:e})},expandTabStack:async function(e,t){const s=d.ZP.getPages(e).filter((e=>(0,N.av)(e)===t));await Promise.all(s.map((e=>(0,U.V)(e.id,{group:void 0,fixedGroupTitle:void 0}))))},getTabsToTheLeft:xe,getTabsToTheRight:Ie,gotoParentDirectory:function(e,t){const{url:s}=t,n=s.lastIndexOf("/");if(-1===n)return;let i;if(n+1===s.length){const e=s.substr(0,s.length-1).lastIndexOf("/");-1!==e&&(i=s.substr(0,e+1))}else i=s.substr(0,n+1);i&&!i.endsWith("://")&&Be.openURL(e,i,{inSpecificPageId:t.id})},load:function(){ue(),function(){const{tabsPrivate:e}=Z.Z;e.onMediaStateChanged.addListener(q),e.onPermissionAccessed.addListener(J),e.onTabUpdated.addListener(ee),e.onBeforeUnloadDialogClosed.addListener(pe),e.onTabResourceMetricsRefreshed.addListener(te)}(),function(){const{windowPrivate:e}=Z.Z;e.onBeforeUnloadDialogOpened.addListener(se)}(),p.Z.addListener(R.kTabsSelectionIncludeActive,Re),G();const e=p.Z.get(R.kTabsStackingNameMap)||{};Object.keys(e).length&&setTimeout(ge,3e4)},minimizePage:ve,moveDroppedTabs:async function(e,t,s,n,i){const a=d.ZP.getActiveWorkspace(e);let o;if(void 0===i)o={workspaceId:a};else if(""===i)o={group:i,workspaceId:a,fixedGroupTitle:void 0};else{const t=d.ZP.getGroup(i,e).first(),s=t?(0,N.XN)(t):void 0;o={group:i,workspaceId:a,fixedGroupTitle:s}}t.map((e=>(0,U.V)(e.id,o))),await Ze(e,t,n),(s?t.find((e=>e.id===parseInt(s))):t.first())&&fe(s,e),await new Promise((e=>setTimeout(e,100))),Me(t.filter((e=>e.pinned)),!0)},moveToIndex:Ze,moveToWindow:Te,moveSelectionToWorkspace:function(e,t){const s=t>0?w.Z.getState()[t-1]?.id:void 0;if(void 0===s&&0!==t)return void console.warn(`Workspace number ${t} does not exist.`);ke(d.ZP.getSelectionOrActivePage(e).filter(Boolean),s)},muteAllExcept:function(e,t){Ae(e,"selection","mute",d.ZP.getPages(e).filter((e=>-1===t.findIndex((t=>t.id===e.id)))))},pinTabStack:async function(e,t){const s=d.ZP.getGroup(e,t);await Me(s,!0)},newTab:async function(e,t,s={index:void 0,workspaceId:void 0,groupId:void 0,ignoreLinkRouting:void 0}){const n=s.index,i=s.workspaceId,a=s.groupId??void 0,r=(0,E.Gr)(t),l=r&&"_blank"!==r?r:d.ZP.getDefaultStartpage(e),c={url:l,windowId:e,index:n,active:!0,ignoreLinkRouting:s.ignoreLinkRouting,vivExtData:JSON.stringify({workspaceId:i,group:a}),pinned:d.ZP.isPinnedGroup(a,e)};p.Z.get(R.kWorkspacesEnabled)&&await Ee(e,i);const h=await y.Z.tabs.create(c);if(void 0!==h?.id){const t=h.id;return o.Z.dispatch({actionType:"PAGE_OPEN_URL",pageId:t,windowId:e,url:l,postParams:void 0}),t}throw new Error("Failed to create tab")},openLastPage:function(e){const t=d.ZP.getActiveWorkspace(e),s=!oe(),n=d.ZP.getWorkspaceTabsInWindow(e,t,s).last();n&&fe(n.page.id,e)},activateTab:fe,activateTabByIndex:function(e,t){const s=d.ZP.getActiveWorkspace(e),n=!oe(),i=d.ZP.getWorkspaceTabsInWindow(e,s,n).get(t);if(!i)return;const a="group"===i.type?i.pages:(0,k.aV)();if(!(a.size>0)||!i.page.active)return void fe(i.page.id,i.page.windowId);if(a.last()===i.page)return void fe(a.first().id,e);const o=a.findIndex((e=>e.active))+1,r=a.get(o)?.id;r&&fe(r,e)},openURL:$,openUrls:async function(e,t,s){s.inNewWindow?await v.Z.openBrowserWindow(e,t,{incognito:s.incognito}):await Promise.all(t.map(((n,i)=>s.inCurrent?Be.openURL(e,n,{...s,inCurrent:0===i,inBackground:0!==i}):Be.openURL(e,n,{...s,inBackground:s.inBackground||n!==(0,D.Z)(t)}))))},reloadPage:async function(e){const t=Se(e)?e:k.aV.of(e);await Promise.all(t.map((e=>y.Z.tabs.reload(e))))},removeFromTabStack:_e,closeWorkspaceTabs:function(e){const t=d.ZP.getWorkspacePages(e).map((e=>e.id)).toArray();return y.Z.tabs.remove(t)},moveToWorkspace:ke,setActiveWorkspace:Ee,setFixedStackTitle:me,setFixedTitle:async function(e,t){await(0,U.V)(e,{fixedTitle:t?t.substring(0,50):void 0})},setHistoryManagerState:async function(e,t){await(0,U.V)(e,{historyManagerState:t})},setImageInspector:function(e,t,s){o.Z.dispatch({actionType:"PAGE_SET_IMAGE_INSPECTOR",pageId:e,windowId:t,showImageInspector:s})},setImageLoading:De,setMuting:Ae,setPageInspected:function(e,t,s){o.Z.dispatch({actionType:"PAGE_SET_IS_INSPECTED",pageId:e,windowId:t,inspected:s})},setPinned:Me,setReaderState:async function(e,t){await(0,U.V)(e,{readerMode:t})},setSelection:function(e,t){const{multiSelect:s=!1,addGroup:n=!0,excludeActive:i=!1}=t??{};o.Z.dispatch({actionType:"PAGE_SELECTION_SET",page:e,multiSelect:s,addGroup:n,excludeActive:i})},setThumbnail:async function(e,t){const s=d.ZP.getPageById(e);s&&(t?await(0,U.V)(e,{urlForThumbnail:s.url,thumbnail:t}):await(0,U.V)(e,{urlForThumbnail:void 0,thumbnail:void 0}))},setTitle:function(e,t,s){o.Z.dispatch({actionType:"PAGE_SET_TITLE",pageId:e,windowId:t,title:s})},showHomepage:async function(e,t){if(t.inCurrent){d.ZP.getActivePage(e)&&(0,_.gR)((0,x.Z)(e))}const s=p.Z.get(R.kHomepage),n=d.ZP.getDefaultStartpage(e),i=s===T.QG&&n===T.P1?n:s;await $(e,i,t)},stepPage:async function(e,t,s,n){const i=d.ZP.getStepInfo(e,t,s,n);if(!i)return;const{pages:a,index:o}=i;await Be.moveDroppedTabs(n,a,e.id,o,void 0)},stepTabsToStart:function(e){z({toStart:!0,windowId:e})},stepTabsToEnd:function(e){z({toStart:!1,windowId:e})},tileLastActive:async function(e,t){const s=d.ZP.getActivePage(e),n=d.ZP.getLastVisited(e);if(s&&n&&(0,N.cm)(s)===(0,N.cm)(n)){const i=(0,k.aV)([s,n]);i.forEach((t=>{const s=(0,N.jA)(t);s&&je(e,s)})),await Oe(i,t)}},tilePages:Oe,tileTabStack:async function(e,t,s){const n=d.ZP.getGroup(t,e),i=s||(n.count()<4?"row":"grid");await Oe(n,i,"group")},toggleImageLoading:async function(e){const t=p.Z.get(R.kPageImageLoading);"always"===t?await De(e,"never"):"never"===t?await De(e,"cache"):await De(e,"always")},toggleMuting:async function(e,t){const s=t.filter((e=>{const t=r.Z.hasMediaState(e.id,"muting");return!e.vivExtData.vivaldi_tab_muted&&!t})),n=t.filter((e=>{const t=r.Z.hasMediaState(e.id,"muting");return e.vivExtData.vivaldi_tab_muted||t}));await Ae(e,"selection","mute",s),await Ae(e,"selection","unmute",n)},toggleRelatedSelection:function(e){o.Z.dispatch({actionType:"PAGE_SELECTION_TOGGLE_RELATED",page:e})},toggleSelectedPagesPinned:async function(e){const t=d.ZP.getSelectionOrActivePage(e);if(!t.isEmpty())for(let e=0;e<t.size;e+=1){const s=t.get(e);if(!s)return;const n=(0,N.av)(s),i=d.ZP.getGroup(n,s.windowId),a=s.pinned||i?.some((e=>e.pinned));if(i.size>1)for(let e=0;e<i.size;e+=1){const t=a?i.size-1-e:e,s=i.get(t);s&&await y.Z.tabs.update(s.id,{pinned:!a})}else await y.Z.tabs.update(s.id,{pinned:!a})}},tryToUpdateTabResources:function(e){Z.Z.tabsPrivate.getTabPerformanceData(e,(e=>{e.forEach((e=>te(e)))}))},treeMove:async function({windowId:e,pages:t,groups:s,targetArea:n,targetPage:i,targetGroup:a="",targetWorkspaceId:o}){const r=d.ZP.getGroup(a,e).first(),l=r?(0,N.XN)(r):void 0,c=new Map;await Promise.all(t.map((async t=>{const i=(0,N.av)(t);switch(i&&c.set(i,t.windowId),n){case"pinned":return await(0,U.V)(t.id,{group:a,fixedGroupTitle:l,tiling:void 0,workspaceId:o}),void await y.Z.tabs.update(t.id,{pinned:!0});case"stack":{const s=d.ZP.getPages(e).find((e=>(0,N.av)(e)===a&&Boolean(e.vivExtData.tiling)))?.vivExtData.tiling;return await(0,U.V)(t.id,{group:a,fixedGroupTitle:l,tiling:s,workspaceId:o}),void await y.Z.tabs.update(t.id,{pinned:!1})}case"regular":{const e=(0,N.av)(t),n=s.includes(e)?e:void 0,i=t.vivExtData.tiling;return await(0,U.V)(t.id,{group:n,fixedGroupTitle:void 0,tiling:n?i:void 0,workspaceId:o}),void await y.Z.tabs.update(t.id,{pinned:!1})}}}))),i&&await Be.moveToIndex(i.windowId,t,i.index),c.forEach(((e,t)=>{const s=d.ZP.getGroup(t,e).toArray();1===s.length&&(0,U.V)(s[0].id,{group:"",fixedGroupTitle:void 0})}))},unpinTabStack:async function(e,t){const s=d.ZP.getGroup(e,t);await Me(s.reverse(),!1)},untilePages:Le,untileTileGroup:je},Fe=Be},18350:(e,t,s)=>{"use strict";s.d(t,{Z:()=>p});var n=s(15285),i=s(34197),a=s(68247),o=s(29087),r=s(33638),l=s(70864),d=s(7064),c=s(89175),h=s(34155);const u=new class{init(){const{barVisible:e}=o.Z.get(c.kPanelsWindowDefaults);r.Z.dispatch({actionType:"PANEL_INIT_COMMON",state:{regPanels:i.ZP.readRegPanelListFromPrefs(),webPanels:i.ZP.readWebPanelListFromPrefs(),barVisible:e}}),o.Z.addListener(c.kPanelsElements,u.setRegPanels),o.Z.addListener(c.kPanelsWebElements,u.setWebPanels),o.Z.addListener(c.kFeaturesFeeds,u.setRegPanels),u.setWebPanels()}setAddedButton(e,t,s,n){t===c.kToolbarsPanel&&r.Z.dispatch({actionType:"PANEL_ADDED",winId:e,panelId:s,showContent:n})}setRemovedButton(e,t,s){t===c.kToolbarsPanel&&r.Z.dispatch({actionType:"PANEL_REMOVED",winId:e,panelId:s})}setMuted(e,t,s){r.Z.dispatch({actionType:"PANEL_SET_MUTED",winId:e,panelId:t,muted:s})}setFocus(e){r.Z.dispatch({actionType:"PANEL_SET_FOCUS",winId:e})}removeFocus(e){r.Z.dispatch({actionType:"PANEL_REMOVE_FOCUS",winId:e})}toggleFloating(){r.Z.dispatch({actionType:"PANEL_TOGGLE_FLOATING"})}showNextPanel(e,t){r.Z.dispatch({actionType:"PANEL_SHOW_NEXT",winId:e,direction:t})}setContentVisible(e,t){r.Z.dispatch({actionType:"PANEL_SET_CONTENT_VISIBLE",winId:e,visible:t})}togglePanel(e){r.Z.dispatch({actionType:"PANEL_TOGGLE_PANEL",winId:e})}toggleContent(e,t){switch(t){case"webpanel 1":case"webpanel 2":case"webpanel 3":case"webpanel 4":case"webpanel 5":case"webpanel 6":case"webpanel 7":case"webpanel 8":case"webpanel 9":{const s=l.Z.getIndexByShortcut(t),n=[...o.Z.get(c.kToolbarsPanel)].filter((e=>i.ZP.isWebPanel(e)));s>=1&&s<=n.length&&r.Z.dispatch({actionType:"PANEL_TOGGLE_CONTENT",winId:e,panelId:n[s-1]});break}default:r.Z.dispatch({actionType:"PANEL_TOGGLE_CONTENT",winId:e,panelId:t})}}showContent(e,t,s={selectId:"",reason:""}){const{setFocus:n=!1,selectId:i,reason:a}=s;r.Z.dispatch({actionType:"PANEL_SHOW_CONTENT",winId:e,panelId:t,setFocus:n,selectId:i,reason:a})}setWidth(e,t,s){r.Z.dispatch({actionType:"PANEL_SET_WIDTH",winId:e,panelId:t,width:s})}toggleCurrentPanel(e){r.Z.dispatch({actionType:"PANEL_TOGGLE_CURRENT",winId:e})}setSeparateFloating(e,t){let s=o.Z.get(c.kPanelsWebElements).slice(),n=s.findIndex((t=>t.id===e));if(-1!==n){const e={...s[n]};return e.floating=t,s[n]=e,void a.Z.set(c.kPanelsWebElements,s)}if(s=o.Z.get(c.kPanelsElements).slice(),n=s.findIndex((t=>t.id===e)),-1!==n){const e={...s[n]};e.floating=t,s[n]=e,a.Z.set(c.kPanelsElements,s)}}setPanelResizable(e,t){r.Z.dispatch({actionType:"PANEL_SET_RESIZABLE",panelId:e,resizable:t})}setRegPanels=()=>{h.nextTick((()=>{r.Z.dispatch({actionType:"PANEL_SET_REG_PANELS",list:i.ZP.readRegPanelListFromPrefs()})}))};setWebPanels=()=>{h.nextTick((()=>{r.Z.dispatch({actionType:"PANEL_SET_WEB_PANELS",list:i.ZP.readWebPanelListFromPrefs()})}))};setWebPanelStringValue=(e,t,s,n)=>{"title"===t?l.Z.setTitle(e,s,n):"faviconUrl"===t?l.Z.setFaviconUrl(e,s,n):"activeUrl"===t&&l.Z.setActiveUrl(e,s,n)};translateWithPanel(e,t,s){n.ZP.getIsVisible(e,"PanelTranslate")||this.toggleContent(e,"PanelTranslate"),d.Z.utilities.broadcastMessage({translate:{winId:e,lang:t,text:s}})}clearTransitionState(e,t){r.Z.dispatch({actionType:"PANEL_CLEAR_TRANSITION_STATE",winId:e,panelId:t})}closePanel(e){const t=n.ZP.getSelected(e);t&&r.Z.dispatch({actionType:"PANEL_CLOSE",winId:e,panelId:t})}},p=u},14481:(e,t,s)=>{"use strict";s.d(t,{Z:()=>u});var n=s(59322),i=s(96951),a=s(34197),o=s(32921),r=s(33638),l=s(70864),d=s(69046);async function c(e){const{id:t,from:s,interval:a}=e;if(l.Z.isExtPanel(t))return;if(!a)return;const d={id:t,scheduledTime:(0,o.d)({periodInMinutes:a}),periodInMinutes:a,from:s},c=i.ZP.getPageByReloadId(t);c?await n.ZP.changePeriodicReloadForPages([c.id],a):"panel"===s&&l.Z.setPeriodicReload(t,a),r.Z.dispatch({actionType:"PERIODIC_RELOAD_CREATE",alarm:{alarmId:t,alarm:d}})}async function h({ids:e,from:t}){for(const s of e){if(l.Z.isExtPanel(s))continue;const e=i.ZP.getPageByReloadId(s);e?await n.ZP.changePeriodicReloadForPages([e.id],0):"panel"===t&&l.Z.setPeriodicReload(s,null)}r.Z.dispatch({actionType:"PERIODIC_RELOAD_DESTROY",alarmIds:e})}const u={load:async function(){const e=new Map,t=Date.now();i.ZP.getReloadingPages().forEach((s=>{const n=s.vivExtData.interval,i=s.vivExtData.ext_id;if(!n||!i)return;const a={id:i,periodInMinutes:n,scheduledTime:(0,o.d)({periodInMinutes:n,currentTime:t}),from:"tab"};e.set(i,a)})),a.ZP.readWebPanelListFromPrefs().forEach((s=>{if(s.interval&&s.interval>0){const{id:n,interval:i}=s,a={id:n,periodInMinutes:i,scheduledTime:(0,o.d)({periodInMinutes:i,currentTime:t}),from:"panel"};e.set(n,a)}})),r.Z.dispatch({actionType:"PERIODIC_RELOAD_ALL",alarms:e})},createOrDestroyAlarm:async function(e){const{alarm:t,id:s,interval:n,from:i}=e;l.Z.isExtPanel(s)||(t?.periodInMinutes===n?await h({ids:[s],from:i}):await c({id:s,interval:n,from:i}))},createPeriodicReloadAlarm:c,destroyTabPeriodicAlarms:async function(e){const t=i.ZP.getActiveWorkspace(e),s=i.ZP.getReloadingPages().filter((s=>s.windowId===e&&(0,d.cm)(s)===t)),a=s.map((e=>e.vivExtData.ext_id)).toArray(),o=s.map((e=>e.id)).toArray();await n.ZP.changePeriodicReloadForPages(o,0),r.Z.dispatch({actionType:"PERIODIC_RELOAD_DESTROY",alarmIds:a})},destroyAllPanelPeriodicAlarms:async function(){const e=[];for(const t of o.Z.getPanelAlarms().keys())e.push(t),l.Z.setPeriodicReload(t,null);r.Z.dispatch({actionType:"PERIODIC_RELOAD_DESTROY",alarmIds:e})},destroyPeriodicAlarm:h,updateRunningAlarm:function(e,t){const s={alarmId:e,alarm:t};r.Z.dispatch({actionType:"PERIODIC_RELOAD_UPDATE",alarm:s})}}},92413:(e,t,s)=>{"use strict";s.d(t,{Z:()=>f});var n=s(59322),i=s(96951),a=s(68247),o=s(29087),r=s(37330),l=s(33638),d=s(83526),c=s(68079),h=s.n(c),u=s(63164),p=s(89175);function g(e){const t=o.Z.get(p.kWebpagesReaderStyle),s=i.ZP.getActivePage(e);s?.vivExtData.readerMode&&(0,u.VN)(s.id,{type:"READER_MODE_SET_STYLE",readerStyle:{...t,...r.Z.getReaderThemeColor(e)}})}function m(e,t){if(t.tab?.id)switch(e.type){case"READER_MODE_SET_READERABLE":const s=e.isReaderable;l.Z.dispatch({actionType:"READERMODE",supportsReaderMode:s,pageId:t.tab.id,windowId:t.tab.windowId});break;case"READER_MODE_UPDATE_STYLE":g(t.tab.windowId)}}const f={init:function(){(0,u.Tg)(m)},setReaderModeStyle:g,resetReaderModeStyle:function(e){a.Z.reset(p.kWebpagesReaderStyle),g(e)},toggleReaderMode:async function(e){h()(e.url)&&(e.vivExtData.readerMode?await n.ZP.setReaderState(e.id,!1):await n.ZP.setReaderState(e.id,!0),d.Z.doAction(e.windowId,e.id,"focusWebView"))}}},54614:(e,t,s)=>{"use strict";s.d(t,{Bz:()=>m,Ey:()=>u,IH:()=>p,MT:()=>d,Od:()=>g,S1:()=>h});var n=s(96951),i=s(60331),a=s(33638),o=s(56371),r=s(7064);const l=["http://","https://","file://"];function d(e){return l.some((t=>e?.toLowerCase().startsWith(t)))}function c(){r.Z.readingListPrivate.getAll((e=>{a.Z.dispatch({actionType:"READING_LIST_UPDATE",entries:e})}))}function h(){c(),r.Z.readingListPrivate.onModelChanged.addListener((()=>c()))}function u(e,t){let s=0;t.forEach((t=>{d(t.url)&&r.Z.readingListPrivate.add(t.url,t.title,(t=>{t&&(s+=1,i.Z.setStatus(e,(0,o.Z)("$1 page has been added to Reading List.","$1 pages have been added to Reading List.",[s])))}))}))}function p(e,t,s=""){let a=t??"";if(!a){const t=n.ZP.getActivePage(e);t&&(a=t.url,s=t.title)}d(a)&&r.Z.readingListPrivate.add(a,s,(t=>{t&&i.Z.setStatus(e,(0,o.Z)("Page “$1” added to Reading List.",[s]))}))}function g(e){r.Z.readingListPrivate.remove(e,(()=>{}))}function m(e,t){r.Z.readingListPrivate.setReadStatus(e,t,(()=>{}))}},66971:(e,t,s)=>{"use strict";s.d(t,{Z:()=>I});var n=s(46382),i=s(29087),a=s(18237),o=s(33638),r=s(56371),l=s(30381),d=s.n(l),c=s(7064),h=s(15489),u=s(89175);function p(e,t,s){switch(t){case"added":s.item&&o.Z.dispatch({actionType:"SESSION_ADDED",id:e,owner:s.owner,parentId:s.parentId,index:s.index,item:s.item});break;case"changed":s.item&&o.Z.dispatch({actionType:"SESSION_CHANGED",id:e,item:s.item});break;case"content":s.content&&o.Z.dispatch({actionType:"SESSION_CONTENT",id:e,owner:"",content:s.content});break;case"deleted":o.Z.dispatch({actionType:"SESSION_DELETED",id:e});break;case"moved":s.item&&o.Z.dispatch({actionType:"SESSION_MOVED",id:e,item:s.item,parentId:s.parentId,index:s.index})}}function g(e){const t=new Map,s=new Map;o.Z.dispatch({actionType:"SESSION_SET_LOADING_PARAMETERS",opening:e,workspaceAsTabs:!1,persistentTabs:!0,workspaceMap:t,groupNameMap:s})}function m(){o.Z.dispatch({actionType:"SESSION_RECOVERY_START"})}function f(){o.Z.dispatch({actionType:"SESSION_RECOVERY_DONE"})}async function v(e,t){function s(e){const t=i.Z.get(u.kWorkspacesList);for(let s=0;s<t.length+1;s++)if(!t.some((t=>t.id===e+s)))return e+s;return-1}let n=!0;const r=new Map,l=new Map;for(let t=0;t<e.length;t++){const i=a.ZP.getById(e[t]),o=i?.item.workspaces;if(o?.length){let e=0;for(let t=0;t<o.length;t++){if(e=s(e+1),-1===e){n=!1;break}r.set(o[t].id,e)}}i?.item.groupNames.length&&i.item.groupNames.forEach((e=>{l.set(e.id,{windowId:h.Ex,name:e.name})}))}n||r.clear(),o.Z.dispatch({actionType:"SESSION_SET_LOADING_PARAMETERS",opening:e.length>0,workspaceAsTabs:t,persistentTabs:!1,workspaceMap:r,groupNameMap:l})}async function b(){const e=i.Z.get(u.kSessionsSaveDays),t=await c.Z.sessionsPrivate.getAutosaveIds(e);x.remove(t)}function C(){o.Z.dispatch({actionType:"SESSION_SET_TIMED_BACKUP",backup:"on"===i.Z.get(u.kSessionsSaveOnExit)})}function w(e){if("backup"===e.reason||"autosave"===e.reason){const t={name:"",filename:"",parentId:-1,index:-1,owner:"",backup:e.reason};c.Z.sessionsPrivate.add(t,(e=>{e&&console.warn("Error making session backup: "+e)}))}}function y(){return d()().format("YYYY-MM-DD_HH_mm_ss")}const x=new class{loadPromise=()=>(c.Z.sessionsPrivate.onChanged.addListener(p),c.Z.sessionsPrivate.onPersistentLoad.addListener(g),c.Z.utilities.onSessionRecoveryStart.addListener(m),c.Z.utilities.onSessionRecoveryDone.addListener(f),i.Z.addListener(u.kSessionsSaveDays,b),i.Z.addListener(u.kSessionsSaveOnExit,C),a.ZP.addListener(w),new Promise((e=>{c.Z.sessionsPrivate.getAll((t=>{t.loadingFailed&&console.warn("Error loading session list"),o.Z.dispatch({actionType:"SESSION_INIT",model:t,backup:"on"===i.Z.get(u.kSessionsSaveOnExit)}),e()}))})));setTitle=(e,t)=>{c.Z.sessionsPrivate.rename(e,t.trim())};add(e,t,s,n,i,o){const r=y(),l={name:e||r,filename:r,parentId:t,index:s,owner:n,windowId:i,ids:o};if(t<0||a.ZP.isTrash(t,!0))l.index=0;else if(t!==a.ZP.getRootId()){const e=a.ZP.getById(t);e?.item.parentId===a.ZP.getRootId()&&(l.index=e?.index??0)}return s<0&&(l.index=0),l.parentId=a.ZP.getRootId(),new Promise((e=>{c.Z.sessionsPrivate.add(l,(t=>{e(t)}))}))}duplicate(e,t,s,n){const i=a.ZP.getById(e),o=y(),l={name:i?.item.name?(0,r.Z)("$1 (copy)",[i?.item.name]):o,filename:o,parentId:t,index:s,owner:n,fromId:e};return new Promise((e=>{c.Z.sessionsPrivate.add(l,(t=>{e(t)}))}))}async requestContent(e,t){const s=await c.Z.sessionsPrivate.getContent(e);s.id===e&&0!==s.windows.length?o.Z.dispatch({actionType:"SESSION_CONTENT",id:e,owner:t,content:s}):console.warn("Failed to load content for",e)}emptyTrash(){return new Promise((e=>{c.Z.sessionsPrivate.emptyTrash((t=>{t&&console.warn("Error emptying trash: "+t),e()}))}))}makeContainer(e){return new Promise((t=>{c.Z.sessionsPrivate.makeContainer(e,(e=>{t(e)}))}))}modifyContent(e,t){return new Promise((s=>{c.Z.sessionsPrivate.modifyContent(e,t,(t=>{t&&console.warn("Error modifying session '"+e+"', error: "+t),s(t)}))}))}move(e,t,s){return Promise.all(e.map((e=>new Promise((n=>{const i=a.ZP.getById(e);c.Z.sessionsPrivate.move(e,t,s,(t=>{t&&console.warn("Error moving session '"+e+"', error: "+t),n(e)})),i&&(i.item.parentId!==t||i.index>s)&&s++})))))}async open(e,t,s,o=[]){const l=async(e,t,s,i,a)=>{const o={newWindow:s,oneWindow:!s,withWorkspace:!0,tabIds:a};return await v(t,i),Promise.all(t.map((t=>new Promise((s=>{c.Z.sessionsPrivate.open(t,e,o).then((i=>{i&&(console.warn("Error opening session '"+t+"', error: "+i),n.Z.showModalInfo(e,{title:(0,r.Z)("Sessions"),body:(0,r.Z)("No tabs were opened. You may have excluded all tabs in the session.")})),s()}))}))))).then((()=>{v([],!1)}))},d=t.length>1?[]:o;return t.map((e=>a.ZP.getById(e))).filter(Boolean).some((e=>e.item?.workspaces.length))?new Promise((a=>{i.Z.get(u.kWorkspacesEnabled)?n.Z.showIncludeWorkspaceDialog(e,{onClose:n=>{l(e,t,s,n,d),a()}}):n.Z.showEnableWorkspaceDialog(e,{onClose:n=>{l(e,t,s,n,d),a()}})})):l(e,t,s,!0,o)}remove(e){let t=0;return Promise.all(e.map((e=>new Promise((s=>{const n=a.ZP.isTrash(e,!1);c.Z.sessionsPrivate.delete(e,t,(t=>{t&&console.warn("Error deleting session '"+e+"', error: "+t),s()})),n||t++})))))}async restore(e){let t=0;for(const s of e){const e=a.ZP.getById(s);if(e&&a.ZP.isTrashFolder(e.item.parentId))if(a.ZP.isAutoSaveNode(s)){const e=a.ZP.getById(a.ZP.getTrashId()),t=e?e.index:0;await x.move([s],a.ZP.getRootId(),t)}else-1===e.item.containerId?await x.move([s],a.ZP.getRootId(),t++):await x.move([s],e.item.containerId,0)}}update(e,t,s){const n={name:"",filename:y(),parentId:-1,index:-1,owner:"",windowId:t,ids:s};return new Promise((t=>{c.Z.sessionsPrivate.update(e,n,(e=>{t(e)}))}))}},I=x},43656:(e,t,s)=>{"use strict";s.d(t,{Z:()=>I});var n=s(5298),i=s(84451),a=s(96951),o=s(29087),r=s(60331),l=s(15489),d=s(2497),c=s(7064),h=s(89175);const u=new Map;function p(e){return u.get(e)??{indicator:void 0,spatnavActive:!1,tabId:-1,point:void 0,url:"",path:""}}function g(e,t){u.get(e)?.spatnavActive!==t&&(u.set(e,{...p(e),spatnavActive:t}),t?(c.Z.tabsPrivate.onWebviewClickCheck.addListener(w),c.Z.tabsPrivate.onKeyboardChanged.addListener(m),i.Z.bind("ctrl+enter",v),i.Z.bind("shift+enter",b),i.Z.bind("ctrl+shift+enter",C)):(c.Z.tabsPrivate.onWebviewClickCheck.removeListener(w),c.Z.tabsPrivate.onKeyboardChanged.removeListener(m),i.Z.unbind("ctrl+enter",v),i.Z.unbind("shift+enter",b),i.Z.unbind("ctrl+shift+enter",C)))}function m(e,t,s,i){if(!t)return;const a=u.get(e);if(!a?.spatnavActive)return;const o=(0,d.Z)(e);if("WEBVIEW"!==o.document.activeElement?.tagName)g(e,!1);else if(i===n.Z.KEY_ESCAPE&&0===s&&a?.spatnavActive){const t=o.document.activeElement,s=parseInt(t.getAttribute("tab_id"));c.Z.tabsPrivate.closeSpatnavOrCurrentOpenMenu(s,(({layout_changed:t,current_element_valid:s})=>{t&&s||g(e,!1)}))}else i===n.Z.KEY_RETURN&&0===s&&f(e,0)}function f(e,t){g(e,!1);const s=u.get(e),n=(0,d.Z)(e).document.activeElement;if(s?.point&&n){const e=parseInt(n.getAttribute("tab_id"));c.Z.tabsPrivate.activateSpatnavElement(e,t)}}function v(e){f(e.windowId,2)}function b(e){f(e.windowId,1)}function C(e){f(e.windowId,3)}function w(e,t,s,n,i){const a=(0,d.Z)(e).document.activeElement;if(!a)return;const o=parseInt(a.getAttribute("tab_id"));u.get(e)?.spatnavActive&&c.Z.tabsPrivate.closeSpatnavOrCurrentOpenMenu(o,(({layout_changed:t,current_element_valid:s})=>{t&&s||g(e,!1)})),g(e,!1)}function y(e){if(e!==l.ZP.getActiveWindowId())return;if(!(0,d.Z)(e).document.activeElement)return;const t=a.ZP.getActivePage(e)?.url??"",s=u.get(e)?.url??"";if(s){if(s!==t){const s=u.get(e)?.spatnavActive;s&&g(e,!1),u.set(e,{...p(e),url:t,point:void 0})}}else u.set(e,{...p(e),url:t,point:void 0})}async function x(e,t){const s=(0,d.Z)(e).document.activeElement;if(!s)return;const n=parseInt(s.getAttribute("tab_id"));if(!o.Z.get(h.kWebpagesSpatialNavigationEnabled)&&n)return;if(u.set(e,{...p(e),tabId:n}),!n)return void g(e,!1);const i=await c.Z.tabsPrivate.moveSpatnavRect(n,t);i&&i.width>0?g(e,!0):g(e,!1),u.set(e,{...p(e),point:i}),r.Z.setStatus(e,i.href)}const I=new class{attachSpatnavListeners(e){const t={onPageStore:y.bind(this,e)};return a.ZP.addListener(t.onPageStore,(t=>t.get(e))),t}detachSpatnavListeners(e){a.ZP.removeListener(e.onPageStore)}async left(e){await x(e,"left")}async up(e){await x(e,"up")}async right(e){await x(e,"right")}async down(e){await x(e,"down")}}},60331:(e,t,s)=>{"use strict";s.d(t,{Z:()=>d});var n=s(33638),i=s(15489),a=s(1407);let o;function r(e){(e=l(e))!==a.Ex&&(clearTimeout(o),n.Z.dispatch({actionType:"STATUS_SET_STATUS",windowId:e,status:""}))}function l(e){return e===a.A4?i.ZP.getMailWindowId():e===a.Ex||i.ZP.isSettings(e)?i.ZP.getLastActiveBrowserWindowId():i.ZP.isTabbedBrowser(e)?e:a.Ex}const d={setStatus:function(e,t,s){(e=l(e))!==a.Ex&&(clearTimeout(o),n.Z.dispatch({actionType:"STATUS_SET_STATUS",windowId:e,status:t}),s&&(o=setTimeout((()=>r(e)),s)))},clearStatus:r,setPersistentStatus:function(e,t,s){(e=l(e))!==a.Ex&&n.Z.dispatch({actionType:"STATUS_SET_PERSISTENT_STATUS",windowId:e,key:t,status:s})},clearPersistentStatus:function(e,t){(e=l(e))!==a.Ex&&n.Z.dispatch({actionType:"STATUS_CLEAR_PERSISTENT_STATUS",windowId:e,key:t})},rerouteWindowId:l}},2699:(e,t,s)=>{"use strict";s.d(t,{Z:()=>k});var n=s(65792),i=s.n(n),a=s(68247),o=s(29087),r=s(9304),l=s(33638),d=s(15489),c=s(56371),h=s(92292),u=s(7064),p=s(58848),g=s(65741),m=s(89175),f=s(48588);const v=[m.kAppearanceDensity,m.kSystemAccentColor,m.kSystemDesktopThemeColor,m.kSystemHasDesktopWallpaperProtocol,m.kThemeDimBlurred,m.kThemePrivateWindow,m.kThemeScheduleEnabled,m.kThemeScheduleOS,m.kThemeScheduleTimeline,m.kThemeUseAnimation,m.kThemesCurrent,m.kThemeSimpleScrollbar,m.kThemesPreview,m.kThemesCurrentPrivate,m.kThemesSystem,m.kThemesUser];let b;const C=(0,p.Z)(((e,t)=>{i().valid(t)?l.Z.dispatch({actionType:"THEME_SET_META",tabId:e,color:i()(t)}):console.warn("Invalid meta theme color supplied for tabId",t,e)}),2e3,{trailing:!0});async function w(){const e=h.Z.extension.inIncognitoContext&&!window.isGuestSession?o.Z.get(m.kThemesCurrentPrivate):y(),t=r.ZP.getThemeWithFallback(e),{backgroundImage:s,backgroundPosition:n}=t;return[t,await r.ZP.getImageVars(s,n)]}function y(e){return r.ZP.getPreview()?.id||x(e)}function x(e){if(e&&d.ZP.isIncognito(e))return o.Z.get(m.kThemesCurrentPrivate);switch(o.Z.get(m.kThemeScheduleEnabled)){case"timeline":return r.ZP.getTimerByDate(new Date,"current").themeId;case"system":return o.Z.get(m.kThemeScheduleOS)[o.Z.get(m.kSystemDesktopThemeColor)];default:return o.Z.get(m.kThemesCurrent)}}function I(e){switch(o.Z.get(m.kThemeScheduleEnabled)){case"timeline":(0,f.kz)(m.kThemeScheduleTimeline,(t=>{const s=r.ZP.getTimerByDate(new Date,"current"),n=t.findIndex((e=>e.id===s.id));-1!==n&&(t[n].themeId=e)}));break;case"system":(0,f.kz)(m.kThemeScheduleOS,(t=>{t[o.Z.get(m.kSystemDesktopThemeColor)]=e}));break;default:a.Z.set(m.kThemesCurrent,e)}T()}function A(){if(h.Z.extension.inIncognitoContext)return;const e=new Date,t=r.ZP.getTimerByDate(e,"next");if(Z(),t&&"timeline"===o.Z.get(m.kThemeScheduleEnabled)){const s=60*(t.minutes+60*t.hours-60*e.getHours()-e.getMinutes())-e.getSeconds();b=setTimeout((async()=>{const e=r.ZP.getThemeWithFallback(t.themeId),s=await r.ZP.getImageVars(e.backgroundImage,e.backgroundPosition);l.Z.dispatch({actionType:"THEME_SET",style:s,theme:e}),A()}),1e3*s)}}async function S(){const e=o.Z.get(m.kThemeScheduleEnabled);if(["system","timeline"].includes(e)){const[e,t]=await w();l.Z.dispatch({actionType:"THEME_SET",style:t,theme:e})}"timeline"===e?A():Z()}function Z(){b&&clearTimeout(b)}function T(){o.Z.get(m.kThemesPreview)?.length>0&&a.Z.reset(m.kThemesPreview)}async function E(e,t,s){if((0,g.Z)(t,e))return;const[n,i]=await w();switch(s){case m.kThemeScheduleEnabled:case m.kThemeScheduleTimeline:l.Z.dispatch({actionType:"THEME_SET",style:i,theme:n}),"timeline"===o.Z.get(m.kThemeScheduleEnabled)?A():Z();break;case m.kThemeScheduleOS:case m.kThemesCurrent:case m.kSystemHasDesktopWallpaperProtocol:case m.kSystemDesktopThemeColor:case m.kThemesCurrentPrivate:case m.kThemeDimBlurred:case m.kAppearanceDensity:case m.kThemeSimpleScrollbar:case m.kThemesSystem:case m.kThemesUser:case m.kSystemAccentColor:case m.kThemeUseAnimation:case m.kThemesPreview:l.Z.dispatch({actionType:"THEME_SET",style:i,theme:n})}}const k={getCurrentId:y,getCurrentIdWithoutPreview:x,createTheme:function(e){const t=r.ZP.getThemeWithFallback(e),s={...t};return s.id=crypto.randomUUID(),s.version=1,s.url="",s.name=(0,c.Z)("$1 copy",[t.name]),I(s.id),a.Z.set(m.kThemesUser,[...o.Z.get(m.kThemesUser),s]),s.id},deleteTheme:function(e){const t=o.Z.get(m.kThemesUser),s=t.findIndex((t=>t.id===e));let n;if(-1!==s){if(t[s+1])n=t[s+1].id;else if(t[s-1])n=t[s-1].id;else{const e=o.Z.get(m.kThemesSystem);n=e[e.length-1].id}o.Z.get(m.kThemesCurrent)===e&&a.Z.set(m.kThemesCurrent,n),o.Z.get(m.kThemesCurrentButtons)===e&&a.Z.reset(m.kThemesCurrentButtons),(0,f.kz)(m.kThemeScheduleOS,(t=>{t.dark===e&&(t.dark=n),t.light===e&&(t.light=n)})),(0,f.kz)(m.kThemeScheduleTimeline,(t=>{for(let s=0;s<t.length;s++){const i=t[s];i.themeId===e&&(i.themeId=n)}})),a.Z.set(m.kThemesUser,t.filter((t=>t.id!==e)))}else console.warn(`Theme ${e} is not a user theme and cannot be deleted.`)},exportTheme:async function(e,t){await u.Z.themePrivate.export({...e,engineVersion:1},{windowId:t,dialogTitle:(0,c.Z)("Select Export Location")})},installTheme:function(){const e=o.Z.get(m.kThemesPreview)[0];if(e){const t=o.Z.get(m.kThemesUser);a.Z.set(m.kThemesUser,[...t,e]),I(e.id),T()}},updateTheme:function(){const e=o.Z.get(m.kThemesPreview)[0];if(e){(0,f.kz)(m.kThemesUser,(t=>{const s=t.findIndex((t=>t.id===e.id));t[s]=e}))&&I(e.id),T()}},clearThemePreview:T,loadFavicon:function(e,t){const s=new Image,n=e.url;s.crossOrigin="Anonymous",s.onload=()=>{s.height=16,s.width=16;const n=r.ZP.getPalette(s).map((e=>i()(e)));l.Z.dispatch({actionType:"THEME_SET_PAGE_PALETTE",favIconUrl:e.favIconUrl,hostname:t,windowId:e.windowId,colors:n})},s.onerror=()=>{l.Z.dispatch({actionType:"THEME_SET_FAILED_FAVICON_URL",url:n})},s.src=e.favIconUrl},loadPromise:async function(){T();const[e,t]=await w();l.Z.dispatch({actionType:"THEME_SET",style:t,theme:e,init:!0}),A(),o.Z.addListener(v,E),u.Z.tabsPrivate.onThemeColorChanged.addListener(C),u.Z.utilities.onSuspend.addListener(Z),u.Z.utilities.onResume.addListener(S)},revertSystemTheme:function(e){const t=o.Z.get(m.kThemesSystem),s=t.findIndex((t=>t.id===e)),n=o.Z.getDefault(m.kThemesSystem).find((t=>t.id===e));if(-1!==s&&void 0!==n){if(t[s]!==n){const e=[...t];e[s]=n,a.Z.set(m.kThemesSystem,e)}}else console.warn(e,"is not a valid system theme id")},updateCustomTheme:async function(e){const t=r.ZP.getTheme(e);if(t){const{url:e}=t,s=await fetch(e);s.ok||console.warn(`No response from: ${e}`);const n=await s.json();n.download&&t.version<=n.version?u.Z.themePrivate.download(t.id,n.download,(e=>console.log(`Theme loaded: ${e.themeID}`))):console.warn(`Bad response from: ${e}`)}},setNextTheme:function(){const e=o.Z.get(m.kThemesSystem),t=o.Z.get(m.kThemesUser),s=e.concat(t);let n;switch(o.Z.get(m.kThemeScheduleEnabled)){case"timeline":n=r.ZP.getTimerByDate(new Date,"current").themeId;break;case"system":const e=o.Z.get(m.kThemeScheduleOS),t=o.Z.get(m.kSystemDesktopThemeColor);n=e[t];break;default:n=o.Z.get(m.kThemesCurrent)}const i=s.findIndex((e=>e.id===n));I(s[i+1]?s[i+1].id:s[0].id)},setTheme:I,setThemeBackgroundImageFromUrl:function(e,t){const s=x(e);t.startsWith("file:")?u.Z.utilities.storeImage({themeId:s,url:t}):fetch(t).then((e=>e.blob())).then((e=>{e.arrayBuffer().then((t=>{u.Z.utilities.storeImage({themeId:s,mimeType:e.type,data:t})}))}))},setThemeByNameWithFallback:function(e){const t=o.Z.get(m.kThemesSystem),s=o.Z.get(m.kThemesUser),n=t.concat(s).find((t=>t?.name===e))?.id;n?I(n):console.warn((0,c.Z)("Unable to find a theme named $1",[e]))}}},69787:(e,t,s)=>{"use strict";s.d(t,{Z:()=>i});var n=s(33638);class i{static setIntialized(e,t){n.Z.dispatch({actionType:"TILE_INITIALIZED",windowId:e,tilesState:t})}static setTileLayout(e,t,s){n.Z.dispatch({actionType:"TILE_SET_LAYOUT",windowId:e,mosaicLayout:t,id:s})}}},32773:(e,t,s)=>{"use strict";s.d(t,{Z:()=>i});var n=s(33638);class i{static edit(e){n.Z.dispatch({actionType:"TOOLBAR_EDIT_MODE",toolbar:e})}static stopEditing(){n.Z.dispatch({actionType:"TOOLBAR_STOP_EDIT_MODE"})}}},65810:(e,t,s)=>{"use strict";s.d(t,{h:()=>o,i:()=>r});var n=s(33638);const i=(e,t)=>t?setTimeout(e,t):e();let a;function o(e,t=0){clearTimeout(a),a=i((()=>n.Z.dispatch({actionType:"TOOLTIP_SET",id:e})),t)}function r(e=0){clearTimeout(a),a=i((()=>n.Z.dispatch({actionType:"TOOLTIP_SET",id:null})),e)}},54058:(e,t,s)=>{"use strict";s.d(t,{Z:()=>w});var n=s(5198),i=s(96951),a=s(18350),o=s(29087),r=s(37330),l=s(9304),d=s(85374),c=s(33638),h=s(15489),u=s(7064),p=s(63164),g=s(89175);const m=["colorBgLighter","colorFg","colorBg","colorFgFadedMore","colorBorder","colorBgLighter","colorBgDark"];function f(e,t){let s=t.adoptedLanguage;"und"===s&&(s=t.cldLanguage,"und"===s&&(s="")),c.Z.dispatch({actionType:"VIVALDI_TABS_LANGUAGE_DETERMINED",tabId:e,pageLanguage:s})}function v(e,t,s,n){const i={isTranslated:!0,originalLang:t,translatedLang:s,error:n};c.Z.dispatch({actionType:"VIVALDI_TABS_PAGE_TRANSLATED",tabId:e,message:i})}function b(e,t){!1===t&&c.Z.dispatch({actionType:"VIVALDI_TABS_PAGE_TRANSLATED_REVERT",tabId:e})}const C={async translateSelection(e,t,s){const r=await n.Z.detectTextLanguage(t,s),l=s.replace(/\u00AD/g,"");o.Z.get(g.kPanelsTranslateRedirect)||i.ZP.getPageInWindow(e,t)?.isMailPage?a.Z.translateWithPanel(e,r,s):(0,p.VN)(t,{type:"TRANSLATE_SELECTION",text:l,textLanguage:r,destLanguage:n.Z.getTargetTranslationCode(),allLanguages:n.Z.getTranslationLocales()})},async sendInitDataToInjectedScript(e){const t=await u.Z.utilities.getCommandLineValue("translate-server-url");t&&console.warn("Translate server overridden: "+t);const s=i.ZP.getPageById(e)?.windowId,a=s?r.Z.getBaseStylesByWindowId(s,m):l.ZP.getFallbackStyle();try{await(0,p.VN)(e,{type:"TRANSLATE_INIT_DATA",destLanguage:n.Z.getTargetTranslationCode(),allLanguages:n.Z.getTranslationLocales(),buttonEnabled:o.Z.get(g.kWebpagesTranslateSelectionButtonEnabled),styles:a,overrideServer:t})}catch(e){}},async sendTextLanguageToInjectedScript(e,t){try{await(0,p.VN)(e,{type:"TRANSLATE_TEXT_LANGUAGE",textLanguage:t,textLanguageName:n.Z.getHumanReadableLanguageFromCode(t)})}catch(e){}},init(){u.Z.tabsPrivate.onLanguageDetermined.addListener(f),u.Z.tabsPrivate.onPageTranslated.addListener(v),u.Z.tabsPrivate.onIsPageTranslatedChanged.addListener(b),u.Z.tabsPrivate.onShowTranslationUI.addListener(((e,t,s,n)=>{c.Z.dispatch({actionType:"VIVALDI_TABS_TRANSLATION_PROGRESS",tabId:e,translateStep:t,error:s,autoTranslate:n})})),(0,p.Tg)((function(e,t,s){if(!t.tab?.id)return!1;const a=t.tab.id;switch(e.type){case"TRANSLATE_SELECTION_READY":return C.sendInitDataToInjectedScript(a),s(),!0;case"TRANSLATE_DETERMINE_LANGUAGE":n.Z.detectTextLanguage(a,e.text).then((e=>{C.sendTextLanguageToInjectedScript(a,e)}));break;case"TRANSLATE_RESULT":{const t=i.ZP.getPageById(a)?.windowId;t&&h.ZP.isActive(t)&&u.Z.translateHistory.add(e.item,0),n.Z.setTargetTranslationCode(e.destLang);break}case"TRANSLATE_SELECTION_BUTTON_CLICKED":{const t=i.ZP.getPageById(a)?.windowId;t&&C.translateSelection(t,a,e.text);break}}return!1}))},resetTranslationParameters(e){c.Z.dispatch({actionType:"PAGE_RESET_TRANSLATION_PARAMETERS",tabId:e})},async translatePage(e){const t=n.Z.getTargetTranslationCode(),s=d.ZP.getPageState(e);t&&s&&await u.Z.tabsPrivate.translatePage(e,s.pageLanguage?s.pageLanguage:"auto",t)}},w=C},76501:(e,t,s)=>{"use strict";s.d(t,{Z:()=>h});var n=s(63365),i=s(33638),a=s(15489),o=s(92292),r=s(75256),l=s(7064);async function d(){const e=await o.Z.sessions.getRecentlyClosed();await new Promise((e=>setTimeout(e)));const t=e.filter((e=>{if(e.tab)return!0;if(!e.window)return!1;let t=!0;const s=(0,r.Z)(e.window.vivExtData);for(const[,e]of a.ZP.getState())if(t=e.extId!==s.ext_id,!t)break;return t}));i.Z.dispatch({actionType:"CHROME_SET_SESSION",session:t})}const c=new class{emptyTrash=()=>{l.Z.utilities.clearAllRecentlyClosedSessions()};removeTabs(e){l.Z.utilities.clearRecentlyClosedTabs(e,(e=>{e||console.warn("Error removing tabs")}))}undeleteTab(e){return new Promise(((t,s)=>{o.Z.sessions.restore(e,(n=>{o.Z.runtime.lastError&&(console.warn("Error restoring tab: ",e,o.Z.runtime.lastError),s()),t()}))}))}async undeletePreviousTab(){const e=n.Z.getTrash().find((e=>e.tab));e?.tab&&await c.undeleteTab(e.tab.sessionId)}undeleteWindow(e){o.Z.sessions.restore(e,(t=>{o.Z.runtime.lastError&&console.warn("Error restoring window: ",e,o.Z.runtime.lastError.message)}))}loadPromise=()=>(o.Z.sessions.onChanged.addListener(d),d())},h=c},67975:(e,t,s)=>{"use strict";s.d(t,{Z:()=>i});var n=s(33638);const i=new class{updateState(e,t){n.Z.dispatch({actionType:"URLFIELD_UPDATE_STATE",pageId:e,state:t})}reset(e){n.Z.dispatch({actionType:"URLFIELD_RESET",pageId:e})}}},2004:(e,t,s)=>{"use strict";s.d(t,{Z:()=>_});var n=s(59322),i=s(96951),a=s(29087),o=s(39206),r=s(15489);const l=function(e){const t=e.replace(/^.*?\:\/\//,"");return!!t.includes('"')&&(!t.includes("/")||t.indexOf('"')<t.indexOf("/"))};var d=s(7064),c=s(36436),h=s(78614),u=s(86662),p=s(55432),g=s(89175);const m=/\s/,f=/^(\w{1,}\:(\/\/)?)?(\w{1,}(\.\w{1,})?(:\d{1,5})?[/?#])/,v=/\.(.{2,})(\/)/,b=/^([a-zA-Z0-9\-\._~!$&'()\*+,;=%]*(:[a-zA-Z0-9\-\._~!$&'()\*+,;=%]*)?)?@\S*/,C=/^[^\/ ]{1,}:(\/\/)?[^\/ ]{1,}(\/|\?|#)/,w=/^[^\/\s]+@[^@]+$/,y=/[a-z]+\/$/,x=/(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}/,I=/^localhost/,A=/https:\/+/i,S=/http:\/+/i;async function Z(e,t,s){if(function(e){const t=e.split(" ");return t.length>=2&&void 0!==o.Z.getByKeyword(t[0])}(t))return T(e,t,s);const n=t.trimEnd().replace(A,"https://").replace(S,"http://"),{urlValid:i,isBrowserUrl:a,schemeParsed:r}=d.Z.utilities.isUrlValid(n);if((0,u.AZ)(n)){return(0,c.q9)(n)}const p="file"!==r&&"javascript"!==r,g=m.test(n),Z=g&&f.test(n),E=v.test(n.split(" ")[0]),k=b.test(n),N=C.test(n);let _;function P(){return _||(_=d.Z.utilities.canOpenUrlExternally(n)),_}const M=function(e){if(!e.includes(":"))return!1;if(e.includes(" ")&&e.indexOf(" ")<e.indexOf(":"))return!1;try{const t=parseInt(e.split(":")[1].split("/")[0]);return t>=0&&t<=65535}catch(e){return!1}}(n);if(s.enableSearch&&!N&&!k&&!E&&!M&&(p&&g&&!Z||""!==r&&!a&&!await P()))return T(e,n,s);if(i&&(a||await P())&&!M)return n;const D=n.startsWith("?"),O=w.test(n);if(D||O&&(0,h.HZ)(n)||s.enableSearch&&l(n))return T(e,D?n.substr(1):n,s);const j=(0,c.q9)(n),L=y.test(n),R=x.test(n),B=d.Z.utilities.getUrlFragments(j),F=Boolean(B.tld),W=I.test(n);if(s.enableSearch&&!R&&!F&&!M&&!W&&!L)return T(e,n,s);try{return new URL(j),j}catch(t){return s.enableSearch?T(e,n,s):"vivaldi://network-error/-300"}}async function T(e,t,s){const n=t,{useSearchEngine:i}=s;if(i){const{url:e,contentType:t,postParams:a}=await d.Z.searchEngines.getSearchRequest(i.guid,n);return s.postParams=a,s.contentType=t,e}const a=o.Z.getByQuery(n);if(a){const e=n.substr(a.keyword.length+1),{url:t,contentType:i,postParams:o}=await d.Z.searchEngines.getSearchRequest(a.guid,e);return s.postParams=o,s.contentType=i,t}const l=o.Z.getDefault(r.ZP.isIncognito(e));if(l){const{url:e,contentType:t,postParams:i}=await d.Z.searchEngines.getSearchRequest(l.guid,n);return s.postParams=i,s.contentType=t,e}return t}async function E({windowId:e,url:t,options:s}){s.hasOwnProperty("inCurrent")||(s.inCurrent=!s.inBackground);const{enableSearch:i,useSearchEngine:a,...o}=s;await n.ZP.openURL(e,t.replace(/ /g,"%20"),o)}async function k(e,t,s={}){let n;if("string"==typeof t?n=await Z(e,t.trimStart(),s):(s.transition=t.transition,n=(0,p.K5)(t)?await T(e,t.fillIntoEdit,s):t.destinationUrl),n)return!s.inCurrent&&a.Z.get(g.kTabsStackingOpenInCurrent)&&(s.groupId=i.ZP.getActiveGroupId(e)),E({windowId:e,url:n,options:s})}const N={go:k,goSearchUrl:async function(e,t,s){const n=await T(e,t,s);n&&await E({windowId:e,url:n,options:s})},goToMany:function(e,t,s){return Promise.allSettled(t.map(((n,i)=>k(e,n,{...s,inBackground:i!==t.length-1}))))}},_=N},83526:(e,t,s)=>{"use strict";s.d(t,{Z:()=>h});var n=s(30626),i=s(99827),a=s(96951),o=s(67975),r=s(33638),l=s(57904),d=s(2497),c=s(751);const h=new class{doAction(e,t,s,n){r.Z.dispatch({actionType:"WEBPAGEVIEW_ACTIONS",windowId:e,pageId:t,subAction:s,...n?{payload:n}:null})}findInPage(e,t,s,i){const a=n.Z.getActiveWebView(e);if(a){const n={findNext:!1,matchCase:i||!1};a.find(s,n,(n=>this._findCallback(e,t,s,i,n)))}}findNextInPage(e,t,s,i,a){const o=n.Z.getActiveWebView(e);if(o){const n={backward:i||!1,findNext:!0,matchCase:a||!1};o.find(s,n,(n=>this._findCallback(e,t,s,a,n)))}}_findCallback(e,t,s,n,i){i&&!i.canceled&&r.Z.dispatch({actionType:"WEBPAGEVIEW_RESULTS_FROM_FIND_IN_PAGE",windowId:e,pageId:t,searchText:s,matchCase:n,results:i})}closeFindInPageToolbar(e,t){return!0===l.Z.isFindInPageOpen(t)&&(r.Z.dispatch({actionType:"WEBPAGEVIEW_CLOSE_FIND_IN_PAGE",windowId:e,pageId:t}),!0)}go(e,t,s){r.Z.dispatch({actionType:"WEBPAGEVIEW_GO",windowId:e,pageId:t,index:s||0})}back(e,t){a.ZP.getPageInWindow(e,t)?.isMailPage?i.Z.pageBack(e):r.Z.dispatch({actionType:"WEBPAGEVIEW_BACK",windowId:e,pageId:t})}forward(e,t){a.ZP.getPageInWindow(e,t)?.isMailPage?i.Z.pageForward(e):r.Z.dispatch({actionType:"WEBPAGEVIEW_FORWARD",windowId:e,pageId:t})}getPageHistory(e,t,s){r.Z.dispatch({actionType:"WEBPAGEVIEW_GET_HISTORY",windowId:e,pageId:t,callback:s})}stop(e,t){r.Z.dispatch({actionType:"WEBPAGEVIEW_STOP",windowId:e,pageId:t})}reload(e,t,s){(0,c.gR)((0,d.Z)(e)),r.Z.dispatch({actionType:"WEBPAGEVIEW_RELOAD",windowId:e,pageId:t,bypassCache:s}),o.Z.reset(t)}}},63153:(e,t,s)=>{"use strict";s.d(t,{Z:()=>S});var n=s(30626),i=s(96951),a=s(68247),o=s(29087),r=s(60331),l=s(37330),d=s(9304),c=s(69787),h=s(33638),u=(s(80822),s(15489)),p=s(56371),g=s(92292),m=s(75256),f=s(7064),v=s(44850),b=s(89175),C=s(34155);function w(){0}function y(e,t){const s=u.ZP.getWindowState(e);s&&h.Z.dispatch({actionType:"WINDOW_STATE_CHANGED",windowId:e,oldState:s,change:t})}function x(e,t){h.Z.dispatch({actionType:"WINDOW_ACTIVATED",windowId:e,activated:t})}function I(e){h.Z.dispatch({actionType:"WINDOW_READY",windowId:e})}function A(e,t,s){for(const[e]of u.ZP.getState())h.Z.dispatch({actionType:"WINDOW_UPDATE_FROM_PREFS",windowId:e})}const S=new class{minimize(e){const t=u.ZP.getWindowState(e);t&&(f.Z.windowPrivate.setState(e,"minimized"),h.Z.dispatch({actionType:"WINDOW_STATE_CHANGED",windowId:e,oldState:t,change:"minimized"}))}minimizeAll(){for(const[e]of u.ZP.getState())this.minimize(e)}maximize(e){const t=u.ZP.getWindowState(e);t&&(f.Z.windowPrivate.setState(e,"maximized"),h.Z.dispatch({actionType:"WINDOW_STATE_CHANGED",windowId:e,oldState:t,change:"maximized"}))}restore(e){if(u.ZP.isHTML5Fullscreen(e)){const t=n.Z.getActiveWebView(e);t&&t.setIsFullscreen(!1),this.restoreStateAfterHTMLFullscreen(e)}else{const t=u.ZP.getWindowState(e);t&&(f.Z.windowPrivate.setState(e,"normal"),h.Z.dispatch({actionType:"WINDOW_STATE_CHANGED",windowId:e,oldState:t,change:"normal"}))}}setFullscreen(e){const t=u.ZP.getWindowState(e);t&&(f.Z.windowPrivate.setState(e,"fullscreen"),h.Z.dispatch({actionType:"WINDOW_STATE_CHANGED",windowId:e,oldState:t,change:"fullscreen"}))}toggleFullscreen(e){u.ZP.isFullscreen(e)?this.restore(e):this.setFullscreen(e)}restoreStateAfterHTMLFullscreen(e){const t=u.ZP.getWindowState(e);if(t){const s=u.ZP.getRestoreStateHtml5Fullscreen(e);f.Z.windowPrivate.setState(e,s),h.Z.dispatch({actionType:"WINDOW_STATE_CHANGED",windowId:e,oldState:t,change:s})}}async close(e){return g.Z.windows.remove(e)}onHTML5FullScreen(e,t){if(e)f.Z.windowPrivate.setState(t,"fullscreen");else{const e=u.ZP.getRestoreStateHtml5Fullscreen(t);f.Z.windowPrivate.setState(t,e)}h.Z.dispatch({actionType:"WINDOW_HTML5_FULL_SCREEN",windowId:t,html5FullScreen:e})}async setInert(e,t){h.Z.dispatch({actionType:"WINDOW_SET_INERT",windowId:e,inert:t})}toggleMinimalUI(e){h.Z.dispatch({actionType:"WINDOW_MINIMAL_UI",windowId:e,minimalUI:!u.ZP.isMinimalUI(e)})}toggleBookmarksBar(e){u.ZP.isMinimalUI(e)?h.Z.dispatch({actionType:"WINDOW_TOGGLE_BOOKMARKS_BAR",windowId:e}):u.ZP.isGuest()||a.Z.toggle(b.kBookmarksBarVisible,!0,!1)}toggleAddressBar(e){u.ZP.isMinimalUI(e)?h.Z.dispatch({actionType:"WINDOW_TOGGLE_ADDRESS_BAR",windowId:e}):a.Z.toggle(b.kAddressBarVisible,!0,!1)}toggleTabs(e){u.ZP.isMinimalUI(e)?h.Z.dispatch({actionType:"WINDOW_TOGGLE_TABS",windowId:e}):a.Z.toggle(b.kTabsVisible,!0,!1)}togglePanelToggle(e){u.ZP.isMinimalUI(e)?h.Z.dispatch({actionType:"WINDOW_TOGGLE_PANEL_TOGGLE",windowId:e}):a.Z.toggle(b.kPanelsShowToggle,!0,!1)}toggleStatusBar(e){u.ZP.isMinimalUI(e)?h.Z.dispatch({actionType:"WINDOW_TOGGLE_STATUS_BAR",windowId:e}):(a.Z.toggle(b.kStatusBarDisplay,"on",o.Z.get(b.kStatusBarMinimized)),C.nextTick((()=>{"overlay"===o.Z.get(b.kStatusBarDisplay)&&r.Z.setStatus(e,(0,p.Z)("Status Info set to Overlay"),2e3)})))}focus(e){return g.Z.windows.update(e,{focused:!0})}openWindow(e,t,s,n){const a={incognito:!1,state:"normal"===s&&u.ZP.isMaximized(e)?"maximized":"normal",...n};if(a.tabUrl)a.tabUrl=(0,v.Gr)(a.tabUrl);else if("normal"===s){const t=o.Z.get(b.kIncognitoShowIntro);a.tabUrl=a.incognito&&t?v.xy["private-intro"]:i.ZP.getDefaultStartpage(e)}const r={ext_id:crypto.randomUUID(),...a.vivExtData?JSON.parse(a.vivExtData):null};return"settings"===s&&(r.isSettings=!0),a.vivExtData=JSON.stringify(r),w(),f.Z.windowPrivate.create(t,a,s)}async openBrowserWindow(e,t,s={}){"string"==typeof t&&(t=(0,v.Gr)(t));let n=!1;const a={url:t,incognito:!1,transition:f.Z.historyPrivate.TransitionType.AUTO_TOPLEVEL,...s};u.ZP.isMaximized(e)&&(void 0===a.left&&void 0===a.top&&void 0===a.width&&void 0===a.height?a.state="maximized":n=!0);const r={ext_id:crypto.randomUUID(),...s.vivExtData?JSON.parse(s.vivExtData):null};if(a.vivExtData=JSON.stringify(r),w(),void 0===a.url){const t=o.Z.get(b.kIncognitoShowIntro);a.url=a.incognito&&t?v.xy["private-intro"]:i.ZP.getDefaultStartpage(e)}const l=await g.Z.windows.create(a);return n&&l?.id&&this.maximize(l.id),l}openIncognitoWindow(e,t){return this.openBrowserWindow(e,t,{incognito:!0})}setPanelHasBeenVisible(e,t,s){h.Z.dispatch({actionType:"WINDOW_PANEL_HAS_BEEN_VISIBLE",windowId:e,panelId:t,visible:s})}__initForTests(){window.vivaldiWindowId=42,window.isGuestSession=!1,h.Z.dispatch({actionType:"WINDOW_SET_STATE",windowState:{extId:"cl75x1ek60000lji5dpopf94g",active:!0,state:"maximized",restoreStateFullscreen:"normal",restoreStateHtml5Fullscreen:"normal",guest:!1,html5FullScreen:!1,incognito:!1,nativeDecorations:!1,minimalUI:!1,type:"normal",visibleUI:{addressBar:!1,bookmarksBar:!1,panelToggle:!1,tabs:!0,statusBar:"on"}},windowId:42,windowExtData:{}})}_setWindowState(e,t){const s=e.id;if("number"!=typeof s)return;const n=(0,m.Z)(e.vivExtData);n.ext_id||(n.ext_id=crypto.randomUUID(),g.Z.windows.update(s,{vivExtData:JSON.stringify(n)}));const i=e.tabs??[];let a;i.forEach((e=>{const{id:t}=e;if(t&&!e.vivExtData){const s=JSON.stringify({ext_id:crypto.randomUUID()});e.vivExtData=s,g.Z.tabs.update(t,{vivExtData:s})}})),a="popup"===e.type?n.isSettings?"settings":"popup":"normal";const r={extId:n.ext_id,active:e.focused,state:"locked-fullscreen"===e.state?"normal":e.state,restoreStateFullscreen:"maximized"===e.state?"maximized":"normal",restoreStateHtml5Fullscreen:"normal",guest:t,html5FullScreen:!1,incognito:e.incognito&&!t,minimalUI:n.minimalUI,nativeDecorations:o.Z.get(b.kWindowsUseNativeDecoration),type:a,visibleUI:u.ZP.getUIFromPrefs()};if(n.visibleUI&&(0,u.TF)(r)&&(r.visibleUI=n.visibleUI),"fullscreen"===r.state&&(o.Z.get(b.kStartupRememberFullScreen)?f.Z.windowPrivate.setState(s,"fullscreen"):r.state="normal"),h.Z.dispatch({actionType:"WINDOW_SET_STATE",windowState:r,windowId:s,windowExtData:n}),"settings"!==r.type){let e;for(let t=0;t<i.length;t++){if(n.commandline_tab?.includes(t))continue;const s=i[t];if(s.active){e=s;break}(!e||s.lastAccessed>e.lastAccessed)&&(e=s)}const t=e?.vivExtData?JSON.parse(e?.vivExtData).workspaceId:void 0;if(n.commandline_tab){for(const e of n.commandline_tab){const s=i[e];if(!s)continue;const n=(0,m.Z)(s.vivExtData);n.workspaceId=t,s.vivExtData=JSON.stringify(n),g.Z.tabs.update(s.id,{vivExtData:s.vivExtData})}delete n.commandline_tab,g.Z.windows.update(s,{vivExtData:JSON.stringify(n)})}h.Z.dispatch({actionType:"CHROME_TABS_INIT",tabs:i,windowId:s})}"object"==typeof n.tiles&&c.Z.setIntialized(s,n.tiles);const{theme:p}=l.Z.getState(),{backgroundImage:v,backgroundPosition:C}=p;d.ZP.getImageVars(v,C).then((e=>h.Z.dispatch({actionType:"THEME_WINDOW_CREATED",style:e,windowId:s})))}loadPromise=async()=>{const{isGuestSession:e}=window;f.Z.windowPrivate.onStateChanged.addListener(y),f.Z.windowPrivate.onActivated.addListener(x),f.Z.windowPrivate.onWebContentsHasWindow.addListener(I),o.Z.addListener([b.kAppearanceDisableTitleBar,b.kAddressBarVisible,b.kAddressBarPosition,b.kBookmarksBarVisible,b.kPanelsShowToggle,b.kStatusBarDisplay,b.kTabsVisible,b.kTabsBarPosition],A),g.Z.windows.onCreated.addListener((t=>{if("normal"===t.type&&(u.ZP.initializingWindowId=t.id),("normal"===t.type||"popup"===t.type)&&g.Z.extension.inIncognitoContext===t.incognito)return this._setWindowState(t,e)})),g.Z.windows.onRemoved.addListener((e=>{f.Z.devtoolsPrivate.closeDevtools(1,e,(e=>{})),h.Z.dispatch({actionType:"WINDOW_CLOSED",windowId:e})}));const t=await g.Z.windows.getAll({populate:!0,windowTypes:["normal"]});for(const s of t)this._setWindowState(s,e)}}},29104:(e,t,s)=>{"use strict";s.d(t,{Z:()=>p});var n=s(59322),i=s(96951),a=s(68247),o=s(29087),r=s(33638),l=s(15489),d=s(64387),c=s(53454),h=s(92292),u=s(89175);const p=new class{init(){h.Z.extension.inIncognitoContext||(r.Z.dispatch({actionType:"WORKSPACES_INIT",workspaces:o.Z.get(u.kWorkspacesList)}),c.Z.addListener((()=>{a.Z.set(u.kWorkspacesList,c.Z.getState())})))}addWorkspaceWithId(e,t,s,n){return r.Z.dispatch({actionType:"CREATE_WORKSPACE",id:e,name:t,icon:s,emoji:n}),e}async addWorkspace(e,t,s,i,a=!1){const o=l.ZP.getLastActiveBrowserWindowId(),d=Date.now();r.Z.dispatch({actionType:"CREATE_WORKSPACE",id:d,name:e,icon:t,emoji:s});const c=()=>a?Promise.resolve():n.ZP.setActiveWorkspace(o,d);return i&&!i.isEmpty()?(await n.ZP.moveToWorkspace(i,d),await c(),n.ZP.cycleByOrder(o,void 0)):await c(),d}setName(e,t){r.Z.dispatch({actionType:"SET_WORKSPACE_NAME",id:e,name:t})}setIcon(e,t){r.Z.dispatch({actionType:"SET_WORKSPACE_ICON",id:e,icon:t})}setEmoji(e,t){r.Z.dispatch({actionType:"SET_WORKSPACE_EMOJI",id:e,emoji:t})}async removeWorkspace(e,t){i.ZP.getActiveWorkspace(e)===t&&await n.ZP.setActiveWorkspace(e,void 0),await d.Z.removeWorkspaceRules(t),await n.ZP.closeWorkspaceTabs(t),r.Z.dispatch({actionType:"REMOVE_WORKSPACE",id:t})}activateWorkspaceByIndex(e,t){if("number"!=typeof t)n.ZP.setActiveWorkspace(e,void 0);else{const s=c.Z.getState()[t]?.id;s&&n.ZP.setActiveWorkspace(e,s)}}setOrder(e){r.Z.dispatch({actionType:"REORDER_WORKSPACES",ids:e})}_activateByOrder(e,t){const s=i.ZP.getActiveWorkspace(e),a=i.ZP.getActiveWorkspaces(),o=c.Z.getState().filter((e=>e.id===s||!a.has(e.id))).map((e=>e.id));if(!s){let s;return s="forward"===t?o[0]:o[o.length-1],void n.ZP.setActiveWorkspace(e,s)}let r;if("forward"===t){const e=o.indexOf(s)+1;r=e>=o.length?void 0:o[e]}else{const e=o.indexOf(s)-1;r=e<-1?o[o.length-1]:-1===e?void 0:o[e]}n.ZP.setActiveWorkspace(e,r)}activateNextByOrder(e){this._activateByOrder(e,"forward")}activatePreviousByOrder(e){this._activateByOrder(e,"backward")}hibernateInactive(){const e=Array.from(i.ZP.getActiveWorkspaces().keys());c.Z.getState().forEach((t=>{if(!e.includes(t.id)){i.ZP.getWorkspacePages(t.id).filter((e=>!e.active)).forEach(n.ZP.discardPage)}}))}}},64387:(e,t,s)=>{"use strict";s.d(t,{Z:()=>l});var n=s(29087),i=s(33638),a=s(92),o=s(89175);function r(e,t){0===t.length&&0!==e.length&&i.Z.dispatch({actionType:"UPDATE_LINK_ROUTES_FROM_PREFS"})}const l=new class{loadPromise=async()=>{const e=n.Z.get(o.kWorkspacesLinkRoutes);i.Z.dispatch({actionType:"WORKSPACE_LINK_ROUTES_INIT",rules:e}),n.Z.addListener([o.kWorkspacesLinkRoutes],r)};async addLinkRoutingRule(e,t,s){const n=crypto.randomUUID();return i.Z.dispatch({actionType:"CREATE_WORKSPACE_LINK_ROUTE",id:n,type:e,expression:t,workspaceId:s}),n}async removeLinkRoutingRules(e){i.Z.dispatch({actionType:"REMOVE_WORKSPACE_LINK_ROUTES",ids:e})}async updateLinkRoutingRule(e,t,s,n){i.Z.dispatch({actionType:"UPDATE_WORKSPACE_LINK_ROUTE",id:e,type:t,expression:s,workspaceId:n})}async removeWorkspaceRules(e){const t=a.Z.getWorkspaceRules(e);t.length>0&&await this.removeLinkRoutingRules(t.map((e=>e.id)))}setOrder(e,t){i.Z.dispatch({actionType:"REORDER_WORKSPACE_LINK_ROUTES",ids:t})}}},22303:(e,t,s)=>{"use strict";s.d(t,{Z:()=>f});var n=s(30626),i=s(96951),a=s(29087),o=s(60331),r=s(33638),l=s(47825),d=s(56371),c=s(7064),h=s(71828),u=s(89175),p=s(44850);function g(e){r.Z.dispatch({actionType:"ZOOM_PAGE_DEFAULT",zoomData:e})}const m=new class{async setUIZoomPercentage(e){await m.setUIZoom(e/100)}async setUIZoom(e){const t=Math.min(Math.max(e,h.bI),h.OK);await c.Z.zoom.setVivaldiUIZoom(t)}async setDefaultWebPageZoom(e){const t=Math.min(Math.max(e/100,h.XF),h.qt);await c.Z.zoom.setDefaultZoom(t)}setPageZoomPercentage(e,t){m.setPageZoom(e,t/100)}setPageZoom(e,t){const s=Math.min(Math.max(t,h.XF),h.qt);(i.ZP.getActivePage(e)?.url??"").startsWith(p.jk.internals.notes)?r.Z.dispatch({actionType:"ZOOM_NOTES",zoomData:s}):r.Z.dispatch({actionType:"ZOOM_PAGE",zoomData:s});const l=n.Z.getActiveWebView(e);l&&(l.setZoom(s),"overlay"!==a.Z.get(u.kStatusBarDisplay)&&a.Z.get(u.kToolbarsStatus).includes("Zoom")||o.Z.setStatus(e,(0,d.Z)("Page Zoom $1%",[Math.round(100*s)]),2e3))}async uiZoomIn(){const e=l.Z.getUIZoom(),t=parseFloat(e+h.Wp);await m.setUIZoom(t)}async uiZoomOut(){const e=l.Z.getUIZoom(),t=parseFloat(e-h.Wp);await m.setUIZoom(t)}async pageZoomIn(e){const t=await m.getActiveZoom(e);m.setPageZoom(e,parseFloat((t+h.Zh).toFixed(2)))}async pageZoomOut(e){const t=await m.getActiveZoom(e);m.setPageZoom(e,parseFloat((t-h.Zh).toFixed(2)))}async pageZoomHalf(e){const t=await m.getActiveZoom(e);m.setPageZoom(e,parseFloat((t/2).toFixed(2)))}async pageZoomReset(e){const t=await c.Z.zoom.getDefaultZoom();m.setPageZoom(e,t)}async pageZoomDouble(e){const t=await m.getActiveZoom(e);m.setPageZoom(e,parseFloat((2*t).toFixed(2)))}getActiveZoom(e){return new Promise((t=>{const s=n.Z.getActiveWebView(e);s?s.getZoom((e=>{t(e)})):t(h.rM)})).then((e=>e))}dispatchZoomUI(e){r.Z.dispatch({actionType:"ZOOM_SET_UI",zoomData:e})}};c.Z.zoom.getVivaldiUIZoom((e=>{m.dispatchZoomUI(e)})),c.Z.zoom.onUIZoomChanged.addListener((e=>{m.dispatchZoomUI(e)})),c.Z.zoom.getDefaultZoom(g),c.Z.zoom.onDefaultZoomChanged.addListener(g);const f=m},89049:(e,t,s)=>{"use strict";var n=s(92292);let i;s(89907).k||(i=n.Z.extension.getViews().find((e=>e.isPortal))??window,i.isPortal||(i.isPortal=!0,i.requestAnimationFrame=e=>n.Z.extension.getViews().find((e=>e!==i))?.requestAnimationFrame(e),i.cancelAnimationFrame=e=>n.Z.extension.getViews().find((e=>e!==i))?.cancelAnimationFrame(e)));const a=i;var o=s(4660),r=s(43623),l=s(17751),d=s(99827),c=s(59322),h=s(60331),u=s(1407);const p={contact:o.Z,mail:d.Z,page:c.ZP,status:h.Z,logger:l.Z,error:r.Z};new BroadcastChannel("actions").addEventListener("message",(function(e){if(e.origin!==u.oP||!e.data||!e.data.actions)return;const{actionType:t,action:s,args:n}=e.data.actions,i=p[t];if(!i)throw new Error("Action creator not found for action type "+t);if("function"!=typeof i[s])throw new Error("Action "+i+"."+s+" not found");i[s](...n)}),!1);var g=s(59486),m=s(24602);class f extends m.Z{getInitialState(){return{defaultLocationId:0,weatherMap:new Map}}getForecastByLocationId(e){return this.getState().weatherMap.get(e)}getDefaultLocationId(){return this.getState().defaultLocationId}getNextUpdate(e){return this.getState().weatherMap.get(e)?.nextUpdate}reduce(e,t){switch(t.actionType){case"WEATHER_SET_DEFAULT_LOCATION":return{...e,defaultLocationId:t.locationId};case"WEATHER_UPDATE":{const s=new Map(e.weatherMap);return s.set(t.locationId,t.forecast),{...e,weatherMap:s}}default:return e}}}const v=new f;var b=s(57118),C=s(93513);class w extends m.Z{getInitialState(){return[]}reduce(e,t){switch(t.actionType){case"DASHBOARD_INIT":return t.widgets;case"DASHBOARD_SET_TIP":return(0,C.Uy)(e,(e=>{const s=e.find((e=>e.id===t.widgetId));"tip"===s?.type&&t.tipContent&&t.tipLink&&(s.tipContent=t.tipContent,s.tipLink=t.tipLink,s.tipTimestamp=t.tipTimestamp)}));case"DASHBOARD_ADD_WIDGET":{const s=function(e,t){const s={id:crypto.randomUUID(),size:b.sB[e].size};switch(e){case"email":return{...s,type:e,background:"solid",accountId:b.$c};case"calendar":return{...s,type:e,background:"solid",calendarIds:[]};case"shortcuts":return{...s,type:e,background:"semi-transparent",folderId:"",showTitle:!1,showThumbnail:!1};case"feed":return{...s,type:e,background:"solid",feedId:t?.feedId,feedDisplay:void 0};case"top-sites":return{...s,type:e,background:"semi-transparent",showTitle:void 0};case"tasks":return{...s,type:"tasks",background:"solid"};case"sticky-note":return{...s,type:"sticky-note",background:"semi-transparent",content:""};case"tip":return{...s,type:e,background:"semi-transparent",tipContent:"",tipLink:"",tipTimestamp:0};case"privacy-stats":return{...s,type:"privacy-stats",background:"semi-transparent"};case"webpage":return{...s,type:"webpage",background:"solid",url:void 0,shareTheme:!1};case"date":return{...s,type:"date",background:"semi-transparent"};case"weather":return{...s,type:"weather",background:"solid",locationId:v.getDefaultLocationId(),temperatureUnit:"celsius",windspeedUnit:"ms",precipitationUnit:"mm",view:"WEEK"};case"currency":return{...s,type:"currency",background:"solid",currencyA:"USD",currencyB:"EUR"}}}(t.type,t.options);if(!s)return e;return(0,C.Uy)(e,(e=>{"number"==typeof t.options.index?e.splice(t.options.index,0,s):e.push(s)}))}case"DASHBOARD_SET_WIDGET_ORDER":{const s=t.widgetIds.map((t=>e.find((e=>e.id===t)))).filter(Boolean);return s.length===e.length?s:(console.error("Sanity check failed when trying to set widget order."),e)}case"DASHBOARD_REMOVE_WIDGET":return(0,C.Uy)(e,(e=>{const s=e.findIndex((e=>e.id===t.widgetId));s>-1&&e.splice(s,1)}));case"DASHBOARD_UPDATE_WIDGET":return(0,C.Uy)(e,(s=>{const n=s.find((e=>e.id===t.widgetId));if(!n)return e;if(t.size)n.size=t.size;else if(t.background)n.background=t.background;else switch(n.type){case"email":n.accountId=t.accountId;break;case"feed":t.feedId&&(n.feedId=t.feedId),t.feedDisplay&&(n.feedDisplay=t.feedDisplay);break;case"shortcuts":const e=t.shortcutConfig;void 0!==e?.folderId&&(n.folderId=e.folderId),void 0!==e?.showTitle&&(n.showTitle=e.showTitle),void 0!==e?.showThumbnail&&(n.showThumbnail=e.showThumbnail);break;case"top-sites":n.showTitle=t.showTitle;break;case"tip":const s=t.tipData;s?.tipContent&&(n.tipContent=s.tipContent),s?.tipLink&&(n.tipLink=s.tipLink),s?.tipTimestamp&&(n.tipTimestamp=s.tipTimestamp);break;case"calendar":n.calendarIds=t.calendarIds?[...t.calendarIds]:[];break;case"sticky-note":n.content=t.content??"";break;case"webpage":const i=t.webpageData;void 0!==i?.url&&(n.url=i.url),void 0!==i?.shareTheme&&(n.shareTheme=i.shareTheme);break;case"weather":const a=t.weatherData;n.locationId=a?.locationId,a?.temperatureUnit&&(n.temperatureUnit=a.temperatureUnit),a?.windspeedUnit&&(n.windspeedUnit=a.windspeedUnit),a?.precipitationUnit&&(n.precipitationUnit=a.precipitationUnit),a?.view&&(n.view=a.view);break;case"currency":t.currencyA&&t.currencyB&&(n.currencyA=t.currencyA,n.currencyB=t.currencyB)}}));default:return e}}}const y=new w;var x=s(17434),I=s(68247),A=s(29087),S=s(33638),Z=s(89175);function T(){S.Z.dispatch({actionType:"DASHBOARD_INIT",widgets:A.Z.get(Z.kDashboardWidgets)}),y.addListener((()=>{I.Z.set(Z.kDashboardWidgets,y.getState())}))}function E(){const e=A.Z.get(Z.kDashboardEnabled);e?I.Z.set(Z.kStartpageSpeedDialOrder,A.Z.get(Z.kStartpageSpeedDialOrder).filter((e=>e!==b.N4))):I.Z.set(Z.kStartpageSpeedDialOrder,A.Z.get(Z.kStartpageSpeedDialOrder).concat([b.N4])),I.Z.set(Z.kDashboardEnabled,!e)}function k(e,t){S.Z.dispatch({actionType:"DASHBOARD_UPDATE_WIDGET",widgetId:e,accountId:t})}function N(e,t){S.Z.dispatch({actionType:"DASHBOARD_UPDATE_WIDGET",widgetId:e,feedId:t})}function _(e,t){S.Z.dispatch({actionType:"DASHBOARD_UPDATE_WIDGET",widgetId:e,feedDisplay:t})}function P(e,t){S.Z.dispatch({actionType:"DASHBOARD_ADD_WIDGET",type:e,options:t})}function M(e,t){S.Z.dispatch({actionType:"DASHBOARD_UPDATE_WIDGET",widgetId:e,shortcutConfig:t})}function D(e,t){S.Z.dispatch({actionType:"DASHBOARD_UPDATE_WIDGET",widgetId:e,weatherData:t})}function O(e,t){S.Z.dispatch({actionType:"DASHBOARD_UPDATE_WIDGET",widgetId:e,size:t})}function j(e,t){S.Z.dispatch({actionType:"DASHBOARD_UPDATE_WIDGET",widgetId:e,background:t})}function L(e,t,s){S.Z.dispatch({actionType:"DASHBOARD_UPDATE_WIDGET",widgetId:e,currencyA:t,currencyB:s})}var R=s(54614);function B(){A.Z.get(Z.kDashboardEnabled)&&S.Z.dispatch({actionType:"STICKY_NOTE_INIT",notes:A.Z.get(Z.kDashboardStickyNotes)})}var F=s(19789),W=s(56371),U=s(30381),V=s.n(U),H=s(8684);const G={getTimeFormat:()=>A.Z.get(Z.kClockShowSeconds)?"LTS":"LT",getDateFormat:()=>F.ZP.getShortDateFormat(),getTimeAndDateFormat:()=>G.getDateFormat()+" "+G.getTimeFormat(),completeTimer:e=>{const t=A.Z.get(Z.kClockNotificationSound),s={title:G.getName(e),body:G.getTime(e),silent:!1,tag:`VIVALDI_CLOCK_TIMER_${G.getName(e)}`};if(t){new Audio(t).play()}var n;(0,H.c)(s),n=(new Date).valueOf(),S.Z.dispatch({actionType:"TIMER_REMOVE_EXPIRED",timestamp:n})},getName:e=>e.name||("alarm"===e.type?(0,W.Z)("Alarm"):(0,W.Z)("Countdown")),getTime:e=>V()(e.date).format("LTS"),getActiveLabel:(e,t)=>{const s=V()(e.date),n=V().duration(s.diff(new Date)),i=n.hours(),a=n.minutes();let o;if("alarm"===e.type)o=s.format("LT");else if(i&&a)o=(0,W.Z)("$1h $2m",[i,a]);else if(i)o=(0,W.Z)("$1h",[i]);else if(a)o=(0,W.Z)("$1m",[a]);else{const e=n.seconds();o=(0,W.Z)("$1s",[e])}if(t){return`${o} - ${G.getName(e)}`}return o},setAlarmWithPreset:e=>{const t=new Date;t.setSeconds(0),t.setHours(e.hour),t.setMinutes(e.minute);Q({name:e.name,date:t.valueOf()},"alarm")},getAlarmPreset:e=>A.Z.get(Z.kClockAlarmPresets).find((t=>t.id===e)),saveAlarmPreset:(e,t,s)=>{const n=crypto.randomUUID();I.Z.set(Z.kClockAlarmPresets,[...A.Z.get(Z.kClockAlarmPresets),{name:e,hour:t,minute:s,id:n}])},removeAlarmPreset:e=>{const t=A.Z.get(Z.kClockAlarmPresets).filter((t=>t.id!==e));I.Z.set(Z.kClockAlarmPresets,t)},setCountdownWithPreset:e=>{const t=new Date;Q({name:e.name,date:t.setSeconds(t.getSeconds()+e.seconds).valueOf()},"countdown")},getCountdownPreset:e=>A.Z.get(Z.kClockCountdownPresets).find((t=>t.id===e)),saveCountdownPreset:(e,t)=>{const s=crypto.randomUUID();I.Z.set(Z.kClockCountdownPresets,[...A.Z.get(Z.kClockCountdownPresets),{name:e,seconds:t,id:s}])},removeCountdownPreset:e=>{const t=A.Z.get(Z.kClockCountdownPresets).filter((t=>t.id!==e));I.Z.set(Z.kClockCountdownPresets,t)}},K=G;class z extends m.Z{getInitialState(){return[]}reduce(e,t){switch(t.actionType){case"TIMER_INIT":return t.timers;case"TIMER_ADD":return e.concat(t.timer);case"TIMER_REMOVE":return e.filter((e=>e.id!==t.timerId));case"TIMER_REMOVE_EXPIRED":return e.filter((e=>t.timestamp<e.date));default:return e}}}const $=new z,Y=[];function X(){const e=A.Z.get(Z.kClockTimers);S.Z.dispatch({actionType:"TIMER_INIT",timers:e}),q(e),$.addListener((()=>{const e=$.getState();I.Z.set(Z.kClockTimers,e),q(e)}))}function Q(e,t){const s=new Date;if(e.date<s.valueOf()){const t=new Date(e.date);t.setDate(t.getDate()+1),e.date=t.valueOf()}S.Z.dispatch({actionType:"TIMER_ADD",timer:{...e,type:t,id:crypto.randomUUID()}})}function q(e){Y.forEach(clearTimeout),Y.length=0;for(const t of e){const e=t.date-Date.now();e>0&&Y.push(setTimeout((()=>{K.completeTimer(t)}),e))}}function J(e,t){if(!e)return;const s=new Date(e);return s.setSeconds(s.getSeconds()+t),s}function ee(){A.Z.get(Z.kDashboardEnabled)&&async function(){try{const e=await fetch("https://weather.vivaldi.com/cities/"),t=await e.json();if(t&&t.results&&t.results.length>0){const e=t.results.at(0);if(e&&e.id)return e.id}return 3413829}catch(e){return 0}}().then((e=>{if(e){S.Z.dispatch({actionType:"WEATHER_SET_DEFAULT_LOCATION",locationId:e}),te(e);for(const t of y.getState())"weather"===t.type&&0===t.locationId&&D(t.id,{locationId:e})}}))}function te(e){(async function(e){const t=F.ZP.UI_LANGUAGE.substring(0,2),s=await fetch(`https://weather.vivaldi.com/forecast/${e}.json.${t}`),n=await s.json(),i=Number(s.headers.get("cache-control")?.split("=")[1]);let a=[J(n.forecast.properties.meta.updated_at,21600),J(s.headers.get("last-modified"),isNaN(i)?21600:i)].filter(Boolean).sort().at(-1);if(!a){const e=new Date;e.setHours(e.getHours()+1),a=e}return a.setMinutes(a.getMinutes()+Math.floor(11*Math.random())),n.nextUpdate=a,n})(e).then((t=>{t&&S.Z.dispatch({actionType:"WEATHER_UPDATE",locationId:e,forecast:t})}))}s(44620);var se=s(39005),ne=s(48603),ie=s(2934),ae=s(47995),oe=s(27033),re=s(7064),le=s(29489);function de(){const e=oe.Z.getScripts();ce((({scripts:t})=>{const s=e.filter((e=>!t.includes(e))).map((e=>function(e){return`COMMAND_${(0,le.gD)(e).toUpperCase()}`.replace(/\s+/g,"_")}(e)));S.Z.dispatch({actionType:"CONTENT_SCRIPTS_UPDATED",updated:s,scripts:t})}))}function ce(e){re.Z.pageActions.getScripts((t=>{const s=t.map((e=>`COMMAND_${(0,le.gD)(e)}`.toUpperCase().replace(/\s+/g,"_")));e({scriptNames:s,scripts:t})}))}const he={loadPromise:function(){return re.Z.pageActions.onScriptsChanged.addListener(de),new Promise((e=>{ce((({scriptNames:t,scripts:s})=>{S.Z.dispatch({actionType:"CONTENT_SCRIPTS_INITIALIZE",scripts:s}),e()}))}))}};var ue=s(46382);function pe(e){return e.hasToken?"loggedIn":"invalid_credentials"===e.lastTokenFetchError.errorType?"loginFailed":0!==e.tokenRequestTime?"loggingIn":e.accountInfo.accountId?"credentialsMissing":"loggedOut"}class ge extends m.Z{getInitialState(){return{accountInfo:{accountId:"",username:"",pictureUrl:"",donationTier:""},hasSavedPassword:!1,hasToken:!1,accessToken:"",hasEncryptedToken:!1,tokenRequestTime:0,nextTokenRequestTime:0,lastTokenFetchError:{errorType:"no_error",serverMessage:"",errorCode:0},lastAccountInfoFetchError:{errorType:"no_error",serverMessage:"",errorCode:0},isReady:!1}}reduce(e,t){return"VIVALDI_ACCOUNT_STATE_UPDATED"===t.actionType?t.state:e}}const me=new ge;var fe=s(15489),ve=s(25372),be=s(24522);be.S;function Ce(e,t){return A.Z.get(Z.kStartupActiveDays).filter((s=>s>e&&s<=t)).length}var we=s(34155);const ye=e=>"EnableMailContextDialog"===e||"EnableCalendarContextDialog"===e||"EnableSyncContextDialog"===e||"CreateWorkspaceContextDialog"===e,xe={showing:!1,seen:!1};const Ie=new Map([["EnableMailContextDialog",{type:"url",extraCheck:e=>!1,domainInterest:["gmail.com","mail.google.com/mail/u/0","outlook.com","outlook.live.com/mail","yahoo.com/mail","login.yahoo.com","mail.yahoo.com","icloud.com/mail","protonmail.com","mail.proton.me/u/0/inbox","account.proton.me/mail","zoho.com/mail","mail.zoho.com","aol.com","login.aol.com","gmx.com","yandex.com","mail.yandex.com","mail.com","fastmail.com","fastmail.com/mail","tutanota.com","mail.tutanota.com","hushmail.com","hushmail.com/hushmail","mailfence.com","mailfence.com/mail","posteo.de/en","posteo.de/webmail","runbox.com","runbox.com/mail","startmail.com","webmail.startmail.com","kolabnow.com","kolabnow.com/webmail","mailbox.org/en","mailbox.org/login","soverin.net","soverin.net/webmail"]}],["EnableCalendarContextDialog",{type:"url",extraCheck:e=>!1,domainInterest:["calendar.google.com","workspace.google.com","outlook.live.com/calendar","icloud.com/calendar","calendar.yahoo.com","zoho.com/calendar","any.do/calendar","desktop.any.do/#/calendar","clickup.com/features/calendar","app.clickup.com/calendar","proton.me/calendar","calendar.proton.me"]}],["EnableSyncContextDialog",{type:"action",extraCheck:e=>"loggedOut"===pe(me.getState())&&A.Z.get(Z.kStartupActiveDays).length>1,action:function(e){const t=1*be.lb;function s(){we.nextTick((()=>{Ne.show(e)})),me.removeListener(s),clearTimeout(n)}const n=setTimeout((()=>{s()}),t);me.addListener(s)}}],["CreateWorkspaceContextDialog",{type:"action",extraCheck:e=>A.Z.get(Z.kWorkspacesEnabled)&&0===A.Z.get(Z.kWorkspacesList).length,action:e=>((e,t)=>{const s=e*be.lb;setTimeout((()=>{Ne.show(t)}),s)})(15,e)}]]);class Ae extends m.Z{saveStateToPrefs(e){const t={};e.dialogs.forEach(((e,s)=>{t[s]=e.seen})),I.Z.set(Z.kContextDialogsSeen,t)}constructor(){super(),A.Z.addListener(Z.kStartupActiveDays,(()=>{this.executeActionDialogs()}))}getInitialState(){const e=new Map;return Ie.forEach(((t,s)=>{e.set(s,xe)})),{isInitialized:!1,hasUnseenDialogs:!0,dialogs:e}}hasUnseenDialogsInterestedInURL(){return!1}getOnboardingDialogToShow(){const e=this.getState();if(!e.isInitialized||!e.hasUnseenDialogs)return null;for(const[t,s]of e.dialogs){if(s.showing||s.seen)continue;const n=Ie.get(t);if(n&&"onboarding"===n.type&&(!n.extraCheck||n.extraCheck(e)))return t}return null}getDialogInterestedInURL(e){return null}executeActionDialogs(){const e=this.getState();if(e.isInitialized&&e.hasUnseenDialogs)for(const[t,s]of e.dialogs){if(s.showing||s.seen)continue;const e=Ie.get(t);e&&"action"===e.type&&e.action&&e.action(t)}}showDialog(e,t){const s=this.getState();if(!s.isInitialized)return;const n=s.dialogs.get(e),i=Ie.get(e);if(n&&!n.showing&&!n.seen&&i&&(!i.extraCheck||i.extraCheck(s))){const s=fe.ZP.getActiveWindowId();we.nextTick((()=>ue.Z.showContextDialog(s,e,t)))}}reduce(e,t){switch(t.actionType){case"CONTEXTDIALOG_RESET":{const{id:s}=t;return(0,C.Uy)(e,(t=>{e.isInitialized&&(t.dialogs.set(s,xe),t.hasUnseenDialogs=!0,this.saveStateToPrefs(t))}))}case"CONTEXTDIALOG_RESET_ALL":return(0,C.Uy)(e,(e=>{Ie.forEach(((t,s)=>{e.dialogs.set(s,xe)})),e.hasUnseenDialogs=!0,this.saveStateToPrefs(e)}));case"CONTEXTDIALOG_SHOW_DIALOG":{const{id:s,force:n}=t;return(0,C.Uy)(e,(t=>{if(e.isInitialized){const e=t.dialogs.get(s)??{...xe};e.showing=!0,t.dialogs.set(s,e),this.showDialog(s,n)}}))}case"CONTEXTDIALOG_SHOWN":{const{id:s}=t;return(0,C.Uy)(e,(t=>{if(e.isInitialized){const e=t.dialogs.get(s)??{...xe};e.seen=!0,t.dialogs.set(s,e),t.hasUnseenDialogs=Array.from(t.dialogs).some((([e,t])=>!t.seen)),this.saveStateToPrefs(t)}}))}case"CONTEXTDIALOG_UPDATE_FROM_PREFS":return(0,C.Uy)(e,(e=>{const t=A.Z.get(Z.kContextDialogsSeen);Object.entries(t).forEach((([t,s])=>{if(ye(t)){const n=e.dialogs.get(t);n&&"boolean"==typeof s&&(n.seen=s,e.dialogs.set(t,n))}})),e.isInitialized=!0,e.hasUnseenDialogs=Array.from(e.dialogs).some((([e,t])=>!t.seen)),this.saveStateToPrefs(e)}))}return e}}const Se=new Ae;var Ze=s(96951),Te=s(16152);const Ee=(0,Te.Z)((function(){if(Se.hasUnseenDialogsInterestedInURL()){const e=fe.ZP.getActiveWindowId(),t=Ze.ZP.getActivePage(e);if(t){const e=Se.getDialogInterestedInURL(t.url);e&&S.Z.dispatch({actionType:"CONTEXTDIALOG_SHOW_DIALOG",id:e,force:!0})}}else Ze.ZP.removeListener(Ee)}),100);class ke{static contextDialogsBlocked=!1;init=async()=>{if(await re.Z.utilities.hasCommandLineSwitch("auto-test-mode"))return void(ke.contextDialogsBlocked=!0);Ze.ZP.addListener(Ee),this.updateFromPrefs();const e=Se.getOnboardingDialogToShow();e&&this.show(e),Se.executeActionDialogs()};show(e,t){ke.contextDialogsBlocked||S.Z.dispatch({actionType:"CONTEXTDIALOG_SHOW_DIALOG",id:e,force:t??!1})}shown(e){ke.contextDialogsBlocked||S.Z.dispatch({actionType:"CONTEXTDIALOG_SHOWN",id:e})}reset(e){ke.contextDialogsBlocked||S.Z.dispatch({actionType:"CONTEXTDIALOG_RESET",id:e})}resetAll(){ke.contextDialogsBlocked||S.Z.dispatch({actionType:"CONTEXTDIALOG_RESET_ALL"})}updateFromPrefs(){ke.contextDialogsBlocked||S.Z.dispatch({actionType:"CONTEXTDIALOG_UPDATE_FROM_PREFS"})}}const Ne=new ke;var _e=s(83784);const Pe=new class{loadPromise=async()=>{re.Z.extensionActionUtils.onAdded.addListener((e=>{this.onExtensionActionChanged(e)})),re.Z.extensionActionUtils.onRemoved.addListener((e=>{this.onExtensionActionRemoved(e)})),re.Z.extensionActionUtils.onUpdated.addListener((e=>{this.onExtensionActionChanged(e)})),re.Z.extensionActionUtils.onClearAllValuesForTab.addListener((function(e,t){S.Z.dispatch({actionType:"EXTENSION_ACTION_CLEAR_FOR_TAB",extensionId:e,tabId:t})}));const e=await re.Z.extensionActionUtils.getToolbarExtensions(),t=new Map,s=new Map;e.filter((e=>e.enabled)).forEach((e=>{s.set(e.tabId,e),t.set(e.id,s),this.onExtensionActionChanged(e)}))};onExtensionActionRemoved(e){S.Z.dispatch({actionType:"EXTENSION_ACTION_REMOVED",info:e})}onExtensionActionChanged(e){S.Z.dispatch({actionType:"EXTENSION_ACTION_UPDATED",info:e})}};var Me=s(87210);let De=!1;async function Oe(e){const t=V()().startOf("date"),s=V()().endOf("date"),n=await re.Z.historyPrivate.visitSearch({startTime:t.valueOf(),endTime:s.valueOf()});S.Z.dispatch({actionType:"HISTORY_LOAD",items:n,isToday:!0})}const je=(0,Te.Z)(Oe,2e3);const Le=new class{loadPromise=async()=>{await Oe(),n.Z.history.onVisited.addListener(je),re.Z.importData.onImportEnded.addListener((async()=>{De=!1,this.loadAll()}))};#i=async(e,t)=>{const s=await re.Z.historyPrivate.visitSearch({startTime:e.from,endTime:e.to});(s.length>0||t)&&S.Z.dispatch({actionType:"HISTORY_LOAD",items:s,resetCache:t})};async loadAll(){if(De)return;De=!0;const e="month",t=V()().endOf("d");for(let s=0;s<120;s++){const n=V()(t).subtract(s,e).endOf(0===s?"d":e),i=V()(n).startOf(e);await this.#i({to:n.valueOf(),from:i.valueOf()},0===s)}const s=V()().subtract(121,e).endOf(e),n=V()("1970-01-01");await this.#i({to:s.valueOf(),from:n.valueOf()})}deleteHistoryPromise(e){return S.Z.dispatch({actionType:"HISTORY_REMOVE_VISITS",visits:e}),Promise.all(e.map((e=>new Promise((t=>{if(e.isFolder){const s=V()(e.visitTime),i={startTime:V()(s.startOf("day")).valueOf(),endTime:V()(s.endOf("day")).valueOf()};n.Z.history.deleteRange(i,(()=>{t()}))}else{const s={time:e.visitTime,url:e.url||""};re.Z.historyPrivate.deleteVisits(s,(()=>{t()}))}})))))}removeLocalHistory(e){S.Z.dispatch({actionType:"HISTORY_REMOVE_AFTER",since:e})}};var Re=s(65792),Be=s.n(Re);class Fe extends m.Z{getInitialState(){return{lights:new Map,groups:new Map}}reduce(e,t){return"HUE_LIGHTS_UPDATE"===t.actionType?(0,C.Uy)(e,(e=>(e.groups=t.groups,e.lights=t.lights,e))):"HUE_LIGHTS_SET"===t.actionType?(0,C.Uy)(e,(t=>e||t)):e}}const We=new Fe;var Ue=s(37330);async function Ve(){const e=A.Z.get(Z.kHueBridgeIp),t=A.Z.get(Z.kHueUsername);if(!e||!t)return void S.Z.dispatch({actionType:"HUE_LIGHTS_UPDATE",groups:new Map,lights:new Map});const s=await fetch(`http://${e}/api/${t}/lights`);s.ok||console.warn(`Unable to retrieve lights from bridge at ${e}`);const n=await s.json(),i=new Map(Object.entries(n)),a=await fetch(`http://${e}/api/${t}/groups`);a.ok||console.warn(`Unable to retrieve lights from bridge at ${e}`);const o=await a.json(),r=new Map(Object.entries(o));for(const[e,t]of r){t.lights.map((e=>i.get(e))).some((e=>e?.capabilities?.control?.colorgamuttype))||r.delete(e)}S.Z.dispatch({actionType:"HUE_LIGHTS_UPDATE",groups:r,lights:i})}let He;function Ge(){const e=A.Z.get(Z.kHueBridgeIp),t=A.Z.get(Z.kHueUsername),s=A.Z.get(Z.kHueLights);if(!e||!t||!s)return;const n=fe.ZP.getLastActiveBrowserWindowId(),i=Ue.Z.getState().windowStyles.get(n)?.["--colorAccentBg"];if("string"!=typeof i)return;if(i===He)return;He=i;const a=function(e){let t=e.get("rgb.r"),s=e.get("rgb.g"),n=e.get("rgb.b");t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92,s=s>.04045?Math.pow((s+.055)/1.055,2.4):s/13.02,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92;const i=.664511*t+.154324*s+.162028*n,a=.283881*t+.668433*s+.047685*n,o=88e-6*t+.07231*s+.986039*n;return[i/(i+a+o),a/(i+a+o)]}(Be()(i)),o=`http://${e}/api/${t}`;for(const[e,t]of We.getState().lights)s.includes(t.uniqueid)&&fetch(`${o}/lights/${e}/state/`,{method:"put",body:JSON.stringify({transitiontime:3,xy:a})}).catch((e=>{console.warn("Unable to set Hue light",t.name,e)}))}async function Ke(e,t,s){switch(s){case Z.kHueEnabled:await Ve(),t?(Ge(),Ue.Z.addListener(Ge),fe.ZP.addListener(Ge)):(Ue.Z.removeListener(Ge),fe.ZP.removeListener(Ge));break;case Z.kHueLights:S.Z.dispatch({actionType:"HUE_LIGHTS_SET",lights:t})}}const ze={loadPromise:async function(){A.Z.addListener([Z.kHueEnabled,Z.kHueLights],Ke),A.Z.get(Z.kHueEnabled)&&await Ke(!1,!0,Z.kHueEnabled)},updateLights:Ve,flash:function(e){const t=A.Z.get(Z.kHueBridgeIp),s=A.Z.get(Z.kHueUsername);fetch(`http://${t}/api/${s}/lights/${e}/state`,{method:"put",body:JSON.stringify({alert:"select"})})}};var $e=s(16682),Ye=s(25795),Xe=s(45502),Qe=s(84451),qe=s(35369);class Je extends m.Z{getInitialState(){return{feature:"browser",hasActiveMessage:!1,hasMenu:!1,pageId:void 0,pages:(0,qe.aV)(),windowId:fe.Ex}}getHasActiveMessage(){return this.getState().hasActiveMessage}getHasMenu(){return this.getState().hasMenu}getName(){return"mac"}getPageId(){return this.getState().pageId}getPages(){return this.getState().pages}getWindowId(){return this.getState().windowId}reduce(e,t){switch(t.actionType){case"MACMENU_INIT":case"MACMENU_SET_WINDOW_ID":return(0,C.Uy)(e,(e=>{e.windowId=t.windowId}));case"MACMENU_SET_FEATURE":return(0,C.Uy)(e,(e=>{e.feature=t.feature}));case"MACMENU_SET_HAS_ACTIVE_MESSAGE":return(0,C.Uy)(e,(e=>{e.hasActiveMessage=t.hasActiveMessage}));case"MACMENU_SET_HAS_MENU":return(0,C.Uy)(e,(e=>{e.hasMenu=t.hasMenu}));case"MACMENU_SET_PAGE":return(0,C.Uy)(e,(e=>{e.pageId=t.pageId,e.pages=t.pages}));default:return this.getState()}}}const et=new Je(S.Z);var tt=s(32921),st=s(76747),nt=s(26591);const it=function(e,t){const s=st.Z.getShortcutSettings(),n=[],i=function(t){if(t.isVisible&&!t.isVisible(e,!1))return null;if(st.Z.isSeparator(t))return{type:"separator",name:"",action:"",withNoWindow:!0,id:-1};if("container"===t.type){const s=st.Z.getDisplayName(t);return t.container?{type:"container",name:s,action:t.container.content,edge:t.container.edge,withNoWindow:!0===t.withNoWindow,enabled:!t.isEnabled||t.isEnabled(e),id:-1}:null}{let a;t.url&&(a=nt.Z);const o="folder"===t.type?t.items?t.items.map(i).filter(Boolean):[]:null;if("folder"!==t.type&&!t.commandName)return console.warn("Menu element ignored. Not a folder nor a command"),null;const r=!t.isVisibleMac||t.isVisibleMac(e,!1),l=st.Z.getShortcut(t,s);return l.value&&!l.singleKey&&r&&(l.value.startsWith("Shift+")&&7===l.value.length||n.push(l.value.toLowerCase())),{type:t.type,name:st.Z.getDisplayName(t),action:t.commandName||"",withNoWindow:!0===t.withNoWindow,enabled:!t.isEnabled||t.isEnabled(e),id:-1,items:o,shortcut:l.value,checked:!(!t.checked||t.statestrings)&&t.checked,emphasized:t.emphasized,parameter:t.parameter,visible:r,url:t.url,icon:a}}};return{items:t.map(i).filter(Boolean),blockedShortcuts:n}};var at=s(34155);let ot,rt=[];function lt(e){switch(e){case"menu":at.nextTick((()=>{S.Z.dispatch({actionType:"MACMENU_SET_HAS_MENU",hasMenu:!0})}));break;case"menuState":case"shortcut":ft()}}function dt(){at.nextTick((()=>{const e=fe.ZP.getActiveWindowId();S.Z.dispatch({actionType:"MACMENU_SET_WINDOW_ID",windowId:e})}))}function ct(){at.nextTick((()=>{const e=et.getWindowId();if(fe.ZP.isActive(e)){const t=Ze.ZP.getActivePage(e)?.id;(et.getPageId()!==t||function(e,t){const s=Ze.ZP.getPages(e);return s.size!==t.size||t.some(((e,t)=>{const n=s.get(t);return e!==n&&(e.title!==n?.title||e.url!==n?.url)}))}(e,et.getPages()))&&S.Z.dispatch({actionType:"MACMENU_SET_PAGE",pageId:t,pages:Ze.ZP.getPages(e)})}}))}function ht(){at.nextTick((()=>{const e=Xe.Z.getContext(et.getWindowId()).feature;S.Z.dispatch({actionType:"MACMENU_SET_FEATURE",feature:e})}))}function ut(){at.nextTick((()=>{const e=et.getWindowId();if(fe.ZP.isActive(e)&&fe.ZP.isMail(e)){const e=Boolean(se.Z.getActiveMessage());S.Z.dispatch({actionType:"MACMENU_SET_HAS_ACTIVE_MESSAGE",hasActiveMessage:e})}}))}function pt(){const e=et.getWindowId();fe.ZP.isActive(e)&&!fe.ZP.isSettings(e)&&ft()}function gt(e){const t=e?e.filter(Boolean).map((e=>e.periodInMinutes)):[];rt.length===t.length&&rt.every(((e,s)=>e===t[s]))||(rt=t,fe.ZP.isActive(et.getWindowId())&&ft())}async function mt(){await re.Z.menubar.getHasWindows()||vt(fe.Ex)}function ft(){if(et.getHasMenu()){const e=et.getWindowId();e!==fe.Ex&&vt(e)}}function vt(e){void 0===ot?(ot=e,setTimeout((()=>{const t=Ye.Z.getNamedMenu(e,et.getName(),!0);if(void 0!==ot){const e=it(ot,t);re.Z.menubar.setup(e.items),Qe.Z.setBlockedShortcuts(e.blockedShortcuts)}ot=void 0}),100)):ot=e}new class{init(){if(!et.getHasMenu()){const e=fe.ZP.getActiveWindowId();S.Z.dispatch({actionType:"MACMENU_INIT",windowId:e}),et.addListener(ft),Ye.Z.addListener(lt),fe.ZP.addListener(dt,(e=>{const t=fe.ZP.getActiveWindowId();return{windowId:t,minimalUI:fe.ZP.isMinimalUI(t)}})),Ze.ZP.addListener(ct,(e=>e.get(et.getWindowId()))),Xe.Z.addListener(ht),se.Z.addListener(ut),A.Z.addListener([Z.kTabsStackingMode,Z.kPanelsWindowShowPinnedGroup,Z.kConfirmToQuitEnabled],pt),tt.Z.addListener(gt),n.Z.windows.onRemoved.addListener(mt),ae.Z.requestNamedMenu(et.getName())}}};var bt=s(98611),Ct=s(54162),wt=s(24367),yt=s(81538),xt=s(97297),It=s(78347),At=s(71320),St=s(10671),Zt=s(75401),Tt=s(84283),Et=s(89165),kt=s(95752),Nt=s(5863),_t=s(13248),Pt=s(19842);function Mt(e){const{enabledButtons:t}=e,{isJunkSelected:s,isNonJunkSelected:n,isDeletedSelected:i,isNonDeletedSelected:a,isArchivedSelected:o,isNonArchivedSelected:r,selectionCount:l,isOutboundSelected:d,isOutboxDraftsSelected:c,isReadSelected:h,isUnreadSelected:p,isArchivableSelected:g,isJunkableSelected:m}=function(){const e={isDeletedSelected:!1,isNonDeletedSelected:!1,isJunkSelected:!1,isNonJunkSelected:!1,isJunkableSelected:!1,isArchivedSelected:!1,isNonArchivedSelected:!1,isArchivableSelected:!1,isOutboundSelected:!1,isOutboxDraftsSelected:!1,isReadSelected:!1,isUnreadSelected:!1,selectionCount:0},t=function(){const e=fe.ZP.getActiveWindowId();if((0,Pt.Rr)(e)){const e=se.Z.getActiveListEntry();if(e)return[e.id]}else{const e=yt.Z.get(u.uP);if(e)return e.selectedIds.map((({id:e})=>e))}}();if(!t)return e;const s=[Nt.Nz,Nt.fZ,Nt.kY],n=[Nt.fZ,Nt.kY];for(const i of t){const t=bt.Z.getListEntry(i);if(!t)continue;e.selectionCount++;const{sourceFilterIds:a,sources:o,flags:r}=t;if(!e.isOutboundSelected){const t=At.Z.getByIds(a),n=St.Z.getFolderTypes(t);e.isOutboundSelected=s.some((e=>n.has(e)))}if(!e.isOutboxDraftsSelected){const t=At.Z.getByIds(a),s=St.Z.getFolderTypes(t);e.isOutboxDraftsSelected=n.some((e=>s.has(e)))}e.isDeletedSelected&&e.isNonDeletedSelected||(Tt.Z.isMessageDeleted(o)?e.isDeletedSelected=!0:e.isNonDeletedSelected=!0),e.isJunkSelected&&e.isNonJunkSelected&&e.isJunkableSelected||((0,Et.Z)(o,r)?(e.isJunkSelected=!0,e.isJunkableSelected=!0):(e.isNonJunkSelected=!0,!e.isJunkableSelected&&Dt(a,Nt.Hd)&&(e.isJunkableSelected=!0))),e.isArchivedSelected&&e.isNonArchivedSelected&&!e.isArchivableSelected||((0,Zt.Z)(o)?(e.isArchivedSelected=!0,e.isArchivableSelected=!0):(e.isNonArchivedSelected=!0,!e.isArchivableSelected&&(A.Z.get(Z.kMailAddArchiveFolder)?Ot(a):Dt(a,Nt.hn))&&(e.isArchivableSelected=!0))),e.isReadSelected&&e.isUnreadSelected||(kt.Z.call(o)?e.isReadSelected=!0:e.isUnreadSelected=!0)}return e}();if(0===l)return void t.clear();const f=1===l&&!d;t.set("MailMsgTrash",!(i&&a)),t.set("MailMsgSpam",m&&!(s&&n)),t.set("MailMsgArchive",g&&!(o&&r)),t.set("MailMsgReply",f),t.set("MailMsgReplyToAll",f),t.set("MailMsgFlag",!c),t.set("MailMsgLabel",!c),t.set("MailMsgStatusRead",!(h&&p))}function Dt(e,t){const s=At.Z.getByIds(e);return[...new Set(s.map((({accountId:e})=>e)))].some((e=>It.Z.getFoldersOfType(e,t).length>0))}function Ot(e){const t=At.Z.getByIds(e);return[...new Set(t.map((({accountId:e})=>e)))].some((e=>(0,_t.ZA)(e)))}function jt(e){const{hiddenButtons:t}=e,s=Ct.Z.getSelectedFolder();if(!s)return void t.clear();const{accountId:n,path:i}=s,a=St.Z.getFolderType(n,i),o=[Nt.kY,Nt.fZ].includes(a),r=[Nt.Nz,Nt.uT].includes(a),l=n===Nt.u4;t.set("MailMsgEdit",!o),t.set("MailMsgSpam",o||r||l),t.set("MailMsgArchive",o||r),t.set("MailMsgReply",o),t.set("MailMsgReplyToAll",o),t.set("MailMsgStatusRead",o||a===Nt.Nz),t.set("MailMsgFlag",o),t.set("MailMsgLabel",o)}class Lt extends m.Z{getInitialState(){return{enabledButtons:new Map,hiddenButtons:new Map}}reduce(e,t){switch(t.actionType){case"MAIL_SELECT_FOLDER":case"MAIL_REFRESH_ACTIVE_MESSAGE":case"MAIL_SET_ACTIVE_COMPONENT":return(0,C.Uy)(e,(e=>{Mt(e),jt(e)}));case"WINDOW_ACTIVATED":return wt.Z.isMailOn()?(0,C.Uy)(e,(e=>{Mt(e),jt(e)})):e;case"MAIL_STOP":return(0,C.Uy)(e,(e=>{e.enabledButtons.clear(),e.hiddenButtons.clear()}));default:return e}}isEnabled(e){if(""!==xt.Z.getState())return!0;const{enabledButtons:t}=this.getState();return t.get(e)??!1}isHidden(e){if(""!==xt.Z.getState())return!1;const{hiddenButtons:t}=this.getState();return t.get(e)??!1}}const Rt=new Lt;var Bt=s(47513),Ft=s.n(Bt),Wt=s(51501),Ut=s(51733);function Vt(e){return e===Nt.of?Nt.ik:Nt.Gf}function Ht(e,t,s){const n=bt.Z.getByFolder(e,t);n&&(s.has(e)||s.set(e,new Map),s.get(e)?.set(t,Wt.ZP.getViewIntersections(n)))}function Gt(e){const t=new Map;for(const{accountId:s}of e.mailWidgets)s&&Ht(s,Vt(s),t);for(const{feedId:s}of e.feedWidgets)if(s){const e=s===Nt.of?Nt.ym:s;Ht(Nt.u4,e,t)}t.has(Nt.of)||Ht(Nt.of,Nt.ik,t);const s=A.Z.get(Z.kMailStatusSelectedAccount);return s&&!t.has(s)&&Ht(s,Vt(s),t),t}function Kt(e,t){for(const s of t.values())for(const t of s.values())if(t){const s=t.findIndex((t=>t.id===e));s>=0&&t.splice(s,1)}}function zt(e,t,s){for(const[n,i]of t)for(const[t,a]of i){const i=s.get(n)?.get(t);if(i){const t=i.findIndex((t=>t.id===e));t>=0&&(bt.Z.matchesViewIntersection(i[t].viewIds,a)||i.splice(t,1))}}}function $t(e,t,s){const n=bt.Z.getListEntry(e);if(n)for(const[e,i]of t)for(const[t,a]of i)if(bt.Z.matchesViewIntersection(n.viewIds,a)){const i=s.get(e)?.get(t);if(i){const a=Ft()(i,n,((e,t)=>t.sentDate-e.sentDate));a<0&&i.splice(-a-1,0,n),s.get(e)?.set(t,i)}else s.has(e)||s.set(e,new Map),s.get(e)?.set(t,[n])}}function Yt(e){return e.filter((e=>"email"===e.type&&e.accountId!==b.$c))}function Xt(e){return e.filter((e=>"feed"===e.type&&!!e.feedId))}class Qt extends m.Z{getInitialState(){return{isInitialized:!1,items:new Map,mailWidgets:[],feedWidgets:[]}}reduce(e,t){switch(t.actionType){case"MAIL_INIT_INDEX_BATCH":{const{viewIdsBatch:s}=t,n=Gt(e),i=structuredClone(e.items);for(const{searchListId:e}of s)$t(e,n,i);return{...e,items:this.trimLists(i)}}case"MAIL_INIT_INDEX_FINISHED":return{...e,isInitialized:!0};case"MAIL_INDEX_UPDATE":{const{sleUpdates:s,removedSles:n,addedSles:i}=t.updates;if(s||n||i){const t=structuredClone(e.items);if(n)for(const e of n)Kt(e,t);if(s){const n=Gt(e),i=new Set(s.map((({id:e})=>e)));for(const e of t.values())for(const t of e.values())for(let e=0;e<t.length;e++)if(i.has(t[e].id)){const s=bt.Z.getListEntry(t[e].id);s&&(t[e]=s)}for(const e of s){const{addedViewIds:s,removedViewIds:i}=e.updates;Array.isArray(i)&&i.length>0&&zt(e.id,n,t),Array.isArray(s)&&s.length>0&&$t(e.id,n,t)}}if(i){const e=Xt(y.getState()).map((e=>e.feedId));for(const s of i){const n=bt.Z.getListEntry(s.id),i=At.Z.getByIds(s.sourceFilterIds);for(const a of i)a.accountId===Nt.u4&&e.some((e=>e===a.path))&&(n?t.get(Nt.u4)?.has(a.path)?t.get(Nt.u4)?.get(a.path)?.push(n):t.has(Nt.u4)?t.get(Nt.u4)?.set(a.path,[n]):t.set(Nt.u4,new Map([[a.path,[n]]])):console.error("List entry not found!",s.id))}}return{...e,items:this.trimLists(t)}}return e}case"DASHBOARD_INIT":return{...e,mailWidgets:Yt(t.widgets),feedWidgets:Xt(t.widgets)};case"DASHBOARD_REMOVE_WIDGET":{const t=y.getState();return{...e,mailWidgets:Yt(t),feedWidgets:Xt(t)}}case"DASHBOARD_ADD_WIDGET":{const s=y.getState(),n=Yt(s),i=Xt(s),{options:a}=t,o=a?.feedId;if(o){const t=o===Nt.of?Nt.ym:o;if(e.items.get(Nt.u4)?.has(t))return{...e,feedWidgets:i};{const s=bt.Z.getListEntriesByFolder(Nt.u4,t),n=structuredClone(e.items);return n.has(Nt.u4)?n.get(Nt.u4)?.set(t,s):n.set(Nt.u4,new Map([[t,s]])),{...e,items:this.trimLists(n),feedWidgets:i}}}return{...e,mailWidgets:n}}case"DASHBOARD_UPDATE_WIDGET":{const{widgetId:s,accountId:n,feedId:i}=t;if(n){const t=[...e.mailWidgets],i=e.mailWidgets.findIndex((e=>e.id===s));if(i>-1){const s=e.mailWidgets[i];"email"===s.type&&t.splice(i,1,{...s,accountId:n})}if(e.items.has(n))return{...e,mailWidgets:t};{const s=Vt(n),i=bt.Z.getListEntriesByFolder(n,s),a=structuredClone(e.items);return a.set(n,new Map([[s,i]])),{...e,items:this.trimLists(a),mailWidgets:t}}}if(i){const t=[...e.feedWidgets],n=e.feedWidgets.findIndex((e=>e.id===s));if(n>-1){const s=e.feedWidgets[n];"feed"===s.type&&t.splice(n,1,{...s,feedId:i})}const a=i===Nt.of?Nt.ym:i;if(e.items.get(Nt.u4)?.has(a))return{...e,feedWidgets:t};{const s=bt.Z.getListEntriesByFolder(Nt.u4,a),n=structuredClone(e.items);return n.has(Nt.u4)?n.get(Nt.u4)?.set(a,s):n.set(Nt.u4,new Map([[a,s]])),{...e,items:this.trimLists(n),feedWidgets:t}}}return e}case"MAIL_LATEST_POPULATE":{const{accountId:s,path:n}=t,i=bt.Z.getListEntriesByFolder(s,n),a=structuredClone(e.items);return a.has(s)?a.get(s)?.set(n,i):a.set(s,new Map([[n,i]])),{...e,items:this.trimLists(a)}}case"MAIL_STOP":return this.getInitialState();default:return e}}getList(e,t){return this.getState().items.get(e)?.get(t)||[]}hasList(e){return this.getState().items.has(e)}isInitialized(){return this.getState().isInitialized}trimLists(e,t=b.bb){const s=new Map;for(const[n,i]of e){s.set(n,new Map);for(const[e,a]of i)s.get(n)?.set(e,a.sort((0,Ut.g4)(Ut.rQ)).slice(0,t))}return s}}const qt=new Qt;var Jt=s(39045),es=s(2711),ts=s(3184),ss=s(97698),ns=s(2431),is=s(75459),as=s(82227),os=s(31857),rs=s(48868),ls=s(45660),ds=s(21285),cs=s(61839);async function hs(e,t){const s=(0,Wt.CR)(e);if(s){const{addedSles:e,forSearchDb:n}=await(0,ds.Z)(Nt.u4,s.path,Nt.Oi,t);return(0,cs.Z)(n),e}return ls.Z.error("Feeds",["Add items"],`Filter not found when adding feed items for feed ${e}`),[]}const us=async function(e){return await rs.Z.deletedFeedItems.where("feedId").equals(e).toArray()};const ps=async function(e){return await rs.Z.searchList.where("messageId").anyOf(e).toArray()};var gs=s(24651),ms=s(5204),fs=s(40382),vs=s(44850),bs=s(34155);async function Cs(e,t){const s=At.Z.getByFolderId([Nt.u4,t]);if(!s){const s=t.split("/").filter((e=>e!==Nt.ym));if(s.length>1){let e=s[0];for(let t=1;t<s.length;t++){if(!At.Z.getByFolderId([Nt.u4,e])){const t={name:e,accountId:Nt.u4,path:e,filterValue:{include:[],...Wt.ZP.getSearchListButtons(Nt.u4),showSubFolders:!0}};await d.Z.addFilter(t,!1)}e+="/"+s[t]}}const n={name:e,accountId:Nt.u4,path:t,filterValue:{include:[[{accountId:Nt.u4},{path:t}]],...Wt.ZP.getSearchListButtons(Nt.u4)}},i=await d.Z.addFilter(n,!1);return{...n,id:i[0]}}return s}function ws(e,t){const s=t.length,n=os.Z.adjustBatchSize.bind(void 0,10,100,500);let i,a=10,o=0;return new Promise(((r,l)=>{bs.nextTick((function l(){const c=t.slice(o,o+a);o+=a,o>s&&(o=s);const p=Date.now();if(0===c.length)return r(i),Promise.resolve();return async function(e,t){const s=t.map((e=>e.messageId)),n=new Set(t.map((e=>e.subject)));let i=[],a=[];await rs.Z.transaction("rw",ds.E.concat([rs.Z.deletedFeedItems]),(async()=>{let o=await ps(s);o=o.filter((e=>n.has(e.subject)));const r=await us(e),l=new Set;for(const e of o)l.add(e.messageId);for(const e of r)l.add(e.messageId);a=t.filter((e=>!l.has(e.messageId))),0!==a.length&&(i=await hs(e,a))})),d.Z.updateIndex({addedSles:i});for(const e of a){const t=i.find((t=>t.messageId===e.messageId&&t.subject===e.subject));if(!t)throw new Error(`searchListEntry and message for rss out of sync. Subject: ${e.subject}`);await(0,fs.Z)(Nt.u4,e.sentDate,t.id,e.raw),await gs.Z.setHasRaw(Nt.u4,t.id)}return i[0]}(e,c).then((t=>{t&&!i?i=t:t&&h.Z.setStatus(u.A4,(0,W.Z)("Loading feed $1: $2/$3",[e,o,s]));const r=Date.now();a=n(a,r-p)})).then((()=>bs.nextTick(l)))}))}))}var ys=s(95617);async function xs(e){wt.Z.ensureFeedsIsOn();const t=A.Z.get(Z.kRssSettings),s=e.filter((e=>!t.some((t=>t.url===e.url))));if(s.length){if(s.some((e=>!e.feedId)))throw new Error("RssSettingsActions.add: Expected GUID feedId");const e=s.map((e=>(0,ys.Z)(e,"path")));I.Z.set(Z.kRssSettings,[...t,...e]);for(const e of s)await Cs(e.title||e.url,e.path||e.feedId);return await Ls.poll(e,!0),e}return[]}function Is(e){const t=A.Z.get(Z.kRssSettings);try{const s=(0,Wt.CR)(e);if(!s)return void console.error("Feed filter not found for feed",e);d.Z.removeAccountPath(Nt.u4,s.path);const n=t.findIndex((t=>t.feedId===e));if(-1===n)throw`RssSettingsActions.removeFeed: feedId ${e} not found in prefs`;{const e=[...t];e.splice(n,1),I.Z.set(Z.kRssSettings,e)}}catch(e){console.error(e)}}async function As(e,t){const s=(0,Wt.CR)(e.feedId);if(!s)return void console.error("Feed filter not found for feed",e.url);if(s.name!==e.title){const t=await as.Z.put({...s,name:e.title});At.Z.updateFilters(t)}const n=A.Z.get(Z.kRssSettings).slice();n[t]=e,I.Z.set(Z.kRssSettings,n)}function Ss(e,t,s){for(const n of[e,t,s]){const e=n.filter(((e,t,s)=>e.email&&t===s.findIndex((t=>t.email===e.email))));if(e.length>0)return e.map((e=>({name:e.name?e.name:e.email,address:e.email})))}return[]}var Zs=s(77150),Ts=s.n(Zs),Es=s(4111);function ks(e){let t=new Date(e);return Ns(t)||(t=_s(e)),t}const Ns=e=>e instanceof Date&&!isNaN(e),_s=(e="")=>new Date(e.trim().replace(/\b[a-z]+$/i,(e=>Es.Z[e.toUpperCase()]||"+0000")));var Ps=s(76085),Ms=s(11472);function Ds(e,t){return e.id+(t.pubDate?e.publishdate:e.updatedate)+e.links.alternate.map((e=>e.url)).join(" | ")}function Os(e,t){const s=e.url,i=e.cacheLastModified,a=e.cacheETag,o="string"==typeof i||"string"==typeof a,r=new XMLHttpRequest,l=["application/atom+xml","application/rss+xml","application/rdf+xml;q=0.8","application/xml;q=0.6","text/xml;q=0.6","text/*;q=0.4"];return new Promise(((e,n)=>{r.overrideMimeType("text/xml"),r.open("GET",s,!0),r.setRequestHeader("Accept",l.join(", ")),t?r.setRequestHeader("Cache-Control","max-age=0"):o&&("string"==typeof i&&r.setRequestHeader("If-Modified-Since",i),"string"==typeof a&&r.setRequestHeader("If-None-Match",a)),r.onload=function(){if(r.status>=400)return;const l=isNaN(Date.parse(r.getResponseHeader("Last-Modified")))?null:r.getResponseHeader("Last-Modified"),d=r.getResponseHeader("ETag");if((!t||!o)&&(304===r.status||"string"==typeof i&&"string"==typeof l&&new Date(i)===new Date(l)||"string"==typeof d&&a===d))return e({cacheRevalidated:!0});let c=r.responseURL;/^(https?|ftp|file):/i.test(c)||(c=s);try{let{responseXML:t}=r;if(null===t){if(/^\s{0,10}<(\!doctype\ )?html/i.test(r.responseText))return n((0,W.Z)("Received HTML instead of the expected XML feed."));/^\s/.test(r.responseText)&&(t=(new DOMParser).parseFromString(r.responseText.trim(),"text/xml"))}const s=(0,Ps.t5)(t,r.responseText,c);"string"==typeof s?n(s):e({parsedFeed:s,lastModified:l,eTag:d})}catch(e){n(e)}},r.onreadystatechange=()=>{r.status>=400&&n(r.status)},r.onerror=r.onabort=function(e){n(e)},r.send()})).then((t=>{const i=A.Z.get(Z.kRssSettings),a=i.findIndex((t=>t.url===e.url));if(-1===a)return Promise.reject("Feed deleted");const o={...i[a]};if(t.cacheRevalidated)return o.lastChecked=(new Date).valueOf(),As(o,a),Promise.resolve();const r=t.parsedFeed,l={pubDate:!1};/^https?:\/\/(\w+\.)?youtube\.com\//i.test(s)&&(l.pubDate=!0);const d=r.plaintitle||new URL(o.url).hostname;o.title&&!["Atom","Feed","RSS","RSS 2.0"].includes(o.title)||(o.title=d);const p=r.feeditems.map((t=>({accountId:Nt.u4,feedId:e.url,subject:t.plaintitle,bodyParts:(0,Ms.O)(t),raw:t.xmloriginal,sentDate:ks(t.updatedate).getTime()||0,messageId:Ts()(Ds(t,l)),from:[{name:d,address:d}],replyTo:Ss(t.people.author.concat(t.people.contributor),r.people.author.concat(r.people.contributor),r.people.managingeditor.concat(r.people.webmaster)),to:[],cc:[],flags:[],internal:!0})));return async function(e,t,s){const i=s.length,a=await ws(t,s);if(!a)return;const o=()=>{const e=["message",a.id].join("/"),t=vs.jk.internalUrl("mailpage",e,a.subject),s=fe.ZP.getMailWindowId();c.ZP.openURL(s,t),n.Z.windows.update(s,{drawAttention:!0})};if(A.Z.get(Z.kRssShowNotifications)){const t=(0,W.Z)("$1 New Feed from $2","$1 New Feeds from $2",[i,e]);(0,H.c)({title:a.subject,body:t,icon:"resources/mail_notification_icon.png",onClick:o,tag:"VIVALDI_IMPORT_RSS_FEEDS"})}h.Z.setStatus(u.A4,(0,W.Z)("Finished loading feed $2. $1 message loaded","Finished loading feed $2. $1 messages loaded",[i,e]),Nt.QM),ms.Z.filter()}(o.title,o.feedId,p).then((()=>{const e=(new Date).valueOf();o.lastChecked=e,o.lastParsed=e,o.errorCount="number"==typeof o.errorCount&&o.errorCount>=5?Math.round(.8*o.errorCount):0,o.cacheLastModified=t.lastModified,o.cacheETag=t.eTag,As(o,a)}))})).catch((t=>{const n=A.Z.get(Z.kRssSettings),i=n.findIndex((t=>t.url===e.url));if(i>-1){const e={...n[i]};e&&navigator.onLine&&(e.lastChecked=(new Date).valueOf(),e.errorCount="number"==typeof e.errorCount?e.errorCount+1:1,As(e,i))}t instanceof Error?ls.Z.error("Mail",["feeds","parsing"],(0,W.Z)("Encountered an error when parsing feed $1",[s]),t):ls.Z.warn("Mail",["feeds","loading"],(0,W.Z)("Failed to load feed $1",[s]),t)}))}var js=s(34155);const Ls=new class{#a;async poll(e=A.Z.get(Z.kRssSettings),t=!1){if(!navigator.onLine)return;const s=(new Date).valueOf(),n=e.filter((e=>{if(t)return!e.offline;let{refreshInterval:n,lastChecked:i=0,offline:a,errorCount:o=0}=e;n=Math.max(n,15);const r=Math.min(60480,0===o?n:n+15*o);return!a&&s>=6e4*r+i})),i=new Document,a=i.createElement("link");a.rel="preconnect",i.appendChild(a);const o=Date.now();for(const e of n){if(!navigator.onLine)break;const s=n.indexOf(e);let i=t;if(s<n.length-2){const e=n[s+1];a.href=e.url}if(!i&&"number"==typeof e.lastParsed&&e.lastParsed>0){const t=new Date(e.lastParsed);t.setDate(t.getDate()+14)<=o&&(i=!0)}await Os(e,i)}}forceRefreshAllRSSAccounts(){const e=A.Z.get(Z.kRssSettings);e.length>0&&this.poll(e,!0)}_onPrefsChanged=(e,t)=>{0===e.length&&t.length>0?(void 0!==this.#a&&(ls.Z.warn("Feeds",["RSSStartup"],"Did not expect an existing polling interval ID"),clearInterval(this.#a)),this.#a=setInterval((()=>this.poll()),6e4),js.nextTick((()=>this.poll()))):e.length>0&&0===t.length&&(clearInterval(this.#a),this.#a=void 0)};start(){A.Z.addListener(Z.kRssSettings,this._onPrefsChanged),this._onPrefsChanged([],A.Z.get(Z.kRssSettings))}stop(){A.Z.removeListener(Z.kRssSettings,this._onPrefsChanged),clearInterval(this.#a),this.#a=void 0}};var Rs=s(80822),Bs=s(54773),Fs=s(95538),Ws=s(51370),Us=s(32593),Vs=s(83065);async function Hs(e){for(const t of e){const e=[t,""],s=[t,"￿"],n={Inbox:[],Drafts:[],All:[],Flagged:[],Sent:[],Trash:[],Junk:[],Archive:[],Other:[]},i=(await rs.Z.filters.where("[accountId+path]").between(e,s).toArray()).map((e=>e.path));let a=".";for(const e of i){if(e===Nt.ym)continue;e.indexOf("/")>-1&&(a="/");let t=(0,Vs.kF)(e);if(e.indexOf(a)>-1){const s=e.split(a);t=(0,Vs.kF)(s[s.length-1])}const s=(0,Us.C7)(e),i={path:e,name:t,type:s,delimiter:a};n[s]?n[s].push(i):n[s]=[i]}await Jt.Z.add(t,n),await It.Z.addAccounts({[t]:{folders:n}})}}var Gs=s(63164);function Ks(){const e=A.Z.get(Z.kMailCheckInterval);"one_minute"===e?(ts.Z.setCheckInterval(!0,1),is.Z.setCheckInterval(!0,1)):"fifteen_minutes"===e?(ts.Z.setCheckInterval(!0,15),is.Z.setCheckInterval(!0,15)):(ts.Z.setCheckInterval(!1),is.Z.setCheckInterval(!1))}function zs(){d.Z.sortListEntries()}function $s(e){d.Z.sortListEntries()}function Ys(e){const t=(0,Ws.Z)(e);ns.Z.createDraft(t)}const Xs={async startPortalLoad(){if(n.Z.extension.inIncognitoContext)return;d.Z.init(),await async function(){const{dbVersion:e,migrationNeeded:t}=await re.Z.mailPrivate.getDBVersion();if(3!==e||!t)return;function s(e,t,s){const n=0===t?0:Math.floor(e/t*100),i=0===t?"":`${(0,F.uf)(e)} / ${(0,F.uf)(t)} - ${n}%.`;ls.Z.log("Mail",["migrate search db"],`${s} ${i}`),h.Z.setPersistentStatus(u.A4,"MAIL_SEARCH_MIGRATION",`${s} ${i}`)}ls.Z.log("Mail",["migrate search db"],"Starting migration"),re.Z.mailPrivate.onUpgradeProgress.addListener(s);const n=await re.Z.mailPrivate.startMigration();if(h.Z.clearPersistentStatus(u.A4,"MAIL_SEARCH_MIGRATION"),re.Z.mailPrivate.onUpgradeProgress.removeListener(s),!n){const e="migratateSearchData: Irrecoverable failure.     Make sure there is enough disk space on your computer.     Please close Vivaldi, delete the files: MailSearchDB & MailSearchDB-journal     and MailDB & MailDB-journal     from your profile directory and start again. Click the Mail Status button     in Status Bar, click the cog wheel in the top right corner and select     Rebuild Mail Search Database.";throw h.Z.setStatus(u.A4,"Error migrating search data. Please check the logs in     Mail Status button for more info"),ls.Z.error("Mail",["migrateMailSearch"],e),new Error(e)}}(),es.Z.startBackgroundActions(),(0,Gs.Tg)((async(e,t)=>{t.tab?.id&&"FEEDS_ADD"===e.type&&ue.Z.showAddFeed(t.tab.windowId,{feeds:e.feeds})}));const e=new SharedWorker("bundle-mailreader-worker.js");async function t(){ls.Z.debug("Mail",["startup"],"Starting up..."),h.Z.setPersistentStatus(u.A4,"MAIL_STARTUP",(0,W.Z)("Mail client starting...")),A.Z.addListener(Z.kMailCheckInterval,Ks),A.Z.addListener(Z.kMailSearchSortField,$s),A.Z.addListener(Z.kMailSearchSortFieldSent,$s),A.Z.addListener(Z.kMailSearchSortFieldPerFolder,$s),A.Z.addListener(Z.kMailSearchSortOrder,zs),re.Z.calendar.onMailtoOpened.addListener(Ys);try{try{h.Z.setPersistentStatus(u.A4,"MAIL_DB_OPEN",(0,W.Z)("Waiting for Mail to start…")),await(navigator.serviceWorker?.ready),h.Z.setPersistentStatus(u.A4,"MAIL_DB_OPEN",(0,W.Z)("Loading mail database…")),await rs.Z.open()}catch(e){return"VersionError"===e.name&&(e.message=(0,W.Z)("Your mail database was created with a newer version of Vivaldi. Please upgrade Vivaldi.")),ls.Z.error("Mail",["startup"],e),r.Z.set("INTERNAL","DATABASE",e,"MAIL_DB_OPEN_FAILED","CRITICAL"),void h.Z.setPersistentStatus(u.A4,"MAIL_DB_OPEN_FAILED",(0,W.Z)("Error: Failed to open mail database!"))}finally{h.Z.clearPersistentStatus(u.A4,"MAIL_DB_OPEN")}await Promise.all([Jt.Z.getAccountsAndFolders().then((e=>Promise.all([It.Z.initAccounts(e.accounts),St.Z.initFolders(e.folders)]))),Fs.Z.initMailingLists(),At.Z.initFilters(),es.Z.start(),d.Z.initIndex(),o.Z.initialize()])}catch(e){return ls.Z.error("Mail",["startup"],e),s(),void h.Z.setPersistentStatus(u.A4,"MAIL_STARTUP_FAILED",(0,W.Z)("Mail client startup failed. Error: $1",[e.message||e]))}finally{h.Z.clearPersistentStatus(u.A4,"MAIL_STARTUP")}if((await rs.Z.systemTasks.toArray()).find((e=>"restore_mail_db"===e.taskName)))ls.Z.warn("Mail",["startup"],"Resume restoration of mail DB!"),(0,H.c)({title:(0,W.Z)("Resuming restoration of Mail DB"),tag:"MAIL_DB_RESTORATION"}),await es.Z.runSystemTasks();else if(A.Z.get(Z.kMailAccounts).filter((e=>!e.isDeleted)).length>Object.keys(It.Z.accounts).length){if(0===await rs.Z.messages.count())return ls.Z.warn("Mail",["startup"],"No mail accounts and no messages found in DB but accounts exist in Prefs. Restore mail DB!"),(0,H.c)({title:(0,W.Z)("Mail DB missing! Starting restoration!"),tag:"MAIL_DB_RESTORATION"}),await rs.Z.systemTasks.add({taskName:"restore_mail_db"}),void await es.Z.runSystemTasks();ls.Z.warn("Mail",["startup"],"Some mail accounts missing from DB and will be restored based on info in settings"),await Hs(A.Z.get(Z.kMailAccounts).filter((e=>!e.isDeleted)).map((e=>e.MAIL_EMAIL)))}!async function(){const{result:e,message:t}=await re.Z.mailPrivate.checkMailSearchDBHealth();e||await async function(e){ls.Z.error("Mail",["startup"],"Error detected in mail search db.",e);const t={title:(0,W.Z)("title","Error in Mail Search Database!"),body:(0,W.Z)("The database for full-text search needs to be rebuilt. Should it be done now or at a later restart?"),actions:[{title:(0,W.Z)("Rebuild Now"),action:"confirm",default:!0}],cancelAction:{title:(0,W.Z)("Rebuild Later"),action:"cancel"}},{action:s}=await ue.Z.showModal(fe.ZP.getMailWindowId(),{modal:t});"confirm"===s?(ls.Z.log("Mail",["startup"],"Starting rebuild of mail search db."),await d.Z.restoreFullTextSearchDb()):ls.Z.warn("Mail",["startup"],"User opted out of rebuilding the mail search db.")}(t)}(),Ls.start();const e=Rs.Z.getSync("FOLDER_SELECTION");d.Z.selectFolder(e),ms.Z.filter(),es.Z.updateFlags(),es.Z.updateThreads(),es.Z.runSystemTasks(),Ks(),ts.Z.startAddtoSearchDb(),window.addEventListener("online",Qs,!1),h.Z.setStatus(u.A4,(0,W.Z)("Mail client started"),Nt.QM),ls.Z.debug("Mail",["startup"],"Startup complete")}async function s(){ls.Z.debug("Mail",["startup"],"Shutting down..."),Ls.stop(),ts.Z.setCheckInterval(!1),is.Z.setCheckInterval(!1),A.Z.removeListener(Z.kMailCheckInterval,Ks),A.Z.removeListener(Z.kMailSearchSortField,$s),A.Z.removeListener(Z.kMailSearchSortFieldSent,$s),A.Z.removeListener(Z.kMailSearchSortFieldPerFolder,$s),A.Z.removeListener(Z.kMailSearchSortOrder,zs),re.Z.calendar.onMailtoOpened.removeListener(Ys),window.removeEventListener("online",Qs,!1),ns.Z.closeMailPages(),await ts.Z.disconnectIMAPClients(),It.Z.clear(),Fs.Z.clear(),At.Z.clear(),St.Z.clear(),Bs.Z.clear(),d.Z.stop(),es.Z.stop(),ls.Z.debug("Mail",["startup"],"Shutdown complete")}async function i(e,n,i){switch(i){case Z.kFeaturesFeeds:(A.Z.get(Z.kMailAccounts).length>0||A.Z.get(Z.kRssSettings).length>0)&&(n?(await t(),navigator.onLine&&Qs()):s());break;case Z.kMailAccounts:if(!wt.Z.isMailOn())break;e.length>0&&0===n.length?(0===A.Z.get(Z.kRssSettings).length&&s(),I.Z.set(Z.kMailMailtoInVivaldi,!1)):0===e.length&&n.length>0&&(await t(),I.Z.set(Z.kMailMailtoInVivaldi,!0));break;case Z.kRssSettings:wt.Z.isFeedsOn()&&0===A.Z.get(Z.kMailAccounts).length&&(e.length>0&&0===n.length?s():0===e.length&&n.length>0&&await t())}}return e.onerror=console.error,navigator.serviceWorker?.ready.then((t=>{t.active?.postMessage({setupMailreaderOnBackground:!0},[e.port])})),A.Z.addListener([Z.kFeaturesFeeds,Z.kMailAccounts,Z.kRssSettings],i),wt.Z.isFeedsOn()?i(!1,!0,Z.kFeaturesFeeds):void 0}};async function Qs(){ls.Z.info("Mail",["startup"],"onOnline event fired");const e=fe.ZP.getMailWindowId();e!==u.Ex&&ss.Z.sendAll(e,!1),await Promise.all([ts.Z.connectIMAPClients(),is.Z.checkForMail()]),es.Z.flushBuffer()}const qs=Xs;var Js=s(21838),en=s(18350),tn=s(15285),sn=s(14481);let nn=!1;const an="#000000";let on,rn=an,ln=an;const dn={_onPrefsCacheChanged:function(e,t,s){s===Z.kRazerChromaEnabled&&!0===t&&dn.init()},isInitialized:function(){return nn},setInitCallback:function(e){on=e},onChromaReady:function(){nn||(nn=!0,ln!==an&&(dn.setColor(ln),ln=an),on&&on(),re.Z.utilities.onRazerChromaReady.removeListener(this.onChromaReady),Ue.Z.addListener(this.onColorUpdated),fe.ZP.addListener(this.onColorUpdated))},init:function(){nn=!1,A.Z.addListener([Z.kRazerChromaEnabled],this._onPrefsCacheChanged),re.Z.utilities.onRazerChromaReady.addListener(this.onChromaReady),re.Z.utilities.isRazerChromaReady((e=>{e&&this.onChromaReady()}))},onColorUpdated:function(){const e=fe.ZP.getLastActiveBrowserWindowId(),t=Ue.Z.getState().windowStyles.get(e)?.["--colorAccentBg"];"string"==typeof t&&dn.setColor(t)},setColor:function(e){if(!nn)return void(ln=e);if(rn===e)return;rn=e;let t=Be()(e);const[,,s]=t.hsl();s<.1&&(t=t.brighten(1));const n=[],i=Be().bezier([rn,t.toString()]);for(let e=1;e<11;e++){const[t,s,a]=i(e/10).rgb();n.push({red:t,green:s,blue:a})}re.Z.utilities.setRazerChromaColor(n,(e=>{e||console.warn("Error setting Razer Chroma color")}))}},cn=dn;var hn=s(92413);const un=new class{resetRssFeeds(e){S.Z.dispatch({actionType:"RSS_CLEAR_FEEDS",tabId:e})}initPortalDocument(){(0,Gs.Tg)(((t,s,n)=>{if(!s.tab?.id)return;const i=s.tab.id;switch(t.type){case"FEEDS_REMOVE_THIS_PREVIEW":(0,Gs.VN)(i,{type:"FEEDS_REMOVE_PREVIEW"});break;case"FEEDS_GET_TAB_URL":n(s.tab.url);break;case"FEEDS_GET_CONTENT_TYPE":n(e.get(i)??"");break;case"FEEDS_ADD_DETECTED":S.Z.dispatch({actionType:"RSS_FEEDS_FOUND",tabId:i,feeds:t.feeds});break;case"FEEDS_ADD":const a=t.feeds.reduce(((e,t)=>(t.url&&e.push({url:t.url,title:t.title??t.url,type:"RSS"}),e)),[]);S.Z.dispatch({actionType:"RSS_FEEDS_FOUND",tabId:i,feeds:a})}}));const e=new Map;n.Z.webRequest.onResponseStarted.addListener((t=>{if(-1===t.tabId)return void console.warn("RssDetectActions:","Should this be a chrome.runtime.lastError check instead?");const s=(t.responseHeaders||[]).reverse().find((e=>"content-type"===e.name.toLowerCase()));e.set(t.tabId,s?.value)}),{types:["main_frame"],urls:["http://*/*","https://*/*"]},["responseHeaders"]),n.Z.tabs.onRemoved.addListener((t=>e.delete(t)))}};var pn=s(39206),gn=s(66971);class mn extends m.Z{getInitialState(){return{elements:[],changeReason:""}}getElements(){return this.getState().elements}reduce(e,t){if("SHARED_LINKS_ADD"===t.actionType){return(0,C.Uy)(e,(e=>{e.elements=t.elements,e.elements.sort(((e,t)=>e.sharedTime<t.sharedTime?1:e.sharedTime>t.sharedTime?-1:0)),e.changeReason=t.fromEvent?"event":"poll"}))}return e}}const fn=new mn(S.Z);async function vn(e,t){const s=await re.Z.tabsPrivate.getSendTabToSelfEntries(t);return S.Z.dispatch({actionType:"SHARED_LINKS_ADD",elements:s,fromEvent:e}),Promise.resolve()}const bn=new class{loadPromise=async()=>(re.Z.tabsPrivate.onSendTabToSelfAdded.addListener(this.onAdded),re.Z.tabsPrivate.onSendTabToSelfDismissed.addListener(this.onDismissed),vn(!1,!0));onAdded=async e=>vn(!0,!1);onDismissed=e=>{const t=fn.getElements().filter((t=>!e.find((e=>e===t.guid))));S.Z.dispatch({actionType:"SHARED_LINKS_ADD",elements:t,fromEvent:!0})};onActivate=(e,t)=>{let s=!1;t.forEach((t=>{const n=fn.getElements().find((e=>e.guid===t));n&&(c.ZP.openURL(e,n.url,{inCurrent:!1,inBackground:s}),s=!0)})),this.onDismiss(t)};onDelete=e=>{re.Z.tabsPrivate.execSendTabToSelfAction("delete",e,(()=>{vn(!1,!1)}))};onDismiss=e=>{re.Z.tabsPrivate.execSendTabToSelfAction("delete",e,(()=>{vn(!1,!1)}))}},Cn={intro:(0,W.Z)("Welcome to Vivaldi!"),account:(0,W.Z)("Unlock the full potential of Vivaldi with an account"),import_data:(0,W.Z)("Bring your favorites to Vivaldi"),tracker_and_ad:(0,W.Z)("browser","We care about your privacy!"),personalize:(0,W.Z)("Make Vivaldi yours!"),tabs:(0,W.Z)("Where do you want your tabs?"),welcome_feature_amount:(0,W.Z)("One more thing")},wn={intro:[(0,W.Z)("With everything you want and more, built-in, the only browser powerful enough to match you."),(0,W.Z)("Allow Vivaldi to Send Automatic Crash Reports"),(0,W.Z)("Crash reports include the most recently visited webpage. It may send more personal information which is promptly deleted."),(0,W.Z)("Privacy policy")],control:[(0,W.Z)("Unlock the full potential of Vivaldi from day one by importing your data from your old browser and setting Vivaldi as default."),(0,W.Z)("mac","Keep Vivaldi in Dock"),(0,W.Z)("win_linux","Keep Vivaldi in Taskbar"),(0,W.Z)("Set Vivaldi as Default Browser"),(0,W.Z)("Import from Other Browsers")],account:[(0,W.Z)("Get access to:"),(0,W.Z)("Proton VPN for Vivaldi"),(0,W.Z)("Vivaldi Sync – your data across all your devices"),(0,W.Z)("Forums and communities"),(0,W.Z)("Vivaldi Social – an algorithm-free social platform"),(0,W.Z)("Theme sharing"),(0,W.Z)("Enter your email to get started"),(0,W.Z)("Your email address"),(0,W.Z)("We’ll email you instructions to help you set up your account and get started. You can unsubscribe at any time. See more at vivaldi.com/privacy"),"",(0,W.Z)("Incorrect email format."),(0,W.Z)("Great, apparently you already have an account, welcome back! You can skip this step to continue setting up Vivaldi."),(0,W.Z)("Form submission failed.")],tracker_and_ad:[(0,W.Z)("Vivaldi comes with a built-in tracker and ad blocker to protect your browsing. You’re in control, block as much or as little as you want. You can adjust the global and site-specific blocking preferences from settings.")],import_data:[(0,W.Z)("Select your old web browsers to import bookmarks, history, passwords, tabs, and other data."),(0,W.Z)("Import your bookmarks, browser history, passwords, notes, and other data using the “File: Import From Applications or Files” menu.")],personalize:[(0,W.Z)("Vivaldi looks better when you put your personal touch to it. Choose a theme from the options below. You can personalize your theme or find others from settings later."),(0,W.Z)("Follow Operating System Theme Color")],tabs:[(0,W.Z)("Personalization is not just about the colors you choose, Vivaldi is packed with ways to make the browser adapt to you. A unique feature is the ability to place tabs wherever you like.")],welcome_feature_amount:[(0,W.Z)("Vivaldi is not only a browser, it has a mail client, calendar, and feed reader, all built-in. Choose the full package or start simple and add features as you go. You can always enable Mail, Calendar, and Feeds from settings later."),(0,W.Z)("Browser"),(0,W.Z)("Enable Mail, Calendar and Feeds"),(0,W.Z)("Start Browsing"),(0,W.Z)("Set up Vivaldi Mail")]},yn=Object.keys(Cn),xn="personalize",In={getUnreadPageKeys:()=>Object.keys(Cn).filter((e=>!A.Z.get(Z.kWelcomeReadPages).includes(e))),isFirstStart:()=>0===A.Z.get(Z.kWelcomeReadPages).length,shouldHideUI:()=>{const e=A.Z.get(Z.kWelcomeReadPages),t=yn.indexOf(xn);return e.every((e=>yn.indexOf(e)<t))},shouldAnimateUI:()=>A.Z.get(Z.kWelcomeReadPages).includes(xn)};var An=s(39180);const Sn=new class{init=async()=>{const e=In.isFirstStart(),t=[];if(!e){if(A.Z.get(Z.kStartupCheckIsDefault)&&!fe.ZP.isGuest()){if(!await re.Z.utilities.isVivaldiDefaultBrowser()){(await n.Z.history.search({startTime:Date.now()-2592e5,endTime:Date.now(),text:""})).length>=10&&t.push("DIALOG_DEFAULT_BROWSER")}}await re.Z.utilities.isRazerChromaAvailable()&&!A.Z.get(Z.kRazerChromaHasShownPromotion)&&t.push("DIALOG_RAZER_CHROMA_FOUND"),"win"===An.Z.call()&&A.Z.get(Z.kStartupShowMediaAvailableInformation)&&(await re.Z.utilities.getMediaAvailableState()||t.push("DIALOG_INFORM_MEDIA_WIN_N")),""!==A.Z.get(Z.kStartupShowGitDirectoryWarning)&&t.push("DIALOG_INFORM_GIT_DIRECTORY_FOUND"),(await re.Z.extensionActionUtils.triggerGlobalErrors()).length&&t.push("DIALOG_EXTENSION_INSTALL_ERROR")}const s=await re.Z.searchEngines.getSwitchPromptData();!e&&s.shouldPrompt&&t.push("DIALOG_SEARCH_ENGINE_SWITCH"),0!==t.length&&S.Z.dispatch({actionType:"STARTUP_DIALOGS_INIT",state:t})};closeDialog(e){S.Z.dispatch({actionType:"STARTUP_DIALOG_CLOSE",dialog:e})}};function Zn(e){S.Z.dispatch({actionType:"SYNC_ENGINE_STATE_CHANGED",engineData:e})}function Tn(e){S.Z.dispatch({actionType:"SYNC_CYCLE_COMPLETED",cycleData:e})}const En=new class{start(){re.Z.sync.start()}clearData(){re.Z.sync.clearData()}setEncryptionPassword(e,t){re.Z.sync.setEncryptionPassword(e,(e=>t(e)))}loadPromise=async()=>{if(n.Z.extension.inIncognitoContext)return;const e=new Promise((e=>re.Z.sync.getEngineState((t=>{Zn(t),re.Z.sync.onEngineStateChanged.addListener((e=>Zn(e))),e()})))),t=new Promise((e=>re.Z.sync.getLastCycleState((t=>{Tn(t),re.Z.sync.onCycleCompleted.addListener((e=>Tn(e))),e()}))));await Promise.all([e,t])}};class kn extends m.Z{getInitialState(){return{devices:[],loggedIn:!1}}hasSupport(){return!window.isGuestSession&&!n.Z.extension.inIncognitoContext}getDevices(){return this.getState().devices}getLoggedIn(){return this.getState().loggedIn}getDeviceTree(){const e=(e,t)=>{const s={id:e.sessionId??"",name:e.title??"",url:e.url??"",windowId:t,tab:e,workspaceId:void 0,stackId:void 0,panelId:void 0,fixedTitle:void 0,fixedGroupTitle:void 0};if(!e.vivExtData||String(e.vivExtData).length<2)return s;try{const t=JSON.parse(String(e.vivExtData));s.workspaceId=t.workspaceId,s.stackId=t.group,s.panelId=t.panelId,s.fixedTitle=t.fixedTitle,s.fixedGroupTitle=t.fixedGroupTitle}catch(e){console.log("invalid tab ext data")}return s};return this.getState().devices.map(((t,s)=>{let n=[],i=[],a="device_"+s;1===t.sessions.length?t.sessions[0].window?.tabs&&t.sessions[0].window?.sessionId&&(a=t.sessions[0].window.sessionId,i=t.sessions[0].window.tabs.map((t=>e(t,a)))):n=t.sessions.map(((t,s)=>{if(t.window&&t.window.sessionId){const n=t.window.sessionId;return{id:n,name:(0,W.Z)("$1",[s+1]),tabs:(t.window?.tabs??[]).map((t=>e(t,n)))}}})).filter(Boolean);const o={id:a,name:t.deviceName,windows:n,tabs:i,workspaceNames:void 0,panels:void 0,deviceType:t.deviceType};return t.vivaldiSpecific?.workspaces&&(o.workspaceNames=t.vivaldiSpecific.workspaces.reduce(((e,t)=>(t.workspaceId&&t.name&&e.set(t.workspaceId,{name:t.name,icon:t.icon,iconId:t.iconId,emoji:t.emoji}),e)),new Map)),t.vivaldiSpecific?.panels&&(o.panels=t.vivaldiSpecific.panels.map((e=>({url:e.url,title:e.title,initialFaviconUrl:e.initialFaviconUrl,id:e.panelId})))),o}))}reduce(e,t){switch(t.actionType){case"SYNCED_TABS_INIT":return{devices:[...t.devices],loggedIn:t.loggedIn};case"SYNCED_TABS_SET_DEVICES":return{devices:[...t.devices],loggedIn:e.loggedIn};case"SYNCED_TABS_SET_LOGGED_IN":return{devices:[...e.devices],loggedIn:t.loggedIn};default:return e}}}const Nn=new kn(S.Z);var _n=s(34155);async function Pn(){const e=await n.Z.sessions.getDevices();S.Z.dispatch({actionType:"SYNCED_TABS_SET_DEVICES",devices:e})}function Mn(){_n.nextTick((()=>{S.Z.dispatch({actionType:"SYNCED_TABS_SET_LOGGED_IN",loggedIn:"loggedIn"===pe(me.getState())})}))}const Dn=new class{loadPromise=()=>(Nn.hasSupport()&&(me.addListener(Mn),re.Z.sync.onCycleCompleted.addListener(Pn),async function(){const e=await n.Z.sessions.getDevices(),t="loggedIn"===pe(me.getState());S.Z.dispatch({actionType:"SYNCED_TABS_INIT",devices:e,loggedIn:t})}()),Promise.resolve());openTabs=e=>{e.forEach((e=>{n.Z.sessions.restore(e,(t=>{n.Z.runtime.lastError&&console.warn("Error restoring tab: ",e,n.Z.runtime.lastError)}))}))};openWindows=e=>{e.forEach((e=>{n.Z.sessions.restore(e,(t=>{n.Z.runtime.lastError&&console.warn("Error restoring window: ",e,n.Z.runtime.lastError)}))}))}};var On=s(2699),jn=s(54058),Ln=s(76501);function Rn(e){S.Z.dispatch({actionType:"VIVALDI_ACCOUNT_STATE_UPDATED",state:e})}const Bn=new class{login(e,t,s){re.Z.vivaldiAccount.login(e,t,s),re.Z.sync.start()}logout(){re.Z.vivaldiAccount.logout()}loadPromise=async()=>{if(n.Z.extension.inIncognitoContext)return;Rn(await re.Z.vivaldiAccount.getState()),re.Z.vivaldiAccount.onAccountStateChanged.addListener(Rn)}};var Fn=s(16716),Wn=s(63153),Un=s(67294),Vn=s(97009),Hn=s(94184),Gn=s.n(Hn),Kn=s(86088),zn=s(48521),$n=(0,zn.jsx)("circle",{cx:"10.5",cy:"10.5",r:"5"}),Yn=(0,zn.jsx)("text",{x:"7.5",y:"14",fontSize:"10px",children:"~"}),Xn=(0,zn.jsx)("text",{x:"9.5",y:"14",fontSize:"10px",children:"!"});class Qn extends Un.PureComponent{getImageSet=()=>this.props.trash?Kn.nre:this.props.speeddial?this.props.open?Kn.g0V:Kn.$II:this.props.open?Kn.fHR:Kn._TQ;render(){const e=Gn()("folder-icon",this.props.className,{sd:this.props.speeddial});return(0,zn.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",className:e,style:{marginLeft:this.props.leftMargin?this.props.leftMargin:null,marginRight:this.props.rightMargin?this.props.rightMargin:null},children:[this.props.icon?this.props.icon:(0,zn.jsx)("g",{className:"fill-override",dangerouslySetInnerHTML:{__html:(this.props.imageSet||this.getImageSet()).small}}),(this.props.isConnecting||this.props.disconnected)&&(0,zn.jsxs)("g",{className:this.props.isConnecting?"folder-evaluating":"folder-error",onClick:this.props.onClickStatusIcon,children:[$n,this.props.isConnecting?Yn:Xn]})]})}}const qn=Qn;var Jn=s(27770),ei=s(72882),ti=s(26395);const si=class{constructor(e=!0){this.selectedIds_=[],this.anchorIndex_=-1,this.leadIndex_=-1,this.multiSelect_=e}isSelected(e){for(const t of this.selectedIds_)if(t.id===e)return t.selected;return!1}get length(){return this.selectedIds_.length}get isSingleItemSelected(){return 1===this.selectedIds_.length}get FirstSingleItemSelected(){return this.isSingleItemSelected?this.selectedIds_[0].id:-1}get selectedIds(){return this.selectedIds_}resetSelectionModel(){this.selectedIds_=[],this.anchorIndex_=-1,this.leadIndex_=-1}getData(){return{selectedIds_:this.selectedIds_,anchorIndex_:this.anchorIndex_,leadIndex_:this.leadIndex_}}setData(e){this.anchorIndex_=e.anchorIndex_,this.leadIndex_=e.leadIndex_,this.selectedIds_=e.selectedIds_}unSelectAll(){this.selectedIds_=[]}selectAll(e){this.multiSelect&&(e.forEach((e=>{this.selectedIds_.push({id:e,selected:!0})})),e.length>0&&(-1===this.anchorIndex_&&(this.anchorIndex_=e[0]),-1===this.leadIndex_&&(this.leadIndex_=e[0])))}setSelectedIds(e){this.multiSelect?this.selectedIds_=e.map((e=>({id:e,selected:!0}))):this.setIndexSelected(this.leadIndex,!0)}setLeadIndex(e){this.leadIndex=e}setIndexSelected(e,t){var s=this.selectedIds_.map((e=>e.id)).indexOf(e),n=this.selectedIds_[s];if((!n||n.selected!==t)&&(this.multiSelect||this.resetSelectionModel(),this.leadIndex=e,this.anchorIndex=e,-1!==e))if(t)this.selectedIds_.push({id:e,selected:t});else{var i=this.selectedIds_.map((e=>e.id)).indexOf(e);-1!==i&&this.selectedIds_.splice(i,1)}}get leadIndex(){return this.leadIndex_}set leadIndex(e){this.leadIndex_=e}get anchorIndex(){return this.anchorIndex_}set anchorIndex(e){this.anchorIndex_=e}get multiSelect(){return this.multiSelect_}set multiSelect(e){this.multiSelect_=e}};var ni=s(34155);const ii={throttleSync:function(e,t={}){return function(){if(!t.isRunning){t.isRunning=!0;try{e.apply(this,arguments)}finally{ni.nextTick((()=>{t.isRunning=!1}))}}}}};var ai=s(4027),oi=s(94283),ri=s(51877),li=s(52373);function di(e,t,s){switch(e){case"style":case"componentProps":return(0,ri.Z)(t[e],s[e])}return(0,li.Z)(t[e],s[e])}class ci extends Un.Component{static contextType=oi.Z;#o={available:!1,onto:!1,edge:"none"};#r;shouldComponentUpdate(e){return!(0,ri.Z)(this.props,e,di)}isFolder=()=>this.props.isFolder(this.props.treeItem);hasChildren=()=>this.props.hasChildren(this.props.treeItem);onClick=e=>{this.props.onItemClick(this.props.treeItem,e),e.stopPropagation()};onDoubleClick=e=>{if(void 0===this.props.inlineEditText){if(this.isFolder()){this.props.overrideDoubleClick&&this.props.overrideDoubleClick(this.props.treeItem)||this.onExpandClick(e)}this.props.onItemDoubleClick(this.props.treeItem,e)}};onDragStart=e=>{const{inlineEditText:t,validateForDrag:s,getAllSelectedItems:n,mimeType:i,disableMousePointersOverride:a,setCustomEventBehavior:o}=this.props;if(!s||void 0!==t)return;let r=n().map((e=>e.id));r=s(r),0!==r.length&&(i&&e.dataTransfer.setData(i,JSON.stringify(r)),e.dataTransfer.setData("text/uri-list",this.props.getDragData?.("text/uri-list",r)),e.dataTransfer.setData("vivaldi/x-uri-list",this.props.getDragData?.("vivaldi/x-uri-list",r)),e.dataTransfer.setData("text/plain",this.props.getDragData?.("text/plain",r)),e.dataTransfer.setData("vivaldi/x-title",this.props.getDragData?.("vivaldi/x-title",r)),e.dataTransfer.effectAllowed="all",o&&o(e,r),this.props.onDragStart(r),this.#r=!0,a||ai.Z.setWebviewPointerEvents(!1,this.context.document))};onDragEnd=e=>{this.#r=!1,this.props.disableMousePointersOverride||ai.Z.setWebviewPointerEvents(!0,this.context.document),this.props.onDragEnd()};onDragEnter=e=>{this.props.supportDrop&&(this.#o=this.props.supportDrop(this.props.treeItem,e))};onDrop=e=>{e.preventDefault(),e.stopPropagation(),!0===this.#o.available&&this.props.onDrop(this.props.treeItem,this.#o,e)};onDragOver=e=>{const{onDragOver:t,treeItem:s,index:n}=this.props;e.stopPropagation(),!0===this.#o.available&&t&&(e.preventDefault(),e.nativeEvent.dataTransfer.dropEffect="move",t(s,n,this.#o,e))};onDragLeave=e=>{e.preventDefault(),e.stopPropagation(),this.props.onDragLeave&&!0===this.#o.available&&this.props.onDragLeave(this.props.treeItem,e)};onMouseDown=e=>{this.props.onMouseDown(this.props.treeItem,e)};onMouseUp=e=>{this.props.onMouseUp(this.props.treeItem,e),0===e.buttons&&this.#r&&this.onDragEnd(e)};onExpandClick=e=>{if(this.props.treeItem.children&&this.props.treeItem.children.length>0){const t=e.altKey;this.props.toggleExpandModel(this.props.treeItem,t),e.preventDefault(),e.stopPropagation()}};render(){const{Component:e,componentProps:t}=this.props,s=!!this.props.isSeparator&&this.props.isSeparator(this.props.treeItem),n=this.props.selected,i=this.props.dragOverObj.id===this.props.treeItem.id,a=this.props.dragOverObj.position;return(0,zn.jsx)("div",{style:this.props.style,"data-id":this.props.treeItem.id,className:"tree-item","data-selected":n?"":null,"data-lead":this.props.lead?"":null,"data-cut":this.props.isCut?"":null,"data-expanded":this.props.isExpanded?"":null,onDragEnter:this.props.enableDragAndDrop?this.onDragEnter:null,onDragOver:this.props.enableDragAndDrop?this.onDragOver:null,onDragLeave:this.props.enableDragAndDrop?this.onDragLeave:null,onDrop:this.props.enableDragAndDrop?this.onDrop:null,onContextMenu:this.props.onContextMenu,children:(0,zn.jsx)("div",{className:Gn()("tree-row",{folder:this.isFolder(),"tree-row-selected":n,"tree-row-selected--first":this.props.isFirstSelected,"tree-row-selected--last":this.props.isLastSelected,dragover:i&&"on"===a,dragoverAbove:i&&"above"===a,dragoverBelow:i&&"below"===a,"speeddial-folder":this.isFolder()&&this.props.treeItem.speeddial}),"data-separator":s?"":null,"data-selected":n?"":null,onClick:this.onClick,onDoubleClick:this.onDoubleClick,onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,draggable:this.props.isDraggable??!1,onDragStart:this.props.enableDragAndDrop?this.onDragStart:null,onDragEnd:this.props.enableDragAndDrop?this.onDragEnd:null,children:(0,zn.jsx)(e,{...t})})})}}const hi=ci;var ui=s(93974);class pi extends Un.Component{scrollerRef=Un.createRef();scrollDirection="up";lastScrollTop=0;bufferStart=0;bufferEnd=0;scrollTop=0;shouldComponentUpdate(e,t){return e.nodes===this.props.nodes&&e.height===this.props.height||this.updateBuffer(e),!0}componentDidUpdate(e,t){const{visibleIndex:s,visibleCount:n}=this.getVisible();if(this.props.stabilizeScrollTop&&e.nodes!==this.props.nodes){const t=this.stabilizeScrollTop(e.nodes);this.setScrollTop(t)}else this.props.isDragging&&(s<this.bufferStart||s+n>this.bufferEnd)&&this.updateBuffer();this.props.onRowsRendered?.({startIndex:s,stopIndex:s+n,listLength:this.props.nodes.length})}setScrollTop(e,t=!0){if("number"!=typeof e)return;const s=this.getScrollHeight(),n=Math.max(Math.min(e,s-this.props.height),0);this.lastScrollTop=this.scrollTop,this.scrollTop=n,t&&this.updateBuffer(),this.props.onScroll&&this.props.onScroll({clientHeight:this.props.height,scrollHeight:this.getScrollHeight(),scrollTop:this.scrollTop})}getScrollTop(){const{nodes:e,height:t}=this.props,s=this.getScrollHeight(e);return Math.max(Math.min(this.scrollTop,s-t),0)}getWrapper(){return this.scrollerRef?.current}scrollToRow(e){const t=this.props.nodes[e];if(t){const e=t.accumulatedHeight-t.height,s=this.getScrollTop();e<s?this.setScrollTop(e):t.accumulatedHeight>s+this.props.height&&this.setScrollTop(t.accumulatedHeight-this.props.height)}}onScroll=e=>{const{scrollTop:t}=e.currentTarget;0===t&&this.scrollTop===this.lastScrollTop||(this.scrollDirection=t>this.lastScrollTop?"down":"up",this.setScrollTop(t,!1),this.updateBufferDebounced())};getVisible(e=this.props){const{nodes:t,height:s}=e,n=this.getScrollTop(),i=this.heightToIndex(t,n);let a=0,o=0;const r=t.length;for(let e=i;e<r&&o<s;e++)a++,o+=t[e]?.height??0;return{visibleIndex:i,visibleCount:a}}updateBuffer(e=this.props){const{nodes:t,height:s}=e,{visibleIndex:n,visibleCount:i}=this.getVisible(e);let a=n,o=n+i;const r=e.bufferHeightLead??2*s,l=e.bufferHeightTrail??2*s;if(i<t.length){a=n;let e="up"===this.scrollDirection?r:l,s=0;for(;a>0&&s<e;)a--,s+=t[a].height;for(e="down"===this.scrollDirection?r:l,s=0;o<t.length&&s<e;)s+=t[o].height,o++}a===this.bufferStart&&o===this.bufferEnd||(this.bufferStart=a,this.bufferEnd=o,this.forceUpdate())}updateBufferDebounced=(0,Te.Z)((()=>{this.updateBuffer()}),50,{maxWait:200});getScrollHeight(e=this.props.nodes){return e[e.length-1]?.accumulatedHeight??0}heightToIndex(e,t){const s=Ft()(e,{accumulatedHeight:t},((e,t)=>e.accumulatedHeight-t.accumulatedHeight));return s<0?-s-1:s}stabilizeScrollTop(e){const{height:t,nodes:s}=this.props,n=e[0]?.height??0;if("top"===this.props.anchor&&this.lastScrollTop<=n)return this.lastScrollTop;const i=this.getScrollHeight(e),a=e[e.length-1]?.height??0;if("bottom"===this.props.anchor&&this.lastScrollTop>=i-t-a){return this.getScrollHeight(s)-t}const o=this.scrollTop+t/2,r=this.heightToIndex(e,o),l=e[r];if(l){const n=l.accumulatedHeight-o,i=new Map(s.map((e=>[e.node.id,e]))),a=i.get(l.node.id),d=this.getScrollHeight(s)-t;if(a){const e=a.accumulatedHeight-n-t/2;return Math.max(Math.min(e,d),0)}for(let s=1;r-s>=0||r+s<e.length;s++){const a=e[r-s];if(a){const e=i.get(a.node.id);if(e){const s=e.accumulatedHeight-n-t/2;return Math.max(s,0)}}const o=e[r+s];if(o){const e=i.get(o.node.id);if(e){const s=e.accumulatedHeight-n-t/2;return Math.min(s,d)}}}}const d=this.lastScrollTop,c=this.getScrollHeight(s)-t;return Math.min(d,c)}render(){const{nodes:e,rowRenderer:t,rowCache:s}=this.props,n=[];for(let i=this.bufferStart;i<this.bufferEnd;i++){const a=e[i];if(!a)continue;let o=s.get(a);o||(o=t({index:i,style:{height:a.height,contentVisibility:"auto"}}),s.set(a,o)),n.push(o)}const i=e[this.bufferStart],a=i?i.accumulatedHeight-i.height:0,o=(0,zn.jsxs)("div",{ref:this.scrollerRef,className:"VivaldiList",style:{height:this.props.height,...this.props.containerStyle},onScroll:this.onScroll,tabIndex:0,children:[(0,zn.jsx)("div",{className:"VivaldiList-Offset",style:{top:a},children:n}),(0,zn.jsx)("div",{style:{height:this.getScrollHeight()}})]});return this.scrollerRef.current&&this.scrollerRef.current.scrollTo(0,this.scrollTop),o}}const gi=pi;var mi=s(47380),fi=s(26036),vi=s(84847),bi=s(42568),Ci=s.n(bi),wi=s(81157);const yi=(e,t)=>{const s={...A.Z.get(Z.kAppearanceTreeColumnsEntries),[t]:e};I.Z.set(Z.kAppearanceTreeColumnsEntries,s)},xi=()=>A.Z.get(Z.kAppearanceTreeColumnsEntries),Ii=e=>e.filter((e=>e.visible)).reduce(((e,t)=>(e.push({id:t.value,width:t.width||100,key:t.key}),e)),[]),Ai=e=>e.map((e=>e.key?`minmax(${Math.min(e.width/2,100)}px, 1fr)`:`minmax(36px, ${e.width}px)`)).join(" ");var Si=s(9304),Zi=s(721);function Ti(){return 24+((0,Si.mM)()?4:0)}const Ei="F2",ki=268e5,Ni=16;function _i(e){e.target.select()}class Pi extends Un.PureComponent{static contextType=oi.Z;static defaultProps={enableDragAndDrop:!0,supportsCollapseAll:!0};emptyDragOverObj={id:-1,position:""};refTreeListEntries=Un.createRef();constructor(e){super(e);const t=this.setupExpandModel(e),{multiSelect:s}=e;this.selectionModel=new si(s),this.state={dragOverObj:this.emptyDragOverObj,hasFocus:!1,expandModel:t,renderArray:this.makeRenderArray(e.nodes,t,e.sorting),rowCache:new WeakMap,inlineEditId:-1,inlineEditText:"",width:0,height:0,isDragging:!1}}_dropSupport={available:!1,onto:!1,edge:"none"};_leftMouseTimeStamp=0;#l;_isMounted=!1;_hasCutCopyPasteListeners=!1;_isComposing=!1;_scrollTopNeedsUpdate=!1;_canCutCopyPaste=!1;resetSelectionModel=()=>{this.selectionModel.resetSelectionModel(),this.updateSelectionState()};updateSelectionState=e=>{this.setState({rowCache:new WeakMap},e)};SelectionMixinSelectAll=()=>{this.selectionModel.selectAll(this.getAllIds()),this.updateSelectionState()};SelectionMixinSetLead=e=>{this.selectionModel.setLeadIndex(e),this.updateSelectionState()};SelectionMixinSelectItem=(e,t,s,n,i)=>{this.selectionModel.setLeadIndex(e);const a=t;let o=this.selectionModel.isSelected(e);if(a||s)o=i||!o;else{if(i&&this.selectionModel.length>1)return;this.selectionModel.unSelectAll(),o=!0}if(s&&-1!==this.selectionModel.anchorIndex){const t=this.getSelectedIdsFromIdToAnchor(e);this.selectionModel.setSelectedIds(t)}else this.selectionModel.setIndexSelected(e,o);this.updateSelectionState()};getRowHeight=(e,t=!1)=>void 0===this.props.rowHeight?Ti():"function"==typeof this.props.rowHeight?this.props.rowHeight(e,t):this.props.rowHeight;getSelectedIdsFromIdToAnchor=e=>{const t=this.selectionModel.anchorIndex;return this.getIdsBetween(t,e)};_initializeSettings=e=>{e.settings&&(this._scrollTopSettings="SCROLL_TOP_"+e.settings,this._scrollTopNeedsUpdate=!0,this._searchStyleSettings="SEARCH_STYLE_"+e.settings,this._onRowsRenderedOptions="ON_ROWS_RENDERED_OPTIONS_"+e.settings)};_updateSelectionStateIfNeeded=e=>{if(e.settings){this._selectionSettings="SELECTION_"+e.settings;const t=Rs.Z.getSync(this._selectionSettings);if(t){const s=this.getSelectedItem();this.selectionModel.setData(t),this.updateSelectionState((()=>{const{onSelect:t}=e;if(t){const e=this.getSelectedItem();let n=-1;!e||s&&e.id===s.id?s&&(n=s.id,this._scrollTopNeedsUpdate=!0):(n=e.id,t(e),this._scrollTopNeedsUpdate=!0),-1!==n&&this.scrollToId(n)}}))}else if(e.autoFocus&&e.nodes.length>0){const t=e.nodes[0];-1!==t.id&&(this._scrollTopNeedsUpdate=!0,this.selectByNode(t))}else this.resetSelectionModel()}};componentDidMount(){const{selectionStoreKey:e}=this.props;if(e){if(yt.Z.has(e))throw new Error(`Key ${e} has already been set in\n          SelectionStore. VivaldiTreeList expects instances using\n          selectionStoreKey props to be singleton.`);yt.Z.set(e,this.selectionModel)}this._initializeSettings(this.props),this._updateSelectionStateIfNeeded(this.props),this._isMounted=!0;const t=this.getWrapper();if(t){t.addEventListener("focus",this.onGotFocus,!0);const e=t.parentElement;if(e){const t=Ti();let s=t;e.clientHeight<=t&&this.state.renderArray.length>1&&(s=Math.min(this.state.renderArray[this.state.renderArray.length-1].accumulatedHeight,10*t)),this.updateTreeSize(e.clientWidth,s)}}}UNSAFE_componentWillReceiveProps(e){this.props.multiSelect!==e.multiSelect&&(this.selectionModel.multiSelect=Boolean(e.multiSelect));let t=this.state.expandModel;e.settings!==this.props.settings&&(this._initializeSettings(e),this._updateSelectionStateIfNeeded(e),t=this.setupExpandModel(e)),e.columns===this.props.columns&&e.nodes===this.props.nodes&&e.sorting===this.props.sorting&&e.getRowComponentProps===this.props.getRowComponentProps||this.prepareDataForRender(e.nodes,t,e.sorting)}componentDidUpdate(e,t){e.sorting?.sortOrder!==this.props.sorting?.sortOrder||e.sorting?.sortField!==this.props.sorting?.sortField?this._scrollLeadNodeIntoView():(e.nodes===this.props.nodes&&t.hasFocus===this.state.hasFocus||(this._scrollTopNeedsUpdate=!0),this.updateScrollTop())}componentWillUnmount(){this.enableCutCopyPasteListeners(!1),this.stopInlineEditTimer(),this.resetAutoExpandTimer(),this._isMounted=!1;const e=this.getWrapper();e&&e.removeEventListener("focus",this.onGotFocus,!0);const{selectionStoreKey:t}=this.props;t&&yt.Z.get(t)===this.selectionModel&&yt.Z.delete(t)}getWrapper(){return this.refTreeListEntries.current?.getWrapper()}focusTree=()=>{const e=this.getWrapper();e instanceof this.context.HTMLElement&&e.focus()};prepareDataForRender=(e,t,s)=>{const n=this.makeRenderArray(e,t,s);this.setState({renderArray:n,expandModel:t})};setCutIds=e=>{this.props.setCutIds&&this.props.setCutIds(e)};onCut=e=>{if(e.preventDefault(),!this._canCutCopyPaste)return;const t=this.getAllSelectedItems();this.props.onCut?this.props.onCut(e,t):(this.setCutIds(t.map((e=>e.id))),this.setClipboard(e,t,!0))};onCopy=e=>{const{onCopy:t}=this.props;if(!this._canCutCopyPaste)return;const s=this.getAllSelectedItems();t?t(e,s):this.setClipboard(e,s,!1)};toggleSelectedExpansion=(e,t=!1)=>{this.stopInlineEditTimer();const s=e||this.selectionModel.leadIndex;if(-1===s)return;if(this.state.inlineEditId===s)return;const n=this.findTreeItem(s);n&&this.props.isFolder(n)&&this.toggleExpandModel(n,t&&this.props.hasChildren(n))};expand=e=>{const t=this.findTreeItem(e);t&&this.props.isFolder(t)&&this._setExpandState(t,!0)};collapse=e=>{const t=this.findTreeItem(e);t&&this.props.isFolder(t)&&this._setExpandState(t,!1)};pruneExpandModel=()=>{this.setState((e=>{const t={...e.expandModel},s=e=>{e.children&&(0===e.children.length&&this._isModelExpanded(e.id,t)&&this._setExpandModelElement(t,e.id,!1),e.children.forEach(s))};return this.props.nodes.forEach(s),{expandModel:t}}))};toggleExpandModel=(e,t)=>{const s=!this.isExpanded(e.id),n={...this.state.expandModel};if(t){const t=e=>this.props.isFolder(e)&&this.props.hasChildren(e)?e.children.flatMap(t).concat(e.id):[];t(e).forEach((e=>this._setExpandModelElement(n,e,s)))}else this._setExpandModelElement(n,e.id,s);this.saveExpandModel(n),this.prepareDataForRender(this.props.nodes,n,this.props.sorting)};_setExpandModelElement=(e,t,s)=>{if("expand"===this.props.folderMode)s?delete e[t]:e[t]=!1;else s?e[t]=!0:delete e[t]};saveExpandModel=e=>{if(this.props.settings){const t={};t["EXPAND_"+this.props.settings]=e,Rs.Z.set(t)}};saveSelectionModel=()=>{if(this.props.settings){const e={[this._selectionSettings]:this.selectionModel.getData()};Rs.Z.set(e)}};_getRenderIndex=e=>this.state.renderArray.findIndex((t=>t.node.id===e));_scrollLeadNodeIntoView=()=>{const e=this._getRenderIndex(this.selectionModel.leadIndex);e>=0&&this.scrollIntoView(e)};resetExpandModel=(e,t)=>{const s={},n=e=>{this.props.isFolder(e)&&(s[e.id]=t),this.props.hasChildren(e)&&e.children.forEach(n)};return"expand"===this.props.folderMode?t||e.forEach(n):t&&e.forEach(n),s};collapseAll=()=>{const e=this.findTreeItem(this.selectionModel.leadIndex);let t=e;for(;t&&void 0!==t.parentId&&t.parentId!==this.props.rootId;)t=this.findTreeItem(t.parentId);const s=this.resetExpandModel(this.props.nodes,!1);this.saveExpandModel(s),this.prepareDataForRender(this.props.nodes,s,this.props.sorting),t&&t!==e?this.selectByNode(t):this._scrollLeadNodeIntoView()};setupExpandModel=e=>{const{nodes:t,settings:s,collapsedOnMount:n}=e,i=this.resetExpandModel(t,"expand"===this.props.folderMode);return s&&(Object.assign(i,Rs.Z.getSync("EXPAND_"+s)),n?.forEach((e=>{i[e]=!1}))),i};getExpandModel=()=>this.state.expandModel;expandWithModel=e=>{this.saveExpandModel(e),this.prepareDataForRender(this.props.nodes,e,this.props.sorting),this._scrollLeadNodeIntoView()};expandAll=()=>{this.expandAllExcept([])};expandAllExcept=e=>{const t=this.resetExpandModel(this.props.nodes,!0);e.forEach((e=>{this._setExpandModelElement(t,e,!1)})),this.saveExpandModel(t),this.prepareDataForRender(this.props.nodes,t,this.props.sorting),this._scrollLeadNodeIntoView()};isExpanded=e=>this._isModelExpanded(e,this.state.expandModel);onImport=()=>{this.props.onImport&&this.props.onImport()};setClipboard=(e,t,s)=>{const{clipboardData:n}=e,{getDragData:i,mimeType:a}=this.props;if(!a||!i||!n||this.props.disableClipboard)return;const o=t.map((e=>e.id));n.setData("vivaldi/x-cut",s.toString()),n.setData(a,JSON.stringify(o)),n.setData("text/plain",i("text/plain",o));const r=this.selectionModel.leadIndex;-1!==r&&n.setData("text/html",i("text/html",[r])),(0,wi.ZP)(e)};contextMenuSpy=e=>{this._canCutCopyPaste=!1;const t=this.getWrapper();let s=e.target;for(;s;){if(s===t){this._canCutCopyPaste=!0;break}s=s.parentNode}};keyDownSpy=e=>{this._canCutCopyPaste=!0};onPaste=e=>{if(e.preventDefault(),!this._canCutCopyPaste)return;const{mimeType:t,onPaste:s}=this.props;if(s){const t=this.getSelectedItem();return void(t&&s(e,t))}if(!t)return;const n=this.getTargetFromSelection(),i=e.clipboardData;if(!i)return;const a=-1!==i.types.findIndex((e=>e===t))?JSON.parse(i.getData(t)):[];if(0===a.length)return;if("true"===i.getData("vivaldi/x-cut")){if(!(this.props.cutIds&&this.props.cutIds.length>0)||!this.props.onMove)return;this.props.onMove(a,n,"on").then((e=>{const t=e??[];this.setCutIds([]),this.selectionModel.setSelectedIds(t);const{onSelect:s}=this.props;if(t.length>0&&s){const e=this.findTreeItem(t[0]);e&&s(e)}}))}else{const e=structuredClone(a.map((e=>this.findTreeItem(e))));this.props.onCreate&&this.props.onCreate(e,n.parentId,n.index,!1).then((e=>{const t=Array.isArray(e)?e:e?.items||[];Boolean(t)&&t.length>0&&(this.selectionModel.setSelectedIds(t.map((e=>e.id))),this.SelectionMixinSetLead(t[0].id))}))}};moveNode=(e,t)=>{const{onMove:s}=this.props;if(s&&this.canMoveUpDown(e,t)){const n={parentId:e.parentId,index:t?e.index-1:e.index+2,pageIndex:void 0},i=t?"above":"below";s([e.id],n,i)}};canMoveUpDown=(e,t)=>{if(!0===t&&0===e.index)return!1;if(!1===t){let t=0;if(e.parentId===this.props.rootId)t=this.props.nodes.length,t>0&&this._isTrashFolder(this.props.nodes[t-1])&&t--;else{const s=this.findTreeItem(e.parentId);s&&s.children&&(t=s.children.length)}if(e.index+1>=t)return!1}const s=!!this.props.sorting&&this.props.sorting.sortOrder!==ui.Z.NO_SORTING,n=!this.props.supportsUpDownMove||this.props.supportsUpDownMove(e,t);return!s&&n};getKeyEventMap=()=>({esc:this.onKeyEscUp,up:this.onKeyArrowUp,down:this.onKeyArrowDown,"alt+up":this.onKeyArrowUp,"alt+down":this.onKeyArrowDown,left:this._collapseFolderOrSelectParent,right:this._expandFolder,del:this.onKeyDelete,home:this.onKeyHome,end:this.onKeyEnd,pageup:this.onKeyPageUp,pagedown:this.onKeyPageDown,"shift+del":this.onKeyShiftDelete,"shift+up":this.onKeyArrowUp,"shift+down":this.onKeyArrowDown,"shift+home":this.onKeyHome,"shift+end":this.onKeyEnd,"shift+pageup":this.onKeyPageUp,"shift+pagedown":this.onKeyPageDown,"ctrl+a":this.onKeySelectAll,"ctrl+left":this._collapseFolderOrSelectParent,"ctrl+right":this._expandFolder,"ctrl+space":this.onKeyCtrlSpace,"ctrl+up":this.onKeyCtrlUp,"ctrl+down":this.onKeyCtrlDown});enableCutCopyPasteListeners=e=>{if(this._canCutCopyPaste=e,this._hasCutCopyPasteListeners!==e){this._hasCutCopyPasteListeners=e;const{document:t}=this.context;this._hasCutCopyPasteListeners?(t.addEventListener("cut",this.onCut),t.addEventListener("copy",this.onCopy),t.addEventListener("paste",this.onPaste),t.addEventListener("contextmenu",this.contextMenuSpy),t.addEventListener("keydown",this.keyDownSpy)):(t.removeEventListener("cut",this.onCut),t.removeEventListener("copy",this.onCopy),t.removeEventListener("paste",this.onPaste),t.removeEventListener("contextmenu",this.contextMenuSpy),t.removeEventListener("keydown",this.keyDownSpy))}};onLostFocus=()=>{this.stopInlineEditTimer(),this.enableCutCopyPasteListeners(!1),this.setState({hasFocus:!1})};onGotFocus=()=>{if(-1===this.state.inlineEditId){let e=this.getSelectedItem();e&&-1===this._getRenderIndex(e.id)&&(e=void 0),this.props.autoFocus&&!e&&this.state.renderArray.length>0&&this.selectByNode(this.state.renderArray[0].node),this.enableCutCopyPasteListeners(!0),this.setState({hasFocus:!0})}};scrollIntoView=e=>{this.refTreeListEntries.current?.scrollToRow(e)};setSelectedIds=e=>{this.selectionModel.resetSelectionModel(),this.selectionModel.selectAll(e),this.saveSelectionModel(),this.updateSelectionState()};selectByIndex=e=>{this.state.renderArray.length>e&&this.selectByNode(this.state.renderArray[e].node)};selectById=(e,t,s)=>{const n=this.props.onSelect?this.findTreeItem(e):{id:e};this.selectByNode(n,t,s)};selectByNode=(e,t,s)=>{const n=e?e.id:-1;this.props.onSelect&&(e&&this.selectionModel.FirstSingleItemSelected===e.id||this.props.onSelect(e)),s||(s=this._getRenderIndex(n)),-1!==s&&this.scrollIntoView(s),t?this.SelectionMixinSelectItem(n,t.ctrlKey,t.shiftKey,t.metaKey,"contextmenu"===t.type):this.SelectionMixinSelectItem(n),this.saveSelectionModel()};scrollToId=e=>{this.scrollIntoView(this._getRenderIndex(e))};onItemClick=(e,t)=>{t.stopPropagation(),this.props.onItemClick&&this.props.onItemClick(t,e)};onItemDoubleClick=(e,t)=>{const{onItemDoubleClick:s,overrideDoubleClick:n,isFolder:i}=this.props;if(this.stopInlineEditTimer(),s){!(n&&n(e))&&i(e)||s(t,e)}};onItemMouseDown=(e,t)=>{if(ai.Z.isNavigationButton(t.button))return;const s=this.selectionModel.selectedIds;let n=!1;for(const t of s)if(t.id===e.id){n=!0;break}this.state.hasFocus&&n&&1===s.length&&t.button===ai.Z.kLeft&&!(0,vi.Z)(t)&&t.target instanceof this.context.HTMLElement&&"title"===t.target.className&&t.timeStamp-this._leftMouseTimeStamp>300?this.startInlineEditTimerForId(e.id):this.stopInlineEditTimer();const i=t.ctrlKey;n&&!i||(n&&i&&1===s.length?this.unSelectAll():this.selectByNode(e,t)),"function"==typeof this.props.onItemMouseDown&&this.props.onItemMouseDown(e,t),t.button===ai.Z.kLeft&&(this._leftMouseTimeStamp=t.timeStamp)};onItemMouseUp=(e,t)=>{ai.Z.isNavigationButton(t.button)||this.props.onItemMouseUp?.(e,t)};onContextMenuOpen=(e,t)=>{t&&this.scrollIntoView(this._getRenderIndex(t.id))};getParentAndIndex=(e,t)=>{let s,n;if(e)if(this.props.isFolder(e))s=e.id,!this.isExpanded(e.id)&&t&&this.toggleExpandModel(e);else{s=e.parentId;const{id:t}=e;if(s===this.props.rootId)this.props.nodes&&(n=this.props.nodes.findIndex((e=>e.id===t))+1);else{const e=this.findTreeItem(s);e&&e.children&&(n=e.children.findIndex((e=>e.id===t))+1)}}else s=this.props.rootId;return{parentId:s,index:n,pageIndex:void 0}};getTargetFromSelection=()=>{const e=this.selectionModel.FirstSingleItemSelected;let t;return e&&-1!==e&&(t=this.findTreeItem(e),this.props.isValidAddTarget&&!this.props.isValidAddTarget(t)&&(t=void 0)),this.getParentAndIndex(t,!0)};onAdd=async(e,t)=>{const s=this.props.buildItem?this.props.buildItem(e,t):{...t,children:"folder"===e?[]:void 0,separator:"separator"===e},{parentId:n,index:i}=this.getTargetFromSelection();if(!this.props.onCreate)return;const a=await this.props.onCreate([s],n,i,!0);if(!a)return;const o=Array.isArray(a)?a:a.items,r=Boolean(!Array.isArray(a)&&a.props?.edit);if(1!==o.length)return;const[l]=o;this.getSelectedId()!==l.id&&this.selectByNode(l),r&&this.startInlineEdit(l.id)};onSave=()=>{const{onSave:e}=this.props;e&&e(this.getAllSelectedItems().map((e=>e.id)))};onSaveAll=()=>{this.props.onSave&&this.props.onSave([])};onExport=()=>{const{onExport:e}=this.props;e&&e(this.getAllSelectedItems().map((e=>e.id)))};onExportAll=()=>{this.props.onExport&&this.props.onExport([])};onDelete=e=>{let t=this.getAllSelectedItems().map((e=>e.id));if(this.props.validateForDeletion&&(t=this.props.validateForDeletion(t)),t.length>0){if(!this.props.confirmDelete)return this.onDeleteItems(t,e);this.props.confirmDelete(t).then((s=>{if(s)return this.onDeleteItems(t,e)}))}return Promise.resolve()};onDeleteItems=async(e,t)=>{const s=this.props.delete;if(!s||!e.length)return;let n;for(const e of this.selectionModel.selectedIds){const t=this._getRenderIndex(e.id);(!n||t<n)&&(n=t)}n=n??0;const i=this.state.renderArray[n].node;let a=void 0!==i.parentId?this.findTreeItem(i.parentId):void 0;const o=e=>{this.selectByNode(e),e&&this.props.activateAfterDelete&&this.props.activateAfterDelete(e)};try{await s(e,t)}catch{}if(this.props.disableSelectAfterDelete)return;const r=this.state.renderArray.filter((t=>!e.includes(t.node.id)));if(0===r.length)o(void 0);else if(a){if(this.props.hasChildren(a)&&a?.children){let t=a.children;t=t.filter((t=>!e.includes(t.id))),t=this.sortItems(t,this.props.sorting),a={...a,children:t}}if(this.props.hasChildren(a)&&a?.children){const e=a.children;if(1===e.length)o(e[0]);else{const t=e[0],s=e[e.length-1],i=this._getRenderIndex(t.id),a=this._getRenderIndex(s.id);if(n<=i)o(t);else if(n>=a)o(s);else{let t=0;if(a-i+1>e.length){const e=n-i;for(let s=0;s<e;s++){const e=r[i+s].node;this.props.hasChildren(e)&&this.isExpanded(e.id)&&(t-=e.children.length)}}o(e[n-i+t])}}}else o(a)}else{let e=this.state.renderArray.filter((e=>e.node.parentId===this.props.rootId||this._isTrashFolder(e.node)));const t=e.findIndex((e=>e.node.id===i.id));if(t>=0){e=r.filter((e=>e.node.parentId===this.props.rootId||this._isTrashFolder(e.node)));const s=e.length-1;o(e[Math.min(t,s)].node)}else{const e=r.length-1;o(r[Math.min(n,e)].node)}}};onKeyCtrlUp=ii.throttleSync((e=>{const t=this.selectionModel.leadIndex,s=this._getRenderIndex(t);if(0===s)return;const n=-1===s?this.state.renderArray.length-1:s-1;if(n<0)return;const i=this.state.renderArray[n].node;this.SelectionMixinSetLead(i.id),this.scrollIntoView(n)}));onKeyCtrlDown=ii.throttleSync((e=>{const t=this.selectionModel.leadIndex,s=this._getRenderIndex(t);if(s===this.state.renderArray.length-1)return;const n=s+1,i=this.state.renderArray[n].node;this.SelectionMixinSetLead(i.id),this.scrollIntoView(n)}));onKeyArrowDown=ii.throttleSync((e=>{const t=this.selectionModel.leadIndex,s=this._getRenderIndex(t);if(s!==this.state.renderArray.length-1){if(!0===e.altKey)this.moveNode(this.state.renderArray[s].node,!1);else{const t=s+1,n=this.state.renderArray[t].node;this.selectByNode(n,e,t)}e.preventDefault(),e.stopPropagation()}}));onKeyArrowUp=ii.throttleSync((e=>{const t=this.selectionModel.leadIndex,s=this._getRenderIndex(t);if(0!==s){if(!0===e.altKey)this.moveNode(this.state.renderArray[s].node,!0);else{const t=-1===s?this.state.renderArray.length-1:s-1;if(t<0)return;const n=this.state.renderArray[t].node;this.selectByNode(n,e,t)}e.preventDefault(),e.stopPropagation()}}));onKeyEscUp=e=>{this.selectionModel.setSelectedIds([])};onKeyHome=e=>{const t=this.state.renderArray[0].node;this.selectByNode(t,e,0),e.preventDefault(),e.stopPropagation()};onKeyEnd=e=>{const t=this.state.renderArray.length,s=this.state.renderArray[t-1].node;this.selectByNode(s,e,t-1),e.preventDefault(),e.stopPropagation()};onKeyPageDown=ii.throttleSync((e=>{const t=this.selectionModel.leadIndex,s=this._getRenderIndex(t),{height:n,renderArray:i}=this.state;let a=0,o=s;for(;o<i.length-1&&a<n;)a+=i[o].height,o++;if(o===s)return;const r=i[o].node;this.selectByNode(r,e,o),e.preventDefault(),e.stopPropagation()}));onKeyPageUp=ii.throttleSync((e=>{const t=this.selectionModel.leadIndex,s=this._getRenderIndex(t),{height:n,renderArray:i}=this.state;let a=0,o=s;for(;o>0&&a<n;)a+=i[o].height,o--;if(o===s)return;const r=i[o].node;this.selectByNode(r,e,o),e.preventDefault(),e.stopPropagation()}));handleKeyDelete=(e,t)=>{this.onDelete(t),e.preventDefault(),e.stopPropagation()};onKeyShiftDelete=e=>{this.handleKeyDelete(e,!0)};onKeyDelete=e=>{this.handleKeyDelete(e,!1)};onKeySelectAll=()=>{this.SelectionMixinSelectAll(),this.saveSelectionModel()};onKeyCtrlSpace=e=>{const t=this.selectionModel.leadIndex;this.SelectionMixinSelectItem(t,e.ctrlKey,e.shiftKey,e.metaKey,"contextmenu"===e.type)};_setExpandState=(e,t)=>{t!==this.isExpanded(e.id)&&this.toggleExpandModel(e)};_collapseFolderOrSelectParent=e=>{const t=this.findTreeItem(this.getSelectedId());if(t)if(this._isFolderWithChildren(t)&&this.isExpanded(t.id))this._setExpandState(t,!1);else{const e=this.findTreeItem(t.parentId);e&&this.selectByNode(e)}e.preventDefault(),e.stopPropagation()};expandToId=e=>{let t=this.findTreeItem(e);for(;t;)t=this.findTreeItem(t.parentId),t&&this.isFolder(t)&&this._setExpandState(t,!0)};_expandFolder=e=>{const t=this.findTreeItem(this.getSelectedId());t&&this._isFolderWithChildren(t)&&this._setExpandState(t,!0),e.preventDefault(),e.stopPropagation()};unSelectAll=()=>{this.selectByNode(void 0)};isItemLead=e=>e===this.selectionModel.leadIndex;isItemSelected=e=>this.selectionModel.isSelected(e);supportDropForItem=(e,t)=>this.props.getDropSupport?this.props.getDropSupport(e,t):{available:!1,onto:!1,edge:"none"};onDragLeaveItem=(e,t)=>{this.cancelDragOverObject(),this.resetAutoExpandTimer()};onDragOverItem=(e,t,s,n)=>{const i=n.currentTarget;if(!this.supportDropForItem(e,n).available)return;const a=i.getBoundingClientRect(),o=this.getRowHeight(this.state.renderArray[t]),r=(n.clientY-a.top)/o;let l="";const d="both"===s.edge||"above"===s.edge,c="both"===s.edge||"below"===s.edge;!0===s.onto?l=r<=.25?d?"above":"on":r>.75&&c?"below":"on":r<=.5&&d?l="above":r>.5&&c&&(l="below"),(this.state.dragOverObj.id!==e.id||this.state.dragOverObj.id===e.id&&this.state.dragOverObj.position!==l)&&this.setState({rowCache:new WeakMap,dragOverObj:{id:e.id,position:l}},this.initAutoExpandTimer(e,l))};initAutoExpandTimer=(e,t)=>{this.isExpanded(e.id)||!this.props.isFolder(e)||"on"!==t?this.resetAutoExpandTimer():this.#l?.id!==e.id&&(this.resetAutoExpandTimer(),this.#l=e,this.expandTimer=setTimeout(this.onAutoExpandTimer,1200))};resetAutoExpandTimer=()=>{this.expandTimer&&(clearTimeout(this.expandTimer),delete this.expandTimer,this.#l=void 0)};onAutoExpandTimer=()=>{void 0!==this.#l&&(this.state.dragOverObj.id===this.#l.id&&"on"===this.state.dragOverObj.position&&this.toggleExpandModel(this.#l),this.resetAutoExpandTimer())};onDragEmptyArea=e=>{if(this.state.renderArray.length>0){const t=this.state.renderArray[this.state.renderArray.length-1].node;this._dropSupport=this.supportDropForItem(t,e),this._dropSupport.available&&"none"!==this._dropSupport.edge&&(e.preventDefault(),e.nativeEvent.dataTransfer.dropEffect="move",this.state.dragOverObj.id!==t.id&&"below"!==this.state.dragOverObj.position&&this.setState({dragOverObj:{id:t.id,position:"below"}}))}e.stopPropagation()};onDropEmptyArea=e=>{if(this.resetAutoExpandTimer(),this.state.renderArray.length>0&&this._dropSupport.available){const t=this.state.renderArray[this.state.renderArray.length-1].node;this.onDrop(t,this._dropSupport,e),this._dropSupport={available:!1,onto:!1,edge:"none"}}e.preventDefault(),e.stopPropagation()};onDrop=(e,t,s)=>{this.setState({isDragging:!1}),this.resetAutoExpandTimer();const n=Jn.ZP.isCopyModifierPressed(s),i=this.state.dragOverObj.position,{mimeType:a}=this.props;switch(i){case"above":if("both"!==t.edge&&"above"!==t.edge)return void this.cancelDragOverObject();break;case"below":if("both"!==t.edge&&"below"!==t.edge)return void this.cancelDragOverObject();break;case"on":if(!1===t.onto)return void this.cancelDragOverObject();break;default:return void this.cancelDragOverObject()}let o;if(a&&s.dataTransfer&&-1!==s.dataTransfer.types.findIndex((e=>e===a))?o=JSON.parse(s.dataTransfer.getData(a)):this.props.onDrop&&this.props.onDrop(s,e,i).then((e=>{this.cancelDragOverObject(),e&&e.length>0&&this.selectByNode(e[0])})),!o||o.length<=0)return void this.cancelDragOverObject();const r=this.props.isFolder(e);let l=!1,d={index:0,parentId:void 0,pageIndex:void 0};this.props.getTargetSpec?d=this.props.getTargetSpec(e,i):"above"===i?(d.index=parseInt(e.index),d.parentId=e.parentId):"on"===i?d.parentId=r?e.id:e.parentId:"below"===i&&(r&&this.isExpanded(e.id)?d.parentId=e.id:(d.index=parseInt(e.index)+1,d.parentId=e.parentId));const c=o.map((t=>{if(t===e.id)return void(l=!0);const s=this.findTreeItem(t);if(n||!this.props.isFolder(s)||!s||!this.findItemInFolder(s,e.id))return s;l=!0})).filter((e=>null!==e));if(l||c.length<=0)this.cancelDragOverObject();else if(n){const e=structuredClone(c);this.props.onCreate&&this.props.onCreate(e,d.parentId,d.index,!1).then(this.cancelDragOverObject())}else{const e=c.map((e=>e.id));this.props.onMove?.(e,d,i).then((()=>{this.cancelDragOverObject()}))}};cancelDragOverObject=()=>{this.setState({dragOverObj:this.emptyDragOverObj})};onDragEndItem=()=>{this.cancelDragOverObject(),this.setState({isDragging:!1})};onItemDragStart=e=>{this.stopInlineEditTimer(),this.props.onItemDragStart&&this.props.enableDragAndDrop&&this.props.onItemDragStart(e),this.setState({isDragging:!0})};onCompositionStart=()=>{this._isComposing=!0};onCompositionEnd=()=>{this._isComposing=!1};onKeyDown=async e=>{const{ctrlKey:t,altKey:s,shiftKey:n,metaKey:i}=e,a={ctrlKey:t,altKey:s,shiftKey:n,metaKey:i},o=(0,Zi.VV)(a);if(this.stopInlineEditTimer(),-1!==this.state.inlineEditId)return void("Escape"===e.key&&o?(e.preventDefault(),await this.cancelInlineEdit(),this.focusTree()):"Enter"!==e.key||this._isComposing?e.key===Ei&&e.preventDefault():(e.preventDefault(),await this.saveInlineEdit(),this.focusTree()));if("Escape"===e.key&&o)this.setCutIds([]),e.preventDefault();else if("\\"===e.key&&o&&this.props.supportsCollapseAll)this.collapseAll();else if(this.props.supportsInlineEdit&&e.key===Ei){const t=!0===this.props.supportsInlineEdit?this.getSelectedItem():void 0;if(t){return void(this.startInlineEdit(t.id)&&e.preventDefault())}}let r=!1;if(this.props.onItemsActivated&&"Enter"===e.key){if(!1===e.repeat){const t=this.getAllSelectedItems();t&&this.props.onItemsActivated&&this.props.onItemsActivated(e,t,!0)}r=!0,e.preventDefault()}const l=Qe.Z.keyComboFromEvent(e.nativeEvent),d=this.getKeyEventMap()[l];d&&d(e.nativeEvent),!r&&this.props.onKeyDown&&this.props.onKeyDown(e)};startInlineEditTimerForId=e=>{this.stopInlineEditTimer(),!0===this.props.supportsInlineEdit&&(this.inlineEditTimeoutId=setTimeout(this.startInlineEdit.bind(this,e),700))};stopInlineEditTimer=()=>{clearTimeout(this.inlineEditTimeoutId),delete this.inlineEditTimeoutId};startInlineEditForSelectedItem=()=>{const e=this.selectionModel.FirstSingleItemSelected;-1!==e&&this.startInlineEdit(e)};startInlineEdit=e=>{const t=this.selectionModel.selectedIds;if(1===t.length&&t[0].id===e){const t=this.state.renderArray.filter((t=>t.node.id===e));if(1===t.length&&this.props.isValidToEdit?.(t[0].node.id))return this.setState({inlineEditId:e,inlineEditText:this.props.getTitle?this.props.getTitle(e):"",rowCache:new WeakMap}),!0}return!1};getInlineEditId=()=>-1===this.state.inlineEditId?void 0:this.state.inlineEditId;setInlineEditText=e=>{const t=e.target.value;this.setState({inlineEditText:t,rowCache:new WeakMap})};cancelInlineEdit=()=>new Promise((e=>{this.setState({inlineEditId:-1,inlineEditText:"",rowCache:new WeakMap},e)}));saveInlineEdit=()=>new Promise(((e,t)=>{if(-1===this.state.inlineEditId||!this.props.saveTitle)return t();this.props.saveTitle(this.state.inlineEditId,this.state.inlineEditText),this.setState({inlineEditId:-1,inlineEditText:"",rowCache:new WeakMap},e)}));onRowsRendered=e=>{this._onRowsRenderedOptions&&Rs.Z.set({[this._onRowsRenderedOptions]:e}),this.props.onRowsRendered&&this.props.onRowsRendered(e)};updateScrollTop=()=>{if(this._scrollTopNeedsUpdate){this._scrollTopNeedsUpdate=!1;const e=Rs.Z.getSync(this._scrollTopSettings);this.refTreeListEntries.current?.setScrollTop(e)}};onScroll=e=>{if(!this._isMounted)return;const{scrollTop:t}=e;this._scrollTopSettings&&(Rs.Z.cacheValues(this._scrollTopSettings,t),Rs.Z.set({[this._scrollTopSettings]:t})),this.props.onScroll&&this.props.onScroll(e)};getVisibleNodes=()=>{const e=Rs.Z.getSync(this._onRowsRenderedOptions);if(e){const{startIndex:t,stopIndex:s}=e;return this.state.renderArray.slice(t,s+1)}return[]};getSelectedItem=()=>this.findTreeItem(this.selectionModel.leadIndex);getSelectedId=()=>this.selectionModel.FirstSingleItemSelected;isFolder=e=>Boolean(e&&this.props.isFolder(e));_isTrashFolder=e=>this.props.isTrashFolder?this.props.isTrashFolder(e):!0===e.trash;_isFolderWithChildren=e=>e.children&&e.children.length>0;_isModelExpanded=(e,t)=>"0"===e||!0===t[e]||"expand"===this.props.folderMode&&void 0===t[e];makeRenderArray=(e,t,s)=>{let n=[],i=0;if(!e||0===e.length)return n;e=this.sortItems(e,s);const a=s&&s.sortOrder!==ui.Z.NO_SORTING,o=(e,s,r=[])=>{if(a&&this.props.isSeparator&&this.props.isSeparator(e))return;if(r.includes(e))return void console.error("Trees should be acyclic",{node:e});if(0===s){const e=n.at(-1);if(e&&e.level>0){e.isLastChild=!0;const t=this.getRowHeight(e.node,!0);t!==e.height&&(i+=t-e.height,e.height=t)}}const l=this.getRowHeight(e);if(i+=l,n.push({node:e,level:s,height:l,accumulatedHeight:i,isLastChild:!1}),this.props.hasChildren(e)&&this._isModelExpanded(e.id,t))for(const t of e.children)r.push(e),o(t,s+1,r),r.pop()};return(()=>{for(const t of e){if("top"===this.props.anchor&&i>ki)break;o(t,0)}const t=n[n.length-1];if(t.isLastChild=!0,"bottom"===this.props.anchor&&t.accumulatedHeight>ki){const e=t.accumulatedHeight-ki;let s=Ft()(n,{accumulatedHeight:e},((e,t)=>e.accumulatedHeight-t.accumulatedHeight));s<0&&(s=-s-1);const i=n[s];n=n.slice(s+1);for(const e of n)e.accumulatedHeight-=i.accumulatedHeight}})(),n};canSort=e=>Boolean(e&&e.sortOrder&&e.sortOrder!==ui.Z.NO_SORTING);sortItems=(e,t)=>{if(!t||!this.canSort(t)||t?.onlyScroll)return e;!1!==this.props.supportsDeepCopy&&(e=structuredClone(e));const s=t.comparator||ui.Z.getDefaultComparator(t.sortOrder,t.sortField);return ui.Z.treeSort(e,s),e};getSelectedFromTree=()=>{const e=[],t=this,s=function(n){for(let i=0;i<n.length;i++){const a=n[i];t.selectionModel.isSelected(a.id)?e.push(a):a.children&&s(a.children)}};return s(this.props.nodes),e};getAllSelectedItems=()=>{const e=this.selectionModel.selectedIds;if(0===e.length)return e;if(e.length>1&&!this.canSort(this.props.sorting))return this.getSelectedFromTree();const t=function(e,s){for(let n=0;n<e.length;n++){let i=e[n];if(i.id===s)return i;if(i.children&&(i=t(i.children,s),i))return i}},s=e.map((e=>t(this.props.nodes,e.id))).filter((e=>void 0!==e));return this.sortItems(s,this.props.sorting)};getSelectedCount=()=>this.selectionModel.selectedIds.length;findTreeItem=e=>{function t(s){if(s.id===e)return s;if(s.children)for(let e=0;e<s.children.length;e++){const n=t(s.children[e]);if(n)return n}}for(let e=0;e<this.props.nodes.length;e++){const s=t(this.props.nodes[e]);if(s)return s}return null};findItemInFolder=(e,t)=>{let s=null;const n=e=>{if(e.id===t)return s=e;e.children&&e.children.forEach(n)};return e.children.forEach(n),s};getIdsBetween=(e,t)=>{const s=this._getRenderIndex(e),n=this._getRenderIndex(t);let i=[];return i=s>n?this.state.renderArray.slice(n,s+1):this.state.renderArray.slice(s,n+1),i.map((e=>e.node.id))};getAllIds=()=>this.state.renderArray.map(((e,t)=>e.node.id||t));getRenderArray=()=>this.state.renderArray;getId=e=>this.state.renderArray[e].node.id||e;getSearchStyle=()=>"flat"===Rs.Z.getSync(this._searchStyleSettings)?"flat":"tree";setSearchStyle=e=>{const t={};t[this._searchStyleSettings]=e,Rs.Z.set(t,(()=>{this.props.onSearchStyleChanged&&this.props.onSearchStyleChanged(e)}))};getNamedContextMenuItems=(e,t)=>{const s=this.context.vivaldiWindowId,n=ei.Z.getOptionFunction(e.name),{document:i}=this.context,a={selectedCount:this.getSelectedCount(),...e.getState?e.getState(t):{}};return ei.Z.getNamedMenu(s,e.name,(async o=>{switch(o.action){case"CONTEXT_EXPAND_ALL":return{handler:this.expandAll,isVisible:()=>e.getVisibility(o,t),...n(s,o,a)};case"CONTEXT_COLLAPSE_ALL":return{handler:this.collapseAll,...n(s,o,a),isVisible:()=>e.getVisibility(o,t)};case"CONTEXT_NEW_ITEM":return{handler:()=>{this.onAdd("item")},isVisible:()=>e.getVisibility(o,t),...n(s,o,a)};case"CONTEXT_NEW_FOLDER":return{handler:()=>{this.onAdd("folder")},isVisible:()=>e.getVisibility(o,t),...n(s,o,a)};case"CONTEXT_NEW_SEPARATOR":return{handler:()=>{this.onAdd("separator")},isVisible:()=>e.getVisibility(o,t),...n(s,o,a)};case"CONTEXT_EDIT":return{handler:()=>{this.props.onEdit?.()},isVisible:()=>e.getVisibility(o,t)&&"function"==typeof this.props.onEdit,...n(s,o,a)};case"CONTEXT_RENAME":return{handler:()=>{this.startInlineEditForSelectedItem()},isVisible:()=>e.getVisibility(o,t),...n(s,o,a),shortcuts:[Ei]};case"CONTEXT_CUT":return{handler:()=>{i.execCommand("cut")},isVisible:()=>e.getVisibility(o,t),...n(s,o,a),shortcuts:["ctrl+x"]};case"CONTEXT_COPY":return{handler:()=>{i.execCommand("copy")},isVisible:()=>e.getVisibility(o,t),...n(s,o,a),shortcuts:["ctrl+c"]};case"CONTEXT_PASTE":return{handler:()=>{i.execCommand("paste")},isVisible:()=>e.getVisibility(o,t),...n(s,o,a),shortcuts:["ctrl+v"]};case"CONTEXT_SAVE":return{handler:()=>{this.onSave()},isVisible:()=>e.getVisibility(o,t),...n(s,o,a)};case"CONTEXT_SAVE_ALL":return{handler:()=>{this.onSaveAll()},isVisible:()=>e.getVisibility(o,t),...n(s,o,a)};case"CONTEXT_EXPORT":return{handler:()=>{this.onExport()},isVisible:()=>e.getVisibility(o,t),...n(s,o,a)};case"CONTEXT_EXPORT_ALL":return{handler:()=>{this.onExportAll()},isVisible:()=>e.getVisibility(o,t),...n(s,o,a)};case"CONTEXT_DELETE":return{handler:()=>{this.onDelete(!1)},isVisible:()=>e.getVisibility(o,t),...n(s,o,a),shortcuts:["delete"]};case"CONTEXT_IMPORT":return{handler:()=>{this.onImport()},isVisible:()=>e.getVisibility(o,t),...n(s,o,a)};case"CONTEXT_CONTAINER_SEARCH":{const i=this.getSearchStyle();return{items:[{type:"radio",radiogroup:1,checked:"flat"===i,handler:this.setSearchStyle.bind(this,"flat"),...(0,fi.Z)("Flat Search")},{type:"radio",radiogroup:1,checked:"tree"===i,handler:this.setSearchStyle.bind(this,"tree"),...(0,fi.Z)("Tree Search")}],isVisible:()=>e.getVisibility(o,t),...n(s,o,a)}}default:return e.getCapability(o,n,t,a)}}))};getContextMenuItemsPromise=e=>this.props.getContextMenuItemsPromise?this.props.getContextMenuItemsPromise(e).then((t=>this.appendStandardMenuItems(e,t))):Promise.resolve([]);getContextMenuItems=e=>{if(!0===this.props.appendContextItems){let t=this.appendStandardMenuItems(e,[]);const s=this.props.getContextMenuItems?this.props.getContextMenuItems(e):[];return t.length>0&&s.length>0&&(t=t.concat([st.Z.separatorItem]),t=t.concat(s)),t}{const t=this.props.getContextMenuItems?this.props.getContextMenuItems(e):[];return this.appendStandardMenuItems(e,t)}};appendStandardMenuItems=(e,t)=>{const s=this.props.getContextMenuItemProps?this.props.getContextMenuItemProps(e):{},n=()=>{t.length>0&&t.push(st.Z.separatorItem)};if((s.showNewItem||s.showNewFolder||s.showNewSeparator||s.showEdit||s.showMoveUp||s.showMoveDown||s.showRename)&&(n(),s.showNewItem&&t.push({handler:()=>{this.onAdd("item")},isVisible:()=>s.showNewItem,...this.props.getContextMenuNewItemString?this.props.getContextMenuNewItemString():st.Z.makeLabelPair("")}),s.showNewFolder&&t.push({handler:()=>{this.onAdd("folder")},isVisible:()=>s.showNewFolder,...(0,fi.Z)("command","New Folder")}),s.showNewSeparator&&t.push({handler:()=>{this.onAdd("separator")},isVisible:()=>s.showNewSeparator,...(0,fi.Z)("New Separator")}),(s.showEdit||s.showRename)&&n(),s.showEdit&&t.push({handler:()=>{this.props.onEdit&&this.props.onEdit()},isVisible:()=>s.showEdit,...(0,fi.Z)("verb","Edit")}),s.showRename&&t.push({handler:()=>this.startInlineEditForSelectedItem(),isVisible:()=>s.showRename,shortcuts:[Ei],...(0,fi.Z)("Rename")}),(s.showMoveUp||s.showMoveDown)&&(n(),t.push({handler:()=>{const e=this.getSelectedItem();e&&this.moveNode(e,!0)},isVisible:()=>s.showMoveUp,shortcuts:["alt+up"],...(0,fi.Z)("Move Up")}),t.push({handler:()=>{const e=this.getSelectedItem();e&&this.moveNode(e,!1)},isVisible:()=>s.showMoveDown,shortcuts:["alt+down"],...(0,fi.Z)("Move Down")}))),s.showCut||s.showCopy||s.showPaste){n();const{document:e}=this.context,i=[{handler:()=>{e.execCommand("cut")},isVisible:()=>!0===s.showCut,shortcuts:["ctrl+x"],...(0,fi.Z)("verb","Cut")},{handler:()=>{e.execCommand("copy")},isVisible:()=>!0===s.showCopy,shortcuts:["ctrl+c"],...this.props.getContextMenuCopyString?this.props.getContextMenuCopyString():(0,fi.Z)("verb","Copy")},{handler:()=>{e.execCommand("paste")},shortcuts:["ctrl+v"],isVisible:()=>!0===s.showPaste,...(0,fi.Z)("verb","Paste")}];t=t.concat(i)}if((s.showSave||s.showSaveAll)&&(n(),s.showSave&&(t=t.concat([{handler:()=>{this.onSave()},...this.props.getContextMenuSaveString?this.props.getContextMenuSaveString():(0,fi.Z)("verb","Save")}])),s.showSaveAll&&(t=t.concat([{handler:()=>{this.onSaveAll()},...this.props.getContextMenuSaveAllString?this.props.getContextMenuSaveAllString():(0,fi.Z)("verb","Save All")}]))),(s.showExport||s.showExportAll)&&(n(),s.showExport&&(t=t.concat([{handler:()=>{this.onExport()},...this.props.getContextMenuExportString?this.props.getContextMenuExportString():(0,fi.Z)("verb","Export")}])),s.showExportAll&&(t=t.concat([{handler:()=>{this.onExportAll()},...this.props.getContextMenuExportAllString?this.props.getContextMenuExportAllString():(0,fi.Z)("verb","Export All")}]))),s.showDelete&&(n(),t.push({handler:()=>{this.onDelete(!1)},shortcuts:["delete"],...this.props.getContextMenuDeleteString?this.props.getContextMenuDeleteString():(0,fi.Z)("verb","Delete")})),s.showExpandCollapse){n();const e=[{handler:this.expandAll,...(0,fi.Z)("Expand All Folders")},{handler:this.collapseAll,...(0,fi.Z)("Collapse All Folders")}];t=t.concat(e)}if(s.showImport&&(n(),t.push({handler:this.onImport,ellipsis:!0,...this.props.getContextMenuImportString?this.props.getContextMenuImportString():(0,fi.Z)("Import")})),s.showSettings){n();const e=this.getSearchStyle(),s=[{type:"checkbox",checked:"flat"===e,handler:this.setSearchStyle.bind(this,"flat"),...(0,fi.Z)("Flat Search")},{type:"checkbox",checked:"tree"===e,handler:this.setSearchStyle.bind(this,"tree"),...(0,fi.Z)("Tree Search")}];t=t.concat([{items:s,...(0,fi.Z)("Settings")}])}if(s.showCustomSettings&&(n(),this.props.addCustomSettingMenu&&(t=t.concat([this.props.addCustomSettingMenu()]))),s.showFullscreen){n();const e=[{handler:()=>Wn.Z.toggleFullscreen(this.context.vivaldiWindowId),...(0,fi.Z)("Fullscreen")}];t=t.concat(e)}return t};onResize=e=>{const t=e[0].contentRect;this.updateTreeSize(Math.ceil(t.width),Math.ceil(t.height))};updateTreeSize=(e,t)=>{this._isMounted&&this.setState({width:e,height:t})};onContextMenu=async e=>{let t;if(e?.button>0&&e.currentTarget?.className?.includes("vivaldi-tree")||(t=this.getSelectedItem()),this.props.menu)return e.persist(),e.preventDefault(),e.stopPropagation(),void(this.props.menu&&this.getNamedContextMenuItems(this.props.menu,t).then((s=>{(0,mi.Z)(this.context,s,(s=>{s&&this.onContextMenuOpen(e,t)}))(e)})));let s;e.preventDefault(),e.stopPropagation(),this.props.getContextMenuItemsPromise?(e.persist(),s=await this.getContextMenuItemsPromise(t)):s=this.getContextMenuItems(t),(0,mi.Z)(this.context,s,(s=>{s&&this.onContextMenuOpen(e,t)}))(e)};isDraggable(e){let t=(this.props.enableDragAndDrop??!1)&&this.state.inlineEditId!==e.id;return t&&this.props.isValidDragSource&&(t=this.props.isValidDragSource(e)),t&&this.props.validateForDrag&&(t=0!==this.props.validateForDrag([e.id]).length),t}renderTreeItem=e=>{const{index:t,style:s}=e,n=this.state.renderArray[t].node,{level:i,isLastChild:a}=this.state.renderArray[t];void 0===n.id&&(n.id=t);const o=this.selectionModel.isSelected(n.id),r=this.state.renderArray[t-1]?.node.id,l=this.state.renderArray[t+1]?.node.id,d=t>=0&&r&&this.selectionModel.isSelected(r),c=l&&this.selectionModel.isSelected(l),h=this.selectionModel.leadIndex===n.id,u=this.props.cutIds&&this.props.cutIds.indexOf(n.id)>-1,p=n.children?.length&&this.isExpanded(n.id),g=this.isDraggable(n),m=this.state.inlineEditId===n.id?this.state.inlineEditText:void 0,f={node:n,level:i,isExpanded:p,isSelected:o,inlineEditText:m,onChange:this.setInlineEditText,isLastChild:a,onFocus:_i,onBlur:this.saveInlineEdit},{rowComponent:v,getRowComponentProps:b}=this.props,C=b?b(f):f;return(0,zn.jsx)(hi,{index:t,Component:v,componentProps:C,treeItem:n,style:s,overrideDoubleClick:this.props.overrideDoubleClick,isExpanded:p,isSeparator:this.props.isSeparator,toggleExpandModel:this.toggleExpandModel,onContextMenu:this.onContextMenu,onMouseDown:this.onItemMouseDown,onMouseUp:this.onItemMouseUp,selected:o,isFirstSelected:o&&!d,isLastSelected:o&&!c,lead:h,isCut:u,validateForDrag:this.props.validateForDrag,onDragStart:this.onItemDragStart,supportDrop:this.props.enableDragAndDrop?this.supportDropForItem:null,onDragLeave:this.props.enableDragAndDrop?this.onDragLeaveItem:null,onDragOver:this.props.enableDragAndDrop?this.onDragOverItem:null,onDragEnd:this.onDragEndItem,onDrop:this.onDrop,mimeType:this.props.mimeType,getDragData:this.props.getDragData,setCustomEventBehavior:this.props.setCustomEventBehavior,dragover:this.state.dragOverObj.id===n.id,dragOverObj:this.state.dragOverObj,inlineEditText:m,getAllSelectedItems:this.getAllSelectedItems,isFolder:this.props.isFolder,isDraggable:g,hasChildren:this.props.hasChildren,onItemClick:this.onItemClick,onItemDoubleClick:this.onItemDoubleClick,enableDragAndDrop:this.props.enableDragAndDrop,disableMousePointersOverride:this.props.disableMousePointersOverride},t)};getStyle=Ci()((e=>({"--gridColumns":e&&Ai(e)})));render(){const e=Gn()(this.props.className,{"vivaldi-tree":!this.props.className,"no-selection":-1===this.selectionModel.anchorIndex}),t=this.props.anchor??"top";return(0,zn.jsx)(ti.Z,{style:this.getStyle(this.props.columns),className:e,onBlur:this.onLostFocus,onKeyDown:this.onKeyDown,onDragOver:this.props.enableDragAndDrop?this.onDragEmptyArea:void 0,onDragLeave:this.props.enableDragAndDrop?this.cancelDragOverObject:void 0,onDrop:this.props.enableDragAndDrop?this.onDropEmptyArea:void 0,onClick:this.unSelectAll,onCompositionStart:this.onCompositionStart,onCompositionUpdate:this.onCompositionStart,onCompositionEnd:this.onCompositionEnd,onContextMenu:this.onContextMenu,onResize:this.onResize,children:(0,zn.jsx)(gi,{ref:this.refTreeListEntries,onRowsRendered:this.onRowsRendered,onScroll:this.onScroll,height:this.state.height,bufferHeightLead:this.props.bufferHeightLead,bufferHeightTrail:this.props.bufferHeightTrail,rowRenderer:this.renderTreeItem,nodes:this.state.renderArray,rowCache:this.state.rowCache,stabilizeScrollTop:this.props.stabilizeScrollTop,containerStyle:{pointerEvents:"auto"},isDragging:this.state.isDragging,anchor:t})})}}const Mi=Pi;function Di({onExpandClick:e,inManager:t,fullView:s,node:n,level:i,isExpanded:a,inlineEditText:o,onChange:r,onBlur:l,onFocus:d,showBadge:c,onMouseEnter:h,onMouseLeave:u}){const p=(i+1)*Ni+"px",m=i*Ni+"px",f=Boolean(n.children),v=Boolean(f&&n.children.length),{favIconUrl:b,favIconLoadType:C}=vs.jk.getBookmarkFavicon(n.url,n.faviconUrl);return(0,zn.jsxs)("label",{"data-parent":n.parentId,onMouseEnter:h,onMouseLeave:u,children:[f&&v&&(0,zn.jsx)("span",{className:"expand-icon",style:{marginLeft:m},onMouseUp:t=>{const s=t.altKey;e(n.id,s)},onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},dangerouslySetInnerHTML:{__html:Kn.nfH}}),f&&n.trash&&(0,zn.jsx)(qn,{speeddial:n.speeddial,open:a,trash:!0,leftMargin:v?0:p}),f&&!n.trash&&(0,zn.jsx)(qn,{speeddial:n.speeddial,open:a,trash:!1,leftMargin:v?0:p}),!f&&(0,zn.jsx)(Vn.ZP,{url:b,loadType:C,style:{marginLeft:p},className:"tree-row-image bookmark-icon"}),void 0!==o&&(0,zn.jsx)("input",{type:"text",value:o,onChange:r,onFocus:d,onBlur:l,autoFocus:!0}),void 0===o&&(0,zn.jsx)("span",{className:"title",children:n.title?n.title:g.Z.isBookmark(n)&&!t?n.url:""}),c&&v&&!s&&(0,zn.jsx)("span",{className:"item-count",children:n.children.filter((e=>!g.Z.isSeparator(e))).length})]},"0")}var Oi=s(34155);function ji({node:e,inlineEditText:t,isExpanded:s,level:n,onFocus:i,onChange:a,onBlur:o,onExpandClick:r}){return(0,zn.jsx)(Di,{node:e,inlineEditText:t,isExpanded:s,level:n,inManager:!1,fullView:!1,showBadge:!1,onExpandClick:r,onFocus:i,onChange:a,onBlur:o},e.id)}class Li extends Un.PureComponent{refTreeList=Un.createRef();componentDidMount(){this.setFolderTreeView()}componentDidUpdate(e){const t=this.refTreeList.current?.getSelectedId();e.selectedId===this.props.selectedId||t===this.props.selectedId||this.props.isEditing||this.setFolderTreeView()}async setFolderTreeView(){const{selectedId:e}=this.props,t=this.refTreeList.current?.getSelectedId();if(t!==e&&this.setSelectedId(e),this.props.expandAll)this.refTreeList.current?.expandAll();else{this.refTreeList.current?.collapseAll(),await new Promise((e=>Oi.nextTick(e)));const t=g.Z.getRootId();void 0!==t&&(e&&e!==t?this.refTreeList.current?.expandToId(e):this.refTreeList.current?.expand(t))}await new Promise((e=>Oi.nextTick(e)));e&&"1"!==e&&this.refTreeList.current?.scrollToId(e)}setSelectedId=e=>{this.refTreeList.current?.setSelectedIds([e])};scrollToId=e=>{this.refTreeList.current?.scrollToId(e)};expand=e=>{this.refTreeList.current?.expand(e)};expandAll=()=>{this.refTreeList.current?.expandAll()};toggleSelectedExpansion=(e,t)=>{this.refTreeList.current?.toggleSelectedExpansion(e,t)};startInlineEdit=e=>{this.setSelectedId(e),this.scrollToId(e),this.focus(),this.refTreeList.current?.startInlineEdit(e)};focus=()=>{this.refTreeList.current?.focusTree()};render(){const{folders:e,onSelect:t}=this.props;return(0,zn.jsx)(Mi,{ref:this.refTreeList,className:Gn()(this.props.className,"vivaldi-tree"),nodes:e,hasChildren:e=>e.children?.length,isFolder:e=>Boolean(e.children?.length&&!e.url),onSelect:e=>e&&t(e.id),rowComponent:e=>(0,zn.jsx)(ji,{...e,onExpandClick:this.toggleSelectedExpansion}),saveTitle:this.props.onFolderTitleChange,isValidToEdit:()=>!0,getTitle:()=>this.props.defaultEditFolderText,enableDragAndDrop:!1})}}function Ri(e,t){return t?t>16?e.large:t<16?e.small:e.medium:e.medium}function Bi({icon:e,size:t,className:s}){const n=t&&{"--IconSize":t};return(0,zn.jsx)("span",{style:n,className:Gn()("VivaldiSvgIcon",s),dangerouslySetInnerHTML:{__html:e}})}function Fi({size:e,className:t}){const s=Ri(Kn.GtN,e);return(0,zn.jsx)(Bi,{icon:s,size:e,className:t})}function Wi({size:e,className:t}){const s=Ri(Kn.nre,e);return(0,zn.jsx)(Bi,{icon:s,size:e,className:t})}function Ui({size:e,className:t}){return(0,zn.jsx)(Bi,{icon:Kn.oJy,size:e,className:t})}function Vi({size:e,className:t}){return(0,zn.jsx)(Bi,{icon:Kn.u0H,size:e,className:t})}function Hi({size:e,className:t}){return(0,zn.jsx)(Bi,{icon:Kn.V_c,size:e,className:t})}function Gi({size:e,className:t}){return(0,zn.jsx)(Bi,{size:e,className:t,icon:'\n<svg width="8" height="12" viewBox="0 0 8 12" xmlns="http://www.w3.org/2000/svg">\n  <path d="M7.06006 1.60666L6.1134 0.666656L4.00006 2.77999L1.88673 0.666656L0.940063 1.60666L4.00006 4.66666L7.06006 1.60666ZM0.940063 10.3933L1.88673 11.3333L4.00006 9.21999L6.1134 11.3333L7.0534 10.3933L4.00006 7.33332L0.940063 10.3933Z"/>\n</svg>\n'})}function Ki({size:e,className:t}){return(0,zn.jsx)(Bi,{size:e,className:t,icon:'\n<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none">\n  <path fill="#EF3939" d="M8 3.874C6.84.929 1 1.366 1 5.82 1 8.039 2.785 10.99 8 14c5.215-3.009 7-5.961 7-8.18C15 1.392 9.167.91 8 3.874Z"/>\n</svg>\n'})}function zi({size:e,className:t}){const s=Ri(Kn._TQ,e);return(0,zn.jsx)(Bi,{icon:s,size:e,className:t})}function $i({size:e,className:t}){const s=Ri(Kn.fph,e);return(0,zn.jsx)(Bi,{icon:s,size:e,className:t})}function Yi({size:e,className:t}){const s=Ri(Kn.$II,e);return(0,zn.jsx)(Bi,{icon:s,size:e,className:t})}function Xi({size:e,className:t}){return(0,zn.jsx)(Bi,{size:e,className:t,icon:'\n<svg width="18" height="18" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg">\n  <rect x="1" y="1" width="7" height="7" rx="2"/>\n  <rect x="1" y="10" width="7" height="7" rx="2"/>\n  <rect x="10" y="10" width="7" height="7" rx="2"/>\n  <rect x="10" y="1" width="7" height="7" rx="2"/>\n</svg>\n'})}function Qi({size:e,className:t}){const s=Ri(Kn.YvR,e);return(0,zn.jsx)(Bi,{icon:s,size:e,className:t})}function qi({size:e,className:t}){return(0,zn.jsx)(Bi,{icon:Kn.AXs,size:e,className:t})}function Ji({size:e,className:t}){return(0,zn.jsx)(Bi,{icon:Kn.uw2,size:e,className:t})}function ea({size:e,className:t}){const s=Ri(Kn.bqs,e);return(0,zn.jsx)(Bi,{icon:s,size:e,className:t})}function ta({size:e,className:t}){return(0,zn.jsx)(Bi,{icon:Kn.kze,size:e,className:t})}function sa({size:e,className:t}){return(0,zn.jsx)(Bi,{icon:Kn.D7r.medium,size:e,className:t})}function na({size:e,className:t}){return(0,zn.jsx)(Bi,{icon:Kn.Tu3,size:e,className:t})}function ia({size:e,className:t}){return(0,zn.jsx)(Bi,{icon:Kn.GH$,size:e,className:t})}function aa({size:e,className:t,type:s}){switch(s){case"account":return(0,zn.jsx)(Fi,{className:t,size:e});case"trash":return(0,zn.jsx)(Wi,{className:t,size:e});case"bookmark":return(0,zn.jsx)(Ui,{className:t,size:e});case"caret":case"chevron":return(0,zn.jsx)(Vi,{className:t,size:e});case"time":return(0,zn.jsx)(Hi,{className:t,size:e});case"contract":return(0,zn.jsx)(Gi,{className:t,size:e});case"folder":return(0,zn.jsx)(zi,{className:t,size:e});case"folder-arrow":return(0,zn.jsx)($i,{className:t,size:e});case"heart":return(0,zn.jsx)(Ki,{className:t,size:e});case"speed-dial-folder":return(0,zn.jsx)(Yi,{className:t,size:e});case"speed-dial":return(0,zn.jsx)(Xi,{className:t,size:e});case"search":return(0,zn.jsx)(Qi,{className:t,size:e});case"download-speed":return(0,zn.jsx)(qi,{className:t,size:e});case"download-placeholder":return(0,zn.jsx)(Ji,{className:t,size:e});case"settings":return(0,zn.jsx)(ea,{className:t,size:e});case"close":return(0,zn.jsx)(ta,{className:t,size:e});case"checkmark":return(0,zn.jsx)(sa,{className:t,size:e});case"reorder":return(0,zn.jsx)(Bi,{size:e,className:"reorder",icon:'\n<svg width="12" height="4" viewBox="0 0 12 4" xmlns="http://www.w3.org/2000/svg">\n  <line x1="0" y1="0" x2="12" y2="0" stroke="currentColor" />\n  <line x1="0" y1="4" x2="12" y2="4" stroke="currentColor" />\n</svg>\n'});case"credit-card":return(0,zn.jsx)(Bi,{size:e,icon:Kn.rur,className:t});case"blocker-shield":return(0,zn.jsx)(na,{className:t,size:e});case"info":return(0,zn.jsx)(ia,{className:t,size:e})}}var oa=s(98102),ra=s(34155);function la(e){return e.reduce(((e,t)=>{if(t.speeddial)e.push(t);else if(t.children?.length){const s=la(t.children);(s?.length||t.speeddial)&&e.push({...t,children:s})}return e}),[])}var da=(0,zn.jsx)(aa,{type:"search",size:18,className:"BookmarkLocationSelector-SearchInput-Icon"});function ca({onValueChange:e,value:t,placeholder:s}){return(0,zn.jsxs)("div",{className:"BookmarkLocationSelector-SearchInput",children:[(0,zn.jsx)("input",{placeholder:s,className:"BookmarkLocationSelector-SearchInput-Input",type:"search",value:t,onChange:({currentTarget:t})=>e(t.value)}),da]})}const ha=Object.freeze({folders:!0,bookmarks:!1});class ua extends Un.PureComponent{refFolderList=Un.createRef();state={nodes:g.Z.getFilteredTree("",{...ha,root:"bookmarks"===this.props.mode}).nodes,filter:"",isEditing:!1};componentDidMount(){g.Z.addListener(this.handleBookmarkStoreChange)}componentWillUnmount(){g.Z.removeListener(this.handleBookmarkStoreChange)}handleBookmarkStoreChange=()=>{this.setState((e=>({nodes:[...g.Z.getFilteredTree(e.filter,{...ha,root:"bookmarks"===this.props.mode}).nodes]})))};handleNewFolderButtonClick=async()=>{this.setState({isEditing:!0});const e=this.state.filter||(0,W.Z)("command","New Folder"),t=this.state.filter?"1":this.props.parentId,s="speeddial"===this.props.mode&&t===g.Z.getRootId(),i=await n.Z.bookmarks.create({parentId:t,title:e,speeddial:s});this.refFolderList.current?.expand(t),await this.props.onParentIdChange(i.id),this.refFolderList.current?.startInlineEdit(i.id),this.setState({filter:""})};setParentOnSelect=async e=>{await this.props.onParentIdChange(e)};scrollToId=async e=>{await new Promise((e=>ra.nextTick(e))),this.refFolderList.current?.scrollToId(e),await new Promise((e=>ra.nextTick(e)))};toggleFolderChange=async()=>{const e="bookmarks"===this.props.mode?"speeddial":"bookmarks";await this.props.onModeChange(e),this.handleBookmarkStoreChange(),this.refFolderList.current?.focus()};handleFolderTitleChange=(e,t)=>{this.setState({isEditing:!1}),this.props.onFolderTitleChange(e,t)};handleFilterChange=e=>{const t=[...g.Z.getFilteredTree(e,{...ha,root:"bookmarks"===this.props.mode}).nodes];this.setState({filter:e,nodes:t},(()=>this.refFolderList.current?.expandAll()))};render(){const{className:e}=this.props,t="1"===this.props.parentId,s=this.state.nodes,n="speeddial"===this.props.mode?la(s):s;return(0,zn.jsxs)("div",{className:Gn()("BookmarkLocationSelector",e),children:[(0,zn.jsx)("p",{className:"BookmarkLocationSelector-Header",children:(0,W.Z)("bookmarkeditor","Location")}),(0,zn.jsx)("div",{className:"BookmarkLocationSelector-SpeedDialCheckbox",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:"speeddial"===this.props.mode,onChange:this.toggleFolderChange}),(0,zn.jsx)("span",{children:(0,W.Z)("Show only Speed Dial folders")})]})}),(0,zn.jsx)(ca,{value:this.state.filter,onValueChange:this.handleFilterChange,placeholder:"speeddial"===this.props.mode?(0,W.Z)("Find in Speed Dial Folders"):(0,W.Z)("Find in All Folders")}),(0,zn.jsx)(Li,{ref:this.refFolderList,folders:n,onSelect:this.setParentOnSelect,selectedId:this.props.parentId,isEditing:this.state.isEditing,expandAll:!t,onFolderTitleChange:this.handleFolderTitleChange,className:"BookmarkLocationSelector-FolderList",defaultEditFolderText:this.state.filter||(0,W.Z)("command","New Folder")}),(0,zn.jsx)(oa.ZP,{image:Kn.md4.small,title:"bookmarks"===this.props.mode?(0,W.Z)("Add a new folder in bookmarks","New Folder"):(0,W.Z)("New Speed Dial Group"),size:"medium",className:"BookmarkLocationSelector-AddFolderButton",onClick:this.handleNewFolderButtonClick})]})}}function pa(e){switch(e){case"error":case"warning":return"alert";default:return"status"}}function ga(e){switch(e){case"error":return Kn.viW;case"warning":return Kn.h6;case"success":return Kn.JLz;default:return Kn.GH$}}class ma extends Un.Component{_refFeedback=Un.createRef();componentDidMount(){this._refFeedback.current?.scrollIntoViewIfNeeded()}componentDidUpdate(){this._refFeedback.current?.scrollIntoViewIfNeeded()}render(){const{type:e="info",children:t}=this.props;return(0,zn.jsxs)("div",{ref:this._refFeedback,className:`FormFeedback FormFeedback--${e}`,role:pa(e),children:[(0,zn.jsx)("span",{className:"FormFeedback-Icon",dangerouslySetInnerHTML:{__html:ga(e)}}),t]})}}const fa=ma;function va({value:e,title:t,onChange:s,autoFocus:n}){return(0,zn.jsxs)("label",{className:"BookmarkInputField",children:[(0,zn.jsx)("span",{className:"BookmarkInputField-Title",id:"dialog-bookmark-title",children:t}),(0,zn.jsx)("input",{className:"BookmarkInputField-Input",type:"text",value:e,onChange:s,autoFocus:n})]})}class ba extends Un.PureComponent{refLocationSelector=Un.createRef();scrollToId=async e=>{await(this.refLocationSelector.current?.scrollToId(e))};render(){const{title:e,onTitleChange:t,autoFocus:s,url:n,onUrlChange:i,nickname:a,onNicknameChange:o,description:r,onDescriptionChange:l,onParentIdChange:d,parentId:c,onFolderTitleChange:h,locationSelectMode:u,onDeleteBookmarkClick:p,onClosePopupClick:m,onLocationSelectModeChange:f}=this.props,v=(b=c,g.Z.getItemById(b)?.title);var b;return(0,zn.jsxs)("form",{className:"BookmarkPopup",onSubmit:m,children:[(0,zn.jsxs)("header",{className:"dialog-header",children:[(0,zn.jsx)("h1",{className:"DialogHeader-HeaderText",children:(0,W.Z)("Added Bookmark")}),v&&(0,zn.jsx)("p",{children:(0,W.Z)("to $1",[v])})]}),(0,zn.jsxs)("div",{className:"dialog-content",children:[(0,zn.jsxs)("div",{className:"BookmarkPopup-TextInputWrapper",children:[(0,zn.jsx)(va,{title:(0,W.Z)("bookmarkeditor","Name"),value:e,onChange:({currentTarget:e})=>{t(e.value)},autoFocus:"title"===s}),(0,zn.jsx)(va,{title:(0,W.Z)("URL"),value:n,onChange:({currentTarget:e})=>i(e.value),autoFocus:"url"===s}),(0,zn.jsx)(va,{title:(0,W.Z)("Nickname"),value:a,onChange:({currentTarget:e})=>o(e.value),autoFocus:"nickname"===s}),this.props.nickError&&(0,zn.jsx)(fa,{type:"warning",children:(0,W.Z)("This nickname is already in use.")}),(0,zn.jsx)(va,{title:(0,W.Z)("Description"),value:r,onChange:({currentTarget:e})=>l(e.value),autoFocus:"description"===s})]}),(0,zn.jsx)(ua,{ref:this.refLocationSelector,className:"BookmarkPopup-LocationSelector",onParentIdChange:d,parentId:c,onFolderTitleChange:h,mode:u,onModeChange:f})]}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"submit",value:(0,W.Z)("bookmarkeditor","Done")}),(0,zn.jsx)("input",{type:"button",className:"danger",onClick:p,value:(0,W.Z)("bookmarkeditor","Remove")})]})]})}}var Ca=s(57904);const wa=new class{setBackgroundTasks(e){S.Z.dispatch({actionType:"BACKGROUND_TASKS_SET",tasks:e})}};const ya=function(e,t,s,n,i,a){this.id=e,this.title=s,this.description=i,this.menuItems=a,this.progress=0,this.text=t},xa="thumbnailCapture";const Ia=new class{pendingEntries=[];activeEntries=[];tasks=[];add=(e,t,s)=>{this.pendingEntries.push({id:e,url:t,callback:s})};run=()=>{for(;;){if(this.activeEntries.length>=1)return;if(0===this.pendingEntries.length)return void(0===this.activeEntries.length&&(this.removeFromArrayById(xa,this.tasks),wa.setBackgroundTasks(this.tasks)));const e=this.pendingEntries.shift();this.activeEntries.push(e);let t=this.getFromArrayById(xa,this.tasks);t||(t=new ya(xa,"","Thumbnail Capture","",[{name:(0,W.Z)("Cancel"),handler:()=>{this.pendingEntries=[]}}]),this.tasks.push(t)),t.title=(0,W.Z)("Updating thumbnail for $1",[e.url]),t.description=(0,W.Z)("$1 bookmark waiting for update.","$1 bookmarks waiting for update.",[this.pendingEntries.length]),t.text=this.pendingEntries.length+this.activeEntries.length,wa.setBackgroundTasks(this.tasks),e.callback.call(null,e.id,e.url)}};onLoaded=e=>{this.removeFromArrayById(e,this.activeEntries),this.run()};contains=e=>this.isInArrayById(e,this.pendingEntries)||this.isInArrayById(e,this.activeEntries);getFromArrayById=(e,t)=>t.find((t=>t.id===e));isInArrayById=(e,t)=>t.length>0&&void 0!==this.getFromArrayById(e,t);removeFromArrayById=(e,t)=>{const s=t.findIndex((t=>t.id===e));-1!==s&&t.splice(s,1)}};var Aa=s(30460);const Sa=440,Za=360;let Ta=0;const Ea=new Map,ka={getPageThumbnail(e,t,s){Ta>4||(Ta++,e.getThumbnail(Na(t),(e=>{Ta--,n.Z.runtime.lastError?s(void 0):s(e||void 0)})))},updateForBookmark(e,t){ka.updateForBookmarks([{id:e,url:t}])},updateForBookmarks(e){for(const t of e){const e=t.url;e&&e!==Aa.p&&!Ia.contains(t.id)&&(Ia.add(t.id,vs.jk.getUrl(e),_a),Pa(t.id))}Ia.run()},linkAndQueryUpdatingBookmark:(e,t)=>t?(Ea.set(e,t),Ia.contains(t)):(Ea.delete(e),!1),unlinkBookmarkComponent(e){Ea.delete(e)}},Na=e=>e.compact?{width:330,height:270}:{width:Sa,height:Za},_a=(e,t)=>{const s={bookmarkId:e,url:t};re.Z.thumbnails.captureBookmark(s).then((t=>{Ia.onLoaded(e),Pa(e)}))};function Pa(e){for(const[t,s]of Ea)s===e&&t.forceUpdate()}const Ma=ka;async function Da(e){try{const t=await(0,Gs.VN)(e,{type:"BOOKMARKS_FETCH_METADATA"});if("bookmarkData"===t.type){const{url:s,description:n,imageUrl:i}=t.data,a=Ze.ZP.getPageById(e)?.vivExtData.fixedTitle??t.data.title;let o;if(i)try{const e=s?new URL(i,s).toString():i;o=await async function(e,t,s){return new Promise(((n,i)=>{const a=new Image;a.crossOrigin="anonymous",a.onload=()=>{let e=a.naturalWidth,i=a.naturalHeight;s&&(e>Sa&&(i*=Sa/e,e=Sa),i>Za&&(e*=Za/i,i=Za));const o=document.createElement("canvas"),r=o.getContext("2d");o.width=e,o.height=i,r.drawImage(a,0,0,e,i),o.toBlob((e=>{o.remove(),n(e)}),t)},a.onerror=i,a.src=e}))}(e,"image/png",!0)}catch{}return{title:a,url:s,description:n,thumbnail_blob:o,thumbnail_content_type:"image/png"}}}catch(e){console.error(e)}}function Oa(e){return A.Z.get(Z.kBookmarksFetchPageMetadata)&&!(0,vs.cw)(e)}async function ja(e){return new Promise(((t,s)=>{const n={url:e?.url||"",title:e?(0,vs.d6)(e.url,e.title):"",description:"",thumbnail_blob:null,thumbnail_content_type:""};e?.vivExtData.thumbnail?fetch(e?.vivExtData.thumbnail).then((e=>e.blob())).then((e=>{n.thumbnail_blob=e,n.thumbnail_content_type=e.type})).catch((e=>{console.log(e)})).finally((()=>{t(n)})):t(n)}))}class La extends Un.PureComponent{static contextType=oi.Z;state={status:"standby",buttonTitleIsStatus:!1,isBookmarkPopupOpen:!1,nickError:!1,popupLocationSelectMode:"bookmarks",...this.#d()};componentDidMount(){g.Z.addListener(this.#c),Ca.Z.addListener(this.onWebpageviewStoreChanged)}componentWillUnmount(){g.Z.removeListener(this.#c),Ca.Z.removeListener(this.onWebpageviewStoreChanged)}#d(){const e=g.Z.findByUrl(this.props.url);return{id:e?.id||"",title:e?.title||"",url:e?.url||"",description:e?.description||"",thumbnail:e?.thumbnail||"",nickname:e?.nickname||"",parentId:e?.parentId||""}}#c=()=>{this.setState(this.#d())};onWebpageviewStoreChanged=async e=>{if(e.winId!==this.context.vivaldiWindowId||"WEBPAGEVIEW_ACTIONS"!==e.type||"addBookmark"!==e.action)return;const t=Ze.ZP.getPageInWindow(e.winId,e.pageId);if(!t)return;if(g.Z.findByUrl(t.url))return void this.setIsBookmarkPopupOpen(!0);const s=Oa(t.url)&&await Da(t.id)||await ja(t);await this.bookmarkPage(s),A.Z.get(Z.kBookmarksConfirmAdding)&&this.setIsBookmarkPopupOpen(!0)};componentDidUpdate(e,t){if(t.isBookmarkPopupOpen&&!this.state.isBookmarkPopupOpen&&this.state.id){const{title:e,url:s,description:n,nickname:i}=this.state;this.#h(this.state.id,{title:e,url:s,description:n,nickname:t.nickError?"":i})}else e.url&&!this.props.url&&this.setState({id:"",title:"",url:"",description:"",thumbnail:"",nickname:"",parentId:""}),!e.url&&this.props.url&&this.setState({...this.#d(),status:"bookmarked",buttonTitleIsStatus:!0}),"bookmarked"!==t.status&&"bookmarked"===this.state.status&&setTimeout((()=>{this.state.isBookmarkPopupOpen||this.setState({status:"standby",buttonTitleIsStatus:!1})}),4e3)}#h(e,t){return n.Z.bookmarks.update(e,t).catch((e=>h.Z.setStatus(this.context.vivaldiWindowId,`Error: ${e.message}`)))}setIsBookmarkPopupOpen(e){e?this.setState({isBookmarkPopupOpen:e}):this.setState((t=>({isBookmarkPopupOpen:e,status:"standby",nickname:t.nickError?"":t.nickname,nickError:!1}))),this.props.onBookmarkPopupVisibilityChange?.(e)}bookmarkPage=async e=>{let t=A.Z.get(Z.kBookmarksSaveFolder);const s=g.Z.getItemById(t);s&&!g.Z.isTrashed(s)||(t=g.Z.getRootId());const i={parentId:t,title:e.title,url:e.url,description:e.description,thumbnail:""};if(e.thumbnail_blob)try{i.thumbnail=await re.Z.utilities.storeImage({data:await e.thumbnail_blob.arrayBuffer(),mimeType:e.thumbnail_content_type})}catch(e){console.error(e)}try{const e=await function(e,t){return n.Z.bookmarks.create(t).then((s=>(ue.Z.showBookmarkAddedPopup(fe.ZP.getLastActiveBrowserWindowId(),{pageId:e,url:t.url??"",isActive:!0}),s)))}(this.props.pageId,i);e.parentId&&this.refBookmarkPopup.current?.scrollToId(e.parentId)}catch(e){console.error("Could not set as bookmarked.",e)}};onDeleteBookmarkClick=async()=>{this.setState({status:"standby"}),this.state.id&&(await ne.Z.remove([this.state.id]),this.setIsBookmarkPopupOpen(!1))};onBookmarkButtonClicked=async()=>{if(this.setState((e=>e.id||e.isBookmarkPopupOpen||A.Z.get(Z.kBookmarksConfirmAdding)?(this.props.onBookmarkPopupVisibilityChange&&this.props.onBookmarkPopupVisibilityChange(!e.isBookmarkPopupOpen),{isBookmarkPopupOpen:!e.isBookmarkPopupOpen}):e)),!this.state.id){const e=Ze.ZP.getPageById(this.props.pageId);if(!e)return;const t=Oa(e.url)&&await Da(this.props.pageId)||await ja(e);await this.bookmarkPage(t)}};handleParentIdChange=async e=>{const t=g.Z.getItemById(e);if(t&&!g.Z.isFolder(t)){console.info("handleParentIdChange: parentId is not a folder.");const t=g.Z.getRootId();if(void 0===t)return;e=t}this.state.id&&(await ne.Z.move([this.state.id],e),I.Z.set(Z.kBookmarksSaveFolder,e),this.setState({parentId:e}))};handleTitleChange=e=>{this.setState({title:e})};handleUrlChange=e=>{this.setState({url:e})};handleNicknameChange=e=>{this.setState({nickname:e,nickError:g.Z.hasNickname(e)})};handleDescriptionChange=e=>{this.setState({description:e})};handleFolderTitleChange=(e,t)=>{this.#h(e,{title:t})};hidePopup=()=>{this.setIsBookmarkPopupOpen(!1)};onLocationSelectModeChange=e=>{this.setState({popupLocationSelectMode:e})};refBookmarkPopup=Un.createRef();render(){const{title:e,url:t,nickname:s,nickError:n,description:i,thumbnail:a,parentId:o}=this.state,r="bookmarked"===this.state.status||this.state.isBookmarkPopupOpen,l="bookmarked"===this.state.status&&!this.state.isBookmarkPopupOpen||this.props.isBookmarkPopup?(0,W.Z)("Added bookmark"):"",d=A.Z.get(Z.kAddressBarVisible)&&!fe.ZP.isMinimalUI(this.context.vivaldiWindowId);return(0,zn.jsx)("div",{className:Gn()("BookmarkButton",{"BookmarkButton--Active":r}),children:(0,zn.jsx)(oa.ZP,{onClick:this.onBookmarkButtonClicked,tooltip:(0,W.Z)("tooltip","Bookmark Page"),image:Kn.oJy,hidePopup:this.hidePopup,popupPosition:d?this.props.popupPosition:"below",isPopupVisible:this.state.isBookmarkPopupOpen,popupWidth:356,className:"BookmarkButton-Button",isOn:Boolean(this.state.id),title:l,titleIsStatus:this.state.buttonTitleIsStatus,popupLabelledBy:"dialog-bookmark-title",commandId:"COMMAND_ADD_BOOKMARK",children:(0,zn.jsx)(ba,{ref:this.refBookmarkPopup,onDeleteBookmarkClick:this.onDeleteBookmarkClick,onClosePopupClick:this.hidePopup,onParentIdChange:this.handleParentIdChange,onTitleChange:this.handleTitleChange,onUrlChange:this.handleUrlChange,onNicknameChange:this.handleNicknameChange,onDescriptionChange:this.handleDescriptionChange,onFolderTitleChange:this.handleFolderTitleChange,title:e,url:t,nickname:s,nickError:n,description:i,image:a,parentId:o,autoFocus:"title",locationSelectMode:this.state.popupLocationSelectMode,onLocationSelectModeChange:this.onLocationSelectModeChange})})})}}class Ra extends Un.PureComponent{static contextType=oi.Z;#u;state={isBookmarkButtonOpen:!1};componentDidMount(){this.setExpireTimeout(5e3)}componentWillUnmount(){clearTimeout(this.#u)}setExpireTimeout(e){this.#u=setTimeout((()=>{this.props.onClose()}),e)}handleBookmarkButtonVisibility(e){this.setState({isBookmarkButtonOpen:e}),clearTimeout(this.#u),e||this.setExpireTimeout(500)}render(){const e="top"===A.Z.get(Z.kAddressBarPosition)?"below":"above";return(0,zn.jsx)(La,{pageId:this.props.options.pageId,url:this.props.options.url,popupPosition:e,isBookmarkPopup:!0,onBookmarkPopupVisibilityChange:e=>this.handleBookmarkButtonVisibility(e)})}}const Ba=Ra;var Fa=s(33349);function Wa(){return void 0!==g.Z.getRootId()?{nodes:g.Z.getFoldersWithin(g.Z.getTopNodes(),0),bookmarksBarFolderId:g.Z.getBookmarkBarFolderId()}:{nodes:void 0,bookmarksBarFolderId:void 0}}class Ua extends Un.Component{state=Wa();_onStoreChange=()=>{this.setState(Wa())};componentDidMount(){g.Z.addListener(this._onStoreChange)}componentWillUnmount(){g.Z.removeListener(this._onStoreChange)}getFolderId=e=>{if(this.props.selectedItemID){const t=e.find((e=>e.id===this.props.selectedItemID));if(t)return t.id;console.warn("Bookmark folder not found")}return this.state.bookmarksBarFolderId};render(){const{nodes:e}=this.state;if(!e)return null;const t=this.getFolderId(e),s=e.find((e=>e.id===t))?.title||g.E,n=e.map((e=>(0,zn.jsxs)("option",{value:e.id,children:[" ".repeat(3*e.level),e.title]},"dir_"+e.id)));return(0,zn.jsxs)("span",{className:"bookmark-folder-picker",children:[(0,zn.jsx)("input",{type:"text",value:s,tabIndex:"-1",readOnly:!0}),(0,zn.jsx)(Fa.Z,{className:"bookmark-folders",value:t,onChange:this.props.onChange,children:n})]})}}const Va=Ua;var Ha=s(64473);const Ga={title:"",url:"",description:"",nickname:"",thumbnail:"",isFolder:!1,parentId:"",nickError:!1};class Ka extends Un.PureComponent{static contextType=oi.Z;_parentId="";_index=0;state=Ga;constructor(e,t){super(e);const s=g.Z.getItemById(e.options.id);let n=Ga;switch(e.options.mode){case"edit":s&&(n={...n,title:s.title,url:s.url||"",thumbnail:s.thumbnail,description:s.description,nickname:s.nickname,isFolder:g.Z.isFolder(s),parentId:s.parentId||""});break;case"addbookmark":case"addfolder":if(s?g.Z.isFolder(s)?(this._parentId=s.id,this._index=0):(this._parentId=s.parentId??g.Z.getRootId()??"",this._index="number"==typeof s.index?s.index+1:0):(this._parentId=g.Z.getRootId()??"",this._index=0),n={...n,parentId:this._parentId,isFolder:"addfolder"===e.options.mode},!n.isFolder){const e=Ze.ZP.getActivePage(t.vivaldiWindowId);e&&(n={...n,title:e.title,url:e.url,thumbnail:e.vivExtData.thumbnail??""})}}this.state=n}onCancel=()=>{this.props.onClose()};onSave=()=>{switch(this.props.options.mode){case"edit":{const e=this.props.options.id,t=Jn.ZP.verifyForUpdate({title:this.state.title,url:this.state.url,thumbnail:this.state.thumbnail,nickname:this.state.nickError?"":this.state.nickname,description:this.state.description},this.state.isFolder),s=g.Z.getItemById(e);s&&s.parentId!==this.state.parentId?ne.Z.move([s.id],this.state.parentId,0).then((()=>{n.Z.bookmarks.update(e,t).then((()=>this.props.onClose()))})):n.Z.bookmarks.update(e,t).then((()=>this.props.onClose()));break}case"addbookmark":case"addfolder":{const e=Jn.ZP.verifyForCreate({parentId:this.state.parentId,index:this.state.parentId===this._parentId?this._index:0,title:this.state.title,url:this.state.url,nickname:this.state.nickError?"":this.state.nickname,description:this.state.description},this.state.isFolder);n.Z.bookmarks.create(e).then((()=>this.props.onClose()));break}default:this.props.onClose()}};changeValue=(e,t)=>{const s={},{value:n}=t.target;s[e]=n,this.setState(s),"nickname"===e&&(g.Z.hasNickname(n)?this.setState({nickError:!0}):this.setState({nickError:!1}))};render(){let e;switch(this.props.options.mode){case"edit":e=this.state.isFolder?(0,W.Z)("Edit Folder"):(0,W.Z)("Edit Bookmark");break;case"addbookmark":e=(0,W.Z)("New Bookmark");break;case"addfolder":e=(0,W.Z)("title","New Folder")}if(void 0===e)return null;const t=this.state.isFolder?(0,W.Z)("Folder Name"):(0,W.Z)("Bookmark Name");return(0,zn.jsx)(Ha.Z,{onRequestClose:this.onCancel,title:e,children:(0,zn.jsx)("div",{className:"edit-bookmark",children:(0,zn.jsxs)("form",{onSubmit:this.onSave,children:[false,(0,zn.jsxs)("div",{className:"dialog-content",children:[(0,zn.jsx)("input",{className:"title",type:"text",value:this.state.title,onChange:this.changeValue.bind(this,"title"),title:t,placeholder:t,autoFocus:!0}),!1===this.state.isFolder&&(0,zn.jsx)("input",{className:"address",type:"text",value:this.state.url,onChange:this.changeValue.bind(this,"url"),title:(0,W.Z)("Address"),placeholder:(0,W.Z)("Address")}),void 0!==this.state.parentId&&(0,zn.jsx)(Va,{selectedItemID:this.state.parentId,onChange:this.changeValue.bind(this,"parentId")}),!1===this.state.isFolder&&(0,zn.jsx)("input",{className:"nickname",type:"text",value:this.state.nickname,onChange:this.changeValue.bind(this,"nickname"),title:(0,W.Z)("Nickname"),placeholder:(0,W.Z)("Nickname")}),this.state.nickError&&(0,zn.jsx)(fa,{type:"warning",children:(0,W.Z)("This nickname is already in use.")}),!1===this.state.isFolder&&(0,zn.jsx)("textarea",{className:"description",type:"text",value:this.state.description,onChange:this.changeValue.bind(this,"description"),title:(0,W.Z)("Description"),placeholder:(0,W.Z)("Description")})]}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"submit",className:"primary",value:(0,W.Z)("Save")}),(0,zn.jsx)("input",{type:"button",onClick:this.onCancel,value:(0,W.Z)("Cancel")})]})]})})})}}const za=Ka;class $a extends Un.PureComponent{static contextType=oi.Z;refButton=Un.createRef();componentDidMount(){this._reportSize()}componentDidUpdate(){this._reportSize()}_reportSize=()=>{const{HTMLElement:e}=this.context,t=this.refButton.current;t instanceof e&&this.props.onRendered(t.offsetWidth,t.offsetHeight)};_handleKeyDown=e=>{switch(e.key){case"ArrowUp":case"ArrowDown":case"Enter":this.props.onItemActivated(this.props.id,"Enter"===e.key,!0);break;case"ArrowLeft":this.props.moveFocus(this.props.id,"left",!1);break;case"ArrowRight":this.props.moveFocus(this.props.id,"right",!1);break;case"Escape":if(this.props.menuOpen)return;this.props.onLeaveBar();break;default:return}e.preventDefault(),e.stopPropagation()};_handleMouseDown=e=>{e.preventDefault()};_handleItemMouseUp=e=>{e.button===ai.Z.kCenter&&e.preventDefault()};_handleClick=e=>{this.props.onItemActivated(this.props.id,!0,!0,e),e.preventDefault(),e.stopPropagation()};_handleBlur=()=>{this.props.onItemBlur(this.props.id)};_handleFocus=()=>{this.props.highlighted||this.props.onItemHighlightMissing(this.props.id)};_handleMouseEnter=e=>{this.props.onItemEnter(this.props.id)};_handleMouseLeave=e=>{this.props.onItemLeave(this.props.id)};render(){return(0,zn.jsx)("button",{ref:this.refButton,className:Gn()({bookmarkbarItem:!0,chevron:!0,highlighted:this.props.highlighted}),"data-id":this.props.id,"data-offset":this.props.offset,tabIndex:this.props.keyAccess,title:(0,W.Z)("More bookmarks"),dangerouslySetInnerHTML:{__html:Kn.zwh},onKeyDown:this._handleKeyDown,onClick:this._handleClick,onMouseDown:this._handleMouseDown,onMouseUp:this._handleItemMouseUp,onBlur:this._handleBlur,onFocus:this._handleFocus,onMouseEnter:this._handleMouseEnter,onMouseLeave:this._handleMouseLeave})}}const Ya=$a;var Xa=s(44147),Qa=s(62077),qa=s(72536),Ja=s(86635),eo=s(68551),to=s(13253),so=s(89661),no=s(34155);let io=!1;const ao={show:function(e,t,s,n,i,a,o){const r=e.vivaldiWindowId;let l=!0;const d=function(e,t){l=!1,Xa.Z.onOpen(e,t)},c=function(e){o(e,!1)},h=function(){no.nextTick((()=>{o("",l)}))};io||(io=!0,function(e,t){return new Promise((e=>{re.Z.zoom.getVivaldiUIZoom((s=>{t.forEach((e=>{e.rect.x=parseInt((e.rect.x+1)*s),e.rect.y=parseInt((e.rect.y+0)*s),e.rect.width=parseInt(e.rect.width*s),e.rect.height=parseInt(e.rect.height*s)})),e()}))}))}(0,s).then((()=>{re.Z.menubarMenu.onOpenBookmark.addListener(d),re.Z.menubarMenu.onBookmarkAction.addListener(Xa.Z.onAction),re.Z.menubarMenu.onHover.addListener(Xa.Z.onHover),re.Z.bookmarkContextMenu.onOpen.addListener(c),re.Z.bookmarkContextMenu.onClose.addListener(h),re.Z.bookmarkContextMenu.show({windowId:r,id:t,siblings:s,sortField:n,sortOrder:i,edge:Ye.Z.getBookmarkExtrasEdge(),icons:[nt.Z,Ja.Z,eo.Z,to.Z,so.Z,Qa.Z,qa.Z]},(()=>{Xa.Z.onHover(r,""),re.Z.menubarMenu.onOpenBookmark.removeListener(d),re.Z.menubarMenu.onBookmarkAction.removeListener(Xa.Z.onAction),re.Z.menubarMenu.onHover.removeListener(Xa.Z.onHover),re.Z.bookmarkContextMenu.onOpen.removeListener(c),re.Z.bookmarkContextMenu.onClose.removeListener(h),setTimeout((()=>{io=!1}),100)}))})))}},oo={getMenu:async(e,t,s)=>{const i=[];for(const[a,o]of fe.ZP.getState()){if(a===e||"normal"!==o.type)continue;const r=(await n.Z.windows.get(a,{populate:!0})).tabs||[],l=r.find((e=>e.active)),d=l&&l.url?vs.jk.getDisplayTitleByUrl(l.url,l.title||l.url):String(i.length+1),c=o.incognito?(0,W.Z)("Private Window with $1 Active Tab ($2)","Private Window with $1 Active Tabs ($2)",[r.length,d]):(0,W.Z)("Window with $1 Active Tab ($2)","Window with $1 Active Tabs ($2)",[r.length,d]);i.push({handler:()=>{const e={inCurrent:!1,inBackground:A.Z.get(Z.kTabsOpenNewInBackground),inNewWindow:!1,incognito:!1,transition:re.Z.historyPrivate.TransitionType.AUTO_TOPLEVEL};Jn.ZP.openUrls(a,s,e,t)},...st.Z.makeNumberMnemonic(c,i.length)})}return i}},ro=oo,lo=(e,t,s)=>(e.dataTransfer.setData("text/uri-list",t),e.dataTransfer.setData("text/plain",t),e.dataTransfer.SetURLAndTitle(t,s),e.dataTransfer.setData("vivaldi/x-title",s),e);var co=(0,zn.jsx)("span",{className:"separator"}),ho=(0,zn.jsx)(aa,{type:"chevron",size:10});class uo extends Un.Component{static contextType=oi.Z;refButton=Un.createRef();refTitleInput=Un.createRef();dropMode={support:!1,copy:!1};centerButtonPressed=!1;regularWidth=-1;canHandleClick=!0;constructor(e){super(e),this.state={dragging:!1,title:e.node.title}}componentDidUpdate(){const{HTMLElement:e}=this.context,t=this.refButton.current;t instanceof e&&(this.props.onRendered(this.props.node.id,t.offsetWidth),this.props.editTitle||(this.regularWidth=t.offsetWidth))}componentDidMount(){const{HTMLElement:e}=this.context,t=this.refButton.current;t instanceof e&&this.props.onRendered(this.props.node.id,t.offsetWidth)}_edit=()=>{ue.Z.showBookmarkDialog(this.context.vivaldiWindowId,{mode:"edit",id:this.props.node.id,index:-1})};_rename=()=>{this.setState({title:this.props.node.title}),this.props.onEditChanged(this.props.node.id)};_handleEditChange=e=>{this.setState({title:e.target.value})};_handleEditKeyDown=e=>{switch(e.key){case"Enter":this._saveTitle(e.currentTarget.value),this.refTitleInput.current?.blur();break;case"Escape":this._cancelEdit(),this.refTitleInput.current?.blur()}};_killEvent=e=>{e.preventDefault(),e.stopPropagation()};_cancelEdit=()=>{this.setState({title:this.props.node.title}),this.props.onEditChanged("")};_saveTitle=e=>{n.Z.bookmarks.update(this.props.node.id,{title:e})};_handleFocus=e=>{e.currentTarget.select()};_handleEditBlur=e=>{this.state.title||this._cancelEdit(),this.props.onEditChanged(""),this.props.onRendered(this.props.node.id,this.regularWidth)};_delete=()=>{ne.Z.remove([this.props.node.id])};_handleItemMouseDown=e=>{e.button!==ai.Z.kLeft&&(this.centerButtonPressed=e.button===ai.Z.kCenter,e.preventDefault()),this.canHandleClick=!this.props.menuOpen};_handleItemMouseUp=e=>{e.button===ai.Z.kCenter&&(e.preventDefault(),!0===this.centerButtonPressed&&0===e.buttons&&this.props.onItemActivated(this.props.node.id,!0,!1,e))};_handleClick=e=>{this.canHandleClick&&this.props.onItemActivated(this.props.node.id,!0,!0,e),e.preventDefault(),e.stopPropagation()};_handleKeyDown=e=>{switch("Enter"===e.key&&!0===e.repeat&&e.preventDefault(),e.key){case"ArrowUp":case"ArrowDown":case"Enter":this.props.onItemActivated(this.props.node.id,"Enter"===e.key,!0,e);break;case"ArrowLeft":this.props.moveFocus(this.props.node.id,"left",!1);break;case"ArrowRight":this.props.moveFocus(this.props.node.id,"right",!1);break;case"Escape":if(this.props.menuOpen)return;this.props.onLeaveBar();break;default:return}e.preventDefault(),e.stopPropagation()};_handleDrop=e=>{if(e.preventDefault(),e.stopPropagation(),this.dropMode.support&&""!==this.props.dragover.position){const t="on"===this.props.dragover.position?this.props.node.id:this.props.node.parentId,s="on"===this.props.dragover.position?0:this.props.dragover.index+("right"===this.props.dragover.position?1:0);t&&ne.Z.onDropEvent(e,t,s)}this.props.resetDragover()};_handleDragStart=e=>{this.props.onDragStart(this.props.node.id),this.setState({dragging:!0});const t=JSON.stringify([this.props.node.id.toString()]);e.dataTransfer.setData(Jn.yR,t);const s=vs.jk.getHoverUrl(g.Z.getUrlByNode(this.props.node));lo(e,s,this.props.node.title),e.dataTransfer.effectAllowed="all"};_handleDragEnd=e=>{this.setState({dragging:!1}),this.props.onDragEnd()};_handleDragLeave=e=>{};_handleDragEnter=e=>{this.dropMode=this.props.getDropModeForEvent(e)};_handleDragOver=e=>{e.preventDefault(),e.stopPropagation(),this.dropMode.support?(e.dataTransfer.dropEffect=this.dropMode.copy?"copy":"move",this.props.onDragOver(this.props.node,e)):e.dataTransfer.dropEffect="none"};_handleBlur=()=>{this.props.onItemBlur(this.props.node.id)};_handleMouseEnter=e=>{if(!this.props.statusOff){const e=g.Z.getUrlByNode(this.props.node);h.Z.setStatus(this.context.vivaldiWindowId,e||this.props.node.title)}this.props.onItemEnter(this.props.node.id)};_handleMouseLeave=e=>{this.props.statusOff||h.Z.clearStatus(this.context.vivaldiWindowId),this.centerButtonPressed=!1,this.props.onItemLeave(this.props.node.id)};_openInNewWindow=(e,t)=>{const s={inCurrent:!1,inBackground:!1,inNewWindow:!0,incognito:t,transition:re.Z.historyPrivate.TransitionType.AUTO_BOOKMARK};Jn.ZP.open(this.context.vivaldiWindowId,Jn.ZP.getBookmarksByNode(e),s,!0)};_openInNewTab=(e,t)=>{const s={inCurrent:!1,inBackground:t||A.Z.get(Z.kTabsOpenNewInBackground),inNewWindow:!1,incognito:!1,transition:re.Z.historyPrivate.TransitionType.AUTO_BOOKMARK};Jn.ZP.open(this.context.vivaldiWindowId,Jn.ZP.getBookmarksByNode(e),s,!0)};_open=e=>{const t={inCurrent:!0,inBackground:!1,inNewWindow:!1,incognito:!1,transition:re.Z.historyPrivate.TransitionType.AUTO_BOOKMARK};Jn.ZP.open(this.context.vivaldiWindowId,Jn.ZP.getBookmarksByNode(e),t,!0)};_getContextMenuItems=(e,t)=>{const s=this.context.vivaldiWindowId,n=ei.Z.getOptionFunction(e),i=g.Z.isSeparator(t);return ei.Z.getNamedMenu(s,e,(async e=>{switch(e.action){case"CONTEXT_OPEN_IN_NEW_TAB":return{handler:()=>this._openInNewTab(t,!1),isVisible:()=>!i,...n(s,e,{})};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{handler:()=>this._openInNewTab(t,!0),isVisible:()=>!i&&!A.Z.get(Z.kTabsOpenNewInBackground),...n(s,e,{})};case"CONTEXT_OPEN_IN_TAB":return{handler:()=>this._open(t),isVisible:()=>!i,...n(s,e,{})};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{handler:()=>this._openInNewWindow(t,!1),isVisible:()=>!i,...n(s,e,{})};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{handler:()=>this._openInNewWindow(t,!0),isVisible:()=>!i,...n(s,e,{})};case"CONTEXT_CONTAINER_OPEN_IN_WINDOW":{const a=await ro.getMenu(s,!0,Jn.ZP.getUrlsByNodes([t]));return{isVisible:()=>!i&&a.length>0,items:a,...n(s,e,{})}}case"CONTEXT_BOOKMARK":return{handler:this.props.addActiveTab,isVisible:()=>!i,...n(s,e,{})};case"CONTEXT_NEW_BOOKMARK":return{handler:this.props.createNewBookmark,...n(s,e,{})};case"CONTEXT_NEW_FOLDER":return{handler:this.props.createNewFolder,...n(s,e,{})};case"CONTEXT_NEW_SEPARATOR":return{handler:this.props.createNewSeparator,isVisible:()=>!this.props.isSorted,...n(s,e,{})};case"CONTEXT_EDIT":return{handler:this._edit,isVisible:()=>!i,...n(s,e,{})};case"CONTEXT_RENAME":return{handler:this._rename,isVisible:()=>!i,...n(s,e,{})};case"CONTEXT_CUT":return{handler:this.props.onCut,isVisible:()=>!i,...n(s,e,{})};case"CONTEXT_COPY":return{handler:this.props.onCopy,isVisible:()=>!i,...n(s,e,{})};case"CONTEXT_PASTE":return{handler:this.props.onPaste,isVisible:()=>!i,...n(s,e,{})};case"CONTEXT_DELETE":return{handler:this._delete,...n(s,e,{})};default:return{...n(s,e,{})}}}))};_onContextMenu=e=>{this.props.editTitle?e.stopPropagation():(e.persist(),e.preventDefault(),e.stopPropagation(),this._getContextMenuItems("bookmarkbaritem",this.props.node).then((t=>{(0,mi.Z)(this.context,t)(e)})))};_onFocus=()=>{this.props.highlighted||this.props.onItemHighlightMissing(this.props.node.id)};render(){const e=this.props.node,t=g.Z.getUrlByNode(e),s=g.Z.isSeparator(e),n=g.Z.isFolder(e);let i;n&&"icon"!==this.props.display?i=(0,W.Z)("Show folder contents"):(i=e.title,t&&(i=i+"\n"+t));let a=!1;"icon"!==this.props.display&&(a="iconexceptfolders"!==this.props.display||!t);const{favIconUrl:o,favIconLoadType:r}=vs.jk.getBookmarkFavicon(e.url,e.faviconUrl);return(0,zn.jsxs)("button",{ref:this.refButton,"data-id":e.id,"data-offset":0,title:i,tabIndex:this.props.keyAccess,className:Gn()({uifocusstop:this.props.uiFocus,bookmarkbarItem:!0,highlighted:this.props.highlighted||this.props.menuOpen,folder:!s&&!e.url,"data-cut":this.props.isCut,dragging:this.state.dragging,dragover:this.props.dragover.id===e.id&&"on"===this.props.dragover.position,dragoverLeft:this.props.dragover.id===e.id&&"left"===this.props.dragover.position,dragoverRight:this.props.dragover.id===e.id&&"right"===this.props.dragover.position}),draggable:!this.props.editTitle,onDragStart:this._handleDragStart,onDragEnd:this._handleDragEnd,onDragEnter:this._handleDragEnter,onDragOver:this._handleDragOver,onDrop:this._handleDrop,onBlur:this._handleBlur,onMouseEnter:this._handleMouseEnter,onMouseLeave:this._handleMouseLeave,onClick:this.props.editTitle?void 0:this._handleClick,onMouseDown:this.props.editTitle?void 0:this._handleItemMouseDown,onMouseUp:this.props.editTitle?void 0:this._handleItemMouseUp,onKeyDown:this.props.editTitle?void 0:this._handleKeyDown,onContextMenu:this._onContextMenu,onFocus:this._onFocus,onKeyUp:this._killEvent,children:[s&&co,!s&&o&&"text"!==this.props.display&&(0,zn.jsx)(Vn.ZP,{url:o,loadType:r}),!s&&!e.url&&"text"!==this.props.display&&(0,zn.jsx)(qn,{speeddial:e.speeddial}),!s&&!this.props.editTitle&&a&&e.title&&(0,zn.jsxs)(zn.Fragment,{children:["text"===this.props.display&&n&&ho,(0,zn.jsx)("span",{className:"title",children:e.title})]}),this.props.editTitle&&(0,zn.jsx)("input",{ref:this.refTitleInput,type:"text",value:this.state.title,onFocus:this._handleFocus,onBlur:this._handleEditBlur,onClick:this._killEvent,onKeyDown:this._handleEditKeyDown,onChange:this._handleEditChange,autoFocus:!0})]},e.id)}}const po=uo;var go=s(57082),mo=s(5298),fo=s(45454),vo=s(81814);function bo(e,t,s,n){const i=s.map((e=>e.getAttribute("data-id"))).filter(Boolean);if(i.length<=1)return!1;""===e&&(e=i[0]);let a=i.indexOf(e);if(-1===a)return!1;switch(t){case"current":break;case"right":a+=1;break;case"left":a-=1;break;case"down":a+=n;break;case"up":a-=n;break;default:return!1}if(a<0||a>=i.length)return!1;const o=s[a];return!!o&&(o.focus(),!0)}var Co=s(34155);class wo extends Un.PureComponent{static contextType=oi.Z;acceptEnterId="";draggedId="";dropMode={support:!1,copy:!1};clipboardId="";timer=null;nodeRef=Un.createRef();constructor(e,t){super(e);const{document:s}=t;this.state={nodes:g.Z.getBookmarksBarNodes(),map:new Map,dragover:{id:"",position:"",index:0},maxWidth:s.documentElement?s.documentElement.clientWidth:0,extenderWidth:0,sorting:{sortOrder:ui.Z.NO_SORTING,sortField:"manually"},cutIds:g.Z.getCutIds(),editId:"",newItemAdded:!1,renderedArray:[],openMenuId:"",highlightedId:""}}componentDidMount(){const e=A.Z.get(Z.kBookmarksBarSorting);this._onSortChange(e.sortOrder,e.sortField),g.Z.addListener(this._onStoreChange),go.Z.addListener("COMMAND_FOCUS_BOOKMARKBAR",this._onCommandSpy)}componentWillUnmount(){this.timer&&clearTimeout(this.timer),g.Z.removeListener(this._onStoreChange),go.Z.removeListener("COMMAND_FOCUS_BOOKMARKBAR",this._onCommandSpy)}_onStoreChange=()=>{const e=g.Z.getBookmarksBarNodes();this.setState((t=>{const s=this._getRenderedItems(e,t.sorting,!0===t.newItemAdded?t.editId:"");return{nodes:e,map:new Map,renderedArray:s,cutIds:g.Z.getCutIds()}}))};_hasFocus=()=>{const{document:e,HTMLElement:t}=this.context,s=this.nodeRef.current;return s instanceof t&&(0,vo.sT)(e,s)};_onCommandSpy=e=>{e===this.context.vivaldiWindowId&&(this._hasFocus()||this.state.renderedArray.length>0&&this._moveFocus(this.state.renderedArray[0].id,"current",!0))};_getRenderedItems=(e,t,s)=>{const n=structuredClone(e);if(n.length>0&&t&&t.sortOrder>=ui.Z.ASCENDING_SORT){const e=(e,s)=>g.Z.treeSortComparator(e,s,{sortOrder:t.sortOrder,sortField:t.sortField});if(ui.Z.treeSort(n,e),""!==s){const e=n.findIndex((e=>e.id===s));-1!==e&&n.splice(0,0,n.splice(e,1)[0])}}return n};_handleKeyDown=e=>{e.keyCode===mo.Z.KEY_ESCAPE&&this._resetDragover()};_onButtonRendered=(e,t)=>{this.state.map.get(e)!==t&&this.setState((s=>{const n=new Map(s.map);return n.set(e,t),{map:n}}))};_onExtenderRendered=(e,t)=>{this.setState({extenderWidth:e})};_onResize=e=>{const t=e[0].target;this.setState({maxWidth:Math.floor(t.clientWidth)})};_addActiveTab=()=>{const e=g.Z.getBookmarkBarFolderId();if(void 0!==e){const t=Ze.ZP.getActivePage(this.context.vivaldiWindowId);t&&ne.Z.bookmarkPageInFolder(t,e,0)}};_getItemInsertIndex=e=>{const t=this.state.renderedArray.length;return"number"!=typeof e||t<e?t:e};_createNewBookmark=()=>{const e=g.Z.getBookmarkBarFolderId();void 0!==e&&ue.Z.showBookmarkDialog(this.context.vivaldiWindowId,{mode:"addbookmark",id:e,index:0})};_createNewFolder=()=>{const e=g.Z.getBookmarkBarFolderId();void 0!==e&&ue.Z.showBookmarkDialog(this.context.vivaldiWindowId,{mode:"addfolder",id:e,index:0})};_createNewSeparator=e=>{const t=g.Z.getBookmarkBarFolderId();t&&ne.Z.createSeparator(t,this._getItemInsertIndex(e))};_resetDragover=()=>{this.setState({dragover:{id:"",position:"",index:0}})};_onEditChanged=e=>{""===e?this.setState((e=>({renderedArray:this._getRenderedItems(e.nodes,e.sorting,""),newItemAdded:!1,editId:""}))):this.setState({editId:e})};_onDragEndBookmark=()=>{this.draggedId="",this._resetDragover()};_onDropBar=e=>{if(e.preventDefault(),e.stopPropagation(),this.dropMode.support){const t=g.Z.getBookmarkBarFolderId();if(void 0!==t){const s=g.Z.getBookmarksBarNodes().length;ne.Z.onDropEvent(e,t,s)}}this._resetDragover()};_onDragEnter=e=>{this.dropMode=this._getDropModeForEvent(e)};_onDragOverBar=e=>{e.preventDefault(),e.stopPropagation(),this.dropMode.support?e.dataTransfer.dropEffect=this.dropMode.copy?"copy":"move":e.dataTransfer.dropEffect="none"};_onDragOver=(e,t)=>{const{id:s,index:n}=e;if(s!==this.draggedId&&void 0!==n){var i="";if(this.state.sorting.sortOrder===ui.Z.NO_SORTING){const s=t.currentTarget.getBoundingClientRect(),n=(t.clientX-s.left)/s.width;i=g.Z.isFolder(e)?n<=.33?"left":n>.66?"right":"on":n<=.5?"left":"right"}else g.Z.isFolder(e)&&(i="on");(this.state.dragover.id!==s||this.state.dragover.id===s&&this.state.dragover.position!==i)&&this.setState({dragover:{id:s,position:i,index:n}})}};_onDragStart=e=>{this.draggedId=e};_getDropModeForEvent=e=>{const t={support:!1,copy:!1};return t.support=e.dataTransfer.types.some((e=>Jn.ZP.isUriListType(e)||"text/plain"===e||e===Jn.yR)),t.support&&(e.dataTransfer.types.some((e=>e===u.Up))?t.copy=!1:t.copy=t.support&&(Jn.ZP.isCopyModifierPressed(e)||!e.dataTransfer.types.some((e=>e===Jn.yR)))),t};_onCut=e=>{ne.Z.cut(e,[this.clipboardId]),e.stopPropagation(),e.preventDefault()};_onCopy=e=>{ne.Z.copy(e,[this.clipboardId]),e.stopPropagation(),e.preventDefault()};_onPaste=e=>{const t=this.clipboardId===g.Z.getBookmarkBarFolderId();ne.Z.paste(e,this.clipboardId,t),e.preventDefault(),e.stopPropagation()};_onCutContextMenu=e=>{this.clipboardId=e;const{document:t}=this.context;t.addEventListener("cut",this._onCut),t.execCommand("cut"),t.removeEventListener("cut",this._onCut)};_onCopyContextMenu=e=>{this.clipboardId=e;const{document:t}=this.context;t.addEventListener("copy",this._onCopy),t.execCommand("copy"),t.removeEventListener("copy",this._onCopy)};_onPasteContextMenu=e=>{this.clipboardId=e;const{document:t}=this.context;t.addEventListener("paste",this._onPaste),t.execCommand("paste"),t.removeEventListener("paste",this._onPaste)};_onSortOrderChange=()=>{const e=this.state.sorting.sortOrder===ui.Z.DESCENDING_SORT?ui.Z.ASCENDING_SORT:ui.Z.DESCENDING_SORT;this._onSortChange(e,this.state.sorting.sortField)};_onTitleSortChange=e=>{let t=this.state.sorting.sortOrder;"manually"!==e&&t===ui.Z.NO_SORTING?t=ui.Z.ASCENDING_SORT:"manually"===e&&(t=ui.Z.NO_SORTING),this._onSortChange(t,e)};_onSortChange=(e,t)=>{this.setState({sorting:{sortOrder:e,sortField:t}});const s={sortOrder:e,sortField:t};I.Z.set(Z.kBookmarksBarSorting,s),this.setState((e=>({renderedArray:this._getRenderedItems(e.nodes,s,!0===e.newItemAdded?e.editId:"")})))};_getContextMenuItems=e=>{const t=this.context.vivaldiWindowId,s=this.state.sorting.sortOrder!==ui.Z.NO_SORTING,n=ei.Z.getOptionFunction(e),i=()=>[{handler:this._onTitleSortChange.bind(this,"manually"),type:"checkbox",checked:"manually"===this.state.sorting.sortField,...(0,fi.Z)("radio","Manually")},{handler:this._onTitleSortChange.bind(this,"title"),type:"checkbox",checked:"title"===this.state.sorting.sortField,...(0,fi.Z)("by Title")},{handler:this._onTitleSortChange.bind(this,"url"),type:"checkbox",checked:"url"===this.state.sorting.sortField,...(0,fi.Z)("by Address")},{handler:this._onTitleSortChange.bind(this,"nickname"),type:"checkbox",checked:"nickname"===this.state.sorting.sortField,...(0,fi.Z)("by Nickname")},{handler:this._onTitleSortChange.bind(this,"description"),type:"checkbox",checked:"description"===this.state.sorting.sortField,...(0,fi.Z)("by Description")},{handler:this._onTitleSortChange.bind(this,"dateAdded"),type:"checkbox",checked:"dateAdded"===this.state.sorting.sortField,...(0,fi.Z)("by Date Created")},st.Z.separatorItem,{handler:this._onSortOrderChange,isVisible:()=>this.state.sorting.sortOrder!==ui.Z.NO_SORTING&&this.state.sorting.sortOrder===ui.Z.ASCENDING_SORT,...(0,fi.Z)("Descending")},{handler:this._onSortOrderChange,isVisible:()=>this.state.sorting.sortOrder!==ui.Z.NO_SORTING&&this.state.sorting.sortOrder!==ui.Z.ASCENDING_SORT,...(0,fi.Z)("Ascending")}];return ei.Z.getNamedMenu(t,e,(async e=>{switch(e.action){case"CONTEXT_BOOKMARK":return{handler:this._addActiveTab,...n(t,e,{})};case"CONTEXT_NEW_BOOKMARK":return{handler:this._createNewBookmark,...n(t,e,{})};case"CONTEXT_NEW_FOLDER":return{handler:this._createNewFolder,...n(t,e,{})};case"CONTEXT_NEW_SEPARATOR":return{handler:()=>{this._createNewSeparator(void 0)},isVisible:()=>!s,...n(t,e,{})};case"CONTEXT_PASTE":return{handler:()=>{const e=g.Z.getBookmarkBarFolderId();void 0!==e&&this._onPasteContextMenu(e)},...n(t,e,{})};case"CONTEXT_CONTAINER_SORT":return{items:i(),...n(t,e,{})};default:return{...n(t,e,{})}}}))};_moveFocus=(e,t,s)=>{if(!0===s||this._hasFocus()){bo(e,t,Array.from(this.nodeRef.current?.querySelectorAll(".bookmarkbarItem")||[]),this.state.renderedArray.length),this.setState({highlightedId:e})}};_handleItemActivated=(e,t,s,n)=>{const i=g.Z.getItemById(e);if(i)if(g.Z.isFolder(i)&&s){const e=this._getMenuSorting(),t="top"===A.Z.get(Z.kBookmarksBarPosition)?"bottom":"top";ao.show(this.context,i.id,this._getFolderSiblings(),e.field,e.order,t,this._onMenuVisibilityChanged)}else if(t&&n){const e=this.context.vivaldiWindowId,t=(0,fo.ZP)(e,{ctrlKey:n.ctrlKey,altKey:n.altKey,shiftKey:n.shiftKey,metaKey:n.metaKey,button:"number"==typeof n.button?n.button:-1},re.Z.historyPrivate.TransitionType.AUTO_BOOKMARK);Jn.ZP.open(e,Jn.ZP.getBookmarksByNode(i),t,!0),this._handleLeaveBar()}};_handleItemEnter=e=>{""!==this.acceptEnterId&&this.acceptEnterId!==e||this.state.editId||(this._hasFocus()&&this._moveFocus(e,"current",!0),this.setState({highlightedId:e}))};_handleItemLeave=e=>{""===this.state.openMenuId&&this.setState({highlightedId:""})};_handleItemBlur=e=>{Co.nextTick((()=>{this._hasFocus()||this.setState({highlightedId:""})}))};_handleItemHighlightMissing=e=>{this.setState({highlightedId:e})};_handleLeaveBar=()=>{ue.Z.setPaneFocus(this.context.vivaldiWindowId,!1),ae.Z.executeActions("event",this.context,"COMMAND_FOCUS_WEBVIEW")};_getMenuSorting=()=>ui.Z.toMenuSorting(this.state.sorting.sortOrder,this.state.sorting.sortField);_getFolderSiblings=()=>{const{document:e}=this.context;return Array.from(e.querySelectorAll("button.bookmarkbarItem")).filter((e=>e.classList.contains("folder")||e.classList.contains("chevron"))).map((e=>{const t=e.getBoundingClientRect();return{id:e.dataset.id,offset:Number(e.dataset.offset),folderGroup:Boolean(e.classList.contains("folder")||e.classList.contains("chevron")),rect:{x:parseInt(t.left),y:parseInt(t.top),width:parseInt(t.width),height:parseInt(t.height)}}}))};_onMenuVisibilityChanged=(e,t)=>{""===e?(this.acceptEnterId=this.state.openMenuId,this.timer=setTimeout((()=>{this.acceptEnterId="",this.timer=null}),100),this._hasFocus()&&t?this._moveFocus(this.state.openMenuId,"current",!0):this.setState({highlightedId:""})):(this.setState({highlightedId:e}),this._moveFocus(e,"current",!1)),this.setState({openMenuId:e})};_isSorted=()=>"manually"!==this.state.sorting.sortField;_onContextMenu=e=>{e.persist(),e.preventDefault(),e.stopPropagation(),this._getContextMenuItems("bookmarkbar").then((t=>{(0,mi.Z)(this.context,t)(e)}))};_renderBookmarkBarButton=(e,t)=>(0,zn.jsx)(po,{node:e,editTitle:this.state.editId===e.id,isCut:-1!==this.state.cutIds.indexOf(e.id),menuOpen:this.state.openMenuId===e.id,display:this.props.display,statusOff:this.props.statusOff,dragover:this.state.dragover,highlighted:this.state.highlightedId===e.id,keyAccess:0===t?this.props.keyAccess:-1,uiFocus:0===t,moveFocus:this._moveFocus,onItemActivated:this._handleItemActivated,onItemEnter:this._handleItemEnter,onItemLeave:this._handleItemLeave,onItemBlur:this._handleItemBlur,onItemHighlightMissing:this._handleItemHighlightMissing,onLeaveBar:this._handleLeaveBar,onEditChanged:this._onEditChanged,onDragStart:this._onDragStart,onDragEnd:this._onDragEndBookmark,onDragOver:this._onDragOver,getDropModeForEvent:this._getDropModeForEvent,addActiveTab:this._addActiveTab,createNewBookmark:this._createNewBookmark,createNewFolder:this._createNewFolder,createNewSeparator:()=>this._createNewSeparator(t),isSorted:this._isSorted(),resetDragover:this._resetDragover,onRendered:this._onButtonRendered,onCut:this._onCutContextMenu.bind(this,e.id),onCopy:this._onCopyContextMenu.bind(this,e.id),onPaste:this._onPasteContextMenu.bind(this,e.id)},e.id);render(){let e=0;const t=[];let s=0,n="",i=0;for(let a=0;a<this.state.renderedArray.length;a++){const o=this.state.renderedArray[a];if(!this._isSorted()||!g.Z.isSeparator(o)){const r=this.state.map.get(o.id),l=e+("number"==typeof r?r:28);if(l>this.state.maxWidth||l+this.state.extenderWidth>this.state.maxWidth&&a+1<this.state.renderedArray.length){s=a,""===this.state.editId&&this.state.renderedArray[0].parentId&&(n=this.state.renderedArray[0].parentId);break}t.push(this._renderBookmarkBarButton(o,i)),i++,e=l}}const a=""!==n?(0,zn.jsx)(Ya,{id:n,offset:s,keyAccess:-1,menuOpen:this.state.openMenuId===n,highlighted:this.state.highlightedId===n,moveFocus:this._moveFocus,onRendered:this._onExtenderRendered,onItemActivated:this._handleItemActivated,onItemEnter:this._handleItemEnter,onItemLeave:this._handleItemLeave,onItemBlur:this._handleItemBlur,onItemHighlightMissing:this._handleItemHighlightMissing,onLeaveBar:this._handleLeaveBar}):null;return(0,zn.jsx)("div",{ref:this.nodeRef,role:"toolbar","aria-label":(0,W.Z)("toolbar label","Bookmarks"),inert:this.props.inert?"inert":null,className:`bookmark-bar ${this.props.display}`,onDragEnter:this._onDragEnter,onDragOver:this._onDragOverBar,onDragLeave:this._resetDragover,onDrop:this._onDropBar,onContextMenu:this._onContextMenu,children:(0,zn.jsxs)(ti.Z,{className:"observer",onKeyDown:this._handleKeyDown,onResize:this._onResize,children:[t,a]})})}}const yo=wo;var xo=s(15590),Io=s(27508),Ao=s(84675),So=s(29717),Zo=s(63377),To=s(4949),Eo=s(14507);const ko=[{icon:Kn.oa7,mode:"area",label:(0,W.Z)("capture","Selection")},{icon:Kn.$O3,mode:"fullpage",label:(0,W.Z)("Full Page")}],No=[{value:"png",label:(0,W.Z)("Save as PNG")},{value:"jpg",label:(0,W.Z)("Save as JPEG")},{value:"clipboard",label:(0,W.Z)("panel","Copy to Clipboard")},{value:"note",label:(0,W.Z)("Create Note with...")}],_o=12;const Po=e=>{const t=Un.useContext(oi.Z),{innerWidth:s}=t,{isOffScreenBelow:n,isOffScreenLeft:i,isOffScreenTopAndBottom:a}=function(e){const t=Un.useContext(oi.Z);let s=!1,n=!1,i=!1,a=!1;if(!e)return{isOffScreenTopAndBottom:i,isOffScreenBelow:s,isOffScreenLeft:a};const{top:o,height:r,left:l,width:d}=e,{innerHeight:c}=t;return n=o<46,a=l+d<300,s=c>o+r+34+17,i=!s&&n,{isOffScreenBelow:s,isOffScreenLeft:a,isOffScreenTopAndBottom:i}}(e);if(!e)return null;const{top:o,height:r,left:l}=e;return a?{left:l+_o,top:o+r-34-_o}:e?{top:n?e.top+e.height+_o:e.top-34-_o,...i?{left:e.left}:{right:s-(e.left+e.width)}}:null},Mo=[Z.kWebpagesCaptureSaveLocation,Z.kWebpagesCaptureCompressionFormat,Z.kKeyboardTabToAll];function Do({winId:e,captureSquare:t,mode:s,setMode:n,inProgress:i,isInternalUrl:a,setFormat:o,doScreenshot:r}){const l=(0,Eo.Z)(Mo),d=Po(t),c=l[Z.kWebpagesCaptureSaveLocation],h="clipboard"===c||"note"===c?c:l[Z.kWebpagesCaptureCompressionFormat],u=Gn()("ControlPanel",{Default:!d,InProgress:i});return(0,zn.jsxs)("form",{className:u,style:d,onKeyDown:t=>function(e,t){e.keyCode===mo.Z.KEY_ESCAPE&&Ao.Z.cancelCallback(t)}(t,e),onSubmit:r,role:"dialog","aria-modal":"true","aria-label":(0,W.Z)("Capture Page Screenshot"),children:[" ",i?(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.GO5.medium}}),(0,zn.jsx)("span",{role:"status",children:(0,W.Z)("Capturing Screenshot…")})]}):(0,zn.jsxs)(Zo.Z,{focusName:"focus-capture-dialog",forceTrap:!0,children:[!t&&(0,zn.jsx)(To.Z,{name:"modePicker",className:"ControlPanel-ModeSelector",onChange:n,disabled:a,value:s,children:ko.map((e=>{if(e.mode.includes("fullpage")&&a)return null;const t=Gn()("ControlPanel-ModeSelector--Option",{Active:e.mode.includes(s)});return(0,zn.jsxs)("label",{className:t,children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:e.icon}}),(0,zn.jsx)("input",{type:"radio",value:e.mode,tabIndex:a?-1:l[Z.kKeyboardTabToAll]}),(0,zn.jsx)("span",{children:e.label})]},e.mode)}))}),(0,zn.jsxs)("div",{className:"ControlPanel-Output",children:[(0,zn.jsx)("label",{className:"ControlPanel-Output--Description",htmlFor:"capture:format",children:(0,W.Z)("format","Output")}),(0,zn.jsx)(Fa.Z,{id:"capture:format",className:"ControlPanel-Output--Select",onChange:o,value:h,children:No.map((e=>(0,zn.jsx)("option",{value:e.value,children:e.label},e.value)))}),(0,zn.jsx)("input",{className:"ControlPanel-Output--CaptureButton primary",type:"submit",onMouseDown:wi.ZP,onTouchStart:wi.ZP,disabled:"fullpage"!==s&&!("area"===s&&void 0!==t),value:(0,W.Z)("image","Capture")})]})]})]})}const Oo=10,jo=[Z.kWebpagesCaptureCaptureMode,Z.kWebpagesCaptureCompressionFormat,Z.kWebpagesCaptureSaveLocation],Lo=["TopLeft","TopMid","TopRight","BottomLeft","BottomMid","BottomRight","MidLeft","MidRight"],Ro=e=>{const t=Ze.ZP.getActivePage(e);return!(!t?.id||!t?.url)&&vs.jk.isInternalUrl(t?.url)};function Bo(e){const t=(0,Eo.Z)(jo),s=(0,Un.useRef)(null),n=(0,Un.useRef)(null),i=(0,Un.useRef)(0),a=(0,Un.useRef)(0),o=(0,Un.useRef)(0),r=(0,Un.useRef)(0),l=(0,Un.useRef)({}),[d,c]=(0,Un.useState)(Ro(e.winId)),h=d?"area":t[Z.kWebpagesCaptureCaptureMode],u=(0,Un.useContext)(oi.Z),[p,g]=(0,Un.useState)(null),[m,f]=(0,Un.useState)(!1),[v,b]=(0,Un.useState)(!1);(0,Un.useEffect)((()=>{s.current?.focus()}),[]);const{winId:C}=e;(0,Un.useEffect)((()=>{const e=()=>{c(Ro(C))};return Ze.ZP.addListener(e,u.selectWindow),()=>{Ze.ZP.removeListener(e)}}),[u.selectWindow,C]);const w=()=>{const{x3:e,x4:t,y3:s,y4:n}={x3:Math.round(Math.min(i.current,a.current)),x4:Math.round(Math.max(i.current,a.current)),y3:Math.round(Math.min(o.current,r.current)),y4:Math.round(Math.max(o.current,r.current))},l=u.innerWidth,d=u.innerHeight;g({rectStyle:{left:e,top:s,width:t-e,height:n-s},areaStyle:{background:"transparent",borderWidth:`${s}px ${l-t}px ${d-n}px ${e}px`}})},y=e=>{f(!0),w();const t=Math.round(e.clientX),s=Math.round(e.clientY),n=Math.abs(t-i.current)<=8,d=Math.abs(t-a.current)<=8,c=Math.abs(s-o.current)<=8,h=Math.abs(s-r.current)<=8;l.current={x1:n,x2:d,y1:c,y2:h};const{HTMLElement:p}=u;e.target instanceof p&&e.target.setPointerCapture(e.pointerId)},x=e=>{m&&(l.current.x1&&(i.current=e.clientX),l.current.x2&&(a.current=e.clientX),l.current.y1&&(o.current=e.clientY),l.current.y2&&(r.current=e.clientY),A(),w())},A=()=>{const e=i.current,t=a.current,s=o.current,n=r.current,{innerWidth:l,innerHeight:d}=u;e>l?i.current=l:t>e?(l-t<Oo&&(a.current=l),e<Oo&&(i.current=0)):t<Oo&&(a.current=0),s>d?o.current=d:n>s?(d-n<Oo&&(r.current=d),s<Oo&&(o.current=0)):n<Oo&&(r.current=0)},S=t=>{if(m){const{HTMLElement:s}=u;t.target instanceof s&&t.target.releasePointerCapture(t.pointerId),f(!1);const{current:i}=n;if(!i)return;const{width:a,height:o}=i.getBoundingClientRect();(a<=3||o<=3)&&Ao.Z.cancelCallback(e.winId)}},T=()=>{const{current:e}=n,{current:t}=s;if(e&&t)if("area"===h){g({areaStyle:{borderColor:"rgba(0,0,0,0)",visibility:"hidden"},rectStyle:void 0}),f(!0),t.addEventListener("transitionend",E,!0)}else b(!0),k()},E=()=>{s.current?.removeEventListener("transitionend",E);const t={x:Math.min(i.current,a.current),y:Math.min(o.current,r.current),width:Math.max(a.current,i.current)-Math.min(i.current,a.current),height:Math.max(r.current,o.current)-Math.min(r.current,o.current)};Ao.Z.performCapture({windowId:u.vivaldiWindowId,mode:h,opts:t,noteId:e.capturing.noteId})},k=async()=>{const s=t[Z.kWebpagesCaptureSaveLocation],n=t[Z.kWebpagesCaptureCompressionFormat],i=Ze.ZP.getActivePage(e.winId)?.id;if(!i)return;const{image:a}=await Ao.Z.captureFullpage(i,n,s);b(!1),So.Z.disableCapture(e.winId),Ao.Z.handleCaptureLocation({windowId:e.winId,mode:h,base64:a,noteId:e.capturing.noteId})},N=Gn()("CaptureArea","PreserveTransitions",{Area:"area"===h,FullPage:"area"!==h}),_=Gn()("CaptureRect",{Hidden:!p?.rectStyle});return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("div",{ref:s,style:p?.areaStyle,id:"capture-area",className:N,tabIndex:0,onKeyDown:t=>{const{keyCode:s}=t;s===mo.Z.KEY_ESCAPE?(Ao.Z.cancelCallback(e.winId),m&&f(!1)):s!==mo.Z.KEY_ENTER&&s!==mo.Z.KEY_RETURN||T()},onPointerDown:e=>{if(!h.includes("area"))return;f(!0),i.current=a.current=e.clientX,o.current=r.current=e.clientY,w();const{HTMLElement:t}=u;e.target instanceof t&&e.target.setPointerCapture(e.pointerId),(0,wi.ZP)(e)},onPointerMove:e=>{m&&(a.current=e.clientX,r.current=e.clientY,A(),w())},onPointerUp:S}),!m&&(0,zn.jsx)(Do,{winId:e.winId,captureSquare:p?.rectStyle,isInternalUrl:d,inProgress:v,mode:h,setMode:e=>{const{value:t}=e.target;"area"!==t&&"fullpage"!==t||I.Z.set(Z.kWebpagesCaptureCaptureMode,t)},setFormat:e=>{const{value:t}=e.target;"png"===t||"jpg"===t?(I.Z.set(Z.kWebpagesCaptureSaveLocation,"file"),I.Z.set(Z.kWebpagesCaptureCompressionFormat,t)):I.Z.set(Z.kWebpagesCaptureSaveLocation,t)},doScreenshot:T}),(0,zn.jsx)("div",{ref:n,style:p?.rectStyle,className:_,children:Lo.map((e=>(0,zn.jsx)("div",{className:`CaptureRect-Corner ${e}`,onPointerDown:y,onPointerMove:x,onPointerUp:S},e)))})]})}var Fo=s(48588);class Wo extends m.Z{getInitialState(){return new Map}reduce(e,t){switch(t.actionType){case"CAPTURE_ENABLE":const{noteId:s}=t;return new Map(e).set(t.winId,{capturing:!0,noteId:s});case"CAPTURE_DISABLE":return(0,Fo.u4)(e,t.winId)}return e}getCapturingState(e){return this.getState().get(e)}}const Uo=new Wo;var Vo=s(65398);class Ho extends Vo.Z{_storeState=new Map;getUtilityWebView(e){return this._storeState.get(e)}dispatchAction(e){if("UTILITY_WEBVIEW_SET_VIEW"===e.actionType)this._storeState.set(e.windowId,e.webview),this.emitChange()}}const Go=new Ho(S.Z);var Ko=s(70864),zo=s(67074);const $o=1e6,Yo=[{text:(0,W.Z)("Past Hour"),value:"past_hour",format:"h",difference:-1},{text:(0,W.Z)("Past Day"),value:"past_day",format:"d",difference:-1},{text:(0,W.Z)("Past Week"),value:"past_week",format:"d",difference:-7},{text:(0,W.Z)("Past 4 Weeks"),value:"past_4_weeks",format:"d",difference:-28},{text:(0,W.Z)("All Time"),value:"everything",format:"",difference:0}],Xo=[{value:"history",category:"history",text:(0,W.Z)("Browsing History")},{value:"typedHistory",category:"history",text:(0,W.Z)("Typed History")},{value:"siteUsageData",category:"history",text:(0,W.Z)("Site Usage Data")},{value:"translateHistory",category:"history",text:(0,W.Z)("Translation History")},{value:"downloads",category:"downloads",text:(0,W.Z)("Downloads")},{value:"cookies",category:"sitedata",text:(0,W.Z)("Cookies")},{value:"sessionCookies",category:"sitedata",text:(0,W.Z)("Cookies")},{value:"persistentCookies",category:"sitedata",text:(0,W.Z)("Cookies")},{value:"pluginData",category:"sitedata",text:(0,W.Z)("Plugin Data")},{value:"localStorage",category:"storage",text:(0,W.Z)("Storage (including Extension Storage)")},{value:"fileSystems",category:"storage",text:(0,W.Z)("File Systems")},{value:"webSQL",category:"storage",text:(0,W.Z)("Web SQL")},{value:"serverBoundCertificates",category:"storage",text:(0,W.Z)("Server Bound Certificates")},{value:"indexedDB",category:"storage",text:(0,W.Z)("Indexed DB")},{value:"serviceWorkers",category:"storage",text:(0,W.Z)("Service Workers")},{value:"cache",category:"caches",text:(0,W.Z)("Cache")},{value:"cacheStorage",category:"caches",text:(0,W.Z)("Cache Storage")},{value:"discardUserData",category:"caches",text:(0,W.Z)("Discard User Data")},{value:"passwords",category:"passwords",text:(0,W.Z)("Passwords (including your Sync login password)")},{value:"formData",category:"forms",text:(0,W.Z)("Form Autofill Data")},{value:"appcache",category:"appcache",text:(0,W.Z)("Applications Cache")},{value:"siteSettings",category:"sitesettings",text:(0,W.Z)("Site Settings")}];var Qo=(0,zn.jsx)("p",{className:"in-progress"});class qo extends Un.PureComponent{static contextType=oi.Z;constructor(e){super(e);const t=Xo.reduce(((e,t)=>(e[t.value]=!1,e)),{}),s=A.Z.get(Z.kClearPrivateDataEntries);s&&Object.entries(s).forEach((([e,n])=>{void 0===t[e]&&delete s[e]})),Object.assign(t,s);const n=new Map;Xo.forEach((e=>{const t=n.get(e.category);t?t.push(e):n.set(e.category,[e])})),n.forEach((e=>{if(e.length>1){let s=0;e.forEach((e=>{t[e.value]&&s++})),0!==s&&s!==e.length&&e.forEach((e=>{t[e.value]=!0}))}}));const i={};let a=!0;Object.keys(t).forEach((e=>{i[e]=0,t[e]||(a=!1)})),this.state={all:a,inProgress:!1,deleteHistoryFrom:A.Z.get(Z.kClearPrivateDataRange),dataToRemove:t,dataToRemoveCounters:i}}componentDidMount(){this.updateClearDownloadsCounters(),this.updateClearBrowsingHistoryCounters()}selectChanged=e=>{this.updateClearDownloadsCounters({deleteHistoryFrom:e.target.value}),this.updateClearBrowsingHistoryCounters({deleteHistoryFrom:e.target.value}),this.setState({deleteHistoryFrom:e.target.value})};_onYes=e=>{const{dataToRemove:t,deleteHistoryFrom:s}=this.state;I.Z.set(Z.kClearPrivateDataEntries,t),I.Z.set(Z.kClearPrivateDataRange,s),this.setState({inProgress:!0}),e={deleteHistoryFrom:s,...e};const i=Yo.find((e=>s===e.value)),a=i&&"everything"!==s?V()().add(i.difference,i.format).startOf(i.format).valueOf():0,o=Go.getUtilityWebView(this.context.vivaldiWindowId);if(!o)return;const{downloads:r,formData:l,history:d,serverBoundCertificates:c,serviceWorkers:h,siteUsageData:u,pluginData:p,passwords:g,typedHistory:m,translateHistory:f,siteSettings:v,discardUserData:b,...C}=t;o.clearData({since:a},C,(()=>{n.Z.runtime.lastError&&console.warn("Error clearing data: ",n.Z.runtime.lastError.message);const{typedHistory:e,translateHistory:s,sessionCookies:i,persistentCookies:o,discardUserData:r,...l}=t;n.Z.browsingData.remove({since:a},l).catch((e=>{console.warn("Error clearing data: ",e.message)})),t.history&&(Le.removeLocalHistory(a),re.Z.contentBlocking.clearAdBlockingStats()),t.translateHistory&&re.Z.translateHistory.reset(a),t.discardUserData&&(ne.Z.emptyTrash(),Js.Z.emptyTrash(),Ko.Z.emptyTrash()),re.Z.utilities.cleanUnusedImages(0),this.props.onYes?.()}))};_onNo=()=>{this.props.onNo&&this.props.onNo()};updateClearDownloadsCounters=e=>{if("everything"===(e={deleteHistoryFrom:this.state.deleteHistoryFrom,downloads:this.state.dataToRemove.downloads,...e}).deleteHistoryFrom)n.Z.downloads.search({},(e=>{this.setState((t=>({dataToRemoveCounters:{...t.dataToRemoveCounters,downloads:e.length}})))}));else{const t=this.getSelectedStartTime(e.deleteHistoryFrom);n.Z.downloads.search({},(e=>{const s=e.filter((e=>V()(e.startTime).valueOf()>t));this.setState((e=>({dataToRemoveCounters:{...e.dataToRemoveCounters,downloads:s.length}})))}))}};getSelectedStartTime=e=>{const t=Yo.find((t=>e===t.value));let s;return s=t?V()().add(t.difference,t.format).startOf(t.format).valueOf():V()().add(-1,"h").startOf("h").valueOf(),s};updateClearBrowsingHistoryCounters=e=>{if("everything"===(e={deleteHistoryFrom:this.state.deleteHistoryFrom,history:this.state.dataToRemove.history,...e}).deleteHistoryFrom)n.Z.history.search({text:"",startTime:0,maxResults:$o},(e=>{this.setState((t=>({dataToRemoveCounters:{...t.dataToRemoveCounters,history:e.length}})))}));else{const t=this.getSelectedStartTime(e.deleteHistoryFrom);n.Z.history.search({text:"",maxResults:$o,startTime:t},(e=>{this.setState((t=>({dataToRemoveCounters:{...t.dataToRemoveCounters,history:e.length}})))}))}};toggleAll=()=>{this.setState((e=>{const t=!e.all,s={};return Object.keys(e.dataToRemove).forEach((e=>{s[e]=t})),{all:t,dataToRemove:s}}))};toggleOne=(e,t)=>{"history"===e&&this.updateClearBrowsingHistoryCounters({history:t.target.checked}),"downloads"===e&&this.updateClearDownloadsCounters({downloads:t.target.checked});const s=Xo.reduce(((s,n)=>(n.category===e&&(s[n.value]=t.target.checked),s)),{});this.setState((e=>{const t={...e.dataToRemove,...s};return{dataToRemove:t,all:Boolean(!Object.keys(t).find((e=>!1===t[e])))}}))};render(){if(fe.ZP.isGuest())return(0,zn.jsx)("header",{className:"dialog-header",children:(0,zn.jsx)("p",{className:"error",children:(0,W.Z)("Delete Browsing Data not available from guest windows.")})});const e=Yo.map((e=>(0,zn.jsx)("option",{value:e.value,children:e.text},e.value))),t=Boolean(!Object.keys(this.state.dataToRemove).find((e=>!0===this.state.dataToRemove[e]))),s=Xo.map(((e,t,s)=>{if(!s[t-1]||e.category!==s[t-1].category)return(0,zn.jsx)("li",{style:{paddingLeft:"18px"},children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.state.dataToRemove[e.value],onChange:t=>this.toggleOne(e.category,t)}),(0,zn.jsx)("span",{children:e.text}),this.state.dataToRemoveCounters[e.value]>0&&this.state.dataToRemove[e.value]&&(0,zn.jsx)("span",{className:"item-count",children:this.state.dataToRemoveCounters[e.value]})]})},e.value)}));var n=(0,zn.jsx)("div",{className:"dialog-clear-data",children:(0,zn.jsxs)("form",{className:"dialog-clear-data",onSubmit:this._onYes,children:[(0,zn.jsxs)("div",{className:"dialog-content",children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("span",{children:(0,W.Z)("Delete Data for:")}),(0,zn.jsx)(Fa.Z,{onChange:this.selectChanged,value:this.state.deleteHistoryFrom,autoFocus:!0,children:e})]})}),(0,zn.jsx)("div",{className:"setting-single pad-top",children:(0,zn.jsxs)("ul",{children:[(0,zn.jsx)("li",{style:{paddingBottom:"6px"},children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.state.all,onChange:this.toggleAll}),(0,zn.jsx)("span",{children:(0,W.Z)("browser","All")})]})}),s]})})]}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"submit",disabled:this.state.inProgress||t,value:(0,W.Z)("title","Delete")}),(0,zn.jsx)("input",{type:"button",onClick:this._onNo,disabled:this.state.inProgress,value:(0,W.Z)("Cancel")}),this.state.inProgress&&Qo]})]})});return(0,zo.ZP)(n,this.props.filter)}}const Jo=qo;function er(e){return(0,zn.jsx)(Ha.Z,{onRequestClose:e.onClose,title:(0,W.Z)("title","Delete Browsing Data"),children:(0,zn.jsx)(Jo,{onNo:e.onClose,onYes:e.onClose})})}class tr extends Un.Component{static contextType=oi.Z;context;state={doNotShowAgain:!1};_onNo=()=>{this.props.onRequestClose()};_onYes=()=>{I.Z.set(Z.kTabsConfirmClosingTabs,!this.state.doNotShowAgain),this.props.onRequestClose(),c.ZP.closePage(this.props.options.pages,{bypassConfirm:!0})};_toggleDoNotShowAgain=()=>{this.setState((e=>({doNotShowAgain:!e.doNotShowAgain})))};render(){return(0,zn.jsx)(Ha.Z,{onRequestClose:this._onNo,title:(0,W.Z)("title","Close Tabs"),children:(0,zn.jsxs)("form",{onSubmit:this._onYes,children:[(0,zn.jsxs)("div",{className:"dialog-content",children:[(0,zn.jsx)("p",{children:(0,W.Z)("Do you want to close $1 tab?","Do you want to close $1 tabs?",[this.props.options.pages.size])}),(0,zn.jsxs)("label",{className:"dialog-checkbox",children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.state.doNotShowAgain,onChange:this._toggleDoNotShowAgain}),(0,zn.jsx)("span",{children:(0,W.Z)("Do not ask again")})]})]}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"submit",onClick:this._onYes,value:(0,W.Z)("command","Close Tabs"),autoFocus:!0}),(0,zn.jsx)("input",{type:"button",onClick:this._onNo,value:(0,W.Z)("Cancel")})]})]})})}}class sr extends Un.Component{static contextType=oi.Z;context;state={doNotShowAgain:!1};_onNo=()=>{this.props.onRequestClose()};_onYes=()=>{I.Z.set(Z.kBookmarksConfirmOpening,!this.state.doNotShowAgain),this.props.onRequestClose(),c.ZP.openUrls(this.context.vivaldiWindowId,this.props.options.urls,{...this.props.options.openOptions})};_toggleDoNotShowAgain=()=>{this.setState((e=>({doNotShowAgain:!e.doNotShowAgain})))};render(){return(0,zn.jsx)(Ha.Z,{onRequestClose:this._onNo,title:(0,W.Z)("Open Multiple Links"),children:(0,zn.jsxs)("form",{onSubmit:this._onYes,children:[(0,zn.jsxs)("div",{className:"dialog-content",children:[(0,zn.jsx)("p",{children:(0,W.Z)("Do you want to open $1 link?","Do you want to open $1 links?",[this.props.options.urls.length])}),(0,zn.jsxs)("label",{className:"dialog-checkbox",children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.state.doNotShowAgain,onChange:this._toggleDoNotShowAgain}),(0,zn.jsx)("span",{children:(0,W.Z)("Do not ask again")})]})]}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"submit",onClick:this._onYes,value:(0,W.Z)("Open All Links"),autoFocus:!0}),(0,zn.jsx)("input",{type:"button",onClick:this._onNo,value:(0,W.Z)("Cancel")})]})]})})}}var nr=s(89555);const ir={width:400,minWidth:"unset"};var ar=(0,zn.jsx)(aa,{type:"close",size:16});class or extends Un.Component{state={updated:!1};render(){const{extraClassName:e,header:t,renderBody:s,acceptButtonName:n,onAccept:i,onAcceptText:a,secondaryButtonName:o,onSecondaryButtonClick:r,onDismiss:l}=this.props;return(0,zn.jsxs)(Ha.Z,{onRequestClose:nr.Z,style:ir,className:Gn()("context-anchor",e,{updated:this.state.updated}),children:[(0,zn.jsx)("div",{className:"dialog-header",children:(0,zn.jsxs)("h1",{className:"dialog-title",children:[t&&(0,zn.jsx)("span",{children:t}),(0,zn.jsx)("button",{className:"close transparent",onClick:l,title:(0,W.Z)("Close"),children:ar})]})}),(0,zn.jsx)("div",{className:"dialog-content",children:s()}),(0,zn.jsxs)("footer",{className:"dialog-footer tips",children:[o&&r&&(0,zn.jsx)("input",{type:"button",value:o,onClick:r}),this.state.updated&&a?(0,zn.jsx)("p",{className:"update-text",children:a}):(0,zn.jsx)("input",{type:"button",className:"primary",value:n,onClick:a?()=>{this.setState({updated:!0}),setTimeout(i,2e3)}:i})]})]})}}const rr=or;var lr=s(25051),dr=(0,zn.jsx)("img",{src:"resources/tip-img-mail.png",className:"tip-image-light"}),cr=(0,zn.jsx)("img",{src:"resources/tip-img-mail-dark.png",className:"tip-image-dark"});const hr=()=>(0,zn.jsxs)(zn.Fragment,{children:[dr,cr,(0,zn.jsx)("p",{children:(0,W.Z)("Manage all your inboxes in one place with Vivaldi Mail – private, powerful, and fully integrated.")})]});var ur=(0,zn.jsx)("img",{src:"resources/tip-img-calendar.png",className:"tip-image-light"}),pr=(0,zn.jsx)("img",{src:"resources/tip-img-calendar-dark.png",className:"tip-image-dark"});const gr=()=>(0,zn.jsxs)(zn.Fragment,{children:[ur,pr,(0,zn.jsx)("p",{children:(0,W.Z)("All your calendars, in one place. Get organized with a flexible calendar – fully integrated into Vivaldi.")})]});var mr=(0,zn.jsx)("img",{src:"resources/tip-img-sync.png",className:"tip-image-light"}),fr=(0,zn.jsx)("img",{src:"resources/tip-img-sync-dark.png",className:"tip-image-dark"});const vr=()=>(0,zn.jsxs)(zn.Fragment,{children:[mr,fr,(0,zn.jsx)("p",{children:(0,W.Z)("Keep your data encrypted and secure across all your devices. Pick up right where you left off.")})]});var br=(0,zn.jsx)("img",{src:"resources/tip-img-workspaces.png",className:"tip-image-light"}),Cr=(0,zn.jsx)("img",{src:"resources/tip-img-workspaces-dark.png",className:"tip-image-dark"});const wr=()=>(0,zn.jsxs)(zn.Fragment,{children:[br,Cr,(0,zn.jsx)("p",{children:(0,W.Z)("Organize your tabs into Workspaces – work projects, shopping, social media – all in one window.")})]}),yr=({winId:e,onClose:t,dialogId:s})=>{const n=(0,Un.useCallback)((()=>{Ne.shown(s),t()}),[s,t]),i=(0,Un.useCallback)((t=>{lr.QJ.openURL(e,t),n()}),[n,e]),a=()=>{wt.Z.ensureMailIsOn()},o=(0,Un.useCallback)(((t,s)=>{ue.Z.showSettings(e,t,s),n()}),[n,e]);if(null==s)return null;switch(s){case"EnableMailContextDialog":return(0,zn.jsx)(rr,{extraClassName:"anchored-to-urlfield float",header:(0,W.Z)("Discover Vivaldi Mail"),renderBody:hr,acceptButtonName:(0,W.Z)("Get started"),onAccept:()=>{a(),ue.Z.showMailAccountDialog(e),n()},onDismiss:n,secondaryButtonName:(0,W.Z)("Close"),onSecondaryButtonClick:n});case"EnableCalendarContextDialog":return(0,zn.jsx)(rr,{extraClassName:"anchored-to-urlfield float",header:(0,W.Z)("Plan with Vivaldi Calendar"),renderBody:gr,acceptButtonName:(0,W.Z)("Add accounts"),onAccept:()=>{a(),ue.Z.showCalendarAccountDialog(e),n()},onDismiss:n,secondaryButtonName:(0,W.Z)("Close"),onSecondaryButtonClick:n});case"EnableSyncContextDialog":{const e=A.Z.get(Z.kToolbarsNavigation).some((e=>"AccountButton"===e))?"anchored-to-sync":"anchored-to-urlfield";return(0,zn.jsx)(rr,{extraClassName:e+" slide",header:(0,W.Z)("Sync Vivaldi across devices"),renderBody:vr,acceptButtonName:(0,W.Z)("Set up Sync"),onAccept:()=>o("sync",{view:"register"}),onDismiss:n,secondaryButtonName:(0,W.Z)("Close"),onSecondaryButtonClick:n})}case"CreateWorkspaceContextDialog":return(0,zn.jsx)(rr,{extraClassName:"anchored-to-workspace slide",header:(0,W.Z)("Create a Workspace"),renderBody:wr,acceptButtonName:(0,W.Z)("Create Workspace"),onAccept:()=>{ue.Z.showWorkspaceDialog(e,{createInBackground:!1,withPages:void 0}),n()},onDismiss:n,secondaryButtonName:(0,W.Z)("Learn More"),onSecondaryButtonClick:()=>{i("https://vivaldi.com/features/workspaces/")}});default:return null}};const xr=()=>{let e=1;const t={guid:"",extensionId:"",readOnly:!1,name:"New Engine",keyword:"new",faviconUrl:"",url:"https://example.com/search?q=%s",postParams:"",suggestUrl:"",suggestPostParams:"",imageUrl:"",imagePostParams:"",prepopulateId:0};for(;pn.Z.getByKeyword(t.keyword);)t.keyword=`new${e}`,e++;return t};var Ir=s(57458),Ar=s(36436);class Sr extends Un.Component{static contextType=oi.Z;constructor(e){super(e);const t=e.url?e.url.replace("{searchTerms}","%s"):"",s=new URL((0,Ar.q9)(t)).hostname.replace(/^www\./,"").substring(0,2);this.state={name:e.name||"",url:t,nickname:s,nicknameTaken:!1,default:!1},this.faviconUrl=""}componentDidMount(){this.constructFavicon(this.props.url)}getDataUri=(e,t)=>{const{document:s}=this.context,n=new Image;n.onload=function(){const n=s.createElement("canvas");n.width=this.naturalWidth,n.height=this.naturalHeight,n.getContext("2d").drawImage(this,0,0),t(n.toDataURL(e))},n.src=e};constructFavicon=e=>{const{document:t}=this.context;if(e){const s=(0,Ar.q9)(e.trim()),n=t.createElement("a");n.href=s;const i=n.protocol+"//"+n.host+"/favicon.ico";this.getDataUri(i,(e=>{this.faviconUrl=e}))}};updateFavicon=e=>{if("string"==typeof e.target.value){const t=e.target.value.trim();if(t)return void this.constructFavicon(t)}this.faviconUrl=""};canCreate=()=>Boolean(this.state.name.trim()&&this.state.url.trim()&&this.state.nickname.trim()&&!1===this.state.nicknameTaken);create=async()=>{if(this.canCreate()){const e=xr();e.name=this.state.name.trim(),e.keyword=this.state.nickname,e.url=(0,Ir.encode)(this.state.url.trim()),e.faviconUrl=this.faviconUrl;const t=await re.Z.searchEngines.addTemplateUrl(e);t&&this.state.default&&re.Z.searchEngines.setDefault("defaultSearch",t),"function"==typeof this.props.onClose&&this.props.onClose()}};nameChange=e=>{"string"==typeof e.target.value&&this.setState({name:e.target.value})};defaultChange=e=>{"boolean"==typeof e.target.checked&&this.setState({default:e.target.checked})};urlChange=e=>{"string"==typeof e.target.value&&this.setState({url:e.target.value})};nicknameChange=e=>{if("string"==typeof e.target.value){const t=e.target.value.trim();this.setState({nickname:t,nicknameTaken:t.length>0&&void 0!==pn.Z.getByKeyword(t)})}};render(){const e=this.state.nicknameTaken?pn.Z.getByKeyword(this.state.nickname):null,t=e?e.name:"";return(0,zn.jsxs)("form",{onSubmit:this.create,children:[(0,zn.jsxs)("div",{className:"dialog-content",children:[(0,zn.jsxs)("label",{className:"fieldset",children:[(0,zn.jsx)("span",{children:(0,W.Z)("title","Name")}),(0,zn.jsx)("input",{className:"setting-single-flex",type:"text",value:this.state.name,placeholder:(0,W.Z)("Description"),onChange:this.nameChange,autoFocus:!0})]}),(0,zn.jsxs)("label",{className:"fieldset",children:[(0,zn.jsx)("span",{children:(0,W.Z)("Nickname")}),(0,zn.jsx)("input",{className:"searchengine_keyword setting-single-noflex",type:"text",value:this.state.nickname,placeholder:(0,W.Z)("Nickname"),onChange:this.nicknameChange})]}),this.state.nicknameTaken&&(0,zn.jsx)("p",{className:"info",style:{textAlign:"right"},children:(0,W.Z)("Nickname in use by $1 search engine",[t])})]}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsxs)("label",{className:"fieldset",children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.state.default,onChange:this.defaultChange}),(0,zn.jsx)("span",{children:(0,W.Z)("Set as Default Search")})]}),(0,zn.jsx)("input",{type:"submit",disabled:!this.canCreate(),value:(0,W.Z)("Add")}),(0,zn.jsx)("input",{type:"button",onClick:this.props.onClose,value:(0,W.Z)("Cancel")})]})]})}}const Zr=Sr;const Tr=function(e){return(0,zn.jsx)(Ha.Z,{onRequestClose:e.onClose,title:(0,W.Z)("Add Search Engine"),children:(0,zn.jsx)("div",{className:"dialog-addsearch",children:(0,zn.jsx)(Zr,{onClose:e.onClose,name:e.name,url:e.url})})})};var Er=s(80837);class kr extends Un.PureComponent{static contextType=oi.Z;clickOnExtensionError(e){re.Z.extensionActionUtils.showGlobalError(e,this.context.vivaldiWindowId),1===this.props.errors.length&&this.props.onClose()}render(){return(0,zn.jsxs)(Ha.Z,{style:{width:400},onRequestClose:this.props.onClose,ignoreClickOutside:!0,className:"disabledExtensionsPopup slide",title:(0,W.Z)("Extension Changed","Extensions Changed",[this.props.errors.length]),children:[(0,zn.jsxs)("div",{className:"dialog-content",children:[(0,zn.jsxs)("p",{className:"new-extension",children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.Si$.medium}}),(0,W.Z)("An extension was automatically disabled.","Extensions were automatically disabled.",[this.props.errors.length])]}),this.props.errors.map((e=>(0,zn.jsxs)("div",{className:"list-item",children:[(0,zn.jsx)("button",{onClick:()=>this.clickOnExtensionError(e.commandId),children:(0,W.Z)("Review")}),e.name," ","installed"===e.errorType?(0,W.Z)("extensions","(New)"):(0,W.Z)("extensions","(Updated)")]},e.id)))]}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Show All Extensions"),onClick:()=>{ue.Z.showExtensions(this.context.vivaldiWindowId),this.props.onClose()}}),(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Close"),onClick:this.props.onClose})]})]})}}const Nr=kr;var _r=s(15800),Pr=s(50522),Mr=s(1712),Dr=s(22616),Or=s(34006);const{ensureHttpsForWebcal:jr}=_r.ZP;function Lr(e,t){const s=[];for(const n of e)"ical"!==n.account_type&&s.push({account:n,calendars:t.filter((e=>e.accountId===n.id))});return s.sort(((e,t)=>"local"===e.account.account_type?1:"local"===t.account.account_type?-1:0))}const Rr="CREATE_CALENDAR";class Br extends Un.PureComponent{#p=[];#g=[];constructor(e){super(e);const t="string"==typeof e.file?e.file.split("\\").pop()?.split("/").pop():e.file.name;this.#p=Pr.Z.getAccounts(),this.#g=Pr.Z.getCalendars();const s=Mr.Z.getLocalAccount();this.state={calendarGroups:Lr(this.#p,this.#g),importOption:{file:e.file,calendarId:s?"":this.#g[0]?.id??"",createNew:!!s||0===this.#g.length,newCalendarName:t,importId:t},calendarName:"",eventCount:0,host:""}}componentDidMount(){Pr.Z.addListener(this.#m),this.probeiCal()}componentWillUnmount(){Pr.Z.removeListener(this.#m)}componentDidUpdate(e){this.props.file!==e.file&&this.probeiCal(),this.props.import&&!e.import&&async function(e){try{await(0,Or.PU)(e)}catch(t){Dr.Z.addImportError("Calendar",e.importId,t.message)}}(this.state.importOption)}probeiCal=async()=>{const{message:e,eventCount:t,error:s,calendarName:n}=await(0,Or.ig)(this.state.importOption);this.props.onStatus(e,t,s);const i={eventCount:t,calendarName:n},{file:a}=this.props;if("string"==typeof a){if(this.props.standAlone&&!a.startsWith("webcal")&&1===t&&Pr.Z.getWritableCalendars().length>0){const e=this.props.windowId??fe.ZP.getLastActiveBrowserWindowId();(0,Or.BC)(this.state.importOption,e)}a.startsWith("webcal")||a.startsWith("http")?i.host=re.Z.utilities.getUrlFragments(jr(a))?.host??"":i.host=""}this.setState(i)};#m=()=>{const{accounts:e,calendars:t}=Pr.Z.getState();e===this.#p&&t===this.#g||(this.setState({calendarGroups:Lr(e,t)}),this.#p=e,this.#g=t)};onNameChange=e=>{const{importOption:t}=this.state,s=e.target.value===Rr?{createNew:!0,calendarId:""}:{calendarId:e.target.value,createNew:!1};this.setState((e=>({importOption:{...t,...s}})))};setCreateNewName=e=>{const{importOption:t}=this.state;this.setState((s=>({importOption:{...t,newCalendarName:e.target.value}})))};render(){const{importOption:e,calendarName:t}=this.state,{importId:s,createNew:n,calendarId:i,newCalendarName:a}=e,o=`<strong>${this.state.host||a}</strong>`,r=this.state.host||a?(0,W.Z)("Add $1 event from $2 to","Add $1 events from $2 to",[this.state.eventCount,o]):(0,W.Z)("Add $1 event to","Add $1 events to",[this.state.eventCount]),l=this.#p.some((e=>"local"===e.account_type));return(0,zn.jsxs)(zn.Fragment,{children:[this.props.standAlone&&(0,zn.jsx)("p",{dangerouslySetInnerHTML:{__html:r}}),(0,zn.jsxs)("div",{className:"import-calendar-target",children:[s&&!this.props.standAlone&&(0,zn.jsx)("label",{className:"import-calendar-name",children:(0,W.Z)("$1 to",[s])}),(0,zn.jsxs)(Fa.Z,{onChange:this.onNameChange,name:"calendarId",value:n?Rr:i,children:[this.state.calendarGroups.map((({account:e,calendars:t})=>(0,zn.jsx)("optgroup",{label:"local"===e.account_type?(0,W.Z)("Local Calendars"):e.name||e.url,children:(0,zn.jsxs)(zn.Fragment,{children:[t.map((e=>(0,zn.jsx)("option",{value:e.id,children:e.description||e.name},e.id))),"local"===e.account_type&&(0,zn.jsx)("option",{value:Rr,children:(0,W.Z)("New Calendar...")})]})},e.id))),!l&&(0,zn.jsx)("optgroup",{label:(0,W.Z)("Local Calendars"),children:(0,zn.jsx)("option",{value:Rr,children:(0,W.Z)("New Calendar...")})})]}),n&&(0,zn.jsx)("label",{className:"import-calendar-new-name",children:(0,zn.jsx)("input",{type:"text",value:t||a,onChange:this.setCreateNewName})})]})]})}}const Fr=Br;class Wr extends Un.PureComponent{static contextType=oi.Z;displayName="ImportCalendarDialog";state={fileHandles:[],calendarId:_r.ZP.getDefaultCalendar()?.id||"",calendarName:"",doImport:!1};componentDidMount(){this.props.setStartImport(this.startImport),this.props.setChooseFile(this.loadImport)}loadImport=async()=>{try{const e=await this.context.showOpenFilePicker({multiple:!0,types:[{description:"iCalendar",accept:{"text/calendar":[".ics",".txt"]}}]});this.setState({fileHandles:e}),this.props.readyToStart(!0)}catch(e){"AbortError"!==e.name&&Dr.Z.addImportError("Calendar","File",e.message)}};reportStatus=(e,t,s=!1)=>{s&&Dr.Z.addImportError("Calendar","File",e)};startImport=async()=>{wt.Z.isCalendarOn()||(ls.Z.log("Calendar",["import"],"Calendar is turned off - turning it on for importing"),wt.Z.ensureCalendarIsOn(),en.Z.showContent(this.context.vivaldiWindowId,"PanelCalendar")),this.setState({doImport:!0}),this.props.readyToStart(!1)};render(){return(0,zn.jsx)("div",{className:"import-calendar-files",children:!!this.state.fileHandles.length&&(0,zn.jsx)("div",{className:"import-calendar-targets",children:this.state.fileHandles.map((e=>(0,zn.jsx)(Fr,{file:e,import:this.state.doImport,onStatus:nr.Z},e.name)))})})}}const Ur=Wr;var Vr=s(69417),Hr=s(79706);const{ensureHttpsForWebcal:Gr}=_r.ZP;const Kr=function(e){const{subscribe:t,url:s,onStatus:n}=e,[i,a]=(0,Un.useState)(),[o,r]=(0,Un.useState)(),[l,d]=(0,Un.useState)((0,W.Z)("noun","New Calendar")),c=(0,Un.useRef)(l);c.current=l,(0,Un.useEffect)((()=>{if((0,Ar.C3)(s))try{a(re.Z.utilities.getUrlFragments(Gr(s))?.host),async function(){n((0,W.Z)("Fetching iCal..."),-1);try{const e=await Hr.Z.probeWebCalendar({id:"",account_type:"ical",username:"",name:c.current,url:Gr(s)},"");if(e.foundService){const t=e.calendars[0];t.description&&d(t.description),r(t);const s=t.description?(0,W.Z)("Found calendar ‘$2’ containing $1 event","Found calendar ‘$2’ containing $1 events",[e.eventCount,t.description]):(0,W.Z)("Found a calendar containing $1 event","Found a calendar containing $1 events",[e.eventCount]);n(s,e.eventCount)}else n(e.statusMessage,0,!0)}catch(e){n(e.message,0,!0)}}()}catch(e){n(e.message,0,!0)}else a(void 0),s&&n((0,W.Z)("Invalid URL: $1",[s]),0,!0)}),[s,n]),(0,Un.useEffect)((()=>{o&&t&&async function(){try{await ie.ZP.createAccount({account_type:"ical",username:"",name:c.current,url:Gr(s)}),n((0,W.Z)("Successfully subscribed to web calendar"),0)}catch(e){n(e.message,0,!0)}}()}),[o,t,s,n]);const h=i?(0,W.Z)("Add new calendar subscription from $1?",[`<strong>${i}</strong>`]):(0,W.Z)("Add new calendar subscription?");return(0,zn.jsxs)("div",{className:"import-webcal",children:[e.showBody&&(0,zn.jsx)("p",{dangerouslySetInnerHTML:{__html:h}}),(0,zn.jsx)(Vr.Z,{label:(0,W.Z)("Calendar Name"),type:"text",value:l,onChange:function(e){d(e.target.value)},disabled:!o})]})},zr=/^(\s*\w+:\/\/)?(.+?)\/?(\?.+?)\/*\s*$/;class $r extends Un.PureComponent{state={url:"",urlField:"",subscribe:!1,status:"info",message:""};#f=!1;componentDidMount(){this.props.setStartImport(this.startImport)}setUrlDebounced=(0,Te.Z)((e=>{this.state.url!==e&&(this.props.readyToStart(!1),this.setState({url:e,status:"info",message:""},(()=>{const e=this.state.url.replace(zr,"$2$3");this.#f=Pr.Z.getAccounts().some((t=>"ical"===t.account_type&&t.url.replace(zr,"$2$3")===e))})))}),1e3);onUrlChange=e=>{const t=e.target.value.trim();(0,Ar.C3)(t)?this.setUrlDebounced(t):this.state.url&&this.setUrlDebounced(""),this.setState({urlField:t})};onFetch=e=>{const t=this.state.urlField;this.state.url!==t&&(0,Ar.C3)(t)&&this.setState({url:t})};reportStatus=(e,t,s=!1)=>{this.setState({status:s?"error":"info",message:e});const n=t>=0&&!s;this.props.readyToStart(n),s&&Dr.Z.addImportError("Calendar",this.state.url,e)};startImport=async()=>{Dr.Z.clearImportProgress("Calendar",this.state.url);const e={subscribe:!0};this.state.url!==this.state.urlField&&(e.url=this.state.urlField),this.setState(e)};render(){return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("div",{className:"import-calendar-file",children:[(0,zn.jsx)("form",{onSubmit:this.onFetch,children:(0,zn.jsxs)("label",{className:"floating-label",children:[(0,zn.jsx)("span",{children:(0,W.Z)("Remote ICS Address")}),(0,zn.jsxs)("div",{className:"toolbar toolbar-default",children:[(0,zn.jsx)("input",{className:"floating-input",type:"text",onChange:this.onUrlChange,value:this.state.urlField}),(0,zn.jsx)("input",{type:"submit",value:(0,W.Z)("Fetch"),disabled:!this.state.urlField})]})]})}),(0,zn.jsx)(Kr,{url:this.state.url,subscribe:this.state.subscribe,onStatus:this.reportStatus})]}),(0,zn.jsxs)("div",{children:[this.state.message&&(0,zn.jsx)(fa,{type:this.state.status,children:this.state.message}),this.#f&&(0,zn.jsx)(fa,{type:"warning",children:(0,W.Z)("You are already subscribed to this calendar")})]})]})}}const Yr=$r;var Xr=s(90864),Qr=s(26219),qr=(0,zn.jsx)("br",{}),Jr=(0,zn.jsx)("br",{});class el extends Un.PureComponent{static contextType=oi.Z;accountIdToPaths=new Map;constructor(e,t){super(e);const s=It.Z.getAccounts(),n=Object.keys(s);for(const e of n){const t=Xr.Z.getFoldersFlat(e,{folders:s[e].folders},!1).map((e=>e.path));this.accountIdToPaths.set(e,t)}const i=this.accountIdToPaths.entries().next().value,[a,o]=i||["",[]],r=o[0]||"";this.state={upload:!1,fileEntries:[],accountId:a,path:r}}componentDidMount(){this.props.setStartImport(this.startImport),this.props.setChooseFiles(this.chooseFiles)}chooseFiles=async()=>{const e=await(0,Qr.Z)(this.context,["eml","mbs","mbox"]);this.setState({fileEntries:e}),this.props.readyToStart(!!this.state.accountId&&!!this.state.path)};startImport=async()=>{wt.Z.isMailOn()||(ls.Z.log("Mail",["import"],"Mail is turned off - turning it on for importing"),wt.Z.ensureMailIsOn()),d.Z.importMailFiles(this.context.vivaldiWindowId,this.state.fileEntries,this.state.accountId,this.state.path)};accountSelected=e=>{const t=e.target.value,s=this.accountIdToPaths.get(t),n=s?s[0]:"";this.setState({accountId:t,path:n}),this.props.readyToStart(this.state.fileEntries.length>0&&!!this.state.path)};pathSelected=e=>{this.setState({path:e.target.value}),this.props.readyToStart(this.state.fileEntries.length>0&&!!this.state.accountId)};render(){return(0,zn.jsx)("div",{className:"import-data",children:(0,zn.jsxs)("fieldset",{children:[(0,zn.jsxs)("div",{className:"import-pathname",children:[(0,W.Z)("Source Files:"),qr,this.state.fileEntries.length>0&&(0,zn.jsx)("input",{type:"text",value:this.state.fileEntries.map((e=>e.name)).join(", "),readOnly:!0}),0===this.state.fileEntries.length&&(0,zn.jsx)("input",{type:"text",value:(0,W.Z)("No files selected yet"),readOnly:!0})]}),(0,zn.jsx)("label",{htmlFor:"accountSel",className:"from",children:(0,W.Z)("import","Destination Account")}),(0,zn.jsx)(Fa.Z,{id:"accountSel",value:this.state.accountId,onChange:this.accountSelected,children:Array.from(this.accountIdToPaths.keys()).map((e=>(0,zn.jsx)("option",{value:e,children:e},e)))}),(0,zn.jsx)("label",{htmlFor:"pathSel",className:"from",children:(0,W.Z)("import","Destination Folder")}),(0,zn.jsx)(Fa.Z,{value:this.state.path,onChange:this.pathSelected,children:(this.accountIdToPaths.get(this.state.accountId)||[]).map((e=>(0,zn.jsx)("option",{value:e,children:(0,Vs.kF)(e)},e)))}),(0,zn.jsxs)("div",{className:"import-pathname",children:[(0,W.Z)("Destination:"),Jr,(0,zn.jsx)("input",{type:"text",value:`${this.state.accountId}/${(0,Vs.kF)(this.state.path)}`,readOnly:!0})]})]})})}}const tl=el;var sl=s(80225);class nl extends Un.PureComponent{static contextType=oi.Z;componentDidMount(){this.props.setRunImporter(this.startNotesImporter)}startNotesImporter=()=>{const e=this.context.vivaldiWindowId;return(0,sl.T$)(e)};render(){return(0,zn.jsx)(zn.Fragment,{children:(0,zn.jsx)("div",{className:"import-notes",children:(0,zn.jsx)("p",{children:(0,W.Z)("Import a folder and its subfolders of plain-text and Markdown files (.md, .txt).")})})})}}const il=nl,al=()=>[{value:15,name:(0,W.Z)("Every 15 Minutes")},{value:30,name:(0,W.Z)("Every 30 Minutes")},{value:60,name:(0,W.Z)("Every Hour")},{value:120,name:(0,W.Z)("Every 2 Hours")},{value:360,name:(0,W.Z)("Every 6 Hours")},{value:720,name:(0,W.Z)("Every 12 Hours")},{value:1440,name:(0,W.Z)("Daily")},{value:10080,name:(0,W.Z)("Weekly")},{value:-1,name:(0,W.Z)("other","Never")}].map((e=>(0,zn.jsx)("option",{value:e.value,children:e.name},e.value)));class ol extends Un.PureComponent{constructor(e){super(e);const t=this.props.feedsToAdd.map((e=>({...e})));this.state={feeds:t,alsoOnDashboard:!1,lastFetched:this.props.feedsToAdd.map((e=>(0,W.Z)("Checking..."))),lastFetchedTitles:this.props.feedsToAdd.map((e=>[]))},this.initFeedInfo(t)}initFeedInfo=e=>{const t=this.state.lastFetched,s=this.state.lastFetchedTitles;e.forEach(((n,i)=>{fetch(e[i].url).then((e=>e.ok?e.text():Promise.reject(""))).then((n=>{const a=(0,Ps.t5)(void 0,n,e[i].url);if("string"==typeof a)return;let o,r=[];a.feeditems.forEach(((e,t)=>{const s=a.feeditems[t].updatedate||a.feeditems[t].publishdate;let n;s&&(n=ks(s)),n&&(!o||s>o)?(o=s,r=[a.feeditems[t].plaintitle,...r.slice(0,2)]):r.length<3&&r.push(a.feeditems[t].plaintitle)})),t[i]=o||(0,W.Z)("Date not supplied/unknown"),s[i]=r,this.setState({lastFetched:[...t],lastFetchedTitles:[...s]})})).catch((()=>{t[i]=(0,W.Z)("Could not load newsfeed"),this.setState({lastFetched:[...t]})}))}))};addFeed=async()=>{const{feeds:e}=this.state;Dr.Z.setImportProgress("Feeds (OPML)","Feeds",0,e.length);const t=await xs(e);Dr.Z.setImportProgress("Feeds (OPML)","Feeds",e.length,e.length),this.state.alsoOnDashboard&&t.length>0&&t.forEach((e=>P("feed",{feedId:e.feedId}))),this.onDismiss()};onDismiss=()=>{this.props.onClose()};onChange=e=>{const{name:t,value:s,id:n}=e.target;this.setState((e=>{let i=0;return{feeds:e.feeds.map((e=>(i++,"fid"+i+"__"+t===n?{...e,[t]:s}:e)))}}))};toggleAlsoOnDashboard=()=>{this.setState((e=>({alsoOnDashboard:!e.alsoOnDashboard})))};feeds=()=>{let e=0;return(0,zn.jsxs)("div",{className:"dialog-add-feed "+(this.props.dismissable?"dialog-content":""),children:[(0,zn.jsx)("label",{htmlFor:"fid1__title",children:(0,W.Z)("Feed Title")}),(0,zn.jsx)("label",{htmlFor:"fid1__url",children:(0,W.Z)("Address")}),(0,zn.jsx)("label",{htmlFor:"fid1__refreshInterval",children:(0,W.Z)("Refresh Interval")}),this.state.feeds.map(((t,s)=>{e++;const n="fid"+e,i=t.path||"",a=i.substr(0,i.lastIndexOf("/"));return(0,zn.jsxs)(Un.Fragment,{children:[(0,zn.jsx)("input",{type:"text",placeholder:(0,W.Z)("Title"),onChange:this.onChange,value:t.title,name:"title",id:n+"__title"}),(0,zn.jsx)("input",{type:"text",placeholder:(0,W.Z)("Address"),onChange:this.onChange,value:t.url,name:"url",id:n+"__url"}),(0,zn.jsx)(Fa.Z,{onChange:this.onChange,value:t.refreshInterval,name:"refreshInterval",id:n+"__refreshInterval",children:al()}),(0,zn.jsxs)("div",{className:"last-updated-date",children:[(0,zn.jsxs)("div",{children:[(0,zn.jsx)("span",{className:"last-updated-date-title",children:(0,W.Z)("Last updated:")}),(0,zn.jsx)("span",{children:this.state.lastFetched[s]})]}),a&&(0,zn.jsxs)("div",{children:[(0,zn.jsx)("span",{className:"folder-title",children:(0,W.Z)("Folder:")}),(0,zn.jsx)("span",{children:a})]})]}),this.props.dismissable&&(0,zn.jsxs)("div",{className:"last-updated-title",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Latest feed items (preview)")}),(0,zn.jsx)("ul",{children:this.state.lastFetchedTitles[s].map((e=>(0,zn.jsx)("li",{title:e,children:e},e)))})]})]},t.feedId)}))]})};footer=()=>{const e=this.state.feeds.some((e=>!!e.url));return(0,zn.jsxs)("footer",{className:"dialog-footer dialog-add-feed-footer "+(this.props.dismissable?"":"dialog-footer-sticky"),children:[this.props.dismissable&&(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Preview"),style:{marginRight:"auto"},onClick:()=>{this.state.feeds[0].url&&c.ZP.openURL(fe.ZP.getLastActiveBrowserWindowId(),this.state.feeds[0].url),this.onDismiss()},disabled:!e}),!this.props.widgetId&&(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.state.alsoOnDashboard,onChange:this.toggleAlsoOnDashboard}),(0,zn.jsx)("span",{children:(0,W.Z)("Add to Dashboard")})]}),(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Add Feed","Add Feeds",[this.state.feeds.length]),className:"primary",onClick:this.addFeed,disabled:!e}),(0,zn.jsx)("input",{type:"button",onClick:this.onDismiss,value:(0,W.Z)("Cancel")})]})};render(){return(0,zn.jsxs)(zn.Fragment,{children:[this.props.dismissable&&(0,zn.jsx)("header",{className:"dialog-header",children:(0,zn.jsx)("h1",{id:Ha.t,children:(0,W.Z)("browser","Add Feed")})}),this.feeds(),this.footer()]})}}const rl=ol;function ll(e,t){let s=[];return e.forEach((e=>{const{feedurl:n,plaintitle:i,supported:a,items:o}=e;n&&s.push({title:i,url:n,supported:a,path:t}),o.length&&(t=t?t+"/"+i:i,s=s.concat(ll(o,t)),t="")})),s}function dl(e,t){(0,H.c)({title:(0,W.Z)("Import Feeds (OPML file)"),body:t,tag:"VIVALDI_FEEDS_IMPORT_OPML_FILE"}),h.Z.setStatus(e,t)}class cl extends Un.PureComponent{static contextType=oi.Z;#v=!1;state={listFeeds:!1,feeds:[]};componentDidMount(){this.#v=!0,this.props.setChooseFile(this.chooseAndParseFile)}componentWillUnmount(){this.#v=!1}chooseAndParseFile=async()=>{const e=this.context.vivaldiWindowId,t=await async function({showOpenFilePicker:e}){const[t]=await e({types:[{accept:{"text/*":[".opml",".txt"]},description:(0,W.Z)(".opml and .txt files")}]});return t}(this.context);wt.Z.isFeedsOn()||(ls.Z.info("Feeds",["import opml"],"Feeds are turned off - turning it on for importing an OPML file"),wt.Z.ensureFeedsIsOn(),en.Z.showContent(e,"PanelFeeds"));const s=await async function(e){const t=await e.getFile();return new Promise(((e,s)=>{const n=new FileReader;n.onloadend=()=>{n.result instanceof ArrayBuffer?e(n.result):s()},n.readAsArrayBuffer(t),n.onerror=e=>{console.error(n.error),s()}}))}(t),n=new Uint8Array(s);let i=new TextDecoder("utf-8").decode(n);const a=i.match(/^\<\?xml\s[^>]*\bencoding\s*=\s*"([^"]*)"[^>]*\?>/);if(a&&a[1]&&!/^\s*utf-8\s*$/i.test(a[1]))try{i=new TextDecoder(a[1]).decode(n)}catch(e){}const o=new DOMParser;try{const t=o.parseFromString(i,"application/xml"),s=(0,Ps.X7)(t,"http://localhost/");if("string"==typeof s)dl(e,(0,W.Z)("File does not appear to be of OPML format."));else{const t=ll(s.items,""),n=t.filter((e=>e.supported));if(0===n.length)dl(e,(0,W.Z)("No items in this file are supported"));else if(t.length>n.length?dl(e,(0,W.Z)(t.length-n.length+" items in this file are not supported")):h.Z.clearStatus(e),this.#v){const e=n.map((e=>{const t=crypto.randomUUID();return{url:e.url,title:e.title,path:e.path?e.path+"/"+t:t,feedId:t,offline:!1,refreshInterval:120}}));this.setState({listFeeds:!0,feeds:e})}}}catch(t){throw dl(e,(0,W.Z)("Error parsing file - Not valid XML")),new Error(`Parsing failed: ${t}`)}};render(){return(0,zn.jsx)(zn.Fragment,{children:this.state.listFeeds&&(0,zn.jsx)(rl,{onClose:this.props.onClose,feedsToAdd:this.state.feeds,dismissable:!1})})}}const hl=cl;function ul(e,t,s,n){return e[t]=e[t]||{},e[t][s]=e[t][s]||{current:0,total:0},n&&(e[t][s].children=e[t][s].children||{},e[t][s].children&&(e[t][s].children[n]=e[t][s].children[n]||{current:0,total:0})),e}class pl extends m.Z{getInitialState(){return{}}reduce(e,t){switch(t.actionType){case"IMPORT_PROGRESS":return(0,C.Uy)(e,(e=>{const{importType:s,importItemType:n,current:i,total:a,key:o}=t;e=ul(e,s,n,o),o&&e[s][n].children?(e[s][n].children[o].current=i,e[s][n].children[o].total=a):(e[s][n].current=i,e[s][n].total=a)}));case"IMPORT_PROGRESS_WARN":return(0,C.Uy)(e,(e=>{const{importType:s,importItemType:n,message:i}=t;(e=ul(e,s,n))[s][n].warnings=e[s][n].warnings||[],e[s][n].warnings.push(i)}));case"IMPORT_PROGRESS_ERROR":return(0,C.Uy)(e,(e=>{const{importType:s,importItemType:n,message:i}=t;(e=ul(e,s,n))[s][n].errors=e[s][n].errors||[],e[s][n].errors.push(i)}));case"IMPORT_PROGRESS_CLEAR":return(0,C.Uy)(e,(e=>{delete e[t.importType]}));default:return e}}getImportProgress(){return this.getState()}numImportsInStore(){return Object.keys(this.getState()).length}isImportTypeInProgress(e){const t=this.getImportProgress();for(const s in t[e]){const n=t[e][s];if(!n.children&&(-1===n.total||n.current<n.total))return!0;if(n.children)for(const e in n.children){const t=n.children[e];if(-1===t.total||t.current<t.total)return!0}}return!1}}const gl=new pl;var ml=s(72010);async function fl(e,t,s){let n=0;for(let i=0;i<s.length;i++){const a=s[i];Dr.Z.setImportProgress(e,t,i+1,s.length),ls.Z.log("Mail",["import"],`... importing contact ${++n}/${s.length}`);let r=!1;for(const e of a.emailAddresses){const t=ml.Z.getContactsWithAddress(e.emailAddress);if(t){for(const e of a.emailAddresses)t.emailAddresses.includes(e.emailAddress)||(t.emailAddresses.push({id:e.id,emailAddress:e.emailAddress,type:e.type}),await o.Z.update(t.id,{name:t.name,birthday:t.birthday,note:t.note,generatedFromSentMail:t.generatedFromSentMail,avatarUrl:t.avatarUrl,separator:t.separator,trusted:t.trusted}));r=!0;break}}r||await o.Z.addContact(a)}ls.Z.log("Mail",["import"],`... compared and/or imported ${s.length} contacts`)}var vl=s(25100),bl=s(28973);const Cl=[["is_read",Nt.T4.SEEN],["is_replied",Nt.T4.ANSWERED],["is_forwarded",Nt.T4.FORWARDED],["is_resent",void 0],["is_outgoing",void 0],["is_sent",void 0],["is_queued",void 0],["is_seen",void 0],["is_timequeued",void 0],["is_deleted",Nt.T4.DELETED],["has_attachment",void 0],["has_image_attachment",void 0],["has_audio_attachment",void 0],["has_video_attachment",void 0],["has_zip_attachment",void 0],["is_onepart_message",void 0],["currently unused bit",void 0],["is_waiting_for_indexing",void 0],["is_newsfeed_message",void 0],["partially_fetched",void 0],["is_news_message",void 0],["allow_8bit",void 0],["is_imported",void 0],["has_priority",void 0],["has_priority_low",void 0],["has_priority_max",void 0],["is_control_message",void 0],["allow_quotestring_qp",void 0],["has_keywords",void 0],["permanently_removed",void 0],["dir_forced_ltr",void 0],["dir_forced_rtl",void 0]];var wl=s(16445),yl=s(40348),xl=s(93986);function Il(e,t,s,n,i){Dr.Z.setImportProgress(e,t,s,n,i)}async function Al(e){const{path:t}=e;await rs.Z.importProgress.get(t)?await rs.Z.importProgress.update(t,e):await rs.Z.importProgress.add(e)}async function Sl(e){const t=await async function(e){const t=(0,Us.NQ)(e,"accounts.ini");try{const s=await re.Z.mailPrivate.readFileToText(t);if(s)return s;ls.Z.log("Mail",["import"],`accounts.ini file not found in Opera Mail path: ${e}`)}catch(t){ls.Z.log("Mail",["import"],`Failed to read accounts.ini file for Opera Mail path: ${e} - Error: ${t.message||t}`)}}(e);return t?function(e){const t={section:/^\[(Account(s)?[0-9]+)\]$/,param:/^([^=]+?)\s*=\s*(.*?)$/,comment:/^[;#].*$/},s=new Map,n=e.split(/[\r\n]+/);let i="";return n.forEach((e=>{const n=e.trim();if(!t.comment.test(n))if(t.param.test(n)){const e=n.split("=",2),t=e[0].toLowerCase().replace(/\s+/g,"_"),a=isNaN(e[1])?e[1]:Number(e[1]);i?s.set(i,{...s.get(i),[t]:a}):s.set(t,a)}else t.section.test(n)?(i=n.substr(1,n.length-2).toLowerCase(),s.set(i,{})):0===e.length&&i?i="":ls.Z.log("Mail",["parsing","accounts"],"ignored line:",n)})),ls.Z.log("Mail",["parsing","accounts"],"parseMap:",s),(0,bl.Z)(s).filter((([,e])=>e.account_name)).map((([e,t])=>(t.email||ls.Z.warn("Mail",["parsing","accounts"],`Account in section ${e} has no email address. Protocol: ${t.incoming_protocol}`),{section:e,MAIL_EMAIL:t.email||"",MAIL_PORT:t.incoming_port,MAIL_SERVER:t.incoming_servername||"",MAIL_USER:t.incoming_username||"",MAIL_SMTP_SERVER:t.outgoing_servername||"",MAIL_SMTP_PORT:t.outgoing_port,MAIL_SMTP_SOCKET_TYPE:587===t.outgoing_port?"starttls":"ssl",MAIL_SMTP_USER:t.outgoing_username||"",accountType:t.incoming_protocol,offline:!0,MAIL_PASSWORD:"",MAIL_SMTP_PASSWORD:"",preFetch:t.download_bodies?"all":"none"})))}(t):[]}async function Zl(e,t,s,i,a){wt.Z.isMailOn()||(ls.Z.log("Mail",["import"],"Mail is turned off - turning it on for importing from m2"),wt.Z.ensureMailIsOn(),en.Z.showContent(e,"PanelMail")),t&&"/"!==t[t.length-1]&&(t+="/");const o=await async function(e,t,s){ls.Z.log("Mail",["import"],"importing accounts from",e);const n=It.Z.getAccounts(),i=(await Sl(e)).filter((e=>s.find((t=>t.accountId===e.MAIL_EMAIL&&t.accountType===e.accountType)))),a=new Map;for(let e=0;e<i.length;e++){const s=i[e];Il(t,"MailAccounts",e+1,i.length);try{if(![Nt.s9.IMAP,Nt.s9.POP].includes(s.accountType.toUpperCase())){console.warn(`Importing accounts of type "${s.accountType}" is not supported`),Dr.Z.addImportWarning(t,"MailAccounts",(0,W.Z)(`Importing accounts of type "${s.accountType}" is not supported`));continue}if(a.set(s.section,s.MAIL_EMAIL),n[s.MAIL_EMAIL])continue;if(s.accountType===Nt.s9.POP&&i.find((e=>e.MAIL_EMAIL===s.MAIL_EMAIL&&e.accountType===Nt.s9.IMAP)))continue;const e=(0,ys.Z)(s,"section"),o=(0,Us.Gb)();await es.Z.addAccount(e),(0,xl.ZP)(e),await o,ls.Z.log("Mail",["import"],"... imported account",s.MAIL_EMAIL)}catch(e){Dr.Z.addImportError(t,"MailAccounts",(0,W.Z)("Failed importing account $1",[s.MAIL_EMAIL])),console.error(`Failed importing account ${JSON.stringify(s)}`)}}return a}(s,i,a);await async function(e,t){ls.Z.log("Mail",["import"],"importing contacts from",e);const s=await async function(e){const t=(0,Us.NQ)(e,"contacts.adr"),s=await re.Z.mailPrivate.readFileToText(t);s||(n.Z.runtime.lastError?console.error(n.Z.runtime.lastError):console.warn(`contacts.adr file not found in Opera profile path: ${e}`));return s}(e);if(!s)return Dr.Z.addImportWarning(t,"MailContacts",(0,W.Z)("No contacts found in $1",e)),void ls.Z.log("Mail",["import"],"... no contacts found in",e);const i=function(e){const t=e.split("#FOLDER")[0].split("#CONTACT");t.shift();const s=t.map((e=>e.replace(/\t/g,""))).map((e=>e.split(/[\r\n]+/g))).map((e=>{const t={};return e.forEach((e=>{const s=e.trim(),n=s.split("=")[0].toLowerCase(),i=s.split("=")[1];n.length&&(t[n]=i)})),t}));return ls.Z.log("Mail",["parsing","contacts"],"parsed:",s),s.map(((e,t)=>{const{mail:s="",postaladdress:n="",phone:i="",fax:a=""}=e,o=String.fromCharCode(2)+String.fromCharCode(2),r=s.split(o),l=n.split(o),d=r.map(((e,t)=>({emailAddress:e,id:String(t),type:""}))),c=l.map(((e,t)=>({postalAddress:e,id:String(t),type:""})));let h=0;const u=[];return i&&u.push({phoneNumber:i,id:String(h++),type:""}),a&&u.push({phoneNumber:a,id:String(h++),type:"work"}),{avatarUrl:"",birthday:0,emailAddresses:d,generatedFromSentMail:!1,id:String(t),name:e.name,note:e.description,phoneNumbers:u,postalAddresses:c,separator:!1,trusted:!0}}))}(s);await fl(t,"MailContacts",i)}(t,i),await async function(e,t,s,n){ls.Z.log("Mail",["import"],"importing messages from",s);let i=0;for(const a of t){const[t,o]=a,r=(0,Us.NQ)(s,"store",t),l=await re.Z.mailPrivate.getFilePaths(r);i+=l.length,l.sort(),ls.Z.log("Mail",["import"],`... found ${l.length} messages to import for account ${o}`),await Nl(r,s,l,(async(t,s,i,a)=>{await kl(e,o,t,n,s,i,a)})),ls.Z.log("Mail",["import"],"... finished importing messages for account",o),await Al({path:r,currentIndex:0})}ls.Z.log("Mail",["import"],"... finished importing",i,"messages"),h.Z.setStatus(e,(0,W.Z)("Finished importing $1 message.","Finished importing $1 messages.",[i]),Nt.QM)}(e,o,s,i)}let Tl=0,El=0;async function kl(e,t,s,n,i,a,o){ls.Z.log("Mail",["import"],`... importing ${o}/${a}`);const r=Date.now(),l={};for(let e=0;e<i.length;e++){const s=i[e],r=await(0,yl.Z)(s);await Pl(t,r,l,s),Il(n,"MailMessages",o+e+1,a,t)}try{await async function(e){for(const t in e)for(const s in e[t]){const{messages:n}=e[t][s];await(0,Us.m6)(t,s,n)}ms.Z.filter(),es.Z.updateThreads()}(l)}catch(e){Dr.Z.addImportError(n,"MailMessages",(0,W.Z)("Failed importing messages. Error: $1",[e.message||e])),ls.Z.error("Mail",["import"],e)}const d=Date.now();Tl+=(d-r)/1e3,El+=i.length;const c=El/Tl;h.Z.setStatus(e,(0,W.Z)("Importing: $1/$2. Batch size: $3. Rate: $4/s",[o,a,i.length,c.toFixed(1)]))}async function Nl(e,t,s,n){const i=os.Z.adjustBatchSize.bind(void 0,25,1e3,500);let a=25;let o=(await rs.Z.importProgress.get(e))?.currentIndex||0;return new Promise(((r,l)=>{!async function d(){const c=s.slice(o,o+a);if(0===c.length)return void r();const h=Date.now();try{await n(t,c,s.length,o),o+=c.length,await Al({path:e,currentIndex:o})}catch(e){return void l(e)}const u=Date.now();a=i(a,u-h),d()}()}))}function _l(e,t,s,n){n[e]||(n[e]={}),n[e][t]||(n[e][t]={messages:[]}),n[e][t].messages.push(s)}async function Pl(e,t,s,n){const i=wl.Z.call(t);let a,o=!1,r=!1;if(i.received){const e=i.received.match(/\bfor\s<(.+@.+\..+)>/);e&&(a=e[1])}if(e&&a&&e===a)o=!0;else if(e){i.from.map((e=>e.address)).includes(e)&&(r=!0);i.to.map((e=>e.address)).includes(e)&&(o=!0);i.cc.map((e=>e.address)).includes(e)&&(o=!0)}const l=i.operaStatus?function(e){const t={mappedFlags:[],otherFlags:[]},s=e.substring(34,42);if(!/^[A-Fa-f0-9]{8}$/.test(s))return console.error("invalid flags hex value"),t;const n=parseInt(s,16);for(let e=0;e<Cl.length;e++){const s=Cl[e],i=n&Math.pow(2,e);i&&s[1]?t.mappedFlags.push(s[1]):i&&t.otherFlags.push(s[0])}return t}(i.operaStatus):{mappedFlags:[],otherFlags:[]};let d;if(i.operaLocation){const e=i.operaLocation.match(/^([^\s:]+):(\d+)$/);e&&(d=e[1],"inbox"===d.toLowerCase()&&(d=Nt.Gf))}else l.otherFlags.includes("is_sent")&&(d=Nt.N1);const c=await(0,vl.Z)(i,l.mappedFlags,t);if(e)(o||!o&&!r)&&(await(0,Us.oN)(e,d||Nt.Gf),await(0,Us.KJ)(e,d||Nt.Gf),_l(e,d||Nt.Gf,c,s)),r&&(await(0,Us.oN)(e,d||Nt.N1),await(0,Us.KJ)(e,d||Nt.N1),_l(e,d||Nt.N1,c,s));else{n.match(/\/store\/drafts\//i)?_l(Nt.of,Nt.Wb,c,s):ls.Z.error("Mail",["import"],"Found no fitting folder for message:",n,i.operaLocation)}}function Ml(e,t){if(!e.aliases)return t;if(!t.aliases){return{...t,aliases:e.aliases}}const s=[...t.aliases];for(const n of e.aliases)t.aliases.find((e=>e.MAIL_EMAIL===n.MAIL_EMAIL))||s.push(n);return{...t,aliases:s}}const Dl=[["read",Nt.T4.SEEN],["replied",Nt.T4.ANSWERED],["marked",void 0],["expunged",Nt.T4.DELETED],["has_re",void 0],["elided",void 0],["unused",void 0],["offline",void 0],["watched",void 0],["sender_authed",void 0],["partial",void 0],["queued",void 0],["forwarded",Nt.T4.FORWARDED],["priorities",void 0]];function Ol(e){const t={mappedFlags:[],otherFlags:[]},s=e;if(!/^[A-Fa-f0-9]{4}$/.test(s))return console.error("invalid flags hex value"),t;const n=parseInt(s,16);for(let e=0;e<Dl.length;e++){const s=Dl[e],i=n&Math.pow(2,e);i&&s[1]?t.mappedFlags.push(s[1]):i&&t.otherFlags.push(s[0])}return t}var jl=s(3664);async function Ll(e){const{path:t}=e;await rs.Z.importProgress.get(t)?await rs.Z.importProgress.update(t,e):await rs.Z.importProgress.add(e)}async function Rl(e){return new Promise((t=>{re.Z.mailPrivate.readFileToText(e,(s=>n.Z.runtime.lastError?(ls.Z.warn("Mail",["import","thunderbird"],`Error reading file ${e}`,n.Z.runtime.lastError),t("")):s?void t(s):(ls.Z.warn("Mail",["import","thunderbird"],`File ${e} is empty`),t(""))))}))}async function Bl(){const e=(await new Promise((e=>{re.Z.importData.getProfiles((t=>{e(t)}))}))).find((e=>"Thunderbird"===e.name));return e?e.detectedProfilePath+"/":""}async function Fl(){const e=await Bl(),t=await async function(e){const t=e+"profiles.ini";return function(e){const t={profile:/^\[(Profile[0-9]+)\]$/,name:/^Name\s*=\s*(.*?)$/,path:/^Path\s*=\s*(.*?)$/,isRelative:/^IsRelative\s*=\s*(0|1)$/,default:/^Default\s*=\s*(0|1)$/},s={},n=e.split(/[\r\n]+/);let i;for(const e of n){const n=e.trim();let a=t.profile.exec(n);a?(i=a[1],s[i]={name:"",path:"",isRelative:!1}):(a=t.name.exec(n),a&&i?s[i].name=a[1]:(a=t.path.exec(n),a&&i?s[i].path=a[1]:(a=t.isRelative.exec(n),a&&i?s[i].isRelative="1"===a[1]:(a=t.default.exec(n),a&&i&&(s[i].default="1"===a[1])))))}return s}(await Rl(t))}(e),s=[];for(const n in t){const i=t[n];s.push({prefsFilePath:e+i.path+"/prefs.js",profilePath:e+i.path})}return s}async function Wl(e){return new Promise((t=>{re.Z.mailPrivate.getFilePaths(e+"/",t)}))}async function Ul(e){return function(e){const t={account:/^user_pref\("mail\.account\.(account[0-9]+)\.(.+)", "(.+)"\);$/,identidy:/^user_pref\("mail\.identity\.(id[0-9]+)\.(.+)", "?([^"]+)"?\);$/,server:/^user_pref\("mail\.server\.(server[0-9]+)\.(.+)", "(.+)"\);$/,smtp:/^user_pref\("mail\.smtpserver\.(smtp[0-9]+)\.(.+)", "(.+)"\);$/},s={},n=e.split(/[\r\n]+/),i=[];for(const e of n){const n=e.trim(),a=t.account.exec(n)||t.identidy.exec(n)||t.server.exec(n)||t.smtp.exec(n);a&&(s[a[1]]=s[a[1]]||{},s[a[1]][a[2]]=a[3],a[1].startsWith("account")&&i.push(a[1]))}const a={serverFolders:{},localFolders:""};for(const e of i){const{server:t,identities:n}=s[e];if(t&&n){let e;if("POP3"===s[t].type.toUpperCase())e=Nt.s9.POP;else{if("IMAP"!==s[t].type.toUpperCase()){ls.Z.warn("Mail",["import","thunderbird"],`Importing accounts of type "${s[t].type}" is not supported`),e=Nt.s9.IMAP;continue}e=Nt.s9.IMAP}const i=n.split(",").map((e=>e.trim())),o=i.filter((e=>"true"===s[e].valid));if(0===o.length){ls.Z.info("Mail",["import","thunderbird"],"No valid accounts found in prefs.js file");continue}const r=o[0],l=s[r].smtpServer,d={MAIL_EMAIL:s[r].useremail,MAIL_NAME:s[r].fullName,MAIL_SERVER:s[t].hostname,MAIL_PORT:e===Nt.s9.IMAP?993:995,MAIL_USER:s[t].userName,MAIL_SMTP_SERVER:l?s[l].hostname:"",MAIL_SMTP_PORT:465,MAIL_SMTP_SOCKET_TYPE:"ssl",MAIL_SMTP_USER:l?s[l].username:"",offline:!0,accountType:e,useOAuth:s[t].hasOwnProperty("oauth2.issuer")&&s[t]["oauth2.issuer"].endsWith(".google.com"),preFetch:"month"};if(s[r].htmlSigText&&(d.signature=s[r].htmlSigText),o.length>1){const e=o.slice(1);for(const t of e){const{useremail:e,fullName:n,htmlSigText:i}=s[t],a={MAIL_EMAIL:e};n&&(a.MAIL_NAME=n),i&&(a.signature=i),d.aliases?d.aliases.push(a):d.aliases=[a]}}const c=s[t].directory;a.serverFolders[c]=d}else t&&(a.localFolders=s[t].directory)}return a}(await Rl(e))}async function Vl(e){const t=e||await Fl(),s=[];for(const e of t){const{serverFolders:t}=await Ul(e.prefsFilePath);for(const n in t)s.push({mailAccount:{...t[n],MAIL_PASSWORD:"",MAIL_SMTP_PASSWORD:""},profilePath:e.profilePath})}return s}function Hl(e){const t=[];for(const s of e)/\.(?:html|msf|dat)$/.test(s)||t.push(s);return t}function Gl(e){let t="";const s=e.match(/[\\\/]([^\\\/]+)$/);if(s)return t=s[1],/inbox-[0-9]+/i.test(t)&&(t=t.slice(0,"inbox".length)),/sent-[0-9]+/i.test(t)&&(t=t.slice(0,"sent".length)),/outbox-[0-9]+/i.test(t)&&(t=t.slice(0,"outbox".length)),/trash-[0-9]+/i.test(t)&&(t=t.slice(0,"trash".length)),/junk-[0-9]+/i.test(t)&&(t=t.slice(0,"junk".length)),/spam-[0-9]+/i.test(t)&&(t=t.slice(0,"spam".length)),/drafts-[0-9]+/i.test(t)&&(t=t.slice(0,"drafts".length)),/archive-[0-9]+/i.test(t)&&(t=t.slice(0,"archive".length)),t;ls.Z.warn("Mail",["import","thunderbird"],`No mbox file found in path ${e}`)}async function Kl(e,t){return new Promise((s=>{re.Z.importData.openThunderbirdMailbox(e,String(t),(e=>{s(Number(e))}))}))}async function zl(e,t){wt.Z.isMailOn()||(ls.Z.log("Mail",["import","thunderbird"],"Mail is turned off - turning it on for importing from Thunderbird"),wt.Z.ensureMailIsOn(),en.Z.showContent(e,"PanelMail"));const s=await Fl();await async function(e,t){const s=(await Vl(e)).map((e=>e.mailAccount)),n=A.Z.get(Z.kMailAccounts),i=s.filter((e=>t.find((t=>t.accountId===e.MAIL_EMAIL&&t.accountType===e.accountType))));for(const e of n){const t=i.find((t=>t.MAIL_EMAIL===e.MAIL_EMAIL));if(t)try{(0,xl.ZP)(Ml(t,e))}catch(s){Dr.Z.addImportError("Thunderbird","MailAccounts",(0,W.Z)("Failed updating account $1",[e.MAIL_EMAIL])),ls.Z.error("Mail",["import","thunderbird"],`Failed adding alias from ${JSON.stringify(t)}`)}}const a=i.filter((e=>!n.find((t=>t.MAIL_EMAIL===e.MAIL_EMAIL))));for(let e=0;e<a.length;e++){let t=a[e];if(t.accountType===Nt.s9.IMAP){const e=a.find((e=>e.MAIL_EMAIL===t.MAIL_EMAIL&&e.accountType===Nt.s9.POP));if(e)try{t=Ml(e,t)}catch(s){Dr.Z.addImportError("Thunderbird","MailAccounts",(0,W.Z)("Failed updating account $1",[t.MAIL_EMAIL])),ls.Z.error("Mail",["import","thunderbird"],`Failed adding alias from ${JSON.stringify(e)}`)}}else if(t.accountType===Nt.s9.POP&&a.find((e=>e.MAIL_EMAIL===t.MAIL_EMAIL&&e.accountType===Nt.s9.IMAP)))continue;try{const e=(0,Us.Gb)();await es.Z.addAccount(t),(0,xl.ZP)(t),await e,ls.Z.log("Mail",["import","thunderbird"],"... imported account",t.MAIL_EMAIL),Dr.Z.setImportProgress("Thunderbird","MailAccounts",1,1,t.MAIL_EMAIL)}catch(e){Dr.Z.addImportError("Thunderbird","MailAccounts",(0,W.Z)("Failed importing account $1",[t.MAIL_EMAIL])),ls.Z.error("Mail",["import","thunderbird"],`Failed importing account ${JSON.stringify(t)}`)}}}(s,t);const n=[];for(const e of s){const{serverFolders:s,localFolders:i}=await Ul(e.prefsFilePath);for(const e in s){ls.Z.log("Mail",["import","thunderbird"],"messageFolder",e);const i=s[e].MAIL_EMAIL;if(!t.find((e=>e.accountId===i)))continue;const a=await Wl(e),o=Hl(a);0===o.length&&ls.Z.log("Mail",["import","thunderbird"],"No thunderbird mbox files found in",a);for(const e of o){let t=Gl(e);if(t){const s=e.match(/[\\\/]([^\\\/]+)\.sbd[\\\/]/);s&&(t=s[1]+"/"+t),n.push({filePath:e,accountId:i,path:t})}}}if(i){const e=await Wl(i);0===e.length&&ls.Z.log("Mail",["import","thunderbird"],"No thunderbird mbox files found in",e);const t=Hl(e);for(const e of t){let t=Gl(e);t&&("Unsent Messages"===t&&(t=Nt.J8),n.push({filePath:e,accountId:Nt.of,path:t}))}}}for(const t of n){const{filePath:s,accountId:n}=t;let i=t.path;"inbox"===i.toLowerCase()&&(i=Nt.Gf);const a=(await rs.Z.importProgress.get(s))?.seekPosition||0,o=await Kl(s,a);if(o<-1&&ls.Z.warn("Mail",["import","thunderbird"],`filesize overflow for ${s}`),0===a)try{if(!await(0,Us.tP)()){ls.Z.warn("Mail",["import","thunderbird"],`File does not contain messages ${s}`),re.Z.importData.closeThunderbirdMailbox();continue}await Kl(s,a)}catch(e){ls.Z.warn("Mail",["import","thunderbird"],`Error on checking file validity ${s}. Error: ${e}`),re.Z.importData.closeThunderbirdMailbox();continue}n!==Nt.of&&(await(0,Us.oN)(n,i),await(0,Us.KJ)(n,i)),Dr.Z.setImportProgress("Thunderbird","MailMessages",0,-1,n+"/"+i),await $l(e,s,n,i,a,o),await Ll({path:s,seekPosition:0}),re.Z.importData.closeThunderbirdMailbox()}}async function $l(e,t,s,n,i,a){async function o(){const e=await(0,Us.tP)();if(!e)return void(i=-1);const{message:s,seekPosition:n}=e;if(i>-1&&-1===n&&await Ll({path:t,seekPosition:i}),i=n,s.length>0){return(0,jl.sy)(s)}}async function r(a,o,r,l){-1===r&&(r=l),await async function(e,t,s){const n=[];for(const t of e){const e=wl.Z.call(t),s=e.mozillaStatus?Ol(e.mozillaStatus):{mappedFlags:[],otherFlags:[]},i=await(0,vl.Z)(e,s.mappedFlags,t);n.push(i)}await(0,Us.m6)(t,s,n)}(a,s,n);const d=Math.floor(r/1048576),c=Math.floor(l/1048576);h.Z.setStatus(e,`${s}/${n}: ${d}/${c} MB (${o} messages)`,5e3),Dr.Z.setImportProgress("Thunderbird","MailMessages",d,c,s+"/"+n),i>-1&&await Ll({path:t,seekPosition:i})}try{let e,l=[],d=0,c=40,h=Date.now();const u=new os.Z.BatchSizeOptimizer(c,1e3);do{if(e=await o(),e){if(l.push(e),l.length===c){d+=c,await r(l,d,i,a),l=[];const e=Date.now();c=u.optimize(c,e-h),h=Date.now()}}else{if(i>-1&&0===d){ls.Z.warn("Mail",["import","thunderbird"],"File is not an mbox file",t,i);break}i>-1&&ls.Z.warn("Mail",["import","thunderbird"],"Got an empty message",t,i)}}while(i>-1);l.length>0&&(d+=l.length,await r(l,d,i,a)),0===d&&Dr.Z.setImportProgress("Thunderbird","MailMessages",0,0,s+"/"+n)}catch(e){ls.Z.error("Mail",["import","thunderbird"],e),Dr.Z.addImportError("Thunderbird","MailMessages",(0,W.Z)("Failed importing messages. Error: $1",[e.message||e]))}}var Yl=(0,zn.jsx)("br",{}),Xl=(0,zn.jsx)("br",{});class Ql extends Un.PureComponent{static contextType=oi.Z;#v=!1;refUserProfile=Un.createRef();constructor(e){super(e),this.state={importOptions:JSON.parse(JSON.stringify(e.profile)),selectedProfile:"",selectedProfileIndex:0,masterPassword:"",importItemStatus:(0,qe.aV)(),accountSelection:[],selectedFolder:"",selectedFile:""}}componentDidMount(){this.#v=!0,re.Z.importData.onImportItemStarted.addListener(this.onImportItemStarted),re.Z.importData.onImportItemEnded.addListener(this.onImportItemEnded),re.Z.importData.onImportItemFailed.addListener(this.onImportItemFailed),this.offerAccountSelection(this.props.profile.mailPath),this.props.setStartImport(this.startImport),this.props.setChooseFile(this.chooseFile),this.props.setSelectProfileFolder(this.selectProfileFolder)}componentWillUnmount(){this.#v=!1,re.Z.importData.onImportItemStarted.removeListener(this.onImportItemStarted),re.Z.importData.onImportItemEnded.removeListener(this.onImportItemEnded),re.Z.importData.onImportItemFailed.removeListener(this.onImportItemFailed)}componentDidUpdate(e){e.profile!==this.props.profile&&this.setState({importOptions:JSON.parse(JSON.stringify(this.props.profile))},(()=>{this.offerAccountSelection(this.props.profile.mailPath||(0,Us.NQ)(this.state.selectedFolder,"mail"))}))}async offerAccountSelection(e){if(this.props.profile.email||this.props.profile.contacts){const t=(e,t)=>e.MAIL_EMAIL>t.MAIL_EMAIL?1:-1;if("Thunderbird"===this.props.profile.name){const e=(await Vl()).sort(((e,t)=>e.mailAccount.MAIL_EMAIL>t.mailAccount.MAIL_EMAIL?1:-1)).map((e=>({accountId:e.mailAccount.MAIL_EMAIL,accountType:e.mailAccount.accountType,selected:!0,profilePath:e.profilePath})));this.#v&&this.setState({accountSelection:e,selectedProfile:[...new Set(e.map((({profilePath:e})=>e)))].join(";")})}else/^[OÓ]pera/i.test(this.props.profile.name)?Sl(e).then((e=>{const s=e.sort(t).filter((e=>e.MAIL_EMAIL&&[Nt.s9.IMAP,Nt.s9.POP].includes(e.accountType)));0===s.length?this._changeSelection("email"):this._setSelection("email",!0);const n=s.map((e=>({accountId:e.MAIL_EMAIL,accountType:e.accountType,selected:!0,profilePath:""})));this.#v&&this.setState({accountSelection:n})})):ls.Z.warn("Mail",["import"],"Mail import not supported from profile",this.props.profile.name)}}onImportItemStarted=e=>{Dr.Z.setImportProgress(this.props.profile.name,e,0,1),this.setItemState(e,"IMPORT_STARTED"),this.props.onImportStarted()};onImportItemEnded=e=>{Dr.Z.setImportProgress(this.props.profile.name,e,1,1),this.setItemState(e,"IMPORT_COMPLETED")};onImportItemFailed=(e,t)=>{Dr.Z.addImportError(this.props.profile.name,e,t),this.setItemState(e,"IMPORT_FAILED",t)};setItemState(e,t,s){this.#v&&this.setState((n=>{let i=n.importItemStatus;const a=i.filter((t=>t.itemName===e)).first(),o={itemName:e,state:t,errorMsg:s};return i=a?i.map((t=>t.itemName===e?"IMPORT_FAILED"===t.state?t:{...o}:t)):i.push(o),{importItemStatus:i}}))}startImport=async()=>{if(gl.isImportTypeInProgress(this.props.profile.name))return void(0,H.c)({title:(0,W.Z)("Import for this profile is currently running"),tag:"VIVALDI_IMPORT_CURRENTLY_RUNNING"});const e=this.state.importOptions,t=e.history,s=e.favorites,n=e.passwords,i=e.notes,a=e.speeddial,o=e.email,r=e.contacts,l=e.extensions,d=e.tabs,c=""===this.state.selectedProfile?this.refUserProfile?.current?.value??"":this.state.selectedProfile,h=""===this.state.selectedProfile?this.props.profile.index:this.state.selectedProfileIndex,u={history:t,favorites:s,passwords:n,notes:i,speeddial:a,extensions:l,tabs:d};let p=e.detectedProfilePath,g=e.mailPath;e.hasDefaultInstall||(p=this.state.selectedFolder||this.state.selectedFile,g=(0,Us.NQ)(p,"mail")),p?(p.endsWith("operaprefs.ini")&&(p=p.substring(0,p.indexOf("operaprefs.ini"))),re.Z.importData.startImport(h,e.hasDefaultInstall,c,u,this.state.masterPassword,p,(()=>{if(o){const t=this.state.accountSelection.filter((e=>e.selected));if(this.setItemState("email","IMPORT_STARTED"),/^[OÓ]pera/.test(e.name))Zl(this.context.vivaldiWindowId,p,g,this.props.profile.name,t).then((()=>{this.setItemState("email","IMPORT_COMPLETED")}));else{if("Thunderbird"!==e.name)throw new Error("Unsupported mail client");zl(this.context.vivaldiWindowId,t).then((()=>{this.setItemState("email","IMPORT_COMPLETED")}))}}r&&async function(e,t){const s=(await re.Z.contacts.readThunderbirdContacts(t)).map((e=>{const t=e.emailAddresses.map((e=>{const{favorite:t,...s}=e;return{...s,emailAddress:s.emailAddress??"",isDefault:!1,type:s.type??""}})),s=e.postalAddresses.map((e=>({...e,postalAddress:e.postalAddress??"",type:e.type??""}))),n=e.phoneNumbers.map((e=>({...e,phoneNumber:e.phoneNumber??"",type:e.type??""})));return{...e,name:e.name??"",emailAddresses:t,postalAddresses:s,phoneNumbers:n}}));await fl(e,(0,W.Z)("Thunderbird Contacts"),s)}(p,c)}))):(0,H.c)({title:(0,W.Z)("Import source not specified!"),tag:"VIVALDI_IMPORT_SOURCE_NOT_SPECIFIED"})};openFolder=async()=>new Promise(((e,t)=>{this.context.chrome.fileSystem.chooseEntry({type:"openDirectory"},(s=>{n.Z.runtime.lastError||!s?t(n.Z.runtime.lastError||"Cancelled opening folder"):e(s)}))}));chooseFile=async()=>{const e=await async function(e,t){const{chrome:s}=e;return new Promise(((e,n)=>{s.fileSystem.chooseEntry({type:"openFile",accepts:[{mimeTypes:["text/*"],extensions:t,description:(0,W.Z)("files of type $1",[t.join(", ")])}]},(t=>{s.runtime.lastError||!t?n(s.runtime.lastError||"Cancelled opening file"):e(t)}))}))}(this.context,["html"]),t=await re.Z.mailPrivate.getFullPath(e.filesystem.name,e.fullPath);this.setState({selectedFile:t},this.startImport)};chooseFolder=async()=>{const e=await this.openFolder(),t=await re.Z.mailPrivate.getFullPath(e.filesystem.name,e.fullPath);this.setState({selectedFolder:t},(()=>this.offerAccountSelection((0,Us.NQ)(t,"mail"))))};selectProfileFolder=async()=>{const e=this.props.profile;re.Z.utilities.selectFile({windowId:this.context.vivaldiWindowId,title:(0,W.Z)("Select $1 Folder",[e.name]),type:"folder",defaultPath:e.suggestedProfilePath}).then((t=>{t&&this.setState({selectedFolder:t},(()=>{e.requiresAccessPermission?this.props.refreshProfileList():this.startImport()}))}))};updateDetectedProfilePath=()=>{const e=this.props.profile;re.Z.utilities.selectFile({windowId:this.context.vivaldiWindowId,title:(0,W.Z)("Select $1 Folder",[e.name]),type:"folder",defaultPath:e.detectedProfilePath}).then((e=>{e&&this.setState((t=>{const s={...t.importOptions};return s.detectedProfilePath=e,{importOptions:s}}))}))};handlePasswordChange=e=>{const{HTMLInputElement:t}=this.context;e.target instanceof t&&this.setState({masterPassword:e.target.value.toString()})};handleUserProfileChange=e=>{const{HTMLSelectElement:t}=this.context;if(e.target instanceof t){const t=e.target.value,s=this.props.profile.UserProfiles.find((e=>e.profileName===t)),n=s?.profilePath,i=s?.index;this.setState((e=>{const s={...e.importOptions};return n&&(s.detectedProfilePath=n),{importOptions:s,selectedProfile:t,selectedProfileIndex:i||e.selectedProfileIndex}}))}};_changeSelection(e){this.setState((t=>{const s={...t.importOptions},n=t.accountSelection.slice();if("email"===e){const t=n.filter((e=>e.selected));s[e]||0!==t.length?s[e]&&n.forEach((e=>e.selected=!1)):s.detectedProfilePath||s.mailPath?n.forEach((e=>e.selected=!0)):this.chooseFolder()}return s[e]=!s[e],{accountSelection:n,importOptions:s}}))}_setSelection(e,t){this.setState((s=>{const n={...s.importOptions};return n[e]=t,{importOptions:n}}))}_getImportItemMarkup(e,t,s,n,i){return(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("div",{className:"import-setting",children:[(0,zn.jsx)("input",{id:t,type:"checkbox",checked:n,onChange:()=>this._changeSelection(e),disabled:i}),(0,zn.jsx)("label",{htmlFor:t,children:s})]})})}_onAccountSelection=e=>{this.setState((t=>{const s={...t.importOptions},n=t.accountSelection.filter((e=>e.selected));return 1===n.length&&!0===e.selected?s.email=!1:0===n.length&&!1===e.selected&&(s.email=!0),{importOptions:s,accountSelection:t.accountSelection.map((t=>(t.accountId===e.accountId&&t.accountType===e.accountType&&(t.selected=!t.selected),t)))}}))};render(){const e=this.props.profile,t=this.state.importOptions;if(t&&e){const s=Boolean(!(t.passwords||t.history||t.notes||t.speeddial||t.email||t.contacts||t.extensions||t.tabs));let n;return e.UserProfiles&&e.UserProfiles.length>0&&(n=e.UserProfiles.map((e=>(0,zn.jsx)("option",{value:e.profileName,children:e.profileDisplayName},e.profileName)))),(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("fieldset",{children:[n&&(0,zn.jsxs)("div",{className:"profile",children:[(0,zn.jsx)("label",{htmlFor:"userProfile",children:(0,W.Z)("User Profile")}),(0,zn.jsx)(Fa.Z,{ref:this.refUserProfile,id:"userProfile",onChange:this.handleUserProfileChange,value:this.state.selectedProfile,children:n})]}),!s&&e.favorites&&this._getImportItemMarkup("favorites","f-favorites",(0,W.Z)("Bookmarks"),!!t&&t.favorites,!1),e.passwords&&this._getImportItemMarkup("passwords","f-passwords",(0,W.Z)("Passwords"),!!t&&t.passwords,!1),e.supportsMasterPassword&&(0,zn.jsxs)("div",{className:"setting-single import-masterpassword",children:[(0,zn.jsx)("label",{htmlFor:"f-masterpassword",children:(0,W.Z)("Master password, if needed:")}),(0,zn.jsx)("input",{id:"f_masterpassword",type:"password",onChange:this.handlePasswordChange})]}),e.history&&this._getImportItemMarkup("history","f-history",(0,W.Z)("History"),!!t&&t.history,!1),e.notes&&this._getImportItemMarkup("notes","f-notes",(0,W.Z)("Notes"),!!t&&t.notes,!1),e.speeddial&&this._getImportItemMarkup("speeddial","f-speeddial",(0,W.Z)("Speed Dial"),!!t&&t.speeddial,!1),e.email&&this._getImportItemMarkup("email","f-email",(0,W.Z)("Mail"),!!t&&t.email,!1),e.email&&(0,zn.jsx)("div",{className:"import-mail-account",children:this.state.accountSelection.map((e=>{const{accountId:t,accountType:s,selected:n}=e;return(0,zn.jsxs)("div",{className:"imported-email",children:[(0,zn.jsx)("input",{id:t+s,type:"checkbox",checked:n,onChange:()=>this._onAccountSelection(e)}),(0,zn.jsxs)("label",{htmlFor:t+s,children:[t," ",s]})]},t+s)}))}),e.contacts&&this._getImportItemMarkup("contacts","f-contacts",(0,W.Z)("Contacts"),!!t&&t.contacts,!1),e.extensions&&this._getImportItemMarkup("extensions","f-extensions",(0,W.Z)("Extensions"),!!t&&t.extensions,!1),e.tabs&&this._getImportItemMarkup("tabs","f-tabs",(0,W.Z)("Open Tabs"),!!t&&t.tabs,!1)]}),e.hasDefaultInstall&&t.detectedProfilePath.length>0&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("div",{className:"import-pathname",children:[(0,W.Z)("Detected Profile Path:"),Yl,(0,zn.jsx)("input",{type:"text",value:t.detectedProfilePath,readOnly:!0})]}),(0,zn.jsx)("div",{children:(0,zn.jsx)("input",{type:"button",className:"primary",onClick:this.updateDetectedProfilePath,value:(0,W.Z)("Choose a Different Profile...")})})]}),e.requiresInteractiveImport&&"folder"===e.dialogType&&(0,zn.jsxs)("div",{className:"import-pathname",children:[e.requiresAccessPermission&&(0,zn.jsxs)(zn.Fragment,{children:[(0,W.Z)("Vivaldi needs your permission to read the $1 folder.",[e.name]),Xl]}),(0,W.Z)("Select the $1 folder to begin import.",[e.name])]}),e.requiresInteractiveImport&&"file"===e.dialogType&&s&&(0,zn.jsx)(zn.Fragment,{children:(0,zn.jsxs)("div",{className:"import-pathname",children:[(0,W.Z)("To import your bookmarks, please follow these steps:"),(0,zn.jsxs)("ol",{children:[(0,zn.jsx)("li",{children:(0,W.Z)("Open the source application.")}),(0,zn.jsx)("li",{children:(0,W.Z)("Use the application menu to export Bookmarks to file. Save the file to someplace easy to find (e.g., Documents).")}),(0,zn.jsx)("li",{children:(0,W.Z)("Import bookmarks from the resulting file using the button below.")})]})]})})]})}return null}}const ql=Ql;function Jl(e){return e.map((function(e){return"string"==typeof e?e:Array.isArray(e)?`[${Jl(e).join(", ")}]`:e instanceof Error?`Error: ${e.message}`:"object"==typeof e?JSON.stringify(e):String(e)}))}function ed(e){switch(e.toLowerCase()){case"calendar":return{translated:!0,text:(0,W.Z)("Calendar")};case"feeds":return{translated:!0,text:(0,W.Z)("Feeds")};default:return{translated:!1,text:e}}}function td(e){switch(e.toLowerCase()){case"file":return{translated:!0,text:(0,W.Z)("storage","File")};case"history":return{translated:!0,text:(0,W.Z)("History")};case"favorites":return{translated:!0,text:(0,W.Z)("Favorites")};case"passwords":return{translated:!0,text:(0,W.Z)("Passwords")};case"mailaccounts":return{translated:!0,text:(0,W.Z)("Mail Accounts")};case"mailmessages":return{translated:!0,text:(0,W.Z)("Mail Messages")};case"extensions":return{translated:!0,text:(0,W.Z)("Extensions")};case"tabs":return{translated:!0,text:(0,W.Z)("Open Tabs")};default:return{translated:!1,text:e}}}class sd extends Un.PureComponent{#v=!1;constructor(e){super(e),this.state={progress:gl.getImportProgress()}}componentDidMount(){this.#v=!0,gl.addListener(this.onProgress)}componentWillUnmount(){this.#v=!1,gl.removeListener(this.onProgress)}onProgress=(0,Te.Z)((()=>{this.#v&&this.setState({progress:gl.getImportProgress()})}),300,{leading:!0});_getImportItemStatus(e){return e.errors?(0,zn.jsx)("div",{className:"import-result",children:(0,zn.jsx)(fa,{type:"error",children:Jl(e.errors)})}):!e.children&&-1!==e.total&&e.current>=e.total?(0,zn.jsx)("div",{className:"import-result",children:(0,zn.jsxs)("div",{className:e.warnings?"import-warning":"import-success",title:e.warnings,children:[(0,zn.jsx)("span",{className:"status-icon",dangerouslySetInnerHTML:{__html:s(75124)}}),(0,W.Z)("other","Done")]})}):!e.children&&(e.total>=1||-1===e.total)?(0,zn.jsx)("div",{className:"import-result numbers",children:(0,zn.jsx)("div",{className:e.warnings?"import-warning":"import-success",title:e.warnings,children:e.total>1?e.current+"/"+e.total:""})}):void 0}renderItem=(e,t)=>{const{translated:s,text:n}=td(e);return(0,zn.jsxs)("div",{className:Gn()("setting-single import-status-table",{capitalized:s}),children:[(0,zn.jsx)("span",{children:n}),this._getImportItemStatus(t)]},e)};renderIndentedItem=(e,t)=>{const{translated:s,text:n}=td(e);return(0,zn.jsxs)("div",{className:Gn()("setting-single import-mail-account imported-email import-status-table",{capitalized:s}),children:[(0,zn.jsx)("span",{children:n}),this._getImportItemStatus(t)]},e)};renderItems=e=>{const t=[];t.push((0,zn.jsx)("header",{children:(0,zn.jsx)("h4",{className:"dialog-title",children:ed(e).text})},e));for(const s in this.state.progress[e]){const n=this.state.progress[e][s];if(t.push(this.renderItem(s,n)),n.children)for(const e in n.children){const s=n.children[e];t.push(this.renderIndentedItem(e,s))}}return t};renderTypes=e=>{const t=[];for(const s of e)t.push((0,zn.jsx)("div",{className:"import-data",children:(0,zn.jsx)("div",{className:"imported-data",children:this.renderItems(s)})},s));return t};numImportsToReport=()=>Object.keys(this.state.progress).length;render(){const e=this.numImportsToReport(),t=Object.keys(this.state.progress);return 0===e?null:(0,zn.jsx)("div",{className:"import-container",children:this.renderTypes(t)})}}const nd=sd;var id=s(21343);class ad extends Un.PureComponent{static contextType=oi.Z;componentDidMount(){this.props.setRunImporter(this.chooseFile)}chooseFile=()=>{const e=this.context.vivaldiWindowId;return(0,id.l_)(e)};render(){return(0,zn.jsx)("div",{className:"import-readinglist",children:(0,zn.jsx)("p",{children:(0,W.Z)("Import a reading list from a comma-separated values file (.csv).")})})}}const od=ad;var rd=(0,zn.jsx)("div",{className:"import-data",children:(0,zn.jsx)(nd,{})});class ld extends Un.PureComponent{static contextType=oi.Z;#v=!1;constructor(e){super(e),this.state={offerings:{profiles:[]},selectedIndex:0,selectedPane:A.Z.get(Z.kMailImportSelectedPane),numImportsInStore:0,startImport:()=>{},runImporter:()=>Promise.resolve(),chooseFile:()=>Promise.resolve(),chooseFiles:()=>Promise.resolve(),selectProfileFolder:()=>Promise.resolve(),isReadyToStart:!1}}componentDidMount(){this.#v=!0,this.refreshProfileList(),gl.addListener(this.onProgress)}refreshProfileList=()=>{re.Z.runtimePrivate.getUserProfiles((e=>{this.refreshProfileListWithIgnorePaths(e.map((e=>e.path)))}))};refreshProfileListWithIgnorePaths=e=>{re.Z.importData.getProfiles((t=>{if(this.#v){const s=gl.numImportsInStore(),n=t.filter((t=>!(t.detectedProfilePath&&e.some((e=>e.startsWith(t.detectedProfilePath))))));this.setState((e=>({offerings:{...e.offerings,profiles:n},numImportsInStore:s,selectedPane:0===s?"import":e.selectedPane})))}}))};clearFinishedImports=()=>{const e=gl.getImportProgress();for(const t of Object.keys(e))for(const s of Object.keys(e[t])){const n=e[t][s];n.current===n.total&&Dr.Z.clearImportProgress(t,s)}};getProfileName=()=>this.state.selectedIndex<this.state.offerings.profiles.length?this.state.offerings.profiles[this.state.selectedIndex].name:"Feeds";componentWillUnmount(){this.#v=!1,this.clearFinishedImports(),gl.removeListener(this.onProgress)}onImportItemStarted=e=>{Dr.Z.setImportProgress(this.getProfileName(),e,0,1)};onImportItemEnded=e=>{Dr.Z.setImportProgress(this.getProfileName(),e,1,1),"extensions"===e&&c.ZP.openURL(this.context.vivaldiWindowId,vs.xy.extensions,{inBackground:!0,singleton:!0})};onImportItemFailed=(e,t)=>{Dr.Z.addImportError(this.getProfileName(),e,t)};onImportStarted=()=>{re.Z.importData.onImportItemStarted.addListener(this.onImportItemStarted),re.Z.importData.onImportItemEnded.addListener(this.onImportItemEnded),re.Z.importData.onImportItemFailed.addListener(this.onImportItemFailed),re.Z.importData.onImportEnded.addListener(this.onImportEnded),re.Z.importData.onImportStarted.removeListener(this.onImportStarted),this.setState({selectedPane:"status",numImportsInStore:gl.numImportsInStore()})};onImportEnded=e=>{re.Z.importData.onImportItemStarted.removeListener(this.onImportItemStarted),re.Z.importData.onImportItemEnded.removeListener(this.onImportItemEnded),re.Z.importData.onImportItemFailed.removeListener(this.onImportItemFailed),re.Z.importData.onImportEnded.removeListener(this.onImportEnded),this.setState({numImportsInStore:gl.numImportsInStore()})};onProgress=()=>{const e=gl.numImportsInStore();e!==this.state.numImportsInStore&&this.setState({numImportsInStore:e})};handleSelectionChange(e){const{HTMLSelectElement:t}=this.context;if(e.target instanceof t){const t=parseInt(e.target.value,10);this.setState({selectedIndex:t,isReadyToStart:!1})}}setStartImport=e=>{this.#v&&this.setState({startImport:()=>{e().then((()=>{this.onImportStarted()}))}})};setRunImporter=e=>{this.setState({runImporter:()=>e().then((()=>{this.setState({selectedPane:"status"})}))})};setChooseFile=e=>{this.#v&&this.setState({chooseFile:e})};newImport=()=>{this.clearFinishedImports(),this._selectPane("import")};setChooseFiles=e=>{this.#v&&this.setState({chooseFiles:e})};setSelectProfileFolder=e=>{this.#v&&this.setState({selectProfileFolder:e})};readyToStart=e=>{this.setState({isReadyToStart:e})};renderImportFooter(){const{selectedIndex:e}=this.state,t=e<this.state.offerings.profiles.length?this.state.offerings.profiles[e]:void 0,s=e===this.state.offerings.profiles.length+5,n=e===this.state.offerings.profiles.length+1,i=e===this.state.offerings.profiles.length+3,a=e===this.state.offerings.profiles.length,o=t?.hasDefaultInstall,r=i,l=!(n||r||t&&"file"!==t.dialogType),d=a?this.state.runImporter:this.state.chooseFile,c=t&&"folder"===t.dialogType,h=t?t.name:"Profile";return n?(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"button",className:"primary",onClick:this.state.runImporter,value:(0,W.Z)("Choose a Notes Folder...")}),(0,zn.jsx)("input",{type:"button",onClick:this.props.onClose,value:(0,W.Z)("Cancel")})]}):o||this.state.isReadyToStart||s?(0,zn.jsxs)("footer",{className:"dialog-footer",children:[s&&!this.state.isReadyToStart?(0,zn.jsx)("input",{type:"button",className:"primary",onClick:this.state.chooseFiles,value:(0,W.Z)("Choose One or More Files...")}):(0,zn.jsx)("input",{type:"button",className:"primary",onClick:this.state.startImport,value:(0,W.Z)("Start Import"),disabled:s&&!this.state.isReadyToStart}),(0,zn.jsx)("input",{type:"button",onClick:this.props.onClose,value:(0,W.Z)("Close")})]}):l?(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"button",className:"primary",onClick:d,value:(0,W.Z)("Choose a File...")}),(0,zn.jsx)("input",{type:"button",onClick:this.props.onClose,value:(0,W.Z)("Cancel")})]}):r?(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"button",className:"primary",onClick:this.state.chooseFiles,value:(0,W.Z)("Choose One or More Files...")}),(0,zn.jsx)("input",{type:"button",onClick:this.props.onClose,value:(0,W.Z)("Cancel")})]}):c?(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"button",className:"primary",onClick:this.state.selectProfileFolder,value:(0,W.Z)("Select $1 Folder",[h])}),(0,zn.jsx)("input",{type:"button",onClick:this.props.onClose,value:(0,W.Z)("Cancel")})]}):null}renderStatusFooter(){return(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"button",className:"primary",onClick:this.props.onClose,value:(0,W.Z)("Close")}),(0,zn.jsx)("input",{type:"button",onClick:this.newImport,value:(0,W.Z)("New Import...")})]})}_selectPane(e){I.Z.set(Z.kMailImportSelectedPane,e),this.setState({selectedPane:e})}render(){const e=this.state.offerings.profiles.map(((e,t)=>(0,zn.jsx)("option",{value:t,children:e.name},t)));let t=this.state.offerings.profiles.length;if(e.push((0,zn.jsx)("option",{value:t++,children:(0,W.Z)("Reading List (CSV)")},"readinglist-import")),e.push((0,zn.jsx)("option",{value:t++,children:(0,W.Z)("Notes Folder")},"notes-import")),e.push((0,zn.jsx)("option",{value:t++,children:(0,W.Z)("Feeds (OPML file)")},"opml-import")),wt.Z.isMailOn()){const s=A.Z.get(Z.kMailAccounts);e.push((0,zn.jsx)("option",{value:t++,disabled:!s||0===s.length,children:(0,W.Z)("Mail files")},"mail-file-import")),e.push((0,zn.jsx)("option",{value:t++,children:(0,W.Z)("Calendar Events (ICS file)")},"calendar-import")),e.push((0,zn.jsx)("option",{value:t++,children:(0,W.Z)("Calendar Events from Remote Server (iCal)")},"calendar-import-web"))}const{numImportsInStore:s}=this.state,n=0===s?(0,W.Z)("Import Status"):(0,W.Z)("Import Status ($1)",[s]);return(0,zn.jsxs)(Ha.Z,{onRequestClose:this.props.onClose,className:"import-data-dialog slide",title:(0,W.Z)("title","Imports"),children:[(0,zn.jsxs)("div",{className:"dialog-content",children:[(0,zn.jsx)("div",{className:"toolbar toolbar-default import",children:(0,zn.jsxs)("div",{className:"toolbar-group equal-width",children:[(0,zn.jsx)(oa.ZP,{title:(0,W.Z)("Import"),isPressed:"import"===this.state.selectedPane,onClick:()=>this._selectPane("import")}),(0,zn.jsx)(oa.ZP,{title:n,isPressed:"status"===this.state.selectedPane,onClick:()=>this._selectPane("status"),disabled:0===this.state.numImportsInStore})]})}),"import"===this.state.selectedPane&&(0,zn.jsxs)("div",{className:"import-data",children:[(0,zn.jsxs)("fieldset",{children:[(0,zn.jsx)("label",{htmlFor:"browserSel",className:"from",children:(0,W.Z)("import","From")}),(0,zn.jsx)(Fa.Z,{id:"browserSel",onChange:e=>this.handleSelectionChange(e),value:this.state.selectedIndex,autoFocus:!0,children:e})]}),this.state.selectedIndex<this.state.offerings.profiles.length&&(0,zn.jsx)(ql,{profile:this.state.offerings.profiles[this.state.selectedIndex],setStartImport:this.setStartImport,setChooseFile:this.setChooseFile,setSelectProfileFolder:this.setSelectProfileFolder,onImportStarted:this.onImportStarted,refreshProfileList:this.refreshProfileList}),this.state.selectedIndex===this.state.offerings.profiles.length&&(0,zn.jsx)(od,{setRunImporter:this.setRunImporter}),this.state.selectedIndex===this.state.offerings.profiles.length+1&&(0,zn.jsx)(il,{setRunImporter:this.setRunImporter}),this.state.selectedIndex===this.state.offerings.profiles.length+2&&(0,zn.jsx)(hl,{setStartImport:this.setStartImport,setChooseFile:this.setChooseFile,onClose:this.props.onClose}),this.state.selectedIndex===this.state.offerings.profiles.length+3&&(0,zn.jsx)(tl,{setStartImport:this.setStartImport,setChooseFiles:this.setChooseFiles,readyToStart:this.readyToStart}),this.state.selectedIndex===this.state.offerings.profiles.length+4&&(0,zn.jsx)(Ur,{setStartImport:this.setStartImport,setChooseFile:this.setChooseFile,readyToStart:this.readyToStart}),this.state.selectedIndex===this.state.offerings.profiles.length+5&&(0,zn.jsx)(Yr,{setStartImport:this.setStartImport,readyToStart:this.readyToStart})]}),"status"===this.state.selectedPane&&rd]}),"import"===this.state.selectedPane?this.renderImportFooter():this.renderStatusFooter()]})}}const dd=ld;var cd=s(10679);const hd={width:400,minWidth:"unset"};class ud extends Un.Component{refPromptInput=Un.createRef();refOkButton=Un.createRef();_pendingAction=!0;state={promptValue:this.props.customData.defaultPromptText};handleLoadStart=e=>{e.isTopLevel&&this.onCancel()};componentDidMount(){re.Z.utilities.onDialogCanceled.addListener(this._handleDialogCanceled),this.props.customData.webview.addEventListener("loadstart",this.handleLoadStart),"prompt"!==this.props.customData.messageType?(0,cd.Z)((()=>this.refOkButton.current?.focus()),80):(0,cd.Z)((()=>this.refPromptInput.current?.select()),80)}componentWillUnmount(){re.Z.utilities.onDialogCanceled.removeListener(this._handleDialogCanceled),this.props.customData.webview.removeEventListener("loadstart",this.handleLoadStart)}_handleDialogCanceled=e=>{this.onCancel()};onOk=e=>{this._pendingAction&&(e.preventDefault(),this._pendingAction=!1,this.props.customData.dialog.ok(this.state.promptValue)),this.props.onClose()};onCancel=()=>{this._pendingAction&&(this._pendingAction=!1,this.props.customData.dialog.cancel()),this.props.onClose()};handlePrompt=e=>{this.setState({promptValue:e.target.value})};render(){const{messageType:e,origin:t}=this.props.customData,s=t?(0,W.Z)("JavaScript from “$1”",[t]):(0,W.Z)("JavaScript from localhost");return(0,zn.jsx)(Ha.Z,{style:hd,onRequestClose:this.onCancel,ignoreClickOutside:!0,className:"dialog-javascript slide",title:s,children:(0,zn.jsxs)("form",{onSubmit:this.onOk,children:[(0,zn.jsxs)("div",{className:"dialog-content",children:[(0,zn.jsx)("p",{children:this.props.customData.messageText}),"prompt"===e&&(0,zn.jsx)("input",{type:"text",ref:this.refPromptInput,value:this.state.promptValue,onChange:this.handlePrompt})]}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{ref:this.refOkButton,type:"submit",value:(0,W.Z)("OK")}),"alert"!==e&&(0,zn.jsx)("input",{type:"button",onClick:this.onCancel,value:(0,W.Z)("Cancel")})]})]})})}}const pd=ud;const gd=function(e){const t={};for(const s of e.buffer){let e=t[s.operation]||0;e+=s.uids?s.uids.length:1,t[s.operation]=e}return(0,zn.jsx)(zn.Fragment,{children:Object.entries(t).map((([e,t])=>(0,zn.jsxs)("div",{children:[(0,zn.jsx)("span",{className:"StatusPopup-DbInfo",children:(0,zn.jsx)("div",{children:e})}),(0,zn.jsx)("span",{className:"StatusPopup-DbInfo",children:(0,zn.jsx)("div",{children:t})})]},e)))})};const md=function(e){const t={};for(const s of e.filteringQueue){let e=t[s.type]||0;e+=s.searchListIds?s.searchListIds.length:1,t[s.type]=e}return(0,zn.jsx)(zn.Fragment,{children:Object.entries(t).map((([e,t])=>(0,zn.jsxs)("div",{children:[(0,zn.jsx)("span",{className:"StatusPopup-DbInfo",children:(0,zn.jsx)("div",{children:e})}),(0,zn.jsx)("span",{className:"StatusPopup-DbInfo",children:(0,zn.jsx)("div",{children:t})})]},e)))})},fd={version:-1,accounts:-1,bufferSize:-1,messages:-1,imap:-1,pop:-1,filteringQueueSize:-1,threadingQueueSize:-1,flaggingQueueSize:-1,searchDbQueueSize:-1,filteringQueue:[],buffer:[]};function vd(e){return e>-1?e:"..."}const bd=function(){const[e,t]=Un.useState(fd),[s,n]=Un.useState(!1),[i,a]=Un.useState(0);function o(){n(!0),async function(){const e=await rs.Z._upgrades.toCollection().last(),t=await rs.Z.filteringQueue.toArray(),s=(await rs.Z.flaggingQueue.toArray()).reduce(((e,t)=>e+t.searchListIds.length),0),n=(await rs.Z.threadingQueue.toArray()).reduce(((e,t)=>e+t.threadingIds.length),0),i=await rs.Z.buffer.toArray();return{version:e.version,accounts:await rs.Z.accounts.count(),bufferSize:await rs.Z.buffer.count(),messages:await rs.Z.messages.count(),imap:await rs.Z.imap.count(),pop:await rs.Z.pop.count(),filteringQueueSize:t.length,threadingQueueSize:n,flaggingQueueSize:s,searchDbQueueSize:await rs.Z.searchDbQueue.count(),filteringQueue:t,buffer:i}}().then((e=>{t(e),n(!1)}))}return setTimeout((function(){s||(0===i?(a(5),o()):a(i-1))}),1e3),(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("div",{className:"StatusPopup-ContentPane pad-top-bottom",children:[(0,zn.jsxs)("span",{className:"StatusPopup-DbInfo",children:[(0,W.Z)("Version:"),(0,zn.jsx)("div",{children:vd(e.version)})]}),(0,zn.jsxs)("span",{className:"StatusPopup-DbInfo",children:[(0,W.Z)("Accounts:"),(0,zn.jsx)("div",{children:vd(e.accounts)})]}),(0,zn.jsxs)("span",{className:"StatusPopup-DbInfo",title:(0,W.Z)("With duplicates resolved"),children:[(0,W.Z)("Number of messages:"),(0,zn.jsx)("div",{children:vd(e.messages)})]}),(0,zn.jsxs)("span",{className:"StatusPopup-DbInfo",title:(0,W.Z)("Includes duplicates"),children:[(0,W.Z)("... from IMAP Servers:"),(0,zn.jsx)("div",{children:vd(e.imap)})]}),(0,zn.jsxs)("span",{className:"StatusPopup-DbInfo",title:(0,W.Z)("Includes duplicates"),children:[(0,W.Z)("... from POP3 servers:"),(0,zn.jsx)("div",{children:vd(e.pop)})]}),(0,zn.jsxs)("span",{className:"StatusPopup-DbInfo",children:[(0,W.Z)("Pending IMAP actions:"),(0,zn.jsx)("div",{children:vd(e.bufferSize)})]}),e.bufferSize>0&&(0,zn.jsx)("span",{className:"StatusPopup-DbInfo",children:(0,zn.jsx)(gd,{buffer:e.buffer})}),(0,zn.jsxs)("span",{className:"StatusPopup-DbInfo",children:[(0,W.Z)("Pending filtering:"),(0,zn.jsx)("div",{children:vd(e.filteringQueueSize)})]}),e.filteringQueueSize>0&&(0,zn.jsx)("span",{className:"StatusPopup-DbInfo",children:(0,zn.jsx)(md,{filteringQueue:e.filteringQueue})}),(0,zn.jsxs)("span",{className:"StatusPopup-DbInfo",children:[(0,W.Z)("Pending threading:"),(0,zn.jsx)("div",{children:vd(e.threadingQueueSize)})]}),(0,zn.jsxs)("span",{className:"StatusPopup-DbInfo",children:[(0,W.Z)("Pending flagging:"),(0,zn.jsx)("div",{children:vd(e.flaggingQueueSize)})]}),(0,zn.jsxs)("span",{className:"StatusPopup-DbInfo",children:[(0,W.Z)("Pending search indexing:"),(0,zn.jsx)("div",{children:vd(e.searchDbQueueSize)})]})]}),(0,zn.jsx)("div",{className:"StatusPopup-Footer toolbar-default",children:(0,zn.jsx)("div",{className:"StatusPopup-AccountPoll",children:s?(0,W.Z)("Refreshing ..."):(0,W.Z)("Refreshes in $1 seconds",[i])})})]})};var Cd=s(65093),wd=s(35874);class yd extends m.Z{getInitialState(){return new Map}reduce(e,t){if("MAIL_ERROR_SET"===t.actionType){const{accountId:s,category:n,error:i,code:a,level:o="WARNING"}=t,r={category:n,error:i,code:a,level:o};return(0,C.Uy)(e,(e=>{const t=e.get(s);t?t.push(r):e.set(s,[r])}))}if("MAIL_ERROR_DELETE"===t.actionType){const{accountId:s,category:n}=t;return(0,C.Uy)(e,(e=>{const t=e.get(s);if(t){const i=t.filter((e=>e.category!==n));i.length>0?e.set(s,i):e.delete(s)}}))}return e}getLatestError(e){const t=this.getState().get(e);if(t)return t[t.length-1]}hasError(e){const t=this.getState().get(e);return!!t&&t.length>0}hasAccountError(e){return!!this.getState().get(e)?.some((e=>(0,wd.I)(e.code)))}}const xd=new yd;Ad.defaultProps={size:32};const Id="/resources/vivaldi_mail_default.png";function Ad(e){let t=e.emailAddress.split("@")[1]||"";return t="gmail.com"===t?"https://ssl.gstatic.com/ui/v1/icons/mail/images/favicon5.ico":"googleusercontent.com"===t?"https://google.com/favicon.ico":(0,Vn.rv)(t),(0,zn.jsx)(Vn.ZP,{size:e.size,className:e.className,url:t?(0,Ar.q9)(t):Id,fallbackUrl:Id,loadType:"faviconSkipCache"})}const Sd=Ad;var Zd=s(97823);class Td extends Un.PureComponent{static contextType=oi.Z;#v=!1;constructor(e){super(e),this.state={imapStatus:Cd.Z.getStatus(e.account.MAIL_EMAIL),selectedMailboxes:new Map}}componentDidMount(){this.#v=!0,Cd.Z.addListener(this.onImapStoreChange),this.props.showAdvancedInfo&&this.#b()}componentWillUnmount(){this.#v=!1,Cd.Z.removeListener(this.onImapStoreChange)}onImapStoreChange=e=>{e.accountId===this.props.account.MAIL_EMAIL&&this.setState({imapStatus:Cd.Z.getStatus(this.props.account.MAIL_EMAIL)})};#b=async()=>{const e=await ts.Z.getSelectedMailboxes();this.#v&&(this.setState({selectedMailboxes:e}),setTimeout(this.#b,3e3))};#C=()=>{this.props.hidePopup()};#w=async()=>{const e=await Zd.Z.loadAccount(this.props.account.MAIL_EMAIL);ue.Z.showMailAuthenticationDialog(this.context.vivaldiWindowId,{account:e}),this.props.hidePopup()};render(){const{account:e}=this.props,t=e.MAIL_EMAIL,s=this.state.selectedMailboxes.get(t),n=this.state.imapStatus;let i;return e.offline?i="offline":navigator.onLine?n.isConnecting||n.isDisconnected?n.isConnecting?i="connecting":xd.hasAccountError(t)?i="needsAuth":e.accountType===Nt.s9.IMAP?i=xd.hasError(t)?"hasError":"disconnected":e.accountType===Nt.s9.POP&&(i="connected"):i=n.isSyncing?"syncing":n.isSyncingFlags?"syncingFlags":n.isPreFetching?"preFetching":"connected":i="noNetwork",(0,zn.jsxs)("button",{tabIndex:A.Z.get(Z.kKeyboardTabToAll),onClick:()=>this.#C(),className:"StatusPopup-Account",children:[(0,zn.jsx)(Sd,{emailAddress:t,size:16,className:"StatusPopup-AccountIcon"}),(0,zn.jsx)("div",{className:"StatusPopup-AccountName",children:t}),(0,zn.jsxs)("div",{className:"StatusPopup-AccountStatus",children:["offline"===i&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("span",{className:"StatusPopup-AccountStatus--Success",title:(0,W.Z)("mail","Offline"),dangerouslySetInnerHTML:{__html:Kn.GH$}}),(0,W.Z)("mail","Offline")]}),"connected"===i&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("span",{className:"StatusPopup-AccountStatus--Success",title:(0,W.Z)("The account should normally be connected on the inbox"),dangerouslySetInnerHTML:{__html:Kn.JLz}}),s?(0,W.Z)("Connected on $1",[s]):(0,W.Z)("Connected")]}),"syncing"===i&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("span",{className:"StatusPopup-AccountStatus--Success",title:(0,W.Z)("Fetching Headers"),dangerouslySetInnerHTML:{__html:Kn.JLz}}),(0,W.Z)("Indexing...")]}),"syncingFlags"===i&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("span",{className:"StatusPopup-AccountStatus--Success",title:(0,W.Z)("Fetching Mail Status"),dangerouslySetInnerHTML:{__html:Kn.JLz}}),(0,W.Z)("Flag updates...")]}),"preFetching"===i&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("span",{className:"StatusPopup-AccountStatus--Success",title:(0,W.Z)("Fetching Bodies"),dangerouslySetInnerHTML:{__html:Kn.JLz}}),(0,W.Z)("Pre-fetching...")]}),"connecting"===i&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("span",{className:"StatusPopup-AccountStatus--Warning",title:(0,W.Z)("Connecting..."),dangerouslySetInnerHTML:{__html:Kn.GH$}}),(0,W.Z)("Connecting...")]}),"needsAuth"===i&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("span",{className:"StatusPopup-AccountStatus--Error",title:(0,W.Z)("Authentication Error"),dangerouslySetInnerHTML:{__html:Kn.viW}}),(0,W.Z)("Authentication Error")]}),"hasError"===i&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("span",{className:"StatusPopup-AccountStatus--Error",title:xd.getLatestError(t)?.error.message||(0,W.Z)("Error"),dangerouslySetInnerHTML:{__html:Kn.viW}}),(0,W.Z)("Error")]}),"noNetwork"===i&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("span",{className:"StatusPopup-AccountStatus--Warn",title:(0,W.Z)("No Network"),dangerouslySetInnerHTML:{__html:Kn.GH$}}),(0,W.Z)("No Network")]}),"disconnected"===i&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("span",{className:"StatusPopup-AccountStatus--Warn",title:(0,W.Z)("Disconnected"),dangerouslySetInnerHTML:{__html:Kn.GH$}}),(0,W.Z)("Disconnected")]}),!i&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("span",{className:"StatusPopup-AccountStatus--Warn",title:(0,W.Z)("Unknown"),dangerouslySetInnerHTML:{__html:Kn.GH$}}),(0,W.Z)("Status Unknown")]}),"needsAuth"===i&&(0,zn.jsx)("a",{className:"StatusPopup-AccountStatusRetry",tabIndex:A.Z.get(Z.kKeyboardTabToAll),onClick:this.#w,href:"",children:(0,W.Z)("Retry")})]})]})}}const Ed=Td;const kd=function(){const e=A.Z.get(Z.kMailAccounts).filter((e=>e.accountType===Nt.s9.IMAP));return(0,zn.jsx)(zn.Fragment,{children:(0,zn.jsx)("div",{className:"StatusPopup-List pad-top",children:e.map((e=>(0,zn.jsx)(Un.Fragment,{children:(0,zn.jsx)("div",{children:(0,zn.jsx)(Ed,{account:e,hidePopup:()=>{},showAdvancedInfo:!0})})},e.MAIL_EMAIL)))})})};var Nd=(0,zn.jsx)(bd,{}),_d=(0,zn.jsx)(kd,{});const Pd=function(){return(0,zn.jsx)(zn.Fragment,{children:(0,zn.jsxs)("div",{children:[(0,zn.jsxs)("div",{className:"StatusPopup-ContentPane",children:[(0,zn.jsx)("div",{className:"StatusPopup-Header",children:(0,zn.jsx)("h2",{children:(0,W.Z)("Mail DB")})}),Nd]}),(0,zn.jsxs)("div",{className:"StatusPopup-ContentPane",children:[(0,zn.jsx)("div",{className:"StatusPopup-Header",children:(0,zn.jsx)("h2",{children:(0,W.Z)("IMAP Clients")})}),_d]})]})})};var Md=(0,zn.jsx)(Pd,{});const Dd=function(e){return(0,zn.jsx)(Ha.Z,{className:"float",onRequestClose:e.onClose,children:Md})};class Od extends Un.Component{constructor(e){super(e),this.state={hover:!1,show:!0}}componentDidMount(){this.hideSelf(4e3)}componentWillUnmount(){this._timeoutID&&clearTimeout(this._timeoutID)}startHover=e=>{this.setState({hover:!0})};endHover=e=>{this.setState({hover:!1},this.onClose)};showSelf=()=>{this._timeoutID&&clearTimeout(this._timeoutID),this.setState({show:!0}),this.props.onVisibilityChanged&&this.props.onVisibilityChanged(!0)};hideSelf=e=>{this._timeoutID&&clearTimeout(this._timeoutID),this._timeoutID=setTimeout((()=>{this.setState({show:!1},this.onClose)}),e)};onClose=()=>{this.state.show||this.state.hover||(this.props.onClose&&this.props.onClose(),this.props.onVisibilityChanged&&this.props.onVisibilityChanged(!1))};show=()=>{this.showSelf(),this.hideSelf(4e3)};render(){var e=Gn()({overlayinfobubble:!0,show:this.state.hover||this.state.show});return(0,zn.jsx)("div",{onMouseEnter:this.startHover,onMouseLeave:this.endHover,children:(0,zn.jsx)("div",{className:e,onClick:this.hideSelf.bind(this,0),children:this.props.overlayText})})}}const jd=Od,Ld=287;function Rd(e){const t=e.length;switch(!0){case t>180&&t<Ld:return 426;case t>122:return 354;case t>84:return 306;default:return 258}}class Bd extends Un.Component{#v=!1;constructor(e){super(e),this.state={qrImage:"",data:this.props.data,dataChanged:!1}}componentDidMount(){this.#v=!0,this.onGenerate("dataurl")}componentWillUnmount(){this.#v=!1}componentDidUpdate(e){this.state.dataChanged||this.props.data===e.data||this.setState({data:this.props.data},this.onGenerate.bind(this,"dataurl"))}onUrlInputChanged=e=>{const t=e.currentTarget.value;this.setState({data:t}),t&&t.length>2&&re.Z.utilities.generateQRCode(t,(e=>{this.setState({qrImage:e,dataChanged:!0})}))};onGenerate=(e,t)=>{const s=""!==this.state.data?this.state.data:this.props.data,n=(0,W.Z)("QR Code Generated");re.Z.utilities.generateQRCode(s,e,(t=>{"dataurl"===e?this.#v&&this.setState({qrImage:t,data:s}):"clipboard"===e&&(0,H.c)({title:n,body:(0,W.Z)("Image stored in the clipboard."),tag:"VIVALDI_QR_IMAGE_TO_CLIPBOARD"})})),t&&this.props.hidePopup()};onCancel=()=>{this.props.hidePopup()};renderDialogHeader=()=>(0,zn.jsx)("div",{className:"dialog-header",children:(0,zn.jsx)("h3",{id:"dialog-qrshare-title",children:(0,W.Z)("Page QR Code")})});renderQRImage=()=>(0,zn.jsxs)("div",{className:"dialog-content",children:[this.state.data.length>Ld?(0,zn.jsx)("p",{children:(0,W.Z)("Address is too long, QR code source cannot exceed $1 characters.",[Ld])}):(0,zn.jsx)("img",{src:this.state.qrImage,className:"qr-image"}),(0,zn.jsx)("input",{type:"url",value:this.state.data,spellCheck:"false",maxLength:Ld,onChange:this.onUrlInputChanged,onFocus:e=>e.target.select()})]});renderSaveCancel=()=>(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"button",onClick:this.onGenerate.bind(this,"clipboard",!0),disabled:this.state.data.length>Ld,value:(0,W.Z)("verb","Copy")}),(0,zn.jsx)("input",{type:"button",onClick:this.onGenerate.bind(this,"file",!0),disabled:this.state.data.length>Ld,value:(0,W.Z)("Save to Download")})]});renderPopupContents=()=>(0,zn.jsxs)("div",{className:"qr-share-dialog",children:[this.renderDialogHeader(),this.renderQRImage(),this.renderSaveCancel()]});render(){return this.props.useModal?(0,zn.jsx)(Ha.Z,{style:{width:Rd(this.state.data),minWidth:"unset"},onRequestClose:this.onCancel,labelledBy:"dialog-qrshare-title",children:this.renderPopupContents()}):this.renderPopupContents()}}const Fd=Bd,Wd={width:400,minWidth:"unset"};class Ud extends Un.Component{state={awaiting:30};componentDidMount(){this.props.failedPreview||(this.expireInterval=setInterval((()=>this.expirePreview()),1e3))}componentWillUnmount(){clearInterval(this.expireInterval)}expirePreview=()=>{this.setState((e=>{const t=e.awaiting-1;return t<=0&&(clearInterval(this.expireInterval),On.Z.clearThemePreview()),{awaiting:t}}))};acceptPreview=()=>{this.props.isUpdate?On.Z.updateTheme():On.Z.installTheme(),this.props.onClose()};discardPreview=()=>{On.Z.clearThemePreview(),this.props.onClose()};render(){return(0,zn.jsxs)(Ha.Z,{onRequestClose:nr.Z,style:Wd,className:"slide",ignoreClickOutside:!0,title:(0,W.Z)("Theme Preview"),children:[this.props.failedPreview?(0,zn.jsx)("div",{className:"dialog-content",children:(0,W.Z)("Theme cannot be previewed due to format errors.")}):(0,zn.jsxs)("div",{className:"dialog-content",children:[this.state.awaiting>0&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("p",{children:this.props.isUpdate?(0,W.Z)("This is a preview of the updated “$1” theme. Would you like to install this update and apply it?",[this.props.themeName]):(0,W.Z)("This is a preview of the “$1” theme. Would you like to install and apply it?",[this.props.themeName])}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Theme preview expires in $1 second.","Theme preview expires in $1 seconds.",[this.state.awaiting])})]}),this.state.awaiting<1&&(0,zn.jsx)("p",{children:(0,W.Z)("Preview of the “$1” theme has expired, please reload the theme again if you wish to install it.",[this.props.themeName])})]}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[!this.props.failedPreview&&(0,zn.jsx)("input",{type:"submit",value:this.props.isUpdate?(0,W.Z)("Update"):(0,W.Z)("Install"),onClick:this.acceptPreview,disabled:this.state.awaiting<1,autoFocus:!0}),(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Cancel"),onClick:this.discardPreview})]})]})}}const Vd=Ud;const Hd=function({customData:e,closeDialog:t}){switch(e.dialogtype){case"toast":return(0,zn.jsx)(jd,{customData:e,onClose:()=>t("toast"),overlayText:e.text});case"download":return(0,zn.jsx)(Er.Z,{customData:e,onClose:()=>t("download")});case"import":return(0,zn.jsx)(dd,{onClose:()=>t("import")});case"createSearch":return(0,zn.jsx)(Tr,{onClose:()=>t("createSearch"),name:e.Name,url:e.Url});case"javascript":return(0,zn.jsx)("div",{className:"modal-overlay",children:(0,zn.jsx)(pd,{customData:e,onClose:()=>t("javascript")})});case"fullscreen":{const s=(0,W.Z)("Press Escape key to exit fullscreen.");return(0,zn.jsx)(jd,{customData:e,onClose:()=>t("fullscreen"),overlayText:s})}case"pointerLock":{const s=(0,W.Z)("Press Escape key to exit the pointer lock.");return(0,zn.jsx)(jd,{customData:e,onClose:()=>t("pointerLock"),overlayText:s})}case"qrcode":return(0,zn.jsx)("div",{className:"modal-overlay",children:(0,zn.jsx)(Fd,{useModal:!0,data:e.url,hidePopup:()=>t("qrcode")})});case"extensionError":return(0,zn.jsx)("div",{className:"modal-overlay",children:(0,zn.jsx)(Nr,{errors:e.errors,onClose:()=>t("extensionError")})});case"themePreview":return(0,zn.jsx)("div",{className:"modal-overlay",children:(0,zn.jsx)(Vd,{themeName:e.themeName,isUpdate:e.isUpdate,onClose:()=>t("themePreview")})});case"themePreviewFailed":return(0,zn.jsx)(Vd,{failedPreview:!0,themeName:"",isUpdate:!1,onClose:()=>t("themePreviewFailed")});case"mailInfo":return(0,zn.jsx)(Dd,{onClose:()=>t("mailInfo")});default:return console.error("DialogRenderWrapper.render: unknown dialogtype:"+e.dialogtype),null}};class Gd extends Un.Component{static contextType=oi.Z;state={hasError:!1,stack:"",existingChildren:this.props.children};static getDerivedStateFromProps(e,t){return e.children!==t.existingChildren?{hasError:!1,existingChildren:e.children}:null}static getDerivedStateFromError(e){return{hasError:!0,stack:e.stack}}componentDidCatch(e,t){return null}openBugReport=()=>{const e=encodeURIComponent(this.state.stack),t=encodeURIComponent(this.state.stack.slice(0,this.state.stack.indexOf("\n")));c.ZP.openURL(this.context.vivaldiWindowId,`${u.EA}?project=VB&type=normal&summary=%5BJSError%5D%20${t}&actual=${e}`)};render(){const{children:e,level:t}=this.props;return this.state.hasError?(0,zn.jsxs)("div",{className:"error-boundary",children:[(0,zn.jsx)("h1",{children:(0,W.Z)("An error occurred")}),(0,zn.jsx)("pre",{children:this.state.stack}),(0,zn.jsx)("p",{children:(0,W.Z)("Please consider reporting the issue at $1 to help us fix it.",[u.EA])}),"nothing"===t&&(0,zn.jsx)("input",{type:"button",onClick:()=>re.Z.runtimePrivate.exit(!1),value:(0,W.Z)("verb","Exit")}),"tabs"===t&&(0,zn.jsx)("input",{type:"button",onClick:this.openBugReport,value:(0,W.Z)("Report issue")})]}):e}}const Kd=Gd;var zd=s(81009);const $d=[Z.kStartupShowGitDirectoryWarning],Yd={width:500,minWidth:"unset"};class Xd extends Un.Component{constructor(e){super(e)}_onClose=()=>{I.Z.set(Z.kStartupShowGitDirectoryWarning,""),this.props.onClose()};render(){return(0,zn.jsxs)(Ha.Z,{onRequestClose:nr.Z,style:Yd,className:"slide",title:(0,W.Z)("Warning: Your profile folder might be inside a Git repository"),children:[(0,zn.jsxs)("div",{className:"dialog-content selectable-content",children:[(0,zn.jsxs)("p",{children:[(0,W.Z)("A .git configuration was detected in")," ",(0,zn.jsx)("b",{children:this.props.prefValues[Z.kStartupShowGitDirectoryWarning]})]}),(0,zn.jsx)("p",{children:(0,W.Z)("This could cause you to accidentally share part of or your whole profile with a public Git repository and allow others to see your private data, such as website logins, cookies and cache files.")}),(0,zn.jsx)("p",{children:(0,W.Z)("A .gitignore file has therefore been added to your profile folder to prevent accidental sharing to public Git services (e.g. GitHub). If sharing was intentional, please edit the .gitignore file to select what really should be ignored.")})]}),(0,zn.jsx)("footer",{className:"dialog-footer",children:(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Close"),onClick:this._onClose})})]})}}const Qd=(0,zd.Z)(Xd,$d),qd=[Z.kStartupShowMediaAvailableInformation],Jd={width:400,minWidth:"unset"};class ec extends Un.Component{static contextType=oi.Z;constructor(e){super(e),this.state={doNotShowAgain:!1}}_onClose=()=>{I.Z.set(Z.kStartupShowMediaAvailableInformation,!this.state.doNotShowAgain),this.props.onClose()};_onInformation=()=>{c.ZP.openURL(this.context.vivaldiWindowId,"https://www.microsoft.com/en-us/software-download/mediafeaturepack"),this._onClose()};_onCheckChanged=()=>{this.setState((e=>({doNotShowAgain:!e.doNotShowAgain})))};render(){return(0,zn.jsxs)(Ha.Z,{onRequestClose:nr.Z,style:Jd,className:"slide",title:(0,W.Z)("Media support"),children:[(0,zn.jsxs)("div",{className:"dialog-content",children:[(0,zn.jsx)("p",{children:(0,W.Z)("This Windows N edition lacks the media package to play HTML5 ‘proprietary’ media (H.264/AAC).")}),(0,zn.jsxs)("label",{className:"dialog-checkbox",children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.state.doNotShowAgain,onChange:this._onCheckChanged}),(0,zn.jsx)("span",{children:(0,W.Z)("Do not show again")})]})]}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"submit",value:(0,W.Z)("More Information"),onClick:this._onInformation,autoFocus:!0}),(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Cancel"),onClick:this._onClose})]})]})}}const tc=(0,zd.Z)(ec,qd);const sc=function(e){const t=(0,Un.useContext)(oi.Z),[n,i]=(0,Un.useState)(!0),a=function(){const e=(0,Un.useContext)(oi.Z),t=(0,Un.useRef)(null),s=(0,Un.useCallback)((()=>{const s=t.current?.getBoundingClientRect();s&&re.Z.windowPrivate.updateMaximizeButtonPosition(e.vivaldiWindowId,s.left,s.top,s.width,s.height)}),[e.vivaldiWindowId]);return(0,Un.useEffect)((()=>(e.addEventListener("resize",s),e.addEventListener("load",s),()=>{e.removeEventListener("resize",s),e.removeEventListener("load",s)})),[s,e]),(0,Un.useLayoutEffect)(s,[s]),t}(),o=s(51759),r=s(96375),l=s(9592),d=e=>{e.preventDefault()};return(0,zn.jsx)("div",{className:Gn()({"window-buttongroup":!0,"on-mainbar":e.onMainBar,"disable-transition":n}),onMouseEnter:e=>{i(!1)},children:(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("button",{tabIndex:"-1",className:"window-minimize",onMouseDown:d,onClick:e=>{Wn.Z.minimize(t.vivaldiWindowId)},dangerouslySetInnerHTML:{__html:r}}),(0,zn.jsx)("button",{ref:a,tabIndex:"-1",className:"window-maximize",onMouseDown:d,onClick:e=>{e.persist(),fe.ZP.isMaximized(t.vivaldiWindowId)||fe.ZP.isFullscreen(t.vivaldiWindowId)?Wn.Z.restore(t.vivaldiWindowId):Wn.Z.maximize(t.vivaldiWindowId)},dangerouslySetInnerHTML:{__html:l}}),(0,zn.jsx)("button",{tabIndex:"-1",className:"window-close",onMouseDown:d,onClick:e=>{e.stopPropagation(),Wn.Z.close(t.vivaldiWindowId)},dangerouslySetInnerHTML:{__html:o}})]})})};var nc=s(34197);var ic=s(32773),ac=s(57654);const oc=[Z.kKeyboardTabToAll];var rc=(0,zn.jsx)("br",{});class lc extends Un.Component{static contextType=oi.Z;constructor(e){super(e),this.state={hasGuestSession:!1,accountState:"none",editedName:this.getProfileName(e.activeProfile),suggestedName:"",activeImageIndex:e.activeProfile.imageIndex,activeImageUrl:this.getProfileImage(e.activeProfile),profileImages:[],profileStats:[],selectedProfilePath:"",hasDesktopShortcut:!1,createDesktopShortcut:!1,canCreateDesktopShortcut:!0,canRemoveActive:!1}}componentDidMount(){this.attachListeners(),this.onWindowUpdated(),this.getAllProfileImages(),re.Z.runtimePrivate.getProfileDefaults((e=>{this.setState({suggestedName:e})})),re.Z.runtimePrivate.hasDesktopShortcut(((e,t)=>{this.setState({hasDesktopShortcut:e,createDesktopShortcut:e,canCreateDesktopShortcut:t})}))}componentWillUnmount(){this.detachListeners()}attachListeners=()=>{n.Z.windows.onCreated.addListener(this.onWindowUpdated),n.Z.windows.onRemoved.addListener(this.onWindowUpdated)};detachListeners=()=>{n.Z.windows.onCreated.removeListener(this.onWindowUpdated),n.Z.windows.onRemoved.removeListener(this.onWindowUpdated)};onWindowUpdated=()=>{re.Z.runtimePrivate.hasGuestSession((e=>{this.state&&this.setState({hasGuestSession:e})}))};getAllProfileImages=()=>{re.Z.runtimePrivate.getUserProfileImages((e=>{this.setState({profileImages:e})}))};openNamedProfile=e=>{re.Z.runtimePrivate.openNamedProfile(e,(t=>{t||console.warn("Failed to open profile: "+e),this.props.hidePopup()}))};getProfileImage=e=>{if(e.active){const e=me.getState().accountInfo;if(e.pictureUrl)return e.pictureUrl}return e.customAvatar?e.customAvatar:e.image};getProfileName=e=>{if(e.active){const e=me.getState().accountInfo;if(e.accountId)return e.accountId}return e.name};toggleGuestProfile=()=>{this.state.hasGuestSession?ue.Z.closeGuestSession():ue.Z.openGuestWindow(),this.props.hidePopup()};managePeople=()=>{this.setState({accountState:"list"})};manageUser=()=>{this.props.isLoggedIn?(ue.Z.showSettings(this.context.vivaldiWindowId,"sync"),this.props.hidePopup()):this.setState({accountState:"edit"})};exitUser=()=>{ue.Z.closeActiveProfile()};getFormattedName_=()=>this.props.accountInfo.username&&this.props.isLoggedIn?(0,zn.jsxs)("div",{className:"profile-name-text",children:[(0,zn.jsxs)("div",{className:"active-sync-item-label",children:[(0,W.Z)("Logged in as"),rc]}),(0,zn.jsx)("div",{children:this.props.accountInfo.username})]}):this.props.activeProfile.name;selectActiveProfileImage=(e,t)=>{this.setState({activeImageIndex:e,activeImageUrl:t})};selectCustomProfileImage=()=>{re.Z.utilities.selectLocalImage({windowId:this.context.vivaldiWindowId,title:(0,W.Z)("Select Custom Image"),profileImage:!0})};goBack=()=>{let e="none";"info"===this.state.accountState&&(e="list"),this.state&&this.setState({accountState:e,editedName:this.props.activeProfile.name,activeImageIndex:this.props.activeProfile.imageIndex,canRemoveActive:!1})};onSave=()=>{let e=!0;if("edit"===this.state.accountState){if(this.state.editedName.length){const t=(0,ac.Z)(this.state.editedName).trim();if(!t.length)return;const s=this.state.hasDesktopShortcut!==this.state.createDesktopShortcut||this.state.activeImageIndex!==this.props.activeProfile.imageIndex;re.Z.runtimePrivate.updateActiveProfile(t,this.state.activeImageIndex,s?this.state.createDesktopShortcut:void 0,(t=>{e=t}))}}else if("new"===this.state.accountState&&this.state.suggestedName.length){const t=(0,ac.Z)(this.state.suggestedName).trim();if(!t.length)return;re.Z.runtimePrivate.createProfile(t,this.state.activeImageIndex,this.state.createDesktopShortcut,(t=>{e=t}))}this.props.hidePopup&&e&&this.props.hidePopup()};onCancel=()=>{this.goBack()};onSignin=()=>{ue.Z.showSettings(this.context.vivaldiWindowId,"sync"),this.props.hidePopup()};onRegister=()=>{ue.Z.showSettings(this.context.vivaldiWindowId,"sync",{view:"register"}),this.props.hidePopup()};createProfile=()=>{this.setState({accountState:"new",activeImageIndex:0})};showProfileInfo=(e,t)=>{this.setState({accountState:"info",selectedProfilePath:e}),t.preventDefault(),t.stopPropagation(),re.Z.runtimePrivate.getProfileStatistics(e,(e=>{e.map((e=>{switch(e.category){case"Autofill":e.category=(0,W.Z)("other","Autofill");break;case"Bookmarks":e.category=(0,W.Z)("Bookmarks");break;case"Passwords":e.category=(0,W.Z)("Passwords");break;case"BrowsingHistory":e.category=(0,W.Z)("Browsing History")}})),this.setState({profileStats:e})}))};confirmRemoval=()=>{this.setState({canRemoveActive:!0})};removeProfile=()=>{re.Z.runtimePrivate.deleteProfile(this.state.selectedProfilePath,(e=>{e&&this.goBack()}))};handleNameInput=e=>{"new"===this.state.accountState?this.setState({suggestedName:e.target.value}):this.setState({editedName:e.target.value})};changeDesktopShortcut=e=>{this.setState({createDesktopShortcut:e.currentTarget.checked})};handleFocus=e=>{e.currentTarget.select()};renderNavigationBack=()=>{const e=(0,W.Z)("profiles","Back");return(0,zn.jsx)("button",{type:"button",title:e,className:"nav-back",onClick:this.goBack,dangerouslySetInnerHTML:{__html:Kn.mgF.medium+e}})};renderDialogHeader=()=>{let e;switch(this.state.accountState){case"new":e=(0,W.Z)("Create New Profile");break;case"info":break;default:e=(0,W.Z)("Edit Profile")}return e?(0,zn.jsx)("div",{className:"profile-section-header",children:e}):null};renderNameEdit=()=>{const e="new"===this.state.accountState?this.state.suggestedName:this.state.editedName;return(0,zn.jsx)("label",{className:"profile-section-name",children:(0,zn.jsx)("input",{type:"text",name:"name",placeholder:(0,W.Z)("profiles","Name"),onChange:this.handleNameInput,value:e,onFocus:this.handleFocus,autoFocus:!0})})};renderSaveCancel=()=>(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"submit",className:"primary",value:"new"===this.state.accountState?(0,W.Z)("Add Profile"):(0,W.Z)("Save")}),(0,zn.jsx)("input",{type:"button",onClick:this.onCancel,value:(0,W.Z)("Cancel")})]});renderProfileInfo=()=>{const e=[],t=this.props.allProfiles.filter((e=>e.path===this.state.selectedProfilePath));if(t&&t[0]){const s=this.getProfileName(t[0]),n=this.getProfileImage(t[0]);e.push((0,zn.jsxs)("div",{className:"profile-details",children:[(0,zn.jsx)("div",{className:"profile-image",style:{backgroundImage:`url(${n})`}}),(0,zn.jsx)("div",{className:"profile-name",children:s})]},"apv_details"))}return this.state.profileStats.forEach(((t,s)=>{e.push((0,zn.jsxs)("div",{className:"profile-stat-row",children:[(0,zn.jsx)("div",{className:"profile-category",children:t.category}),(0,zn.jsx)("div",{className:"profile-count",children:t.count})]},t.category))})),this.state.canRemoveActive&&e.push((0,zn.jsx)(fa,{type:"error",children:(0,W.Z)("All profile data will be deleted and cannot be restored. Do you still want to proceed?")},"apv_alert")),e.push((0,zn.jsx)("input",{type:"button",className:"danger remove-person-button",onClick:this.state.canRemoveActive?this.removeProfile:this.confirmRemoval,value:(0,W.Z)("Remove Profile")},"apv_button")),e};renderSelectableProfileImages=()=>{const e=[];e.push((0,zn.jsx)("button",{title:(0,W.Z)("Select custom avatar image"),type:"button",className:"avatarbox avatarbox-custom",onClick:this.selectCustomProfileImage.bind(this),dangerouslySetInnerHTML:{__html:Kn.IJb}},"custom-image"));let t=this.state.profileImages.map((e=>{const t=Gn()({"avatarbox-image":!0,"avatarbox-selected":this.state.activeImageIndex===e.index});return(0,zn.jsx)("button",{title:e.name,type:"button",className:"avatarbox",onClick:this.selectActiveProfileImage.bind(this,e.index,e.image),children:(0,zn.jsx)("div",{className:t,style:{backgroundImage:`url(${e.image})`}})},e.index)}));return t=e.concat(t),(0,zn.jsx)("div",{className:"avatarlist",children:t})};renderCreateProfileShortcut=()=>this.state.canCreateDesktopShortcut?(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{className:"dialog-checkbox",checked:this.state.createDesktopShortcut,onChange:this.changeDesktopShortcut,type:"checkbox"}),(0,zn.jsx)("span",{children:(0,W.Z)("Create Desktop Shortcut")})]}):null;renderAllProfiles=()=>{const e=[];return this.props.allProfiles.forEach((t=>{const s=this.getProfileImage(t),n=this.getProfileName(t);e.push((0,zn.jsxs)("button",{className:"account-item-large",title:n,onClick:this.showProfileInfo.bind(this,t.path),tabIndex:this.props.prefValues[Z.kKeyboardTabToAll],autoFocus:-1!==this.props.prefValues[Z.kKeyboardTabToAll],children:[(0,zn.jsx)("img",{src:s,onError:e=>e.target.src=uc}),(0,zn.jsx)("span",{className:"profile-name",children:n})]},t.path))})),e};renderActiveProfileHeader=()=>{let e=this.props.accountInfo.pictureUrl;return e&&this.props.isLoggedIn||(e=this.getProfileImage(this.props.activeProfile)),(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("div",{className:"account-item active-profile",onClick:this.manageUser,children:[(0,zn.jsxs)("div",{className:"profile-name",children:[(0,zn.jsx)("img",{src:e,onError:e=>e.target.src=uc}),this.getFormattedName_()]}),(this.props.isLoggedIn||!this.props.accountInfo.username)&&(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.Zu.medium}})]}),this.props.accountInfo.username&&!this.props.isLoggedIn&&(0,zn.jsx)("input",{type:"button",onClick:this.onSignin,value:(0,W.Z)("Log in"),autoFocus:!0})]})};renderInActiveProfiles=()=>{const e=this.props.allProfiles.filter((e=>!e.active)),t=[];return e.forEach((e=>{const s=this.getProfileImage(e),n=this.getProfileName(e);t.push((0,zn.jsxs)("button",{className:"account-item",title:n,onClick:this.openNamedProfile.bind(this,e.path),children:[(0,zn.jsx)("img",{src:s,onError:e=>e.target.src=uc}),(0,zn.jsx)("span",{className:"profile-name",children:n})]},e.path))})),t};renderGuestEntry=()=>{const e=this.state.hasGuestSession?(0,W.Z)("Exit Guest Profile"):(0,W.Z)("Open Guest Profile");return(0,zn.jsx)("button",{className:"account-item",onClick:this.toggleGuestProfile,title:e,dangerouslySetInnerHTML:{__html:Kn.CtH.medium+e}})};renderManagePeople=()=>{const e=(0,W.Z)("Manage Profiles");return(0,zn.jsx)("button",{className:"account-item",onClick:this.managePeople,title:e,dangerouslySetInnerHTML:{__html:Kn.LaO.medium+e}})};renderExitUser=()=>{const e=(0,W.Z)("Exit $1",[this.props.activeProfile.name]);return(0,zn.jsx)("button",{className:"account-item",onClick:this.exitUser,title:e,dangerouslySetInnerHTML:{__html:Kn.kze+e}})};renderSyncCTA=()=>(0,zn.jsxs)("div",{className:"account-create",children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:s(71665)}}),(0,zn.jsx)("p",{children:(0,W.Z)("Create a Vivaldi Account to access your tabs, bookmarks, and data on all your devices.")}),(0,zn.jsxs)("div",{className:"toolbar toolbar-wrap toolbar-space toolbar-center",children:[(0,zn.jsx)("input",{type:"button",className:"primary",value:(0,W.Z)("Create Account"),onClick:this.onRegister}),(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Log In"),onClick:this.onSignin})]})]});render(){return"edit"===this.state.accountState||"new"===this.state.accountState?(0,zn.jsxs)("form",{className:"account-dialog",onSubmit:this.onSave,children:[this.renderNavigationBack(),this.renderDialogHeader(),this.renderNameEdit(),this.renderSelectableProfileImages(),this.renderCreateProfileShortcut(),this.renderSaveCancel()]}):"list"===this.state.accountState?(0,zn.jsxs)("div",{className:"account-dialog",children:[this.renderNavigationBack(),(0,zn.jsx)("div",{className:"account-listing-large",children:this.renderAllProfiles()}),(0,zn.jsx)("footer",{className:"dialog-footer",children:(0,zn.jsx)("input",{type:"submit",className:"primary",onClick:this.createProfile,value:(0,W.Z)("Add Profile")})})]}):"info"===this.state.accountState?(0,zn.jsxs)("div",{className:"account-dialog",children:[this.renderNavigationBack(),this.renderDialogHeader(),(0,zn.jsx)("div",{className:"profile-stat",children:this.renderProfileInfo()})]}):this.props.activeProfile.guest?(0,zn.jsxs)("div",{className:"account-dialog",children:[this.renderInActiveProfiles(),this.renderGuestEntry()]}):(0,zn.jsxs)("div",{className:"account-dialog",children:[(0,zn.jsx)("header",{children:this.renderActiveProfileHeader()}),(0,zn.jsxs)("div",{className:"popup-scrollarea",children:[!this.props.accountInfo.username&&!this.props.isLoggedIn&&this.renderSyncCTA(),this.renderInActiveProfiles(),this.renderManagePeople(),this.renderGuestEntry(),this.props.allProfiles.length>1&&this.renderExitUser()]})]})}}const dc=(0,zd.Z)(lc,oc);var cc=s(60679);function hc(e){switch(e){case"1":return"supporter";case"2":return"patron";case"3":return"advocate";default:return""}}const uc="/resources/contact-person.png";var pc=(0,zn.jsx)("div",{className:"profile-popup sync-anchor"});class gc extends Un.PureComponent{static contextType=oi.Z;state={popupVisible:!1,activeProfile:void 0,allProfiles:[],isLoggedIn:me.getState().hasToken,accountInfo:me.getState().accountInfo};componentDidMount(){re.Z.runtimePrivate.onProfilesUpdated.addListener(this.profilesUpdated),this.profilesUpdated(),me.addListener(this.onVivaldiAccountChange),this.onVivaldiAccountChange()}componentWillUnmount(){re.Z.runtimePrivate.onProfilesUpdated.removeListener(this.profilesUpdated),me.removeListener(this.onVivaldiAccountChange)}profilesUpdated=()=>{re.Z.runtimePrivate.getUserProfiles((e=>{const t=e.find((e=>!0===e.active));this.setState({allProfiles:e}),t&&this.setState({activeProfile:t})}))};onVivaldiAccountChange=()=>{const e=me.getState();this.setState({isLoggedIn:e.hasToken&&e.isReady,accountInfo:e.accountInfo})};togglePopup=()=>{this.setState((e=>({popupVisible:!e.popupVisible})))};hidePopup=()=>{this.setState({popupVisible:!1})};render(){if(!this.props.preview&&fe.ZP.isIncognito(this.context.vivaldiWindowId))return null;let e=this.state.accountInfo.username,t=this.state.accountInfo.pictureUrl;const s=hc(this.state.accountInfo.donationTier),n=this.state.activeProfile;return n?(n.guest?(n.image=t=uc,n.name=e=(0,W.Z)("Guest User")):this.state.isLoggedIn||(e=n.name,t=n.customAvatar?n.customAvatar:n.image),t||(t=uc),(0,zn.jsx)(oa.ZP,{imagePath:t,fallbackImagePath:uc,tooltip:e||(0,W.Z)("Account"),onClick:this.togglePopup,customizeMenu:this.props.customizeMenu,menuOrigin:this.props.menuOrigin,popupPosition:this.props.popupPosition,hidePopup:this.hidePopup,isPopupVisible:this.state.popupVisible,className:"button-circularimage button-cropimage profile-popup sync-anchor",popupClassName:"ToolbarButtonPopup-DefaultStyles",popupLabel:(0,W.Z)("dialog title","Accounts"),popupWidth:260,size:this.props.size,draggable:this.props.draggable||!1,onDragStart:this.props.onDragStart??nr.Z,onDragEnd:this.props.onDragEnd??nr.Z,onDrop:this.props.onDrop??nr.Z,onDragEnter:this.props.onDragEnter??nr.Z,onDragLeave:this.props.onDragLeave??nr.Z,onDragOver:this.props.onDragOver??nr.Z,mimeType:this.props.mimeType,name:this.props.name??"",badgeText:s,children:(0,zn.jsx)(dc,{activeProfile:n,allProfiles:this.state.allProfiles,hidePopup:this.hidePopup,isLoggedIn:this.state.isLoggedIn,accountInfo:this.state.accountInfo})})):pc}}const mc=(0,cc.ZP)(gc);var fc=s(21191),vc=s(13302);const bc=(e,t)=>Qe.Z.isSingleKeyShortcut(e)?t?"singlefeatures":"single":"",Cc=["shift+tab","tab","space","enter","left","right","up","down","pageup","pagedown","numlock","home","end","insert","del"],wc=["alt+shift+f4","alt+f4","shift+insert","ctrl+insert","shift+f10"];class yc extends Un.Component{static contextType=oi.Z;refComboInput=Un.createRef();state={keyValue:this.props.command.shortcuts||[],selectedCombo:"",active:!1,duplicateCombo:null,systemReservedCombo:"",singleKeyWarning:!1};findExistingShortcut=(e,t="browser")=>this.props.commandArray.filter((e=>e.shortcuts)).find((s=>s.shortcuts?.includes(e)&&(0,fc._5)(s.feature,t)));isTweakedShortcut=e=>(!this.props.command.shortcuts||!this.props.command.shortcuts.includes(e))&&Boolean(this.props.command.tweakedShortcut&&this.props.command.tweakedShortcut===e);restoreDefault=()=>{const e=A.Z.getDefault(Z.kActions)[0][this.props.command.name];if(e?.shortcuts)for(let t=0;t<e.shortcuts.length;t++){const s=this.findExistingShortcut(e.shortcuts[t],this.props.command.feature);if(s&&this.props.command.name!==s.name&&!this.isTweakedShortcut(e.shortcuts[t]))return void this.setState({duplicateCombo:{shortcut:(0,vc.$)(e.shortcuts[t]),label:s.label},systemReservedCombo:"",singleKeyWarning:!1})}this.setState({keyValue:e?.shortcuts??[]},this.save)};onClearComboButton=()=>{const{selectedCombo:e}=this.state,t=this.props.command.shortcuts;if(!e||!t)return void this.setState({keyValue:[]},this.save);const s=t.indexOf(e);if(s<0)return void this.setState({selectedCombo:""},this.save);const n=[...t.slice(0,s),...t.slice(s+1)];this.setState({keyValue:n,selectedCombo:n[s]||""},this.save)};onClearComboButtonMouseDown=e=>{e.preventDefault()};handleKeyEvent=e=>{const t=Qe.Z.keyComboFromEvent(e.nativeEvent);if(!t)return;"tab"!==t&&"shift+tab"!==t&&e.preventDefault();const s=this.findExistingShortcut(t,this.props.command.feature);if("PageUp"!==e.nativeEvent.key&&"PageDown"!==e.nativeEvent.key||!e.nativeEvent.ctrlKey||e.preventDefault(),e.getModifierState("AltGraph"))return;const n=["calendar","mail","feeds"].includes(this.props.command.feature)?this.props.prefValues[Z.kKeyboardShortcutsEnableSingleKeyForMail]:this.props.prefValues[Z.kKeyboardShortcutsEnableSingleKey],{selectedCombo:i}=this.state;if("backspace"===t||i&&"del"===t){let e=(this.props.command.shortcuts??[]).slice();if(i&&e)e.splice(e.indexOf(i),1);else if(e)if(n)e=e.slice(0,e.length-1);else for(let t=e.length-1;t>=0;t--)if(!Qe.Z.isSingleKeyShortcut(e[t])){e.splice(t,1);break}this.setState({keyValue:e||[],duplicateCombo:null,systemReservedCombo:"",singleKeyWarning:!1},this.save),this.refComboInput.current?.focus()}else if(Qe.Z.isSingleKeyShortcut(t)&&!n)this.setState({duplicateCombo:null,systemReservedCombo:"",singleKeyWarning:!0});else if(s&&!this.isTweakedShortcut(t))this.setState({duplicateCombo:{shortcut:(0,vc.$)(t),label:s.label},systemReservedCombo:"",singleKeyWarning:!1});else if(-1!==wc.indexOf(t))this.setState({systemReservedCombo:(0,vc.$)(t),duplicateCombo:null,singleKeyWarning:!1});else if(-1===Cc.indexOf(t)){const e=this.props.command.shortcuts||[];this.setState({keyValue:e.slice().concat(t),duplicateCombo:null,systemReservedCombo:"",singleKeyWarning:!1},this.save)}else this.navigateWithArrowKeys(e)};navigateWithArrowKeys=e=>{let t=null;if(!this.state.keyValue||0===this.state.keyValue.length)return;const s=Qe.Z.keyComboFromEvent(e.nativeEvent),{document:n,HTMLElement:i}=this.context,a=n.activeElement;switch(s){case"left":a&&(t=a.previousElementSibling);break;case"right":a&&(t=a.nextElementSibling);break;case"up":a&&a.parentNode&&(t=a.parentNode.firstChild);break;case"down":a&&a.parentNode&&(t=a.parentNode.lastChild)}t instanceof i&&(e.preventDefault(),e.stopPropagation(),t.focus())};save=()=>{ae.Z.setShortcuts(this.props.command.name,this.state.keyValue)};onTextFocus=()=>{this.setState({active:!0})};onTextBlur=e=>{e.preventDefault(),e.stopPropagation(),this.setState({active:!1,duplicateCombo:null,systemReservedCombo:"",singleKeyWarning:!1}),this.save()};onButtonFocus=()=>{this.setState({active:!0})};onButtonBlur=e=>{e.preventDefault(),e.stopPropagation(),this.setState({active:!1,duplicateCombo:null,systemReservedCombo:"",singleKeyWarning:!1}),this.save()};onComboFocus=e=>{this.setState({selectedCombo:e.currentTarget.dataset.raw,active:!0})};onComboBlur=()=>{this.setState({selectedCombo:"",active:!1})};renderCombos=()=>{const e=this.props.command.shortcuts;if(Array.isArray(e)&&e.length>0){const t=["mail","calendar","feeds"].includes(this.props.command.feature);return e.map(((e,s)=>(0,zn.jsx)("button",{className:`multiinput-item ${bc(e,t)}`,"data-raw":e,onFocus:this.onComboFocus,onBlur:this.onComboBlur,onKeyDown:this.handleKeyEvent,children:(0,vc.$)(e)},s)))}return null};renderKeyboardShortcutEditSetting=()=>(0,zn.jsxs)("div",{className:Gn()({controls:!0,active:this.state.active}),children:[(0,zn.jsx)("div",{className:"multiinput",children:(0,zn.jsxs)("div",{className:"multiinput-group",children:[this.renderCombos(),(0,zn.jsx)("input",{type:"text",ref:this.refComboInput,id:this.props.id,defaultValue:"",onKeyDown:this.handleKeyEvent,onFocus:this.onTextFocus,onBlur:this.onTextBlur})]})}),(0,zn.jsx)("input",{type:"button",className:"circular restorekey",title:(0,W.Z)("Restore default shortcut"),onClick:this.restoreDefault,onFocus:this.onButtonFocus,onBlur:this.onButtonBlur}),(0,zn.jsx)("input",{type:"button",className:"circular clearkey",title:(0,W.Z)("Clear shortcut"),onMouseDown:this.onClearComboButtonMouseDown,onClick:this.onClearComboButton,onFocus:this.onButtonFocus,onBlur:this.onButtonBlur}),this.state.duplicateCombo&&(0,zn.jsx)("p",{className:"info",role:"alert",children:(0,W.Z)("Shortcut $1 is already assigned to “$2” command.",[this.state.duplicateCombo.shortcut.toUpperCase(),this.state.duplicateCombo?.label??""])}),this.state.systemReservedCombo&&(0,zn.jsx)("p",{className:"info",role:"alert",children:(0,W.Z)("Shortcut $1 is reserved by the system.",[this.state.systemReservedCombo.toUpperCase()])}),this.state.singleKeyWarning&&(0,zn.jsx)("p",{className:"info",role:"alert",children:(0,W.Z)("Single Key Shortcuts are currently disabled.")})]});render(){return this.renderKeyboardShortcutEditSetting()}}const xc=yc;class Ic extends Un.PureComponent{static contextType=oi.Z;refComboInput=Un.createRef();state={commands:[],error:null};componentDidMount=()=>{this._initialSetup(),Ye.Z.addListener(this.onStoreChange)};componentWillUnmount=()=>{Ye.Z.removeListener(this.onStoreChange)};_initialSetup=()=>{this.setState({commands:Ye.Z.getSettingsList(!1)})};onStoreChange=()=>{this._initialSetup()};getCommand=()=>this.state.commands.find((e=>e.name===this.props.name));findExistingShortcut=e=>this.state.commands.filter((e=>e.shortcuts)).find((t=>t.shortcuts?.includes(e)));isDefault=()=>{const e=this.getCommand()?.shortcuts;if(void 0===e)return!0;const t=A.Z.getDefault(Z.kActions)[0][this.props.name]?.shortcuts;return!!t?.every(((t,s)=>t===e[s]))||void 0===t&&0===e.length};restoreDefault=()=>{const e=A.Z.getDefault(Z.kActions)[0][this.props.name];if(e.shortcuts)for(let t=0;t<e.shortcuts.length;t++){const s=e.shortcuts[t],n=this.findExistingShortcut(s);if(n&&n.name!==this.props.name)return void this.setState({error:(0,W.Z)("Shortcut $1 is already assigned to “$2” command.",[(0,vc.$)(s).toUpperCase(),n.label])})}const t=this.getCommand();t&&this.save(t,e.shortcuts||[])};handleKeyEvent=e=>{const t=this.getCommand();if(!t||["Escape","Tab"].includes(e.key)||e.getModifierState("AltGraph"))return void this.setState({error:null});e.preventDefault(),e.stopPropagation();const s=Qe.Z.keyComboFromEvent(e.nativeEvent);if("Backspace"!==e.key){if(s){const e=this.findExistingShortcut(s);if(!A.Z.get(Z.kKeyboardShortcutsEnableSingleKey)&&Qe.Z.isSingleKeyShortcut(s))this.setState({error:(0,W.Z)("Single Key Shortcuts are currently disabled.")});else if(e)this.setState({error:(0,W.Z)("Shortcut $1 is already assigned to “$2” command.",[(0,vc.$)(s).toUpperCase(),e.label])});else if(-1!==wc.indexOf(s)){const e=(0,vc.$)(s);this.setState({error:(0,W.Z)("Shortcut $1 is reserved by the system.",[e.toUpperCase()])})}else-1===Cc.indexOf(s)&&this.setState({error:null},(()=>{const e=(t.shortcuts||[]).concat(s);this.save(t,e,(()=>{this.refComboInput.current?.focus()}))}))}}else{const e=t.shortcuts?.slice(0,t.shortcuts.length-1);e&&this.setState({error:null},(()=>{this.save(t,e)}))}};deleteCombo=(e,t,s,n)=>{const{HTMLElement:i}=this.context,a=s.filter(((e,t)=>t!==n));if("Delete"===e.key){const s=e.currentTarget.nextElementSibling;this.save(t,a,(()=>{s instanceof i&&s.focus()}))}else if("Backspace"===e.key&&s){const s=e.currentTarget.previousElementSibling||e.currentTarget.nextElementSibling;this.save(t,a,(()=>{s instanceof i&&s.focus()}))}else this.handleKeyEvent(e)};save=(e,t,s)=>{const{name:n}=e;this.setState({error:null},(()=>{ae.Z.setShortcuts(n,t),s&&s()}))};render(){const e=this.getCommand(),t=e&&Array.isArray(e.shortcuts)&&e.shortcuts;return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("div",{className:"SingleShortcut-Toolbar toolbar toolbar-default",children:[(0,zn.jsx)("div",{className:"multiinput",children:(0,zn.jsxs)("div",{className:"multiinput-group",children:[e&&t&&t.map(((s,n)=>(0,zn.jsx)("button",{style:{textTransform:"capitalize"},className:"multiinput-item",onKeyDown:s=>{this.deleteCombo(s,e,t,n)},children:(0,vc.$)(s)},s))),(0,zn.jsx)("input",{type:"text",ref:this.refComboInput,placeholder:t&&0===t.length&&this.props.placeholder||null,onKeyDown:this.handleKeyEvent})]})}),(0,zn.jsx)(oa.ZP,{onClick:this.restoreDefault,image:Kn.GO5.medium,disabled:void 0!==e&&this.isDefault(),tooltip:(0,W.Z)("Restore default shortcut")})]}),this.state.error&&(0,zn.jsx)("p",{className:"SingleShortcut-Error",dangerouslySetInnerHTML:{__html:Kn.Si$.small+this.state.error}})]})}}const Ac=Ic,Sc=[Z.kPrivacyBreakModeIntroductionShow];class Zc extends Un.PureComponent{render(){return(0,zn.jsxs)("div",{className:"popup-scrollarea",children:[(0,zn.jsx)("div",{className:"BreakModePopup--Graphic",dangerouslySetInnerHTML:{__html:Kn.Gvk.large}}),(0,zn.jsx)("h1",{id:"popout-breakmode-title",children:(0,W.Z)("Take a Break")}),(0,zn.jsx)("p",{className:"BreakModePopup-Intro",children:(0,W.Z)("Vivaldi is fading content and pausing media. Focus elsewhere for a while.")}),(0,zn.jsx)("h3",{children:(0,W.Z)("Keyboard Shortcut")}),(0,zn.jsx)(Ac,{name:"COMMAND_BREAKMODE_TOGGLE",placeholder:(0,W.Z)("No shortcut assigned")}),(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:!this.props.prefValues[Z.kPrivacyBreakModeIntroductionShow],onChange:()=>{I.Z.toggle(Z.kPrivacyBreakModeIntroductionShow,!0,!1)}}),(0,zn.jsx)("span",{children:(0,W.Z)("Do not show again")})]})]})}}const Tc=(0,zd.Z)(Zc,Sc),Ec=[Z.kPrivacyBreakModeIntroductionShow];var kc=(0,zn.jsx)(Tc,{});class Nc extends Un.PureComponent{state={shouldShowPopup:Io.Z.getState().isActive&&this.props.prefValues[Z.kPrivacyBreakModeIntroductionShow],isInBreakMode:Io.Z.getState().isActive};componentDidMount=()=>{this.props.inEditor||Io.Z.addListener(this.onBreakModeChanged)};componentWillUnmount=()=>{this.props.inEditor||Io.Z.removeListener(this.onBreakModeChanged)};onBreakModeChanged=()=>{const e=Io.Z.getState().isActive,t=e&&this.props.prefValues[Z.kPrivacyBreakModeIntroductionShow];this.setState({isInBreakMode:e,shouldShowPopup:t})};hidePopup=()=>{this.setState({shouldShowPopup:!1})};menu=()=>[{type:"checkbox",checked:this.props.prefValues[Z.kPrivacyBreakModeIntroductionShow],handler:()=>{I.Z.toggle(Z.kPrivacyBreakModeIntroductionShow,!0,!1)},...(0,fi.Z)("Show Break Mode Introduction")}];render(){return(0,zn.jsx)(oa.ZP,{className:"panel-clickoutside-ignore break-mode",label:(0,W.Z)("Break Mode"),tooltip:this.state.isInBreakMode?(0,W.Z)("End Break"):(0,W.Z)("Take a Break"),onClick:xo.Z.toggleBreakMode,customizeMenu:this.props.customizeMenu,menuOrigin:this.props.menuOrigin,image:this.state.isInBreakMode?Kn._qK[this.props.size]:Kn.Gvk[this.props.size],draggable:this.props.draggable,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,onDrop:this.props.onDrop,onDragEnter:this.props.onDragEnter,mimeType:this.props.mimeType,name:this.props.name,hidePopup:this.hidePopup,popupPosition:this.props.popupPosition,popupClassName:"BreakModePopup ToolbarButtonPopup-DefaultStyles",popupLabelledBy:this.props.prefValues[Z.kPrivacyBreakModeIntroductionShow]?"popout-breakmode-title":void 0,hasPopup:this.props.prefValues[Z.kPrivacyBreakModeIntroductionShow],popupWidth:220,isPopupVisible:this.state.shouldShowPopup,menu:this.menu,size:this.props.size,style:{"--breakModeActive":this.state.isInBreakMode?1:0},commandId:"COMMAND_BREAKMODE_TOGGLE",children:kc})}}const _c=(0,zd.Z)(Nc,Ec);var Pc=s(82649),Mc=s(6320);class Dc extends m.Z{getInitialState(){return[]}getLogsByComponent(e){return this.getState().filter((t=>e.includes(t.component)))}#y=(e,t,s,n)=>{let i=e;return s&&(i=i.filter((e=>!t.some((t=>t===e.component))||!e.tags.some((e=>s.includes(e)))))),n&&(i=i.filter((e=>!t.some((t=>t===e.component))||!n.includes(e.level)))),s||n||(i=i.filter((e=>!t.some((t=>t===e.component))))),i};reduce(e,t){switch(t.actionType){case"COMPONENT_LOGGER_LOG":{let s;return e.length>=1e3?(s=e.slice(1),s.push(t.entry)):s=e.concat(t.entry),s}case"COMPONENT_LOGGER_PRUNE":{const{components:s,tags:n,levels:i}=t;return this.#y(e,s,n,i)}}return e}}const Oc=new Dc;var jc=s(21788);function Lc(e){switch(e){case"warn":return"warning";case"log":return"info";default:return e}}function Rc(e){for(const t of e)if(t instanceof Error)return t}function Bc(e){const{component:t,tags:s,level:n,timestamp:i,args:a}=e,o=V()(i).format("HH:mm:ss.SSS"),r=Jl(a).join(" "),l=`${o} ${n} [${t} - ${s.join(", ")}] ${r}\r\n`,d=Rc(a);return d?`${l}${d.stack}\r\n`:l}var Fc=(0,zn.jsx)("br",{});function Wc(e){const t=Un.useContext(oi.Z);function s(){jc.Z.copyTextToClipboard(Bc(e.entry))}const{args:n,level:i,tags:a,timestamp:o}=e.entry,r=Rc(n);return(0,zn.jsx)(fa,{type:Lc(i),children:(0,zn.jsxs)("div",{className:"StatusPopup-LogEntryMessage","data-index":e.index,onContextMenu:function(e){(0,mi.Z)(t,[{handler:s,...(0,fi.Z)("verb","Copy")}])(e)},children:[(0,zn.jsxs)("span",{className:"StatusPopup-LogEntryTags",children:["[",a.join(", "),"]"]}),Jl(n).join(" ").split("\n").map(((t,s)=>(0,zn.jsxs)(Un.Fragment,{children:[t,Fc]},`line-${e.index}-${s}`))),(0,zn.jsxs)("span",{className:"StatusPopup-LogEntryTimestamp",children:[!!r&&(0,zn.jsx)("span",{className:"StatusPopup-LogEntryStacktrace",title:r.stack,dangerouslySetInnerHTML:{__html:Kn.AE4.small}}),V()(o).format("HH:mm:ss.SSS")]})]})})}const Uc=function(e){const{document:t}=Un.useContext(oi.Z),[s,n]=Un.useState(Nt.of),[i,a]=Un.useState("info"),o=A.Z.get(Z.kMailAccounts);let r=s===Nt.of?e.logs:e.logs.filter((e=>e.tags.includes(s)));return"warn"===i?r=r.filter((e=>["error","warn"].includes(e.level))):"error"===i&&(r=r.filter((e=>"error"===e.level))),(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("div",{className:"StatusPopupViewFilterSelect",children:[(0,zn.jsxs)(Fa.Z,{value:i,onChange:function(e){const t=e.currentTarget.value;a(t)},children:[(0,zn.jsx)("option",{value:"info",children:(0,W.Z)("Log","Info")}),(0,zn.jsx)("option",{value:"warn",children:(0,W.Z)("Log","Warn")}),(0,zn.jsx)("option",{value:"error",children:(0,W.Z)("Log","Error")})]}),"Mail"===e.component&&(0,zn.jsxs)(Fa.Z,{value:s,onChange:function(e){const{value:t}=e.currentTarget;n(t)},children:[(0,zn.jsx)("option",{value:Nt.of,children:(0,W.Z)("All Accounts")},Nt.of),o.map((e=>(0,zn.jsx)("option",{value:e.MAIL_EMAIL,children:e.MAIL_EMAIL},e.MAIL_EMAIL)))]})]}),0===r.length&&(0,zn.jsxs)("div",{className:"StatusPopup-ContentPane StatusPopup-ContentPane--Empty",children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.RXs}}),(0,zn.jsx)("h1",{children:(0,W.Z)("No Logs")}),(0,zn.jsx)("p",{className:"faded-text",children:(0,W.Z)("No logs to show yet.")})]}),r.length>0&&(0,zn.jsx)("div",{className:"StatusPopup-List",tabIndex:r.length?"-1":"0",children:r.map(((e,t)=>(0,zn.jsx)(Wc,{entry:e,index:t},e.timestamp+"__"+t)))}),!e.hideButtons&&(0,zn.jsxs)("div",{className:"StatusPopup-Footer toolbar-default",children:[(0,zn.jsx)(oa.ZP,{onClick:function(){const s=t.createElement("a");s.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(r.map(Bc).join(""))),s.download=`Vivaldi_${e.component}_log.txt`,s.click()},disabled:0===r.length,title:(0,W.Z)("Save to File")}),(0,zn.jsx)(oa.ZP,{onClick:function(){const e=r.map(Bc).join("");jc.Z.copyTextToClipboard(e)},disabled:0===r.length,title:(0,W.Z)("mail","Copy to Clipboard")}),(0,zn.jsx)(oa.ZP,{onClick:()=>l.Z.prune(["oAuth",e.component],s===Nt.of?void 0:[s],"info"===i?void 0:[i]),disabled:0===r.length,title:(0,W.Z)("Clear")})]})]})};var Vc=s(25765),Hc=s(51540),Gc=s(81723),Kc=s(58821),zc=s(97781);const $c=new DOMParser;function Yc(e){const{start:t,end:s}=(0,Kc.aE)(e,!0);let n,i,a="";return e.allDay?(n=V().localeData().longDateFormat("LL"),i=V().localeData().longDateFormat("LL")):(n=(0,Kc.KC)(new Date,new Date(t.valueOf()||s.valueOf()))?"LT":F.ZP.getShortDateFormat()+" LT",i="LT"),e.start&&e.end&&t.valueOf()===s.valueOf()?a=`${t.format(n)}`:e.start&&e.end?a=`${t.format(n)}-${s.format(i)}`:e.end&&(a=`${s.format(n)}`),a}function Xc(e){let t="";if(void 0!==e){t=`${V()(e).format("LT")}`}return t}const Qc=new Set(["a","b","br","div","del","em","h1","h2","h3","h4","h5","h6","hr","i","ins","mark","p","s","sub","sup","span","strike","strong","u"]);function qc(e,t){let s=e;for(let e=0;e<s.length;e++)if("<"===s[e])for(let n=e+1;n<s.length;n++){const i=s[n];if("<"===i){const e=s.slice(n),{encoded:t,original:i}=qc(e,!1),a=n+i.length;s=`${s.slice(0,n)}${t}${s.slice(a)}`,n=a-1}else if(">"===i){if("/"===s[n-1]){const i=s.slice(e+1,n),a=i.match(/\w+/i)?.[0];if(a&&Qc.has(a.toLowerCase())){if(e=n+1,!t){const t=s.slice(e,n);return{encoded:t,original:t}}break}if(!t)return{encoded:`&lt;${i}&gt;`,original:`<${i}>`};s=`${s.slice(0,e)}&lt;${i}&gt;${s.slice(n+1)}`,e=n+6;break}{const i=s.slice(e+1,n),a=i.match(/\w+/i)?.[0];if(a){const o=`</${a}>`,r=s.indexOf(o,n);if(-1!==r){const l=s.slice(n+1,r),d=qc(l,!0),c=d.encoded.length-d.original.length;if(Qc.has(a?.toLowerCase())){if(!t){const e=`<${i}>`;return{encoded:e+d.encoded+o,original:e+l+o}}const n=r+o.length+c;s=`${s.slice(0,e)}<${i}>${d.encoded}</${a}>${s.slice(n)}`,e=n;break}if(!t)return{encoded:`&lt;${i}&gt;`,original:`<${i}>`};const h=n+d.encoded.length+o.length+1;s=`${s.slice(0,e)}&lt;${i}&gt;${d.encoded}&lt;/${a}&gt;${s.slice(h)}`,e=h+12;break}}if(!t)return{encoded:`&lt;${i}&gt;`,original:`<${i}>`};s=`${s.slice(0,e)}&lt;${i}&gt;${s.slice(n+1)}`,e=n+6;break}}if(n===s.length-1){s=`${s.slice(0,e)}&lt;${s.slice(e+1)}`;break}}else">"===s[e]&&(s=`${s.slice(0,e)}&gt;${s.slice(e+1)}`,e+=3);return{encoded:s,original:e}}function Jc(e){return qc(e,!0).encoded}function eh(e,t,s,n){let i=s.trim();if(!i)return null;const a=(0,zc.Nw)(Jc(i),{wholeDocument:!1}).sanitized;return i=function(e){return-1===e.indexOf("<")||$c.parseFromString(e,"text/html").body?.innerText===e}(a)?function(e){const t=e.match(/(\n|[^\r\n]+)/g);return t&&1!==t.length?t.map((e=>-1!==e.indexOf("\n")?"<br />":e.startsWith("-::")?`<p class="delimiter">${e}</p>`:`<p>${e}</p>`)).join(""):e}((0,Hc.Z)(a)):a,(0,zn.jsx)("span",{ref:n,className:`cal-event-${t}`,onClick:t=>function(e,t){const{vivaldiWindowId:s,HTMLAnchorElement:n,HTMLElement:i}=t,a=e.target instanceof i&&e.target.closest("a");e.ctrlKey?e.preventDefault():a instanceof n&&e.currentTarget.contains(a)&&a.href&&((0,wi.ZP)(e),c.ZP.openURL(s,a.href))}(t,e),dangerouslySetInnerHTML:{__html:i}},t)}function th(e,t,s,n){const i=Pr.Z.getCalendars();if(0===i.length)return(0,zn.jsx)("div",{children:(0,W.Z)("You have no calendars set up, event can not be saved")});const a=e.calendarId?i.find((t=>t.id===e.calendarId)):_r.ZP.getDefaultCalendar(e.task);if(!a){const t=e.task?(0,W.Z)("No task list found. Please go to calendar settings to add one."):(0,W.Z)("No calendar found. Please go to calendar settings to add one.");return(0,zn.jsx)("p",{className:"info",children:t})}const o=Pr.Z.getAccounts().find((e=>e.id===a?.accountId));if(!o)return(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Calendar account not found. Go to settings and add a calendar account.")});if("ical"===o.account_type){const e=_r.ZP.createCalendarIcon(a,10);return(0,zn.jsxs)("div",{title:(0,W.Z)("Web Calendar: $1",[a.description||a.name]),children:[(0,zn.jsx)("span",{className:"calendar-dot",dangerouslySetInnerHTML:{__html:e}}),a.description||a.name]})}const r=Pr.Z.getState().accounts.filter((e=>"ical"===e.account_type)).map((e=>e.id)),l=(0,Gc.Z)(Pr.Z.getVisibleCalendars(),r,((e,t)=>e.accountId===t)),d=e.task?l.filter((e=>e.supportedCalendarComponent?.vtodo)):l.filter((e=>e.supportedCalendarComponent?.vevent));return(0,zn.jsx)(oa.ZP,{className:"CalendarSelector",title:_r.ZP.getCalendarDisplayName(a,!0),image:_r.ZP.createCalendarIcon(a,10),menu:()=>function(e){return e.map((e=>{const s=_r.ZP.createCalendarIconPNG(e),n=_r.ZP.getCalendarDisplayName(e,!0);return{handler:()=>t(e.id),label:n,labelEnglish:n,iconPNG:s,iconPNGWhite:s}}))}(d),menuOrigin:"bottomLeft",tabIndex:s})}var sh=s(8336),nh=s(39980),ih=s(76259),ah=s.n(ih);function oh(e){return e.some((e=>"error"===e.level))}function rh(e){switch(e.account_type){case"google":return`<img src="${nh.K}" />`;case"ical":case"caldav":return Kn.eTS.small;case"vivaldi":return ah();default:return Kn.bcq.small}}function lh(e){const[t,s]=Un.useState({}),n=Pr.Z.getAccounts();async function i(e){!function(e){s((t=>({...t,[e.id]:{pending:!0,state:"UNKNOWN",message:""}})))}(e);const t=await Pc.Z.pollCalDAV({accountIds:[e.id],interactive:!0}),n=_r.ZP.getPollResultText(t);let i="SUCCESS";!t.didPoll&&t.error?i="WARNING":t.error&&(i="ERROR"),function(e,t,n){s((s=>({...s,[e.id]:{pending:!1,state:t,message:n}})))}(e,i,n)}return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("div",{className:"StatusPopup-List",children:n.map((e=>{const s=Pr.Z.getCalendars().filter((t=>t.accountId===e.id)),n=Math.max(...s.map((e=>e.lastChecked)).filter(Boolean));return(0,zn.jsx)(Un.Fragment,{children:(0,zn.jsxs)("div",{className:"StatusPopup-Account",children:[(0,zn.jsx)("span",{className:"StatusPopup-AccountIcon",dangerouslySetInnerHTML:{__html:rh(e)}}),(0,zn.jsx)("span",{className:Gn()("StatusPopup-AccountName",{"StatusPopup-AccountName--Local":"local"===e.account_type}),children:e.name}),"local"!==e.account_type&&(0,zn.jsxs)("div",{className:"StatusPopup-AccountStatus",children:[t[e.id]?.pending&&(0,zn.jsx)("span",{className:"spinner",dangerouslySetInnerHTML:{__html:Kn.H0I}}),"ERROR"===t[e.id]?.state&&(0,zn.jsx)("span",{className:"StatusPopup-AccountStatus--Error",title:t[e.id].message,dangerouslySetInnerHTML:{__html:Kn.viW}}),"WARNING"===t[e.id]?.state&&(0,zn.jsx)("span",{className:"StatusPopup-AccountStatus--Warning",title:t[e.id].message,dangerouslySetInnerHTML:{__html:Kn.h6}}),"SUCCESS"===t[e.id]?.state&&(0,zn.jsx)("span",{className:"StatusPopup-AccountStatus--Success",title:t[e.id].message,dangerouslySetInnerHTML:{__html:Kn.JLz}}),(0,zn.jsx)(oa.ZP,{onClick:()=>i(e),title:(0,W.Z)("Refresh")})]}),s.map((e=>{const t=_r.ZP.createCalendarIcon(e,8);return(0,zn.jsxs)(Un.Fragment,{children:[(0,zn.jsx)("span",{className:"StatusPopup-CalendarIcon",dangerouslySetInnerHTML:{__html:t}}),(0,zn.jsx)("span",{className:"StatusPopup-CalendarName",children:e.description||e.name},e.id)]},e.id)})),"local"!==e.account_type&&(0,zn.jsx)("div",{className:"StatusPopup-AccountPoll",children:(0,W.Z)("Last Checked $1",[V()(n).fromNow()])})]})},e.id)}))}),(0,zn.jsx)("div",{className:"StatusPopup-Footer toolbar-default",children:(0,zn.jsx)(oa.ZP,{onClick:()=>async function(e){for(const t of e)await i(t)}(n),title:(0,W.Z)("Refresh All")})})]})}var dh=(0,zn.jsx)("dt",{children:"Id"}),ch=(0,zn.jsx)("dt",{children:"Date"}),hh=(0,zn.jsx)("dt",{children:"UID"}),uh=(0,zn.jsx)("dt",{children:"Sequence"}),ph=(0,zn.jsx)("dt",{children:"Recurrence"}),gh=(0,zn.jsx)("dt",{children:"Exceptions"}),mh=(0,zn.jsx)("div",{className:"StatusPopup-Footer"});function fh(e){const{selectedEvent:t}=e;return(0,zn.jsxs)(zn.Fragment,{children:[0===e.events.length&&(0,zn.jsxs)("div",{className:"StatusPopup-ContentPane StatusPopup-ContentPane--Empty",children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.g1e}}),(0,zn.jsx)("h1",{children:(0,W.Z)("No Events")}),(0,zn.jsx)("p",{className:"faded-text",children:(0,W.Z)("Get started by creating a new event.")}),(0,zn.jsx)("input",{type:"button",className:"primary",value:(0,W.Z)("New Event"),onClick:()=>ie.ZP.showAddEvent({winId:e.windowId})})]}),e.events.length>0&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Upcoming Events")}),(0,zn.jsx)("div",{className:"StatusPopup-List",children:e.events.slice(0,5).map((t=>{const s=_r.ZP.getEventColors(t.calendarId);return(0,zn.jsxs)("button",{tabIndex:A.Z.get(Z.kKeyboardTabToAll),className:Gn()("StatusPopup-Event",{"StatusPopup-Event--AllDay":t.allDay}),onClick:()=>{ue.Z.showCalendar(e.windowId,t.id),e.hidePopup()},style:s,children:[(0,zn.jsx)("span",{className:"StatusPopup-EventIcon",dangerouslySetInnerHTML:{__html:_r.ZP.getEventSquircle()}}),(0,zn.jsx)("span",{className:"StatusPopup-EventDate",children:Yc(t)}),(0,zn.jsx)("span",{className:"StatusPopup-EventTitle",children:t.title||Vc.gT})]},_r.ZP.generateKey(t))}))})]}),t&&(0,zn.jsxs)("dl",{className:"StatusPopup-EventDetail",children:[(0,zn.jsx)("dt",{children:(0,W.Z)("Selected")}),(0,zn.jsx)("dd",{children:t.title}),dh,(0,zn.jsx)("dd",{children:t.id}),ch,(0,zn.jsx)("dd",{children:`${V()(t.start).format("l LT")} - ${V().duration(t.start-t.end).humanize()}`}),hh,(0,zn.jsx)("dd",{children:t.uid}),uh,(0,zn.jsx)("dd",{children:t.sequence}),t.rrule&&(0,zn.jsxs)(zn.Fragment,{children:[ph,(0,zn.jsx)("dd",{children:t.rrule}),gh]}),!!t.recurrenceExceptions?.length&&(0,zn.jsx)(zn.Fragment,{children:(0,zn.jsx)("dd",{children:t.recurrenceExceptions.map(((e,t)=>(0,zn.jsxs)("p",{children:[`${V()(e.date).format("l LT")}`,` Cancel: ${e.cancelled?.toString()??"false"}`,!!e.exception_event_id&&"0"!==e.exception_event_id&&` Exc. Id: ${e.exception_event_id}`]},t)))})})]}),mh]})}function vh(e){const t=Pr.Z.getVisibleEvents();let s;const n=Ze.ZP.getActivePage(e)?.id;if(void 0!==n){const e=Mc.Z.getStateForPage(n).selectedEvent;e&&(s=Pr.Z.getEvent(e),s?.trash&&(s=void 0))}return{upcomingEvents:sh.CP.call(t).sort(((e,t)=>(e.start||e.end)-(t.start||t.end))),selectedEvent:s}}class bh extends Un.PureComponent{static contextType=oi.Z;#x;constructor(e,t){super(e);const s=Oc.getLogsByComponent(["Calendar","oAuth"]);this.state={...vh(t.vivaldiWindowId),selectedPane:e.requestPane?e.requestPane:A.Z.get(Z.kCalendarStatusSelectedPane),logs:s,hasLoggedError:oh(s)}}componentDidMount(){Pr.Z.addListener(this._onStoreChange),Oc.addListener(this._onLogsUpdated),this.#x=setInterval((()=>this._onStoreChange()),be.lb)}componentWillUnmount(){Oc.removeListener(this._onLogsUpdated),this.#x&&clearInterval(this.#x),Pr.Z.removeListener(this._onStoreChange)}_onLogsUpdated=()=>{const e=Oc.getLogsByComponent(["Calendar","oAuth"]);this.setState({logs:e,hasLoggedError:oh(e)})};_onStoreChange=()=>{this.setState(vh(this.context.vivaldiWindowId))};_selectPane=e=>{I.Z.set(Z.kCalendarStatusSelectedPane,e),this.setState({selectedPane:e})};_viewLog=()=>{re.Z.devtoolsPrivate.toggleDevtools(this.context.vivaldiWindowId,"console"),this.props.hidePopup()};_startChangeListeners=()=>{ie.ZP.startAPIChangeListeners(),this.props.hidePopup()};openCalendarSettings=()=>{ue.Z.showSettings(this.context.vivaldiWindowId,"calendar"),this.props.hidePopup()};getContextMenu=()=>[{handler:this.openCalendarSettings,...(0,fi.Z)("Calendar Settings")},{handler:this._viewLog,...(0,fi.Z)("View Log")},{handler:this._startChangeListeners,...(0,fi.Z)("Start Calendar Change Listeners")}];render(){return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("div",{className:"StatusPopup-Header",children:[(0,zn.jsx)("h2",{id:"popup-label-calendarstatus",children:(0,W.Z)("Calendar Status")}),(0,zn.jsxs)("div",{className:"toolbar button-popup-header-toolbar toolbar-default",children:[(0,zn.jsx)(oa.ZP,{onClick:()=>{ue.Z.showCalendar(this.context.vivaldiWindowId),this.props.hidePopup()},menuOrigin:"bottomLeft",title:(0,W.Z)("Show Calendar")}),(0,zn.jsx)(oa.ZP,{menuOrigin:"bottomLeft",image:Kn.bqs.small,menu:this.getContextMenu,tooltip:(0,W.Z)("Settings")})]})]}),(0,zn.jsx)("div",{className:"toolbar toolbar-default",children:(0,zn.jsxs)("div",{className:"toolbar-group equal-width",children:[(0,zn.jsx)(oa.ZP,{title:(0,W.Z)("Events"),isPressed:"events"===this.state.selectedPane,onClick:()=>this._selectPane("events")}),(0,zn.jsx)(oa.ZP,{title:(0,W.Z)("Accounts"),isPressed:"accounts"===this.state.selectedPane,onClick:()=>this._selectPane("accounts")}),(0,zn.jsx)(oa.ZP,{title:(0,W.Z)("Logs"),isPressed:"logs"===this.state.selectedPane,onClick:()=>this._selectPane("logs"),badgeText:this.state.hasLoggedError?"!":""})]})}),(0,zn.jsx)("div",{className:"StatusPopup-Content",children:(0,zn.jsxs)("div",{className:"StatusPopup-ContentPane",children:["accounts"===this.state.selectedPane&&(0,zn.jsx)(lh,{windowId:this.context.vivaldiWindowId}),"events"===this.state.selectedPane&&(0,zn.jsx)(fh,{windowId:this.context.vivaldiWindowId,events:this.state.upcomingEvents,selectedEvent:this.state.selectedEvent,hidePopup:this.props.hidePopup}),"logs"===this.state.selectedPane&&(0,zn.jsx)(Uc,{logs:this.state.logs,component:"Calendar"})]})})]})}}const Ch=bh;const wh=new class{open(e,t){S.Z.dispatch({actionType:"STATUS_POPUP_OPEN",component:e,pane:t})}close(e){S.Z.dispatch({actionType:"STATUS_POPUP_CLOSE",component:e})}},yh={calendarPopupOpen:!1,mailPopupOpen:!1};class xh extends m.Z{getInitialState(){return yh}isOpen(e){switch(e){case"Calendar":return this.getState().calendarPopupOpen;case"Mail":return this.getState().mailPopupOpen}}reduce(e,t){switch(t.actionType){case"STATUS_POPUP_OPEN":return t.pane&&("Mail"===t.component?I.Z.set(Z.kMailStatusSelectedPane,t.pane):"Calendar"===t.component&&I.Z.set(Z.kCalendarStatusSelectedPane,t.pane)),{mailPopupOpen:"Mail"===t.component,calendarPopupOpen:"Calendar"===t.component};case"STATUS_POPUP_CLOSE":if(this.isOpen(t.component))return yh}return e}}const Ih=new xh,Ah=[Z.kCalendarStatusButtonStyle,Z.kFeaturesCalendar];class Sh extends Un.PureComponent{static contextType=oi.Z;state={isPopupOpen:!1,lastPoll:0,hasErrors:!1};componentDidMount=()=>{this.props.inEditor||(Ih.addListener(this.popupStateChanged),Oc.addListener(this.handleLogStoreChange))};componentWillUnmount=()=>{this.props.inEditor||(Ih.removeListener(this.popupStateChanged),Oc.removeListener(this.handleLogStoreChange))};popupStateChanged=()=>{const e=Ih.getState().calendarPopupOpen;this.setState({isPopupOpen:e})};hidePopup=()=>{this.setState({isPopupOpen:!1}),wh.close("Calendar")};togglePopup=()=>{this.setState((e=>({isPopupOpen:!e.isPopupOpen})))};openCalendarSettings=()=>{ue.Z.showSettings(this.context.vivaldiWindowId,"calendar")};getTooltip=()=>(0,W.Z)("Calendar Status");calendarHasErrors=()=>Oc.getLogsByComponent(["Calendar","oAuth"]).some((e=>"error"===e.level));handleLogStoreChange=()=>{this.setState({hasErrors:this.calendarHasErrors()})};menu=()=>{const e=this.props.prefValues[Z.kCalendarStatusButtonStyle];return[{handler:this.openCalendarSettings,...(0,fi.Z)("Calendar Settings")},{items:[{type:"checkbox",checked:"imageandtext"===e,handler:()=>I.Z.set(Z.kCalendarStatusButtonStyle,"imageandtext"),...(0,fi.Z)("Image and Text")},{type:"checkbox",checked:"image"===e,handler:()=>I.Z.set(Z.kCalendarStatusButtonStyle,"image"),...(0,fi.Z)("Image Only")},{type:"checkbox",checked:"text"===e,handler:()=>I.Z.set(Z.kCalendarStatusButtonStyle,"text"),...(0,fi.Z)("title","Text Only")}],...(0,fi.Z)("Button Style")}]};render(){const e=this.props.preview||this.props.inEditor||this.props.prefValues[Z.kFeaturesCalendar]&&this.props.isMailWindow,t=this.props.prefValues[Z.kCalendarStatusButtonStyle],s=!this.props.isMailWindow;return(0,zn.jsx)(oa.ZP,{badgeText:this.state.hasErrors?"!":"",className:Gn()(this.state.hasErrors?"StatusButton--HasError":"StatusButton"),popupLabelledBy:"popup-label-calendarstatus",disabled:s,onClick:this.togglePopup,customizeMenu:this.props.customizeMenu,menuOrigin:this.props.menuOrigin,tooltip:this.getTooltip(),title:"image"!==t?(0,W.Z)("Calendar Status"):void 0,image:"text"!==t?Kn.bcq[this.props.size]:void 0,draggable:this.props.draggable,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,onDrop:this.props.onDrop,onDragEnter:this.props.onDragEnter,mimeType:this.props.mimeType,name:this.props.name,hidePopup:this.hidePopup,popupPosition:this.props.popupPosition,popupClassName:"StatusPopup",popupWidth:400,isPopupVisible:this.state.isPopupOpen,menu:this.menu,size:this.props.size,style:e?void 0:{display:"none"},children:(0,zn.jsx)(Ch,{hidePopup:this.hidePopup,requestPane:this.state.hasErrors?"logs":void 0})})}}const Zh=(0,zd.Z)(Sh,Ah);var Th=s(34155);const Eh=["hour","minute","meridiem"],kh=function(e){return 1===e.length?`0${e}`:e.length>2?e.slice(e.length-2):e};class Nh extends Un.PureComponent{static contextType=oi.Z;#I=!1;hidden=Un.createRef();fieldRefs={hour:Un.createRef(),minute:Un.createRef(),meridiem:Un.createRef()};hr12="";constructor(e){super(e);const t=this.getFormat(),s=t.match(/a/i)?.[0];s&&(this.hr12=s),this.separator=t.match(/h+([^m]*)m+/i)?.[1]??":";const[n="",i=""]=this.props.value.split(":");this.state={hour:n,minute:i,dateCache:V()(`2010-10-20 ${this.props.value}`)}}componentDidUpdate(e){e.value!==this.props.value&&this.setCache()}getFormat=()=>this.props.format||V()().localeData().longDateFormat("LT");setCache=()=>{const[e="",t=""]=this.props.value.split(":");this.setState({hour:e,minute:t,dateCache:V()(`2010-10-20 ${this.props.value}`)})};processChange=e=>{1!==this.state.hour.length&&1!==this.state.minute.length&&this.props.onChange(e)};select=e=>{e.target instanceof this.context.HTMLInputElement&&(e.preventDefault(),e.target.select())};focus=()=>{this.fieldRefs.hour.current?.focus()};onKeyDown=e=>{const{key:t,target:s}=e,n=s.dataset.type;if(t){const s=Eh.indexOf(n);switch(t){case"ArrowRight":e.preventDefault();const t=s+1===Eh.length?s:s+1;return void this.fieldRefs[Eh.slice(t,t+1)[0]].current?.select();case"ArrowLeft":e.preventDefault();const n=0===s?s:s-1;return void this.fieldRefs[Eh.slice(n,n+1)[0]].current?.select();case"ArrowDown":return void(e.altKey&&(e.preventDefault(),this.hidden.current?.showPicker()))}}isNaN(Number(t))&&Th.nextTick((()=>{const{document:e,HTMLInputElement:t}=this.context;e.activeElement instanceof t&&e.activeElement.select()}))};skipToNextField(e){const{document:t}=this.context,s=this.hr12?3:2,n=Eh.indexOf(e)+1;n===s&&A.Z.get(Z.kCalendarAutoTabDatetime)?Th.nextTick((()=>(0,vo.pf)(t))):Th.nextTick((()=>{const e=Eh[Math.min(n,s-1)];this.fieldRefs[e].current?.select()}))}switchMeridiem=e=>{const{document:t}=this.context,{target:s}=e,n="string"==typeof e.key?e.key:"",i=this.state.dateCache.set("minute",parseInt(this.state.minute)).add(12,"hour"),{type:a}=e.target.dataset;"meridiem"===a&&("ArrowUp"===n||"ArrowDown"===n||"wheel"===e.type&&s===t.activeElement||n.toLowerCase()===i.format("a")[0].toLowerCase())&&(e.preventDefault(),this.setInput(i),this.setState({dateCache:i})),"a"!==n.toLowerCase()&&"p"!==n.toLowerCase()?this.onKeyDown(e):this.skipToNextField("meridiem")};onChangeTime=e=>{const{type:t}=e.target.dataset;let s=parseInt(e.target.value);const n=!e.nativeEvent.inputType,i=n&&this.props.step?parseInt(this.props.step):1;let a=!1;if(n&&"minute"===t&&s%i!=0){const e=parseInt(this.state.minute);a=!0,s<e?s=e-s%i:s-=s%i}const o="minute"===t?59:this.hr12?12:23,r="minute"===t?60:this.hr12?12:24;s>o?n?s%=r:this.hr12&&"hour"===t?(s%=r,this.state.dateCache.hour(s+12)):s=o:s<0&&(s=n?(s+r)%r:0);let l=s.toString();n&&(l=kh(l)),a&&e.target.setAttribute("value",l),!n&&(10*s>o||e.target.value.length>=2)&&(l=kh(l),this.skipToNextField(t)),this.setState({[t]:l},(()=>{let{hour:e}=this.state;this.hr12&&parseInt(e)<12&&"pm"===this.state.dateCache.format(this.hr12).toLowerCase()&&(e=String(parseInt(e)+12));const t=V()(this.state.dateCache).set("hour",parseInt(e)).set("minute",parseInt(this.state.minute));t.isValid()&&this.setInput(t)}))};setInput=e=>{const t=this.hidden.current,s=(Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value")||{}).set;t&&s&&(s.call(t,(0,F.mr)(e)),t.dispatchEvent(new Event("input",{bubbles:!0})))};onFocus=e=>{e.persist(),e.preventDefault();const{document:t,HTMLElement:s}=this.context;if(this.#I||!(e.target instanceof s))return;const n=e.target.closest(".dateInput");Th.nextTick((()=>{const{onFocus:i}=this.props;i&&n instanceof s&&(0,vo.sT)(t,n)&&(this.#I=!0,i(e))}))};onBlur=e=>{const{hour:t,minute:s}=this.state;(t.length<2||s.length<2)&&this.setState({hour:kh(t),minute:kh(s)}),e.preventDefault(),e.persist();const n=e.target.closest(".dateInput");Th.nextTick((()=>{const{onBlur:t}=this.props,{document:s,HTMLElement:i}=this.context;t&&n instanceof i&&!(0,vo.sT)(s,n)&&(this.#I=!1,t(e))}))};keepFocusWithin=e=>{e.preventDefault(),(0,vo.sT)(this.context.document,e.currentTarget.nextElementSibling)||this.focus()};forceTimePicker=e=>{e.preventDefault(),this.hidden.current?.showPicker()};renderFields=()=>{const e=this.getFormat().replace(/[hma:]/gi,""),t={onFocus:this.select,onMouseDown:this.select,onMouseUp:e=>e.preventDefault(),onKeyDown:this.onKeyDown,onChange:this.onChangeTime,disabled:this.props.disabled};let s=this.state.hour;return 1!==s.length&&(s=this.hr12?kh(((parseInt(this.state.hour)+11)%12+1).toString()):this.state.hour),(0,zn.jsxs)("span",{className:"faux time",children:[(0,zn.jsx)("input",{...t,className:"dateInputHour",tabIndex:this.props.tabIndex,type:"number",ref:this.fieldRefs.hour,"data-type":"hour",placeholder:(0,W.Z)("hh"),value:s}),(0,zn.jsx)("span",{className:"dateInputSeparator",children:this.separator}),(0,zn.jsx)("input",{...t,className:"dateInputMinute",type:"number",ref:this.fieldRefs.minute,"data-type":"minute",tabIndex:this.props.tabIndex,step:this.props.step,placeholder:(0,W.Z)("time","mm"),value:this.state.minute}),this.hr12&&(0,zn.jsx)("span",{children:e}),this.hr12&&(0,zn.jsx)("input",{...t,type:"text",ref:this.fieldRefs.meridiem,"data-type":"meridiem",className:"dateInputAmPm",tabIndex:this.props.tabIndex,placeholder:"--",value:this.state.dateCache.format(this.hr12).trim(),onKeyDown:this.switchMeridiem,onWheel:this.switchMeridiem,onChange:this.select})]})};render(){return(0,zn.jsxs)("span",{className:"dateInput time",title:this.props.title,onBlur:this.onBlur,onFocus:this.onFocus,children:[(0,zn.jsx)("input",{type:"time",ref:this.hidden,tabIndex:"-1",className:"dateInputHidden",value:this.props.value,disabled:this.props.disabled,onMouseDown:this.keepFocusWithin,onMouseUp:this.forceTimePicker,onChange:this.processChange}),this.renderFields(),(0,zn.jsx)("span",{className:"arrowDown",dangerouslySetInnerHTML:{__html:Kn.yaZ.medium}})]})}}const _h=Nh,Ph=[Z.kKeyboardTabToAll,Z.kClockAlarmPresets,Z.kClockTimers];class Mh extends Un.PureComponent{state={selectedPresetId:null,name:""};isPresetSelected=e=>e.id===this.state.selectedPresetId&&e.name===this.state.name&&this.props.minute===e.minute&&this.props.hour===e.hour;setAlarm=()=>{const e=this.state.name,t=new Date;t.setHours(this.props.hour),t.setMinutes(this.props.minute),t.setSeconds(0),this.setState({selectedPresetId:null,name:""},(()=>{this.props.hidePopup({name:e,date:t.valueOf()},"alarm")}))};setName=e=>{this.setState({name:e.currentTarget.value})};selectPreset=e=>{const t=e.name,s=e.id;this.props.setHour(e.hour),this.props.setMinute(e.minute),this.setState({name:t,selectedPresetId:s})};timeChange=e=>{const t=e.currentTarget.value.split(":"),s=parseInt(t[0]),n=parseInt(t[1]);this.props.setHour(s),this.props.setMinute(n)};savePreset=()=>{K.saveAlarmPreset(this.state.name,this.props.hour,this.props.minute)};setPreview=()=>{this.props.setMode("alarm")};render(){const e=this.props.prefValues[Z.kClockAlarmPresets],t=this.state.selectedPresetId&&K.getAlarmPreset(this.state.selectedPresetId),s=this.props.alarms,n=new Date;n.setHours(this.props.hour),n.setMinutes(this.props.minute);const i=[],a=[];return s.forEach((e=>{this.props.now.valueOf()<e.date?i.push(e):a.push(e)})),(0,zn.jsxs)("div",{className:"ClockPopup-Alarms",children:[(0,zn.jsx)("div",{className:"ClockPopup-Presets",children:e.map((e=>{const s=t&&this.isPresetSelected(e);return(0,zn.jsxs)("div",{className:"ClockPopup-PresetWrapper",children:[(0,zn.jsx)("button",{className:Gn()("ClockPopup-Preset",{"ClockPopup-Preset--selected":s}),tabIndex:this.props.prefValues[Z.kKeyboardTabToAll],onClick:()=>this.selectPreset(e),children:e.name}),(0,zn.jsx)("button",{className:Gn()("ClockPopup-Preset-Clear",{"ClockPopup-Preset-Clear--selected":s}),tabIndex:this.props.prefValues[Z.kKeyboardTabToAll],onClick:()=>K.removeAlarmPreset(e.id),dangerouslySetInnerHTML:{__html:Kn.kze}})]},e.id)}))}),(0,zn.jsxs)("form",{className:"ClockPopup-Custom",onSubmit:this.setAlarm,children:[(0,zn.jsxs)("div",{className:"ClockPopup-Custom-Line",children:[(0,zn.jsxs)("label",{className:"ClockPopup-TimeField",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Time")}),(0,zn.jsx)(_h,{className:"ClockPopup-DateInputField",onChange:this.timeChange,step:"5",title:(0,W.Z)("Alarm time"),onFocus:this.setPreview,value:V()(n).format("HH:mm"),noValidate:!0})]}),(0,zn.jsxs)("label",{className:"ClockPopup-TimeField",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Alarm preset","Name")}),(0,zn.jsx)("input",{className:"ClockPopup-Name",type:"text",onFocus:this.setPreview,placeholder:(0,W.Z)("Alarm preset","Name"),onChange:this.setName,value:this.state.name})]})]}),(0,zn.jsxs)("div",{className:"ClockPopup-Custom-Line ClockPopup-Custom-Line--wrap",children:[(0,zn.jsx)("input",{disabled:this.state.name.length<2||t&&t.name===this.state.name,className:"ClockPopup-SavePreset",type:"button",onClick:this.savePreset,value:(0,W.Z)("Save Preset")}),(0,zn.jsx)("input",{className:"ClockPopup-Start",type:"submit",value:(0,W.Z)("verb","Set")})]})]})]})}}const Dh=(0,zd.Z)(Mh,Ph),Oh=[Z.kKeyboardTabToAll,Z.kClockCountdownPresets,Z.kClockTimers];class jh extends Un.PureComponent{state={selectedPresetId:null,name:""};isPresetSelected=e=>{const t=60*this.props.minute+3600*this.props.hour;return e.id===this.state.selectedPresetId&&e.name===this.state.name&&t===e.seconds};setCountdown=()=>{const e=this.state.name,t=V()().add(this.props.hour,"hours").add(this.props.minute,"minutes").valueOf();this.setState({selectedPresetId:null,name:""},(()=>{this.props.hidePopup({name:e,date:t},"countdown")}))};setMinute=e=>{const{value:t}=e.currentTarget,s=Math.min(Math.max(parseInt(t),0),59);this.props.setMinute(s)};setHour=e=>{const{value:t}=e.currentTarget,s=Math.min(Math.max(parseInt(t),0),23);this.props.setHour(s)};decrementHour=()=>{this.props.setHour(this.props.hour-1)};incrementHour=()=>{this.props.setHour(this.props.hour+1)};decrementMinute=()=>{this.props.setMinute(this.props.minute-1)};incrementMinute=()=>{this.props.setMinute(this.props.minute+1)};setName=e=>{this.setState({name:e.currentTarget.value})};setPreview=()=>{this.props.setMode("countdown")};handleFocus=e=>{this.setPreview(),e.target.select()};selectPreset=e=>{const t=V().duration(e.seconds,"seconds"),s=e.name,n=t.hours(),i=t.minutes();this.props.setHour(n),this.props.setMinute(i),this.setState({name:s,selectedPresetId:e.id})};savePreset=()=>{const e=60*this.props.hour*60+60*this.props.minute;K.saveCountdownPreset(this.state.name,e)};render(){const e=this.props.prefValues[Z.kClockCountdownPresets],t=this.state.selectedPresetId&&K.getCountdownPreset(this.state.selectedPresetId),s=this.props.countdowns,n=[],i=[];return s.forEach((e=>{this.props.now.valueOf()<e.date?n.push(e):i.push(e)})),(0,zn.jsxs)("div",{className:"ClockPopup-Countdowns",children:[(0,zn.jsx)("div",{className:"ClockPopup-Presets",children:e.map((e=>{const s=t&&this.isPresetSelected(e);return(0,zn.jsxs)("div",{className:"ClockPopup-PresetWrapper",children:[(0,zn.jsx)("button",{className:Gn()("ClockPopup-Preset",{"ClockPopup-Preset--selected":s}),tabIndex:this.props.prefValues[Z.kKeyboardTabToAll],onClick:()=>this.selectPreset(e),children:e.name}),(0,zn.jsx)("button",{className:Gn()("ClockPopup-Preset-Clear",{"ClockPopup-Preset-Clear--selected":s}),tabIndex:this.props.prefValues[Z.kKeyboardTabToAll],onClick:()=>K.removeCountdownPreset(e.id),dangerouslySetInnerHTML:{__html:Kn.kze}})]},e.id)}))}),(0,zn.jsxs)("form",{className:"ClockPopup-Custom",onSubmit:this.setCountdown,children:[(0,zn.jsxs)("div",{className:"ClockPopup-Custom-Line",children:[(0,zn.jsxs)("label",{className:"ClockPopup-TimeField",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Hours")}),(0,zn.jsx)("input",{className:"ClockPopup-DateInputField",type:"number","data-type":"hour",step:1,min:0,max:23,onFocus:this.handleFocus,placeholder:(0,W.Z)("hh"),onChange:this.setHour,value:this.props.hour}),(0,zn.jsxs)("div",{className:"ClockPopup-Spinner-Wrapper",children:[(0,zn.jsx)("button",{tabIndex:this.props.prefValues[Z.kKeyboardTabToAll],disabled:23===this.props.hour,onClick:this.incrementHour,type:"button",className:"ClockPopup-Spinner ClockPopup-Spinner--up"}),(0,zn.jsx)("button",{tabIndex:this.props.prefValues[Z.kKeyboardTabToAll],disabled:0===this.props.hour,type:"button",onClick:this.decrementHour,className:"ClockPopup-Spinner ClockPopup-Spinner--down"})]})]}),(0,zn.jsxs)("label",{className:"ClockPopup-TimeField",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Minutes")}),(0,zn.jsx)("input",{className:"ClockPopup-DateInputField",type:"number","data-type":"minute",step:1,min:0,max:59,placeholder:(0,W.Z)("time","mm"),onChange:this.setMinute,onFocus:this.handleFocus,value:this.props.minute}),(0,zn.jsxs)("div",{className:"ClockPopup-Spinner-Wrapper",children:[(0,zn.jsx)("button",{tabIndex:this.props.prefValues[Z.kKeyboardTabToAll],disabled:59===this.props.minute,onClick:this.incrementMinute,type:"button",className:"ClockPopup-Spinner ClockPopup-Spinner--up"}),(0,zn.jsx)("button",{tabIndex:this.props.prefValues[Z.kKeyboardTabToAll],disabled:0===this.props.minute,onClick:this.decrementMinute,type:"button",className:"ClockPopup-Spinner ClockPopup-Spinner--down"})]})]}),(0,zn.jsxs)("label",{className:"ClockPopup-TimeField",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Countdown preset","Name")}),(0,zn.jsx)("input",{className:"ClockPopup-Name",type:"text",placeholder:(0,W.Z)("Countdown preset","Name"),onChange:this.setName,onFocus:this.handleFocus,value:this.state.name})]})]}),(0,zn.jsxs)("div",{className:"ClockPopup-Custom-Line ClockPopup-Custom-Line--wrap",children:[(0,zn.jsx)("input",{disabled:this.state.name.length<2||t&&t.name===this.state.name,className:"ClockPopup-SavePreset",type:"button",onClick:this.savePreset,value:(0,W.Z)("Save Preset")}),(0,zn.jsx)("input",{disabled:0===this.props.hour&&0===this.props.minute,className:"ClockPopup-Start",type:"submit",value:(0,W.Z)("Start")})]})]})]})}}const Lh=(0,zd.Z)(jh,Oh),Rh=[Z.kKeyboardTabToAll,Z.kClockShowSeconds,Z.kClockMode,Z.kClockTimers];class Bh extends Un.PureComponent{constructor(e){super(e),this.state={alarmHour:13,alarmMinute:37,countdownHour:0,countdownMinute:0,previewMode:"alarm"===this.props.prefValues[Z.kClockMode]?"alarm":"countdown"}}setAlarmHour=e=>{this.setState({alarmHour:e})};setAlarmMinute=e=>{this.setState({alarmMinute:e})};setCountdownHour=e=>{this.setState({countdownHour:e})};setCountdownMinute=e=>{this.setState({countdownMinute:e})};setMode=e=>{I.Z.set(Z.kClockMode,e),this.setState({previewMode:e})};setPreviewMode=e=>{this.setState({previewMode:e})};getClockStyle=()=>{const e=this.props.now.getHours(),t=this.props.prefValues[Z.kClockShowSeconds]?this.props.now.getSeconds():0,s=this.props.now.getMinutes(),n=s/60,i={"--hourDeg":(e+n)%12*30-90+"deg","--minuteDeg":6*s+"deg","--secondDeg":this.props.prefValues[Z.kClockShowSeconds]?6*t+360*s+60*e*360+"deg":"0deg"};if("countdown"===this.state.previewMode&&(i["--hourPercent"]=this.state.countdownHour<12?this.state.countdownHour/.12:100,i["--minutePercent"]=this.state.countdownMinute/.6),"alarm"===this.state.previewMode){const t=this.state.alarmHour>e?this.state.alarmHour-e:this.state.alarmHour===e&&this.state.alarmMinute>s?0:this.state.alarmHour-e+24,a=t>0?t-n:0,o=this.state.alarmMinute>s?this.state.alarmMinute-s:this.state.alarmMinute-s+60;i["--hourPercent"]=a<12?a/.12:100,i["--minutePercent"]=o/.6}return i};getInfoText=e=>{const t=e.filter((e=>"alarm"===e.type)),s=e.filter((e=>"countdown"===e.type));return t.length>0&&s.length>0?(0,W.Z)("$1 alarm","$1 alarms",[t.length])+", "+(0,W.Z)("$1 countdown","$1 countdowns",[s.length]):t.length>0?(0,W.Z)("$1 alarm","$1 alarms",[t.length]):s.length>0?(0,W.Z)("$1 countdown","$1 countdowns",[s.length]):V()().format(K.getTimeAndDateFormat())};render(){const e=$.getState(),t=e.filter((e=>this.props.now.valueOf()<e.date));return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("div",{className:"ClockPopup-Header",children:[(0,zn.jsx)("h2",{id:"popup-label-clockpopup",children:(0,W.Z)("Clock")}),(0,zn.jsx)("div",{className:"info",children:this.getInfoText(t)})]}),(0,zn.jsxs)("div",{className:"popup-scrollarea",children:[(0,zn.jsx)("div",{style:this.getClockStyle(),className:Gn()("ClockPopup-BigClock",{"ClockPopup-BigClock--ShowSeconds":this.props.prefValues[Z.kClockShowSeconds]}),dangerouslySetInnerHTML:{__html:Kn.gep}}),(0,zn.jsx)("div",{className:"ClockPopup-Active",children:t.map(((e,t)=>(0,zn.jsxs)("div",{className:"ClockPopup-Timer ClockPopup-Timer--Active",children:[(0,zn.jsx)("button",{className:"ClockPopup-Timer-Name",children:K.getActiveLabel(e,!0)}),(0,zn.jsx)("button",{className:"ClockPopup-Timer-Clear",tabIndex:this.props.prefValues[Z.kKeyboardTabToAll],onClick:()=>{return t=e.id,void S.Z.dispatch({actionType:"TIMER_REMOVE",timerId:t});var t},dangerouslySetInnerHTML:{__html:Kn.kze}})]},e.id)))}),(0,zn.jsx)("div",{className:"toolbar toolbar-default",children:(0,zn.jsxs)("div",{className:"toolbar-group",children:[(0,zn.jsx)(oa.ZP,{title:(0,W.Z)("Countdown"),isPressed:"countdown"===this.props.prefValues[Z.kClockMode],onClick:()=>this.setMode("countdown")}),(0,zn.jsx)(oa.ZP,{title:(0,W.Z)("Alarm"),isPressed:"alarm"===this.props.prefValues[Z.kClockMode],onClick:()=>this.setMode("alarm")})]})}),"countdown"===this.props.prefValues[Z.kClockMode]&&(0,zn.jsx)(Lh,{now:this.props.now,hour:this.state.countdownHour,minute:this.state.countdownMinute,hidePopup:this.props.hidePopup,setHour:this.setCountdownHour,setMinute:this.setCountdownMinute,setMode:this.setPreviewMode,countdowns:e.filter((e=>"countdown"===e.type))}),"alarm"===this.props.prefValues[Z.kClockMode]&&(0,zn.jsx)(Dh,{now:this.props.now,alarms:e.filter((e=>"alarm"===e.type)),hidePopup:this.props.hidePopup,hour:this.state.alarmHour,minute:this.state.alarmMinute,setHour:this.setAlarmHour,setMode:this.setPreviewMode,setMinute:this.setAlarmMinute})]})]})}}const Fh=(0,zd.Z)(Bh,Rh);const Wh=new class{#A;#S=[];#Z=[];#T=-1;addListener(e,t){"minutes"===e?this.#S.push(t):this.#Z.push(t),clearTimeout(this.#A),this.#E()}removeListener(e){this.#S=this.#S.filter((t=>t!==e)),this.#Z=this.#Z.filter((t=>t!==e)),this.#S.length+this.#Z.length===0&&(clearTimeout(this.#A),this.#A=null)}#k(e){for(const t of this.#Z)t(e)}#N(e){for(const t of this.#S)t(e)}#E(){let e=0;const t=new Date,s=t.getMinutes();this.#k(t),this.#T!==s&&(this.#N(t),this.#T=s),e=this.#Z.length>0?1e3-t.getMilliseconds():1e3*(60-t.getSeconds())-t.getMilliseconds(),this.#A=setTimeout((()=>this.#E()),e)}},Uh=[Z.kClockButtonShowDate,Z.kClockButtonShowName,Z.kClockButtonStyle,Z.kClockAlarmPresets,Z.kClockCountdownPresets,Z.kClockNotificationSound,Z.kClockShowSeconds],Vh={"":(0,W.Z)("other","None"),"../../resources/notification_ding.opus":(0,W.Z)("Ding"),"../../resources/notification_rooster.opus":(0,W.Z)("Rooster"),"../../resources/notification_tada.opus":(0,W.Z)("Tada")};class Hh extends Un.PureComponent{buttonRef=Un.createRef();constructor(e){super(e),this.now=new Date,this.state={isPopupOpen:!1,hour:this.now.getHours(),minute:this.now.getMinutes(),width:34,leadingTimer:this.getActiveTimers()[0]},this.isVertical="left"===e.popupPosition||"right"===e.popupPosition}componentDidMount(){this.props.inEditor||(this.isVertical&&this.recalculateWidth(),Wh.addListener(this.hasTimerSecondsPrecision?"seconds":"minutes",this.onTick),$.addListener(this.#_))}componentDidUpdate(e){this.isVertical&&e.prefValues!==this.props.prefValues&&this.recalculateWidth(),e.prefValues[Z.kClockShowSeconds]!==this.props.prefValues[Z.kClockShowSeconds]&&this.updateTimerPrecision()}componentWillUnmount(){this.props.inEditor||(Wh.removeListener(this.onTick),$.removeListener(this.#_))}#P(){return $.getState().slice().sort(((e,t)=>e.date-t.date))}#_=()=>{this.setState({leadingTimer:this.getActiveTimers()[0]},(()=>this.updateTimerPrecision()))};recalculateWidth=()=>{const e=this.buttonRef.current?.buttonRef?.getBoundingClientRect();e?.height&&this.setState({width:Math.round(Math.min(Math.max(34,e.height),160))})};updateTimerPrecision=()=>{const e=this.hasTimerSecondsPrecision,t=this.props.prefValues[Z.kClockShowSeconds]||"countdown"===this.getActiveMode();e!==t&&(this.hasTimerSecondsPrecision=t,Wh.removeListener(this.onTick),Wh.addListener(this.hasTimerSecondsPrecision?"seconds":"minutes",this.onTick))};onTick=e=>{this.now=e;const t=this.now.getMinutes(),s=this.now.getHours(),n=this.now.getSeconds();let i=!1;this.props.prefValues[Z.kClockShowSeconds]&&(this.state.isPopupOpen||"image"!==this.props.prefValues[Z.kClockButtonStyle])||"countdown"===this.state.leadingTimer?.type?(this.setState({minute:t+n/60}),i=!0):t===this.state.minute&&s===this.state.hour||(this.setState({hour:s,minute:t}),i=!0),$.getState().forEach((e=>{Math.round(e.date/1e3)===Math.round(this.now.valueOf()/1e3)&&(this.setState({leadingTimer:this.getActiveTimers()[1],...i?{}:{minute:t+n/60}}),this.updateTimerPrecision())}))};getActiveTimers=()=>$.getState().filter((e=>this.now.valueOf()<e.date));getActiveMode=()=>this.state.leadingTimer?.type??"time";hidePopup=(e,t)=>{this.state.isPopupOpen&&this.setState({isPopupOpen:!1},(()=>{e&&t&&Q(e,t)}))};togglePopup=()=>{this.setState((e=>({isPopupOpen:!e.isPopupOpen})))};#M(){const{leadingTimer:e}=this.state,t=this.now.getHours(),s=this.now.getMinutes(),n={"--hourDeg":30*(t+s/60)+"deg","--minuteDeg":`${6*s+360*t}deg`,"--clockWidth":`${this.state.width}px`};if(e&&"countdown"===e.type){const t=V()(e.date).diff(this.now,"seconds"),s=V().duration(t,"seconds"),i=s.hours()%12/.12,a=0===s.minutes()&&0===i;n["--countdownHourPercent"]=i,n["--countdownMinutePercent"]=a?s.seconds()/.6:s.minutes()/.6,a&&(n["--countdownSeconds"]="rotate(calc(var(--minuteDeg) + 90deg)) scaleX(-1)")}return this.getActiveTimers().some((e=>"alarm"===e.type))?n["--clockAlarmSet"]=1:n["--clockAlarmSet"]=0,n}getButtonText=()=>{const e="image"!==this.props.prefValues[Z.kClockButtonStyle],t=this.props.prefValues[Z.kClockButtonShowDate],s=this.props.prefValues[Z.kClockButtonShowName],{leadingTimer:n}=this.state;let i="";return"countdown"!==n?.type&&(e&&t?i=V()(this.now).format(K.getTimeAndDateFormat()):e?i=V()(this.now).format(K.getTimeFormat()):t&&(i=V()(this.now).format(K.getDateFormat()))),e&&n?"countdown"===n.type?K.getActiveLabel(n,s):(i?i+" – ":"")+K.getName(n):i};getTooltip=()=>{const e=this.getActiveTimers();let t=V()(this.now).format("LL LT");if(e.length>0){const s=e.filter((e=>"countdown"===e.type)),n=e.filter((e=>"alarm"===e.type));s.length>0&&(t+="\n\n"+(0,W.Z)("Countdowns"),s.forEach((e=>{t+="\n"+K.getActiveLabel(e,!0)}))),n.length>0&&(t+="\n\n"+(0,W.Z)("Alarms"),n.forEach((e=>{t+="\n"+K.getActiveLabel(e,!0)})))}return t};menu=()=>{const e=this.props.prefValues[Z.kClockButtonStyle];return[{isVisible:()=>this.props.prefValues[Z.kClockCountdownPresets].length>0,items:this.props.prefValues[Z.kClockCountdownPresets].map((e=>({handler:()=>K.setCountdownWithPreset(e),...(0,fi.Z)(e.name)}))),...(0,fi.Z)("New Countdown")},{isVisible:()=>this.props.prefValues[Z.kClockAlarmPresets].length>0,items:this.props.prefValues[Z.kClockAlarmPresets].map((e=>({handler:()=>K.setAlarmWithPreset(e),...(0,fi.Z)(e.name)}))),...(0,fi.Z)("New Alarm")},{items:[{type:"checkbox",checked:"imageandtext"===e,handler:()=>I.Z.set(Z.kClockButtonStyle,"imageandtext"),...(0,fi.Z)("Image and Text")},{type:"checkbox",checked:"image"===e,handler:()=>I.Z.set(Z.kClockButtonStyle,"image"),...(0,fi.Z)("Image Only")},{type:"checkbox",checked:"text"===e,handler:()=>I.Z.set(Z.kClockButtonStyle,"text"),...(0,fi.Z)("title","Text Only")}],...(0,fi.Z)("Button Style")},{items:[{type:"checkbox",checked:this.props.prefValues[Z.kClockButtonShowName],handler:()=>I.Z.set(Z.kClockButtonShowName,!0),...(0,fi.Z)("Show Name")},{type:"checkbox",checked:!this.props.prefValues[Z.kClockButtonShowName],handler:()=>I.Z.set(Z.kClockButtonShowName,!1),...(0,fi.Z)("Time Only")}],...(0,fi.Z)("Button Label")},{items:Object.keys(Vh).map((e=>{const t=Vh[e];return{type:"checkbox",checked:this.props.prefValues[Z.kClockNotificationSound]===e,handler:()=>I.Z.set(Z.kClockNotificationSound,e),...(0,fi.Z)(t)}})),...(0,fi.Z)("Notification Sound")},{type:"checkbox",checked:this.props.prefValues[Z.kClockShowSeconds],handler:()=>I.Z.set(Z.kClockShowSeconds,!this.props.prefValues[Z.kClockShowSeconds]),...(0,fi.Z)("Show Seconds")},{type:"checkbox",checked:this.props.prefValues[Z.kClockButtonShowDate],handler:()=>I.Z.set(Z.kClockButtonShowDate,!this.props.prefValues[Z.kClockButtonShowDate]),...(0,fi.Z)("Show Date")}]};render(){const e=this.getActiveMode(),t=this.props.prefValues[Z.kClockButtonStyle];return(0,zn.jsx)(oa.ZP,{className:`ClockButton ClockButton--${e}`,isOn:"time"!==e,onClick:this.togglePopup,customizeMenu:this.props.customizeMenu,menuOrigin:this.props.menuOrigin,ref:this.buttonRef,tooltip:this.getTooltip(),title:this.getButtonText(),image:"text"!==t||this.props.preview?Kn.kY4[this.props.size]:void 0,draggable:this.props.draggable,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,onDrop:this.props.onDrop,onDragEnter:this.props.onDragEnter,mimeType:this.props.mimeType,name:this.props.name,popupWidth:210,hidePopup:this.hidePopup,popupPosition:this.props.popupPosition,popupClassName:"ClockPopup",popupLabelledBy:"popup-label-clockpopup",isPopupVisible:this.state.isPopupOpen,menu:this.menu,style:this.#M(),size:this.props.size,children:(0,zn.jsx)(Fh,{now:this.now,firstTimer:this.state.leadingTimer,hidePopup:this.hidePopup})})}}const Gh=(0,zd.Z)(Hh,Uh);var Kh=s(15908),zh=s(33466),$h=s(61667),Yh=s(68691),Xh=s(49777);const Qh={top:0,right:0,bottom:0,left:0},qh={data:{fill:"var(--colorHighlightBg)",fillOpacity:.2,stroke:"var(--colorHighlightBg)",strokeWidth:2}},Jh={grid:{stroke:"var(--colorFgAlpha)"}};var eu=(0,zn.jsx)(Kh._,{preserveAspectRatio:"none"}),tu=(0,zn.jsx)(zh.E,{standalone:!1,style:Jh,offsetY:-10}),su=(0,zn.jsx)(zh.E,{dependentAxis:!0,standalone:!1,style:Jh,offsetX:-10});function nu({downloadId:e,speed:t}){const[s,n]=Un.useState(Xh.mb.get(e).reduce(((e,t)=>Math.max(e,t)),.1)),[i,a]=Un.useState(Xh.mb.get(e).map(((e,t)=>({x:t,y:e}))));return Un.useEffect((()=>{t>s&&n(1.1*t),a((e=>{const s=(e.at(-1)?.x??-1)+1;return e.push({x:s,y:t}),e.length>300&&e.splice(0,1),e}))}),[s,t]),i.length<=1?null:(0,zn.jsxs)($h.k,{height:50,padding:Qh,domain:{x:[i[0].x,Math.max(i.at(-1)?.x??0,5)],y:[0,s]},domainPadding:{x:[Math.abs(Math.min(300,i.length-300)),0]},scale:"linear",containerComponent:eu,children:[tu,su,(0,zn.jsx)(Yh.b,{data:i,interpolation:"natural",standalone:!1,style:qh})]})}var iu=s(82313),au=(0,zn.jsx)(aa,{type:"download-speed"});class ou extends Un.PureComponent{static contextType=oi.Z;pathButtonTitle=(0,W.Z)("Show in File Manager");_openUrl=()=>{this.props.url&&c.ZP.openURL(this.context.vivaldiWindowId,(0,Ar.q9)(this.props.url))};render(){const{node:e}=this.props,t="complete"===e?.state?e.totalBytes:e?.bytesReceived||0,s=e?(0,iu.Z)(t):"",n=e?e.currentSpeed:0,i=V()(e?.endTime),a=V()(e?.startTime),o="complete"===e?.state&&i.isValid()&&a.isValid()?e?.bytesReceived/V().duration(i.diff(a)).asSeconds():n,r=e?(0,W.Z)("$1/s",[(0,iu.Z)(o)]):"",l="in_progress"===e?.state;return(0,zn.jsxs)("div",{className:"container",children:[(0,zn.jsx)("div",{className:"completed",children:s}),(0,zn.jsx)("div",{className:"speed",children:r?(0,zn.jsxs)(zn.Fragment,{children:[au,r]}):(0,W.Z)("Download Speed")}),(0,zn.jsx)("div",{className:"chart",children:e&&(0,zn.jsx)(nu,{downloadId:e.id,speed:n},this.props.finalName)}),(0,zn.jsxs)("div",{className:"actionbuttons",children:[this.props.canResumeDownload&&this.props.hasPausedTransfersSelected?(0,zn.jsx)("input",{type:"button",className:"action-button",value:(0,W.Z)("navigation","Resume"),tabIndex:this.props.tabIndex,onClick:this.props.onDownloadResume}):(0,zn.jsx)("input",{type:"button",className:"action-button",disabled:l,value:(0,W.Z)("navigation","Restart"),tabIndex:this.props.tabIndex,onClick:this._openUrl}),(0,zn.jsx)("input",{id:"show-in-folder-button",type:"button",className:"action-button",tabIndex:this.props.tabIndex,disabled:l,onClick:this.props.openFile,value:this.pathButtonTitle,title:this.pathButtonTitle})]})]})}}const ru=ou,lu="in_progress",du="complete",cu="interrupted";function hu({item:e}){const t=e.state===lu,s=e.paused||e.state===cu,n=e.bytesReceived/e.totalBytes,i=e.totalBytes&&e.state!==du?100*n:100,a=Math.min(e.totalBytes/100,500);return(0,zn.jsx)("progress",{style:{"--duration":a+"ms","--progress":n.toFixed(2)},className:Gn()("DownloadItem-ProgressBar",{"unknown-filesize":!e.totalBytes,visible:t,loading:!s}),value:i,max:100})}function uu({node:e}){const{bytesReceived:t=0,fileSize:s=1,startTime:n="",endTime:i=""}=e||{},a=(t/s*100).toFixed(0),o=!isNaN(parseInt(a)),r=V()(n),l=V()(i),d=r.isSame(l,"day");return(0,zn.jsx)("div",{className:"panel-timefield",children:(0,zn.jsxs)("div",{className:"container",children:[(0,zn.jsx)("div",{className:"started",children:(0,W.Z)("Started:")}),(0,zn.jsx)("div",{className:"started-time",children:r.isValid()?r.format("l, LTS"):""}),(0,zn.jsx)("div",{className:"completed",children:i?(0,W.Z)("Finished:"):o&&(0,W.Z)("Completed:")}),(0,zn.jsx)("div",{className:"progress",children:l.isValid()?l.format(d?"LTS":"l, LTS"):e&&o&&(0,zn.jsxs)(zn.Fragment,{children:[a+"%",(0,zn.jsx)(hu,{item:e})]})})]})})}var pu=s(86662);const gu=(0,W.Z)("File Name");class mu extends Un.Component{render(){const e=this.props.downloadItem,t=e?.filename||"",s=e?.url||"",{filename:n,extension:i}=(0,pu.QQ)(t),a=n+i,o=e&&e?.bytesReceived>0?this.props.getItemPath(e.id):"";return(0,zn.jsxs)("div",{className:Gn()({data:!0,"downloads-cardwrapper":!0,cardview:!0,disabled:!e}),children:[(0,zn.jsxs)("div",{className:"downloads-panel-actions",children:[(0,zn.jsx)("span",{className:"download-panel title",title:a,children:n.length?(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("span",{className:"DownloadItem-FileName-Name",children:n}),(0,zn.jsx)("span",{className:"DownloadItem-FileName-Extension",children:i})]}):gu}),(0,zn.jsx)("input",{type:"text",className:"cardview url downloads",tabIndex:this.props.keyAccess,placeholder:(0,W.Z)("File URL"),disabled:!e,value:s,title:s,readOnly:!0}),(0,zn.jsx)("input",{type:"text",className:"cardview url downloads",tabIndex:this.props.keyAccess,placeholder:(0,W.Z)("Local File"),disabled:!e,value:o,title:o,readOnly:!0})]}),(0,zn.jsx)(uu,{node:e}),(0,zn.jsx)("div",{className:"panel-pathfield",children:e&&(0,zn.jsx)(ru,{node:e,finalName:a,url:s,tabIndex:this.props.keyAccess,openFile:this.props.onShow,canResumeDownload:this.props.canResumeDownload,hasPausedTransfersSelected:this.props.hasPausedTransfersSelected,onDownloadResume:this.props.onDownloadResume})})]})}}const fu=mu,vu=[Z.kKeyboardTabToAll];var bu=(0,zn.jsx)(aa,{type:"close",size:16});const Cu=function({title:e,showCloseButton:t}){const s=(0,Eo.Z)(vu),n=(0,Un.useContext)(oi.Z);return(0,zn.jsxs)("h1",{children:[(0,zn.jsx)("span",{id:"ui-region-panel-title",children:e}),t&&(0,zn.jsx)("button",{className:"close transparent",onClick:()=>en.Z.closePanel(n.vivaldiWindowId),title:(0,W.Z)("Close Panel"),tabIndex:s[Z.kKeyboardTabToAll],children:bu})]})};function wu({downloadItem:e,canResumeDownload:t,filter:s,hasActiveTransfersSelected:n,hasCompletedTransfers:i,hasCompletedTransfersSelected:a,hasPausedTransfersSelected:o,hasDownload:r,keyAccess:l,onDownloadResume:d,onFilterChange:c,onRemoveAllFinished:h,onRemoveSelected:u,onRestartSelectedDownload:p,onStopSelectedDownload:g,title:m,showCloseButton:f}){const{document:v}=(0,Un.useContext)(oi.Z),b=(0,Un.useRef)(),[C,w]=(0,Un.useState)(s),[,y]=(0,Un.useTransition)();(0,Un.useEffect)((()=>{v.activeElement!==b.current&&w(s)}),[v.activeElement,s]);return(0,zn.jsxs)("header",{children:[(0,zn.jsx)(Cu,{title:m,showCloseButton:f}),(0,zn.jsxs)("div",{className:"toolbar toolbar-default toolbar-wrap",role:"toolbar","aria-label":(0,W.Z)("toolbar label","Downloads"),children:[(0,zn.jsx)("input",{ref:b,type:"search",placeholder:(0,W.Z)("verb","Search"),value:C,disabled:!r&&!s,onChange:e=>{const{value:t}=e.target;w(t),y((()=>{c(t)}))}}),(0,zn.jsx)("div",{className:"toolbar",children:(0,zn.jsxs)("div",{className:"toolbar-group",children:[o||t?(0,zn.jsx)(oa.ZP,{tooltip:(0,W.Z)("Resume Download"),onClick:d,image:Kn.sxZ.small}):(0,zn.jsx)(oa.ZP,{tooltip:(0,W.Z)("verb","Pause"),onClick:g,disabled:!n,image:Kn.Q9E.small}),(0,zn.jsx)(oa.ZP,{tooltip:(0,W.Z)("command","Restart"),disabled:!e,onClick:p,image:Kn.Ibx.small}),(0,zn.jsx)(oa.ZP,{tooltip:(0,W.Z)("verb","Remove"),disabled:!(a||o||e&&"interrupted"===e.state),onClick:u,image:Kn.M2k.small}),(0,zn.jsx)(oa.ZP,{tooltip:(0,W.Z)("Remove All"),disabled:!i,onClick:h,image:Kn.DwE.small})]})})]})]})}function yu(){return(0,zn.jsx)("div",{className:"download-placeholder",children:(0,zn.jsxs)("div",{className:"download-empty-state",children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.ZsG}}),(0,zn.jsx)("h1",{children:(0,W.Z)("Your download list is empty")}),(0,zn.jsx)("p",{className:"faded-text",children:(0,W.Z)("As soon as you download something, it will appear here.")})]})})}var xu=s(8874);function Iu({onClick:e}){return(0,zn.jsx)("button",{onClick:e,title:(0,W.Z)("verb","Pause"),className:"ActionButton circular",tabIndex:"-1",dangerouslySetInnerHTML:{__html:Kn.Q9E.small}})}function Au({onClick:e}){return(0,zn.jsx)("button",{onClick:e,title:(0,W.Z)("Resume Download"),className:"ActionButton circular resume",tabIndex:"-1",dangerouslySetInnerHTML:{__html:Kn.sxZ.small}})}function Su({onClick:e}){return(0,zn.jsx)("button",{onClick:e,title:(0,W.Z)("Show in File Manager"),className:"ActionButton circular reveal",tabIndex:"-1",dangerouslySetInnerHTML:{__html:Kn._TQ.small}})}function Zu({onClick:e}){return(0,zn.jsx)("button",{onClick:e,title:(0,W.Z)("verb","Remove"),className:"ActionButton circular remove",tabIndex:"-1",dangerouslySetInnerHTML:{__html:Kn.M2k.small}})}function Tu(e){return new Promise(((t,s)=>{n.Z.downloads.getFileIcon(e,{size:32},(e=>{t(e)}))}))}const Eu="in_progress",ku="complete";function Nu(e){const t=e.state===Eu;return e.url+u.YV+(0,W.Z)("Added: $1",[V()(e.startTime).format("l, LTS")])+(t&&e.paused?u.YV+(0,W.Z)("Download stopped"):"")+(e.endTime?u.YV+(0,W.Z)("Complete: $1",[V()(e.endTime).format("l, LTS")]):"")}class _u extends Un.PureComponent{static contextType=oi.Z;#v=!1;constructor(e){super(e),V().relativeTimeThreshold("ss",2)}state={icon:void 0};componentDidMount(){this.#v=!0,Tu(this.props.item.id).then((e=>{this.#v&&this.setState({icon:e})}))}componentWillUnmount(){this.#v=!1}componentDidUpdate(e,t){this.state.icon||e.item.state===this.props.item.state||Tu(this.props.item.id).then((e=>{this.#v&&this.setState({icon:e})}))}handleMouseEnter=e=>{h.Z.setStatus(e,this.props.item.url)};handleMouseLeave=e=>{h.Z.clearStatus(e)};renderDownloadButton=()=>{const{item:e,onPause:t,onResume:s,onShow:n,onErase:i}=this.props;return e.state!==Eu||e.paused?e.canResume?(0,zn.jsx)(Au,{onClick:s.bind(null,e.id)}):e.state===ku&&e.exists?(0,zn.jsx)(Su,{onClick:n.bind(null,e.id)}):(0,zn.jsx)(Zu,{onClick:i.bind(null,e.id)}):(0,zn.jsx)(Iu,{onClick:t.bind(null,e.id)})};render(){const{item:e}=this.props,t=e.filename||e.finalUrl,{filename:s,extension:n}=(0,pu.QQ)(t),i=this.context.vivaldiWindowId,{icon:a}=this.state;return(0,zn.jsxs)("div",{className:Gn()("DownloadItem",{"DownloadItem--Unavailable":!1===e.exists}),onMouseEnter:()=>this.handleMouseEnter(i),onMouseLeave:()=>this.handleMouseLeave(i),title:Nu(e),children:[a&&(0,zn.jsx)("img",{src:a,className:"DownloadItem-Icon"}),(0,zn.jsxs)("div",{className:"DownloadItem-FileName",children:[(0,zn.jsx)("span",{className:"DownloadItem-FileName-Name",children:s}),(0,zn.jsx)("span",{className:"DownloadItem-FileName-Extension",children:n})]}),(0,zn.jsx)(hu,{item:e}),(0,zn.jsx)(xu.Z,{item:e}),this.renderDownloadButton()]})}}const Pu=_u;var Mu=s(69697),Du=s(34155);const Ou="vivaldi/x-sortfield",ju=ui.Z.ASCENDING_SORT,Lu="100dvh";class Ru extends Un.PureComponent{static contextType=oi.Z;nodeRef=Un.createRef();constructor(e){super(e),this.state={columns:e.columns||[],maxWidth:0,maxHeight:e.fullsize&&e.columns?this.getColumnHeight():Lu,dataKey:"",dragOverField:void 0}}componentDidUpdate(){this.props.fullsize&&this.props.columns&&this.setState({maxHeight:this.getColumnHeight()})}getWidth=e=>{const t=this.nodeRef.current?.getBoundingClientRect();t?.width&&this.setState({maxWidth:t.width,dataKey:e})};saveColumnsToSettings=()=>{this.dragged="",this.props.onSaveRow&&this.props.onSaveRow()};resizeRow=(e,t,s)=>{const{dataKey:n}=this.state;this.setState((t=>{const i=t.columns?[...t.columns]:[],a=i.flatMap((e=>e.id)).indexOf(n),o=s.target.parentElement,r=Math.round(e-o.getClientRects()[0].left),l=a+1,d=o.nextSibling,c=Math.round(o.clientWidth+d.clientWidth)-r;return r<0||c<0||(i[l].key||0===a&&!i[a].key?i[a]={...i[a],width:r}:i[l]={...i[l],width:c},this.props.onUpdateRow&&this.props.onUpdateRow(i)),{columns:i}}))};updateField=e=>{const t=e.target.value;let s;s="manually"===t?ui.Z.NO_SORTING:this.props.sortOrder===ui.Z.NO_SORTING?ju:this.props.sortOrder,this.props.onSortChange(s,t)};updateSort=(e,t)=>{let s;if(t.preventDefault(),e===this.props.sortField)switch(this.props.sortOrder){case ui.Z.ASCENDING_SORT:s=ui.Z.DESCENDING_SORT;break;case ui.Z.DESCENDING_SORT:s=!1!==this.props.manualSorting?ui.Z.NO_SORTING:ui.Z.ASCENDING_SORT;break;case ui.Z.NO_SORTING:s=ju}else s=this.props.sortOrder;s&&this.props.onSortChange(s,e)};updateOrder=()=>{const e=this.props.sortOrder===ui.Z.DESCENDING_SORT?ui.Z.ASCENDING_SORT:ui.Z.DESCENDING_SORT;this.props.onSortChange(e,this.props.sortField)};onDragStart=(e,t)=>{this.dragged=e,t.dataTransfer.setData(Ou,!0),t.stopPropagation()};onDragOver=(e,t)=>{const{HTMLElement:s}=this.context;if(t.dataTransfer&&!t.dataTransfer.types.includes(Ou))return;if(t.preventDefault(),t.stopPropagation(),e===this.dragged||!(t.currentTarget instanceof s))return;const n=t.currentTarget.getBoundingClientRect(),i=(t.clientX-n.left)/n.width<=.5?"left":"right";this.setState({dragOverField:{id:e,position:i}})};onDrop=e=>{if(this.state.columns&&void 0!==this.state.dragOverField&&this.state.columns.length>1&&e.dataTransfer.getData(Ou)){const{columns:t,dragOverField:s}=this.state,n=t.findIndex((e=>e.id===this.dragged)),i=Math.max(0,t.findIndex((e=>e.id===s?.id))+("right"===s?.position?1:0)),a=n-i;if(0===a||!this.state.columns)return;e.preventDefault(),e.stopPropagation(),this.setState((e=>{if(e.columns){const t=[...e.columns];return t.splice(Math.max(0,i-(a<0?1:0)),0,t.splice(n,1)[0]),this.props.onUpdateRow&&this.props.onUpdateRow(t),{columns:t,dragOverField:void 0}}})),Du.nextTick((()=>this.saveColumnsToSettings()))}};resetDragOverField=()=>{this.setState({dragOverField:void 0})};resetColumns=()=>{const e=Ii(this.props.fields);e&&(this.setState({columns:e}),this.props.onUpdateRow&&this.props.onUpdateRow(e),Du.nextTick((()=>this.saveColumnsToSettings())))};onContextMenu=e=>{if(!this.state.columns)return;const t=this.state.columns.flatMap((e=>e.id)),s=this.props.fields.filter((e=>!e.key)).map((e=>({handler:this.toggleColumn.bind(this,e.value),type:"checkbox",checked:t.includes(e.value),...st.Z.makeLabelPair(e.text)})),[]);this.props.columns&&(s.push(st.Z.separatorItem),s.push({handler:this.resetColumns,...(0,fi.Z)("Reset Columns")})),(0,mi.Z)(this.context,s)(e)};toggleColumn=e=>{if(!this.state.columns)return;const t=this.state.columns.flatMap((e=>e.id));t.includes(e)?this.setState((s=>{const n=s.columns||[];if(n){const s=t.indexOf(e),i=[...n.slice(0,s),...n.slice(s+1)];return this.props.onUpdateRow&&this.props.onUpdateRow(i),{columns:i}}})):this.setState((t=>{const s=t.columns||[],n=this.props.fields.find((t=>t.value===e));if(n&&s.length>0){const t=this.props.fields.indexOf(n),i=[...s.slice(0,t),{id:e,width:n.width||20},...s.slice(t)];return this.props.onUpdateRow&&this.props.onUpdateRow(i),{columns:i}}})),Du.nextTick((()=>this.saveColumnsToSettings()))};_getSortLabel=e=>{const t=e.text,s=e.value,n=e.isSortField??!0,i=this.props.sortField===s,a=e.fullScreenTitle,{dragOverField:o}=this.state,r=o&&o.id===e.value,l=o&&o.position||"",d=Gn()({"sortselector-button":!0,"sortselector-button-active":i&&this.props.sortOrder!==ui.Z.NO_SORTING,"direction-ascending":i&&this.props.sortOrder===ui.Z.ASCENDING_SORT,"direction-descending":i&&this.props.sortOrder===ui.Z.DESCENDING_SORT,"over-left":r&&"left"===l,"over-right":r&&"right"===l,"drag-over":r}),{columns:c}=this.state,h=c.findIndex((e=>e.id===s)),u=c[h];return(0,zn.jsxs)("div",{onContextMenu:this.onContextMenu,children:[(0,zn.jsxs)("button",{draggable:1!==this.props.fields.length,onDragStart:this.onDragStart.bind(this,s),onDragOver:this.onDragOver.bind(this,s),onDragLeave:this.resetDragOverField,onDrop:this.onDrop,className:d,onMouseDown:e=>e.preventDefault(),onClick:e=>this.updateSort(s,e),title:a||(0,W.Z)("Toggle Sort Order"),disabled:!n,tabIndex:this.props.keyAccess,children:[u&&u.width<80?(0,zn.jsx)("span",{className:"column-icon",dangerouslySetInnerHTML:{__html:e.icon?e.icon:Kn.NNg.small}}):(0,zn.jsx)("span",{className:"column-label",children:t}),(0,zn.jsx)("span",{className:"column-sort-order",dangerouslySetInnerHTML:{__html:Kn.u0H}})]}),c&&h>-1&&h<c.length-1&&(0,zn.jsx)(Mu.Z,{onSlidebarPosition:this.resizeRow,onStart:()=>this.getWidth(s),onStop:this.saveColumnsToSettings,style:this.props.style,position:"right"})]},"key_"+s+t+a)};getColumnHeight(){const e=this.nodeRef.current?.nextElementSibling?.clientHeight,t=this.nodeRef.current?.clientHeight;return e&&t?`${e+t}px`:Lu}getFullOptions(){const{columns:e=[]}=this.state,{fields:t}=this.props;return e.length>0?e.map((e=>t.find((t=>t.value===e.id)))).filter(Boolean).map(this._getSortLabel):t.map(this._getSortLabel)}getCompactOptions(){const e=this.props.fields.filter((({isSortField:e})=>e??!0)).map((e=>(0,zn.jsx)("option",{value:e.value,children:e.fullScreenTitle},e.value)));return!1!==this.props.manualSorting&&e.unshift((0,zn.jsx)("option",{value:"manually",children:(0,W.Z)("Sort Manually")},"manually")),e}render(){const{columns:e,fullsize:t}=this.props,s=this.props.sortOrder===ui.Z.NO_SORTING,n=t&&e?Ai(e):void 0,i=t&&e?{"--columnHeight":this.state.maxHeight}:void 0,a=1===this.props.fields.length&&!this.props.compact,o=!(t||a);return(0,zn.jsx)("div",{ref:this.nodeRef,className:Gn()("sortselector",{"sortselector-tableheader":!o,"tableheader-add-scrollbar-spacing":t&&!!this.props.alignHeaderWithScrollbar,"sortselector-compact":o,single:a}),style:{gridTemplateColumns:n,...i},children:o?(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("div",{className:"sortselector-area",children:(0,zn.jsx)("select",{className:"sortselector-dropdown",title:(0,W.Z)("Sort by..."),value:this.props.sortField,tabIndex:this.props.keyAccess,onChange:this.updateField,children:this.getCompactOptions()})}),(0,zn.jsx)("button",{className:Gn()({"sortselector-button":!0,"direction-ascending":this.props.sortOrder===ui.Z.ASCENDING_SORT,"direction-descending":this.props.sortOrder===ui.Z.DESCENDING_SORT}),onClick:this.updateOrder,title:this.props.sortOrder===ui.Z.ASCENDING_SORT?(0,W.Z)("Sort Descending"):(0,W.Z)("Sort Ascending"),tabIndex:s?-1:this.props.keyAccess,disabled:s,dangerouslySetInnerHTML:{__html:Kn.u0H}})]}):this.getFullOptions()})}}const Bu=Ru,Fu=[{text:(0,W.Z)("title","Name"),value:"filename",fullScreenTitle:(0,W.Z)("Sort by Name")},{text:(0,W.Z)("Type"),value:"extension",fullScreenTitle:(0,W.Z)("Sort by Type")},{text:(0,W.Z)("Size"),value:"bytesReceived",fullScreenTitle:(0,W.Z)("Sort by Size")},{text:(0,W.Z)("Date"),value:"startTime",fullScreenTitle:(0,W.Z)("Sort by Date")},{text:(0,W.Z)("Address"),value:"url",fullScreenTitle:(0,W.Z)("Sort by Address")}];class Wu extends Un.PureComponent{refTreeList=Un.createRef();static contextType=oi.Z;winId=this.context.vivaldiWindowId;getExtension=e=>{const t=e?e.lastIndexOf("."):-1;return-1!==t?e.substring(t+1):""};sortForExtension=(e,t)=>{const{sortOrder:s}=this.props;if(s<=ui.Z.NO_SORTING)return 0;const n=e,i=t;let a=this.getExtension(n.filename),o=this.getExtension(i.filename);if(!a&&!o)return 0;if(!a)return s===ui.Z.ASCENDING_SORT?1:-1;if(!o)return s===ui.Z.ASCENDING_SORT?-1:1;if("number"==typeof a&&"number"==typeof o)return s===ui.Z.ASCENDING_SORT?a-o:o-a;if(a=a.toString().toLowerCase(),o=o.toString().toLowerCase(),a>o)return s===ui.Z.ASCENDING_SORT?1:-1;if(a<o)return s===ui.Z.ASCENDING_SORT?-1:1;return ui.Z.getDefaultComparator(s,"filename")(e,t)};returnFalse=()=>!1;selectByIds=e=>{e.forEach((e=>{this.refTreeList.current?.selectById(e,{ctrlKey:!0,metaKey:!0})}))};selectByNode=e=>{this.refTreeList.current?.selectByNode(e)};selectByIndex=e=>{this.refTreeList.current?.selectByIndex(e)};scrollToId=e=>{this.refTreeList.current?.scrollToId(e)};isSelected=e=>this.refTreeList.current?.isItemSelected(e);getSelectedNodes=()=>this.refTreeList.current?.selectionModel.selectedIds||[];getSelectedNode=()=>this.refTreeList.current?.getSelectedItem();onNodeMouseDown=()=>{this.refTreeList.current?.focusTree()};onNodeSelected=e=>{e?this.props.onSelected(parseInt(e.id)<0?void 0:e):this.props.onSelected(void 0)};onNodeDoubleClick=(e,t)=>{this.props.onOpen(t.id)};onNodesActivated=(e,t)=>{t.forEach((e=>{this.props.onOpen(e.id)}))};onNodeDragStart=e=>{this.refTreeList.current?.setSelectedIds(e),this.props.onDrag(e)};validateForDrag=e=>{const t=this.props.nodes.filter((e=>e.exists&&"complete"===e.state));return e.filter((e=>t.some((t=>t.id===e))))};setCustomEventBehavior=(e,t)=>{e.preventDefault(),e.stopPropagation()};handleErase=e=>(this.props.nodes.filter((t=>e.includes(t.id))).forEach((({id:e})=>this.props.onErase(e))),Promise.resolve());rowComponent=e=>{const t=e.node;return(0,zn.jsx)(Pu,{item:t,onErase:this.props.onErase,onShow:this.props.onShow,onPause:this.props.onPause,onResume:this.props.onResume},t.id)};render(){const e=fe.ZP.isIncognito(this.winId),t={sortOrder:this.props.sortOrder,sortField:this.props.sortField,comparator:this.sortForExtension,onlyScroll:"extension"!==this.props.sortField};return(0,zn.jsxs)(zn.Fragment,{children:[Xh.ZP.hasDownloads({isIncognitoWindow:e})&&(0,zn.jsx)(Bu,{fields:Fu,manualSorting:!1,onSortChange:this.props.onSortChange,keyAccess:this.props.keyAccess,sortField:this.props.sortField,sortOrder:this.props.sortOrder}),Xh.ZP.hasDownloads({isIncognitoWindow:e})&&(0,zn.jsx)("section",{className:"outerScrollbar",children:(0,zn.jsx)(Mi,{ref:this.refTreeList,settings:"DOWNLOADS_TREE",rowComponent:this.rowComponent,nodes:this.props.nodes,menu:this.props.menu,isFolder:this.returnFalse,hasChildren:this.returnFalse,delete:this.handleErase,onSelect:this.onNodeSelected,enableDragAndDrop:!0,onItemMouseDown:this.onNodeMouseDown,onItemDoubleClick:this.onNodeDoubleClick,onItemsActivated:this.onNodesActivated,rowHeight:52,sorting:t,onItemDragStart:this.onNodeDragStart,validateForDrag:this.validateForDrag,disableMousePointersOverride:!0,setCustomEventBehavior:this.setCustomEventBehavior})})]})}}const Uu=Wu;var Vu=s(34155);function Hu(e,t){const s="startTime";if("extension"===e)return s;if(t===ui.Z.ASCENDING_SORT)return e;switch(e){case"bytesReceived":return"-bytesReceived";case"endTime":return"-endTime";case"filename":return"-filename";case"startTime":return"-startTime";case"url":return"-url"}return s}const Gu=[Z.kDownloadsPanelEditorHeight];function Ku(e){return"complete"===e.state&&e.mime.startsWith("image/")}var zu=(0,zn.jsx)(yu,{});class $u extends Un.PureComponent{static contextType=oi.Z;winId=this.context.vivaldiWindowId;nodeRef=Un.createRef();refTree=Un.createRef();defaultHeight=A.Z.getDefault(Z.kDownloadsPanelEditorHeight);state={downloadItems:[],hasActiveDownloadItemsSelected:!1,hasPausedDownloadItemsSelected:!1,hasCompletedDownloadItemsSelected:!1,hasCompletedDownloadItems:!1,selectedDownloadItem:void 0,filter:Xh.ZP.getFilter(),editorHeight:A.Z.get(Z.kDownloadsPanelEditorHeight),...A.Z.get(Z.kDownloadsPanelSorting)};componentDidMount(){const{selectWindow:e}=this.context;tn.ZP.addListener(this.onPanelStoreChange),Xh.ZP.addListener(this.onDownloadStoreChange),_e.Z.setOrderBy(Hu(this.state.sortField,this.state.sortOrder)),_e.Z.setSearchFilter(this.state.filter),fe.ZP.addListener(this._onWindowStoreChange,e),this.fetchDownloadItemsAndUpdateState()}componentDidUpdate(e,t){return t.filter!==this.state.filter?this.fetchDownloadItemsAndUpdateState():"extension"===this.state.sortField||t.sortField===this.state.sortField&&t.sortOrder===this.state.sortOrder?(t.selectedDownloadItem!==this.state.selectedDownloadItem&&this.updateActiveProgressState(),void(!e.open&&this.props.open&&Vu.nextTick((()=>{this.focusTree(),0===this.refTree.current?.getSelectedNodes().length&&this.refTree.current?.selectByIndex(0)})))):this.fetchDownloadItemsAndUpdateState()}componentWillUnmount(){Xh.ZP.removeListener(this.onDownloadStoreChange),tn.ZP.removeListener(this.onPanelStoreChange),fe.ZP.removeListener(this._onWindowStoreChange)}fetchDownloadItemsAndUpdateState=()=>new Promise((e=>{const t=fe.ZP.isIncognito(this.winId),s=Xh.ZP.getItems({isIncognitoWindow:t});let n;this.state.selectedDownloadItem&&(n=s.find((e=>{if(this.state.selectedDownloadItem)return e.id===this.state.selectedDownloadItem.id})),this.updateActiveProgressState());const i=s;this.setState({filter:Xh.ZP.getFilter(),selectedDownloadItem:n,downloadItems:i,hasCompletedDownloadItems:s.some((e=>"in_progress"!==e.state&&!e.paused)),...A.Z.get(Z.kDownloadsPanelSorting)},e)}));scrollDownloadItemIntoView=e=>{this.refTree.current?.scrollToId(e.id)};selectDownloadItem=e=>{this.refTree.current?.selectByNode(e)};onDownloadStoreChange=e=>{switch(e.reason){case"download_stopped":case"download_completed":{const{downloadItem:t}=e;return void this.onTransferFinished(t)}case"download_started":{const{downloadItem:t}=e;return void this.fetchDownloadItemsAndUpdateState().then((()=>{this.scrollDownloadItemIntoView(t),this.selectDownloadItem(t)}))}case"download_panel_updated":return void this.fetchDownloadItemsAndUpdateState()}};onPanelStoreChange=()=>{const e=tn.ZP.getChangeReason();this.props.open&&"setFocus"===e&&!(0,vo.sT)(this.context.document,this.nodeRef.current)&&this.focusTree()};_onWindowStoreChange=()=>{this.props.open&&fe.ZP.isActive(this.winId)&&_e.Z.forceUpdate()};onTransferFinished=e=>{this.updateActiveProgressState()};getMenuState=()=>{const e=this.updateActiveProgressState();return{numAddresses:this.getNumSelectedAddresses(),numFiles:this.getNumSelectedFiles(),numImages:this.getNumSelectedImages(),hasPaused:e.hasPausedDownloadItemsSelected,hasCompleted:e.hasCompletedDownloadItemsSelected,hasActive:e.hasActiveDownloadItemsSelected}};getMenuCapability=async(e,t,s,n)=>{const i=this.winId;switch(e.action){case"CONTEXT_OPEN_FILE":return{handler:this.openSelected,isVisible:()=>Boolean(s)&&n.hasCompleted&&n.numFiles>0,...t(i,e,n)};case"CONTEXT_OPEN_IN":return{isVisible:()=>Boolean(s)&&n.numImages>0&&n.numFiles>0,...t(i,e,n)};case"CONTEXT_OPEN_IN_NEW_TAB":return{handler:()=>{this.openSelectedInTab(!1,A.Z.get(Z.kTabsOpenNewInBackground))},isVisible:()=>Boolean(s)&&n.numImages>0&&n.numFiles>0,...t(i,e,n)};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{handler:()=>{this.openSelectedInTab(!1,!0)},isVisible:()=>Boolean(s)&&!A.Z.get(Z.kTabsOpenNewInBackground)&&n.numImages>0&&n.numFiles>0,...t(i,e,n)};case"CONTEXT_OPEN_IN_TAB":return{handler:()=>{this.openSelectedInTab(!0,!1)},isVisible:()=>Boolean(s)&&n.numImages>0&&n.numFiles>0,...t(i,e,n)};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{handler:()=>{this.openSelectedInWindow(!1)},isVisible:()=>Boolean(s)&&n.numImages>0&&n.numFiles>0,...t(i,e,n)};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{handler:()=>{this.openSelectedInWindow(!0)},isVisible:()=>Boolean(s)&&n.numImages>0&&n.numFiles>0,...t(i,e,n)};case"CONTEXT_FILEMANAGER":return{handler:()=>{this.showSelectedInFilemanager()},isVisible:()=>Boolean(s)&&n.numFiles>0,...t(i,e,n)};case"CONTEXT_COPY_ADDRESS":return{handler:()=>{this.copySelectedAddress()},isVisible:()=>Boolean(s),...t(i,e,n)};case"CONTEXT_COPY_PATH":return{handler:()=>{this.copySelectedPath()},isVisible:()=>Boolean(s)&&n.hasCompleted&&n.numFiles>0,...t(i,e,n)};case"CONTEXT_RESTART":return{handler:()=>{this.restartSelected()},isVisible:()=>Boolean(s)&&(n.hasCompleted||this.fileErrors()),...t(i,e,n)};case"CONTEXT_STOP":return{handler:()=>{this.stopSelected()},isVisible:()=>Boolean(s)&&n.hasActive,...t(i,e,n)};case"CONTEXT_RESUME":return{handler:()=>{this.resumeSelected()},isVisible:()=>Boolean(s)&&n.hasPaused,...t(i,e,n)};case"CONTEXT_REMOVE":return{handler:()=>{this.removeSelected()},isVisible:()=>Boolean(s),...t(i,e,n)};case"CONTEXT_REMOVE_ALL_FINISHED":return{handler:()=>{this.removeAllFinished()},isVisible:()=>Boolean(s)&&n.hasCompleted,...t(i,e,n)};default:return{...t(i,e,n)}}};getSelectedDownloadItems=()=>{const e=this.refTree.current?.getSelectedNodes().map((e=>e.id))||[];return this.state.downloadItems.filter((t=>-1!==e.findIndex((e=>e===t.id))))};getNumSelectedImages=()=>this.getSelectedDownloadItems().filter(Ku).length;getNumSelectedAddresses=()=>this.getSelectedDownloadItems().filter((e=>Boolean(e.url))).length;getNumSelectedFiles=()=>{let e=0;const t=this.getSelectedDownloadItems();for(let s=0;s<t.length;s++){const n=t[s];n.exists&&!n.error&&e++}return e};fileErrors=()=>{const e=this.getSelectedDownloadItems().map((e=>e.error));if(e.length)return!e.includes(void 0)};getActiveProgressStateForSelectedDownloadItems=()=>{const e=this.getSelectedDownloadItems(),t=this.state.downloadItems;let s=!1,n=!1,i=!1,a=!1;for(let t=0;t<e.length;t++){const o=e[t];if("in_progress"===o.state?o.paused?n=!0:s=!0:"in_progress"===o.state||o.paused||(i=a=!0),s&&n&&i)break}return a=a||!!t.some((e=>"in_progress"!==e.state&&!e.paused)),{hasActiveDownloadItemsSelected:s,hasPausedDownloadItemsSelected:n,hasCompletedDownloadItemsSelected:i,hasCompletedDownloadItems:a}};updateActiveProgressState=()=>{const e=this.getActiveProgressStateForSelectedDownloadItems();return this.setState(e),e};canResumeSelected=()=>{const e=this.getSelectedDownloadItems();if(1===e.length){return e[0].canResume}return!1};stopSelected=()=>{this.getSelectedDownloadItems().filter((e=>!e.paused)).forEach((({id:e})=>_e.Z.pauseDownload(e)))};resumeSelected=()=>{this.getSelectedDownloadItems().filter((e=>e.canResume)).forEach((({id:e})=>_e.Z.resumeDownload(e)))};restartSelected=()=>{this.getSelectedDownloadItems().forEach((({id:e})=>_e.Z.restartDownload(e)))};showSelectedInFilemanager=()=>{this.getSelectedDownloadItems().forEach((({id:e})=>_e.Z.showDownload(e)))};onSortChange=(e,t)=>{I.Z.set(Z.kDownloadsPanelSorting,{sortOrder:e,sortField:t});const s=Hu(t,e);_e.Z.setOrderBy(s),"extension"===t&&this.setState({sortField:t,sortOrder:e})};openSelected=()=>{this.getSelectedDownloadItems().forEach((e=>{"complete"===e.state&&_e.Z.openDownload(e.id)}))};openSelectedInTab=(e,t)=>{const s=this.getSelectedDownloadItems().filter((e=>"complete"===e.state&&e.mime.startsWith("image/"))).map((e=>"file://"+e.filename));if(s.length>0){const n=s[s.length-1];s.forEach((s=>{const i={inCurrent:e,inBackground:t};!1===t&&(i.inBackground=s!==n),c.ZP.openURL(this.context.vivaldiWindowId,s,i),e=!1}))}};openSelectedInWindow=e=>{const t=this.getSelectedDownloadItems().filter((e=>"complete"===e.state&&e.mime.startsWith("image/"))).map((e=>"file://"+e.filename)),s={inNewWindow:!0,incognito:e};t.forEach((e=>{c.ZP.openURL(this.context.vivaldiWindowId,e,s)}))};onSelected=e=>{this.setState({selectedDownloadItem:e},(()=>{_e.Z.forceUpdate(),this.updateActiveProgressState()}))};removeAllFinished=()=>{this.state.downloadItems.filter((e=>"in_progress"!==e.state&&!e.paused)).forEach((({id:e})=>_e.Z.eraseDownload(e)))};removeSelected=()=>{this.getSelectedDownloadItems().forEach((({id:e})=>_e.Z.eraseDownload(e)))};copySelectedAddress=()=>{const e=this.getSelectedDownloadItems().map((e=>e.finalUrl));0!==e.length&&this.context.navigator.clipboard.writeText(e.join("\n"))};copySelectedPath=()=>{const e=this.getSelectedDownloadItems().filter((e=>"complete"===e.state)).map((e=>e.filename));0!==e.length&&this.context.navigator.clipboard.writeText(e.join("\n"))};getItemPath=Ci()((e=>this.getSelectedDownloadItems().find((t=>t.id===e))?.filename??""));handleFilterChange=e=>new Promise((t=>this.setState({filter:e},(()=>{_e.Z.setSearchFilter(e).then(t)}))));onSlidebarPosition=(e,t)=>{this.setState((e=>({editorHeight:Math.max(Math.min(e.editorHeight-t,250),u.mT)})))};onSlideBarStop=()=>{this.setState((e=>{const t=e.editorHeight<u.Cn?u.mT:e.editorHeight;return I.Z.set(Z.kDownloadsPanelEditorHeight,parseInt(t)),{editorHeight:t}}))};onSlidebarToggle=()=>{this.setState((e=>{let t=e.editorHeight;return t>u.Cn?(t=u.mT,I.Z.set(Z.kDownloadsPanelEditorHeight,t)):(t=250,I.Z.reset(Z.kDownloadsPanelEditorHeight)),{editorHeight:parseInt(t)}}))};focusTree=()=>{this.refTree.current?.refTreeList.current?.focusTree()};showSelectedDownloadItem=()=>{this.state.selectedDownloadItem&&_e.Z.showDownload(this.state.selectedDownloadItem.id)};menu={name:"downloadlist",getState:this.getMenuState,getCapability:this.getMenuCapability,getVisibility:()=>!1};render(){if(!this.props.open)return null;const e=this.canResumeSelected(),t=fe.ZP.isIncognito(this.winId),s=!Xh.ZP.hasDownloads({isIncognitoWindow:t})&&!this.state.filter;return(0,zn.jsxs)("div",{ref:this.nodeRef,className:Gn()("panel","downloads",{isEmpty:s}),children:[(0,zn.jsx)(wu,{title:this.props.title,filter:this.state.filter,onFilterChange:this.handleFilterChange,keyAccess:this.props.keyAccess,canResumeDownload:e,onDownloadResume:this.resumeSelected,hasPausedTransfersSelected:this.state.hasPausedDownloadItemsSelected,hasActiveTransfersSelected:this.state.hasActiveDownloadItemsSelected,hasCompletedTransfersSelected:this.state.hasCompletedDownloadItemsSelected,hasCompletedTransfers:this.state.hasCompletedDownloadItems,hasDownload:0!==this.state.downloadItems.length,onStopSelectedDownload:this.stopSelected,onRestartSelectedDownload:this.restartSelected,downloadItem:this.state.selectedDownloadItem?this.state.selectedDownloadItem:void 0,onRemoveSelected:this.removeSelected,onRemoveAllFinished:this.removeAllFinished,showCloseButton:this.props.showCloseButton}),(0,zn.jsx)(Uu,{ref:this.refTree,keyAccess:this.props.keyAccess,menu:this.menu,nodes:this.state.downloadItems,onSelected:this.onSelected,onSortChange:this.onSortChange,sortField:this.state.sortField,sortOrder:this.state.sortOrder,onErase:_e.Z.eraseDownload,onResume:_e.Z.resumeDownload,onPause:_e.Z.pauseDownload,onShow:_e.Z.showDownload,onOpen:_e.Z.openDownload,onDrag:_e.Z.dragDownloads}),s?zu:(0,zn.jsxs)("section",{className:Gn()("download-editor","outerScrollbar",{collapsed:this.state.editorHeight===u.mT}),style:{flexBasis:this.state.editorHeight},children:[(0,zn.jsx)(Mu.Z,{onSlidebarPosition:this.onSlidebarPosition,onStop:this.onSlideBarStop,onDoubleClick:this.onSlidebarToggle,position:"bottom",returnOffset:!0}),this.state.editorHeight>u.mT&&(0,zn.jsx)(fu,{downloadItem:this.state.selectedDownloadItem,keyAccess:this.props.keyAccess,onShow:this.showSelectedDownloadItem,canResumeDownload:e,hasPausedTransfersSelected:this.state.hasPausedDownloadItemsSelected,onDownloadResume:this.resumeSelected,getItemPath:this.getItemPath})]})]})}}const Yu=(0,zd.Z)($u,Gu);class Xu extends Un.PureComponent{static contextType=oi.Z;state={downloadProgress:0,isPopupVisible:!1};componentDidMount(){this.props.inEditor||(Xh.ZP.addListener(this._onDownloadStoreChange),go.Z.addListener("COMMAND_SHOW_DOWNLOADS_POPOUT",this.onCommandSpy))}componentWillUnmount(){this.props.inEditor||(Xh.ZP.removeListener(this._onDownloadStoreChange),go.Z.removeListener("COMMAND_SHOW_DOWNLOADS_POPOUT",this.onCommandSpy))}_onDownloadStoreChange=()=>{this.setState({downloadProgress:Xh.ZP.getTotalProgress()})};onCommandSpy=(e,t)=>{e===this.context.vivaldiWindowId&&(this.state.isPopupVisible||this.setState({isPopupVisible:!0}))};hidePopup=()=>{this.setState({isPopupVisible:!1})};togglePopup=()=>{this.setState((e=>({isPopupVisible:!e.isPopupVisible})))};render(){return(0,zn.jsx)(oa.ZP,{id:"downloads",popupClassName:"download-popout",popupLabel:(0,W.Z)("dialog title","Downloads"),tooltip:(0,W.Z)("Downloads"),alwaysMenu:!0,onClick:this.togglePopup,customizeMenu:this.props.customizeMenu,menuOrigin:this.props.menuOrigin,popupPosition:this.props.popupPosition,hidePopup:this.hidePopup,isPopupVisible:this.state.isPopupVisible,popupWidth:360,image:Kn.izi[this.props.size],progress:this.state.downloadProgress,isPopupResizable:!0,draggable:this.props.draggable,onDragStart:this.props.onDragStart??nr.Z,onDragEnd:this.props.onDragEnd??nr.Z,onDrop:this.props.onDrop??nr.Z,onDragEnter:this.props.onDragEnter??nr.Z,onDragLeave:this.props.onDragLeave??nr.Z,onDragOver:this.props.onDragOver??nr.Z,mimeType:this.props.mimeType,name:this.props.name,size:this.props.size,style:{"--downloadInProgress":this.state.downloadProgress?1:0},commandId:"COMMAND_SHOW_DOWNLOADS_POPOUT",children:(0,zn.jsx)(Yu,{keyAccess:-1,title:(0,W.Z)("Downloads"),panelId:"PanelDownloads",open:!0,onOpenDialog:nr.Z,showCloseButton:!0})})}}const Qu=(0,cc.ZP)(Xu);var qu=s(79227);var Ju=(0,zn.jsx)("img",{className:"GamePreviewPopup-PreviewImage",src:"resources/game_screenshot.png"});function ep(e){return(0,zn.jsxs)("div",{className:"GamePreviewPopup",children:[(0,zn.jsx)("h2",{className:"GamePreviewPopup-HeaderText",id:"popup-label-vivaldiagame",children:(0,W.Z)("Vivaldia Game")}),(0,zn.jsx)("button",{className:"GamePreviewPopup-SettingsButton",title:(0,W.Z)("Settings"),dangerouslySetInnerHTML:{__html:Kn.bqs.large},onClick:()=>{return t=e.winId,void c.ZP.openURL(t,"vivaldi://settings/startpage/",{inBackground:!1});var t}}),Ju,(0,zn.jsx)("button",{onClick:()=>{return t=e.winId,void c.ZP.openURL(t,"vivaldi://game/",{inCurrent:!1,inBackground:!1});var t},className:"GamePreviewPopup-StartButton FormButton primary",title:(0,W.Z)("Click to Play"),children:(0,W.Z)("Click to Play")})]})}class tp extends Un.PureComponent{static contextType=oi.Z;state={isPopupOpen:!1,isIconHovered:!1};hidePopup=()=>{this.setState({isPopupOpen:!1})};togglePopup=()=>{this.setState((e=>({isPopupOpen:!e.isPopupOpen})))};menu=()=>[{type:"checkbox",handler:()=>{I.Z.toggle(Z.kStartpageSpeedDialGameButtonShow,!0,!1)},checked:A.Z.get(Z.kStartpageSpeedDialGameButtonShow),...(0,fi.Z)("Show Game on Speed Dial")}];render(){const{isStartPage:e}=this.props,t=this.state.isPopupOpen||this.state.isIconHovered&&e?"resources/game_icon_alternate.png":"resources/game_icon.png";return(0,zn.jsx)(oa.ZP,{className:"GameButton",tooltip:(0,W.Z)("Vivaldia the game"),name:this.props.name||"Game",image:Kn.rNG[this.props.size||"large"],imagePath:e?t:void 0,mimeType:this.props.mimeType||"vivaldi/x-button-toolbar",hidePopup:this.hidePopup,popupPosition:this.props.popupPosition||"above",popupWidth:180,isPopupVisible:this.state.isPopupOpen,popupClassName:"extensionIconPopupMenu ToolbarButtonPopup-DefaultStyles",popupLabelledBy:"popup-label-vivaldiagame",menu:this.menu,customizeMenu:this.props.customizeMenu||void 0,menuOrigin:this.props.menuOrigin||void 0,draggable:this.props.draggable||!1,onClick:this.togglePopup,onDragStart:this.props.onDragStart||nr.Z,onDragEnd:this.props.onDragEnd||void 0,onDrop:this.props.onDrop||void 0,onDragEnter:this.props.onDragEnter||void 0,onPointerEnter:()=>this.setState({isIconHovered:!0}),onPointerLeave:()=>this.setState({isIconHovered:!1}),children:(0,zn.jsx)(ep,{winId:this.context.vivaldiWindowId})})}}var sp=s(83526);const np={header:`${(0,W.Z)("sender","From")} / ${(0,W.Z)("To")} / ${(0,W.Z)("Cc")} / ${(0,W.Z)("Subject")}`,body:(0,W.Z)("Body"),anywhere:(0,W.Z)("Anywhere")};class ip extends Un.PureComponent{static contextType=oi.Z;updateQuery=()=>{const e=Ct.Z.getOptions(),t=Ct.Z.getSelectedFolder()?.accountId===Nt.u4,s=Ct.Z.getQuery(),n=this.state?.queryType??"anywhere";if(e.forSender||e.forContact){return{query:s,contactQuery:e.contactQuery||"",isFeed:t,options:e,queryType:n}}return{query:s,contactQuery:"",isFeed:t,options:e,queryType:n}};refSearchInput=Un.createRef();state=this.updateQuery();doDebounceSearch=(0,Te.Z)((()=>{this.doSearch()}),200);componentDidMount(){Ct.Z.addListener(this.queryListener),Ca.Z.addListener(this._onWebpageviewChanged)}componentWillUnmount(){Ca.Z.removeListener(this._onWebpageviewChanged),Ct.Z.removeListener(this.queryListener)}_onWebpageviewChanged=e=>{e.winId===this.context.vivaldiWindowId&&"WEBPAGEVIEW_ACTIONS"===e.type&&"focusSearchField"===e.action&&this.refSearchInput.current?.select()};queryListener=()=>{this.setState({options:Ct.Z.getOptions(),...this.updateQuery()})};doSearch=()=>{const{query:e,contactQuery:t}=this.state,s={...Ct.Z.getOptions(),query:e,contactQuery:t,queryType:this.state.queryType};Wt.ZP.isValidSearch(s)||e.length>0?d.Z.addSearchToHistory(s):e||(h.Z.clearStatus(u.A4),d.Z.clearSearch())};onKeyDown=e=>{switch(e.key){case"Enter":case"Return":A.Z.get(Z.kMailSearchOnEnter)&&this.doSearch();break;case"Escape":if(!this.state.query){(0,wi.ZP)(e);const t=Ze.ZP.getActivePage(this.context.vivaldiWindowId);t&&sp.Z.doAction(this.context.vivaldiWindowId,t.id,"focusWebView")}}};onQueryTypeChange=e=>{this.setState({queryType:e},(()=>{this.state.query&&this.doSearch()}))};onQueryChange=()=>{const e=this.refSearchInput.current?.value,t=A.Z.get(Z.kMailSearchOnEnter)&&e?void 0:this.doDebounceSearch;this.setState({query:e},t)};render(){const e=!this.state.query&&!Wt.ZP.isValidSearch(this.state.options),t=[{type:"checkbox",checked:"anywhere"===this.state.queryType,handler:()=>this.onQueryTypeChange("anywhere"),label:np.anywhere,labelEnglish:"Anywhere",iconPNG:"iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAARGVYSWZNTQAqAAAACAABh2kABAAAAAEAAAAaAAAAAAADoAEAAwAAAAEAAQAAoAIABAAAAAEAAAAgoAMABAAAAAEAAAAgAAAAAKyGYvMAAAGbaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA2LjAuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIj4KICAgICAgICAgPGV4aWY6UGl4ZWxYRGltZW5zaW9uPjMyPC9leGlmOlBpeGVsWERpbWVuc2lvbj4KICAgICAgICAgPGV4aWY6UGl4ZWxZRGltZW5zaW9uPjMyPC9leGlmOlBpeGVsWURpbWVuc2lvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CizMyv0AAAB4SURBVFjD7ZbRCcAgDEQdxT29g2xkN3CkjGC/CkKVfpkWegf3/R5BQ1JSlCFmlgE0kg6gb2g1s7yEbwSP9akEyRoAv9puAoHwDsBnE/BIidkEWhS8lHK89ghJ+tNPqLvAANoSrmgTahMGC3QJSOB7AroHdA8ov80Jm4++6PcLeWoAAAAASUVORK5CYII=",iconPNGWhite:"iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAARGVYSWZNTQAqAAAACAABh2kABAAAAAEAAAAaAAAAAAADoAEAAwAAAAEAAQAAoAIABAAAAAEAAAAgoAMABAAAAAEAAAAgAAAAAKyGYvMAAAGbaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA2LjAuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIj4KICAgICAgICAgPGV4aWY6UGl4ZWxYRGltZW5zaW9uPjMyPC9leGlmOlBpeGVsWERpbWVuc2lvbj4KICAgICAgICAgPGV4aWY6UGl4ZWxZRGltZW5zaW9uPjMyPC9leGlmOlBpeGVsWURpbWVuc2lvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CizMyv0AAACESURBVFjD7ZbRCcAgDAUdxW0DeZGMYjdwJEewX4VCtX+GQt9Bvu8IKEmJkBvungFrQOmqNjZMdff8It8mvk+fRqiWGiAfqjYAa5OAGPm1hUcAYD0yYhbQ4gJwPAJEPEdsAShdZPESRDyrWt0lBqwt5YQ/IX/C4IDBAAZ8L4D3AO8B8ltObSwnDfe6D9wAAAAASUVORK5CYII="},{type:"checkbox",checked:"header"===this.state.queryType,handler:()=>this.onQueryTypeChange("header"),label:np.header,labelEnglish:"From / To / Cc / Subject",iconPNG:"iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAARGVYSWZNTQAqAAAACAABh2kABAAAAAEAAAAaAAAAAAADoAEAAwAAAAEAAQAAoAIABAAAAAEAAAAgoAMABAAAAAEAAAAgAAAAAKyGYvMAAAGbaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA2LjAuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIj4KICAgICAgICAgPGV4aWY6UGl4ZWxYRGltZW5zaW9uPjMyPC9leGlmOlBpeGVsWERpbWVuc2lvbj4KICAgICAgICAgPGV4aWY6UGl4ZWxZRGltZW5zaW9uPjMyPC9leGlmOlBpeGVsWURpbWVuc2lvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CizMyv0AAACnSURBVFjD7ZbBCcUwDEM7QkbonpJBm7Qb5G+QkTJC/ylQ+pP28p1eLPBZwtgPLUsodJKklWQxs0rycJgsaR2aOxqfp3ZDmFmeYN6m/ASYaH6QrL0N1Jkhehsos8wBfF47QjOrT5+QvYxJlqF5KEjYjg/ALil5bBfA/khCzyuVlIYkHBLqz7ojYQSIAO8GaBDyYMCFtPd9wMw2DxZISgC26APRB0JXfQHxH4gC/xH2dgAAAABJRU5ErkJggg==",iconPNGWhite:"iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAARGVYSWZNTQAqAAAACAABh2kABAAAAAEAAAAaAAAAAAADoAEAAwAAAAEAAQAAoAIABAAAAAEAAAAgoAMABAAAAAEAAAAgAAAAAKyGYvMAAAGbaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA2LjAuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIj4KICAgICAgICAgPGV4aWY6UGl4ZWxYRGltZW5zaW9uPjMyPC9leGlmOlBpeGVsWERpbWVuc2lvbj4KICAgICAgICAgPGV4aWY6UGl4ZWxZRGltZW5zaW9uPjMyPC9leGlmOlBpeGVsWURpbWVuc2lvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CizMyv0AAAC6SURBVFjD7ZbBDcMgEARdgkugVP+Qbg9tCXYHpANKogTyiSUrhvgRgz+3Eu8dnWC4abJYDiHpAE1AyCJaOpxI0v0o71Z8PLkKIRLigPIiogXQVAEYU75P4QQAaB4JUQNI4wDwOgF4TzdiCkDI3jdegvd0Ihp7FQOamuUWM+FuQkC3ZeF893Q/r2y7NGHPW0pybpqwaaib0+wxAAN4HGD/Ccn7HXCU3eU+oBrWpi7/dIBqWG0fsH3A8p03Jb3IxrXtLGAAAAAASUVORK5CYII="},{type:"checkbox",checked:"body"===this.state.queryType,handler:()=>this.onQueryTypeChange("body"),label:np.body,labelEnglish:"Body",iconPNG:"iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAARGVYSWZNTQAqAAAACAABh2kABAAAAAEAAAAaAAAAAAADoAEAAwAAAAEAAQAAoAIABAAAAAEAAAAgoAMABAAAAAEAAAAgAAAAAKyGYvMAAAGbaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA2LjAuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIj4KICAgICAgICAgPGV4aWY6UGl4ZWxYRGltZW5zaW9uPjMyPC9leGlmOlBpeGVsWERpbWVuc2lvbj4KICAgICAgICAgPGV4aWY6UGl4ZWxZRGltZW5zaW9uPjMyPC9leGlmOlBpeGVsWURpbWVuc2lvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CizMyv0AAACKSURBVEjH7VTBDYAgEHMERnBPSsImuAFuwEg3Qn1IVPThgT5M5PojaWl6zQ1Dnzx+RHICqhH9WNCryCvkIOEiaCdv9H7tBCJtDyBYWLqXMCBkdyCg/v+cGcHdQQJd0HvwxgbQzo9CdHLeQ6whI9Vl9pMmNqBsYgPkqQC7wJsCDTXi5R7Uo9+D78wCGg7sK59OVUMAAAAASUVORK5CYII=",iconPNGWhite:"iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAARGVYSWZNTQAqAAAACAABh2kABAAAAAEAAAAaAAAAAAADoAEAAwAAAAEAAQAAoAIABAAAAAEAAAAgoAMABAAAAAEAAAAgAAAAAKyGYvMAAAGbaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA2LjAuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIj4KICAgICAgICAgPGV4aWY6UGl4ZWxYRGltZW5zaW9uPjMyPC9leGlmOlBpeGVsWERpbWVuc2lvbj4KICAgICAgICAgPGV4aWY6UGl4ZWxZRGltZW5zaW9uPjMyPC9leGlmOlBpeGVsWURpbWVuc2lvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CizMyv0AAAC3SURBVFjD7ZbNCYAwDIUdwREc1ZvQtHQE3UA36EgdQX3+oGCrB00VyYOcGszXlxjNMpFoJ2ttQaQdkfFK6Z4hWtQ4Kc5WeB8+CKGUaZEwOtCUpc2fdreqJnebpYYLAMyESGRscb66cDgcqSb7kcQ5Y+tFQwAOB1qbOjooN2+PZ88A1MV6xD6EGPRom3GAV4WrMFzmnDHZhD/ZhCnidBMmCv82QC8AAvA9gBRfwisAlw5A/gdEok0DezdCVCjzVHkAAAAASUVORK5CYII="}];let s=Kn.ch_;return"body"===this.state.queryType?s=Kn.JXf:"header"===this.state.queryType&&(s=Kn.J8U),(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("div",{className:"MailSearchField-Inner",children:[(0,zn.jsx)("input",{ref:this.refSearchInput,className:"searchfield-input",type:"search",placeholder:this.state.isFeed?(0,W.Z)("Search Feeds"):(0,W.Z)("Mail Search"),value:this.state.query,onChange:this.onQueryChange,onKeyDown:this.onKeyDown}),e&&(0,zn.jsx)("button",{className:"MailSearchField-advancedSearchIcon",title:(0,W.Z)("Open advanced mail search"),dangerouslySetInnerHTML:{__html:Kn.uZ2},onClick:e=>d.Z.showMailSearchOptions()})]}),(0,zn.jsx)(oa.ZP,{image:s,popupPosition:"below",tooltip:(0,W.Z)("Search in"),isMenuIndicatorVisible:!0,openMenuOnClick:!0,menu:()=>t,menuOrigin:"bottomLeft"})]})}}const ap=ip,op=[Z.kPanelsAsOverlayEnabled,Z.kPanelsPosition,Z.kMailViewDimensions,Z.kMailViewLayout,Z.kToolbarsMail,Z.kToolbarsMailComposer,Z.kToolbarsMailMessage];var rp=(0,zn.jsx)(ap,{});class lp extends Un.Component{static contextType=oi.Z;winId=this.context.vivaldiWindowId;state={searchInput:"",panelWidth:tn.ZP.getWidth(this.winId),folder:"",width:0,margin:0};componentDidMount(){this.props.inEditor||(this.getFieldStyle(),tn.ZP.addListener(this.panelStoreChanged,(e=>e.windowData.get(this.context.vivaldiWindowId))),Ct.Z.addListener(this.selectedFolderChanged),this.selectedFolderChanged())}componentDidUpdate(e){e.prefValues[Z.kMailViewDimensions]===this.props.prefValues[Z.kMailViewDimensions]&&e.prefValues[Z.kMailViewLayout]===this.props.prefValues[Z.kMailViewLayout]||this.context.requestAnimationFrame((()=>this.getFieldStyle()))}componentWillUnmount(){this.props.inEditor||(tn.ZP.removeListener(this.panelStoreChanged),Ct.Z.removeListener(this.selectedFolderChanged))}panelStoreChanged=()=>{this.context.requestAnimationFrame((()=>{this.setState({panelWidth:tn.ZP.getWidth(this.winId)},(()=>this.getFieldStyle()))}))};selectedFolderChanged=()=>{let e,t;const s=Ct.Z.getSelectedFolder();s&&(e=s.accountId,t=s.path,this.setState({folder:e+t}))};getView=()=>{const e=Ze.ZP.getActivePage(this.context.vivaldiWindowId)?.url??"";let t="list";return(0,Pt.vE)(e)?t="composer":(0,Pt.Ds)(e)&&(t="message"),t};getFieldStyle=()=>{const{prefValues:e}=this.props,t=this.getView(),s="list"!==t?0:6;"horizontal"===e[Z.kMailViewLayout]&&this.setState({width:260,margin:6});const{document:n,HTMLDivElement:i}=this.context,a=tn.ZP.getSelected(this.context.vivaldiWindowId),o=a&&!tn.ZP.getSeparateFloating(a,this.context.vivaldiWindowId)&&!e[Z.kPanelsAsOverlayEnabled]&&"left"===e[Z.kPanelsPosition],r=n.querySelector(".mainbar .toolbar-mailbar .toolbar-spacer-panel:has(~ .SearchField)"),l=n.querySelector(".mainbar .toolbar-mailbar .SearchField"),d=Boolean(n.querySelector("#panels-container.overlay.minimized"));if("list"===t&&r instanceof i){const{panelWidth:t}=this.state,n=r.getClientRects()[0];if(n){const i=l?.getClientRects()[0]?.left||6,a=o?n.right>t?n.right-t+(i-n.right):-2:n.right,r=e[Z.kMailViewDimensions],c="vertical_wide"===e[Z.kMailViewLayout],h="left"===e[Z.kPanelsPosition]&&d?34:0;return void this.setState({width:Math.min((c?r.widthWide:r.width)-a+h,800),margin:s})}}this.setState((e=>({width:e.width||260,margin:e.margin||6})))};render(){const e=(0,cc.uu)({draggable:this.props.draggable,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,onDragEnter:this.props.onDragEnter,onDragOver:this.props.onDragOver,onDragLeave:this.props.onDragLeave,onDrop:this.props.onDrop});if(this.props.inEditor)return(0,zn.jsx)("input",{type:"text",value:(0,W.Z)("Mail Search"),name:"MailSearch",readOnly:!0,...e});const t=this.props.buttonClasses;return(0,zn.jsx)("div",{className:Gn()("SearchField MailSearchField",t),name:"MailSearch",style:"horizontal"!==this.props.prefValues[Z.kMailViewLayout]?{flexBasis:this.state.width,marginRight:this.state.margin}:{},...e,children:rp})}}const dp=(0,zd.Z)((0,cc.ZP)(lp),op);async function cp(){await Promise.all([ts.Z.checkForMail(),is.Z.checkForMail(),new Promise((e=>setTimeout(e,1e3)))])}var hp=s(56887);const up=[Z.kFeaturesMail,Z.kFeaturesFeeds,Z.kMailSearchSortField,Z.kMailSearchSortFieldPerFolder,Z.kMailSearchSortFieldSent,Z.kMailShowQuickReply,Z.kMailPreferredRendering,Z.kMailViewLayout];class pp extends Un.PureComponent{static contextType=oi.Z;state={canGoBack:!1,canGoForward:!1,isCheckingMail:!1,folder:Ct.Z.getSelectedFolder()};_isMounted=!1;componentDidMount(){this._isMounted=!0,Ct.Z.addListener(this._onSelectedFolderStoreChange)}componentWillUnmount(){this._isMounted=!1,Ct.Z.removeListener(this._onSelectedFolderStoreChange)}_onSelectedFolderStoreChange=()=>{this.setState({canGoBack:Ct.Z.canGoBack(),canGoForward:Ct.Z.canGoForward(),folder:Ct.Z.getSelectedFolder()})};checkForMail=async()=>{this.setState({isCheckingMail:!0}),await cp(),this.setState({isCheckingMail:!1})};_onHistorySelection=e=>{d.Z.selectFolderFromHistory(this.context.vivaldiWindowId,e)};_getHistoryMenuPromise=e=>()=>{const t=Ct.Z.getHistoryIndex(),s=Ze.ZP.getActivePage(this.context.vivaldiWindowId)?.url??"",n=Ct.Z.getSelectionHistory(),i="backward"===e?n.slice(0,t).reverse():n.slice(t+1),a="backward"===e?(e,t)=>e-t-1:(e,t)=>e+t+1,o=i.map(((e,n)=>({url:s,handler:()=>this._onHistorySelection(a(t,n)),...st.Z.makeNumberMnemonic(e.name,n)})));return Promise.resolve(o)};mailBackMenu=this._getHistoryMenuPromise("backward");mailForwardMenu=this._getHistoryMenuPromise("forward");selectHistoryItem=e=>{d.Z.selectFolderFromHistory(this.context.vivaldiWindowId,e)};rewindFolderSelection=()=>{d.Z.selectFolderFromHistory(this.context.vivaldiWindowId,0)};forwardToEndOfFolderSelection=()=>{d.Z.selectFolderFromHistory(this.context.vivaldiWindowId,Ct.Z.getSelectionHistory().length-1)};navigate=e=>{const t=Ze.ZP.getActivePage(this.context.vivaldiWindowId);t&&(e?sp.Z.forward(this.context.vivaldiWindowId,t.id):sp.Z.back(this.context.vivaldiWindowId,t.id))};toggleLayout=()=>{const e=["horizontal","vertical","vertical_wide"],t=e.indexOf(this.props.prefValues[Z.kMailViewLayout]),s=e[(t+1)%3];I.Z.set(Z.kMailViewLayout,s)};render(){const{name:e,size:t,customizeMenu:s,menuOrigin:n,draggable:i,onDragStart:a,onDragEnd:o,onDrop:r,onDragEnter:l,mimeType:d}=this.props,c={name:e,size:t,customizeMenu:s,menuOrigin:n,draggable:i,onDragStart:a,onDragEnd:o,onDrop:r,onDragEnter:l,mimeType:d};switch(e){case"MailBack":return(0,zn.jsx)(oa.ZP,{...c,disabled:!this.state.canGoBack,onClick:()=>this.navigate(!1),label:(0,W.Z)("Previous Page"),tooltip:(0,W.Z)("Go to previous page"),tooltipExtra:(0,W.Z)("Hold for history list"),menu:this.mailBackMenu,image:Kn.mgF[this.props.size]});case"MailForward":return(0,zn.jsx)(oa.ZP,{...c,disabled:!this.state.canGoForward,onClick:()=>this.navigate(!0),label:(0,W.Z)("Next Page"),tooltip:(0,W.Z)("Go to next page"),tooltipExtra:(0,W.Z)("Hold for forward history list"),menu:this.mailForwardMenu,image:Kn.Zu[this.props.size]});case"MailReload":return(0,zn.jsx)(oa.ZP,{...c,className:this.state.isCheckingMail?"btn-toolbar-spinner":"",disabled:this.props.disabled||this.state.isCheckingMail,tooltip:(0,W.Z)("Check for mail"),onClick:this.checkForMail,image:Kn.QPh[this.props.size]});case"MailViewQuickResponse":const s="show",n="hide";return(0,zn.jsx)(oa.ZP,{...c,tooltip:this.props.prefValues[Z.kMailShowQuickReply]===s?(0,W.Z)("Hide Quick Reply Editor"):(0,W.Z)("Show Quick Reply Editor"),onClick:()=>I.Z.set(Z.kMailShowQuickReply,this.props.prefValues[Z.kMailShowQuickReply]===s?n:s),image:Kn.IWS[t],imageOverride:"MailViewQuickResponse",style:{"--displayQuickReply":this.props.prefValues[Z.kMailShowQuickReply]===s?1:0}});case"MailRenderingMethod":case"MailRenderingMethodText":{const s=(this.props.preview||"prefer_html"===this.props.prefValues[Z.kMailPreferredRendering])&&"MailRenderingMethodText"!==e,n=s?(0,W.Z)("Show Messages as Text"):(0,W.Z)("Show Messages as HTML");return(0,zn.jsx)(oa.ZP,{...c,tooltip:n,onClick:()=>I.Z.toggle(Z.kMailPreferredRendering,"prefer_html","plaintext"),image:s?Kn.lOb[t]:Kn.dYD[t],imageOverride:s?"MailRenderingMethod":"MailRenderingMethodText"})}case"MailViewLayout":const i=this.props.prefValues[Z.kMailViewLayout];return(0,zn.jsx)(oa.ZP,{...c,tooltip:(0,W.Z)("Toggle View"),onClick:this.toggleLayout,disabled:!this.props.prefValues[Z.kFeaturesMail]&&!this.props.prefValues[Z.kFeaturesFeeds],image:Kn.EVi[t],style:this.props.preview?{}:{"--modeHorizontal":"horizontal"===i?1:0,"--modeVertical":"vertical"===i?1:0,"--modeVerticalWide":"vertical_wide"===i?1:0}});case"MailViewThreading":case"MailViewThreadingFlat":const a=(this.props.preview||"threads"===(0,hp.U)(this.state.folder))&&"MailViewThreadingFlat"!==e;return(0,zn.jsx)(oa.ZP,{...c,tooltip:a?(0,W.Z)("Hide Message Threads"):(0,W.Z)("Show Message Threads"),onClick:()=>this.state.folder&&(0,hp.O)(this.state.folder,a?"sentDate":"threads"),disabled:!this.state.folder,image:a?Kn.AE4[t]:Kn.eCP[t],imageOverride:a?"MailViewThreading":"MailViewThreadingFlat"});default:return console.warn(`ToolbarButton “${e}” not found`),null}}}const gp=(0,zd.Z)(pp,up);var mp=s(36943),fp=s(45709);function vp(e,t,s,n,i){const a=ei.Z.getOptionFunction(e),o={};return ei.Z.getNamedMenu(t,e,(async function(e){const r=await rs.Z.messages.get(s.id);switch(r||h.Z.setStatus(t,(0,W.Z)("Could not find message")),e.action){case"CONTEXT_OPEN_IN_NEW_TAB":return{handler:()=>r&&i(r,{inCurrent:!1}),isEnabled:()=>Boolean(r),...a(t,e,o)};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{handler:()=>r&&i(r,{inCurrent:!1,inBackground:!0}),isEnabled:()=>Boolean(r),...a(t,e,o)};case"CONTEXT_MAIL_REPLY":return{handler:()=>r&&ns.Z.reply(r),isEnabled:()=>Boolean(r),...a(t,e,o)};case"CONTEXT_MAIL_REPLY_ALL":return{handler:()=>r&&ns.Z.replyToAll(r),isEnabled:()=>Boolean(r),...a(t,e,o)};case"CONTEXT_MAIL_REPLY_LIST":return{handler:()=>r&&ns.Z.replyToList(r),isEnabled:()=>Boolean(r),...a(t,e,o)};case"CONTEXT_MAIL_FORWARD":return{handler:()=>r&&ns.Z.forward(r),isEnabled:()=>Boolean(r),...a(t,e,o)};case"CONTEXT_MAIL_MARK_READ":return{handler:()=>fp.Z.setRead([s],!0),isEnabled:()=>!kt.Z.call(s.sources),...a(t,e,o)};case"CONTEXT_MAIL_MARK_UNREAD":return{handler:()=>fp.Z.setRead([s],!1),isEnabled:()=>kt.Z.call(s.sources),...a(t,e,o)};case"CONTEXT_MAIL_MARK_JUNK":return{handler:()=>mp.Z.moveToJunk([s]),isVisible:()=>!n,...a(t,e,o)};case"CONTEXT_ADD_CALENDAR_ITEM":default:return{...a(t,e,o)};case"CONTEXT_ADD_CALENDAR_EVENT":return{handler:()=>r&&ie.ZP.showAddEvent({winId:t,message:r,listEntry:s}),isEnabled:()=>Boolean(r),...a(t,e,o)};case"CONTEXT_ADD_CALENDAR_TASK":return{handler:()=>r&&ie.ZP.showAddTask({winId:t,message:r,listEntry:s}),isEnabled:()=>Boolean(r),...a(t,e,o)};case"CONTEXT_ADD_CALENDAR_EVENT_WITH_INVITE":return{handler:()=>r&&ie.ZP.showAddInvite({winId:t,message:r,listEntry:s}),isEnabled:()=>Boolean(r),...a(t,e,o)}}}))}var bp=s(307),Cp=s(59275);const wp=[Z.kKeyboardTabToAll];function yp(e){return e.some((e=>"error"===e.level))}function xp(e){let t=Oc.getLogsByComponent(["Mail","oAuth"]);return e!==Nt.of&&(t=t.filter((t=>t.tags.includes(e)))),t}var Ip=(0,zn.jsx)("br",{});class Ap extends Un.PureComponent{static contextType=oi.Z;constructor(e,t){super(e);const s=xp(e.accountId);this.state={activeListEntry:se.Z.getActiveListEntry(),isMailTabActive:Boolean(Ze.ZP.getActivePage(t.vivaldiWindowId)?.isMailPage),selectedPane:e.requestPane?e.requestPane:A.Z.get(Z.kMailStatusSelectedPane),logs:s,hasLoggedError:yp(s),isCheckingMail:!1}}componentDidMount(){const{selectWindow:e}=this.context;se.Z.addListener(this.handleActiveMessageStoreChange),Ze.ZP.addListener(this.checkIfMailTabActive,e),Oc.addListener(this.handleLogStoreChange)}componentWillUnmount(){se.Z.removeListener(this.handleActiveMessageStoreChange),Ze.ZP.removeListener(this.checkIfMailTabActive),Oc.removeListener(this.handleLogStoreChange)}componentDidUpdate(e){if(e.accountId!==this.props.accountId){const e=xp(this.props.accountId);this.setState({logs:e,hasLoggedError:yp(e)})}}checkIfMailTabActive=()=>{const e=Boolean(Ze.ZP.getActivePage(this.context.vivaldiWindowId)?.isMailPage);this.setState({isMailTabActive:e})};handleActiveMessageStoreChange=()=>{this.updateCurrentMessageDebounced()};handleLogStoreChange=()=>{const e=xp(this.props.accountId);this.setState({logs:e,hasLoggedError:yp(e)})};updateCurrentMessageDebounced=(0,Te.Z)((()=>{this.setState({activeListEntry:se.Z.getActiveListEntry()})}));_selectPane=e=>{I.Z.set(Z.kMailStatusSelectedPane,e),this.setState({selectedPane:e})};#D=async(e,t)=>{this.props.hidePopup(),(0,bp.Z)(this.context.vivaldiWindowId,e,t)};_viewLog=()=>{re.Z.devtoolsPrivate.toggleDevtools(this.context.vivaldiWindowId,"console"),this.props.hidePopup()};_restoreFullTextSearchDb=async()=>{const e={title:(0,W.Z)("title","Rebuild Mail Search Database"),body:(0,W.Z)("Note: This task could take several minutes."),actions:[{title:(0,W.Z)("Rebuild"),action:"confirm"}],cancelAction:{title:(0,W.Z)("Cancel"),action:"cancel",default:!0}},{action:t}=await ue.Z.showModal(this.context.vivaldiWindowId,{modal:e});"cancel"!==t&&await d.Z.restoreFullTextSearchDb()};openMailSettings=()=>{ue.Z.showSettings(this.context.vivaldiWindowId,"mail"),this.props.hidePopup()};#O=e=>{this.props.switchAccount(e)};#j=()=>{ue.Z.showMailInfoDialog(this.context.vivaldiWindowId),this.props.hidePopup()};getContextMenu=()=>{const e=A.Z.get(Z.kMailAccounts),t=[Nt.of].concat(e.map((e=>e.MAIL_EMAIL)));return[{handler:this.openMailSettings,...(0,fi.Z)("Mail Settings")},{handler:this.#j,...(0,fi.Z)("Advanced Mail Info")},{handler:this._viewLog,...(0,fi.Z)("View Log")},{handler:this._restoreFullTextSearchDb,...(0,fi.Z)("command","Rebuild Mail Search Database")},{...(0,fi.Z)("Select Folder"),items:t.map((e=>({type:"checkbox",checked:this.props.accountId===e,handler:()=>this.#O(e),label:e,labelEnglish:e})))}]};checkForMail=async()=>{this.setState({isCheckingMail:!0}),await cp(),this.setState({isCheckingMail:!1})};#L=(e,t)=>{e.persist(),(0,wi.ZP)(e),vp("mailandfeeds",this.context.vivaldiWindowId,t,!1,this.#D).then((t=>{(0,mi.Z)(this.context,t)(e)}))};render(){const e=A.Z.get(Z.kMailAccounts),t=this.state.activeListEntry;return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("div",{className:"StatusPopup-Header",children:[(0,zn.jsx)("h2",{id:"popup-label-mailstatus",children:(0,W.Z)("Mail Status")}),(0,zn.jsxs)("div",{className:"toolbar button-popup-header-toolbar toolbar-default",children:[(0,zn.jsx)(oa.ZP,{onClick:()=>{ue.Z.showMail(this.context.vivaldiWindowId),this.props.hidePopup()},disabled:this.state.isMailTabActive,menuOrigin:"bottomLeft",title:(0,W.Z)("Show Mail")}),(0,zn.jsx)(oa.ZP,{menuOrigin:"bottomLeft",image:Kn.bqs.small,menu:this.getContextMenu,tooltip:(0,W.Z)("Mail status tools")})]})]}),(0,zn.jsx)("div",{className:"toolbar toolbar-default",children:(0,zn.jsxs)("div",{className:"toolbar-group equal-width",children:[(0,zn.jsx)(oa.ZP,{title:(0,W.Z)("Messages"),isPressed:"messages"===this.state.selectedPane,onClick:()=>this._selectPane("messages")}),(0,zn.jsx)(oa.ZP,{title:(0,W.Z)("Accounts"),isPressed:"accounts"===this.state.selectedPane,onClick:()=>this._selectPane("accounts")}),(0,zn.jsx)(oa.ZP,{title:(0,W.Z)("Logs"),isPressed:"logs"===this.state.selectedPane,onClick:()=>this._selectPane("logs"),badgeText:this.state.hasLoggedError?"!":""})]})}),(0,zn.jsxs)("div",{className:"StatusPopup-Content",children:["accounts"===this.state.selectedPane&&(0,zn.jsxs)("div",{className:"StatusPopup-ContentPane",children:[(0,zn.jsx)("div",{className:"StatusPopup-List",children:e.map((e=>(0,zn.jsx)(Ed,{account:e,hidePopup:this.props.hidePopup,showAdvancedInfo:!1},e.MAIL_EMAIL)))}),(0,zn.jsx)("div",{className:"StatusPopup-Footer"})]}),"messages"===this.state.selectedPane&&(0,zn.jsxs)("div",{className:"StatusPopup-ContentPane",children:[(0,zn.jsxs)(zn.Fragment,{children:[this.props.recentMessages.length>0&&(0,zn.jsx)("h3",{children:this.props.accountId===Nt.of?(0,W.Z)("All Recent Messages"):(0,W.Z)("Recent in $1",[(0,W.Z)(this.props.accountId)])}),(0,zn.jsx)("div",{className:"StatusPopup-List",children:this.props.recentMessages.map((e=>{const t=Bs.Z.get(e.toIds),s=t.length>0?t[0].address:"",n=Bs.Z.get(e.fromIds),i=n.length>0?n[0].address:"";return(0,zn.jsxs)("button",{tabIndex:this.props.prefValues[Z.kKeyboardTabToAll],className:Gn()("StatusPopup-Mail",{"StatusPopup-Mail--Unread":!kt.Z.call(e.sources)}),onClick:async()=>{const t=await rs.Z.messages.get(e.id);t&&this.#D(t)},onContextMenu:t=>this.#L(t,e),children:[(0,zn.jsx)(Sd,{emailAddress:s,size:16,className:"StatusPopup-MailIcon"}),(0,zn.jsx)("div",{className:"StatusPopup-MailTitle",children:e.subject}),(0,zn.jsxs)("div",{className:"StatusPopup-MailReceiver",children:[i," ➝ ",s]}),(0,zn.jsx)("div",{className:"StatusPopup-MailDate",children:V()(e.sentDate).fromNow()})]},e.id)}))}),t&&(0,zn.jsx)(zn.Fragment,{children:(0,zn.jsxs)("dl",{className:"StatusPopup-MailDetail",children:[(0,zn.jsx)("dt",{children:(0,W.Z)("Current Message")}),(0,zn.jsx)("dd",{children:t.subject}),(0,zn.jsx)("dt",{children:(0,W.Z)("Internal ID")}),(0,zn.jsx)("dd",{children:t.id}),(0,zn.jsx)("dt",{children:(0,W.Z)("Thread ID")}),(0,zn.jsx)("dd",{children:t.threadKey}),(0,zn.jsx)("dt",{children:(0,W.Z)("Flags")}),(0,zn.jsxs)("dd",{children:[" ",t.flags.join(", ")]}),[...t.sources.entries()].map((([e,t])=>{const s=At.Z.get(e);if(s)return(0,zn.jsxs)(Un.Fragment,{children:[(0,zn.jsx)("dt",{children:(0,W.Z)("Filter ID: $1",[e])}),(0,zn.jsxs)("dd",{children:[(0,zn.jsx)("span",{children:t.read?(0,W.Z)("Read"):(0,W.Z)("Unread")}),", ",(0,zn.jsx)("span",{children:t.deleted?(0,W.Z)("Deleted"):(0,W.Z)("Not deleted")}),", ",(0,zn.jsx)("span",{children:t.internal?(0,W.Z)("Internal"):(0,W.Z)("External")}),Ip,(0,zn.jsx)("span",{children:`${s.accountId} ${(0,Cp.e)(s.name)}`})]})]},e)}))]})})]}),(0,zn.jsx)("div",{className:"StatusPopup-Footer toolbar-default",children:(0,zn.jsx)(oa.ZP,{className:this.state.isCheckingMail?"btn-toolbar-spinner":"",disabled:this.state.isCheckingMail,onClick:()=>this.checkForMail(),title:(0,W.Z)("Check for New Messages"),image:this.state.isCheckingMail?Kn.QPh.small:void 0})})]}),"logs"===this.state.selectedPane&&(0,zn.jsx)("div",{className:"StatusPopup-ContentPane",children:(0,zn.jsx)(Uc,{logs:this.state.logs,component:"Mail"})})]})]})}}const Sp=(0,zd.Z)(Ap,wp);function Zp(e){return e>0?e>9999?(0,W.Z)("$1 K",[Math.round(e/1e3)]):e.toString():""}const Tp=[Z.kMailAccounts,Z.kMailCountersPanelUnseenEnabled,Z.kMailCountersStatusButtonEnabled,Z.kFeaturesMail,Z.kMailStatusButtonStyle,Z.kMailStatusSelectedAccount,Z.kRssSettings];function Ep(){const e=bt.Z.getCounters("All Messages","Unread");return{unseen:e?.unseen||0,unread:e?.unread||0}}function kp(e){const t=Ep(),s=e||Nt.of,n=s===Nt.of?Nt.ik:Nt.Gf;return{accountId:s,isPopupOpen:!1,recentMessages:qt.getList(s,n),hasErrors:!1,...t}}class Np extends Un.PureComponent{static contextType=oi.Z;constructor(e){super(e),this.state={...kp(e.prefValues[Z.kMailStatusSelectedAccount])}}componentDidMount(){qt.addListener(this.onLatestStoreChange),Ih.addListener(this.popupStateChanged),Oc.addListener(this.handleLogStoreChange)}componentWillUnmount(){qt.removeListener(this.onLatestStoreChange),Ih.removeListener(this.popupStateChanged),Oc.removeListener(this.handleLogStoreChange)}static getDerivedStateFromError(){return kp()}popupStateChanged=()=>{const e=Ih.getState().mailPopupOpen;this.setState({isPopupOpen:e})};getMessageCount=()=>this.props.prefValues[Z.kMailCountersPanelUnseenEnabled]?this.state.unseen:this.state.unread;onLatestStoreChange=()=>{const{accountId:e}=this.state,t=qt.getList(e,e===Nt.of?Nt.ik:Nt.Gf),s=Ep();t&&this.setState({recentMessages:t,...s})};hidePopup=()=>{this.setState({isPopupOpen:!1}),wh.close("Mail")};togglePopup=()=>{this.setState((e=>({isPopupOpen:!e.isPopupOpen})))};openMailAccountSheet=()=>{ue.Z.showMailAccountDialog(this.context.vivaldiWindowId)};openMailSettings=()=>{ue.Z.showSettings(this.context.vivaldiWindowId,"mail")};mailHasErrors=()=>Oc.getLogsByComponent(["Mail","oAuth"]).some((e=>"error"===e.level));handleLogStoreChange=()=>{this.setState({hasErrors:this.mailHasErrors()})};switchAccount=e=>{if(I.Z.set(Z.kMailStatusSelectedAccount,e),e===Nt.of){const t=qt.getList(Nt.of,Nt.ik);this.setState({accountId:e,recentMessages:t})}else if(qt.hasList(e)){const t=qt.getList(e,Nt.Gf);this.setState({accountId:e,recentMessages:t})}else!function(e,t){S.Z.dispatch({actionType:"MAIL_LATEST_POPULATE",accountId:e,path:t})}(e,Nt.Gf),this.setState({accountId:e})};getTooltip=()=>{const e=!this.props.prefValues[Z.kFeaturesMail],t=this.props.prefValues[Z.kMailAccounts].length+this.props.prefValues[Z.kRssSettings].length>0;return e||!t?(0,W.Z)("Mail"):(0,W.Z)("Mail Status")};getTooltipExtras=()=>{const e=this.props.prefValues[Z.kMailCountersPanelUnseenEnabled],t=this.getMessageCount();let s="";return t>0&&(s+=e?(0,W.Z)("($1 unseen)","($1 unseen)",[t]):(0,W.Z)("($1 unread)","($1 unread)",[t])),this.state.recentMessages.length>0&&(s+="\n\n"),this.state.recentMessages.forEach(((e,t)=>{t>0&&(s+="\n\n"),s+=e.subject;const n=Bs.Z.get(e.fromIds);n.length>0&&(s+="\n"+n[0].address)})),s};menu=()=>{const e=this.props.prefValues[Z.kMailStatusButtonStyle],t=this.props.prefValues[Z.kMailCountersStatusButtonEnabled];return[{handler:this.openMailSettings,...(0,fi.Z)("Mail Settings")},{items:[{type:"checkbox",checked:"imageandtext"===e,handler:()=>I.Z.set(Z.kMailStatusButtonStyle,"imageandtext"),...(0,fi.Z)("Image and Text")},{type:"checkbox",checked:"image"===e,handler:()=>I.Z.set(Z.kMailStatusButtonStyle,"image"),...(0,fi.Z)("Image Only")},{type:"checkbox",checked:"text"===e,handler:()=>I.Z.set(Z.kMailStatusButtonStyle,"text"),...(0,fi.Z)("title","Text Only")}],...(0,fi.Z)("Button Style")},{type:"checkbox",checked:t,handler:()=>I.Z.set(Z.kMailCountersStatusButtonEnabled,!t),...(0,fi.Z)("Show Message Counter")}]};render(){const e=this.props.prefValues[Z.kMailStatusButtonStyle],t=this.props.preview||this.props.inEditor||this.props.prefValues[Z.kFeaturesMail]&&this.props.isMailWindow,s=this.props.prefValues[Z.kMailCountersStatusButtonEnabled],n=!this.props.isMailWindow,i=this.props.prefValues[Z.kMailAccounts].length+this.props.prefValues[Z.kRssSettings].length>0,a=this.props.prefValues[Z.kMailCountersPanelUnseenEnabled];let o="";return this.state.hasErrors?o="!":s&&(o=Zp(this.getMessageCount())),(0,zn.jsx)(oa.ZP,{badgeText:o??"",className:Gn()(this.state.hasErrors?"StatusButton--HasError":"StatusButton",{unseen:a}),disabled:n,onClick:i?this.togglePopup:this.openMailAccountSheet,customizeMenu:this.props.customizeMenu,menuOrigin:this.props.menuOrigin,tooltip:this.getTooltip(),tooltipExtra:this.getTooltipExtras(),title:"image"!==e?(0,W.Z)("Mail Status"):void 0,image:"text"!==e?Kn.lvj[this.props.size]:void 0,draggable:this.props.draggable,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,onDrop:this.props.onDrop,onDragEnter:this.props.onDragEnter,mimeType:this.props.mimeType,name:this.props.name,hidePopup:this.hidePopup,popupPosition:this.props.popupPosition,popupClassName:"StatusPopup",popupLabelledBy:"popup-label-mailstatus",popupWidth:400,isPopupVisible:this.state.isPopupOpen,menu:this.menu,size:this.props.size,style:t?void 0:{display:"none"},children:!n&&(0,zn.jsx)(Sp,{switchAccount:this.switchAccount,recentMessages:this.state.recentMessages,accountId:this.state.accountId,hidePopup:this.hidePopup,requestPane:this.state.hasErrors?"logs":void 0})})}}const _p=(0,zd.Z)(Np,Tp);var Pp=s(43630);const Mp={getItems:function(e,t){const s=[],n="read"===t?A.Z.get(Z.kMailReadHeadersHidden):A.Z.get(Z.kMailComposeHeadersHidden);return e.map((e=>{s.push({type:"checkbox",checked:!n.includes(e.ref),handler:this._setField.bind(this,e.ref,t),...e.labels})})),s},_setField:function(e,t){const s="read"===t?Z.kMailReadHeadersHidden:Z.kMailComposeHeadersHidden;let n=A.Z.get(s).slice();n.includes(e)?n=n.filter((t=>t!==e)):n.push(e),I.Z.set(s,n)}};var Dp=s(49168);class Op extends Un.Component{_isIMEOpen=!1;state={newLabel:""};onSave=async()=>{if(this._isIMEOpen||!this.state.newLabel||this.doesLabelExist(this.state.newLabel))return;const e=(0,Dp.A4)(this.state.newLabel),t=se.Z.getActiveListEntry(),s=t?(0,Dp.Q3)(t.flags):[];await d.Z.addLabelsFilter(e),await(0,Dp.oD)([e]),Pp.Z.toggleLabel(this.props.windowId,e,s)(),this.props.onClose()};onCancel=()=>{this.props.onClose()};doesLabelExist=e=>{const t=bt.Z.getByAccountId(Nt.ut).map((e=>e.name.toLowerCase()));return t.includes(Nt.ow+e.toLowerCase())||t.includes(e.toLowerCase())};newLabelChanged=e=>{if(this._isIMEOpen)return void this.setState({newLabel:e.target.value});const t=(0,Dp.Tv)(e.target.value);t!==this.state.newLabel&&this.setState({newLabel:t})};render(){const{newLabel:e}=this.state,t=this.doesLabelExist(e);return(0,zn.jsxs)(Ha.Z,{onRequestClose:this.onCancel,className:this.props.viewMode,labelledBy:"popup-label-addmaillabel",children:[(0,zn.jsx)("header",{className:"dialog-header",children:(0,zn.jsx)("h1",{className:"dialog-title",id:"popup-label-addmaillabel",children:(0,W.Z)("Add a New Label")})}),(0,zn.jsxs)("form",{onSubmit:this.onSave,children:[(0,zn.jsxs)("div",{className:"dialog-content",children:[(0,zn.jsx)("input",{type:"text",className:"new-label",maxLength:Dp.Ws,onChange:this.newLabelChanged,onCompositionStart:()=>this._isIMEOpen=!0,onCompositionEnd:e=>{this._isIMEOpen=!1,this.newLabelChanged(e)},value:(0,Vs.kF)(e),autoFocus:!0}),t&&(0,zn.jsx)(fa,{type:"info",children:(0,W.Z)("Label “$1” already exists.",[(0,Vs.kF)(e)])})]}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"submit",className:"primary",value:(0,W.Z)("Save"),disabled:""===e||t}),(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Cancel"),onClick:this.onCancel})]})]})]})}}const jp=Op;var Lp=s(98484),Rp=s(86461);const Bp=(0,W.Z)("All Messages"),Fp=(0,W.Z)("Custom Folders"),Wp=(0,W.Z)("Mailing Lists"),Up=(0,W.Z)("Filters"),Vp=(0,W.Z)("Flags"),Hp=(0,W.Z)("Labels"),Gp=(0,W.Z)("Feeds");function Kp(e){return{name:Fp,accountId:Nt.Ry,path:Nt.ym,id:Nt.Ry,children:e}}function zp(e){return{name:Wp,accountId:Nt.wC,path:Nt.ym,id:Nt.jT,children:e}}function $p(e){return{name:Up,accountId:Nt.Kz,path:Nt.ym,id:Nt.rQ,children:e}}function Yp(e){return{name:Vp,accountId:Nt.MN,path:Nt.ym,id:Nt.q0,children:e}}function Xp(e){return{name:Hp,accountId:Nt.ut,path:Nt.ym,id:Nt.pz,children:e}}function Qp(e){return{name:Gp,accountId:Nt.u4,path:Nt.ym,id:Nt.sM,children:e}}const qp=new Map([[Nt.of,Bp],[Nt.Ry,Fp],[Nt.wC,Wp],[Nt.Kz,Up],[Nt.MN,Vp],[Nt.ut,Hp],[Nt.u4,Gp]]);class Jp extends Un.PureComponent{state={isOpen:!1,disableUndo:!0,undoActions:[]};componentDidMount(){this.getUndoState(),Lp.Z.addListener(this.getUndoState)}componentWillUnmount(){Lp.Z.removeListener(this.getUndoState)}toggleOpen=()=>{this.setState((e=>({isOpen:!e.isOpen})))};getUndoState=()=>{const e=Lp.Z.getUndoActions();this.setState((t=>({undoActions:[...e],disableUndo:0===e.size,isOpen:0!==e.size&&t.isOpen})))};onRequestClose=()=>{this.setState({isOpen:!1})};getLabel=e=>{switch(e.operation){case"delete":return(0,W.Z)("Restore $1 message from Trash","Restore $1 messages from Trash",[e.searchListIds.size]);case"setFlags":if(0===e.sourcesPerSle.size)throw new Error("Empty setFlags undo item");return[...[...e.sourcesPerSle.values()][0].values()][0].read?(0,W.Z)("Mark $1 message as read","Mark $1 messages as read",[e.searchListIds.size]):(0,W.Z)("Mark $1 message as unread","Mark $1 messages as unread",[e.searchListIds.size]);default:throw new Error("Invalid undo item with operation "+e.operation)}};getDetails=e=>{const{undoItem:t,folder:s}=e,{searchListIds:n,operation:i}=t;if(1===n.size){const e=bt.Z.getListEntry([...n][0]);if(e)return e.subject}if(s){const{accountId:e,name:t}=s;if(It.Z.isMailAccount(e))return"delete"===i?(0,W.Z)("Deleted from '$1' ($2)",[t,e]):(0,W.Z)("Marked in '$1' ($2)",[t,e]);{const s=qp.get(e)||e;return"delete"===i?(0,W.Z)("Deleted from '$1' ($2)",[t,s]):(0,W.Z)("Marked in '$1' ($2)",[t,s])}}return""};getIcon=e=>{switch(e.operation){case"delete":return Kn.nre.small;case"setFlags":if(0===e.sourcesPerSle.size)throw new Error("Empty setFlags undo item");return[...[...e.sourcesPerSle.values()][0].values()][0].read?Kn.LDV.small:Kn.aAJ.small;default:throw new Error("Invalid undo item with operation "+e.operation)}};renderUndoActions=()=>{const e=[];let t=0;for(const s of this.state.undoActions){const{undoItem:n,created:i}=s;e.unshift((0,zn.jsx)(Un.Fragment,{children:(0,zn.jsx)("button",{onClick:e=>d.Z.undo(s),children:(0,zn.jsxs)("div",{className:"undo-item",children:[(0,zn.jsx)("span",{className:"button-icon",dangerouslySetInnerHTML:{__html:this.getIcon(n)}}),(0,zn.jsxs)("div",{className:"undo-text",children:[(0,zn.jsxs)("div",{className:"action-timestamp",children:[(0,zn.jsx)("span",{className:"label",children:this.getLabel(n)}),(0,zn.jsx)("span",{className:"timestamp",children:V()(i).format("L")})]}),(0,zn.jsx)("div",{className:"subject",children:(0,zn.jsx)("span",{children:this.getDetails(s)})})]})]})})},t++))}return e};render(){const{draggable:e,onDragStart:t,onDragEnd:s,onDrop:n,onDragEnter:i,mimeType:a,name:o,size:r,customizeMenu:l,menuOrigin:d}=this.props,c={draggable:e,customizeMenu:l,onDragStart:t,onDragEnd:s,onDrop:n,onDragEnter:i,mimeType:a,name:o,size:r,menuOrigin:d};return(0,zn.jsx)(oa.ZP,{...c,tooltip:(0,Rp.wY)("MailUndo"),image:Kn.ERx[r],isPressed:this.state.isOpen,disabled:this.state.disableUndo,onClick:this.toggleOpen,popupWidth:320,isPopupVisible:this.state.isOpen,hidePopup:this.onRequestClose,popupPosition:this.props.popupPosition,children:this.state.isOpen&&(0,zn.jsx)("div",{className:"undo-wrapper",children:this.renderUndoActions()})})}}const eg=Jp;const tg=function(e,t){const s=[];return t?(s.push({handler:()=>Pp.Z.undelete(e),...(0,fi.Z)("mail","Undelete")}),s.push({handler:()=>Pp.Z.prepareDelete(e,!0),...(0,fi.Z)("mail","Delete Permanently")})):s.push({handler:()=>Pp.Z.prepareDelete(e,!1),...(0,fi.Z)("mail","Move to Trash")}),s},sg=[{ref:"from",labels:(0,fi.Z)("sender","From")},{ref:"cc",labels:(0,fi.Z)("Carbon Copy")},{ref:"bcc",labels:(0,fi.Z)("Blind Carbon Copy")}],ng=[Z.kMailSendOrQueue];class ig extends Un.PureComponent{static contextType=oi.Z;state={standardFlag:"",customLabels:[],unread:!1,messageSelected:!1,showLabel:!1,disableTrash:!0,disableJunk:!0,disableArchive:!0,disableMarkRead:!0,disableUndo:!0};componentDidMount(){this.props.inEditor||(se.Z.addListener(this.activeMessageStoreChanged),Rt.addListener(this.updateButtonStatus),this.activeMessageStoreChanged(),this.updateButtonStatus())}activeMessageStoreChanged=()=>{const e=se.Z.getActiveListEntry();if(e){const t=bt.Z.getListEntry(e.id);if(t){const e=Ct.Z.getSelectedFolder(),s=e&&bt.Z.getByFolder(e.accountId,e.path);this.setState({messageSelected:!0,unread:!kt.Z.call(t.sources,s),standardFlag:(0,Dp.Zr)(t.flags),customLabels:(0,Dp.Q3)(t.flags)})}else this.setState({messageSelected:!1})}else this.setState({messageSelected:!1})};updateButtonStatus=()=>{this.setState({disableTrash:!Rt.isEnabled("MailMsgTrash"),disableJunk:!Rt.isEnabled("MailMsgSpam"),disableArchive:!Rt.isEnabled("MailMsgArchive"),disableMarkRead:!Rt.isEnabled("MailMsgStatusRead")})};componentWillUnmount(){this.props.inEditor||(se.Z.removeListener(this.activeMessageStoreChanged),Rt.removeListener(this.updateButtonStatus))}createCustomLabel=()=>{this.setState({showLabel:!0})};closeCustomFlagDlg=()=>{this.setState({showLabel:!1})};getSendQueueMenu=()=>[{type:"checkbox",checked:"send"===this.props.prefValues[Z.kMailSendOrQueue],handler:this.sendAndSetSendAsDefault,...(0,fi.Z)("Send")},{type:"checkbox",checked:"queue"===this.props.prefValues[Z.kMailSendOrQueue],handler:this.queueAndSetQueueAsDefault,...(0,fi.Z)("Queue")}];sendAndSetSendAsDefault=()=>{"send"!==this.props.prefValues[Z.kMailSendOrQueue]&&I.Z.set(Z.kMailSendOrQueue,"send")};queueAndSetQueueAsDefault=()=>{"queue"!==this.props.prefValues[Z.kMailSendOrQueue]&&I.Z.set(Z.kMailSendOrQueue,"queue")};deleteDraftMessage=()=>{go.Z.onCommand(this.context.vivaldiWindowId,"COMMAND_MAIL_COMPOSER_DELETE_DRAFT")};customLabelsMenuData=()=>{const e=Pp.Z.getCustomLabelsMenu(this.context.vivaldiWindowId,this.state.customLabels);return e.push(st.Z.separatorItem,{handler:this.createCustomLabel,ellipsis:!0,...(0,fi.Z)("Add New Label")}),this.state.customLabels.length>0&&e.push(st.Z.separatorItem,{handler:()=>Pp.Z.clearAllLabels(this.context.vivaldiWindowId,this.state.customLabels),...(0,fi.Z)("Clear All Labels")}),e};render(){let e=se.Z.isTrash(),t=se.Z.isJunk(),s=se.Z.isArchived();const n=this.props.size,i=this.context.vivaldiWindowId,a=se.Z.getActiveListEntry()?.flags,o=a?"flag-color "+(0,Dp.Zr)(a).toLowerCase():void 0,{draggable:r,onDragStart:l,onDragEnd:d,onDrop:c,onDragEnter:h,mimeType:u,name:p,size:g,customizeMenu:m,menuOrigin:f}=this.props,v={draggable:r,customizeMenu:m,onDragStart:l,onDragEnd:d,onDrop:c,onDragEnter:h,mimeType:u,name:p,size:g,menuOrigin:f,style:!this.props.preview&&Rt.isHidden(this.props.name)?{display:"none"}:void 0};switch(this.props.name){case"MailMsgEdit":return(0,zn.jsx)(oa.ZP,{...v,tooltip:(0,Rp.wY)(p),onClick:()=>Pp.Z.openMessage(i),disabled:!this.state.messageSelected||!Ct.Z.isFolderAnEditMailFolder(),image:Kn.NNg[n]});case"MailMsgReply":return(0,zn.jsx)(oa.ZP,{...v,tooltip:(0,Rp.wY)(p),onClick:()=>Pp.Z.reply(),disabled:!this.state.messageSelected,image:Kn.hGk[n],commandId:"COMMAND_MAIL_REPLY"});case"MailMsgReplyToAll":const a=se.Z.isListPost();return(0,zn.jsx)(oa.ZP,{...v,tooltip:a?(0,W.Z)("Reply to Mailing List"):(0,Rp.wY)(p),onClick:a?()=>Pp.Z.replyList():()=>Pp.Z.replyAll(),disabled:!this.state.messageSelected,image:Kn.Sap[n],isMenuIndicatorVisible:a,menu:a?()=>Pp.Z.getReplyMenu():void 0,commandId:a?"COMMAND_MAIL_REPLY_LIST":"COMMAND_MAIL_REPLY_ALL"});case"MailMsgForward":return(0,zn.jsx)(oa.ZP,{...v,tooltip:(0,Rp.wY)(p),onClick:()=>Pp.Z.forward(),disabled:!this.state.messageSelected,image:Kn.upG[n],commandId:"COMMAND_MAIL_FORWARD"});case"MailMsgStatusRead":case"MailMsgStatusUnread":const r=Ct.Z.getGoToMenuItems(this.context.vivaldiWindowId,Nt.AF.toolbar),l=this.state.unread||"MailMsgStatusUnread"===this.props.name;return(0,zn.jsx)(oa.ZP,{...v,tooltip:l?(0,Rp.wY)("MailMsgStatusUnread"):(0,Rp.wY)("MailMsgStatusRead"),onClick:l?()=>Pp.Z.markRead(i):()=>Pp.Z.markUnread(i),disabled:!this.state.messageSelected||this.state.disableMarkRead,isMenuIndicatorVisible:!0,isMenuIndicatorDisabled:!this.state.unread,menu:()=>r,image:l?Kn.aAJ[n]:Kn.LDV[n],imageOverride:l?"MailMsgStatusUnread":"MailMsgStatusRead",commandId:l?"COMMAND_MAIL_MARK_READ":"COMMAND_MAIL_MARK_UNREAD"});case"MailMsgFlag":return(0,zn.jsx)(oa.ZP,{...v,tooltip:(0,Rp.wY)(p),onClick:()=>Pp.Z.toggleStandardFlag(this.context.vivaldiWindowId,this.state.standardFlag?this.state.standardFlag:Nt.T4.RED,this.state.standardFlag),buttonClasses:o,disabled:!this.state.messageSelected,image:Kn.nyn[n],isMenuIndicatorVisible:!0,menu:()=>Pp.Z.getStandardFlagsMenu(this.context.vivaldiWindowId,this.state.standardFlag)});case"MailMsgLabel":return(0,zn.jsx)(oa.ZP,{...v,tooltip:(0,Rp.wY)(p),disabled:!this.state.messageSelected,image:Kn.rpm[n],isMenuIndicatorVisible:!0,menu:this.customLabelsMenuData,size:n,hidePopup:this.closeCustomFlagDlg,hasLightArrow:!0,popupClassName:"ToolbarButtonPopup-DefaultStyles",popupLabelledBy:"popup-label-addmaillabel",popupPosition:this.props.popupPosition,isPopupVisible:this.state.showLabel,children:(0,zn.jsx)(jp,{onClose:()=>Promise.resolve(this.closeCustomFlagDlg()),windowId:i,viewMode:"slide"})});case"MailMsgTrash":case"MailMsgTrashRestore":"MailMsgTrashRestore"===this.props.name?e=!0:this.props.preview&&(e=!1);const d=tg(i,e);return(0,zn.jsx)(oa.ZP,{...v,tooltip:e?(0,Rp.wY)("MailMsgTrashRestore"):(0,Rp.wY)("MailMsgTrash"),onClick:e?()=>Pp.Z.undelete(i):()=>Pp.Z.prepareDelete(i,!1),disabled:!this.state.messageSelected||this.state.disableTrash,image:e?Kn.zpg[n]:Kn.nre[n],imageOverride:e?"MailMsgTrashRestore":"MailMsgTrash",isMenuIndicatorVisible:d.length>0,menu:()=>d});case"MailMsgMove":return(0,zn.jsx)(oa.ZP,{...v,tooltip:(0,Rp.wY)(p),disabled:!this.state.messageSelected,image:Kn.Kt8[n],isMenuIndicatorVisible:!0,menu:()=>Pp.Z.getMoveToFolderMenu(i)});case"MailMsgSend":const c="send"===this.props.prefValues[Z.kMailSendOrQueue];return(0,zn.jsx)(oa.ZP,{...v,tooltip:c?(0,W.Z)("Send"):(0,W.Z)("Queue"),onClick:c?()=>go.Z.onCommand(this.context.vivaldiWindowId,"COMMAND_MAIL_SEND_MESSAGE"):()=>go.Z.onCommand(this.context.vivaldiWindowId,"COMMAND_MAIL_QUEUE_MESSAGE"),title:c?(0,W.Z)("Send"):(0,W.Z)("Queue"),image:Kn.zLp[n],menu:this.getSendQueueMenu,isMenuIndicatorVisible:!0,commandId:c?"COMMAND_MAIL_SEND_MESSAGE":"COMMAND_MAIL_QUEUE_MESSAGE"});case"MailMsgDiscard":return(0,zn.jsx)(oa.ZP,{...v,tooltip:(0,Rp.wY)(p),onClick:()=>this.deleteDraftMessage(),image:Kn.GqE[n],isMenuIndicatorVisible:!1});case"MailMsgAttach":return(0,zn.jsx)(oa.ZP,{...v,tooltip:(0,Rp.wY)(p),onClick:()=>go.Z.onCommand(this.context.vivaldiWindowId,"COMMAND_MAIL_COMPOSER_CHOOSE_ATTACHMENTS"),image:Kn.UEH[n],isMenuIndicatorVisible:!1,hasPopup:!0});case"MailMsgSpam":case"MailMsgSpamRestore":return"MailMsgSpamRestore"===this.props.name?t=!0:this.props.preview&&(t=!1),(0,zn.jsx)(oa.ZP,{...v,tooltip:t?(0,Rp.wY)("MailMsgSpamRestore"):(0,Rp.wY)("MailMsgSpam"),onClick:t?()=>Pp.Z.markAsNotJunk(i):()=>Pp.Z.markAsJunk(i),disabled:!this.state.messageSelected||this.state.disableJunk,image:t?Kn.och[n]:Kn.Qwh[n],imageOverride:t?"MailMsgSpamRestore":"MailMsgSpam",isMenuIndicatorVisible:!1,commandId:t?"COMMAND_MAIL_MARK_NOT_JUNK":"COMMAND_MAIL_MARK_JUNK"});case"MailMsgArchive":case"MailMsgArchiveRestore":return"MailMsgArchiveRestore"===this.props.name?s=!0:this.props.preview&&(s=!1),(0,zn.jsx)(oa.ZP,{...v,tooltip:s?(0,Rp.wY)("MailMsgArchiveRestore"):(0,Rp.wY)("MailMsgArchive"),onClick:s?()=>Pp.Z.restoreFromArchive(i):()=>Pp.Z.moveToArchive(i),disabled:!this.state.messageSelected||this.state.disableArchive,image:s?Kn.RaS[n]:Kn._w1[n],imageOverride:s?"MailMsgArchiveRestore":"MailMsgArchive",isMenuIndicatorVisible:!1,commandId:s?"COMMAND_MAIL_RESTORE_FROM_ARCHIVE":"COMMAND_MAIL_MOVE_TO_ARCHIVE"});case"MailMsgShowHeaders":return(0,zn.jsx)(oa.ZP,{...v,tooltip:(0,Rp.wY)(p),isMenuIndicatorVisible:!1,image:Kn.x6W[this.props.size],menu:()=>Mp.getItems(sg,"composer")});case"MailCompose":return(0,zn.jsx)(oa.ZP,{...v,tooltip:(0,Rp.wY)(p),isMenuIndicatorVisible:!1,image:Kn.XTV[this.props.size],onClick:ns.Z.createDraft.bind(null,void 0),commandId:"COMMAND_MAIL_COMPOSE_NEW_MESSAGE"});case"MailUndo":return(0,zn.jsx)(eg,{...v,popupPosition:this.props.popupPosition});default:return console.warn(`ToolbarButton “${this.props.name}” not found`),null}}}const ag=(0,zd.Z)(ig,ng);var og=s(16875);const rg=(0,C.vV)({blockedPageContents:[],blockedPopups:new Set,navigationInfo:{canGoBack:!1,canGoForward:!1,isLoading:!1,reason:void 0,trigger:"stop"},permissionInfo:new Map,sslInfo:{state:"none",issuer:void 0}},!0);class lg extends m.Z{getInitialState(){return new Map}getStateForTab(e){return this.getState().get(e)??rg}getNavigationInfo(e){return this.getStateForTab(e).navigationInfo}getSSLInfo(e){return this.getStateForTab(e).sslInfo}getBlockedPopupsById(e){return this.getStateForTab(e).blockedPopups}getPermissionsById(e){return this.getStateForTab(e).permissionInfo}getblockedPageContents(e){return this.getStateForTab(e).blockedPageContents}reduce(e,t){switch(t.actionType){case"CHROME_TABS_REMOVED":return(0,Fo.u4)(e,t.tabId);case"NAVIGATION_SET_STATE":return function(e,t,s){return dg(e,t,"navigationInfo",(e=>{Object.assign(e,s)}))}(e,t.pageId,t.navigationState);case"PAGE_SET_SSL_STATE":return function(e,t,s){return dg(e,t,"sslInfo",(e=>{Object.assign(e,s)}))}(e,t.pageId,t.info);case"NAVIGATION_ADD_POPUP":return function(e,t,s){return dg(e,t,"blockedPopups",(e=>{e.add(s)}))}(e,t.pageId,t.popupEvent);case"NAVIGATION_REMOVE_POPUP":return function(e,t,s){return dg(e,t,"blockedPopups",(e=>{e.forEach((t=>{t.targetUrl===s&&e.delete(t)}))}))}(e,t.pageId,t.targetUrl);case"NAVIGATION_RESET_BLOCKED_POPUPS":return function(e,t){return dg(e,t,"blockedPopups",(e=>{e.forEach((t=>{e.clear()}))}))}(e,t.pageId);case"NAVIGATION_SET_PERMISSION":return function(e,t,s,n,i,a,o,r){return dg(e,t,"permissionInfo",(e=>{switch(n){case"audiocapture":n="microphone";break;case"videocapture":n="camera"}const t=e.get(s)??new Map;e.set(s,t);const l={requestEvent:i,state:a,promptPermission:o,suppressedPrompt:r};t.set(n,l)}))}(e,t.pageId,t.origin,t.permission,t.requestEvent,t.state,t.promptPermission,t.suppressedPrompt);case"NAVIGATION_RESET_PERMISSIONS":return function(e,t){return dg(e,t,"permissionInfo",(e=>{e.clear()}))}(e,t.pageId);case"NAVIGATION_SET_BLOCKED_CONTENT":return function(e,t,s){return dg(e,t,"blockedPageContents",(e=>{e.push(s)}))}(e,t.pageId,t.contentType);case"NAVIGATION_RESET_BLOCKED_CONTENT":return function(e,t){return dg(e,t,"blockedPageContents",(e=>{e.length=0}))}(e,t.pageId);default:return e}}}function dg(e,t,s,n){const i=e.get(t)??rg,a=(0,C.Uy)(i[s],n);return i[s]===a?e:new Map(e).set(t,{...i,[s]:a})}const cg=new lg;var hg=s(69046);class ug extends Un.PureComponent{static contextType=oi.Z;constructor(e,t){super(e);const s=Ze.ZP.unsafeGetActivePage(t.vivaldiWindowId);this.state={activePageId:s.id,isInternalPage:vs.jk.isInternalPage(s),navigationInfo:cg.getNavigationInfo(s.id),pageHistoryIndex:-1,...this.getFastForwardStoreState(s.id)}}_isMounted=!1;componentDidMount(){const{selectWindow:e}=this.context;this._isMounted=!0,this.props.inEditor||("FastForward"!==this.props.name&&"Rewind"!==this.props.name||og.Z.addListener(this.fastForwardStoreChanged),cg.addListener(this.navigationStoreChanged,(e=>e.get(this.state.activePageId)?.navigationInfo)),Ze.ZP.addListener(this.pageStoreChanged,e))}componentDidUpdate(e,t){e.name!==this.props.name&&console.error("NavButton: Can't reuse component for a different button")}componentWillUnmount(){this._isMounted=!1,this.props.inEditor||("FastForward"!==this.props.name&&"Rewind"!==this.props.name||og.Z.removeListener(this.fastForwardStoreChanged),cg.removeListener(this.navigationStoreChanged),Ze.ZP.removeListener(this.pageStoreChanged))}fastForwardStoreChanged=()=>{this.setState((e=>this.getFastForwardStoreState(e.activePageId)))};getFastForwardStoreState=e=>({forwardUrl:og.Z.getFastForwardUrl(e),rewindRelativeIndex:og.Z.getRewindRelativeIndex(e)});navigationStoreChanged=()=>{this.setState((e=>({navigationInfo:cg.getNavigationInfo(e.activePageId)})))};pageStoreChanged=()=>{if(!this._isMounted)return;const e=Ze.ZP.unsafeGetActivePage(this.context.vivaldiWindowId),t=vs.jk.isInternalPage(e)&&!e.url.startsWith(vs.jk.internals.startpage);e.id!==this.state.activePageId?this.setState({activePageId:e.id,isInternalPage:t,navigationInfo:cg.getNavigationInfo(e.id),...this.getFastForwardStoreState(e.id)}):t!==this.state.isInternalPage&&this.setState({isInternalPage:t})};reload=({shiftKey:e})=>{this.state.navigationInfo&&(this.state.navigationInfo.isLoading?sp.Z.stop(this.context.vivaldiWindowId,this.state.activePageId):sp.Z.reload(this.context.vivaldiWindowId,this.state.activePageId,e))};cloneSelectedTabs=()=>{Ze.ZP.isSelecting(this.context.vivaldiWindowId)?c.ZP.clonePages(Ze.ZP.getSelectedPages(this.context.vivaldiWindowId)):c.ZP.clonePages(qe.aV.of(Ze.ZP.unsafeGetActivePage(this.context.vivaldiWindowId)))};back=e=>{sp.Z.back(this.context.vivaldiWindowId,this.state.activePageId)};backInBackground=()=>{this.openURLFromHistory(-1)};forward=()=>{sp.Z.forward(this.context.vivaldiWindowId,this.state.activePageId)};forwardInBackground=()=>{this.openURLFromHistory(1)};isSubstripVisible(e){return"substrip"===A.Z.get(Z.kTabsStackingMode)&&(!!A.Z.get(Z.kTabsStackingSubstripLocked)||Ze.ZP.getGroup(e,this.context.vivaldiWindowId).size>1)}openURLFromHistory=e=>{const t=this.context.vivaldiWindowId;sp.Z.getPageHistory(t,this.state.activePageId,((s,n)=>{const i=s+e;if(i>=0||i<n.length){const e=Ze.ZP.getPageInWindow(t,this.state.activePageId),s=e?(0,hg.av)(e):null;c.ZP.openURL(t,n[i].url,{inCurrent:!1,inBackground:!0,transition:re.Z.historyPrivate.TransitionType.RELOAD,groupId:s&&this.isSubstripVisible(s)?s:void 0})}}))};rewind=()=>{sp.Z.go(this.context.vivaldiWindowId,this.state.activePageId,-1*this.state.rewindRelativeIndex)};rewindInBackground=()=>{const e=this.context.vivaldiWindowId;if(this.state.rewindRelativeIndex>0){const t=Ze.ZP.getActivePage(e);if(t){const s=og.Z.getRewindHistory(t);s.length>0&&c.ZP.openURL(e,s[0].url,{inBackground:!0,transition:re.Z.historyPrivate.TransitionType.RELOAD})}}};goHome=e=>{c.ZP.showHomepage(this.context.vivaldiWindowId,{inCurrent:!e.shiftKey})};goHomeInNewTab=()=>{c.ZP.showHomepage(this.context.vivaldiWindowId,{inCurrent:!1})};getHistory=()=>new Promise((e=>sp.Z.getPageHistory(this.context.vivaldiWindowId,this.state.activePageId,((t,s)=>this.setState({pageHistoryIndex:t},(()=>e(s)))))));_onHistorySelection=(e,t,s,n)=>{const{ctrlKey:i,shiftKey:a,altKey:o,metaKey:r}=s,l=void 0===n?0:n,d=this.context.vivaldiWindowId;if(t&&(i||a||o||r||0!==l)){const e=(0,fo.ZP)(d,{button:l,ctrlKey:Boolean(i),altKey:Boolean(o),shiftKey:Boolean(a),metaKey:Boolean(r)});c.ZP.openURL(d,t,{...e})}else sp.Z.go(d,this.state.activePageId,e-this.state.pageHistoryIndex)};getHistoryMenuPromise=e=>()=>this.getHistory().then((t=>{const s="backward"===e?t.slice(0,this.state.pageHistoryIndex).reverse():t.slice(this.state.pageHistoryIndex+1),n="backward"===e?(e,t)=>e-t-1:(e,t)=>e+t+1;return s.map(((e,t)=>{let s=e.name;return vs.jk.isInternalUrl(s)&&(s=vs.jk.getDisplayTitleByUrl(s,"")),{...st.Z.makeNumberMnemonic(s,t),url:e.url,handler:s=>{this._onHistorySelection(n(this.state.pageHistoryIndex,t),e.url,s.keyState,s.button)}}}))}));getContextMenuPromise=e=>{const t=this.context.vivaldiWindowId,s=ei.Z.getOptionFunction(e);return ei.Z.getNamedMenu(t,e,(async e=>{switch(e.action){case"CONTEXT_CONTAINER_CUSTOMIZE_TOOLBAR":return{items:this.props.customizeMenu?.(this.props.name),...s(t,e,{})};case"CONTEXT_CONTAINER_FORWARD_HISTORY":return this.getHistoryMenuPromise("forward")().then((n=>({items:n,...s(t,e,{})})));case"CONTEXT_CONTAINER_BACKWARD_HISTORY":return this.getHistoryMenuPromise("backward")().then((n=>({items:n,...s(t,e,{})})));default:return{...s(t,e,{})}}}))};getbackwardbuttonContextMenu=()=>this.getContextMenuPromise("backwardbutton");getforwardbuttonContextMenu=()=>this.getContextMenuPromise("forwardbutton");getrewindbuttonContextMenu=()=>this.getContextMenuPromise("rewindbutton");getfastforwardbuttonContextMenu=()=>this.getContextMenuPromise("fastforwardbutton");getreloadbuttonContextMenu=()=>this.getContextMenuPromise("reloadbutton");gethomebuttonContextMenu=()=>this.getContextMenuPromise("homebutton");render(){const{isInternalPage:e,navigationInfo:t}=this.state,s=this.context.vivaldiWindowId,{draggable:n,onDragStart:i,onDragEnd:a,onDrop:o,onDragEnter:r,mimeType:l,name:d,menuOrigin:c,size:h}=this.props,u={draggable:n,onDragStart:i,onDragEnd:a,onDrop:o,onDragEnter:r,mimeType:l,name:d,menuOrigin:c,size:h};switch(this.props.name){case"Back":return(0,zn.jsx)(oa.ZP,{...u,disabled:!t||!t.canGoBack,onClick:this.back,onMiddleClick:this.backInBackground,modifier:"ctrlCmd",label:(0,W.Z)("Previous Page"),tooltip:(0,W.Z)("Go to previous page"),tooltipExtra:(0,W.Z)("Hold for history list"),menu:this.getbackwardbuttonContextMenu,alwaysMenu:!0,image:Kn.mgF[this.props.size],commandId:"COMMAND_PAGE_BACK"});case"Forward":return(0,zn.jsx)(oa.ZP,{...u,disabled:!t||!t.canGoForward,onClick:this.forward,onMiddleClick:this.forwardInBackground,modifier:"ctrlCmd",label:(0,W.Z)("Next Page"),tooltip:(0,W.Z)("Go to next page"),tooltipExtra:(0,W.Z)("Hold for forward history list"),menu:this.getforwardbuttonContextMenu,alwaysMenu:!0,image:Kn.Zu[this.props.size],commandId:"COMMAND_PAGE_FORWARD"});case"Rewind":return(0,zn.jsx)(oa.ZP,{...u,className:"button-narrow",disabled:!(Number.isInteger(this.state.rewindRelativeIndex)&&this.state.rewindRelativeIndex>0),onClick:this.rewind,onMiddleClick:this.rewindInBackground,label:(0,W.Z)("verb","Rewind"),tooltip:"Rewind by visited domain",tooltipExtra:(0,W.Z)("Hold for history domain list"),menu:this.getrewindbuttonContextMenu,alwaysMenu:!0,image:Kn.jtA[this.props.size],commandId:"COMMAND_PAGE_REWIND"});case"FastForward":return(0,zn.jsx)(oa.ZP,{...u,className:"button-narrow",label:(0,W.Z)("verb","Fast Forward"),tooltip:this.state.forwardUrl?(0,W.Z)("Fast Forward - $1",[this.state.forwardUrl]):(0,W.Z)("Fast Forward"),onClick:()=>Me.Z.navigateFastforward(s),disabled:!this.state.forwardUrl,menu:this.getfastforwardbuttonContextMenu,alwaysMenu:!0,image:Kn.Wmx[this.props.size],commandId:"COMMAND_PAGE_FAST_FORWARD"});case"Reload":case"Stop":case"COMMAND_PAGE_REFRESH":const n=!!t&&t.isLoading;return(0,zn.jsx)(oa.ZP,{...u,disabled:e,menu:this.getreloadbuttonContextMenu,alwaysMenu:!0,label:n&&!e?(0,W.Z)("verb","Stop"):(0,W.Z)("verb","Reload"),tooltip:n&&!e?(0,W.Z)("verb","Stop"):(0,W.Z)("Reload current page"),onClick:this.reload,onMiddleClick:this.cloneSelectedTabs,image:n&&!e||"Stop"===this.props.name?Kn.YVA[this.props.size]:Kn.GO5[this.props.size],imageOverride:n&&!e||"Stop"===this.props.name?"Stop":"Reload",commandId:n&&!e?"COMMAND_STOP_PAGE":"COMMAND_PAGE_REFRESH"});case"Home":case"COMMAND_SHOW_HOMEPAGE":return(0,zn.jsx)(oa.ZP,{...u,label:(0,W.Z)("noun","Homepage"),tooltip:(0,W.Z)("Go to homepage"),menu:this.gethomebuttonContextMenu,alwaysMenu:!0,onClick:this.goHome,onMiddleClick:this.goHomeInNewTab,image:Kn.PaK[this.props.size],commandId:"COMMAND_SHOW_HOMEPAGE"});default:return null}}}const pg=ug;var gg=s(57049),mg=s(751);class fg extends Un.PureComponent{static contextType=oi.Z;#R=!1;#B=!1;#F=this.props.autocompleteValue;#W=!1;inputField=Un.createRef();componentDidMount(){this.context.addEventListener("drop",this.windowDropHandler)}componentDidUnMount(){this.context.removeEventListener("drop",this.windowDropHandler)}componentDidUpdate(e){if((e.autocompleteValue!==this.props.autocompleteValue||e.typedValue!==this.props.typedValue)&&this.inputField.current){const e=this.inputField.current,{selectionStart:t,selectionEnd:s}=this.#W&&this.props.autocompleteValue===this.props.typedValue?e:function(e,t){if(!e||!t)return{selectionStart:-1,selectionEnd:-1};const s=t.length,n=e.length;return s===n?{selectionStart:-1,selectionEnd:-1}:e.toLowerCase().startsWith(t.toLowerCase())?{selectionStart:s,selectionEnd:n}:{selectionStart:-1,selectionEnd:-1}}(this.props.autocompleteValue,this.props.typedValue);this.props.navigationMode||-1===t||(e.selectionStart!==t&&(e.selectionStart=t,t!==s&&(e.selectionDirection="backward")),e.selectionEnd!==s&&(e.selectionEnd=s))}}setSelection=(e,t="forward")=>{const s=this.inputField.current;s&&s.setSelectionRange(e.selectionStart,e.selectionEnd,t)};onValueChange=e=>{this.props.onValueChange(e)};onKeyPress=e=>{this.props.onKeyPress(e),this.props.typedValue+e.key===e.currentTarget.value&&this.onValueChange(e.currentTarget.value)};onSelect=e=>{const t=this.inputField.current;t&&t.value.length>0&&0===t.selectionStart&&t.selectionEnd===t.value.length&&"none"===t.selectionDirection&&(t.selectionDirection="forward")};onChange=e=>{const{currentTarget:t,nativeEvent:s}=e;let n;this.#W="historyUndo"===s?.inputType,n=this.#R&&this.#B&&!1!==this.props.readOnlyDnD?this.#F:t.value,this.onValueChange(n??"")};onDragStart=e=>{this.#R=!0,this.props.onDragStart(e)};windowDropHandler=e=>{this.#B=this.#R,this.#F=this.props.autocompleteValue};onDragEnd=e=>{this.#R=!1,this.#B=!1,this.props.onDragEnd(e)};render(){return(0,zn.jsx)("input",{id:this.props.inputId??mg.IY,ref:this.inputField,value:this.props.autocompleteValue||this.props.typedValue,autoComplete:"off",spellCheck:"false",type:"text",autoFocus:this.props.autoFocus,className:this.props.className,disabled:this.props.disabled,placeholder:this.props.placeholder,title:this.props.title,readOnly:this.props.readOnly,onChange:this.onChange,onKeyPress:this.onKeyPress,onBlur:this.props.onBlur,onFocus:this.props.onFocus,onSelect:this.onSelect,onCompositionStart:this.props.onCompositionStart,onCompositionUpdate:this.props.onCompositionUpdate,onCompositionEnd:this.props.onCompositionEnd,onClick:this.props.onClick,onContextMenu:this.props.onClick,onDragStart:this.onDragStart,onDragEnter:this.props.onDragEnter,onDragOver:this.props.onDragOver,onDragLeave:this.props.onDragLeave,onDragEnd:this.onDragEnd,onDrop:this.props.onDrop,onMouseDown:this.props.onMouseDown,onMouseUp:this.props.onMouseUp,onKeyDown:this.props.onKeyDown,onCut:this.props.onCut,onCopy:this.props.onCopy,onPaste:this.props.onPaste})}}var vg=s(67975);const bg=Object.freeze({autocompleteValue:"",typedUrl:void 0});class Cg extends m.Z{getInitialState(){return new Map}getUrlfieldState(e){return this.getState().get(e)??bg}reduce(e,t){switch(t.actionType){case"CHROME_TABS_REMOVED":case"URLFIELD_RESET":{const s=void 0===t.tabId?t.pageId:t.tabId;return void 0===s?this.getInitialState():(0,Fo.u4)(e,s)}case"URLFIELD_UPDATE_STATE":return(0,Fo.cR)(e,t.pageId,(e=>{Object.assign(e,t.state)}),bg);case"PAGE_CLOSE":{const s=t.pages;return s.some((t=>e.has(t.id)))&&(e=new Map(e),s.forEach((t=>e.delete(t.id)))),e}}return e}}const wg=new Cg;class yg extends Un.PureComponent{static contextType=oi.Z;context;#U=!1;#V=!1;#H=!1;_allowedToAutocomplete=!0;refUrlInput=Un.createRef();get isIMEOpen(){return this.#V}componentDidUpdate(e){e.displayUrl!==this.props.displayUrl&&(this._allowedToAutocomplete=!1),e.autocompleteValue!==this.props.autocompleteValue&&(this.props.autocompleteValue?this._allowedToAutocomplete&&this.props.onAutocompleteValueChange(this.props.autocompleteValue):this._allowedToAutocomplete=!1)}_makeSubmit=e=>{const t={ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,metaKey:e.metaKey};this._allowedToAutocomplete=!1,this.props.onSubmit(t)};onKeyDown=e=>{if(this.props.onKeyDown(e),"Escape"===e.key&&(this._allowedToAutocomplete=!1),"Enter"===e.key&&(e.altKey||e.ctrlKey||e.metaKey))return this._makeSubmit(e),void(this._allowedToAutocomplete=!1);"Backspace"===e.key&&this.#V&&(this.#U=!0)};onKeyPress=e=>{this.props.onKeyPress(e),"Enter"!==e.key&&13!==e.which||e.altKey||e.ctrlKey||this._makeSubmit(e)};onValueChange=e=>{const{autocompleteValue:t}=wg.getUrlfieldState(this.props.pageId),s=this.props.typedUrl,n=e===this.props.displayUrl?void 0:e;vg.Z.updateState(this.props.pageId,{typedUrl:n});const i=e.endsWith(" "),a=!this.props.navigationMode&&void 0!==n&&(void 0===s||n.length>s.length),o=this.props.navigationMode&&Boolean(t)&&e.length>=t.length,r=this.props.autocompletionEnabled&&!this.#V&&!i&&!this.#H;this._allowedToAutocomplete=r&&(a||o),this.#H=!1,this.props.onValueChange(e)};onCompositionStart=()=>{this.#V=!0};onCompositionUpdate=()=>{this.#V=!0};onCompositionEnd=e=>{const t=e.currentTarget.value,s=this.props.typedUrl??this.props.displayUrl;this._allowedToAutocomplete=!this.#U&&t.length>=s.length,this.#U=!1,this.#V=!1};onCut=e=>{this._allowedToAutocomplete=!1,this.props.onCut(e)};onPaste=e=>{this.#H=!0,this.props.onPaste(e)};render(){const{typedUrl:e,displayUrl:t}=this.props;return(0,zn.jsx)(fg,{ref:this.refUrlInput,autocompleteValue:this.props.autocompleteValue,typedValue:e??t,autoFocus:this.props.autoFocus,className:this.props.className,disabled:this.props.disabled,placeholder:this.props.placeholder,title:this.props.title,readOnly:this.props.readOnly,readOnlyDnD:this.props.readOnlyDnD,inputId:this.props.inputId,navigationMode:this.props.navigationMode,onBlur:this.props.onBlur,onFocus:this.props.onFocus,onCompositionStart:this.onCompositionStart,onCompositionUpdate:this.onCompositionUpdate,onCompositionEnd:this.onCompositionEnd,onClick:this.props.onClick,onContextMenu:this.props.onClick,onDragStart:this.props.onDragStart,onDragEnter:this.props.onDragEnter,onDragOver:this.props.onDragOver,onDragLeave:this.props.onDragLeave,onDragEnd:this.props.onDragEnd,onDrop:this.props.onDrop,onMouseDown:this.props.onMouseDown,onMouseUp:this.props.onMouseUp,onCut:this.onCut,onCopy:this.props.onCopy,onPaste:this.onPaste,onKeyDown:this.onKeyDown,onValueChange:this.onValueChange,onKeyPress:this.onKeyPress})}}var xg=s(74117);const Ig=function(e){return e.length>=32e3};const Ag=function(e,t,s,n){if(Ig(e)||Ig(t)||t.startsWith("data:"))return t;const i=e.toLowerCase().split(" ");let a;try{a=new RegExp((s?"\\b":"")+"("+i.map((e=>(0,xg.Z)(e.toLowerCase()))).filter((e=>e.trim().length>0)).join("|")+")","i")}catch(e){return t}let o=t.split(a);const r=e.toLowerCase(),l=o.findIndex((e=>e.toLowerCase()===r));if(s&&-1!==l){const e=o.slice(0,l).join(""),t=o.slice(l+1).join("");o=[e,o[l],t]}return(0,zn.jsx)("span",{className:n,children:o.reduce(((e,t,n)=>(!s||l===n)&&a.test(t)?e.concat((0,zn.jsx)("b",{children:t},n)):e.concat((0,zn.jsx)("span",{children:t},n))),[])})};var Sg=s(55432);const Zg="omni_option_";function Tg(e,t,s,n){return e?t?Ag(t,e,s,n):(0,zn.jsx)("span",{className:n,children:e}):""}var Eg=(0,zn.jsx)("span",{children:"-"});const kg=Un.forwardRef(((e,t)=>{if("function"==typeof t)throw Error("Callback refs not supported");const s=Un.useContext(oi.Z),n=(0,Un.useRef)(!1),i=(0,Un.useRef)(),[a,o]=(0,Un.useState)(!1);(0,Un.useEffect)((()=>{const t=A.Z.get(Z.kAddressBarUrlOpenShortcut);function n(e){((0,Zi.Mr)(e)&&"shift"!==t||(0,Zi.S2)(e)&&"alt"!==t)&&o(!0)}function i(e){(0,Zi.Mr)(e)&&"shift"!==t||(0,Zi.S2)(e)&&"alt"!==t||o(!1)}return e.item.hasTabMatch&&e.isHighlighted&&(s.document.addEventListener("keydown",n),s.document.addEventListener("keyup",i)),()=>{s.document.removeEventListener("keydown",n),s.document.removeEventListener("keyup",i),o(!1)}}),[s.document,e.isHighlighted,e.item]),(0,Un.useEffect)((()=>{!n.current&&e.isHighlighted&&i.current?.scrollIntoViewIfNeeded(),n.current=e.isHighlighted}),[e.isHighlighted,i]);const{item:r,displayText:l,index:d,isHighlighted:c,onMouseOver:h,pattern:u,displayUrl:p,badge:g,isOnlyTextCategory:m,faviconUrl:f,activeTabSwitch:v,switchToTab:b}=e,C=!A.Z.get(Z.kAddressBarSearchAlwaysShowDropdownBadge)&&!c&&!(0,Sg.eE)(r),w=Gn()({"omni-clickable":!0,OmniLinkItem:!0,"OmniLinkItem--Highlighted":c,"OmniLinkItem--TabSwitch":r.hasTabMatch,"OmniLinkItem--ButtonFocus":r.hasTabMatch&&v,"OmniLinkItem--DisplayTextOnly-CanDelete":m&&r.deletable,"OmniLinkItem--DisplayTextOnly-NoDelete":m&&!r.deletable,"modifier-pressed":a}),y=!(0,Sg.in)(r),x=Gn()("displayTitle",{fromSearchField:e.fromSearchField});return(0,zn.jsxs)("li",{"data-index":d,"data-url":p||"",ref:e=>{t&&(t.current=e),i.current=e},className:w,onClick:t=>{const{item:s}=e;e.onClick(s,t)},onMouseUp:t=>{const{item:s}=e;t.button===ai.Z.kCenter&&e.onMiddleClick(s)},onMouseOver:h,role:"option","aria-selected":c,id:Zg+d,children:[f&&(0,zn.jsx)("div",{className:"OmniLinkItem-Favicon",children:(()=>{const{faviconUrl:t,faviconType:s}=e;return t?(0,zn.jsx)(Vn.ZP,{url:t,loadType:"url"===s?"faviconSkipCache":"img"===s?"faviconFromCache":"page"}):null})()}),(0,zn.jsxs)("div",{className:"OmniLinkItem-DisplayText",children:[Tg(l,u,y,x),l&&p&&Eg,Tg(p,u,y,"displayUrl")]}),r.hasTabMatch&&!e.fromSearchField&&(0,zn.jsx)("span",{className:"OmniLinkItem-TabSwitchLabel",dangerouslySetInnerHTML:{__html:Kn.P$T+(0,W.Z)("Switch to Tab")},onClick:e=>{e.preventDefault(),e.stopPropagation(),b&&b(r,s.vivaldiWindowId)}}),g&&(0,zn.jsx)("span",{className:Gn()("OmniLinkItem-Badge",{"OmniLinkItem-Badge--HoverOnly":C}),children:g}),r.deletable&&(0,zn.jsx)("span",{className:"OmniLinkItem-EraseButton",title:(0,W.Z)("Delete history item"),onClick:t=>{if(!e.onDelete)return;const{item:s}=e;e.onDelete(s),t.stopPropagation()},dangerouslySetInnerHTML:{__html:Kn.kze}})]})})),Ng=Un.memo(kg),_g=[Z.kAddressBarShowSearchSuggestionsWarning,Z.kSearchSuggestEnabled];function Pg(){const e=Un.useContext(oi.Z),t=(0,Eo.Z)(_g),s=t[Z.kAddressBarShowSearchSuggestionsWarning];if(!(-1!==s&&s>=0&&s<2&&!t[Z.kSearchSuggestEnabled]&&(0,mg.RT)(e)&&pn.Z.getDefault(!1)?.suggestUrl&&!fe.ZP.isIncognitoOrGuest(e.vivaldiWindowId)))return null;function n(t){(0,wi.ZP)(t),I.Z.set(Z.kAddressBarShowSearchSuggestionsWarning,-1),(0,mg.x0)(e)}return(0,zn.jsxs)("div",{className:"search-suggestion-warning",children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.WVA}}),(0,zn.jsxs)("div",{children:[(0,zn.jsx)("h2",{children:(0,W.Z)("Enable Search Suggestions")}),(0,zn.jsx)("p",{className:"faded-text",children:(0,W.Z)("Share your input with search providers for suggestions. Disabled by default for privacy.")}),(0,zn.jsxs)("div",{className:"toolbar toolbar-default",children:[(0,zn.jsx)("input",{type:"button",className:"primary",value:(0,W.Z)("other","Enable"),onClick:e=>{I.Z.set(Z.kSearchSuggestEnabled,!0),n(e)}}),(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Disable"),onClick:e=>{n(e)}})]})]})]})}const Mg=Un.memo(Pg);var Dg=s(52250);function Og(e,t){return function(e){const t=document.createElement("canvas").getContext("2d");return t.font="13px system-ui, -apple-system, HelveticaNeue, sans-serif",t.measureText(e).width}(e.description)<t/1.5?e.description:e.contents}function jg(e,t,s){return"typedText"===e||(0,li.Z)(t[e],s[e])}var Lg=(0,zn.jsx)(Mg,{});class Rg extends Un.Component{static contextType=oi.Z;nodeRef=Un.createRef();state={searchEngineKeyword:"",searchEngineName:""};static getDerivedStateFromProps(e){const t=(e.typedSearchEngine||e.defaultSearchEngine||{name:""}).name;return{searchEngineKeyword:!e.typedSearchEngine&&e.defaultSearchEngine&&e.defaultSearchEngine.keyword&&e.defaultSearchEngine.keyword+" "||"",searchEngineName:t}}shouldComponentUpdate(e,t){return!(0,ri.Z)(this.props,e,jg)||!(0,ri.Z)(this.state,t)}getNode(){return this.nodeRef.current}handleClickOutside=()=>{this.props.onMenuClosed?.()};onLinkItemClicked=(e,t)=>{const s={ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,button:t.button};this.props.onLinkItemClicked(e,(0,fo.ZP)(this.context.vivaldiWindowId,s,e.transition))};onDeleteItem=e=>{this.props.onDeleteItem(e)};onLinkItemMiddleClicked=e=>{const t={...fo.ke.openInBackgroundTab};this.props.onLinkItemClicked(e,t)};getBadge=e=>{const t=(0,Sg.Ht)(e);return this.props.fromSearchField?(0,Sg.eE)(e)?t:"":e.hasTabMatch?"":t};getDisplayText=e=>(0,Sg.K5)(e)||(0,Sg.dC)(e)||(0,Sg.b1)(e)?e.contents:(0,Sg.eE)(e)&&this.props.getOffsetWidth?Og(e,this.props.getOffsetWidth()):e.description;getDisplayUrl=e=>this.props.fromSearchField||(0,Sg.eE)(e)||(0,Sg.b1)(e)?"":(0,Sg.K5)(e)||(0,Sg.dC)(e)?e.description:e.contents;getHighlightText=e=>{if(this.props.fromSearchField||(0,Sg.K5)(e))return e.inlineAutocompletion.length>0?e.inlineAutocompletion:this.props.typedText;if((0,Sg.in)(e)){const t=e.fillIntoEdit,s=`= ${t}`;return e.contents.includes(s)?s:t}return this.props.typedText};renderLinkItem=(e,t)=>{const s=t===this.props.selectionIndex,n=void 0!==this.props.autocompleteHighlight&&this.props.autocompleteHighlight===e.destinationUrl&&-1===this.props.selectionIndex,i=this.getDisplayText(e),a=this.getDisplayUrl(e),o=this.getHighlightText(e);return(0,zn.jsx)(Ng,{item:e,index:t,displayText:i,displayUrl:a,pattern:o,isOnlyTextCategory:!1,isHighlighted:s||n,badge:this.getBadge(e),onClick:this.onLinkItemClicked,onMiddleClick:this.onLinkItemMiddleClicked,onDelete:e.deletable?this.onDeleteItem:null,faviconUrl:e.faviconUrl,faviconType:e.faviconType,fromSearchField:this.props.fromSearchField,activeTabSwitch:this.props.activeTabSwitch??!1,switchToTab:this.props.switchToTab??void 0},t)};render(){const{items:e}=this.props;return(0,zn.jsxs)("div",{ref:this.nodeRef,className:"OmniDropdown",children:[Lg,(0,zn.jsx)("ul",{className:"OmniDropdown-Collection",role:"listbox","aria-activedescendant":Zg+this.props.selectionIndex,id:this.props.id,children:e.map(((e,t)=>this.renderLinkItem(e,t)))})]})}}const Bg=(0,Dg.Z)(Rg);var Fg=s(2004);var Wg=(0,zn.jsx)("bdo",{children:"."}),Ug=(0,zn.jsx)("bdo",{children:"."}),Vg=(0,zn.jsx)("bdo",{children:":"}),Hg=(0,zn.jsx)("bdo",{children:":"});class Gg extends Un.Component{static contextType=oi.Z;refComponent=Un.createRef();componentDidMount(){if(!this.refComponent.current)return;const e=this.refComponent.current;this._intersectionObserver=new IntersectionObserver((([e])=>{this.onIntersectionChange(e.intersectionRatio)}),{threshold:1}),this._intersectionObserver.observe(e)}componentWillUnmount=()=>{this.props.onBaseDomainObscured(!1),this._intersectionObserver?.disconnect()};onIntersectionChange=e=>{const t=e<1;this.props.onBaseDomainObscured(t)};renderBdoSubDomain=e=>-1===e.indexOf(".")?(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("bdi",{children:e}),Wg]}):e.split(".").map(((e,t)=>(0,zn.jsxs)("span",{children:[(0,zn.jsx)("bdi",{children:e}),Ug]},t)));render(){const{urlFragment:e,onGoToPath:t,tld:s,basedomain:n,subdomain:i,port:a,scheme:o}=this.props,r=(o?`${o}://`:"")+(e||"")+(a?`:${a}`:""),l=this.context.vivaldiWindowId,d=function(e,t){let s=0;for(let n=e.lastIndexOf(t)-1;n>0&&"."===e[n];n--)s++;return s}(r,s||"");return n?(0,zn.jsx)($g,{windowId:l,url:r,rawDisplay:this.props.rawDisplay,onGoToPath:t,children:(0,zn.jsxs)("span",{ref:this.refComponent,children:[i&&(0,zn.jsx)("span",{className:"UrlFragment--Lowlight UrlFragment-HostFragment-Subdomain",children:this.renderBdoSubDomain(i)}),(0,zn.jsx)("span",{className:"UrlFragment--Highlight UrlFragment-HostFragment-Basedomain",children:(0,zn.jsx)("bdi",{children:n})}),s&&(0,zn.jsxs)("span",{className:"UrlFragment--Highlight UrlFragment-HostFragment-TLD",children:[(0,zn.jsx)("bdo",{children:".".repeat(d)}),(0,zn.jsx)("bdi",{children:s})]}),a&&(0,zn.jsxs)("span",{className:"UrlFragment--Lowlight UrlFragment-HostFragment-Port",children:[Hg,(0,zn.jsx)("bdi",{children:a})]})]})}):(0,zn.jsx)($g,{windowId:l,url:r,rawDisplay:this.props.rawDisplay,onGoToPath:t,children:(0,zn.jsxs)("span",{ref:this.refComponent,children:[(0,zn.jsx)("span",{className:"UrlFragment--Highlight",children:e}),a&&(0,zn.jsxs)("span",{className:"UrlFragment--Lowlight",children:[Vg,a]})]})})}}var Kg=s(50503),zg=s(10373);function $g({windowId:e,url:t,className:s,children:n,onGoToPath:i,rawDisplay:a}){return(0,zn.jsx)("span",{className:Gn()(s,{"UrlFragment-Link":!a}),onClick:()=>i(t,{inCurrent:!0,transition:re.Z.historyPrivate.TransitionType.AUTO_TOPLEVEL}),onMouseOver:()=>!a&&h.Z.setStatus(e,t),onMouseOut:()=>!a&&h.Z.clearStatus(e),children:n})}var Yg=(0,zn.jsx)("bdo",{children:"/"});function Xg({windowId:e,urlFragment:t,onGoToPath:s,host:n,scheme:i,port:a,rawDisplay:o,shouldDisplayPostfix:r}){return t?t.split("/").slice(1).map(((t,l,d)=>{if(!t&&r)return null;const c=(i?`${i}://`:"")+(n||"")+(a?`:${a}`:"")+"/"+d.slice(0,l+1).join("/");return(0,zn.jsxs)($g,{windowId:e,className:"UrlFragment--Lowlight",rawDisplay:o,onGoToPath:s,url:c,children:[Yg,(0,zn.jsx)("bdi",{children:t})]},c)})):null}var Qg=(0,zn.jsx)("bdo",{children:"&"}),qg=(0,zn.jsx)("bdo",{children:"="});function Jg({urlFragment:e}){if(!e)return null;return e.split("&").map(((e,t)=>{const s=e.split("="),n=s[0];s.shift();const i=s.join("="),a=s.length>0;return(0,zn.jsxs)("span",{children:[0!==t&&Qg,n&&(0,zn.jsx)("bdi",{children:n}),a&&qg,i&&(0,zn.jsx)("bdi",{children:i})]},n)}))}var em=(0,zn.jsx)("bdo",{children:"/"}),tm=(0,zn.jsx)("bdo",{children:"?"}),sm=(0,zn.jsx)("bdo",{children:"#"});function nm({urlFragment:e,path:t}){if(!e)return null;const s=e.indexOf("#"),n=-1!==s?e.substring(s+1,e.length):"",i="?"===e.charAt(0)?e.substring(1,-1===s?e.length:s):"",a=!t||"/"===t||"/"===t.slice(-1);return(0,zn.jsxs)("span",{className:"UrlFragment--Lowlight",children:[a&&em,i&&(0,zn.jsxs)(zn.Fragment,{children:[tm,(0,zn.jsx)(Jg,{urlFragment:i})]}),n&&(0,zn.jsxs)(zn.Fragment,{children:[sm,(0,zn.jsx)("bdi",{children:n})]})]})}var im=(0,zn.jsx)("bdo",{children:"://"});function am({urlFragment:e}){return(0,zn.jsxs)("span",{className:"UrlFragment--Lowlight",children:[(0,zn.jsx)("bdi",{children:e}),im]})}var om=(0,zn.jsx)("span",{className:"UrlFragment--Highlight",children:"data:"});function rm({urlFragment:e}){return e?(0,zn.jsxs)(zn.Fragment,{children:[om,(0,zn.jsx)("span",{className:"UrlFragment--Lowlight",children:e.substring("data:".length,u.RL)})]}):null}function lm({windowId:e,displayUrl:t,shouldShowFullUrl:s,onGoToPath:n,shouldHighlightBaseDomain:i,onBaseDomainObscured:a,urlFragments:o,rawDisplay:r}){const l=function(){const{selectWindow:e,vivaldiWindowId:t}=Un.useContext(oi.Z),[s,n]=Un.useState(!1);return Un.useEffect((()=>{function s(e,s,i,a){e===t&&a===mo.Z.KEY_CONTROL&&n(s)}function i(){n(!1)}return re.Z.tabsPrivate.onKeyboardChanged.addListener(s),fe.ZP.addListener(i,e),()=>{re.Z.tabsPrivate.onKeyboardChanged.removeListener(s),fe.ZP.removeListener(i)}}),[e,t]),s}();if(!t)return null;const d=t;if(!["http","https","ftp","data"].includes(d.substring(0,d.indexOf(":"))))return(0,zn.jsx)("div",{className:Gn()({"UrlFragment-Wrapper":!r}),"aria-hidden":"true",children:(0,zn.jsx)("span",{className:"UrlFragment--Highlight",children:t.substring(0,u.RL)})});const{schema:c}=(0,zg.C)(t);if("data:"===c)return(0,zn.jsxs)("div",{className:Gn()({"UrlFragment-Wrapper":!r,"UrlFragment-Wrapper--ShouldHighlight":i}),"aria-hidden":"true",children:[(0,zn.jsx)(rm,{urlFragment:d}),";"]});const h=function(e){return(e.scheme?.length||0)+(e.username?.length||0)+(e.password?.length||0)+(e.host?.length||0)+(e.path?.length||0)+(e.ref?.length||0)+(e.query?.length||0)+(e.port?.length||0)+(e.tld?.length||0)>=u.RL}(o);if(h)return(0,zn.jsx)("div",{className:Gn()({"UrlFragment-Wrapper":!r}),"aria-hidden":"true",children:(0,zn.jsx)("span",{className:"UrlFragment--Highlight",children:t.substring(0,u.RL)})});const{host:p,tld:g,port:m,scheme:f,path:v,query:b,ref:C}=o,w=("string"==typeof b?`?${b}`:"")+("string"==typeof C?`#${C}`:""),{subdomain:y,basedomain:x,hostTld:I}=(0,Kg.gC)(p,g)||{subdomain:"",basedomain:"",hostTld:""},A=s&&w.length>0;return(0,zn.jsxs)("div",{className:Gn()("UrlFragments",{"UrlFragment-Wrapper":!r,"UrlFragment-Wrapper--Clickable":!r&&l,"UrlFragment-Wrapper--ShouldHighlight":!r&&i}),"aria-hidden":"true",children:[s&&f&&(0,zn.jsx)(am,{urlFragment:f}),(0,zn.jsxs)("span",{className:"UrlFragment-LinkWrapper",children:[(0,zn.jsx)(Gg,{urlFragment:p,scheme:f||"",tld:0!==I.length?I:g,port:m,basedomain:x,subdomain:y,rawDisplay:r,onGoToPath:n,onBaseDomainObscured:e=>a&&a(e)}),(s||!s&&"/"!==v)&&(0,zn.jsx)(Xg,{windowId:e,urlFragment:v,onGoToPath:n,host:p,port:o.port,scheme:f||"",rawDisplay:r,shouldDisplayPostfix:A})]}),A&&(0,zn.jsx)(nm,{urlFragment:w,path:v})]})}var dm=s(68079),cm=s.n(dm),hm=s(94595);const um="vivaldi/x-calendar-event",pm="vivaldi/x-calendar-create-event",gm="text/plain";function mm(e){if(!e)return;const t=pn.Z.getByQuery(e);if(!t||!t.keyword)return;return e.substring(t.keyword.length)?t:void 0}var fm=s(34155);const vm=!1,bm=[Z.kAddressBarOmniboxEnabled,Z.kAddressBarShowFullUrl,Z.kAddressBarHighlightBaseDomain,Z.kAddressBarOmniboxShowTypedHistory],Cm=/\r\n|\r|\n/g;class wm extends Un.PureComponent{static contextType=oi.Z;#v=!1;#G=!1;#K=!1;#z=0;_omniDropdownElement=Un.createRef();_urlInput=Un.createRef();deleteKeyPressed=!1;#$=!1;state=(this.props.pageId,{dropdownSelectionIndex:0,typedSearchEngine:void 0,omniboxResults:[],activeTabSwitch:!1});static defaultProps={urlFragments:(0,Kg.kG)()};setUrlfieldState=e=>{vg.Z.updateState(this.props.pageId,e)};componentDidMount(){this.#v=!0}componentWillUnmount(){this.#v=!1,this._tearDownComponentEventListeners()}isNavigationMode(){return this.state.dropdownSelectionIndex>0}isOmniDropdownOpen(){const e=!this.props.typedUrl?this.props.prefValues[Z.kAddressBarOmniboxShowTypedHistory]:this.props.prefValues[Z.kAddressBarOmniboxEnabled];return Boolean(this.props.isUrlBar&&e&&this.state.omniboxResults.length>0)}getSelectedItem(){const{dropdownSelectionIndex:e,omniboxResults:t}=this.state;return t[e]}getValue(){const{displayUrl:e,typedUrl:t}=this.props;if(this.isNavigationMode()){const e=this.getSelectedItem();if(e){return e.destinationUrl||""}}return t??e}blur(){(0,mg.gR)(this.context,this.props.inputId)}onClick=async e=>{if(!A.Z.get(Z.kAddressBarSelectOnClick))return;const{button:t,currentTarget:s}=e,{selectionStart:n,selectionEnd:i,value:a}=s;if(0===t&&Date.now()-this.#z<350)return;this.#z=Date.now();const o=0===n&&i===a.length;if(n===i||o){if(this.isUrlInputFocusedOnMouseDown())return;0===t&&await new Promise((e=>fm.nextTick(e))),s.select(),this._focusedOnMouseDown=null}};onMouseDown=e=>{this._focusedOnMouseDown=this.context.document.activeElement,(0===this.props.typedUrl?.length||void 0===this.props.typedUrl&&0===this.props.displayUrl.length)&&this._focusedOnMouseDown&&this._focusedOnMouseDown.id===(this.props.inputId??mg.IY)&&!this.isOmniDropdownOpen()&&this.performZeroSuggestion(),1===e.buttons&&0===this.state.dropdownSelectionIndex&&this.validateAutocomplete(e)};onValueChange=e=>{const t=e.endsWith(" "),s=this.deleteKeyPressed||this.#$||this.getValue().length>=e.length&&this.getValue()!==this.props.displayUrl;(s||t||this.#K)&&(this.forceUpdate(),this.setUrlfieldState({autocompleteValue:""}));const n=mm(e),i=!(!e||n&&0===(a=e,o=n,a.substring(o.keyword.length).trim()).length);var a,o;this.setState({typedSearchEngine:n}),i?this.performSearch({query:e,preventInlineAutocomplete:s,searchEngineGUID:n?.guid??"",focusType:"INTERACTION_DEFAULT",zeroSuggestion:!1}):this.hideDropdown()};onAutocompleteValueChange=e=>{this.setUrlfieldState({autocompleteValue:e})};#Y(e){if(this.isNavigationMode())return e.preventDefault(),void this.setState({dropdownSelectionIndex:0});const t=this.getSelectedItem(),{typedUrl:s}=this.props,{autocompleteValue:n}=wg.getUrlfieldState(this.props.pageId);!s||n<=s||!t||(e.preventDefault(),s.length>1?(t.inlineAutocompletion=s[s.length-1]+t.inlineAutocompletion,this.setUrlfieldState({typedUrl:s.slice(0,-1)})):(this.setUrlfieldState({typedUrl:"",autocompleteValue:""}),this.hideDropdown()))}_cleanupState=()=>{this.#G=!1};onOmniboxResult=e=>{const t=!this.props.typedUrl;this.setState({omniboxResults:e.combinedResults,dropdownSelectionIndex:t?-1:0})};_searchDropdownItems=async e=>{const{query:t,preventInlineAutocomplete:s,searchEngineGUID:n,focusType:i}=e;if(this._cleanupState(),this.#K=!1,!this.#v)return;const a="number"==typeof this.props.pageId?Ze.ZP.getPageById(this.props.pageId)?.url??"":"";(0,Sg.PH)({query:t,preventInlineAutocomplete:s,fromSearchField:!1,searchEngineGUID:n,focusType:i,pageClassification:(0,Sg.D7)(a),windowId:this.context.vivaldiWindowId},this.onOmniboxResult)};performSearch=e=>{const{query:t,zeroSuggestion:s}=e;(s||""!==t.trim()&&!Ig(t)&&(A.Z.get(Z.kAddressBarAutocompleteEnabled)||this.props.prefValues[Z.kAddressBarOmniboxEnabled]))&&this._searchDropdownItems(e)};performZeroSuggestion=()=>{A.Z.get(Z.kAddressBarOmniboxShowTypedHistory)&&this.performSearch({query:"",preventInlineAutocomplete:!0,searchEngineGUID:"",focusType:"INTERACTION_FOCUS",zeroSuggestion:!0})};revertUrl=e=>{this.#v&&this.setUrlfieldState({typedUrl:e,autocompleteValue:""})};_onEscPressed=()=>{if(this._urlInput.current?.isIMEOpen)return;if(this.isOmniDropdownOpen())return void this.hideDropdown();const{displayUrl:e,typedUrl:t}=this.props;"string"==typeof t&&t!==e?(this.revertUrl(),this.hideDropdown(),(0,mg.i6)(this.context,this.props.inputId)):(this.blur(),ae.Z.executeActions("shortcut",this.context,"COMMAND_FOCUS_WEBVIEW"))};hideDropdown=e=>{(0,Sg.q)(),this.setState({dropdownSelectionIndex:0,omniboxResults:[]},e)};onPaste=e=>{const{clipboardData:t}=e,s=t.getData(gm);s.trim()||e.preventDefault();const n=this.getValue(),i=this.context.document.activeElement?.classList.toString()===e.currentTarget?.classList.toString()?e.currentTarget.selectionStart:0,a=e.currentTarget.selectionEnd,o=(0,zg.i)(n,s,i,a);if(A.Z.get(Z.kAddressBarStripJavascriptOnPaste)&&(0,hm.M)(o)){e.preventDefault();const t=(0,hm.Z)({textToStrip:s,caretPosition:i,selectionEnd:a,currentValue:n}),o=s.length-s.indexOf(":")-1;return this.setUrlfieldState({typedUrl:t}),this.onValueChange(t),void fm.nextTick((()=>{t&&-1!==o&&this._urlInput.current?.refUrlInput.current?.setSelection({selectionStart:o,selectionEnd:o})}))}if(Cm.test(s)){e.preventDefault();const t=s.replace(Cm,""),o=(0,zg.i)(n,t,i,a),r=i+t.length;return this.setUrlfieldState({typedUrl:o}),this.onValueChange(o),void fm.nextTick((()=>{o&&-1!==r&&this._urlInput.current?.refUrlInput.current?.setSelection({selectionStart:r,selectionEnd:r})}))}this.#K=!0};onClipboardEvent=e=>{const{clipboardData:t,type:s,currentTarget:n}=e,{HTMLInputElement:i}=this.context;if(!(n instanceof i&&t))return;if(0!==n.selectionStart||n.selectionEnd!==n.value.length)return;let a=n.value;n.selectionEnd&&n.selectionEnd!==n.value.length&&(a=n.value.substring(0,n.selectionEnd));const o=this.props.displayUrl!==a;if(A.Z.get(Z.kAddressBarOmniboxCutcopyEncoded)&&!o){const e=(0,Kg.dO)(a).host??"";a=encodeURI(a).replace(/%25/g,"%");const t=encodeURI(e),s=a.indexOf(t);a=a.slice(0,s)+e+a.slice(s+t.length)}if(a.length>=u.RL&&a.endsWith("...")&&this.props.displayUrl.startsWith(a.substring(0,u.RL))&&(a=this.props.displayUrl),(0,Ar.Zj)(a)&&/[\.\/]/.test(a)&&this.getValue()===this.props.displayUrl){const e=(0,ve.Z)(this.props.displayUrl);if(e?.protocol){a=(Ar.JQ.find((t=>t.startsWith(e.protocol)))||e.protocol)+a}}if(a!==n.value){if(t.setData("text",a),"cut"===s){const e=n.value.slice(n.selectionEnd);this.setUrlfieldState({typedUrl:e}),n.setSelectionRange(0,0),this.hideDropdown()}e.preventDefault()}};validateAutocomplete=({currentTarget:e})=>{const t=e.value===this.props.displayUrl?void 0:e.value;t!==this.props.typedUrl&&(this.setUrlfieldState({typedUrl:t}),t?this.performSearch({query:t,preventInlineAutocomplete:!1,searchEngineGUID:"",focusType:"INTERACTION_DEFAULT",zeroSuggestion:!1}):this.hideDropdown())};_shortcutListener=(e,t,s,n)=>{if(t&&n===mo.Z.KEY_ESCAPE)this._onEscPressed()};_setUpComponentEventListeners=()=>{re.Z.tabsPrivate.onKeyboardChanged.addListener(this._shortcutListener)};_tearDownComponentEventListeners=()=>{re.Z.tabsPrivate.onKeyboardChanged.removeListener(this._shortcutListener)};onFocus=e=>{this.props.pageContext.isUrlFieldFocused=!0,this.props.onFocus&&this.props.onFocus(e),this.props.isUrlBar&&this._setUpComponentEventListeners()};onBlur=e=>{this.props.pageContext.isUrlFieldFocused=!1;const{document:t,getSelection:s,Element:n}=this.context,i=s();i&&i.focusNode instanceof n&&i.focusNode.classList.contains("UrlField")&&i.removeAllRanges(),this.props.onBlur&&this.props.onBlur(),this.props.isUrlBar&&this._tearDownComponentEventListeners(),fm.nextTick((()=>{t.activeElement?.classList.contains("uifocusstop")||ue.Z.setPaneFocus(this.context.vivaldiWindowId,!1)}))};#X(e,t=!1){this.setState((s=>{const{dropdownSelectionIndex:n,omniboxResults:i}=s;let a=n;switch(e){case"up":a=0===n?i.length-1:n-1;break;case"down":a=n===i.length-1?0:n+1;break;case"top":a=0;break;case"bottom":a=i.length-1}return{dropdownSelectionIndex:a,activeTabSwitch:t&&i[a]?.hasTabMatch}}))}onKeyDown=e=>{if(!this._urlInput.current?.isIMEOpen){if("Backspace"===e.key||"Delete"===e.key){const t=(0,Zi.Np)(e)||vm;((0,Zi.VV)(e)||t)&&this.getValue().length>0&&(this.deleteKeyPressed=!0)}else this.deleteKeyPressed=!1;if(this.#$="z"===e.key&&(0,Zi.Ek)(e),this.#$)this.#Y(e);else switch(e.key){case"ArrowRight":case"ArrowLeft":case"End":case"Home":return void this.validateAutocomplete(e);case"Escape":return void(this.isOmniDropdownOpen()&&(e.preventDefault(),e.stopPropagation()));case"ArrowUp":return void(this.isOmniDropdownOpen()&&(e.preventDefault(),e.stopPropagation(),this.#X("up")));case"Tab":if(this.isOmniDropdownOpen()){const{activeTabSwitch:t}=this.state;(0,Zi.VV)(e)?(e.preventDefault(),e.stopPropagation(),!t&&this.state.omniboxResults[this.state.dropdownSelectionIndex].hasTabMatch?this.setState({activeTabSwitch:!0}):this.#X("down")):(0,Zi.Mr)(e)&&(e.preventDefault(),e.stopPropagation(),t?this.setState({activeTabSwitch:!1}):this.#X("up",!0))}return;case"ArrowDown":return void(this.isOmniDropdownOpen()?(e.preventDefault(),e.stopPropagation(),this.#X("down")):this.props.typedUrl||this.performZeroSuggestion());case"PageUp":return void(this.isOmniDropdownOpen()&&this.#X("top"));case"PageDown":return void(this.isOmniDropdownOpen()&&this.#X("bottom"));case"Delete":if(this.isOmniDropdownOpen()){const t=this.getSelectedItem();(0,Zi.Mr)(e)&&t&&(e.preventDefault(),this.onOmniDropdownItemDelete(t))}return}}};_urlFieldGo=async(e,t)=>{const{onSubmit:s}=this.props;s&&""!==e&&(this.cleanupUrl(e),await s({url:e,options:t}))};onKeyPress=e=>{this.props.onKeyPress&&this.props.onKeyPress(e)};onDragStart=e=>{if((0,cc.W$)(e))return;const{getSelection:t}=this.context;this.#G=!0;const s=t();s&&e.currentTarget.value===s.toString()&&cm()(e.currentTarget.value)&&this.props.onUrlDrag?.(e)};onDragEnd=()=>{this.#G=!1};onDragEnter=e=>{if(e.stopPropagation(),!this.#G&&this.isDropAllowed(e)){e.preventDefault();const t=e.currentTarget,{HTMLInputElement:s}=this.context;t instanceof s&&t.classList.add("pseudo-selected")}};onDragOver=e=>{this.isDropAllowed(e)&&e.preventDefault()};onDragLeave=e=>{if(this.#G)return;const t=e.target,{HTMLInputElement:s}=this.context;t instanceof s&&t.classList.remove("pseudo-selected")};onDrop=e=>{if(!this.isDropAllowed(e))return;const t=e.target,{HTMLInputElement:s}=this.context;if(t instanceof s&&t.classList.remove("pseudo-selected"),"function"==typeof this.props.onDrop)this.#G||(this.props.onDrop(e),e.stopPropagation(),e.preventDefault());else if(this.props.handleDrop){e.stopPropagation(),e.preventDefault();let t="";const s=e.dataTransfer?Jn.ZP.extractUriListFromEvent(e):"";if(s.length>0){const e=s.split("\n");e.length>0&&(t=e[0])}else t=e.dataTransfer?e.dataTransfer.getData(gm):"";this.setUrlfieldState({typedUrl:t}),(0,mg.x0)(this.context,this.props.inputId)}};isDropAllowed=e=>{if(!e?.dataTransfer||e.dataTransfer.types.includes("vivaldi/x-button-toolbar"))return!1;return e.dataTransfer.types.some((e=>e===Jn.yR||e===gm||Jn.ZP.isUriListType(e)))};switchToTab=(e,t)=>{this.cleanupUrl(this.props.displayUrl),this.setState({activeTabSwitch:!1}),async function(e,t){const s=Ze.ZP.getPageToSwitch(e.destinationUrl);if(!s||s.url.length>2048)return;const n=s.vivExtData?.workspaceId,i=s.windowId,a=Ze.ZP.getActivePage(t);a&&(0,vs.Rf)(a.url)&&await c.ZP.closePage(a,{bypassConfirm:!0,forceClosePinned:!1}),i!==t&&await Wn.Z.focus(i),await c.ZP.setActiveWorkspace(i,n),c.ZP.activateTab(s.id,i)}(e,t)};onNavigateToDropdownItem=(e,t)=>{const s=this.context.vivaldiWindowId,n=!1===t.inBackground&&!1===t.inCurrent&&!1===t.inNewWindow;e.hasTabMatch&&(this.state.activeTabSwitch||n)?this.switchToTab(e,s):(this.props.typedUrl&&re.Z.omniboxPrivate.addOrUpdateShortcut(this.props.typedUrl,e),Fg.Z.go(s,e,{...t})),this.revertUrl(),this.blur(),this.hideDropdown()};_deleteHistoryItem=e=>{const{typedUrl:t}=this.props;n.Z.history.deleteUrl({url:e.destinationUrl}).then((()=>{setTimeout((()=>{t?this.performSearch({query:t,preventInlineAutocomplete:!1,searchEngineGUID:"",focusType:"INTERACTION_DEFAULT",zeroSuggestion:!1}):this.performZeroSuggestion()}),50)}))};onOmniDropdownItemDelete=e=>{(0,Sg.eE)(e)?re.Z.directMatch.hide(e.destinationUrl).then((()=>{const{typedUrl:e}=this.props;e&&this.performSearch({query:e,preventInlineAutocomplete:!1,searchEngineGUID:"",focusType:"INTERACTION_DEFAULT",zeroSuggestion:!1})})):(re.Z.omniboxPrivate.deleteShortcut(e.destinationUrl),((0,Sg.rx)(e)||(0,Sg.K5)(e)||(0,Sg.b1)(e))&&this._deleteHistoryItem(e))};isUrlInputFocusedOnMouseDown=()=>{if(!this._urlInput.current)return!1;const e=this._urlInput.current?.refUrlInput.current?.inputField.current;return e===this._focusedOnMouseDown};componentDidUpdate(e,t){if(this.state.dropdownSelectionIndex===t.dropdownSelectionIndex&&this.state.omniboxResults===t.omniboxResults||this.props.setSelectedItem?.(this.state.omniboxResults[this.state.dropdownSelectionIndex]),this.props.pageId!==e.pageId&&this._cleanupState(),this.props.displayUrl&&this.props.displayUrl!==e.displayUrl&&void 0===this.props.typedUrl){const e=this._urlInput?.current?.refUrlInput?.current,t=e?.inputField?.current;e&&t&&e.setSelection({selectionStart:0,selectionEnd:t.value.length},"forward")}}renderDropdown=e=>this.isOmniDropdownOpen()?(0,zn.jsx)(Bg,{ref:this._omniDropdownElement,onLinkItemClicked:this.onNavigateToDropdownItem,items:e,selectionIndex:this.state.dropdownSelectionIndex,typedSearchEngine:this.state.typedSearchEngine,defaultSearchEngine:this.props.defaultSearchEngine,onDeleteItem:this.onOmniDropdownItemDelete,typedText:this.props.typedUrl??"",onMenuClosed:this.hideDropdown,outsideClickIgnoreClass:"urlfield-clickoutside-ignore",fromSearchField:!1,getOffsetWidth:this.props.getOffsetWidth,activeTabSwitch:this.state.activeTabSwitch,switchToTab:this.switchToTab}):null;updateSearchSuggestionWarning(){-1!==A.Z.get(Z.kAddressBarShowSearchSuggestionsWarning)&&I.Z.set(Z.kAddressBarShowSearchSuggestionsWarning,A.Z.get(Z.kAddressBarShowSearchSuggestionsWarning)+1)}handleSubmit=async({altKey:e,ctrlKey:t,metaKey:s,shiftKey:n})=>{this.updateSearchSuggestionWarning();const i=this.props.typedUrl??this.props.displayUrl;if(t&&A.Z.get(Z.kAddressBarAutocompleteSuffixExpansionEnabled)&&A.Z.get(Z.kAddressBarAutocompleteSuffixExpansionValue))return void await this._urlFieldGo((0,Ar.Ei)(i,A.Z.get(Z.kAddressBarAutocompleteSuffixExpansionValue)),{inCurrent:!0,transition:re.Z.historyPrivate.TransitionType.TYPED});const a=this.context.vivaldiWindowId,o=(0,fo.ZP)(a,{ctrlKey:t,altKey:e,shiftKey:n,metaKey:s}),r=A.Z.get(Z.kAddressBarUrlOpenShortcut);(n&&"shift"===r||e&&"alt"===r)&&(o.inCurrent=!1,o.inBackground=t),o.fromUrlField=!0,o.incognito=fe.ZP.isIncognitoOrGuest(a);const l=this.getSelectedItem();l?this.onNavigateToDropdownItem(l,o):(o.transition=i===this.props.displayUrl?re.Z.historyPrivate.TransitionType.RELOAD:re.Z.historyPrivate.TransitionType.TYPED,await this._urlFieldGo(i,o))};cleanupUrl=e=>{this.revertUrl(e),this.blur(),this.hideDropdown()};onMouseUp=e=>{const{getSelection:t}=this.context,{button:s,currentTarget:n}=e};render(){const{omniboxResults:e,dropdownSelectionIndex:t}=this.state,{typedUrl:s,pageId:n,prefValues:i,displayUrl:a}=this.props,o=this.getValue(),r=i[Z.kAddressBarShowFullUrl],l=i[Z.kAddressBarHighlightBaseDomain],d=this.props.urlFragments?(0,Kg.gG)(this.props.urlFragments):void 0,c=this.isNavigationMode(),h=this.getSelectedItem(),u=s&&s.length>0,p=function({selectedItem:e,allowedToAutocomplete:t,typedValue:s,dropdownSelectionIndex:n,value:i,pageId:a}){if(!e)return"";if(s&&0===n){if(e.allowedToBeDefaultMatch){const n=wg.getUrlfieldState(a).autocompleteValue.toLowerCase(),o=i.replace(/(\.\s*)+$/,"."),r=0===n.length||n.startsWith(o.toLowerCase());if(t&&r){const t=n.length>=o.length&&e.inlineAutocompletion.toLowerCase().endsWith(n.slice(-e.inlineAutocompletion.length))?e.inlineAutocompletion.length+o.length-n.length:-1;return t<0?s+e.inlineAutocompletion:s+e.inlineAutocompletion.slice(t)}}return s}return e.fillIntoEdit}({selectedItem:h,allowedToAutocomplete:this._urlInput.current?._allowedToAutocomplete??!1,typedValue:s,dropdownSelectionIndex:t,value:o,pageId:n});return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("div",{className:Gn()("UrlField",{"UrlField--HasEditText":Boolean(s),"UrlField--IsEmpty":""===this.getValue(),"urlfield-clickoutside-ignore":!0}),children:[(0,zn.jsx)(yg,{ref:this._urlInput,autoFocus:this.props.autoFocus,className:this.props.className||"",displayUrl:a,typedUrl:s,autocompleteData:e,autocompleteValue:p,disabled:this.props.disabled||void 0,placeholder:this.props.placeholder||void 0,title:this.props.title||void 0,pageId:n,readOnly:this.props.readonly,inputId:this.props.inputId,navigationMode:c,autocompletionEnabled:this.props.autocompletionEnabled,onValueChange:this.onValueChange,onAutocompleteValueChange:this.onAutocompleteValueChange,onSubmit:this.props.isUrlBar?this.handleSubmit:nr.Z,onBlur:this.onBlur,onFocus:this.onFocus,onClick:this.onClick,onContextMenu:this.onClick,onDragStart:this.onDragStart,onDragEnter:this.onDragEnter,onDragOver:this.onDragOver,onDragLeave:this.onDragLeave,onDragEnd:this.onDragEnd,onDrop:this.onDrop,onKeyPress:this.onKeyPress,onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onKeyDown:this.onKeyDown,onCut:this.onClipboardEvent,onCopy:this.onClipboardEvent,onPaste:this.onPaste}),d&&!u&&(0,zn.jsx)(lm,{windowId:this.context.vivaldiWindowId,urlFragments:d,displayUrl:a,shouldShowFullUrl:r,onGoToPath:this._urlFieldGo,onBaseDomainObscured:this.props.onBaseDomainObscured,shouldHighlightBaseDomain:l,rawDisplay:!1})]}),this.renderDropdown(e)]})}}const ym=(0,zd.Z)(wm,bm);var xm=s(58379);const Im=gg.t;function Am(e){return{url:e.url,title:e.title}}class Sm extends Un.PureComponent{static contextType=oi.Z;dropMode={support:!1,copy:!1};nodeRef=Un.createRef();_id=crypto.randomUUID();_pageContext={};state={drawerOpen:!1,suggestions:[],url:"",editUrl:void 0};componentDidMount(){wg.addListener(this._onUrlFieldStoreChanged,(e=>e.get(this._id)))}getNode(){return this.nodeRef.current}async updateSuggestedSites(){if(fe.ZP.isIncognitoOrGuest(this.context.vivaldiWindowId))return;const e=(await(0,xm.Z)()).map(Am).filter((e=>!Ko.Z.hasPanelUrl(e.url))),t=Im.filter((e=>!Ko.Z.hasPanelUrl(e.url))),s=await re.Z.extensionActionUtils.getToolbarExtensions(),n=[];s.forEach((e=>{if(!e.enabled)return;const t=Ko.Z.getExtPanelId(e);t&&e.sidePanel&&!Ko.Z.hasPanelId(t)&&n.push({title:e.name,faviconUrl:e.badgeIcon,url:e.sidePanel.url,extensionId:t,extension:e})}));const i=n.concat(e.concat(t));i.splice(12),this.setState({suggestions:i})}componentWillUnmount(){wg.removeListener(this._onUrlFieldStoreChanged),vg.Z.reset(this._id)}_onUrlFieldStoreChanged=()=>{const{typedUrl:e}=wg.getUrlfieldState(this._id);this.setState({editUrl:e})};onDragEnter=e=>{this.dropMode=this.supportDropForEvent(e)};onDragOver=e=>{e.preventDefault(),e.stopPropagation(),this.dropMode.support?e.dataTransfer.dropEffect=this.dropMode.copy?"copy":"move":e.dataTransfer.dropEffect="none"};onDrop=e=>{e.preventDefault(),e.stopPropagation(),this.dropMode.support&&Jn.ZP.getUrlsFromEventPromise(e,!0).then((e=>{e.forEach((e=>{Ko.Z.addByUrl(this.context.vivaldiWindowId,e.url,!0)}))}))};supportDropForEvent=e=>{const t=e.dataTransfer.types.some((e=>Jn.ZP.isUriListType(e)||"text/plain"===e));return{support:t,copy:t&&!e.dataTransfer.types.some((e=>e===u.Up))}};handleClickOutside=()=>{this.state.drawerOpen&&this.closeDrawer()};handleKeyDown=(e,t,s)=>{if("start"===e);else if("suggestion"===e){switch(s.key){case"ArrowLeft":this.moveFocus(t,"left",!1);break;case"ArrowRight":this.moveFocus(t,"right",!1);break;case"ArrowUp":this.moveFocus(t,"up",!1);break;case"ArrowDown":this.moveFocus(t,"down",!1);break;default:return}s.preventDefault(),s.stopPropagation()}};moveFocus=(e,t,s)=>{const{document:n,HTMLElement:i}=this.context,a=this.nodeRef.current;if(a instanceof i&&(!0===s||(0,vo.sT)(n,a))){const s=Array.from(a.querySelectorAll("button.webpanel-suggestion")),n=s.map((e=>e.getAttribute("data-id"))).filter(Boolean);if(0===n.length||n.length!==s.length)return!1;let i,o=0,r=-1;switch(s.forEach((e=>{const t=e.getBoundingClientRect();r<t.left&&(o++,r=t.left)})),t){case"current":if(""===e||"first"===e?e=n[0]:"last"===e&&(e=n[0===this.props.keyAccess?n.length-1:0]),i=n.indexOf(e),-1===i)return!1;break;case"right":case"left":if(1===n.length)return!1;if(i=n.indexOf(e),-1===i)return!1;if("right"===t){if((i+1)%o==0)return!1;if(i+=1,i>=n.length)return!1}else{if(i%o==0)return!1;if(i-=1,i>=n.length)return!1}break;case"up":case"down":if(1===n.length)return!1;if(i=n.indexOf(e),-1===i)return!1;if("up"===t){if(i-=o,i<0)return!1;e=n[i]}else if(i+=o,i>=n.length)return!1;break;default:return!1}e=n[i];const l=a.querySelector(`button.webpanel-suggestion[data-id="${e}"]`);if(l)return l.focus(),!0}return!1};onHideCallout=()=>{this.state.drawerOpen&&this.onToggleCallout()};onToggleCallout=()=>{this.state.drawerOpen?this.closeDrawer():this.updateSuggestedSites().then((()=>{const e=Ze.ZP.getActivePage(this.context.vivaldiWindowId)?.url??"",t={drawerOpen:!0,url:vs.jk.getDisplayUrlFromMapping(e)};vg.Z.updateState(this._id,{typedUrl:e,autocompleteValue:""}),this.setState(t),Qe.Z.bind("esc",this.closeDrawer)}))};onAddWebpanel=()=>{const{autocompleteValue:e}=wg.getUrlfieldState(this._id);let t=(e||this.state.editUrl||this.state.url||"").trim();0!==t.length&&(t=(0,Ar.q9)(t),Ko.Z.addByUrl(this.context.vivaldiWindowId,t,!0),this.closeDrawer())};onClickSuggested=e=>{let t,s="",n="";if(e.extension){const i=e.extension.sidePanel;if(!i)return;t=Ko.Z.getExtPanelId(e.extension),s=i.url,n=i.activeUrl}else{if(0===e.url.length)return;s=(0,Ar.q9)(e.url),n=s}const i={url:s??"",activeUrl:n??"",id:t};Ko.Z.addBySpec(this.context.vivaldiWindowId,i),this.closeDrawer()};closeDrawer=()=>{Qe.Z.unbind("esc",this.closeDrawer),this.setState({drawerOpen:!1,url:"",editUrl:void 0})};preventContextMenu=e=>{e.stopPropagation()};render(){return(0,zn.jsx)(oa.ZP,{id:"downloads",tooltip:(0,W.Z)("Add Web Panel"),image:Kn.ebB[this.props.size],alwaysMenu:!0,onClick:this.onToggleCallout,menu:this.props.menu,customizeMenu:this.props.customizeMenu,menuOrigin:this.props.menuOrigin,hidePopup:this.onHideCallout,popupClassName:"addwebpanel-wrapper",popupLabelledBy:"popup-label-addwebpanel",popupPosition:this.props.popupPosition,popupWidth:246,isPopupVisible:this.state.drawerOpen,draggable:this.props.draggable,onDragStart:this.props.onDragStart??nr.Z,onDragEnd:this.props.onDragEnd??nr.Z,onDrop:this.props.onDrop??nr.Z,onDragEnter:this.props.onDragEnter??nr.Z,onDragLeave:this.props.onDragLeave??nr.Z,onDragOver:this.props.onDragOver??nr.Z,mimeType:this.props.mimeType,name:this.props.name,size:this.props.size,children:(0,zn.jsx)("div",{ref:this.nodeRef,className:"addwebpanelcallout",onContextMenu:this.preventContextMenu,children:(0,zn.jsxs)("form",{children:[(0,zn.jsx)("header",{children:(0,zn.jsx)("h1",{id:"popup-label-addwebpanel",children:(0,W.Z)("Add Web Panel")})}),(0,zn.jsxs)("div",{className:"webpanel-input",children:[(0,zn.jsx)(ym,{className:"address",title:(0,W.Z)("Enter webpage address"),placeholder:"vivaldi.net",displayUrl:this.state.url,typedUrl:this.state.editUrl,autocompletionEnabled:!0,typedHistoryEnabled:!1,pageId:this._id,pageContext:this._pageContext,inputId:this._id,autoFocus:!0}),(0,zn.jsx)("button",{className:"webpanel-suggestion add",tabIndex:0,onClick:this.onAddWebpanel,dangerouslySetInnerHTML:{__html:Kn.md4.small},title:(0,W.Z)("Add Web Panel")})]}),this.state.suggestions&&this.state.suggestions.length>0&&(0,zn.jsx)("div",{className:"webpanel-suggestions",children:(0,zn.jsx)("div",{className:"suggestions-list",children:this.state.suggestions.map(((e,t)=>{const{favIconUrl:s,favIconLoadType:n}=vs.jk.getBookmarkFavicon(e.url,e.faviconUrl),i=t.toString();return(0,zn.jsx)("button",{className:"webpanel-suggestion",tabIndex:0===t?0:this.props.keyAccess,"data-id":i,title:e.title+"\n"+e.url,onKeyDown:this.handleKeyDown.bind(this,"suggestion",i),onClick:()=>this.onClickSuggested(e),children:(0,zn.jsx)(Vn.ZP,{url:s,loadType:n})},t)}))},"list")}),(0,zn.jsx)("button",{className:"FormButton",onClick:()=>{this.closeDrawer(),ic.Z.edit(Z.kToolbarsPanel)},children:(0,W.Z)("Customize Panel...")})]})})})}}const Zm=(0,cc.ZP)(Sm);var Tm=s(20676);const Em={getWebPanelBarMenu:function(){const e=A.Z.get(Z.kPanelsWebToolbar);return[{handler:()=>Ko.Z.setUIContent({showToolbar:!0}),isVisible:()=>!(!0===e.showToolbar),...(0,fi.Z)("command","Show")},{handler:()=>Ko.Z.setUIContent({showToolbar:!1}),isVisible:()=>!0===e.showToolbar,...(0,fi.Z)("other","Hide")},{handler:()=>Ko.Z.setUIContent({allControls:!e.allControls,showToolbar:e.showToolbar||!e.allControls}),type:"checkbox",checked:e.allControls,isVisible:()=>!0===e.showToolbar,...(0,fi.Z)("Display Navigation Controls")},{handler:()=>Ko.Z.setUIContent({deviceControl:!e.deviceControl,showToolbar:e.showToolbar||!e.allControls}),type:"checkbox",checked:e.deviceControl,isVisible:()=>!0===e.showToolbar,...(0,fi.Z)("Display Device Control")},{handler:()=>Ko.Z.setUIContent({zoomControls:!e.zoomControls,showToolbar:e.showToolbar||!e.allControls}),type:"checkbox",checked:e.zoomControls,isVisible:()=>!0===e.showToolbar,...(0,fi.Z)("Display Zoom Controls")}]},getPromise:function(e,t,s){const n="panelbaritem",i=ei.Z.getOptionFunction(n),a=nc.ZP.isWebPanel(t),o=a||nc.ZP.isRegPanel(t),r=e=>{if(a)return Ko.Z.getUrlById(e);switch(e){case"PanelBookmarks":return"vivaldi://bookmarks";case"PanelHistory":return"vivaldi://history";case"PanelDownloads":case"PanelWindow":case"PanelReadingList":case"PanelTranslate":case"PanelMail":case"PanelFeeds":case"PanelContacts":default:return"";case"PanelNotes":return"vivaldi://notes";case"PanelTasks":case"PanelCalendar":return"vivaldi://calendar"}},l=(t,s,n)=>{const i=r(t);i&&c.ZP.openURL(e,i,{inCurrent:s,inBackground:n})};return ei.Z.getNamedMenu(e,n,(async n=>{switch(n.action){case"CONTEXT_MENU_OPEN":return{isVisible:()=>r(t).length>0,...i(e,n,{})};case"CONTEXT_OPEN_IN_TAB":case"CONTEXT_OPEN_IN_NEW_TAB":return{handler:()=>l(t,"CONTEXT_OPEN_IN_TAB"===n.action,!1),isVisible:()=>r(t).length>0,...i(e,n,{})};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{handler:()=>l(t,!1,!0),isVisible:()=>r(t).length>0&&!A.Z.get(Z.kTabsOpenNewInBackground),...i(e,n,{})};case"CONTEXT_OPEN_IN_NEW_WINDOW":case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":{const s=fe.ZP.isGuest(),a="CONTEXT_OPEN_IN_NEW_WINDOW"===n.action;return{handler:()=>((t,s)=>{const n=r(t);n&&c.ZP.openURL(e,n,{inNewWindow:!0,incognito:s})})(t,!a),isVisible:()=>r(t).length>0&&!(a&&s),...i(e,n,{})}}case"CONTAINER_PERIODIC_RELOAD":case"CONTEXT_CONTAINER_PERIODIC_TIMER":return{...i(e,n,{}),items:Tm.Z.getMenu(t,"panel",e),isVisible:()=>a};case"CONTEXT_COPY_ADDRESS":return{handler:()=>{const e=r(t);e&&jc.Z.copyUrlToClipboard(e)},isVisible:()=>r(t).length>0,...i(e,n,{})};case"CONTEXT_DESKTOP_VERSION":return{handler:()=>Ko.Z.setMobileMode(t,!1,e),isVisible:()=>a&&Boolean(s?.mobileMode),...i(e,n,{})};case"CONTEXT_MOBILE_VERSION":return{handler:()=>Ko.Z.setMobileMode(t,!0,e),isVisible:()=>a&&!s?.mobileMode,...i(e,n,{})};case"CONTEXT_MUTE_PANEL":return{handler:e=>{en.Z.setMuted(e.windowId,t,!tn.ZP.getIsMuted(e.windowId,t))},isVisible:()=>a&&tn.ZP.getSelected(e)===t,checked:Boolean(s?.muted),type:"checkbox",...i(e,n,{})};case"CONTEXT_SEPARATE_WIDTH":return{handler:()=>en.Z.setPanelResizable(t,!tn.ZP.getResizableByPanel(t)),checked:tn.ZP.getResizableByPanel(t),isVisible:()=>o,...i(e,n,{})};case"CONTEXT_CONTAINER_FLOATING":{const s=A.Z.get(Z.kPanelsAsOverlayEnabled);return{items:[{handler:()=>{const s=tn.ZP.getSeparateFloating(t,e),n=A.Z.get(Z.kPanelsAsOverlayEnabled);void 0===s&&n?en.Z.setSeparateFloating(t,!1):en.Z.setSeparateFloating(t,!s)},type:"checkbox",checked:Boolean(tn.ZP.getSeparateFloating(t,e)),...(0,fi.Z)("This Panel")},{handler:()=>I.Z.toggle(Z.kPanelsAsOverlayEnabled,!0,!1),type:"checkbox",checked:Boolean(s),...(0,fi.Z)("All Panels")},st.Z.separatorItem,{handler:()=>en.Z.setSeparateFloating(t,void 0),...(0,fi.Z)("Reset Panel Floating")}],isVisible:()=>o,...i(e,n,{})}}case"CONTEXT_CONTAINER_TOOLBAR":return{items:this.getWebPanelBarMenu(),isVisible:()=>a,...i(e,n,{})};case"CONTAINER_CLOSED_WEBPANEL":{const t={...i(e,n,{})};return 0===t.items?.length&&(t.isVisible=()=>!1),t}default:return{...i(e,n,{})}}}))}},km=Em;var Nm=s(80342);function _m(e,t){if(!e||!t||!/\d/.test(e))return{displayTitle:e,badgeText:""};let s=e.match(/^\((?<matchNumber>\d+)\D*?\)\s+(?<matchTitle>.*$)/);if(s?.groups?.matchNumber||(t.startsWith("https://mail.google.com/")?s=e.match(/^(?<matchTitle>.*[\(\[\{](?<matchNumber>\d+)[\}\]\)].*)$/):t.startsWith("https://app.fastmail.com/")&&(s=e.match(/^(?<matchNumber>[0-9]+)\u2009\u2022\u2009(?<matchTitle>.*)$/))),!s||!s.groups||s.length<2)return{displayTitle:e,badgeText:""};const n=parseInt(s.groups.matchNumber)||0,i=s.groups.matchTitle;return 0===n?{displayTitle:i,badgeText:""}:n.toString().length>2?{displayTitle:e,badgeText:"+"}:{displayTitle:i,badgeText:n.toString()}}const Pm=[Z.kMailCountersPanelSwitcherEnabled,Z.kMailCountersPanelUnseenEnabled,Z.kFeaturesMail,Z.kFeaturesFeeds,Z.kPanelsAsOverlayEnabled,Z.kPanelsWebToolbar,Z.kPanelsWindowShowUnread,Z.kReadingListShowCounter,Z.kTabsCounterDetection,Z.kToolbarsPanel],Mm={"--activeButton":1},Dm={"--activeButton":0};class Om extends Un.PureComponent{static contextType=oi.Z;_isWebPanel=!1;_isExtensionPanel=!1;_isDraggingOverButton=!1;_iconChecks=0;constructor(e,t){super(e),this._isWebPanel=nc.ZP.isWebPanel(e.name),this._isExtensionPanel=Ko.Z.isExtPanel(e.name);const s=[],n=this._isWebPanel&&!this._isExtensionPanel?Om.#Q(t.vivaldiWindowId,e,s):void 0;let i=0;if(this._isWebPanel&&!e.inEditor){const t=tt.Z.getAlarmFromReloadId(e.name);t&&(i=60*t.periodInMinutes)}const a=Ze.ZP.unsafeGetActivePage(t.vivaldiWindowId);this.state={activePageId:a.id,isInternalPage:vs.jk.isInternalPage(a),openPanel:tn.ZP.getIsContentVisible(t.vivaldiWindowId)?tn.ZP.getSelected(t.vivaldiWindowId):null,counter:0,mailCounterState:{unseen:0,unread:0},progress:i,webPanelContent:n,panelExtensions:s}}componentDidMount(){if(this._isExtensionPanel&&re.Z.extensionActionUtils.getToolbarExtensions((e=>{const t=e.filter((e=>e.enabled&&e.sidePanel));this.setState({panelExtensions:t})})),!this.props.inEditor){switch(tn.ZP.addListener(this._onPanelStoreChange,(e=>({windowData:e.windowData.get(this.context.vivaldiWindowId),webPanelList:e.webPanelList}))),this._isWebPanel&&tt.Z.addListener(this._onPeriodicReloadStoreChanged),this.props.name){case"PanelDownloads":this._onDownloadStoreChange(),Xh.ZP.addListener(this._onDownloadStoreChange);break;case"PanelWindow":this._onPageStoreChange(),Ze.ZP.addListener(this._onPageStoreChange,this.context.selectWindow);break;case"PanelReadingList":this._onReadingStoreChange(),Nm.Z.addListener(this._onReadingStoreChange);break;case"PanelMail":case"PanelFeeds":this._onMailCounterChange(),bt.Z.addListener(this._onMailCounterChange)}this._onPanelStoreChange(),this._isWebPanel&&this.state.webPanelContent?.faviconUrl===nt.Z&&this.context.requestAnimationFrame(this.checkIconLoaded)}}componentDidUpdate(e){if(this.props.name!==e.name||this.props.inEditor!==e.inEditor)throw new Error("PanelButton: Invalid props change")}componentWillUnmount(){if(!this.props.inEditor)switch(tn.ZP.removeListener(this._onPanelStoreChange),this._isWebPanel&&tt.Z.removeListener(this._onPeriodicReloadStoreChanged),this.props.name){case"PanelDownloads":Xh.ZP.removeListener(this._onDownloadStoreChange);break;case"PanelWindow":Ze.ZP.removeListener(this._onPageStoreChange);break;case"PanelReadingList":Nm.Z.removeListener(this._onReadingStoreChange);break;case"PanelMail":case"PanelFeeds":bt.Z.removeListener(this._onMailCounterChange)}}checkIconLoaded=()=>{this._iconChecks++;const e=Om.#Q(this.context.vivaldiWindowId,this.props,this.state.panelExtensions);e?.faviconUrl!==nt.Z?this.setState({webPanelContent:e}):this._iconChecks<5&&this.context.requestAnimationFrame((()=>{setTimeout(this.checkIconLoaded,2e3)}))};_onPanelStoreChange=()=>{this._isWebPanel&&this.setState((e=>({webPanelContent:Om.#Q(this.context.vivaldiWindowId,this.props,e.panelExtensions)}))),this.setState({openPanel:tn.ZP.getIsContentVisible(this.context.vivaldiWindowId)?tn.ZP.getSelected(this.context.vivaldiWindowId):null})};static#Q=(e,t,s)=>{const n=tn.ZP.getWebPanel(e,t.name);if(n){const s=tn.ZP.getMutedMap(e)?.get(t.name);return{title:n.title,url:n.url,activeUrl:n.activeUrl,muted:s,faviconUrl:n.faviconUrl,mobileMode:n.mobileMode}}let i=A.Z.get(Z.kPanelsWebElements).find((e=>e.id===t.name));if(i||(i=A.Z.getDefault(Z.kPanelsWebElements).find((e=>e.id===t.name))),t.inEditor||i||console.warn("Missing web panel, no fallback:",t.name),i)return{title:i.title??"",url:i.url,activeUrl:i.activeUrl,faviconUrl:i.faviconUrl,mobileMode:i.mobileMode};const a=s.find((e=>e.id===Ko.Z.getExtIdFromPanel(t.name)));return a?.sidePanel?{title:a.name,url:a.sidePanel?.url,activeUrl:a.sidePanel?.activeUrl,faviconUrl:a.badgeIcon??nt.Z,mobileMode:!1}:void 0};_onPeriodicReloadStoreChanged=e=>{if(e)for(let t=0;t<e.length;t++){const s=e[t];if("panel"===s?.from&&this.props.name===s.id)return void this.setState({progress:s?.remainingTime})}tt.Z.getAlarmFromReloadId(this.props.name)||this.setState({progress:0})};_onDownloadStoreChange=()=>{this.setState({counter:Xh.ZP.getTotalNumberOfDownloads(),progress:Xh.ZP.getTotalProgress()})};_onReadingStoreChange=()=>{this.setState({counter:Nm.Z.getUnreadCount()})};_onPageStoreChange=()=>{this.setState({counter:Ze.ZP.getUnreadCount(this.context.vivaldiWindowId)})};_onMailCounterChange=()=>{const e="PanelMail"===this.props.name,t=bt.Z.getCounters(e?Nt.of:Nt.u4,e?Nt.tB:Nt.ym);this.setState({mailCounterState:{unseen:t?.unseen??0,unread:t?.unread??0}})};getTitleExtra=()=>{if(this._isWebPanel){const e=this.state.webPanelContent;if(e&&e.title)return e.url}return""};getTitle=()=>{if(this._isWebPanel){const e=this.state.webPanelContent;return e?e.title?e.title:e.url:""}return"PanelDownloads"===this.props.name&&this.state.progress>0?(0,W.Z)("Downloads")+" "+(0,W.Z)("($1 active transfer)","($1 active transfers)",[this.state.counter]):(0,Rp.wY)(this.props.name)};handleUp=e=>{e.preventDefault(),e.buttons&&(0!==e.buttons||(0,cc.W$)(e)&&fe.ZP.isActive(this.context.vivaldiWindowId))||this.handleClick(e)};setSelected=e=>{en.Z.toggleContent(this.context.vivaldiWindowId,e),Wn.Z.setPanelHasBeenVisible(this.context.vivaldiWindowId,e,!0)};toggleMuted=e=>{en.Z.setMuted(this.context.vivaldiWindowId,e,!tn.ZP.getIsMuted(this.context.vivaldiWindowId,e))};handleClick=e=>{const t=this.context.vivaldiWindowId,s=this.props.name,{altKey:n,ctrlKey:i,shiftKey:a,metaKey:o}=e,r={altKey:n,ctrlKey:i,shiftKey:a,metaKey:o};if(e.button===ai.Z.kCenter||e.button===ai.Z.kLeft&&(0,Zi.S2)(r))switch(s){case"PanelBookmarks":ue.Z.showBookmarks(t);break;case"PanelHistory":ue.Z.showHistory(t);break;case"PanelNotes":ue.Z.showNotes(t);break;case"PanelTasks":case"PanelCalendar":ue.Z.showCalendar(t);break;case"PanelMail":ue.Z.showMail(t);break;default:this._isWebPanel&&Ko.Z.openInTab(t,s,!1,!0)}else(0,cc.W$)(e)&&fe.ZP.isActive(this.context.vivaldiWindowId)||this.setSelected(s);ue.Z.setPaneFocus(t,!1)};debounceOpeningPanel=(0,Te.Z)((()=>{if(!this._isDraggingOverButton)return!1;this.setSelected(this.props.name)}),1500);_onPanelButtonDragEnter=(e,t)=>{(0,wi.ZP)(e),this._isDraggingOverButton=!0,this.debounceOpeningPanel()};_onPanelButtonDragLeave=()=>{this._isDraggingOverButton=!1};getPanelProps=()=>{let e=null,t="",s=!1;switch(this.props.name){case"PanelBookmarks":e="COMMAND_SHOW_BOOKMARK_PANEL",t=Kn.CLf[this.props.size];break;case"PanelHistory":e="COMMAND_SHOW_HISTORY_PANEL",t=Kn.hcy[this.props.size];break;case"PanelDownloads":e="COMMAND_SHOW_DOWNLOADS_PANEL",t=Kn.izi[this.props.size];break;case"PanelNotes":e="COMMAND_SHOW_NOTES_PANEL",t=Kn.cyI[this.props.size];break;case"PanelWindow":e="COMMAND_SHOW_WINDOW_PANEL",t=Kn.NxY[this.props.size],s=this.props.prefValues[Z.kPanelsWindowShowUnread];break;case"PanelReadingList":e="COMMAND_SHOW_READING_LIST_PANEL",t=Kn.R_e[this.props.size],s=this.props.prefValues[Z.kReadingListShowCounter];break;case"PanelTranslate":e="COMMAND_SHOW_TRANSLATE_PANEL",t=Kn.U_X[this.props.size];break;case"PanelMail":e="COMMAND_SHOW_MAIL_PANEL",s=this.props.prefValues[Z.kMailCountersPanelSwitcherEnabled],t=Kn.lvj[this.props.size];break;case"PanelCalendar":e="COMMAND_SHOW_CALENDAR_PANEL",t=Kn.bcq[this.props.size];break;case"PanelTasks":e="COMMAND_SHOW_TASKS_PANEL",t=Kn.wo7[this.props.size];break;case"PanelFeeds":e="COMMAND_SHOW_FEEDS_PANEL",t=Kn.ZU_[this.props.size],s=this.props.prefValues[Z.kMailCountersPanelSwitcherEnabled];break;case"PanelContacts":e="COMMAND_SHOW_CONTACTS_PANEL",t=Kn.LaO[this.props.size];break;case"PanelChat":t=Kn.yt5[this.props.size];break;case"PanelSession":e="COMMAND_SHOW_SESSION_PANEL",t=Kn.CnO[this.props.size]}return{commandId:e,showCounter:s,image:t}};getBadgeText=()=>{if(this._isWebPanel){const e=Om.#Q(this.context.vivaldiWindowId,this.props,this.state.panelExtensions)||this.state.webPanelContent;if(!e)return"";const t=this.props.prefValues[Z.kTabsCounterDetection]?_m(e.title,e.activeUrl).badgeText:"";return 0!==this.state.counter?Zp(this.state.counter):t}const{showCounter:e}=this.getPanelProps(),t=this.props.prefValues[Z.kMailCountersPanelUnseenEnabled],{counter:s,mailCounterState:n}=this.state,i=n?.unread||n?.unseen?t?n.unseen:n.unread:s;return e&&0!==i?Zp(i)??"":""};getWebPanelProps=e=>{if(!e)return null;const t=this.state.webPanelContent;return t?{mediaState:t.muted,faviconPath:t.faviconUrl}:null};menu=e=>{const t=this.context.vivaldiWindowId,{inEditor:s,name:n}=this.props;if(s)return Promise.resolve([]);if(e)return km.getPromise(t,n);{const e=Om.#Q(t,this.props,this.state.panelExtensions);return km.getPromise(t,n,e)}};buttonMenu=()=>this.menu(!1);addWebPanelButtonMenu=()=>this.menu(!0);renderToolbarButton=(e,t)=>{const s=fe.ZP.isIncognito(this.context.vivaldiWindowId),n=Ko.Z.isSafeInIncognitoWindow(this.props.name);if(t&&s&&!n)return;const{commandId:i,image:a}=this.getPanelProps();let o=this.getTitle();const r=this.getTitleExtra();let l,d,c,h;if(t){if(this._isExtensionPanel){const e=this.state.panelExtensions.find((e=>e.id===Ko.Z.getExtIdFromPanel(this.props.name)));c=e?.badgeIcon??nt.Z,o=e?.name??o}else c=void 0;l="panel",d=this.toggleMuted}else c=a;"PanelDownloads"===e.name&&(h={"--downloadInProgress":this.state.progress?1:0});const u=this.state.openPanel===this.props.name,p=Gn()("panel-clickoutside-ignore",{"button-toolbar-webpanel":t,active:u});return(0,zn.jsx)(oa.ZP,{...e,className:p,buttonClasses:tn.ZP.getIsBarVisible(this.context.vivaldiWindowId)&&(u||!this.state.openPanel&&this.props.prefValues[Z.kToolbarsPanel][0]===this.props.name)?"uifocusstop":void 0,onPanelButtonDragEnter:this._onPanelButtonDragEnter,onPanelButtonDragLeave:this._onPanelButtonDragLeave,buttonStyle:u?Mm:Dm,style:h,progress:null!==this.state.progress?Number(this.state.progress.toPrecision(2)):void 0,tooltip:o,tooltipExtra:r,roles:"tab",ariaControls:"ui-region-panel",onClick:this.handleUp,onMiddleClick:this.handleClick,menu:this.buttonMenu,image:c,badgeText:this.getBadgeText(),mediaStateType:l,toggleMuted:d,...this.getWebPanelProps(t),commandId:i})};render(){const e=this.context.vivaldiWindowId,{draggable:t,onDragStart:s,onDragEnd:n,onDrop:i,onDragEnter:a,mimeType:o,name:r,customizeMenu:l,popupPosition:d,menuOrigin:c,size:h}=this.props,u={draggable:t,onDragStart:s,onDragEnd:n,onDrop:i,onDragEnter:a,mimeType:o,name:r,customizeMenu:l,popupPosition:d,menuOrigin:c,size:h};if("PanelWeb"===this.props.name)return(0,zn.jsx)(Zm,{...u,id:"addwebpanel",menu:this.addWebPanelButtonMenu,keyAccess:-1});if(this._isWebPanel){if(fe.ZP.isGuest())return;return this.renderToolbarButton(u,!0)}return this.props.inEditor||tn.ZP.canRender({winId:e,panelId:this.props.name})&&(this.props.isMailWindow&&this.props.prefValues[Z.kFeaturesMail]||!tn.jM.includes(this.props.name))&&(this.props.isMailWindow&&this.props.prefValues[Z.kFeaturesFeeds]||!tn.QZ.includes(this.props.name))&&(this.props.prefValues[Z.kFeaturesMail]||!tn.ut.includes(this.props.name))?this.renderToolbarButton(u,!1):(0,zn.jsx)("div",{className:"button-toolbar",style:{display:"none"}})}}const jm=(0,zd.Z)(Om,Pm);class Lm extends Un.PureComponent{render(){const{entry:e}=this.props,t=(0,ve.Z)(this.props.entry.url)?.host||"";return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)(Vn.ZP,{size:32,style:e.read?{filter:"saturate(0) opacity(0.7)"}:{},url:e.url,title:e.url,loadType:"page"}),(0,zn.jsxs)("div",{className:"readinglist-name",title:e.title.length>80?e.title:null,style:e.read?{filter:"opacity(0.7)"}:{},children:[(0,zn.jsx)("p",{className:"title",children:e.title||t}),e.title&&(0,zn.jsx)("p",{className:"info",children:t})]}),(0,zn.jsx)("button",{type:"button",className:"ActionButton circular",onClick:t=>this.props.onClickMark(e.url,!e.read,t),title:e.read?(0,W.Z)("Mark as unread"):(0,W.Z)("command","Mark as read"),tabIndex:-1,dangerouslySetInnerHTML:{__html:e.read?Kn.sgm.small:Kn.D7r.small}}),(0,zn.jsx)("button",{type:"button",className:"ActionButton circular",onClick:t=>this.props.onClickRemove(e.url,t),title:(0,W.Z)("verb","Remove"),tabIndex:-1,dangerouslySetInnerHTML:{__html:Kn.M2k.small}})]})}}const Rm=Lm,Bm=[Z.kKeyboardTabToAll];class Fm extends Un.PureComponent{static contextType=oi.Z;constructor(e){super(e),this.state={entries:Nm.Z.getList()||[],urlValid:R.MT(this.props.url)}}componentDidMount(){Nm.Z.addListener(this._onStoreChanged)}componentDidUpdate(e){e.url!==this.props.url&&this.setState({urlValid:R.MT(this.props.url)})}componentWillUnmount(){Nm.Z.removeListener(this._onStoreChanged)}_onStoreChanged=()=>{this.setState({entries:Nm.Z.getList()||[]})};onClickUrl=e=>{c.ZP.openURL(this.context.vivaldiWindowId,e,{singleton:!0}),R.Bz(e,!0),this.props.hidePopup()};onClickRemove=(e,t)=>{R.Od(e),(0,wi.ZP)(t)};onClickMark=(e,t,s)=>{R.Bz(e,t),(0,wi.ZP)(s)};onSave=e=>{const t=this.context.vivaldiWindowId,s=Ze.ZP.getActivePage(t);s&&R.IH(t,s.url,s.title),this.props.hidePopup(),(0,wi.ZP)(e)};onKeyDown=(e,t)=>{switch(t.key){case"Escape":(0,wi.ZP)(t),this.props.hidePopup();break;case"Enter":case" ":this.onClickUrl(e);break;case"Delete":case"Backspace":this.onClickRemove(e,t)}};renderDialogHeader=()=>(0,zn.jsx)("div",{className:"dialog-header",id:"popup-label-readinglist",children:(0,W.Z)("Reading List")});renderEntry=(e,t)=>(0,zn.jsx)("div",{tabIndex:0,className:"readinglist-item-large",onClick:this.onClickUrl.bind(this,e.url),onKeyDown:this.onKeyDown.bind(this,e.url),children:(0,zn.jsx)(Rm,{onClickMark:this.onClickMark,onClickRemove:this.onClickRemove,entry:e})},e.url);renderReadingList=()=>{const e=this.state.entries.filter((e=>!e.read)),t=this.state.entries.filter((e=>e.read)),s=[];return e.length?s.push((0,zn.jsx)("header",{children:(0,W.Z)("Unread Articles")},"header1")):t.length&&s.push((0,zn.jsx)("p",{className:"comment",children:(0,W.Z)("All articles read.")},"all-done")),e.forEach((e=>{s.push(this.renderEntry(e,!1))})),t.length&&s.push((0,zn.jsx)("header",{children:(0,W.Z)("Read Articles")},"header2")),t.forEach((e=>{s.push(this.renderEntry(e,!0))})),!e.length&&!t.length&&s.push((0,zn.jsx)("p",{className:"comment",children:(0,W.Z)("No articles in your reading list.")},"empty")),s};renderAddCurrent=()=>(0,zn.jsx)("footer",{className:"dialog-footer",children:(0,zn.jsx)("input",{className:"primary",type:"button",onClick:this.onSave,value:(0,W.Z)("Add Current Page"),disabled:!this.state.urlValid,autoFocus:!0})});render(){return(0,zn.jsxs)("div",{className:"reading-list-dialog",children:[this.renderDialogHeader(),(0,zn.jsx)("div",{className:"readinglist-listing-large",children:this.renderReadingList()}),this.renderAddCurrent()]})}}const Wm=(0,zd.Z)(Fm,Bm),Um=[Z.kReadingListShowCounter];class Vm extends Un.PureComponent{static contextType=oi.Z;state={popupVisible:!1,readingListItems:Nm.Z.getUnreadCount(),url:Ze.ZP.getActivePage(this.context.vivaldiWindowId)?.url??""};componentDidMount(){if(this.props.inEditor)return;const{selectWindow:e}=this.context;Nm.Z.addListener(this._onReadingStoreChange),Ze.ZP.addListener(this._onPageStoreChange,e)}componentWillUnmount(){this.props.inEditor||(Nm.Z.removeListener(this._onReadingStoreChange),Ze.ZP.removeListener(this._onPageStoreChange))}_onReadingStoreChange=()=>{const e=Nm.Z.getUnreadCount();this.setState({readingListItems:e})};_onPageStoreChange=()=>{const e=Ze.ZP.getActivePage(this.context.vivaldiWindowId)?.url??"";this.setState({url:e})};togglePopup=()=>{this.setState((e=>({popupVisible:!e.popupVisible})))};hidePopup=()=>{this.setState({popupVisible:!1})};render(){const{readingListItems:e}=this.state,t=this.props.prefValues[Z.kReadingListShowCounter]&&e>0?e>1e3?"999+":e.toString():void 0;return(0,zn.jsx)(oa.ZP,{image:Kn.R_e[this.props.size],label:(0,W.Z)("Reading List"),tooltip:(0,W.Z)("Show the Reading List"),onClick:this.togglePopup,customizeMenu:this.props.customizeMenu,menuOrigin:this.props.menuOrigin,popupPosition:this.props.popupPosition,hidePopup:this.hidePopup,isPopupVisible:this.state.popupVisible,popupClassName:"ToolbarButtonPopup-DefaultStyles",popupLabelledBy:"popup-label-readinglist",popupWidth:350,size:this.props.size,badgeText:t,draggable:this.props.draggable,onDragStart:this.props.onDragStart??nr.Z,onDragEnd:this.props.onDragEnd??nr.Z,onDrop:this.props.onDrop??nr.Z,onDragEnter:this.props.onDragEnter??nr.Z,mimeType:this.props.mimeType,name:this.props.name??"",children:(0,zn.jsx)(Wm,{hidePopup:this.hidePopup,url:this.state.url})})}}const Hm=(0,zd.Z)((0,cc.ZP)(Vm),Um);var Gm=s(1068);const Km=500,zm=(0,Gm.Z)("button",Km);var $m=(0,zn.jsx)("img",{className:"friends",src:"/resources/share-friends.png",width:"400",height:"158",alt:""}),Ym=(0,zn.jsx)(aa,{type:"close"});function Xm(e){const[t,s]=Un.useState((0,W.Z)("Check out Vivaldi, the browser I'm using: https://vivaldi.com/invite")),[n,i]=Un.useState(!1),[a,o]=Un.useState(!1),[r,l]=Un.useState(!1);return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("div",{className:Gn()("share-vivaldi-background",{closing:r})}),(0,zn.jsxs)("div",{className:Gn()("ShareVivaldiPopup-Content",{copied:n,updated:a,closing:r}),style:{"--transitionSpeed":Km},children:[$m,a?(0,zn.jsxs)("div",{className:"ShareVivaldiPopup-Success",children:[(0,zn.jsx)("h1",{children:(0,W.Z)("Thank you!")}),(0,zn.jsx)("p",{className:"update-text",children:(0,W.Z)("Now paste the message into your favourite messenger app, chat client, or social media and share.")})]}):(0,zn.jsxs)("div",{className:"ShareVivaldiPopup-Intro",children:[(0,zn.jsx)("h1",{children:(0,W.Z)("Share Vivaldi with your friends")}),(0,zn.jsx)("p",{children:(0,W.Z)("Your friends deserve the same powerful browser you are using. Share Vivaldi with them — they’ll thank you later!")}),(0,zn.jsx)("textarea",{onChange:e=>s(e.target.value),value:t})]}),(0,zn.jsx)("div",{className:"ShareVivaldiPopup-Footer",children:n?(0,zn.jsxs)(zn.Fragment,{children:[e.animate&&a&&!r&&(0,zn.jsx)("img",{className:"confetti",src:`/resources/share-confetti.gif#${Math.random()}`,alt:""}),(0,zn.jsx)(zm,{onClick:()=>{l(!0),setTimeout(e.hidePopup,Km)},dangerouslySetInnerHTML:{__html:Kn.D7r.medium+(0,W.Z)("verb","Close")},disabled:r})]}):(0,zn.jsx)("button",{className:"primary",onClick:()=>{i(!0),setTimeout((()=>o(!0)),Km),jc.Z.set(t)},dangerouslySetInnerHTML:{__html:Kn.Ofb+(0,W.Z)("verb","Copy Message")}})}),(0,zn.jsx)("button",{className:"ShareVivaldiPopup-Close",onClick:e.hidePopup,tabIndex:"-1",title:(0,W.Z)("Close"),children:Ym})]})]})}const Qm={display:"none"},qm=(e,t)=>{if(!e&&!t)return!1;const[s=0,n=0]=e.split(".").map(Number),[i=0,a=0]=t.split(".").map(Number);return s<i||s===i&&n<a};class Jm extends Un.PureComponent{constructor(e){super(e),this.state={popupVisible:!1,shouldShowButton:this.shouldShowButton()}}componentDidMount(){this.props.inEditor||(A.Z.addListener(Z.kStartupShareVivaldiLastSeenVersion,this.setShouldShowButton),A.Z.addListener(Z.kStartupActiveDays,this.setShouldShowButton))}componentWillUnmount(){this.props.inEditor||(A.Z.removeListener(Z.kStartupShareVivaldiLastSeenVersion,this.setShouldShowButton),A.Z.removeListener(Z.kStartupActiveDays,this.setShouldShowButton))}togglePopup=()=>{this.setState((e=>({popupVisible:!e.popupVisible})))};hidePopup=()=>{const{vivaldiVersion:e}=re.Z.utilities.getVersion()||{};e&&I.Z.set(Z.kStartupShareVivaldiLastSeenVersion,e),this.setState({popupVisible:!1,shouldShowButton:!1})};shouldShowButton=()=>{const{vivaldiVersion:e}=re.Z.utilities.getVersion()||{};if(!e)return!1;const t=A.Z.get(Z.kStartupFirstSeenVersion),s=A.Z.get(Z.kStartupShareVivaldiLastSeenVersion);return qm(s,e)&&(qm(t,e)||function(e){const t=Date.now();return Ce(t-be.S,t)>=e}(3))};setShouldShowButton=()=>{this.setState({shouldShowButton:this.shouldShowButton()})};render(){const e=this.state.shouldShowButton||this.props.preview||this.props.inEditor;return(0,zn.jsx)(oa.ZP,{style:e?void 0:Qm,image:Kn.kM2[this.props.size],tooltip:(0,W.Z)("Share Vivaldi"),onClick:this.togglePopup,customizeMenu:this.props.customizeMenu,menuOrigin:this.props.menuOrigin,popupClassName:"ShareVivaldiPopup ToolbarButtonPopup-DefaultStyles",popupLabelledBy:"popup-label-sharevivaldi",popupWidth:460,popupPosition:this.props.popupPosition,hidePopup:this.hidePopup,isPopupVisible:this.state.popupVisible,size:this.props.size,draggable:this.props.draggable,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,onDrop:this.props.onDrop,onDragEnter:this.props.onDragEnter,onDragLeave:this.props.onDragLeave,onDragOver:this.props.onDragOver,mimeType:this.props.mimeType,name:this.props.name,children:(0,zn.jsx)(Xm,{hidePopup:this.hidePopup,animate:A.Z.get(Z.kThemeUseAnimation)})})}}const ef=(0,cc.ZP)(Jm),tf=e=>{const{winId:t}=e,s=Un.useCallback((async function(e){const s=Ze.ZP.getActivePage(t);if(!s)return;const{ctrlKey:n,altKey:i,shiftKey:a,metaKey:o}=e,r={ctrlKey:n,altKey:i,shiftKey:a,metaKey:o},l=(0,Zi.S2)(r),d=vs.jk.isInternalUrl(s.url);if(!l||d)return void So.Z.enableCapture(t);const c=A.Z.get(Z.kWebpagesCaptureSaveLocation),h=A.Z.get(Z.kWebpagesCaptureCompressionFormat),{image:u}=await Ao.Z.captureFullpage(s.id,h,c);Ao.Z.handleCaptureLocation({windowId:t,mode:"fullpage",base64:u})}),[t]);return(0,zn.jsx)(oa.ZP,{tooltip:(0,W.Z)("title","Capture Page"),onClick:s,image:Kn.z8c[e.size],size:e.size,customizeMenu:e.customizeMenu,draggable:e.draggable,menuOrigin:e.menuOrigin,onDragStart:e.onDragStart,onDragEnd:e.onDragEnd,onDrop:e.onDrop,onDragEnter:e.onDragEnter,mimeType:e.mimeType,popupClassName:"ToolbarButtonPopup-DefaultStyles",name:e.name})};class sf extends Un.PureComponent{refActionList=Un.createRef();state={pageactionFiles:[],drawerOpen:!1,currentTarget:null,scriptOverrides:[],contentScripts:oe.Z.getState()};componentDidMount(){re.Z.pageActions.onOverridesChanged.addListener(this.onOverridesChanged),oe.Z.addListener(this.newScriptUpdateList),this.updateScriptOverrides()}componentWillUnmount(){oe.Z.removeListener(this.newScriptUpdateList),re.Z.pageActions.onOverridesChanged.removeListener(this.onOverridesChanged)}componentDidUpdate(e){this.props.pageId!==e.pageId&&this.updateScriptOverrides()}newScriptUpdateList=()=>{const e=oe.Z.getScripts();this.setState({contentScripts:e})};onOverridesChanged=e=>{e===this.props.pageId&&this.updateScriptOverrides()};updateScriptOverrides=()=>{re.Z.pageActions.getScriptOverridesForTab(this.props.pageId,(e=>{this.setState({scriptOverrides:e})}))};togglePopup=()=>{this.setState((e=>({drawerOpen:!e.drawerOpen})))};hidePopup=()=>{this.state.drawerOpen&&this.setState({drawerOpen:!1})};onItemClicked=(e,t)=>{this.isScriptEnabled(e)?re.Z.pageActions.setScriptOverrideForTab(e,this.props.pageId,"no_override",(()=>{})):re.Z.pageActions.setScriptOverrideForTab(e,this.props.pageId,"enabled",(()=>{}))};hasScriptOverrides=()=>0!==this.state.scriptOverrides.length;isScriptEnabled=e=>{const t=this.state.scriptOverrides.find((t=>t.script===e));return!!t&&"enabled"===t.override};keyDownHandler=(e,t)=>{switch(t.key){case"ArrowUp":this.moveFocus(e,"up");break;case"ArrowDown":this.moveFocus(e,"down");break;default:return}t.preventDefault(),t.stopPropagation()};moveFocus=(e,t)=>{const s=this.refActionList.current;if(s){bo(e,t,Array.from(s.querySelectorAll(".item")),1)}};render(){return(0,zn.jsxs)(oa.ZP,{tooltip:(0,W.Z)("Page Actions"),disabled:this.props.disabled,isPopupVisible:this.state.drawerOpen,isOn:this.hasScriptOverrides(),onClick:this.togglePopup,hidePopup:this.hidePopup,image:Kn.jVs[this.props.size],size:this.props.size,customizeMenu:this.props.customizeMenu,menuOrigin:this.props.menuOrigin,popupPosition:this.props.popupPosition,hasLightArrow:"above"===this.props.popupPosition,popupWidth:225,draggable:this.props.draggable,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,onDrop:this.props.onDrop,onDragEnter:this.props.onDragEnter,mimeType:this.props.mimeType,popupClassName:"ToolbarButtonPopup-DefaultStyles",popupLabelledBy:"popup-label-pageactions",name:this.props.name,style:{"--pageActionActive":this.hasScriptOverrides()?1:0},children:[(0,zn.jsx)("h2",{id:"popup-label-pageactions",children:(0,W.Z)("Page Actions")}),(0,zn.jsx)("div",{className:"popup-scrollarea",ref:this.refActionList,children:this.state.contentScripts.map(((e,t)=>{const s=t.toString();return(0,zn.jsxs)("label",{"data-id":s,className:"item",onKeyDown:this.keyDownHandler.bind(this,s),children:[(0,zn.jsx)("input",{autoFocus:0===t,type:"checkbox",onChange:this.onItemClicked.bind(this,e),checked:this.isScriptEnabled(e)}),(0,zn.jsx)("span",{children:(0,le.gD)(e)})]},t)}))})]})}}const nf=sf;var af=s(30626),of=s(22303),rf=s(37646),lf=s(47825),df=s(71828),cf=(0,zn.jsx)("input",{type:"range",min:"0",max:"2",value:"1",readOnly:!0});class hf extends Un.PureComponent{static contextType=oi.Z;state={disabled:!af.Z.getActiveWebView(this.context.vivaldiWindowId),defaultPageZoom:lf.Z.getDefaultPageZoom(),zoom:lf.Z.getZoom(),notesZoom:lf.Z.getNotesZoom(),isNoteWebView:!1};componentDidMount(){lf.Z.addListener(this._onZoomStoreChanged),n.Z.tabs.onZoomChange.addListener(this._onTabZoomChange),re.Z.tabsPrivate.onPageZoom.addListener(this._onPageZoom),af.Z.addListener(this._onActiveWebViewStoreChanged),this._onActiveWebViewStoreChanged()}componentWillUnmount(){af.Z.removeListener(this._onActiveWebViewStoreChanged),n.Z.tabs.onZoomChange.removeListener(this._onTabZoomChange),re.Z.tabsPrivate.onPageZoom.removeListener(this._onPageZoom),lf.Z.removeListener(this._onZoomStoreChanged)}_onActiveWebViewStoreChanged=()=>{const e=af.Z.getActiveWebView(this.context.vivaldiWindowId);e&&e.getZoom((t=>{this._updateZoomState(this.rangeCheck(t),e.name)}));const t={disabled:!e};e||(t.zoom=1),this.setState(t)};_onZoomStoreChanged=()=>{const{defaultPageZoom:e,zoom:t,notesZoom:s}=lf.Z.getState();this.setState({defaultPageZoom:e,zoom:t,notesZoom:s})};_onTabZoomChange=e=>{const t=af.Z.getActiveWebView(this.context.vivaldiWindowId);t&&t.getZoom((s=>{s===e.oldZoomFactor&&e.tabId===this.props.pageId&&this._updateZoomState(e.newZoomFactor,t.name)}))};_onPageZoom=(e,t)=>{if(e!==this.context.vivaldiWindowId)return;const s=af.Z.getActiveWebView(e);s&&s.getZoom((e=>{e+=.1*t,this._updateZoomState(e,s.name)}))};_updateZoomState=(e,t)=>{"markdowneditor"===t||"richtexteditor"===t?this.setState({notesZoom:e,isNoteWebView:!0}):this.setState({zoom:e,isNoteWebView:!1})};setZoomLevel=e=>{of.Z.setPageZoom(this.context.vivaldiWindowId,this.rangeCheck(e))};rangeCheck=e=>Math.min(Math.max(e,df.XF),df.qt);render(){const{disabled:e,zoom:t,notesZoom:s,isNoteWebView:n,defaultPageZoom:i}=this.state,a=this.props.draggable,o=this.props.onDrop&&this.props.onDragEnter;return(0,zn.jsxs)("div",{...(0,cc.uu)({draggable:this.props.draggable,onDragStart:a?this.props.onDragStart:null,onDragEnd:a?this.props.onDragEnd:null,onDragEnter:o?this.props.onDragEnter:void 0,onDragOver:o?this.props.onDragOver:null,onDragLeave:o?this.props.onDragLeave:null,onDrop:o?this.props.onDrop:null}),className:this.props.buttonClasses,name:"Zoom",onContextMenu:e=>(0,mi.Z)(this.context,this.props.customizeMenu??[])(e),children:[this.props.preview&&cf,!this.props.preview&&(0,zn.jsx)(rf.Z,{zoom:n?s:t,scrolling:!0,inFooter:!0,defaultZoomLevel:i,maxLevel:df.qt,minLevel:df.XF,step:df.Zh,disabled:e,customizeMenu:this.props.customizeMenu,onZoomUpdated:this.setZoomLevel},"zoomslider")]})}}const uf=(0,cc.ZP)(hf);var pf=(0,zn.jsx)("li",{className:"divider"});class gf extends Un.PureComponent{static contextType=oi.Z;nodeRef=Un.createRef();componentDidUpdate(e){if(this.props.isSelected&&!e.isSelected){const{HTMLElement:e}=this.context,t=this.nodeRef.current;t instanceof e&&t.scrollIntoViewIfNeeded(!1)}}#q=e=>{e.button!==ai.Z.kLeft?e.stopPropagation():this.props.onItemActivated(this.props.item,e)};#J=()=>{this.props.setSelected(this.props.index)};#ee=()=>(0,zn.jsx)("span",{children:this.props.item.name});#te=()=>{if(this.props.item.shortcut&&!1!==this.props.showShortcut){const e=this.props.item.noPrettifying?this.props.item.shortcut:(0,vc.$)(this.props.item.shortcut);return(0,zn.jsx)("span",{"aria-hidden":!0,className:"shortcut",children:e})}return null};#se=()=>{if(this.props.item.iconSVG)return(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:this.props.item.iconSVG}});if(this.props.item.faviconUrl)return(0,zn.jsx)(Vn.ZP,{url:this.props.item.faviconUrl,loadType:"faviconFromCache"});const e=this.props.item.icon?this.props.item.icon:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";return(0,zn.jsx)("img",{src:e})};#ne=()=>{const e=this.props.item.type||"Normal";return(0,zn.jsxs)("li",{ref:this.nodeRef,className:Gn()({selectedItem:this.props.isSelected}),onMouseOver:this.#J,onMouseDown:wi.ZP,onMouseUp:this.#q,role:"menuitem","aria-selected":this.props.isSelected,id:"dm_"+this.props.index,children:["Normal"===e&&(0,zn.jsxs)("a",{tabIndex:"0",children:[(0,zn.jsx)("label",{className:"menu-icon",children:this.#se()}),(0,zn.jsxs)("label",{className:"menu-label",children:[this.#ee(),this.#te()]})]}),"Description"===e&&(0,zn.jsxs)("a",{tabIndex:"0",className:"menu-item-description-container",children:[(0,zn.jsx)("label",{className:"menu-icon",children:this.#se()}),(0,zn.jsxs)("label",{className:"menu-label",children:[this.#ee(),this.#te()]}),(0,zn.jsx)("label",{className:"menu-description",children:this.props.item.description})]}),"Checkbox"===e&&(0,zn.jsx)("a",{tabIndex:"0",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("span",{className:"menu-icon",children:(0,zn.jsx)("input",{type:"checkbox",checked:this.props.item.checked,readOnly:!0})}),(0,zn.jsx)("span",{className:"menu-label",children:this.#ee()})]})}),"Radio"===e&&(0,zn.jsx)("a",{tabIndex:"0",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("span",{className:"menu-icon",children:(0,zn.jsx)("input",{className:"menu-icon",type:"radio",name:"radiomenu",checked:this.props.item.checked,readOnly:!0})}),(0,zn.jsx)("span",{className:"menu-label",children:this.#ee()})]})})]})};render(){return"Separator"===this.props.item.type?pf:this.#ne()}}const mf=gf;var ff=s(34155);class vf extends Un.PureComponent{static contextType=oi.Z;nodeRef=Un.createRef();state={selectedItemIndex:this.props.items.findIndex((e=>e.id===this.props.selectedItem?.id))};componentDidMount(){this.context.requestAnimationFrame((()=>this.#ie()))}getNode(){return this.nodeRef.current}#ie=()=>this.getNode()?.focus();#ae=()=>{ff.nextTick((()=>{const{HTMLElement:e}=this.context,t=this.getNode();t instanceof e&&t.addEventListener("keydown",this.#oe)}))};#oe=e=>{switch(e.preventDefault(),e.which){case mo.Z.KEY_SPACE:case mo.Z.KEY_RETURN:const t=this.state.selectedItemIndex;t>=0&&t<=this.#re()&&this.#le(this.props.items[t],e);break;case mo.Z.KEY_ESCAPE:this.props.onClose?.();break;case mo.Z.KEY_UP:this.#de(!1);break;case mo.Z.KEY_DOWN:this.#de(!0);break;default:e.stopPropagation()}};#de=e=>{let t=this.state.selectedItemIndex;if(0!==this.props.items.filter((e=>"Separator"!==e.type)).length){do{t+=e?1:-1,t=(t+this.props.items.length)%this.props.items.length}while("Separator"===this.props.items[t].type);this.#ce(t)}};#re=()=>this.props.items.length-1;#ce=e=>{"Separator"===this.props.items[e].type||e>this.#re()||this.setState({selectedItemIndex:e})};#he=e=>{e.preventDefault(),e.stopPropagation();const{HTMLElement:t}=this.context,s=e.nativeEvent.target;s&&s instanceof t&&s.focus()};#le=(e,t)=>{t.stopPropagation(),this.props.onItemActivated(e)};handleClickOutside=e=>{this.props.onClose?.()};render(){return(0,zn.jsx)("div",{className:Gn()("menu",this.props.className),children:(0,zn.jsx)("ul",{ref:this.nodeRef,onMouseEnter:this.#ie,onMouseDown:this.#he,onMouseUp:this.#he,tabIndex:"0",onFocus:this.#ae,id:this.props.id,role:"menu","aria-labelledby":this.props.id?this.props.id+"_button":void 0,"aria-activedescendant":"dm_"+this.state.selectedItemIndex,children:this.props.items.map(((e,t)=>(0,zn.jsx)(mf,{index:t,item:e,showShortcut:this.props.showShortcuts,isSelected:this.state.selectedItemIndex===t,setSelected:this.#ce,onItemActivated:this.#le},t)))})})}}const bf=(0,Dg.Z)(vf),Cf="select-engine";function wf({onClick:e,icon:t,isOpen:s}){return(0,zn.jsx)(oa.ZP,{onClick:e,tooltip:(0,W.Z)("Change search engine"),faviconPath:t,faviconLoadType:"faviconFromCache",ariaHaspopup:"true",ariaExpanded:s,ariaControls:Cf,id:Cf+"_button"})}function yf({onClick:e,isOpen:t}){return(0,zn.jsx)(oa.ZP,{onClick:e,tooltip:(0,W.Z)("Change search engine"),image:Kn.L$F,ariaHaspopup:"true",ariaExpanded:t,ariaControls:Cf})}class xf extends Un.PureComponent{onItemClicked=({id:e})=>{this.props.onItemClicked(e)};render(){return(0,zn.jsxs)(Un.Fragment,{children:[(0,zn.jsx)("div",{className:"toolbar-insideinput SearchEngineSelect-Icon",children:this.props.useFavicon?(0,zn.jsx)(wf,{onClick:this.props.toggleOpen,icon:this.props.icon,isOpen:this.props.isOpen}):(0,zn.jsx)(yf,{onClick:this.props.toggleOpen,isOpen:this.props.isOpen})}),this.props.isOpen&&(0,zn.jsx)(bf,{items:this.props.items,onClose:this.props.onClose,onItemActivated:this.onItemClicked,showShortcuts:this.props.showKeywords,id:Cf})]})}}const If=xf;const Af=new class{setText(e,t){const s=Ze.ZP.getActivePage(e);s&&S.Z.dispatch({actionType:"SEARCH_FIELD_SET_TEXT",tabId:s.id,text:t})}},Sf={};class Zf extends Vo.Z{getText(e){const t=Ze.ZP.getActivePage(e);return t?Sf[t.id]??"":""}dispatchAction(e){switch(e.actionType){case"SEARCH_FIELD_SET_TEXT":t=e.tabId,s=e.text,Sf[t]=s,Tf.emitChange();break;case"CHROME_TABS_REMOVED":!function(e){delete Sf[e]}(e.tabId)}var t,s}}const Tf=new Zf(S.Z),Ef=Tf;var kf=s(36246),Nf=s(34155);const _f="select-search-history",Pf="searchFieldInput",Mf=[Z.kAddressBarSearchDisplay,Z.kAddressBarSearchFieldWidth,Z.kAddressBarSearchInNewTab,Z.kAddressBarSearchKeepSelected,Z.kAddressBarSearchShowFavicon,Z.kAddressBarSearchShowKeyword,Z.kAddressBarSearchSuggestEnabled,Z.kAddressBarVisible,Z.kKeyboardTabToAll,Z.kStartpageSpeedDialTrackerSuggestionShow,Z.kAddressBarSearchKeepTypedText,Z.kAddressBarSearchDirectMatchEnabled,Z.kAddressBarOmniboxShowTypedHistory,Z.kAddressBarOmniboxShowTypedHistoryButton];function Df({tabIndex:e,onClick:t,ariaExpanded:s}){return(0,zn.jsx)("div",{className:"toolbar toolbar-insideinput ignore-react-onclickoutside",children:(0,zn.jsx)("div",{className:"button-toolbar drop-down-menu",children:(0,zn.jsx)("button",{tabIndex:e,title:(0,W.Z)("Show search history"),"aria-label":(0,W.Z)("Show search history"),onClick:t,dangerouslySetInnerHTML:{__html:Kn.yaZ.medium},role:"button combobox","aria-haspopup":"menu","aria-expanded":s,"aria-controls":_f})})})}function Of({onClick:e,tabIndex:t}){return(0,zn.jsx)("div",{className:"toolbar toolbar-insideinput",children:(0,zn.jsx)("div",{className:"button-toolbar drop-down-menu",children:(0,zn.jsx)("button",{type:"submit",onMouseDown:e=>e.preventDefault(),tabIndex:t,title:(0,W.Z)("verb","Search"),className:"SearchField-ExecuteSearchButton ignore-react-onclickoutside",onClick:e,dangerouslySetInnerHTML:{__html:Kn.S$A.small}})})})}class jf extends Un.PureComponent{static contextType=oi.Z;_isPasting=!1;_isIMEOpen=!1;_justClosedIME=!1;_isOnSpeedDial="speed_dial_view"===this.props.origin;_refSearchField=Un.createRef();_omniDropdownRef=Un.createRef();_suppressReplace=!1;state={dropdownSelectionIndex:0,editText:Ef.getText(this.context.vivaldiWindowId),typedValue:"",showPopup:!1,searchEngineSelectItems:[],currentSearchEngine:void 0,numberOfSelectableItems:0,isSearchEngineSelectOpen:!1,dropdownItems:[]};componentDidMount(){this._onSearchEngineCacheChanged(),this._onSearchFieldStoreChanged(),pn.Z.addListener(this._onSearchEngineCacheChanged),Ef.addListener(this._onSearchFieldStoreChanged),Ca.Z.addListener(this._onWebpageviewStoreChanged)}componentWillUnmount(){pn.Z.removeListener(this._onSearchEngineCacheChanged),Ef.removeListener(this._onSearchFieldStoreChanged),Ca.Z.removeListener(this._onWebpageviewStoreChanged)}isOmniDropdownOpen(){return this.state.dropdownItems.length>0}getSelectedItem(){const{dropdownSelectionIndex:e,dropdownItems:t}=this.state;return t[e]}_isZeroSuggestion=()=>this.props.prefValues[Z.kAddressBarOmniboxShowTypedHistory]&&0===this.state.typedValue.length&&0===this.state.editText.length;_onWebpageviewStoreChanged=e=>{e.winId===this.context.vivaldiWindowId&&"WEBPAGEVIEW_ACTIONS"===e.type&&("searchPasteAndGo"===e.action?e.payload&&this.context.document.activeElement===this._refSearch&&Nf.nextTick((()=>this._pasteAndGo(e.payload))):"focusSearchField"===e.action&&("button"===this.props.prefValues[Z.kAddressBarSearchDisplay]&&this.toggleHiddenSearchFieldPopup(),Nf.nextTick(this.focusField)))};_pasteAndGo=({openOptions:e,clipboardText:t})=>{this._search({value:t,openOptions:e})};_onSearchEngineCacheChanged=()=>{this.setState(((e,t)=>{const s=pn.Z.get().map((e=>({type:"Normal",name:e.name,faviconUrl:e.faviconUrl,shortcut:e.keyword,noPrettifying:!0,id:e.guid}))),n=t.prefValues[Z.kAddressBarSearchKeepSelected],i=fe.ZP.isIncognito(this.context.vivaldiWindowId);let a;return a=this._isOnSpeedDial&&n?pn.Z.getSpeeddialsSearch(i):pn.Z.getSearchField(i),{currentSearchEngine:a,searchEngineSelectItems:s}}))};_onSearchFieldStoreChanged=()=>{const{document:e}=this.context,t={};e.activeElement===this._refSearch&&(t.editText=Ef.getText(this.context.vivaldiWindowId)),this.setState(t)};_onCompositionStart=()=>{this._isIMEOpen=!0};_onCompositionEnd=()=>{this._isIMEOpen=!1,this._justClosedIME=!0};_updateCurrentEngine=e=>{this.setState({currentSearchEngine:e},(()=>{if(this.props.prefValues[Z.kAddressBarSearchKeepSelected]){const t=fe.ZP.isIncognitoOrGuest(this.context.vivaldiWindowId),s=this._isOnSpeedDial?t?"defaultSpeeddialsPrivate":"defaultSpeeddials":t?"defaultSearchFieldPrivate":"defaultSearchField";re.Z.searchEngines.setDefault(s,e.guid)}}))};_search=({value:e,openOptions:t,itemClicked:s})=>{const{document:n}=this.context;this._refSearch&&n.activeElement===this._refSearch&&this._refSearch.blur();const{typedValue:i}=this.state,a=s??this.getSelectedItem(),o=this.props.prefValues[Z.kAddressBarSearchKeepTypedText],r=e,l={editText:r};o||(l.editText="",l.typedValue=""),this.setState(l);const d=this.context.vivaldiWindowId;Af.setText(d,o?r:"");const c=(!t||!1!==t.inCurrent)&&(!this.props.prefValues[Z.kAddressBarSearchInNewTab]||this._isOnSpeedDial),h={...t,inCurrent:c,fromUrlField:!0};if(!c&&A.Z.get(Z.kTabsStackingOpenInCurrent)&&(h.groupId=Ze.ZP.getActiveGroupId(d)),a&&(0,Sg.eE)(a)&&t)return Fg.Z.go(this.context.vivaldiWindowId,a,{...t,inCurrent:c}),void this._hideDropdown();h.transition=re.Z.historyPrivate.TransitionType.GENERATED;const u=pn.Z.getByQuery(i);var p,g;if(p=e,e=(g=u)&&p.startsWith(g.keyword+" ")?p.slice(g.keyword.length+1):p,u&&this._updateCurrentEngine(u),e.length>0&&this.state.currentSearchEngine){this.onSearch(e,this.state.currentSearchEngine,h);const t=fe.ZP.isIncognito(this.context.vivaldiWindowId),s=pn.Z.getSearchField(t);!this.props.prefValues[Z.kAddressBarSearchKeepSelected]&&s&&this._updateCurrentEngine(s)}this._hideDropdown()};onSearch=(e,t,s={})=>{Fg.Z.goSearchUrl(this.context.vivaldiWindowId,e.trim(),{useSearchEngine:t,...s}),this._hideDropdown()};moveNavigation=e=>{const{dropdownSelectionIndex:t,dropdownItems:s}=this.state;let n=t;"up"===e?n=0===t?s.length-1:t-1:"down"===e&&(n=t===s.length-1?0:t+1),this.setState((e=>({editText:this.getEditText(e.dropdownItems[n]),dropdownSelectionIndex:n})))};onKeyDowned=e=>{this._justClosedIME=!1;const t=e.shiftKey&&!e.ctrlKey&&!e.altKey&&!e.metaKey,s=!(0,vi.Z)(e);switch(e.key){case"ArrowUp":return void(this.isOmniDropdownOpen()&&(0,wi.ZP)(e));case"ArrowDown":return void(t&&this.onKeyPressed(e));case"Tab":if(!this.isOmniDropdownOpen())return;return s&&((0,wi.ZP)(e),Nf.nextTick((()=>this.moveNavigation("down")))),void(t&&((0,wi.ZP)(e),Nf.nextTick((()=>this.moveNavigation("up")))));case"Escape":return(0,wi.ZP)(e),"button"===this.props.prefValues[Z.kAddressBarSearchDisplay]&&this.props.prefValues[Z.kAddressBarVisible]||this.setState((e=>({editText:e.typedValue}))),void this._esc();case"Enter":return void(s||this.onKeyPressed(e))}};onExecuteSearchButtonClick=e=>{const t={ctrlKey:e.ctrlKey,altKey:!1,shiftKey:e.shiftKey||e.altKey,metaKey:e.metaKey},s=(0,fo.ZP)(this.context.vivaldiWindowId,t),n=this.getSelectedItem(),i=n?n.contents||"":this.state.typedValue;this._search({value:i,openOptions:s})};onKeyPressed=e=>{const{key:t,currentTarget:s}=e;switch(t){case"Enter":{this._justClosedIME=!1;const t={ctrlKey:e.ctrlKey,altKey:!1,shiftKey:e.shiftKey||e.altKey,metaKey:e.metaKey},n=(0,fo.ZP)(this.context.vivaldiWindowId,t);return void this._search({value:s.value,openOptions:n})}case"ArrowDown":return;case"Tab":return void this._hideDropdown()}};onSearchEngineChanged=e=>{const t=this._refSearch?this._refSearch.value:"";this._refSearch&&""===t&&this._refSearch.focus();const s=pn.Z.getByGuid(e);if(t.length>0&&s){const e={inCurrent:!0!==this.props.prefValues[Z.kAddressBarSearchInNewTab]};this.onSearch(t,s,e)}s&&this._updateCurrentEngine(s),this.setState({isSearchEngineSelectOpen:!1})};onDeleteItem=e=>{(0,Sg.b1)(e)?n.Z.history.deleteUrl({url:e.destinationUrl}).then((()=>{setTimeout((()=>{this.performZeroSuggestion()}),50)})):(0,Sg.eE)(e)&&re.Z.directMatch.hide(e.destinationUrl).then((()=>{const{typedValue:e,currentSearchEngine:t}=this.state;e&&this.performSearch(e,t?.guid??"")}))};_hideDropdown=()=>{this.setState({dropdownSelectionIndex:0,dropdownItems:[]})};_esc=()=>{if(this._isIMEOpen||this._justClosedIME)this._justClosedIME=!1;else{if(this.isOmniDropdownOpen())this._hideDropdown();else if(this.state.isSearchEngineSelectOpen)this.closeSearchEngineSelect();else if(this.state.editText)this.setState({typedValue:""}),Af.setText(this.context.vivaldiWindowId,"");else{this.state.showPopup&&this.hideSearchField(),this.onBlur();const e=Ze.ZP.getActivePage(this.context.vivaldiWindowId);e&&sp.Z.doAction(this.context.vivaldiWindowId,e.id,"focusWebView")}this._justClosedIME=!1}};_onKeyboardChanged=(e,t,s,n)=>{if(t&&0===s)switch(n){case mo.Z.KEY_DOWN:if(this._isIMEOpen)return;this.isOmniDropdownOpen()?this.moveNavigation("down"):this.setState({isSearchEngineSelectOpen:!0});break;case mo.Z.KEY_UP:this._isIMEOpen||this.moveNavigation("up");break;case mo.Z.KEY_ESCAPE:"button"===this.props.prefValues[Z.kAddressBarSearchDisplay]&&this.props.prefValues[Z.kAddressBarVisible]||this.context.document.activeElement===this._refSearch||this._esc();break;case mo.Z.KEY_PAGE_DOWN:this.moveNavigation("down");break;case mo.Z.KEY_PAGE_UP:this.moveNavigation("up");break;case mo.Z.KEY_DELETE:const e=this.getSelectedItem();e&&this.onDeleteItem(e)}};onFocus=()=>{re.Z.tabsPrivate.onKeyboardChanged.addListener(this._onKeyboardChanged)};onBlur=()=>{const{getSelection:e}=this.context,t=e();t&&t.empty(),re.Z.tabsPrivate.onKeyboardChanged.removeListener(this._onKeyboardChanged)};onMouseDown=e=>{const{document:t}=this.context;this._focusedOnMouseDown=t.activeElement,this._isZeroSuggestion()&&!this.isOmniDropdownOpen()&&this._focusedOnMouseDown?.id===Pf&&this.performZeroSuggestion()};onMouseUp=({currentTarget:e})=>{const{document:t}=this.context;t.activeElement===e&&(this._focusedOnMouseDown!==this._refSearch&&e.selectionStart===e.selectionEnd&&e.select(),this._focusedOnMouseDown=void 0)};onDoubleClick=e=>{(0,wi.ZP)(e)};onPaste=e=>{this._isPasting=!0,setTimeout((()=>this._isPasting=!1),5)};onChange=({currentTarget:{value:e}})=>{Af.setText(this.context.vivaldiWindowId,e);const t=e.indexOf(" ")>=1?pn.Z.getByQuery(e):void 0;if(t)(0,Sg.q)(),this.setState({currentSearchEngine:t,typedValue:"",editText:"",dropdownItems:[],dropdownSelectionIndex:0}),this._updateCurrentEngine(t);else{if(e.trim().length>0){const t=this.state.currentSearchEngine?.guid??"";this.performSearch(e,t)}else(0,Sg.q)(),this.setState({dropdownSelectionIndex:0,typedValue:e,dropdownItems:[]})}};onDragStart=e=>{this._suppressReplace=!0};onDragOver=e=>{e.stopPropagation()};onDragEnter=e=>{if(e.stopPropagation(),this._suppressReplace)return;e.preventDefault();const{HTMLInputElement:t}=this.context,s=e.target;s instanceof t&&""!==s.value&&s.classList.add("pseudo-selected")};onDragLeave=e=>{if(!this._suppressReplace){const{HTMLInputElement:t}=this.context,s=e.target;s instanceof t&&s.classList.remove("pseudo-selected")}};onDropped=e=>{if(this._suppressReplace)this._suppressReplace=!1;else{const t=e.dataTransfer.getData("text/plain");""!==t&&(e.preventDefault(),this.setState({editText:t}),Af.setText(this.context.vivaldiWindowId,t));const{HTMLInputElement:s}=this.context,n=e.target;n instanceof s&&n.classList.remove("pseudo-selected")}};onToggleDropdownClicked=e=>{e.preventDefault(),this.isOmniDropdownOpen()?this._hideDropdown():(this.performZeroSuggestion(),this._refSearch?.focus())};onSlidebarPosition=(e,t)=>{if(this._refSearchField.current){const t=this._refSearchField.current.getBoundingClientRect();I.Z.set(Z.kAddressBarSearchFieldWidth,Math.floor(t.right-e))}};onOmniboxResult=e=>{const{combinedResults:t,inputText:s}=e,n=this._isZeroSuggestion()?-1:0;this.setState({dropdownItems:t,dropdownSelectionIndex:n,typedValue:s})};performSearch=(e,t)=>{(0,Sg.PH)({query:e,preventInlineAutocomplete:!0,fromSearchField:!0,searchEngineGUID:t,focusType:"INTERACTION_DEFAULT",pageClassification:"OTHER",windowId:this.context.vivaldiWindowId},this.onOmniboxResult)};performZeroSuggestion=()=>{const e=this.state.currentSearchEngine?.guid??"";(0,Sg.PH)({query:"",preventInlineAutocomplete:!0,fromSearchField:!0,searchEngineGUID:e,focusType:"INTERACTION_FOCUS",pageClassification:(0,Sg.D7)(Ze.ZP.getActivePage(this.context.vivaldiWindowId)?.url??""),windowId:this.context.vivaldiWindowId},this.onOmniboxResult)};getWidth=()=>(0,kf.Z)(this.props.prefValues[Z.kAddressBarSearchFieldWidth],175,800);focusField=()=>{this._refSearch?.select()};onOmniDropdownItemClicked=(e,t)=>{this._search({value:e.contents,openOptions:t,itemClicked:e})};onContextMenu=e=>{e.stopPropagation()};getEditText=e=>e&&e.destinationUrl?(0,Sg.eE)(e)?e.description:e.contents:"";getDropdownItems=()=>this.state.dropdownItems;renderDropdown=()=>{const e=this.getDropdownItems();return 0===e.length?null:(0,zn.jsx)(Bg,{defaultSearchEngine:this.state.currentSearchEngine,onDeleteItem:this.onDeleteItem,onLinkItemClicked:this.onOmniDropdownItemClicked,typedText:this.state.typedValue,ref:this._omniDropdownRef,selectionIndex:this.state.dropdownSelectionIndex,items:e,onMenuClosed:this._hideDropdown,id:_f,fromSearchField:!0,getOffsetWidth:()=>this._refSearchField.current?.offsetWidth??0})};toggleSearchEngineSelectOpen=()=>{this.setState((e=>({isSearchEngineSelectOpen:!e.isSearchEngineSelectOpen})))};closeSearchEngineSelect=()=>{this.setState({isSearchEngineSelectOpen:!1}),"button"!==this.props.prefValues[Z.kAddressBarSearchDisplay]&&this.focusField()};hideSearchField=()=>{this.setState({showPopup:!1})};toggleHiddenSearchFieldPopup=()=>{this.setState((e=>({showPopup:!e.showPopup})))};renderSearchField(){const{inEditor:e=!1}=this.props;if(e)return(0,zn.jsx)("input",{type:"text",value:(0,W.Z)("verb","Search"),name:"SearchField",...(0,cc.uu)({draggable:this.props.draggable,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,onDragEnter:this.props.onDragEnter,onDragOver:this.props.onDragOver,onDragLeave:this.props.onDragLeave,onDrop:this.props.onDrop}),readOnly:!0});const t=this.state.currentSearchEngine,s=t&&t.name?pn.Z.systemDefaultEngineChanged()?(0,W.Z)("Search $1 [NEW]",[t.name]):(0,W.Z)("Search $1",[t.name]):"",n=Boolean(this.state.typedValue),i=this.props.prefValues[Z.kAddressBarOmniboxShowTypedHistory]&&this.props.prefValues[Z.kAddressBarOmniboxShowTypedHistoryButton]&&!n,a=this.props.popupPosition||"below";return(0,zn.jsxs)("div",{ref:this._refSearchField,className:Gn()(this.props.buttonClasses,this.props.className,"iconmenu-container","SearchField",a,{"SearchField--DropdownOpen":this.isOmniDropdownOpen()||this.state.isSearchEngineSelectOpen}),name:"SearchField",...(0,cc.uu)({draggable:this.props.draggable,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,onDragEnter:this.props.onDragEnter,onDragOver:this.props.onDragOver,onDragLeave:this.props.onDragLeave,onDrop:this.props.onDrop}),onContextMenu:this.onContextMenu,style:{"--SearchFieldWidth":this.getWidth()},children:[!this._isOnSpeedDial&&"button"!==this.props.prefValues[Z.kAddressBarSearchDisplay]&&(0,zn.jsx)(Mu.Z,{className:"SearchField-SlideBar",onSlidebarPosition:this.onSlidebarPosition,offset:2,position:"left"}),(0,zn.jsx)(If,{onItemClicked:this.onSearchEngineChanged,items:this.state.searchEngineSelectItems,isOpen:this.state.isSearchEngineSelectOpen,onClose:this.closeSearchEngineSelect,toggleOpen:this.toggleSearchEngineSelectOpen,icon:this.state.currentSearchEngine?this.state.currentSearchEngine.faviconUrl:"",useFavicon:this.props.prefValues[Z.kAddressBarSearchShowFavicon],showKeywords:this.props.prefValues[Z.kAddressBarSearchShowKeyword]}),(0,zn.jsx)("input",{id:Pf,role:i?"combobox":"searchbox","aria-autocomplete":i?"both":void 0,"aria-controls":_f,"aria-expanded":this.isOmniDropdownOpen(),"aria-activedescendant":Zg+this.state.dropdownSelectionIndex,ref:e=>this._refSearch=e,className:"vivaldi-searchfield searchfield-input ignore-react-onclickoutside",onBlur:this.onBlur,onChange:this.onChange,autoFocus:!this._isOnSpeedDial&&"button"===this.props.prefValues[Z.kAddressBarSearchDisplay],onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onDoubleClick:this.onDoubleClick,onDragEnter:this.onDragEnter,onDragStart:this.onDragStart,onDragOver:this.onDragOver,onDragLeave:this.onDragLeave,onDrop:this.onDropped,onFocus:this.onFocus,onKeyDown:this.onKeyDowned,onKeyPress:this.onKeyPressed,onCompositionStart:this._onCompositionStart,onCompositionUpdate:this._onCompositionStart,onCompositionEnd:this._onCompositionEnd,onPaste:this.onPaste,placeholder:s,tabIndex:this._isOnSpeedDial?0:null,type:"search",value:this.state.editText}),this.isOmniDropdownOpen()&&this.renderDropdown(),n&&(0,zn.jsx)(Of,{onClick:this.onExecuteSearchButtonClick,tabIndex:this.props.prefValues[Z.kKeyboardTabToAll]}),i&&(0,zn.jsx)(Df,{tabIndex:this.props.prefValues[Z.kKeyboardTabToAll],onClick:this.onToggleDropdownClicked,ariaExpanded:this.isOmniDropdownOpen()})]})}render(){if("button"===this.props.prefValues[Z.kAddressBarSearchDisplay]&&!this._isOnSpeedDial||this.props.forceIcon){const{size:e="large"}=this.props;return(0,zn.jsx)(oa.ZP,{image:Kn.YvR[e],label:(0,W.Z)("Search Field"),tooltip:(0,W.Z)("Show Search Field"),onClick:this.toggleHiddenSearchFieldPopup,customizeMenu:this.props.customizeMenu,menuOrigin:this.props.menuOrigin,popupPosition:this.props.popupPosition,draggable:this.props.draggable,onDragStart:this.props.onDragStart??nr.Z,onDragEnd:this.props.onDragEnd??nr.Z,onDragEnter:this.props.onDragEnter,onDragOver:this.props.onDragOver,onDragLeave:this.props.onDragLeave,onDrop:this.props.onDrop??nr.Z,hidePopup:this.hideSearchField,isPopupVisible:this.state.showPopup,popupWidth:210,hasLightArrow:!0,size:e,popupClassName:"SearchField-Popup",popupLabel:(0,W.Z)("dialog title","Search Field"),mimeType:this.props.mimeType,name:this.props.name,children:this.renderSearchField()})}return this.renderSearchField()}}const Lf=(0,zd.Z)((0,cc.ZP)(jf),Mf);class Rf extends Un.Component{static contextType=oi.Z;state={taskInfo:this.props.taskInfo};onContextMenu=e=>{const{taskInfo:t}=this.props;(0,mi.Z)(this.context,t.menuItems)};render(){const{taskInfo:e}=this.props;return(0,zn.jsx)("p",{className:"button-toolbar-small in-progress",id:e.id,title:e.title+"\n"+e.description,onContextMenu:this.onContextMenu,children:this.state.taskInfo.text})}}const Bf=Rf;class Ff extends Vo.Z{_tasks=(0,qe.aV)();getBackgroundTasks(){return this._tasks}dispatchAction(e){if("BACKGROUND_TASKS_SET"===e.actionType)this._tasks=(0,qe.aV)(e.tasks),this.emitChange()}}const Wf=new Ff(S.Z);class Uf extends Un.PureComponent{state={backgroundTasks:Wf.getBackgroundTasks()};componentDidMount(){Wf.addListener(this.onBackgroundTaskStoreChange)}componentWillUnmount(){Wf.removeListener(this.onBackgroundTaskStoreChange)}onBackgroundTaskStoreChange=()=>{this.setState({backgroundTasks:Wf.getBackgroundTasks()})};render(){return(0,zn.jsx)(zn.Fragment,{children:this.state.backgroundTasks.map((e=>(0,zn.jsx)(Bf,{taskInfo:e},e.id)))})}}const Vf=Uf,Hf=Object.freeze({status:"",persistentStatuses:new Map});class Gf extends m.Z{getInitialState(){return new Map}getEntry(e){return this.getState().get(e)??Hf}reduce(e,t){switch(t.actionType){case"WINDOW_CLOSED":return(0,Fo.u4)(e,t.windowId);case"STATUS_SET_STATUS":return(0,Fo.cR)(e,t.windowId,(e=>{e.status=t.status}),Hf);case"STATUS_SET_PERSISTENT_STATUS":return(0,Fo.cR)(e,t.windowId,(e=>{e.persistentStatuses.set(t.key,t.status)}),Hf);case"STATUS_CLEAR_PERSISTENT_STATUS":return(0,Fo.cR)(e,t.windowId,(e=>{e.persistentStatuses.delete(t.key)}),Hf);case"PAGE_OPEN":return(0,Fo.cR)(e,t.windowId,(e=>{e.status=""}),Hf)}return e}}const Kf=new Gf;var zf=(0,zn.jsx)(Vf,{});class $f extends Un.PureComponent{static contextType=oi.Z;state={status:Kf.getEntry(this.context.vivaldiWindowId).status,visible:!1};componentDidMount(){const{selectWindow:e}=this.context;Kf.addListener(this.onStoreChange,e),this._persistentStatusIndex=0}componentWillUnmount(){clearTimeout(this._statusTimeout),clearInterval(this._persistentStatusInterval),Kf.removeListener(this.onStoreChange)}onStoreChange=()=>{clearTimeout(this._statusTimeout),clearInterval(this._persistentStatusInterval);const{status:e,persistentStatuses:t}=Kf.getEntry(this.context.vivaldiWindowId);e?this.setState({status:e,visible:!0}):1===t.size?this.setState({status:[...t.values()][0],visible:!0}):t.size>1?this._persistentStatusInterval=setInterval((()=>{this._persistentStatusIndex=this._persistentStatusIndex%t.size;const e=[...t.values()][this._persistentStatusIndex++];this.setState({status:e,visible:!0})}),2e3):this._statusTimeout=setTimeout((()=>this.setState({visible:!1})),200)};urlSecurityDisplay=()=>{const e=(0,Kg.dO)(this.state.status);return(0,zn.jsx)("div",{className:"StatusInfo-Content",children:(0,zn.jsx)(lm,{windowId:this.context.vivaldiWindowId,urlFragments:e,displayUrl:this.state.status,shouldShowFullUrl:!0,onGoToPath:nr.Z,onBaseDomainObscured:nr.Z,shouldHighlightBaseDomain:!1,rawDisplay:!0})})};renderStatusInfoContent=()=>cm()(this.state.status)?this.urlSecurityDisplay():(0,zn.jsx)("span",{className:"StatusInfo-Content",children:this.state.status});render(){const e=this.props.customizeMenu?.("StatusInfo");return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("span",{style:this.props.style,name:"StatusInfo",className:Gn()(this.props.buttonClasses,{StatusInfo:!0,"button-toolbar":this.props.preview,"StatusInfo--Visible":this.state.visible||this.props.preview}),...(0,cc.uu)({draggable:this.props.draggable,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,onDragEnter:this.props.onDragEnter,onDragOver:this.props.onDragOver,onDragLeave:this.props.onDragLeave,onDrop:this.props.onDrop}),onContextMenu:e?t=>(0,mi.Z)(this.context,e)(t):null,children:this.props.preview?(0,zn.jsx)("button",{className:"ToolbarButton-Button",name:"StatusInfo",children:(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.MSA[this.props.size||"medium"]+(0,W.Z)("Status")}})}):this.renderStatusInfoContent()}),"StatusOverlay"!==this.props.name&&zf]})}}const Yf=(0,cc.ZP)($f),Xf="▽",Qf="▼",qf="△",Jf="▲",ev="⭍",tv={not_synced:(0,W.Z)("Not synced"),success:(0,W.Z)("sync","Done"),auth_error:(0,W.Z)("Sync server refused your credentials"),server_error:(0,W.Z)("Sync server encountered an error"),network_error:(0,W.Z)("Network error"),conflict:(0,W.Z)("Conflict with another client’s data occurred"),throttled:(0,W.Z)("Sync server throttled the connection"),other_error:(0,W.Z)("Unexpected error")};function sv(e,t){return function(e,t){switch(e){case"not_synced":return t?Xf:qf;case"success":return t?Qf:Jf;default:return ev}}(e,t)+" "+(t?(0,W.Z)("Download: $1",[tv[e]]):(0,W.Z)("Upload: $1",[tv[e]]))}function nv(e){return[tv[e.downloadUpdatesStatus],tv[e.commitStatus]]}function iv(e){return(0,zn.jsx)(fa,{type:"warning",children:(0,zn.jsxs)("span",{className:"sync-error-vivaldistatus",children:[(0,W.Z)("sync error","Vivaldi Sync service may be experiencing problems. Get service updates at:")," ",(0,zn.jsx)("a",{href:"https://vivaldistatus.com/",onClick:()=>c.ZP.openURL(e.windowId,"https://vivaldistatus.com/"),children:"vivaldistatus.com"})]})})}function av(e){return"None"!==e&&"EncryptionMissing"!==e}function ov(e){switch(e){case"EncryptionMissing":return(0,W.Z)("Encryption missing");case"ConfigurationPending":return(0,W.Z)("Configuration missing");case"ServerMissing":return(0,W.Z)("Server not responding");case"Outage":return(0,W.Z)("Server or network outage");case"WarningDialogCompleted":return(0,W.Z)("Sync problem");case"StartupFailed":return(0,W.Z)("Startup failed");default:return""}}function rv(e,t){let s;const n=pe(me.getState());return"configuration_pending"===t.engineState?s=t.needsDecryptionPassword?"EncryptionMissing":"ConfigurationPending":"starting"===t.engineState?s="ServerMissing":!function(e,t){const s=["server_error","network_error"];return"stopped"!==t.engineState&&navigator.onLine&&(s.includes(e.downloadUpdatesStatus)||s.includes(e.commitStatus))}(e,t)?(t.isFirstSetupComplete||"disable_sync_on_client"===t.protocolErrorClientAction)&&("credentialsMissing"===n||"loginFailed"===n||"started"===t.engineState&&t.needsDecryptionPassword||"failed"===t.engineState||"disable_sync_on_client"===t.protocolErrorClientAction)&&(s="WarningDialogCompleted"):s="Outage","loggedOut"!==n&&(t.isFirstSetupComplete&&("credentialsMissing"===n||"loginFailed"===n||t.needsDecryptionPassword)||"failed"===t.engineState&&!t.disableReasons.includes("not_signed_in")||"disable_sync_on_client"===t.protocolErrorClientAction)&&(s="StartupFailed"),s??"None"}let lv;function dv(e,t){const s=rv(e,t);return"None"!==s?lv||(lv=setTimeout((()=>{lv=void 0}),3e5)):lv&&(clearTimeout(lv),lv=void 0),s}class cv extends m.Z{getInitialState(){return{engineData:{engineState:"stopped",disableReasons:[],protocolErrorType:"success",protocolErrorDescription:"",protocolErrorClientAction:"unknown",usesEncryptionPassword:!1,needsDecryptionPassword:!1,isEncryptingEverything:!1,isSetupInProgress:!1,isFirstSetupComplete:!1,syncEverything:!0,dataTypes:[],isReady:!1},cycleData:{cycleStartTime:0,downloadUpdatesStatus:"not_synced",commitStatus:"not_synced",nextRetryTime:0,isReady:!1},problem:"None"}}reduce(e,t){switch(t.actionType){case"SYNC_ENGINE_STATE_CHANGED":{const s=dv(e.cycleData,t.engineData);return{engineData:t.engineData,cycleData:e.cycleData,problem:"None"===s?s:e.problem}}case"SYNC_CYCLE_COMPLETED":{const s=dv(t.cycleData,e.engineData);return{engineData:e.engineData,cycleData:t.cycleData,problem:"None"===s?s:e.problem}}case"SYNC_PROBLEM_TIMEOUT":{const t=rv(e.cycleData,e.engineData);return{engineData:e.engineData,cycleData:e.cycleData,problem:t}}}return e}}const hv=new cv;class uv extends Un.Component{static contextType=oi.Z;state={statusText:(0,W.Z)("Sync"),active:!1,statusOverlay:"none",problem:hv.getState().problem};componentDidMount(){hv.addListener(this.onStoreChange),me.addListener(this.onStoreChange),this.onStoreChange()}componentWillUnmount(){hv.removeListener(this.onStoreChange),me.removeListener(this.onStoreChange)}onStoreChange=()=>{const e=pe(me.getState()),t=me.getState().accountInfo.username,s=hv.getState().engineData,n=hv.getState().cycleData,i=s.isFirstSetupComplete&&"stopped"!==s.engineState;let a="none";"loggedOut"!==e&&("StartupFailed"===rv(n,s)?a="failed":["started","stopped"].includes(s.engineState)&&0===parseInt(n.nextRetryTime)||(a="waiting"));let o=(0,W.Z)("Sync");if("loggedOut"===e)o=(0,W.Z)("Sync not connected");else if("failed"===a)o=(0,W.Z)("Failed to start Sync for “$1”",[t]);else if("clearing_data"===s.engineState)o=(0,W.Z)("Clearing Sync server data for “$1”",[t]);else if("configuration_pending"===s.engineState)o=(0,W.Z)("Setting up Sync for “$1”",[t]);else if("started"===s.engineState){if(o=(0,W.Z)("Connected to Sync as “$1”",[t]),"not_synced"!==n.downloadUpdatesStatus){const[e,t]=function(e){return[sv(e.downloadUpdatesStatus,!0),sv(e.commitStatus,!1)]}(n);o+="\n"+(0,W.Z)("Last sync: $1",[V()(n.cycleStartTime).calendar()])+"\n"+e+"\n"+t}}else o=(0,W.Z)("Connecting to Sync as “$1”...",[t]);this.setState({active:i,statusOverlay:a,statusText:o,problem:hv.getState().problem})};openSyncSettings=()=>{ue.Z.showSettings(this.context.vivaldiWindowId,"sync")};renderButton=()=>(0,zn.jsx)(oa.ZP,{onClick:this.openSyncSettings,image:Kn.ssx[this.props.size],tooltip:this.state.statusText,customizeMenu:this.props.customizeMenu,menuOrigin:this.props.menuOrigin,draggable:this.props.draggable,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,onDrop:this.props.onDrop,onDragEnter:this.props.onDragEnter,mimeType:this.props.mimeType,name:this.props.name,size:this.props.size,style:{"--syncStatusActive":this.state.active&&"none"===this.state.statusOverlay?1:0,"--syncStatusLoading":"waiting"===this.state.statusOverlay?1:0,"--syncStatusFailed":"failed"===this.state.statusOverlay?1:0}});render(){return"None"===this.state.problem||this.props.preview?this.renderButton():(0,zn.jsxs)("div",{className:"SyncStatus",title:this.state.statusText,children:[this.renderButton(),(0,zn.jsx)("div",{className:"SyncStatus-Warning",title:ov(this.state.problem),onClick:this.openSyncSettings,children:(0,W.Z)("Sync Problem")})]})}}const pv=uv,gv=[{title:(0,W.Z)("Always"),profile:"always"},{title:(0,W.Z)("Cached"),profile:"cache"},{title:(0,W.Z)("title","Never"),profile:"never"}],mv=[{title:(0,W.Z)("command","Loop"),profile:"allowed"},{title:(0,W.Z)("Once"),profile:"once"},{title:(0,W.Z)("command","Never"),profile:"none"}];class fv extends Un.PureComponent{static contextType=oi.Z;_isMounted=!1;state={imageLoading:A.Z.get(Z.kPageImageLoading),animationProfile:"allowed",drawerOpen:!1};componentDidMount(){this._isMounted=!0,n.Z.accessibilityFeatures.animationPolicy.onChange.addListener(this._onAnimationPolicyChanged),this._onAnimationPolicyChanged(),A.Z.addListener(Z.kPageImageLoading,this._onSettingsChanged)}componentWillUnmount(){this._isMounted=!1,n.Z.accessibilityFeatures.animationPolicy.onChange.removeListener(this._onAnimationPolicyChanged),A.Z.removeListener(Z.kPageImageLoading,this._onSettingsChanged)}_onSettingsChanged=(e,t)=>{this.setState({imageLoading:t})};_onAnimationPolicyChanged=()=>{n.Z.accessibilityFeatures.animationPolicy.get({},(({value:e})=>{this._isMounted&&this.setState({animationProfile:e})}))};onImageProfileSelected=e=>{switch(I.Z.set(Z.kPageImageLoading,e),e){case"never":this.updatePageImageState(!1,!1);break;case"cache":this.updatePageImageState(!0,!0);break;case"always":this.updatePageImageState(!0,!1)}};onAnimationsProfileSelected=e=>{this.setState({animationProfile:e},(()=>{n.Z.accessibilityFeatures.animationPolicy.set({value:e},(()=>{}))}))};updatePageImageState=(e,t)=>{const s=Ze.ZP.getActivePage(this.context.vivaldiWindowId);s&&re.Z.tabsPrivate.update(s.id,{showImages:e,loadFromCacheOnly:t})};hidePopup=()=>{this.state.drawerOpen&&this.setState({drawerOpen:!1})};togglePopup=()=>{this.setState((e=>({drawerOpen:!e.drawerOpen})))};render(){const e=this.state.imageLoading,t=this.state.animationProfile,s=this.props.disabled;return(0,zn.jsx)(oa.ZP,{style:{"--displayImagesAll":"always"===e?1:0,"--displayImagesCached":"cache"!==e||s?0:1,"--displayImagesNever":"never"!==e||s?0:1,"--displayAnimationLoop":"allowed"===t?1:0,"--displayAnimationOnce":"once"===t?1:0,"--displayAnimationNever":"none"===t?1:0},tooltip:(0,W.Z)("Toggle images and animation"),onClick:this.togglePopup,disabled:this.props.disabled,image:Kn.myO[this.props.size],size:this.props.size,customizeMenu:this.props.customizeMenu,menuOrigin:this.props.menuOrigin,hidePopup:this.hidePopup,popupPosition:this.props.popupPosition,isPopupVisible:this.state.drawerOpen,draggable:this.props.draggable,onDragStart:this.props.onDragStart,hasLightArrow:"above"===this.props.popupPosition,onDragEnd:this.props.onDragEnd,onDrop:this.props.onDrop,onDragEnter:this.props.onDragEnter,mimeType:this.props.mimeType,popupClassName:"ToolbarButtonPopup-DefaultStyles",popupLabel:(0,W.Z)("dialog title","Images and Animation Controls"),name:this.props.name,children:(0,zn.jsxs)("form",{children:[(0,zn.jsx)("h2",{children:(0,W.Z)("title","Load Images")}),(0,zn.jsx)("div",{className:"ToggleImages-Selection",children:gv.map((({title:t,profile:s},n)=>(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{autoFocus:e===s,type:"radio",name:"toggle-image-group",checked:e===s,onChange:this.onImageProfileSelected.bind(this,s)}),t]},"imagePolicy-"+s)))}),(0,zn.jsx)("h2",{children:(0,W.Z)("Play Image Animation")}),(0,zn.jsx)("div",{className:"ToggleImages-Selection",children:mv.map((({title:e,profile:s})=>(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"radio",name:"toggle-animations-group",checked:t===s,onChange:this.onAnimationsProfileSelected.bind(this,s)}),e]},"animationPolicy-"+s)))})]})})}}const vv=fv,bv=function(e){const t=Ze.ZP.unsafeGetActivePage(e),s=(0,hg.jA)(t);return{groupId:t.vivExtData.group??"",tileId:s&&Ze.ZP.getTiles(s,e).count()>1?s:"",tileMode:t.vivExtData.tiling?.layout,disabled:1===Ze.ZP.getPages(e).count()}};class Cv extends Un.PureComponent{static contextType=oi.Z;_isMounted=!1;_focusRef=Un.createRef();constructor(e,t){super(e),this.state={drawerOpen:!1,...bv(t.vivaldiWindowId)}}componentDidMount(){const{selectWindow:e}=this.context;this._isMounted=!0,Ze.ZP.addListener(this._onPageStoreChange,e)}componentDidUpdate(e){this._isMounted&&e.pageId!==this.props.pageId&&this.hidePopup()}componentWillUnmount(){this._isMounted=!1,Ze.ZP.removeListener(this._onPageStoreChange)}_onPageStoreChange=()=>{this._isMounted&&this.setState(bv(this.context.vivaldiWindowId))};togglePopup=()=>{this.setState((e=>({drawerOpen:!e.drawerOpen})))};hidePopup=()=>{this.state.drawerOpen&&this.setState({drawerOpen:!1})};setTiling=e=>{if(e.hasOwnProperty("button")&&e.button!==ai.Z.kLeft)return;const t=this.context.vivaldiWindowId,s=e.currentTarget.value,n=Ze.ZP.getSelectedPages(t);if(n.size>1)c.ZP.tilePages(n,s);else if(this.state.tileId){const e=Ze.ZP.getTiles(this.state.tileId,t);c.ZP.tilePages(e,s)}else Ze.ZP.isGroup(this.state.groupId,t)?c.ZP.tileTabStack(t,this.state.groupId,s):c.ZP.tileLastActive(t,s);this.hidePopup()};untile=()=>{c.ZP.untileTileGroup(this.context.vivaldiWindowId,this.state.tileId),this.hidePopup()};keyDownHandler=e=>{const t=e.currentTarget,s=t.parentElement?.querySelectorAll(".PageTiling-Button:not([disabled])");if(s?.length)switch(e.key){case"ArrowUp":let n=Array.from(s).indexOf(t)-1;n<0&&(n=s.length-1),s[n].focus();break;case"ArrowDown":let i=Array.from(s).indexOf(t)+1;i>=s.length&&(i=0),s[i].focus();break;case" ":case"Enter":"none"===t.value?this.untile():this.setTiling(e);break;default:return}};focusPopup=()=>this._focusRef.current?.focus();render(){return(0,zn.jsxs)(oa.ZP,{customizeMenu:this.props.customizeMenu,tooltip:(0,W.Z)("Page tiling"),tooltipExtra:(0,W.Z)("Tile the current tab selection, tab stack, or last active tab"),buttonStyle:{"--displayUntiled":this.state.tileId?0:1,"--displayTileColumn":!this.state.tileId||"column"!==this.state.tileMode&&"grid"!==this.state.tileMode?0:1,"--displayTileRow":!this.state.tileId||"row"!==this.state.tileMode&&"grid"!==this.state.tileMode?0:1},className:`tilingtoggle ${this.props.size} ${["grid","row","column"].includes(this.state.tileMode)?"button-on":""}`,disabled:this.state.disabled,image:Kn.Dx_[this.props.size],size:this.props.size,onClick:this.togglePopup,onPointerDown:this.togglePopup,isPopupVisible:this.state.drawerOpen,hidePopup:this.hidePopup,popupPosition:this.props.popupPosition,popupLabelledBy:"popup-label-pagetiling",menuOrigin:this.props.menuOrigin,draggable:this.props.draggable,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,hasLightArrow:!0,onDrop:this.props.onDrop,onDragEnter:this.props.onDragEnter,mimeType:this.props.mimeType,popupClassName:`ToolbarButtonPopup-DefaultStyles ${this.props.size}`,name:this.props.name,onFocus:this.state.drawerOpen?this.focusPopup:nr.Z,children:[(0,zn.jsx)("h2",{id:"popup-label-pagetiling",children:(0,W.Z)("Page Tiling")}),(0,zn.jsx)("button",{ref:this._focusRef,className:Gn()("PageTiling-Button",{"button-on":"row"===this.state.tileMode}),title:(0,W.Z)("tooltip","Tile vertically"),onKeyDown:this.keyDownHandler,onMouseUp:this.setTiling,value:"row",dangerouslySetInnerHTML:{__html:Kn.Dx_[this.props.size]+(0,W.Z)("option","Tile Vertically")},style:{"--displayTileColumn":0,"--displayTileRow":1,"--displayUntiled":0}}),(0,zn.jsx)("button",{className:Gn()("PageTiling-Button",{"button-on":"column"===this.state.tileMode}),title:(0,W.Z)("tooltip","Tile horizontally"),onKeyDown:this.keyDownHandler,onMouseUp:this.setTiling,value:"column",dangerouslySetInnerHTML:{__html:Kn.Dx_[this.props.size]+(0,W.Z)("option","Tile Horizontally")},style:{"--displayTileColumn":1,"--displayTileRow":0,"--displayUntiled":0}}),(0,zn.jsx)("button",{className:Gn()("PageTiling-Button",{"button-on":"grid"===this.state.tileMode}),title:(0,W.Z)("tooltip","Tile to grid"),onKeyDown:this.keyDownHandler,onMouseUp:this.setTiling,value:"grid",dangerouslySetInnerHTML:{__html:Kn.Dx_[this.props.size]+(0,W.Z)("option","Tile to Grid")},style:{"--displayTileColumn":1,"--displayTileRow":1,"--displayUntiled":0}}),(0,zn.jsx)("button",{className:"PageTiling-Button",title:(0,W.Z)("tooltip","Untile tabs"),disabled:!this.state.tileMode,onKeyDown:this.keyDownHandler,onMouseUp:this.untile,value:"none",dangerouslySetInnerHTML:{__html:Kn.Dx_[this.props.size]+(0,W.Z)("option","Untile Tabs")},style:{"--displayTileColumn":0,"--displayTileRow":0}})]})}}const wv=Cv;var yv=s(8074);class xv extends Un.PureComponent{static contextType=oi.Z;loadBlockedContent=()=>{const e=af.Z.getActiveWebView(this.context.vivaldiWindowId);e&&e.allowBlockedInsecureContent(),yv.Z.resetPageHasBlockedContent(this.props.pageId)};allowCookiesContent=()=>{const e=new URL(this.props.url).origin;re.Z.utilities.setContentSettings({type:"cookies",primaryPattern:"*",secondaryPattern:e,value:"allow",incognito:!1}),yv.Z.resetPageHasBlockedContent(this.props.pageId)};openManageCookies=()=>{ue.Z.showSettings(this.context.vivaldiWindowId,"privacy",{scroll:"cookies"})};render(){const e=new URL(this.props.url).origin;return(0,zn.jsxs)("div",{tabIndex:"0",className:"addressfield-popup",children:[(0,zn.jsxs)("header",{className:"addressfield-popup-header blocked-content",children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.W4h.small}}),(0,zn.jsx)("h1",{id:"popup-label-contentblocker2",children:(0,W.Z)("Blocked Content")})]}),(0,zn.jsx)("div",{className:"addressfield-popup-content blocked-content",children:(()=>{let t=(0,qe.D5)();this.props.blockedPageContent.map((e=>{let s=t.get(e);t=s?t.set(e,++s):t.set(e,1)}));const s=[];for(const[n,i]of t)switch(n){case"ads":s.push((0,zn.jsx)("div",{className:"blocked-section",children:(0,W.Z)("Advertisements on this page are flagged as abusive and blocked.")},n));break;case"cookies":s.push((0,zn.jsxs)("div",{className:"blocked-section",children:[(0,W.Z)("$1 cookie is blocked","$1 cookies are blocked",[i]),(0,zn.jsx)("div",{className:"clickable",onClick:this.allowCookiesContent,children:(0,W.Z)("Allow third-party cookies for “$1”",[e])})]},n));break;case"javascript":s.push((0,zn.jsx)("div",{className:"blocked-section",children:(0,W.Z)("JavaScript has been blocked.")},n));break;case"mixed-script":s.push((0,zn.jsxs)("div",{className:"blocked-section",children:[(0,W.Z)("$1 unsafe resource is blocked","$1 unsafe resources are blocked",[i]),(0,zn.jsx)("div",{className:"clickable",onClick:this.loadBlockedContent,children:(0,W.Z)("Load the unsafe resource","Load the unsafe resources",[i])})]},n));break;case"autoplay":s.push((0,zn.jsx)("div",{className:"blocked-section",children:(0,W.Z)("Autoplay of video content has been blocked.")},n));break;case"images":s.push((0,zn.jsx)("div",{className:"blocked-section",children:(0,W.Z)("Image loading has been blocked.")},n));break;default:console.warn("Unhandled blocked content $1",n)}return s})()}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[this.props.blockedPageContent.includes("cookies")&&(0,zn.jsx)("input",{type:"button",onClick:this.openManageCookies,value:(0,W.Z)("Manage Cookies")}),(0,zn.jsx)("input",{type:"button",onClick:this.props.onPopupClosed,value:(0,W.Z)("Close")})]})]})}}const Iv=xv;class Av extends Un.Component{state={popupVisible:!1};onTogglePopupOpen=e=>{e.preventDefault(),this.setState((e=>({popupVisible:!e.popupVisible})))};onClosePopup=()=>{this.setState({popupVisible:!1})};render(){return(0,zn.jsx)(oa.ZP,{image:Kn.W4h.small,label:(0,W.Z)("Content Blocker"),tooltip:(0,W.Z)("Content has been blocked."),onClick:this.onTogglePopupOpen,popupPosition:this.props.position,className:"button-toolbar button-addressfield permission-popup is-blocking",hidePopup:this.onClosePopup,isPopupVisible:this.state.popupVisible,popupClassName:"addressfield-popup-container",popupLabelledBy:"popup-label-contentblocker2",popupWidth:240,children:(0,zn.jsx)(Iv,{pageId:this.props.pageId,url:this.props.url,onPopupClosed:this.onClosePopup,blockedPageContent:this.props.blockedPageContent})})}}const Sv=Av;function Zv(e){const t=Un.useContext(oi.Z);return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("div",{className:"ContentBlocker-Field info",children:[(0,zn.jsx)("p",{children:(0,W.Z)("Vivaldi allows a minimal selection of trackers to load, for a limited time after clicking an ad in a partner search engine results. This is to ensure correct ad attribution so that Vivaldi earns revenue from our partnerships.")}),(0,zn.jsx)("p",{children:(0,zn.jsx)("a",{tabIndex:e.tabIndex,href:"",onClick:()=>{c.ZP.openURL(t.vivaldiWindowId,"https://vvld.in/ad-attribution-description-dialog"),e.hidePopup()},children:(0,W.Z)("More about Ad Attribution")})})]}),(0,zn.jsxs)("div",{className:"ContentBlocker-Blocked",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Blocking Exceptions")}),(0,zn.jsx)("ul",{className:"domain-wrapper",children:e.domains.map(((e,t)=>(0,zn.jsx)("li",{title:e,children:(0,zn.jsx)("span",{children:e})},`ad-attribution-${t}`)))})]}),(0,zn.jsx)("div",{className:"ContentBlocker-Field",children:(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("verb","Back"),onClick:()=>e.hideAdAttribution()})})]})}const Tv=Un.memo(Zv);var Ev=s(19626);const kv=" "+(0,W.Z)("(Default)"),Nv=["tracking","ad_blocking"],_v="https://vivaldi.com/blog/vivaldi-business-model/",Pv=["vivaldi.com","vivaldi.net"],Mv=[];var Dv=(0,zn.jsx)("br",{}),Ov=(0,zn.jsx)("span",{className:"keep-ea-words",children:kv}),jv=(0,zn.jsx)("span",{className:"keep-ea-words",children:kv}),Lv=(0,zn.jsx)("span",{className:"keep-ea-words",children:kv}),Rv=(0,zn.jsx)(aa,{type:"close"});class Bv extends Un.PureComponent{static contextType=oi.Z;buttonStyle={"--no-blocking":0,"--trackers":0,"--blocking":0,"--ads":0,"--base":1};state={adBlockingEnabled:!1,trackerBlockingEnabled:!1,isBlockingAds:!1,isBlockingTrackers:!1,isExemptByPartnerURL:!1,partnerName:"",blockedTrackerList:void 0,blockedAdList:void 0,showBlockedTrackers:!1,showBlockedAds:!1,popupOpen:!1,ruleSourceReady:!1,animateBlocking:!1,adAttributionTrackers:[],showAdAttributionView:!1};constructor(e){super(e),this.state={adBlockingEnabled:!1,trackerBlockingEnabled:!1,isBlockingAds:!1,isBlockingTrackers:!1,isExemptByPartnerURL:!1,partnerName:"",blockedTrackerList:void 0,blockedAdList:void 0,showBlockedTrackers:!1,showBlockedAds:!1,popupOpen:!1,ruleSourceReady:!1,animateBlocking:!1,adAttributionTrackers:[],showAdAttributionView:!1}}componentDidMount(){this._isMounted=!0,this.getRules(),this.updateSources(),this.updateBlockingState(),re.Z.contentBlocking.onStateChanged.addListener(this.getRules),re.Z.contentBlocking.onUrlsBlocked.addListener(this.updateBlocked),re.Z.contentBlocking.onExceptionsChanged.addListener(this.getRules),re.Z.contentBlocking.onRuleSourceUpdated.addListener(this.updateSources),re.Z.contentBlocking.onRuleSourceEnabled.addListener(this.updateSources),re.Z.contentBlocking.onRuleSourceDisabled.addListener(this.updateSources),re.Z.contentBlocking.onAdAttributionDomainChanged.addListener(this.getAdAttributionDomain),re.Z.contentBlocking.onAdAttributionTrackersAllowed.addListener(this.getAdAttributionTrackers),n.Z.webNavigation.onCommitted.addListener(this.updateBlockingState)}componentDidUpdate(e){this.props.url!==e.url&&(this.setState({blockedTrackerList:void 0,blockedAdList:void 0}),this.updateBlockingState())}componentWillUnmount(){this._isMounted=!1,re.Z.contentBlocking.onStateChanged.removeListener(this.getRules),re.Z.contentBlocking.onUrlsBlocked.removeListener(this.updateBlocked),re.Z.contentBlocking.onExceptionsChanged.removeListener(this.getRules),re.Z.contentBlocking.onRuleSourceUpdated.removeListener(this.updateSources),re.Z.contentBlocking.onRuleSourceEnabled.removeListener(this.updateSources),re.Z.contentBlocking.onRuleSourceDisabled.removeListener(this.updateSources),re.Z.contentBlocking.onAdAttributionDomainChanged.removeListener(this.getAdAttributionDomain),re.Z.contentBlocking.onAdAttributionTrackersAllowed.removeListener(this.getAdAttributionTrackers),n.Z.webNavigation.onCommitted.removeListener(this.updateBlockingState)}getAdAttributionDomain=e=>{this.getAdAttributionTrackers([e])};getAdAttributionTrackers=e=>{re.Z.contentBlocking.getAdAttributionAllowedTrackers(e,(e=>{const t=e[0]?.tracker_urls??Mv;this.state.adAttributionTrackers!==t&&this.setState({adAttributionTrackers:t})}))};getRules=()=>Nv.forEach((e=>(0,Ev.pg)(e,(t=>this.setState(t,(()=>this.updateException(e)))))));getHostname=e=>{let t="";try{t=new URL(e||this.props.url).hostname}catch(e){}return t.startsWith("www.")?t.substring(4):t};getIconUrl=()=>{const{url:e}=this.props;return vs.jk.getFavicon(e)??e};getRootDomain=e=>{const t=this.getHostname(e).split(".");return t.length>=2?`${t[t.length-2]}.${t[t.length-1]}`:""};isOnVivaldiDomain=e=>{const t=this.getRootDomain(this.props.url);return Pv.includes(t)};togglePopup=()=>this.setState((e=>({popupOpen:!e.popupOpen})));hidePopup=()=>this.setState({popupOpen:!1,showAdAttributionView:!1});showSettings=()=>{this.togglePopup(),ue.Z.showSettings(this.context.vivaldiWindowId,"privacy",{scroll:"tracker_and_ad_blocking"})};getActiveExceptionList=e=>{const t="tracking"===e?"trackerBlockingEnabled":"adBlockingEnabled";return this.state[t]?"exempt_list":"process_list"};updateBlockingState=()=>{Nv.forEach((e=>{this.updateException(e),this.updateBlocked(e,[this.props.pageId])})),this.getAdAttributionTrackers([this.props.pageId])};updateException=e=>{re.Z.contentBlocking.isExemptOfFiltering(e,this.props.url,(t=>{this._isMounted&&("tracking"===e?this.setState({isBlockingTrackers:!t}):this.setState({isBlockingAds:!t}))})),this.isOnVivaldiDomain()?this.setState({isExemptByPartnerURL:!1,partnerName:""}):re.Z.contentBlocking.isExemptByPartnerURL(this.props.url,this.props.pageId,(e=>{this._isMounted&&this.setState({isExemptByPartnerURL:e.status,partnerName:e.name})}))};updateSources=()=>Nv.forEach((e=>{re.Z.contentBlocking.getRuleSources(e,(e=>{this._isMounted&&(e.find((e=>""!==e.rules_list_checksum))?this.setState({ruleSourceReady:!0}):this.setState({ruleSourceReady:!1}))}))}));updateBlocked=(e,t)=>{const{trigger:s}=cg.getNavigationInfo(this.props.pageId);this.setState({animateBlocking:"stop"!==s});const n="tracking"===e?"blockedTrackerList":"blockedAdList";t.includes(this.props.pageId)&&re.Z.contentBlocking.getBlockedUrlsInfo(e,[this.props.pageId],(e=>{this._isMounted&&this.setState({[n]:e[0]})}))};setPageBlocking=e=>{const t=e.currentTarget.value,s=0+(this.state.trackerBlockingEnabled?1:0)+(this.state.adBlockingEnabled?1:0),n=this.getHostname();(0,Ev.fs)(n,t,this.props.pageId,s)};handleHidePartnerInfo=e=>{const t=(new Date).valueOf();I.Z.set(Z.kPrivacyPartnersExceptionsDismissed,t)};handlePartnerExceptionURLClick=e=>{c.ZP.openURL(this.context.vivaldiWindowId,u.e9),this.setState({popupOpen:!1})};handleExpandClick=(e,t)=>{t.preventDefault(),"tracking"===e?this.setState((e=>({showBlockedTrackers:!e.showBlockedTrackers}))):this.setState((e=>({showBlockedAds:!e.showBlockedAds})))};renderBlocked=e=>{if(!this.props.blockerVisible)return null;if(!(this.state.showBlockedTrackers&&"tracking"===e||this.state.showBlockedAds&&"ad_blocking"===e))return null;const t="tracking"===e?this.state.blockedTrackerList:this.state.blockedAdList;if(!t)return null;const s=t.blocked_urls_info.slice(0).reduce(((e,t)=>{const s=this.getHostname(t.url);return e[s]=(e[s]||0)+t.blocked_count,e}),{});for(const e of t.blocked_trackers_info){const t=e.domain;s[t]=(s[t]||0)+e.blocked_count}return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("h3",{children:"tracking"===e?(0,W.Z)("Tracker detail","Tracker details",[t.total_blocked_count]):(0,W.Z)("Ad detail","Ad details",[t.total_blocked_count])}),(0,zn.jsx)("ul",{children:Object.keys(s).sort(((e,t)=>s[e]>s[t]?-1:1)).map((e=>(0,zn.jsxs)("li",{children:[(0,zn.jsx)("span",{children:e}),(0,zn.jsx)("span",{children:s[e]})]},e)))})]})};getButtonStyle=(e,t,s,n,i,a)=>({"--base":t&&0===s?0:1,"--no-blocking":!e&&t&&0===s?1:0,"--trackers":t&&1===s&&!a?1:0,"--ads":t&&2===s&&!a?1:0,"--blocking":a?1:0,"--total":a});openPrivacyStatisticsDialog(){this.hidePopup(),ue.Z.showPrivacyStatsDialog(this.context.vivaldiWindowId)}getCurrentLevel=()=>{const{isBlockingTrackers:e,isBlockingAds:t}=this.state;return(e?1:0)+(t?1:0)};handleReportButton=()=>{const e=this.getCurrentLevel()?"AdBlock":"TrackerBlock",t=encodeURIComponent(this.getHostname()),s=[`${u.EA}?project=VB&&type=normal`,`&bugUrl=${t}`,`&summary=%5B${e}%5D+Site+issue+on+${t}`].join("");c.ZP.openURL(this.context.vivaldiWindowId,s,{singleton:!0}),this.hidePopup()};openExceptionHelp=()=>{c.ZP.openURL(this.context.vivaldiWindowId,_v,{singleton:!0}),this.hidePopup()};render(){const{ruleSourceReady:e,trackerBlockingEnabled:t,isBlockingTrackers:s,isExemptByPartnerURL:n,partnerName:i,blockedTrackerList:a,adBlockingEnabled:o,isBlockingAds:r,blockedAdList:l,animateBlocking:d}=this.state,{blockerVisible:c,tabIndex:h}=this.props,p=0+(t?1:0)+(o?1:0),g=this.getCurrentLevel(),m=a||l,f=a?.total_blocked_count??0,v=l?.total_blocked_count??0,b=f+v,C=!this.props.exceptionDismissed,w=[];return e?(s&&w.push(u.YV+(0,W.Z)("Tracker Blocking Active ($1)",[f])),r&&w.push(u.YV+(0,W.Z)("Ad Blocking Active ($1)",[v]))):w.push((0,W.Z)("Blocking is inactive due to missing or disabled rule lists")),(0,zn.jsxs)(oa.ZP,{buttonStyle:this.getButtonStyle(Boolean(m),c,g,s,r,b),label:(0,W.Z)("Content Blocker"),tooltip:b?(0,W.Z)("Blocked $1 Items",[b]):(0,W.Z)("Content Blocker"),tooltipExtra:w.join("\n"),onClick:this.togglePopup,image:Kn.Tu3,hidePopup:this.hidePopup,popupPosition:this.props.position,popupWidth:300,popupClassName:"ContentBlocker ToolbarButtonPopup-DefaultStyles",popupLabelledBy:"popup-label-contentblocker",className:Gn()("ContentBlocker-Control",{"ContentBlocker-Control--Active":d}),isPopupVisible:this.state.popupOpen,children:[(0,zn.jsxs)("div",{className:"ContentBlocker-Header",children:[(0,zn.jsx)("div",{className:"favicon",children:(0,zn.jsx)(Vn.ZP,{url:this.getIconUrl(),loadType:"page"})}),(0,zn.jsxs)("div",{id:"popup-label-contentblocker",children:[c?(0,W.Z)("Blocking Level on"):(0,W.Z)("Content Blocker"),Dv,c?(0,zn.jsx)("strong",{children:this.getHostname()}):null]})]}),(0,zn.jsxs)("div",{className:"content-wrapper",children:[(0,zn.jsxs)("div",{className:"dialog-content",style:{transform:`translateX(${this.state.showAdAttributionView?-300:0}px)`,maxHeight:this.state.showAdAttributionView?0:"unset",visibility:this.state.showAdAttributionView?"hidden":"unset"},children:[c&&(0,zn.jsxs)("div",{className:"ContentBlocker-Field",children:[(0,zn.jsxs)("button",{tabIndex:h,className:Gn()({"ContentBlocker-Label":!0,"ContentBlocker-Label--Active":0===g}),value:"0",onClick:this.setPageBlocking,children:[(0,zn.jsx)("span",{className:"ContentBlocker-Label-Icon",dangerouslySetInnerHTML:{__html:Kn.Tu3},style:{"--no-blocking":1,"--base":0}}),(0,zn.jsxs)("span",{className:"ContentBlocker-Label-Text",children:[(0,W.Z)("No Blocking"),0===p&&Ov]})]}),(0,zn.jsxs)("button",{tabIndex:h,className:Gn()({"ContentBlocker-Label":!0,"ContentBlocker-Label--Active":1===g}),value:"1",onClick:this.setPageBlocking,children:[(0,zn.jsx)("span",{className:"ContentBlocker-Label-Icon",style:{"--trackers":"1"},dangerouslySetInnerHTML:{__html:Kn.Tu3}}),(0,zn.jsxs)("span",{className:"ContentBlocker-Label-Text",children:[(0,W.Z)("Block Trackers"),1===p&&jv]})]}),(0,zn.jsxs)("button",{tabIndex:h,className:Gn()({"ContentBlocker-Label":!0,"ContentBlocker-Label--Active":2===g}),value:"2",onClick:this.setPageBlocking,children:[(0,zn.jsx)("span",{className:"ContentBlocker-Label-Icon",style:{"--ads":"1"},dangerouslySetInnerHTML:{__html:Kn.Tu3}}),(0,zn.jsxs)("span",{className:"ContentBlocker-Label-Text",children:[(0,W.Z)("Block Trackers and Ads"),2===p&&Lv]})]})]}),m&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("div",{className:"ContentBlocker-Counter",children:[s&&(0,zn.jsxs)("div",{className:"ContentBlocker-Counter--Block",onClick:this.handleExpandClick.bind(null,"tracking"),children:[(0,zn.jsx)("div",{className:"ContentBlocker-Counter--Number",children:f}),(0,zn.jsx)("p",{children:(0,W.Z)("Tracker Blocked","Trackers Blocked",[f])})]}),r&&(0,zn.jsxs)("div",{className:"ContentBlocker-Counter--Block",onClick:this.handleExpandClick.bind(null,"ad_blocking"),children:[(0,zn.jsx)("div",{className:"ContentBlocker-Counter--Number",children:v}),(0,zn.jsx)("p",{children:(0,W.Z)("Ad Blocked","Ads Blocked",[v])})]})]}),(0,zn.jsxs)("div",{className:"ContentBlocker-Blocked",children:[a&&this.renderBlocked("tracking"),l&&this.renderBlocked("ad_blocking")]})]}),this.state.adAttributionTrackers.length>0&&(0,zn.jsx)("div",{className:"blocking-exception-wrapper",onClick:()=>this.setState({showAdAttributionView:!0}),children:(0,zn.jsx)("p",{children:(0,W.Z)("$1 Blocking Exception","$1 Blocking Exceptions",[this.state.adAttributionTrackers.length])})}),C&&n&&g>0&&(0,zn.jsxs)("div",{className:"ContentBlocker-Info",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Ads in Search Results")}),(0,zn.jsx)("p",{children:i?(0,W.Z)("Vivaldi has partnered with $1 to not block ads on this page. These ads help fund the development of Vivaldi.",[i]):(0,W.Z)("We have a partnership with this site and exempt ads in the search result from being blocked by default. These ads generate revenue for Vivaldi if you interact with them.")}),(0,zn.jsx)("p",{children:(0,zn.jsx)("a",{href:"",title:_v,onClick:this.openExceptionHelp,children:(0,W.Z)("Read more about Blocking Exceptions")})}),(0,zn.jsx)("button",{className:"ContentBlocker-Close",onClick:this.handleHidePartnerInfo,children:(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.kze}})})]}),A.Z.get(Z.kAddressBarShowBlockerWarning)&&c&&m&&(s||r)&&(0,zn.jsxs)("div",{className:"ContentBlocker-Info",children:[(0,zn.jsx)("p",{children:(0,W.Z)("If the page appears broken, try turning off blocking and extensions.")}),(0,zn.jsx)("p",{children:(0,zn.jsx)("a",{href:"",title:u.EA,onClick:this.handleReportButton,children:(0,W.Z)("Report a page problem.")})}),(0,zn.jsx)("button",{className:"ContentBlocker-Close",onClick:()=>{I.Z.set(Z.kAddressBarShowBlockerWarning,!1),this.forceUpdate()},children:Rv})]}),(0,zn.jsxs)("div",{className:"ContentBlocker-Field",children:[(0,zn.jsx)("button",{className:"privacy-btn-icon",onClick:()=>this.openPrivacyStatisticsDialog(),title:(0,W.Z)("Show Privacy Statistics"),dangerouslySetInnerHTML:{__html:Kn.vh3+(0,W.Z)("Show privacy Statistics")}}),(0,zn.jsx)("input",{type:"button",onClick:this.showSettings,value:(0,W.Z)("Manage Default Settings"),autoFocus:0===h})]})]}),this.state.adAttributionTrackers.length>0&&(0,zn.jsx)("div",{className:"dialog-content",style:{transform:`translateX(${this.state.showAdAttributionView?-300:0}px)`,maxHeight:this.state.showAdAttributionView?"unset":0,visibility:this.state.showAdAttributionView?"unset":"hidden"},children:(0,zn.jsx)(Tv,{domains:this.state.adAttributionTrackers,hideAdAttribution:()=>this.setState({showAdAttributionView:!1}),hidePopup:this.hidePopup,tabIndex:h})})]})]})}}const Fv=Bv;var Wv=s(58848);const Uv={loadedBytes:1,loadedElements:1,progress:1,totalElements:1,url:"",isFetching:!1};class Vv extends Vo.Z{_progressInfo=new qe.D5;getProgressInfo(e){const t=this._progressInfo.get(e);return t||Uv}emitChange=(0,Wv.Z)((()=>{super.emitChange()}),250);dispatchAction(e){switch(e.actionType){case"NAVIGATION_SET_STATE":{const{pageId:t,navigationState:s}=e;switch(s.trigger){case"start":{const e=this._progressInfo.get(t);e&&this._setProgressState({...e,isFetching:!0},t)}break;case"stop":case"abort":this._setProgressState(Uv,t);break;case"commit":{const e=this._progressInfo.get(t);e&&this._setProgressState({...e,isFetching:!1},t)}}break}case"PAGE_SET_PROGRESS":{const{pageId:t,progressState:s}=e;this._setProgressState(s,t);break}case"PAGE_CLOSE":this._removeProgressState(e.pages)}}_setProgressState(e,t){const s=this._progressInfo.get(t);e!==s&&(s?(e.progress<s.progress&&(e={...e,progress:s.progress}),void 0===e.totalElements&&(e={...e,totalElements:s.totalElements}),void 0===e.loadedElements&&(e={...e,loadedElements:s.loadedElements})):e={...e,isFetching:!0},e.totalElements<1&&(e={...e,totalElements:1}),this._progressInfo=this._progressInfo.set(t,e),this.emitChange())}_removeProgressState(e){e.forEach((e=>{this._progressInfo.has(e.id)&&(this._progressInfo=this._progressInfo.remove(e.id),this.emitChange())}))}}const Hv=new Vv(S.Z),Gv={bytes:0,bytesDisplayed:0,currentPageId:null,elLoaded:0,elLoadedDisplayed:0,elTotal:1,isProgressing:!1,isStarted:!1,progress:0,stopped:!1,pageloadTicker:""},Kv=[Z.kAddressBarShowProgress,Z.kBiscuitRainbowProgress,Z.kThemeUseAnimation];class zv extends Un.PureComponent{static contextType=oi.Z;_isMounted=!1;state=Gv;componentDidMount(){this._isMounted=!0,cg.addListener(this._onNavigationStoreChanged,(e=>e.get(this.props.pageId)?.navigationInfo.trigger)),Hv.addListener(this._onProgressStateStoreChanged),Ca.Z.addListener(this._onWebpageviewStoreChanged)}componentWillUnmount(){clearTimeout(this._updateTimer),this._isMounted=!1,cg.removeListener(this._onNavigationStoreChanged),Hv.removeListener(this._onProgressStateStoreChanged),Ca.Z.removeListener(this._onWebpageviewStoreChanged)}componentDidUpdate(e,t){const s=this.props.pageId;if(s!==t.currentPageId){const e=Hv.getProgressInfo(this.props.pageId),{progress:t=0,loadedBytes:n=0,loadedElements:i=0,totalElements:a=1}=e||{};let o={};o=0===t||1===t||void 0===t?{...Gv,currentPageId:s}:{...Gv,currentPageId:s,progress:t,bytes:n,elLoaded:i,elTotal:a},this._onUpdateProgressState(o)}}_onUpdateProgressState=e=>{this.setState(e)};_onNavigationStoreChanged=()=>{this._onProgressStateStoreChanged()};_onProgressStateStoreChanged=()=>{const e=this.props.pageId,t=Ze.ZP.getPageById(e);if(t){const e=t.url;if((0,Ar.xl)(e))return}const s=Hv.getProgressInfo(e),{trigger:n}=cg.getNavigationInfo(e),{progress:i=0,loadedBytes:a=0,loadedElements:o=0,totalElements:r=1}=s||{};"start"===n?this.setState({...Gv,currentPageId:e,isProgressing:!0,isStarted:!0}):"stop"===n?this.setState((e=>({isProgressing:!1,...e.stopped&&{}||{progress:1}}))):"commit"!==n||this.state.stopped||(this.setState({bytes:a,elLoaded:o,elTotal:r,isProgressing:!0,isStarted:!0,progress:i}),this.updateCount())};_onWebpageviewStoreChanged=e=>{e.pageId===this.props.pageId&&"WEBPAGEVIEW_STOP"===e.type&&1!==this.state.progress&&this.setState({isProgressing:!1,stopped:!0})};getIncrement=(e,t)=>{const s=t-e;let n=0;return s>10?n=Math.floor(s/5):s>4?n=2:s>0&&(n=1),e+n};updateCount=()=>{if(clearTimeout(this._updateTimer),!this._isMounted)return;const e=this.state.bytes,t=this.state.bytesDisplayed,s=this.state.elLoadedDisplayed;let n=this.state.elLoaded;1===this.state.progress&&n<this.state.elTotal&&(n=this.state.elTotal);const i=this.getIncrement(t,e),a=this.getIncrement(s,n);!1===this.props.prefValues[Z.kThemeUseAnimation]?this.setState({elLoadedDisplayed:n,bytesDisplayed:e}):(n>s&&this.setState({elLoadedDisplayed:a}),e>t&&this.setState({bytesDisplayed:i}),!this.state.stopped&&(n>a||e>i)&&(this._updateTimer=setTimeout(this.updateCount,80)));const o=e>1048576?1:0,r=(0,iu.Z)(e,o);e>0&&this.setState({pageloadTicker:r})};render(){if(!this.props.open||isNaN(this.state.progress))return null;const e=this.state.progress,t=this.state.elLoadedDisplayed,s=this.state.elTotal,n=this.state.isProgressing,i=this.state.isStarted,a=!0===this.state.stopped,o=Gn()({pageload:!0,unstarted:!i,progressing:n,"progress-done":1===e||a,stopped:a});return(0,zn.jsxs)("div",{className:o,children:[this.props.prefValues[Z.kAddressBarShowProgress]&&(0,zn.jsx)("progress",{className:Gn()("pageload-indicator",{rainbow:this.props.prefValues[Z.kBiscuitRainbowProgress]}),value:100*this.state.progress,max:100}),(0,zn.jsx)("div",{className:"pageload-ticker",children:this.state.pageloadTicker}),(0,zn.jsx)("div",{className:"pageload-ticker",children:t+"/"+s})]})}}const $v=(0,zd.Z)(zv,Kv);class Yv extends Un.PureComponent{openSettings=()=>{re.Z.utilities.openOSGeolocationSettings(),this.props.onDialogClosed()};render(){return(0,zn.jsxs)("section",{className:"addressfield-popup system-location-service",children:[(0,zn.jsxs)("section",{className:"dialog-content",children:[(0,zn.jsx)("h1",{children:(0,W.Z)("Location Services")}),(0,zn.jsx)("p",{children:(0,W.Z)("Vivaldi needs your permission to access system Location Services.")})]}),(0,zn.jsx)("section",{className:"dialog-footer",children:(0,zn.jsx)("input",{type:"button",className:"primary",onClick:this.openSettings,value:(0,W.Z)("Open System Settings"),autoFocus:!0})})]})}}const Xv=Yv,Qv=({onDialogClosed:e,onChange:t})=>(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("input",{type:"button",className:"primary",onClick:e,value:(0,W.Z)("OK"),autoFocus:!0}),(0,zn.jsx)("input",{type:"button",onClick:t,value:(0,W.Z)("Change")})]}),qv=(0,Gm.Z)("input");class Jv extends Un.PureComponent{allow=()=>{this.props.onPermissionClicked(!1)};deny=()=>{this.props.onPermissionClicked(!0)};renderAllowDenyQuery=()=>{const e=this.props.renderNotice?this.props.renderNotice():null;return(0,zn.jsxs)(zn.Fragment,{children:[e,(0,zn.jsx)(qv,{type:"button",onClick:this.allow,value:(0,W.Z)("command","Allow")}),(0,zn.jsx)("input",{type:"button",className:"primary",onClick:this.deny,value:(0,W.Z)("Deny"),autoFocus:!0})]})};render(){return(0,zn.jsxs)("section",{className:"addressfield-popup",children:[(0,zn.jsxs)("header",{className:"addressfield-popup-header",children:[this.props.image&&(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:this.props.image}}),(0,zn.jsx)("h1",{id:"popup-label-permissionprompt",children:this.props.message})]}),(0,zn.jsx)("section",{className:"dialog-footer",children:!1===this.props.isDecided?this.renderAllowDenyQuery():(0,zn.jsx)(Qv,{onDialogClosed:this.props.onDialogClosed,onChange:this.props.onSettingsClicked})})]})}}const eb=Jv;var tb=s(60203),sb=s(63608);function nb(e){const t=Object.keys(sb._).find((t=>sb._[t].path===e));return t?sb._[t].label:""}function ib(e){const t=Object.keys(sb._).find((t=>sb._[t].path===e));return t?sb._[t].icon:""}class ab extends Un.PureComponent{changePermission=async e=>{const{name:t,value:s}=e.target;await re.Z.utilities.setDefaultContentSettings(t,s),this.props.reloadPermissions()};resetToDefaults=()=>{Object.keys(sb._).forEach((e=>{re.Z.utilities.setDefaultContentSettings(e,sb._[e].default,nr.Z)})),this.props.reloadPermissions()};render(){const{filter:e,permissionList:t}=this.props;return(0,zn.jsx)(tb.Z,{filter:e,children:(0,zn.jsxs)("div",{className:"detail",children:[(0,zn.jsxs)("div",{className:"detail-content",children:[(0,zn.jsx)("h3",{children:sb.w["Global Website Permissions"]}),Object.keys(t).map((e=>(0,zn.jsxs)("label",{title:sb._[e].description,children:[(0,zn.jsx)("span",{className:"icon",dangerouslySetInnerHTML:{__html:sb._[e].icon}}),(0,zn.jsx)("span",{children:sb._[e].label}),(0,zn.jsxs)(Fa.Z,{value:t[e],onChange:this.changePermission,name:e,children:[!1!==sb._[e].exceptions?.allow&&!1!==sb._[e].exceptions?.globalAllow&&(0,zn.jsx)("option",{value:"allow",children:sb.w.Allow}),(sb._[e].exceptions?.ask||!1===sb._[e].exceptions?.allow)&&"cookies"!==e&&(0,zn.jsx)("option",{value:"ask",children:sb.w.Ask}),"cookies"===e&&(0,zn.jsx)("option",{value:"session_only",children:sb.w["Session Only"]}),(0,zn.jsx)("option",{value:"block",children:sb.w.Block})]})]},e)))]}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)("input",{type:"button",value:sb.w["Reset Global Permissions"],onClick:this.resetToDefaults})})]})})}}const ob=ab,rb=["protocol_handling","durablestorage"];function lb(e){switch(e){case"camera":case"microphone_and_camera":case"videocapture":return ib("media_stream_camera");case"geolocation":return ib("geolocation");case"audiocapture":case"microphone":return ib("media_stream_mic");case"backgroundsync":return ib("background_sync");case"midi":case"midi-sysex":return ib("midi_sysex");case"idle_detection":return ib("idle_detection");case"javascript":return ib("javascript");case"pushmessaging":return ib("notifications");case"protocol_handling":return Kn.mU8.small;default:return ib(e)}}class db extends Un.PureComponent{static contextType=oi.Z;state={isDialogOpen:"undecided"===this.props.permission.state&&!this.props.permission?.suppressedPrompt,icon:lb(this.props.permissionType),requestOSSettings:!1};async componentDidUpdate(e,t){const{permissionType:s,permission:n}=this.props;"geolocation"===s&&"allowed"!==e.permission.state&&"allowed"===n.state&&await this.maybeShowOSGeolocationHelp()}onNotificatorClicked=async()=>{const{permissionType:e,permission:t}=this.props;if("allowed"===t.state&&"geolocation"===e){if(await this.maybeShowOSGeolocationHelp())return Promise.resolve()}return this.setState((e=>({isDialogOpen:!e.isDialogOpen,requestOSSettings:!1}))),Promise.resolve()};maybeShowOSGeolocationHelp=async()=>(this.state.isDialogOpen,!1);onDialogClosed=()=>{if(this.state.requestOSSettings);else{const{permissionType:e,permission:t}=this.props;"protocol_handling"===e&&"undecided"===t.state&&this.onPermissionClicked(!0)}this.setState({isDialogOpen:!1,requestOSSettings:!1})};onPermissionClicked=e=>{const t=this.props.permission.requestEvent;if(t){!1===e?t.allow():t.deny();const s=this.props.permissionType;s&&yv.Z.setPermission(this.props.pageId,this.props.origin,s,t,e?"blocked":"allowed")}this.onDialogClosed()};onSettingsClicked=()=>{ue.Z.showSettings(this.context.vivaldiWindowId,"privacy",{permissionorigin:this.props.origin}),this.onDialogClosed()};getMessageText=()=>{const e="blocked"===this.props.permission.state,t="undecided"!==this.props.permission.state,s=this.props.origin,n=this.props.permission?.promptPermission,i=this.props.permissionType;if(!i)return"";if(t)if(e)switch(i){case"geolocation":return(0,W.Z)("Website “$1” has been denied location access.",[s]);case"notifications":return(0,W.Z)("Website “$1” has been denied showing notifications.",[s]);case"clipboard":return(0,W.Z)("Website “$1” has been denied accessing your clipboard.",[s]);case"camera":case"videocapture":return(0,W.Z)("Website “$1” has been denied access to your camera.",[s]);case"audiocapture":case"microphone":return(0,W.Z)("Website “$1” has been denied access to your microphone.",[s]);case"microphone_and_camera":return(0,W.Z)("Website “$1” has been denied access to your microphone and camera.",[s]);case"sensors":return(0,W.Z)("Website “$1” has been denied access to motion sensors.",[s]);case"idle_detection":return(0,W.Z)("Website “$1” has been denied access to idle detection.",[s]);case"javascript":return(0,W.Z)("Website “$1” has been denied running JavaScript.",[s]);case"midi":case"midi-sysex":return(0,W.Z)("Website “$1” has been denied access to MIDI devices.",[s]);case"protocol_handling":return(0,W.Z)("Website “$1” has been denied access to protocol handling.",[s])}else switch(i){case"geolocation":return(0,W.Z)("Website “$1” is accessing your location.",[s]);case"notifications":return(0,W.Z)("Website “$1” is authorized to show notifications.",[s]);case"clipboard":return(0,W.Z)("Website “$1” is accessing your clipboard.",[s]);case"camera":case"videocapture":return(0,W.Z)("Website “$1” is using your camera.",[s]);case"audiocapture":case"microphone":return(0,W.Z)("Website “$1” is recording with your microphone.",[s]);case"microphone_and_camera":return(0,W.Z)("Website “$1” is using your microphone and camera.",[s]);case"sensors":return(0,W.Z)("Website “$1” is using your motion sensors.",[s]);case"idle_detection":return(0,W.Z)("Website “$1” uses idle detection.",[s]);case"javascript":return(0,W.Z)("Website “$1” runs JavaScript.",[s]);case"midi":return(0,W.Z)("Website “$1” is using your MIDI devices.",[s]);case"midi-sysex":return(0,W.Z)("Website “$1” is using your MIDI devices (including SYSEX access).",[s]);case"protocol_handling":return(0,W.Z)("Website  “$1” is registered for protocol handling.",[s])}else switch(i){case"geolocation":return(0,W.Z)("Website “$1” would like to access your location.",[s]);case"notifications":return(0,W.Z)("Website “$1” would like to show notifications.",[s]);case"clipboard":return(0,W.Z)("Website “$1” would like to access your clipboard.",[s]);case"camera":case"videocapture":return(0,W.Z)("Website “$1” would like to use your camera.",[s]);case"audiocapture":case"microphone":return(0,W.Z)("Website “$1” would like to use your microphone.",[s]);case"microphone_and_camera":return(0,W.Z)("Website “$1” would like to use your microphone and camera.",[s]);case"sensors":return(0,W.Z)("Website “$1” would like to use motion sensors.",[s]);case"idle_detection":return(0,W.Z)("Website “$1” would like to use idle detection.",[s]);case"javascript":return(0,W.Z)("Website “$1” would like to use JavaScript.",[s]);case"midi":return(0,W.Z)("Website “$1” would like to use MIDI devices.",[s]);case"midi-sysex":return(0,W.Z)("Website “$1” would like to use MIDI devices, including SYSEX access.",[s]);case"protocol_handling":return(0,W.Z)("Allow “$1” to open all “$2” links?",[s,n??""])}return console.warn("Unknown permissiontype: "+i),i};_privacyNotice(){c.ZP.openURL(this.context.vivaldiWindowId,"https://vivaldi.com/privacy/browser/",{singleton:!0})}renderNotice=()=>"geolocation"===this.props.permissionType?(0,zn.jsx)("div",{className:"geo-notice",children:(0,zn.jsx)("a",{href:"",title:(0,W.Z)("Vivaldi Browser Privacy Policy"),onClick:e=>this._privacyNotice(),children:(0,W.Z)("Privacy Notice")})}):null;render(){const e="blocked"===this.props.permission.state,t="undecided"!==this.props.permission.state,{permissionType:s}=this.props;if(t&&rb.includes(s))return null;const n={"button-addressfield":!0,"permission-popup":!0,"is-allowing":!e&&t,"is-dialog-open":this.state.isDialogOpen};return(0,zn.jsxs)(oa.ZP,{tooltip:this.getMessageText(),onClick:this.onNotificatorClicked,image:this.state.icon,popupPosition:this.props.popupPosition,hidePopup:this.onDialogClosed,isPopupVisible:this.state.isDialogOpen,className:Gn()(n),popupClassName:"addressfield-popup-container",popupLabelledBy:"popup-label-permissionprompt",popupWidth:400,children:[this.state.requestOSSettings&&(0,zn.jsx)(Xv,{onDialogClosed:this.onDialogClosed}),!this.state.requestOSSettings&&(0,zn.jsx)(eb,{onPermissionClicked:this.onPermissionClicked,isDecided:t,onDialogClosed:this.onDialogClosed,onSettingsClicked:this.onSettingsClicked,image:this.state.icon,renderNotice:this.renderNotice,message:this.getMessageText()})]})}}const cb=db;class hb extends Un.PureComponent{_isPermissionUsage=e=>!e.requestEvent&&"undecided"!==e.state;mergeSortMicCamPermissions(e){const t=new Map(Array.from(e).sort((([e],[t])=>e>t?1:-1))),s=t.get("microphone"),n=t.get("camera"),i=t.get("microphone_and_camera");return s&&n&&this._isPermissionUsage(s)&&this._isPermissionUsage(n)&&!i?(t.delete("microphone"),t.delete("camera"),t.set("microphone_and_camera",s)):i&&this._isPermissionUsage(i)&&(s&&this._isPermissionUsage(s)&&t.delete("microphone"),n&&this._isPermissionUsage(n)&&t.delete("camera")),t}render(){if(!this.props.pagePermissions.size)return null;const e=[];return this.props.pagePermissions.forEach(((t,s)=>{this.mergeSortMicCamPermissions(t).forEach(((t,n)=>{e.push((0,zn.jsx)(cb,{pageId:this.props.pageId,permission:t,origin:s,permissionType:n,popupPosition:this.props.popupPosition},n))}))})),e}}class ub extends Un.Component{onBlockedPopupUrlClicked=(e,t)=>{t.preventDefault(),this.props.onPopupAllowed(e)};renderItem=e=>(0,zn.jsx)("a",{className:"popupblocker-blocked-page",onClick:this.onBlockedPopupUrlClicked.bind(this,e),title:e.targetUrl,href:e.targetUrl,children:e.targetUrl},e.targetUrl+e.timeStamp);renderItems=e=>(0,zn.jsx)("div",{className:"popupblocker-blocked-pages",children:Array.from(e,(e=>this.renderItem(e)))});onShouldBlockClicked=e=>{this.props.onShouldBlockClicked(e)};renderAlwaysBlockQuery=()=>(0,zn.jsxs)("section",{className:"dialog-footer",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"radio",name:"blocked",value:"false",defaultChecked:!1!==this.props.shouldBlockPopups,onChange:this.onShouldBlockClicked.bind(this,!0)}),(0,W.Z)("Block Popups")]}),(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"radio",name:"blocked",value:"true",defaultChecked:!1===this.props.shouldBlockPopups,onChange:this.onShouldBlockClicked.bind(this,!1)}),(0,W.Z)("Always Allow")]})]});render(){return this.props.blockedPopups.size>0?(0,zn.jsxs)("div",{tabIndex:"0",className:"addressfield-popup",children:[(0,zn.jsxs)("header",{className:"addressfield-popup-header",children:[this.props.image&&(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:this.props.image}}),(0,zn.jsx)("h1",{id:"popup-label-popupblocker",children:(0,W.Z)("Blocked Popups")})]}),(0,zn.jsx)("div",{className:"addressfield-popup-content",children:this.renderItems(this.props.blockedPopups)}),this.renderAlwaysBlockQuery()]}):null}}const pb=ub;class gb extends Un.Component{state={isDialogOpen:!1,shouldBlockPopups:!0};componentDidMount(){this.props.url&&n.Z.contentSettings.popups.get({primaryUrl:this.props.url},(e=>{n.Z.runtime.lastError&&n.Z.runtime.lastError.message&&console.warn("ERROR getting content settings for popups. Original message:\n"+n.Z.runtime.lastError.message)}))}onNotificatorClicked=()=>{this.setState((e=>({isDialogOpen:!e.isDialogOpen})))};onDialogClosed=()=>{this.setState({isDialogOpen:!1})};onShouldBlockClicked=e=>{const t={primary_pattern:this.props.url,secondary_pattern:this.props.url,type:"popups",setting:e?"block":"allow"};re.Z.settings.setContentSetting(t),this.setState({shouldBlockPopups:e})};render(){var e={"button-addressfield":!0,"permission-popup":!0,"is-blocking":!0===this.state.shouldBlockPopups,"is-allowing":!1===this.state.shouldBlockPopups,"is-dialog-open":this.state.isDialogOpen};return(0,zn.jsx)("div",{className:"button-toolbar",children:(0,zn.jsx)(oa.ZP,{tooltip:(0,W.Z)("Blocked Popup Pages"),onClick:this.onNotificatorClicked,image:Kn.nY6.small,popupPosition:this.props.popupPosition,hidePopup:this.onDialogClosed,isPopupVisible:this.state.isDialogOpen,className:Gn()(e),popupClassName:"addressfield-popup-container",popupLabelledBy:"popup-label-popupblocker",popupWidth:300,children:(0,zn.jsx)(pb,{image:Kn.nY6.medium,shouldBlockPopups:this.state.shouldBlockPopups,onShouldBlockClicked:this.onShouldBlockClicked,blockedPopups:this.props.blockedPopups,onPopupAllowed:this.props.onPopupAllowed})})})}}const mb=gb;class fb extends Un.PureComponent{state={popupVisible:!1};togglePopup=()=>{this.setState((e=>({popupVisible:!e.popupVisible})))};hidePopup=()=>{this.setState({popupVisible:!1})};render(){return(0,zn.jsx)(oa.ZP,{className:"create-qr-code",image:Kn.ERJ,label:(0,W.Z)("Page QR Code"),tooltip:(0,W.Z)("Share Page with QR Code"),onClick:this.togglePopup,popupPosition:this.props.popupPosition,hidePopup:this.hidePopup,isPopupVisible:this.state.popupVisible,popupClassName:"ToolbarButtonPopup-DefaultStyles",popupLabelledBy:"dialog-qrshare-title",popupWidth:Rd(this.props.data),size:this.props.size,commandId:"COMMAND_PAGE_QR_CODE",children:(0,zn.jsx)(Fd,{hidePopup:this.hidePopup,data:this.props.data})})}}const vb=fb;class bb extends Un.PureComponent{state={remapLoading:!1};clickRef=Un.createRef();getMenuItems=()=>this.props.feeds.map((e=>{let t;return t=e.remap?{...st.Z.makeLabelPair((0,W.Z)("Feed information could not be loaded")),isEnabled:()=>!1}:{...st.Z.makeLabelPair(`${e.title} - ${e.type}`),items:[{handler:t=>c.ZP.openURL(t.windowId,e.url),...(0,fi.Z)("rss","Preview")},{handler:t=>{this.openFeed(e)},...(0,fi.Z)("Subscribe")}]},t}));remapFeeds=()=>{this.state.remapLoading||(this.props.feeds.some((e=>e.remap))?(this.setState({remapLoading:!0}),Promise.allSettled(this.props.feeds.map((e=>e.remap?fetch(e.url).then((e=>e.ok?e.text():Promise.reject(""))).then((t=>{const s=(new DOMParser).parseFromString(t,"text/html").querySelector('link[type="application/rss+xml"][href], link[type="application/atom+xml"][href], link[type="text/x-opml"][href], a[type="application/rss+xml"][href], a[type="application/atom+xml"][href], a[type="text/x-opml"][href]');if(!(s&&(s instanceof window.HTMLLinkElement||s instanceof window.HTMLAnchorElement)&&s.href))return Promise.reject();e.url=s.href,e.remap=!1})):Promise.resolve()))).finally((()=>{this.setState({remapLoading:!1},(()=>{1!==this.props.feeds.length||this.props.feeds[0].remap?this.clickRef.current?.showMenu:this.openFeed(this.props.feeds[0])}))}))):1!==this.props.feeds.length||this.props.feeds[0].remap?this.clickRef.current?.showMenu():this.openFeed(this.props.feeds[0]))};openFeed=e=>{const t={url:e.url,title:e.title??e.url,feedId:crypto.randomUUID(),offline:!1,refreshInterval:120};ue.Z.showAddFeed(fe.ZP.getLastActiveBrowserWindowId(),{feeds:[t]})};render=()=>this.props.feeds.length?(0,zn.jsx)(oa.ZP,{ref:this.clickRef,image:this.state.remapLoading?Kn.H0I:Kn.ZU_.small,onClick:this.remapFeeds,tooltip:(0,W.Z)("Page offers feeds"),menu:this.getMenuItems,menuOrigin:"bottomLeft"}):null}const Cb=bb,wb=[];class yb extends m.Z{getInitialState(){return new Map}getFeeds(e){return this.getState().get(e)??wb}reduce(e,t){switch(t.actionType){case"RSS_FEEDS_FOUND":{const{tabId:s,feeds:n}=t;return new Map(e).set(s,n)}case"RSS_CLEAR_FEEDS":case"CHROME_TABS_REMOVED":return(0,Fo.u4)(e,t.tabId);default:return e}}}const xb=new yb;var Ib=(0,zn.jsx)("svg",{viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",children:(0,zn.jsxs)("g",{children:[(0,zn.jsx)("path",{d:"M7 8C7 7.44772 7.44772 7 8 7C8.55228 7 9 7.44772 9 8V11C9 11.5523 8.55228 12 8 12C7.44772 12 7 11.5523 7 11V8Z"}),(0,zn.jsx)("path",{d:"M8 6C8.55228 6 9 5.55228 9 5C9 4.44772 8.55228 4 8 4C7.44772 4 7 4.44772 7 5C7 5.55228 7.44772 6 8 6Z"}),(0,zn.jsx)("path",{fillRule:"evenodd",d:"M15 8C15 11.866 11.866 15 8 15C4.13401 15 1 11.866 1 8C1 4.13401 4.13401 1 8 1C11.866 1 15 4.13401 15 8ZM14 8C14 11.3137 11.3137 14 8 14C4.68629 14 2 11.3137 2 8C2 4.68629 4.68629 2 8 2C11.3137 2 14 4.68629 14 8Z"})]})}),Ab=(0,zn.jsxs)("svg",{width:"16",height:"16",xmlns:"http://www.w3.org/2000/svg",children:[(0,zn.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8 2c1.694 0 3 1.31 3 2.846V6H5V4.846C5 3.311 6.306 2 8 2ZM4 6.085V4.846C4 2.722 5.79 1 8 1s4 1.722 4 3.846V6.085A1.5 1.5 0 0 1 13 7.5v5a1.5 1.5 0 0 1-1.5 1.5h-7A1.5 1.5 0 0 1 3 12.5v-5a1.5 1.5 0 0 1 1-1.415ZM4.5 7a.5.5 0 0 0-.5.5v5a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 .5-.5v-5a.5.5 0 0 0-.5-.5h-7Z",fill:"currentColor"}),(0,zn.jsx)("path",{opacity:".1",d:"M8 7h3.5a.5.5 0 0 1 .5.5v5a.5.5 0 0 1-.5.5H8V7Z",fill:"#000"})]}),Sb=(0,zn.jsxs)("svg",{width:"16",height:"16",xmlns:"http://www.w3.org/2000/svg",children:[(0,zn.jsx)("path",{d:"M7.118 1.654a1 1 0 0 1 1.764 0l6.334 11.875A1 1 0 0 1 14.333 15H1.667a1 1 0 0 1-.883-1.47L7.118 1.653Z",fill:"var(--colorErrorBg)"}),(0,zn.jsx)("path",{d:"M8 5a1 1 0 0 0-1 1v3a1 1 0 0 0 2 0V6a1 1 0 0 0-1-1ZM8 11a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z",fill:"var(--colorErrorFg)"})]}),Zb=(0,zn.jsx)("svg",{viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",children:(0,zn.jsx)("path",{d:"M10.4 5c-.4-.8 0-1.8 1-2 .7 0 1.5.4 1.6 1.2a1.4 1.4 0 0 1-.2 1l-4 7c-.3.5-.7.8-1.2.8-.6 0-1-.2-1.3-.7L3.8 7.8 2.2 5c-.5-.8 0-2 1-2 .7 0 1 .2 1.4.7l1 2 1 1.4a2 2 0 0 0 1.7 1.5 2.2 2.2 0 0 0 2.3-2V6c0-.3 0-.6-.2-1z"})});function Tb({pageSecurity:e,isUrlEmpty:t}){if(t)return(0,zn.jsx)(Vn.ZP,{url:A.Z.get(Z.kAddressBarInlineSearchEnabled)?Kn.YvR.medium:Kn.ZuY,loadType:"faviconFromCache"});switch(e){case"web":case"warning":return Ib;case"secure":return Ab;case"insecure":return Sb;case"internal":return Zb;default:return null}}class Eb extends Un.PureComponent{static contextType=oi.Z;refSiteInfoButton=Un.createRef();_popupVisible=!1;_popupVisibleOnMouseDown=!1;componentDidMount(){re.Z.windowPrivate.onPageInfoPopupChanged.addListener(this.popupChanged)}componentWillUnmount(){re.Z.windowPrivate.onPageInfoPopupChanged.removeListener(this.popupChanged),clearTimeout(this._timeoutId)}popupChanged=(e,t)=>{e===this.context.vivaldiWindowId&&(t?this._popupVisible=!0:this._timeoutId=setTimeout((()=>{this._popupVisible=!1}),1))};doActionShowPageInfo=e=>{if(e)return this.props.fieldGo();af.Z.getActiveWebView(this.context.vivaldiWindowId)&&n.Z.windows.getCurrent({},(e=>{re.Z.zoom.getVivaldiUIZoom((t=>{const s=this.refSiteInfoButton.current;if(!s)return;const n=s.getBoundingClientRect(),{left:i=0,top:a=0}=e,o=n.left*t+i-1,r=this.props.isInternal?60:360,{screen:l}=this.context,d=(l.availHeight-(n.bottom+a)*t>r?n.bottom+6:n.top-6)*t+a,c=af.Z.getActiveWebView(this.context.vivaldiWindowId);c&&c.showPageInfo({top:Math.round(d),left:Math.round(o)})}))}))};getFavIconData(e,t,s,n,i){return{favIconUrl:!e&&t||i?t:A.Z.get(Z.kAddressBarInlineSearchEnabled)?Kn.YvR.medium:Kn.ZuY,favIconType:!e&&t&&"img"!==s||i?n?"faviconSkipCache":"page":"faviconFromCache"}}render(){const{vivaldiWindowId:e}=this.context,{favIconType:t,favIconUrl:s,isEditingUrl:n,isInternal:i,isLoading:a,isLocal:o,isUrlEmpty:r,skipCache:l,sslState:d,isZeroSuggestion:c}=this.props,h=n||i||o?"internal":function(e,t){return"security_error"===e?"insecure":"warning"===e||"none"===e&&!t?"warning":"secure"===e?"secure":"web"}(d,a),u=this.getFavIconData(r,s,t,l,c),p=Ze.ZP.isActiveInternal(e)?null:(0,W.Z)("View Site Info"),g=Ze.ZP.isActiveInternal(e)?null:"warning"===h?(0,W.Z)("Page Not Secure, Site Info"):(0,W.Z)("Site Info");return(0,zn.jsx)("div",{className:"button-toolbar",children:(0,zn.jsxs)("button",{ref:this.refSiteInfoButton,className:`button-addressfield SiteInfoButton ${h}`,title:p,"aria-label":g,onMouseDown:()=>{this._popupVisibleOnMouseDown=this._popupVisible},onClick:()=>{this._popupVisibleOnMouseDown||this.doActionShowPageInfo(n),this._popupVisibleOnMouseDown=!1},draggable:this.props.draggable,onDragStart:this.props.onDragStart,disabled:this.props.isInternal&&!n,tabIndex:this.props.tabIndex,"aria-haspopup":!this.props.isInternal&&"dialog","aria-expanded":this._popupVisible,children:[n||c?(0,zn.jsx)(Vn.ZP,{className:"SiteInfoButton-Favicon",url:u.favIconUrl,loadType:u.favIconType}):(0,zn.jsx)("div",{className:"SiteInfoButton-SecurityBadge",children:(0,zn.jsx)(Tb,{pageSecurity:h,isUrlEmpty:r})}),"warning"===h&&(0,zn.jsx)("span",{className:"siteinfo-text",children:(0,W.Z)("Not Secure")})]})})}}const kb=Eb;var Nb=s(5198);function _b(e){return e.local!==e.value?e.value+" ("+e.local+")":e.value}const Pb=[Z.kVivaldiTranslateLanguageList];class Mb extends Un.Component{static contextType=oi.Z;constructor(e,t){super(e),this.state={languages:this._getLanguages(),sourceLang:Nb.Z.getTranslationCode(this.props.pageLanguage),targetLang:Nb.Z.getTranslationCode(this.props.targetLang),settings:{isLanguagePairOnAlwaysTranslateList:!1,isLanguageInNeverTranslateList:!1,isSiteOnNeverTranslateList:!1,shouldShowNeverTranslateShortcut:!1,shouldShowAlwaysTranslateShortcut:!0}}}componentDidMount(){this.actionPerformed_=!1,this.updateLanguageTranslateSettings()}componentDidUpdate(e){e.translateStep!==this.props.translateStep&&"after_translate"===this.props.translateStep&&this.onCancel(),e.prefValues[Z.kVivaldiTranslateLanguageList]!==this.props.prefValues[Z.kVivaldiTranslateLanguageList]&&this.setState({languages:this._getLanguages()}),e.targetLang!==this.props.targetLang&&this.setState({targetLang:Nb.Z.getTranslationCode(this.props.targetLang)})}componentWillUnmount(){}isLanguageSupported=()=>this.props.prefValues[Z.kVivaldiTranslateLanguageList].includes(this.state.sourceLang);_getLanguages=()=>Nb.Z.getTranslationLocales().map((e=>({id:Nb.Z.getTranslationCode(e.key),name:_b(e)})));reportDialogClosing(e){this.isLanguageSupported()&&!this.props.isTranslated&&!1===this.actionPerformed_&&(re.Z.prefs.setTranslationDeclined(this.props.tabId,e,this.state.sourceLang,this.state.targetLang,(()=>{})),this.setActionPerformed())}setActionPerformed(){this.actionPerformed_=!0}updateLanguageTranslateSettings(){this.state.sourceLang&&this.state.targetLang&&re.Z.prefs.getTranslateSettings(this.props.tabId,this.state.sourceLang,this.state.targetLang,(e=>{this.setState({settings:e})}))}shouldShowAlwaysTranslateShortcut=()=>{if(!this.state.sourceLang||this.state.settings.shouldShowNeverTranslateShortcut)return!1;const e=Ze.ZP.getPageById(this.props.tabId);return Boolean(e&&!e.incognito)};shouldShowNeverTranslateShortcut=()=>!(!this.state.sourceLang||this.state.settings.isLanguagePairOnAlwaysTranslateList)&&this.state.settings.shouldShowNeverTranslateShortcut;isTranslationInProgress=()=>"translating"===this.props.translateStep;onCancel=()=>{this.props.hidePopup()};onTranslate=()=>{const e=Nb.Z.getTranslationCode(this.state.targetLang),t=this.state.sourceLang?Nb.Z.getTranslationCode(this.state.sourceLang):"auto";re.Z.tabsPrivate.translatePage(this.props.tabId,t,e,(e=>{})),this.setActionPerformed()};onRevert=()=>{re.Z.tabsPrivate.revertTranslatePage(this.props.tabId,(e=>{})),this.setActionPerformed()};onTargetLanguageSelected=e=>{const{value:t}=e.currentTarget;t!==this.state.targetLang&&(Nb.Z.setTargetTranslationCode(t),this.setState({targetLang:t}))};setAlwaysTranslate=e=>{re.Z.prefs.setLanguagePairToAlwaysTranslate(this.props.tabId,e,this.state.sourceLang,this.state.targetLang,(t=>{t&&(this.updateLanguageTranslateSettings(),e&&!this.props.isTranslated&&this.onTranslate())})),this.setActionPerformed()};setNeverTranslate=e=>{re.Z.prefs.setLanguageToNeverTranslate(this.props.tabId,e,this.state.sourceLang,this.state.targetLang,(e=>{e&&this.updateLanguageTranslateSettings()})),this.setActionPerformed()};setNeverTranslateSite=e=>{re.Z.prefs.setSiteToNeverTranslate(this.props.tabId,e,this.state.sourceLang,this.state.targetLang,(t=>{t&&(this.updateLanguageTranslateSettings(),e&&this.props.isTranslated&&this.onRevert())})),this.setActionPerformed()};_onAlwaysTranslate=e=>{const t=e.target.checked;this.setAlwaysTranslate(t),this.setActionPerformed()};_onNeverTranslate=e=>{const t=e.target.checked;this.setNeverTranslate(t),this.setActionPerformed()};openTranslatePage=()=>{c.ZP.openURL(this.context.vivaldiWindowId,"https://www.vivaldi.com/translate/")};isError=()=>this.props.error&&"no_error"!==this.props.error;handleCloseClick=e=>{this.reportDialogClosing(!0),this.onCancel()};handleMenuClick=e=>{const t=[];t.push({...(0,fi.Z)("Always Translate $1",[Nb.Z.getHumanReadableLanguageFromCode(this.state.sourceLang)]),type:"checkbox",handler:this.setAlwaysTranslate.bind(this,!this.state.settings.isLanguagePairOnAlwaysTranslateList),checked:this.state.settings.isLanguagePairOnAlwaysTranslateList}),t.push({...(0,fi.Z)("Never Translate $1",[Nb.Z.getHumanReadableLanguageFromCode(this.state.sourceLang)]),type:"checkbox",handler:this.setNeverTranslate.bind(this,!this.state.settings.isLanguageInNeverTranslateList),checked:this.state.settings.isLanguageInNeverTranslateList}),t.push({...(0,fi.Z)("Never Translate This Site"),handler:this.setNeverTranslateSite.bind(this,!this.state.settings.isSiteOnNeverTranslateList),type:"checkbox",checked:this.state.settings.isSiteOnNeverTranslateList}),(0,mi.Z)(this.context,t)(e),e.preventDefault(),e.stopPropagation()};renderDialogHeader(){return(0,zn.jsxs)("div",{className:"TranslatePopup-Header",children:[(0,zn.jsx)("h3",{id:"popup-label-translate",children:(0,W.Z)("browser","Translate Page")}),this.isLanguageSupported()&&(0,zn.jsx)(zn.Fragment,{children:(0,zn.jsx)("button",{className:Gn()({"TranslatePopup-Header-CloseButton":!0}),title:(0,W.Z)("Close Dialog"),dangerouslySetInnerHTML:{__html:Kn.kze},onClick:this.handleCloseClick})})]})}renderContent(){if(this.isTranslationInProgress())return null;if(!1===this.isLanguageSupported())return(0,zn.jsx)("div",{className:"dialog-content",children:(0,W.Z)("Vivaldi Translate does not currently support $1 ($2).",[Nb.Z.getHumanReadableLanguageFromCode(this.state.sourceLang),this.state.sourceLang])});if(this.state.languages&&this.state.languages.length>0&&!this.props.isTranslated){const e=this.state.languages.map((e=>e.id===this.state.targetLang?(0,zn.jsx)("option",{value:e.id,defaultValue:!0,children:e.name},e.id):e.id!==this.state.sourceLang?(0,zn.jsx)("option",{value:e.id,children:e.name},e.id):void 0));return(0,zn.jsxs)("div",{className:"dialog-content",children:[(0,zn.jsx)("label",{className:"TranslatePopup-SelectLabel",children:(0,W.Z)("To:")},"select"),(0,zn.jsx)(Fa.Z,{onChange:this.onTargetLanguageSelected,disabled:!1,value:this.state.targetLang,children:e})]})}return null}renderButtons(){const e=[];if(this.isLanguageSupported()){const t=this.isTranslationInProgress();this.isError()?e.push((0,zn.jsx)(fa,{type:"error",children:(0,W.Z)("Error translating page.")},"error")):t&&e.push((0,zn.jsx)("label",{className:"TranslatePopup-Status",children:(0,W.Z)("Translating...")},"progress")),this.props.isTranslated&&!t?(e.push((0,zn.jsx)("label",{className:"TranslatePopup-Status",children:(0,W.Z)("This page has been translated to $1 ($2).",[Nb.Z.getHumanReadableLanguageFromCode(this.state.targetLang),this.state.targetLang])},"status")),e.push((0,zn.jsx)("div",{className:"TranslatePopup-Buttons",children:(0,zn.jsx)("input",{type:"button",className:"TranslatePopup-Buttons-Revert",onClick:this.onRevert,disabled:!1,autoFocus:!0,value:(0,W.Z)("Revert to $1",[Nb.Z.getHumanReadableLanguageFromCode(this.state.sourceLang)])},"translate-revert")},"translate-buttons"))):t||(this.shouldShowAlwaysTranslateShortcut()&&e.push((0,zn.jsxs)("label",{className:"TranslatePopup-Checkbox",children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.state.settings.isLanguagePairOnAlwaysTranslateList,onChange:this._onAlwaysTranslate}),(0,zn.jsx)("span",{children:(0,W.Z)("Always translate $1",[Nb.Z.getHumanReadableLanguageFromCode(this.state.sourceLang)])})]},"alwaysTranslate")),this.shouldShowNeverTranslateShortcut()&&e.push((0,zn.jsxs)("label",{className:"TranslatePopup-Checkbox",children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.state.settings.isLanguageInNeverTranslateList,onChange:this._onNeverTranslate}),(0,zn.jsx)("span",{children:(0,W.Z)("Never translate $1",[Nb.Z.getHumanReadableLanguageFromCode(this.state.sourceLang)])})]},"neverTranslate")),e.push((0,zn.jsxs)("div",{className:"TranslatePopup-Buttons",children:[(0,zn.jsx)("input",{type:"button",className:"TranslatePopup-Buttons-Translate primary",onClick:this.onTranslate,disabled:!1,value:(0,W.Z)("verb","Translate"),autoFocus:!0},"translate-button"),(0,zn.jsxs)("button",{className:"TranslatePopup-Buttons-MenuButton",onClick:this.handleMenuClick,children:[(0,zn.jsx)("span",{className:"TranslatePopup-Buttons-MenuButton-Span",value:"options",dangerouslySetInnerHTML:{__html:Kn.bqs.small}},"translate-menu"),(0,zn.jsx)("label",{className:"TranslatePopup-Buttons-MenuButton-Label",children:(0,W.Z)("Options")})]})]},"translate-buttons")))}return e}renderFooter(){return(0,zn.jsx)("footer",{className:"dialog-footer",children:(0,zn.jsxs)("div",{className:"TranslatePopup-FooterText",children:[(0,W.Z)("Powered by Lingvanex, hosted by Vivaldi."),(0,zn.jsx)("a",{href:"",className:"TranslatePopup-ReadMoreLink",onClick:this.openTranslatePage,title:(0,W.Z)("Read more about Vivaldi Translate"),children:(0,W.Z)("Learn More")})]})})}render(){return(0,zn.jsxs)("div",{className:"TranslatePopup",children:[this.renderDialogHeader(),this.renderContent(),this.renderButtons(),this.renderFooter()]})}}const Db=(0,zd.Z)(Mb,Pb);var Ob=s(85374);class jb extends Un.PureComponent{constructor(e){super(e);const t=this.getStateFromStore();this.state={popupVisible:!1,pageLanguage:t.pageLanguage,isTranslated:t.isTranslated,translateStep:t.translateStep,error:"no_error",targetLang:Nb.Z.getTargetTranslationCode(),autoTranslate:!1}}componentDidMount(){Ob.ZP.addListener(this._onTranslationStateStoreChanged,(e=>e.get(this.props.tabId))),A.Z.addListener([Z.kTranslateTargetLanguage],this._onPrefChanged)}componentWillUnmount(){Ob.ZP.removeListener(this._onTranslationStateStoreChanged),A.Z.removeListener([Z.kTranslateTargetLanguage],this._onPrefChanged)}static getDerivedStateFromProps(e){const{tabId:t}=e,s=Ob.ZP.getPageState(t);if(s){const e=s.pageLanguage?s.pageLanguage:"",t=Boolean(s.isTranslated),n={pageLanguage:e,isTranslated:t,error:s.error,translateStep:s.translateStep,autoTranslate:s.autoTranslate};return t&&(n.targetLang=s.translatedLang,s.originalLang&&(n.pageLanguage=s.originalLang)),n}return null}_onPrefChanged=(e,t,s)=>{if(s===Z.kTranslateTargetLanguage)this.setState({targetLang:String(t)})};getStateFromStore=()=>{const e=Ob.ZP.getPageState(this.props.tabId);return{pageLanguage:e.pageLanguage?e.pageLanguage:"",isTranslated:Boolean(e.isTranslated),error:e.error??"no_error",translateStep:e.translateStep,autoTranslate:Boolean(e.autoTranslate)}};_onTranslationStateStoreChanged=()=>{const e=this.getStateFromStore();"idle"===e.translateStep&&this.hidePopup(),this.setState(e)};hidePopup=()=>{this.setState({popupVisible:!1})};togglePopup=()=>{this.setState((e=>({popupVisible:!e.popupVisible})))};render(){if(!this.state.pageLanguage||this.state.targetLang===this.state.pageLanguage)return null;const e=this.state.isTranslated;return(0,zn.jsx)(oa.ZP,{isPressed:e,isOn:e,image:Kn.IeE,label:(0,W.Z)("verb","Translate Page"),tooltip:e?(0,W.Z)("Revert Page Translation"):(0,W.Z)("title","Translate Page"),onClick:this.togglePopup,popupPosition:this.props.popupPosition,hidePopup:this.hidePopup,isPopupVisible:this.state.popupVisible,size:this.props.size,popupClassName:"ToolbarButtonPopup-DefaultStyles",popupLabelledBy:"popup-label-translate",popupWidth:300,commandId:"COMMAND_TAB_TRANSLATE_PAGE",children:(0,zn.jsx)(Db,{hidePopup:this.hidePopup,tabId:this.props.tabId,isTranslated:this.state.isTranslated,pageLanguage:this.state.pageLanguage,error:this.state.error,targetLang:this.state.targetLang,translateStep:this.state.translateStep})})}}const Lb=jb;const Rb=function(e){if(!e)return"";const t=(0,ve.Z)(e);return t?(t.hostname&&(e=t.hostname),0===e.indexOf("www.")&&(e=e.split("www.")[1]),e.includes("/")&&(e=e.split("/")[0]),e):e};var Bb=s(98010),Fb=s(59720);class Wb extends Un.PureComponent{constructor(e){super(e)}onCloseClicked=()=>{re.Z.infobars.sendButtonAction(this.props.infoBar.tabId,this.props.infoBar.identifier,"dismiss")};onActionClicked=(e,t)=>{t.stopPropagation(),t.preventDefault(),re.Z.infobars.sendButtonAction(this.props.infoBar.tabId,this.props.infoBar.identifier,e)};render(){return(0,zn.jsxs)("div",{className:"page-confirm-info-bar",children:[(0,zn.jsx)("label",{children:this.props.infoBar.messageText}),(0,zn.jsxs)("div",{className:"infobar-controls",children:[this.props.infoBar.buttons.map((e=>(0,zn.jsx)("input",{type:"button",value:e.text,title:(0,W.Z)("Select action"),onClick:this.onActionClicked.bind(this,e.action)},e.action))),this.props.infoBar.isCloseable&&(0,zn.jsx)("button",{type:"button",title:(0,W.Z)("Close infobar"),className:"close",onMouseUp:this.onCloseClicked,dangerouslySetInnerHTML:{__html:Kn.kze}})]})]})}}const Ub=Wb;class Vb extends Un.PureComponent{constructor(e){super(e),this.state={infoBars:(0,qe.aV)()}}componentDidMount(){re.Z.infobars.onInfobarCreated.addListener(this._onInfobarCreated),re.Z.infobars.onInfobarRemoved.addListener(this._onInfobarRemoved)}componentWillUnmount(){re.Z.infobars.onInfobarRemoved.removeListener(this._onInfobarRemoved),re.Z.infobars.onInfobarCreated.removeListener(this._onInfobarCreated)}_onInfobarCreated=e=>{this.props.tabId===e.tabId&&this.setState((t=>({infoBars:t.infoBars.insert(0,e)})))};_onInfobarRemoved=(e,t)=>{this.props.tabId===e&&this.setState((e=>({infoBars:e.infoBars.filter((e=>{e.tabId}))})))};render(){return(0,zn.jsx)(Un.Fragment,{children:this.state.infoBars.map((e=>(0,zn.jsx)(Ub,{infoBar:e},e.tabId)))})}}const Hb=Vb,Gb={dialog:"handleOnJavascriptDialog"};class Kb extends Un.PureComponent{refWebviewDiv=Un.createRef();refDevTools=Un.createRef();state={dialogParentElement:void 0,customData:void 0};componentDidMount(){this.webview=this.refWebviewDiv.current?.firstChild,this.attachWebviewHandlers()}componentWillUnmount(){this.removeWebviewHandlers()}handleOnJavascriptDialog=e=>{e.preventDefault(),e.dialogtype="javascript",this.showDialog(e)};showDialog=e=>{e.webview=this.webview,this.setState({dialogParentElement:this.refDevTools.current,customData:e})};handleOnCloseDialog=()=>{this.setState({dialogParentElement:null})};attachWebviewHandlers=()=>{Object.keys(Gb).forEach((e=>{this.webview&&this.webview.addEventListener(e,this[Gb[e]])}))};removeWebviewHandlers=()=>{Object.keys(Gb).forEach((e=>{this.webview&&this.webview.removeEventListener(e,this[Gb[e]])}))};render(){if("off"===this.props.dockingState)return null;const e="undocked"===this.props.dockingState||!1===this.props.undockedIsUnmounted;return(0,zn.jsxs)("div",{children:[(0,zn.jsx)("div",{ref:this.refDevTools,className:"devtools-content",children:(0,zn.jsx)("div",{ref:this.refWebviewDiv,dangerouslySetInnerHTML:{__html:`<webview name="${String(e?"vivaldi-devtools-undocked":"vivaldi-devtools-main")}"\n                inspect_tab_id="${String(this.props.tabId)}" />`}})}),this.props.active&&this.state.dialogParentElement&&this.state.customData&&(0,zn.jsx)(Hd,{customData:this.state.customData,closeDialog:this.handleOnCloseDialog})]})}}const zb=Kb;class $b extends Un.PureComponent{static contextType=oi.Z;constructor(e,t){super(e),this.state={show:A.Z.get(Z.kShowExtensionsBanner)}}onGoClicked=()=>{c.ZP.openURL(this.context.vivaldiWindowId,"https://vvld.in/chrome-web-store")};onCloseClicked=()=>{this.setState({show:!1}),I.Z.set(Z.kShowExtensionsBanner,!1)};render(){return!this.state.show||this.props.url.indexOf("chrome://extensions")<0?null:(0,zn.jsxs)("div",{className:"vivaldi-extension-banner",children:[(0,zn.jsx)("label",{children:(0,W.Z)("You can install any extension from the Chrome Web Store directly to Vivaldi. Just open the web store and click “Add to Chrome” on your extension of choice.")}),(0,zn.jsxs)("div",{className:"controls",children:[(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Chrome Web Store"),title:(0,W.Z)("Open Chrome Web Store"),onClick:this.onGoClicked}),(0,zn.jsx)("span",{className:"close",value:"close",title:(0,W.Z)("Close"),onMouseUp:this.onCloseClicked,dangerouslySetInnerHTML:{__html:Kn.kze}})]})]})}}const Yb=$b;var Xb=s(12666);class Qb extends Un.PureComponent{static contextType=oi.Z;nodeRef=Un.createRef();constructor(e){super(e),this.state={hitImage:null,justFound:!1,uiZoom:1},this._updateUIZoom()}componentDidUpdate(e){(this.props.selectionRect.top!==e.selectionRect.top||this.props.selectionRect.left!==e.selectionRect.left||this.props.selectionRect.width!==e.selectionRect.width||this.props.selectionRect.height!==e.selectionRect.height)&&this.props.selectionRect.width&&this.props.selectionRect.height&&(this._updateUIZoom(),this.setState({hitImage:null,justFound:!1}),this._getNewSelectionImage(this.props.selectionRect,this.props.tabId))}_updateUIZoom=()=>{re.Z.zoom.getVivaldiUIZoom((e=>{this.setState({uiZoom:e})}))};_getNewSelectionImage=(e,t)=>{const s=af.Z.getActiveWebView(this.context.vivaldiWindowId);if(!s)return;const{uiZoom:n}=this.state,i=s.getBoundingClientRect(),a={left:parseInt(i.left+e.left/n),top:parseInt(i.top+e.top/n),width:parseInt(e.width/n),height:parseInt(e.height/n)},o={windowId:this.context.vivaldiWindowId,posX:a.left,posY:a.top,width:a.width,height:a.height,saveToDisk:!1};re.Z.thumbnails.captureUI(o,((e,t)=>{e?this.setState({hitImage:t,justFound:!0}):this.resetJustFound()}))};resetJustFound=()=>{this.setState({justFound:!1})};render(){if(!this.state.hitImage)return null;const{selectionRect:e,hitOffset:t}=this.props,{uiZoom:s}=this.state,n={position:"absolute",top:parseInt(e.top/s+t),left:parseInt(e.left/s),width:parseInt(e.width),height:parseInt(e.height)};return(0,zn.jsx)(Xb.ZP,{in:this.state.justFound,appear:!0,enter:!0,exit:!0,unmountOnExit:!0,onEntered:(e,t)=>this.resetJustFound(),timeout:{appear:200,enter:200,exit:200},nodeRef:this.nodeRef,children:e=>(0,zn.jsx)("img",{ref:this.nodeRef,src:this.state.hitImage,style:n,className:`fip-active-hit ${e}`})})}}const qb=Qb;var Jb=s(29697),eC=s(34155);class tC extends Un.PureComponent{static contextType=oi.Z;_isIMEOpen=!1;refFipToolbar=Un.createRef();refInputText=Un.createRef();constructor(e){super(e),this.state=this._getStateFromStores(!1)}componentDidMount(){this.props.isActive&&Ca.Z.addListener(this.onWebpageviewStoreChanged)}componentWillUnmount(){this.props.isActive&&Ca.Z.removeListener(this.onWebpageviewStoreChanged)}componentDidUpdate(e){e.isActive!==this.props.isActive&&(this.props.isActive?Ca.Z.addListener(this.onWebpageviewStoreChanged):Ca.Z.removeListener(this.onWebpageviewStoreChanged))}onCompositionStart=()=>{this._isIMEOpen=!0};onCompositionEnd=()=>{this._isIMEOpen=!1,this.onFindInPageTextChanged()};onWebpageviewStoreChanged=e=>{if(e.pageId!==this.props.pageId)return;if("WEBPAGEVIEW_CLOSE_FIND_IN_PAGE"===e.type)return void this.setState(this._getStateFromStores(!1));const t=af.Z.getActiveWebView(this.context.vivaldiWindowId);if(t){switch(e.type){case"WEBPAGEVIEW_RESULTS_FROM_FIND_IN_PAGE":this.setState(this._getStateFromStores(!0));break;case"WEBPAGEVIEW_ACTIONS":"findInPage"===e.action?this.setState(this._getStateFromStores(!1),this.populateWithPageSelection):"findNextInPage"===e.action?(this.focusFindInPageInput(),this.onNextClicked()):"findPreviousInPage"===e.action&&(this.focusFindInPageInput(),this.onPreviousClicked());break;case"WEBPAGEVIEW_FOCUS_FIND_IN_PAGE":this.focusFindInPageInput()}if(this.refFipToolbar.current){const e=this.refFipToolbar.current.getBoundingClientRect().height;let s;s="richtexteditor"===t.name||"markdowneditor"===t.name?this.refFipToolbar.current?.parentElement?.parentElement?.getBoundingClientRect()?.height??e:e,this.setState({hitOffset:s})}}};populateWithPageSelection=()=>{re.Z.utilities.getSelectedText(this.props.pageId,(e=>{if(e.length>0){const t=this.refInputText.current;t&&(t.value=e.substring(0,128)),this.onFindInPageTextChanged()}this.focusFindInPageInput()}))};scrollBy=e=>{let t;t=A.Z.get(Z.kWebpagesSmoothScrollingEnabled)?e?()=>window.scrollBy({top:window.innerHeight,behavior:"smooth"}):()=>window.scrollBy({top:-window.innerHeight,behavior:"smooth"}):e?()=>window.scrollBy({top:window.innerHeight,behavior:"auto"}):()=>window.scrollBy({top:-window.innerHeight,behavior:"auto"}),n.Z.scripting.executeScript({target:{tabId:this.props.pageId},function:t},(()=>{n.Z.runtime.lastError}))};onKeyDown=e=>{const{ctrlKey:t,altKey:s,shiftKey:n,metaKey:i}=e,a={ctrlKey:t,altKey:s,shiftKey:n,metaKey:i};if(!(0,Zi.Mr)(a))switch(e.key){case"PageDown":return void this.scrollBy(!0);case"PageUp":return void this.scrollBy(!1)}"m"===e.key&&(0,Zi.Np)(a)&&this.onMatchCaseClicked(),"Enter"===e.key&&(this.focusFindInPageInput(),(0,Zi.Mr)(a)?this.onPreviousClicked():(0,Zi.Np)(a)?this.closeAndActivate():this.onNextClicked())};focusFindInPageInput=()=>{const e=this.refInputText.current;e&&(e.focus(),e.value&&e.select())};_getFindInPageText=()=>{const e=this.refInputText.current;return e?e.value:""};onMatchCaseClicked=()=>{this.props.onFindInPage(this._getFindInPageText(),!this.state.matchCase),this.setState((e=>({matchCase:!e.matchCase})))};focusWebview=()=>{sp.Z.doAction(this.context.vivaldiWindowId,this.props.pageId,"focusWebView")};matchWord=e=>{const t=Ze.ZP.getActivePage(this.context.vivaldiWindowId)?.id;t!==this.props.pageId&&this.focusWebview(),eC.nextTick((()=>{this.props.onFindNextInPage(this._getFindInPageText(),e,this.state.matchCase)}))};onPreviousClicked=()=>this.matchWord(!0);onNextClicked=()=>this.matchWord(!1);onCloseClicked=()=>{sp.Z.closeFindInPageToolbar(this.context.vivaldiWindowId,this.props.pageId)};closeAndActivate=()=>{this.onCloseClicked();const e=af.Z.getActiveWebView(this.context.vivaldiWindowId);e&&e.stopFinding("activate")};onFindInPageTextChanged=()=>{if(this._isIMEOpen)return;const e=this._getFindInPageText();this.state.findInPageText!==e&&(this.setState({findInPageText:e}),this.props.onFindInPage(e,this.state.matchCase))};_getStateFromStores=e=>{const t=Ca.Z.getFindResultsForPage(this.props.pageId);let s={};return s=e?{...this.state,activeMatchOrdinal:t.activeMatchOrdinal,matchCase:t.matchCase||!1,numberOfMatches:t.numberOfMatches,selectionRect:t.selectionRect}:{activeMatchOrdinal:t.activeMatchOrdinal,findInPageText:t.searchText,hitOffset:0,isFindInPageToolbarOpen:t.isFindInPageToolbarOpen,matchCase:t.matchCase,numberOfMatches:t.numberOfMatches,selectionRect:t.selectionRect},s};render(){if(A.Z.get(Z.kThemeUseAnimation)){const e=af.Z.getActiveWebView(this.context.vivaldiWindowId);e&&Number(e.id)===this.props.pageId&&(0!==this.state.numberOfMatches&&this.state.isFindInPageToolbarOpen?(e.style.transition="filter 100ms",e.style.filter="brightness(95%)"):e.style.filter="brightness(100%)")}return(0,zn.jsxs)("div",{className:"find-in-page-wrapper",children:[(0,zn.jsx)(Jb.Z,{classNames:"find-in-page",in:this.state.isFindInPageToolbarOpen,mountOnEnter:!0,unmountOnExit:!0,timeout:{enter:300,exit:150},nodeRef:this.refFipToolbar,children:(0,zn.jsxs)("div",{ref:this.refFipToolbar,onKeyDown:this.onKeyDown,className:Gn()("find-in-page","toolbar","toolbar-default",{"fip-nomatches":0===this.state.numberOfMatches&&this.state.findInPageText.length>0}),tabIndex:"-1",children:[(0,zn.jsx)("span",{className:"fip-input-label",children:(0,W.Z)("Find in Page:")}),(0,zn.jsxs)("div",{className:"fip-input-container toolbar toolbar-default",children:[(0,zn.jsx)("input",{ref:this.refInputText,type:"search",onChange:this.onFindInPageTextChanged,onCompositionStart:this.onCompositionStart,onCompositionUpdate:this.onCompositionStart,onCompositionEnd:this.onCompositionEnd,defaultValue:this.state.findInPageText}),(0,zn.jsx)("span",{className:"fip-results",style:{display:this.state.findInPageText.length>0?"inline":"none"},children:(0,W.Z)("$1 of $2",[this.state.activeMatchOrdinal,this.state.numberOfMatches])})]}),(0,zn.jsxs)("div",{className:"toolbar-group",children:[(0,zn.jsx)("div",{className:"button-toolbar button-narrow",children:(0,zn.jsx)("button",{className:"button-narrow",onMouseDown:e=>e.preventDefault(),onMouseUp:this.onPreviousClicked,dangerouslySetInnerHTML:{__html:Kn.eFz.small},title:(0,W.Z)("Previous match")})}),(0,zn.jsx)("div",{className:"button-toolbar button-narrow",children:(0,zn.jsx)("button",{className:"button-narrow",onMouseDown:e=>e.preventDefault(),onMouseUp:this.onNextClicked,title:(0,W.Z)("Next match"),dangerouslySetInnerHTML:{__html:Kn.S$A.small}})})]}),(0,zn.jsx)("div",{className:"button-toolbar button-narrow",children:(0,zn.jsx)("button",{onClick:this.onCloseClicked,title:(0,W.Z)("Cancel search"),dangerouslySetInnerHTML:{__html:Kn.kze}})}),(0,zn.jsxs)("label",{className:"toolbar-group",children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.state.matchCase,onChange:this.onMatchCaseClicked}),(0,zn.jsx)("span",{className:"fip-checkbox-label",children:(0,W.Z)("Match Case")})]})]})}),A.Z.get(Z.kThemeUseAnimation)&&0!==this.state.numberOfMatches&&(0,zn.jsx)(qb,{tabId:this.props.pageId,selectionRect:this.state.selectionRect,hitOffset:this.state.hitOffset,hitText:this.state.findInPageText})]})}}const sC=tC;var nC=s(93197);const iC=!1,aC={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},oC={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},rC={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},lC={256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",296:"ResolutionUnit",513:"JpegIFOffset",514:"JpegIFByteCount",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite"},dC={ColorSpace:{0:"Unknown",1:"sRGB",65535:"Adobe RGB / ProPhoto RGB"},ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}};function cC(e){return!!e.exifdata}function hC(e,t){function s(s){var n=function(e){var t=new DataView(e);iC;if(255!==t.getUint8(0)||216!==t.getUint8(1))return!1;var s=2,n=e.byteLength;for(;s<n;){if(255!==t.getUint8(s))return!1;if(225===t.getUint8(s+1))return vC(t,s+4,t.getUint16(s+2));s+=2+t.getUint16(s+2)}}(s),i=function(e){var t=new DataView(e);iC;if(255!==t.getUint8(0)||216!==t.getUint8(1))return!1;var s=2,n=e.byteLength,i=function(e,t){return 56===e.getUint8(t)&&66===e.getUint8(t+1)&&73===e.getUint8(t+2)&&77===e.getUint8(t+3)&&4===e.getUint8(t+4)&&4===e.getUint8(t+5)};for(;s<n;){if(i(t,s)){var a=t.getUint8(s+7);return a%2!=0&&(a+=1),0===a&&(a=4),pC(e,s+8+a,t.getUint16(s+6+a))}s++}}(s),a=function(e){if(!("DOMParser"in self))return;var t=new DataView(e);iC;if(255!==t.getUint8(0)||216!==t.getUint8(1))return!1;var s=2,n=e.byteLength,i=new DOMParser;for(;s<n-4;){if("http"===fC(t,s,4)){var a=s-1,o=t.getUint16(s-2)-1,r=fC(t,a,o),l=r.indexOf("xmpmeta>")+8,d=(r=r.substring(r.indexOf("<x:xmpmeta"),l)).indexOf("x:xmpmeta")+10;return r=r.slice(0,d)+'xmlns:Iptc4xmpCore="http://iptc.org/std/Iptc4xmpCore/1.0/xmlns/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:tiff="http://ns.adobe.com/tiff/1.0/" xmlns:plus="http://schemas.android.com/apk/lib/com.google.android.gms.plus" xmlns:ext="http://www.gettyimages.com/xsltExtension/1.0" xmlns:exif="http://ns.adobe.com/exif/1.0/" xmlns:stEvt="http://ns.adobe.com/xap/1.0/sType/ResourceEvent#" xmlns:stRef="http://ns.adobe.com/xap/1.0/sType/ResourceRef#" xmlns:crs="http://ns.adobe.com/camera-raw-settings/1.0/" xmlns:xapGImg="http://ns.adobe.com/xap/1.0/g/img/" xmlns:Iptc4xmpExt="http://iptc.org/std/Iptc4xmpExt/2008-02-29/" '+r.slice(d),CC(i.parseFromString(r,"text/xml"))}s++}}(s);e.exifdata=n||{},e.iptcdata=i||{},e.xmpdata=a||{},t&&t.call(e)}if(e.src)if(/^data\:/i.test(e.src))s(function(e,t){t=t||e.match(/^data\:([^\;]+)\;base64,/im)[1]||"",e=e.replace(/^data\:([^\;]+)\;base64,/gim,"");for(var s=atob(e),n=s.length,i=new ArrayBuffer(n),a=new Uint8Array(i),o=0;o<n;o++)a[o]=s.charCodeAt(o);return i}(e.src));else if(/^blob\:/i.test(e.src)){const t=new FileReader;t.onload=function(e){s(e.target.result)},function(e,t){var s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="blob",s.onload=function(e){200!==this.status&&0!==this.status||t(this.response)},s.send()}(e.src,(e=>{t.readAsArrayBuffer(e)}))}else{var n=new XMLHttpRequest;n.onload=function(){if(200!==this.status&&0!==this.status)throw"Could not load image";s(n.response),n=null},n.open("GET",e.src,!0),n.responseType="arraybuffer",n.send(null)}else if(self.FileReader&&(e instanceof self.Blob||e instanceof self.File)){const t=new FileReader;t.onload=function(e){s(e.target.result)},t.readAsArrayBuffer(e)}}const uC={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};function pC(e,t,s){for(var n,i,a,o,r=new DataView(e),l={},d=t;d<t+s;)28===r.getUint8(d)&&2===r.getUint8(d+1)&&(o=r.getUint8(d+2))in uC&&(a=r.getInt16(d+3),i=uC[o],n=fC(r,d+5,a),l.hasOwnProperty(i)?l[i]instanceof Array?l[i].push(n):l[i]=[l[i],n]:l[i]=n),d++;return l}function gC(e,t,s,n,i){var a,o=e.getUint16(s,!i),r={};for(let l=0;l<o;l++)a=s+12*l+2,r[n[e.getUint16(a,!i)]]=mC(e,a,t,s,i);return r}function mC(e,t,s,n,i){var a,o,r,l,d,c,h=e.getUint16(t+2,!i),u=e.getUint32(t+4,!i),p=e.getUint32(t+8,!i)+s;switch(h){case 1:case 7:if(1===u)return e.getUint8(t+8,!i);a=u>4?p:t+8,o=[];for(let t=0;t<u;t++)o[t]=e.getUint8(a+t);return o;case 2:return fC(e,a=u>4?p:t+8,u-1);case 3:if(1===u)return e.getUint16(t+8,!i);a=u>2?p:t+8,o=[];for(let t=0;t<u;t++)o[t]=e.getUint16(a+2*t,!i);return o;case 4:if(1===u)return e.getUint32(t+8,!i);for(o=[],l=0;l<u;l++)o[l]=e.getUint32(p+4*l,!i);return o;case 5:if(1===u)return d=e.getUint32(p,!i),c=e.getUint32(p+4,!i),(r=new Number(d/c)).numerator=d,r.denominator=c,r;o=[];for(let t=0;t<u;t++)d=e.getUint32(p+8*t,!i),c=e.getUint32(p+4+8*t,!i),o[t]=new Number(d/c),o[t].numerator=d,o[t].denominator=c;return o;case 9:if(1===u)return e.getInt32(t+8,!i);o=[];for(let t=0;t<u;t++)o[t]=e.getInt32(p+4*t,!i);return o;case 10:if(1===u)return e.getInt32(p,!i)/e.getInt32(p+4,!i);o=[];for(let t=0;t<u;t++)o[t]=e.getInt32(p+8*t,!i)/e.getInt32(p+4+8*t,!i);return o}}function fC(e,t,s){var n="";for(let i=t;i<t+s;i++)n+=String.fromCharCode(e.getUint8(i));return n}function vC(e,t){if("Exif"!==fC(e,t,4))return!1;var s,n,i,a,o,r=t+6;if(18761===e.getUint16(r))s=!1;else{if(19789!==e.getUint16(r))return!1;s=!0}if(42!==e.getUint16(r+2,!s))return!1;var l=e.getUint32(r+4,!s);if(l<8)return!1;if((n=gC(e,r,r+l,oC,s)).ExifIFDPointer)for(i in a=gC(e,r,r+n.ExifIFDPointer,aC,s)){switch(i){case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"ColorSpace":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":a[i]=dC[i][a[i]];break;case"LightSource":const e={1:5500,2:3500,3:2700,4:5e3,9:6e3,10:6e3,11:6500,12:7100,13:5400,14:4500,15:3700};n.kelvin=e[a[i]],a[i]=dC[i][a[i]];break;case"ExifVersion":case"FlashpixVersion":a[i]=String.fromCharCode(a[i][0],a[i][1],a[i][2],a[i][3]);break;case"ComponentsConfiguration":a[i]=dC.Components[a[i][0]]+dC.Components[a[i][1]]+dC.Components[a[i][2]]+dC.Components[a[i][3]]}n[i]=a[i]}if(n.GPSInfoIFDPointer)for(i in o=gC(e,r,r+n.GPSInfoIFDPointer,rC,s)){if("GPSVersionID"===i)o[i]=o[i][0]+"."+o[i][1]+"."+o[i][2]+"."+o[i][3];n[i]=o[i]}return n.thumbnail=function(e,t,s,n){var i=function(e,t,s){var n=e.getUint16(t,!s);return e.getUint32(t+2+12*n,!s)}(e,t+s,n);if(!i)return{};if(i>e.byteLength)return{};var a=gC(e,t,t+i,lC,n);if(a.Compression)switch(a.Compression){case 6:if(a.JpegIFOffset&&a.JpegIFByteCount){var o=t+a.JpegIFOffset,r=a.JpegIFByteCount;a.blob=new Blob([new Uint8Array(e.buffer,o,r)],{type:"image/jpeg"})}break;case 1:console.log("Thumbnail image format is TIFF, which is not implemented.");break;default:console.log("Unknown thumbnail image format '%s'",a.Compression)}else 2===a.PhotometricInterpretation&&console.log("Thumbnail image format is RGB, which is not implemented.");return a}(e,r,l,s),n}function bC(e){var t={};if(1===e.nodeType){if(e.attributes.length>0){t["@attributes"]={};for(var s=0;s<e.attributes.length;s++){var n=e.attributes.item(s);t["@attributes"][n.nodeName]=n.nodeValue}}}else if(3===e.nodeType)return e.nodeValue;if(e.hasChildNodes())for(var i=0;i<e.childNodes.length;i++){var a=e.childNodes.item(i),o=a.nodeName;if(t[o]){if(!t[o].push){var r=t[o];t[o]=[],t[o].push(r)}t[o].push(bC(a))}else t[o]=bC(a)}return t}function CC(e){try{var t={};if(e.children.length>0)for(var s=0;s<e.children.length;s++){var n=e.children.item(s),i=n.attributes;for(var a in i){var o=i[a],r=o.nodeName,l=o.nodeValue;void 0!==r&&(t[r]=l)}var d=n.nodeName;if(void 0===t[d])t[d]=bC(n);else{if(void 0===t[d].push){var c=t[d];t[d]=[],t[d].push(c)}t[d].push(bC(n))}}else t=e.textContent;return t}catch(e){console.log(e.message)}}const wC={getData:function(e,t){return!1!==e.complete&&(cC(e)?t&&t.call(e):hC(e,t),!0)},getTag:function(e,t){if(cC(e))return e.exifdata[t]},getAllTags:function(e){if(!cC(e))return{};var t,s=e.exifdata,n={};for(t in s)s.hasOwnProperty(t)&&(n[t]=s[t]);return n},pretty:function(e){if(!cC(e))return"";var t,s=e.exifdata,n="";for(t in s)s.hasOwnProperty(t)&&("object"==typeof s[t]?s[t]instanceof Number?n+=t+" : "+s[t]+" ["+s[t].numerator+"/"+s[t].denominator+"]\r\n":n+=t+" : ["+s[t].length+" values]\r\n":n+=t+" : "+s[t]+"\r\n");return n}};function yC(e){return`${e[0]}° ${e[1]}' ${e[2]}"`}const xC=function({windowId:e,GPSLatitude:t,GPSLatitudeRef:s,GPSLongitude:n,GPSLongitudeRef:i}){const a=`http://tools.wmflabs.org/geohack/geohack.php?language=en&params=${t.join("_")}_${s}_${n&&n.join("_")}_${i}_`,o=`${yC(t)} ${s},\n            ${yC(n)} ${i}`;return(0,zn.jsxs)("div",{className:"image-metadata-generic",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("other","Location")}),(0,zn.jsx)("div",{children:(0,zn.jsx)("a",{onClick:()=>function(e,t){c.ZP.openURL(e,t)}(e,a),href:a,title:(0,W.Z)("Open in GeoHack"),children:o})})]})};const IC=function({value:e,name:t}){return(0,zn.jsxs)("div",{className:"image-metadata-generic",children:[(0,zn.jsx)("h3",{children:t}),(0,zn.jsx)("div",{children:e})]})},AC=[Z.kKeyboardTabToAll],SC=["0°",(0,W.Z)("Vertical Mirror"),"180°",(0,W.Z)("Horizontal Mirror"),(0,W.Z)("90° Horizontal Mirror"),"270°",(0,W.Z)("270° Vertical Mirror"),"90°"],ZC=document.createElement("canvas"),TC=ZC.getContext("2d"),EC=document.createElement("canvas"),kC=EC.getContext("2d");class NC extends Un.Component{static contextType=oi.Z;refButtonForTests=Un.createRef();style=Si.ZP.convertColorsToVariables(nC.ZP.forTheme(Si.ZP.getThemeWithFallback("Vivaldi2")));constructor(e){super(e),this.state={histogramChannels:[],histogramStyle:3,histogramImage:null,height:0,width:0,size:0,data:{},status:0},EC.width=768,EC.height=300,kC.globalCompositeOperation="lighter",kC.lineWidth=1.5,ZC.width=600,ZC.height=400}componentDidMount(){this.props.open&&this.loadPhoto()}componentDidUpdate(e){this.props.open&&0===this.state.status&&this.loadPhoto()}loadPhoto=()=>{const{document:e}=this.context;this.props.url?this.setState({status:1},(()=>{const t=this.props.url,s=e.createElement("img"),n=[{fill:Be()("#f00"),data:[]},{fill:Be()("#0f0"),data:[]},{fill:Be()("#00f"),data:[]},{fill:Be()("#999"),data:[]}],i=n[0],a=n[1],o=n[2],r=n[3];let l,d=0;s.onload=()=>wC.getData(s,(()=>{l&&URL.revokeObjectURL(l);const e=s.width/s.height;let t=ZC.width,c=t/e,h=0,u=0;c>ZC.height?(c=ZC.height,t=c*e,h=(ZC.width-t)/2):u=(ZC.height-c)/2,TC.clearRect(0,0,ZC.width,ZC.height),TC.drawImage(s,h,u,t,c);const p=TC.getImageData(0,0,ZC.width,ZC.height);for(let e=0;e<256;e+=1)i.data[e]=0,a.data[e]=0,o.data[e]=0,r.data[e]=0;const g=p.data.length/256;for(let e=0,t=p.data.length;e<t;e+=4)if(p.data[e+3]>0){const t=p.data[e],s=p.data[e+1],n=p.data[e+2];i.data[t]+=1/g,a.data[s]+=1/g,o.data[n]+=1/g}for(let e=0;e<256;e+=1)r.data[e]=.2126*i.data[e]+.7152*a.data[e]+.0722*o.data[e];const m=wC.getAllTags(s);for(const e in m)"string"==typeof m[e]&&(m[e]=m[e].replace(/\0/g,""));this.setState({data:m,histogramChannels:n,height:s.naturalHeight,width:s.naturalWidth,size:d,status:2},this.updateHistogram)})),t.startsWith("file:/")?re.Z.utilities.readImage(t).then((e=>{const t=new Uint8Array(e.data),n=new Blob([t],{type:e.type});d=n.size,l=URL.createObjectURL(n),s.src=l})).catch((e=>{this.setState({status:3})})):fetch(t).then((e=>e.blob())).then((e=>{d=e.size,l=URL.createObjectURL(e),s.src=l})).catch((e=>{this.setState({status:3})}))})):this.setState({status:0})};updateHistogram=()=>{let e=[];switch(this.state.histogramStyle){case 0:e=[this.state.histogramChannels[0]];break;case 1:e=[this.state.histogramChannels[1]];break;case 2:e=[this.state.histogramChannels[2]];break;case 4:e=[this.state.histogramChannels[3]];break;case 3:e=[this.state.histogramChannels[0],this.state.histogramChannels[1],this.state.histogramChannels[2]]}kC.clearRect(0,0,EC.width,EC.height),e.forEach((e=>{kC.beginPath(),kC.moveTo(0,EC.height);for(let t=0;t<e.data.length+1;t+=1){const s=Math.round(e.data[t]*EC.height);kC.lineTo(3*t,EC.height-s)}kC.lineTo(EC.width,EC.height),kC.strokeStyle=e.fill.css(),kC.fillStyle=e.fill.alpha(.3).css(),kC.fill(),kC.stroke(),kC.closePath()})),this.setState({histogramImage:EC.toDataURL()})};setHistogramStyle(e){this.setState({histogramStyle:e},this.updateHistogram)}_createClipboardData=()=>this.props.url+"\n\n"+this.state.width+" × "+this.state.height+"\n"+(0,iu.Z)(this.state.size)+"\n\n"+JSON.stringify(this.state.data,null,2);copyToClipboard=e=>{if(!(this.state.size&&this.state.width&&this.state.height))return;const t=this._createClipboardData();this.context.navigator.clipboard.writeText(t)};render(){if(!this.props.open)return null;const e=this.state.data,t=Object.keys(e).length>0&&e.DateTimeOriginal,s=decodeURI(this.props.url.split("/").pop()?.split("#")[0].split("?")[0].toString()??""),n=e.ExposureTime?e.ExposureTime.valueOf():void 0,i=e.Copyright??"";return(0,zn.jsxs)("div",{className:"image-inspector",style:this.style,children:[(0,zn.jsxs)("header",{children:[(0,zn.jsx)("h1",{children:s}),(0,zn.jsx)("button",{className:"close no-stroke",title:(0,W.Z)("Close inspector"),onClick:this.props.toggleImageInspector,dangerouslySetInnerHTML:{__html:Kn.kze}})]}),(0,zn.jsxs)("div",{className:"image-inspector-container",children:[1===this.state.status&&(0,zn.jsx)("p",{className:"in-progress",children:(0,W.Z)("Analyzing image...")}),3===this.state.status&&(0,zn.jsx)("p",{children:(0,W.Z)("Unable to analyze image.")}),2===this.state.status&&(0,zn.jsxs)("div",{className:"image-inspector-metadata",children:[(0,zn.jsxs)("div",{className:"image-histogram",children:[(0,zn.jsx)("img",{className:"histogram",title:(0,W.Z)("Histogram"),src:this.state.histogramImage}),(0,zn.jsxs)("div",{className:"toolbar text",children:[(0,zn.jsx)("button",{tabIndex:this.props.prefValues[Z.kKeyboardTabToAll],className:"button-toolbar "+(4===this.state.histogramStyle?"button-selected":""),onClick:()=>this.setHistogramStyle(4),children:(0,W.Z)("Brightness")}),(0,zn.jsx)("button",{tabIndex:this.props.prefValues[Z.kKeyboardTabToAll],className:"button-toolbar "+(3===this.state.histogramStyle?"button-selected":""),onClick:()=>this.setHistogramStyle(3),children:"RGB"}),(0,zn.jsxs)("span",{children:[(0,zn.jsx)("button",{tabIndex:this.props.prefValues[Z.kKeyboardTabToAll],className:"button-toolbar "+(0===this.state.histogramStyle?"button-selected":""),onClick:()=>this.setHistogramStyle(0),children:"R"}),(0,zn.jsx)("button",{tabIndex:this.props.prefValues[Z.kKeyboardTabToAll],className:"button-toolbar "+(1===this.state.histogramStyle?"button-selected":""),onClick:()=>this.setHistogramStyle(1),children:"G"}),(0,zn.jsx)("button",{tabIndex:this.props.prefValues[Z.kKeyboardTabToAll],className:"button-toolbar "+(2===this.state.histogramStyle?"button-selected":""),onClick:()=>this.setHistogramStyle(2),children:"B"})]})]})]}),t&&(0,zn.jsxs)("div",{className:"image-metadata-device",children:[(0,zn.jsx)("span",{className:"image-camera",dangerouslySetInnerHTML:{__html:Kn.b0l}}),(0,zn.jsxs)("h3",{children:["Canon"===e.Make?"":e.Make," ",e.Model]})]}),t&&(0,zn.jsxs)("div",{className:"image-metadata-core",children:[(0,zn.jsxs)("div",{title:(0,W.Z)("Aperture"),children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.S1h}}),e.FNumber&&`f/${e.FNumber.valueOf()}`]}),(0,zn.jsxs)("div",{title:(0,W.Z)("ISO Speed"),children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.KyY}}),e.ISOSpeedRatings&&e.ISOSpeedRatings]}),(0,zn.jsxs)("div",{title:(0,W.Z)("Exposure time"),children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.CKA}}),n&&n<1&&(0,W.Z)("1/$1 second","1/$1 seconds",[Math.round(1/n*100)/100]),n&&n>=1&&(0,W.Z)("$1 second","$1 seconds",[n])]}),(0,zn.jsxs)("div",{title:(0,W.Z)("Focal length"),children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.heI}}),(e.FocalLengthIn35mmFilm||e.FocalLength)&&`${e.FocalLengthIn35mmFilm?.valueOf()||e.FocalLength?.valueOf()||0} mm`]})]}),e.WhiteBalance&&(0,zn.jsxs)("div",{className:"image-white-balance",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("White Balance")}),e.LightSource&&"Unknown"!==e.LightSource?e.LightSource:e.WhiteBalance,e.kelvin&&(0,zn.jsx)("div",{className:"image-kelvinscale",children:(0,zn.jsxs)("span",{className:"kelvin-indicator",style:{left:(e.kelvin-2e3)/70+"%"},children:[e.kelvin,"K"]})})]}),this.state.width&&this.state.height&&(0,zn.jsx)(IC,{value:this.state.width+" × "+this.state.height+" ("+Math.round(this.state.height*this.state.width/1e5)/10+"MP)",name:(0,W.Z)("Dimensions")}),this.state.size&&(0,zn.jsx)(IC,{value:(0,iu.Z)(this.state.size),name:(0,W.Z)("Size")}),e.ColorSpace&&(0,zn.jsx)(IC,{value:`${e.ColorSpace}`,name:(0,W.Z)("Color Space")}),e.GPSLatitude&&e.GPSLatitudeRef&&e.GPSLongitude&&e.GPSLongitudeRef&&(0,zn.jsx)(xC,{windowId:this.context.vivaldiWindowId,GPSLatitude:e.GPSLatitude,GPSLatitudeRef:e.GPSLatitudeRef,GPSLongitude:e.GPSLongitude,GPSLongitudeRef:e.GPSLongitudeRef}),""!==i.trim()&&(0,zn.jsx)(IC,{value:i,name:(0,W.Z)("Copyright")}),e.DateTimeOriginal&&(0,zn.jsx)(IC,{value:e.DateTimeOriginal,name:(0,W.Z)("Captured at")}),e.Orientation&&(0,zn.jsx)(IC,{value:SC[e.Orientation-1],name:(0,W.Z)("Orientation")}),e.Software&&(0,zn.jsx)(IC,{value:e.Software,name:(0,W.Z)("Software")}),(0,zn.jsx)("div",{className:"toolbar text alldata-toolbar",children:(0,zn.jsx)("button",{ref:this.refButtonForTests,className:"button-toolbar",tabIndex:this.props.prefValues[Z.kKeyboardTabToAll],onClick:this.copyToClipboard,children:(0,W.Z)("Copy Data to Clipboard")})})]})]})]})}}const _C=(0,zd.Z)(NC,AC);class PC extends Un.PureComponent{static contextType=oi.Z;state={actionLog:[]};_actionLoggerChanged=e=>{const{actionType:t,...s}=e;let n=`${(new Date).toLocaleString()}: ${t.padEnd(35)}`;if(Object.keys(s).length>0){let e=!1;for(const[t,i]of Object.entries(s))try{let s=JSON.stringify(i);if(void 0===s&&(s="undefined"),n.length+s.length>160){e=!0;continue}n+=`${t}: ${s}, `}catch(t){e=!0}e&&(n+="...")}this.setState((e=>{const t=e.actionLog.concat(n);return t.length>500&&t.splice(0,1),{actionLog:t}}))};componentDidMount(){S.Z.setLogCallback(this._actionLoggerChanged)}componentWillUnmount(){S.Z.setLogCallback(void 0)}getContextMenuItems=()=>[{handler:()=>this.setState({actionLog:[]}),...(0,fi.Z)("Clear")}];onContextMenu=e=>{(0,mi.Z)(this.context,this.getContextMenuItems())(e)};render(){return(0,zn.jsx)("div",{className:"actionlog",id:"action_logger",tabIndex:"0",onContextMenu:this.onContextMenu,children:(0,zn.jsx)("textarea",{className:"actionlogs",readOnly:!0,value:this.state.actionLog.join("\n")})})}}const MC=PC;function DC({enabled:e,locked:t,fullName:s,description:n,onValueChange:i}){return(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:e,disabled:t,onChange:({currentTarget:e})=>i(e.checked)}),(0,zn.jsx)("span",{children:s})]}),(0,zn.jsx)("p",{className:"info",children:n})]})}var OC=(0,zn.jsx)("br",{});function jC(){return(0,zn.jsxs)("div",{className:"Experiments-Caution",children:[(0,W.Z)("These experimental features may change, break, disappear, not work as intended or at all."),OC,(0,W.Z)("Please proceed with caution.")]})}var LC=(0,zn.jsx)(jC,{});class RC extends Un.PureComponent{constructor(e){super(e),this.state={experiments:this.getFeatureFlags()}}getFeatureFlags=()=>Fn.Z.getFlags().filter((e=>!("chat"===e.name)));_handleChange=(e,t)=>{Fn.Z.enableFeature(e,t).then((()=>this.setState({experiments:this.getFeatureFlags()})))};render(){return(0,zn.jsxs)("div",{className:"Experiments vivaldi-settings",tabIndex:"0",children:[(0,zn.jsx)("h2",{className:"Experiments-Header",children:(0,W.Z)("Experimental features")}),LC,(0,zn.jsx)("div",{className:"setting-subgroup",children:this.state.experiments.map((e=>(0,zn.jsx)(DC,{fullName:e.friendlyName,description:e.description,locked:e.locked,enabled:e.value,onValueChange:this._handleChange.bind(null,e.name)},e.name)))})]})}}const BC="https://vvld.in/guest";function FC(e,t){t.preventDefault(),c.ZP.openURL(e,BC,{inCurrent:!1,inBackground:!1})}var WC=(0,zn.jsx)("svg",{className:"guest-intro-background",viewBox:"0 0 1244 860",children:(0,zn.jsx)("path",{fill:"url(#guest-intro-bg-gradient)",d:"M0 0h153.513c16.141 27.93 32.15 55.734 47.912 83.11 16.086 27.94 32.722 56.832 49.076 85.128 11.01 19.031 22.079 38.316 32.781 56.967 25.186 43.883 51.228 89.259 77.402 132.848 33.382 55.651 75.894 82.121 137.77 85.829 3.205.192 6.454.288 9.655.288 39.673 0 78.14-14.461 108.316-40.722 21.644-18.834 48.687-52.291 54.604-104.667.749-6.654 1.357-13.708 1.855-19.573-1.07-29.74-6.476-52.92-17.294-74.518C622.935 139.46 612.708 67.99 625.087 0h136.676C747.1 44.93 749.845 96.364 774.32 145.251c20.839 41.6 30.654 85.7 31.485 138.023-.568 6.192-1.472 18.273-2.83 30.356-17.572 155.524-149.172 263.318-294.866 263.318-5.816 0-11.67-.173-17.526-.521C382.84 569.97 301.9 518.174 246.822 426.358c-38.015-63.313-74.255-127.68-111.253-191.634C90.359 156.507 45.49 78.062 0 0zm1113.47 0H1244v140.1c-7.496 27.86-18.849 54.995-34.031 81.275a1299530.57 1299530.57 0 0 1-170.255 294.799A1223193.145 1223193.145 0 0 0 841.018 860.24H687.72c135.675-235.123 271.527-470.147 407.26-705.25 22.311-38.621 31.22-79.696 25.368-124.548A170.12 170.12 0 0 0 1113.471 0z"})});class UC extends Un.Component{static contextType=oi.Z;render(){return(0,zn.jsxs)("div",{className:"guest-intro",children:[WC,(0,zn.jsxs)("div",{className:"guest-intro-content",children:[(0,zn.jsx)("h1",{children:(0,W.Z)("title","Guest Profile")}),(0,zn.jsx)("span",{className:"guest-intro-icon",dangerouslySetInnerHTML:{__html:Kn.CtH.large}}),(0,zn.jsx)("p",{children:(0,W.Z)("Browsing with a Guest profile means that searches, sites visited, cookies, and temporary files won’t be stored by Vivaldi. It does not encrypt or otherwise modify your connection.")}),(0,zn.jsx)("p",{children:(0,zn.jsx)("a",{tabIndex:0,href:BC,onClick:e=>FC(this.context.vivaldiWindowId,e),children:(0,W.Z)("Learn more about Guest Profiles")})})]})]})}}const VC=UC;var HC=s(36964);class GC extends Vo.Z{dispatchAction(e){this.emitChange(e)}}const KC=new GC(S.Z);class zC extends Un.Component{onRequestClose=()=>{this.props.onRequestClose?this.props.onRequestClose():this.props.onClose(!1)};onClose=()=>{this.props.onClose(!1)};onConfirmed=()=>{this.props.onClose(!0)};renderDialog=()=>(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("div",{className:"dialog-content",children:this.props.prompt.map((e=>(0,zn.jsx)("p",{children:e},e)))}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"submit",className:this.props.danger?"danger":null,value:this.props.positive,onClick:this.onConfirmed,autoFocus:!this.props.danger}),!this.props.hideNegative&&(0,zn.jsx)("input",{type:"button",value:this.props.negative,onClick:this.onClose,autoFocus:this.props.danger})]})]});render(){return this.props.preventInnerModal?(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("div",{className:"dialog-header",children:(0,zn.jsx)("h1",{className:"dialog-title",children:this.props.title})}),this.renderDialog()]}):(0,zn.jsx)(Ha.Z,{className:"slide",style:{width:this.props.dialogWidth||400,minWidth:"unset"},onRequestClose:this.onRequestClose,title:this.props.title,children:this.renderDialog()})}}const $C=zC;var YC=s(13933);const XC="https://",QC={width:400,minWidth:"unset"};function qC({onCreateLink:e,onCancelCreateLink:t,anchorOrSelection:s,isAnchor:n,useAddress:i}){const a=Un.useRef(),o=i?s?(0,W.Z)("Edit Address"):(0,W.Z)("Add Address"):n&&s?(0,W.Z)("Edit Link"):(0,W.Z)("Create Link");let r;return r=n||s.startsWith("http")?s:XC+s,(0,zn.jsx)(Ha.Z,{style:QC,onRequestClose:t,title:o,children:(0,zn.jsxs)("form",{onSubmit:()=>{e(a.current?(0,Ar.q9)(a.current.value):XC)},children:[(0,zn.jsx)("div",{className:"dialog-content",children:(0,zn.jsx)("input",{ref:a,defaultValue:r,type:"text",autoFocus:!0,onFocus:e=>e.currentTarget.select()})}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"submit",className:"primary",value:(0,W.Z)("Save Link")}),(0,zn.jsx)("input",{type:"button",onClick:t,value:(0,W.Z)("Cancel")})]})]})})}const JC=[[{command:"bold",text:(0,W.Z)("Bold"),icon:Kn.q7H},{command:"italic",text:(0,W.Z)("Italic"),icon:Kn.znb},{command:"underline",text:(0,W.Z)("Underline"),icon:Kn.slH},{command:"strikeThrough",text:(0,W.Z)("Strike through"),icon:Kn._QD}],[{command:"justifyLeft",text:(0,W.Z)("Left align"),icon:Kn.W_c},{command:"justifyCenter",text:(0,W.Z)("Center align"),icon:Kn.vxN},{command:"justifyRight",text:(0,W.Z)("Right align"),icon:Kn.JUc},{command:"justifyFull",text:(0,W.Z)("Justify"),icon:Kn.FsT}],[{command:"insertOrderedList",text:(0,W.Z)("Numbered list"),icon:Kn.o_D},{command:"insertUnorderedList",text:(0,W.Z)("Bullet list"),icon:Kn.rr$}],[{command:"outdent",text:(0,W.Z)("Remove indentation"),icon:Kn.XKb},{command:"indent",text:(0,W.Z)("Indent"),icon:Kn.b2r}],[{command:"createLink",text:(0,W.Z)("Create Link"),icon:Kn.v2I},{command:"insertImage",text:(0,W.Z)("Insert Image"),icon:Kn.kkq}],[{command:"undo",text:(0,W.Z)("win_linux","Undo"),icon:Kn.LwO},{command:"redo",text:(0,W.Z)("win_linux","Redo"),icon:Kn.W9w}],[{command:"removeFormat",text:(0,W.Z)("Remove formatting"),icon:Kn.mHT}]];class ew extends Un.Component{isAnchor=!1;anchorOrSelection="";state={buttonState:[],createLinkModalOpen:!1,formatBlock:"p",fontName:"sans-serif",fontSize:"2",foreColor:"#111111",backColor:"#f6f6f6",minimizeToolbar:!!this.props.isSignature};updateButtonState=e=>{const t=JC.flat().map((e=>e.command)).indexOf("createLink"),s=e&&e[0]||[];s[t]=Boolean(this.isAnchor&&this.anchorOrSelection),this.setState({buttonState:s})};updateDropdownAndColorState=e=>{if(Array.isArray(e)&&1===e.length&&Array.isArray(e[0])){const[t,s,n,i,a]=e[0];this.setState({formatBlock:""===t||"div"===t?"p":t,fontName:s.startsWith('"')&&s.endsWith('"')?s.substring(1,s.length-1):s,fontSize:n,foreColor:"rgb(0, 0, 0)"===i?"#111111":Be()(i).hex(),backColor:"rgba(0, 0, 0, 0)"===a?"#f6f6f6":Be()(a).hex()})}};updateLinkState=e=>{this.isAnchor=e.isAnchor,this.anchorOrSelection=e.anchorOrSelection};onCreateLink=e=>{this.setState({createLinkModalOpen:!1}),this.props.onCreateLink(e)};onCancelCreateLink=()=>{this.setState({createLinkModalOpen:!1}),this.props.onCancelCreateLink()};showCreateLinkModal=()=>this.setState({createLinkModalOpen:!0});render(){let e=0;return(0,zn.jsxs)(zn.Fragment,{children:[this.state.createLinkModalOpen&&(0,zn.jsx)(qC,{onCreateLink:this.onCreateLink,onCancelCreateLink:this.onCancelCreateLink,isAnchor:this.isAnchor,anchorOrSelection:this.anchorOrSelection}),(0,zn.jsxs)("div",{className:"editor-html-toolbar",children:[!this.state.minimizeToolbar&&(0,zn.jsxs)(Fa.Z,{onChange:e=>this.props.onChange("formatBlock",e),value:this.state.formatBlock,title:(0,W.Z)("Paragraph Format"),tabIndex:"-1",children:[(0,zn.jsx)("option",{value:"h1",children:(0,W.Z)("Heading 1")}),(0,zn.jsx)("option",{value:"h2",children:(0,W.Z)("Heading 2")}),(0,zn.jsx)("option",{value:"h3",children:(0,W.Z)("Heading 3")}),(0,zn.jsx)("option",{value:"h4",children:(0,W.Z)("Heading 4")}),(0,zn.jsx)("option",{value:"p",children:(0,W.Z)("Paragraph")}),(0,zn.jsx)("option",{value:"pre",children:(0,W.Z)("Preformatted")}),(0,zn.jsx)("option",{value:"blockquote",children:(0,W.Z)("Quote")})]}),(0,zn.jsxs)(Fa.Z,{onChange:e=>this.props.onChange("fontName",e),value:this.state.fontName,title:(0,W.Z)("Font"),tabIndex:"-1",children:[(0,zn.jsx)("option",{value:"serif",children:(0,W.Z)("Serif")}),(0,zn.jsx)("option",{value:"sans-serif",children:(0,W.Z)("Sans-Serif")}),(0,zn.jsx)("option",{value:"monospace",children:(0,W.Z)("Fixed Width")})]}),!this.state.minimizeToolbar&&(0,zn.jsxs)(Fa.Z,{onChange:e=>this.props.onChange("fontSize",e),value:this.state.fontSize,title:(0,W.Z)("Font Size"),tabIndex:"-1",children:[(0,zn.jsx)("option",{value:"1",children:(0,W.Z)("Extra Small")}),(0,zn.jsx)("option",{value:"2",children:(0,W.Z)("mail","Small")}),(0,zn.jsx)("option",{value:"3",children:(0,W.Z)("Normal")}),(0,zn.jsx)("option",{value:"4",children:(0,W.Z)("mail","Large")}),(0,zn.jsx)("option",{value:"5",children:(0,W.Z)("Larger")}),(0,zn.jsx)("option",{value:"6",children:(0,W.Z)("Extra Large")})]}),JC.map(((t,s)=>{s>0&&(e+=JC[s-1].length);const n=this.props.isSignature?t.filter((e=>"insertImage"!==e.command&&(!this.state.minimizeToolbar||!["insertOrderedList","insertUnorderedList","outdent","indent","undo","redo","removeFormat"].includes(e.command)))):t;if(0!==n.length)return(0,zn.jsx)("span",{className:"editor-button-group",children:n.map(((t,s)=>(0,zn.jsx)("button",{tabIndex:"-1",onClick:()=>this.props.onClick(t.command),title:t.text,className:this.state.buttonState[e+s]?"active":null,dangerouslySetInnerHTML:{__html:t.icon}},t.command)))},s)})),(0,zn.jsx)("input",{type:"color",tabIndex:"-1",className:"text-color",title:(0,W.Z)("Text Color"),value:this.state.foreColor,onChange:e=>this.props.onChangeColor("foreColor",e)}),!this.state.minimizeToolbar&&(0,zn.jsx)("input",{type:"color",tabIndex:"-1",className:"text-bg-color",title:(0,W.Z)("Text Background Color"),value:this.state.backColor,onChange:e=>this.props.onChangeColor("backColor",e)}),this.props.isSignature&&(0,zn.jsx)("span",{className:"editor-button-group",children:(0,zn.jsx)("button",{tabIndex:"-1",style:{float:"right"},onClick:()=>this.setState((e=>({minimizeToolbar:!e.minimizeToolbar}))),title:this.state.minimizeToolbar?(0,W.Z)("Show more"):(0,W.Z)("Show less"),dangerouslySetInnerHTML:{__html:this.state.minimizeToolbar?Kn.yaZ.small:Kn.OCp.small}})})]})]})}}const tw=["colorFg","colorFgAlpha","colorFgIntense","colorBg","colorBgIntense","colorBgDark","colorBorder","colorHighlightBg","colorHighlightBgAlpha","colorBorder","radiusRounded"];var sw=s(65741);const nw=[...tw,"colorBgLighter","colorFgFadedMore"];class iw extends Un.Component{static contextType=oi.Z;refWebview=Un.createRef();#ue=[];constructor(e,t){super(e);const s=Ue.Z.getBaseStylesByWindowId(t.vivaldiWindowId,nw);this.state={windowStyle:s}}componentDidMount(){Ue.Z.addListener(this.onThemeStoreChanged),this.refWebview.current?.addEventListener("consolemessage",this.handleConsoleMessage),this.refWebview.current?.addEventListener("contentload",this.handleContentLoad),this.refWebview.current?.addEventListener("newwindow",this.handleLinkClicked),re.Z.tabsPrivate.onKeyboardChanged.addListener(this.keyEventListener)}componentWillUnmount(){this.#ue.forEach((e=>URL.revokeObjectURL(e))),Ue.Z.removeListener(this.onThemeStoreChanged),this.refWebview.current?.removeEventListener("consolemessage",this.handleConsoleMessage),this.refWebview.current?.removeEventListener("contentload",this.handleContentLoad),this.refWebview.current?.removeEventListener("newwindow",this.handleLinkClicked),re.Z.tabsPrivate.onKeyboardChanged.removeListener(this.keyEventListener)}onThemeStoreChanged=()=>{const e=Ue.Z.getBaseStylesByWindowId(this.context.vivaldiWindowId,nw);(0,sw.Z)(e,this.state.windowStyle)||this.setState({windowStyle:e},this.setStyle)};static defaultProps={hidden:!1};focus(){return this.refWebview.current?.focus()}blur(){return this.refWebview.current?.blur()}hasFocus(){const{document:e}=this.context;return!!this.refWebview.current&&this.refWebview.current===e.activeElement}getContentAsBodyParts=()=>{const e=this.refWebview.current;return e?new Promise(((t,s)=>{e.executeScript({code:"document.body.innerHTML"},(e=>{e&&Array.isArray(e)&&"string"==typeof e[0]?t([{type:"html",content:e[0]}]):s("RichTextEdit.getContentAsBodyParts: Couldn't get content from Webview")}))})):Promise.reject("RichTextEdit.getContentAsBodyParts: Webview doesn't exist")};getWebview=()=>{const e=this.refWebview.current;if(!e)throw new Error("RichTextEdit.getContentAsBodyParts: Webview doesn't exist");return e};postMessage=e=>{this.refWebview.current?.contentWindow?.postMessage?.(e,"*")};setContent=e=>{this.postMessage({type:"SET_CONTENT",content:e})};setStyle=()=>{let e=Si.ZP.createStyleRoot(this.state.windowStyle);e+=this.props.isNote?"\n    html, body, iframe {\n      background-color: var(--colorBg);\n      padding: 0;\n      margin: 0;\n      font-family: sans-serif;\n      overflow: initial;\n    }\n    body[contenteditable=\"plaintext-only\"] {\n      font-family: monospace;\n    }\n    body {\n      --EditorPadding: 12px;\n      --MaxWidth: 700px;\n      margin-left: var(--EditorPadding);\n      padding-left: calc(calc(50% - calc(var(--MaxWidth) / 2) - var(--EditorPadding))) !important;\n      padding-right: calc(50% - calc(var(--MaxWidth) / 2)) !important;\n      padding-top: var(--EditorPadding);\n      padding-bottom: calc(var(--EditorPadding) * 3);\n      color: var(--colorFgIntense);\n      font-size: 100%;\n      cursor: text;\n    }\n    img {\n      display: inline-block;\n      vertical-align: top;\n      max-width: 100%;\n      height: auto;\n    }\n    a:-webkit-any-link {\n      color: var(--colorHighlightBg);\n      cursor: pointer;\n    }\n  \n    html {\n      width: calc(100% - 12px);\n    }\n    html, body, iframe {\n      font-size: 100%;\n    }\n    input[type=checkbox] {\n      appearance: none;\n      position: relative;\n      width: 16px;\n      height: 16px;\n      min-width: 16px;\n      min-height: 16px;\n      vertical-align: middle;\n      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1) inset;\n      margin: unset;\n      border-width: 1px;\n      border-style: solid;\n      border-color: rgba(0,0,0,0.2);\n      background-color: var(--colorBgIntense);\n    }\n    input[type='checkbox']:disabled {\n      opacity: 1;\n      filter: grayscale(1);\n    }\n    input[type=checkbox]:before,\n    input[type=checkbox]:after {\n      content: '';\n      position: absolute;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background-color: var(--colorHighlightBg);\n      transform-origin: 0 0;\n    }\n    input[type=checkbox]:before {\n      transform: rotate(-45deg) translateY(45%) translateX(-30%) scaleX(0.25) scaleY(0);\n    }\n    input[type=checkbox]:checked:before {\n      transform: rotate(-45deg) translateY(45%) translateX(-30%) scaleX(0.25) scaleY(0.4);\n    }\n    input[type=checkbox]:after {\n      transform: rotate(225deg) translateY(-30%) translateX(-95%) scaleX(0.25) scaleY(0);\n    }\n    input[type=checkbox]:checked:after {\n      transform: rotate(225deg) translateY(-30%) translateX(-95%) scaleX(0.25) scaleY(1.2);\n    }\n    \n    .tooltip {\n      --TipWidth: 480px;\n      position: relative;\n    }\n    .tooltip .tooltip-text * {\n      user-select: none;\n    }\n    .tooltip-text input {\n      margin-left: 3px;\n      border: 1px solid var(--colorBorder);\n      border-radius: 2px;\n      font-size: 13px;\n      opacity: 0.8;\n      color: var(--colorFg);\n      background-color: var(--colorBg);\n    }\n    .tooltip-text input:active {\n      background-color: var(--colorBgDark);\n    }\n    .tooltip-text input:first-of-type {\n      margin-left: 12px;\n    }\n    .tooltip-text a {\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      color: var(--colorFg);\n    }\n    .tooltip .tooltip-text {\n      cursor: default;\n      position: absolute;\n      z-index: 1;\n      display: flex;\n      align-items: center;\n      top: 100%;\n      left: -6px;\n      max-width: var(--TipWidth);\n      padding: 6px 6px 6px 12px;\n      color:var(--colorFg);\n      background-color: var(--colorBg);\n      border: 1px solid var(--colorBgDark);\n      box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.1), 0 3px 10px rgba(0, 0, 0, 0.3);\n      border-radius: 3px;\n    }\n  \n  ":function(e=!1){const t="black_on_white"===A.Z.get(Z.kMailComposerColors);return`html, body {\n      overflow: initial;\n    }\n    body {\n      margin: ${e?"6px":"12px 24px 24px"};\n      font-family: sans-serif;\n      font-size: 100%;\n      color: ${t?"black;":"var(--colorFgIntense)"};\n      background-color: ${t?"white;":"var(--colorBgIntense)"};\n    }\n    img {\n      display: inline-block;\n      vertical-align: top;\n      max-width: 100%;\n      height: auto;\n    }\n    [contenteditable] {\n      cursor: text;\n    }\n    blockquote {\n      padding-inline-start: 18px;\n      border-left: 3px solid inherit;\n      margin: 0;\n      opacity: 0.85;\n    }\n    pre {\n      white-space: pre-wrap;\n    }\n    \n    .tooltip {\n      --TipWidth: 480px;\n      position: relative;\n    }\n    .tooltip .tooltip-text * {\n      user-select: none;\n    }\n    .tooltip-text input {\n      margin-left: 3px;\n      border: 1px solid var(--colorBorder);\n      border-radius: 2px;\n      font-size: 13px;\n      opacity: 0.8;\n      color: var(--colorFg);\n      background-color: var(--colorBg);\n    }\n    .tooltip-text input:active {\n      background-color: var(--colorBgDark);\n    }\n    .tooltip-text input:first-of-type {\n      margin-left: 12px;\n    }\n    .tooltip-text a {\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      color: var(--colorFg);\n    }\n    .tooltip .tooltip-text {\n      cursor: default;\n      position: absolute;\n      z-index: 1;\n      display: flex;\n      align-items: center;\n      top: 100%;\n      left: -6px;\n      max-width: var(--TipWidth);\n      padding: 6px 6px 6px 12px;\n      color:var(--colorFg);\n      background-color: var(--colorBg);\n      border: 1px solid var(--colorBgDark);\n      box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.1), 0 3px 10px rgba(0, 0, 0, 0.3);\n      border-radius: 3px;\n    }\n  `}(this.props.isSignature),this.postMessage({type:"SET_STYLE",isNote:this.props.isNote,style:e})};debouncedUpdateState=(0,Te.Z)((()=>{this.props.updateButtonState(),this.props.updateDropdownAndColorState()}),100);handleConsoleMessage=e=>{let t,s;const n=e.message.indexOf(" ");switch(-1===n?(t=e.message,s=""):(t=e.message.substring(0,n),s=e.message.substring(n+1)),t){case"selectionchange":this.debouncedUpdateState();const n=s.startsWith("anchor"),i=s.substring(7);this.props.handleLinkEvent({type:t,isAnchor:n,anchorOrSelection:i});break;case"input":this.debouncedUpdateState(),this.props.onChange(e);break;case"createLink":case"editLink":case"copyLink":case"unlink":this.props.handleLinkEvent({type:t});break;case"dragover":{const e={dataTransfer:{types:s?s.split(","):[]}};this.props.onDragOver?.(e);break}default:throw new Error(e.message)}};handleLinkClicked=e=>{e.targetUrl.startsWith("#")||(c.ZP.openURL(this.context.vivaldiWindowId,e.targetUrl),e.preventDefault())};handleContentLoad=()=>{this.setStyle(),this.props.onContentLoad?.(),this.postMessage({type:"CONTENT_LOAD_REPLY",translatedStrings:{copyValue:(0,W.Z)("link","Copy"),copyTitle:(0,W.Z)("Copy Link Address"),editValue:(0,W.Z)("link","Edit"),editTitle:(0,W.Z)("Edit Link Address"),unlinkValue:(0,W.Z)("link","Remove"),unlinkTitle:(0,W.Z)("Remove Link")}})};keyEventListener=(e,t,s,n,i)=>{const{document:a}=this.context;1===s&&t&&n===mo.Z.KEY_TAB&&a.activeElement&&a.activeElement===this.refWebview.current&&this.props.focusPreviousElement()};execCommand=(e,t,s=!0)=>{this.postMessage({type:"EXEC_COMMAND",command:e,value:t}),s&&setTimeout((()=>this.refWebview.current?.focus()),0)};onChange=(e,t)=>{this.execCommand(e,t.currentTarget.value),this.props.updateDropdownAndColorState()};onClick=e=>{switch(e){case"createLink":this.props.handleLinkEvent({type:"createLinkClicked"});break;case"insertImage":this.insertImage();break;default:this.execCommand(e,""),this.props.updateButtonState()}};insertImage=async()=>{const{showOpenFilePicker:e}=this.context,[t]=await e({types:[{description:"Images",accept:{"image/*":[".png",".gif",".jpeg",".jpg"]}}]}),s=await t.getFile(),n=URL.createObjectURL(s);this.#ue.push(n),this.execCommand("insertHTML",`<img src="${n}" ${zc.ZR}="${s.type}" ${zc.Gx}="${t.name}" />`)};unlink=()=>{this.execCommand("unlink",!1)};selectSurrounding=()=>{this.postMessage({type:"SELECT_SURROUNDING"})};setZoomLevel=e=>{const t=this.refWebview.current;t&&(t.setZoomMode("per-view"),t.setZoom(e))};executeScript=e=>new Promise(((t,s)=>{this.refWebview.current?this.refWebview.current.executeScript(e,t):s()}));render(){return(0,zn.jsx)("webview",{className:"editor-webview",name:"richtexteditor",ref:this.refWebview,style:this.props.hidden||this.props.disabled?{display:"none"}:{},allowtransparency:"on",src:'data:text/html,<html id="content" tabindex="-1">\n  <head>\n    <style id="richtextstyle"></style>\n    <link id="stylesheet"></link>\n    <script src="chrome-extension://mpognobbkildjkofajifpdfhcoklimli/richtexteditor-bundle.js"><\/script>\n  </head>\n  <body class="MarkdownRender" contenteditable="true">\n  </body>\n</html>\n'})}}function aw(e,t){const[s,n]=(0,Un.useState)(!1),i=(0,Un.useCallback)((e=>{e.dataTransfer.types.includes("Files")&&n(!0)}),[]),a=(0,Un.useCallback)((e=>{e.target===e.currentTarget&&(e.preventDefault(),n(!1))}),[]),o=(0,Un.useCallback)((t=>{n(!1);const s=[...t.dataTransfer.items].filter((e=>"file"===e.kind)).map((e=>e.getAsFile()));s.length>0&&(t.preventDefault(),e(s))}),[e]);return(0,Un.useEffect)((()=>{const e=t?.current;s?e?.style.setProperty("pointer-events","none"):e?.style.removeProperty("pointer-events")}),[t,s]),{canDropFile:s,onDragLeave:a,onDragOver:i,onDrop:o}}async function ow(e){const t=["attached-pending"],s=crypto.randomUUID();try{return await re.Z.mailPrivate.writeBufferToMessageFile(t,s,e),s}catch(e){throw new Error(`Failed to write attachment buffer (${s}) to disk: ${e}`)}}const rw=(0,Un.forwardRef)(((e,t)=>{const s=(0,Un.useRef)(null),n=(0,Un.useRef)(null);function i(){const e=s.current?.refWebview.current;e&&e.executeScript({code:"['formatBlock', 'fontName', 'fontSize', 'foreColor', 'backColor'].map(\n         command => document.queryCommandValue(command));"},(e=>{n.current&&n.current.updateDropdownAndColorState(e)}))}(0,Un.useImperativeHandle)(t,(()=>({focus:()=>{s.current&&s.current.focus()},getContentAsBodyParts:()=>{if(!s.current)throw new Error("MailComposer: Building body parts after body is gone");return s.current.getContentAsBodyParts()},getWebview:()=>{if(!s.current)throw new Error("MailComposer: Getting webview body is gone");return s.current.getWebview()},setContent:e=>{s.current?.setContent(e)}})),[]);const{canDropFile:a,onDragLeave:o,onDragOver:r,onDrop:l}=e.onSignatureAttachmentDrop?(d=s.current?.refWebview,c=e.onSignatureAttachmentDrop,aw((0,Un.useCallback)((async e=>{for(const t of e){if(t.size>2e6){ls.Z.warn("Mail",["signature"],`Image ${t.name} is too large (over 2MB) to add to signature`);continue}const e=await new Promise(((e,s)=>{const n=new FileReader;n.onloadend=({currentTarget:t})=>{const{result:n}=t;n.startsWith("data:image/")?e(n):s("Not an image")},n.readAsDataURL(t)}));await new Promise(((t,s)=>{if(d&&d.current){let n="";d.current.executeScript({code:"document.body.innerHTML"},(i=>{i&&Array.isArray(i)&&"string"==typeof i[0]?(n=String(i[0])+`<div><img alt="" src="${e}"></div>`,n&&(d.current?.executeScript({code:`document.body.innerHTML = unescape('${escape(n)}');`}),c(n)),t()):s("RichTextEdit.getContentAsBodyParts: Couldn't get contet from Webview")}))}}))}}),[c,d]),d)):function(e,t){return aw((0,Un.useCallback)((async t=>{const s=[];for(const n of t){if(n.size>Nt.gh&&"cancel"===await ue.Z.showLargeAttachmentWarning(n.name,n.size))continue;let t;try{t=await n.arrayBuffer()}catch(t){console.error("useAttachmentDrop: "+t.toString()),h.Z.setStatus(e,t.toString());continue}const i=await ow(t);s.push({type:"attachment",content:i,filename:n.name,mimeType:n.type,fileSize:t.byteLength})}HC.Z.addAttachments(s)}),[e]),t)}(e.windowId,s.current?.refWebview);var d,c;const u=!!e.onSignatureAttachmentDrop;return(0,zn.jsxs)("div",{className:"editor-html",children:[(0,zn.jsx)(ew,{ref:n,onClick:function(e){s.current&&s.current.onClick(e)},onCreateLink:function(e){const t=s.current;t&&(""===e?t.execCommand("unlink"):"https://"!==e&&t.execCommand("createLink",e),t.focus())},onCancelCreateLink:function(){s.current&&s.current.focus()},onChange:function(e,t){s.current&&s.current.execCommand(e,t.currentTarget.value),i()},onChangeColor:function(e,t){const n=s.current;n&&n.execCommand(e,t.currentTarget.value,!1)},isSignature:u}),a&&(0,zn.jsx)("div",{className:"file-dropzone",onDragLeave:o,onDrop:l,onDragOver:e=>e.preventDefault(),children:(0,zn.jsx)("h1",{children:(0,W.Z)("Drop file(s) here")})}),(0,zn.jsx)(iw,{ref:s,isSignature:u,onChange:e.onBodyChange,onDragOver:r,onContentLoad:e.onContentLoad,focusPreviousElement:e.focusPreviousElement,updateDropdownAndColorState:i,updateButtonState:function(){const e=s.current?.refWebview.current,t='"'+JC.flat().map((e=>e.command)).join('","')+'"';e&&e.executeScript({code:`[${t}].map(command => document.queryCommandState(command));`},(e=>{n.current&&n.current.updateButtonState(e)}))},handleLinkEvent:function(e){const t=n.current;if(!t)return;const{isAnchor:i,anchorOrSelection:a}=t;switch(e.type){case"selectionchange":t.updateLinkState(e);break;case"createLink":case"editLink":t.showCreateLinkModal();break;case"copyLink":break;case"unlink":i&&a&&s.current?.unlink();break;case"createLinkClicked":i&&a&&s.current?.selectSurrounding(),t.showCreateLinkModal()}}})]})})),lw=rw,dw=(e,t)=>{for(const s of e){let e=!1;for(const n of t)0!==n.indexOf(s)||(e=!0);if(!e)return!1}return!0};var cw=s(78614);function hw(e,t){const s=/[\S]+/g;let n=[];if(e&&(n=n.concat(e.match(s)||[])),t){const e=t.match(/[^@.+]+/g)||[];n=n.concat([...e,...t.split("@"),t])}return new Set(n.map((e=>e.toLowerCase())))}function uw(e,t,s=[],n,i){const a=Ci()(((e,t)=>{const s=new Map(e);return t.forEach((({address:e,name:t})=>{s.has(e)&&s.delete(e)})),s}))(t,s);return Ci()(((e,t)=>{const s=i?[{address:e}]:[];for(const[n,i]of t){(0===i.size?new Set([""]):i).forEach((t=>{if(e.length>0){const i=hw(e),a=hw(t,n);dw(i,a)&&s.push({address:n,name:t})}else s.push({address:n,name:t})}))}return n?.resetSelectionModel(),n?.setIndexSelected(0,!0),s}))(e,a)}class pw extends Un.Component{refMultiInputOptions={};selectionModel=new si;constructor(e){super(e),this.state={filteredList:[],inputValue:"",dropDownVisible:!1,isEditing:!1,selectedIndex:-1}}isMetaKeyPressed=!1;onKeyArrowUp=()=>{const e=this.selectionModel.leadIndex;if(e>0){this.selectionModel.resetSelectionModel(),this.selectionModel.setIndexSelected(e-1,!0);const t=this.refMultiInputOptions["option_"+(e-1)];t&&t.scrollIntoViewIfNeeded(),this.forceUpdate()}};onKeyArrowDown=()=>{const e=this.selectionModel.leadIndex;if(e<this.state.filteredList.length-1){this.selectionModel.resetSelectionModel(),this.selectionModel.setIndexSelected(e+1,!0);const t=this.refMultiInputOptions["option_"+(e+1)];t&&t.scrollIntoViewIfNeeded(),this.forceUpdate()}};inputChanged=e=>{const t=this.refInputField?this.refInputField.value:"";this.props.onChange&&this.props.onChange(e);const s=uw(t,this.props.allItems,this.props.selectedItems,this.selectionModel,this.props.showTypedTextAsOption);let n=!0;0!==t.length&&0!==s.length||(n=!1);const i=this.props.setIsValidInput;if(i){let e=!1;if(t.trim().length>0){const s=(0,cw.D$)(t);if(s.length>0){const t=s[0];(0,cw.HZ)(t.address)&&(e=!0)}}i(e)}this.setState({inputValue:t,filteredList:s,dropDownVisible:n})};onOptionClick=e=>{this.selectOption(e)};onItemClick=e=>{this.removeOption(e,!0)};removeOption=(0,Te.Z)(((e,t)=>{const s=this.props.selectedItems,[n]=s.splice(e,1),i=t?e:Math.max(e-1,0);this.setState(((e,a)=>(a.itemSelectionCallback(s),{isEditing:t,selectedIndex:s.length>0?i:-1,inputValue:t?(0,cw.li)(n):""})),(()=>{this.state.isEditing||-1===this.state.selectedIndex?this.focusInput():this.focusItem(i)}))}));inputConfirmed=e=>{let t=!1;if(e&&e.value&&e.value.trim().length>0){let s="";const n=this.props.selectedItems,i=(0,cw.D$)(e.value);for(;i.length>0;){const e=i.shift();if(!(0,cw.HZ)(e.address)){i.unshift(e),s=(0,cw.Rz)(i);break}-1===this.state.selectedIndex?n.push(e):n.splice(this.state.selectedIndex,0,e),t=!0}t&&(this.setState((e=>({isEditing:!1,inputValue:s,dropDownVisible:!1})),(()=>this.focusItem(this.state.selectedIndex))),this.props.itemSelectionCallback(n))}return t};selectAll=()=>{this.selectionModel.resetSelectionModel(),this.setState(((e,t)=>(t.itemSelectionCallback([]),{inputValue:t.selectedItems.map((e=>(0,cw.li)(e))).join(", "),dropDownVisible:!1})),(()=>this.refInputField&&this.refInputField.select()))};selectOption=e=>{e.address.length<3||(this.selectionModel.resetSelectionModel(),this.setState(((t,s)=>{const n=s.selectedItems;return-1===t.selectedIndex?n.push(e):n.splice(t.selectedIndex,0,e),s.itemSelectionCallback(n),{isEditing:!1,inputValue:"",dropDownVisible:!1}}),(()=>this.focusItem(this.state.selectedIndex))))};inputKeyUp=()=>{this.isMetaKeyPressed=!1};inputKeyDown=e=>{const t=e.keyCode;t===mo.Z.KEY_CONTROL&&(this.isMetaKeyPressed=!0);const s=!this.refInputField||0===this.refInputField.value.trim().length,n=this.state.filteredList[this.selectionModel.leadIndex],i=t===mo.Z.KEY_TAB||t===mo.Z.KEY_RETURN;if(s&&this.isMetaKeyPressed&&"a"===e.key)return this.selectAll(),e.preventDefault(),void e.stopPropagation();this.state.dropDownVisible&&void 0!==n&&i?(this.selectOption(n),e.preventDefault(),e.stopPropagation()):i||","===e.key?(this.inputConfirmed(this.refInputField)&&e.preventDefault(),e.stopPropagation()):t===mo.Z.KEY_ESCAPE?this.state.dropDownVisible?this.setState({dropDownVisible:!1}):this.inputConfirmed(this.refInputField)?e.preventDefault():(this.onKeyArrowLeft(),e.preventDefault(),e.stopPropagation()):this.state.dropDownVisible&&t===mo.Z.KEY_DOWN?(this.onKeyArrowDown(),e.preventDefault()):this.state.dropDownVisible&&t===mo.Z.KEY_UP?(this.onKeyArrowUp(),e.preventDefault()):!s||t!==mo.Z.KEY_LEFT&&t!==mo.Z.KEY_BACK_SPACE?s&&t===mo.Z.KEY_RIGHT&&(this.onKeyArrowRight(),e.preventDefault(),e.stopPropagation()):(this.onKeyArrowLeft(),e.preventDefault(),e.stopPropagation())};onKeyArrowLeft=()=>{let e;const t=-1===this.state.selectedIndex;e=this.state.isEditing?this.state.selectedIndex-1:t?this.props.selectedItems.length-1:Math.max(this.state.selectedIndex-1,-1),this.setState({selectedIndex:e,isEditing:!1,inputValue:"",dropDownVisible:!1},(()=>{e<0?this.focusInput():this.focusItem(e)}))};onKeyArrowRight=()=>{const e=this.state.selectedIndex+1;e===this.props.selectedItems.length?this.setState({isEditing:!1,selectedIndex:-1},(()=>this.focusInput())):this.setState((t=>({isEditing:!1,selectedIndex:e})),(()=>this.focusItem(e)))};inputLostFocus=e=>{this.props.clearInputOnBlur&&this.inputConfirmed(this.refInputField),this.setState({dropDownVisible:!1})};itemKeyDown=(e,t)=>{const s=t.keyCode;if(this.state.dropDownVisible&&e===this.props.selectedItems.length-1&&this.focusInput(),s===mo.Z.KEY_LEFT)this.onKeyArrowLeft(),t.preventDefault(),t.stopPropagation();else if(s===mo.Z.KEY_RIGHT)this.onKeyArrowRight(),t.preventDefault(),t.stopPropagation();else if(s===mo.Z.KEY_BACK_SPACE||s===mo.Z.KEY_DELETE)this.removeOption(e),t.preventDefault(),t.stopPropagation();else if(s===mo.Z.KEY_RETURN){const t=!0;this.removeOption(e,t)}else s===mo.Z.KEY_ESCAPE&&this.setState({isEditing:!1,selectedIndex:-1},(()=>this.focusInput()))};onClose=(e,t)=>{this.removeOption(e),t.stopPropagation()};onFocus=e=>{this.setState({selectedIndex:e})};renderSelectedItem=(e,t)=>{let s="";return e.address?s=e.address:"string"==typeof e&&(s=e),(0,zn.jsxs)("div",{title:s,onKeyDown:this.itemKeyDown.bind(this,t),onFocus:()=>this.onFocus(t),ref:e=>this.refMultiInputOptions["item_"+t]=e,onClick:this.onItemClick.bind(this,t),className:Gn()("multiinput-item",this.props.className),tabIndex:this.state.selectedIndex===t||0===this.props.tabIndex?0:-1,children:[e.name&&(0,zn.jsx)("span",{className:"multiinput-item-primary",children:e.name}),e.name&&e.address&&(0,zn.jsx)("span",{className:"multiinput-item-secondary",children:"<"+e.address+">"}),!e.name&&e.address&&(0,zn.jsx)("span",{className:"multiinput-item-primary",children:e.address}),(0,zn.jsx)("button",{type:"button",className:"close",dangerouslySetInnerHTML:{__html:Kn.kze},onClick:e=>this.onClose(t,e),tabIndex:this.props.tabIndex})]},"selected_item_"+t)};focusInput=()=>{this.refInputField&&this.refInputField.focus()};focusItem=e=>{this.refMultiInputOptions["item_"+e]?.focus()};renderMailAddressForOption=e=>(0,zn.jsx)("div",{children:e.name?(0,zn.jsxs)(Un.Fragment,{children:[(0,zn.jsx)("div",{className:"multiinput-option-primary",title:e.name,children:e.name}),(0,zn.jsx)("div",{className:"multiinput-option-secondary",title:e.address,children:"<"+this.shortenEmail(e.address,42)+">"})]}):(0,zn.jsx)("div",{className:"multiinput-option-primary-single",title:e.address,children:this.shortenEmail(e.address,60)})});shortenEmail(e,t){if(e.length>t){let s="";const[n,i]=e.split("@");return i?(s+=t/3<n.length?n.slice(0,t/3)+"…":n,s+="@",s+=t/2<i.length?"…"+i.slice(t/2*-1):i):s=n.slice(0,t),s}return e}renderInputField=()=>(0,zn.jsx)("input",{type:"text",ref:e=>this.refInputField=e,value:this.state.inputValue,onChange:this.inputChanged,onBlur:this.inputLostFocus,onKeyDown:this.inputKeyDown,onKeyUp:this.inputKeyUp,autoComplete:"false",spellCheck:"false",placeholder:this.props.placeholder});renderOption=(e,t)=>{const s=this.selectionModel.isSelected(t),n=(0,zn.jsxs)("div",{className:Gn()("multiinput-option",e.address.length<3&&"multiinput-option-disabled"),ref:e=>this.refMultiInputOptions["option_"+t]=e,role:"option","data-id":t,"data-selected":s?"":null,onClick:this.onOptionClick.bind(this,e),children:[this.props.showTypedTextAsOption&&0===t&&(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.YvR.medium}}),this.renderMailAddressForOption(e)]},"option_"+t);return this.props.showTypedTextAsOption&&0===t?(0,zn.jsx)("div",{className:Gn()("multiinput-leading",1===this.state.filteredList.length&&"multiinput-leading-only"),children:n},"option_first_item"):n};renderDropDown=()=>(0,zn.jsx)("div",{role:"listbox",className:"multiinput-select",children:this.state.filteredList.map(this.renderOption)});getInput=()=>(0,zn.jsxs)("div",{className:"multiinput-group",children:[this.renderInputField(),this.state.dropDownVisible?this.renderDropDown():""]},"input_"+this.state.selectedIndex);render(){const e=this.props.selectedItems.map(this.renderSelectedItem);return this.state.isEditing?e.splice(this.state.selectedIndex,0,this.getInput()):e.push(this.getInput()),(0,zn.jsx)("div",{ref:e=>this.refMultiInputEnvelope=e,className:"multiinput",children:e})}}const gw=pw;var mw=(0,zn.jsx)(aa,{type:"close"});const fw=()=>{const[e,t]=(0,Un.useState)(null);return(0,Un.useEffect)((()=>{const e=e=>{e.value.mode&&t(e.value.mode)};return n.Z.proxy.settings.get({},e),n.Z.proxy.settings.onChange.addListener(e),()=>{n.Z.proxy.settings.onChange.removeListener(e)}}),[]),e&&"direct"!==e&&"system"!==e?(0,zn.jsxs)(fa,{type:"info",children:[(0,W.Z)("Mail is not protected by your current VPN / proxy setup."),(0,zn.jsx)("button",{className:"close",title:(0,W.Z)("notice","Dismiss"),onClick:()=>I.Z.set(Z.kMailVpnNoticeDismissed,(new Date).valueOf()),children:mw})]}):null};var vw=s(5267),bw=s(88951);var Cw=s(55346),ww=s(93818),yw=s(89846),xw=s(93043);var Iw=s(57357);var Aw=s(77312),Sw=s(13519),Zw=s(22288),Tw=s(16888),Ew=s(34155);const kw=[Z.kKeyboardTabToAll,Z.kMailAccounts,Z.kMailComposeHeadersHidden,Z.kMailVpnNoticeDismissed];var Nw=(0,zn.jsx)(fw,{});class _w extends Un.PureComponent{static contextType=oi.Z;refTo=Un.createRef();refFrom=Un.createRef();signature="";draftCreated=!1;fromDraft=!0;fetchDraftFromDBAfterMount=!1;refBody=Un.createRef();refSubject=Un.createRef();messageId=(0,bw.Z)();draftIsPlaintext=!1;cidAttachments=[];focusOnBody=!1;constructor(e){super(e),this.state=this._initDraft()}_initDraft=()=>{const e=Zd.Z.getAccountsAndAliases(),t={from:e.length>0?[{address:e[0].MAIL_EMAIL}]:[],to:[],cc:[],bcc:[],subject:"",attachments:[],mailAddresses:ml.Z.getMailAddresses(),showModal:!1,replyAllPossible:!1,listPostAddresses:[],replyScope:""},s=this.props.mailto&&!this.props.searchListId?(0,ns.J)(this.props.mailto):YC.Z.getAndClear();return s?(this.sentDate=s.sentDate,this.threadKey=s.threadKey,this.references=s.references,this.messageId=s.messageId,this.cidAttachments=s.cidAttachments||[],this.inReplyTo=s.inReplyTo,this.forwarded=s.forwarded,this.replied=s.replied,this._setReplyOptions(),this.draftIsPlaintext=s.plaintext,this.focusOnBody=s.focusOnBody,this.selectedAccount=s.selectedAccount,t.attachments=s.attachments,t.bcc=s.bcc,t.cc=s.cc,t.from=s.from,t.subject=s.subject,t.to=s.to,t.replyScope=s.replyScope,this.bodyDraft=s.body,this.fromDraft=s.fromDraft??!0,this.fromDraft||(this.signature=(0,Zw.SG)((0,Zw.o$)(t.from,e,!!s.replied,!!s.forwarded),this.getSignaturePosition())),t):(this.fetchDraftFromDBAfterMount=!0,this.sentDate=Date.now(),this.draftIsPlaintext=!1,this.bodyDraft="",t)};_setReplyOptions=async()=>{if(this.replied){const e=await Cw.Z.call(this.replied);if(e&&this._isMounted){const{uniqueTo:t,uniqueCc:s}=ns.Z.getUniqueReceivers(e,this.state.from[0]?.address),n=ns.Z.getListPostAddress(e);this.setState({replyAllPossible:t.length+s.length>1,listPostAddresses:n})}}};_setIfActive=e=>{const{searchListId:t}=e;e.isActive&&t?Ew.nextTick((()=>HC.Z.setSearchListId(t))):e.isActive||this.flushPendingChanges()};_contactsChanged=()=>{const e=ml.Z.getMailAddresses();this.setState({mailAddresses:e})};_moveFromDraftsToOutbox=async(e,t)=>{const s={filteringPriority:Nt.Un.HIGH,addedProperties:t?{}:{searchList:{queued:!0}}},{sleUpdate:n,updatedSle:i}=await(0,yw.Z)(e,Nt.of,Nt.Wb,Nt.of,Nt.J8,s);return d.Z.updateIndex({sleUpdates:[n]}),ms.Z.filter(),i};_queueMessage=async e=>{const{to:t,cc:s,bcc:n}=this.state;if([t,s,n].every((e=>0===e.length)))return void this.setState({showModal:!0});const{searchListId:i}=this.props;let a;if(i){if(await this.flushPendingChanges(),a=await(0,ww.Z)(i),a){bt.Z.getByIds(a.sourceFilterIds).some((e=>e.accountId===Nt.of&&e.path===Nt.Wb))&&(a=await this._moveFromDraftsToOutbox(i,e))}}else this.cancelPendingChanges();if(!a){const t=await this.buildMessage();a=await ss.Z.storeMessage(t,e)}e&&ss.Z.sendSelected(this.context.vivaldiWindowId,[a]),c.ZP.close(this.context.vivaldiWindowId)};_addAttachments=e=>{this.setState((t=>({attachments:[...t.attachments,...e]})),(()=>this.updateAttribute(this.onBodyChange)))};_chooseAttachments=async()=>{const{showOpenFilePicker:e}=this.context,t=await e({multiple:!0}),s=[];for(const e of t){const t=await e.getFile();if(t.size>Nt.gh){if("cancel"===await ue.Z.showLargeAttachmentWarning(t.name,t.size))continue}const n=await t.arrayBuffer(),i=await ow(n);s.push({type:"attachment",content:i,filename:e.name,fileSize:t.size,mimeType:t.type})}this._addAttachments(s)};_deleteDraftMessage=async()=>{this.cancelPendingChanges();const{searchListId:e}=this.props;if(e)if(bt.Z.isInDraftOrOutbox(e)){await(0,Aw.fN)(e);const t=[e];xw.Z.call(t),vw.Z.deleteMessages(t),d.Z.updateIndex({removedSles:[e]}),ls.Z.log("Mail",["composer","discard draft"],"Message deleted!")}else ls.Z.warn("Mail",["composer","discard draft"],"Message is not a draft - probably has already been sent!");c.ZP.close(this.context.vivaldiWindowId)};_reactIfActive=e=>{this.props.isActive&&"MAIL_ACTIVE_COMPOSER_ADD_ATTACHMENTS"===e.actionType&&this._addAttachments(e.newAttachments)};onCommandSpy=(e,t)=>{if(this.props.isActive&&e===this.context.vivaldiWindowId)switch(t){case"COMMAND_MAIL_SEND_MESSAGE":this._queueMessage(!0);break;case"COMMAND_MAIL_QUEUE_MESSAGE":this._queueMessage(!1);break;case"COMMAND_MAIL_COMPOSER_CHOOSE_ATTACHMENTS":this._chooseAttachments();break;case"COMMAND_MAIL_COMPOSER_DELETE_DRAFT":this._deleteDraftMessage()}};_hideModal=()=>{this.setState({showModal:!1})};componentDidMount(){this._isMounted=!0,this._setIfActive(this.props),go.Z.addListeners(["COMMAND_MAIL_SEND_MESSAGE","COMMAND_MAIL_QUEUE_MESSAGE","COMMAND_MAIL_COMPOSER_CHOOSE_ATTACHMENTS","COMMAND_MAIL_COMPOSER_DELETE_DRAFT"],this.onCommandSpy),KC.addListener(this._reactIfActive),ml.Z.addListener(this._contactsChanged),this.focusOnBody&&this.refBody.current?this.refBody.current.focus():this.refTo.current&&this.refTo.current.focusInput();const{searchListId:e}=this.props;e&&this.fetchDraftFromDBAfterMount&&(async()=>{await ns.Z.prepareDraft(e)&&this._isMounted&&this.setState(this._initDraft(),this.onContentLoad)})()}onContentLoad=()=>{if(!this.bodyDraft&&!this.signature)return;const e=[],t=this.getSignaturePosition();""!==this.bodyDraft&&"above"!==t||e.push({content:"<br>",isPlainText:!1}),(this.replied||this.forwarded)&&("above"===t?e.push({content:this.signature,isPlainText:!1}):e.push({content:(0,Zw.SG)("","above"),isPlainText:!1})),""!==this.bodyDraft&&e.push({content:this.bodyDraft,isPlainText:this.draftIsPlaintext}),"below"===t&&this.draftIsPlaintext&&this.bodyDraft&&e.push({content:"<br>",isPlainText:!1}),"below"!==t&&this.bodyDraft?e.push({content:(0,Zw.SG)("","below"),isPlainText:!1}):e.push({content:this.signature,isPlainText:!1}),e.length>0&&this.refBody.current?.setContent(e),this.signature="",this.bodyDraft="",this.draftIsPlaintext=!1};componentDidUpdate(e){e.isActive!==this.props.isActive&&this._setIfActive(this.props)}componentWillUnmount(){this._isMounted=!1,go.Z.removeListeners(["COMMAND_MAIL_SEND_MESSAGE","COMMAND_MAIL_QUEUE_MESSAGE","COMMAND_MAIL_COMPOSER_CHOOSE_ATTACHMENTS","COMMAND_MAIL_COMPOSER_DELETE_DRAFT"],this.onCommandSpy),KC.removeListener(this._reactIfActive),ml.Z.removeListener(this._contactsChanged),this.flushPendingChanges()}getSignaturePosition=()=>(!!this.replied||!!this.forwarded)&&this.selectedAccount?.signaturePosition||"below";_updateSignature=e=>{const t=Zd.Z.getAccountsAndAliases(),s=(0,Zw.o$)(e,t,!!this.replied,!!this.forwarded),n=this.getSignaturePosition(),i=this.refBody.current;if(!i)return;const a="below"===n?".viv-signature-below":".viv-signature",o=".viv-signature-below"===a?".viv-signature":".viv-signature-below";i.getWebview().executeScript({code:`\n      if (document.body.querySelector(':scope > ${o}') instanceof HTMLSpanElement) {\n        document.body.querySelector(':scope > ${o}').innerHTML = unescape('${escape("")}');\n      }\n      if (document.body.querySelector(':scope > ${a}') instanceof HTMLSpanElement) {\n        document.body.querySelector(':scope > ${a}').innerHTML = unescape('${escape(s)}');\n      }\n    `})};buildMessage=()=>this.refBody.current?this.refBody.current.getContentAsBodyParts().then(this.processBodyParts).then((e=>({from:this.state.from,to:this.state.to,cc:this.state.cc,bcc:this.state.bcc,subject:this.state.subject,sentDate:this.sentDate,threadKey:this.threadKey,bodyParts:e,flags:["\\Seen"],inReplyTo:this.inReplyTo,replied:this.replied,forwarded:this.forwarded,...this.references?{references:this.references}:null,internal:!0,messageId:this.messageId,queued:!1}))):Promise.reject();_createDraftMessage=async e=>{const t=await async function(e){const{addedSles:t,forSearchDb:s}=await(0,ds.Z)(Nt.of,Nt.Wb,Nt.kY,[e],{filteringPriority:Nt.Un.HIGH});(0,cs.Z)(s);const[n]=t;if(!n)throw new Error("Failed to store message in drafts folder");return n}(e),{id:s,threadKey:i}=t;if(await gs.Z.setHasRaw(Nt.of,s),this.threadKey=i,this._isMounted){const e=`${this.props.url}&query={"id":${s}}`;n.Z.tabs.update(this.props.pageId,{url:e})}d.Z.updateIndex({addedSles:[t]}),ms.Z.filter(),es.Z.updateThreads()};updateAttribute=e=>this.props.searchListId?e(this.props.searchListId):this.draftCreated?Promise.resolve():(this.draftCreated=!0,this.buildMessage().then(this._createDraftMessage));updateBody=(0,Wv.Z)((e=>this.updateAttribute((async t=>{await function(e,t){let s=0;return t?.forEach((e=>{e.fileSize?s+=e.fileSize:s+=e.content.length})),rs.Z.messages.update(e,{bodyParts:t,size:s})}(t,e);const s=(0,Sw.Hg)(e);await(0,Tw.K)(t,this.state,s);const n=(0,Sw.Qe)(e);await(0,Iw.Z)(t,n),this.updateIndex(t,{attachment:(0,Zw.tZ)(e),preview:n})}))),5e3,{leading:!1});processBodyParts=async e=>{if("html"===e[0].type){const{blobFreeHTML:t,cidsInUse:s,newImages:n}=(0,zc.o6)(e[0].content),i=this.cidAttachments.filter((e=>e.id&&s.includes("cid:"+e.id)));e[0].content=t;const a=n.map((async({dataOrBlobUrl:e,cid:t,mimeType:s,filename:n})=>{const i=await fetch(e),a=await i.arrayBuffer();return{type:"attachment",content:new Uint8Array(a),filename:n,id:t,mimeType:s,fileSize:a.byteLength}})),o=await Promise.all(a);return e.concat(this.state.attachments,i,o)}return Promise.resolve(e.concat(this.state.attachments))};onBodyChange=()=>this._isMounted&&this.refBody.current?.getContentAsBodyParts?this.refBody.current.getContentAsBodyParts().then(this.processBodyParts).then(this.updateBody):Promise.reject();flushPendingChanges=async()=>{await this.toSelected.flush(),await this.ccSelected.flush(),await this.bccSelected.flush(),await this.subjectChange.flush(),await this.updateBody.flush()};cancelPendingChanges=()=>{this.toSelected.cancel(),this.ccSelected.cancel(),this.bccSelected.cancel(),this.subjectChange.cancel(),this.updateBody.cancel()};updateIndex=(e,t)=>{if(!this.threadKey)throw new Error("MailComposer: Trying to update an unsaved draft");const s=[{id:e,updates:t}];d.Z.updateIndex({sleUpdates:s})};fromChange=e=>{this.selectedAccount=Zd.Z.getAccountOrAlias(e.target.value),this.setState({from:this.selectedAccount?[{name:this.selectedAccount.MAIL_NAME,address:this.selectedAccount.MAIL_EMAIL}]:[]},(()=>(this._updateSignature(this.state.from),this.updateAttribute((async e=>{await function(e,t){return rs.Z.transaction("rw",[rs.Z.messages,rs.Z.searchList],(()=>{rs.Z.searchList.update(e,{from:t}),rs.Z.messages.update(e,{from:t})}))}(e,this.state.from),this.updateIndex(e,{from:this.state.from})}))))),this.selectedAccount&&(this.messageId=(0,bw.Z)(this.selectedAccount.MAIL_EMAIL))};toSelected=(0,Wv.Z)((()=>this.updateAttribute((async e=>{await function(e,t){return rs.Z.transaction("rw",[rs.Z.messages,rs.Z.searchList],(()=>{rs.Z.searchList.update(e,{to:t}),rs.Z.messages.update(e,{to:t})}))}(e,this.state.to),this.updateIndex(e,{to:this.state.to})}))),5e3,{leading:!1});onToSelected=e=>{this.setState({to:[...e]},(()=>this.toSelected()))};ccSelected=(0,Wv.Z)((()=>this.updateAttribute((e=>function(e,t){return rs.Z.transaction("rw",[rs.Z.messages,rs.Z.searchList],(()=>{rs.Z.searchList.update(e,{cc:t}),rs.Z.messages.update(e,{cc:t})}))}(e,this.state.cc)))),5e3,{leading:!1});onCcSelected=e=>{this.setState({cc:[...e]},(()=>this.ccSelected()))};bccSelected=(0,Wv.Z)((()=>this.updateAttribute((e=>function(e,t){return rs.Z.messages.update(e,{bcc:t})}(e,this.state.bcc)))),5e3,{leading:!1});onBccSelected=e=>{this.setState({bcc:[...e]},(()=>this.bccSelected()))};subjectChange=(0,Wv.Z)((()=>this.updateAttribute((async e=>{await function(e,t){return rs.Z.transaction("rw",[rs.Z.messages,rs.Z.searchList],(()=>{rs.Z.searchList.update(e,{subject:t}),rs.Z.messages.update(e,{subject:t})}))}(e,this.state.subject),this.updateIndex(e,{subject:this.state.subject})}))),5e3,{leading:!1});onSubjectChange=e=>{this.setState({subject:e.target.value},(()=>this.subjectChange()))};focusSubject=()=>{this.refSubject.current&&this.refSubject.current.focus()};removeAttachment=e=>{const t=this.state.attachments[e];this.setState((t=>({attachments:t.attachments.filter(((t,s)=>s!==e))})),(()=>this.updateAttribute(this.onBodyChange).then((()=>{"string"==typeof t.content&&(0,Aw.MT)(t.content)}))))};_onContextMenu=(e,t)=>{const s=[{handler:this.removeAttachment.bind(this,e),...(0,fi.Z)("mail","Remove")}];(0,mi.Z)(this.context,s)(t)};_onChangeReplyScope=async e=>{if(this.replied){const t=e.target.value,s=await Cw.Z.call(this.replied);if(s&&this._isMounted){let e=[],n=[];const i=[];if("sender"===t)e=ns.Z.getTo(s);else if("all"===t){const t=ns.Z.getUniqueReceivers(s,this.state.from[0]?.address);e=t.uniqueTo,n=t.uniqueCc}else"list"===t&&(e=this.state.listPostAddresses);this.setState({to:e,cc:n,bcc:i,replyScope:t},(()=>{this.toSelected(),this.ccSelected(),this.bccSelected(),this.flushPendingChanges()}))}}};render(){const{from:e,to:t,cc:s,bcc:n,subject:i,attachments:a}=this.state,o=this.props.prefValues[Z.kMailComposeHeadersHidden];return(0,zn.jsxs)("div",{id:"mail_composer",children:[0===this.props.prefValues[Z.kMailVpnNoticeDismissed]&&Nw,(0,zn.jsxs)("header",{children:[!o.includes("from")&&(0,zn.jsxs)("div",{children:[(0,zn.jsx)("label",{htmlFor:"from",children:(0,W.Z)("sender","From")}),(0,zn.jsx)("div",{className:"headerItemWrapper",children:(0,zn.jsx)(Fa.Z,{ref:this.refFrom,id:"from",onChange:this.fromChange,value:e.length>0?e[0].address:"",children:Zd.Z.getAccountsAndAliases().filter((e=>!e.offline)).map(((e,t)=>(0,zn.jsx)("option",{value:e.MAIL_EMAIL,children:(e.MAIL_NAME?e.MAIL_NAME:"")+" ("+e.MAIL_EMAIL+")"},t)))})})]}),(0,zn.jsxs)("div",{className:"composer_reply_field",children:[(0,zn.jsx)("label",{htmlFor:"to",children:(0,W.Z)("To")}),(0,zn.jsxs)("div",{className:"headerItemWrapper",children:[this.replied&&(this.state.replyAllPossible||this.state.listPostAddresses.length>0)&&(0,zn.jsxs)(Fa.Z,{onChange:this._onChangeReplyScope,value:this.state.replyScope,title:(0,W.Z)("Whom to reply to"),children:[(0,zn.jsx)("option",{value:"sender",children:(0,W.Z)("Reply")}),this.state.replyAllPossible&&(0,zn.jsx)("option",{value:"all",children:(0,W.Z)("Reply All")}),this.state.listPostAddresses.length>0&&(0,zn.jsx)("option",{value:"list",children:(0,W.Z)("Reply List")})]}),(0,zn.jsx)(gw,{ref:this.refTo,id:"to",tabIndex:0===this.props.prefValues[Z.kKeyboardTabToAll]?0:-1,selectedItems:t,allItems:this.state.mailAddresses,itemSelectionCallback:this.onToSelected,clearInputOnBlur:!0})]})]}),(s.length>0||!o.includes("cc"))&&(0,zn.jsxs)("div",{children:[(0,zn.jsx)("label",{htmlFor:"cc",title:(0,W.Z)("Carbon copy"),children:(0,W.Z)("Cc")}),(0,zn.jsx)("div",{className:"headerItemWrapper",children:(0,zn.jsx)(gw,{id:"cc",tabIndex:0===this.props.prefValues[Z.kKeyboardTabToAll]?0:-1,selectedItems:s,allItems:this.state.mailAddresses,itemSelectionCallback:this.onCcSelected,clearInputOnBlur:!0})})]}),(n.length>0||!o.includes("bcc"))&&(0,zn.jsxs)("div",{children:[(0,zn.jsx)("label",{htmlFor:"bcc",title:(0,W.Z)("Blind carbon copy"),children:(0,W.Z)("Bcc")}),(0,zn.jsx)("div",{className:"headerItemWrapper",children:(0,zn.jsx)(gw,{id:"bcc",tabIndex:0===this.props.prefValues[Z.kKeyboardTabToAll]?0:-1,selectedItems:n,allItems:this.state.mailAddresses,itemSelectionCallback:this.onBccSelected,clearInputOnBlur:!0})})]}),(0,zn.jsxs)("div",{children:[(0,zn.jsx)("label",{htmlFor:"subject",children:(0,W.Z)("Subject")}),(0,zn.jsx)("div",{className:"headerItemWrapper",children:(0,zn.jsx)("input",{type:"text",ref:this.refSubject,id:"subject",value:i,onChange:this.onSubjectChange})})]}),a.length>0&&(0,zn.jsxs)("div",{children:[(0,zn.jsx)("label",{children:(0,W.Z)("Attachments")}),(0,zn.jsx)("div",{className:"composer-attachments",children:a.map(((e,t)=>(0,zn.jsxs)("div",{onContextMenu:this._onContextMenu.bind(this,t),className:"attachment",title:e.filename,children:[(0,zn.jsx)("span",{className:"attachment-title",children:e.filename}),(0,zn.jsx)("button",{className:"attachment-remove",tabIndex:0===this.props.prefValues[Z.kKeyboardTabToAll]?0:-1,onClick:this.removeAttachment.bind(this,t),dangerouslySetInnerHTML:{__html:Kn.kze}})]},`attachment${t}`)))})]})]}),(0,zn.jsxs)("main",{children:[this.state.showModal&&(0,zn.jsx)($C,{title:(0,W.Z)("Missing Recipients"),prompt:[(0,W.Z)("At least one address must be added to the To, Cc, or Bcc fields in order to send this email.")],positive:(0,W.Z)("OK"),onClose:this._hideModal,hideNegative:!0}),(0,zn.jsx)(lw,{ref:this.refBody,windowId:this.context.vivaldiWindowId,focusPreviousElement:this.focusSubject,onBodyChange:this.onBodyChange,onContentLoad:this.onContentLoad})]})]})}}const Pw=(0,zd.Z)(_w,kw);const Mw=function(e){return(0,zn.jsxs)("div",{className:"MailDisabled",children:[(0,zn.jsx)("h1",{children:(0,W.Z)("Mail, Calendar and Feeds are Turned Off")}),(0,zn.jsx)("p",{children:(0,W.Z)("Vivaldi email client is turned off. Go to Settings\n        to enable it, set up accounts or change preferences.")}),(0,zn.jsx)("input",{type:"button",onClick:()=>ue.Z.showSettings(e.windowId,"general",{scroll:"features"}),tabIndex:0,value:(0,W.Z)("Go to Settings")})]})};var Dw=s(72494);class Ow extends Un.PureComponent{state={listEntry:void 0};componentDidMount(){bt.Z.isInitialized()?this.getListEntry():bt.Z.addListener(this.onMailFilterStoreChange)}componentWillUnmount(){bt.Z.ensureRemovedListener(this.onMailFilterStoreChange)}onMailFilterStoreChange=e=>{"finishIndexProgress"===e.target&&(this.getListEntry(),bt.Z.ensureRemovedListener(this.onMailFilterStoreChange))};getListEntry(){const e=bt.Z.getListEntry(this.props.id);this.setState({listEntry:e})}render(){return(0,zn.jsx)("div",{id:"mail_view",className:"top",children:(0,zn.jsx)(Dw.Z,{pageId:this.props.id,hasNoListEntries:!0,listEntry:this.state.listEntry,pageIsActive:this.props.isActive})})}}const jw=Ow,Lw=[Z.kPanelsAsOverlayEnabled,Z.kPanelsPosition,Z.kMailListButtons,Z.kMailViewDimensions,Z.kMailViewLayout,Z.kToolbarsMail,Z.kToolbarsMailComposer,Z.kToolbarsMailMessage];class Rw extends Un.Component{static contextType=oi.Z;_isMounted=!1;_isConfirmationDialogVisible=!1;constructor(e,t){super(e),this.windowId=t.vivaldiWindowId,this.state={searchInput:"",showMailingLists:!0,showMailingListsButton:!1,showRead:!0,showReadButton:!1,showDeleted:!1,showDeletedButton:!1,showCustomFolder:!0,showCustomFolderButton:!1,showJunk:!1,showJunkButton:!1,showFeeds:!1,showFeedsButton:!1,showArchived:!1,showArchivedButton:!1,showSubFolders:!1,total:0,accountId:"",path:"",isPopupVisible:!1,defaultFilterOptions:void 0,hasQuery:!1,queryTotal:0},e.settingsFilter&&(this.state={...this.state,accountId:e.settingsFilter.accountId,path:e.settingsFilter.path,defaultFilterOptions:e.settingsFilter?.defaultFilterOptions,...this.updateShowButtons(e.settingsFilter.filterValue),...this.getUpdatedViews(e.settingsFilter)})}componentDidMount(){this._isMounted=!0,this.props.settingsFilter||(Ct.Z.addListener(this.selectedFolderChanged),bt.Z.addListener(this.onCountersChanged),this.selectedFolderChanged(),this._updateCounters())}componentWillUnmount(){this._isMounted=!1,this.props.settingsFilter||(Ct.Z.removeListener(this.selectedFolderChanged),bt.Z.removeListener(this.onCountersChanged))}_updateCounters=()=>{const e=bt.Z.getListEntries().length,t=bt.Z.getQueryNumFound()||0;this.setState({total:e,queryTotal:t})};onCountersChanged=e=>{this._isMounted&&"listEntries"===e.target&&this._updateCounters()};selectedFolderChanged=()=>{if(!this._isMounted)return;let e,t;const s=Ct.Z.getSelectedFolder(),n=Ct.Z.getOptions(),i=n.queryFolder;if(i&&Wt.ZP.isMailSearching(n))e=i.accountId,t=i.path;else{if(!s)return;e=s.accountId,t=s.path}const a=bt.Z.getByFolder(e,t||Nt.ym),o=a?a.filterValue:{...Wt.ZP.getSearchListButtons("")};this.setState({accountId:e,path:t,hasQuery:Boolean(n.query||n.queryAddition||n.attachments||n.sentDate||n.sentDateEnd),defaultFilterOptions:a?.defaultFilterOptions,...this.updateShowButtons(o),...!!a&&this.getUpdatedViews({...a,filterValue:{...a.filterValue,...n.queryOptions}})},(()=>this._updateCounters()))};getUpdatedViews=e=>e?Wt.ZP.getFilterOptions(e):{};toggleShow=e=>{const t=Ct.Z.getOptions();if(this.props.settingsFilterCallback)this.props.settingsFilterCallback(e,!this.state[e]),this.setState((t=>({[e]:!t[e]})));else{if(Wt.ZP.isValidSearch(t)){const s=!this.state[e];return t.queryOptions={...t.queryOptions,[e]:s},d.Z.setSearchOptions(t),void d.Z.updateQueryResults(t)}{const t=Ct.Z.getSelectedFolder(),s=t&&this.getOldFilter(t);if(!s)return;s.triggers&&s.triggers?.length>0?(this._isConfirmationDialogVisible=!0,ue.Z.showMailFilterViewConfirmation(this.context.vivaldiWindowId,s.name,(t=>{this._isConfirmationDialogVisible=!1,t&&this.updateSavedFilter(e,s,!0)}))):this.updateSavedFilter(e,s)}}};updateSavedFilter=(e,t,s)=>{this.setState((n=>{const i=!n[e],a=(0,C.Uy)(t,(t=>{t.filterValue[e]=i}));return d.Z.putFilter(a,t,!!s),{[e]:i}}))};togglePopup=()=>{this.setState((e=>({isPopupVisible:!e.isPopupVisible})))};getOldFilter=e=>bt.Z.getByFolder(e.accountId,e.path||Nt.ym);updateShowButtons=e=>{const t=Wt.ZP.getOptionNames().map((([,t])=>[t,this._updateShowButton(e,t)]));return Object.fromEntries(t)};_updateShowButton=(e,t)=>!e.hasOwnProperty(t)||Boolean(e[t]);getContextMenuItems=()=>{const e=[];return Wt.ZP.getOptionNames().forEach((([t,s])=>{this.state[s]&&e.push({type:"checkbox",checked:this.state[t],handler:()=>this.toggleShow(t),...(0,fi.Z)(this.convertOptionToTranslatableString(t))})})),e};onContextMenu=e=>{const{document:t,HTMLElement:s}=this.context,n=e.target instanceof s&&e.target.closest(".calendar-grid");n&&n!==t.activeElement&&n instanceof s&&n.focus(),(0,mi.Z)(this.context,this.getContextMenuItems())(e)};getViewFilterIcon=(e,t)=>{const s="vertical"===this.props.prefValues[Z.kMailViewLayout],n="text_menu"===A.Z.get(Z.kMailListButtons),i=this.props.settingsFilter;if((!s||i)&&n&&!t)return"";switch(e){case"showRead":return this.state[e]?Kn.tD0:Kn.LDV.small;case"showCustomFolder":return this.state[e]?Kn.Hj9:Kn.dMx.small;case"showMailingLists":return this.state[e]?Kn.ibx:Kn.GAD.small;case"showFeeds":return this.state[e]?Kn.hCY:Kn.ZU_.small;case"showJunk":return this.state[e]?Kn.K30:Kn.Qwh.small;case"showDeleted":return this.state[e]?Kn.Y41:Kn.nre.small;case"showArchived":return this.state[e]?Kn.sBl:Kn._w1.small}};getTitleAndTooltip=(e,t)=>{const s=!!this.props.settingsFilter;return{title:"text_menu"===A.Z.get(Z.kMailListButtons)||t||s?this.convertOptionToTranslatableString(e):void 0,tooltip:this.convertOptionToTranslatableString(e,!0)}};getButtonOrCheckbox=(e,t)=>{const s=!!this.props.settingsFilter,n="text_menu"===A.Z.get(Z.kMailListButtons),i="vertical"===this.props.prefValues[Z.kMailViewLayout],a=n&&i&&!s||t,o=this.getTitleAndTooltip(e,t),r=o?.title;return a?(0,zn.jsxs)("label",{className:Gn()("MailListButtons-CheckboxWrapper",this.state[e]&&"MailListButtons-CheckboxWrapper--active"),children:[(0,zn.jsx)("span",{className:Gn()("MailListButtons-CheckboxIcon",this.state[e]&&"MailListButtons-CheckboxIcon--active"),dangerouslySetInnerHTML:{__html:this.getViewFilterIcon(e,t)}}),r,(0,zn.jsx)("input",{...o,className:"MailListButtons-Checkbox",onChange:()=>this.toggleShow(e),checked:this.state[e],type:"checkbox"})]},e):(0,Un.createElement)(oa.ZP,{...o,key:e,isOn:this.state[e],onClick:()=>this.toggleShow(e),image:this.getViewFilterIcon(e)})};renderButtons(e){const t=[];return Wt.ZP.getOptionNames().forEach((([s,n])=>{this.state[n]&&t.push(this.getButtonOrCheckbox(s,e))})),t}getNewDefaultOptions=()=>{const e={};return Wt.ZP.getOptionNames().forEach((([t,s])=>{this.state[s]&&(e[t]=!!this.state[t])})),e};convertOptionToTranslatableString=(e,t)=>{switch(e){case"showMailingLists":return t?(0,W.Z)("Show Mailing Lists"):(0,W.Z)("Mailing Lists");case"showRead":return t?(0,W.Z)("Show Read"):(0,W.Z)("Read");case"showDeleted":return t?(0,W.Z)("Show Trash"):(0,W.Z)("Trash");case"showCustomFolder":return t?(0,W.Z)("Show Custom Folders"):(0,W.Z)("Custom Folders");case"showJunk":return t?(0,W.Z)("Show Spam"):(0,W.Z)("Spam");case"showFeeds":return t?(0,W.Z)("Show Feeds"):(0,W.Z)("Feeds");case"showArchived":return t?(0,W.Z)("Show Archived"):(0,W.Z)("Archived");default:return""}};resetToDefault=()=>{const e=St.Z.getFolderType(this.state.accountId,this.state.path),t=Wt.ZP.getDefaultFilterForPath(this.state.accountId,this.state.path,e),s=this.state.defaultFilterOptions||Wt.ZP.getFilterOptions(t),n=Ct.Z.getSelectedFolder(),i=n&&this.getOldFilter(n);if(!i)return;const a=(0,C.Uy)(i,(e=>{for(const t of Object.keys(s))this.state[t+"Button"]&&(e.filterValue[t]=s[t])}));this.setState((e=>(d.Z.putFilter(a,i),s)))};menu=()=>[{handler:this.resetToDefault,...(0,fi.Z)("Reset")},{handler:this.setAsNewDefault,...(0,fi.Z)("Set as New Default")}];isDifferent=()=>{const e=St.Z.getFolderType(this.state.accountId,this.state.path),t=Wt.ZP.getDefaultFilterForPath(this.state.accountId,this.state.path,e),s=this.state.defaultFilterOptions||Wt.ZP.getFilterOptions(t);return Wt.ZP.getOptionNames().some((([e,t])=>this.state[t]&&this.state[e]!==!!s[e]))};isSearching=()=>{const e=Ct.Z.getOptions();return Wt.ZP.isValidSearch(e)};setAsNewDefault=()=>{const e=Ct.Z.getSelectedFolder(),t=e&&this.getOldFilter(e);if(!t)return;const s=this.getNewDefaultOptions(),n={...t,defaultFilterOptions:s};this.setState((e=>(d.Z.putFilter(n,t),{defaultFilterOptions:s})))};renderViewFilterButton=()=>{const e=It.Z.getFolderName(this.state.accountId,this.state.path),t=this.renderButtons(!0),s=this.isDifferent(),n=this.isSearching();return(0,zn.jsxs)(oa.ZP,{tooltip:(0,W.Z)("View Filters"),popupPosition:"below",image:Kn.EnF.small,hidePopup:()=>{this._isConfirmationDialogVisible||this.setState({isPopupVisible:!1})},onClick:this.togglePopup,isPopupVisible:this.state.isPopupVisible,popupWidth:240,className:Gn()("MailListButtons-FilterIcon",{"MailListButtons-FilterIcon--active":s}),popupClassName:"MailListButtons-Popup",outsideClickIgnoreClass:"MailListButtons-TextMenuTitle",popupLabelledBy:"popout-maillist-filterbutton-title",children:[(0,zn.jsxs)("span",{id:"popout-maillist-filterbutton-title",className:"MailListButtons-Label",children:[(0,W.Z)('Show the following types of messages in "$1"',[e]),":"]}),t,s&&(0,zn.jsxs)("div",{className:"MailListButtons-PopupButtonsWrapper",children:[(0,zn.jsx)("input",{type:"button",className:"MailListButtons-PopupButtons",onClick:this.resetToDefault,value:(0,W.Z)("Reset")}),!n&&(0,zn.jsx)("input",{type:"button",className:"MailListButtons-PopupButtons",onClick:this.setAsNewDefault,value:(0,W.Z)("Set as New Default")})]})]})};render(){const e=!!this.props.settingsFilter,t=this.renderButtons(),s="icons_only"===A.Z.get(Z.kMailListButtons);if(0===t.length)return null;const n="vertical"===this.props.prefValues[Z.kMailViewLayout],i=this.isDifferent(),a=(0,F.uf)(this.state.total);let o=(0,W.Z)("$2 message","$2 messages",[this.state.total,a]);return this.state.hasQuery&&(o=(0,W.Z)("Found $2 message","Found $2 messages",[this.state.total,a])),s||!n||e?(0,zn.jsxs)("div",{className:Gn()("MailListButtons",{"MailListButtons--textMenu":!s||e,"MailListButtons--settings":e}),onContextMenu:this.onContextMenu,children:[this.state.hasQuery&&(0,zn.jsx)("div",{title:(0,W.Z)("Found in all folders: $1. Found in current folder: $2",[this.state.queryTotal,this.state.total]),className:Gn()("MailListButtons-MessageCount",{"MailListButtons-MessageCount--hasQuery":this.state.hasQuery}),children:o}),e?(0,zn.jsx)("span",{children:(0,W.Z)("mail","Include messages from:")}):(0,zn.jsxs)("span",{className:"MailListButtons-Label",children:[(0,W.Z)("mail","Show"),":"]}),(0,zn.jsx)("div",{className:"toolbar toolbar-insideinput",children:t}),!e&&this.renderViewFilterButton()]}):(0,zn.jsxs)("div",{className:"MailListButtons MailListButtons--popUp",onContextMenu:this.onContextMenu,children:[(0,zn.jsx)("div",{title:(0,W.Z)("Found in all folders: $1. Found in current folder: $2",[this.state.queryTotal,this.state.total]),className:"MailListButtons-MessageCount",children:o}),(0,zn.jsxs)("div",{className:Gn()("MailListButtons-TextMenuTitle",{"MailListButtons-TextMenuTitle--active":i}),children:[(0,zn.jsx)("div",{onClick:this.togglePopup,children:(0,W.Z)("View Filters")}),this.renderViewFilterButton()]}),i&&(0,zn.jsxs)("div",{className:"MailListButtons-NonDefaultStateMessage",children:[(0,zn.jsxs)("strong",{children:[(0,W.Z)("mail","Show"),": "]}),Wt.ZP.getOptionNames().filter((([e,t])=>this.state[t]&&this.state[e])).map((([e])=>this.convertOptionToTranslatableString(e))).join(", ")]})]})}}const Bw=(0,zd.Z)(Rw,Lw);var Fw=s(95032);class Ww extends Un.PureComponent{renderSubjectLine=()=>(0,zn.jsxs)(zn.Fragment,{children:[this.props.isParent&&(0,zn.jsx)("div",{className:"status-indicators",children:(0,zn.jsx)("span",{className:"expand-icon",onClick:this.props.handleExpandClick,dangerouslySetInnerHTML:{__html:s(4103)}})}),(0,zn.jsxs)("div",{className:"subject",children:[this.props.queued&&(0,zn.jsx)("span",{className:"mail-queued",dangerouslySetInnerHTML:{__html:s(48783)}}),(0,zn.jsx)("div",{className:"subject-title",children:this.props.variables.subject})]}),(0,zn.jsx)(Fw.Z,{className:"labels",flags:this.props.flags})]});renderPreviewLine=()=>(0,zn.jsx)("div",{className:`mail_entry_row body_preview body_preview_${this.props.previewLinesCount}`,children:this.props.variables.preview??(0,zn.jsx)("i",{children:(0,W.Z)("No preview available")})});getIndentation=()=>{const e=void 0!==this.props.level&&this.props.level>0&&!this.props.isParent?16:0;let t=0;return"number"==typeof this.props.level&&(t=16*Math.min(this.props.level-1,5)),{paddingLeft:this.props.level?`${t+e}px`:0,minWidth:this.props.level?`${50+t+e}px`:0}};renderDataLine=()=>{const e=void 0!==this.props.level&&this.props.level>0,t=this.props.variables;return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("div",{className:"status-indicators",children:this.props.renderStatusIndicator()}),(0,zn.jsxs)("div",{className:"from",style:this.getIndentation(),children:[this.props.isParent&&e&&(0,zn.jsx)("div",{className:"status-indicators",children:(0,zn.jsx)("span",{className:"expand-icon",onClick:this.props.handleExpandClick,dangerouslySetInnerHTML:{__html:s(4103)}})}),(0,zn.jsx)("div",{className:"mail-contact-name",children:t.contactString}),0!==this.props.attachment&&(0,zn.jsx)("span",{className:"mail-status-indicator mail-attachment-indicator",title:(0,W.Z)("Attachment"),dangerouslySetInnerHTML:{__html:s(51843)}})]}),e&&(0,zn.jsx)(Fw.Z,{className:"labels",flags:this.props.flags}),t.flagColor&&(0,zn.jsx)("span",{className:`mail-status-indicator ${t.flagColor}`,dangerouslySetInnerHTML:{__html:Kn.nyn.small}}),(0,zn.jsx)("div",{className:"maildate",children:(0,zn.jsx)("div",{className:"mailDateInfo",children:t.datetime})})]})};getTitle=()=>{const e=Ct.Z.getSelectedFolder(),t=e&&bt.Z.getByFolder(e.accountId,e.path),s=this.props.variables,n=kt.Z.call(this.props.sources,t)?"":` (${this.props.unseen?(0,W.Z)("Unseen"):(0,W.Z)("Unread")})`;return`${s.subject}${n}\n`+s.contactTooltip+"\n"+(0,W.Z)("Sent: $1",[s.datetime])};render(){const e=0===this.props.level,t=0!==this.props.level;return(0,zn.jsxs)("div",{className:this.props.variables.classes,style:this.props.variables.style,"data-id":this.props.id,title:this.getTitle(),children:[e&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("div",{className:"mail_entry_row data_row",children:this.renderDataLine()}),(0,zn.jsx)("div",{className:"mail_entry_row subject_row",children:this.renderSubjectLine()})]}),t&&(0,zn.jsx)("div",{className:"mail_entry_row data_row",children:this.renderDataLine()}),!!this.props.previewLinesCount&&(0,zn.jsx)("div",{style:this.getIndentation(),children:this.renderPreviewLine()})]})}}const Uw=Ww,Vw=[Z.kCalendarRelativeDates,Z.kMailCountersPanelUnseenEnabled,Z.kMailMessageListPreview,Z.kMailMessageListPreviewVerticalOnly],Hw={sameDay:(0,W.Z)("[Today] $1",["LT"]),lastDay:(0,W.Z)("[Yesterday] $1",["LT"]),nextDay:(0,W.Z)("[Tomorrow]",["LT"]),nextWeek:(0,W.Z)("[Next] $1",["dddd"]),lastWeek:"dddd LT",sameElse:"LL LT"},Gw={...Hw,lastWeek:"dddd LT",sameElse:"ll LT"},Kw={...Hw,lastWeek:"ddd LT",sameElse:"L LT"},zw=[145,170,205];function $w(e,t,s=!1){const n=e>0,i=s?16:16*e,a=Ti();return!t||s?n?i+30:a:n?i+54:2*a}var Yw=(0,zn.jsx)("span",{className:"mail-status-indicator"}),Xw=(0,zn.jsx)("span",{});class Qw extends Un.Component{renderStatusIndicator=()=>{const e=Yw,{selectedFilter:t,sources:n,flags:i}=this.props,a=(0,Et.Z)(n,i),o=t?Tt.Z.isMessageDeleted(n,t):Tt.Z.isMessageDeleted(n),r=kt.Z.call(n,t),l=this.props.isParent&&this.props.unreadInThread&&r,d=(0,Zt.Z)(n);switch(!0){case a:return(0,zn.jsx)("span",{className:"mail-status-indicator read-status spam",dangerouslySetInnerHTML:{__html:Kn.Qwh.small}});case o:return(0,zn.jsx)("span",{className:"mail-status-indicator read-status trash",dangerouslySetInnerHTML:{__html:Kn.nre.small}});case d:return(0,zn.jsx)("span",{className:"mail-status-indicator read-status",dangerouslySetInnerHTML:{__html:Kn._w1.small}});case(0,Dp.B_)(this.props):return(0,zn.jsx)("span",{className:"mail-status-indicator",dangerouslySetInnerHTML:{__html:Kn.hGk.small}});case(0,Dp.XN)(this.props):return(0,zn.jsx)("span",{className:"mail-status-indicator",dangerouslySetInnerHTML:{__html:Kn.upG.small}});case!r:case l:return(0,zn.jsx)("span",{className:"mail-status-indicator read-status",dangerouslySetInnerHTML:{__html:s(l?85382:88826)}});default:return e}};renderFlags=(e,t,s)=>(0,zn.jsx)("span",{className:`mail-status-indicator ${t.flagColor}`,dangerouslySetInnerHTML:{__html:Kn.nyn[s]}});renderMailEntryHorizontal=e=>{const{columns:t}=this.props;if(!t)return null;const n=this.props.level&&!this.props.isParent?16:0;let i=0;"number"==typeof this.props.level&&(i=16*Math.min(this.props.level,5));const a=V()(this.props.sentDate).format("LT"),o=V()().isSame(this.props.sentDate,"day");var r=(0,zn.jsx)("span",{children:a}),l=(0,zn.jsx)("span",{children:a});return(0,zn.jsx)("div",{className:e.classes,style:e.style,"data-id":this.props.id,children:t.map((d=>{switch(d.id){case"unread":return(0,zn.jsx)("label",{children:this.renderStatusIndicator()},d.id);case"sender":return(0,zn.jsx)("label",{className:"from",children:(0,zn.jsx)("span",{children:e.contactString})},d.id);case"subject":return(0,zn.jsxs)("label",{className:"subject",style:{width:t?"var(--subjectWidth)":null,marginLeft:this.props.level?`${i+n}px`:0},children:[(0,zn.jsxs)("div",{className:"subject-title-container",children:[this.props.isParent&&(0,zn.jsx)("span",{className:"expand-icon",onClick:this.props.handleExpandClick,dangerouslySetInnerHTML:{__html:s(4103)}}),this.props.queued&&(0,zn.jsx)("span",{className:"mail-queued",dangerouslySetInnerHTML:{__html:s(48783)}}),(0,zn.jsx)("span",{children:e.subject})]}),!!this.props.prefValues[Z.kMailMessageListPreview]&&!("vertical"!==this.props.direction&&this.props.prefValues[Z.kMailMessageListPreviewVerticalOnly])&&(0,zn.jsx)("div",{className:Gn()("body_preview",`body_preview_${this.props.prefValues[Z.kMailMessageListPreview]}`),children:e.preview??(0,zn.jsx)("i",{children:(0,W.Z)("No preview available")})},d.id)]},d.id);case"label":return(0,zn.jsx)("label",{className:"labels",children:(0,zn.jsx)("div",{className:"adjustment-mail-labels",children:(0,zn.jsx)(Fw.Z,{flags:this.props.flags})})},d.id);case"flag":return(0,zn.jsx)("label",{children:e.messageIsFlagged&&this.renderFlags(this.props,e,"small")},d.id);case"attachment":return(0,zn.jsxs)("label",{className:"mail-status-indicator mailattachment",children:[this.props.attachment>0&&2048!==this.props.attachment&&(0,zn.jsx)("span",{children:(0,W.Z)("$1 item","$1 items",[this.props.attachment])}),2048===this.props.attachment&&(0,zn.jsx)("span",{children:(0,W.Z)("1+ items")})]},d.id);case"size":return(0,zn.jsx)("label",{className:"mailsize",children:(0,zn.jsx)("span",{children:(0,iu.Z)(this.props.size,1,!1)})},d.id);case"sentDate":return(0,zn.jsx)("label",{className:"maildate",children:o&&d.width<=zw[0]?r:(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("span",{children:e.datetime.split(a)[0]}),d.width>zw[0]&&l]})},d.id);case"threads":return(0,zn.jsx)("label",{children:Xw},d.id);default:console.warn("Unknown column:",d.id)}}))})};render(){const e={mail_entry:!0,"mail-parent":this.props.isParent,"mail-child":this.props.isChild,"last-mail-child":this.props.isLastChild};let t={classes:Gn()(e,"loading"),contactString:"",contactTooltip:"",contactColumnTitle:"",datetime:"",flagColor:"",messageIsFlagged:!1,subject:"",preview:"",style:{"--mailEntryRowHeight":`${$w(this.props.prefValues[Z.kMailMessageListPreview],"vertical"===this.props.direction,!1)}px`,"--mailEntryRowHeightChild":`${$w(this.props.prefValues[Z.kMailMessageListPreview],"vertical"===this.props.direction,!0)}px`}};const s=this.props.prefValues[Z.kMailCountersPanelUnseenEnabled]&&this.props.unseen;t.subject=this.props.subject||"(no subject)",t.preview=this.props.preview,t.messageIsFlagged=(0,Dp.u9)(this.props),t.classes=Gn()(e,{unread:!s&&!kt.Z.call(this.props.sources,this.props.selectedFilter),unseen:s});const n=Ct.Z.getSelectedFolder(),i=n&&(n.type||n.path);[Nt.Nz,Nt.kY,Nt.fZ].includes(i)?(t={...t,...(0,cw.Qb)(this.props.toIds,!0)},t.contactColumnTitle=(0,W.Z)("mail","To")):(t={...t,...(0,cw.Qb)(this.props.fromIds)},t.contactColumnTitle=(0,W.Z)("mail","From")),t.messageIsFlagged&&(t.flagColor=`flag-color flag-${(0,Dp.Zr)(this.props.flags).toLowerCase()}`);const a=(this.props.columns||[]).find((e=>"sentDate"===e.id)),o=a&&a.width>zw[1]&&"vertical"!==this.props.direction?a.width>zw[2]?Hw:Gw:Kw;return t.datetime=this.props.prefValues[Z.kCalendarRelativeDates]?V()(this.props.sentDate).calendar(null,o):V()(this.props.sentDate).format(o.sameElse),"horizontal"===this.props.direction||"vertical_wide"===this.props.direction?this.renderMailEntryHorizontal(t):(0,zn.jsx)(Uw,{variables:t,handleExpandClick:this.props.handleExpandClick,unseen:this.props.unseen,id:this.props.id,queued:this.props.queued,flags:this.props.flags,sources:this.props.sources,isParent:this.props.isParent,level:this.props.level,attachment:this.props.attachment,renderStatusIndicator:this.renderStatusIndicator,previewLinesCount:this.props.prefValues[Z.kMailMessageListPreview]})}}const qw=(0,zd.Z)(Qw,Vw);var Jw=s(75995);const ey=function(e,t){return!!e.isParent&&!!e.unreadInThread&&!t(e)},ty=function(e,t,s,n){for(let i=t+1;i<e.length;i++){const t=e[i];if(!kt.Z.call(t.sources,s)||ey(t,n))return i}return-1},sy=function(e,t,s,n){for(let i=t-1;i>=0;i--){const t=e[i];if(!kt.Z.call(t.sources,s)||ey(t,n))return i}return-1},ny=function(e,t,s,n,i,a="undefined"){if("undefined"===a){if(s){const s=ty(e,t,n,i);return s>-1?s:sy(e,t,n,i)}{const s=sy(e,t,n,i);return s>-1?s:ty(e,t,n,i)}}return"previous"===a?s?sy(e,t,n,i):ty(e,t,n,i):s?("next"!==a&&console.warn("Direction to look for unread mail is not correct"),ty(e,t,n,i)):sy(e,t,n,i)};var iy=s(6826);const ay=[Z.kMailMessageListPreview,Z.kMailMessageListPreviewVerticalOnly,Z.kMailPrefetchOnDemand,Z.kMailMessageListJumpToLatest];function oy(){return(0,hp.U)(Ct.Z.getSelectedFolder())}function ry(){const e=A.Z.get(Z.kMailSearchSortOrder);return"ascending"===e?ui.Z.ASCENDING_SORT:"descending"===e?ui.Z.DESCENDING_SORT:ui.Z.NO_SORTING}function ly(e=oy(),t=ry()){return"threads"===e?Jw.Z.getThreadsAsTree(bt.Z.getListEntries().slice(),t===ui.Z.ASCENDING_SORT):bt.Z.getListEntries()}var dy=(0,zn.jsx)(aa,{type:"chevron",size:9}),cy=(0,zn.jsx)(aa,{type:"close"});class hy extends Un.PureComponent{refTree=Un.createRef();scrollLatestDismissed=!1;static contextType=oi.Z;winId=this.context.vivaldiWindowId;state={list:ly(),sorting:{sortField:oy(),sortOrder:ry(),comparator:void 0,onlyScroll:!0},autoFocusEntry:!0,previewLines:A.Z.get(Z.kMailMessageListPreview),previewVerticalOnly:A.Z.get(Z.kMailMessageListPreviewVerticalOnly),prefetchOnDemand:A.Z.get(Z.kMailPrefetchOnDemand),showScrollLatest:!1,stabilizeScrollTop:!1};componentDidMount(){bt.Z.addListener(this.messageListChanged),A.Z.addListener(ay,this.onPrefsCacheChanged),A.Z.addListener(Z.kMailViewLayout,this.onLayoutChange)}componentWillUnmount(){this._unbind(),bt.Z.removeListener(this.messageListChanged),A.Z.removeListener(ay,this.onPrefsCacheChanged),A.Z.removeListener(Z.kMailViewLayout,this.onLayoutChange)}onLayoutChange=()=>{this.setState((e=>({list:[...e.list]})))};onPrefsCacheChanged=()=>{this.setState({previewLines:A.Z.get(Z.kMailMessageListPreview),previewVerticalOnly:A.Z.get(Z.kMailMessageListPreviewVerticalOnly),prefetchOnDemand:A.Z.get(Z.kMailPrefetchOnDemand)},(async()=>{await this.fetchMissingPreviews()}))};messageListChanged=e=>{switch(this.setState({autoFocusEntry:!0}),e.target){case"gotoUnread":return void this._gotoUnreadFiltered();case"gotoNextUnread":return void this._gotoNextUnread();case"gotoPreviousUnread":return void this._gotoPreviousUnread();case"listEntries":return this.scrollLatestDismissed=!1,void this.updateListEntries(e)}};updateListEntries=e=>{const{isLoading:t,updateSelection:s,updateScrollPosition:n,stabilizeScrollTop:i=!1,replaceList:a=!0}=e,o=oy(),r=ry(),l={sortField:o,sortOrder:r,onlyScroll:!0},d=t?{isLoading:!0}:a?{isLoading:!1,sorting:l,list:ly(o,r),stabilizeScrollTop:i}:{isLoading:!1,sorting:l,stabilizeScrollTop:i};this.setState(d,(()=>{if(s)this.updateMessageSelection(n);else if(n)if(this.state.sorting.sortOrder===ui.Z.ASCENDING_SORT){const e=this.refTree.current;e?.scrollIntoView(e.getRenderArray().length-1)}else{this.refTree.current?.scrollIntoView(0)}}))};delete=(e,t)=>{const s=this.context.vivaldiWindowId;return Ct.Z.isTrashFolderSelected()||t?Pp.Z.prepareDelete(s,!0):Pp.Z.prepareDelete(s,!1)};isValidAddTarget=iy.Z;hasChildren=e=>Boolean(e.children&&e.children.length);isFolder=e=>this.hasChildren(e);getSelectedNodes=()=>{const e=this.refTree.current;if(!e)return[];const t=e.selectionModel.selectedIds,s=e.getRenderArray().map((e=>e.node));return t.map((e=>s.find((t=>t.id===e.id)))).filter(Boolean)};getNumSelected=()=>this.refTree.current?this.refTree.current.selectionModel.selectedIds.length:0;_findIndex=(e,t,s)=>{if(-1===e)return 0===t.length||this.state.sorting.sortOrder===ui.Z.ASCENDING_SORT?-1:-t.length-1;let n=bt.Z.getListEntry(e);if(n||this.selectedEntry?.id!==e||(n=this.selectedEntry),!n)return-1;if("threads"===this.state.sorting.sortField&&this.state.sorting.sortOrder===ui.Z.DESCENDING_SORT){const e=(e,t)=>e.threadKey[0]===t.threadKey[0]?t.threadKey[1]-e.threadKey[1]:t.threadKey[0]-e.threadKey[0];let s=Ft()(t,n,e);if(s>=0){for(;s>0&&0===e(t[s-1],n)&&(0,Ut.HT)(t[s],n)>0;)s--;for(;s<t.length-1&&0===e(t[s],n)&&(0,Ut.HT)(t[s],n)<0;)s++;n!==t[s]&&(s=-s-1)}return s}return Ft()(t,n,s)};setMessageSelection=(e,t,s)=>{const n=this.refTree.current;if(!n)return;const i=t?t.id:-1,a=s?s.id:-1;n.selectionModel.setSelectedIds(e??[]),n.selectionModel.anchorIndex=i,n.selectionModel.leadIndex=a,n.updateSelectionState(),n.saveSelectionModel(),this.onSelect(s)};updateMessageSelection=(e=!1)=>{const t=this.refTree.current;if(!t)return this.onSelect();const s=t.getRenderArray().map((e=>e.node));if(0===s.length)return this.setMessageSelection();const n=bt.Z.getListEntryComparator(),i=t.selectionModel.selectedIds.map((e=>e.id)).filter((e=>this._findIndex(e,s,n)>=0));let a=t.selectionModel.leadIndex;if(-1===a&&(a=t.selectionModel.anchorIndex),-1===a)return this.setMessageSelection();let o=this._findIndex(a,s,n);o<0&&(o=-o-1);let r=this._findIndex(t.selectionModel.anchorIndex,s,n);r<0&&(r=-r-1);const l=o>r;if(0===i.length){const e=Math.min(o,s.length-1),t=s[e];i.push(t.id)}const d=i[l?0:i.length-1],c=this._findIndex(d,s,n),h=s[c],u=i[l?i.length-1:0],p=this._findIndex(u,s,n),g=s[p];this.setMessageSelection(i,h,g),e&&t.scrollIntoView(p)};_markSelectedRead=()=>{Pp.Z.markRead(this.winId)};_markSelectedFlagged=()=>{Pp.Z.markFlagged(this.winId)};_toggleSenderAsMailingList=()=>{this.getSelectedNodes().forEach((e=>{const t=Bs.Z.get(e.fromIds);d.Z.toggleSenderAsMailingList(this.winId,t[0].address)}))};_markSelectedUnflagged=()=>{Pp.Z.markUnflagged(this.winId)};_goToNext=()=>{const e=this.refTree.current;if(!e)return;const t=e.selectionModel.leadIndex,s=e.getRenderArray().map((e=>e.node));let n=this._findIndex(t,s,bt.Z.getListEntryComparator());if(n<0&&(n=-n-1),n<s.length-1){const t=s[n+1];t.isParent&&!e.isExpanded(t.id)?(e.toggleExpandModel(t),this._goToNext()):t&&e.selectByNode(t)}};_goToNextUnread=e=>{const t=this.refTree.current;if(!t)return;const s=t.selectionModel.leadIndex,n=t.getRenderArray().map((e=>e.node));let i=this._findIndex(s,n,bt.Z.getListEntryComparator());i<0&&(i=-i-1);const a=Ct.Z.getSelectedFolder(),o=a?.accountId===Nt.tQ?Wt.ZP.getFilterForSingleThreadView():a&&bt.Z.getByFolder(a.accountId,a.path);if(!o)throw new Error("Filter not found");const r=ny(n,i,this.state.sorting.sortOrder===ui.Z.ASCENDING_SORT,o,(e=>t.isExpanded(e.id)),e);if(r>-1){const s=n[r];s.isParent&&!t.isExpanded(s.id)?(t.toggleExpandModel(s),this._goToNextUnread(e)):t.selectByNode(s)}};_markAndGotoNextUnread=ii.throttleSync((()=>{this._markSelectedRead(),this._gotoUnreadFiltered("undefined")}));_gotoNextUnread=ii.throttleSync((()=>{this._gotoUnreadFiltered("next")}));_gotoPreviousUnread=ii.throttleSync((()=>{this._gotoUnreadFiltered("previous")}));_gotoUnreadFiltered=(e="undefined")=>{const t=Ct.Z.getSelectedFolder();if(!t)return;const s=bt.Z.getByFolder(t.accountId,t.path);Wt.ZP.getFilterOptions(s).showRead&&this._goToNextUnread(e)};getLabelMenuItems=()=>{const e=se.Z.getActiveListEntry(),t=e?(0,Dp.Q3)(e.flags):[],s=Pp.Z.getCustomLabelsMenu(this.winId,t);return s.push(st.Z.separatorItem,{handler:()=>ue.Z.showAddCustomLabel(this.winId),ellipsis:!0,...(0,fi.Z)("Add New Label")}),t.length>0&&s.push(st.Z.separatorItem,{handler:()=>Pp.Z.clearAllLabels(this.winId,t),...(0,fi.Z)("Clear All Labels")}),s};getJumpToLatestMenuItems=()=>{const e=[];return e.push(st.Z.separatorItem,{type:"checkbox",checked:A.Z.get(Z.kMailMessageListJumpToLatest)||!0,handler:()=>{I.Z.set(Z.kMailMessageListJumpToLatest,!1),this.setState({showScrollLatest:!1})},...(0,fi.Z)("Show Jump to Latest")}),e};_scrollOrMarkAndGotoNext=e=>{const{document:t,HTMLElement:s}=this.context,n=t.querySelector("#mail_view .mail_body webview");n instanceof s&&"function"==typeof n.executeScript&&n.executeScript({code:this._injectCode(e.shiftKey)},(e=>{e&&!1===e[0]&&(this._markSelectedRead(),this._goToNext())}))};_injectCode=e=>e?"b__ = document.documentElement.querySelector('body');\n      if (b__.scrollTop !== 0) {\n        b__.scrollBy({\n          top: - b__.clientHeight - 30,\n          left: 0,\n          behavior: 'smooth'\n        });\n        true;\n      }":"b__ = document.documentElement.querySelector('body');\n      if (b__.scrollHeight - b__.scrollTop > b__.clientHeight) {\n        b__.scrollBy({\n          top: b__.clientHeight - 30,\n          left: 0,\n          behavior: 'smooth'\n        });\n        true;\n      } else {\n        false;\n      }";_sendSelected=()=>{ss.Z.sendSelected(this.context.vivaldiWindowId,this.getSelectedNodes())};standardFlagMenuData=()=>{const e=se.Z.getActiveListEntry(),t=e?(0,Dp.Zr)(e.flags):"";return Pp.Z.getStandardFlagsMenu(this.winId,t)};getMenuCapability=(e,t,s)=>{const n=this.winId,i=Rt.isEnabled("MailMsgSpam"),a=Rt.isEnabled("MailMsgArchive"),o=e=>{const t=Ct.Z.getSelectedFolder(),s=t&&bt.Z.getByFolder(t.accountId,t.path);return Boolean(e)&&kt.Z.call(e.sources,s)},r=e=>{const t=Ct.Z.getSelectedFolder();if(t&&bt.Z.getByFolder(t.accountId,t.path))return(0,Zt.Z)(e.sources)},l=e=>{const t=Ct.Z.getSelectedFolder();if(t&&bt.Z.getByFolder(t.accountId,t.path))return(0,Et.Z)(e.sources,e.flags)},d=e=>"threads"===this.state.sorting.sortField&&1===this.getNumSelected()&&Boolean(e)&&Boolean(e.children),c=e=>1===this.getNumSelected()&&Boolean(e)&&e.fromIds.length>0?Bs.Z.get(e.fromIds)[0].address:"",h=()=>bt.Z.getByIds(s.sourceFilterIds).some((e=>e.accountId===Nt.of&&e.path===Nt.J8)),u=()=>{const e=Ct.Z.getSelectedFolder(),t=e&&bt.Z.getByFolder(e.accountId,e.path);return!!t&&St.Z.getFolderType(t.accountId,t.path)===Nt.Nz};switch(e.action){case"COMMAND_MAIL_COMPOSE_NEW_MESSAGE":return Promise.resolve({...t(n,e,{}),handler:ns.Z.createDraft.bind(null,void 0)});case"CONTEXT_SEND":return Promise.resolve({...t(n,e,{}),handler:this._sendSelected,isVisible:()=>Boolean(s)&&h()});case"COMMAND_MAIL_REPLY":return Promise.resolve({...t(n,e,{}),isVisible:()=>Boolean(s)&&Rt.isEnabled("MailMsgReply")});case"COMMAND_MAIL_REPLY_ALL":return Promise.resolve({...t(n,e,{}),handler:()=>Pp.Z.replyAll(),isVisible:()=>Boolean(s)&&Rt.isEnabled("MailMsgReplyToAll")});case"COMMAND_MAIL_REPLY_LIST":return Promise.resolve({...t(n,e,{}),handler:()=>Pp.Z.replyList(),isVisible:()=>Boolean(s)&&se.Z.isListPost()});case"COMMAND_MAIL_FORWARD":return Promise.resolve({...t(n,e,{}),isVisible:()=>Boolean(s)&&!h()});case"COMMAND_MAIL_MARK_READ":return Promise.resolve({...t(n,e,{}),isVisible:()=>Boolean(s)&&Rt.isEnabled("MailMsgStatusRead")&&!Rt.isHidden("MailMsgStatusRead")&&!o(s)});case"COMMAND_MAIL_MARK_UNREAD":return Promise.resolve({...t(n,e,{}),isVisible:()=>Boolean(s)&&Rt.isEnabled("MailMsgStatusRead")&&!Rt.isHidden("MailMsgStatusRead")&&o(s)});case"CONTEXT_GOTO":case"COMMAND_MAIL_MARK_READ_AND_GOTO_NEXT_UNREAD":case"CONTEXT_THREAD":return Promise.resolve({...t(n,e,{}),isVisible:()=>Boolean(s)});case"COMMAND_MAIL_GOTO_NEXT_UNREAD":case"COMMAND_MAIL_GOTO_PREVIOUS_UNREAD":return Promise.resolve({...t(n,e,{}),isVisible:()=>Boolean(s)&&!(()=>{const e=Ct.Z.getSelectedFolder();return!!e&&St.Z.getFolderType(e.accountId,e.path)===Nt.tB})()});case"CONTEXT_CONTAINER_MOVE":return Promise.resolve({...t(n,e,{}),items:Pp.Z.getMoveToFolderMenu(n),isVisible:()=>Boolean(s)});case"CONTEXT_ADD_FLAG":return Promise.resolve({...t(n,e,{}),handler:this._markSelectedFlagged,isVisible:()=>Boolean(s)&&Rt.isEnabled("MailMsgFlag")&&!(0,Dp.u9)(s)});case"CONTEXT_REMOVE_FLAG":return Promise.resolve({...t(n,e,{}),handler:this._markSelectedUnflagged,isVisible:()=>Boolean(s)&&Rt.isEnabled("MailMsgFlag")&&(0,Dp.u9)(s)});case"CONTEXT_CONTAINER_FLAGS":return Promise.resolve({...t(n,e,{}),items:this.standardFlagMenuData(),isVisible:()=>Boolean(s)&&Rt.isEnabled("MailMsgFlag")});case"CONTEXT_CONTAINER_LABELS":return Promise.resolve({...t(n,e,{}),items:this.getLabelMenuItems(),isVisible:()=>Boolean(s)&&Rt.isEnabled("MailMsgLabel")});case"CONTEXT_EDIT":return Promise.resolve({...t(n,e,{}),handler:()=>Pp.Z.openMessage(n),isVisible:()=>Boolean(s)&&Ct.Z.isFolderAnEditMailFolder()});case"COMMAND_MAIL_MARK_JUNK":return Promise.resolve({...t(n,e,{}),isVisible:()=>Boolean(s)&&i&&!1===l(s)});case"COMMAND_MAIL_MARK_NOT_JUNK":return Promise.resolve({...t(n,e,{}),isVisible:()=>Boolean(s)&&i&&!0===l(s)});case"COMMAND_MAIL_MOVE_TO_ARCHIVE":return Promise.resolve({...t(n,e,{}),handler:()=>Pp.Z.moveToArchive(n),isVisible:()=>Boolean(s)&&a&&!1===r(s)});case"COMMAND_MAIL_RESTORE_FROM_ARCHIVE":return Promise.resolve({...t(n,e,{}),handler:()=>Pp.Z.restoreFromArchive(n),isVisible:()=>Boolean(s)&&a&&!0===r(s)});case"CONTEXT_CONTAINER_TRASH":const p=(e=>{const t=Ct.Z.getSelectedFolder(),s=t&&bt.Z.getByFolder(t.accountId,t.path);if(Boolean(e)&&s)return Tt.Z.isMessageDeleted(e.sources,s)})(s);return Promise.resolve({...t(n,e,{}),items:null!=p&&Rt.isEnabled("MailMsgTrash")?tg(n,p):[],isVisible:()=>Boolean(s)&&void 0!==p});case"CONTEXT_RECEIVER":return Promise.resolve({...t(n,e,{}),handler:()=>Pp.Z.enableCorrespondentView(n),isVisible:()=>Boolean(s)&&u()});case"CONTEXT_SENDER":return Promise.resolve({...t(n,e,{}),isVisible:()=>Boolean(s)&&!u()});case"COMMAND_MAIL_ENABLE_SENDER_VIEW":{const i=c(s);return Promise.resolve({...t(n,e,{}),isVisible:()=>Boolean(s)&&1===this.getNumSelected()&&i.length>0})}case"CONTEXT_SENDER_IS_MAILING_LIST":{const i=c(s);return Promise.resolve({...t(n,e,{}),handler:this._toggleSenderAsMailingList,checked:bt.Z.isSenderMailingList(i),isVisible:()=>Boolean(s)&&1===this.getNumSelected()&&i.length>0})}case"COMMAND_MAIL_ENABLE_THREADED_VIEW":return Promise.resolve({...t(n,e,{}),isVisible:()=>Boolean(s)&&1===this.getNumSelected()});case"COMMAND_MAIL_MARK_THREAD_READ":case"COMMAND_MAIL_MARK_THREAD_UNREAD":return Promise.resolve({...t(n,e,{}),isVisible:()=>Boolean(s)&&d(s)});default:return Promise.resolve({...t(n,e,{})})}};getMenuVisibility=e=>{switch(e.action){case"CONTEXT_EXPAND_ALL":case"CONTEXT_COLLAPSE_ALL":return"threads"===this.state.sorting.sortField;default:return!1}};handleExpandClick=()=>{this.refTree.current&&this.refTree.current.toggleSelectedExpansion()};onItemDoubleClick=()=>{Pp.Z.openMessage(this.context.vivaldiWindowId)};onItemMouseDown=(e,t)=>{1===t.button&&(t.preventDefault(),t.stopPropagation())};onItemMouseUp=(e,t)=>{1===t.button&&(Pp.Z.openMessage(this.context.vivaldiWindowId),t.preventDefault(),t.stopPropagation())};fetchMissingPreviews=(0,Te.Z)((()=>{if(this.state.prefetchOnDemand&&this.state.previewLines&&("vertical"===this.props.position||!this.state.previewVerticalOnly)){const e=this.refTree.current?.getVisibleNodes(),t=e?e.filter((({node:e})=>!e.preview)).map((({node:e})=>e.id)):[];t.length>0&&d.Z.fetchPreviews(t)}}),200);onScroll=()=>{this.fetchMissingPreviews()};onRowsRendered=e=>{if(!this.scrollLatestDismissed&&A.Z.get(Z.kMailMessageListJumpToLatest)){const{startIndex:t,stopIndex:s,listLength:n}=e;this.state.sorting.sortOrder===ui.Z.ASCENDING_SORT&&s<n-1||this.state.sorting.sortOrder===ui.Z.DESCENDING_SORT&&t>0?this.setState({showScrollLatest:!0}):this.setState({showScrollLatest:!1})}};onRowsRenderedDebounced=(0,Te.Z)((e=>{this.onRowsRendered(e)}),50);getRowComponentProps=e=>{const{node:t,level:s,isLastChild:n}=e,i=Ct.Z.getSelectedFolder();let a;if(i){const{accountId:e,path:t}=i;a=bt.Z.getByFolder(e,t)}return{...t,level:s,direction:"horizontal"===this.props.position||"vertical_wide"===this.props.position?"horizontal":"vertical",handleExpandClick:this.handleExpandClick,selectedFilter:a,columns:this.props.columns,isLastChild:n}};getRowHeight=e=>{const t="vertical"===this.props.position;return $w(!t&&this.state.previewVerticalOnly?0:this.state.previewLines,t,"threads"===this.state.sorting.sortField&&e.isChild)};onSelect=e=>{this.selectedEntry=e,this.setState({autoFocusEntry:!!this.selectedEntry}),this.props.onSelect(e)};openMessage=e=>{Pp.Z.openMessage(e.windowId)};onFocus=()=>{Qe.Z.bind("enter",this.openMessage)};_unbind=()=>{Qe.Z.unbind("enter",this.openMessage)};onBlur=()=>{this._unbind()};onKeyDown=e=>{const t=!!e.ctrlKey;switch(e.key){case"z":!t||e.shiftKey||e.altKey||(d.Z.undo(),e.preventDefault(),e.stopPropagation());break;case" ":e.preventDefault(),e.repeat||this._scrollOrMarkAndGotoNext(e)}};getDragData=(e,t)=>t;menu={name:"mailsearchlist",getCapability:this.getMenuCapability,getVisibility:this.getMenuVisibility};scrollToLatest=()=>{const e=this.refTree.current;if(e){if(this.state.sorting.sortOrder===ui.Z.ASCENDING_SORT){const t=e.getRenderArray().length-1;e.scrollIntoView(t),e.selectByIndex(t)}else e.scrollIntoView(0),e.selectByIndex(0);this.setState({showScrollLatest:!1})}};onContextMenu=e=>{(0,mi.Z)(this.context,this.getJumpToLatestMenuItems())(e)};render(){const e=Ct.Z.getSelectedFolder();let t,s=!1;e&&(t="MAIL_SEARCH_"+e.accountId+e.path,Xr.Z.isSubscribable(e)&&(s=!e.subscribed));const n=this.state.sorting.sortOrder===ui.Z.DESCENDING_SORT?"top":"bottom";return(0,zn.jsxs)("div",{className:"list-wrapper",onFocus:this.onFocus,onBlur:this.onBlur,onKeyDown:this.onKeyDown,children:[!s&&this.state.isLoading&&(0,zn.jsx)("span",{className:"mail-loading",children:(0,W.Z)("Loading selected view...")}),!s&&!this.state.isLoading&&this.state.list.length>0&&(0,zn.jsxs)(zn.Fragment,{children:[this.state.showScrollLatest&&A.Z.get(Z.kMailMessageListJumpToLatest)&&(0,zn.jsx)("div",{className:Gn()("jump-to-latest-container",this.state.sorting.sortOrder===ui.Z.ASCENDING_SORT&&"jump-to-latest-container-ascending"),children:(0,zn.jsxs)("button",{onClick:this.scrollToLatest,className:"jump-to-latest",onContextMenu:this.onContextMenu,children:[dy,(0,W.Z)("Jump to Latest"),(0,zn.jsx)("span",{className:"closeContainer",onClick:e=>{e.preventDefault(),e.stopPropagation(),this.scrollLatestDismissed=!0,this.setState({showScrollLatest:!1})},children:cy})]})}),(0,zn.jsx)(Mi,{ref:this.refTree,rowComponent:qw,getRowComponentProps:this.getRowComponentProps,nodes:this.state.list,onSelect:this.onSelect,onItemDoubleClick:this.onItemDoubleClick,onItemMouseDown:this.onItemMouseDown,onItemMouseUp:this.onItemMouseUp,onScroll:this.onScroll,delete:this.delete,disableSelectAfterDelete:!0,isFolder:this.isFolder,menu:this.menu,hasChildren:this.hasChildren,settings:t,rootId:0,isValidAddTarget:this.isValidAddTarget,disableClipboard:!0,rowHeight:this.getRowHeight,folderMode:"expand",selectionStoreKey:u.uP,getDragData:this.getDragData,mimeType:"vivaldi/x-mail-message",validateForDrag:e=>e,columns:this.props.columns,autoFocus:this.state.autoFocusEntry,sorting:this.state.sorting,stabilizeScrollTop:this.state.stabilizeScrollTop,onRowsRendered:this.onRowsRenderedDebounced,anchor:n})]}),!s&&!this.state.isLoading&&0===this.state.list.length&&(0,zn.jsxs)("span",{className:"mail-loading",children:[(0,zn.jsx)("div",{dangerouslySetInnerHTML:{__html:Kn.Fii}}),(0,W.Z)("No messages in selected view")]}),e&&s&&(0,zn.jsxs)("div",{className:"mail-folder-subscribe",children:[(0,zn.jsx)("h2",{children:(0,W.Z)("Subscribe to Folder")}),(0,zn.jsx)("p",{children:(0,W.Z)("You are currently not subscribed to the folder $2 of $1.",[e.accountId,It.Z.getFolderName(e.accountId,e.path)])}),(0,zn.jsx)("input",{type:"button",className:"primary",value:(0,W.Z)("Subscribe"),onClick:()=>d.Z.subscribeMailbox(this.context.vivaldiWindowId,e)})]})]})}}const uy=hy;class py extends Un.PureComponent{rules={from:(0,W.Z)("sender","From"),to:(0,W.Z)("To"),cc:(0,W.Z)("Cc"),subject:(0,W.Z)("Subject"),body:(0,W.Z)("Body"),...this.props.isSettings&&{anywhere:(0,W.Z)("Anywhere")}};state={rule:"",conjunction:this.props.type||this.props.isSettings?this.props.isEmpty?"":"AND":"NOT",ruleName:this.props.type||(this.props.isSettings?"anywhere":"from"),allMailAddresses:ml.Z.getMailAddresses(),isValidInput:!1,condition:"include"};_allMailAddressesChanged=()=>{this.setState({allMailAddresses:ml.Z.getMailAddresses()})};componentDidMount(){ml.Z.addListener(this._allMailAddressesChanged)}componentWillUnmount(){ml.Z.removeListener(this._allMailAddressesChanged)}onChangeRuleName=e=>{const t=e.target.value;switch(t){case"subject":case"body":case"to":case"from":case"cc":case"anywhere":this.setState({ruleName:t},(()=>{this.props.isSettings||this.onSubmit()}))}};onChange=e=>{this.setState({rule:e.target.value,isValidInput:e.target.value.trim().length>0},(()=>{this.props.isSettings||A.Z.get(Z.kMailSearchOnEnter)||(0,Te.Z)(this.onSubmit,100)()}))};onChangeConjunction=e=>{switch(e.target.value){case"NOT":case"AND":case"OR":this.setState({conjunction:e.target.value},(()=>{this.props.isSettings||this.onSubmit()}));break;case"from":case"to":case"cc":case"subject":case"body":this.setState({conjunction:"AND",ruleName:e.target.value},(()=>{this.props.isSettings||this.onSubmit()}))}};onSubmit=(e,t)=>{const{ruleName:s,condition:n,conjunction:i,rule:a}=this.state;this.props.onSubmit({ruleName:s,rule:a,condition:n,conjunction:i,mailAddresses:t},e),this.props.isSettings&&this.setState({rule:""})};onBeforeAddMailFilter=()=>{if(this.state.rule)return this.setState({showDialog:!0}),!0};addAddressToRuleGroup=e=>{if(this.props.isSettings){if(e.length>0){const t=e[0].address,s="equal",n=this.state.conjunction;this.props.onSubmit({ruleName:this.state.ruleName,rule:t,condition:s,conjunction:n})}}else this.onSubmit(!1,e)};setIsValidInput=e=>{this.state.isValidInput!==e&&this.setState({isValidInput:e})};onChangeCondition=e=>{const t=e.target.value;switch(t){case"equal":case"include":case"starts_with":this.setState({condition:t})}};onClose=e=>{if(e){const e=!0;this.onSubmit(e)}else this.setState({showDialog:!1})};render(){const e=[];for(const t of Object.keys(this.rules))e.push((0,zn.jsx)("option",{value:t,children:this.rules[t]},t));const t="AND"===this.state.conjunction;let s=[...this.props.isSettings?["AND","OR"]:[],"NOT"].map((e=>(0,zn.jsx)("option",{value:e,children:(0,W.Z)(e)},e)));return this.props.isSettings||(s=[...e,!this.props.isEmpty&&(0,zn.jsx)("optgroup",{label:(0,W.Z)("Conjunction"),children:s},"conjunction")]),(0,zn.jsxs)(zn.Fragment,{children:[this.props.type&&(0,zn.jsx)("span",{className:this.props.className,children:"from"===this.props.type?(0,W.Z)("mail","From"):"to"===this.props.type?(0,W.Z)("To"):(0,W.Z)("Cc")}),!this.props.type&&(!this.props.isEmpty||!this.props.isSettings)&&(0,zn.jsx)(Fa.Z,{onChange:this.onChangeConjunction,value:this.props.isSettings||"AND"!==this.state.conjunction?this.state.conjunction:this.state.ruleName,className:Gn()("MailFilterSelector-conjunctionContainer",this.props.className),children:s}),(0,zn.jsxs)("form",{onSubmit:this.onSubmit,className:Gn()("MailFilterSelector",!this.props.isSettings&&"MailFilterSelector--mailList",this.props.isSettings&&"MailFilterSelector--isSettings",!t&&"MailFilterSelector--multipleSelect",this.props.className),children:[(this.props.isSettings||!t)&&(0,zn.jsx)(Fa.Z,{onChange:this.onChangeRuleName,value:this.state.ruleName,children:this.rules&&e}),this.props.isSettings&&(0,zn.jsxs)(Fa.Z,{onChange:this.onChangeCondition,value:this.state.condition,children:[["from","cc","to"].includes(this.state.ruleName)&&(0,zn.jsx)(zn.Fragment,{children:(0,zn.jsx)("option",{value:"equal",children:(0,W.Z)("equals")})}),(0,zn.jsx)("option",{value:"include",children:(0,W.Z)("includes")}),(0,zn.jsx)("option",{value:"starts_with",children:(0,W.Z)("starts with")}),["subject","body","anywhere"].includes(this.state.ruleName)&&(0,zn.jsx)(zn.Fragment,{children:(0,zn.jsx)("option",{value:"equal",children:(0,W.Z)("equals")})})]}),(0,zn.jsxs)("div",{className:"MailFilterSelector-inputContainer",children:[["from","to","cc"].includes(this.state.ruleName)?(0,zn.jsx)(gw,{id:this.state.ruleName,selectedItems:this.props.selectedMailAddresses,allItems:this.state.allMailAddresses||new Map,itemSelectionCallback:this.addAddressToRuleGroup,setIsValidInput:this.setIsValidInput,onChange:this.onChange,clearInputOnBlur:this.props.isSettings,className:"MailFilterSelector-input",showTypedTextAsOption:!0}):(0,zn.jsx)("input",{type:"text",onChange:this.onChange,value:this.state.rule,className:"MailFilterSelector-input"}),this.props.isSettings&&(0,zn.jsx)("input",{type:"button",disabled:!this.state.isValidInput,onClick:this.onSubmit,value:(0,W.Z)("Add to Search")})]}),this.state.showDialog&&(0,zn.jsx)($C,{title:(0,W.Z)("Forgot to add to search"),prompt:[(0,W.Z)("We noticed you wrote something and didn't add it to the search. Would you like to add '$1' to the search?",[this.state.rule])],positive:(0,W.Z)("Add to Search"),negative:(0,W.Z)("Cancel"),onRequestClose:()=>this.setState({showDialog:!1}),onClose:this.onClose})]})]})}}const gy=py;const my=function(e){return(0,zn.jsxs)("label",{className:e.className,title:(0,W.Z)("Select whether the message can include attachments or not."),children:[(0,zn.jsx)("input",{type:"checkbox",checked:!!e.attachments,onChange:t=>{const s=t.currentTarget.checked?1:0;e.selectAttachments(s)}}),(0,zn.jsx)("span",{children:(0,W.Z)("Has Attachments")})]})};function fy(e){const{unseen:t,unread:s,total:n}=e;return t>0?t===s&&s===n?(0,W.Z)("$1 new message","$1 new messages",[t]):t===s?(0,W.Z)("$1 new message of $2 messages","$1 new messages of $2 messages",[t,n]):(0,W.Z)("$1 new in $2 unread of $3 messages","$1 new in $2 unread of $3 messages",[t,s,n]):s>0?s===n?(0,W.Z)("$1 unread message","$1 unread messages",[s]):(0,W.Z)("$1 unread of $2 messages","$1 unread of $2 messages",[s,n]):(0,W.Z)("$1 message","$1 messages",[n])}const vy=[Z.kMailCountersPanelUnseenEnabled];class by extends Un.Component{_isMounted=!1;state={unseen:0,unread:0,total:0};componentDidMount(){this._isMounted=!0,this._updateCounters(),bt.Z.addListener(this.onCountersChanged)}componentWillUnmount(){bt.Z.removeListener(this.onCountersChanged)}_updateCounters=(e=this.props)=>{const{accountId:t,path:s}=e;if(this._isMounted){const e=bt.Z.getCounters(t,s);this.setStateIfNeeded({unread:e&&e.unread||0,unseen:e&&e.unseen||0,total:e&&e.total||0})}};setStateIfNeeded=e=>{Object.getOwnPropertyNames(e).some((t=>e[t]!==this.state[t]))&&this.setState(e)};onCountersChanged=e=>{"counters"===e.target&&this._updateCounters()};handleMouseUp=e=>{const t=e.altKey;this.props.handleExpandClick(this.props.id,t)};render(){const e=this.state.unseen>0&&this.props.prefValues[Z.kMailCountersPanelUnseenEnabled],{unseen:t,unread:n,total:i}=this.state,a=this.props.label+" "+fy({unseen:t,unread:n,total:i});return(0,zn.jsx)("div",{className:"mail-panel-category-container",children:(0,zn.jsxs)("label",{className:"mail-panel-category"+(this.props.hasChildren?"":" empty"),title:a,children:[(0,zn.jsx)("span",{onClick:this.props.onClick,className:"title",children:this.props.label}),!this.props.isExpanded&&(0,zn.jsxs)("div",{className:"counter-container",children:[e&&(0,zn.jsx)("span",{className:"item-count counter-unseen",children:this.state.unseen}),this.state.unread>0&&(0,zn.jsx)("span",{className:"item-count counter-unread",children:this.state.unread})]}),this.props.hasChildren&&(0,zn.jsx)("span",{className:"expand-icon display-hint",onMouseDown:wi.ZP,onMouseUp:this.handleMouseUp,dangerouslySetInnerHTML:{__html:s(4103)}})]})})}}const Cy=(0,zd.Z)(by,vy),wy={},yy={};class xy extends Vo.Z{getAccountIndicator(e){let t,s=Object.keys(Nt.NB).length;if(wy[e]){const n=Object.keys(wy[e]);for(const i of n)wy[e][i].priority<s&&(s=wy[e][i].priority,t=wy[e][i])}if(yy[e])for(const n in yy[e])yy[e][n].priority<s&&(s=yy[e][n].priority,t=yy[e][n]);return t}getPrefetchProgress(){let e=0,t=0;for(const s in wy){const n=wy[s].INDICATOR_TYPE_PRE_FETCHING;n&&(e+=n.current,t+=n.total)}return{current:e,total:t}}getPathIndicator(e,t){if(yy[e]&&yy[e][t])return yy[e][t]}reset=()=>{for(const e in wy)delete wy[e];for(const e in yy)delete yy[e]};dispatchAction(e){switch(e.actionType){case"MAIL_INDICATOR_ADD_ACCOUNT":{const{accountId:t,indicatorType:s,priority:n,current:i,total:a}=e;!function(e,t,s,n,i){wy[e]||(wy[e]={});wy[e][t]={indicatorType:t,priority:s,current:n,total:i},Iy.emitChange()}(t,s,n,i,a);break}case"MAIL_INDICATOR_ADD_PATH":{const{accountId:t,path:s,indicatorType:n,priority:i,current:a,total:o}=e;!function(e,t,s,n,i,a){yy[e]||(yy[e]={});yy[e][t]={indicatorType:s,priority:n,current:i,total:a},Iy.emitChange()}(t,s,n,i,a,o);break}case"MAIL_INDICATOR_REMOVE_ACCOUNT":{const{accountId:t,indicatorType:s}=e;!function(e,t){wy[e]&&wy[e][t]&&(delete wy[e][t],Iy.emitChange())}(t,s);break}case"MAIL_INDICATOR_REMOVE_PATH":{const{accountId:t,path:s}=e;!function(e,t){yy[e]&&yy[e][t]&&(delete yy[e][t],Iy.emitChange())}(t,s);break}case"MAIL_INDICATOR_REMOVE_ALL":t=e.accountId,delete wy[t],delete yy[t],Iy.emitChange()}var t}}const Iy=new xy(S.Z);const Ay=Iy;var Sy=s(34198),Zy=s(81744);const Ty=[Z.kMailAccounts,Z.kMailCountersPanelArchiveEnabled,Z.kMailCountersPanelDraftsEnabled,Z.kMailCountersPanelJunkEnabled,Z.kMailCountersPanelTrashEnabled,Z.kMailCountersPanelUnseenEnabled,Z.kMailPanelActivityIndicatorsEnabled];function Ey(e){const t={disconnected:!1,isConnecting:!1,error:void 0},{isImap:s,isAccount:n,accountId:i,isOnline:a}=e;if(n){const e=Zd.Z.getAccountOrAlias(i);if(a)if(s){t.disconnected=!!e&&!e.offline&&Cd.Z.isDisconnected(i),t.isConnecting=Cd.Z.isConnecting(i);const s=xd.getLatestError(i);s&&(t.error=s.error.message)}else t.disconnected=!1;else t.disconnected=!!e&&!e.offline}return t}class ky extends Un.Component{static contextType=oi.Z;_isMounted=!1;state=function(e){return{unread:0,unseen:0,total:0,...Ey(e)}}(this.props);componentDidMount(){this._isMounted=!0,this._updateCounters(),bt.Z.addListener(this.onCountersChanged),Cd.Z.addListener(this.onConnectionChanged),Ay.addListener(this.onIndicatorsChanged)}componentWillUnmount(){this._isMounted=!1,bt.Z.removeListener(this.onCountersChanged),Cd.Z.removeListener(this.onConnectionChanged),Ay.removeListener(this.onIndicatorsChanged)}componentDidUpdate(e){if(e.isOnline!==this.props.isOnline){const e={...Ey(this.props)};this.setStateIfNeeded(e)}}onCountersChanged=e=>{"counters"===e.target&&this._updateCounters()};onConnectionChanged=()=>{const e={...Ey(this.props)};this.setStateIfNeeded(e)};onIndicatorsChanged=()=>{const e=this.props.path===Nt.ym?Ay.getAccountIndicator(this.props.accountId):Ay.getPathIndicator(this.props.accountId,this.props.path),t={indicator:""},s=this.props.isExpanded&&this.props.path===Nt.ym;if(e&&!s){const{indicatorType:s,current:n,total:i}=e,a=this.getIndicatorText(s);t.indicator=i>0?`${a} ${n}/${i}`:a}this.setState(t)};_updateCounters=(e=this.props)=>{if(this._isMounted){let{accountId:t,path:s}=e;t===Nt.Ry&&s!==Nt.ym&&([t,s]=Wt.ZP.fromCustomFolderPath(e.path));const n=bt.Z.getCounters(t,s);this.setStateIfNeeded({unread:n&&n.unread||0,unseen:n&&n.unseen||0,total:n&&n.total||0})}};setStateIfNeeded=e=>{Object.getOwnPropertyNames(e).some((t=>e[t]!==this.state[t]))&&this.setState(e)};getIndicatorText=e=>{switch(e){case"INDICATOR_TYPE_FLAGS":return(0,W.Z)("Updating Flags");case"INDICATOR_TYPE_THREADING":return(0,W.Z)("Threading");case"INDICATOR_TYPE_FLUSHING":return(0,W.Z)("Flushing");case"INDICATOR_TYPE_CONNECTING":return(0,W.Z)("Connecting");case"INDICATOR_TYPE_FETCHING":return(0,W.Z)("Fetching");case"INDICATOR_TYPE_PRE_FETCHING":return(0,W.Z)("Prefetching");default:return""}};isDrafts=()=>this.props.path===Nt.Wb||this.props.type===Nt.kY;isOutbox=()=>this.props.path===Nt.J8||this.props.type===Nt.fZ;isTrash=()=>this.props.path===Nt.cm||this.props.type===Nt.uT;isUnread=()=>this.props.path===Nt.tB;isSent=()=>this.props.path===Nt.N1||this.props.type===Nt.Nz;isJunk=()=>this.props.path===Nt.rp||this.props.type===Nt.Hd;isArchive=()=>this.props.path===Nt.$T||this.props.type===Nt.hn;isFeeds=()=>this.props.accountId===Nt.u4&&Nt.pG.test(this.props.path);isFeedsFolder=()=>this.props.accountId===Nt.u4&&!Nt.pG.test(this.props.path);isLabels=()=>this.props.accountId===Nt.ut;isFilters=()=>this.props.accountId===Nt.Kz;isFlags=()=>this.props.accountId===Nt.MN;isReceived=()=>this.props.path===Nt.ik||this.props.type===Nt.e9;isMailingList=()=>this.props.accountId===Nt.wC&&Sy.ZP.isMailingListPath(this.props.path);getImageSet=()=>this.props.isAccount?Kn.GtN:this.isSent()?Kn.zLp:this.isTrash()?Kn.nre:this.isJunk()?Kn.Qwh:this.isArchive()?Kn._w1:this.isFeedsFolder()?Kn._TQ:this.isFeeds()?Kn.ZU_:this.isUnread()?Kn.aAJ:this.isReceived()?Kn.LDV:this.isDrafts()?Kn.XTV:this.isFilters()?Kn.EnF:this.isLabels()?Kn.rpm:this.isFlags()?Kn.nyn:this.isMailingList()?Kn.GAD:void 0;_onError=e=>{const t=xd.getLatestError(this.props.name);t&&(0,wd.I)(t.code)?ue.Z.showMailAuthenticationDialog(this.context.vivaldiWindowId,{account:e}):ue.Z.showSettings(this.context.vivaldiWindowId,wt.Z.isMailOn()?"mail":"feeds")};_handleStatusIconClick=async()=>{if(this.state.disconnected&&!Cd.Z.isConnecting(this.props.name)){const e=await Zd.Z.loadAccount(this.props.name);this._onError(e)}else ue.Z.showSettings(this.context.vivaldiWindowId,"mail")};handleMouseUp=e=>{(0,wi.ZP)(e);const t=e.altKey;this.props.handleExpandClick(this.props.id,t)};render(){const e=this.props.prefValues[Z.kMailPanelActivityIndicatorsEnabled]&&this.state.indicator,t=this.state.unread>0&&!(this.isDrafts()||this.isOutbox()||this.isTrash()||this.isJunk()||this.isArchive()),s=t&&this.state.unseen>0&&this.props.prefValues[Z.kMailCountersPanelUnseenEnabled],n=this.state.total>0&&this.isOutbox(),i=this.state.total>0&&this.props.prefValues[Z.kMailCountersPanelTrashEnabled]&&this.isTrash(),a=this.state.unread>0&&this.props.prefValues[Z.kMailCountersPanelJunkEnabled]&&this.isJunk(),o=this.state.unread>0&&this.props.prefValues[Z.kMailCountersPanelArchiveEnabled]&&this.isArchive(),r=this.state.total>0&&this.props.prefValues[Z.kMailCountersPanelDraftsEnabled]&&this.isDrafts();let l;if(this.state.error)l=this.state.error;else if(this.props.isAccount&&!this.props.isOnline)l=(0,W.Z)("No network connection");else if(this.state.disconnected)l=(0,W.Z)("Disconnected");else{const{unseen:e,unread:t,total:s}=this.state;l=(this.isLabels()?(0,Zy.X)(this.props.name):(0,Cp.e)(this.props.name))+"\n"+fy({unseen:e,unread:t,total:s})}const d=this.props.level*Ni;let c;return c=this.props.hasChildren?0:this.props.level>1?d+Ni:d,(0,zn.jsxs)("label",{className:Gn()("mail_panel_node",{disabled:this.props.subscribable||this.props.internal}),title:l,onClick:this.props.onClick,children:[this.props.hasChildren&&0!==this.props.level&&(0,zn.jsx)("span",{className:"expand-icon",style:{marginLeft:d},onMouseDown:wi.ZP,onClick:this.handleMouseUp,dangerouslySetInnerHTML:{__html:Kn.nfH}}),(0,zn.jsx)(qn,{imageSet:this.getImageSet(),open:this.props.isExpanded,trash:this.isTrash(),disconnected:this.state.disconnected,isConnecting:this.state.isConnecting,leftMargin:c,onClickStatusIcon:this._handleStatusIconClick}),void 0!==this.props.inlineEditText&&(0,zn.jsx)("input",{type:"text",value:this.props.inlineEditText,onChange:this.props.onChange,onFocus:this.props.onFocus,onBlur:this.props.onBlur,autoFocus:!0}),void 0===this.props.inlineEditText&&(0,zn.jsxs)(Un.Fragment,{children:[(0,zn.jsx)("span",{className:"title",children:this.isLabels()?(0,Zy.X)(this.props.name):(0,Cp.e)(this.props.name)}),e&&(0,zn.jsx)("span",{className:"item-count counter-indicator",children:this.state.indicator}),s&&(0,zn.jsx)("span",{className:"item-count counter-unseen",children:this.state.unseen}),t&&(0,zn.jsx)("span",{className:"item-count counter-unread",children:this.state.unread}),a&&(0,zn.jsx)("span",{className:"item-count counter-unread",children:this.state.unread}),o&&(0,zn.jsx)("span",{className:"item-count counter-unread",children:this.state.unread}),(n||i||r)&&(0,zn.jsx)("span",{className:"item-count counter-total",children:this.state.total})]})]})}}const Ny=(0,zd.Z)(ky,Ty);class _y extends Un.PureComponent{state={isSyncing:Cd.Z.isSyncingAny()||Cd.Z.isSyncingFlagsAny(),isPrefetching:Cd.Z.isPreFetchingAny(),isPrefetchPaused:Cd.Z.isPrefetchPaused(),prefetchProgress:Ay.getPrefetchProgress()};componentDidMount(){Cd.Z.addListener(this.#pe),Ay.addListener(this.#ge)}componentWillUnmount(){Cd.Z.removeListener(this.#pe),Ay.removeListener(this.#ge)}#me=()=>{d.Z.pausePrefetching("userRequest",!this.state.isPrefetchPaused)};#pe=e=>{const t={};void 0!==e.isPreFetching&&(t.isPrefetching=Cd.Z.isPreFetchingAny()),void 0!==e.isPrefetchPaused&&(t.isPrefetchPaused=Cd.Z.isPrefetchPaused()),void 0===e.isSyncing&&void 0===e.isSyncingFlags||(t.isSyncing=Cd.Z.isSyncingAny()||Cd.Z.isSyncingFlagsAny()),this.setState(t)};#ge=()=>{this.setState({prefetchProgress:Ay.getPrefetchProgress()})};render(){const{isSyncing:e,isPrefetching:t,isPrefetchPaused:s,prefetchProgress:n}=this.state;return t||s?(0,zn.jsx)("div",{children:(0,zn.jsxs)("div",{className:"StatusPopup-Footer PrefetchProgress toolbar-default",children:[(0,zn.jsx)("h2",{children:(0,W.Z)("Downloading messages")}),(0,zn.jsx)("p",{className:"info",children:e?(0,W.Z)("Downloading messages put on hold while indexing headers and flags."):(0,W.Z)("Messages are being downloaded for offline viewing, and better search results.")}),(0,zn.jsxs)("div",{className:"progress-wrapper",children:[(0,zn.jsx)("progress",{style:{"--duration":"500ms","--progress":n.current/n.total},className:Gn()("DownloadItem-ProgressBar",{visible:!0,loading:!this.state.isPrefetchPaused}),value:0===n.total?0:n.current/n.total*100,max:100}),!s&&!e&&(0,zn.jsx)("span",{className:"prefetch-details",children:n.total>0?(0,W.Z)("$1 of $2",[n.current,n.total]):"..."}),s&&(0,zn.jsx)("span",{className:"prefetch-details",children:(0,W.Z)("Paused")}),e&&!s&&(0,zn.jsx)("span",{className:"prefetch-details",children:(0,W.Z)("Waiting")})]}),(0,zn.jsx)(oa.ZP,{disabled:e||s&&!Cd.Z.canResumePrefetch("userRequest"),tooltip:s?(0,W.Z)("verb","Resume downloading"):(0,W.Z)("verb","Pause downloading"),title:s?(0,W.Z)("verb","Resume"):(0,W.Z)("verb","Pause"),onClick:this.#me,image:s?Kn.sxZ.small:Kn.Q9E.small})]})}):null}}const Py=_y;var My=s(74652),Dy=s(59552),Oy=s(30628),jy=s(68906);async function Ly(e,t){return rs.Z.searchList.update(e,t)}var Ry=s(26067);async function By(){const e=A.Z.get(Z.kRssSettings)||[];if(0===e.length)return void ls.Z.error("Feeds",["restore"],"No settings found for Feeds and hence unable to restore");h.Z.setStatus(u.A4,(0,W.Z)("Restoring filters for feeds ..."));const t=At.Z.getByAccountId(Nt.u4).filter((e=>Nt.pG.test(e.path))),s=[];for(const n of e){if(!t.find((e=>e.path.endsWith(n.feedId)))){ls.Z.warn("Feeds",["restore"],`adding missing filter for ${n.title}`);const e=await Cs(n.title||n.url,n.feedId);t.push(e),s.push(e.id)}}const i=Ts()(Nt.u4).substring(0,6),a=await re.Z.mailPrivate.getFileDirectory(i);if(!a)return ls.Z.error("Feeds",["restore"],"Root path for feeds not found on disk"),void Ls.forceRefreshAllRSSAccounts();const o=await re.Z.mailPrivate.getFilePaths(a);if(0===o.length)return ls.Z.error("Feeds",["restore"],"No feed files found"),void Ls.forceRefreshAllRSSAccounts();const r=[],l=[],c=new Map;for(const e of o){const t=(0,Ry.BB)(Nt.u4),s=RegExp(`${t}/([0-9]{4})/([0-9]{2})/([0-9]{2})/([0-9]+).eml`).exec(e);if(!s){ls.Z.error("Feeds",["restore"],`File path does not fit expected format for a feed file: ${e}`);continue}const[,n,i,a,o]=s;c.set(Number(o),{feedsRootFolder:t,filePath:e,year:n,month:i,day:a})}const p=[...c.keys()];h.Z.setStatus(u.A4,(0,W.Z)("Restoring filters for feeds - files found on disk: $1",[p.length]));const g=await rs.Z.searchList.where("id").anyOf(p).toArray();for(const[n,i]of c){const{feedsRootFolder:a,filePath:o,year:c,month:p,day:m}=i;h.Z.setStatus(u.A4,(0,W.Z)("Restoring filters for feeds - restoring file: $1",[o]));const f=await re.Z.mailPrivate.readFileToText(o),v=f.match(/xml:base="([^"]+)"/);if(!v){ls.Z.error("Feeds",["restore"],`No url found in file ${o}`);continue}const b=v[1].replaceAll("&amp;","&");if(r.includes(b))continue;const C=e.find((e=>e.url===b));if(!C){r.push(b),ls.Z.error("Feeds",["restore"],`settings for ${b} missing from prefs and hence unable to restore`);continue}const w=t.find((e=>e.path.endsWith(C.feedId))),y=g.find((e=>e.id===n));let x;if(w)x=w.id;else{ls.Z.warn("Feeds",["restore"],`adding missing filter for ${b}`);const e=await Cs(C.title||C.url,C.feedId);if(!e){ls.Z.error("Feeds",["restore"],`failed to add new filter for ${b}`);continue}x=e.id,s.push(x)}if(y){const e=y.sourceFilterIds[0];if(e!==x){ls.Z.warn("Feeds",["restore"],`Re-assigning filter ${e} to ${x} for entry ${y.id}`);const t=y.sources.get(e),s={deleted:!1,internal:!0,read:!1},n=new Map,i=t?{...t}:{...s};n.set(x,i);const a={sourceFilterIds:[x],sources:n};await Ly(y.id,a);const o=t?{...t}:{...s},r=new Map;r.set(x,o),r.set(e,void 0);const c={sourceFilterIds:[x],sources:r},h={id:y.id,updates:c};d.Z.updateIndex({sleUpdates:[h]}),l.push(y.id)}}else{ls.Z.warn("Feeds",["restore"],`adding missing entry for ${n}`);const e=(0,Ps.ho)(f);if("string"==typeof e){ls.Z.error("Feeds",["restore"],e);continue}const t={pubDate:/^https?:\/\/(\w+\.)?youtube\.com\//i.test(b)},s=e.feeditems.map((e=>({accountId:Nt.u4,feedId:C.feedId,subject:e.plaintitle,bodyParts:(0,Ms.O)(e),raw:f,sentDate:new Date(Number(c),Number(p)-1,Number(m)).getTime(),messageId:Ts()(Ds(e,t)),from:[{name:C.title,address:C.title}],replyTo:[],to:[],cc:[],flags:[],internal:!0}))),i=await hs(C.feedId,s);1!==i.length&&ls.Z.error("Feeds",["restore"],"Expected one-to-one between sle and file for feeds"),d.Z.updateIndex({addedSles:i});const o=i[0].id,r=[a,c,p,m];ls.Z.warn("Feeds",["restore"],`writing raw message to new file: ${r.join("/")}/${o}.eml`);const l=`${n}.eml`,h=`_${o}.eml`;try{await re.Z.mailPrivate.renameMessageFile(r,l,h)}catch(e){console.error(e)}}}const m=await re.Z.mailPrivate.getFilePaths(a);for(const e of m){const t=e.split("/"),s=t[t.length-1];if("_"===s[0]){const e=t.slice(t.length-5,t.length-1),i=s.substr(1);h.Z.setStatus(u.A4,(0,W.Z)("Restoring filters for feeds - renaming file:",[i])),await re.Z.mailPrivate.renameMessageFile(e,s,i),n.Z.runtime.lastError&&ls.Z.error("Feeds",["restoreLostFeeds","renameMessageFile",s,i],n.Z.runtime.lastError)}}s.length>0&&await jy.Z.call({type:"RUN_FILTERS",priority:Nt.Un.LOW,filterIds:s}),l.length>0&&await jy.Z.call({type:"RE_RUN_SLES",priority:Nt.Un.LOW,searchListIds:l}),s.length+l.length>0&&ms.Z.filter(),Ls.forceRefreshAllRSSAccounts(),h.Z.setStatus(u.A4,(0,W.Z)("Restoring filters for feeds - Finished!"),Nt.QM)}var Fy=s(95064),Wy=s(20570);var Uy=s(70752),Vy=s(72046),Hy=s(56551);const Gy=I.Z.getEventHandler,Ky=[Z.kFeaturesMail,Z.kMailDisplayMailPanelViewingMail,Z.kMailOpenPanelAutomaticallyViewingMail,Z.kMailPanelActivityIndicatorsEnabled,Z.kMailPanelItemsOrder,Z.kMailPanelItemsShowAccounts,Z.kMailPanelItemsShowAllMessages,Z.kMailPanelItemsShowCustomFolders,Z.kMailPanelItemsShowFeeds,Z.kMailPanelItemsShowFilters,Z.kMailPanelItemsShowFlags,Z.kMailPanelItemsShowLabels,Z.kMailPanelItemsShowMailingLists,Z.kMailPanelShowErrorMessages,Z.kMailShowUnsubscribed,Z.kMailSingleClickTabs],zy=new Map([["ALL_MESSAGES",{key:"ALL_MESSAGES",name:(0,W.Z)("All Messages"),showPref:Z.kMailPanelItemsShowAllMessages}],["CUSTOM_FOLDERS",{key:"CUSTOM_FOLDERS",name:(0,W.Z)("Custom Folders"),showPref:Z.kMailPanelItemsShowCustomFolders}],["MAILING_LISTS",{key:"MAILING_LISTS",name:(0,W.Z)("Mailing Lists"),showPref:Z.kMailPanelItemsShowMailingLists}],["FILTERS",{key:"FILTERS",name:(0,W.Z)("Filters"),showPref:Z.kMailPanelItemsShowFilters}],["FLAGS",{key:"FLAGS",name:(0,W.Z)("Flags"),showPref:Z.kMailPanelItemsShowFlags}],["LABELS",{key:"LABELS",name:(0,W.Z)("Labels"),showPref:Z.kMailPanelItemsShowLabels}],["FEEDS",{key:"FEEDS",name:(0,W.Z)("Feeds"),showPref:Z.kMailPanelItemsShowFeeds}],["ACCOUNTS",{key:"ACCOUNTS",name:(0,W.Z)("All Accounts"),showPref:Z.kMailPanelItemsShowAccounts}]]);class $y extends Un.PureComponent{constructor(e){super(e)}moveItem=(e,t)=>{const s=this.props.prefValues[Z.kMailPanelItemsOrder].slice(),[n]=s.splice(e,1);s.splice(t,0,n),I.Z.set(Z.kMailPanelItemsOrder,s)};toggleShow=e=>{I.Z.toggle(e,!0,!1)};renderListItem=(e,t)=>{const{key:s,name:n,showPref:i}=t,a=this.props.prefValues[i];return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("input",{type:"checkbox",value:s,checked:a,onChange:this.toggleShow.bind(this,i)}),n]})};render(){const e=[];for(const t of this.props.prefValues[Z.kMailPanelItemsOrder]){const s=zy.get(t);s&&e.push(s)}return(0,zn.jsxs)(Vy.Z,{categoryTitle:(0,W.Z)("mail settings","Mail Panel"),filter:this.props.filter,children:[(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("mail","Panel")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.props.prefValues[Z.kMailDisplayMailPanelViewingMail],onChange:Gy(Z.kMailDisplayMailPanelViewingMail)}),(0,zn.jsx)("span",{children:this.props.prefValues[Z.kFeaturesMail]?(0,W.Z)("Display Mail Panel when Viewing Mail"):(0,W.Z)("Display Feeds Panel when Viewing Feeds")})]})}),(0,zn.jsx)("div",{className:"setting-single pad-left",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.props.prefValues[Z.kMailOpenPanelAutomaticallyViewingMail],disabled:!this.props.prefValues[Z.kMailDisplayMailPanelViewingMail],onChange:Gy(Z.kMailOpenPanelAutomaticallyViewingMail)}),(0,zn.jsx)("span",{children:(0,W.Z)("Open Panel Automatically")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.props.prefValues[Z.kMailSingleClickTabs],onChange:Gy(Z.kMailSingleClickTabs)}),(0,zn.jsx)("span",{children:(0,W.Z)("Open Message Tabs with Single Click")})]})}),(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.props.prefValues[Z.kMailPanelActivityIndicatorsEnabled],onChange:Gy(Z.kMailPanelActivityIndicatorsEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("Show Activity Indicators")})]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Briefly display status next to folders when updating.")})]}),this.props.prefValues[Z.kFeaturesMail]&&(0,zn.jsxs)("div",{children:[(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.props.prefValues[Z.kMailPanelShowErrorMessages],onChange:Gy(Z.kMailPanelShowErrorMessages)}),(0,zn.jsx)("span",{children:(0,W.Z)("Error Messages")})]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Display errors in Mail Panel. They are also accessible via Mail Status Button.")})]}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.props.prefValues[Z.kMailShowUnsubscribed],onChange:Gy(Z.kMailShowUnsubscribed)}),(0,zn.jsx)("span",{children:(0,W.Z)("Show Unsubscribed Mailboxes")})]})})]})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Mail Panel Order and Visibility")}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Hide, show and re-order folders in the Mail Panel.")}),(0,zn.jsx)(Hy.Z,{filter:this.props.filter,items:e,moveItem:this.moveItem,renderListItem:this.renderListItem,supportDragAndDrop:!0,mimeType:"vivaldi/x-settings-quick-command-type"})]})]})}}const Yy=(0,zd.Z)($y,Ky);var Xy=s(34155);const Qy="vivaldi/x-mail-message",qy=[Nt.W4,Nt.cs],Jy=[Nt.T4.RED,Nt.T4.ORANGE,Nt.T4.YELLOW,Nt.T4.GREEN,Nt.T4.BLUE,Nt.T4.PURPLE,Nt.T4.GRAY],ex=[Nt.w1+"_"+Nt.Sp,Nt.w1,Nt.rQ,Nt.q0,Nt.pz,Nt.sM,Nt.Ry,Nt.jT];const tx=()=>{const e=A.Z.get(Z.kMailPanelItemsOrder),t=vx(),s=[];for(const i of e)switch(i){case"ALL_MESSAGES":if(t.showAllMessages){const e=(n=mx(),{name:Bp,accountId:Nt.of,path:Nt.ym,id:Nt.w1,children:n});s.push(e)}break;case"CUSTOM_FOLDERS":if(t.showCustomFolders){const e=!t.showUnsubscribed,n=Kp(fx(e));s.push(n)}break;case"MAILING_LISTS":if(t.showMailingLists){const e=gx(bt.Z.getByAccountId(Nt.wC),Nt.jT),t=e.find((e=>e.path===Nt.cs));t&&(t.name=(0,W.Z)("Mailing Lists","Other"));const n=e.find((e=>e.path===Nt.W4));n&&(n.name=(0,W.Z)("Mailing Lists","Important"));const i=zp(e.sort(cx));s.push(i)}break;case"FILTERS":if(t.showFilters){const e=$p(gx(bt.Z.getByAccountId(Nt.Kz),Nt.rQ).sort(Ut.JM));s.push(e)}break;case"FLAGS":if(t.showFlags){const e=Yp(gx(bt.Z.getByAccountId(Nt.MN),Nt.q0).sort(hx));s.push(e)}break;case"LABELS":if(t.showLabels){const e=(0,Dp._c)(),t=Xp(gx(e,Nt.pz));s.push(t)}break;case"FEEDS":if(t.showFeeds){const e=Qp(gx(bt.Z.getByAccountId(Nt.u4),Nt.sM).sort(Ut.DF));s.push(e)}break;case"ACCOUNTS":if(t.showAccounts){const e=It.Z.getAccounts(),n=A.Z.get(Z.kMailAccounts).map((e=>e.MAIL_EMAIL)),i=new Map(n.map(((e,t)=>[e,t]))),a=(e,t)=>(i.get(e)??1/0)-(i.get(t)??1/0),o=[],r=Xr.Z.getFolders(e,t.showUnsubscribed,a);for(const e of r)e.accountId!==Nt.u4&&o.push({...e,type:"All",subscribed:!0});const l={name:(0,W.Z)("All Accounts"),path:Nt.ym,accountId:Nt.Sp,id:Nt.w1+"_"+Nt.Sp,children:o};s.push(l)}break;default:throw Error("Invalid mail panel item key: "+i)}var n;return s},sx=()=>[Qp(gx(bt.Z.getByAccountId(Nt.u4),Nt.sM).sort(Ut.DF))];var nx=(0,zn.jsx)("hr",{}),ix=(0,zn.jsx)("progress",{}),ax=(0,zn.jsx)("hr",{}),ox=(0,zn.jsx)("progress",{}),rx=(0,zn.jsx)(Py,{}),lx=(0,zn.jsx)("div",{className:"vpn-alert",children:(0,zn.jsx)(fw,{})});class dx extends Un.PureComponent{refTreeList=Un.createRef();static contextType=oi.Z;winId=this.context.vivaldiWindowId;_isMounted=!1;#fe=()=>"PanelFeeds"===this.props.panelId;#ve=()=>"PanelMail"===this.props.panelId;state={mailFolders:this.#fe()?sx():tx(),mailAccounts:It.Z.getAccounts(),online:navigator.onLine,showHiddenMailingLists:!1,indexProgress:bt.Z.isInitialized()?100:0,showErrors:A.Z.get(Z.kMailPanelShowErrorMessages),isCheckingMail:!1,waitingForAccountCache:!It.Z.hasLoadedFolders()&&(A.Z.get(Z.kMailAccounts).length>0||A.Z.get(Z.kRssSettings).length>0),isRestoringFeeds:!1,errorMessages:[],hasCriticalError:!1,clearFeedsConfirmation:!1};componentDidMount(){this._isMounted=!0,It.Z.addListener(this.gotFolders),bt.Z.addListener(this.#be),Cd.Z.addListener(this.#pe),tn.ZP.addListener(this.#Ce),Ct.Z.addListener(this.#we),this.context.addEventListener("online",this.#ye),this.context.addEventListener("offline",this.#xe),this.#ve()&&(A.Z.addListener([Z.kMailShowUnsubscribed],ts.Z.reconnectIMAPClients),A.Z.addListener([Z.kMailPanelItemsOrder,Z.kMailPanelItemsShowAccounts,Z.kMailPanelItemsShowAllMessages,Z.kMailPanelItemsShowCustomFolders,Z.kMailPanelItemsShowFeeds,Z.kMailPanelItemsShowFilters,Z.kMailPanelItemsShowFlags,Z.kMailPanelItemsShowLabels,Z.kMailPanelItemsShowMailingLists,Z.kMailShowUnsubscribed,Z.kMailLabelItemsOrder,Z.kMailLabelItemsHide,Z.kMailVpnNoticeDismissed],this.#Ie),A.Z.addListener(Z.kMailAccounts,this.#Ae)),A.Z.addListener([Z.kMailPanelShowErrorMessages],this.#Se),xd.addListener(this.#Ze),this.#Ze()}componentDidUpdate(e){!e.open&&this.props.open&&this.props.focusContent&&Xy.nextTick((()=>{this.refTreeList.current?.focusTree()}))}componentWillUnmount(){this._isMounted=!1,this.context.removeEventListener("online",this.#ye),this.context.removeEventListener("offline",this.#xe),It.Z.removeListener(this.gotFolders),bt.Z.removeListener(this.#be),Cd.Z.removeListener(this.#pe),tn.ZP.removeListener(this.#Ce),Ct.Z.removeListener(this.#we),A.Z.removeListener([Z.kMailPanelShowErrorMessages],this.#Se),this.#ve()&&(A.Z.removeListener([Z.kMailShowUnsubscribed],ts.Z.reconnectIMAPClients),A.Z.removeListener([Z.kMailPanelItemsOrder,Z.kMailPanelItemsShowAccounts,Z.kMailPanelItemsShowAllMessages,Z.kMailPanelItemsShowCustomFolders,Z.kMailPanelItemsShowFeeds,Z.kMailPanelItemsShowFilters,Z.kMailPanelItemsShowFlags,Z.kMailPanelItemsShowLabels,Z.kMailPanelItemsShowMailingLists,Z.kMailShowUnsubscribed,Z.kMailLabelItemsOrder,Z.kMailLabelItemsHide,Z.kMailVpnNoticeDismissed],this.#Ie),A.Z.removeListener(Z.kMailAccounts,this.#Ae)),xd.removeListener(this.#Ze)}#Ze=()=>{const e=[];let t=!1;for(const[s,n]of xd.getState())for(let i=n.length-1;i>=0;i--){const{category:a,error:o,code:r,level:l}=n[i];let d;if("CRITICAL"===l&&(t=!0),"DATABASE"===a||"SMTP"===a?d=o.message:(0,wd.I)(r)&&(d=(0,W.Z)("Authentication failed. Check username and password")),d){e.push({accountId:s,category:a,message:d,level:l});break}}this.setState({errorMessages:e,hasCriticalError:t})};#Te=(e,t,s)=>{this.openMailbox(t[0],s)};#Ee=e=>{this.openMailbox(e,!1)};#pe=()=>{navigator.onLine?this.#ye():this.#xe()};#we=()=>{Xy.nextTick((()=>{const e=Ct.Z.getSelectedFolder();e&&this.refTreeList.current?.selectByNode(e)}))};#ye=()=>{this.setState({online:!0})};#xe=()=>{this.setState({online:!1})};#be=e=>{if("mailingLists"===e.target){const e=this.#fe()?sx():tx();this.setState({mailFolders:e})}else if("filters"===e.target){let t;const{filterIds:s}=e;if(s){const e=bt.Z.getByIds(s),n=[Nt.Kz,Nt.MN,Nt.ut,Nt.u4,Nt.of,Nt.Ry,Nt.wC];t=s.length>e.length||e.some((e=>n.includes(e.accountId)))}else t=!0;if(t){const e=this.#fe()?sx():tx();this.setState({mailFolders:e})}}else if("updateIndexProgress"===e.target){const t=Math.floor(e.indexCount/e.total*100)||0;this.setState({indexProgress:t})}else if("finishIndexProgress"===e.target){const e=this.#fe()?sx():tx();this.setState({mailFolders:e,indexProgress:100})}};#Ce=()=>{const e=this.refTreeList.current?.getWrapper(),t=tn.ZP.getChangeReason();this.props.open&&"setFocus"===t&&e instanceof this.context.HTMLElement&&!(0,vo.sT)(this.context.document,e)&&this.refTreeList.current?.focusTree()};gotFolders=()=>{const e=this.#fe()?sx():tx();this.setState({mailFolders:e,mailAccounts:It.Z.getAccounts(),waitingForAccountCache:!1})};getAllAccountMailboxes=e=>{const t=[];let s;switch(e.path){case Nt.N1:s=Nt.Nz;break;case Nt.rp:s=Nt.Hd;break;case Nt.cm:s=Nt.uT;break;case Nt.$T:s=Nt.hn}if(s){const e=It.Z.getAccounts();for(const n in e){e[n].folders[s]?.forEach((({type:e,path:i,subscribed:a})=>{e===s&&t.push({accountId:n,path:i,subscribed:a})}))}}return t};fixPathInCustomFolders=e=>{if(e.accountId===Nt.Ry&&e.path!==Nt.ym){const[t,s]=Wt.ZP.fromCustomFolderPath(e.path);return{...e,accountId:t,path:s}}return{...e}};openMailbox=(e,t=!0)=>{const s=this.fixPathInCustomFolders(e),n=Ze.ZP.getActivePage(this.context.vivaldiWindowId),i=n&&(0,vs.NC)(n.url),a=Ct.Z.getSelectedFolder()?.id===s.id;Xy.nextTick((()=>{if(i||c.ZP.openURL(this.context.vivaldiWindowId,vs.jk.internals.mailpage,{singleton:!0}),a)d.Z.clearSearch();else{(s.accountId===Nt.of?this.getAllAccountMailboxes(s):[{...s}]).forEach((({accountId:e,path:t,subscribed:s})=>{t!==Nt.ym&&e&&((0,_t.mq)(e)&&s&&"string"==typeof t?ts.Z.checkNewDeletedModified(e,t):(0,_t.Vd)(e)&&is.Z.checkForMail(e))})),d.Z.selectFolder(s)}!t||i&&a||setTimeout((()=>{this.context.document.querySelector(".webpageview.active #mail_search .VivaldiList")?.focus()}),200)}))};handleMailboxClick=e=>{this.openMailbox(e)};#ke=(e,t)=>{this.refTreeList.current?.toggleSelectedExpansion(e,t)};#Ne=e=>{const{node:t,level:s}=e;if(0===s)return(0,zn.jsx)(Cy,{id:t.id,name:t.name,label:t.name,handleExpandClick:this.#ke,hasChildren:this.#_e(t),onClick:this.handleMailboxClick.bind(this,t),isExpanded:e.isExpanded,accountId:t.accountId,path:t.path},t.id);let{name:n}=t;const i=Xr.Z.isAccountRootFolder(t);let a=!1;if(i){const e=Zd.Z.getAccountOrAlias(t.accountId);e?.displayName&&(n=e?.displayName),a=this.state.online}return(0,zn.jsx)(Ny,{name:n,accountId:t.accountId,id:t.id,type:t.type,path:t.path,isAccount:i,isImap:(0,_t.ZA)(t.accountId),isOnline:a,level:s,onClick:this.handleMailboxClick.bind(this,t),isExpanded:e.isExpanded,onChange:e.onChange,onFocus:e.onFocus,onBlur:e.onBlur,inlineEditText:e.inlineEditText,handleExpandClick:this.#ke,hasChildren:this.#_e(t),subscribable:Xr.Z.isSubscribable(t)&&!t.subscribed,internal:It.Z.isInternal(t.accountId,t.path)},t.id)};#Pe=()=>!0;#Me=()=>{const e=[];for(const t of A.Z.get(Z.kMailPanelItemsOrder)){const s=zy.get(t);s&&e.push({handler:this.#De.bind(this,s.showPref),type:"checkbox",checked:A.Z.get(s.showPref),label:s.name,labelEnglish:s.name})}return e};#De=e=>{I.Z.toggle(e,!0,!1)};#_e=e=>Boolean(e.children&&e.children.length>0);#Oe=()=>{ue.Z.showMailAccountDialog(this.context.vivaldiWindowId)};#je=()=>{ss.Z.sendAll(this.context.vivaldiWindowId)};#Le=e=>{ss.Z.sendForAccount(this.context.vivaldiWindowId,e)};#Re=(e,t)=>{ts.Z.rescanUnreadFlags(e,t)};#Be=(e,t)=>{ue.Z.showAddMailFolder(this.context.vivaldiWindowId,{accountId:e,path:t})};#Fe=(e,t)=>{ue.Z.showDeleteMailFolder(this.context.vivaldiWindowId,{accountId:e,path:t})};#We=e=>{e||(e=Nt.ym),ue.Z.showAddFeedFolder(this.context.vivaldiWindowId,{path:e})};#Ue=e=>{ue.Z.showDeleteFeedFolder(this.context.vivaldiWindowId,{path:e})};#Ve=async(e,t,s)=>{const n=this.winId;switch(e.action){case"CONTEXT_VIEW_ALL_MESSAGES":return{handler:()=>this.openMailbox(s),isVisible:()=>Boolean(s),...t(n,e,{})};case"CONTEXT_RERUN_FILTER":return{handler:()=>d.Z.rerunFilter(s.accountId,s.path||Nt.ym),isVisible:()=>Boolean(s),...t(n,e,{})};case"CONTEXT_RESYNC_FOLDER":return{handler:()=>d.Z.reSyncFolder(s.accountId,s.path),isVisible:()=>Boolean(s)&&Boolean(s.path)&&!s.internal&&(0,_t.mq)(s.accountId)&&s.path!==Nt.ym,...t(n,e,{})};case"CONTEXT_RESYNC_ACCOUNT":return{handler:()=>d.Z.reSyncAccount(s.accountId),isVisible:()=>Boolean(s)&&(0,_t.mq)(s.accountId)&&s.path===Nt.ym,...t(n,e,{})};case"CONTEXT_RECONNECT_ACCOUNT":return{handler:()=>d.Z.reconnectAccount(s.accountId),isVisible:()=>Boolean(s)&&(0,_t.mq)(s.accountId)&&s.path===Nt.ym,...t(n,e,{})};case"CONTEXT_MARK_ALL_AS_READ":{const i=s?St.Z.getFolderType(s.accountId,s.path):"";return{handler:()=>d.Z.markAllRead(s.accountId,s.path),isVisible:()=>Boolean(s)&&i!==Nt.Nz&&i!==Nt.kY&&i!==Nt.hn&&i!==Nt.fZ,...t(n,e,{})}}case"CONTEXT_MOVE_ALL_TO_TRASH":{const i=s?St.Z.getFolderType(s.accountId,s.path):"";return{handler:()=>function(e,t,s,n){const i=bt.Z.getListEntriesByFolder(t,s);Pp.Z.prepareDelete(e,!1,i,n)}(n,s.accountId,s.path,!0),isVisible:()=>Boolean(s)&&(i===Nt.Hd||i===Nt.kY||i===Nt.fZ),...t(n,e,{})}}case"CONTEXT_EMPTY_TRASH":{const i=s?St.Z.getFolderType(s.accountId,s.path):"";return{handler:()=>async function(e,t,s){if(St.Z.getFolderType(t,s)!==Nt.uT)throw new Error("Non-Trash folder can not be emptied");const n=bt.Z.getListEntriesByFolder(t,s);await Pp.Z.prepareDelete(e,!0,n)}(n,s.accountId,s.path),isVisible:()=>Boolean(s)&&i===Nt.uT,...t(n,e,{})}}case"CONTEXT_CHECK_FOR_MAIL":return{handler:()=>this.#He(s.accountId),isVisible:()=>Boolean(s)&&Xr.Z.isAccountRootFolder(s)&&!(0,_t.S9)(s.accountId),...t(n,e,{})};case"CONTEXT_CREATE_FOLDER":return{handler:()=>this.#Be(s.accountId,s.path),isVisible:()=>Boolean(s)&&(0,_t.ZA)(s.accountId)&&!s.internal&&!(0,_t.S9)(s.accountId),...t(n,e,{})};case"CONTEXT_DELETE_FOLDER":return{handler:()=>this.#Fe(s.accountId,s.path),isVisible:()=>Boolean(s)&&(0,_t.ZA)(s.accountId)&&Xr.Z.isAccountSubFolder(s)&&"inbox"!==s.path.toLowerCase(),...t(n,e,{})};case"CONTEXT_CREATE_FEED_FOLDER":return{handler:()=>this.#We(Nt.pG.test(s.path)?"":s.path),isVisible:()=>Boolean(s)&&s.accountId===Nt.u4&&s.path!==Nt.cm,...t(n,e,{})};case"CONTEXT_DELETE_FEED_FOLDER":return{handler:()=>this.#Ue(s.path),isVisible:()=>Boolean(s)&&s.accountId===Nt.u4&&!Nt.pG.test(s.path)&&s.path!==Nt.cm&&s.path!==Nt.ym,...t(n,e,{})};case"CONTEXT_TOGGLE_MAIL_VIEWS":return{isVisible:()=>Boolean(s)&&this.#ve(),...t(n,e,{})};case"CONTEXT_MAIL_FOLDER":return{items:this.#Me(),...t(n,e,{})};case"CONTEXT_SEND":return{handler:()=>this.#Le(s.accountId),isVisible:()=>Boolean(s)&&Xr.Z.isAccountRootFolder(s),...t(n,e,{})};case"CONTEXT_RESCAN_UNREAD":return{handler:()=>this.#Re(s.accountId,s.path),isVisible:()=>Boolean(s)&&!s.internal&&Xr.Z.isAccountSubFolder(s)&&(0,_t.ZA)(s.accountId)&&!(0,_t.S9)(s.accountId),...t(n,e,{})};case"CONTEXT_IMPORT_MAIL_FILES":return{handler:()=>d.Z.selectAndImportMailFiles(this.context,s),isVisible:()=>Boolean(s)&&Xr.Z.isAccountSubFolder(s),...t(n,e,{})};case"CONTEXT_SUBSCRIBE":return{handler:()=>d.Z.subscribeMailbox(n,s),isVisible:()=>Boolean(s)&&Xr.Z.isSubscribable(s)&&!s.subscribed&&!s.internal,...t(n,e,{})};case"CONTEXT_UNSUBSCRIBE":return{handler:()=>ue.Z.showMailUnsubscribeDialog(n,{folder:s}),isVisible:()=>Boolean(s)&&Xr.Z.isUnsubscribable(s)&&s.subscribed&&!s.internal,...t(n,e,{})};case"CONTEXT_RERUN_THREADING":return{handler:()=>d.Z.rerunThreading(s.accountId,s.path),isVisible:()=>Boolean(s)&&Xr.Z.isAccountSubFolder(s),...t(n,e,{})};case"CONTEXT_MOVE_INTO_IMPORTANT":{const i=Boolean(s)&&s.accountId===Nt.wC&&s.path!==Nt.ym?bt.Z.getByFolder(s.accountId,s.path):null,a=i&&i.path!==Nt.cs&&i.path!==Nt.W4&&i.path.startsWith(Nt.cs);return{handler:()=>d.Z.toggleMoveToOther(s),isVisible:()=>Boolean(a),...t(n,e,{})}}case"CONTEXT_MOVE_INTO_OTHER":{const i=Boolean(s)&&s.accountId===Nt.wC&&s.path!==Nt.ym?bt.Z.getByFolder(s.accountId,s.path):null,a=i&&i.path!==Nt.cs&&i.path!==Nt.W4&&i.path.startsWith(Nt.W4);return{handler:()=>d.Z.toggleMoveToOther(s),isVisible:()=>Boolean(a),...t(n,e,{})}}case"CONTEXT_DELETE_ALL":return{handler:()=>{this.setState({clearFeedsConfirmation:!0})},isVisible:()=>Boolean(s)&&s.id===Nt.sM&&s.children&&this.#_e(s),...t(n,e,{})};case"CONTEXT_CREATE_LABEL":return{handler:()=>ue.Z.showAddCustomLabel(n),isVisible:()=>Boolean(s)&&s.accountId===Nt.ut,...t(n,e,{})};case"CONTEXT_FILTER_EDIT":return{handler:()=>ue.Z.showSettings(this.context.vivaldiWindowId,"mail",{scroll:"mail_filters_and_actions"}),isVisible:()=>Boolean(s)&&s.accountId===Nt.Kz,...t(n,e,{})};case"CONTEXT_ADD_NEW_ACCOUNT":return{handler:()=>ue.Z.showMailAccountDialog(n),isVisible:()=>Boolean(s)&&s.accountId===Nt.Sp,...t(n,e,{})};case"CONTEXT_REGENERATE":return{handler:d.Z.regenerateAllMailingLists,isVisible:()=>Boolean(s)&&s.accountId===Nt.wC&&s.path===Nt.ym,...t(n,e,{})};case"CONTEXT_ADVANCED":return{isVisible:()=>Boolean(s),...t(n,e,{})};default:return{...t(n,e,{})}}};#Ge=(e,t)=>{if(!t)return!1;switch(e.action){case"CONTEXT_RENAME":return this.#Ke(t.id);case"CONTEXT_DELETE":return 1===this.#ze([t.id]).length;case"CONTEXT_FILTER_EDIT":return t.id.startsWith(Nt.rQ);default:return!1}};#$e=e=>{if(1!==e.length)return Promise.resolve(!1);const t=this.refTreeList.current?.findTreeItem(e[0]);return t?t.accountId===Nt.ut?new Promise((e=>{ue.Z.showDeleteCustomLabelConfirmation(this.context.vivaldiWindowId,t.name,e)})):t.accountId===Nt.Kz?new Promise((e=>{ue.Z.showDeleteFilterConfirmation(this.context.vivaldiWindowId,t.name,e)})):t.accountId===Nt.u4?new Promise((e=>{ue.Z.showDeleteFeedConfirmation(this.context.vivaldiWindowId,t.name,e)})):Promise.resolve(!0):Promise.resolve(!1)};#ze=e=>{if(e.length>1)return[];const t=[];return e.forEach((e=>{const s=this.refTreeList.current?.findTreeItem(e);if(s){let n=!1;switch(s.accountId){case Nt.Kz:case Nt.ut:n=void 0!==s.path&&Boolean(bt.Z.getByFolder(s.accountId,s.path));break;case Nt.wC:n=s.path!==Nt.ym&&(!s.children||0===s.children.length);break;case Nt.u4:n=Nt.pG.test(s.path)}n&&t.push(e)}})),t};#Ye=e=>Promise.all(this.#ze(e).map((e=>{const t=this.refTreeList.current?.findTreeItem(e);if(t)switch(t.accountId){case Nt.ut:!async function(e,t){const s=bt.Z.getByFolder(e,t);if(!s)throw new Error(`Filter not found for ${e} and ${t}`);if(!s.filterValue.include)throw new Error(`Filter for flag does not have any include rules: ${s.path}`);const n=s.filterValue.include.find((e=>e.some((e=>e.hasOwnProperty("flag")))));if(!n)throw new Error(`Filter for flag does not have flag include rule: ${s.path}`);const i=n.find((e=>e.hasOwnProperty("flag")));if(void 0===i?.flag)throw new Error(`flag not found in include rule for label ${s.path}`);const a=i.flag,o=bt.Z.getIndex(),r=[];for(const e of o)e.flags.includes(a)&&r.push(e.id);const l=[];await rs.Z.transaction("rw",[rs.Z.buffer,rs.Z.filters,rs.Z.filteringQueue,rs.Z.viewIds,rs.Z.imap,rs.Z.searchList],(async()=>{await as.Z.remove([s.id]),await rs.Z.searchList.where("id").anyOf(r).modify((e=>{const t=e.flags.indexOf(a);t>-1&&(e.flags.splice(t,1),l.push({id:e.id,updates:{flags:e.flags}}))})),await Wy.Z.addImapFlags(r,{[a]:!1})})),await At.Z.updateFilters([s.id]),d.Z.updateIndex({sleUpdates:l}),ms.Z.filter(),es.Z.flushBuffer()}(t.accountId,t.path);break;case Nt.Kz:case Nt.wC:{const e=bt.Z.getByFolder(t.accountId,t.path);if(e)return t.accountId===Nt.wC?d.Z.removeMailingListFilter(this.context.vivaldiWindowId,e):d.Z.removeFilter(e.id);console.warn("No filter",t.accountId,t.path);break}case Nt.u4:const e=t.path.match(Nt.pG);if(e)return Is(e[0]);break;default:console.warn("Unknown account",t.accountId)}else console.warn("No match",e);return Promise.resolve()}))).then((()=>Promise.resolve()));#Xe=e=>{e.nativeEvent.buttons>0&&this.refTreeList.current?.unSelectAll(),this.refTreeList.current?.onContextMenu(e)};#Qe=e=>{const{id:t}=e,s=(0,Si.mM)(),n=Ti();return void 0===t?n:ex.includes(t)?30+s:n};#qe={name:"mailpanellist",getCapability:this.#Ve,getVisibility:this.#Ge};#Je=(e,t)=>{const{accountId:s,path:n}=e,i=s===Nt.u4?!t.dataTransfer.types.some((e=>e===Qy)):t.dataTransfer.types.some((e=>e===Qy)),a=St.Z.getFolderType(s,n);return{available:i,onto:(s===Nt.u4&&!Nt.pG.test(n)||s===Nt.MN&&n!==Nt.ym||s===Nt.ut&&n!==Nt.ym||s===Nt.Ry&&n!==Nt.ym||s===Nt.of&&n===Nt.tB||s===Nt.of&&n===Nt.rp||s===Nt.of&&n===Nt.$T||s===Nt.of&&n===Nt.cm||a===Nt.uT||a===Nt.Hd||a===Nt.hn||a===Nt.Oi||a===Nt.e9)&&i,edge:"none"}};#et=async(e,t,s,n)=>{const i=await as.Z.move(e,t,s,n);At.Z.updateFilters(i)};#tt=(e,t,s)=>{const n=St.Z.getFolderType(t.accountId,t.path),i=Ct.Z.getSelectedFolder();switch(!0){case t.accountId===Nt.MN:Pp.Z.setStandardFlag(this.winId,t.path);break;case t.accountId===Nt.ut:i&&i.accountId===Nt.ut?Pp.Z.setLabels(this.winId,{[i.path]:!1,[t.path]:!0}):Pp.Z.setLabel(this.winId,t.path);break;case t.accountId===Nt.of&&t.path===Nt.tB:Pp.Z.markUnread(this.winId);break;case t.accountId===Nt.of&&t.path===Nt.rp||n===Nt.Hd:Pp.Z.markAsJunk(this.winId);break;case t.accountId===Nt.of&&t.path===Nt.$T||n===Nt.hn:Pp.Z.moveToArchive(this.winId);break;case t.accountId===Nt.of&&t.path===Nt.cm||n===Nt.uT:{const t=JSON.parse(e.dataTransfer.getData(Qy)).map((e=>bt.Z.getListEntry(e)));Pp.Z.prepareDelete(this.winId,!1,t,!0);break}case t.accountId===Nt.Ry||n===Nt.Oi||n===Nt.e9:{const s=JSON.parse(e.dataTransfer.getData(Qy)).map((e=>bt.Z.getListEntry(e))),[n,i]=t.accountId===Nt.Ry?Wt.ZP.fromCustomFolderPath(t.path):[t.accountId,t.path];this.#st(s,n,i);break}case t.accountId===Nt.Sp:t.path===Nt.tB&&Pp.Z.markUnread(this.winId);break;case t.accountId===Nt.wC:break;case t.accountId===Nt.u4:const s=e.dataTransfer.getData("vivaldi/x-title").split("FEEDS_LABELS_")[1];if(Nt.pG.test(s)){const{ancestorPath:e,feedPath:n}=Wt.ZP.parseFeedFolderPath(s),i=t.path.split("/").filter((e=>e!==Nt.ym)).join("/");this.#et(Nt.u4,e,i,n)}break;case t.accountId===Nt.Kz:break;default:if(t.path===Nt.ym)break}return e.preventDefault(),e.stopPropagation(),Promise.resolve([])};#st=(e,t,s)=>{const n=new Set,i=Ct.Z.getSelectedFolder();if(i){const e=i?.type;e&&n.add(e);const t=At.Z.getByFolderId([i.accountId,i.path]);if(t){const{showDeleted:e,showJunk:s,showCustomFolder:i,showArchived:a}=Wt.ZP.getFilterOptions(t);switch(i&&n.add(Nt.Oi),a&&n.add(Nt.hn),e&&n.add(Nt.uT),s&&n.add(Nt.Hd),t.accountId){case Nt.of:t.path!==Nt.tB&&t.path!==Nt.ik&&t.path!==Nt.ym||n.add(Nt.e9);break;case Nt.wC:case Nt.Kz:case Nt.MN:case Nt.ut:case Nt.Sp:n.add(Nt.e9)}}}const a=e.flatMap((e=>e.sourceFilterIds)).reduce(((e,t)=>{const s=At.Z.get(t);return s?e.push(s):ls.Z.error("Mail",["move"],`Can not find any filter for id: ${t} when moving messages`),e}),[]),o=new Map,r=i&&It.Z.get(i.accountId),l=a.filter((e=>{const t=St.Z.getFolderType(e.accountId,e.path);if(r){if(i?.accountId!==e.accountId)return!1;if(![Nt.Hd,Nt.uT].includes(t)&&i?.path!==e.path)return!1}return n.has(t)})).map((e=>(o.set(e.id,{accountId:e.accountId,path:e.path}),{accountId:e.accountId,path:e.path})));if(0===l.length)ls.Z.error("Mail",["move"],`Can not find any source filter to move from when moving ${e.length} message(s)`);else{const n=new Set;let i=0,a=0;e.forEach((e=>{let s=0,r=!1;e.sources.forEach(((e,i)=>{if(o.has(i)){const a=o.get(i)?.accountId;e.internal||++s,a&&a!==t&&(n.add(a),r=!0)}})),s>1&&++a,r&&++i}));const r=()=>(0,Dy.Z)(this.context.vivaldiWindowId,e,l,t,s);i&&a?this.#nt((e=>{e&&r()}),(0,W.Z)("Move message from different account and in multiple folders?","Move messages from different account and in multiple folders?",[i]),(0,W.Z)("Are you sure you want to move $1 message from $2 to $3? (Note: Messages in multiple folders will move to to a single folder)","Are you sure you want to move $1 messages from $2 to $3? (Note: Messages in multiple folders will move to to a single folder)",[i,[...n].join(", "),t])):i?this.#nt((e=>{e&&r()}),(0,W.Z)("Move message to different account?","Move messages to different account?",[i]),(0,W.Z)("Are you sure you want to move $1 message from $2 to $3?","Are you sure you want to move $1 messages from $2 to $3?",[i,[...n].join(", "),t])):a?this.#nt((e=>{e&&r()}),(0,W.Z)("Move message in multiple folders?","Move messages in multiple folders?",[a]),(0,W.Z)("Are you sure you want to move $1 message in multiple folders to a single folder?","Are you sure you want to move $1 messages in multiple folders to a single folder?",[a])):r()}};#it=(e,t)=>t;#at=()=>{const e=this.#fe()?"FEEDS_PANEL":"MAIL_PANEL";return(0,zn.jsx)(Mi,{ref:this.refTreeList,rowComponent:this.#Ne,getDropSupport:this.#Je,onDrop:this.#tt,nodes:this.state.mailFolders,menu:this.#qe,onItemsActivated:this.#Te,isFolder:this.#Pe,hasChildren:this.#_e,settings:e,multiSelect:!1,supportsInlineEdit:!0,supportsCollapseAll:!1,isValidToEdit:this.#Ke,validateForDeletion:this.#ze,confirmDelete:this.#$e,activateAfterDelete:this.#Ee,delete:this.#Ye,saveTitle:this.#ot,getTitle:this.#rt,rowHeight:e=>this.#Qe(e),folderMode:"expand",getDragData:this.#it,validateForDrag:e=>e})};#lt=(e,t)=>{const s=t.match(Nt.pG);return s?e.findIndex((e=>e.feedId===s[0])):-1};#rt=e=>{let t="",s="";if(e.startsWith(Nt.jT))t=Nt.wC,s=Nt.jT;else if(e.startsWith(Nt.rQ))t=Nt.Kz,s=Nt.rQ;else if(e.startsWith(Nt.q0))t=Nt.MN,s=Nt.q0;else{const t=A.Z.get(Z.kRssSettings);if(e){const s=this.#lt(t,e);if(s>-1)return t[s].title||"";{const t=this.refTreeList.current?.findTreeItem(e);if(t)return t.name}}}const n=e.replace(s+"_",""),i=bt.Z.getByFolder(t,n);return i?i.name:""};#Ke=e=>!(!e.startsWith(Nt.sM)||e===Nt.sM||e.endsWith(Nt.cm))||(e.startsWith(Nt.jT)&&e.split("/").length>1||e.startsWith(Nt.rQ)||e.startsWith(Nt.q0));#dt=e=>e.substring(Nt.sM.length+1);#ot=async(e,t)=>{if(e.startsWith(Nt.sM)){if(!Nt.pG.test(e)){const s=this.#dt(e),n=s.split("/"),i=n.length-1,a=bt.Z.getByAccountId(Nt.u4),o=[];for(const e of a)if(e.path===s){n[i]=t;const s=await as.Z.put({...e,path:n.join("/"),name:t});o.push(...s)}else if(e.path.startsWith(s)){const s=e.path.split("/");s[i]=t;const n=await as.Z.put({...e,path:s.join("/")});o.push(...n)}return void(o.length>0&&At.Z.updateFilters(o))}{const s=A.Z.get(Z.kRssSettings),n=this.#lt(s,e);if(-1===n)return void ls.Z.debug("Expected to find feed account matching id",e);const i=s[n];if(i.title!==t){As({...i,title:t},n);const s=bt.Z.getByFolder(Nt.u4,this.#dt(e));if(s){const e=await as.Z.put({...s,name:t});At.Z.updateFilters(e)}return}}}let s,n="";if(e.startsWith(Nt.jT))n=Nt.wC,s=Nt.jT;else if(e.startsWith(Nt.rQ))n=Nt.Kz,s=Nt.rQ;else{if(!e.startsWith(Nt.q0))return;n=Nt.MN,s=Nt.q0}const i=e.replace(s+"_",""),a=bt.Z.getByFolder(n,i);a&&t&&as.Z.put({...a,name:t}).then((e=>{At.Z.updateFilters(e)}))};#ct=()=>{const e=[];return Oy.Z.m3GetAll().then((t=>{const s={};t.forEach((e=>{if(e.from){const t=e.from[0].address;s[t]||(s[t]=[]),s[t].push(e)}}));for(const t in s){const n=s[t].length;n>0&&e.push({handler:this.#Le.bind(null,t),...(0,fi.Z)("Send from $1 ($2)",[t,n])})}return e}))};#ht=()=>{const e=[],t=Object.keys(this.state.mailAccounts);for(const s of t)e.push({handler:this.#He.bind(null,s),...(0,fi.Z)("Check $1",[s])});return e};#He=e=>{(0,_t.mq)(e)?ts.Z.checkForMail(e):(0,_t.Vd)(e)&&is.Z.checkForMail(e)};#ut=async()=>{this.setState({isCheckingMail:!0}),await cp(),this._isMounted&&this.setState({isCheckingMail:!1})};#pt=()=>{Ls.forceRefreshAllRSSAccounts()};#gt=()=>{ue.Z.showAddFeed(this.context.vivaldiWindowId,{feeds:[{url:"",title:"",refreshInterval:0,feedId:crypto.randomUUID(),offline:!1}]})};#nt=(e,t,s)=>{ue.Z.showMessageMoveConfirmation(this.context.vivaldiWindowId,e,t,s)};#Se=()=>{this.setState({showErrors:A.Z.get(Z.kMailPanelShowErrorMessages)})};#Ae=(e,t)=>{let s=!1;if(e.length!==t.length)s=!0;else for(let n=0;n<e.length;n++){const i=t[n].MAIL_EMAIL!==e[n].MAIL_EMAIL,a=t[n].displayName!==e[n].displayName;if(i||a){s=!0;break}}s&&this.#Ie()};#Ie=()=>{const e=this.#fe()?sx():tx();this.setState({mailFolders:e})};#mt=async()=>{this.setState({isRestoringFeeds:!0}),await By(),this._isMounted&&this.setState({isRestoringFeeds:!1})};#ft=e=>{e&&async function(){const e=At.Z.getByAccountId(Nt.u4);try{for(const t of e)await d.Z.removeAccountPath(Nt.u4,t.path);I.Z.set(Z.kRssSettings,[])}catch(e){console.error(e)}}()};#vt=()=>{ue.Z.showDeleteFeedConfirmation(this.context.vivaldiWindowId,"",this.#ft),this.setState({clearFeedsConfirmation:!1})};render(){if(!this.props.open)return null;const e=At.Z.getByAccountId(Nt.u4).filter((e=>Nt.pG.test(e.path))),t=A.Z.get(Z.kRssSettings),s=t.length>0;if(this.state.clearFeedsConfirmation&&this.#vt(),this.#fe()){const n=bt.Z.isInitialized()&&(this.state.isRestoringFeeds||t.length>e.length);return(0,zn.jsxs)("div",{className:"panel",id:"mail_panel",children:[!n&&(0,zn.jsxs)("header",{children:[(0,zn.jsx)(Cu,{title:this.state.online?this.props.title:(0,W.Z)("$1 – Offline",[this.props.title]),showCloseButton:this.props.showCloseButton}),(0,zn.jsxs)("div",{className:"toolbar toolbar-default",role:"toolbar","aria-label":(0,W.Z)("toolbar-label","Feeds"),children:[(0,zn.jsxs)("div",{className:"toolbar toolbar-group",children:[(0,zn.jsx)(oa.ZP,{tooltip:(0,W.Z)("Check all feeds"),image:Kn.GO5.small,disabled:!s,onClick:this.#pt}),nx,(0,zn.jsx)(oa.ZP,{tooltip:(0,W.Z)("Add a feed"),onClick:this.#gt,image:Kn.md4.small})]}),s&&(0,zn.jsx)(oa.ZP,{onClick:()=>this.#We(),tooltip:(0,W.Z)("command","New Folder"),image:Kn._TQ.small})]})]}),s||n?this.state.hasCriticalError?(0,zn.jsx)("span",{className:"mail-loading",children:(0,zn.jsx)("span",{className:"critical-error-ocon",dangerouslySetInnerHTML:{__html:Kn.viW}})}):this.state.indexProgress<100?(0,zn.jsx)("span",{className:"mail-loading",children:0===this.state.indexProgress?ix:(0,zn.jsx)("progress",{max:"100",value:this.state.indexProgress})}):(0,zn.jsx)("section",{className:"outerScrollbar",onContextMenu:this.#Xe,children:this.#at()}):(0,zn.jsxs)("div",{className:"mail-onboarding",children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.Us1}}),(0,zn.jsx)("h1",{children:(0,W.Z)("Add your first feed")}),(0,zn.jsx)("p",{className:"faded-text",children:(0,W.Z)("Click the “+” button to add a new feed.")})]}),n&&(0,zn.jsxs)("header",{children:[(0,zn.jsx)(Cu,{title:(0,W.Z)("Database Error Detected"),showCloseButton:this.props.showCloseButton}),(0,zn.jsx)("div",{className:"toolbar toolbar-default",children:(0,zn.jsx)("label",{role:"alert",title:(0,W.Z)("Filters for feeds are missing from DB and need to be restored!"),children:(0,zn.jsx)("input",{type:"button",onClick:this.#mt,disabled:this.state.isRestoringFeeds,value:this.state.isRestoringFeeds?(0,W.Z)("Restoring Feeds ..."):(0,W.Z)("Restore Feeds")})})})]}),this.state.showErrors&&this.state.errorMessages.length>0&&(0,zn.jsx)("div",{children:this.state.errorMessages.filter((e=>"DATABASE"===e.category)).map((({accountId:e,category:t,message:s,level:n})=>(0,zn.jsx)(fa,{type:["CRITICAL","ERROR"].includes(n)?"error":"warning",children:(0,zn.jsx)("div",{children:s})},e)))})]})}{const e=Object.keys(this.state.mailAccounts).length,t=A.Z.get(Z.kMailPanelItemsShowFeeds);return this.state.waitingForAccountCache||0!==e||t&&s?(0,zn.jsxs)("div",{className:"panel",id:"mail_panel",children:[(0,zn.jsxs)("header",{children:[(0,zn.jsx)(Cu,{title:this.state.online?this.props.title:(0,W.Z)("$1 – Offline",[this.props.title]),showCloseButton:this.props.showCloseButton}),(0,zn.jsxs)("div",{className:"toolbar toolbar-default",role:"toolbar","aria-label":(0,W.Z)("toolbar label","Mail"),children:[(0,zn.jsxs)("div",{className:"toolbar toolbar-group",children:[(0,zn.jsx)(oa.ZP,{className:this.state.isCheckingMail?"btn-toolbar-spinner":"",disabled:this.state.isCheckingMail||this.state.hasCriticalError,tooltip:(0,W.Z)("Check all accounts"),label:(0,W.Z)("Fetch New Mail"),onClick:this.#ut,isMenuIndicatorVisible:e>1,image:Kn.GO5.small,menu:this.#ht,menuOrigin:"bottomLeft"}),ax,(0,zn.jsx)(oa.ZP,{tooltip:(0,W.Z)("Send from all accounts"),label:(0,W.Z)("Send Queued"),onClick:this.#je,disabled:100!==this.state.indexProgress,isMenuIndicatorVisible:e>1,image:Kn.zLp.small,menu:this.#ct,menuOrigin:"bottomLeft"})]}),(0,zn.jsx)(oa.ZP,{title:(0,W.Z)("Compose"),label:(0,W.Z)("Compose Mail"),tooltip:(0,W.Z)("Compose new mail"),onClick:ns.Z.createDraft.bind(null,void 0),image:Kn.XTV.small,className:"button-mail-compose",commandId:"COMMAND_MAIL_COMPOSE_NEW_MESSAGE"})]})]}),(0,zn.jsx)("section",{className:"outerScrollbar",onContextMenu:this.#Xe,children:this.state.hasCriticalError?(0,zn.jsx)("span",{className:"mail-loading",children:(0,zn.jsx)("span",{className:"critical-error-icon",dangerouslySetInnerHTML:{__html:Kn.viW}})}):this.state.indexProgress<100?(0,zn.jsx)("span",{className:"mail-loading",children:0===this.state.indexProgress?ox:(0,zn.jsx)("progress",{max:"100",value:this.state.indexProgress})}):this.#at()}),rx,0===A.Z.get(Z.kMailVpnNoticeDismissed)&&lx,this.state.showErrors&&this.state.errorMessages.length>0&&(0,zn.jsx)("div",{children:this.state.errorMessages.map((({accountId:e,category:t,message:s,level:n})=>(0,zn.jsxs)(fa,{type:["CRITICAL","ERROR"].includes(n)?"error":"warning",children:["DATABASE"!==t&&(0,zn.jsxs)("div",{children:[e," (",t,")"]}),(0,zn.jsx)("div",{children:s})]},e)))})]}):(0,zn.jsxs)("div",{className:"panel",id:"mail_panel",children:[(0,zn.jsx)("header",{children:(0,zn.jsx)(Cu,{title:(0,W.Z)("Mail"),showCloseButton:this.props.showCloseButton})}),(0,zn.jsx)("div",{className:"mail-onboarding-wrapper",children:(0,zn.jsxs)("div",{className:"mail-onboarding",children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.Rx8}}),(0,zn.jsx)("h1",{children:(0,W.Z)("Add your first mail account")}),(0,zn.jsx)("p",{className:"faded-text",children:(0,W.Z)("You can add any IMAP or POP account to Vivaldi Mail.")}),(0,zn.jsx)("input",{type:"button",onClick:this.#Oe,value:(0,W.Z)("Add Mail Account")})]})})]})}}}const cx=function(e,t){return qy.indexOf(e.path)-qy.indexOf(t.path)},hx=function(e,t){return Jy.indexOf(e.path)-Jy.indexOf(t.path)},ux=function(e,t,s,n,i,a,o){n.sort(Ut.JM).forEach((n=>{(0,My.Z)(n.path,s)?px(e,t,s+"/",n.children??[],i,a,o):n.children&&n.children.length>0&&ux(e,t,s,n.children,i,a,o)}))},px=function(e,t,s,n,i,a,o){const r=t.indexOf("/");if(-1===r)i[s+=t]||(n.push({name:o||t,path:s,accountId:e,id:a+"_"+s,children:[]}),i[s]=!0);else{const l=t.substr(r+1),d=t.substr(0,r);if(i[s+=d])ux(e,l,s,n,i,a,o);else{const t={accountId:e,path:s,children:[],id:a+"_"+s,name:At.Z.getByFolderId([e,s])?.name||d};px(e,l,s+"/",t.children??[],i,a,o),n.push(t),i[s]=!0}}},gx=(e,t)=>{const s=[],n={};for(let i=0;i<e.length;i++){const a=e[i],o=a.accountId===Nt.MN?(0,Uy.M)(a.path):a.accountId===Nt.ut?(0,Zy.X)(a.path):a.name;px(a.accountId,a.path,"",s,n,t,o)}return s},mx=()=>{const e=bt.Z.getByAccountId(Nt.of);return 0===e.length?[]:e.map((e=>({name:(0,Cp.W)(e.path),path:e.path,accountId:Nt.of,id:Nt.w1+"_"+e.path,children:[]}))).sort(Fy.m)},fx=e=>{const t=[],s=It.Z.getAccounts(),n=new Set,i=new Set;for(const a in s){const o=Xr.Z.getFoldersFlat(a,{folders:s[a].folders},e);for(const e of o)if(e.type===Nt.Oi){n.has(e.name)?i.add(e.name):n.add(e.name);const s=Wt.ZP.toFolderPath(a,e.path);t.push({...e,id:Nt.Ry+"_"+s,accountId:Nt.Ry,path:s})}}return t.forEach((e=>{if(i.has(e.name)){const t=e.path.substring(0,e.path.indexOf("/"));e.name=e.name+" ("+t+")"}})),t.sort(Ut.JM)},vx=()=>({showAccounts:A.Z.get(Z.kMailPanelItemsShowAccounts),showAllMessages:A.Z.get(Z.kMailPanelItemsShowAllMessages),showCustomFolders:A.Z.get(Z.kMailPanelItemsShowCustomFolders),showFeeds:A.Z.get(Z.kMailPanelItemsShowFeeds),showFilters:A.Z.get(Z.kMailPanelItemsShowFilters),showFlags:A.Z.get(Z.kMailPanelItemsShowFlags),showLabels:A.Z.get(Z.kMailPanelItemsShowLabels),showMailingLists:A.Z.get(Z.kMailPanelItemsShowMailingLists),showUnsubscribed:A.Z.get(Z.kMailShowUnsubscribed)}),bx=dx;const Cx=function(e){function t(e){return(0,zn.jsx)("option",{title:e.name,value:JSON.stringify(e),children:e.name},e.id)}const s=e.originalSelectedFolder?.accountId===Nt.u4,n=s?Nt.u4:Nt.of;let i=(0,W.Z)("Selected");return e.originalSelectedFolder&&(i=e.originalSelectedFolder.accountId===Nt.Kz?e.originalSelectedFolder.name:It.Z.getFolderName(e.originalSelectedFolder.accountId,e.originalSelectedFolder.path)),(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("span",{children:(0,W.Z)("Search in")}),(0,zn.jsx)("div",{className:"MailSearchOptionsSelectedFolder",children:(0,zn.jsxs)(Fa.Z,{value:e.selectedFolderString,onChange:function(t){const s=t.currentTarget.value;let n;try{n=JSON.parse(s)}catch(e){ls.Z.error("Mail",["search"],e)}n&&e.selectSearchFolder(n,s)},title:(0,W.Z)("Select which view to search in"),children:[(0,zn.jsx)("option",{value:JSON.stringify({name:n,accountId:n,path:Nt.ym,id:Nt.i4+"_"+n}),title:s?(0,W.Z)("All Feeds"):(0,W.Z)("All Messages"),children:s?(0,W.Z)("All Feeds"):(0,W.Z)("All Messages")}),e.originalSelectedFolder&&(0,zn.jsx)("optgroup",{label:(0,W.Z)("Current Folder"),children:(0,zn.jsx)("option",{title:i,value:JSON.stringify(e.originalSelectedFolder),children:i})}),(s?sx():tx()).flatMap((n=>n.path===Nt.ym&&(n.accountId===Nt.of||n.accountId===Nt.Sp||s&&Nt.u4)?(0,zn.jsx)("optgroup",{label:n.name,children:n.children?.map((e=>t(e)))},n.id):n.accountId!==Nt.Kz&&e.isFilterManager&&Wt.ZP.canSaveAsFilter(n.accountId,n.path)?t(n):void 0))]})})]})};var wx=s(22529);const yx=function(e){return(0,zn.jsx)(wx.Z,{onChange:t=>{const{value:s}=t.currentTarget;let n;n=e.isEndDate?V()(s).endOf("day").valueOf():V()(s).valueOf(),e.selectSentDate(n)},onKeyDown:t=>{"Escape"!==t.key||e.selectSentDate(void 0)},title:e.isEndDate?(0,W.Z)("End Date"):(0,W.Z)("Start Date"),value:e.sentDate?V()(e.sentDate).format("YYYY-MM-DD"):"",placeholder:e.isEndDate?(0,W.Z)("End Date"):(0,W.Z)("Start Date")})};var xx=s(73132);const Ix=[Z.kKeyboardTabToAll,Z.kMailSearchOnEnter,Z.kMailSearchFolder,Z.kMailViewLayout];class Ax extends Un.Component{static contextType=oi.Z;_isMounted=!1;refAllButton=Un.createRef();constructor(e){super(e);const t=Ct.Z.getOptions(),s=bt.Z.getByFolder(this.props.currentAccountId,this.props.currentPath);let n;t.queryFolder?n=JSON.stringify(t.queryFolder):s?.selectedAccountId&&s.selectedName?n=JSON.stringify({name:s.selectedName,accountId:s.accountId,path:s.selectedName,id:Wt.ZP.toFolderPath(s.accountId,s.path)}):"current"===this.props.prefValues[Z.kMailSearchFolder]&&(n=JSON.stringify(Ct.Z.getSelectedFolder())),this.state={recipientTypes:this.getRecipientTypes(t),forSender:t.forSender,forContact:t.forContact,attachments:t.attachments,sentDate:t.sentDate,sentDateEnd:t.sentDateEnd,selectedFolderString:n,mailAddresses:{queryAddition:[],from:[],to:[],cc:[]}}}componentDidMount(){Ct.Z.addListener(this.updateSearchOptions),this._isMounted=!0}componentWillUnmount(){this._isMounted=!1,Ct.Z.removeListener(this.updateSearchOptions)}selectAttachments=e=>{const t={...Ct.Z.getOptions()};"number"==typeof e?t.attachments=e:delete t.attachments,d.Z.addSearchToHistory(t)};selectsentDateEnd=e=>{this.selectSentDate(e,!0)};selectSentDate=(e,t=!1)=>{const s={...Ct.Z.getOptions()};"number"==typeof e?s[t?"sentDateEnd":"sentDate"]=e:delete s[t?"sentDateEnd":"sentDate"],d.Z.addSearchToHistory(s)};changeRecipientTypes=(e,t)=>{const{checked:s}=e.target;s?this.addRecipientTypes(t):this.removeRecipientTypes(t)};doSearch=e=>{d.Z.updateQueryResults(e)};addRecipientTypes=e=>{this.setState((t=>{let s=[];if(t.forContact&&!t.forSender?s=ml.Z.getAddressesById(t.forContact)||[]:t.forSender&&(s=[t.forSender]),s.length>0){const n=t.recipientTypes||new Set;n.add(e);const i=Wt.ZP.getContactQuery(s,n),a={...Ct.Z.getOptions(),contactQuery:i};return Ct.Z.setOptions(a),this.doSearch(a),{recipientTypes:n}}}))};removeRecipientTypes=e=>{this.setState((t=>{const{recipientTypes:s,forSender:n,forContact:i}=t;let a=[];if(i&&!n?a=ml.Z.getAddressesById(i)??[]:n&&(a=[n]),s&&a.length>0){s.delete(e);const t=Wt.ZP.getContactQuery(a,s),n={...Ct.Z.getOptions(),contactQuery:t};return Ct.Z.setOptions(n),this.doSearch(n),{recipientTypes:s}}}))};updateSearchOptions=e=>{const t=Ct.Z.getOptions();if(this._isMounted&&"setOptions"===e){const e=t.queryFolder?JSON.stringify(t.queryFolder):void 0;this.setState({selectedFolderString:e,sentDate:t.sentDate,sentDateEnd:t.sentDateEnd,attachments:t.attachments})}else"selectFolder"===e&&this.setState({forSender:t.forSender,forContact:t.forContact,recipientTypes:this.getRecipientTypes(t),...Wt.ZP.isMailSearching(t)?{}:{mailAddresses:{queryAddition:[],from:[],to:[],cc:[]}}})};getRecipientTypes(e){let t="";if(e.forSender)t=e.forSender;else if(e.forContact){const s=ml.Z.getAddressesById(e.forContact||"");s&&s.length>0&&(t=s[0])}const s=new Set,n=e.contactQuery||"";return t?(n&&(n.includes(Wt.ZP.getEqualsAddressQuery(t,"from"))&&s.add("from"),n.includes(Wt.ZP.getEqualsAddressQuery(t,"to"))&&s.add("to"),n.includes(Wt.ZP.getEqualsAddressQuery(t,"cc"))&&s.add("cc")),s):s}editFilter=()=>{ue.Z.showSettings(this.context.vivaldiWindowId,"mail",{scroll:"mail_filters_and_actions"})};updateMailFilterSelector=(e,t)=>{e.mailAddresses?e.rule="":e.mailAddresses=this.state.mailAddresses[t],this.setState((s=>{if(e.mailAddresses)return s.mailAddresses[t]=e.mailAddresses,{mailAddresses:{...s.mailAddresses}}}),(()=>{const s=Wt.ZP.getAddedQuery(e)||"";if(s!==(Ct.Z.getOptions()[t]||"")){let e={queryAddition:s};switch(t){case"from":e={from:s};break;case"to":e={to:s};break;case"cc":e={cc:s}}d.Z.addSearchToHistory({...Ct.Z.getOptions(),...e})}}))};selectSearchFolder=e=>{const t={...Ct.Z.getOptions(),queryFolder:e,queryOptions:e.accountId===Nt.of&&e.path===Nt.ym?Wt.ZP.getFilterOptions(Wt.ZP.getDefaultFilterForPath(Nt.of,Nt.ym)):Wt.ZP.getFilterOptions(At.Z.getByFolderId([e.accountId,e.path]))};d.Z.addSearchToHistory(t)};renderMailFilterSelectors=()=>{const e=e=>(this.props.showMore?["from","to","cc"]:["from"]).map((t=>(0,zn.jsx)(gy,{className:e,type:t,saveFilter:()=>{},isEmpty:!1,onSubmit:(e,s)=>this.updateMailFilterSelector(e,t),selectedMailAddresses:this.state.mailAddresses[t],isSettings:!1},t))),t=Ct.Z.getOptions().queryFolder,s=bt.Z.getByFolder(t?t.accountId:this.props.currentAccountId,t?t.path:this.props.currentPath);return s?(0,zn.jsxs)(zn.Fragment,{children:[e("MailSearchOptions--narrowOnly"),(0,zn.jsx)("div",{className:Gn()("MailSearchOptions-FromToCc MailSearchOptions--wideOnly",!this.props.showMore&&"MailSearchOptions-FromToCc--showLess"),children:e()}),this.props.showMore&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)(gy,{saveFilter:()=>{},isEmpty:!1,onSubmit:(e,t)=>this.updateMailFilterSelector(e,"queryAddition"),selectedMailAddresses:this.state.mailAddresses.queryAddition,isSettings:!1}),this.renderShowMoreAndMenuButtons(s,!0,"MailSearchOptions--wideOnly")]})]}):null};renderShowMoreAndMenuButtons=(e,t,s)=>(0,zn.jsxs)("div",{className:Gn()("MailSearchOptions-SaveButtonContainer",s),children:[!this.props.showMore&&(0,zn.jsx)(oa.ZP,{className:"MailSearchOptions-Menu MailSearchOptions--wideOnly",image:Kn.VZO,menu:this.getMenu,menuOrigin:"bottomLeft",tooltip:(0,W.Z)("Open menu")}),t&&(0,zn.jsxs)("a",{className:"MailSearchOption-ShowMore",tabIndex:this.props.prefValues[Z.kKeyboardTabToAll],onClick:()=>this.props.setShowMore(!this.props.showMore),children:[(0,zn.jsx)("span",{children:this.props.showMore?(0,W.Z)("Show less"):(0,W.Z)("Show more")}),(0,zn.jsx)(aa,{type:"chevron",size:10,className:this.props.showMore?"ascending":"descending"})]})]});renderSingleThread=()=>(0,zn.jsxs)("div",{className:"toolbar toolbar-default mail-search MailSearchOptions",children:[(0,zn.jsx)("h2",{className:"MailSearchOptions-Title",children:(0,W.Z)("Displaying a single thread")}),this.renderShowMoreAndMenuButtons()]});renderContactOrSender=()=>{const e=ml.Z.getAddressesById(this.state.forContact||""),t=this.state.forContact,s=t?ml.Z.getNodeById(t):void 0;return(0,zn.jsxs)("div",{className:Gn()("toolbar toolbar-default mail-search MailSearchOptions",this.state.forContact&&"MailSearchOptions--contact"),children:[t&&1!==e?.length?(0,zn.jsxs)("div",{className:"MailSearchOptions-TitleWrapper",children:[(0,zn.jsx)("h2",{className:"MailSearchOptions-Title",children:(0,W.Z)("Displaying mails for")}),(0,zn.jsxs)("div",{className:"MailSearchOptions-ContactWrapper",children:[(0,zn.jsx)("img",{className:"MailSearchOptions-Image",src:s?.avatarUrl?s.avatarUrl:xx.g,alt:""}),(0,zn.jsxs)(Fa.Z,{value:this.state.forSender||"all",className:"MailSearchOptions-Dropdown",onChange:e=>{const s=e.currentTarget.value;Pp.Z.enableContactView(this.context.vivaldiWindowId,t,"all"!==s?s:void 0)},children:[(0,zn.jsx)("option",{value:"all",children:s?.name?(0,W.Z)("$1 (All)",[s?.name||""]):(0,W.Z)("$1 addresses",[e?.length??""])},"all"),e?.map((e=>(0,zn.jsx)("option",{value:e,children:e},e)))]})]})]}):(0,zn.jsxs)("h2",{className:"MailSearchOptions-Title",children:[(0,W.Z)("Displaying mails for"),(0,zn.jsxs)("span",{className:"MailSearchOptions-ContactWrapper",children:[t&&(0,zn.jsx)("img",{className:"MailSearchOptions-Image",src:s?.avatarUrl?s.avatarUrl:xx.g,alt:""}),(0,zn.jsx)("span",{className:"MailSearchOptions-Contact",children:e&&1===e.length?e[0]:this.state.forSender})]})]}),(0,zn.jsxs)("div",{className:"MailSearchOptions-RecipientTypes",children:[(0,zn.jsxs)("label",{className:"MailSearchOptions-RecipientType",children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.state.recipientTypes.has("from"),onChange:e=>this.changeRecipientTypes(e,"from")}),(0,W.Z)("mail","from")]}),(0,zn.jsxs)("label",{className:"MailSearchOptions-RecipientType",children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.state.recipientTypes.has("to"),onChange:e=>this.changeRecipientTypes(e,"to")}),(0,W.Z)("to")]}),(0,zn.jsxs)("label",{className:"MailSearchOptions-RecipientType",children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.state.recipientTypes.has("cc"),onChange:e=>this.changeRecipientTypes(e,"cc")}),(0,W.Z)("cc")]})]}),this.renderShowMoreAndMenuButtons()]})};renderFilterFolder=()=>{const e=bt.Z.getByFolder(this.props.currentAccountId,this.props.currentPath);if(!e)return null;const{selectedAccountId:t,selectedName:s}=e;let n=(0,W.Z)("Selected");return t&&s&&(n=t===s?(0,W.Z)(t):(0,W.Z)(t)+"/"+(0,W.Z)(s)),(0,zn.jsxs)("div",{className:"toolbar toolbar-default mail-search MailSearchOptions",children:[(0,zn.jsx)("span",{children:(0,W.Z)("Searching in: $1",[n])}),(0,zn.jsx)(oa.ZP,{onClick:this.editFilter,title:(0,W.Z)("mail_filter","Edit Filter"),tooltip:(0,W.Z)("mail_filter","Edit Filter"),className:Gn()("MailSearchOptions-Save")})]})};getMenu=e=>{const t=Ct.Z.getOptions(),s=Wt.ZP.isValidSearch(t),n=this.props.currentAccountId===Nt.tQ,i=!this.state.forSender&&!this.state.forContact&&!n,a=[{type:"command",handler:()=>this.props.saveSearch(),isEnabled:()=>s,label:(0,W.Z)("Save as Filter"),labelEnglish:"Save as Filter"},{type:"command",handler:()=>d.Z.clearSearch(),label:i?(0,W.Z)("Clear Search"):(0,W.Z)("Navigation","Back"),labelEnglish:i?"Clear Search":"Back"}];return i&&(a.push(st.Z.separatorItem),a.push({...(0,fi.Z)("Default Search Folder"),items:[{type:"radio",radiogroup:1,...(0,fi.Z)("All Messages"),checked:"all"===this.props.prefValues[Z.kMailSearchFolder],handler:e=>I.Z.set(Z.kMailSearchFolder,"all")},{type:"radio",radiogroup:1,...(0,fi.Z)("Current Folder"),checked:"current"===this.props.prefValues[Z.kMailSearchFolder],handler:e=>I.Z.set(Z.kMailSearchFolder,"current")}]}),a.push({type:"checkbox",checked:this.props.prefValues[Z.kMailSearchOnEnter],handler:()=>I.Z.set(Z.kMailSearchOnEnter,!this.props.prefValues[Z.kMailSearchOnEnter]),label:(0,W.Z)("Start Search Using Enter Key"),labelEnglish:"Start Search Using Enter Key"})),a};render(){const e=Ct.Z.getOptions(),t=e.queryFolder;if(!t&&this.props.currentAccountId===Nt.tQ)return this.renderSingleThread();if(this.state.forContact||this.state.forSender)return this.renderContactOrSender();this.props.currentAccountId!==Nt.Kz||Wt.ZP.isValidSearch(e)||this.renderFilterFolder();const s=bt.Z.getByFolder(t?t.accountId:this.props.currentAccountId,t?t.path:this.props.currentPath);return s?(0,zn.jsxs)("div",{className:"toolbar toolbar-default mail-search MailSearchOptions",children:[(0,zn.jsxs)("div",{className:"MailSearchOptions--search",children:[(0,zn.jsx)(Cx,{filter:s,selectedFolderString:this.state.selectedFolderString,selectSearchFolder:this.selectSearchFolder,originalSelectedFolder:Ct.Z.getSelectedFolder()}),(0,zn.jsx)(oa.ZP,{className:"MailSearchOptions-Menu MailSearchOptions--narrowOnly",image:Kn.VZO,menu:this.getMenu,menuOrigin:"bottomLeft",tooltip:(0,W.Z)("Open menu")}),(0,zn.jsx)("span",{className:"MailSearchOptions--narrowOnly",children:(0,W.Z)("Date Range")}),(0,zn.jsxs)("div",{className:"MailSearchOptions-DropdownContainer",children:[(0,zn.jsx)("span",{className:"MailSearchOptions--wideOnly",children:(0,W.Z)("Date Range")}),(0,zn.jsx)(yx,{className:"MailSearchOptions-Dropdown",title:(0,W.Z)("Start Date"),selectSentDate:this.selectSentDate,sentDate:this.state.sentDate}),(0,zn.jsx)(yx,{className:"MailSearchOptions-Dropdown",title:(0,W.Z)("End Date"),isEndDate:!0,selectSentDate:this.selectsentDateEnd,sentDate:this.state.sentDateEnd})]}),this.props.showMore&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)(my,{className:"MailSearchOptions-Attachments MailSearchOptions-Attachments--showMore MailSearchOptions--wideOnly",selectAttachments:this.selectAttachments,attachments:this.state.attachments}),(0,zn.jsx)(oa.ZP,{className:"MailSearchOptions-Menu MailSearchOptions--wideOnly",image:Kn.VZO,menu:this.getMenu,menuOrigin:"bottomLeft",tooltip:(0,W.Z)("Open menu")})]}),this.renderMailFilterSelectors()]}),!this.props.showMore&&(0,zn.jsx)(zn.Fragment,{children:(0,zn.jsx)(my,{className:"MailSearchOptions-Attachments MailSearchOptions--wideOnly",selectAttachments:this.selectAttachments,attachments:this.state.attachments})}),this.props.showMore&&(0,zn.jsx)(zn.Fragment,{children:(0,zn.jsx)(my,{className:"MailSearchOptions-Attachments MailSearchOptions--narrowOnly",selectAttachments:this.selectAttachments,attachments:this.state.attachments})}),this.renderShowMoreAndMenuButtons(s,!0,"MailSearchOptions--narrowOnly"),!this.props.showMore&&this.renderShowMoreAndMenuButtons(s,!0,"MailSearchOptions--wideOnly")]}):null}}const Sx=(0,zd.Z)(Ax,Ix),Zx=[Z.kKeyboardTabToAll,Z.kMailSearchSortField,Z.kMailSearchSortFieldPerFolder,Z.kMailSearchSortFieldSent,Z.kMailSearchSortOrder,Z.kMailViewLayout];var Tx=(0,zn.jsx)(Bw,{});class Ex extends Un.Component{nodeRef=Un.createRef();constructor(e){super(e),this.state={columns:xi()["vertical_wide"===this.props.prefValues[Z.kMailViewLayout]?"mail_vertical":"mail_horizontal"]||Ii(this.getMailSortFields(e.prefValues[Z.kMailViewLayout])),mailSearchOptionsShowMore:!1}}componentDidUpdate(e){const t=this.props.prefValues[Z.kMailViewLayout];t!==e.prefValues[Z.kMailViewLayout]&&this.setState({columns:xi()["vertical_wide"===t?"mail_vertical":"mail_horizontal"]||Ii(this.getMailSortFields(t))})}getMailSortFields=e=>{const t=this.props.selectedFolder&&[Nt.Nz,Nt.kY,Nt.fZ].includes(St.Z.getFolderType(this.props.selectedFolder.accountId,this.props.selectedFolder.path));return[{value:"unread",text:(0,W.Z)("Unread"),icon:Kn.XQw.small,fullScreenTitle:(0,W.Z)("Sort by Unread Status"),width:36,visible:"vertical"!==e},{value:"flag",text:(0,W.Z)("Flag"),icon:Kn.nyn.small,fullScreenTitle:(0,W.Z)("Sort by Flag"),width:36,visible:"vertical"!==e},{value:"sender",text:t?(0,W.Z)("Recipient"):(0,W.Z)("Sender"),icon:Kn.HXY,fullScreenTitle:t?(0,W.Z)("Sort by Message Recipient"):(0,W.Z)("Sort by Message Sender"),width:150,visible:"vertical"!==e},{value:"subject",text:(0,W.Z)("Subject"),fullScreenTitle:(0,W.Z)("Sort by Subject"),width:300,visible:"vertical"!==e,key:!0},{value:"label",text:(0,W.Z)("Labels"),icon:Kn.rpm.small,fullScreenTitle:(0,W.Z)("Sort by Label"),width:"vertical_wide"===e?36:140,visible:"vertical"!==e},{value:"attachment",text:(0,W.Z)("Attachment"),icon:Kn.onv,fullScreenTitle:(0,W.Z)("Sort by Attachments"),width:36,visible:"vertical"!==e},{value:"size",text:(0,W.Z)("Size"),icon:Kn.W9U,fullScreenTitle:(0,W.Z)("Sort by Size"),width:100,visible:"horizontal"===e},{value:"sentDate",text:(0,W.Z)("Date"),icon:Kn.V_c,fullScreenTitle:t?(0,W.Z)("Sort by Date Sent"):(0,W.Z)("Sort by Date Received"),width:150,visible:"vertical"!==e},{value:"threads",text:(0,W.Z)("Date (Threaded)"),icon:Kn.V_c,fullScreenTitle:(0,W.Z)("Sort by Date (Threaded)"),width:150,visible:!1}]};onSortChange=(e,t)=>{const s=this.props.prefValues[Z.kMailSearchSortOrder],n=(0,hp.U)(this.props.selectedFolder);("ascending"===s&&e!==ui.Z.ASCENDING_SORT||"descending"===s&&e!==ui.Z.DESCENDING_SORT)&&I.Z.set(Z.kMailSearchSortOrder,this.getMailSortOrder(e)),n!==t&&this.props.selectedFolder&&(0,hp.O)(this.props.selectedFolder,t)};saveSearch=()=>{const{queryFolder:e,queryAddition:t,queryOptions:s={},attachments:n,sentDate:i,sentDateEnd:a}=Ct.Z.getOptions(),{accountId:o,path:r}=e||(this.props.selectedFolder||{}),l=void 0!==o&&bt.Z.getByFolder(o,r)||{},c=Wt.ZP.joinQueries(Ct.Z.getQuery(),t),h={...l.filterValue,...s,attachments:n,sentDate:i,sentDateEnd:a,query:c},u={name:c||Wt.ZP.generateFilterName(),accountId:Nt.Kz,path:Math.random().toString(36).substring(2),filterValue:{...h},selectedAccountId:o,selectedName:l.name};d.Z.addFilter(u)};onUpdateRow=e=>{this.setState({columns:e})};onSaveRow=()=>{yi(this.state.columns,"vertical_wide"===this.props.prefValues[Z.kMailViewLayout]?"mail_vertical":"mail_horizontal")};getSortOrder(){return"ascending"===this.props.prefValues[Z.kMailSearchSortOrder]?ui.Z.ASCENDING_SORT:ui.Z.DESCENDING_SORT}getMailSortOrder(e){switch(e){case ui.Z.ASCENDING_SORT:return"ascending";case ui.Z.DESCENDING_SORT:return"descending";default:throw new Error("Non existent mail sort order "+e)}}setShowMore=e=>{this.setState({mailSearchOptionsShowMore:e})};render(){const e=this.getMailSortFields(this.props.prefValues[Z.kMailViewLayout]),t=this.props.selectedFolder,s=this.getSortOrder(),n=t?(0,hp.U)(t):"threads",i=Ct.Z.getOptions(),a="horizontal"===this.props.position?"top":"left";return(0,zn.jsxs)("div",{ref:this.nodeRef,id:"mail_search",style:this.props.style,children:[(this.props.showMailSearchOptions||i.forSender||this.props.selectedFolder?.accountId===Nt.tQ||i.forContact)&&(0,zn.jsx)(Sx,{saveSearch:this.saveSearch,currentPath:this.props.selectedFolder?.path||"",currentName:this.props.selectedFolder?.name||"",currentAccountId:this.props.selectedFolder?.accountId||"",showMore:this.state.mailSearchOptionsShowMore,setShowMore:this.setShowMore}),Tx,(0,zn.jsx)(Bu,{fields:e,columns:this.state.columns,onSortChange:this.onSortChange,sortField:n,sortOrder:s,manualSorting:!1,keyAccess:this.props.prefValues[Z.kKeyboardTabToAll],fullsize:"horizontal"===this.props.prefValues[Z.kMailViewLayout]||"vertical_wide"===this.props.prefValues[Z.kMailViewLayout],onUpdateRow:this.onUpdateRow,onSaveRow:this.onSaveRow},this.state.columns.flatMap((e=>e.id)).join()||"sortfield"),(0,zn.jsx)(uy,{position:this.props.position,onSelect:this.props.onSelect,columns:this.state.columns}),(0,zn.jsx)(Mu.Z,{onSlidebarPosition:this.props.onSlidebarPosition,position:a})]})}}const kx=(0,zd.Z)(Ex,Zx);var Nx=s(34155);const _x=[Z.kMailViewLayout,Z.kMailViewDimensions];function Px(e,t){const s=Ze.ZP.getPagesByUrl(e,vs.xy.mailpage).sort(((e,t)=>e.id-t.id));return s.size>1&&s.first().id!==t}class Mx extends Un.PureComponent{static contextType=oi.Z;mailSearchRef=Un.createRef();state={listEntry:void 0,hasNoListEntries:bt.Z.hasNoListEntries(),showMailSearchOptions:Wt.ZP.isValidSearch(Ct.Z.getOptions()),selectedFolder:Ct.Z.getSelectedFolder(),showSearchOptionsPersistent:!1,isDuplicateTab:Px(this.context.vivaldiWindowId,this.props.id)};onSlidebarPosition=(e,t)=>{const s=this.mailSearchRef.current?.nodeRef.current;if(!(s instanceof this.context.Element))return;var n=s.getBoundingClientRect(),i=t-n.top,a=e-n.left;const o={...this.props.prefValues[Z.kMailViewDimensions]};"horizontal"===this.props.prefValues[Z.kMailViewLayout]?(i>2e3?i=2e3:i<120&&(i=120),o.height=Math.floor(i)):(a>2e3?a=2e3:a<200&&(a=200),"vertical_wide"===this.props.prefValues[Z.kMailViewLayout]?o.widthWide=Math.floor(a):o.width=Math.floor(a)),I.Z.set(Z.kMailViewDimensions,o)};componentDidMount(){Ct.Z.addListener(this._folderChanged),bt.Z.addListener(this._onFiltersChanged),Ze.ZP.addListener(this._onPageStoreChange)}componentWillUnmount(){Ct.Z.removeListener(this._folderChanged),bt.Z.removeListener(this._onFiltersChanged),Ze.ZP.removeListener(this._onPageStoreChange)}_onPageStoreChange=()=>{if(this.state.isDuplicateTab){const e=Px(this.context.vivaldiWindowId,this.props.id);e||this.setState({isDuplicateTab:e})}};_onFiltersChanged=()=>{this.state.hasNoListEntries!==bt.Z.hasNoListEntries()&&this.setState({hasNoListEntries:bt.Z.hasNoListEntries()})};_folderChanged=e=>{if("toggleShowMailSearchOptions"===e)return void this.setState((e=>({showMailSearchOptions:!e.showMailSearchOptions,showSearchOptionsPersistent:!e.showSearchOptionsPersistent})));const t=Ct.Z.getOptions(),s=Ct.Z.getSelectedFolder();if("selectFolder"===e&&this.setState({showSearchOptionsPersistent:Wt.ZP.isMailSearching(t),selectedFolder:s}),this.setState((e=>({showMailSearchOptions:e.showSearchOptionsPersistent||!!t.query||Wt.ZP.isValidSearch(t)}))),!s)return;const n=(0,W.Z)(s.name),i=(0,W.Z)(s.accountId);let a="Labels"===i?(0,Zy.X)(n):n;n!==i&&(a+=" ("+i+")"),Nx.nextTick((()=>c.ZP.setTitle(this.props.id,this.context.vivaldiWindowId,a)))};handleSelection=(0,Te.Z)((e=>{this.setState({listEntry:e})}),200,{leading:!0,trailing:!0});render(){if(!fe.ZP.isMail(this.context.vivaldiWindowId))return(0,zn.jsx)("div",{className:"mail-single-window-error",children:(0,zn.jsxs)("div",{children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.Rx8}}),(0,zn.jsx)("h1",{children:(0,W.Z)("Mail is in Another Window")}),(0,zn.jsx)("p",{className:"faded-text",children:(0,W.Z)("The Vivaldi email client runs in a single window at a time.")}),(0,zn.jsx)("input",{type:"button",className:"primary",onClick:()=>{const e=fe.ZP.getMailWindowId();ue.Z.showMail(e),n.Z.windows.update(e,{focused:!0})},value:(0,W.Z)("Go to Mail")})]})},"mailview");if(this.state.isDuplicateTab)return(0,zn.jsx)("div",{className:"mail-onboarding-wrapper",children:(0,zn.jsxs)("div",{className:"mail-onboarding",children:[(0,zn.jsx)("h1",{children:(0,W.Z)("Mail is in Another Tab")}),(0,zn.jsx)("p",{children:(0,W.Z)("The Vivaldi email client runs in a single tab at a time.")})]})},"mailview");const e="vertical_wide"===this.props.prefValues[Z.kMailViewLayout],t="horizontal"===this.props.prefValues[Z.kMailViewLayout]?{height:this.props.prefValues[Z.kMailViewDimensions].height}:{width:this.props.prefValues[Z.kMailViewDimensions][e?"widthWide":"width"]};return(0,zn.jsxs)("div",{id:"mail_view",className:this.props.prefValues[Z.kMailViewLayout],children:[(0,zn.jsx)(kx,{ref:this.mailSearchRef,selectedFolder:this.state.selectedFolder,showMailSearchOptions:this.state.showMailSearchOptions,onSlidebarPosition:this.onSlidebarPosition,position:this.props.prefValues[Z.kMailViewLayout],style:t,hasNoListEntries:this.state.hasNoListEntries,onSelect:this.handleSelection}),(0,zn.jsx)(Dw.Z,{pageId:this.props.id,listEntry:this.state.listEntry,prefValues:this.props.prefValues,hasNoListEntries:this.state.hasNoListEntries,pageIsActive:this.props.isActive})]})}}const Dx=(0,zd.Z)(Mx,_x),Ox=[Z.kIncognitoShowIntro],jx=I.Z.getEventHandler,Lx="https://vvld.in/privacy-and-security";var Rx=(0,zn.jsxs)("svg",{className:"private-window-background",viewBox:"0 0 1244 860",children:[(0,zn.jsxs)("defs",{children:[(0,zn.jsxs)("linearGradient",{x1:"0.15",y1:"0.3",x2:"0.3",y2:"0.5",id:"private-intro-bg-gradient",children:[(0,zn.jsx)("stop",{offset:"0",stopColor:"var(--colorFg)",stopOpacity:"0.03"}),(0,zn.jsx)("stop",{offset:"1",stopColor:"var(--colorFg)",stopOpacity:"0.003"})]}),(0,zn.jsxs)("linearGradient",{x1:"1",y1:"0",x2:"0",y2:"1",id:"private-intro-accent-gradient",children:[(0,zn.jsx)("stop",{offset:"0",stopColor:"var(--colorAccentBg)",stopOpacity:"0"}),(0,zn.jsx)("stop",{offset:"0.5",stopColor:"var(--colorAccentBg)",stopOpacity:"1"}),(0,zn.jsx)("stop",{offset:"1",stopColor:"var(--colorAccentBg)",stopOpacity:"0"})]})]}),(0,zn.jsx)("path",{fill:"url(#private-intro-bg-gradient)",d:"M0 0h153.513c16.141 27.93 32.15 55.734 47.912 83.11 16.086 27.94 32.722 56.832 49.076 85.128 11.01 19.031 22.079 38.316 32.781 56.967 25.186 43.883 51.228 89.259 77.402 132.848 33.382 55.651 75.894 82.121 137.77 85.829 3.205.192 6.454.288 9.655.288 39.673 0 78.14-14.461 108.316-40.722 21.644-18.834 48.687-52.291 54.604-104.667.749-6.654 1.357-13.708 1.855-19.573-1.07-29.74-6.476-52.92-17.294-74.518C622.935 139.46 612.708 67.99 625.087 0h136.676C747.1 44.93 749.845 96.364 774.32 145.251c20.839 41.6 30.654 85.7 31.485 138.023-.568 6.192-1.472 18.273-2.83 30.356-17.572 155.524-149.172 263.318-294.866 263.318-5.816 0-11.67-.173-17.526-.521C382.84 569.97 301.9 518.174 246.822 426.358c-38.015-63.313-74.255-127.68-111.253-191.634C90.359 156.507 45.49 78.062 0 0zm1113.47 0H1244v140.1c-7.496 27.86-18.849 54.995-34.031 81.275a1299530.57 1299530.57 0 0 1-170.255 294.799A1223193.145 1223193.145 0 0 0 841.018 860.24H687.72c135.675-235.123 271.527-470.147 407.26-705.25 22.311-38.621 31.22-79.696 25.368-124.548A170.12 170.12 0 0 0 1113.471 0z"}),(0,zn.jsx)("path",{stroke:"url(#private-intro-accent-gradient)",strokeWidth:"2",d:"M854 839.979L1103.98 407"}),(0,zn.jsx)("path",{stroke:"url(#private-intro-accent-gradient)",d:"M951 649.979L1200.98 217"}),(0,zn.jsx)("path",{stroke:"url(#private-intro-accent-gradient)",d:"M969 628.452L1126.86 356"}),(0,zn.jsx)("path",{stroke:"url(#private-intro-accent-gradient)",d:"M802 686.452L959.86 414"}),(0,zn.jsx)("path",{stroke:"url(#private-intro-accent-gradient)",opacity:".5",d:"M735 790.452L892.86 518"})]});class Bx extends Un.Component{static contextType=oi.Z;state={searchEngines:pn.Z.get()};componentDidMount(){pn.Z.addListener(this.#bt)}componentWillUnmount(){pn.Z.removeListener(this.#bt)}#bt=()=>{this.setState({searchEngines:pn.Z.get()})};#Ct=e=>{e.preventDefault(),c.ZP.openURL(this.context.vivaldiWindowId,Lx,{inCurrent:!1,inBackground:!1})};#wt=()=>{c.ZP.openURL(this.context.vivaldiWindowId,"https://store.vivaldi.com/shop/privacy-ghost-unisex-t-shirt/?pk_campaign=private-window",{inCurrent:!1,inBackground:!1})};#yt=e=>{re.Z.searchEngines.setDefault("defaultPrivate",e.currentTarget.value)};#xt=e=>{const t=[{handler:this.#wt,...(0,fi.Z)("Get the T-Shirt")}];(0,mi.Z)(this.context,t)(e)};render(){const e=pn.Z.getDefault(!0);return(0,zn.jsxs)("div",{className:"private-intro",children:[Rx,(0,zn.jsxs)("div",{className:"private-intro-content",children:[(0,zn.jsx)("h1",{children:(0,W.Z)("title","Private Window")}),(0,zn.jsx)("span",{className:"private-intro-ghost",dangerouslySetInnerHTML:{__html:s(51491)},onContextMenu:this.#xt,onDoubleClick:this.#wt}),(0,zn.jsx)("p",{children:(0,W.Z)("Browsing in a Private Window means that searches, sites visited, cookies, and temporary files won’t be stored by Vivaldi. It does not encrypt or otherwise modify your connection.")}),(0,zn.jsx)("p",{children:(0,zn.jsx)("a",{tabIndex:0,href:Lx,onClick:this.#Ct,children:(0,W.Z)("Learn more about Privacy & Security")})}),(0,zn.jsx)("h2",{children:(0,W.Z)("Default Search")}),(0,zn.jsxs)("p",{className:"private-intro-blurb",children:[(0,zn.jsx)("span",{children:(0,W.Z)("While in a Private Window, Vivaldi will use $1 to answer your searches.",[e?.name??""])}),(0,zn.jsx)("span",{children:"DuckDuckGo"===e?.name&&" "+(0,W.Z)("DuckDuckGo is a search engine that does not track your search history, enabling you to search privately.")})]}),(0,zn.jsx)("h3",{children:(0,W.Z)("Search with")}),(0,zn.jsxs)("label",{className:"private-intro-select-searchengine",children:[e&&(0,zn.jsx)(Vn.ZP,{className:"private-intro-favicon",url:e.faviconUrl,loadType:"faviconFromCache"}),(0,zn.jsx)(Fa.Z,{value:e?.guid,onChange:this.#yt,children:this.state.searchEngines.map((e=>(0,zn.jsx)("option",{value:e.guid,children:e.name},e.guid)))})]}),(0,zn.jsxs)("label",{className:"private-intro-disable",children:[(0,zn.jsx)("input",{type:"checkbox",checked:!this.props.prefValues[Z.kIncognitoShowIntro],onChange:jx(Z.kIncognitoShowIntro,"inverse")}),(0,zn.jsx)("span",{children:(0,W.Z)("Do Not Show Introduction Again")})]})]})]})}}const Fx=(0,zd.Z)(Bx,Ox);function Wx(){return(0,zn.jsx)("webview",{src:`${u.oP}/saga/saga.html`})}const Ux={SpeedDial:"speeddial",Bookmarks:"bookmarks",History:"history",Calendar:"calendar",Mail:"mailpage",NotesManager:"notes",Dashboard:"dashboard"};var Vx=s(90718);const Hx=[Z.kVivaldiCrashReportingConsentGranted];const Gx=function(){const e=Un.useContext(oi.Z),t=(0,Eo.Z)(Hx),[s,n]=Un.useState(!1),i=Un.useRef(s),[a,o]=Un.useState(!0),[r,l]=Un.useState(!1);Un.useEffect((()=>{i.current=s,re.Z.extensionActionUtils.getToolbarExtensions().then((e=>{l(!!e.length)}))}),[s,l]);const d=Un.useCallback((async()=>{const t=Ze.ZP.getActivePage(e.vivaldiWindowId);t&&Ze.ZP.isLastPage(t)&&await c.ZP.openURL(e.vivaldiWindowId,"",{inCurrent:!1,singleton:!0}),t&&c.ZP.closePage(t)}),[e.vivaldiWindowId]),h=Un.useCallback(((t,s)=>{if(!i.current){n(!0);const i=()=>{re.Z.utilities.onSessionRecoveryDone.removeListener(a),clearTimeout(o)},a=()=>{d(),i()},o=setTimeout(a,1e4);re.Z.utilities.onSessionRecoveryDone.addListener(a),re.Z.utilities.acknowledgeCrashedSession(e.vivaldiWindowId,t,s)}}),[e.vivaldiWindowId,d]);Un.useEffect((()=>()=>{i.current?a||c.ZP.openURL(e.vivaldiWindowId,vs.xy.extensions,{inBackground:!0,singleton:!0}):re.Z.utilities.acknowledgeCrashedSession(e.vivaldiWindowId,!1,!0)}),[e.vivaldiWindowId,i,a]);const p=e=>{h(e,a)};return(0,zn.jsx)("div",{className:"guest-intro crash-recovery",children:(0,zn.jsxs)("div",{className:"guest-intro-content",children:[(0,zn.jsx)("h1",{children:(0,W.Z)("title","Whoa, that was unexpected")}),(0,zn.jsxs)("div",{className:"crash-recovery-info",children:[(0,zn.jsx)("p",{children:(0,W.Z)("Vivaldi could not start up as normal. We had to unload your tabs and extensions to get the browser running again.")}),(0,zn.jsx)("p",{children:(0,W.Z)("Select Recover Tabs to try again or Discard Tabs.")})]}),r&&(0,zn.jsxs)("div",{className:"crash-recovery-option",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:!a,onChange:()=>{o(!a)}}),(0,zn.jsx)("span",{children:(0,W.Z)("Keep Extensions Disabled")})]}),(0,zn.jsxs)("p",{className:"info",children:[(0,W.Z)("If your session keeps crashing, you can try disabling your extensions. You can re-enable them in")," ",(0,zn.jsx)(Vx.Z,{title:vs.xy.extensions,onClick:()=>{c.ZP.openURL(e.vivaldiWindowId,vs.xy.extensions,{inBackground:!0,singleton:!0})},children:vs.jk.getDisplayUrlFromMapping(vs.xy.extensions)})]})]}),(0,zn.jsxs)("div",{className:"crash-recovery-option",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kVivaldiCrashReportingConsentGranted],onChange:()=>{I.Z.set(Z.kVivaldiCrashReportingConsentGranted,!A.Z.get(Z.kVivaldiCrashReportingConsentGranted))}}),(0,zn.jsx)("span",{children:(0,W.Z)("Allow Vivaldi to Send Automatic Crash Reports")})]}),(0,zn.jsxs)("p",{className:"info",children:[(0,W.Z)("Crash reports can help us fix problems and avoid them in the future.")," ",(0,zn.jsx)(Vx.Z,{title:u.fg,onClick:()=>{c.ZP.openURL(e.vivaldiWindowId,u.fg)},children:(0,W.Z)("Privacy policy")})]})]}),(0,zn.jsxs)("div",{className:"crash-recovery-footer",children:[(0,zn.jsx)("input",{type:"button",className:"primary",value:(0,W.Z)("Recover Tabs"),onClick:()=>{p(!0)},autoFocus:!0}),(0,zn.jsx)("input",{type:"button",className:"danger",value:(0,W.Z)("Discard Tabs"),onClick:()=>{p(!1)}})]})]})})},Kx="HintTooltip",zx={show:100,hide:300};class $x extends Un.PureComponent{static contextType=oi.Z;#It=crypto.randomUUID();state={visible:!1};componentWillUnmount(){clearTimeout(this._timeout)}showHint=()=>{const{show:e}=this.props.delay||zx;clearTimeout(this._timeout),this._timeout=setTimeout((()=>this.setState({visible:!0})),e)};hideHint=()=>{const{hide:e}=this.props.delay||zx;clearTimeout(this._timeout),this._timeout=setTimeout((()=>this.setState({visible:!1})),e)};toggleHint=()=>{const{show:e,hide:t}=this.props.delay||zx,s=this.state.visible;clearTimeout(this._timeout),this._timeout=setTimeout((()=>this.setState({visible:s})),s?t:e)};render(){const{label:e,className:t,position:s}=this.props,n=`--${this.#It}-anchor`;return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("div",{style:{anchorName:n},className:Gn()(t,Kx,[`HintTooltip--${s||"top"}`]),role:"tooltip",onFocus:this.showHint,onBlur:this.hideHint,onMouseEnter:this.showHint,onMouseLeave:this.hideHint,onTouchEnd:this.toggleHint,children:this.props.children}),this.state.visible&&(0,zn.jsx)("div",{role:"tooltip",style:{"--anchor-name":n},className:"HintTooltip__content",children:e})]})}}const Yx=[Z.kAddressBarInlineSearchSuggestOnNickname,Z.kAddressBarOmniboxBookmarksBoosted,Z.kAddressBarOmniboxShowBrowserHistory,Z.kAddressBarOmniboxBookmarks,Z.kAddressBarOmniboxShowNicknames,Z.kAddressBarSearchDirectMatchBoosted,Z.kAddressBarSearchDirectMatchEnabled,Z.kSearchSuggestEnabled,Z.kAddressBarSearchHiddenDirectMatchProviders,Z.kAddressBarOmniboxSearchHistoryEnable],Xx=I.Z.getEventHandler,Qx=[{key:"BOOKMARK_PROVIDER",name:(0,W.Z)("Bookmarks"),hint:(0,W.Z)("All saved bookmarks"),pref:Z.kAddressBarOmniboxBookmarks,indent:!1},{key:"BOOKMARK_PROVIDER_PRIORITISATION",name:(0,W.Z)("Prioritize Bookmarks"),hint:"",pref:Z.kAddressBarOmniboxBookmarksBoosted,indent:!0},{key:"NICKNAME_PROVIDER",name:(0,W.Z)("Bookmark Nicknames"),hint:(0,W.Z)("Bookmarks labeled with custom shortcut nicknames"),pref:Z.kAddressBarOmniboxShowNicknames,indent:!1},{key:"SEARCH_SUGGESTIONS_PROVIDER",name:(0,W.Z)("Search Suggestions"),hint:(0,W.Z)("Recommendations provided by the search engine based on your current query"),pref:Z.kSearchSuggestEnabled,indent:!1},{key:"SEARCH_SUGGESTIONS_ON_NICKNAME",name:(0,W.Z)("Only When Using Search Engine Nickname"),hint:"",pref:Z.kAddressBarInlineSearchSuggestOnNickname,indent:!0},{key:"SEARCH_HISTORY_PROVIDER",name:(0,W.Z)("Search History"),hint:(0,W.Z)("All recorded search queries"),pref:Z.kAddressBarOmniboxSearchHistoryEnable,indent:!1},{key:"HISTORY_PROVIDER",name:(0,W.Z)("History"),hint:(0,W.Z)("All recorded visits to pages and URLs"),pref:Z.kAddressBarOmniboxShowBrowserHistory,indent:!1},{key:"DIRECT_MATCH_PROVIDER",name:(0,W.Z)("Direct Match"),hint:(0,W.Z)("Shortcut to known brand website"),pref:Z.kAddressBarSearchDirectMatchEnabled,indent:!1},{key:"DIRECT_MATCH_PRIORITISATION",name:(0,W.Z)("Prioritize Direct Match"),hint:"",pref:Z.kAddressBarSearchDirectMatchBoosted,indent:!0}];function qx(e){const t=(0,Eo.Z)(Yx);return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Address Field Suggestions")}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Select which items to display in the dropdown menu.")}),(0,zn.jsx)(Hy.Z,{items:Qx.map((e=>({...e,isDefault:!1,isRemovable:!1,isStatic:!1,label:""}))),filter:e.filter,renderListItem:(e,s)=>{const n=Qx.find((e=>e.key===s.key));if(!n)return(0,zn.jsx)("span",{style:{width:16}});const{pref:i,indent:a,key:o,name:r,hint:l}=n,d=i&&t[i];return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("input",{style:{marginLeft:a?"16px":"0px"},type:"checkbox",value:o,checked:d,onChange:Xx(i)}),r,l&&(0,zn.jsx)($x,{className:"hint-position",label:l,children:" "})]})},onActivate:e=>{I.Z.toggle(Qx[e].pref,!0,!1)}}),t[Z.kAddressBarSearchHiddenDirectMatchProviders].length>0&&(0,zn.jsx)("input",{type:"button",onClick:()=>re.Z.directMatch.resetHidden(),value:(0,W.Z)("Reset Hidden Direct Match Providers"),disabled:!t[Z.kAddressBarSearchDirectMatchEnabled]})]})}const Jx=Un.memo(qx);class eI extends Un.Component{_hiddenRange=Un.createRef();setValue=e=>{const t=this._hiddenRange.current,s=(Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value")||{}).set;t&&s&&(s.call(t,e.currentTarget.value),t.dispatchEvent(new Event("input",{bubbles:!0})))};render(){const{prefValues:e,className:t,label:s,minLabel:n,maxLabel:i,...a}=this.props,o=this.props.step||1,r=["RangeButtonInput",t].join(" ");return e[Z.kAppearanceRangeButtons]?(0,zn.jsxs)("span",{className:r,children:[(0,zn.jsx)("input",{...a,ref:this._hiddenRange,type:"range",onChange:this.props.onChange,hidden:!0}),(0,zn.jsx)("button",{type:"button",className:"FormButton",onClick:this.setValue,title:n??(0,W.Z)("Decrease"),value:Number((this.props.value-o).toFixed(2)),disabled:this.props.disabled||this.props.value<=this.props.min,dangerouslySetInnerHTML:{__html:Kn.M2k.medium}}),s??this.props.value,(0,zn.jsx)("button",{type:"button",className:"FormButton",onClick:this.setValue,title:i??(0,W.Z)("Increase"),value:Number((this.props.value+o).toFixed(2)),disabled:this.props.disabled||this.props.value>=this.props.max,dangerouslySetInnerHTML:{__html:Kn.md4.medium}})]}):(0,zn.jsxs)("label",{className:r,children:[(0,zn.jsx)("input",{...a,type:"range"}),(0,zn.jsx)("span",{children:s??this.props.value})]})}}const tI=(0,zd.Z)(eI,[Z.kAppearanceRangeButtons]),sI={width:400,minWidth:"unset"};function nI(e){const[t,s]=Un.useState(!1),{onReset:n,prefPaths:i}=e,a=Un.useCallback((async()=>(n&&await n(),i?.length>0&&i.forEach((e=>{I.Z.reset(e)})),s(!1),Promise.resolve())),[i,n]),o=()=>{s(!1)},r=()=>{s(!0)},l=Un.useCallback((e=>(0,zn.jsx)(Ha.Z,{style:sI,className:"float",onRequestClose:o,title:(0,W.Z)("Reset $1 Settings to Default?",[e]),children:(0,zn.jsxs)("div",{className:"dialog-restore-settings",children:[(0,zn.jsx)("div",{className:"dialog-content",children:(0,zn.jsx)("p",{children:(0,W.Z)("All settings in the “$1” section will be reset to default values.",[e])})}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"button",className:"danger",onClick:a,value:(0,W.Z)("command","Reset Settings")}),(0,zn.jsx)("input",{type:"button",onClick:o,value:(0,W.Z)("Cancel"),autoFocus:!0})]})]})})),[a]),d=Un.useMemo((()=>(0,zn.jsxs)(Vy.Z,{categoryTitle:(0,W.Z)("title","Reset Settings"),filter:e.filter,children:[t&&l(e.name),(0,zn.jsx)("div",{className:"setting-group",children:(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Reset $1 Settings to Default",[e.name]),onClick:r}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("This will reset the settings in this section to default values.")})]})})]})),[t,e.filter,e.name,l]);return e.prefPaths?.length?d:null}var iI=s(66777);const aI=[Z.kAddressBarAutocompleteEnabled,Z.kAddressBarAutocompleteSuffixExpansionEnabled,Z.kAddressBarAutocompleteSuffixExpansionValue,Z.kAddressBarExtensionsRenderInDropdown,Z.kAddressBarExtensionsShowAllToggle,Z.kAddressBarHighlightBaseDomain,Z.kAddressBarOmniboxCutcopyEncoded,Z.kAddressBarOmniboxEnabled,Z.kAddressBarOmniboxShowSearchHistory,Z.kAddressBarOmniboxShowTypedHistory,Z.kAddressBarOmniboxShowTypedHistoryButton,Z.kAddressBarPosition,Z.kAddressBarSearchAlwaysShowDropdownBadge,Z.kAddressBarSelectOnClick,Z.kAddressBarShowFullUrl,Z.kAddressBarShowProgress,Z.kAddressBarShowQrGenerator,Z.kAddressBarStripJavascriptOnPaste,Z.kAddressBarUrlOpenShortcut,Z.kAddressBarVisible,Z.kHttpsOnlyModeEnabled,Z.kAddressBarOmniboxDropdownSize],oI=[...aI,...Yx],rI=I.Z.getEventHandler;var lI=(0,zn.jsx)("input",{type:"radio",value:"top"}),dI=(0,zn.jsx)("input",{type:"radio",value:"bottom"}),cI=(0,zn.jsx)("input",{type:"radio",value:"alt"}),hI=(0,zn.jsx)("input",{type:"radio",value:"shift"}),uI=(0,zn.jsx)("input",{type:"radio",value:"false"}),pI=(0,zn.jsx)("input",{type:"radio",value:"true"});function gI(e){const t=(0,Eo.Z)(aI),s=nI({filter:e.filter,prefPaths:oI,name:e.category.title});return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsxs)(Vy.Z,{categoryTitle:(0,W.Z)("title","Address Bar"),filter:e.filter,children:[(0,zn.jsx)(iI.j,{filter:e.filter,className:"unlimited",children:(0,zn.jsx)(iI.C,{text:(0,W.Z)("Show Address Bar"),children:(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kAddressBarVisible],onChange:rI(Z.kAddressBarVisible)})})}),(0,zn.jsxs)(iI.j,{filter:e.filter,heading:(0,W.Z)("Address Bar Position"),children:[(0,zn.jsxs)(To.Z,{name:"addressbar-position",value:t[Z.kAddressBarPosition],onChange:rI(Z.kAddressBarPosition),className:"group",children:[(0,zn.jsx)(iI.C,{text:(0,W.Z)("Top"),children:lI}),(0,zn.jsx)(iI.C,{text:(0,W.Z)("Bottom"),children:dI})]}),(0,zn.jsx)("h3",{className:"pad-top",children:(0,W.Z)("Open Address in New Tab")}),(0,zn.jsxs)(To.Z,{name:"urlfieldShortcut",className:"setting-single",value:t[Z.kAddressBarUrlOpenShortcut],onChange:rI(Z.kAddressBarUrlOpenShortcut),children:[(0,zn.jsx)(iI.C,{text:(0,vc.$)("Alt + Enter"),children:cI}),(0,zn.jsx)(iI.C,{text:(0,vc.$)("Shift + Enter"),children:hI})]})]}),(0,zn.jsxs)(iI.j,{filter:e.filter,heading:(0,W.Z)("Address Field Options"),children:[(0,zn.jsx)(iI.C,{text:(0,W.Z)("Address Auto-Complete"),children:(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kAddressBarAutocompleteEnabled],onChange:rI(Z.kAddressBarAutocompleteEnabled)})}),(0,zn.jsx)(iI.C,{text:(0,W.Z)("Show Full Address"),children:(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kAddressBarShowFullUrl],onChange:rI(Z.kAddressBarShowFullUrl)})}),(0,zn.jsx)(iI.C,{text:(0,W.Z)("Select Address on Activation"),children:(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kAddressBarSelectOnClick],onChange:rI(Z.kAddressBarSelectOnClick)})}),(0,zn.jsx)(iI.C,{text:(0,W.Z)("Copy and Cut Encoded Address"),children:(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kAddressBarOmniboxCutcopyEncoded],onChange:rI(Z.kAddressBarOmniboxCutcopyEncoded)})}),(0,zn.jsx)(iI.C,{text:(0,W.Z)("Page Load Progress Bar"),children:(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kAddressBarShowProgress],onChange:rI(Z.kAddressBarShowProgress)})}),(0,zn.jsx)(iI.C,{text:(0,W.Z)("QR Code Generator"),children:(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kAddressBarShowQrGenerator],onChange:rI(Z.kAddressBarShowQrGenerator)})})]}),(0,zn.jsxs)(iI.j,{filter:e.filter,heading:(0,W.Z)("Drop-Down Menu"),children:[(0,zn.jsx)(iI.C,{text:(0,W.Z)("Show Drop-Down when Typing"),children:(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kAddressBarOmniboxEnabled],onChange:rI(Z.kAddressBarOmniboxEnabled)})}),(0,zn.jsx)(iI.C,{text:(0,W.Z)("Always Show Item Badge"),className:"pad-left",children:(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kAddressBarSearchAlwaysShowDropdownBadge],onChange:rI(Z.kAddressBarSearchAlwaysShowDropdownBadge),disabled:!t[Z.kAddressBarOmniboxEnabled]})}),(0,zn.jsx)(iI.C,{text:(0,W.Z)("Show Typed History Drop-Down"),children:(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kAddressBarOmniboxShowTypedHistory],onChange:rI(Z.kAddressBarOmniboxShowTypedHistory)})}),(0,zn.jsx)(iI.C,{text:(0,W.Z)("Include Search Queries"),className:"pad-left",children:(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kAddressBarOmniboxShowSearchHistory],onChange:rI(Z.kAddressBarOmniboxShowSearchHistory),disabled:!t[Z.kAddressBarOmniboxShowTypedHistory]})}),(0,zn.jsx)(iI.C,{text:(0,W.Z)("Show Typed History Button"),className:"pad-left",children:(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kAddressBarOmniboxShowTypedHistoryButton],onChange:rI(Z.kAddressBarOmniboxShowTypedHistoryButton),disabled:!t[Z.kAddressBarOmniboxShowTypedHistory]})})]}),(0,zn.jsx)(iI.j,{filter:e.filter,heading:(0,W.Z)("Drop-Down Maximum Size"),children:(0,zn.jsx)(tI,{value:t[Z.kAddressBarOmniboxDropdownSize],min:5,max:42,step:1,onChange:rI(Z.kAddressBarOmniboxDropdownSize),label:(0,W.Z)("$1 result","$1 results",[t[Z.kAddressBarOmniboxDropdownSize]]),title:(0,W.Z)("Maximum number of results to show in the drop-down")})}),(0,zn.jsx)("div",{className:"setting-group setting-group-double",children:(0,zn.jsx)("div",{className:"setting-single list-priority",children:(0,zn.jsx)(Jx,{filter:e.filter})})}),(0,zn.jsxs)(iI.j,{filter:e.filter,heading:(0,W.Z)("Security Features"),children:[(0,zn.jsx)(iI.C,{text:(0,W.Z)("Always Use Secure Connection (HTTPS)"),children:(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kHttpsOnlyModeEnabled],onChange:rI(Z.kHttpsOnlyModeEnabled)})}),(0,zn.jsx)(iI.C,{text:(0,W.Z)("Strip JavaScript from Pasted Text"),children:(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kAddressBarStripJavascriptOnPaste],onChange:rI(Z.kAddressBarStripJavascriptOnPaste)})}),(0,zn.jsx)(iI.C,{text:(0,W.Z)("Highlight Address Base Domain"),children:(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kAddressBarHighlightBaseDomain],onChange:rI(Z.kAddressBarHighlightBaseDomain)})})]}),(0,zn.jsxs)(iI.j,{filter:e.filter,heading:(0,W.Z)("Domain Expansion"),children:[(0,zn.jsx)("p",{className:"info pad-top",children:(0,W.Z)("Expand top level domains with $1. This shortcut takes precedence over tab opening modifiers.",[(0,vc.$)("Ctrl + Enter")])}),(0,zn.jsx)(iI.C,{text:(0,W.Z)("radio","Enabled"),children:(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kAddressBarAutocompleteSuffixExpansionEnabled],onChange:rI(Z.kAddressBarAutocompleteSuffixExpansionEnabled)})}),(0,zn.jsx)(iI.C,{className:"pad-left",text:(0,W.Z)("Suffix"),children:(0,zn.jsx)("input",{disabled:!t[Z.kAddressBarAutocompleteSuffixExpansionEnabled],type:"text",defaultValue:t[Z.kAddressBarAutocompleteSuffixExpansionValue],maxLength:"256",onChange:rI(Z.kAddressBarAutocompleteSuffixExpansionValue)})})]}),(0,zn.jsxs)(iI.j,{filter:e.filter,heading:(0,W.Z)("Extension Visibility"),children:[(0,zn.jsxs)(To.Z,{name:"extension-toolbar-expansion",value:t[Z.kAddressBarExtensionsShowAllToggle],onChange:rI(Z.kAddressBarExtensionsShowAllToggle,"convert"),className:"group",children:[(0,zn.jsx)(iI.C,{label:(0,W.Z)("Show and hide only hidden extensions"),text:(0,W.Z)("Toggle Only Hidden Extensions"),children:uI}),(0,zn.jsx)(iI.C,{label:(0,W.Z)("Show and hide all extensions"),text:(0,W.Z)("Toggle All Extensions"),children:pI})]}),(0,zn.jsx)(iI.C,{label:(0,W.Z)("Enable the drop-down menu for hidden extensions"),text:(0,W.Z)("Expand Hidden Extensions to Drop-Down Menu"),children:(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kAddressBarExtensionsRenderInDropdown],onChange:rI(Z.kAddressBarExtensionsRenderInDropdown)})})]}),(0,zn.jsx)(iI.j,{filter:e.filter,heading:(0,W.Z)("Profile Management"),children:(0,zn.jsx)("input",{type:"button",onClick:e=>ue.Z.managePeople(),value:(0,W.Z)("Manage Profiles")})})]})}),s]})}const mI=Un.memo(gI);var fI=s(37182),vI=s(63305);const bI="vivaldi/x-commanditem",CI="vivaldi/x-commandfolder",wI="vivaldi/x-commandmixed",yI="vivaldi/x-menuitem",xI="vivaldi/x-menudefaulttopfolder",II="vivaldi/x-menufolder",AI="vivaldi/x-menumixed",SI="vivaldi/x-bookmarkcontainer";function ZI(e){return(0,vc.$)(e)}var TI=(0,zn.jsx)("hr",{className:"separator-left"}),EI=(0,zn.jsx)("hr",{className:"separator-right"});class kI extends Un.Component{static contextType=oi.Z;refTreeList=Un.createRef();_searchKey="";_appendToSearch=!1;_isIMEOpen=!1;constructor(e,t){super(e),this.state={commandItems:[],searchFilter:"",darkBackground:Ue.Z.hasDarkBackground(t.vivaldiWindowId)}}componentDidMount(){this._isMounted=!0,this._initialSetup(),Ye.Z.addListener(this._onCommandStoreChanged),Ue.Z.addListener(this._onThemeStoreChanged)}_initialSetup=(0,Te.Z)((async(e="")=>{if(!this._isMounted)return!1;const{commandItems:t,searchFilter:s}=await this._getStateWithSearchFilter(e);this.setState({commandItems:t,searchFilter:s})}),200);componentWillUnmount(){this._isMounted=!1,clearTimeout(this._timeout),Ye.Z.removeListener(this._onCommandStoreChanged),Ue.Z.removeListener(this._onThemeStoreChanged)}componentDidUpdate(e,t){0===t.commandItems?.length&&this.state.commandItems.length>0&&this.refTreeList.current?.selectByNode(this.state.commandItems[0]),this.props.menu!==e.menu&&this._initialSetup(this.state.searchFilter)}_onCommandStoreChanged=e=>{if("menu"===e){const e=this.state.searchFilter;this._initialSetup(e)}};_onThemeStoreChanged=()=>{this.setState({darkBackground:Ue.Z.hasDarkBackground(this.context.vivaldiWindowId)})};_getStateWithSearchFilter=async e=>{const t="contextfolder",s="chainfolder",n="appfolder",i="mailfolder",a="calendarfolder",o=e=>e.sort(((e,t)=>{if("container"===e.type&&"container"===t.type){const s=e.settingsLabel||"",n=t.settingsLabel||"";return s<n?-1:s>n?1:0}return"container"===e.type&&"container"!==t.type?"separator"===t.type?1:-1:"container"!==e.type&&"container"===t.type?"separator"===e.type?-1:1:"separator"===e.type||"separator"===t.type||e.label<t.label?-1:e.label>t.label?1:0})),r=(e,t)=>({parentId:e,id:t.id||"",type:t.type,label:t.settingsLabel||t.label,action:"",iconPNG:t.iconPNG||"",iconPNGWhite:t.iconPNGWhite||"",shortcuts:t.shortcuts}),l=e=>o(Ye.Z.makeCommandList(this.context.vivaldiWindowId).filter((t=>{if(void 0===t.id||t.id.startsWith("COMMAND_MAIL")||t.id.startsWith("COMMAND_CALENDAR"))return!1;return-1!==(t.settingsLabel||t.label||"").toLowerCase().indexOf(e)}))),d=e=>o(Ye.Z.makeCommandList(this.context.vivaldiWindowId).filter((t=>{if(void 0===t.id||!t.id.startsWith("COMMAND_MAIL"))return!1;return-1!==(t.settingsLabel||t.label||"").toLowerCase().indexOf(e)}))),c=e=>o(Ye.Z.makeCommandList(this.context.vivaldiWindowId).filter((t=>{if(void 0===t.id||!t.id.startsWith("COMMAND_CALENDAR"))return!1;return-1!==(t.settingsLabel||t.label||"").toLowerCase().indexOf(e)}))),h=(e,t)=>o(ei.Z.makeCommandList(this.context.vivaldiWindowId,e).filter((e=>{const s=e.settingsLabel||e.label;return void 0===s?(console.warn("Action ignored for command list",e.commandName),!1):-1!==s.toLowerCase().indexOf(t)}))),u=async e=>{const t=d(e).map((e=>r(n,e))),h=c(e).map((e=>r(n,e))),u=[{id:i,parentId:n,type:"folder",label:(0,W.Z)("Mail Commands"),action:"",iconPNG:"",iconPNGWhite:"",children:t},{id:a,parentId:n,type:"folder",label:(0,W.Z)("Calendar Commands"),action:"",iconPNG:"",iconPNGWhite:"",children:h}].sort(((e,t)=>e.label<t.label?-1:e.label>t.label?1:0)).concat(l(e).map((e=>r(n,e)))),p=await(async e=>{const t=await Ye.Z.getChainCommandsShortcuts();return o(A.Z.get(Z.kChainedCommandsCommandList).map((e=>{const s=t.find((t=>t.name===e.name));return{type:"command",action:e.name,id:e.name,...st.Z.makeLabelPair(e.label),shortcuts:s?.shortcuts}})).filter((t=>-1!==(t.label||"").toLowerCase().indexOf(e))))})(e).then((e=>e.map((e=>r(s,e)))));return[{id:n,parentId:"",type:"folder",label:(0,W.Z)("Application Commands"),action:"",iconPNG:"",iconPNGWhite:"",children:u},{id:s,parentId:"",type:"folder",label:(0,W.Z)("Command Chains"),action:"",iconPNG:"",iconPNGWhite:"",children:p}]};let p=[];if(!ei.Z.isSection(this.props.menu)){const n=e.toLowerCase();p=ei.Z.getKeys().includes(this.props.menu)?await(async(e,n)=>u(n).then((i=>{const a=h(e,n).map((e=>r(s,e)));return[{id:t,parentId:"",type:"folder",label:(0,W.Z)("Context Commands"),action:"",iconPNG:"",iconPNGWhite:"",children:a}].concat(i)})))(this.props.menu,n):await u(n);const i={parentId:"",id:"separator",type:"separator",action:"",iconPNG:"",iconPNGWhite:"",label:""};p.splice(0,0,i);const a=Ye.Z.makeCommandList(this.context.vivaldiWindowId,Ye.Z.getOpenLinkName());a&&1===a.length&&a[0].id&&p.splice(0,0,r("",a[0]))}return{searchFilter:e,commandItems:p,darkBackground:this.state.darkBackground}};_hasChildren=e=>Boolean(e.children?.length);_isFolder=e=>Boolean(e.children);_isSeparator=e=>"separator"===e.type;_isValidDragSource=e=>!this._isFolder(e);_validateForDrag=vI.Z;_getDragData=(e,t)=>"";_getNodeById=e=>{const t=s=>{if(s)for(let n=0;n<s.length;n++){const i=s[n];if(i.id===e)return i;if(i.children){const e=t(i.children);if(e)return e}}};return t(this.state.commandItems)};_getMimeData=e=>{let t="";const s=[];return e.forEach((e=>{const n=this._getNodeById(e);if(n&&void 0!==n.type){t="folder"===n.type?""===t||t===CI?CI:wI:""===t||t===bI?bI:wI;const e={id:"",type:n.type,action:n.id};"folder"===n.type&&(e.title=n.label);const i=Ye.Z.getCommandParameter(e.action);if(i&&(e.parameter=i),Ye.Z.getOpenLinkName()===e.action){const t=Ye.Z.getCommandLabel(e.action);t&&(e.title=t)}const a={menu:"contextfolder"===n.parentId?this.props.menu:"",node:e};s.push(a)}})),{mimeType:t,payload:JSON.stringify(s)}};_setEventBehavior=(e,t)=>{const s=this._getMimeData(t);e.dataTransfer.setData(s.mimeType,s.payload)};_copy=(e,t)=>{const s=e.clipboardData;if(s){const e=t.filter(this._isValidForClipboard).map((e=>e.id)),n=this._getMimeData(e);s.setData(n.mimeType,n.payload)}(0,wi.ZP)(e)};_onKeyDown=e=>{const t=(e,t,s)=>{for(let n=t;n<s.length;n++){const t=s[n];if(t.label&&t.label.toUpperCase().startsWith(e))return t}};switch(e.key){case"ArrowUp":case"ArrowDown":case"PageUp":case"PageDown":break;default:const{ctrlKey:s,altKey:n,shiftKey:i,metaKey:a}=e,o={ctrlKey:s,altKey:n,shiftKey:i,metaKey:a};if((0,Zi.VV)(o)){const s=this.refTreeList.current?.getSelectedItem(),n=s?this._getNodeById(s.parentId):void 0,i=n?n.children||[]:this.state.commandItems,a=(s?i.findIndex((e=>e.id===s.id)):-1)+1,o=this._searchKey.length;if("ArrowLeft"===e.key||"ArrowRight"===e.key){if(0===o)break}else if(this._appendToSearch&&!1===e.repeat){const t=e.key.toUpperCase();1===o&&this._searchKey[0]===t||(this._searchKey+=t)}else this._searchKey=e.key.toUpperCase();let r=t(this._searchKey,a,i);r||0===a||(r=t(this._searchKey,0,i)),r&&(this.refTreeList.current?.selectByNode(r),e.preventDefault()),clearTimeout(this._timeout),this._appendToSearch=!0,this._timeout=setTimeout((()=>{this._appendToSearch=!1}),400)}}};_onSearchFilterChange=async e=>{if(this._isIMEOpen)this.setState({searchFilter:e.target.value});else{const t=await this._getStateWithSearchFilter(e.target.value);this.setState(t)}};_handleExpandClick=(e,t)=>{const s=e.altKey;this.refTreeList.current?.toggleSelectedExpansion(t,s)};_getContextMenuItems=e=>e?[{isVisible:()=>{const e=this.refTreeList.current?.getAllSelectedItems().filter((e=>this._isValidForClipboard(e))).map((e=>e.id));return Boolean(e&&e.length>0&&this.props.canAddToTree())},handler:()=>{const e=this.refTreeList.current?.getAllSelectedItems().filter((e=>this._isValidForClipboard(e))).map((e=>e.id));if(e){const t=this._getMimeData(e);this.props.addToTree(t.mimeType,t.payload)}},...(0,fi.Z)("Add to Content")}]:[];_getContextMenuItemProps=e=>({showCopy:this._isValidForClipboard(e)});_isValidForClipboard=e=>!this._isFolder(e);rowComponent=e=>{const t=e.node,s=e.level,n=s*Ni+"px",i=(s+1)*Ni+"px";if(this._isSeparator(t))return(0,zn.jsxs)("label",{style:{marginLeft:i},children:[TI,(0,W.Z)("Menu Separator"),EI]},"0");let a=t.label;t.ellipsis&&(a+=st.Z.ellipsisString()),"container"===t.type&&t.settingsLabel&&(a=t.settingsLabel);const o=this._isFolder(t)&&this._hasChildren(t);let r=A.Z.get(Z.kKeyboardShortcutsEnable);t.shortcuts?.length>0&&1===t.shortcuts[0].length&&r&&(r=st.Z.hasBrowserFeature(t)?A.Z.get(Z.kKeyboardShortcutsEnableSingleKey):A.Z.get(Z.kKeyboardShortcutsEnableSingleKeyForMail));const l=this.state.darkBackground?t.iconPNGWhite:t.iconPNG;return(0,zn.jsxs)("label",{style:o?null:{marginLeft:i},children:[o&&(0,zn.jsx)("span",{className:"expand-icon",style:{marginLeft:n},onMouseDown:wi.ZP,onMouseUp:e=>this._handleExpandClick(e,t.id),dangerouslySetInnerHTML:{__html:Kn.nfH}}),l&&(0,zn.jsx)("img",{src:"data:image/png; base64, "+l}),(0,zn.jsx)("span",{className:"title",children:a}),t.shortcuts&&t.shortcuts.length>0&&(0,zn.jsx)("span",{className:"nickname",children:ZI(t.shortcuts[0])})]},"0")};render(){return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)(Mi,{ref:this.refTreeList,rowComponent:this.rowComponent,nodes:this.state.commandItems,enableDragAndDrop:!0,validateForDrag:this._validateForDrag,isValidDragSource:this._isValidDragSource,getDragData:this._getDragData,setCustomEventBehavior:this._setEventBehavior,hasChildren:this._hasChildren,isFolder:this._isFolder,onCopy:this._copy,getContextMenuItems:this._getContextMenuItems,getContextMenuItemProps:this._getContextMenuItemProps,onKeyDown:this._onKeyDown}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)("input",{type:"search",className:"menu-search",value:this.state.searchFilter,placeholder:(0,W.Z)("Filter Commands"),onCompositionStart:()=>this._isIMEOpen=!0,onCompositionEnd:e=>{this._isIMEOpen=!1,this._onSearchFilterChange(e)},onChange:this._onSearchFilterChange})})]})}}const NI=kI;var _I=s(34155);const PI="MenuCutIds";class MI extends Un.Component{refTreeList=Un.createRef();static contextType=oi.Z;winId=-1;_isMounted=!1;_isMac=!1;_editHasFocus=!1;_id=crypto.randomUUID();_pageContext={};constructor(e,t){super(e),this.winId=t.vivaldiWindowId,this.state={rootId:"",role:void 0,menuItems:[],editId:"",editTitle:"",editUrl:"",url:"",cutIds:[],darkBackground:Ue.Z.hasDarkBackground(t.vivaldiWindowId)}}componentDidMount(){this._isMounted=!0,re.Z.menuContent.onChanged.addListener(this._onMenuChanged),re.Z.menuContent.onResetAll.addListener(this._onMenuResetAll),re.Z.utilities.onSharedDataUpdated.addListener(this._onSharedDataChanged),Ue.Z.addListener(this._onThemeStoreChanged),wg.addListener(this._onUrlFieldStoreChanged,(e=>e.get(this._id))),this._loadMenu()}componentWillUnmount(){this._isMounted=!1,re.Z.menuContent.onChanged.removeListener(this._onMenuChanged),re.Z.menuContent.onResetAll.removeListener(this._onMenuResetAll),re.Z.utilities.onSharedDataUpdated.removeListener(this._onSharedDataChanged),Ue.Z.removeListener(this._onThemeStoreChanged),wg.removeListener(this._onUrlFieldStoreChanged)}componentDidUpdate(e,t){this.props.menu!==e.menu&&(this._cancelEdit(),this._loadMenu())}_onThemeStoreChanged=()=>{this.setState({darkBackground:Ue.Z.hasDarkBackground(this.context.vivaldiWindowId)})};_onUrlFieldStoreChanged=()=>{const{typedUrl:e}=wg.getUrlfieldState(this._id);this.setState({editUrl:e})};getSelectedItem=()=>this.refTreeList.current?.getSelectedItem();_onMenuChanged=(e,t,s,n,i)=>{e===this.props.menu&&this._setMenu(this.props.menu,t,s,n,i,!1)};_onMenuResetAll=e=>{e===ei.Z.hasName(this.props.menu)&&this._loadMenu()};_loadMenu=()=>{const e=this.props.menu;ei.Z.isSection(e)?this._isMounted&&this.setState({rootId:"",role:void 0,menuItems:[]}):re.Z.menuContent.get(e,((t,s,i)=>{n.Z.runtime.lastError?(this.setState({rootId:"",role:void 0,menuItems:[]}),console.warn("Failed to read menu spec. Attempting fallback for menu key:",e),re.Z.menuContent.reset(e,ei.Z.hasName(e),void 0,nr.Z)):this._setMenu(e,t,s,"",i,!0)}))};_setMenu=(e,t,s,n,i,a)=>{const o=(e,t,s)=>{const n={...e,index:s,parentId:t},i=e.id;return e.items&&void 0!==i&&(n.children=e.items.map(((e,t)=>o(e,i,t)))),n};((e,t,s)=>{const n={expandContainers:!1,inSettings:!0,updateCallbacks:!1};return"context"===t?ei.Z.makeMenuWithContent(this.winId,e,s,n):Promise.resolve(Ye.Z.makeMenuWithContent(this.winId,s,n))})(e,s,i).then((e=>{const i=e.map(((e,s)=>o(e,t,s)));this._isMounted&&this.setState({rootId:t,role:s,menuItems:i},(()=>{if(a&&this.state.menuItems.length>0)this.refTreeList.current?.selectByNode(this.state.menuItems[0]);else{const e=this._getNodeById(n);e&&this.refTreeList.current?.selectByNode(e)}}))}))};_getNodeById=e=>{const t=s=>{if(s)for(let n=0;n<s.length;n++){const i=s[n];if(i.id===e)return i;if(i.children){const e=t(i.children);if(e)return e}}};return t(this.state.menuItems)};_hasChildren=e=>Boolean(e.children)&&e.children.length>0;_isFolder=e=>Boolean(e.children);_isContainer=e=>"container"===e.type;_isBookmarkContainer=e=>"CONTAINER_BOOKMARK"===e.container?.content;_isSeparator=e=>"separator"===e.type;_isLink=e=>e.commandName===Ye.Z.getOpenLinkName();_isDefaultTopFolder=e=>!this._isContextMenu()&&(!!this._isMac&&["MENU_APPLE_APP","MENU_FILE","MENU_EDIT","MENU_VIEW","MENU_BOOKMARKS","MENU_WINDOW","MENU_HELP"].includes(e.commandName));_isPersistent=e=>!this._isContextMenu()&&(!!this._isMac&&["MENU_APPLE_APP","MENU_BOOKMARKS","MENU_WINDOW","MENU_HELP"].includes(e.commandName));_canDeleteNode=e=>!!this._isContextMenu()||(!this._isMac||!this._isPersistent(e)&&!this._isBookmarkContainer(e));_isValidForClipboard=e=>this._isValidDragSource(e);_isValidDragSource=e=>!!this._isContextMenu()||(!this._isMac||!["MENU_APPLE_APP"].includes(e.commandName));_validateForDrag=e=>e.map(this._getNodeById).filter(Boolean).filter(this._isValidDragSource).map((e=>e.id));_validateForDeletion=e=>e.map(this._getNodeById).filter(Boolean).filter(this._canDeleteNode).map((e=>e.id));_validateForRename=e=>{const t=this._getNodeById(e);return!!t&&(!this._isSeparator(t)&&!1!==t.settingsRename)};_validateForEdit=e=>{const t=this._getNodeById(e);return!!t&&this._isLink(t)};_reset=e=>{re.Z.menuContent.reset(this.props.menu,ei.Z.hasName(this.props.menu),[e],nr.Z)};_setContainerMode=(e,t)=>{re.Z.menuContent.update(this.props.menu,e,{containerMode:t},nr.Z)};_setShowShorcut=(e,t)=>{re.Z.menuContent.update(this.props.menu,e,{showshortcut:t},nr.Z)};_setContainerEdge=(e,t)=>{re.Z.menuContent.update(this.props.menu,e,{containerEdge:t},nr.Z)};_onEdit=()=>{const e=this.getSelectedItem();if(e){const t=e.url||"https://www.vivaldi.com";vg.Z.updateState(this._id,{typedUrl:t,autocompleteValue:""}),this.setState({editId:e.id,editTitle:e.label,url:t})}};_onTitleChanged=e=>{const t=e.target.value;this.setState({editTitle:t})};_onEditFocus=()=>{this._editHasFocus=!0};_onEditBlur=()=>{this._editHasFocus=!1,_I.nextTick((()=>{this._saveEdit(!this._editHasFocus,!1)}))};_cancelEdit=()=>{this.setState({editId:"",editTitle:"",editUrl:""})};_saveEdit=(e,t)=>{const s=this.state.editId,{autocompleteValue:n}=wg.getUrlfieldState(this._id);let i=(n||this.state.editUrl||this.state.url||"").trim();void 0===re.Z.utilities.getUrlFragments(i).scheme&&(i="http://"+i),re.Z.menuContent.update(this.props.menu,s,{title:this.state.editTitle,parameter:i},(()=>{e&&this.setState({editId:"",editTitle:"",editUrl:""},(()=>{const e=this._getNodeById(s);e&&(t&&this.refTreeList.current?.focusTree(),this.refTreeList.current?.expandToId(s),this.refTreeList.current?.selectByNode(e))}))}))};_handleEditKeyPress=e=>{"Escape"===e.key&&(e.preventDefault(),this._cancelEdit()),"Enter"===e.key&&(e.preventDefault(),this._saveEdit(!0,!0))};_getTitle=e=>{const t=this._getNodeById(e);if(t){let e=t.label;return t.ellipsis&&(e+=st.Z.ellipsisString()),e}return""};_saveTitle=(e,t)=>{re.Z.menuContent.update(this.props.menu,e,{title:t},nr.Z)};_isMenubarMenu=()=>"mac"===this.state.role||"horizontal"===this.state.role;_isContextMenu=()=>"context"===this.state.role;_getDragData=(e,t)=>"";_getMimeData=e=>{let t="",s=!1,n=!1;e.forEach((e=>{const i=this._getNodeById(e);i&&(this._isFolder(i)?(this._isDefaultTopFolder(i)&&(s=!0),t=""===t||t===II?II:AI):(this._isBookmarkContainer(i)&&(n=!0),t=""===t||t===yI?yI:AI))}));const i=[];return i.push({mimeType:t,payload:JSON.stringify(e)}),s&&i.push({mimeType:xI,payload:JSON.stringify(e)}),n&&i.push({mimeType:SI,payload:JSON.stringify(e)}),i};_setEventBehavior=(e,t)=>{this._getMimeData(t).forEach((t=>{e.dataTransfer.setData(t.mimeType,t.payload)}))};_getDropSupport=(e,t)=>{const s={available:!1,onto:!1,edge:"none"};return s.available=t.dataTransfer.types.some((e=>e===yI||e===II||e===AI||e===bI||e===CI||e===wI)),s.available&&(s.onto=this._canDropOnto(e,t),s.edge=this._canDropOnEdge(e,t)?"both":"none"),s};_canDropOnto=(e,t)=>{if(this._isFolder(e)){if(this._isMac){if(t.dataTransfer.types.some((e=>e===SI)))return!1;if(t.dataTransfer.types.some((e=>e===II))&&t.dataTransfer.types.some((e=>e===xI)))return!1}return!0}return!1};_canDropOnEdge=(e,t)=>e.parentId!==this.state.rootId||!this._isMenubarMenu()||(!this._isMac||0!==e.index)&&t.dataTransfer.types.some((e=>e===II||e===AI||e===CI||e===wI));_getTargetSpec=(e,t)=>{const s={id:e.id,index:0,parentId:""};return this._isFolder(e)&&"on"===t?s.parentId=e.id:(s.parentId=e.parentId,s.index=e.index+("below"===t?1:0)),s};_canAddToTopLevel=e=>{let t=!0;return this._isMenubarMenu()&&e.forEach((e=>{"folder"!==e.type&&(t=!1)})),t};_handleMimeData=(e,t,s,n,i)=>{const a={type:""};if(this._hasCommandMimeType(n,a)){const s=JSON.parse(i(a.type)).map((e=>{if(!e.menu||e.menu===this.props.menu)return e.node})).filter(Boolean);return this._add(e,t,s,!0).then((()=>Promise.resolve([])))}if(this._hasMenuMimeType(n,a)){const n=i(a.type),o=JSON.parse(n);if(s){const s=[];return this._getContentTree(s,o),this._add(e,t,s,!1).then((()=>Promise.resolve([])))}return this._onMove(o,{parentId:e,index:t,pageIndex:void 0}).then((e=>{if(e&&e.length>0){const t=e[0];this.refTreeList.current?.expandToId(t),this.refTreeList.current?.setSelectedIds(e),this._setCutIds([])}return Promise.resolve([])}))}return Promise.resolve([])};_onDrop=(e,t,s)=>{const n="on"===s?t.id:t.parentId,i="on"===s?0:t.index+("below"===s?1:0),a=Jn.ZP.isCopyModifierPressed(e);return this._handleMimeData(n,i,a,e.dataTransfer.types,(t=>e.dataTransfer.getData(t)))};addToNode=(e,t,s)=>{const n=this._isFolder(e)?e.id:e.parentId,i=this._isFolder(e)?0:e.index+1,a=JSON.parse(t).map((e=>{if(!e.menu||e.menu===this.props.menu)return e.node})).filter(Boolean);return this._add(n,i,a,s)};_add=(e,t,s,n,i)=>this._addAtPosition(e,t,s,n).then((e=>{e?.length>0&&(this.refTreeList.current?.expandToId(e[0]),this.refTreeList.current?.setSelectedIds(e))}));_addAtPosition=(e,t,s,n)=>{const i=(e,t,s)=>Promise.all(e.map((e=>new Promise((n=>{re.Z.menuContent.create(this.props.menu,t,s++,[e],((t,s)=>{e.children?i(e.children,s[0],0).then((()=>{n(s[0])})):n(s[0])}))}))))),a=n&&1===s.length&&s[0].action===Ye.Z.getOpenLinkName();return i(s,e,t).then((e=>(a&&_I.nextTick(this._onEdit),e)))};_supportsUpDownMove=(e,t)=>!!this._isValidDragSource(e)&&!(e.parentId===this.state.rootId&&t&&e.index<1);_onMove=(e,t)=>{const{parentId:s="",index:n=0}=t;return new Promise((t=>{re.Z.menuContent.move(this.props.menu,e,s,n,(s=>{t(e)}))}))};_onKeyPressed=e=>{"Escape"===e.key&&this._setCutIds([])};_setCutIds=e=>{re.Z.utilities.setSharedData({key:PI,value:e.length>0?e.join():""})};_onSharedDataChanged=(e,t)=>{if(e===PI){const e=t.length>0?t.split(","):[];e.length>0?this.context.addEventListener("keydown",this._onKeyPressed,!0):this.context.removeEventListener("keydown",this._onKeyPressed,!0),this.setState({cutIds:e})}};_cut=(e,t)=>{const s=t.filter(this._isValidForClipboard).map((e=>e.id));this._setCutIds(s);const n=e.clipboardData;if(n){n.setData("vivaldi/x-cut","true");this._getMimeData(s).forEach((e=>{n.setData(e.mimeType,e.payload)}))}(0,wi.ZP)(e)};_copy=(e,t)=>{const s=e.clipboardData;if(s){const e=t.filter(this._isValidForClipboard).map((e=>e.id));this._getMimeData(e).forEach((e=>{s.setData(e.mimeType,e.payload)}))}(0,wi.ZP)(e)};_getContentTree=(e,t)=>{t.forEach((t=>{const s=this._getNodeById(t);if(s){const t={id:"",action:s.commandName||"",type:s.type};if(t.action===Ye.Z.getOpenLinkName()&&(t.parameter=s.url,t.title=s.label),"folder"===t.type&&(t.title=s.label,t.children=[],s.children)){const e=s.children.map((e=>e.id)),n=[];this._getContentTree(n,e),t.children=n}e.push(t)}}))};_hasCommandMimeType=(e,t)=>{for(let s=0;s<e.length;s++){const n=e[s];switch(n){case bI:case CI:case wI:return t.type=n,!0}}return t.type="",!1};_hasMenuMimeType=(e,t)=>{for(let s=0;s<e.length;s++){const n=e[s];switch(n){case yI:case II:case AI:return t.type=n,!0}}return t.type="",!1};_paste=(e,t)=>{const s=e.clipboardData;if(!s)return Promise.resolve([]);const n="true"===s.getData("vivaldi/x-cut");if(n&&0===this.state.cutIds.length)return Promise.resolve([]);const i=this._isFolder(t)?t.id:t.parentId,a=this._isFolder(t)?0:t.index+1;return this._handleMimeData(i,a,!n,s.types,(e=>s.getData(e))).then((e=>(n&&this._setCutIds([]),e)))};_onCreate=(e,t,s,n)=>n?new Promise((n=>{const i=[];let a=!1,o=!1;e.forEach(((e,t)=>{if(e.children)a=0===t,i.push({id:"",type:"folder",action:"",title:(0,W.Z)("command","New Folder")});else if(e.separator)i.push({id:"",type:"separator",action:""});else{o=0===t;const e=Ye.Z.getOpenLinkName();i.push({id:"",type:"command",action:e,title:Ye.Z.getCommandLabel(e)||"",parameter:Ye.Z.getCommandParameter(e)||""})}})),re.Z.menuContent.create(this.props.menu,t||"",s??-1,i,((e,t)=>{o&&_I.nextTick(this._onEdit);const s={items:t.map((e=>({id:e}))),props:{edit:a}};n(s)}))})):Promise.resolve({items:[]});_onRemove=e=>new Promise((t=>{re.Z.menuContent.remove(this.props.menu,e,(e=>{t(e)}))}));_handleExpandClick=(e,t)=>{const s=e.altKey;this.refTreeList.current?.toggleSelectedExpansion(t,s)};_getContextMenuItemProps=e=>ei.Z.isSection(this.props.menu)?{}:e?{showMoveUp:this.refTreeList.current?.canMoveUpDown(e,!0)??!1,showMoveDown:this.refTreeList.current?.canMoveUpDown(e,!1)??!1,showRename:this._validateForRename(e.id),showEdit:this._validateForEdit(e.id),showDelete:this._canDeleteNode(e),showNewItem:!0,showNewSeparator:!0,showNewFolder:!0,showCut:this._canDeleteNode(e),showCopy:!0,showPaste:!0}:{showNewSeparator:!this._isMenubarMenu(),showNewFolder:!0,showPaste:!0};_getContextMenuNewItemString=()=>(0,fi.Z)("New Link");_getNodeMenuItems=e=>[{handler:()=>this._reset(e.id),isVisible:()=>this._isFolder(e)&&!e.custom,...(0,fi.Z)("Restore Default Folder")},{isVisible:()=>this._isContainer(e)&&!this._isBookmarkContainer(e),...(0,fi.Z)("Show as Subfolder"),type:"checkbox",checked:"folder"===e.container?.mode,handler:()=>this._setContainerMode(e.id,"folder"===e.container?.mode?"inline":"folder")},{isVisible:()=>this._isBookmarkContainer(e),...(0,fi.Z)("Show 'Add Active Tab'"),items:[{type:"radio",checked:"above"===e.container?.edge,radiogroup:2,handler:this._setContainerEdge.bind(this,e.id,"above"),...(0,fi.Z)("Above List")},{type:"radio",checked:"below"===e.container?.edge,radiogroup:2,handler:this._setContainerEdge.bind(this,e.id,"below"),...(0,fi.Z)("Below List")},{type:"separator",label:"",labelEnglish:""},{type:"radio",checked:"off"===e.container?.edge,handler:this._setContainerEdge.bind(this,e.id,"off"),radiogroup:2,...(0,fi.Z)("radio","Hide")}]},{isVisible:()=>!0,...(0,fi.Z)("Show Shortcuts in Menu"),type:"checkbox",isEnabled:()=>A.Z.get(Z.kKeyboardShortcutsEnable),checked:!1!==e.showshortcut,handler:()=>this._setShowShorcut(e.id,!(!1!==e.showshortcut))}];_getContextMenuItems=e=>e?this._getNodeMenuItems(e):[];rowComponent=e=>{const{inlineEditText:t,node:s,onBlur:n,onChange:i,onFocus:a,level:o}=e,r=o*Ni+"px",l=(o+1)*Ni+"px";if(this._isSeparator(s))return(0,zn.jsx)("label",{children:(0,zn.jsx)("hr",{style:{marginLeft:l},className:"separator"})},"0");let d=s.label;s.ellipsis&&(d+=st.Z.ellipsisString()),"container"===s.type&&(s.settingsLabel?d="inline"===s.container?.mode||this._isBookmarkContainer(s)?s.settingsLabel:(0,W.Z)("$1 (as Subfolder)",[s.settingsLabel]):"folder"===s.container?.mode&&(d=(0,W.Z)("$1 (as Subfolder)",[d])));const c=this._isFolder(s)&&this._hasChildren(s);let h=A.Z.get(Z.kKeyboardShortcutsEnable);s.shortcuts?.length>0&&1===s.shortcuts[0].length&&h&&(h=st.Z.hasBrowserFeature(s)?A.Z.get(Z.kKeyboardShortcutsEnableSingleKey):A.Z.get(Z.kKeyboardShortcutsEnableSingleKeyForMail));const u=!1!==s.showshortcut,p=this._isMenubarMenu()&&this._isMac?void 0:this.state.darkBackground?s.iconPNGWhite:s.iconPNG;return(0,zn.jsxs)("label",{style:c?null:{marginLeft:l},children:[c&&(0,zn.jsx)("span",{className:"expand-icon",style:{marginLeft:r},onMouseDown:wi.ZP,onMouseUp:e=>this._handleExpandClick(e,s.id),dangerouslySetInnerHTML:{__html:Kn.nfH}}),void 0!==t&&(0,zn.jsx)("input",{type:"text",value:t,onChange:i,onFocus:a,onBlur:n,autoFocus:!0}),p&&(0,zn.jsx)("img",{src:"data:image/png; base64, "+p}),void 0===t&&(0,zn.jsx)("span",{className:"title",children:d}),s.shortcuts?.length>0&&!u&&h&&(0,zn.jsx)("span",{style:{textDecoration:"line-through"},className:"nickname",children:ZI(s.shortcuts[0])}),s.shortcuts?.length>0&&u&&h&&(0,zn.jsx)("span",{className:"nickname",children:ZI(s.shortcuts[0])})]},"0")};render(){return this.state?this.state.editId?(0,zn.jsxs)("div",{onKeyDown:this._handleEditKeyPress,children:[(0,zn.jsx)("div",{className:"urlfield-clickoutside-ignore",children:(0,zn.jsx)("input",{type:"text",placeholder:(0,W.Z)("Title"),value:this.state.editTitle,onChange:this._onTitleChanged,onBlur:this._onEditBlur,onFocus:this._onEditFocus})}),(0,zn.jsx)(ym,{placeholder:(0,W.Z)("Address"),title:(0,W.Z)("Enter webpage address"),pageId:this._id,pageContext:this._pageContext,autocompletionEnabled:!0,typedHistoryEnabled:!1,autoFocus:!1,displayUrl:this.state.url,typedUrl:this.state.editUrl,handleDrop:!0,onBlur:this._onEditBlur,onFocus:this._onEditFocus,inputId:this._id,autoFocus:!0})]}):(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)(Mi,{ref:this.refTreeList,rowComponent:this.rowComponent,nodes:this.state.menuItems,rootId:this.state.rootId,cutIds:this.state.cutIds,enableDragAndDrop:!ei.Z.isSection(this.props.menu),validateForDrag:this._validateForDrag,validateForDeletion:this._validateForDeletion,isValidDragSource:this._isValidDragSource,getDragData:this._getDragData,setCustomEventBehavior:this._setEventBehavior,getDropSupport:this._getDropSupport,onDrop:this._onDrop,onMove:this._onMove,onCreate:this._onCreate,onEdit:this._onEdit,delete:this._onRemove,onCut:this._cut,onCopy:this._copy,onPaste:this._paste,hasChildren:this._hasChildren,isFolder:this._isFolder,appendContextItems:!0,getContextMenuItems:this._getContextMenuItems,getContextMenuItemProps:this._getContextMenuItemProps,getContextMenuNewItemString:this._getContextMenuNewItemString,getTitle:this._getTitle,saveTitle:this._saveTitle,supportsInlineEdit:!0,supportsUpDownMove:this._supportsUpDownMove,isValidToEdit:this._validateForRename}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)("input",{type:"button",onClick:this.props.confirmReset,value:(0,W.Z)("Restore Default Menu")})})]}):null}}const DI=MI,OI={width:400,minWidth:"unset"};class jI extends Un.Component{refMenuTree=Un.createRef();constructor(e){super(e);const t="top"===this.props.menuDisplay?"menubar":"vivaldi";this.state={menu:t,confirmation:!1}}_onMenuChange=e=>{this.setState({menu:e.target.value})};_handleResetMenu=()=>{re.Z.menuContent.reset(this.state.menu,ei.Z.hasName(this.state.menu),void 0,(()=>{})),this.closeConfirmation()};_canAddToTree=()=>Boolean(this.refMenuTree.current?.getSelectedItem());_addToTree=(e,t)=>{const s=this.refMenuTree.current,n=s?.getSelectedItem();s&&n&&s.addToNode(n,t,!0)};confirmReset=()=>this.setState({confirmation:!0});closeConfirmation=()=>this.setState({confirmation:!1});getMenuName=e=>{if(e||(e=this.state.menu),ei.Z.hasName(e))return ei.Z.getName(e);switch(e){case"vivaldi":return(0,W.Z)("Vivaldi Button Menu");case"menubar":return(0,W.Z)("Horizontal Menu");case"mac":return(0,W.Z)("Application Menu");default:return e}};renderModal=()=>{const e=this.getMenuName();return(0,zn.jsxs)(Ha.Z,{style:OI,onRequestClose:this.closeConfirmation,className:"anchor slide",title:(0,W.Z)("Reset $1?",[e]),children:[(0,zn.jsx)("div",{className:"dialog-content",children:(0,zn.jsx)("p",{children:(0,W.Z)("$1 will be reset to its default state.",[e])})}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"button",className:"primary",onClick:this._handleResetMenu,value:(0,W.Z)("Reset to Default"),autoFocus:!0}),(0,zn.jsx)("input",{type:"button",onClick:this.closeConfirmation,value:(0,W.Z)("Cancel")})]})]})};_getOptionItems=()=>[...["vivaldi","menubar"].map((e=>({key:e,indent:1,name:this.getMenuName(e)}))),...ei.Z.getSettingsList()];render(){const e=this._getOptionItems().map((e=>0===e.indent?(0,zn.jsx)("optgroup",{label:e.name},e.key):(0,zn.jsxs)("option",{value:e.key,children:[" ".repeat(2*e.indent),e.name]},e.key)));return(0,zn.jsxs)(tb.Z,{filter:this.props.filter,children:[this.state.confirmation&&this.renderModal(),(0,zn.jsxs)("div",{className:"setting-single pad-top",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Menu Customization")}),(0,zn.jsx)(Fa.Z,{className:"menu-list",value:this.state.menu,onChange:this._onMenuChange,children:e})]}),(0,zn.jsxs)("div",{className:"menu-lists",children:[(0,zn.jsx)("div",{className:"setting-single menu-commands",children:(0,zn.jsx)("h3",{children:(0,W.Z)("Content")})}),(0,zn.jsx)("div",{className:"setting-single menu-commands",children:(0,zn.jsx)("h3",{children:(0,W.Z)("Commands")})}),(0,zn.jsx)("div",{className:"setting-single menu-items",children:(0,zn.jsx)(DI,{ref:this.refMenuTree,menu:this.state.menu,confirmReset:this.confirmReset,filter:this.props.filter})}),(0,zn.jsx)("div",{className:"setting-single menu-commands",children:(0,zn.jsx)(NI,{canAddToTree:this._canAddToTree,addToTree:this._addToTree,menu:this.state.menu,filter:this.props.filter})})]})]})}}const LI=jI,RI=[Z.kMenuDisplay,Z.kMenuIconType],BI=I.Z.getEventHandler;var FI=(0,zn.jsx)("input",{type:"radio",value:"vivaldi"}),WI=(0,zn.jsx)("input",{type:"radio",value:"top"}),UI=(0,zn.jsx)("input",{type:"radio",value:"icon"}),VI=(0,zn.jsx)("input",{type:"radio",value:"burger"});function HI(e){const t=(0,Eo.Z)(RI);return(0,zn.jsxs)(Vy.Z,{categoryTitle:(0,W.Z)("Menu"),filter:e.filter,children:[(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("title","Menu Position")}),(0,zn.jsxs)(To.Z,{name:"menuPosition",value:t[Z.kMenuDisplay],onChange:BI(Z.kMenuDisplay),className:"group",children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[FI,(0,zn.jsx)("span",{children:(0,W.Z)("menu","Vivaldi Button")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[WI,(0,zn.jsx)("span",{children:(0,W.Z)("menu","Horizontal")})]})})]})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Menu Icon Style")}),(0,zn.jsxs)(To.Z,{name:"menuStyle",value:t[Z.kMenuIconType],onChange:BI(Z.kMenuIconType),className:"group",children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[UI,(0,zn.jsx)("span",{children:(0,W.Z)("Vivaldi Icon")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[VI,(0,zn.jsx)("span",{children:(0,W.Z)("Menu Icon")})]})})]})]}),(0,zn.jsx)(LI,{menuDisplay:"vivaldi",filter:e.filter})]})}const GI=Un.memo(HI),KI=[...RI,...fI.FI],zI=async()=>(await re.Z.menuContent.resetAll(!1),await re.Z.menuContent.resetAll(!0),Promise.resolve());function $I({filter:e,category:t}){const s=nI({filter:e,prefPaths:KI,name:t.title,onReset:zI});return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsx)(fI.ZP,{filter:e})}),(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsx)(GI,{filter:e})}),s]})}const YI=Un.memo($I),XI=[Z.kWelcomeReadPages];class QI extends Un.Component{resetSeen=()=>{I.Z.set(Z.kWelcomeReadPages,[])};render(){const e=this.props.prefValues[Z.kWelcomeReadPages].length>0;return(0,zn.jsx)(tb.Z,{filter:this.props.filter,children:(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Welcome Page")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)("label",{children:(0,zn.jsx)("input",{type:"button",disabled:!e,value:(0,W.Z)("Reset Welcome Page"),onClick:this.resetSeen})})})]})})}}const qI=(0,zd.Z)(QI,XI),JI=[Z.kBiscuitLoadBookmarks,Z.kBiscuitLogLevel,Z.kBiscuitLogRockerGestures,Z.kBiscuitVersion,Z.kBiscuitRainbowProgress,Z.kBiscuitLogComponents,Z.kBiscuitPromote,Z.kStartupActiveDays,Z.kStartupShareVivaldiLastSeenVersion,Z.kStartpageSpeedDialTrackerSuggestionShow],eA=I.Z.getEventHandler;var tA=(0,zn.jsx)("h2",{children:"Biscuit Area 🐶"}),sA=(0,zn.jsx)("h3",{children:"Biscuit Mode"}),nA=(0,zn.jsx)("span",{children:"Enable Rainbow Mode 🌈"}),iA=(0,zn.jsx)("span",{children:"Show Browser Version on Status Bar"}),aA=(0,zn.jsx)("span",{children:"Upgrade Bookmarks Every Startup"}),oA=(0,zn.jsx)("span",{children:"Show “Support Us” Search Dialog"}),rA=(0,zn.jsx)("span",{children:"Log Rocker Gestures"}),lA=(0,zn.jsx)("span",{children:"Show Promote Button"}),dA=(0,zn.jsx)("h3",{children:"Logging"}),cA=(0,zn.jsx)("div",{children:"Log Level"}),hA=(0,zn.jsx)("option",{value:"debug",children:"Debug"}),uA=(0,zn.jsx)("option",{value:"info",children:"Info"}),pA=(0,zn.jsx)("option",{value:"warn",children:"Warn"}),gA=(0,zn.jsx)("option",{value:"error",children:"Error"}),mA=(0,zn.jsx)("option",{value:"none",children:"None"}),fA=(0,zn.jsx)("h3",{children:"Log Components"}),vA=(0,zn.jsx)("h3",{children:"Modify preferences for testing"}),bA=(0,zn.jsx)("h3",{children:"Show Context Dialog"}),CA=(0,zn.jsx)("option",{value:"EnableMailContextDialog",children:"Mail"}),wA=(0,zn.jsx)("option",{value:"EnableCalendarContextDialog",children:"Calendar"}),yA=(0,zn.jsx)("option",{value:"EnableSyncContextDialog",children:"Sync"}),xA=(0,zn.jsx)("option",{value:"CreateWorkspaceContextDialog",children:"Workspace"}),IA=(0,zn.jsx)("h3",{children:"Reset All Context Dialogs"}),AA=(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)("input",{type:"button",onClick:function(){Ne.resetAll()},value:"Reset All Context Dialogs"})}),SA=(0,zn.jsx)(qI,{filter:""});function ZA(e){const t=(0,Eo.Z)(JI),[s,n]=Un.useState("EnableMailContextDialog");return["🐶","biscuit","🌈","🏳️‍🌈"].includes(e.filter)?(0,zn.jsxs)("div",{className:"biscuit-area",children:[tA,(0,zn.jsxs)("div",{className:"setting-group-double",children:[sA,(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kBiscuitRainbowProgress],onChange:eA(Z.kBiscuitRainbowProgress)}),nA]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kBiscuitVersion],onChange:eA(Z.kBiscuitVersion)}),iA]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kBiscuitLoadBookmarks],onChange:eA(Z.kBiscuitLoadBookmarks)}),aA]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kStartpageSpeedDialTrackerSuggestionShow],onChange:eA(Z.kStartpageSpeedDialTrackerSuggestionShow)}),oA]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kBiscuitLogRockerGestures],onChange:eA(Z.kBiscuitLogRockerGestures)}),rA]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kBiscuitPromote],onChange:eA(Z.kBiscuitPromote)}),lA]})}),dA,(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{style:{alignItems:"center"},children:[cA,(0,zn.jsxs)(Fa.Z,{value:t[Z.kBiscuitLogLevel],onChange:eA(Z.kBiscuitLogLevel),children:[hA,uA,pA,gA,mA]})]})}),fA,(0,zn.jsx)("div",{className:"setting-single",children:Object.entries(t[Z.kBiscuitLogComponents]).map((e=>{const[s,n]=e;return(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:n,onChange:e=>{const n={...t[Z.kBiscuitLogComponents],[s]:e.target.checked};I.Z.set(Z.kBiscuitLogComponents,n)}}),(0,zn.jsx)("span",{children:s})]})},s)}))}),vA,(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)("label",{children:(0,zn.jsx)("input",{type:"button",onClick:()=>{const e=Date.now(),t=e-be.S;I.Z.set(Z.kStartupActiveDays,[...Array(3).fill(e),...Array(3).fill(t)])},value:"Apply fake active days for D3D7 marketing"})})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)("label",{children:(0,zn.jsx)("input",{type:"button",onClick:()=>{I.Z.reset(Z.kStartupShareVivaldiLastSeenVersion)},value:"Clear 'Share Vivaldi Last Seen Version'"})})}),bA,(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)(Fa.Z,{value:s,onChange:e=>{ye(e.target.value)&&n(e.target.value)},children:[CA,wA,yA,xA]}),(0,zn.jsx)("input",{type:"button",onClick:()=>Ne.show(s,!0),value:"Trigger Context Dialog"})]}),IA,AA]}),SA]}):null}const TA=Un.memo(ZA),EA=[Z.kBookmarksBarDisplay,Z.kBookmarksBarPosition,Z.kBookmarksBarVisible],kA=I.Z.getEventHandler;var NA=(0,zn.jsx)("input",{type:"radio",value:"top"}),_A=(0,zn.jsx)("input",{type:"radio",value:"bottom"}),PA=(0,zn.jsx)("input",{type:"radio",value:"default"}),MA=(0,zn.jsx)("input",{type:"radio",value:"text"}),DA=(0,zn.jsx)("input",{type:"radio",value:"icon"}),OA=(0,zn.jsx)("input",{type:"radio",value:"iconexceptfolders"});function jA(e){const t=(0,Eo.Z)(EA);return(0,zn.jsxs)(Vy.Z,{categoryTitle:(0,W.Z)("Bookmark Bar"),filter:e.filter,children:[(0,zn.jsx)("div",{className:"setting-group unlimited",children:(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kBookmarksBarVisible],onChange:kA(Z.kBookmarksBarVisible)}),(0,zn.jsx)("span",{children:(0,W.Z)("Show Bookmark Bar")})]})})}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Select Bookmark Bar Folder")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(Va,{onChange:e=>{ne.Z.setBookmarkBarFolder(e.target.value)}})})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Bookmark Bar Position")}),(0,zn.jsxs)(To.Z,{name:"bookmark-position",value:t[Z.kBookmarksBarPosition],onChange:kA(Z.kBookmarksBarPosition),children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[NA,(0,zn.jsx)("span",{children:(0,W.Z)("Top")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[_A,(0,zn.jsx)("span",{children:(0,W.Z)("Bottom")})]})})]})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Bookmark Bar Display")}),(0,zn.jsxs)(To.Z,{name:"bookmark_bar_display",value:t[Z.kBookmarksBarDisplay],onChange:kA(Z.kBookmarksBarDisplay),children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[PA,(0,zn.jsx)("span",{children:(0,W.Z)("Text and Icon")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[MA,(0,zn.jsx)("span",{children:(0,W.Z)("radio","Text Only")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[DA,(0,zn.jsx)("span",{children:(0,W.Z)("Icon Only")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[OA,(0,zn.jsx)("span",{children:(0,W.Z)("Bookmark Icon Only")})]})})]})]})]})}const LA=Un.memo(jA),RA=[Z.kBookmarksConfirmAdding,Z.kBookmarksConfirmOpening,Z.kBookmarksConfirmOpeningThreshold,Z.kBookmarksFetchPageMetadata,Z.kBookmarksOpenInNewTab,Z.kBookmarksSingleClickOpens,Z.kBookmarksUnderlineMenuLetter],BA=I.Z.getEventHandler;function FA(e){const t=(0,Eo.Z)(RA);return(0,zn.jsx)(Vy.Z,{categoryTitle:(0,W.Z)("Bookmarks"),filter:e.filter,children:(0,zn.jsxs)("div",{className:"setting-group unlimited",children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kBookmarksOpenInNewTab],onChange:BA(Z.kBookmarksOpenInNewTab)}),(0,zn.jsx)("span",{children:(0,W.Z)("Open Bookmarks in New Tab")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kBookmarksSingleClickOpens],onChange:BA(Z.kBookmarksSingleClickOpens)}),(0,zn.jsx)("span",{children:(0,W.Z)("Open Bookmark Panel Items with Single Click")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kBookmarksUnderlineMenuLetter],onChange:BA(Z.kBookmarksUnderlineMenuLetter)}),(0,zn.jsx)("span",{children:(0,W.Z)("Use “&” in Title to Underline Next Letter in Menus")})]})}),(0,zn.jsxs)("div",{className:"setting-single max-bookmarks",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kBookmarksConfirmOpening],onChange:BA(Z.kBookmarksConfirmOpening)}),(0,zn.jsx)("span",{children:(0,W.Z)("Confirm Opening Bookmarks over Maximum of")})]}),(0,zn.jsx)("input",{type:"number",size:"2",disabled:!t[Z.kBookmarksConfirmOpening],value:t[Z.kBookmarksConfirmOpeningThreshold],onChange:BA(Z.kBookmarksConfirmOpeningThreshold),min:1,max:99})]}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(iI.C,{text:(0,W.Z)("Fetch Bookmark Data from Page Metadata"),children:(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kBookmarksFetchPageMetadata],onChange:BA(Z.kBookmarksFetchPageMetadata)})})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(iI.C,{text:(0,W.Z)("Always Open Bookmark Dialog"),children:(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kBookmarksConfirmAdding],onChange:BA(Z.kBookmarksConfirmAdding)})})})]})})}const WA=Un.memo(FA),UA=[...EA,...RA];function VA({filter:e,category:t}){const s=nI({filter:e,prefPaths:UA,name:t.title});return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("section",{className:"setting-section",children:[(0,zn.jsx)(WA,{filter:e}),(0,zn.jsx)(LA,{filter:e})]}),s]})}const HA=Un.memo(VA);var GA=s(34155);const KA=[Z.kFeaturesMail,Z.kFeaturesFeeds];var zA=(0,zn.jsx)("input",{type:"radio",value:"feeds",onClick:function(){wt.Z.ensureMailIsOff(),GA.nextTick(wt.Z.ensureFeedsIsOn)}});function $A(e){const t=(0,Eo.Z)(KA),s=t[Z.kFeaturesMail],n=t[Z.kFeaturesFeeds];return(0,zn.jsx)(Vy.Z,{categoryTitle:e.categoryTitle||(0,W.Z)("Productivity Features"),filter:e.filter,"data-anchor":"features",children:(0,zn.jsx)(tb.Z,{filter:e.filter,children:(0,zn.jsxs)("div",{className:"setting-group unlimited",children:[e.inform&&!n&&(0,zn.jsx)("h3",{children:(0,W.Z)("Mail, Calendar and Feeds are Turned Off")}),(0,zn.jsxs)(To.Z,{name:"productivityFeatures",value:s?"all":n?"feeds":"none",onChange:nr.Z,children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"radio",value:"none",onClick:wt.Z.ensureMailIsOff}),(0,zn.jsx)("span",{children:(0,W.Z)("Turn off Mail, Calendar and Feeds")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"radio",value:"all",onClick:wt.Z.ensureMailIsOn}),(0,zn.jsx)("span",{children:(0,W.Z)("Enable Mail, Calendar and Feeds")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[zA,(0,zn.jsx)("span",{children:(0,W.Z)("Enable Feeds")})]})})]})]})})})}const YA=Un.memo($A);var XA=s(25201),QA=s(88545);const{isCalDAV:qA,isOAuthProvider:JA}=_r.ZP,{UNKNOWN:eS,VERIFYING:tS,OK:sS,ERROR:nS}=be.LB;class iS extends Un.Component{constructor(e){super(e),this.state={status:eS,statusText:"",password:"",passwordChanged:!1,name:e.account.name,username:e.account.username,url:e.account.url,refreshing:!1}}componentDidMount=()=>{const{url:e,username:t}=this.state;e&&t&&(0,XA.Ij)({url:e,username:t}).then((e=>{e.found&&this.setState({password:e.password})}))};probeAccounts=async()=>{const{account:e}=this.props,{account_type:t}=e,{password:s}=this.state;let n={foundService:!1,statusMessage:"",calendars:[],eventCount:0};if(this.logStatus((0,W.Z)("Verifying..."),tS),"ical"===t){n=await Hr.Z.probeWebCalendar(this.getAccount(),s);const{foundService:e,eventCount:t}=n;if(e)return this.logStatus((0,W.Z)("Connected to Web Calendar. Found $1 Event(s)",[t]),sS),e}else if(JA(t))n=await(0,QA.P)(this.getAccount(),s);else{if(!this.state.password)return this.logStatus((0,W.Z)("Password Missing..."),nS),!1;n=await(0,QA.P)(this.getAccount(),s)}return n.foundService?(this.logStatus((0,W.Z)("Connected to CalDAV. Found $1 Calendar(s)",[n.calendars.length]),sS),Pc.Z.resetStatus(this.props.account.name)):this.logStatus((0,W.Z)("Not connected. $1",[n.statusMessage||""]),nS),n.foundService};savePasswordIfNeeded=e=>{const{account_type:t}=this.props.account,{username:s,password:n,url:i}=this.state,{urlValid:a}=re.Z.utilities.isUrlValid(i);if(e&&(0,XA.QN)({url:i,username:s}),a){if(["caldav","vivaldi"].includes(t)||"ical"===t&&s.trim())try{this.logStatus("",eS),(0,XA.vW)({url:i,username:s},n)}catch(e){this.logStatus(e.message,nS)}}else this.logStatus((0,W.Z)("Invalid URL"),tS)};isAccountChanged=()=>this.state.name!==this.props.account.name||this.state.username!==this.props.account.username||this.state.url!==this.props.account.url||this.state.passwordChanged;onChangeCredentials=e=>{const t=e.target.value;this.setState({password:t,passwordChanged:!0,status:eS},(()=>this.savePasswordIfNeeded(!1)))};getAccount=()=>({id:this.props.account.id,name:this.state.name,username:this.state.username,url:this.state.url,account_type:this.props.account.account_type});logStatus=(e,t)=>{this.setState({status:t,statusText:e})};saveAccount=async()=>{let e=!0;const{account_type:t}=this.props.account;"local"!==t&&(e=await this.probeAccounts()),this.setState({passwordChanged:!1},(()=>{e&&this.props.saveAccount(this.getAccount())}))};changeName=e=>{const t=e.target.value;this.setState({name:t})};changeUrl=e=>{const t=e.target.value;t!==this.state.url&&this.setState({url:t},(()=>this.savePasswordIfNeeded(!0)))};changeUsername=e=>{const t=e.target.value;if(t!==this.state.username){const{url:e,username:s}=this.state;(0,XA.QN)({url:e,username:s}),this.setState({username:t},(()=>this.savePasswordIfNeeded(!0)))}};render(){const{name:e,url:t,account_type:s,username:n}=this.getAccount(),{password:i}=this.state,a=this.state.status===nS?"error":this.state.status===sS?"success":"info",o=["caldav","ical"].includes(s)||"vivaldi"===s&&i;return(0,zn.jsxs)("form",{className:"detail",onSubmit:this.saveAccount,children:[(0,zn.jsxs)("div",{className:"detail-content",children:[(0,zn.jsx)("div",{className:"setting-group",children:(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(Vr.Z,{type:"text",onChange:this.changeName,label:this.props.searchableStrings["Display Name"],value:e})})}),"local"!==s&&(0,zn.jsx)("div",{className:"setting-group",children:(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(Vr.Z,{type:"text",onChange:this.changeUrl,label:this.props.searchableStrings.URL,value:t})})}),(qA(s)||"ical"===s)&&(0,zn.jsx)("div",{className:"setting-group",children:(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(Vr.Z,{type:"text",onChange:this.changeUsername,name:"username",label:this.props.searchableStrings.Username,value:n})})}),o&&(0,zn.jsx)("div",{className:"setting-group",children:(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(Vr.Z,{type:"password",onChange:this.onChangeCredentials,name:"password",label:this.props.searchableStrings.Password,value:i})})}),this.state.statusText&&(0,zn.jsx)("div",{className:"setting-group-double",children:(0,zn.jsx)(fa,{type:a,children:this.state.statusText})})]}),(0,zn.jsxs)("div",{className:"detail-toolbar",children:[(0,zn.jsx)("input",{type:"submit",value:(0,W.Z)("Save"),disabled:!this.isAccountChanged()}),"local"!==s&&(0,zn.jsx)("input",{type:"button",onClick:this.probeAccounts,value:(0,W.Z)("Test")})]})]})}}const aS=iS,{startDeletingAccount:oS}=Mr.Z,{prepareForDeleteAccount:rS}=Pc.Z;const lS=function(e){const[t,s]=Un.useState(""),[n,i]=Un.useState([]),[a,o]=Un.useState(!1),{item:r,onClose:l,onDeleteInProgress:d}=e,c=async e=>{try{await oS(e)}catch(e){i(Jl([e]))}finally{s(""),d(!1)}},h=t===r.id,u="local"===r?.account_type;return(0,zn.jsxs)("div",{children:[(0,zn.jsx)("header",{className:"dialog-header",children:(0,zn.jsx)("h1",{className:"dialog-title",children:(0,W.Z)("Are you sure you want to remove the account ‘$1’ and its events?",[r.name])})}),(0,zn.jsxs)("div",{className:"dialog-content",children:["local"===r.account_type&&(0,zn.jsx)("p",{className:"faded-text",children:(0,W.Z)("This will permanently delete your local calendars and associated events. It can not be undone.")}),"local"!==r.account_type&&(0,zn.jsx)("p",{className:"faded-text",children:(0,W.Z)("This will not delete any data on the remote server. You can set it up again if you later want to use it in Vivaldi.")}),u&&(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:a,onChange:e=>o(e.target.checked)}),(0,W.Z)("I understand that this will delete data permanently")]}),n.length>0&&(0,zn.jsx)(fa,{type:"error",children:n.join("")})]}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"button",className:"danger",disabled:h||u&&!a,onClick:async()=>{d(!0),s(r.id);try{"local"===r.account_type?c(r.id):await rS({accountId:r.id,onRemoval:c})}catch(e){i(Jl([e]))}finally{s(""),d(!1)}},value:h?(0,W.Z)("Removing Account"):(0,W.Z)("verb","Remove"),autoFocus:!0}),(0,zn.jsx)("input",{type:"button",onClick:l,disabled:h,value:(0,W.Z)("Cancel")})]})]})};var dS=s(74487);const cS=function(e){return Un.forwardRef((function(t,s){const n=(0,dS.Z)(Pr.Z);return(0,zn.jsx)(e,{...t,ref:s,...n})}))},{createLocalAccountAndCalendar:hS}=Mr.Z,{ensureAccountType:uS,isCalDAV:pS,ensureHttpsForWebcal:gS}=_r.ZP,{UNKNOWN:mS,VERIFYING:fS,OK:vS,ERROR:bS}=be.LB;function CS(e){switch(e){case"vivaldi":return(0,W.Z)("user@vivaldi.net");case"google":return(0,W.Z)("user@gmail.com");case"fastmail":return(0,W.Z)("user@fastmail.com");case"icloud":return(0,W.Z)("user@icloud.com");default:return""}}function wS(e,t="vivaldi"){return{status:mS,statusText:"",name:_r.ZP.suggestNewCalendarDisplayName(t),url:"",account_type:t,username:"",password:"",step:"accountType",initial:e,requestPending:!1,calendars:[]}}var yS=(0,zn.jsx)("img",{src:"/resources/vivaldi_calendar_default.png",alt:"",width:"64",height:"64"}),xS=(0,zn.jsx)("span",{className:"info",children:"App specific password is required to connect to iCloud calendars."});class IS extends Un.Component{static contextType=oi.Z;state=wS(!0,this.props.onboarding?"local":"vivaldi");account=null;changeType=e=>{const t="icloud"===e?(0,be.Hv)():"",s="icloud"===e?"icloud":uS(e),n=_r.ZP.suggestNewCalendarDisplayName(s);s!==this.state.account_type?this.setState({name:n,account_type:s,url:t,username:"",password:""}):this.setState({name:n,account_type:s})};handleChange=e=>{const{target:{name:t,value:s}}=e;this.setState({[t]:s})};toggleCalendarState=(e,t,s)=>{this.setState((n=>{const i=[...n.calendars];return i[t]={...i[t],[s]:e.target.checked},{calendars:i}}))};selectAccountType=()=>{"local"===this.state.account_type?this.createAccount():this.setState({step:"accountInfo"})};goBack=()=>{"accountInfo"===this.state.step?this.setState({step:"accountType",statusText:"",status:mS}):"accountSummary"===this.state.step&&(this.account=null,this.setState({step:"accountInfo",calendars:[]}))};addAnother=()=>{this.account=null,this.setState(wS(!1))};createAccount=async()=>{const{name:e,account_type:t,username:s}=this.state;let n;if(pS(uS(t)))n=await this.createCalDAVAccount();else if("ical"===t)n=await this.createWebCalendar();else if("local"===t)try{({account:n}=await hS({name:e,url:"",account_type:t,username:s},null)),this.setState({step:"done"})}catch(e){this.log((0,W.Z)("Error creating local calendar.")+String(e?.message||e),bS)}n&&(this.account=n)};log=(e,t,s)=>{const n=s?{username:s.username,name:s.name}:{};this.setState({...n,statusText:e,status:t})};createWebCalendar=async()=>{this.log((0,W.Z)("Verifying..."),fS),this.setState({requestPending:!0});const{name:e,account_type:t,username:s,password:n}=this.state;let{url:i}=this.state;i.startsWith("webcal")&&(i=gS(i),this.setState({url:i}));const a={id:"",name:e,url:i,account_type:uS(t),username:s,interval:be.jC},{foundService:o,statusMessage:r,eventCount:l,calendars:d}=await Hr.Z.probeWebCalendar(a,n);return!o&&r?(this.log(r,bS),this.setState({requestPending:!1})):(this.log((0,W.Z)("Connected to Web Calendar, found $1 event(s).",[l]),vS),this.setState({step:"accountSummary",calendars:d,requestPending:!1})),a};createCalDAVAccount=async()=>{this.log((0,W.Z)("Verifying..."),fS),this.setState({requestPending:!0});const{name:e,url:t,account_type:s,username:n,password:i}=this.state;try{const{account:a,calendars:o}=await Pc.Z.getCalDAVAccountDetails({name:e,url:t,account_type:uS(s),username:n,password:i},this.log);if(this.state.status!==bS){for(const e of o)e.active=!0;this.account=a,this.setState({step:"accountSummary",calendars:o,requestPending:!1})}else this.setState({requestPending:!1})}catch(e){this.setState({requestPending:!1})}};saveAccount=async()=>{const e=this.account;if(e&&"local"!==e.account_type){"icloud"===e.account_type&&(e.account_type="caldav"),this.setState({requestPending:!0});try{await Pc.Z.saveCalendarAccount({account:e,calendars:this.state.calendars,password:this.state.password},this.log),this.setState({requestPending:!0,step:"done"})}catch(e){this.setState({requestPending:!1}),this.log(e.message,bS)}}};render(){const{name:e,url:t,account_type:s,username:n}=this.state,{password:i}=this.state,a=["vivaldi","fastmail","google","icloud","caldav","ical"];(!Mr.Z.getLocalAccount()||this.props.onboarding&&this.state.initial)&&a.unshift("local");const o=this.state.status===bS?"error":this.state.status===vS?"success":"info";let r;if("accountInfo"===this.state.step)switch(this.state.account_type){case"vivaldi":r=(0,W.Z)("Vivaldi.net account, OK - now enter your login details below and let us fetch your calendars.");break;case"icloud":r=(0,W.Z)("iCloud account, OK - now enter your username and app specific password below and let us fetch your calendars.");break;case"caldav":r=(0,W.Z)("CalDAV account, OK - now enter the server URL and your login details below and let us fetch your calendars.");break;case"google":r=(0,W.Z)("Google account, OK - now enter your username below and then log in using the google dialog shown.");break;case"ical":r=(0,W.Z)("Web calendar, OK - now enter the calendar URL below and let us fetch your events.")}return(0,zn.jsxs)(zn.Fragment,{children:["accountType"===this.state.step&&(0,zn.jsxs)("form",{className:"detail",onSubmit:this.selectAccountType,children:[(0,zn.jsxs)("div",{className:"detail-content",children:[this.props.onboarding&&(0,zn.jsxs)(zn.Fragment,{children:[yS,this.state.initial&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("h1",{children:(0,W.Z)("Welcome to Vivaldi Calendar")}),(0,zn.jsx)("p",{children:(0,W.Z)("Let’s get you going by adding your first account.")})]}),!this.state.initial&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("h1",{children:(0,W.Z)("Vivaldi Calendar")}),(0,zn.jsx)("p",{children:(0,W.Z)("Great, let’s add another account.")})]})]}),!this.props.onboarding&&(0,zn.jsx)("p",{children:(0,W.Z)("Select account type to add.")}),(0,zn.jsx)("div",{className:"toolbar toolbar-pills toolbar-wrap",children:a.map((e=>(0,zn.jsx)(oa.ZP,{isPressed:e===this.state.account_type,title:this.props.searchableStrings[e],onClick:()=>this.changeType(e)},e)))})]}),(0,zn.jsx)("div",{className:"detail-toolbar",children:(0,zn.jsx)("input",{type:"submit",value:(0,W.Z)("Continue"),autoFocus:!0})})]}),"accountInfo"===this.state.step&&(0,zn.jsxs)("form",{className:"detail",onSubmit:this.createAccount,children:[(0,zn.jsxs)("div",{className:"detail-content",children:[this.props.onboarding&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("h1",{children:(0,W.Z)("Add Your First Calendar Account")}),(0,zn.jsx)("p",{children:r})]}),(0,zn.jsxs)("div",{className:"setting-group unlimited",children:[(0,zn.jsx)("div",{className:"setting-group",children:(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(Vr.Z,{type:"text",name:"name",onChange:this.handleChange,label:this.props.searchableStrings["Display Name"],value:e,autoFocus:!0})})}),["caldav","ical"].includes(s)&&(0,zn.jsx)("div",{className:"setting-group",children:(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(Vr.Z,{type:"text",name:"url",onChange:this.handleChange,label:this.props.searchableStrings.URL,value:t})})})]}),(pS(uS(s))||"ical"===s)&&(0,zn.jsxs)("div",{className:"setting-group unlimited",children:[(0,zn.jsx)("div",{className:"setting-group",children:(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(Vr.Z,{type:"text",name:"username",onChange:this.handleChange,label:this.props.searchableStrings.Username,value:n,placeholder:CS(s)})})}),["caldav","ical","icloud"].includes(s)&&(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(Vr.Z,{type:"password",name:"password",onChange:this.handleChange,label:this.props.searchableStrings.Password,value:i})}),"icloud"===s&&xS]})]}),this.state.statusText&&(0,zn.jsx)("div",{className:"setting-group-double",children:(0,zn.jsx)(fa,{type:o,children:this.state.statusText})})]}),(0,zn.jsxs)("div",{className:"detail-toolbar",children:[(0,zn.jsx)("input",{type:"submit",disabled:pS(uS(s))&&!n||this.state.requestPending,value:(0,W.Z)("Add Account")}),(0,zn.jsx)("input",{type:"button",disabled:this.state.requestPending,onClick:this.goBack,value:(0,W.Z)("navigation","Back")})]})]}),"accountSummary"===this.state.step&&(0,zn.jsxs)("form",{className:"detail",onSubmit:this.saveAccount,children:[(0,zn.jsxs)("div",{className:"detail-content",children:[this.state.calendars.length>0&&(0,zn.jsxs)(zn.Fragment,{children:[this.props.onboarding&&(0,zn.jsx)(zn.Fragment,{children:(0,zn.jsx)("h1",{children:(0,W.Z)("Calendar Visibility and Syncing")})}),(0,zn.jsx)("p",{children:(0,W.Z)("We found the following calendars:")}),(0,zn.jsxs)("table",{children:[(0,zn.jsx)("thead",{children:(0,zn.jsxs)("tr",{children:[(0,zn.jsx)("td",{children:(0,W.Z)("Calendar")}),(0,zn.jsx)("td",{children:(0,W.Z)("Sync")}),(0,zn.jsx)("td",{children:(0,W.Z)("show","Hide")})]})}),(0,zn.jsx)("tbody",{children:this.state.calendars.map(((e,t)=>(0,zn.jsxs)("tr",{children:[(0,zn.jsx)("td",{children:e.description||e.name}),(0,zn.jsx)("td",{children:(0,zn.jsx)("input",{type:"checkbox",onChange:e=>this.toggleCalendarState(e,t,"active"),checked:e.active})}),(0,zn.jsx)("td",{children:(0,zn.jsx)("input",{type:"checkbox",onChange:e=>this.toggleCalendarState(e,t,"hidden"),checked:e.hidden})})]},e.name||e.description||e.ctag)))})]})]}),0===this.state.calendars.length&&(0,zn.jsx)("p",{children:(0,W.Z)("No calendars found. Check that your credentials are correct and your calendar service has calendars configured.")}),this.state.statusText&&this.state.status===bS&&(0,zn.jsx)("div",{className:"setting-group-double",children:(0,zn.jsx)(fa,{type:o,children:this.state.statusText})})]}),(0,zn.jsxs)("div",{className:"detail-toolbar",children:[(0,zn.jsx)("input",{type:"submit",disabled:this.state.requestPending,value:(0,W.Z)("Save Account")}),(0,zn.jsx)("input",{type:"button",disabled:this.state.requestPending,onClick:this.goBack,value:(0,W.Z)("navigation","Back")})]})]}),"done"===this.state.step&&(0,zn.jsxs)("form",{className:"detail",onSubmit:this.props.showTips,children:[(0,zn.jsxs)("div",{className:"detail-content",children:[this.props.onboarding&&(0,zn.jsx)(zn.Fragment,{children:(0,zn.jsx)("span",{className:"ShowMailTipsAndTricks-allSetIcon",dangerouslySetInnerHTML:{__html:Kn.mXV}})}),(0,zn.jsx)("h1",{children:(0,W.Z)("Great, You’re All Set!")}),"local"===this.account?.account_type&&(0,zn.jsx)("p",{children:(0,W.Z)("If you want to add more local calendars use the calendar list in settings.")}),this.props.onboarding&&(0,zn.jsx)("p",{children:(0,W.Z)("Where to next?")})]}),(0,zn.jsxs)("div",{className:"detail-toolbar",children:[(0,zn.jsx)("input",{type:"submit",value:(0,W.Z)("Show Tips and Tricks")}),(0,zn.jsx)("input",{type:"button",onClick:this.addAnother,value:(0,W.Z)("Add Another Account")}),this.props.onboarding&&(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Open Vivaldi Calendar"),onClick:()=>{ue.Z.showCalendar(this.context.vivaldiWindowId),this.props.done?.()}}),!this.props.onboarding&&(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("calendar","Done"),onClick:()=>{this.props.done?.()}})]})]})]})}}const AS=IS;var SS=s(76632);class ZS extends Un.PureComponent{faviconStyle=this.props.isCreating?{opacity:.3}:{};render(){let e=this.props.iconPath;return"gmail.com"===e?e="https://ssl.gstatic.com/ui/v1/icons/mail/images/favicon5.ico":"googleusercontent.com"===e?e="https://google.com/favicon.ico":"fastmail.com"===e?e="https://www.fastmail.com/favicon.svg":e&&(e=(0,Vn.rv)(e)),(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)(Vn.ZP,{size:32,className:"item-icon",url:e?(0,Ar.q9)(e):this.props.iconFallbackPath,fallbackUrl:this.props.iconFallbackPath,loadType:"faviconSkipCache",style:this.faviconStyle}),(0,zn.jsx)("div",{className:"item-title",children:this.props.title}),(0,zn.jsx)("div",{className:"item-meta",children:this.props.meta})]})}}const TS=ZS,ES=["editor","density","help"];function kS(e){const[t,n]=Un.useState(A.Z.get(Z.kCalendarEditMode));return(0,zn.jsxs)(zn.Fragment,{children:[e.onboarding&&(0,zn.jsx)("h3",{children:(0,W.Z)("Calendar Settings")}),(0,zn.jsx)("h1",{children:(0,W.Z)("Adding Events")}),(0,zn.jsx)("p",{children:(0,W.Z)("We’re all about choice. By default, we add and edit events inline, right inside the calendar without any popups.")}),(0,zn.jsxs)("div",{className:"ShowCalendarTipsAndTricks-Selectbox",children:[(0,zn.jsxs)("button",{className:Gn()("selectbox",{"selectbox-selected":"inline"===t}),onClick:function(){n("inline"),I.Z.set(Z.kCalendarEditMode,"inline")},type:"button",children:[(0,zn.jsxs)("div",{className:"selectbox-image",children:[(0,zn.jsx)("span",{className:"onboarding-iillustration",dangerouslySetInnerHTML:{__html:s(36502)}}),(0,zn.jsx)("div",{dangerouslySetInnerHTML:{__html:Kn.D7r.medium}})]}),(0,zn.jsx)("div",{className:"selectbox-title",children:(0,W.Z)("Inline Editor")})]}),(0,zn.jsxs)("button",{className:Gn()("selectbox",{"selectbox-selected":"popup"===t}),onClick:function(){n("popup"),I.Z.set(Z.kCalendarEditMode,"popup")},type:"button",children:[(0,zn.jsxs)("div",{className:"selectbox-image",children:[(0,zn.jsx)("span",{className:"onboarding-iillustration",dangerouslySetInnerHTML:{__html:s(46647)}}),(0,zn.jsx)("div",{dangerouslySetInnerHTML:{__html:Kn.D7r.medium}})]}),(0,zn.jsx)("div",{className:"selectbox-title",children:(0,W.Z)("Dialog Editor")})]})]})]})}function NS(e){const[t,n]=Un.useState(A.Z.get(Z.kCalendarDisplayDensity));return(0,zn.jsxs)(zn.Fragment,{children:[e.onboarding&&(0,zn.jsx)("h3",{children:(0,W.Z)("Calendar Settings")}),(0,zn.jsx)("h1",{children:(0,W.Z)("Calendar Density")}),(0,zn.jsx)("p",{children:(0,W.Z)("We can show you all the details from an event right in the calendar, or just the title. It’s up to you.")}),(0,zn.jsxs)("div",{className:"ShowCalendarTipsAndTricks-Selectbox",children:[(0,zn.jsxs)("button",{className:Gn()("selectbox",{"selectbox-selected":"full"===t}),onClick:function(){n("full"),I.Z.set(Z.kCalendarDisplayDensity,"full")},type:"button",children:[(0,zn.jsxs)("div",{className:"selectbox-image",children:[(0,zn.jsx)("span",{className:"onboarding-iillustration",dangerouslySetInnerHTML:{__html:s(87922)}}),(0,zn.jsx)("div",{dangerouslySetInnerHTML:{__html:Kn.D7r.medium}})]}),(0,zn.jsx)("div",{className:"selectbox-title",children:(0,W.Z)("Full Details")})]}),(0,zn.jsxs)("button",{className:Gn()("selectbox",{"selectbox-selected":"minimal"===t}),onClick:function(){n("minimal"),I.Z.set(Z.kCalendarDisplayDensity,"minimal")},type:"button",children:[(0,zn.jsxs)("div",{className:"selectbox-image",children:[(0,zn.jsx)("span",{className:"onboarding-iillustration",dangerouslySetInnerHTML:{__html:s(18767)}}),(0,zn.jsx)("div",{dangerouslySetInnerHTML:{__html:Kn.D7r.medium}})]}),(0,zn.jsx)("div",{className:"selectbox-title",children:(0,W.Z)("Title Only")})]})]})]})}function _S(e){return(0,zn.jsxs)(zn.Fragment,{children:[e.onboarding&&(0,zn.jsx)("h3",{children:(0,W.Z)("Calendar Help")}),(0,zn.jsx)("h1",{children:(0,W.Z)("Get All the Help You Need")}),(0,zn.jsxs)("div",{className:"ShowCalendarTipsAndTricks-WithImage",children:[(0,zn.jsx)("span",{className:"onboarding-iillustration",dangerouslySetInnerHTML:{__html:Kn.Kuf}}),(0,zn.jsxs)("div",{className:"ShowCalendarTipsAndTricks-TextBlock",children:[(0,zn.jsx)("p",{children:(0,W.Z)("Want more tips and tricks? Our Help pages contain all the documentation you need.")}),(0,zn.jsx)("p",{children:(0,zn.jsx)("a",{onClick:()=>c.ZP.openURL(e.windowId,"https://help.vivaldi.com/calendar/"),children:(0,W.Z)("Visit our Help pages for Calendar.")})})]})]})]})}function PS(e){const[t,s]=Un.useState(ES[0]);const n=t===ES[ES.length-1];return(0,zn.jsx)("div",{className:"ShowCalendarTipsAndTricks",children:(0,zn.jsxs)("form",{className:"detail",onSubmit:function(){s(ES[ES.indexOf(t)+1])},children:[(0,zn.jsxs)("div",{className:"detail-content",children:["editor"===t&&(0,zn.jsx)(kS,{windowId:e.windowId,onboarding:e.onboarding}),"density"===t&&(0,zn.jsx)(NS,{windowId:e.windowId,onboarding:e.onboarding}),"help"===t&&(0,zn.jsx)(_S,{windowId:e.windowId,onboarding:e.onboarding})]}),(0,zn.jsxs)("div",{className:"detail-toolbar",children:[!n&&(0,zn.jsx)("input",{type:"submit",value:(0,W.Z)("Next tip")}),(0,zn.jsx)("input",{type:n?"submit":"button",value:(0,W.Z)("Open Vivaldi Calendar"),onClick:()=>{ue.Z.showCalendar(e.windowId),e?.onClose?.()}}),e.onClose&&(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("calendar","Done"),onClick:()=>{e?.onClose?.()}})]})]})})}const{isOAuthProvider:MS,ensureAccountType:DS}=_r.ZP,OS="/resources/vivaldi_calendar_default.png",jS=s(28888),LS={"Add your First Calendar Account":(0,W.Z)("Add your First Calendar Account"),"Press the “Add” button to the left to add a new Account.":(0,W.Z)("Press the “Add” button to the left to add a new Account.")},RS={...Vc.d3,icloud:(0,W.Z)("iCloud Calendar"),"Calendar Type":(0,W.Z)("Calendar Type"),"Display Name":(0,W.Z)("Display Name"),URL:(0,W.Z)("Address"),Password:(0,W.Z)("Password"),Username:(0,W.Z)("Username"),Timezone:(0,W.Z)("Timezone"),Description:(0,W.Z)("Description")};class BS extends Un.Component{static contextType=oi.Z;state={deletingAccount:"",isCreating:!1,setupStep:"setup"};#At=!1;onCreateItem=()=>{this.#At=!0,this.setState({isCreating:!0,setupStep:"setup"})};onCancelCreateItem=()=>{"setup"===this.state.setupStep?this.setState({isCreating:!1}):this.setState({isCreating:!1,setupStep:"setup"})};showTips=()=>{this.setState({setupStep:"tips"})};done=()=>{this.setState({setupStep:"setup"})};saveAccount=e=>{ie.ZP.updateAccount(e)};getFallbackIcon=e=>"caldav"===e?"/resources/calendar_caldav.png":"ical"===e?"/resources/calendar_web.png":OS;renderListItem=(e,t)=>{const s=DS(t.account_type);let n="";if(MS(s)){n=((0,ve.Z)(t.url)?.hostname||"").split(".").slice(-2).join(".")}return(0,zn.jsx)(TS,{title:t.name,meta:Vc.d3[s],iconPath:n,iconFallbackPath:this.getFallbackIcon(s)})};renderCreateListItem=()=>(0,zn.jsx)(TS,{title:(0,W.Z)("New Account"),meta:(0,W.Z)("Setup in progress..."),iconFallbackPath:OS,isCreating:!0});renderContent=(e,t)=>{const s=this.props.accounts[e],n=Ts()(Object.values(s).reduce(((e,t)=>e+t)));return(0,zn.jsxs)(zn.Fragment,{children:["setup"===this.state.setupStep&&(0,zn.jsx)(aS,{filter:this.props.filter,searchableStrings:t,account:s,saveAccount:this.saveAccount},n),"tips"===this.state.setupStep&&(0,zn.jsx)(PS,{windowId:this.context.vivaldiWindowId,onClose:this.done,onboarding:!1})]})};remapAccounts=()=>this.props.accounts.map((e=>({...e,key:e.id})));renderCreate=e=>(0,zn.jsx)(AS,{done:this.onCancelCreateItem,filter:this.props.filter,searchableStrings:e});renderEmpty=e=>(0,zn.jsx)("div",{className:"detail",children:(0,zn.jsxs)("div",{className:"detail-content",children:[(0,zn.jsx)("h3",{children:LS["Add your First Calendar Account"]}),(0,zn.jsx)("p",{children:LS["Press the “Add” button to the left to add a new Account."]})]})});deleteAccountDialog=e=>(0,zn.jsx)(lS,{...e});render(){return(0,zn.jsx)(SS.Z,{title:(0,W.Z)("Calendar Accounts"),subtitle:(0,W.Z)("Add accounts such as Google, Outlook, Vivaldi.net, etc., to access your online calendars."),className:"account-settings",deleteDialog:this.deleteAccountDialog,addTipString:(0,W.Z)("Add Account"),deleteTipString:(0,W.Z)("tooltip","Remove Account"),emptyListGraphic:jS,emptyListString:(0,W.Z)("No accounts added"),filter:this.props.filter,items:this.remapAccounts(),masterLayout:0,renderListItem:this.renderListItem,renderCreateListItem:this.renderCreateListItem,renderContent:this.renderContent,isCreating:this.state.isCreating,onCreateItem:this.onCreateItem,onCancelCreateItem:this.onCancelCreateItem,renderCreate:this.renderCreate,renderEmpty:this.renderEmpty,contentStrings:RS,emptyStrings:LS,createStrings:RS,onRemove:nr.Z})}}const FS=cS(BS),WS=Un.createContext({pageId:NaN,displayDensity:"full",isPanel:!1,isEditing:!1,isWidget:!1,handler:{selectDate:nr.Z,selectEvent:nr.Z,selectCalendars:nr.Z,toggleShowCompleted:nr.Z,editEvent:nr.Z,saveEventEdit:nr.Z,updateEventEdit:nr.Z,endEventEdit:nr.Z,cancelEventEdit:nr.Z}});const US=function(e){const{event:t,updateEvent:s}=e,{start:n,end:i,allDay:a=!1}=t,o=Un.useRef(""),r=function(e,t,s){let n=t-e;return n<0&&(n+=be.hd),{days:Math.floor(n/be.hd)+(s?1:0),hours:s?0:Math.floor(n%be.hd/be.QI),minutes:s?0:Math.floor(n%be.QI/be.lb)}}(n,i,a);function l(){const{days:t,hours:n,minutes:i}=r;e.event.end=a?e.event.start+(t||0)*be.hd:e.event.start+(t||0)*be.hd+(n||0)*be.QI+(i||0)*be.lb,s(e.event)}function d(e){const{name:t,value:s}=e.currentTarget,n=Math.max(parseInt(s),0);switch(t){case"days":r.days=n;break;case"hours":r.hours=n;break;case"minutes":r.minutes=n}o.current=isNaN(n)?t:"",l()}function c(e){const{name:t}=e.currentTarget;e.currentTarget.value||"days"!==t&&"hours"!==t&&"minutes"!==t||(r[t]=0,o.current="",l())}const{days:h,hours:u,minutes:p}=r;return(0,zn.jsxs)("div",{className:"edit-group",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"number",name:"days",min:"0",value:"days"===o.current?"":h,onBlur:c,onChange:d}),(0,zn.jsx)("span",{children:(0,W.Z)("Day","Days",[h])})]}),!a&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"number",name:"hours",min:"0",value:"hours"===o.current?"":u,onBlur:c,onChange:d}),(0,zn.jsx)("span",{children:(0,W.Z)("Hour","Hours",[u])})]}),(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"number",name:"minutes",min:"0",value:"minutes"===o.current?"":p,onBlur:c,onChange:d}),(0,zn.jsx)("span",{children:(0,W.Z)("Minute","Minutes",[p])})]})]})]})},VS=60,HS=1440,GS=10080;function KS(e,t){if(0===e)return t?(0,W.Z)("Same day"):(0,W.Z)("At event time");if(e%GS==0){const t=e/GS;return(0,W.Z)("$1 week before","$1 weeks before",[t])}if(e%HS==0){const t=e/HS;return(0,W.Z)("$1 day before","$1 days before",[t])}if(e%VS==0){const t=e/VS;return(0,W.Z)("$1 hour before","$1 hours before",[t])}return(0,W.Z)("$1 minute before","$1 minutes before",[e])}const zS=[[NaN,(0,W.Z)("No reminder")],[0,(0,W.Z)("At event time")],[5,KS(5,!1)],[10,KS(10,!1)],[15,KS(15,!1)],[30,KS(30,!1)],[45,KS(45,!1)],[60,KS(60,!1)],[120,KS(120,!1)],[240,KS(240,!1)],[360,KS(360,!1)],[480,KS(480,!1)],[720,KS(720,!1)],[1440,KS(1440,!1)],[2880,KS(2880,!1)],[4320,KS(4320,!1)],[5760,KS(5760,!1)],[7200,KS(7200,!1)],[8640,KS(8640,!1)],[10080,KS(10080,!1)],[20160,KS(20160,!1)],[30240,KS(30240,!1)],[40320,KS(40320,!1)]],$S=[[NaN,(0,W.Z)("No reminder")],[0,(0,W.Z)("Same day")],[1440,(0,W.Z)("$1 day before","$1 days before",[1])],[2880,(0,W.Z)("$1 day before","$1 days before",[2])],[4320,(0,W.Z)("$1 day before","$1 days before",[3])],[5760,(0,W.Z)("$1 day before","$1 days before",[4])],[7200,(0,W.Z)("$1 day before","$1 days before",[5])],[8640,(0,W.Z)("$1 day before","$1 days before",[6])],[10080,(0,W.Z)("$1 week before","$1 weeks before",[1])],[20160,(0,W.Z)("$1 week before","$1 weeks before",[2])],[30240,(0,W.Z)("$1 week before","$1 weeks before",[3])],[40320,(0,W.Z)("$1 week before","$1 weeks before",[4])]],YS=6e4;function XS(e){const t=QS(e);return`${Math.floor(t/VS%24).toString().padStart(2,"0")}:${(t%VS).toString().padStart(2,"0")}`}function QS(e){return e<0?Math.abs(e)%HS:(HS-e%HS)%HS}const qS=function(e){const t=Un.useRef(null),s=e.value/YS;function n(t){let n=parseInt(t.target.value);e.allDay&&(n-=QS(s)),e.onChange(n*YS)}const i=e.allDay?[...$S]:[...zS],a=e.allDay?Math.ceil(s/HS)*HS:s;return i.find((([e])=>e===a))||(i.push([a,KS(a,e.allDay??!1)]),i.sort((([e],[t])=>e-t))),(0,zn.jsxs)(zn.Fragment,{children:[e.create&&(0,zn.jsx)(Fa.Z,{ref:t,className:e.className,tabIndex:e.tabIndex,onChange:n,value:"NaN",disabled:0===i.length,children:i.map((([e,t])=>(0,zn.jsx)("option",{value:e.toString(),children:t},e)))}),!e.create&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)(Fa.Z,{ref:t,className:e.className,tabIndex:e.tabIndex,onChange:n,value:a,disabled:0===i.length,children:i.map((([e,t])=>(0,zn.jsx)("option",{value:e.toString(),children:t},e)))}),e.allDay&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("span",{style:{flex:"0 0 auto"},children:(0,W.Z)("at")}),(0,zn.jsx)(_h,{onChange:function(s){const n=Date.parse(`1970-01-01T${s.target.value}Z`)/YS,i=(parseInt(t.current?.value)||0)-n;e.onChange(i*YS)},value:XS(s),step:"5",autoFocusNextElement:!1})]})]})]})};var JS=s(49550);function eZ(e){"Enter"===JS.Z[e.keyCode]&&e.stopPropagation()}const tZ=function(e){const t=Un.useContext(oi.Z),{document:s}=t,[n,i]=Un.useState(!1);if(Un.useEffect((()=>{if(n){const e=s.querySelectorAll(".cal-event-alarm-time");e.length&&e[e.length-1].focus(),i(!1)}}),[n,s]),e.event.task&&!e.event.end)return(0,zn.jsxs)(zn.Fragment,{children:[e.label&&(0,zn.jsx)("h2",{children:e.label}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Can not set reminder for task without due time.")})]});if(e.event.task&&!e.event.end)return(0,zn.jsxs)(zn.Fragment,{children:[e.label&&(0,zn.jsx)("h2",{children:e.label}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Can not set reminder for task without due time.")})]});const a=t=>{const s=function(e,t){let s=t;e.allDay&&t%be.hd==0&&(s-=QS(A.Z.get(Z.kCalendarDefaultAlldayNotificationTime)||900)*be.lb);return{id:"",event_id:e.id,name:e.title,when:s}}(l,t??0),n=[...l.notifications||[],s];i(!0),e.updateEvent({...e.event,notifications:n})},o=()=>{a(function(e){if(e)return(A.Z.get(Z.kCalendarDefaultAlldayNotificationTime)||900)*be.lb;{const e=A.Z.get(Z.kCalendarDefaultNotification);return-1===e?0:e*be.lb}}(l.allDay??!1))},r=n=>{const i=[...e.event.notifications??[]];if(!i.length)return;const{HTMLElement:a}=t,o=s.activeElement instanceof a&&s.activeElement.closest(".calendar-event");if(o){const e=(0,vo.Ng)(o);e.forEach(((t,n)=>{t===s.activeElement&&e[n-1]?.focus()}))}const r=i.indexOf(n);-1!==r&&(i.splice(r,1),e.updateEvent({...e.event,notifications:i}))},{event:l}=e;return(0,zn.jsxs)(zn.Fragment,{children:[e.label&&(0,zn.jsx)("h2",{children:e.label}),!!l.notifications?.length&&l.notifications.map(((t,s)=>(0,zn.jsx)("div",{className:"edit-group",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)(qS,{allDay:l.allDay??!1,create:!1,value:t.when,onChange:s=>((t,s)=>{const n=[...e.event.notifications??[]];if(!n.length)return;const i=n.findIndex((e=>e===t));if(-1!==i){if(-1===s||isNaN(s))return void r(t);n[i]={...n[i],when:s},e.updateEvent({...e.event,notifications:n})}})(t,s),tabIndex:e.tabIndex,className:"cal-event-alarm-time"}),!e.readOnly&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("button",{className:"circular",onClick:r.bind(null,t),onKeyDown:eZ,tabIndex:e.tabIndex,type:"button",title:(0,W.Z)("Remove alarm"),dangerouslySetInnerHTML:{__html:Kn.M2k.small}}),(0,zn.jsx)("button",{className:"circular",onClick:o,onKeyDown:eZ,tabIndex:e.tabIndex,type:"button",title:(0,W.Z)("Add another alarm"),dangerouslySetInnerHTML:{__html:Kn.md4.small}})]})]})},t.id||s))),!l.notifications?.length&&(0,zn.jsx)("div",{className:"edit-group",children:(0,zn.jsx)("label",{children:(0,zn.jsx)(qS,{allDay:l.allDay??!1,create:!0,value:0,onChange:a,tabIndex:e.tabIndex,className:"cal-event-alarm-time"})})})]})};var sZ=s(98528);const nZ={ACCEPTED:{icon:Kn.wHY,text:(0,W.Z)("Has accepted the invite")},DECLINED:{icon:Kn.dHk,text:(0,W.Z)("Has declined the invite")},TENTATIVE:{icon:Kn.owS,text:(0,W.Z)("Has tentatively accepted the invite")},"NEEDS-ACTION":{icon:Kn.DvK,text:(0,W.Z)("Has not replied to the invite")},DELEGATED:{icon:Kn.upG.large,text:(0,W.Z)("Has delegated invite to another person")}};function iZ(e){const{requestAnimationFrame:t}=Un.useContext(oi.Z);return(0,zn.jsx)("p",{className:Gn()("Participants-Dropdown-Item",{"Participants-Dropdown-Item--Selected":e.selected}),onClick:e.onClick,ref:s=>{e.selected&&s&&t((()=>{s.scrollIntoViewIfNeeded()}))},children:e.contact.name?(0,zn.jsxs)(Un.Fragment,{children:[(0,zn.jsx)("span",{className:"Participants-Dropdown-Item-Primary",children:e.contact.name}),(0,zn.jsx)("span",{className:"Participants-Dropdown-Item-Secondary",children:"<"+e.contact.address+">"})]}):(0,zn.jsx)("span",{className:"Participants-Dropdown-Item-Primary",children:e.contact.address})})}const aZ={value:"",items:[],selectedIndex:0};function oZ(e){const t=Un.useContext(oi.Z),s=Un.useRef(),[n,i]=Un.useState(aZ);function a(t){const s=n.items[n.selectedIndex];if(s)e.onItemSelected(s);else if(t){(0,cw.D$)(t).forEach(e.onItemSelected)}i(aZ)}return(0,zn.jsxs)("div",{className:"Participants-Input edit-group",children:[0===A.Z.get(Z.kMailAccounts).length?(0,zn.jsx)("input",{type:"submit",title:(0,W.Z)("Add Mail Account"),value:(0,W.Z)("Add Mail Account"),onClick:()=>ue.Z.showMailAccountDialog(t.vivaldiWindowId)}):(0,zn.jsx)("input",{ref:s,type:"text",tabIndex:e.tabIndex,placeholder:e.placeholder,value:n.value,onChange:function(t){const{value:s}=t.target,n=s?uw(s,e.contacts):[];i({value:s,items:n,selectedIndex:0})},onKeyDown:function(e){const{value:t}=e.currentTarget;switch(JS.Z[e.keyCode]){case"Up":i((e=>({...e,selectedIndex:Math.max(0,e.selectedIndex-1)}))),(0,wi.ZP)(e);break;case"Down":i((e=>({...e,selectedIndex:Math.min(e.items.length-1,e.selectedIndex+1)}))),(0,wi.ZP)(e);break;case"Enter":a(t),(0,wi.ZP)(e);break;case"Escape":n.value&&(i(aZ),(0,wi.ZP)(e))}},onBlur:function(e,t){const{value:s}=e.currentTarget;a(s),(0,wi.ZP)(e)}}),n.items.length>0&&s.current instanceof t.HTMLElement&&(0,zn.jsx)(sZ.Z,{popupClassName:"Participants-Dropdown",buttonRef:s.current,hidePopup:()=>i(aZ),isResizable:!1,popupPosition:"below",width:350,forceFocus:!1,anchorPosition:"left",label:(0,W.Z)("calendar event","Participants"),children:n.items.map(((t,s)=>(0,zn.jsx)(iZ,{contact:t,selected:s===n.selectedIndex,onClick:t=>function(t,s){e.onItemSelected(n.items[s]),i(aZ),(0,wi.ZP)(t)}(t,s)},t.address)))})]})}class rZ extends Un.Component{static contextType=oi.Z;contacts=new Map;showNoMailWarning=!1;constructor(e){super(e),this.contacts=this.getRemainingContacts(ml.Z.getMailAddresses())}stopEnterEvent=e=>{e.keyCode===mo.Z.KEY_RETURN&&e.stopPropagation()};getInvite=e=>{const{event:t}=this.props;return{id:"",event_id:t.id,name:e.name,address:e.address,sent:!1}};contactSelected=e=>{const{event:t}=this.props,s=this.getInvite(e),n=t.invites?[s,...t.invites]:[s],i=this.getMailAccounts();let a="";!t.organizer&&i.length&&(a=A.Z.get(Z.kCalendarMailAccount)||i[0].address),this.props.updateEvent({...t,invites:n,...a?{organizer:a}:{}}),this.contacts=this.getRemainingContacts(this.contacts),this.forceUpdate()};getRemainingContacts(e){const{event:t}=this.props;if(!t.invites||0===t.invites.length)return e;const s=new Set(t.invites.map((e=>e.address)));return new Map([...e.entries()].filter((([e,t])=>!s.has(e))))}removeInvite=(e,t)=>{const{event:s}=this.props;if(!s.invites||0===s.invites.length)return;const n=[...s.invites],i=n.findIndex((t=>t.address===e));if(-1===i)return;n.splice(i,1);const{HTMLElement:a}=this.context,o=t.target.closest(".calendar-event");if(o instanceof a){const e=(0,vo.Ng)(o);e.forEach(((s,n)=>{s===t.target&&e[n-1]&&e[n-1].focus()}))}this.props.updateEvent({...s,invites:n}),this.contacts=this.getRemainingContacts(ml.Z.getMailAddresses()),this.forceUpdate()};setOrganizer=({currentTarget:e})=>{const t=e.value,s=this.props.event.organizer||"";let n=[...this.props.event.invites||[]];s&&(n=n.filter((e=>e.address!==s))),this.props.updateEvent({...this.props.event,organizer:t,invites:n}),this.contacts=this.getRemainingContacts(this.contacts),this.forceUpdate()};getMailAccounts=()=>A.Z.get(Z.kMailAccounts).map((e=>({name:e.displayName,address:e.MAIL_EMAIL})));render(){const{event:e}=this.props,t=(e.invites||[]).filter((t=>t.address!==e.organizer)),s=this.getMailAccounts();return e.task?(0,zn.jsx)("div",{className:"Participants",children:(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Participants not supported for Tasks")})}):(0,zn.jsxs)("div",{className:"Participants",children:[!this.props.readOnly&&(0,zn.jsx)(oZ,{contacts:this.contacts,onItemSelected:this.contactSelected,tabIndex:this.props.tabIndex,placeholder:this.props.label}),this.props.readOnly&&!e.invites?.length&&(0,zn.jsx)("span",{children:(0,W.Z)("No participants")}),!!t?.length&&(0,zn.jsxs)("div",{className:"Participants-List",children:[e.organizer&&(0,zn.jsxs)("div",{className:"Participant",title:(0,W.Z)("Event Organizer"),children:[(0,zn.jsx)("span",{className:"Participant-Status",dangerouslySetInnerHTML:{__html:Kn.LaO.small}}),this.props.event.id?(0,zn.jsx)("span",{className:"Participant-Address",children:e.organizer}):(0,zn.jsx)(Fa.Z,{className:"Blocking-Level-Select",value:e.organizer,onChange:this.setOrganizer,title:(0,W.Z)("Select event organizer."),children:s.map((e=>(0,zn.jsx)("option",{value:e.address,children:e.address},e.address)))})]},e.organizer),t.map(((e,t)=>{const s=e.partstat||"NEEDS-ACTION",n=nZ[s]?nZ[s]:nZ["NEEDS-ACTION"];return(0,zn.jsxs)("div",{className:"Participant",title:this.props.readOnly?"":n.text,children:[!this.props.readOnly&&(0,zn.jsx)("span",{className:"Participant-Status",dangerouslySetInnerHTML:{__html:n.icon}}),(0,zn.jsx)("span",{className:"Participant-Address",children:e.address}),!this.props.readOnly&&(0,zn.jsx)("input",{onClick:this.removeInvite.bind(this,e.address),onKeyDown:this.stopEnterEvent,tabIndex:this.props.tabIndex,type:"button",value:(0,W.Z)("verb","Remove")})]},e.address)}))]}),0===s.length&&(0,zn.jsx)("p",{className:"info",title:(0,W.Z)("In order to send invitations you will need to add a mail account."),children:(0,W.Z)("In order to send invitations you will need to add a mail account.")})]})}}const lZ=rZ;var dZ=s(6142);const cZ=function(e){const{event:t,updateEvent:s}=e,n=Un.useRef(null),i=Un.useCallback((()=>{const i=n.current;"start"===e.type?t.start=i&&i<=t.end?i:t.end-A.Z.get(Z.kCalendarDefaultDuration):t.end=i||(0,Kc.zX)(Date.now()),s(t)}),[t,s,e.type]),a=Un.useCallback((()=>{"start"===e.type?(n.current=t.start,t.start=0):(n.current=t.end,t.start=0,t.end=0),s(t)}),[t,s,e.type]),o="start"===e.type,r="dialog"===e.view,l=!r,d=o?(0,W.Z)("Start Time"):(0,W.Z)("Due Time"),c=o?(0,W.Z)("Task Start Date"):(0,W.Z)("Task Due Date"),h=o?(0,W.Z)("Task Start Time"):(0,W.Z)("Task Due Time"),u=o?(0,W.Z)("Clear Start Time"):(0,W.Z)("Clear Due Time"),{start:p,end:g}=(0,Kc.aE)(t),m=o?p:g,f=(0,zn.jsx)("button",{className:"circular",onClick:a,tabIndex:e.tabIndex,type:"button",title:u,dangerouslySetInnerHTML:{__html:Kn.YVA.small}}),v=!e.timeOnly&&(0,zn.jsx)(wx.Z,{className:"cal-event-date-picker",onChange:e.onDateChange,tabIndex:e.tabIndex,title:c,value:m.format("YYYY-MM-DD"),autoFocus:!0}),b=!t.allDay&&(0,zn.jsx)(_h,{className:"cal-event-time-picker",onChange:e.onTimeChange,tabIndex:e.tabIndex,step:"5",title:h,value:m.format("HH:mm")});return(0,zn.jsxs)(zn.Fragment,{children:[!m.valueOf()&&(0,zn.jsx)("button",{className:"TaskTime FormButton FormButton--WithIcon",onClick:i,dangerouslySetInnerHTML:{__html:`${Kn.hcy.small} ${d}`},tabIndex:e.tabIndex,autoFocus:!0,disabled:o&&!t.end}),!!m.valueOf()&&(0,zn.jsxs)(zn.Fragment,{children:[o&&r&&f,!o&&r&&b,v,(o||l)&&b,!(o&&r)&&f]})]})};var hZ=s(68172),uZ=(0,zn.jsx)("hr",{}),pZ=(0,zn.jsx)("hr",{});function gZ(e){const t=(0,Un.useContext)(oi.Z),s=(0,Un.useRef)("label");const n=Pr.Z.getTemplates();return(0,zn.jsxs)(Fa.Z,{name:"template",onChange:function(n){const i=n.currentTarget.value;"create"===i?function(){const s={templateId:"",name:e.event.title,event:e.event,properties:be.rA};ue.Z.showEditEventTemplate(t.vivaldiWindowId,s)}():((0,hZ.tE)(i,e.event).then(e.updateEvent),s.current=i)},tabIndex:e.tabIndex,value:s.current,children:[(0,zn.jsx)("option",{value:"label",children:(0,W.Z)("Templates")}),uZ,n.map((e=>(0,zn.jsx)("option",{value:e.id,children:e.name},e.id))),!!n.length&&pZ,(0,zn.jsx)("option",{value:"create",children:(0,W.Z)("Create Event Template")})]})}class mZ extends Un.Component{static contextType=oi.Z;constructor(e){super(e)}shouldComponentUpdate=()=>{const{document:e}=this.context;return!(this.element&&this.element===e.activeElement)};setRef=e=>{this.element=e,e&&this.props.setElementRef&&this.props.setElementRef(e)};updateContent=e=>{if(this.element){const e=this.element.textContent;this.props.updateContent(e||"")}};render(){const e=(this.props.className||"")+" editable",t=(0,ys.Z)(this.props,["className","content","updateContent","formatter","setElementRef"]);return(0,zn.jsx)("p",{...t,className:e,contentEditable:"plaintext-only",onBlur:this.updateContent,onInput:this.updateContent,ref:this.setRef,suppressContentEditableWarning:!0,"data-placeholder":this.props.placeholder?this.props.placeholder:"",children:this.props.formatter(this.props.content)})}}const fZ=mZ;function vZ(e){return e??""}class bZ extends Un.PureComponent{updateText=e=>{const{event:t,field:s}=this.props;(e&&e!==t[s]||!e&&t[s])&&this.props.updateEvent({...t,[s]:e})};onKeyDown=e=>{if("Enter"===JS.Z[e.keyCode]&&!e.shiftKey){const{saveEventEdit:t}=this.props;t&&(t(),(0,wi.ZP)(e))}};render(){return this.props.readOnly?(0,zn.jsx)("p",{className:`field cal-event-${this.props.field}`,children:this.props.event[this.props.field]}):(0,zn.jsx)(fZ,{setElementRef:e=>{this.props.focusRef&&e&&(this.props.focusRef.current=e)},tabIndex:this.props.tabIndex,title:this.props.label,placeholder:this.props.label,className:`field cal-event-${this.props.field}`,content:this.props.event[this.props.field],formatter:vZ,updateContent:this.updateText,onKeyDown:this.onKeyDown})}}const CZ=bZ;var wZ=s(92571),yZ=s(80008),xZ=s.n(yZ);const IZ=[{value:be.ad,label:(0,W.Z)("Current ($1)",[(0,Kc.EP)()])},{value:be.$T,label:(0,W.Z)("Always in Local Time")}].concat(xZ().tz.names().filter((e=>-1!==e.indexOf("/"))).map((e=>({value:e,label:e})))),AZ=Ci()((function(e,t){return t?IZ[1]:IZ.find((t=>t.value===e))??SZ()[0]}));function SZ(){return IZ[0]={value:be.ad,label:(0,W.Z)("Current ($1)",[(0,Kc.EP)()])},IZ}const ZZ=function(e){const{event:t,setSelectedItem:s}=e,n=Un.useRef(!1);return(0,zn.jsx)(wZ.Z,{commands:SZ(),placeholder:"",selectedCommand:AZ(t.timezone,t.allDay),setSelectedItem:s,blurInputOnSelect:!1,disabled:e.event.allDay,onKeyDown:e=>{n.current&&(0,wi.UW)(e)},tabIndex:e.tabIndex,onMenuOpen:function(){n.current=!0},onMenuClose:function(){n.current=!1}})};var TZ=s(12442);const EZ=e=>{const{pageId:t,handler:s}=Un.useContext(WS),n=Un.useContext(oi.Z).vivaldiWindowId,i=Un.useCallback((()=>{ie.ZP.trashEvent(e.id)}),[e]),a=Un.useCallback((()=>{const t={templateId:"",name:e.title,event:e,properties:be.rA};ue.Z.showEditEventTemplate(n,t)}),[e,n]),o=Un.useCallback((s=>{TZ.Z.selectEvent(t,{event:e}),s?jc.Z.cut(n):jc.Z.copy(n)}),[e,t,n]),r=Un.useCallback((()=>[{handler:()=>s.editEvent(e),...(0,fi.Z)("verb","Edit")},{type:"separator",label:"",labelEnglish:""},{handler:()=>o(!0),...(0,fi.Z)("verb","Cut")},{handler:()=>o(!1),...(0,fi.Z)("verb","Copy")},{handler:()=>i(),...(0,fi.Z)("verb","Delete")},{handler:()=>a(),...(0,fi.Z)("Create Event Template")}]),[i,o,s,e,a]);return{trashEvent:i,getContextMenu:r}};function kZ(e,t,s){const n=(0,Kc.Yu)(e),i=xZ().tz(e[t],n).format("YYYY-MM-DD");return _Z(t,e,xZ().tz(`${i} ${s}`,n).valueOf())}function NZ(e,t,s){const n=(0,Kc.Yu)(e),i=xZ().tz(e[t],n).format("HH:mm"),a=xZ().tz(`${s} ${i}`,n);return e.allDay&&!e.task&&"end"===t&&a.add(1,"day"),_Z(t,e,a.valueOf())}function _Z(e,t,s){if(!isNaN(s)){const n=A.Z.get(Z.kCalendarAutoAdjustEnd);if("start"===e&&("always"===n||"timed_only"===n&&!t.allDay)){const e=t.end-t.start;t.start=s,t.end=s+e}else t[e]=s}return t}class PZ extends Un.Component{createTimeHandler=e=>t=>{const{value:s}=t.currentTarget;this.props.updateEvent(kZ(this.props.event,e,s))};createDateHandler=e=>t=>{const{value:s}=t.currentTarget;this.props.updateEvent(NZ(this.props.event,e,s))};setTimezone=e=>{this.props.updateEvent((0,Kc.bn)(this.props.event,e.value))};setAllDay=e=>{const{checked:t}=e.currentTarget;this.props.event.allDay=t,this.props.updateEvent(this.props.event)};render(){const{event:e}=this.props,{start:t,end:s}=(0,Kc.aE)(e);return(0,zn.jsxs)("div",{children:[!e.task&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("div",{className:"edit-group large-gap",children:[(0,zn.jsx)(wx.Z,{className:"cal-event-date-picker",onChange:this.createDateHandler("start"),tabIndex:this.props.tabIndex,title:(0,W.Z)("Event Start Date"),value:t.format("YYYY-MM-DD")}),!e.allDay&&(0,zn.jsx)(_h,{className:"cal-event-time-picker",onChange:this.createTimeHandler("start"),ref:this.props.focusRef,tabIndex:this.props.tabIndex,step:"5",title:(0,W.Z)("Event Start Time"),value:t.format("HH:mm")})]}),(0,zn.jsxs)("div",{className:"edit-group large-gap",children:[(0,zn.jsx)(wx.Z,{className:"cal-event-date-picker",onChange:this.createDateHandler("end"),tabIndex:this.props.tabIndex,title:(0,W.Z)("Event End Date"),value:s.format("YYYY-MM-DD")}),!e.allDay&&(0,zn.jsx)(_h,{className:"cal-event-time-picker",onChange:this.createTimeHandler("end"),tabIndex:this.props.tabIndex,step:"5",title:(0,W.Z)("Event End Time"),value:s.format("HH:mm")})]})]}),e.task&&(0,zn.jsxs)(zn.Fragment,{children:[!!e.end&&(0,zn.jsx)("div",{className:"edit-group large-gap",children:(0,zn.jsx)(cZ,{type:"start",view:"inline",event:e,updateEvent:this.props.updateEvent,onDateChange:this.createDateHandler("start"),onTimeChange:this.createTimeHandler("start"),tabIndex:this.props.tabIndex})}),(0,zn.jsx)("div",{className:"edit-group large-gap",children:(0,zn.jsx)(cZ,{type:"due",view:"inline",event:e,onDateChange:this.createDateHandler("end"),onTimeChange:this.createTimeHandler("end"),updateEvent:this.props.updateEvent,tabIndex:this.props.tabIndex})})]}),(0,zn.jsxs)("div",{className:"edit-group large-gap",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:!!e.allDay,onChange:this.setAllDay,tabIndex:this.props.tabIndex}),(0,zn.jsx)("span",{children:(0,W.Z)("All Day")})]}),(0,zn.jsx)(ZZ,{event:e,setSelectedItem:this.setTimezone,tabIndex:this.props.tabIndex})]}),(0,zn.jsx)(tZ,{event:e,tabIndex:this.props.tabIndex,updateEvent:this.props.updateEvent,label:(0,W.Z)("Reminders")})]})}}const MZ=PZ;var DZ=(0,zn.jsx)("span",{children:"-"}),OZ=(0,zn.jsx)("span",{children:"-"});class jZ extends Un.Component{createTimeHandler=e=>t=>{const{value:s}=t.currentTarget;this.props.updateEvent(kZ(this.props.event,e,s))};createDateHandler=e=>t=>{const{value:s}=t.currentTarget;this.props.updateEvent(NZ(this.props.event,e,s))};changeField=(e,t)=>{this.props.event[e]=t.currentTarget.checked,this.props.updateEvent(this.props.event)};onCalendarChange=e=>{this.props.event.calendarId=e.target.value,this.props.updateEvent(this.props.event)};onCalendarSelected=e=>{ie.ZP.setDefaultCalendarId(e,this.props.event.task??!1),this.props.event.calendarId=e,this.props.updateEvent(this.props.event)};render(){const{event:e}=this.props,{start:t,end:s}=(0,Kc.aE)(e);return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("div",{className:"edit-group large-gap",children:(0,zn.jsx)(CZ,{...this.props,label:(0,W.Z)("Title"),field:"title"})}),(0,zn.jsxs)("div",{className:"edit-group large-gap",children:[!e.task&&e.allDay&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)(wx.Z,{className:"cal-event-date-picker",onChange:this.createDateHandler("start"),tabIndex:this.props.tabIndex,title:(0,W.Z)("Event Start Date"),value:t.format("YYYY-MM-DD")}),DZ,(0,zn.jsx)(wx.Z,{className:"cal-event-date-picker",onChange:this.createDateHandler("end"),tabIndex:this.props.tabIndex,title:(0,W.Z)("Event End Date"),value:s.format("YYYY-MM-DD")})]}),!e.task&&!e.allDay&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)(_h,{className:"cal-event-time-picker",onChange:this.createTimeHandler("start"),tabIndex:this.props.tabIndex,step:"5",title:(0,W.Z)("Event Start Time"),value:t.format("HH:mm")}),OZ,(0,zn.jsx)(_h,{className:"cal-event-time-picker",onChange:this.createTimeHandler("end"),tabIndex:this.props.tabIndex,step:"5",title:(0,W.Z)("Event End Time"),value:s.format("HH:mm")})]}),e.task&&(0,zn.jsx)(cZ,{type:"due",view:"inline",event:e,updateEvent:this.props.updateEvent,onDateChange:this.createDateHandler("end"),onTimeChange:this.createTimeHandler("end"),tabIndex:this.props.tabIndex})]}),(0,zn.jsxs)("div",{className:"edit-group inline large-gap",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:!!e.task,onChange:this.changeField.bind(null,"task"),tabIndex:this.props.tabIndex}),(0,zn.jsx)("span",{children:(0,W.Z)("Is a Task")})]}),(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{disabled:!e.task,type:"checkbox",checked:!!e.complete,onChange:this.changeField.bind(null,"complete"),tabIndex:e.task?this.props.tabIndex:-1}),(0,zn.jsx)("span",{children:(0,W.Z)("Complete")})]})]}),e&&(0,zn.jsx)("div",{className:"edit-group large-gap capped-width",children:th(e,this.onCalendarSelected,this.props.tabIndex)}),e&&(0,zn.jsx)("div",{className:"edit-group capped-width",children:(0,zn.jsx)(gZ,{event:e,tabIndex:this.props.tabIndex,updateEvent:this.props.updateEvent})})]})}}const LZ=jZ;var RZ=(0,zn.jsx)("div",{className:"CalendarEventBubble-Arrow"});const BZ=function(e){const t=Un.useContext(oi.Z),s=Un.useContext(WS),n=t.vivaldiWindowId,i=Un.useRef(Un.createRef().current),a=Un.useRef();(0,dS.Z)(Ze.ZP,t.selectWindow);let o=!1;Ze.ZP.isActivePage(n,s.pageId)||s.isPanel||(o=!0);const r=Un.useCallback(((e,s)=>{a.current||(a.current=t.requestAnimationFrame((()=>{!function(e,t){const s=e.current,n=t.current;if(!s||!n)return;const i=s.parentElement?.getBoundingClientRect()||{left:0,top:0,bottom:0,width:0,height:0},a=s.getBoundingClientRect(),o=n.getBoundingClientRect(),r=o.left-i.left,l=i.width-o.right;l>=a.width?(s.style.left=o.right-i.left+"px",s.style.right="auto",s.classList.remove("CalendarEventBubble--RightArrow"),s.classList.add("CalendarEventBubble--LeftArrow")):r>=a.width?(s.style.right=i.width-o.left+"px",s.style.left="auto",s.classList.remove("CalendarEventBubble--LeftArrow"),s.classList.add("CalendarEventBubble--RightArrow")):r>l?(s.style.left="0px",s.style.right="auto",s.classList.remove("CalendarEventBubble--LeftArrow"),s.classList.add("CalendarEventBubble--RightArrow")):(s.style.right="0px",s.style.left="auto",s.classList.remove("CalendarEventBubble--RightArrow"),s.classList.add("CalendarEventBubble--LeftArrow"));const d=s.querySelector(".CalendarEventBubble-Arrow"),c=o.top-i.top,h=i.height-o.bottom,u=(a.height-o.height)/2;if(c>u&&h>u){if(s.style.top=o.top-i.top-u+"px",s.style.bottom="auto",d){const e=u+o.height/2;d.style.top=`${e}px`}}else if(h<u){if(s.style.bottom="0px",s.style.top="auto",d){const e=i.bottom-a.height,t=Math.min(a.height-20,o.top-e+o.height/2);d.style.top=`${t}px`}}else if(s.style.top="0px",s.style.bottom="auto",d){const e=Math.max(20,o.top-a.top+o.height/2);d.style.top=`${e}px`}}(e,s),a.current=null})))}),[a,t]);Un.useEffect((()=>{function s(){r(i,e.eventRef)}const n=new t.ResizeObserver(s),a=e.eventRef.current?.closest(".calendar-viewport");return a&&a.addEventListener("scroll",s),t.addEventListener("resize",s),e.eventRef.current&&n.observe(e.eventRef.current),r(i,e.eventRef),()=>{a&&a.removeEventListener("scroll",s),e.eventRef.current&&n.unobserve(e.eventRef.current),t.removeEventListener("resize",s)}}),[e.eventRef,r,t]);const{saveEvent:l,trashEvent:d}=e,c=Un.useCallback((function(e){(0,wi.ZP)(e),l()}),[l]),h=Un.useCallback((function(e){(0,wi.ZP)(e),d()}),[d]),u=!!e.event.id,p=!!e.event.task;return(0,zn.jsx)("div",{className:"CalendarEventBubble panel-clickoutside-ignore",ref:i,"data-top":"225px",style:o?{display:"none"}:null,children:(0,zn.jsxs)(Zo.Z,{focusName:"calendar_event",forceTrap:!0,children:[RZ,(0,zn.jsx)("div",{className:"CalendarEventBubble-Inner",role:"dialog","aria-modal":"true","aria-label":u?p?(0,W.Z)("Edit Task"):(0,W.Z)("Edit Event"):p?(0,W.Z)("New Task"):(0,W.Z)("New Event"),children:(0,zn.jsxs)("form",{onSubmit:c,children:[(0,zn.jsx)(mE,{event:e.event}),(0,zn.jsxs)("div",{className:"CalendarEventBubble-Buttons",children:[(0,zn.jsx)("input",{type:"submit",disabled:!e.event.calendarId,value:u?(0,W.Z)("calendar","Done"):p?(0,W.Z)("Add Task"):(0,W.Z)("Add Event"),onClick:c}),(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("calendar","Cancel"),onClick:()=>e.discardChanges()}),u&&(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("verb","Delete"),onClick:h})]})]})})]})})};class FZ extends Un.Component{static contextType=oi.Z;render(){const{event:e}=this.props;return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("div",{className:"edit-group large-gap",children:(0,zn.jsx)(CZ,{...this.props,label:(0,W.Z)("Description"),field:"description"})}),(0,zn.jsx)("div",{className:"edit-group",children:(0,zn.jsx)(CZ,{...this.props,label:(0,W.Z)("URL"),field:"url"})}),e.attachment&&e.attachment.length>0&&(0,zn.jsx)("div",{className:"cal-event-attchments",children:e.attachment.map((e=>(0,zn.jsxs)("div",{className:"cal-event-attachment",children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.UEH.small}}),(0,zn.jsx)("a",{onClick:()=>c.ZP.openURL(this.context.vivaldiWindowId,e.url),title:e.url,children:e.filename||e.url})]},e.url)))})]})}}const WZ=FZ;class UZ extends Un.PureComponent{render(){return(0,zn.jsx)("div",{className:"cal-edit-tabs",children:this.props.tabs.map((e=>{const{id:t,label:s,icon:n}=e;return(0,zn.jsx)("button",{className:Gn()("cal-edit-tab",{selected:this.props.currentTabId===t}),dangerouslySetInnerHTML:{__html:n},onClick:this.props.onSelectTab.bind(null,t),tabIndex:"-1",title:s},`tab-${t}`)}))})}}const VZ=UZ;var HZ=s(73935);const GZ="basics";const KZ=function(e,t,s,n){const i=Un.useContext(oi.Z),[a,o]=Un.useState({tabId:GZ,toFocus:""}),r=Un.useRef(!1),l=Un.useRef(null),d=n?.[0].current,c=n?.[1].current,h=a.tabId,u=Un.useCallback(((t,s="")=>{if(!e.get(t)||t===h)return;const n=h?e.get(h):void 0,a=n&&n.containerRef.current,r=i.getSelection(),{document:l}=i;if(a?.contains(l.activeElement)){const e=[];if(r)for(let t=0;t<r.rangeCount;t++)e.push(r.getRangeAt(t));const t={element:l.activeElement,ranges:e};n&&(n.storedFocus=t)}l.activeElement?.blur(),o({tabId:t,toFocus:s})}),[e,i,h]);return Un.useEffect((()=>{const s=(t,s="first")=>{if(!e)return;const n=h?e.get(h):void 0;let i;"next"===t?(i=n&&n.index+1||0,i=i<e.size?i:0):(i=n&&n.index-1||0,i=i<0?e.size-1:i);const a=[...e.values()].find((e=>e.index===i));u(a&&a.id||GZ,s)},n=s.bind(null,"next","first"),a=s.bind(null,"previous","last"),o=e=>{const{changeTab:t,direction:n,toFocus:i}=(e=>{const t=JS.Z[e.keyCode];return"PageUp"===t||"Tab"===t&&e.altKey&&e.shiftKey?{changeTab:!0,direction:"previous",toFocus:"first"}:"PageDown"===t||"Tab"===t&&e.altKey?{changeTab:!0,direction:"next",toFocus:"first"}:{changeTab:!1,direction:"next",toFocus:"first"}})(e);t&&(e.preventDefault(),s(n,i))},r=t=>{let s;e?.forEach((e=>{const n=e.containerRef.current;t.target instanceof i.HTMLElement&&n?.contains(t.target)&&(s=e.id)})),s&&s!==h&&u(s)};d&&d.addEventListener("focusin",a),c&&c.addEventListener("focusin",n);const l=t.current;return l&&(l.addEventListener("keydown",o),l.addEventListener("focusin",r)),()=>{l&&(l.removeEventListener("keydown",o),l.removeEventListener("focusin",r)),d&&d.removeEventListener("focusin",a),c&&c.removeEventListener("focusin",n)}}),[h,e,s,t,u,d,c,i]),Un.useEffect((function(){function n(e,t){i.requestAnimationFrame((()=>function(e,t,s){if(t.tabIndex<0){const e=t.tabIndex;t.tabIndex=0,t.focus(),t.tabIndex=e}else t.focus();const n=e.document.getSelection();if(!n)return;const{HTMLInputElement:i,HTMLElement:a}=e;if(t instanceof i&&"number"===t.type)t.select();else{if(n.focusNode&&n.focusNode.childNodes[n.focusOffset]===t)return;{const i=e.document.createRange();if(!(i&&t instanceof a))return;i.selectNodeContents(t);const o=t.hasChildNodes()?t.childNodes[0]:null;if(s&&o)try{i.setStart(o,s.start),i.setEnd(o,s.end)}catch(e){i.collapse(!1),ls.Z.error("Calendar","Setting caret position failed!",e)}else i.collapse(!1);n.removeAllRanges(),e.document.contains(i.commonAncestorContainer)&&n.addRange(i)}}}(i,e,t)))}const o=s&&!1===r.current;if(r.current=s,!s)return;const h=t.current,u=i.getSelection(),p=e.get(a.tabId);if(h&&p)if(o){e.forEach((e=>e.storedFocus=null)),i.requestAnimationFrame((()=>{h.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})}));const t=p.focusRef?.current;t&&n(t,l.current)}else{const e=!(!d||!c);if(e&&["first","last"].includes(a.toFocus)){let t=[];if(h instanceof i.HTMLElement&&(t=Array.from((0,vo.Ng)(h))),e&&(t=t.slice(1,-1)),t=t.filter((e=>!e.parentElement?.className.includes("cal-event-body-buttons"))),t.length)"first"===a.toFocus?n(t[0]):n(t[t.length-1]);else{const e=p.focusRef&&p.focusRef.current;e&&n(e)}}else if(p.storedFocus){const e=p.storedFocus;e.element?.focus(),u&&(u.removeAllRanges(),e.ranges.forEach((e=>u.addRange(e))))}else if(!h.contains(i.document.activeElement)){const e=p.focusRef&&p.focusRef.current;e&&n(e)}}}),[a,s,t,e,d,c,i]),[a.tabId,e=>u(e,"first")]},zZ=[Z.kCalendarEditMode,Z.kCalendarDisplayEventIcons,Z.kCalendarDisplayDimPastEvents],$Z=[["basics",(0,W.Z)("Basic Event Info"),Kn.qHs],["time",(0,W.Z)("Date and Time"),Kn.zTz],["recurrence",(0,W.Z)("Recurrence"),Kn.Eki],["location",(0,W.Z)("other","Location"),Kn.GF3],["description",(0,W.Z)("Description"),Kn.wTH],["participants",(0,W.Z)("Type to add Participants"),Kn.Rs2]],YZ=[["basics",(0,W.Z)("Basic Task Info"),Kn.qHs],["time",(0,W.Z)("Date and Time"),Kn.zTz],["recurrence",(0,W.Z)("Recurrence"),Kn.Eki],["location",(0,W.Z)("other","Location"),Kn.GF3],["description",(0,W.Z)("Description"),Kn.wTH]],XZ=e=>{const t=Yc(e);let s=`${e.title||Vc.gT}`;return t&&(s+=` (${t})`),e.location&&(s+=`\n${e.location}`),e.description&&(s+=`\n${e.description}`),s};function QZ(e){["Space","Enter"].includes(JS.Z[e.keyCode])&&e.stopPropagation()}function qZ(e){const t=Un.useContext(WS),s=Un.useContext(oi.Z),n=Un.useRef(new Map((e.event.task?YZ:$Z).map(((e,t)=>{const[s,n,i]=e;return[s,{id:s,label:n,icon:i,index:t,focusRef:Un.createRef(),containerRef:Un.createRef(),storedFocus:null}]})))),{event:i,isSelected:a,isEditing:o,isMultiDay:r,isFiltering:l,multiDayContinues:d,multiDayContinuing:c,dayOutOfTotalDays:h}=e,u=Un.useRef(null),p=Un.useRef(null),g=Un.useRef(null),m=(0,Eo.Z)(zZ),[f,v]=KZ(n.current,u,o,[p,g]),{trashEvent:b,getContextMenu:w}=EZ(i),y=n.current.get("title"),x=n.current.get("time"),I=""===i.id,A=t.isWidget?"popup":m[Z.kCalendarEditMode],S=Un.useCallback((e=>{"Enter"!==JS.Z[e.keyCode]||e.shiftKey||(e.preventDefault(),e.stopPropagation(),t.handler.saveEventEdit())}),[t.handler]);Un.useEffect((()=>{o||v("basics")}),[o,v]);const T=Un.useCallback((()=>{I||b(),t.handler.cancelEventEdit()}),[t.handler,b,I]);let E;if(o&&"popup"===A){const e=s.document.querySelector("#main > .inner");e&&(E=HZ.createPortal((0,zn.jsx)(BZ,{event:i,eventRef:u,saveEvent:t.handler.saveEventEdit,trashEvent:b,discardChanges:t.handler.cancelEventEdit}),e))}const k=Un.useCallback((()=>{if(!h||i.allDay||!e.isMultiDay)return"";const t=h.startOf("day").valueOf(),s=864e5,n=new Date(i.start).setHours(0,0,0,0),a=new Date(i.end).setHours(0,0,0,0),o=Math.trunc((a-n)/s)+1,r=Math.trunc((t-n)/s)+1;return(0,W.Z)("(day $1)",[`${r}/${o}`])}),[h,i.allDay,i.start,i.end,e.isMultiDay]),N=m[Z.kCalendarDisplayDimPastEvents],_=i.end&&i.end<Date.now(),P=i.task&&!i.complete,M=h&&k();return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("div",{className:Gn()(`calendar-event calendar${i.calendarId}`,e.className,{selected:a||o,editing:o&&"inline"===A,"all-day":r,solid:"solid"===e.displayStyle,"filtered-out":i.filteredOut&&!o,"task-completed":i.task&&i.complete,minimal:"minimal"===t.displayDensity,compact:"compact"===t.displayDensity,"event-passed":_&&N&&!l&&!o&&!P,"task-overdue":_&&!l&&!o&&P,"multiday-continuing":e.multiDayContinuing&&!o,"multiday-continues":e.multiDayContinues&&!o}),style:e.style,ref:u,onContextMenu:function(e){pE(s,e.target)?e.stopPropagation():(t.handler.selectEvent({event:i}),(0,mi.Z)(s,w())(e))},title:XZ(i),"data-event-id":i.id,onClick:s=>{e.onClick?e.onClick(s):o||t.handler.editEvent(i),s.stopPropagation()},onKeyDown:S,children:[o&&"inline"===A&&(0,zn.jsxs)(Zo.Z,{focusName:"calendar_event_inline_edit",preventTrap:!0,children:[(0,zn.jsx)(VZ,{tabs:Array.from(n.current.values()),currentTabId:f,onSelectTab:v}),(0,zn.jsx)("div",{className:"cal-event-body",children:(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("span",{className:"sentry",tabIndex:"0",ref:p}),Array.from(n.current.values(),(e=>{const{id:s,label:n,focusRef:a}=e,o=f===s,r=o?0:-1,l={event:i,updateEvent:t.handler.updateEventEdit,field:s,label:n,focusRef:a,tabIndex:r};let d;switch(s){case"basics":d=(0,zn.jsx)(LZ,{...l});break;case"recurrence":d=(0,zn.jsx)(dZ.Z,{...l});break;case"description":d=(0,zn.jsx)(WZ,{...l});break;case"time":d=(0,zn.jsx)(MZ,{...l});break;case"participants":d=(0,zn.jsx)(lZ,{...l});break;default:d=(0,zn.jsx)("div",{className:"edit-group",children:(0,zn.jsx)(CZ,{...l,field:s})})}return(0,zn.jsxs)("div",{ref:e.containerRef,className:Gn()("cal-event-body-edit",{selected:o}),children:[d,(0,zn.jsxs)("div",{className:"cal-event-body-buttons",children:[""===i.id&&i.filteredOut&&(0,zn.jsx)("span",{className:"cal-event-body-filtered-warning",dangerouslySetInnerHTML:{__html:Kn.h6},title:i.task?(0,W.Z)("Once saved this task will be hidden by current search"):(0,W.Z)("Once saved this event will be hidden by current search")}),t.isTaskList&&!i.task&&(0,zn.jsx)("span",{className:"cal-event-body-filtered-warning",dangerouslySetInnerHTML:{__html:Kn.h6},title:(0,W.Z)("Once saved this event will not show in the task list")}),(0,zn.jsx)("input",{onClick:t.handler.saveEventEdit,onKeyDown:QZ,tabIndex:r,type:"submit",disabled:!i.calendarId,value:(0,W.Z)("calendar","Done")}),(0,zn.jsx)("input",{onClick:T,onKeyDown:QZ,tabIndex:r,type:"button",value:I?(0,W.Z)("Cancel"):(0,W.Z)("verb","Delete")})]})]},e.id)})),(0,zn.jsx)("span",{className:"sentry",tabIndex:"0",ref:g})]})})]}),(!o||"popup"===A)&&(0,zn.jsxs)("div",{className:"cal-event-body",children:[(0,zn.jsxs)("div",{className:"cal-event-header",children:[!r&&"transparent"===e.displayStyle&&!i.task&&(0,zn.jsx)("span",{className:"cal-event-dot",dangerouslySetInnerHTML:{__html:_r.ZP.getEventSquircle()}}),i.task&&(0,zn.jsx)("input",{type:"checkbox",checked:i.complete,onChange:e.onCompleteChanged??function(s){const{checked:n}=s.target,i=(0,C.Uy)(e.event,(e=>{e.complete=n}));ie.ZP.updateEvent(i,"single",!0,t.pageId)},onMouseDown:wi.ZP,onClick:wi.ZP,tabIndex:"-1"}),!r&&(i.start||i.task)&&!!i.end&&!c&&(0,zn.jsx)("span",{className:"cal-event-time",ref:x?.focusRef,children:Xc(i.start||i.end)}),!r&&!!i.end&&!d&&c&&(0,zn.jsx)("span",{className:"cal-event-time",ref:x?.focusRef,children:Xc(i.end)}),eh(s,"title",i.title||Vc.gT,y?.focusRef),M&&(0,zn.jsx)("span",{className:"cal-event-progression",children:M}),m[Z.kCalendarDisplayEventIcons]&&(0,zn.jsxs)("div",{className:"cal-event-icons",children:[i.url&&(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.wTH},className:"cal-event-icon-link",onClick:e=>{lr.QJ.openURL(s.vivaldiWindowId,i.url),(0,wi.ZP)(e)}}),i.location&&(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.GF3},onClick:()=>v("location")}),!(!i.notifications||!i.notifications.length)&&(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.PPL},onClick:()=>v("time")}),_r.ZP.isRecurringEvent(i)&&(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.Eki},onClick:()=>v("recurrence")}),i.attachment&&i.attachment.length>0&&(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.UEH.small},onClick:()=>v("description")})]})]}),"minimal"!==t.displayDensity&&(0,zn.jsxs)("div",{className:"cal-event-body-content",children:[eh(s,"description",i.description||""),eh(s,"location",i.location||""),eh(s,"url",i.url||"")]})]}),e.resizeHandler&&!c&&(0,zn.jsx)("div",{className:"calendar-event-resizer pre "+e.resizeHandler}),e.resizeHandler&&!d&&(0,zn.jsx)("div",{className:"calendar-event-resizer post "+e.resizeHandler})]}),E]})}function JZ(e,t){var s,n;return!e.isEditing&&!t.isEditing&&(e.event===t.event&&e.isSelected===t.isSelected&&e.isMultiDay===t.isMultiDay&&e.isFiltering===t.isFiltering&&(s=e.style,n=t.style,!s&&!n||!!s&&!!n&&s.gridRowStart===n.gridRowStart&&s.gridRowEnd===n.gridRowEnd&&s.gridColumnStart===n.gridColumnStart&&s.gridColumnEnd===n.gridColumnEnd))}const eT=Un.memo(qZ,JZ),{minimalCreateEvent:tT}=_r.ZP,sT={dragging:!1,cancelled:!1,currentX:null,currentY:null,xOffset:0,yOffset:0,initialTime:0,initialEndTime:0,initialStartRow:0,initialEndRow:0,initialLeftCol:0,initialRightCol:0,resizeEvent:null,draggingFrom:"start",isAllDay:!1};function nT(e,t,s,n,i){const[a,o]=Un.useState(null),[r,l]=Un.useState(null),d=Un.useRef(null),c=Un.useRef(null),h=Un.useRef(n);h.current=n;const u=Un.useContext(oi.Z),{document:p,getComputedStyle:g}=u,{handler:m}=Un.useContext(WS),f=Un.useRef(),v=Un.useRef({...sT});Un.useEffect((()=>{const e=p.createElement("div");return e.classList.add("calendar-drag-image"),f.current=e,p.body?.append(e),()=>{e.remove()}}),[p]);const b=Un.useCallback((()=>{e&&o({gridTemplateColumns:g(e).gridTemplateColumns,gridTemplateRows:g(e).gridTemplateRows})}),[e,g]),C=Un.useCallback((()=>{o(null)}),[]),w=Un.useCallback((()=>{d.current=null,l(d.current),v.current={...sT},i(!1),C()}),[C,i]);function y(){const{resizeEvent:i}=v.current;if(v.current.dragging){if(i){const t=s(e,v.current,d.current,n);if(!t)return void w();if(t&&!(0,sw.Z)(t,c.current)){const e=i.dataset.eventId,s=h.current;if(s&&s.id===e)s.start=t.startTime,s.end=t.endTime,m.updateEventEdit(s);else{const s=Pr.Z.getEvent(e);s&&m.editEvent({...s,start:t.startTime,end:t.endTime})}c.current=t}}else{const s=t(e,v.current,d.current);if(!s)return void w();(0,sw.Z)(d.current,s)||l(s),d.current=s}u.requestAnimationFrame(y)}else if(v.current.cancelled)i&&m.cancelEventEdit(),w();else{const e=d.current;e?m.editEvent(null,tT({start:e.startTime,end:e.endTime,allDay:e.isAllDay})).then(w):i&&m.saveEventEdit().then(w)}}return{gridFrozen:a,handlers:{onDragStart:e=>{if(!e.dataTransfer.items.length){const t=p.elementFromPoint(e.clientX,e.clientY),s=t?.closest(".calendar-event");if(t instanceof u.HTMLElement&&t.classList.contains("calendar-event-resizer"))v.current.resizeEvent=t.parentElement instanceof u.HTMLElement&&t.parentElement||null,t.classList.contains("pre")?v.current.draggingFrom="start":v.current.draggingFrom="end",i(!0);else if(s instanceof u.HTMLElement){const a=s.dataset.eventId;if(n&&"DIV"!==t?.tagName)return void(0,wi.ZP)(e);e.dataTransfer&&a&&(e.dataTransfer.setData(um,JSON.stringify({id:a})),e.dataTransfer.effectAllowed="copyMove",e.stopPropagation());const o=s.getBoundingClientRect(),r=Math.round(o.width/2),l=Math.round(e.clientX-o.left),d=Math.round(e.clientY-o.top);return v.current.xOffset=l-r,v.current.yOffset=d,e.dataTransfer.setDragImage(s,l,d),void i(!0)}f.current&&e.dataTransfer.setDragImage(f.current,0,0),e.dataTransfer.setData(pm,!0),v.current.dragging=!0,v.current.currentX=e.clientX,v.current.currentY=e.clientY,v.current.resizeEvent||b(),e.stopPropagation(),u.requestAnimationFrame(y)}},onDragOver:e=>{e.dataTransfer.types.some((e=>e===pm))&&(v.current.currentX=e.clientX,v.current.currentY=e.clientY,(0,wi.ZP)(e))},onDragEnd:e=>{v.current.resizeEvent||i(!1),e.dataTransfer.types.some((e=>e===um))&&e.stopPropagation(),"none"===e.dataTransfer.dropEffect&&(v.current.dragging=!1,v.current.cancelled=!0,(0,wi.ZP)(e))},onDrop:e=>{v.current.resizeEvent||i(!1),e.dataTransfer.types.some((e=>e===pm))&&(v.current.currentX=e.clientX,v.current.currentY=e.clientY,v.current.dragging=!1,e.stopPropagation())}},overlay:r,dragOffset:{xOffset:v.current.xOffset,yOffset:v.current.yOffset}}}const iT=function(e){const{HTMLElement:t}=Un.useContext(oi.Z),{isEditing:s,isWidget:n}=Un.useContext(WS),i=Un.useRef(0),a=Un.useRef(0);return function(o){if(s||n)return;const{deltaX:r,deltaY:l,currentTarget:d}=o;if(!(d instanceof t))return;const c=Date.now(),h=c-i.current>50;if(i.current=c,!h)return;const u=d.scrollHeight,p=d.clientHeight,g=d.scrollTop;if(Math.floor(g)>0&&Math.ceil(g)+p<u||c-a.current<200)return;if(!o.shiftKey)return;a.current=c,(0===Math.abs(l)?r:l)>0?(d.scrollHeight===d.clientHeight||d.scrollHeight<=d.clientHeight+Math.ceil(d.scrollTop))&&(o.stopPropagation(),TZ.Z.viewNextPeriod(e)):Math.floor(d.scrollTop)<=0&&(o.stopPropagation(),TZ.Z.viewPreviousPeriod(e))}};var aT=s(23542),oT=s(90870);function rT(e){return e.task?e.start?{start:e.start,end:e.end}:{start:e.end,end:e.end?e.end+1:0}:{start:e.start,end:e.end}}function lT(e,t=!1){const s=t?Math.ceil:Math.floor,n=new Date(e);return 4*n.getHours()+s(n.getMinutes()/15)}function dT(e,t){e.items.forEach((s=>{const n=pT(e.items,s,t).sort(((e,t)=>e.stacking-t.stacking));let i=0;for(;n[i]&&i===n[i].stacking;)i++;s.stacking=i,s.adjacent=n}))}function cT(e){e.items.forEach((e=>{const t=new Set(e.adjacent.map((e=>e.stacking))).size;e.stackSize=t+1}))}const hT=(e,t)=>0===t?e:hT(t,e%t),uT=(e,t)=>e*t/hT(e,t);function pT(e,t,s){return e.filter((e=>e!==t&&("day"===s?e.startRow<t.endRow&&e.endRow>t.startRow:e.startCol<t.endCol&&e.endCol>t.startCol)))}const gT=Ci()(((e,t,s)=>{let n=function(e,t){e.sort(((e,t)=>{const{start:s,end:n}=rT(e),{start:i,end:a}=rT(t);if(s!==i)return s-i;const o=n-s,r=a-i;return o!==r?r-o:(parseInt(e.id)||1/0)-(parseInt(t.id)||1/0)}));const s=e.map((e=>{const{start:t,end:s}=rT(e),n=lT(t);let i=lT(s,!0);return 0===i&&t!==s&&(i=96),{event:e,adjacent:[],stacking:1/0,stackSize:-1,startRow:n,endRow:i>n?i:n+1,startCol:0,endCol:0}}));return{columns:-1,maxStackSize:0,items:s}}(e);return dT(n,"day"),cT(n),n=function(e){const t=[...new Set(e.items.map((e=>e.stackSize)))],s=t.reduce(((e,t)=>t>e?t:e),-1),n=Math.min(Math.max(100,s),t.reduce(((e,t)=>uT(e,t)),1)),i=n/s;return{columns:n,maxStackSize:s,items:e.items.map((e=>(e.startCol=Math.ceil(e.stacking*i),e.endCol=Math.floor((e.stacking+1)*i),e)))}}(n),function(e){e.items.sort(((e,t)=>{const s=t.stacking-e.stacking;return 0!==s?s:e.startRow-t.startRow}));const t=[];e.items.forEach((s=>{const n=pT(t,s,"day"),i=Math.min(...n.map((e=>e.startCol)),e.columns),a=i/s.endCol;s.endCol=i,s.startCol=Math.ceil(s.startCol*a),t.push(s)}))}(n),n}),{maxSize:2});const mT=Ci()(((e,t,s)=>{let n=function(e,t,s){const n=t.clone().startOf("day"),i=e=>{let{start:t,end:i}=rT(e);return i===V()(i).startOf("day").valueOf()&&(i-=1),[(0,kf.Z)(V()(t).diff(n,"day"),0,s-1),(0,kf.Z)(V()(i).diff(n,"day")+1,1,s)]};let[a,o]=(0,oT.Z)(e,(e=>{const[t,s]=i(e);return s-t>1}));const r=a.sort(((e,t)=>{const{start:s,end:n}=rT(e),{start:i,end:a}=rT(t),o=(n||u.Lc)-s,r=(a||u.Lc)-i;return o!==r?r-o:s!==i?s-i:(parseInt(e.id)||1/0)-(parseInt(t.id)||1/0)})).map((e=>{const[t,s]=i(e);return{event:e,adjacent:[],stacking:1/0,stackSize:-1,startCol:t,endCol:s,startRow:0,endRow:0}}));o=o.sort(((e,t)=>{if(!e.id||!t.id)return e.id?-1:1;const s=_r.ZP.isMultiDayEvent(e);if(s!==_r.ZP.isMultiDayEvent(t))return s?-1:1;const{start:n,end:i}=rT(e),{start:a,end:o}=rT(t);if(n!==a)return n-a;const r=(i||u.Lc)-n,l=(o||u.Lc)-a;return r!==l?l-r:(parseInt(e.id)||1/0)-(parseInt(t.id)||1/0)}));const l=[],d=n.clone();for(;d.diff(n,"day")<s;){const e=_r.ZP.filterEventsByPeriod(o,d,"day"),t=(0,kf.Z)(d.diff(n,"day"),0,s-1);l.push({events:e,adjacent:[],stacking:1/0,stackSize:-1,startCol:t,endCol:t+1,startRow:0,endRow:0,date:d.valueOf()}),d.add(1,"day")}return{rows:-1,maxStackSize:0,items:r,multiEventItems:l,startTime:n.valueOf(),endTime:d.valueOf()}}(e,t,s);return dT(n,"week"),cT(n),n=(e=>{const t=[...new Set(e.items.map((e=>e.stackSize)))].reduce(((e,t)=>t>e?t:e),0);return{...e,rows:t,maxStackSize:t,items:e.items.map((e=>(e.startRow=e.stacking,e.endRow=e.stacking+1,e)))}})(n),n=(e=>{const t=e.multiEventItems.length?e.rows+1:e.rows,s=e.multiEventItems.map((s=>{const n=pT(e.items,s,"week"),i=Math.max(0,...n.map((e=>e.endRow)));return{...s,startRow:i,endRow:t}}));return{...e,rows:t,multiEventItems:s}})(n),n}),{maxSize:10}),fT=(0,aT.extendMoment)(V()),vT=[Z.kCalendarClickTimeSlot,Z.kCalendarDisplayWeekNumber],{minimalCreateEvent:bT,getDisplayRange:CT}=_r.ZP;function wT(e,t,s,n){const{resizeEvent:i}=t;if(!e||!i)return;const a=e.querySelectorAll(".calendar-drop-target"),o=!t.initialTime,r=t.currentX||1e5,l=t.currentY||1e5,d=Array.from(a).find((e=>{const t=e.getBoundingClientRect();return t.bottom>l&&t.right>r}));if(!d)return;if(o){const e=n??Pr.Z.getEvent(i.dataset.eventId);if(!e)return;t.initialTime=e.start,t.initialEndTime=e.allDay?e.end-be.hd:e.end,t.isAllDay=e.allDay??!1}const c=parseInt(d.dataset.date),h=c+(0,Kc.oR)(t.initialTime),u=c+(0,Kc.oR)(t.initialEndTime);let p,g;return"end"===t.draggingFrom&&u<=t.initialTime||"start"===t.draggingFrom&&h<t.initialEndTime?(p=h,g=t.initialEndTime):(p=t.initialTime,g=u),{startTime:p,endTime:g,isAllDay:t.isAllDay}}function yT(e,t){if(!e)return;const s=Array.from(e.querySelectorAll(".calendar-drop-target")),n=!t.initialTime,i=t.currentX||1e5,a=t.currentY||1e5,o=s.find((e=>{const t=e.getBoundingClientRect();return t.bottom>a&&t.right>i}));if(o&&n){const{resizeEvent:e}=t;if(e)return;t.initialTime=parseInt(o.dataset.date),t.initialEndTime=t.initialTime,t.initialLeftCol=parseInt(o.style.gridColumnStart),t.initialRightCol=t.initialLeftCol+1,t.initialStartRow=parseInt(o.style.gridRowStart),t.initialEndRow=t.initialStartRow+parseInt(o.style.gridRowEnd.match(/\d/)?.[0]),t.isAllDay=!0}if(o){const e=t.initialLeftCol,s=t.initialStartRow,n=parseInt(o.style.gridColumnStart),i=parseInt(o.style.gridRowStart);let a,r,l,d,c,h,u=!0,p="initialStartToCurrent";return(parseInt(o.dataset.date)<t.initialTime||t.resizeEvent&&"start"===t.draggingFrom)&&(p="initialEndToCurrent",u=!1),"initialStartToCurrent"===p?(a=e,r=parseInt(o.style.gridColumnStart)+1,l=s,d=parseInt(o.style.gridRowStart)+parseInt(o.style.gridRowEnd.match(/\d/)?.[0])):(a=n,r=t.initialRightCol,l=i,d=t.initialEndRow),u?(c=t.initialTime,h=parseInt(o.dataset.date)+(0,Kc.oR)(t.initialEndTime)):(c=parseInt(o.dataset.date)+(0,Kc.oR)(t.initialTime),h=t.initialEndTime),{startCol:a,endCol:r,startRow:l,endRow:d,startTime:c,endTime:h,isAllDay:t.isAllDay}}}function xT(e){return e.reduce(((e,t)=>e=(e=e.concat(t.items.map((e=>e.event)))).concat(t.multiEventItems.reduce(((e,t)=>e.concat(t.events)),[]))),[])}function IT(e){const t=(0,Eo.Z)(vT);if(!e.overlay)return null;const{startRow:s,endRow:n,startCol:i,endCol:a,startTime:o,endTime:r}=e.overlay,l="week"===e.displayMode?1:2,d=t[Z.kCalendarDisplayWeekNumber]&&"week"!==e.displayMode?2:1,c="week"===e.displayMode?2:7;return e.grids.reduce((([t,l],h)=>{const u=h.rows+2,p=l===s,g=l+u===n,m=Gn()("calendar-drag-overlay",{left:p,right:g});if(p){const n={gridRowStart:s,gridRowEnd:l+u,gridColumnStart:i,gridColumnEnd:g?a:d+c},h=e.overlay?.isAllDay??1?"L":"LLL";t.push((0,zn.jsxs)("div",{className:m,style:n,children:[(0,zn.jsx)("div",{className:"start-time",children:p&&(0,zn.jsx)(zn.Fragment,{children:fT(o).format(h)})}),(0,zn.jsx)("div",{className:"end-time",children:g&&(0,zn.jsx)(zn.Fragment,{children:fT(r).format(h)})})]},l))}else if(l>s&&l<n){const s={gridRowStart:l,gridRowEnd:l+u,gridColumnStart:d,gridColumnEnd:g?a:d+c},n=e.overlay?.isAllDay??1?"L":"LLL";t.push((0,zn.jsxs)("div",{className:m,style:s,children:[(0,zn.jsx)("div",{className:"start-time",children:p&&(0,zn.jsx)("span",{children:fT(o).format(n)})}),(0,zn.jsx)("div",{className:"end-time",children:g&&(0,zn.jsx)("span",{children:fT(r).format(n)})})]},l))}return[t,l+u]}),[[],l])}function AT(e){const t=e.showWeekNumber?2:1,s=fT().startOf("week");return[...Array(7).keys()].map((e=>{const n=(0,zn.jsx)(Un.Fragment,{children:(0,zn.jsx)("header",{style:{gridColumnStart:e+t},className:"calendar-header-date",children:s.format("dddd")})},e);return s.add(1,"days"),n}))}function ST(e){const{requestAnimationFrame:t}=Un.useContext(oi.Z),{handler:s,pageId:n}=Un.useContext(WS),[i,a]=Un.useState(""),o=(0,Eo.Z)(vT),{displayMode:r,editingEvent:l,grids:d,filter:c,selectedEvent:h,isActiveEditor:u}=e,p=Un.useCallback(((e,t)=>{e.dataTransfer.types.some((e=>e===um))&&(e.preventDefault(),e.stopPropagation(),a(t))}),[]),g=Un.useCallback((e=>{e.dataTransfer.types.some((e=>e===um))&&(e.preventDefault(),e.stopPropagation())}),[]),m=Un.useCallback((e=>{e.dataTransfer.types.some((e=>e===um))&&(e.preventDefault(),e.stopPropagation())}),[]),f=Un.useCallback(((t,s)=>{const i=t.dataTransfer;if(i.types.some((e=>e===um))){t.preventDefault(),t.stopPropagation();const o=JSON.parse(i.getData(um)).id.split("-")[0];if(e.events.find((e=>e.id===o))){("copy"===i.effectAllowed?ie.ZP.copyEvent:ie.ZP.moveEvent)(o,{start:s,byDateOnly:!0},n),a("")}}}),[n,e.events]),v=e.displayRange.start.valueOf(),b=o[Z.kCalendarDisplayWeekNumber]&&"week"!==e.displayMode,C=Un.useMemo((()=>{const n=e.filter;const a=fT(v),r=b?2:1,l=n.anchorDate.month(),d=new Date,c="week"===e.displayMode?2:7;let h="week"===e.displayMode?2:3;return e.grids.flatMap(((u,v)=>{const C=[];return b&&C.push((0,zn.jsx)(Un.Fragment,{children:(0,zn.jsx)("div",{className:"week-number",style:{gridRowStart:h-1,gridRowEnd:`span ${u.rows+2}`},children:(0,zn.jsx)("span",{className:"week-number-value",children:a.week()})})},v)),[...Array(c).keys()].forEach((c=>{if("week"===e.displayMode&&3===v&&1===c)return;const b=`${v}-${c}`,w=a.valueOf(),y=a.month()===l,x=Number(a.format("E"))>5,I="week"!==e.displayMode&&(0===v&&0===c||1===a.date()),A=a.date()===d.getDate()&&a.month()===d.getMonth()&&a.year()===d.getFullYear(),S=n.selectedDate&&a.isSame(n.selectedDate,"day");function T(e){!function(e,t){"click"===e.type&&e.stopPropagation();const n=t+(new Date).getHours()*be.QI;"select"===o[Z.kCalendarClickTimeSlot]||"contextmenu"===e.type?s.selectDate(fT(n),!0):s.editEvent(null,bT({start:n}))}(e,w)}C.push((0,zn.jsx)("div",{className:Gn()("calendar-drop-target",{current:A,"dragged-over":b===i,"out-of-view":"month"===e.displayMode&&!y,weekend:x}),"data-date":w,style:{gridRowStart:h-1,gridRowEnd:`span ${u.rows+2}`,gridColumnStart:c+r},onDragEnter:e=>p(e,b),onDragOver:m,onDragLeave:g,onDrop:e=>f(e,w),onClick:T,onContextMenu:T,children:(0,zn.jsxs)("div",{className:Gn()("day",{current:A}),ref:e=>{S&&e&&t((()=>{e.scrollIntoView({block:"nearest",inline:"nearest"})}))},onClick:e=>{e.stopPropagation(),s.selectDate(fT(w),!0)},children:[a.format("D"),"week"===e.displayMode&&" "+a.format("ddd"),I&&" "+a.format("MMM")]})},b)),a.add(1,"day")})),h+=u.rows+2,C}))}),[i,v,e.displayMode,e.grids,o,e.filter,b,t,s,p,m,g,f]),w=[...C];if(e.filter.selectedDate){const n="week"===e.displayMode?2:7,i=e.filter.selectedDate.valueOf()-v,a=Math.floor(i/(n*be.hd)),o=e.grids.slice(0,a+1).reduce(((e,t)=>e+t.rows+2),0)+("week"===e.displayMode?0:1),r=Math.floor(i/be.hd)%n+(b?2:1),l=!e.selectedEvent&&!e.editingEvent;w.push((0,zn.jsx)("div",{className:Gn()("calendar-add-event-button","selected","bottom",{active:l}),style:{gridRowStart:o,gridRowEnd:"span 1",gridColumnStart:r},ref:e=>{l&&e&&t((()=>{e.scrollIntoViewIfNeeded({block:"nearest",inline:"nearest"})}))},onClick:l?()=>function(e,t){const s=e.selectedDate?e.selectedDate.clone().startOf("day").valueOf()+(new Date).getHours()*be.QI:0;t.editEvent(null,bT({start:s}))}(e.filter,s):nr.Z,dangerouslySetInnerHTML:{__html:Kn.PbG}},"add-event-button"))}const y=Boolean(c.filterText),x=Un.useMemo((()=>({displayStyle:"transparent",isFiltering:y})),[y]);let I=[],A="week"===r?2:3;const S=o[Z.kCalendarDisplayWeekNumber]&&"week"!==r?1:0;return d.forEach(((t,s)=>{I=I.concat(t.items.map((s=>{const n=s.event.end,i=u&&l?.id===s.event.id&&!e.isDragging,a=s.event.id.split("-")[0]===h?.split("-")[0],o=i&&l?l:s.event,r={gridRowStart:s.startRow+A,gridColumnStart:s.startCol+S+1,gridColumnEnd:s.endCol+S+1};return(0,zn.jsx)(eT,{multiDayContinuing:(s.event.start||1/0)<t.startTime,multiDayContinues:n>t.endTime,event:o,style:r,...x,isMultiDay:_r.ZP.isMultiDayEvent(s.event),isSelected:a,isEditing:i,resizeHandler:"horizontal"},`${_r.ZP.generateKey(s.event)}-${r.gridRowStart}`)}))),I=I.concat(t.multiEventItems.map(((n,i)=>{const a=l&&n.events.some((e=>e.id===l.id)),o=new Date(n.date).toDateString(),r=`${s}-${i}`;return(0,zn.jsx)("div",{className:Gn()("event-container",{selected:a}),style:{gridRowStart:n.startRow+A,gridRowEnd:t.rows+A,gridColumnStart:n.startCol+S+1,gridColumnEnd:n.endCol+S+1},onDragEnter:e=>p(e,r),onDragOver:m,onDragLeave:g,onDrop:e=>f(e,n.date),"data-date":n.date,children:n.events.map((s=>{const n=u&&l?.id===s.id&&!e.isDragging,i=s.id.split("-")[0]===h?.split("-")[0],a=n&&l?l:s;return(0,zn.jsx)(eT,{event:a,...x,multiDayContinuing:(s.start||1/0)<t.startTime,multiDayContinues:s.end>t.endTime,isMultiDay:_r.ZP.isMultiDayEvent(s),isSelected:i,isEditing:n,resizeHandler:"horizontal"},_r.ZP.generateKey(s))}))},`${o}-${A}`)}))),A+=t.rows+2})),w.push(...I),w}const ZT=function(e){const t=(0,Eo.Z)(vT),{handler:s,pageId:n}=Un.useContext(WS),i=iT(n),a=Un.useRef(null),[o,r]=Un.useState([]),[l,d]=Un.useState(fT.range()),[c,h]=Un.useState(!1),{gridFrozen:u,handlers:p,overlay:g}=nT(a.current,yT,wT,e.editingEvent,h),m=Un.useRef({selectedEventCache:new Map,lastSelectedEvent:null,updateCreateOverlay:()=>{}}),{events:f,filter:v,displayMode:b}=e;function C(e,t,n,i){const o=a.current;if(!o)return;const r=e||m.current.lastSelectedEvent,l=r?o.querySelector(`[data-event-id="${r.id}"]`):o.querySelector(`#${n.toDate().toDateString()}`),d=n.clone();if("Left"===i?d.subtract(1,"day"):d.add(1,"day"),!l)return m.current.selectedEventCache.clear(),void s.selectDate(d,!0);const c=new IntersectionObserver((e=>{let n;const i=[];for(const s of e){const e=s.boundingClientRect;if(s.target===l)n=e;else{const n=s.target.dataset.eventId,a=t.find((e=>e.id===n));i.push({event:a,element:s.target,bounds:e})}}const a=i.filter((e=>e.bounds.bottom>n.top&&e.bounds.top<n.bottom)).sort(((e,t)=>{const s=(n.top+n.bottom)/2,i=(e.bounds.top+e.bounds.bottom)/2,a=(t.bounds.top+t.bounds.bottom)/2;return Math.abs(i-s)-Math.abs(a-s)}));if(a.length){w({event:a[0].event,date:d})}else s.selectDate(d,!0);c.disconnect()}));c.observe(l);for(const e of t){const t=o.querySelector(`[data-event-id="${e.id}"]`);t&&c.observe(t)}}function w(e){const{event:t}=e;if(t){const e=fT(t.start).format("YYYY-MM-DD");m.current.selectedEventCache.set(e,t),m.current.lastSelectedEvent=t}else m.current.selectedEventCache=new Map,m.current.lastSelectedEvent=null;s.selectEvent({...e,allDay:!0})}Un.useMemo((()=>{let t=f;c&&e.editingEvent&&(t=f.map((t=>t.id===e.editingEvent?.id?e.editingEvent:t)).filter(Boolean));const s=function(e,t,s){const n=CT(t,s),i=[],a=n.start.clone(),o="week"===s?2:7;for(;a<n.end;){const t=a.valueOf(),s=_r.ZP.filterEventsByPeriod(e,a,"day",o).map((e=>(e.start||e.end)<t?{...e,id:`${e.id}-${a.dayOfYear()}`}:e)),r=a.isSame(n.end,"day")?1:o;i.push(mT(s,a,r)),a.add(o,"day")}return{grids:i,displayRange:n}}(t,v.anchorDate,b);r(s.grids),d(s.displayRange)}),[b,f,v.anchorDate,c,e.editingEvent]);let y={};if(u)y=u;else{const t="week"===e.displayMode?"":"max-content ";y.gridTemplateRows=o.reduce(((e,t)=>`${e} 1.9em ${"max-content ".repeat(Math.max(t.rows-1,0))} ${t.rows?"minmax(min-content, max-content) ":""} minmax(20px, 1fr) `),t)}const x=t[Z.kCalendarDisplayWeekNumber]&&"week"!==b;return(0,zn.jsxs)("div",{className:Gn()("calendar-grid calendar-grid-days",`calendar-grid-${e.displayMode}`,{"is-dragging":c,"show-weeknumber":x}),ref:a,onKeyDown:function(t){const i=xT(o),a=t.altKey;if(!e.editingEvent){const o="week"===e.displayMode?2:7,r=i.find((t=>t.id===e.selectedEvent)),{selectedDate:d}=e.filter;if(!d)return void console.error("Can not navigate day grid. No selected calendar date.");const c=d.weekday();switch(JS.Z[t.keyCode]){case"Left":{if(c%o==0)break;const e=d.clone().subtract(1,"day"),t=e.format("YYYY-MM-DD"),n=m.current.selectedEventCache.get(t);if(n){w({event:n,date:e});break}if(r||m.current.lastSelectedEvent){C(r,_r.ZP.filterEventsByPeriod(i,e,"day"),d,"Left")}else s.selectDate(e,!0);break}case"Right":{if(c%o==o-1||6===c)break;const e=d.clone().add(1,"day"),t=e.format("YYYY-MM-DD"),n=m.current.selectedEventCache.get(t);if(n){w({event:n,date:e});break}if(r||m.current.lastSelectedEvent){C(r,_r.ZP.filterEventsByPeriod(i,e,"day"),d,"Right")}else s.selectDate(e,!0);break}case"Up":{m.current.selectedEventCache=new Map,m.current.lastSelectedEvent=null;const t=_r.ZP.filterEventsByPeriod(i,d,"day"),n=t.findIndex((t=>t.id===e.selectedEvent));if(-1===n&&t.length&&!a)w({event:t[t.length-1],date:d});else if(0===n||!t.length||a){let t=o;"week"===e.displayMode&&c<2&&(t=0===c?1:3),s.selectDate(d.clone().subtract(t,"day"),!0)}else w({event:t[n-1],date:d});break}case"Down":{m.current.selectedEventCache=new Map,m.current.lastSelectedEvent=null;let t=_r.ZP.filterEventsByPeriod(i,d,"day");const n=t.findIndex((t=>t.id===e.selectedEvent));let r=o;if("week"===e.displayMode&&c>=5&&(r=5===c?3:1),a){const e=d.clone().add(r,"day");s.selectDate(e,!0)}else if(-1===n){const e=d.clone().add(r,"day");if(e.isAfter(l.end,"day")){const s=sh.tV.call(Pr.Z.getEvents(),e,"day");t=xT([mT(s,e,1)])}else t=_r.ZP.filterEventsByPeriod(i,e,"day");t.length?w({event:t[0],date:e}):s.selectDate(e,!0)}else n===t.length-1?w({event:null}):w({event:t[n+1],date:d});break}case"Enter":if((0,wi.ZP)(t),e.selectedEvent){const t=i.find((t=>t.id===e.selectedEvent));s.editEvent(t)}else{const e=d.clone().hours((new Date).getHours()).valueOf();s.editEvent(null,bT({start:e}))}break;case"Space":const h=e.selectedEvent&&i.find((t=>t.id===e.selectedEvent));if(h&&h.task){(0,wi.ZP)(t);const e={...h,complete:!h.complete};ie.ZP.updateEvent(e,"single",!0,n)}break;case"Escape":(0,wi.ZP)(t),e.selectedEvent&&w({event:null})}}},draggable:!0,...p,style:y,tabIndex:"0",onWheel:i,children:["week"!==e.displayMode&&(0,zn.jsx)(AT,{showWeekNumber:x}),(0,zn.jsx)(ST,{grids:o,events:f,displayRange:l,displayMode:b,editingEvent:e.editingEvent,selectedEvent:e.selectedEvent,filter:v,isActiveEditor:!!e.editingEvent,isDragging:c,setIsDragging:h}),(0,zn.jsx)(IT,{overlay:g,displayMode:b,grids:o})]})};function TT(e){return"time"in e}function ET(e,t,s,n){let i,a,o;const r=s||t;let l;const d=n[8];switch(e){case"Left":l=r.isAllDay?r:t,i=e=>e.navigation.right<r.navigation.right&&e.navigation.top<l.navigation.bottom&&e.navigation.bottom>l.navigation.top,a=(e,t)=>t.navigation.right-e.navigation.right,o=(e,t)=>e.navigation.top-t.navigation.top;break;case"Right":l=r.isAllDay?r:t,i=e=>e.navigation.right>r.navigation.right&&e.navigation.left>=r.navigation.left&&e.navigation.top<l.navigation.bottom&&e.navigation.bottom>l.navigation.top,a=(e,t)=>e.navigation.left-t.navigation.left,o=(e,t)=>e.navigation.top-t.navigation.top;break;case"Up":{const e=d.display.bottom-d.display.top-1;l=r.isAllDay?t:r,i=e=>e.navigation.bottom<=r.navigation.top&&e.navigation.left<l.navigation.right&&e.navigation.right>l.navigation.left,a=(t,s)=>{const n=TT(t)||t.isAllDay?t.navigation.bottom:t.navigation.bottom+e;return(TT(s)||s.isAllDay?s.navigation.bottom:s.navigation.bottom+e)-n},o=(e,t)=>e.navigation.left-t.navigation.left;break}case"Down":{const e=d.display.bottom-d.display.top-1;l=r.isAllDay?t:r,i=e=>e.navigation.top>=r.navigation.bottom&&e.navigation.left<l.navigation.right&&e.navigation.right>l.navigation.left,a=(t,s)=>(!TT(t)||t.isAllDay?t.navigation.top-e:t.navigation.top)-(!TT(s)||s.isAllDay?s.navigation.top-e:s.navigation.top),o=(e,t)=>e.navigation.left-t.navigation.left;break}default:return}const c=n.filter(i).sort(((e,t)=>{const s=a(e,t);return 0!==s?s:TT(e)!==TT(t)?TT(e)?1:-1:o(e,t)}));return c.length?c[0]:null}var kT=s(98891),NT=s(84584),_T=s(34155);const PT=[Z.kCalendarCollapseHours,Z.kCalendarClickTimeSlot,Z.kCalendarDayEnds,Z.kCalendarDayStarts,Z.kCalendarOnlyHourlyKeynav,Z.kCalendarTimeIncrements],{minimalCreateEvent:MT}=_r.ZP,DT={day:{row:2,column:2},week:{row:2,column:2},year:{row:1,column:2}},OT=96,jT={adjacent:[],stacking:0,stackSize:0,startRow:0,endRow:1,startCol:0,endCol:1};function LT(e,t,s){const n=V()();if(e.isSame(n,t)){const e=lT(n.valueOf())+DT[t].row,i=Math.round(n.minutes()%15/15*100);let a=0,o=s[0]+1;if("week"===t){const e=n.weekday();a=(0,kT.Z)(s.slice(0,e))+e,o=s[e]+1}return{row:e,percentage:i,column:a,columnSpan:o}}}function RT(e,t,s,n){const i=n?(0,kT.Z)(n.slice(0,s.startCol)):s.startCol,a=n?(0,kT.Z)(n.slice(0,s.endCol)):s.endCol;return{left:t+i,top:e+s.startRow,right:t+a,bottom:e+s.endRow}}const BT=Ci()((function(e,t,s,n,i,a){const[o,r]=(0,oT.Z)(e,_r.ZP.isMultiDayEvent);o.sort(((e,t)=>e.start!==t.start?e.start-t.start:e.end!==t.end?e.end-t.end:(parseInt(e.id)||1/0)-(parseInt(t.id)||1/0)));const[l,d,c]=function(e,t,s,n){const i=[];if("day"===n)i.push(gT(e,s));else if("week"===n){const t=s.clone().startOf("week");[...Array(7).keys()].forEach((s=>{const n=_r.ZP.filterEventsByPeriod(e,t,"day");i.push(gT(n,t)),t.add(1,"days")}))}let a;if("day"===n){const e=s.clone().startOf("day").valueOf();a={maxStackSize:1,rows:t.length,items:[],multiEventItems:t.length?[{...jT,date:s.valueOf(),events:t}]:[],startTime:e,endTime:e+be.hd}}else a=mT(t,s.clone().startOf("week"),7);const o=i.map((e=>e.columns));return[i,a,o]}(r,o,t,s),{timeCells:h,eventCells:u}=function(e,t,s,n,i,a,o,r){function l(e){return 60*e.hour()+e.minute()}const d=V()(e).startOf(t),c=i.map((e=>e+1)),h=n?n.rows+1:1;let u,p,g=[],m=DT[t].row,f=[];if(m=DT[t].row,u=DT[t].column,n){const e={start:n.startTime,end:n.startTime+be.S};f=f.concat(n.items.map((t=>{const s=RT(m,u,t,c);return{display:s,navigation:s,isAllDay:!0,event:t.event,time:e}}))),f=f.concat(n.multiEventItems.map((t=>{const s=RT(m,u,t,c);return{display:s,navigation:s,isAllDay:!0,events:t.events,time:e}})))}m+=h,u=DT[t].column,f=f.concat(s.flatMap((e=>{const t=e.items.map((e=>({display:{...RT(m,u,e)},navigation:{...RT(m,u,e)},isAllDay:!1,event:e.event})));return u+=e.columns+1,t}))),m=DT[t].row,u=DT[t].column,p=d.clone(),g=g.concat(c.map((e=>{const t=p.valueOf();p.add(1,"day");const s=p.valueOf(),n=u,i=m,a=u+e,o=m+h,r=f.filter((e=>e.navigation.left<a&&e.navigation.right>n&&e.navigation.top<o&&e.navigation.bottom>i)).reduce(((e,t)=>Math.max(e,t.navigation.bottom)),i);return u+=e,{display:{left:n,top:i,right:a,bottom:o},navigation:{left:n,top:r,right:a,bottom:o},isAllDay:!0,time:{start:t,end:s}}}))),m+=h,u=DT[t].column,p=d.clone();const v=Math.max(60*a-r,0),b=60*o;return p.add(v,"minute"),g=g.concat(c.flatMap(((e,t)=>{const s=[];for(;p.diff(d,"day")===t;){const t=u,n=l(p)===v?m:m+l(p)/15,i=u+e,a=p.valueOf();p.add(r,"minute");const o=l(p),d=o>b||0===o?m+OT:m+l(p)/15,c=p.valueOf(),h=f.filter((e=>e.navigation.left<i&&e.navigation.right>t&&e.navigation.top<d&&e.navigation.bottom>n)),g=h.reduce(((e,t)=>Math.max(e,t.navigation.right)),t),C={display:{left:t,top:n,right:i,bottom:d},navigation:{left:g,top:n,right:i,bottom:d},isAllDay:!1,time:{start:a,end:c}};l(p)>b&&(p.add(1,"day").startOf("day"),C.time.end=p.valueOf(),p.add(v,"minute")),s.push(C)}return u+=e,s}))),{timeCells:g,eventCells:f}}(t,s,l,d,c,n,i,a);return{grids:l,gridColumns:c,allDayGrid:d,timeCells:h,eventCells:u}}),{maxSize:2});function FT(e,t,s){const n=e?.querySelectorAll(".quarter"),i=e?.querySelectorAll(".calendar-background-day");if(n&&i){let e=!1;const a=[...n].find(((t,n)=>{const i=t.getBoundingClientRect(),a=i.bottom>s;return a&&0===n&&s<i.top&&(e=!0),a})),o=[...i].find((e=>e.getBoundingClientRect().right>t));if(a&&o)return{currentRow:a,currentCol:o,isAllDayRow:e}}return{}}function WT(e,t,s,n){const{resizeEvent:i}=t;if(!e||!i)return;const a=t.currentX??1e5,o=t.currentY??1e5,{currentRow:r,currentCol:l,isAllDayRow:d}=FT(e,a,o);if(r&&l){const e=!t.initialTime,a=e?Boolean(d):s?.isAllDay||!1;if(e){const e=n??Pr.Z.getEvent(i.dataset.eventId);if(!e)return;t.initialTime=e.start,t.initialEndTime=e.allDay?e.end-be.hd:e.end}const o=a?parseInt(l.dataset.date):parseInt(l.dataset.date)+parseInt(r.dataset.starttime),c=a?parseInt(l.dataset.date)+be.hd:parseInt(l.dataset.date)+parseInt(r.dataset.endtime);let h,u;return"end"===t.draggingFrom&&c<=t.initialTime||"start"===t.draggingFrom&&o<t.initialEndTime?(h=o,u=t.initialEndTime):(h=t.initialTime,u=c),{startTime:h,endTime:u,isAllDay:a}}}function UT(e,t,s){if(!e)return;const n=t.currentX??1e5,i=t.currentY??1e5;let{currentRow:a,currentCol:o,isAllDayRow:r}=FT(e,n,i);if(a&&o){const e=!t.initialTime,n=e?Boolean(r):s?.isAllDay||!1;if(e){if(t.resizeEvent)return;t.initialTime=parseInt(o.dataset.date)+parseInt(a.dataset.starttime),t.initialEndTime=parseInt(o.dataset.date)+parseInt(a.dataset.endtime),t.initialStartRow=parseInt(a.style.gridRowStart),t.initialEndRow=parseInt(a.style.gridRowEnd),t.initialLeftCol=parseInt(o.style.gridColumnStart),t.initialRightCol=parseInt(o.style.gridColumnEnd)}n&&(a=o);const i=t.initialLeftCol,l=t.initialStartRow,d=parseInt(o.style.gridColumnStart),c=parseInt(a.style.gridRowStart);let h,u,p,g,m,f,v=!0;return i<d?n?("start"===t.draggingFrom?(h=parseInt(o.style.gridColumnStart),u=t.initialRightCol):(h=i,u=parseInt(o.style.gridColumnEnd)),p=parseInt(a.style.gridRowStart),g=l):(h=i,u=parseInt(o.style.gridColumnEnd),p=l,g=parseInt(a.style.gridRowEnd)):i>d?(h=parseInt(o.style.gridColumnStart),u=t.initialRightCol,p=parseInt(a.style.gridRowStart),g=t.initialEndRow,v=!1):(h=i,u=t.initialRightCol,"end"===t.draggingFrom&&l<=c||"start"===t.draggingFrom&&t.initialEndRow<=c?(p=l,g=parseInt(a.style.gridRowEnd)):(p=c,g=t.initialEndRow,v=!1)),v?(m=t.initialTime,f=n?parseInt(o.dataset.date):parseInt(o.dataset.date)+parseInt(a.dataset.endtime)):(m=n?parseInt(o.dataset.date):parseInt(o.dataset.date)+parseInt(a.dataset.starttime),f=t.initialEndTime),{startCol:h,endCol:u,startRow:p,endRow:g,startTime:m,endTime:f,isAllDay:n}}}function VT(e){if(!e.overlay)return null;const{startRow:t,endRow:s,startCol:n,endCol:i,startTime:a,endTime:o,isAllDay:r}=e.overlay,l={gridRowStart:t,gridRowEnd:s,gridColumnStart:n,gridColumnEnd:i};if(r)return(0,zn.jsxs)("div",{className:"calendar-drag-overlay start end",style:l,children:[(0,zn.jsx)("div",{className:"start-time",children:V()(a).format("L")}),(0,zn.jsx)("div",{className:"end-time",children:V()(o).format("L")})]});{const[t]=e.columnSizes.reduce((([t,r],d)=>{const c=d+1,h=r===n,u=i>r&&i<=r+c,p=Gn()("calendar-drag-overlay",{start:h,end:u});return h?(l.gridRowEnd=u?s:e.rowOffset+OT,l.gridColumnEnd=r+d,t.push((0,zn.jsxs)("div",{className:p,style:{...l},children:[(0,zn.jsx)("div",{className:"start-time",children:h&&(0,zn.jsx)(zn.Fragment,{children:V()(a).format("LT")})}),(0,zn.jsx)("div",{className:"end-time",children:u&&(0,zn.jsx)(zn.Fragment,{children:V()(o).format("LT")})})]},r))):r>n&&r<i&&(l.gridRowStart=e.rowOffset,l.gridColumnStart=r,l.gridColumnEnd=r+d,l.gridRowEnd=u?s:e.rowOffset+OT,t.push((0,zn.jsxs)("div",{className:p,style:{...l},children:[(0,zn.jsx)("div",{className:"start-time",children:h&&(0,zn.jsx)("span",{children:V()(a).format("LT")})}),(0,zn.jsx)("div",{className:"end-time",children:u&&(0,zn.jsx)("span",{children:V()(o).format("LT")})})]},r))),[t,r+c]}),[[],e.colOffset]);return t}}function HT(e){const{handler:t}=Un.useContext(WS),s=(0,Eo.Z)([Z.kCalendarCollapseHours,Z.kCalendarDayEnds,Z.kCalendarDayStarts,Z.kCalendarTimeIncrements,Z.kCalendarOnlyHourlyDivider]),{anchorDate:n,displayMode:i,allDayGrid:a,filter:o}=e;return Un.useMemo((function(){function e(e,s){e.stopPropagation();const n=V()(o.selectedDate).hours(s);t.selectDate(n,!1)}const r=s[Z.kCalendarCollapseHours],l=r?s[Z.kCalendarDayStarts]:0,d=r&&s[Z.kCalendarDayEnds]||24,c=n.clone().startOf("day").hour(l),h=parseInt(s[Z.kCalendarTimeIncrements]);let u=DT[i].row;a&&(u+=a.rows+1);const p=(0,NT.Z)(l,d);let g=[];g=15===h?[{rowOffset:0,span:1,startOffset:0,endOffset:9e5},{rowOffset:1,span:1,startOffset:9e5,endOffset:18e5},{rowOffset:2,span:1,startOffset:18e5,endOffset:27e5},{rowOffset:3,span:1,startOffset:27e5,endOffset:36e5}]:30===h?[{rowOffset:0,span:2,startOffset:0,endOffset:18e5},{rowOffset:2,span:2,startOffset:18e5,endOffset:36e5}]:[{rowOffset:0,span:4,startOffset:0,endOffset:36e5}];const m=V()().localeData().longDateFormat("LT").match(/[aA]/)?.[0],f=m?`h ${m}`:"H:mm",v=m?V()().startOf("day").format(f):"0:00";return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("div",{className:"hour-track",style:{gridRowEnd:OT+u}}),l>0&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("div",{className:"hour",onClick:t=>e(t,l-1),style:{gridRowStart:u,gridRowEnd:"span "+4*l},children:(0,zn.jsx)("div",{className:"hour-value",children:v})}),(0,zn.jsx)("div",{className:"quarter collapsed morning","data-starttime":l*be.QI-h*be.lb,"data-endtime":l*be.QI,style:{gridRowStart:u,gridRowEnd:u+4*l}}),(0,zn.jsx)("div",{className:"hour-line",style:{gridRowStart:u}})]}),p.map(((t,n)=>{const i=u+4*t,a=(0,zn.jsxs)(Un.Fragment,{children:[(0,zn.jsx)("div",{className:"hour",onClick:s=>e(s,t),style:{gridRowStart:i},children:(0,zn.jsx)("div",{className:"hour-value",children:c.format(f)})}),g.map(((e,n)=>(0,zn.jsxs)(Un.Fragment,{children:[(0,zn.jsx)("div",{className:"quarter",style:{gridRowStart:i+e.rowOffset,gridRowEnd:i+e.rowOffset+e.span},"data-starttime":t*be.QI+e.startOffset,"data-endtime":t*be.QI+e.endOffset}),0!==n&&!s[Z.kCalendarOnlyHourlyDivider]&&(0,zn.jsx)("div",{className:"quarter-line",style:{gridRowStart:i+e.rowOffset}})]},e.rowOffset))),(0,zn.jsx)("div",{className:"hour-line",style:{gridRowStart:i}})]},`fr${n}`);return c.add(1,"hour"),a})),d<24&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("div",{className:"hour-line",style:{gridRowStart:u+4*d}}),(0,zn.jsx)("div",{className:"hour",onClick:t=>e(t,c.hour()),style:{gridRowStart:u+4*d},style:{gridRowStart:u+4*d,gridRowEnd:u+96},children:(0,zn.jsx)("div",{className:"hour-value",children:c.format(f)})}),(0,zn.jsx)("div",{className:"quarter collapsed evening","data-starttime":d*be.QI,"data-endtime":d*be.QI+h*be.lb,style:{gridRowStart:u+4*d,gridRowEnd:u+OT}})]}),(0,zn.jsx)("div",{className:"hour hour-last",style:{gridRowStart:u+OT-1},children:(0,zn.jsx)("div",{className:"hour-value",children:v})})]})}),[s,a,n,i,t,o])}function GT(e){const{anchorDate:t,displayMode:s,gridColumns:n,filter:i,inPanel:a}=e,{handler:o}=Un.useContext(WS);return Un.useMemo((function(){const e=[];if("week"===s){const s=t.clone().startOf("week");let a=2;n.forEach(((t,n)=>{const r=s.format(F.ZP.getWeekdayFormat(F.ZP.getShortDateFormat())),l=s.valueOf();e.push((0,zn.jsxs)(Un.Fragment,{children:[(0,zn.jsx)("header",{style:{gridRowStart:1,gridColumnStart:a,gridColumnEnd:a+t+1},className:Gn()("calendar-header-date",{current:(0,Kc.KC)(s.toDate(),new Date)}),onClick:e=>{e.stopPropagation();const t=V()(l).hours(i.selectedDate?.hours()??0);o.selectDate(t,i.allDaySelected)},children:r}),(0,zn.jsx)("div",{style:{gridRowStart:2,gridRowEnd:"grid-bottom",gridColumnStart:a,gridColumnEnd:a+t+1},className:Gn()("calendar-background-day",{weekend:s.day()%6==0}),"data-date":s.valueOf()})]},n)),a+=t+1,s.add(1,"days")}))}else e.push((0,zn.jsxs)(Un.Fragment,{children:[(0,zn.jsx)("header",{style:{gridRowStart:1,gridColumnStart:2,gridColumnEnd:n[0]+3},className:Gn()("calendar-header-date",{current:(0,Kc.KC)(t.toDate(),new Date)}),children:t.format(F.ZP.getWeekdayFormat(a?"ll":"LL"))}),(0,zn.jsx)("div",{style:{gridRowStart:2,gridRowEnd:"grid-bottom",gridColumnStart:2,gridColumnEnd:n[0]+3},className:Gn()("calendar-background-day",{weekend:t.day()%6==0}),"data-date":t.clone().startOf("day").valueOf()})]},"day"));return e}),[t,s,n,a,o,i])}function KT(e){return e.marker?[(0,zn.jsx)("div",{className:"current-time",style:{gridRowStart:e.marker.row,gridColumnStart:e.marker.column+2,gridColumnEnd:`span ${e.marker.columnSpan}`},children:(0,zn.jsx)("span",{className:"marker",style:{top:`${e.marker.percentage}%`}})},"marker")]:null}function zT(e){const{requestAnimationFrame:t}=Un.useContext(oi.Z),{editEvent:s}=Un.useContext(WS).handler,{cells:n,selectedEvent:i,editingEvent:a,allDaySelected:o,selectedDate:r}=e;return Un.useMemo((function(){return n.map(((e,n)=>{const{display:l,isAllDay:d,navigation:c,time:h}=e;if(!h)return null;const u=r?.valueOf(),p=u&&o===d&&h.start<=u&&h.end>u;if(!p)return null;const g=p&&!i&&!a;return(0,zn.jsx)("div",{className:Gn()("calendar-add-event-button selected",{active:g,"with-event":c.left!==l.left}),onClick:e=>{e.stopPropagation(),s(null,MT({start:h.start,allDay:d}))},style:{gridRowStart:c.top,gridRowEnd:c.bottom,gridColumnStart:c.left,gridColumnEnd:c.right},ref:e=>e&&t((()=>{e.scrollIntoView({block:"nearest",inline:"nearest"})})),dangerouslySetInnerHTML:{__html:Kn.PbG}},`sel${n}`)}))}),[o,n,s,a,r,i,t])}function $T(e){const t=Boolean(e.filter.filterText),s=Un.useMemo((()=>({displayStyle:"solid",isFiltering:t})),[t]),{cells:n,editingEvent:i,selectedEvent:a,displayMode:o,anchorDate:r}=e;return Un.useMemo((()=>n.map(((t,n)=>{if(t.event){const n=t.event;if(!n)return null;const o=i?.id===n.id&&!e.isDragging,r=n.id.split("-")[0]===a?.split("-")[0],l=o&&i?i:n,d=_r.ZP.generateKey(n,t.isAllDay?`${t.display.left}${t.display.right}`:`${t.display.left}${t.display.top}`),c=t.time&&n.start<t.time.start,h=t.time&&n.end>t.time.end;return(0,zn.jsx)(eT,{...s,style:{gridRowStart:t.display.top,gridRowEnd:t.display.bottom,gridColumnStart:t.display.left,gridColumnEnd:t.display.right},event:l,isMultiDay:_r.ZP.isMultiDayEvent(n),isSelected:r,isEditing:o,resizeHandler:t.isAllDay?"horizontal":"vertical",multiDayContinuing:c,multiDayContinues:h},d)}if(t.events){const n=t.events;if(!n.length)return null;const l=_r.ZP.generateKey(n[0]);return(0,zn.jsx)("div",{className:Gn()("event-container",{"calendar-day-allday":t.isAllDay&&"day"===o}),style:{gridRowStart:t.display.top,gridRowEnd:t.display.bottom,gridColumnStart:t.display.left,gridColumnEnd:t.display.right},children:n.map((n=>{const o=i?.id===n.id&&!e.isDragging,l=n.id.split("-")[0]===a?.split("-")[0],d=o&&i?i:n;return(0,zn.jsx)(eT,{...s,event:d,isMultiDay:_r.ZP.isMultiDayEvent(n),isSelected:l,isEditing:o,resizeHandler:t.isAllDay?"horizontal":"vertical",dayOutOfTotalDays:r},`${_r.ZP.generateKey(n,e.fromWidget?"widget":"")}`)}))},`${l}-${t.display.top}`)}}))),[n,i,e.isDragging,e.fromWidget,a,s,o,r])}const YT=function(e){const{handler:t,pageId:s,isWidget:n}=Un.useContext(WS),{editEvent:i,selectDate:a,selectEvent:o}=t,{requestAnimationFrame:r,HTMLElement:l}=Un.useContext(oi.Z),d=iT(s),c=Un.useRef(null),[h,u]=Un.useState(null),[p,g]=Un.useState([]),[m,f]=Un.useState([]),[v,b]=Un.useState([]),[C,w]=Un.useState(!1),[y,x]=Un.useState(),[I,A]=Un.useState(),S=(0,Eo.Z)(PT),T=Un.useRef({updateTimer:null,updateCreateOverlay:()=>{},isResizing:!1,hover:{x:0,y:0,updateRequested:!1}});Un.useEffect((()=>(T.current.updateTimer||(T.current.updateTimer=setInterval((()=>{x(LT(e.anchorDate,e.displayMode,p))}),6e4)),()=>{T.current.updateTimer&&clearInterval(T.current.updateTimer)})));const{anchorDate:E,displayMode:k,events:N}=e,_=S[Z.kCalendarCollapseHours],P=_?S[Z.kCalendarDayStarts]:0,M=_&&S[Z.kCalendarDayEnds]||24,D=S[Z.kCalendarOnlyHourlyKeynav]?60:S[Z.kCalendarTimeIncrements];Un.useMemo((()=>{let t=N;C&&e.editingEvent&&(t=N.map((t=>t.id===e.editingEvent?.id?e.editingEvent:t)).filter(Boolean));const s=BT(t,E,k,P,M,D);g(s.gridColumns),u(s.allDayGrid),f(s.timeCells),b(s.eventCells)}),[E,k,P,M,N,D,C,e.editingEvent]),Un.useMemo((()=>{const e=LT(E,k,p);e&&h&&(e.row=e.row+h.rows+1),x(e)}),[E,k,h,p]);const{gridFrozen:O,handlers:j,overlay:L,dragOffset:R}=nT(c.current,UT,WT,e.editingEvent,w),B=()=>{if(T.current.hover.x&&T.current.hover.y){const{currentRow:e,currentCol:t,isAllDayRow:s}=FT(c.current,T.current.hover.x,T.current.hover.y);e&&t?A({gridColumnStart:parseInt(t.style.gridColumnStart),gridRowStart:s?2:parseInt(e.style.gridRowStart),gridColumnEnd:parseInt(t.style.gridColumnEnd),gridRowEnd:s?parseInt(e.style.gridRowStart):parseInt(e.style.gridRowEnd)||parseInt(e.style.gridRowStart)+1}):A()}T.current.hover.updateRequested=!1},F=e=>{if(e.target!==e.currentTarget||T.current.isResizing)return;const{currentRow:s,currentCol:n,isAllDayRow:i}=FT(c.current,e.clientX,e.clientY);if(s&&n){"click"===e.type&&e.stopPropagation();const a=parseInt(n.dataset.date)+parseInt(s.dataset.starttime);"select"===S[Z.kCalendarClickTimeSlot]||"contextmenu"===e.type?t.selectDate(V()(a),i):t.editEvent(null,MT({start:a,allDay:i})),A()}},W={...j,onDragOver:e=>{e.dataTransfer.types.some((e=>e===um))?(T.current.hover.x=e.clientX-(R.xOffset??0),T.current.hover.y=e.clientY-(R.yOffset??0),T.current.hover.updateRequested||(r(B),T.current.hover.updateRequested=!0),(0,wi.ZP)(e)):j.onDragOver(e)},onDrop:e=>{const t=e.dataTransfer;if(t.types.some((e=>e===um))){(0,wi.ZP)(e);const{currentRow:n,currentCol:i,isAllDayRow:a}=FT(c.current,e.clientX-(R.xOffset??0),e.clientY-(R.yOffset??0));if(n&&i){const e=parseInt(i.dataset.date)+parseInt(n.dataset.starttime),o=JSON.parse(t.getData(um)).id;("copy"===t.effectAllowed?ie.ZP.copyEvent:ie.ZP.moveEvent)(o,{start:e,allDay:a},s)}}else j.onDrop(e)}},{allDaySelected:U,selectedDate:H}=e.filter,G=Un.useCallback((t=>{if(!(t.shiftKey||t.ctrlKey||t.metaKey))if(H){if(!e.editingEvent){const n=JS.Z[t.keyCode],r=t.altKey;switch(n){case"Up":case"Down":case"Left":case"Right":t.preventDefault();const l=r?[]:v,[d,c,h]=function(e,t,s,n,i,a=!1){const o=n.valueOf(),r=t.find((e=>e.isAllDay===a&&e.time.start<=o&&e.time.end>o));if(!r)return[null,null,!1];const l=s.find((e=>e.event&&e.event.id===i||e.events&&e.events.some((e=>e.id===i)))),d=l||r;if(d.events&&("Up"===e||"Down"===e)){const t=d.events.findIndex((e=>e.id===i));if("Up"===e&&t>0||"Down"===e&&t<d.events.length-1){const s="Up"===e?-1:1,n=d.events[t+s];return[r.time&&r.time.start,n,r.isAllDay]}}let c;switch(e){case"Up":case"Down":case"Left":case"Right":c=ET(e,r,l,[...t,...s])}if(c){let s;if(c.time)return[c.time.start,null,c.isAllDay];if(c.event)s=c.event;else if(c.events){const t="Up"===e?c.events.length-1:0;s=c.events[t]}if(s){if(function(e,t){return e.time.start<(t.end||1/0)&&e.time.end>t.start}(r,s))return[r.time&&r.time.start,s,c.isAllDay];let n;if(n=d.isAllDay?function(e,t,s){let n;n="Left"===s?t=>t.navigation.right===e.navigation.right:t=>t.navigation.left===e.navigation.left;const i=t.filter(n).sort(((e,t)=>e.navigation.top-t.navigation.top));return i.length?i[0]:null}(c,[...t],e):ET(e,r,null,[...t]),n&&n.time)return[n.time.start,s,c.isAllDay]}}return[null,null,!1]}(n,m,l,H,e.selectedEvent,U);if(!d){let e;switch(n){case"Left":e=H.clone().subtract(1,"day");break;case"Right":e=H.clone().add(1,"day")}return void(e&&a(e,U))}(c||e.selectedEvent)&&o({event:c,date:V()(d),allDay:h}),c||a(V()(d),h);break;case"Enter":if(t.preventDefault(),e.selectedEvent){const t=N.find((t=>t.id===e.selectedEvent));i(t)}else{const e=H.valueOf();i(null,MT({start:e,allDay:U}))}break;case"Space":const u=e.selectedEvent&&N.find((t=>t.id===e.selectedEvent));if(u&&u.task){(0,wi.ZP)(t);const e={...u,complete:!u.complete};ie.ZP.updateEvent(e,"single",!0,s)}break;case"Escape":t.preventDefault(),e.selectedEvent&&o({})}A()}}else console.error("Can not navigate hour grid. No selected calendar date.")}),[v,m,e.selectedEvent,N,e.editingEvent,U,H,i,a,o,s]);let K={};if(O)K=O;else{const t="auto ",s=p.reduce(((e,s)=>`${e} ${t.repeat(s)} 16px`),"var(--calendar-hour-column-width) ");K.gridTemplateColumns=s+" [grid-right]";let n="";DT[e.displayMode].row-1&&(n="max-content ");const i=S[Z.kCalendarCollapseHours],a=i?S[Z.kCalendarDayStarts]:0,o=i&&S[Z.kCalendarDayEnds]||24;let r=a>0?`repeat(${4*a}, min-content) `:"";r+=`repeat(${4*(24-a-(24-o))}, auto) `,r+=o<24?`repeat(${4*(24-o)}, min-content) `:"",h?.rows&&(n+=`repeat(${h.rows}, min-content) `),n+=`1.5em ${r} [grid-bottom]`,K.gridTemplateRows=n}return(0,zn.jsxs)("div",{className:Gn()("calendar-grid calendar-grid-hours",`calendar-grid-${e.displayMode}`,{"is-dragging":C}),ref:c,onKeyDown:G,style:K,tabIndex:"0",draggable:!0,...W,onMouseDown:e=>{e.target instanceof l&&e.target.className.includes("calendar-event-resizer")&&(T.current.isResizing=!0)},onMouseUp:e=>{_T.nextTick((()=>T.current.isResizing=!1))},onMouseMove:e=>{T.current.hover.x=e.clientX,T.current.hover.y=e.clientY,T.current.hover.updateRequested||(r(B),T.current.hover.updateRequested=!0)},onContextMenu:F,onClick:F,onWheel:d,children:[(0,zn.jsx)(GT,{anchorDate:E,displayMode:k,gridColumns:p,filter:e.filter,inPanel:e.inPanel??!1}),(0,zn.jsx)(HT,{allDayGrid:h,anchorDate:E,displayMode:k,filter:e.filter}),I&&(0,zn.jsx)("div",{className:"calendar-grid-hover",style:I}),(0,zn.jsx)(zT,{cells:m,editingEvent:e.editingEvent,allDaySelected:e.filter.allDaySelected,selectedDate:e.filter.selectedDate,selectedEvent:e.selectedEvent}),(0,zn.jsx)(KT,{marker:y}),(0,zn.jsx)($T,{cells:v,editingEvent:e.editingEvent,filter:e.filter,isDragging:C,selectedEvent:e.selectedEvent,displayMode:e.filter.displayMode,anchorDate:E,fromWidget:n}),(0,zn.jsx)(VT,{overlay:L,rowOffset:DT[e.displayMode].row+(h&&h.rows+1||0),colOffset:DT[e.displayMode].column,columnSizes:p})]})},XT=[Z.kCalendarDisplayWeekNumber];function QT(e){const t=Pr.Z.getCalendars().find((t=>t.id===e.event.calendarId));let s,n;e.event.end&&!e.event.start?(n=Math.max(2,Math.floor((e.event.end-e.startTime)/be.lq)),s=n-2):(s=Math.max(0,Math.floor((e.event.start-e.startTime)/be.lq)),n=Math.max(Math.min(96,Math.floor((e.event.end-e.startTime)/be.lq)),s+1));return(0,zn.jsx)("line",{stroke:"var(--colorCalendarBg)",style:_r.ZP.getCalendarColorStyles(t),x1:110,x2:110,y1:s,y2:n})}function qT(e){const t=Pr.Z.getCalendars().find((t=>t.id===e.event.calendarId)),s=Math.floor(48-10*(e.count-1)-10)+20*e.index,n=s+14;return(0,zn.jsx)("line",{stroke:"var(--colorCalendarBg)",x1:10,x2:10,y1:s,y2:n,style:_r.ZP.getCalendarColorStyles(t)},e.event.id)}function JT(e){const[t,s]=(0,oT.Z)(_r.ZP.filterEventsByPeriod(e.events,e.day,"day"),_r.ZP.isMultiDayEvent),n=e.day.clone();return(0,zn.jsx)(Un.Fragment,{children:(0,zn.jsxs)("div",{className:Gn()("CalendarMonth-Day",{"CalendarMonth-Day--OtherMonth":!e.isSameMonth,"CalendarMonth-Day--Selected":e.isSelected,"CalendarMonth-Day--Highlighted":e.isHighlighted,"CalendarMonth-Day--Current":e.day.isSame(Date.now(),"day"),"CalendarMonth-Day--Weekend":e.day.day()%6==0}),onClick:e.renderMonthDay?nr.Z:()=>e.onSelect(n),children:[e.renderMonthDay&&e.renderMonthDay(e.day),!e.renderMonthDay&&e.day.format("D"),!e.renderMonthDay&&!(!s.length&&!t.length)&&(0,zn.jsxs)("svg",{viewBox:"0 0 120 96",children:[s.map((t=>(0,zn.jsx)(QT,{event:t,startTime:e.day.valueOf()},t.id))),t.map(((e,s)=>(0,zn.jsx)(qT,{event:e,index:s,count:t.length},e.id)))]})]})},e.day.valueOf())}var eE=(0,zn.jsx)("span",{}),tE=(0,zn.jsx)("span",{});const sE=function(e){const t=(0,Eo.Z)(XT),s=e.showWeekNumber&&t[Z.kCalendarDisplayWeekNumber],{events:n,month:i,style:a}=e,o=i.clone().startOf("month").startOf("week");let r;if(e.fixedHeight)r=[...Array(42).keys()].map((e=>o.clone().add(e,"day")));else{const e=_r.ZP.getDisplayRange(i,"month");r=Array.from(e.by("day"))}const l=r.slice(0,7);return(0,zn.jsxs)("div",{style:a,className:Gn()("CalendarMonth",{"CalendarMonth--ShowWeeknumber":s}),children:[s&&eE,e.showWeekDays&&l.map((e=>(0,zn.jsx)("span",{className:"CalendarMonth-DayOfWeek",children:e.format("dd")[0]},`hdr-${e.valueOf()}`))),r.map(((t,a)=>{const o=t.isSame(i,"month");return s&&a%7==0?(0,zn.jsxs)(Un.Fragment,{children:[(0,zn.jsx)("span",{className:"CalendarMonth-Week",children:t.week()}),e.showOutOfMonthDays||o?(0,zn.jsx)(JT,{day:t,events:n,isSelected:!!e.selectedDate&&e.selectedDate.isSame(t,e.highlightMode),isHighlighted:e.highlightedDate?.isSame(t,e.highlightMode)||!1,isSameMonth:o,onSelect:e.onSelect,renderMonthDay:e.renderMonthDay}):tE]},a):e.showOutOfMonthDays||o?(0,zn.jsx)(JT,{day:t,events:n,isSelected:!!e.selectedDate&&e.selectedDate.isSame(t,e.highlightMode),isHighlighted:e.highlightedDate?.isSame(t,e.highlightMode)||!1,isSameMonth:o,onSelect:e.onSelect,renderMonthDay:e.renderMonthDay},t.valueOf()):(0,zn.jsx)("span",{},t.valueOf())}))]},i.valueOf())};const nE=function(e){const t=Un.useContext(WS),s=iT(t.pageId),n=Un.useRef(),i=()=>{const e=n.current;if(!e)return 0;const t=!!e.childElementCount&&e.children[0];return t?Math.max(1,Math.floor(e.clientWidth/t.clientWidth)):0},{anchorDate:a,displayMode:o}=e.filter,r=_r.ZP.getDisplayRange(a,o),l=Array.from(r.by("month"));return(0,zn.jsx)("div",{className:`calendar-grid-${e.filter.displayMode} calendar-grid`,onKeyDown:s=>{const n=e.filter.selectedDate;if(!n)return void console.error("Can not navigate month grid. No selected calendar date.");let a,o;switch(JS.Z[s.keyCode]){case"Left":if(0===n.weekday()||1===n.date()){const e=(0,Kc.Xq)(n);a=(0,Kc.FY)(e,6,n.clone().subtract(1,"month"),!0)}else a=n.clone().subtract(1,"day");break;case"Right":if(a=n.clone().endOf("month"),6===n.weekday()||n.isSame(a,"day")){const e=(0,Kc.Xq)(n);a=(0,Kc.FY)(e,0,n.clone().add(1,"month"),!0)}else a=n.clone().add(1,"day");break;case"Up":o=i(),n.date()<8?(a=n.clone().subtract(o,"month"),a=(0,Kc.Ro)(n.weekday(),a)):a=n.clone().subtract(1,"week");break;case"Down":o=i(),a=n.clone().endOf("month"),a.date()-n.date()<7?(a=n.clone().add(o,"month"),a=(0,Kc.PX)(n.weekday(),a)):a=n.clone().add(1,"week")}a&&(a.hour(n.hour()).minute(n.minute()),t.handler.selectDate(a))},ref:n,tabIndex:"0",onWheel:s,children:l.map((s=>{const n=_r.ZP.filterEventsByPeriod(e.events,s,"month");return(0,zn.jsxs)("div",{children:[(0,zn.jsx)("p",{className:"month-name",children:s.format("MMMM")}),(0,zn.jsx)(sE,{events:n,month:s,selectedDate:e.filter.selectedDate,showWeekNumber:!0,showWeekDays:!0,onSelect:t.handler.selectDate,fixedHeight:!1,highlightMode:"day"})]},s.valueOf())}))})};function iE(){const[,e]=Un.useReducer((e=>e+1),0);return e}const{minimalCreateEvent:aE}=_r.ZP,oE=[Z.kCalendarClickTimeSlot],rE="YYYY-MM-DD",lE="!todos";function dE(e,t,s,n=0){const i=n>0?{...s,id:`${s.id}-${n}`}:s,a=e.get(t);Array.isArray(a)?(a.push(i),e.set(t,a)):e.set(t,[i])}const cE=Ci()((function(e,t,s){const n=_r.ZP.getDisplayRange(t,s),i=new Map;return e.forEach((e=>{if(e.task)if(e.end){const t=V()(e.end).format(rE);dE(i,t,e)}else dE(i,lE,e);else if(e.start){const t=V()(Math.max(e.start,n.start)).startOf("day");let s=0;const a=Math.min(e.end,n.end);for(;t.valueOf()<a||t.valueOf()===e.start;){const n=t.format(rE);dE(i,n,e,s),t.add(1,"day"),s++}}})),i.forEach((e=>e.sort(((e,t)=>e.id&&t.id?e.allDay!==t.allDay?e.allDay?-1:1:e.task&&t.task?(e.end||1/0)-(t.end||1/0):e.start-t.start:e.id?-1:1)))),i}),{maxSize:2});const hE=function(e){const t=(0,Eo.Z)(oE),{handler:s,pageId:n,isTaskList:i,isWidget:a}=Un.useContext(WS),{document:o}=Un.useContext(oi.Z),r=iE(),l=iT(n),d=Un.useRef(new Map),c=Un.useRef(new Map);Un.useMemo((()=>{c.current=cE(e.events,e.filter.anchorDate,e.displayMode)}),[e.displayMode,e.events,e.filter.anchorDate]);const h=Un.useMemo((()=>function(e,t){let s="";const n=e?.format(rE)??lE,i=[...t.keys()].sort();for(const e of i)if(!s&&n<=e){s=e;break}return!s&&i.length&&(s=i.pop()??""),!s&&e&&(s=e.format(rE)),s||lE}(e.filter.selectedDate,c.current)),[e.filter.selectedDate]);function u(t){let s="";if(e.filter.calendarIds.size){const t=_r.ZP.getDefaultCalendar(i)?.id??"";e.filter.calendarIds.has(t)||(s=e.filter.calendarIds.values().next().value??"")}return i?{end:t,task:!0,calendarId:s}:{start:t,calendarId:s}}function p(e,t){"click"===e.type&&e.stopPropagation();const n=u(t?t+(new Date).getHours()*be.QI:0);s.editEvent(null,aE(n))}Un.useEffect((()=>{e.filter.showCompletedTasks&&d.current.clear()}),[e.filter.showCompletedTasks]);const g=[...c.current.keys()].sort(),m=!!e.filter.filterText,f=!!o.activeElement?.closest(".calendar-grid");return(0,zn.jsxs)("div",{className:`calendar-grid calendar-grid-${e.displayMode}`,onKeyDown:function(t){const a=t.altKey;if(!e.editingEvent){const o=_r.ZP.getDisplayRange(e.filter.anchorDate,e.displayMode),r=Array.from(c.current.keys()).sort();let l,d;switch(JS.Z[t.keyCode]){case"Up":if((0,wi.ZP)(t),l=c.current.get(h)||[],d=l.findIndex((t=>t.id===e.selectedEvent)),a||0===d||0===l.length){const e=r.findIndex((e=>h===e));if(e<=0&&h!==lE){const e=o.start.clone().subtract(1,"day");TZ.Z.viewPreviousPeriod(n,e)}else if(e>0){const t=r[e-1],n=t===lE?null:V()(t);s.selectDate(n,!0)}}else if(e.selectedEvent){const e=l[d-1];s.selectEvent({event:e})}else{const e=l[l.length-1];s.selectEvent({event:e})}break;case"Down":if((0,wi.ZP)(t),l=c.current.get(h)||[],d=l.findIndex((t=>t.id===e.selectedEvent)),a||-1===d||!e.selectedEvent){const e=r.findIndex((e=>h===e));l=c.current.get(r[e+1])||[],e>=r.length-1?TZ.Z.viewNextPeriod(n,o.end.clone().add(1,"day")):l.length&&!a?s.selectEvent({event:l[0]}):s.selectDate(V()(r[e+1]),!0)}else d===l.length-1?s.selectEvent({}):s.selectEvent({event:l[d+1]});break;case"Enter":if((0,wi.ZP)(t),e.selectedEvent){l=c.current.get(h)||[];const t=l.find((t=>t.id===e.selectedEvent));s.editEvent(t)}else{const e=i,t=h!==lE&&V()(h),n=t?t.hours((new Date).getHours()).valueOf():0,a=e?{end:n,task:e}:{start:n};s.editEvent(null,aE(a))}break;case"Space":const u=e.selectedEvent&&e.events.find((t=>t.id===e.selectedEvent));if(u&&u.task){(0,wi.ZP)(t);const e={...u,complete:!u.complete};ie.ZP.updateEvent(e,"single",!0,n)}break;case"Escape":(0,wi.ZP)(t),e.selectedEvent&&s.selectEvent({})}}},onClick:function(n,i){if(e.editingEvent)s.endEventEdit();else if(n.target===n.currentTarget){const e=i?V()(i,rE):void 0,a=u(e?.valueOf()??0);"select"===t[Z.kCalendarClickTimeSlot]||"contextmenu"===n.type?e&&s.selectDate(e,!0):s.editEvent(null,aE(a))}},tabIndex:"0",onWheel:l,children:[0===e.events.length&&function(){const t=0===Pr.Z.getEvents().length,s=i?0:e.filter.anchorDate.valueOf();return(0,zn.jsx)("div",{className:"cal-tasks-row",children:(0,zn.jsxs)("div",{className:"cal-tasks-row-events selected",children:[t&&(0,zn.jsx)("h2",{children:i?(0,W.Z)("Your calendar is empty. Add your first task below!"):(0,W.Z)("Your calendar is empty. Add your first event below!")}),(0,zn.jsx)("div",{className:"calendar-add-event-button selected active",onClick:e=>p(e,s),children:i?(0,W.Z)("Add Task"):(0,W.Z)("Add Event")})]})})}(),g.map((t=>{const o=c.current.get(t)||[],l=h===t,u=t!==lE?V()(t,rE):void 0;return(0,zn.jsxs)("div",{className:"cal-tasks-row",ref:e=>{l&&e&&(!a||f)&&e.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"})},children:[!!u&&(0,zn.jsx)("div",{className:Gn()("cal-tasks-row-date",{current:(0,Kc.KC)(u.toDate(),new Date)}),children:(0,Kc.KC)(u.toDate(),new Date)?(0,zn.jsx)("span",{className:"cal-tasks-row-doy",children:(0,W.Z)("calendar","Today")}):(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("span",{className:"cal-tasks-row-dow",children:u.format("dddd")}),(0,zn.jsx)("span",{className:"cal-tasks-row-doy",children:u.format("ll")})]})}),(0,zn.jsxs)("div",{className:Gn()("cal-tasks-row-events",{selected:l}),children:[o.map((t=>{const a=e.selectedEvent?.split("-")[0]===t.id.split("-")[0],o=!!e.editingEvent&&e.editingEvent.id===t.id;d.current.has(t.id)&&(t={...t,complete:d.current.get(t.id)});const l=o&&e.editingEvent?e.editingEvent:t;let h;return i&&!e.filter.showCompletedTasks&&(h=s=>{const i=(0,C.Uy)(t,(e=>{e.complete=s.target.checked}));d.current.set(i.id,i.complete??!1),i.complete&&setTimeout((()=>{d.current.get(i.id)&&ie.ZP.updateEvent(i,"single",!0,n)}),1500);const a=e.events.map((e=>e.id===i.id?i:e)),o=cE(a,e.filter.anchorDate,e.displayMode);setTimeout((()=>{c.current=o,r()}),0)}),(0,zn.jsx)("div",{className:Gn()("event-container",{exiting:d.current.get(t.id)}),onClick:t=>function(t,n){const{editingEvent:i}=e;(!i||i&&i.id!==n.id)&&s.editEvent(n),t.stopPropagation()}(t,l),children:(0,zn.jsx)(eT,{event:l,displayStyle:e.eventDisplayStyle,isSelected:a,isEditing:o,isMultiDay:_r.ZP.isMultiDayEvent(l),isFiltering:m,multiDayContinuing:!!t.start&&t.start<(u?.valueOf()??-1/0),multiDayContinues:(t.end||0)>(u?.valueOf()??1/0)+be.hd,onCompleteChanged:h,dayOutOfTotalDays:u})},_r.ZP.generateKey(l))})),(0,zn.jsx)("div",{className:Gn()("calendar-add-event-button",{active:l&&!e.selectedEvent,selected:l,"task-list":i,disabled:!!e.editingEvent}),onClick:e=>p(e,i?0:Date.parse(t)),ref:t=>{l&&!e.selectedEvent&&t&&!a&&t.scrollIntoViewIfNeeded({block:"nearest",inline:"nearest",behavior:"smooth"})},children:i?(0,W.Z)("Add Task"):(0,W.Z)("Add Event")})]})]},t)}))]})},{minimalCreateEvent:uE}=_r.ZP;function pE(e,t){if(!t)return!1;const{HTMLElement:s}=e;return t instanceof s&&t.isContentEditable||"function"==typeof t.select}const gE=function(e){const t=Un.useContext(WS),s=Un.useContext(oi.Z),n=Un.useRef(),i={allDaySelected:e.filter.allDaySelected,selectedDate:e.filter.selectedDate,selectedEvent:e.filter.selectedEvent,editingEvent:e.editingEvent},a=Un.useRef(i);a.current=i;const{isPanel:o}=t,r=Un.useRef(!!e.editingEvent);Un.useEffect((()=>{r.current=!!e.editingEvent})),Un.useEffect((()=>{function e(e){if(e!==s.vivaldiWindowId)return;if(!n.current?.contains(s.document.activeElement))return;const{editingEvent:i,selectedDate:r}=a.current,{area:l}=Xe.Z.getContext(e);if(i||o!==("panel"===l))return;const d=r?.valueOf()??0;t.handler.editEvent(null,uE({start:d}))}return go.Z.addListener("COMMAND_CALENDAR_CREATE_EVENT",e),()=>{go.Z.removeListener("COMMAND_CALENDAR_CREATE_EVENT",e)}}),[o,s,t.handler]);const l=Un.useCallback((()=>{const s=e.trashedEvents.sort(((e,t)=>(e.trash_time||0)-(t.trash_time||0))).slice(-1);s.length&&ie.ZP.restoreEvent(t.pageId,s[0])}),[t.pageId,e.trashedEvents]),d=Un.useCallback(((e,t)=>{const i=s.document.getSelection(),o=s.document.activeElement,{selectedEvent:r,editingEvent:l}=a.current,d=r||l?.id;if(d&&(!i||i.isCollapsed)&&n.current?.contains(o)){const{clipboardData:s}=e;if(!s)throw new Error("No clipboardData on copy event");e.preventDefault();const n=Pr.Z.getEvent(d);if(!n)return void ls.Z.warn("Calendar",`Event to copy (id: ${d}) not found`);s.setData("text/plain",n.title),s.setData(um,d),s.setData("vivaldi/x-cut",t)}}),[s.document]),c=Un.useCallback((e=>{d(e,"true")}),[d]),h=Un.useCallback((e=>{d(e,"false")}),[d]),{document:u}=s,p=Un.useCallback((async e=>{if(n.current?.contains(u.activeElement)){const{clipboardData:s}=e;if(!s)throw new Error("No clipboardData on paste event");const{allDaySelected:n,selectedDate:i,editingEvent:o}=a.current;if(o)return;(0,wi.ZP)(e);const r=s.getData(um),l=i?.valueOf()??0;if(r){const e=n,a="true"===s.getData("vivaldi/x-cut")?ie.ZP.moveEvent:ie.ZP.copyEvent,d=await a(r,{start:l,byDateOnly:e},t.pageId);o?t.handler.editEvent(d):t.handler.selectEvent({event:d,date:i})}else{const e=s.getData("text/plain");e&&t.handler.editEvent(null,uE({title:e,start:l}))}}}),[u,t.handler,t.pageId]),g=n.current;Un.useEffect((()=>{if(g)return Qe.Z.bind("ctrl+z",l,{feature:"calendar"}),u.addEventListener("cut",c),u.addEventListener("copy",h),u.addEventListener("paste",p),()=>{Qe.Z.unbind("ctrl+z",l),u.removeEventListener("cut",c),u.removeEventListener("cut",h),u.removeEventListener("paste",p)}}),[u,g,l,c,h,p]);const m=e.displayMode||e.filter.displayMode,f=_r.ZP.getDefaultCalendar();return(0,zn.jsxs)("div",{ref:n,className:"calendar-viewport outerScrollbar",onContextMenu:t=>{const{HTMLElement:n}=s,i=t.currentTarget.closest(".calendar-grid");i&&i!==u.activeElement&&i instanceof n&&i.focus(),(0,mi.Z)(s,(()=>{const t=[{handler:()=>jc.Z.paste(s.vivaldiWindowId),...(0,fi.Z)("verb","Paste")}];return e.trashedEvents.length&&t.push({handler:l,...(0,fi.Z)("Restore Event from Trash")}),t})())(t)},onFocus:e.onFocus,onKeyDown:n=>{const{editingEvent:i,filter:a}=e,o=n.ctrlKey;if(i)switch(JS.Z[n.keyCode]){case"Escape":t.handler.cancelEventEdit();break;case"Del":case"Backspace":o&&!pE(s,n.target)&&ie.ZP.trashEvent(i.id)}else switch(JS.Z[n.keyCode]){case"Del":case"Backspace":a.selectedEvent&&ie.ZP.trashEvent(a.selectedEvent),n.preventDefault(),n.stopPropagation()}},style:_r.ZP.getCalendarColorStyles(f),children:[(0,zn.jsx)("style",{children:_r.ZP.getCalendarColors()}),("day"===m||"week"===m&&!o)&&(0,zn.jsx)(YT,{anchorDate:e.anchorDate||e.filter.anchorDate,filter:e.filter,events:e.events,displayMode:m,selectedEvent:e.filter.selectedEvent,editingEvent:e.editingEvent,inPanel:o}),("week"===m&&o||"multiweek"===m||"month"===m)&&(0,zn.jsx)(ZT,{filter:e.filter,events:e.events,displayMode:m,selectedEvent:e.filter.selectedEvent,editingEvent:e.editingEvent}),"year"===m&&(0,zn.jsx)(nE,{filter:e.filter,events:e.events}),"agenda"===m&&(0,zn.jsx)(hE,{filter:e.filter,events:e.events,displayMode:m,eventDisplayStyle:e.eventDisplayStyle||"transparent",selectedEvent:e.filter.selectedEvent,editingEvent:e.editingEvent})]})},mE=e=>{const{event:t}=e,{getContextMenu:s}=EZ(t),n=Un.useRef(),i=Un.useContext(oi.Z),{document:a,getSelection:o}=i,r=Un.useContext(WS),l=r.handler.updateEventEdit,d=r.handler.saveEventEdit,h=!!e.checkboxes,u=h&&!e.editTemplate,p=e.checkboxes??{};Un.useEffect((()=>{const t=n.current,s=o();if(t&&s&&!e.checkboxes){t.focus();const e=a.createRange();e.selectNodeContents(t),e.collapse(!1),s.removeAllRanges(),s.addRange(e)}}),[a,o,e.checkboxes]);const g={updateEvent:l,saveEventEdit:d,event:t,tabIndex:0},m=t=>s=>{const{value:n}=s.currentTarget;l(kZ(e.event,t,n)),e.enableProperty&&e.enableProperty("time")},f=t=>s=>{const{value:n}=s.currentTarget;l(NZ(e.event,t,n)),e.enableProperty&&e.enableProperty("time")};const{start:v,end:b}=(0,Kc.aE)(t),C=!(t.start||t.end||h),w=h&&t.allDay;return(0,zn.jsxs)("div",{className:"CalendarEventFull",onContextMenu:e=>{pE(i,e.target)?e.stopPropagation():(0,mi.Z)(i,s())(e)},style:{backgroundImage:Kn._9b},onClick:wi.UW,children:[(!u||p.title)&&(0,zn.jsxs)("div",{className:"CalendarEventFull-Row",children:[(0,zn.jsx)("span",{className:"CalendarEventFull-Icon",dangerouslySetInnerHTML:{__html:Kn.qHs}}),(0,zn.jsx)(CZ,{...g,field:"title",label:(0,W.Z)("Title"),focusRef:n,readOnly:u}),p.title]}),(!u||p.description)&&(0,zn.jsxs)("div",{className:"CalendarEventFull-Row CalendarEventFull-Row--NoIcon",children:[(0,zn.jsx)(CZ,{...g,field:"description",label:(0,W.Z)("Description"),readOnly:u}),p.description]}),(!u||p.time)&&!w&&!t.task&&(0,zn.jsx)(zn.Fragment,{children:(0,zn.jsxs)("div",{className:"CalendarEventFull-Row",children:[(0,zn.jsx)("span",{className:"CalendarEventFull-Icon",dangerouslySetInnerHTML:{__html:Kn.zTz}}),(0,zn.jsxs)("div",{className:"edit-group",children:[!h&&(0,zn.jsx)(wx.Z,{onChange:f("start"),title:(0,W.Z)("Event Start Date"),value:v.format("YYYY-MM-DD")}),!t.allDay&&(0,zn.jsx)(_h,{onChange:m("start"),step:"5",title:(0,W.Z)("Event Start Time"),value:v.format("HH:mm")}),"–",!t.allDay&&(0,zn.jsx)(_h,{onChange:m("end"),step:"5",title:(0,W.Z)("Event End Time"),value:b.format("HH:mm")}),!h&&(0,zn.jsx)(wx.Z,{onChange:f("end"),title:(0,W.Z)("Event End Date"),value:b.format("YYYY-MM-DD")})]}),p.time]})}),(!u||p.time)&&t.task&&(0,zn.jsxs)("div",{className:"CalendarEventFull-Row",children:[(0,zn.jsx)("span",{className:"CalendarEventFull-Icon",dangerouslySetInnerHTML:{__html:Kn.zTz}}),(0,zn.jsxs)("div",{className:"CalendarEventFull-TaskTime edit-group",children:[(0,zn.jsx)(cZ,{type:"start",view:"dialog",event:t,updateEvent:l,onDateChange:f("start"),onTimeChange:m("start")}),(!!t.start||!!t.end)&&"–",(0,zn.jsx)(cZ,{type:"due",view:"dialog",event:t,updateEvent:l,onDateChange:f("end"),onTimeChange:m("end")})]}),p.time]}),p.duration&&(0,zn.jsxs)("div",{className:Gn()("CalendarEventFull-Row",{"CalendarEventFull-Row--NoIcon":!w}),children:[w&&(0,zn.jsx)("span",{className:"CalendarEventFull-Icon",dangerouslySetInnerHTML:{__html:Kn.zTz}}),(0,zn.jsx)(US,{event:t,updateEvent:function(t){e.enableProperty&&e.enableProperty("duration"),l(t)}}),p.duration]}),(!u||p.allDay)&&(!t.task||!!t.end)&&(0,zn.jsxs)("div",{className:"CalendarEventFull-Row CalendarEventFull-Row--NoIcon",children:[(0,zn.jsx)("div",{className:"edit-group",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:!!t.allDay,onChange:function(t){l({...e.event,allDay:t.currentTarget.checked})}}),(0,zn.jsx)("span",{children:(0,W.Z)("All Day")})]})}),p.allDay]}),(!u||p.timezone)&&(!t.task||!!t.end)&&(0,zn.jsxs)("div",{className:"CalendarEventFull-Row CalendarEventFull-Row--NoIcon",children:[(0,zn.jsx)("div",{className:"edit-group",children:(0,zn.jsx)(ZZ,{event:t,setSelectedItem:t=>{l((0,Kc.bn)({...e.event},t.value))}})}),p.timezone]}),(!u||p.task)&&(0,zn.jsxs)("div",{className:"CalendarEventFull-Row",children:[(0,zn.jsx)("span",{className:"CalendarEventFull-Icon",dangerouslySetInnerHTML:{__html:Kn._9b}}),(0,zn.jsxs)("div",{className:"edit-group",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:!!t.task,onChange:function(t){l({...e.event,task:t.currentTarget.checked})}}),(0,zn.jsx)("span",{children:(0,W.Z)("Is a Task")})]}),!h&&(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{disabled:!t.task,type:"checkbox",checked:!!t.complete,onChange:function(t){l({...e.event,complete:t.currentTarget.checked})}}),(0,zn.jsx)("span",{children:(0,W.Z)("Complete")})]})]}),p.task]}),(!u||p.location)&&(0,zn.jsxs)("div",{className:"CalendarEventFull-Row",children:[(0,zn.jsx)("span",{className:"CalendarEventFull-Icon",dangerouslySetInnerHTML:{__html:Kn.GF3}}),(0,zn.jsx)(CZ,{...g,field:"location",label:(0,W.Z)("other","Location"),readOnly:u}),p.location]}),(!u||p.recurrence)&&(0,zn.jsxs)("div",{className:"CalendarEventFull-Row",children:[(0,zn.jsx)("span",{className:"CalendarEventFull-Icon CalendarEventFull-Icon--WithInput",dangerouslySetInnerHTML:{__html:Kn.Eki}}),(0,zn.jsxs)("div",{className:"CalendarEventFull-RowContent",children:[!C&&(0,zn.jsx)(dZ.Z,{...g,field:"recurrence",label:"recurrence"}),C&&(0,zn.jsx)("div",{className:"edit-group capped-width",children:(0,zn.jsx)("span",{className:"info",children:(0,W.Z)("Task without time can not recur.")})})]}),p.recurrence]}),(!u||p.url)&&(0,zn.jsxs)("div",{className:"CalendarEventFull-Row",children:[(0,zn.jsx)("span",{className:"CalendarEventFull-Icon",dangerouslySetInnerHTML:{__html:Kn.wTH}}),(0,zn.jsx)(CZ,{...g,field:"url",label:(0,W.Z)("URL"),readOnly:u}),p.url]}),!u&&t.attachment&&t.attachment.length>0&&(0,zn.jsxs)("div",{className:"CalendarEventFull-Row",children:[(0,zn.jsx)("span",{className:"CalendarEventFull-Icon",dangerouslySetInnerHTML:{__html:Kn.onv}}),t.attachment.map((e=>(0,zn.jsx)("div",{className:"CalendarEventFull-Attachment",children:(0,zn.jsx)("a",{onClick:()=>c.ZP.openURL(i.vivaldiWindowId,e.url),title:e.url,children:e.filename||e.url})},e.url)))]}),(!u||p.reminders)&&(0,zn.jsxs)("div",{className:"CalendarEventFull-Row",children:[(0,zn.jsx)("span",{className:"CalendarEventFull-Icon CalendarEventFull-Icon--WithInput",dangerouslySetInnerHTML:{__html:Kn.PPL}}),(0,zn.jsx)("div",{className:"CalendarEventFull-RowContent",children:(0,zn.jsx)(tZ,{event:t,updateEvent:l,readOnly:u})}),p.reminders]}),(!u||p.participants)&&!t.task&&(0,zn.jsxs)("div",{className:"CalendarEventFull-Row",children:[(0,zn.jsx)("span",{className:"CalendarEventFull-Icon CalendarEventFull-Icon--WithInput",dangerouslySetInnerHTML:{__html:Kn.Rs2}}),(0,zn.jsx)("div",{className:"CalendarEventFull-RowContent",children:(0,zn.jsx)(lZ,{...g,field:"attendees",label:(0,W.Z)("Type to add Participants"),readOnly:u})}),p.participants]}),(!u||p.calendar)&&(0,zn.jsxs)("div",{className:"CalendarEventFull-Row",children:[(0,zn.jsx)("span",{className:"CalendarEventFull-Icon CalendarEventFull-Icon--WithInput",dangerouslySetInnerHTML:{__html:Kn.fIz}}),(0,zn.jsx)("div",{className:"CalendarEventFull-RowContent",children:th(t,(e=>{h||ie.ZP.setDefaultCalendarId(e,t.task),l({...t,calendarId:e})}),0)}),p.calendar]}),!h&&(0,zn.jsx)("div",{className:"CalendarEventFull-Row CalendarEventFull-Row--NoIcon",children:(0,zn.jsx)(gZ,{event:t,updateEvent:l})}),""===t.id&&t.filteredOut&&!r.isWidget&&(0,zn.jsx)(fa,{type:"warning",children:t.task?(0,W.Z)("Once saved this task will be hidden by current search"):(0,W.Z)("Once saved this event will be hidden by current search")}),r.isTaskList&&!t.task&&(0,zn.jsx)(fa,{type:"warning",children:(0,W.Z)("Once saved this event will not show in the task list")}),t.filteredOut&&r.isWidget&&(0,zn.jsx)(fa,{type:"warning",children:t.task?(0,W.Z)("Once saved this task will be hidden by calendar selection."):(0,W.Z)("Once saved this event will be hidden by calendar selection.")})]})};class fE extends Un.PureComponent{static contextType=oi.Z;refSwitchInput=Un.createRef();refSwitchButton=Un.createRef();OFF=0;ON=12;constructor(e){super(e),e.scale&&(this.ON=this.ON*e.scale),this.state={dragging:!1,position:e.checked?this.ON:this.OFF}}componentDidUpdate(e){e.checked!==this.props.checked&&this.updateButtonPosition()}updateButtonPosition=()=>{this.setState({position:this.props.checked?this.ON:this.OFF})};onChange=e=>{const t=e.target.checked?this.ON:this.OFF;this.setState({position:t}),this.props.onChange&&this.props.onChange(e)};onClick=e=>{this.state.dragging?(e.preventDefault(),this.setState({dragging:!1})):this.toggleSwitch()};toggleSwitch=()=>{const e=new MouseEvent("click",{bubbles:!0,cancelable:!0});this.refSwitchInput.current?.dispatchEvent(e)};cancelEvent=e=>{e.preventDefault()};releasePointerCapture=e=>{e.currentTarget.hasPointerCapture(e.pointerId.toString())&&e.currentTarget.releasePointerCapture(e.pointerId)};onPointerDown=e=>{e.currentTarget.setPointerCapture(e.pointerId)};onPointerMove=e=>{if(1===e.buttons&&this.refSwitchButton.current===this.context.document.activeElement){const{movementX:t}=e;0!==t&&this.setState((e=>({dragging:!0,position:(0,kf.Z)(e.position+t,0,this.ON)})))}};onPointerUp=e=>{if(this.state.dragging){this.releasePointerCapture(e);const{position:t}=this.state;t>=0&&t<=this.ON/2?(this.setState({position:this.OFF}),this.props.checked&&this.toggleSwitch()):(this.setState({position:this.ON}),this.props.checked||this.toggleSwitch())}};render(){const{position:e}=this.state;return(0,zn.jsxs)("div",{className:Gn()("Switch",{"Switch--Disabled":this.props.disabled,"Switch--Progress":this.props.inProgress,"Switch--Progress-Done":this.props.checked&&this.props.hasOwnProperty("inProgress")}),style:this.props.scale?{transform:`scale(${this.props.scale})`}:void 0,title:this.props.title,children:[(0,zn.jsx)("input",{id:this.props.inputId,ref:this.refSwitchInput,className:"Switch-Input",type:"checkbox",onChange:this.onChange,checked:this.props.checked,disabled:this.props.disabled,value:this.props.value,onPointerDown:this.cancelEvent,tabIndex:this.props.tabIndex}),(0,zn.jsx)("button",{ref:this.refSwitchButton,className:Gn()({"Switch-Button":!0,dragging:this.state.dragging}),style:{transform:`translateX(${e/(this.props.scale||1)}px)`},onPointerDown:this.onPointerDown,onPointerMove:this.onPointerMove,onPointerUp:this.onPointerUp,onPointerCancel:this.releasePointerCapture,onClick:this.onClick,tabIndex:"-1","aria-hidden":"true"})]})}}const vE=fE,bE={title:"title",description:"description",allDay:"allDay",timezone:"timezone",task:"task",location:"location",rrule:"recurrence",url:"url",notifications:"reminders",invites:"participants",calendarId:"calendar"},CE={selectDate:nr.Z,selectEvent:e=>{},selectCalendars:nr.Z,toggleShowCompleted:nr.Z,editEvent:(e,t)=>Promise.resolve(),updateEventEdit:e=>{},saveEventEdit:()=>Promise.resolve(),endEventEdit:e=>Promise.resolve(),cancelEventEdit:nr.Z};function wE(e){const[t,s]=(0,Un.useState)({...e.event}),[n,i]=(0,Un.useState)(e.name),[a,o]=(0,Un.useState)(e.properties),r=(0,Un.useContext)(WS),{edit:l=!0,templateId:d,setSaveTemplate:c}=e,h=(0,Un.useRef)();function u(e,s){if(a.hasOwnProperty(e)){const i={...a,[e]:s};return o(i),h.current=(0,hZ.tL)(t,i),h.current.name=n,i}return a}(0,Un.useEffect)((()=>{h.current=function(e,t,s){return{...(0,hZ.tL)(e,t),name:s}}(e.event,e.properties,e.name)}),[e.event,e.properties,e.name]),(0,Un.useEffect)((()=>{s({...e.event}),o({...e.properties}),i(e.name)}),[e.name,e.properties,e.event]),(0,Un.useEffect)((()=>{c((function(){if(!h.current)return;const e=h.current;if(!e.name)throw new Error((0,W.Z)("Please name the template"));if(Object.keys(e).length<=1)throw new Error((0,W.Z)("No property selected. Please select at least one to save template."));d?ie.ZP.updateTemplate(d,e):ie.ZP.createEventTemplate(e)}))}),[c,d]);const p={...CE,updateEventEdit:e=>{let i=a;for(const s of Object.keys(bE))t[s]!==e[s]&&(i=u(bE[s],!0));const o={...e};s(o),h.current=(0,hZ.tL)(o,i),h.current.name=n}};function g(e){u(e.target.id,e.target.checked)}const m={};for(const e of Object.keys(a)){if(!l&&!a[e])continue;const s=!l||"timezone"===e&&t.allDay;m[e]=(0,zn.jsx)(vE,{inputId:e,checked:!!a[e],disabled:s,onChange:g})}const f={...r,handler:p},v=!!d;return(0,zn.jsxs)("fieldset",{className:"detail-content",disabled:!l,children:[l&&(0,zn.jsxs)("label",{className:"floating-label",children:[(0,zn.jsx)("span",{children:(0,W.Z)("Template name")}),(0,zn.jsx)("input",{value:n,name:"name",onChange:function(e){const t=e.target.value;h.current&&(h.current.name=t),i(t)},type:"text"})]}),!v&&(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Select the properties you want to include in the template. Any changes you make will not be saved to the original event.")}),(0,zn.jsx)(WS.Provider,{value:f,children:(0,zn.jsx)(mE,{event:t,checkboxes:m,editTemplate:l,enableProperty:e=>{u(e,!0)}})})]})}const yE={id:"",calendarId:"",title:"",start:0,end:0};function xE(e){const[t,s]=(0,Un.useState)(!e.templateId),[n,i]=(0,Un.useState)(""),a=(0,Un.useRef)(nr.Z),o=(0,Un.useMemo)((()=>{const t=((0,Kc.FL)(new Date).getHours()+1)*be.QI,s=t+A.Z.get(Z.kCalendarDefaultDuration);return(0,hZ.$u)(e.template,{...yE,start:t,end:s})}),[e.template]),r=(0,Un.useMemo)((()=>(0,hZ.e$)(e.template)),[e.template]);(0,Un.useEffect)((()=>{s(!e.templateId)}),[e.templateId]);const l=(0,Un.useCallback)((e=>{a.current=e}),[]);return(0,zn.jsxs)("form",{className:"detail edit-template",children:[(0,zn.jsx)(wE,{templateId:e.templateId,name:e.template.name,event:o,properties:r,setSaveTemplate:l,edit:t}),n&&(0,zn.jsx)(fa,{type:"error",children:n}),(0,zn.jsx)("div",{className:"detail-toolbar",children:(0,zn.jsx)("input",{type:"button",value:t?(0,W.Z)("Save"):(0,W.Z)("verb","Edit"),onClick:t?async function(){i("");try{a.current()}catch(e){i(e.message)}}:function(){s(!0)}})})]})}var IE=s(41851);const AE=s(28888),SE={},ZE={"Add your First Event Template":(0,W.Z)("Add your First Event Template"),"Press the “Add” button to the left to add a new template.":(0,W.Z)("Press the “Add” button to the left to add a new template.")};function TE(e,t){return(0,zn.jsx)("div",{className:"item-title",children:t.name})}var EE=(0,zn.jsx)("div",{className:"item-meta",children:" "});function kE(){return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("div",{className:"item-title",children:(0,W.Z)("New Template")}),EE]})}function NE(e){return(0,zn.jsx)("div",{className:"detail",children:(0,zn.jsxs)("div",{className:"detail-content",children:[(0,zn.jsx)("h3",{children:ZE["Add your First Event Template"]}),(0,zn.jsx)("p",{children:ZE["Press the “Add” button to the left to add a new template."]})]})})}function _E(e){const{templates:t}=(0,dS.Z)(Pr.Z),s=(0,Un.useRef)(""),[n,i]=(0,Un.useState)({id:""}),a=(0,Un.useMemo)((()=>(s.current="",t.map((e=>({...e,key:e.id}))))),[t]);return(0,zn.jsx)(Vy.Z,{categoryTitle:(0,W.Z)("Event Templates"),filter:e.filter,children:(0,zn.jsx)(SS.Z,{className:"giant",deleteTitle:(0,W.Z)("Delete Template"),onRemove:function(e){const s=t[e]?.id;ie.ZP.removeTemplate(s)},addTipString:(0,W.Z)("Add Template"),deleteTipString:(0,W.Z)("Delete Template"),emptyListGraphic:AE,emptyListString:(0,W.Z)("No Templates added"),filter:e.filter,items:a,masterLayout:1,renderListItem:TE,renderCreateListItem:kE,renderContent:function(e,a){const o=t[e]?.id;if(s.current!==o)return s.current=o,IE.Z.loadTemplate(o).then((e=>{e&&i({id:o,template:e})})),null;const{template:r}=n;return r?(0,zn.jsx)(xE,{templateId:o,template:r}):null},renderCreate:function(e){return(0,zn.jsx)(xE,{templateId:"",template:{name:(0,W.Z)("New Template")}})},renderEmpty:NE,contentStrings:SE,emptyStrings:ZE,createStrings:SE})})}const PE=function(e){const[t,s]=Un.useState(""),[n,i]=Un.useState(""),[a,o]=Un.useState(!1),{item:r,onClose:l,onDeleteInProgress:d}=e,c=t===r.id,{account:h}=_r.ZP.getAccountAndCalendar(r.id),u="ical"!==h?.account_type;return(0,zn.jsxs)("div",{children:[(0,zn.jsx)("header",{className:"dialog-header",children:(0,zn.jsx)("h1",{className:"dialog-title",children:(0,W.Z)("Are you sure you want to delete the calendar ‘$1’ and its events?",[r.description])})}),(0,zn.jsxs)("div",{className:"dialog-content",children:["local"===h?.account_type&&(0,zn.jsx)("p",{className:"faded-text",children:(0,W.Z)("This will permanently delete your local calendar and associated events. It can not be undone.")}),"ical"===h?.account_type&&(0,zn.jsx)("p",{className:"faded-text",children:(0,W.Z)("This will not delete any data on the remote server. You can set it up again if you later want to use it in Vivaldi.")}),h&&_r.ZP.isCalDAV(h.account_type)&&(0,zn.jsx)("p",{className:"faded-text",children:(0,W.Z)("This will permanently delete the calendar on the remote server. It can not be undone. You can use the calendar settings to disable sync or hide the calendar.")}),u&&(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:a,onChange:e=>o(e.target.checked)}),(0,W.Z)("I understand that this will delete data permanently")]}),n&&(0,zn.jsx)(fa,{type:"error",children:n})]}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"button",className:"danger",disabled:c||u&&!a,onClick:async()=>{i(""),d(!0),s(r.id);const e=await ie.ZP.deleteCalendar(r,!0);!1===e.status?i(e.message):d(!1),s("")},value:c?(0,W.Z)("Deleting Calendar"):(0,W.Z)("verb","Delete"),autoFocus:!0}),(0,zn.jsx)("input",{type:"button",onClick:l,disabled:c,value:(0,W.Z)("Cancel")})]})]})};class ME extends Un.Component{nodeRef=Un.createRef();state={originalColor:this.props.color};#St=()=>{this.props.setColor(Be()(this.state.originalColor),this.props.name,!1)};#Zt=e=>{const t=e.currentTarget.value.trim();t.length<=3&&this.props.setColor(Be()(t),this.props.name)};#Tt=e=>{"Escape"===e.key?(e.preventDefault(),this.#St()):"Enter"===e.key&&this.#Zt(e)};render(){return(0,zn.jsx)("input",{type:"color",title:(0,W.Z)("Show system color picker"),className:"colorpicker-system",value:`#${this.props.color}`,onKeyDown:this.#Tt,onChange:this.#Zt})}}const DE=ME;function OE({className:e}){return(0,zn.jsx)("span",{className:e,dangerouslySetInnerHTML:{__html:Kn.yaZ.small}})}var jE=(0,zn.jsx)(OE,{className:"VivaldiDropdown-SelectedValue-Arrow"});function LE({item:e}){return(0,zn.jsxs)("span",{className:"VivaldiDropdown-SelectedValue",children:[e&&e.icon&&(0,zn.jsx)("img",{src:e.icon,className:"VivaldiDropdown-SelectedValue-Icon"}),e&&e.faviconUrl&&(0,zn.jsx)(Vn.ZP,{url:e.faviconUrl,className:"VivaldiDropdown-SelectedValue-Icon",loadType:"faviconFromCache"}),e&&(0,zn.jsx)("span",{className:"VivaldiDropdown-SelectedValue-Title",children:e.name}),jE]})}var RE=(0,zn.jsx)(OE,{className:"VivaldiDropdown-SelectedValue-Arrow"}),BE=(0,zn.jsx)(OE,{className:"VivaldiDropdown-SelectedValue-Arrow"});class FE extends Un.Component{refButton=Un.createRef();state={isExpanded:!1};#le=({id:e})=>{this.props.onValueChange(e),this.#Et()};#Et=()=>{this.setState({isExpanded:!1}),this.#kt()};#Nt=e=>{(0,wi.ZP)(e),this.setState((e=>({isExpanded:!e.isExpanded})))};#_t=e=>{switch(e.which){case mo.Z.KEY_UP:case mo.Z.KEY_DOWN:this.setState({isExpanded:!0})}};#kt=()=>{this.refButton.current?.focus()};render(){const e=this.props.items.find((e=>e.id===this.props.value));return(0,zn.jsxs)("div",{className:Gn()("VivaldiDropdown",this.props.className),children:[(0,zn.jsx)("button",{type:"button",ref:this.refButton,disabled:this.props.disabled,onMouseUp:this.#Nt,title:this.props.tooltip,className:Gn()("VivaldiDropdown-Button",{"VivaldiDropdown-Button--isActive":this.state.isExpanded}),onKeyDown:this.#_t,children:this.props.hideButtonText?RE:this.props.placeholder&&!e?(0,zn.jsxs)("div",{className:"VivaldiDropdown-Placeholder",children:[(0,zn.jsx)("p",{children:this.props.placeholder}),BE]}):(0,zn.jsx)(LE,{item:e||this.props.items[0]})}),this.state.isExpanded&&(0,zn.jsx)(bf,{className:"VivaldiDropdown-DropdownMenu",items:this.props.items,onClose:this.#Et,onItemActivated:this.#le,selectedItem:e,outsideClickIgnoreClass:"VivaldiDropdown-Button"})]})}}const WE=FE,UE=/^([0-9a-f]{3}){1,2}$/i;var VE=(0,zn.jsx)("span",{className:"ColorEditor-HexTextInput-Octothorpe",children:"#"});class HE extends Un.Component{refColorToggle=Un.createRef();constructor(e){super(e),this.state={color:e.colorValue.substring(1)},this.debouncedSetColor=(0,Te.Z)(this.props.setColor,100,{leading:!1}),e.predefinedColors&&(this.dropdownColors=e.predefinedColors.map((e=>({type:"Normal",name:e.name,iconSVG:this.createColorIcon(e.value),noPrettifying:!0,id:e.value}))))}createColorIcon=e=>`<svg width="16" height="16" viewBox="0 0 16 16">\n      <rect x="0" y="0" width="16" height="16" rx="2" ry="2" fill="${e}" />\n    </svg>`;hexInputEvents=e=>{let t=e.currentTarget.value;if("#"===t.charAt(0)&&(t=t.substring(1)),t.length>6&&(t=t.substring(0,6)),this.setState({color:t}),UE.test(t)){const e=Be()(t);e&&this.props.setColor(e,this.props.colorKey)}};onColorPicked=(e,t,s=!1)=>{this.setState({color:e.hex().substring(1)}),s?this.debouncedSetColor(e,t):this.props.setColor(e,t)};onDropdownColorSelected=e=>{const t=Be()(e);t&&(this.setState({color:t.hex().substring(1)}),this.props.setColor(t,this.props.colorKey))};render(){const e=this.props.colorKey,t=this.props.predefinedColors&&this.props.predefinedColors.length>0;let{color:s}=this.state;return UE.test(s)||(s=this.props.colorValue.replace("#","")),(0,zn.jsxs)("div",{className:Gn()("ColorEditor",{"with-dropdown":t}),children:[this.props.label&&(0,zn.jsx)("label",{htmlFor:e,className:"color-name",children:this.props.label}),(0,zn.jsxs)("div",{className:"ColorEditor-ColorPickerContainer",children:[(0,zn.jsx)(DE,{name:e,color:s,setColor:this.onColorPicked},e),t&&(0,zn.jsx)(WE,{className:"ColorEditor-VivaldiDropdown",disabled:this.props.disabled,items:this.dropdownColors,onValueChange:this.onDropdownColorSelected,tooltip:(0,W.Z)("Choose a Color"),value:s,hideButtonText:!0})]}),(0,zn.jsxs)("div",{className:"ColorEditor-HexTextInput",children:[VE,(0,zn.jsx)("input",{className:"ColorEditor-HexTextInput-InputField",type:"text",id:e,disabled:this.props.disabled,value:this.state.color,spellCheck:"false",size:"6",onChange:this.hexInputEvents})]})]})}}const GE=HE;var KE=(0,zn.jsx)("input",{type:"radio",value:"all"}),zE=(0,zn.jsx)("input",{type:"radio",value:"vevent"}),$E=(0,zn.jsx)("input",{type:"radio",value:"vtodo"});class YE extends Un.PureComponent{static defaultProps={searchableStrings:{Events:"Events",Tasks:"Tasks"}};constructor(e){super(e)}onChangeCalendarComponent=e=>{const t={...this.props.supportedCalendarComponent},{value:s}=e.target;"all"===s?(t.vtodo=!0,t.vevent=!0):(t.vtodo="vtodo"===s,t.vevent="vevent"===s),this.props.updateCalendarComponent(t)};getSupportedComponent(){const{vevent:e,vtodo:t}=this.props.supportedCalendarComponent;return e&&t?"all":e?"vevent":"vtodo"}render(){return(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Allowed Calendar Items")}),(0,zn.jsxs)(To.Z,{name:"calendar-density",value:this.getSupportedComponent(),onChange:this.onChangeCalendarComponent,className:"group",disabled:this.props.disabled,children:[(0,zn.jsxs)("label",{className:"setting-single",children:[KE,(0,zn.jsx)("span",{children:(0,W.Z)("calendar","All")})]}),(0,zn.jsxs)("label",{className:"setting-single",children:[zE,(0,zn.jsx)("span",{children:(0,W.Z)("calendar","Events Only")})]}),(0,zn.jsxs)("label",{className:"setting-single",children:[$E,(0,zn.jsx)("span",{children:(0,W.Z)("Tasks Only")})]})]})]})}}const XE=YE;const QE=async function(e,{showSaveFilePicker:t}){const s=Pr.Z.getCalendars().find((t=>t.id===e)),{description:n=(0,W.Z)("Events")}=s||{};try{!async function(e,t){if(!e)return;const s=[...Pr.Z.getEventsPerCalendar(t)];s.forEach((e=>{e.recurrenceExceptions?.length&&e.recurrenceExceptions.forEach((t=>{const n=s.findIndex((e=>e.id===t.exception_event_id));-1!==n&&(s[n]={...s[n],recurrenceId:t.date,sequence:e.sequence})}))}));const n=_r.ZP.eventsToICalendar(s);try{const t=await e.createWritable();await t.write(n),await t.close()}catch(e){ls.Z.error("Calendar",["export"],"Exporting events failed.",e)}}(await t({suggestedName:`${n}.ics`,types:[{description:(0,W.Z)("iCalendar file"),accept:{"text/calendar":[".ics"]}}]}),e)}catch(e){ls.Z.error("Calendar",["export"],"Error opening filepicker",e)}},{isLocalCalendar:qE}=_r.ZP,{UNKNOWN:JE,OK:ek,ERROR:tk}=be.LB;class sk extends Un.Component{static contextType=oi.Z;state={status:JE,statusText:"",calendar:this.props.calendar};isCalendarChanged=()=>{const e=this.props.calendar;if(!e)return!1;const t=this.state.calendar;return!(0,sw.Z)(t,e)};setCalendarProperty=e=>{this.setState((t=>({calendar:{...t.calendar,...e}})))};onChange=e=>{const{name:t,value:s}=e.target,n={},i="iconindex"===t?isNaN(s)?0:parseInt(s):s;n[t]=i,this.setCalendarProperty(n)};logStatus=(e,t)=>{this.setState({status:t,statusText:e})};saveCalendar=()=>{this.state.calendar.description?this.props.save(this.state.calendar):this.setState({statusText:(0,W.Z)("Calendar Name cannot be empty")})};setColor=(e,t,s=!1)=>{this.setCalendarProperty({color:e.hex()})};onChangeCheckbox=e=>{const{checked:t,name:s}=e.target;this.setCalendarProperty({[s]:t})};onChangeCalendarComponent=e=>{this.setCalendarProperty({supportedCalendarComponent:e})};exportCalendar=e=>{QE(this.state.calendar.id,this.context)};render(){const{description:e,hidden:t,active:s,id:n,supportedCalendarComponent:i}=this.state.calendar,{disabledProperties:a,searchableStrings:o}=this.props,r=_r.ZP.getCalendarColor(this.state.calendar),l=this.state.status===tk?"error":this.state.status===ek?"success":"info";return(0,zn.jsxs)("form",{className:"detail",onSubmit:this.saveCalendar,children:[(0,zn.jsxs)("div",{className:"detail-content",children:[(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(Vr.Z,{type:"text",onChange:this.onChange,name:"description",label:o["Calendar Name"],value:e,disabled:a.includes("name")})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",name:"hidden",checked:t,onChange:this.onChangeCheckbox}),(0,zn.jsx)("span",{children:o["Hide from Calendar View"]})]})})]}),(0,zn.jsx)("div",{className:"setting-group",children:(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(GE,{label:o.Color,colorKey:"color",colorValue:r,setColor:this.setColor,predefinedColors:Vc.hx,disabled:a.includes("color")})})}),!qE(n)&&(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Sync Calendar")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{title:(0,W.Z)("Active"),children:[(0,zn.jsx)("input",{type:"checkbox",name:"active",checked:s,onChange:this.onChangeCheckbox}),(0,zn.jsx)("span",{children:o.Active})]})})]}),(0,zn.jsx)(XE,{supportedCalendarComponent:i,updateCalendarComponent:this.onChangeCalendarComponent,searchableStrings:this.props.searchableStrings,disabled:!qE(n)}),this.state.statusText&&(0,zn.jsx)("div",{className:"setting-group-double",children:(0,zn.jsx)(fa,{type:l,children:this.state.statusText})})]}),(0,zn.jsxs)("div",{className:"detail-toolbar",children:[(0,zn.jsx)("input",{type:"submit",value:(0,W.Z)("Save"),disabled:!this.isCalendarChanged()}),(0,zn.jsx)("input",{type:"button",onClick:this.exportCalendar,value:(0,W.Z)("Export Calendar")})]})]})}}const nk=sk,{isCalendarValidToCreate:ik}=_r.ZP,{getCalendarCreateParams:ak}=Mr.Z;class ok extends Un.PureComponent{constructor(e){super(e);const t=_r.ZP.getDefaultAccount();this.state=t?{calendar:ak(t),statusText:"",status:"info"}:{calendar:null,statusText:(0,W.Z)("No Account defined. Can not create calendar."),status:"error"}}setColor=(e,t,s=!1)=>this.setCalendarProperty(t,e.hex());onAccountChange=e=>{this.setCalendarProperty("accountId",e.target.value)};onCalendarChange=e=>{const{name:t,value:s}=e.target,n="iconindex"===t?isNaN(s)?0:parseInt(s):s;this.setCalendarProperty(t,n)};setCalendarProperty=(e,t)=>this.setState((s=>{let n=s.calendar?.active;if("accountId"===e){n="local"!==Pr.Z.getAccounts().find((e=>e.id===t))?.account_type}return{calendar:s.calendar&&{...s.calendar,active:n,[e]:t},status:"info",statusText:""}}));createCalendar=async()=>{const e=this.state.calendar;if(!e)return void this.setState({status:"error",statusText:(0,W.Z)("Calendar missing")});this.setState({status:"info",statusText:(0,W.Z)("Creating calendar")});const t=await this.props.createCalendar(e);t.result.status||this.setState({status:"error",statusText:t.result.message})};isCalendarValidToCreate=()=>!!this.state.calendar&&ik(this.state.calendar);onChangeCalendarComponents=e=>{this.setState((t=>({calendar:t.calendar&&{...t.calendar,supportedCalendarComponent:e}})))};render(){const{calendar:e}=this.state,t=Pr.Z.getAccounts().filter((e=>"ical"!==e.account_type));return(0,zn.jsxs)("form",{className:"detail",onSubmit:this.createCalendar,children:[!!e&&(0,zn.jsxs)("div",{className:"detail-content",children:[t.length>1&&(0,zn.jsx)("div",{className:"setting-group",children:(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{className:"floating-label",children:[(0,zn.jsx)("span",{children:(0,W.Z)("Account")}),(0,zn.jsx)(Fa.Z,{onChange:this.onAccountChange,value:e.accountId,children:t.map((e=>(0,zn.jsx)("option",{value:e.id,children:e.name},e.id)))})]})})}),(0,zn.jsx)("div",{className:"setting-group",children:(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(Vr.Z,{type:"text",onChange:this.onCalendarChange,name:"description",label:this.props.searchableStrings["Calendar Name"],value:e.description??"",autoFocus:!0})})}),(0,zn.jsx)("div",{className:"setting-group",children:(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(GE,{label:this.props.searchableStrings.Color,colorKey:"color",colorValue:e.color||_r.ZP.getCalendarCreateColor(),setColor:this.setColor,predefinedColors:Vc.hx})})}),(0,zn.jsx)(XE,{supportedCalendarComponent:e.supportedCalendarComponent,updateCalendarComponent:this.onChangeCalendarComponents,searchableStrings:this.props.searchableStrings,disabled:!1})]}),!!this.state.statusText&&(0,zn.jsx)(fa,{type:this.state.status,children:this.state.statusText}),(0,zn.jsx)("div",{className:"detail-toolbar",children:(0,zn.jsx)("input",{className:"primary",type:"submit",disabled:!this.isCalendarValidToCreate(),value:(0,W.Z)("Create Calendar")})})]})}}const rk=ok,lk=s(28888),{ensureAccountType:dk,isCalDAV:ck}=_r.ZP,hk={"Add your First Calendar":(0,W.Z)("Add your First Calendar"),"Press the “Add” button to the left to add a new Calendar.":(0,W.Z)("Press the “Add” button to the left to add a new Calendar.")},uk={...Vc.d3,"Calendar Name":(0,W.Z)("Calendar Name"),Active:(0,W.Z)("Active"),"Hide from Calendar View":(0,W.Z)("Hide from Calendar View"),"Calendar Type":(0,W.Z)("Calendar Type"),Name:(0,W.Z)("calendar","Name"),CalDav:(0,W.Z)("CalDAV"),URL:(0,W.Z)("Address"),Subscribe:(0,W.Z)("Subscribe"),Password:(0,W.Z)("Password"),Username:(0,W.Z)("Username"),Timezone:(0,W.Z)("Timezone"),Color:(0,W.Z)("calendar","Color"),Index:(0,W.Z)("Index"),Events:(0,W.Z)("Events"),Tasks:(0,W.Z)("Tasks")};var pk=(0,zn.jsx)("div",{}),gk=(0,zn.jsx)("div",{className:"item-meta",children:" "});class mk extends Un.PureComponent{renderListItem=(e,t)=>{const s=this.props.accounts.find((e=>e.id===t.accountId));if(s){const e=dk(s.account_type),n="local"===e?Kn.Rd:Kn.eTS.large;return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("span",{className:"item-icon",style:{fill:_r.ZP.getCalendarColor(t)},dangerouslySetInnerHTML:{__html:n}}),(0,zn.jsx)("div",{className:"item-title",children:t.description||t.name}),(0,zn.jsx)("div",{className:"item-meta",children:`${s.name} (${Vc.d3[e]})`})]})}return pk};renderCreateListItem=()=>(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("div",{className:"item-title",children:(0,W.Z)("noun","New Calendar")}),gk]});save=e=>{const{id:t,...s}=e;ie.ZP.updateCalendar(t,s)};createCalendar=e=>{if(0===Pr.Z.getAccounts().length)return Mr.Z.createLocalAccountAndCalendar(null,e);{const t=this.props.accounts.find((t=>t.id===e.accountId));return ie.ZP.createCalendar(e,t,!0)}};renderContent=(e,t)=>{const{calendars:s}=this.props,n=s&&s[e];if(!n)return null;const i=Ts()(Object.values(n).reduce(((e,t)=>e+t))),a=this.props.accounts.find((e=>e.id===n.accountId)),o=[];return ck(a?.account_type)&&o.push("name"),"google"===a?.account_type&&n.supportedCalendarComponent?.vtodo&&o.push("color"),(0,zn.jsx)(nk,{save:this.save,searchableStrings:t,calendar:n,disabledProperties:o},i)};renderCreate=e=>(0,zn.jsx)(rk,{searchableStrings:e,createCalendar:this.createCalendar});renderEmpty=e=>(0,zn.jsx)("div",{className:"detail",children:(0,zn.jsxs)("div",{className:"detail-content",children:[(0,zn.jsx)("h3",{children:hk["Add your First Calendar"]}),(0,zn.jsx)("p",{children:hk["Press the “Add” button to the left to add a new Calendar."]})]})});remapCalendars=()=>this.props.calendars.map((e=>({...e,key:e.id})));deleteCalendarDialog=e=>(0,zn.jsx)(PE,{...e});render(){return(0,zn.jsx)(Vy.Z,{categoryTitle:(0,W.Z)("Calendars"),filter:this.props.filter,children:(0,zn.jsx)(SS.Z,{className:"tall",deleteDialog:this.deleteCalendarDialog,addTipString:(0,W.Z)("Add Calendar"),deleteTipString:(0,W.Z)("tooltip","Delete Calendar"),emptyListGraphic:lk,emptyListString:(0,W.Z)("No Calendars added"),filter:this.props.filter,items:this.remapCalendars(),masterLayout:0,onRemove:nr.Z,renderListItem:this.renderListItem,renderCreateListItem:this.renderCreateListItem,renderContent:this.renderContent,renderCreate:this.renderCreate,renderEmpty:this.renderEmpty,contentStrings:uk,emptyStrings:hk,createStrings:uk})})}}const fk=cS(mk),vk=[Z.kCalendarAutoAdjustEnd,Z.kCalendarAutoTabDatetime,Z.kCalendarClickOutside,Z.kCalendarClickTimeSlot,Z.kCalendarCollapseHours,Z.kCalendarDayEnds,Z.kCalendarDayStarts,Z.kCalendarDefaultAlldayNotification,Z.kCalendarDefaultAlldayNotificationTime,Z.kCalendarDefaultDuration,Z.kCalendarDefaultNotification,Z.kCalendarDisplayDensity,Z.kCalendarDisplayDimPastEvents,Z.kCalendarHandleIcsDownloads,Z.kCalendarHandleWebcalLinks,Z.kCalendarDisplayEventIcons,Z.kCalendarDisplayWeekNumber,Z.kCalendarEditMode,Z.kCalendarHiddenHidesNotifications,Z.kCalendarMailAccount,Z.kCalendarNotificationFullscreen,Z.kCalendarNotificationType,Z.kCalendarNotificationSound,Z.kCalendarNotificationVolume,Z.kCalendarOnlyHourlyDivider,Z.kCalendarOnlyHourlyKeynav,Z.kCalendarSendInviteEmailAction,Z.kCalendarTimeIncrements,Z.kMailAccounts,Z.kFeaturesCalendar],bk=I.Z.getEventHandler,Ck=[["",(0,W.Z)("other","None")],["../../../resources/notification_ding.opus",(0,W.Z)("Ding")],["../../../resources/notification_rooster.opus",(0,W.Z)("Rooster")],["../../../resources/notification_tada.opus",(0,W.Z)("Tada")]],wk=[[0,(0,W.Z)("No Duration")],[5*be.lb,(0,W.Z)("$1 minute","$1 minutes",[5])],[10*be.lb,(0,W.Z)("$1 minute","$1 minutes",[10])],[15*be.lb,(0,W.Z)("$1 minute","$1 minutes",[15])],[30*be.lb,(0,W.Z)("$1 minute","$1 minutes",[30])],[45*be.lb,(0,W.Z)("$1 minute","$1 minutes",[45])],[1*be.QI,(0,W.Z)("$1 hour","$1 hours",[1])],[2*be.QI,(0,W.Z)("$1 hour","$1 hours",[2])],[3*be.QI,(0,W.Z)("$1 hour","$1 hours",[3])],[8*be.QI,(0,W.Z)("$1 hour","$1 hours",[8])]],yk=V()().startOf("day"),xk=[];for(;yk.hour()<13;){const e=yk.hour();xk.push((0,zn.jsx)("option",{value:e,children:yk.format("LT")},e)),yk.add(1,"hour")}yk.hour(12);const Ik=[];for(;yk.hour()>0;){yk.add(1,"hour");const e=yk.hour()||24;Ik.push((0,zn.jsx)("option",{value:e,children:yk.format("LT")},e))}var Ak=(0,zn.jsx)("input",{type:"radio",value:"full"}),Sk=(0,zn.jsx)("input",{type:"radio",value:"compact"}),Zk=(0,zn.jsx)("input",{type:"radio",value:"minimal"}),Tk=(0,zn.jsx)("input",{type:"radio",value:"15"}),Ek=(0,zn.jsx)("input",{type:"radio",value:"30"}),kk=(0,zn.jsx)("input",{type:"radio",value:"60"}),Nk=(0,zn.jsx)("input",{type:"radio",value:"select"}),_k=(0,zn.jsx)("input",{type:"radio",value:"create"}),Pk=(0,zn.jsx)("input",{type:"radio",value:"cancel"}),Mk=(0,zn.jsx)("input",{type:"radio",value:"save_and_close"}),Dk=(0,zn.jsx)("input",{type:"radio",value:"inline"}),Ok=(0,zn.jsx)("input",{type:"radio",value:"popup"}),jk=(0,zn.jsx)("input",{type:"radio",value:"always"}),Lk=(0,zn.jsx)("input",{type:"radio",value:"never"}),Rk=(0,zn.jsx)("input",{type:"radio",value:"timed_only"}),Bk=(0,zn.jsx)("input",{type:"radio",value:"system"}),Fk=(0,zn.jsx)("input",{type:"radio",value:"dialog"}),Wk=(0,zn.jsx)("input",{type:"radio",value:"melt"}),Uk=(0,zn.jsx)("input",{type:"radio",value:"burn"}),Vk=(0,zn.jsx)("input",{type:"radio",value:"ask"}),Hk=(0,zn.jsx)("input",{type:"radio",value:"send"}),Gk=(0,zn.jsx)("input",{type:"radio",value:"cancel"});function Kk(e){const t=(0,Eo.Z)(vk);return(0,zn.jsxs)(zn.Fragment,{children:[t[Z.kFeaturesCalendar]&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)(FS,{filter:e.filter}),(0,zn.jsx)(fk,{filter:e.filter}),(0,zn.jsx)(_E,{filter:e.filter}),(0,zn.jsxs)(Vy.Z,{categoryTitle:(0,W.Z)("Calendar Display"),filter:e.filter,children:[(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kCalendarDisplayEventIcons],onChange:bk(Z.kCalendarDisplayEventIcons)}),(0,zn.jsx)("span",{children:(0,W.Z)("Show Event Property Icons")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kCalendarDisplayDimPastEvents],onChange:bk(Z.kCalendarDisplayDimPastEvents)}),(0,zn.jsx)("span",{children:(0,W.Z)("Show Past Events Faded")})]})}),(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kCalendarDisplayWeekNumber],onChange:bk(Z.kCalendarDisplayWeekNumber)}),(0,zn.jsx)("span",{children:(0,W.Z)("Show Week Number")})]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("For week settings see Language under General Settings.")})]})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Events View")}),(0,zn.jsxs)(To.Z,{name:"calendar-density",value:t[Z.kCalendarDisplayDensity],onChange:bk(Z.kCalendarDisplayDensity),className:"group",children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[Ak,(0,zn.jsx)("span",{children:(0,W.Z)("Full")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[Sk,(0,zn.jsx)("span",{children:(0,W.Z)("calendar","Compact")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[Zk,(0,zn.jsx)("span",{children:(0,W.Z)("Minimal")})]})})]})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Visible Day Hours")}),(0,zn.jsx)("div",{className:"setting-single day-setting-grid",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("span",{children:(0,W.Z)("Day Starts at")}),(0,zn.jsx)(Fa.Z,{name:"day_starts",value:t[Z.kCalendarDayStarts],onChange:bk(Z.kCalendarDayStarts),children:xk}),(0,zn.jsx)("span",{children:(0,W.Z)("Day Ends at")}),(0,zn.jsx)(Fa.Z,{name:"day_ends",value:t[Z.kCalendarDayEnds],onChange:bk(Z.kCalendarDayEnds),children:Ik})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kCalendarCollapseHours],onChange:bk(Z.kCalendarCollapseHours)}),(0,zn.jsx)("span",{children:(0,W.Z)("Collapse Excluded Hours")})]})})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Time Increments")}),(0,zn.jsxs)(To.Z,{name:"time-increments",value:t[Z.kCalendarTimeIncrements],onChange:bk(Z.kCalendarTimeIncrements),className:"group",children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[Tk,(0,zn.jsx)("span",{children:(0,W.Z)("15 Minutes")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[Ek,(0,zn.jsx)("span",{children:(0,W.Z)("30 Minutes")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[kk,(0,zn.jsx)("span",{children:(0,W.Z)("1 Hour")})]})})]}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kCalendarOnlyHourlyDivider],onChange:bk(Z.kCalendarOnlyHourlyDivider)}),(0,zn.jsx)("span",{children:(0,W.Z)("Show Only 1 Hour Grid Lines")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kCalendarOnlyHourlyKeynav],onChange:bk(Z.kCalendarOnlyHourlyKeynav)}),(0,zn.jsx)("span",{children:(0,W.Z)("Use 1 Hour Increments for Keyboard Navigation")})]})})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Click on Time Slot Should")}),(0,zn.jsxs)(To.Z,{name:"click-timeslot",value:t[Z.kCalendarClickTimeSlot],onChange:bk(Z.kCalendarClickTimeSlot),className:"group",children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[Nk,(0,zn.jsx)("span",{children:(0,W.Z)("Select Period")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[_k,(0,zn.jsx)("span",{children:(0,W.Z)("calendar","Create New Event")})]})})]})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Click Outside Event Should")}),(0,zn.jsxs)(To.Z,{name:"click-outside",value:t[Z.kCalendarClickOutside],onChange:bk(Z.kCalendarClickOutside),className:"group",children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[Pk,(0,zn.jsx)("span",{children:(0,W.Z)("Discard Changes")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[Mk,(0,zn.jsx)("span",{children:(0,W.Z)("Save Changes")})]})})]})]})]}),(0,zn.jsxs)(Vy.Z,{categoryTitle:(0,W.Z)("Calendar Editing"),filter:e.filter,children:[(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Edit Mode")}),(0,zn.jsxs)(To.Z,{name:"edit-mode",value:t[Z.kCalendarEditMode],onChange:bk(Z.kCalendarEditMode),className:"group",children:[(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[Dk,(0,zn.jsx)("span",{children:(0,W.Z)("Inline")})]}),(0,zn.jsx)("div",{className:Gn()("img-setting",{disabled:"popup"===t[Z.kCalendarEditMode]}),children:(0,zn.jsx)("span",{className:"image",dangerouslySetInnerHTML:{__html:s(9371)}})})]}),(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[Ok,(0,zn.jsx)("span",{children:(0,W.Z)("radio","Dialog")})]}),(0,zn.jsx)("div",{className:Gn()("img-setting",{disabled:"inline"===t[Z.kCalendarEditMode]}),children:(0,zn.jsx)("span",{className:"image",dangerouslySetInnerHTML:{__html:s(97487)}})})]})]})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Default Event Duration")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)("label",{children:(0,zn.jsx)(Fa.Z,{value:t[Z.kCalendarDefaultDuration],onChange:bk(Z.kCalendarDefaultDuration),children:wk.map((([e,t])=>(0,zn.jsx)("option",{value:e,children:t},e)))})})}),(0,zn.jsx)("h3",{children:(0,W.Z)("Default Event Reminder")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)("label",{children:(0,zn.jsx)(Fa.Z,{value:t[Z.kCalendarDefaultNotification],onChange:e=>{let t=parseInt(e.target.value);isNaN(t)&&(t=-1),I.Z.set(Z.kCalendarDefaultNotification,t)},children:zS.map((([e,t])=>(0,zn.jsx)("option",{value:e.toString(),children:t},e)))})})}),(0,zn.jsx)("h3",{children:(0,W.Z)("Default Reminder for All Day Events")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)("label",{children:(0,zn.jsx)(qS,{value:t[Z.kCalendarDefaultAlldayNotificationTime]*be.lb,onChange:e=>{isNaN(e)?(e=0,I.Z.set(Z.kCalendarDefaultAlldayNotification,!1)):I.Z.set(Z.kCalendarDefaultAlldayNotification,!0),0===t[Z.kCalendarDefaultAlldayNotificationTime]&&(e-=540*be.lb),I.Z.set(Z.kCalendarDefaultAlldayNotificationTime,e/be.lb)},create:!t[Z.kCalendarDefaultAlldayNotification],allDay:!0})})})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Auto Adjust End Time")}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Automatically update end time when editing to keep same event duration.")}),(0,zn.jsxs)(To.Z,{name:"auto-adjust-end",value:t[Z.kCalendarAutoAdjustEnd],onChange:bk(Z.kCalendarAutoAdjustEnd),className:"group",children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[jk,(0,zn.jsx)("span",{children:(0,W.Z)("Always")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[Lk,(0,zn.jsx)("span",{children:(0,W.Z)("other","Never")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[Rk,(0,zn.jsx)("span",{children:(0,W.Z)("Except for All Day Events")})]})})]})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Auto Focus Next Date/Time")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kCalendarAutoTabDatetime],onChange:bk(Z.kCalendarAutoTabDatetime)}),(0,zn.jsx)("span",{children:(0,W.Z)("Automatically move focus to next field after typing complete date or time value")})]})})]})]}),(0,zn.jsxs)(Vy.Z,{categoryTitle:(0,W.Z)("Calendar Notifications"),filter:e.filter,children:[(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",value:"none"!==t[Z.kCalendarNotificationType]?"none":"dialog",checked:"none"!==t[Z.kCalendarNotificationType],onChange:bk(Z.kCalendarNotificationType)}),(0,zn.jsx)("span",{children:(0,W.Z)("Enable Notifications")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kCalendarHiddenHidesNotifications],disabled:"none"===t[Z.kCalendarNotificationType],onChange:bk(Z.kCalendarHiddenHidesNotifications)}),(0,zn.jsx)("span",{children:(0,W.Z)("Disable for Hidden Calendars")})]})})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Notification Style")}),(0,zn.jsxs)(To.Z,{name:"calendarnotificationgroup",value:t[Z.kCalendarNotificationType]||"",onChange:bk(Z.kCalendarNotificationType),disabled:"none"===t[Z.kCalendarNotificationType],children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[Bk,(0,zn.jsx)("span",{children:(0,W.Z)("System Notification")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[Fk,(0,zn.jsx)("span",{children:(0,W.Z)("calendar","Dialog")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[Wk,(0,zn.jsx)("span",{children:(0,W.Z)("Melt Browser")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[Uk,(0,zn.jsx)("span",{children:(0,W.Z)("Burn Browser")})]})})]}),(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kCalendarNotificationFullscreen],onChange:bk(Z.kCalendarNotificationFullscreen),disabled:!("melt"===t[Z.kCalendarNotificationType]||"burn"===t[Z.kCalendarNotificationType])}),(0,zn.jsx)("span",{children:(0,W.Z)("Full Screen Notifications")})]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Applies to Melt and Burn notification type.")})]})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Notification Sound")}),(0,zn.jsx)(To.Z,{name:"calendarnotificationsoundgroup",value:t[Z.kCalendarNotificationSound]||"",onChange:bk(Z.kCalendarNotificationSound),disabled:"none"===t[Z.kCalendarNotificationType],children:Ck.map((([e,t])=>(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"radio",value:e}),(0,zn.jsx)("span",{children:t})]})},e)))}),(0,zn.jsx)("h3",{children:(0,W.Z)("Notification Volume")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(tI,{value:t[Z.kCalendarNotificationVolume],min:0,max:100,step:5,onChange:bk(Z.kCalendarNotificationVolume),label:`${t[Z.kCalendarNotificationVolume]} %`,title:(0,W.Z)("Minimum width of horizontally scaled active tab")})})]})]}),(0,zn.jsxs)(Vy.Z,{categoryTitle:(0,W.Z)("Calendar Integration"),filter:e.filter,children:[function(){const e=t[Z.kMailAccounts],s=t[Z.kCalendarMailAccount],n=e.find((e=>e.MAIL_EMAIL===s));return(0,zn.jsx)("div",{className:"setting-group",children:(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Calendar Mail Account")}),(0,zn.jsxs)(Fa.Z,{value:s,onChange:bk(Z.kCalendarMailAccount),children:[!n&&(0,zn.jsx)("option",{value:s,disabled:!0,children:(0,W.Z)("Select mail account")}),e.map((e=>(0,zn.jsx)("option",{value:e.MAIL_EMAIL,children:e.MAIL_EMAIL},e.MAIL_EMAIL)))]})]})})}(),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Send Invite Email Messages")}),(0,zn.jsxs)(To.Z,{name:"calendarinviteemailsgroup",value:t[Z.kCalendarSendInviteEmailAction]||"",onChange:bk(Z.kCalendarSendInviteEmailAction),children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[Vk,(0,zn.jsx)("span",{children:(0,W.Z)("Ask Each Time")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[Hk,(0,zn.jsx)("span",{children:(0,W.Z)("Always Send Messages")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[Gk,(0,zn.jsx)("span",{children:(0,W.Z)("Never Send Messages")})]})})]})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kCalendarHandleIcsDownloads],onChange:bk(Z.kCalendarHandleIcsDownloads)}),(0,zn.jsx)("span",{children:(0,W.Z)("Open ICS files in Vivaldi")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kCalendarHandleWebcalLinks],onChange:bk(Z.kCalendarHandleWebcalLinks)}),(0,zn.jsx)("span",{children:(0,W.Z)("Open Webcal Links in Vivaldi")})]})})]})]})," "]}),(0,zn.jsx)(YA,{categoryTitle:(0,W.Z)("Calendar"),filter:e.filter,inform:!0})]})}const zk=Un.memo(Kk),$k=e=>null;function Yk(){const e=(new Date).valueOf();I.Z.set(Z.kSettingsDonationPromoDismissed,e)}var Xk=(0,zn.jsx)(aa,{type:"heart",size:16}),Qk=(0,zn.jsx)(aa,{type:"close",size:16});function qk(){const e=Un.useContext(oi.Z),t=(0,Eo.Z)([Z.kSettingsDonationPromoDismissed]),s=(0,dS.Z)(me),n=s.isReady?Number(s.accountInfo.donationTier):1,i=Un.useCallback((()=>{const t=u._L+"#mtm_campaign=Desktop-Donate-SettingsLove";c.ZP.openURL(e.vivaldiWindowId,t)}),[e.vivaldiWindowId]);return n>0||t[Z.kSettingsDonationPromoDismissed]>0?null:(0,zn.jsxs)("div",{className:"settings-donation-suggestion",children:[(0,zn.jsxs)("div",{children:[(0,W.Z)("Love Vivaldi?"),Xk,(0,zn.jsx)("a",{href:"",className:"donate-link",onClick:i,children:(0,W.Z)("Donate!")})]}),(0,zn.jsx)("button",{className:"close transparent",onClick:Yk,title:(0,W.Z)("Hide this message"),tabIndex:-1,children:Qk})]})}const Jk=[Z.kDownloadDefaultDirectory,Z.kDownloadsAvoidTargetFilenamecollisionsWhenSavingAs,Z.kDownloadsNotifyOnComplete,Z.kDownloadsOpenPanelOnNew,Z.kDownloadsStartAutomatically,Z.kDownloadsUpdateDefaultDownloadWhenSavingAs],eN=I.Z.getEventHandler;function tN(e){const t=Un.useContext(oi.Z),s=(0,Eo.Z)(Jk),n=nI({filter:e.filter,prefPaths:Jk,name:e.category.title});return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)(Vy.Z,{categoryTitle:(0,W.Z)("Downloads"),filter:e.filter,className:"setting-group unlimited",children:[(0,zn.jsxs)("div",{className:"setting-subgroup",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Download Location")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("div",{className:"setting-single folder-selection",children:[(0,zn.jsx)("input",{type:"text",value:s[Z.kDownloadDefaultDirectory],title:(0,W.Z)("Enter Default Download Directory Path"),onChange:eN(Z.kDownloadDefaultDirectory)}),(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Select Folder..."),onClick:function(){re.Z.utilities.selectFile({windowId:t.vivaldiWindowId,title:(0,W.Z)("Select Download Folder"),type:"folder"}).then((e=>{e&&I.Z.set(Z.kDownloadDefaultDirectory,e)}))}})]})}),(0,zn.jsx)("div",{className:"setting-single pad-top",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kDownloadsStartAutomatically],onChange:eN(Z.kDownloadsStartAutomatically)}),(0,zn.jsx)("span",{children:(0,W.Z)("Save Files to Default Location Without Asking")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kDownloadsUpdateDefaultDownloadWhenSavingAs],onChange:eN(Z.kDownloadsUpdateDefaultDownloadWhenSavingAs)}),(0,zn.jsx)("span",{children:(0,W.Z)("Update Default Location When Choosing Save as Location")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kDownloadsOpenPanelOnNew],onChange:eN(Z.kDownloadsOpenPanelOnNew)}),(0,zn.jsx)("span",{children:(0,W.Z)("Display Downloads Automatically")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kDownloadsNotifyOnComplete],onChange:eN(Z.kDownloadsNotifyOnComplete)}),(0,zn.jsx)("span",{children:(0,W.Z)("Notify on Completed Downloads")})]})})]}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kDownloadsAvoidTargetFilenamecollisionsWhenSavingAs],onChange:eN(Z.kDownloadsAvoidTargetFilenamecollisionsWhenSavingAs)}),(0,zn.jsx)("span",{children:(0,W.Z)("Avoid Filename Collisions When Choosing Save as")})]})})]}),n]})}const sN=Un.memo(tN),nN={Title:(0,W.Z)("Title"),Address:(0,W.Z)("Address"),"Every 15 minutes":(0,W.Z)("Every 15 minutes"),"Every 30 minutes":(0,W.Z)("Every 30 minutes"),"Every hour":(0,W.Z)("Every hour"),"Every 2 hours":(0,W.Z)("Every 2 hours"),"Every 6 hours":(0,W.Z)("Every 6 hours"),"Every 12 hours":(0,W.Z)("Every 12 hours"),Daily:(0,W.Z)("Daily"),Weekly:(0,W.Z)("Weekly"),Never:(0,W.Z)("other","Never")};class iN extends Un.Component{constructor(e){super(e),this.state={account:this.props.account,accountIndex:this.props.accountIndex,urlValidated:!1}}isAccountChanged=()=>{const e=this.props.account;if(!e||!this.state.urlValidated)return!1;const{url:t,feedId:s,title:n,refreshInterval:i,offline:a}=this.state.account;return!(n===e.title&&t===e.url&&s===e.feedId&&i===e.refreshInterval&&a===e.offline)};isUrlValid=e=>""!==e.trim()&&(e.split(/\s/).filter((e=>e))||[e]).every((e=>(0,Ar.C3)(e)));setAccountProperty=e=>{const{name:t,value:s}=e.target,n="refreshInterval"===t?"-1"===s:this.state.account.offline,i=this.isUrlValid("url"===t?s:this.state.account.url);this.setState((e=>({account:{...e.account,[t]:s,offline:n},urlValidated:i})))};saveAccount=()=>{const{url:e,feedId:t,title:s,refreshInterval:n,lastChecked:i,offline:a}=this.state.account;this.props.save({url:e,feedId:t,title:s,refreshInterval:n,lastChecked:i,offline:a},this.props.accountIndex)};render(){return(0,zn.jsxs)("form",{className:"detail",onSubmit:this.saveAccount,children:[(0,zn.jsx)("div",{className:"detail-content",children:(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(Vr.Z,{type:"text",onChange:this.setAccountProperty,name:"title",label:this.props.searchableStrings.Title,placeholder:(0,W.Z)("Feed Title"),value:this.state.account.title,autoFocus:!this.state.account.title})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(Vr.Z,{type:"text",onChange:this.setAccountProperty,name:"url",label:this.props.searchableStrings.Address,placeholder:(0,W.Z)("Feed Address"),isVerified:this.state.urlValidated,value:this.state.account.url})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{className:"floating-label",children:[(0,zn.jsx)("span",{children:(0,W.Z)("Refresh Interval")}),(0,zn.jsx)(Fa.Z,{onChange:this.setAccountProperty,value:this.state.account.refreshInterval,name:"refreshInterval",children:al()})]})})]})}),(0,zn.jsx)("div",{className:"detail-toolbar",children:(0,zn.jsx)("input",{type:"submit",value:(0,W.Z)("Save"),disabled:!this.isAccountChanged()})})]})}}const aN=iN;function oN(e,t){re.Z.mailPrivate.getFileDirectory(t,(t=>{t&&c.ZP.openURL(e,`file://${t}`,{inCurrent:!1,inBackground:!1})}))}const rN="/resources/vivaldi_rss_default.png",lN=s(55592),dN=[Z.kRssDetectFeeds,Z.kRssEmbedYoutubeAttachments,Z.kRssShowNotifications,Z.kRssSettings],cN=I.Z.getEventHandler,hN={"Add your First Newsfeed Account":(0,W.Z)("Add your First Newsfeed Account"),"Press the “Add” button to the left to add a new account.":(0,W.Z)("Press the “Add” button to the left to add a new account.")};function uN(e){const t=Un.useContext(oi.Z),s=(0,Eo.Z)(dN),n=s[Z.kRssSettings],i=At.Z.getByAccountId(Nt.u4),[a,o]=Un.useState(n.length>i.length),[r,l]=Un.useState(!1),d=(e,t)=>{if(t<n.length)As((0,ys.Z)(e,"path"),t);else{const t=[],s=e.url.split(/\s/).filter((e=>e));s.length>1?s.forEach((s=>{const{title:n,feedId:i}=e;t.some((e=>e.url===s))||t.push({url:s,feedId:i,title:n,refreshInterval:5,lastChecked:0,offline:!1})})):t.push(e),xs(t)}};return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)(Vy.Z,{filter:e.filter,categoryTitle:(0,W.Z)("Newsfeed Accounts"),children:[a&&(0,zn.jsx)("div",{className:"setting-group",children:(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Database Error Detected")}),(0,zn.jsx)("label",{title:(0,W.Z)("Filters for feeds are missing from DB and need to be restored!"),children:(0,zn.jsx)("input",{type:"button",onClick:async()=>{l(!0),await By();const e=At.Z.getByAccountId(Nt.u4);o(n.length!==e.length),l(!1)},disabled:r,value:r?(0,W.Z)("Restoring Feeds ..."):(0,W.Z)("Restore Feeds")})})]})}),(0,zn.jsxs)("div",{className:"setting-group unlimited",children:[(0,zn.jsx)(SS.Z,{deleteTitle:(0,W.Z)("title","Delete Feed"),addTipString:(0,W.Z)("title","Add Feed"),deleteTipString:(0,W.Z)("tooltip","Delete Feed"),emptyListGraphic:lN,emptyListString:(0,W.Z)("No Feeds added"),filter:e.filter,items:n.map((e=>({...e,key:e.title,name:e.title}))),masterLayout:0,onRemove:e=>{const{feedId:t}=n[e];Is(t)},renderListItem:(e,t)=>{const s=((0,ve.Z)(t.url)?.hostname||"").split(".").slice(-2).join(".");return(0,zn.jsx)(TS,{title:t.title,meta:t.url,iconPath:s,iconFallbackPath:rN},t.url)},renderCreateListItem:()=>(0,zn.jsx)(zn.Fragment,{children:(0,zn.jsx)(TS,{title:(0,W.Z)("New Feed"),meta:(0,W.Z)("Setup in progress..."),iconFallbackPath:rN,isCreating:!0})}),renderContent:(e,t)=>{const s=n&&n[e];return s?(0,zn.jsx)(aN,{save:d,searchableStrings:t,account:s,accountIndex:e},s.url):null},renderCreate:e=>{const t={title:"",url:"",feedId:crypto.randomUUID(),lastChecked:0,refreshInterval:0,offline:!1};return(0,zn.jsx)(aN,{save:d,searchableStrings:e,account:t,accountIndex:n.length})},renderEmpty:e=>(0,zn.jsx)("div",{className:"detail",children:(0,zn.jsxs)("div",{className:"detail-content",children:[(0,zn.jsx)("h3",{children:e["Add your First Newsfeed Account"]}),(0,zn.jsx)("p",{children:e["Press the “Add” button to the left to add a new account."]})]})}),contentStrings:nN,emptyStrings:hN,className:"setting-rss-accounts"}),(0,zn.jsx)("div",{className:"setting-group",children:(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)("input",{type:"button",onClick:()=>Ls.forceRefreshAllRSSAccounts(),disabled:0===n.length,value:(0,W.Z)("Update All Feeds")})})}),(0,zn.jsx)("div",{className:"setting-group",children:(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)("input",{type:"button",onClick:()=>oN(t.vivaldiWindowId,(0,Ry.BB)(Nt.u4)),disabled:0===n.length,value:(0,W.Z)("Reveal Data Folder")})})})]})]}),(0,zn.jsxs)(Vy.Z,{categoryTitle:(0,W.Z)("Feed Settings"),filter:e.filter,children:[(0,zn.jsx)(iI.j,{filter:e.filter,heading:(0,W.Z)("Feed Detection"),children:(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{title:(0,W.Z)("Use Vivaldi Feeds to detect, preview and subscribe to feeds."),children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kRssDetectFeeds],onChange:cN(Z.kRssDetectFeeds)}),(0,zn.jsx)("span",{children:(0,W.Z)("Detect Feeds in Web Pages")})]})})}),(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)(iI.j,{filter:e.filter,heading:(0,W.Z)("Feed Notifications"),children:(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kRssShowNotifications],onChange:cN(Z.kRssShowNotifications)}),(0,zn.jsx)("span",{children:(0,W.Z)("Show Notifications for New Feed Items")})]})})}),(0,zn.jsx)(iI.j,{filter:e.filter,heading:(0,W.Z)("Attachments"),children:(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kRssEmbedYoutubeAttachments],onChange:cN(Z.kRssEmbedYoutubeAttachments)}),(0,zn.jsx)("span",{children:(0,W.Z)("Embed YouTube Links in Attachments")})]})})})]})]})]})}const pN=Un.memo(uN),gN=new Map([["SET_FLAG",(0,W.Z)("Flag")],["ADD_LABEL",(0,W.Z)("Add label")],["REMOVE_LABEL",(0,W.Z)("Remove label")],["MARK_READ",(0,W.Z)("mail","Mark as read")],["MARK_AS_SPAM",(0,W.Z)("Mark as spam")],["ARCHIVE",(0,W.Z)("Move to Archive")]]);var mN=(0,zn.jsx)("hr",{},"separator"),fN=(0,zn.jsx)("hr",{},"separator");class vN extends Un.PureComponent{state={showCreateLabel:!1,showArchivingNotification:!1};onChangeType=e=>{const t=e.target.value;let s;"ADD_LABEL"===t?s={type:"ADD_LABEL",label:(0,Dp.A4)(this.props.trigger.label||"")}:"REMOVE_LABEL"===t?s={type:"REMOVE_LABEL",label:(0,Dp.A4)(this.props.trigger.label||"")}:"MARK_READ"===t?s={type:"MARK_READ"}:"SET_FLAG"===t?s={type:"SET_FLAG",flag:this.props.trigger.flag||Nt.T4.RED}:"MARK_AS_SPAM"===t?s={type:"MARK_AS_SPAM"}:"ARCHIVE"===t&&(A.Z.get(Z.kMailAddArchiveFolder)||this.setState({showArchivingNotification:!0}),s={type:"ARCHIVE"}),s&&this.props.editTrigger(this.props.triggerIndex,s)};onChangeLabel=e=>{const t=e.target.value;if("addlabel"===t)return void this.setState({showCreateLabel:!0});switch(this.props.trigger.type){case"ADD_LABEL":const e={type:"ADD_LABEL",label:t};this.props.editTrigger(this.props.triggerIndex,e);break;case"REMOVE_LABEL":const s={type:"REMOVE_LABEL",label:t};this.props.editTrigger(this.props.triggerIndex,s)}};onChangeFlag=e=>{const t=e.target.value;if("SET_FLAG"===this.props.trigger.type){const e={type:"SET_FLAG",flag:t};this.props.editTrigger(this.props.triggerIndex,e)}};renderAction=()=>{switch(this.props.trigger.type){case"ADD_LABEL":case"REMOVE_LABEL":return this.renderLabel();case"SET_FLAG":return this.renderFlag();case"MARK_READ":case"MARK_AS_SPAM":case"ARCHIVE":return}};renderLabel=()=>{const e=At.Z.getByAccountId(Nt.ut).sort(Dp.jp).map((e=>(0,zn.jsx)("option",{value:e.path,children:(0,Zy.X)(e.path)},e.path)));return e.push([mN,(0,zn.jsx)("option",{value:"addlabel",children:(0,W.Z)("Add New Label")},"addlabel")]),(0,zn.jsx)(Fa.Z,{className:"MailTriggerSelector-select",onChange:this.onChangeLabel,value:this.props.trigger.label||"",children:e})};renderFlag=()=>{const e=fp.Z.getStandardFlagList().map((e=>(0,zn.jsx)("option",{value:e,children:(0,Uy.M)(e)},e)));return e.push([fN,(0,zn.jsx)("option",{value:Nt.T4.CLEAR_FLAGS,children:(0,Uy.M)(Nt.T4.CLEAR_FLAGS)},Nt.T4.CLEAR_FLAGS)]),(0,zn.jsx)(Fa.Z,{className:"MailTriggerSelector-select",onChange:this.onChangeFlag,value:this.props.trigger.flag||Nt.T4.RED,children:e})};onCustomLabelDlgClose=()=>(this.setState({showCreateLabel:!1}),Promise.resolve());onSetArchivingOption=e=>{e&&I.Z.set(Z.kMailAddArchiveFolder,!0),this.setState({showArchivingNotification:!1})};render(){return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("form",{className:"MailTriggerSelector",children:[(0,zn.jsx)(Fa.Z,{className:"MailTriggerSelector-select",onChange:this.onChangeType,value:this.props.trigger.type,children:[...gN.keys()].map((e=>(0,zn.jsx)("option",{value:e,children:gN.get(e)},e)))}),this.renderAction(),!this.props.lastTrigger&&(0,zn.jsx)("input",{type:"button",onClick:this.props.removeTrigger.bind(this,this.props.triggerIndex),className:"MailTriggerSelector-button circular remove"}),(0,zn.jsx)("input",{type:"button",onClick:this.props.addTrigger,className:"MailTriggerSelector-button circular add"})]}),this.state.showCreateLabel&&(0,zn.jsx)(jp,{onClose:this.onCustomLabelDlgClose,windowId:this.props.windowId,viewMode:"float"}),this.state.showArchivingNotification&&(0,zn.jsx)($C,{title:(0,W.Z)("Move to Archive"),prompt:[(0,W.Z)("The setting 'Add Archive Folder if Missing' is currently turned off. Do you want to turn it on?")],positive:(0,W.Z)("Yes"),negative:(0,W.Z)("No"),onClose:this.onSetArchivingOption})]})}}const bN=vN,CN={"Mail Filter":(0,W.Z)("Mail Filter"),Search:(0,W.Z)("mail filters","Search"),Actions:(0,W.Z)("mail filters","Actions"),Save:(0,W.Z)("Save"),Name:(0,W.Z)("mail filters","Filter Name")};var wN=(0,zn.jsx)("span",{className:"MailSearchOptions-Dash",children:"-"});class yN extends Un.Component{refButton=Un.createRef();constructor(e){super(e);const{accountId:t,path:s,selectedName:n,name:i}=this.props.filter,a={accountId:t,path:s,name:n||i,id:Wt.ZP.toFolderPath(this.props.filter.accountId,this.props.filter.path)};this.state={filter:this.props.filter,showDialog:!1,originalSelectedFolder:a,selectedFolderString:JSON.stringify(a)}}componentDidUpdate(e){e.filter!==this.props.filter&&this.setState({filter:this.props.filter})}updateName=e=>{const t=e.target.value;this.setState((0,C.Uy)((({filter:e})=>{e.name=t})))};updateFilter=e=>{const t=e.target.value;this.setState((0,C.Uy)((({filter:e})=>{e.name&&e.name!==e.filterValue.query||(e.name=t),e.filterValue.query=t})))};updateFilterCallback=(e,t)=>{this.setState((0,C.Uy)((({filter:s})=>{s.filterValue[e]=t})))};addQuery=(e,t)=>{this.setState((0,C.Uy)((({filter:t})=>{const s=Wt.ZP.getAddedQuery(e),n=t.filterValue.query,i=n?n+" "+s:s;t.name&&t.name!==n||(t.name=i),t.filterValue.query=i})),(()=>t&&this.saveFilter()))};validate=e=>!(!e.filterValue||0===Object.keys(e.filterValue).length)||(this.setState({showDialog:!0}),!1);onClose=e=>{if(this.setState({showDialog:!1}),e){const e=!0;this.saveFilter(e)}};saveFilter=e=>{if(this.refButton.current?.onBeforeAddMailFilter())return;const t=function(e){const t={...e};if(t.filterValue){const e={...t.filterValue};""===e.query&&(delete e.query,t.filterValue=e)}if(t.triggers){const e=t.triggers.filter((e=>!Object.values(e).some((e=>!e))));0===e.length?delete t.triggers:t.triggers=e}return t}(this.state.filter);(e||this.validate(t))&&(t.name||(t.name=Wt.ZP.generateFilterName()),void 0===t.id?d.Z.addFilter(t):t.id&&this.props.filter.id&&d.Z.putFilter(t,this.props.filter,!0))};getNewTrigger=()=>({type:"ADD_LABEL",label:""});addTrigger=()=>{const e=this.getNewTrigger();this.setState((0,C.Uy)((({filter:t})=>{t.triggers?t.triggers.push(e):t.triggers=[e]})))};removeTrigger=e=>{this.setState((0,C.Uy)((({filter:t})=>{const{triggers:s}=t;s&&(s.splice(e,1),0===s.length&&delete t.triggers)})))};editTrigger=(e,t)=>{this.setState((0,C.Uy)((({filter:s})=>{const{triggers:n}=s;n&&(n[e]=t)})))};selectSearchFolder=(e,t)=>{const s=At.Z.getByFolderId([e.accountId,e.path]);s&&this.setState((0,C.Uy)((n=>{n.filter.selectedName=e.name,n.filter.selectedAccountId=e.accountId,n.filter.filterValue={...s.filterValue,attachments:n.filter.filterValue.attachments,sentDate:n.filter.filterValue.sentDate,sentDateEnd:n.filter.filterValue.sentDateEnd,query:n.filter.filterValue.query},n.selectedFolderString=t})))};selectSentDateEnd=e=>{this.selectSentDate(e,!0)};selectSentDate=(e,t=!1)=>{this.setState((0,C.Uy)((({filter:s})=>{"number"==typeof e?s.filterValue[t?"sentDateEnd":"sentDate"]=e:delete s.filterValue[t?"sentDateEnd":"sentDate"]})))};selectAttachments=e=>{this.setState((0,C.Uy)((({filter:t})=>{"number"==typeof e?t.filterValue.attachments=e:delete t.filterValue.attachments})))};render(){return(0,zn.jsxs)("div",{className:"detail",children:[(0,zn.jsx)("div",{className:"detail-content",children:(0,zn.jsxs)("div",{className:"setting-group-double",children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(Vr.Z,{type:"text",onChange:this.updateName,label:this.props.searchableStrings.Name,value:this.state.filter.name||"",labelImportant:!0})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(Cx,{filter:this.state.filter,selectedFolderString:this.state.selectedFolderString,selectSearchFolder:this.selectSearchFolder,originalSelectedFolder:this.state.originalSelectedFolder,isFilterManager:!0},this.state.filter.id)}),(0,zn.jsxs)("div",{className:"setting-flexgroup",children:[(0,zn.jsxs)("div",{className:"setting-single-noflex",children:[(0,zn.jsx)(yx,{title:(0,W.Z)("Start Date"),selectSentDate:this.selectSentDate,sentDate:this.state.filter.filterValue.sentDate},this.state.filter.filterValue.sentDate),wN,(0,zn.jsx)(yx,{title:(0,W.Z)("End Date"),isEndDate:!0,selectSentDate:this.selectSentDateEnd,sentDate:this.state.filter.filterValue.sentDateEnd},this.state.filter.filterValue.sentDateEnd)]}),(0,zn.jsx)("div",{className:"setting-single-noflex",children:(0,zn.jsx)(my,{className:"MailSearchOptions-Attachments",attachments:this.state.filter.filterValue.attachments,selectAttachments:this.selectAttachments},this.state.filter.filterValue.attachments)})]}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(Bw,{settingsFilter:this.state.filter,settingsFilterCallback:this.updateFilterCallback},this.state.selectedFolderString||"new")}),this.state.filter.filterValue.query&&(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(Vr.Z,{type:"textarea",rows:"3",onChange:this.updateFilter,label:this.props.searchableStrings.Search,title:(0,W.Z)("Tokenized search through content, recipients, and subject field"),value:this.state.filter.filterValue.query||""})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(gy,{ref:this.refButton,saveFilter:this.saveFilter,isEmpty:!this.state.filter.filterValue.query,onSubmit:this.addQuery,isSettings:!0,selectedMailAddresses:[]},this.state.filter.filterValue.query)}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)("div",{className:"MailActionManagerEditor-mailTriggerSelectors",children:this.state.filter.triggers?(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("h3",{children:this.props.searchableStrings.Actions}),this.state.filter.triggers.map(((e,t)=>(0,zn.jsx)(bN,{trigger:e,triggerIndex:t,removeTrigger:this.removeTrigger,addTrigger:this.addTrigger,editTrigger:this.editTrigger,lastTrigger:!1,windowId:this.props.windowId},t)))]}):(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Add Action"),onClick:this.addTrigger})})})]})}),(0,zn.jsxs)("div",{className:"detail-toolbar",children:[!this.state.filter.id&&(0,zn.jsx)("input",{type:"button",className:"primary",onClick:()=>this.saveFilter(),disabled:this.props.filter===this.state.filter,value:(0,W.Z)("Add Mail Filter")}),this.state.filter.id&&(0,zn.jsx)("input",{type:"button",className:"primary",onClick:()=>this.saveFilter(),disabled:this.props.filter===this.state.filter,value:(0,W.Z)("Update Mail Filter")}),(0,zn.jsx)("input",{type:"button",disabled:this.props.filter===this.state.filter,onClick:()=>{this.setState((e=>({filter:this.props.filter,selectedFolderString:JSON.stringify(e.originalSelectedFolder)})))},value:(0,W.Z)("Cancel")})]}),this.state.showDialog&&(0,zn.jsx)($C,{title:(0,W.Z)("Missing search"),prompt:[(0,W.Z)("By not specifying any search parameters you are about to apply an action to all your messages. Would you like to proceed?")],positive:(0,W.Z)("Apply to All"),negative:(0,W.Z)("Cancel"),danger:!0,onRequestClose:()=>this.setState({showDialog:!1}),onClose:this.onClose})]})}}const xN=yN,IN=[Z.kMailAccounts,Z.kFeaturesMail],AN={"Filters added in the mail panel will appear here.":(0,W.Z)("Filters added in the mail panel will appear here.")};class SN extends Un.PureComponent{constructor(e){super(e),this.state={mailFilters:this.loadMailFilters()}}componentDidMount(){At.Z.addListener(this.mailFiltersChanged)}componentWillUnmount(){At.Z.removeListener(this.mailFiltersChanged)}mailFiltersChanged=()=>{const e=this.loadMailFilters();this.state.mailFilters.length===e.length&&this.state.mailFilters.every(((t,s)=>t===e[s]))||this.setState({mailFilters:e})};loadMailFilters=()=>At.Z.getAll().filter((e=>e.accountId===Nt.Kz&&e.path!==Nt.ym)).map((e=>structuredClone(e)));remapMailFilters=e=>e.map(((e,t)=>({...e,key:String(t)})));renderListItem=e=>(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("span",{className:"item-icon",dangerouslySetInnerHTML:{__html:Kn.EnF.small}}),(0,zn.jsx)("div",{className:"item-title",children:e})]});renderContent=(e,t)=>(0,zn.jsx)(xN,{searchableStrings:t,windowId:this.props.windowId,filter:this.state.mailFilters[e]},this.state.mailFilters[e].id);renderCreateListItem=()=>(0,zn.jsx)("div",{className:"item-title",children:(0,W.Z)("New Filter")});renderCreate=e=>{const t=Wt.ZP.getDefaultFilterForPath(Nt.of,Nt.ym),s={name:"",accountId:Nt.Kz,path:Math.random().toString(36).substring(2),selectedAccountId:t.accountId,selectedName:t.name,filterValue:{}};return(0,zn.jsx)(xN,{searchableStrings:e,windowId:this.props.windowId,filter:s},"new")};renderEmpty=e=>(0,zn.jsx)("div",{className:"detail",children:(0,zn.jsx)("div",{className:"detail-content",children:(0,zn.jsx)("p",{children:e["Filters added in the mail panel will appear here."]})})});removeAt=e=>{const t=this.state.mailFilters[e];d.Z.removeFilter(t.id)};render(){return 0!==this.props.prefValues[Z.kMailAccounts].length&&this.props.prefValues[Z.kFeaturesMail]?(0,zn.jsx)(SS.Z,{title:(0,W.Z)("Mail Filters and Actions"),dataAnchor:"mail_filters_and_actions",deleteTitle:(0,W.Z)("Delete Filter"),addTipString:(0,W.Z)("Add Mail Filter"),deleteTipString:(0,W.Z)("Delete Mail Filter"),masterLayout:1,items:this.remapMailFilters(this.state.mailFilters),onRemove:this.removeAt,renderListItem:this.renderListItem,renderContent:this.renderContent,contentStrings:CN,renderCreate:this.renderCreate,renderCreateListItem:this.renderCreateListItem,renderEmpty:this.renderEmpty,emptyStrings:AN,filter:this.props.filter,className:"setting-mail-filters"}):null}}const ZN=(0,zd.Z)(SN,IN),TN=[Z.kMailLabelItemsOrder,Z.kMailLabelItemsHide];class EN extends Un.PureComponent{constructor(e){super(e)}#Pt=()=>(0,Dp._c)(!0).map((e=>({key:e.path,name:(0,Zy.X)(e.path),...(0,fi.Z)((0,Zy.X)(e.path))})));#Mt=(e,t)=>{const s=this.props.prefValues[Z.kMailLabelItemsOrder].slice(),[n]=s.splice(e,1);s.splice(t,0,n),I.Z.set(Z.kMailLabelItemsOrder,s)};#De=e=>{const t=new Set(A.Z.get(Z.kMailLabelItemsHide));t.has(e)?t.delete(e):t.add(e),I.Z.set(Z.kMailLabelItemsHide,[...t])};#Dt=(e,t)=>{const{key:s,name:n}=t,i=!new Set(A.Z.get(Z.kMailLabelItemsHide)).has(s);return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("input",{type:"checkbox",value:s,checked:i,onChange:this.#De.bind(this,s)}),n]})};render(){const e=this.#Pt();return(0,zn.jsxs)("div",{className:"setting-single","data-anchor":"labels",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Message Label Order and Visibility")}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Hide, show and re-order Message Labels.")}),(0,zn.jsx)(Hy.Z,{filter:this.props.filter,items:e,moveItem:this.#Mt,renderListItem:this.#Dt,supportDragAndDrop:!0,mimeType:"vivaldi/x-settings-quick-command-type"})]})}}const kN=(0,zd.Z)(EN,TN),NN=[Z.kCalendarRelativeDates,Z.kFeaturesMail,Z.kMailAutoMarkAsRead,Z.kMailCountersPanelArchiveEnabled,Z.kMailCountersPanelDraftsEnabled,Z.kMailCountersPanelJunkEnabled,Z.kMailCountersPanelSwitcherEnabled,Z.kMailCountersPanelTrashEnabled,Z.kMailCountersPanelUnseenEnabled,Z.kMailCountersStatusButtonEnabled,Z.kMailListButtons,Z.kMailNotifications,Z.kMailNotificationsOnSuccessfullySent,Z.kMailNotificationsSoundOn,Z.kMailSearchOnEnter,Z.kMailSearchFolder,Z.kMailSearchSortField,Z.kMailSearchSortFieldSent,Z.kMailMessageListPreview,Z.kMailMessageListPreviewVerticalOnly,Z.kMailMessageListJumpToLatest,Z.kMailViewLayout],_N=I.Z.getEventHandler;var PN=(0,zn.jsx)("input",{type:"radio",value:"horizontal"}),MN=(0,zn.jsx)("input",{type:"radio",value:"vertical"}),DN=(0,zn.jsx)("input",{type:"radio",value:"vertical_wide"}),ON=(0,zn.jsx)("input",{type:"radio",value:"text_menu"}),jN=(0,zn.jsx)("input",{type:"radio",value:"icons_only"}),LN=(0,zn.jsx)("option",{value:"all",children:'_("All Messages")}'});function RN(e){const t=Un.useContext(oi.Z),s=(0,Eo.Z)(NN),[n,i]=Un.useState(!1);if(Un.useEffect((()=>{!async function e(){const t=(await rs.Z.systemTasks.toArray()).some((e=>"restore_mail_db"===e.taskName));i(t),t&&setTimeout(e,1e4)}()}),[]),n)return(0,zn.jsxs)("div",{children:[(0,zn.jsx)("h1",{children:(0,W.Z)("Mail Settings Unavailable")}),(0,zn.jsx)("p",{children:(0,W.Z)("Database being restored. See progress in Mail Status or Status Bar.")})]});const a="mail"===e.settingsFeature,o="feeds"===e.settingsFeature;return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)(Vy.Z,{categoryTitle:(0,W.Z)("Message View Settings"),filter:e.filter,excludeFromSearch:o&&s[Z.kFeaturesMail],children:[(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Message List Preview")}),(0,zn.jsxs)(Fa.Z,{name:"messagelistpreview",value:s[Z.kMailMessageListPreview],onChange:_N(Z.kMailMessageListPreview),children:[(0,zn.jsx)("option",{value:"0",children:(0,W.Z)("mail preview","None")}),(0,zn.jsx)("option",{value:"1",children:(0,W.Z)("1 line")}),(0,zn.jsx)("option",{value:"2",children:(0,W.Z)("2 lines")}),(0,zn.jsx)("option",{value:"3",children:(0,W.Z)("3 lines")})]})]}),(0,zn.jsx)("div",{className:"setting-single pad-top",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kMailMessageListPreviewVerticalOnly],onChange:_N(Z.kMailMessageListPreviewVerticalOnly)}),(0,zn.jsx)("span",{children:(0,W.Z)("Only Show Message Preview in Vertical View")})]})})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Message List Layout")}),(0,zn.jsxs)(To.Z,{name:"mailviewgroup",value:s[Z.kMailViewLayout],onChange:_N(Z.kMailViewLayout),children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[PN,(0,zn.jsx)("span",{children:(0,W.Z)("mail","Horizontal")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[MN,(0,zn.jsx)("span",{children:(0,W.Z)("mail","Vertical")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[DN,(0,zn.jsx)("span",{children:(0,W.Z)("Vertical Wide")})]})})]}),(0,zn.jsx)("div",{className:"setting-single pad-top",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kCalendarRelativeDates],onChange:_N(Z.kCalendarRelativeDates)}),(0,zn.jsx)("span",{children:(0,W.Z)("Use Relative Dates")})]})})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Message List Sorting")}),a&&(0,zn.jsxs)("div",{children:[(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Default order for sent folders")}),(0,zn.jsx)("label",{children:(0,zn.jsxs)(Fa.Z,{name:"mailsortfieldsent",value:s[Z.kMailSearchSortFieldSent],onChange:_N(Z.kMailSearchSortFieldSent),children:[(0,zn.jsx)("option",{value:"sender",children:(0,W.Z)("mail","Sort by Recipient")}),(0,zn.jsx)("option",{value:"subject",children:(0,W.Z)("mail","Sort by Subject")}),(0,zn.jsx)("option",{value:"sentDate",children:(0,W.Z)("mail","Sort by Date Sent")}),(0,zn.jsx)("option",{value:"threads",children:(0,W.Z)("mail","Sort by Date (Threaded)")})]})})]}),(0,zn.jsxs)("div",{children:[(0,zn.jsx)("p",{className:"info",children:a?(0,W.Z)("Default order for other folders"):(0,W.Z)("Default order for feeds")}),(0,zn.jsx)("label",{children:(0,zn.jsxs)(Fa.Z,{name:"mailsortfield",value:s[Z.kMailSearchSortField],onChange:_N(Z.kMailSearchSortField),children:[(0,zn.jsx)("option",{value:"sender",children:(0,W.Z)("mail","Sort by Sender")}),(0,zn.jsx)("option",{value:"subject",children:(0,W.Z)("mail","Sort by Subject")}),(0,zn.jsx)("option",{value:"sentDate",children:(0,W.Z)("mail","Sort by Date Received")}),(0,zn.jsx)("option",{value:"threads",children:(0,W.Z)("mail","Sort by Date (Threaded)")})]})})]}),(0,zn.jsx)("div",{className:"setting-single pad-top",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kMailMessageListJumpToLatest],onChange:_N(Z.kMailMessageListJumpToLatest)}),(0,zn.jsx)("span",{children:(0,W.Z)("Show Jump to Latest")})]})})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("New Message Notifications")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kMailNotifications],onChange:_N(Z.kMailNotifications)}),(0,zn.jsx)("span",{children:(0,W.Z)("mail","Enabled")})]})}),(0,zn.jsx)("div",{className:"setting-single pad-left",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kMailNotificationsSoundOn],disabled:!s[Z.kMailNotifications],onChange:_N(Z.kMailNotificationsSoundOn)}),(0,zn.jsx)("span",{children:(0,W.Z)("mail","Play Sound")})]})}),a&&(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kMailNotificationsOnSuccessfullySent],disabled:!s[Z.kMailNotifications],onChange:_N(Z.kMailNotificationsOnSuccessfullySent)}),(0,zn.jsx)("span",{children:(0,W.Z)("Notify on Successfully Sent")})]})})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Unseen Messages")}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Highlight unread messages that have not been seen since the last check.")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kMailCountersPanelUnseenEnabled],onChange:_N(Z.kMailCountersPanelUnseenEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("Highlight and Count Unseen Messages")})]})})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Unread Messages")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kMailAutoMarkAsRead],onChange:_N(Z.kMailAutoMarkAsRead)}),(0,zn.jsx)("span",{children:(0,W.Z)("Automatically Mark as Read")})]})})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Filter View Buttons")}),(0,zn.jsxs)(To.Z,{name:"maillistbuttons",value:s[Z.kMailListButtons],onChange:_N(Z.kMailListButtons),children:[(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[ON,(0,zn.jsx)("span",{children:(0,W.Z)("Text Menu")})]}),(0,zn.jsx)("div",{className:"text_menu"===s[Z.kMailListButtons]?"img-setting":"img-setting disabled",children:(0,zn.jsx)("span",{className:"text_menu"===s[Z.kMailListButtons]?"mail-settings-image image alternate":"mail-settings-image image",dangerouslySetInnerHTML:{__html:Kn.yYJ}})})]}),(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[jN,(0,zn.jsx)("span",{children:(0,W.Z)("Icons Only")})]}),(0,zn.jsx)("div",{className:"icons_only"===s[Z.kMailListButtons]?"img-setting":"img-setting disabled",children:(0,zn.jsx)("span",{className:"icons_only"===s[Z.kMailListButtons]?"mail-settings-image image alternate":"mail-settings-image image",dangerouslySetInnerHTML:{__html:Kn.EO4}})})]})]})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Message Search")}),(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kMailSearchOnEnter],onChange:_N(Z.kMailSearchOnEnter)}),(0,zn.jsx)("span",{children:(0,W.Z)("Start Search Using Enter Key")})]})]}),(0,zn.jsxs)("div",{className:"setting-single pad-top",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Default Search Folder")}),(0,zn.jsxs)(Fa.Z,{name:"mailsearchfoldergroup",value:s[Z.kMailSearchFolder],onChange:_N(Z.kMailSearchFolder),children:[LN,(0,zn.jsx)("option",{value:"current",children:(0,W.Z)("Current Folder")})]})]})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Message Counters")}),a&&(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kMailCountersStatusButtonEnabled],onChange:_N(Z.kMailCountersStatusButtonEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("Show on Status Button")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kMailCountersPanelSwitcherEnabled],onChange:_N(Z.kMailCountersPanelSwitcherEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("Show on Panel Button")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kMailCountersPanelTrashEnabled],onChange:_N(Z.kMailCountersPanelTrashEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("Include Trash Messages")})]})}),a&&(0,zn.jsxs)("div",{children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kMailCountersPanelJunkEnabled],onChange:_N(Z.kMailCountersPanelJunkEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("Include Spam Messages")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kMailCountersPanelArchiveEnabled],onChange:_N(Z.kMailCountersPanelArchiveEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("Include Archive Messages")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kMailCountersPanelDraftsEnabled],onChange:_N(Z.kMailCountersPanelDraftsEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("Include Draft Messages")})]})})]})]}),(0,zn.jsx)("div",{className:"setting-group",children:(0,zn.jsx)(kN,{filter:e.filter})})]}),a&&(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsx)(ZN,{windowId:t.vivaldiWindowId,filter:e.filter})})]})}const BN=Un.memo(RN),FN=[Z.kFeaturesFeeds,Z.kFeaturesMail];function WN(e){const t=(0,Eo.Z)(FN);return(0,zn.jsxs)(zn.Fragment,{children:[(t[Z.kFeaturesFeeds]||t[Z.kFeaturesMail])&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsx)(pN,{filter:e.filter})}),(0,zn.jsx)(BN,{filter:e.filter,settingsFeature:"feeds"})]}),(0,zn.jsx)(YA,{categoryTitle:(0,W.Z)("Feeds"),filter:e.filter,inform:!0})]})}const UN=Un.memo(WN);class VN extends Un.PureComponent{_isMounted=!1;_updateNotifierStatusKnown=!1;static#Ot=void 0;state={showUpdateSettings:!1,updateNotifierEnabled:!1,autoInstallUpdate:!0};componentDidMount(){this._isMounted=!0,void 0===VN.#Ot&&re.Z.autoUpdate.hasAutoUpdates().then((e=>{VN.#Ot=e,this._isMounted&&this.forceUpdate()}))}componentWillUnmount(){this._isMounted=!1}refreshUpdateNotifierEnabled=()=>{re.Z.autoUpdate.isUpdateNotifierEnabled((e=>{this.setUpdateNotifierEnabled(e)}))};setUpdateNotifierEnabled=e=>{this._isMounted&&this.setState({updateNotifierEnabled:e})};refreshAutoInstallUpdates=()=>{re.Z.autoUpdate.getAutoInstallUpdates((e=>{this._isMounted&&this.setState({autoInstallUpdate:e})}))};toggleUpdateSettings=()=>{this._updateNotifierStatusKnown||(this._updateNotifierStatusKnown=!0,this.refreshUpdateNotifierEnabled()),this.setState((e=>({showUpdateSettings:!e.showUpdateSettings})))};toggleUpdateNotifier=e=>{e.target.checked?re.Z.autoUpdate.enableUpdateNotifier((e=>{e?this.setUpdateNotifierEnabled(!0):this.refreshUpdateNotifierEnabled()})):re.Z.autoUpdate.disableUpdateNotifier((e=>{e?this.setUpdateNotifierEnabled(!1):this.refreshUpdateNotifierEnabled()}))};toggleAutoInstallUpdate=e=>{const t=e.target.checked;re.Z.autoUpdate.setAutoInstallUpdates(t),this.refreshAutoInstallUpdates()};getUpdateLabel(){return!1===VN.#Ot?(0,W.Z)("Automatically download updates and notify when they are ready to install"):(0,W.Z)("Automatically Download and Install Updates")}render(){return(0,zn.jsx)(Vy.Z,{categoryTitle:(0,W.Z)("Updates"),filter:this.props.filter,children:(0,zn.jsxs)("div",{className:"setting-group unlimited",children:[(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Get the latest security fixes by allowing automatic updates of Vivaldi.")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)("input",{type:"button",value:this.state.showUpdateSettings?(0,W.Z)("Hide Update Settings"):(0,W.Z)("Show Update Settings"),onClick:this.toggleUpdateSettings})}),this.state.showUpdateSettings&&(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.state.updateNotifierEnabled,onChange:this.toggleUpdateNotifier}),(0,zn.jsx)("span",{children:this.getUpdateLabel()})]})}),!1]})})}}const HN=VN;var GN=s(9761),KN=s(1658);const zN=[Z.kAcceptLanguages];class $N extends Un.PureComponent{static contextType=oi.Z;_isMounted=!1;state={language:F.ZP.UI_LANGUAGE,acceptLangs:[],acceptLangsList:[]};componentDidMount(){this._isMounted=!0,n.Z.languageSettingsPrivate.getLanguageList((e=>{if(n.Z.runtime.lastError)console.error(n.Z.runtime.lastError.message);else if(this._isMounted){const t=[];for(const s of e){if(s.code===s.nativeDisplayName){const e=GN.lE.find((e=>e.key===s.code));if(!e)continue;s.nativeDisplayName=e.local}t.push(s)}this.setState({acceptLangsList:t.sort(((e,t)=>e.code.localeCompare(t.code))).map((e=>({key:e.code,value:e.nativeDisplayName})))})}})),this.updateAcceptedList()}componentWillUnmount(){this._isMounted=!1}updateAcceptedList=()=>{n.Z.i18n.getAcceptLanguages((e=>{n.Z.runtime.lastError?(console.error(n.Z.runtime.lastError.message),this._isMounted&&this.setState({acceptLangs:[]})):this._isMounted&&this.setState({acceptLangs:e})}))};onContextMenu=(e,t)=>{const s=[];e>=0&&e<this.state.acceptLangs.length&&(s.push({...(0,fi.Z)("Move to Top"),handler:this.moveItemToTop.bind(this,e),isVisible:()=>0!==e}),s.push({...(0,fi.Z)("Move Up"),handler:this.moveItem.bind(this,e,e-1),isVisible:()=>e>1}),s.push({...(0,fi.Z)("Move Down"),handler:this.moveItem.bind(this,e,e+1),isVisible:()=>e!==this.state.acceptLangs.length-1}),s.push({...(0,fi.Z)("verb","Remove"),handler:this.removeItem.bind(this,e),isVisible:()=>this.state.acceptLangs[e]!==this.state.language&&this.state.acceptLangs.length>1})),(0,mi.Z)(this.context,s)(t)};addItem=e=>{if(e&&e.target){const t=e.target.value;n.Z.languageSettingsPrivate.enableLanguage(t),this.updateAcceptedList()}};moveItem=(e,t)=>{const s=t<e?"UP":"DOWN",i=Math.abs(e-t);(0,KN.Z)(i,(()=>{n.Z.languageSettingsPrivate.moveLanguage(this.state.acceptLangs[e],s)})),this.updateAcceptedList()};moveItemToTop=e=>{n.Z.languageSettingsPrivate.moveLanguage(this.state.acceptLangs[e],"TOP"),this.updateAcceptedList()};removeItem=e=>{this.state.acceptLangs.length<=1||(n.Z.languageSettingsPrivate.disableLanguage(this.state.acceptLangs[e]),this.updateAcceptedList())};resetToDefault=()=>{I.Z.reset(Z.kAcceptLanguages),this.updateAcceptedList()};resetTranslationSettingsToDefault=()=>{re.Z.prefs.resetTranslationPrefs()};remapLangs=()=>this.state.acceptLangs.map((e=>({key:e,name:e,isDefault:Boolean(e===this.state.language||this.state.acceptLangs.length<=1)})));renderItem=(e,t)=>(0,zn.jsx)("span",{children:e});render(){const e=this.state.acceptLangsList.filter((e=>!this.state.acceptLangs.includes(e.key)));return e.unshift({key:"",value:(0,W.Z)("Select Language")}),(0,zn.jsx)(tb.Z,{filter:this.props.filter,children:(0,zn.jsxs)("div",{className:"setting-group accept-language-list",children:[(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Accept Languages")}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Preferred languages, accepted by compatible websites in given order.")}),this.state.acceptLangsList.length>0?(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)(Hy.Z,{items:this.remapLangs(),filter:this.props.filter,onCreateItem:this.addItem,moveItem:this.moveItem,onRemove:this.removeItem,onContextMenu:this.onContextMenu,renderListItem:this.renderItem,optionsList:e,addTipString:(0,W.Z)("Add Language"),deleteTipString:(0,W.Z)("Remove Language"),supportDragAndDrop:!0,mimeType:"vivaldi/x-settings-accept-langage"}),(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Reset to Default"),onClick:this.resetToDefault})]}):(0,zn.jsx)("p",{children:(0,W.Z)("Language list retrieval for “$1” failed",[this.state.language])})]}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Reset Translation Settings to Default"),onClick:this.resetTranslationSettingsToDefault})})]})})}}const YN=$N,XN=[Z.kCalendarDateFormat,Z.kCalendarStartOfWeek,Z.kCalendarWeekNumberRule],QN=[...zN,...XN],qN=I.Z.getEventHandler,JN={width:400,minWidth:"unset"},e_=[...GN.lE].sort(((e,t)=>e.local.localeCompare(t.local)));function t_(e){const t=(0,Eo.Z)(XN),[s,n]=Un.useState(""),[i,a]=Un.useState(""),[o,r]=Un.useState(!1),[l,d]=Un.useState(F.ZP.getLocale()),c=()=>{re.Z.utilities.getSystemDateFormat((e=>{d(F.ZP.getLocale(e))}))};Un.useEffect((()=>{re.Z.utilities.getLanguage((e=>{a(e),n(e)})),c()}),[]),Un.useEffect((()=>{c()}),[t]);const h=()=>{re.Z.utilities.setLanguage(i,(()=>{Nb.Z.setTargetTranslationCode(Nb.Z.getTranslationCode(i)),n(i),r(!1)}))},u=()=>{a(s),r(!1)},p=V()(),{longDateFormat:g,week:m,weekdays:f}=l;return p.localeData()._week=l.week,(0,zn.jsxs)(Vy.Z,{categoryTitle:(0,W.Z)("Language"),"data-anchor":"language",filter:e.filter,children:[(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("These settings require a restart to take full effect.")}),o&&(()=>{const e=e_.find((e=>e.key===i));return e?(0,zn.jsx)(Ha.Z,{className:"float",style:JN,onRequestClose:u,title:(0,W.Z)("Save New Language?"),children:(0,zn.jsxs)("div",{className:"dialog-restore-shortcuts",children:[(0,zn.jsxs)("div",{className:"dialog-content",children:[(0,zn.jsx)("p",{children:(0,W.Z)("Vivaldi user interface language will be set to:")}),(0,zn.jsx)("p",{children:(0,zn.jsx)("strong",{children:e.local+(e.value!==e.local?" – "+e.value:"")})}),(0,zn.jsx)("p",{children:(0,W.Z)("Browser restart is required for new setting to take effect.")})]}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"button",className:"danger",onClick:h,value:(0,W.Z)("Save Language")}),(0,zn.jsx)("input",{type:"button",onClick:u,value:(0,W.Z)("Cancel"),autoFocus:!0})]})]})}):null})(),(0,zn.jsxs)("form",{className:"setting-group",onSubmit:()=>{r(!0)},children:[(0,zn.jsx)("h3",{children:(0,W.Z)("User Interface Language")}),(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)(Fa.Z,{onChange:e=>{const t=e.currentTarget.selectedOptions[0].dataset.lang;a(t)},value:i.toLowerCase(),children:e_.map((e=>(0,zn.jsx)("option",{value:e.key.toLowerCase(),"data-lang":e.key,children:e.local+(e.value!==e.local?" – "+e.value:"")},e.key)))}),(0,zn.jsx)("input",{type:"submit",className:"primary",disabled:i===s,value:(0,W.Z)("Save Language")})]})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Preferred Date & Time Format")}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Affects beginning day of week, time and date display format.")}),(0,zn.jsxs)(Fa.Z,{value:t[Z.kCalendarDateFormat],onChange:e=>{const t=e.target.value;I.Z.set(Z.kCalendarDateFormat,t)},children:[(0,zn.jsx)("option",{value:"system",children:(0,W.Z)("Inherit from Operating System")}),(0,zn.jsx)("option",{value:"language",children:(0,W.Z)("Same as Selected Language")})]})]}),(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Week Starts On")}),(0,zn.jsx)("label",{children:(0,zn.jsxs)(Fa.Z,{name:"week_starts",value:t[Z.kCalendarStartOfWeek],onChange:qN(Z.kCalendarStartOfWeek),children:[(0,zn.jsx)("option",{value:"system",children:(0,W.Z)("System Default")}),(0,zn.jsx)("option",{value:"sunday",children:(0,W.Z)("Sunday")}),(0,zn.jsx)("option",{value:"monday",children:(0,W.Z)("Monday")}),(0,zn.jsx)("option",{value:"tuesday",children:(0,W.Z)("Tuesday")}),(0,zn.jsx)("option",{value:"wednesday",children:(0,W.Z)("Wednesday")}),(0,zn.jsx)("option",{value:"thursday",children:(0,W.Z)("Thursday")}),(0,zn.jsx)("option",{value:"friday",children:(0,W.Z)("Friday")}),(0,zn.jsx)("option",{value:"saturday",children:(0,W.Z)("Saturday")})]})})]}),(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("First Week Number")}),(0,zn.jsx)("label",{children:(0,zn.jsxs)(Fa.Z,{name:"week_number_rule",value:t[Z.kCalendarWeekNumberRule],onChange:qN(Z.kCalendarWeekNumberRule),children:[(0,zn.jsx)("option",{value:"4",children:(0,W.Z)("First 4 Day Week (ISO8601)")}),(0,zn.jsx)("option",{value:"1",children:(0,W.Z)("First Week in Calendar Year")}),(0,zn.jsx)("option",{value:"7",children:(0,W.Z)("First Whole Week")})]})})]}),(0,zn.jsxs)("dl",{className:"info",style:{display:"grid",gridTemplateColumns:"auto 1fr",gridGap:"2px 8px",margin:"12px 0"},children:[(0,zn.jsx)("dt",{children:(0,W.Z)("Time Format")}),(0,zn.jsx)("dd",{children:p.format(g.LT)}),(0,zn.jsx)("dt",{children:(0,W.Z)("Short Date")}),(0,zn.jsx)("dd",{children:p.format(g.L)}),(0,zn.jsx)("dt",{children:(0,W.Z)("Long Date")}),(0,zn.jsx)("dd",{children:p.format(g.LLLL)}),(0,zn.jsx)("dt",{children:(0,W.Z)("Start of Week")}),(0,zn.jsx)("dd",{children:f[m.dow]}),(0,zn.jsx)("dt",{children:(0,W.Z)("Week Number")}),(0,zn.jsx)("dd",{children:p.week()})]})]}),(0,zn.jsx)(YN,{filter:e.filter})]})}const s_=Un.memo(t_),n_=I.Z.getEventHandler,i_=[Z.kWindowsShowWindowCloseConfirmationDialog];class a_ extends Un.Component{render(){return(0,zn.jsx)(tb.Z,{filter:this.props.filter,children:(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Close Window Confirmation")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.props.prefValues[Z.kWindowsShowWindowCloseConfirmationDialog],onChange:n_(Z.kWindowsShowWindowCloseConfirmationDialog)}),(0,zn.jsx)("span",{children:(0,W.Z)("Show Close Window Confirmation Dialog")})]})})]})})}}const o_=(0,zd.Z)(a_,i_),r_=I.Z.getEventHandler,l_=[Z.kSystemShowExitConfirmationDialog];class d_ extends Un.Component{renderMacQuitConfirmation(){return(0,zn.jsx)(tb.Z,{filter:this.props.filter,children:(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Quit Confirmation")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.props.prefValues[Z.kConfirmToQuitEnabled],onChange:r_(Z.kConfirmToQuitEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("Warn on Quit (⌘Q)")})]})})]})})}renderExitConfirmation(){return(0,zn.jsx)(tb.Z,{filter:this.props.filter,children:(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Exit Confirmation")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.props.prefValues[Z.kSystemShowExitConfirmationDialog],onChange:r_(Z.kSystemShowExitConfirmationDialog)}),(0,zn.jsx)("span",{children:(0,W.Z)("Show Exit Confirmation Dialog")})]})})]})})}render(){return this.renderExitConfirmation()}}const c_=(0,zd.Z)(d_,l_),h_="about:blank",u_=[Z.kHomepage,Z.kHomepageCache];class p_ extends Un.Component{state={customHomepage:this.props.prefValues[Z.kHomepageCache]};saveHomePage=({currentTarget:e})=>{const t=""!==e.value?(0,Ar.Rz)(e.value):e.value;I.Z.set(Z.kHomepage,t||h_),t!==u.QG&&(this.setState({customHomepage:e.value}),I.Z.set(Z.kHomepageCache,t))};render(){const e=(this.props.prefValues[Z.kHomepage]===h_?"":this.props.prefValues[Z.kHomepage])===u.QG;return(0,zn.jsx)(tb.Z,{filter:this.props.filter,children:(0,zn.jsxs)("div",{className:"setting-group homepage",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("noun","Homepage")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"radio",name:"startpage_url",onChange:this.saveHomePage,checked:e,value:u.QG}),(0,zn.jsx)("span",{children:(0,W.Z)("other","Start Page")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"radio",name:"startpage_url",onChange:this.saveHomePage,checked:!e,value:this.props.prefValues[Z.kHomepageCache]}),(0,zn.jsx)("span",{children:(0,W.Z)("Specific Page")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)("input",{type:"text",placeholder:(0,W.Z)("Address"),disabled:e,onChange:this.saveHomePage,value:this.state.customHomepage})})]})})}}const g_=(0,zd.Z)(p_,u_);var m_=s(53454),f_=s(34155);const v_={width:500,minWidth:"unset"};const b_=function({from:e,onClose:t}){if(!(0,dS.Z)(m_.Z).length)return f_.nextTick((()=>t(!0))),null;const s=()=>{t(!1)};return(0,zn.jsxs)(Ha.Z,{onRequestClose:s,className:"slide float",style:v_,title:(0,W.Z)("Disable Workspaces"),children:[(0,zn.jsx)("div",{className:"dialog-content",children:(0,zn.jsxs)("p",{className:"error",children:["startup"===e&&(0,W.Z)("Workspaces currently require setting set to “Startup with Last Session”, otherwise they will be disabled.")," ",(0,W.Z)("What would you like to do with the tabs that are currently in a Workspace?")]})}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"button",className:"primary",value:(0,W.Z)("verb","Move Tabs"),onClick:async()=>{const e=fe.ZP.getLastActiveBrowserWindowId();if(e===fe.Ex)return console.warn("No active window found"),void t(!1);for(const t of fe.ZP.getIds("normal")){await c.ZP.setActiveWorkspace(t,void 0);const s=Ze.ZP.getPages(t).filter((e=>void 0!==(0,hg.cm)(e)));s.size>0&&await c.ZP.moveToWindow(s,e)}t(!0)},autoFocus:!0}),(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("verb","Close Tabs"),onClick:async()=>{for(const e of fe.ZP.getIds("normal")){await c.ZP.setActiveWorkspace(e,void 0);const t=Ze.ZP.getPages(e).filter((e=>void 0!==(0,hg.cm)(e)));await c.ZP.closePage(t,{bypassConfirm:!0,forceClosePinned:!0})}t(!0)}}),(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Cancel"),onClick:s})]})]})};function C_({filter:e,onSave:t,onDelete:s,urlItem:n}){return(0,zn.jsx)(tb.Z,{filter:e,children:(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("input",{className:"edit",type:"text",value:n.url,onChange:e=>{n.url=e.target.value,t(n)}}),(0,zn.jsx)("input",{type:"button",tabIndex:"-1",className:"circular clearkey",onClick:s,title:(0,W.Z)("Remove page")})]})})}function w_(e){const t=(0,Un.createRef)(),[s,n]=(0,Un.useState)(!1),[i,a]=(0,Un.useState)((A.Z.get(Z.kURLsToRestoreOnStartup)||[]).map(((e,t)=>({url:e,id:t})))),o=e=>e.includes(":")?e:"http://"+e,r=e=>{a(e);const t=e.map((e=>e.url));I.Z.set(Z.kURLsToRestoreOnStartup,t)},l=()=>{const e=t.current;if(!e)return;const s=o(e.value),a=[...i];a.push({url:s,id:a.length}),e.value="",n(!1),r(a)},d=e=>{const t=[...i],s=t.find((t=>t.id===e.id));s&&(s.url=o(e.url)),r(t)};return(0,zn.jsx)(tb.Z,{filter:e.filter,children:(0,zn.jsxs)("div",{className:"setting-group setting-startup-specific-pages",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Startup Pages")}),i.map((t=>(0,zn.jsx)(C_,{urlItem:t,onDelete:()=>(e=>{const t=[...i],s=t.find((t=>t.id===e.id));t.splice(t.indexOf(s),1),r(t)})(t),onSave:d,filter:e.filter},t.id))),(0,zn.jsxs)("form",{className:"setting-flexgroup",onSubmit:l,children:[(0,zn.jsx)("input",{type:"text",className:"setting-single-flex",ref:t,value:e.url,onKeyUp:e=>{const{keyCode:t,currentTarget:s}=e;if(s.value.length>2?n(!0):n(!1),t===mo.Z.KEY_ESCAPE)s.value="",n(!1);else{if(t!==mo.Z.KEY_RETURN&&t!==mo.Z.KEY_ENTER||!(s.value.length>2))return;l()}},placeholder:(0,W.Z)("Enter page URL")}),(0,zn.jsx)("input",{type:"submit",className:"setting-single-noflex",disabled:!s,value:(0,W.Z)("Add")}),(0,zn.jsx)("input",{type:"button",onClick:()=>{const e=[];for(const[t,s]of fe.ZP.getState())"normal"===s.type&&Ze.ZP.getPages(t).forEach((({url:t},s)=>{vs.jk.isInternalUrl(t)||e.push({id:s,url:t})}));r(e)},value:(0,W.Z)("Use Current Pages")})]})]})})}const y_=[Z.kTabsAlwaysLoadPinnedAfterRestore,Z.kTabsDeferLoadingAfterRestore,Z.kWorkspacesEnabled],x_=[Z.kTabsAlwaysLoadPinnedAfterRestore,Z.kTabsDeferLoadingAfterRestore,Z.kURLsToRestoreOnStartup],I_=I.Z.getEventHandler;function A_({filter:e}){const t=(0,Eo.Z)(y_),s=(0,zn.jsx)(w_,{filter:e,prefValues:t}),[n,i]=(0,Un.useState)(!1),[a,o]=(0,Un.useState)("last"),[r,l]=(0,Un.useState)("");(0,Un.useEffect)((()=>{re.Z.utilities.getStartupAction((e=>o(e)))}),[]);const d=e=>{const s=e.target.value;if("last"!==s&&t[Z.kWorkspacesEnabled])l(s),i(!0),e.preventDefault();else{const e=A.Z.get(Z.kURLsToRestoreOnStartup);re.Z.utilities.setStartupAction(s,e,(e=>o(e)))}},c=(0,Un.useMemo)((()=>"urls"===a?s:null),[e,t,a]);return(0,zn.jsxs)(tb.Z,{filter:e,children:[(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Startup with")}),(0,zn.jsxs)(To.Z,{name:"startupSettings",value:a,onChange:nr.Z,children:[(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"radio",value:"last",onClick:d}),(0,zn.jsx)("span",{children:(0,W.Z)("Last Session")})]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Required for Workspaces feature")})]}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"radio",value:"homepage",onClick:d}),(0,zn.jsx)("span",{children:(0,W.Z)("radio","Homepage")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"radio",value:"speeddial",onClick:d}),(0,zn.jsx)("span",{children:(0,W.Z)("radio","Start Page")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"radio",value:"urls",onClick:d}),(0,zn.jsx)("span",{children:(0,W.Z)("Specific Pages")})]})})]}),(0,zn.jsx)("div",{className:"setting-single pad-top",children:(0,zn.jsxs)("label",{title:(0,W.Z)("Wait to load restored session content until tab is activated."),children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kTabsDeferLoadingAfterRestore],onChange:I_(Z.kTabsDeferLoadingAfterRestore)}),(0,zn.jsx)("span",{children:(0,W.Z)("Lazy Load Restored Tabs")})]})}),(0,zn.jsx)("div",{className:"setting-single pad-left",children:(0,zn.jsxs)("label",{title:(0,W.Z)("Load pinned tabs before they are activated."),children:[(0,zn.jsx)("input",{type:"checkbox",disabled:!t[Z.kTabsDeferLoadingAfterRestore],checked:t[Z.kTabsAlwaysLoadPinnedAfterRestore],onChange:I_(Z.kTabsAlwaysLoadPinnedAfterRestore)}),(0,zn.jsx)("span",{children:(0,W.Z)("Always Load Pinned Tabs")})]})})]}),c,n&&(0,zn.jsx)(b_,{onClose:e=>{if(i(!1),e&&r){I.Z.set(Z.kWorkspacesEnabled,!1);const e=A.Z.get(Z.kURLsToRestoreOnStartup);re.Z.utilities.setStartupAction(r,e,(e=>o(e)))}},from:"startup"})]})}const S_=async function(){return!1},Z_=[Z.kStartupCheckIsDefault],T_=I.Z.getEventHandler;class E_ extends Un.Component{_isMounted=!1;static contextType=oi.Z;state={isVivaldiDefault:!0,isRunningInContainer:!0};componentDidMount(){this.getDefaultBrowserValue(),S_().then((e=>this.setState({isRunningInContainer:e}))),this._isMounted=!0}componentWillUnmount(){this._isMounted=!1}getDefaultBrowserValue=()=>{re.Z.utilities.isVivaldiDefaultBrowser((e=>{this._isMounted&&this.setState({isVivaldiDefault:!0===e})}))};setVivaldiDefault=()=>{re.Z.utilities.setVivaldiAsDefaultBrowser((e=>{this._isMounted&&this.setState({isVivaldiDefault:!0===e})})),this.props.onClose&&this.props.onClose()};openFlatpakHelp=()=>{c.ZP.openURL(this.context.vivaldiWindowId,"https://help.vivaldi.com/?p=106242")};renderCheckbox=()=>(0,zn.jsxs)("label",{title:(0,W.Z)("Check if Vivaldi is your default browser upon every startup"),children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.props.prefValues[Z.kStartupCheckIsDefault],onChange:T_(Z.kStartupCheckIsDefault)}),(0,zn.jsx)("span",{children:(0,W.Z)("Check on Startup")})]});render(){return this.props.onClose?(0,zn.jsxs)("form",{onSubmit:this.setVivaldiDefault,className:"SuggestDefault",role:"none",children:[(0,zn.jsx)("span",{children:(0,W.Z)("Enjoying Vivaldi? Make it your default browser.")}),(0,zn.jsx)("input",{type:"submit",value:(0,W.Z)("browser","Set as Default Browser")}),this.renderCheckbox(),(0,zn.jsx)("button",{type:"button",className:"close",dangerouslySetInnerHTML:{__html:Kn.kze},onClick:this.props.onClose,"aria-label":(0,W.Z)("Dismiss")})]}):(0,zn.jsx)(tb.Z,{filter:this.props.filter,children:(0,zn.jsxs)("div",{className:"setting-group",children:[!this.props.onClose&&(0,zn.jsx)("h3",{children:(0,W.Z)("Default Browser")}),(0,zn.jsx)("div",{className:"setting-single",children:this.state.isRunningInContainer?(0,zn.jsx)(zn.Fragment,{children:(0,zn.jsxs)("p",{children:[(0,W.Z)("To set Vivaldi for Flatpak as your default browser, please refer to the documentation.")," ",(0,zn.jsx)(Vx.Z,{onClick:this.openFlatpakHelp,children:(0,W.Z)("Learn more.")})]})}):this.state.isVivaldiDefault?(0,zn.jsx)("p",{children:(0,W.Z)("Vivaldi is set as your default browser.")}):(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("p",{children:(0,W.Z)("Vivaldi isn’t your default browser.")}),(0,zn.jsx)("input",{type:"button",onClick:this.setVivaldiDefault,value:(0,W.Z)("browser","Set as Default")})]})}),!this.state.isRunningInContainer&&(0,zn.jsx)("div",{className:"setting-single pad-top",children:this.renderCheckbox()})]})})}}const k_=(0,zd.Z)(E_,Z_),N_=[...i_,...l_,...u_,...x_,...Z_];function __(e){return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)(Vy.Z,{categoryTitle:(0,W.Z)("Startup"),filter:e.filter,children:[(0,zn.jsx)(k_,{...e}),(0,zn.jsx)(g_,{...e}),(0,zn.jsx)(A_,{...e})]}),(0,zn.jsxs)(Vy.Z,{categoryTitle:(0,W.Z)("title","Close and Exit"),filter:e.filter,children:[(0,zn.jsx)(c_,{...e}),(0,zn.jsx)(o_,{...e})]},"2")]})}const P_=Un.memo(__),M_=[...QN,...N_].concat([]);function D_({filter:e,category:t}){const s=nI({filter:e,name:t.title,prefPaths:M_});return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsx)(P_,{filter:e})}),(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsx)(HN,{filter:e})}),(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsx)(s_,{filter:e})}),(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsx)(YA,{filter:e})}),s]})}const O_=Un.memo(D_),j_=[Z.kWebpagesAccessKeys],L_=I.Z.getEventHandler;class R_ extends Un.Component{render(){return(0,zn.jsx)(tb.Z,{filter:this.props.filter,children:(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Access Keys")}),(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.props.prefValues[Z.kWebpagesAccessKeys],onChange:L_(Z.kWebpagesAccessKeys)}),(0,zn.jsx)("span",{children:(0,W.Z)("Allow Access Keys")})]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Some websites may use this accessibility feature to register shortcuts for certain elements, using $1 modifier.",["Shift+Alt"])})]})]})})}}const B_=(0,zd.Z)(R_,j_),F_=(e,t)=>Qe.Z.isSingleKeyShortcut(e)?t?"singlefeatures":"single":"";class W_ extends Un.PureComponent{static contextType=oi.Z;getBrowserPriorityShortcuts=()=>A.Z.get(Z.kKeyboardShortcutsBrowserPriorityList);state={selectedCombo:"",active:!1,duplicate:"",browserShortcutList:this.getBrowserPriorityShortcuts()};updateBrowserPriorityShortcutList=e=>{I.Z.set(Z.kKeyboardShortcutsBrowserPriorityList,e)};resetToDefault=()=>{I.Z.reset(Z.kKeyboardShortcutsBrowserPriorityList);const e=A.Z.getDefault(Z.kKeyboardShortcutsBrowserPriorityList);this.setState({browserShortcutList:e})};handleKeyEvent=e=>{const t=Qe.Z.keyComboFromEvent(e.nativeEvent);if(!t)return;if(e.getModifierState("AltGraph"))return;"tab"!==t&&"shift+tab"!==t&&e.preventDefault(),"PageUp"!==e.nativeEvent.key&&"PageDown"!==e.nativeEvent.key||!e.nativeEvent.ctrlKey||e.preventDefault();const s=this.state.browserShortcutList.slice(),{selectedCombo:n}=this.state;if(-1===s.indexOf(t))if("backspace"===t||n&&"del"===t){const e=s.indexOf(n),t=s.length;n?s.splice(e,1):t>0&&s.splice(t-1,1),this.updateBrowserPriorityShortcutList(s),this.setState({browserShortcutList:s,duplicate:""})}else-1===Cc.indexOf(t)?(s.push(t),this.updateBrowserPriorityShortcutList(s),this.setState({browserShortcutList:s,duplicate:""})):this.navigateWithArrowKeys(e);else this.setState({duplicate:t})};navigateWithArrowKeys=e=>{let t=null;if(!this.state.browserShortcutList)return;const s=Qe.Z.keyComboFromEvent(e.nativeEvent),{document:n,HTMLElement:i}=this.context,a=n.activeElement;if(a){switch(s){case"left":a&&(t=a.previousElementSibling);break;case"right":a&&(t=a.nextElementSibling);break;case"up":a&&a.parentNode&&(t=a.parentNode.firstChild);break;case"down":a&&a.parentNode&&(t=a.parentNode.lastChild)}t instanceof i&&(e.preventDefault(),e.stopPropagation(),t.focus())}};onComboFocus=e=>{this.setState({selectedCombo:e.currentTarget.dataset.raw,active:!0})};onComboBlur=()=>{this.setState({selectedCombo:"",active:!1})};renderCombos=()=>{const e=this.state.browserShortcutList;return e.length>0?e.map(((e,t)=>(0,zn.jsx)("button",{className:`multiinput-item ${F_(e,!1)}`,"data-raw":e,onFocus:this.onComboFocus,onBlur:this.onComboBlur,onKeyDown:this.handleKeyEvent,children:(0,vc.$)(e)},t))):null};render(){return(0,zn.jsx)(tb.Z,{filter:this.props.filter,children:(0,zn.jsxs)("div",{className:"setting-group setting-group-double pad-top browser-priority-list",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Browser Priority Shortcuts")}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Keyboard shortcuts that have browser priority, which means that they will always be fired regardless of whether the website tries to use them.")}),(0,zn.jsx)("div",{className:Gn()({controls:!0,active:this.state.active}),children:(0,zn.jsx)("div",{className:"multiinput",children:(0,zn.jsxs)("div",{className:"multiinput-group",children:[this.renderCombos(),(0,zn.jsx)("input",{type:"text",id:"browser-priority-input",defaultValue:"",onKeyDown:this.handleKeyEvent})]})})}),this.state.duplicate&&(0,zn.jsx)("p",{className:"info",role:"alert",children:(0,W.Z)("Shortcut $1 already has browser priority.",[(0,vc.$)(this.state.duplicate)])}),(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Reset to Default"),onClick:this.resetToDefault})]})})}}const U_=W_,V_=function(e){switch(e){case"CATEGORY_COMMAND_APPLICATION":return(0,W.Z)("win_linux","Window");case"CATEGORY_COMMAND_APPEARANCE":return(0,W.Z)("win_linux","View");case"CATEGORY_COMMAND_TAB_ACTION":return(0,W.Z)("command","Tab");case"CATEGORY_COMMAND_WEBPAGE_NAVIGATION":return(0,W.Z)("Page");case"CATEGORY_COMMAND_MAIL":return(0,W.Z)("Mail");case"CATEGORY_COMMAND_CALENDAR":return(0,W.Z)("Calendar");case"CATEGORY_COMMAND_CHAIN":return(0,W.Z)("Chains");case"CATEGORY_COMMAND_WORKSPACE_ACTION":return(0,W.Z)("Workspaces");default:return"Unknown"}},H_=I.Z.getEventHandler;class G_ extends Un.Component{render(){return(0,zn.jsx)(tb.Z,{filter:this.props.filter,children:(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Keyboard Shortcuts")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.props.prefValues[Z.kKeyboardShortcutsEnable],onChange:H_(Z.kKeyboardShortcutsEnable)}),(0,zn.jsx)("span",{children:(0,W.Z)("Enable Keyboard Shortcuts")})]})}),(0,zn.jsx)("div",{className:"setting-single pad-left",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.props.prefValues[Z.kKeyboardShortcutsEnableSingleKey],onChange:H_(Z.kKeyboardShortcutsEnableSingleKey),disabled:!this.props.prefValues[Z.kKeyboardShortcutsEnable]}),(0,zn.jsx)("span",{children:(0,W.Z)("Single Key Shortcuts")})]})}),(this.props.prefValues[Z.kFeaturesMail]||this.props.prefValues[Z.kFeaturesFeeds])&&(0,zn.jsx)("div",{className:"setting-single pad-left",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.props.prefValues[Z.kKeyboardShortcutsEnableSingleKeyForMail],onChange:H_(Z.kKeyboardShortcutsEnableSingleKeyForMail),disabled:!this.props.prefValues[Z.kKeyboardShortcutsEnable]}),(0,zn.jsx)("span",{children:(0,W.Z)("Mail and Calendar Single Key Shortcuts")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.props.prefValues[Z.kKeyboardShortcutsSpaceFastForwards],onChange:H_(Z.kKeyboardShortcutsSpaceFastForwards)}),(0,zn.jsx)("span",{children:(0,W.Z)("Space Key to Fast Forward")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.props.prefValues[Z.kKeyboardShortcutsAltOpensMenu],onChange:H_(Z.kKeyboardShortcutsAltOpensMenu)}),(0,zn.jsx)("span",{children:(0,W.Z)("Alt Key for Main Menu")})]})})]})})}}const K_=G_,z_=[Z.kKeyboardTabToAll,Z.kKeyboardTabToAllUsesSystemDefault,Z.kWebpagesFocusTrap],$_=I.Z.getEventHandler;var Y_=(0,zn.jsx)("input",{type:"radio",value:"0"}),X_=(0,zn.jsx)("input",{type:"radio",value:"-1"}),Q_=(0,zn.jsx)("input",{type:"radio",value:"1"}),q_=(0,zn.jsx)("input",{type:"radio",value:"0"});class J_ extends Un.Component{handleDarwinKeyAccess=e=>{const t=A.Z.get(Z.kSystemMacKeyboardUiMode),s=e.target&&e.target.checked;s||-1===this.props.prefValues[Z.kKeyboardTabToAll]?s&&2===t&&0!==this.props.prefValues[Z.kKeyboardTabToAll]?I.Z.set(Z.kKeyboardTabToAll,0):s&&0===t&&-1!==this.props.prefValues[Z.kKeyboardTabToAll]&&I.Z.set(Z.kKeyboardTabToAll,-1):I.Z.set(Z.kKeyboardTabToAll,-1),I.Z.set(Z.kKeyboardTabToAllUsesSystemDefault,s)};renderFullKeyboardAccess=()=>(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Full Keyboard Access")}),!1,(0,zn.jsxs)(To.Z,{name:"keyAccessSetting",className:"setting-single",value:this.props.prefValues[Z.kKeyboardTabToAll],onChange:$_(Z.kKeyboardTabToAll),disabled:this.props.prefValues[Z.kKeyboardTabToAllUsesSystemDefault],children:[(0,zn.jsxs)("label",{children:[Y_,(0,zn.jsx)("span",{children:(0,W.Z)("Focus All Controls")})]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Press TAB key to focus all controls")}),(0,zn.jsxs)("label",{children:[X_,(0,zn.jsx)("span",{children:(0,W.Z)("Focus Input")})]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Press TAB key to focus text boxes and lists only")})]})]});onFocusCyclingChanged=e=>{const t="1"===e.target.value;I.Z.set(Z.kWebpagesFocusTrap,t)};renderFocusCycling=()=>(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Focus Cycling")}),(0,zn.jsxs)(To.Z,{name:"toolbarFocusCycling",className:"setting-single",value:this.props.prefValues[Z.kWebpagesFocusTrap]?"1":"0",onChange:this.onFocusCyclingChanged,children:[(0,zn.jsxs)("label",{children:[Q_,(0,zn.jsx)("span",{children:(0,W.Z)("Cycle in Component")})]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("TAB key focus is bound to individual toolbars or webpage")}),(0,zn.jsxs)("label",{children:[q_,(0,zn.jsx)("span",{children:(0,W.Z)("Cycle All")})]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("TAB key focus cycles through whole application")})]})]});render(){return(0,zn.jsxs)(tb.Z,{filter:this.props.filter,children:[this.renderFocusCycling(),this.renderFullKeyboardAccess()]})}}const eP=(0,zd.Z)(J_,z_),tP=[Z.kKeyboardShortcutsEnableSingleKey,Z.kWebpagesSpatialNavigationEnabled],sP=[Z.kActions,...tP],nP=I.Z.getEventHandler;class iP extends Un.Component{isSingleKeyShortcut=(e,t)=>!!t||!Qe.Z.isSingleKeyShortcut(e);render(){const{prefValues:e}=this.props,t=e[Z.kActions][0],s=e[Z.kKeyboardShortcutsEnableSingleKey],n=t.COMMAND_SPATNAV_LEFT.shortcuts?.slice(0,3).filter((e=>this.isSingleKeyShortcut(e,s)))||[],i=t.COMMAND_SPATNAV_RIGHT.shortcuts?.slice(0,3).filter((e=>this.isSingleKeyShortcut(e,s)))||[],a=t.COMMAND_SPATNAV_UP.shortcuts?.slice(0,3).filter((e=>this.isSingleKeyShortcut(e,s)))||[],o=t.COMMAND_SPATNAV_DOWN.shortcuts?.slice(0,3).filter((e=>this.isSingleKeyShortcut(e,s)))||[];return(0,zn.jsx)(tb.Z,{filter:this.props.filter,children:(0,zn.jsx)("div",{className:"setting-group",children:(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Spatial Navigation")}),(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.props.prefValues[Z.kWebpagesSpatialNavigationEnabled],onChange:nP(Z.kWebpagesSpatialNavigationEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("spatial navigation","Enabled")})]}),(0,zn.jsxs)("div",{className:"info",children:[(0,W.Z)("Navigate between links and elements using your keyboard."),(0,zn.jsxs)("div",{className:"shortcuts",children:[Boolean(n.length)&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("span",{children:(0,W.Z)("spatnav","Left")}),(0,zn.jsx)("span",{className:"shortcut",children:n.map((e=>(0,zn.jsx)("kbd",{children:(0,vc.$)(e)},e)))})]}),Boolean(i.length)&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("span",{children:(0,W.Z)("spatnav","Right")}),(0,zn.jsx)("span",{className:"shortcut",children:i.map((e=>(0,zn.jsx)("kbd",{children:(0,vc.$)(e)},e)))})]}),Boolean(a.length)&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("span",{children:(0,W.Z)("spatnav","Up")}),(0,zn.jsx)("span",{className:"shortcut",children:a.map((e=>(0,zn.jsx)("kbd",{children:(0,vc.$)(e)},e)))})]}),Boolean(o.length)&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("span",{children:(0,W.Z)("spatnav","Down")}),(0,zn.jsx)("span",{className:"shortcut",children:o.map((e=>(0,zn.jsx)("kbd",{children:(0,vc.$)(e)},e)))})]})]})]})]})})})}}const aP=(0,zd.Z)(iP,sP);var oP=s(93196);const rP={width:400,minWidth:"unset"},lP=[...j_,...z_,...tP,Z.kKeyboardShortcutsAltOpensMenu,Z.kKeyboardShortcutsEnable,Z.kKeyboardShortcutsEnableSingleKey,Z.kKeyboardShortcutsEnableSingleKeyForMail,Z.kKeyboardShortcutsSpaceFastForwards],dP=[Z.kChainedCommandsCommandList,Z.kFeaturesMail,Z.kFeaturesFeeds,...lP];function cP(e){if(!e.name.startsWith("COMMAND_WORKSPACE_SWITCH_")&&!e.name.startsWith("COMMAND_WORKSPACE_MOVE_TABS_TO_"))return e.label;const t=e.name.startsWith("COMMAND_WORKSPACE_MOVE_TABS_TO_")?1:2,s=Number(e.name.split("_").at(-1)),n=m_.Z.getState();return s>=t&&s<n.length+t?e.label+" ("+n[s-t].name+")":e.label}function hP(e){const t=(0,Eo.Z)(dP),s=e.category?.title?e.category.title:"",n=nI({filter:e.filter,prefPaths:lP,name:s}),i=e.category?n:null,[a,o]=Un.useState(Ye.Z.getSettingsList(!1)),[r,l]=Un.useState(["CATEGORY_COMMAND_APPLICATION"]),[d,c]=Un.useState(!1),[h,u]=Un.useState("");Un.useEffect((()=>{const e=()=>{o(Ye.Z.getSettingsList(!1))};return Ye.Z.addListener(e),oe.Z.addListener(e),A.Z.addListener([Z.kFeaturesMail,Z.kFeaturesFeeds],e),()=>{Ye.Z.removeListener(e),oe.Z.removeListener(e),A.Z.removeListener([Z.kFeaturesMail,Z.kFeaturesFeeds],e)}}),[]),Un.useEffect((()=>{u("")}),[e.filter]);const p=()=>{c(!0)},g=()=>{ae.Z.restoreShortcuts(),c(!1)},m=()=>{c(!1)},f=(t,s)=>{const n=t.reduce(((e,t)=>(e[t.category]=(e[t.category]||[]).concat(t),e)),{});let i;i=A.Z.get(Z.kWorkspacesEnabled)?Object.keys(n):Object.keys(n).filter((e=>"CATEGORY_COMMAND_WORKSPACE_ACTION"!==e));const a=i.map(((e,t)=>v(e,n[e],s)));return a.length>0?(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("div",{className:"keystrokes",children:a}),!e.filter&&"read-only"!==e.view&&(0,zn.jsx)("input",{type:"button",onClick:p,value:(0,W.Z)("Restore Default Keys")})]}):null},v=(e,t,s)=>{const n=V_(e),i=s||r.indexOf(e)>-1?"show":"hide";return(0,zn.jsxs)("div",{className:"category "+i,children:[(0,zn.jsx)("button",{onClick:()=>{return t=e,void l((0,C.Uy)((e=>{e.indexOf(t)>-1?e.splice(e.indexOf(t),1):e.push(t)})));var t},children:(0,zo.CH)(n,s)}),(0,zn.jsx)("div",{className:"list",children:t.map(((e,t)=>b(e,t,s)))})]},e)},b=(s,n,i)=>{if("read-only"===e.view){const e=!t[Z.kKeyboardShortcutsEnable],a=!t[Z.kKeyboardShortcutsEnableSingleKey],o=!t[Z.kKeyboardShortcutsEnableSingleKeyForMail],r=e=>["mail","feeds"].includes(e.feature);return(0,zn.jsxs)("div",{className:"keycombo",children:[(0,zn.jsx)("label",{children:(0,zo.CH)(cP(s),i)}),s.shortcuts&&s.shortcuts.map(((t,n)=>[(0,zn.jsx)("span",{title:e?(0,W.Z)("Keyboard Shortcuts are disabled"):1===t.length&&(a&&!r(s)||o)?(0,W.Z)("Single Key Shortcuts are disabled"):"",children:(0,zn.jsx)("input",{type:"button",disabled:!0,className:t.length>1?"item regular":"item single",value:(0,vc.$)(t)})},n)]))]},n)}if(!(0,oP.os)(s.name)){const n=s.name.toLowerCase();return(0,zn.jsxs)("div",{className:"keycombo",children:[(0,zn.jsx)("label",{htmlFor:"combo-"+n,children:(0,zo.CH)(cP(s),e.filter)}),(0,zn.jsx)(xc,{prefValues:t,id:"combo-"+n,commandArray:a,command:s},n)]},n)}return null},w=t=>{let s=[];if(s="read-only"===e.view?a.filter((e=>Boolean(e.shortcuts&&e.shortcuts.length>0))):a,t){const e=y(t);s=s.filter((s=>{if((s.label||s.name).toLowerCase().indexOf(t.toLowerCase())>-1)return!(0,oP.os)(s.name);return(s.shortcuts||[]).some((t=>{const s=y(t);return dw(e,s)}))}))}return s.length>0?(0,zn.jsxs)("div",{className:"keyboard-shortcut-list",children:[t&&(0,zn.jsx)("header",{children:(0,zn.jsx)("h3",{children:(0,W.Z)("Showing all keyboard shortcut entries matching $1.",[t])})}),f(s,t)]}):null},y=e=>new Set(e.match(/[^,\s\+]+/g)||[]),x=h||e.filter;return"read-only"===e.view?w(x):(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsxs)(Vy.Z,{categoryTitle:(0,W.Z)("Keyboard"),className:Gn()({"keyboard-shortcut-list":!0,singlekeydisabled:!t[Z.kKeyboardShortcutsEnableSingleKey],singlekeydisabledfeatures:!t[Z.kKeyboardShortcutsEnableSingleKeyForMail]}),filter:e.filter,children:[d&&(0,zn.jsx)(Ha.Z,{style:rP,onRequestClose:m,title:(0,W.Z)("Restore Keyboard Shortcuts?"),children:(0,zn.jsxs)("div",{className:"dialog-restore-shortcuts",children:[(0,zn.jsx)("div",{className:"dialog-content",children:(0,zn.jsx)("p",{children:(0,W.Z)("All keyboard shortcuts will be restored to default.")})}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"button",className:"danger",onClick:g,value:(0,W.Z)("Restore")}),(0,zn.jsx)("input",{type:"button",onClick:m,value:(0,W.Z)("Cancel"),autoFocus:!0})]})]})}),(0,zn.jsx)(eP,{filter:e.filter}),(0,zn.jsx)(B_,{filter:e.filter}),(0,zn.jsx)(K_,{filter:e.filter,prefValues:t}),(0,zn.jsx)(aP,{filter:e.filter}),w(x),(0,zn.jsx)(U_,{filter:e.filter,prefValues:t})]})}),i]})}const uP=Un.memo(hP);var pP=s(6271);const gP={Port:(0,W.Z)("Port"),"Incoming Server":(0,W.Z)("Incoming Server"),Username:(0,W.Z)("Username"),Password:(0,W.Z)("Password"),"Outgoing Server":(0,W.Z)("Outgoing Server"),"Use App Password":(0,W.Z)("Use App Password"),"Use OAuth":(0,W.Z)("Use OAuth")};var mP=(0,zn.jsx)(Fa.Z,{name:"MAIL_SOCKET_TYPE",value:"ssl",disabled:!0,children:(0,zn.jsx)("option",{value:"ssl",children:"SSL/TLS"})}),fP=(0,zn.jsx)("option",{value:"starttls",children:"StartTLS"});class vP extends Un.PureComponent{isImap(){return this.props.account.accountType===Nt.s9.IMAP}toggleOAuth=()=>{this.props.setAccountProperty("useOAuth",!this.props.account.useOAuth)};onChangeEvent=e=>{const{name:t,value:s}=e.target;this.props.setAccountProperty(t,s)};render(){const{MAIL_SERVER:e,MAIL_PORT:t,MAIL_USER:s,MAIL_PASSWORD:n,MAIL_SMTP_SERVER:i,MAIL_SMTP_PORT:a,MAIL_SMTP_USER:o,MAIL_SMTP_PASSWORD:r,MAIL_SMTP_SOCKET_TYPE:l}=this.props.account;return(0,zn.jsxs)("div",{className:"setting-group-block setting-mail-account-form",children:[(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsxs)("div",{className:"setting-single setting-single-flex",children:[(0,zn.jsx)(Vr.Z,{type:"text",disabled:this.props.disabled,onChange:this.onChangeEvent,name:"MAIL_SERVER",label:this.props.searchableStrings["Incoming Server"],labelImportant:!0,placeholder:"mail.vivaldi.net",isVerified:this.props.incomingVerified,hasError:this.props.showErrors&&!e,value:e||"",className:"incoming-server-label"}),(0,zn.jsx)(Vr.Z,{type:"number",disabled:this.props.disabled,onChange:this.onChangeEvent,name:"MAIL_PORT",label:this.props.searchableStrings.Port,placeholder:this.isImap()?"993":"995",isVerified:this.props.incomingVerified,value:t||"",className:"port-label"})]}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{className:"floating-label",disabled:!0,children:[(0,W.Z)("Connection Security"),mP]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(Vr.Z,{type:"text",disabled:this.props.disabled,onChange:this.onChangeEvent,name:"MAIL_USER",label:this.props.searchableStrings.Username,placeholder:"user@vivaldi.net",isVerified:this.props.userVerified,hasError:this.props.showErrors&&!s,value:s||""})}),!this.props.account.useOAuth&&(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(Vr.Z,{type:"password",disabled:this.props.disabled,onChange:this.onChangeEvent,name:"MAIL_PASSWORD",label:this.props.searchableStrings.Password,placeholder:"",isVerified:this.props.userVerified,hasError:this.props.showErrors&&!n,value:n||""})})]},"mail__imap"),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsxs)("div",{className:"setting-single setting-single-flex",children:[(0,zn.jsx)(Vr.Z,{type:"text",disabled:this.props.disabled,onChange:this.onChangeEvent,name:"MAIL_SMTP_SERVER",label:this.props.searchableStrings["Outgoing Server"],labelImportant:!0,placeholder:"mail.vivaldi.net",isVerified:this.props.smtpVerified,hasError:this.props.showErrors&&!i,value:i||"",className:"outgoing-server-label"}),(0,zn.jsx)(Vr.Z,{type:"number",disabled:this.props.disabled,onChange:this.onChangeEvent,name:"MAIL_SMTP_PORT",label:this.props.searchableStrings.Port,placeholder:"465",value:a||"",isVerified:this.props.smtpVerified,className:"port-label"})]}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{className:"floating-label",children:[(0,W.Z)("Connection Security"),(0,zn.jsxs)(Fa.Z,{name:"MAIL_SMTP_SOCKET_TYPE",onChange:this.onChangeEvent,value:l||"ssl",children:[(0,zn.jsx)("option",{value:"ssl",children:(0,W.Z)("SSL/TLS (Recommended)")}),fP]})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(Vr.Z,{type:"text",disabled:this.props.disabled,onChange:this.onChangeEvent,name:"MAIL_SMTP_USER",label:this.props.searchableStrings.Username,placeholder:"user@vivaldi.net",isVerified:this.props.userVerified,hasError:this.props.showErrors&&!o,value:o||""})}),!this.props.account.useOAuth&&(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(Vr.Z,{type:"password",disabled:this.props.disabled,onChange:this.onChangeEvent,name:"MAIL_SMTP_PASSWORD",label:this.props.searchableStrings.Password,placeholder:"",isVerified:this.props.userVerified,hasError:this.props.showErrors&&!r,value:r||""})}),(0,pP.Ap)(this.props.account)&&(0,zn.jsxs)("label",{className:"setting-single",children:[(0,zn.jsx)("input",{type:"checkbox",checked:!!this.props.account.useOAuth&&this.props.account.useOAuth,onChange:this.toggleOAuth}),(0,zn.jsx)("span",{children:this.props.searchableStrings["Use OAuth"]})]})]},"mail__smtp")]})}}const bP=vP;var CP=(0,zn.jsx)("input",{type:"radio",value:Nt.kA,default:!0}),wP=(0,zn.jsx)("input",{type:"radio",value:Nt.Qp}),yP=(0,zn.jsx)("input",{type:"radio",value:Nt.eQ});class xP extends Un.PureComponent{onChange=e=>{let{name:t,value:s,checked:n}=e.target;s===Nt.qd&&n&&(s=Nt.kA);const i={...this.props.account.popDeletion,[t]:s};this.props.setAccountProperty("popDeletion",i)};render(){const e=this.props.account.popDeletion||{},{when:t=Nt.qd,howManyDays:s=Nt.CH}=e;return(0,zn.jsx)("div",{className:"setting-group setting-group-double",children:(0,zn.jsxs)(To.Z,{name:"popdeletiongroup",value:t,onChange:this.onChange,disabled:t===Nt.qd,name:"when",children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t!==Nt.qd,value:Nt.qd,onChange:this.onChange,name:"when"}),(0,zn.jsx)("span",{children:(0,W.Z)("Delete mail from server")})]})}),(0,zn.jsx)("div",{className:"setting-single pad-left",children:(0,zn.jsxs)("label",{className:"pop-how-many-days",children:[CP,(0,zn.jsx)("input",{type:"number",min:"1",disabled:t!==Nt.kA,value:s,placeholder:Nt.CH,onChange:this.onChange,name:"howManyDays",className:"pop-how-many-days-input"}),(0,zn.jsx)("span",{children:(0,W.Z)("days after receiving from server")})]})}),(0,zn.jsx)("div",{className:"setting-single pad-left",children:(0,zn.jsxs)("label",{children:[wP,(0,zn.jsx)("span",{children:(0,W.Z)("when deleting locally")})]})}),(0,zn.jsx)("div",{className:"setting-single pad-left",children:(0,zn.jsxs)("label",{children:[yP,(0,zn.jsx)("span",{children:(0,W.Z)("when received from server")})]})})]})})}}const IP=xP,AP={"Limit size when loading":(0,W.Z)("Limit size when loading"),"Limit (MB)":(0,W.Z)("Limit (MB)"),"Sync Options":(0,W.Z)("Sync Options")};class SP extends Un.PureComponent{onChange=e=>{const{name:t,value:s,checked:n}=e.target,i={...this.props.popMaxSize,[t]:"limited"===t?n:s};"limited"===t&&n&&!i.limit&&(i.limit=Nt.yX),this.props.setAccountProperty("popMaxSize",i)};render(){const{limited:e=!1,limit:t=Nt.yX}=this.props.popMaxSize||{};return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("h3",{children:AP["Sync Options"]}),(0,zn.jsxs)("label",{className:"setting-single",children:[(0,zn.jsx)("input",{type:"checkbox",name:"limited",checked:e,onChange:this.onChange}),(0,zn.jsx)("span",{children:AP["Limit size when loading"]})]}),(0,zn.jsxs)("label",{className:"setting-single setting-single-flex",children:[(0,zn.jsx)("input",{type:"number",name:"limit",placeholder:Nt.yX,disabled:!e,onChange:this.onChange,value:t,style:{width:90}}),(0,zn.jsx)("span",{children:AP["Limit (MB)"]})]})]})}}const ZP=SP;var TP=s(87192);function EP(e){const t=(0,Ry.BB)(e);return new Promise(((e,s)=>{re.Z.mailPrivate.createFileDirectory(t,(t=>{n.Z.runtime.lastError?s((0,W.Z)("Error creating data directory")):e(t)}))}))}var kP=s(27950);async function NP(e,t){t?((0,kP.OM)(t,e)&&(t.offline||t.accountType!==Nt.s9.IMAP||await ts.Z.disconnectIMAPClient(t.MAIL_EMAIL),e.offline||(e.accountType===Nt.s9.IMAP?await ts.Z.connectIMAPClient(e):e.accountType===Nt.s9.POP&&is.Z.checkForMail(e.MAIL_EMAIL))),!e.offline&&(0,kP.yN)(t,e)&&ss.Z.sendForAccount(u.A4,e.MAIL_EMAIL)):e.offline||(e.accountType===Nt.s9.IMAP&&await ts.Z.connectIMAPClient(e),e.accountType===Nt.s9.POP&&is.Z.checkForMail(e.MAIL_EMAIL))}const{UNKNOWN:_P,VERIFYING:PP,OK:MP,ERROR:DP}=Nt.In,OP={Back:(0,W.Z)("account creation","Back"),IMAP:(0,W.Z)("IMAP"),"Manual Setup":(0,W.Z)("Manual Setup"),"Edit Servers":(0,W.Z)("Edit Servers"),Manual:(0,W.Z)("Manual"),POP:(0,W.Z)("POP"),"Email Address":(0,W.Z)("Email Address"),Password:(0,W.Z)("Password"),"Offline Account":(0,W.Z)("Offline Account"),"Download Messages for Offline Viewing and Searching":(0,W.Z)("Download Messages for Offline Viewing and Searching"),"Upload Sent Messages to Sent Folder":(0,W.Z)("Upload Sent Messages to Sent Folder"),"Add your First Account":(0,W.Z)("Add your First Account"),"Add Mail Account":(0,W.Z)("Add Mail Account"),"Enter your email address to get started.":(0,W.Z)("Enter your email address to get started."),"Enter your email address to add account.":(0,W.Z)("Enter your email address to add account."),"If you would like a new mail account, we offer a free account when you register with vivaldi.net.":(0,W.Z)("If you would like a new mail account, we offer a free account when you register with vivaldi.net."),"Please provide the password for your account":(0,W.Z)("Please provide the password for your account"),"Enter your password":(0,W.Z)("Enter your password"),...gP,"IMAP Server":(0,W.Z)("IMAP Server"),"POP Server":(0,W.Z)("POP Server"),"SMTP Server":(0,W.Z)("SMTP Server"),"Account Type":(0,W.Z)("Account Type"),Port:(0,W.Z)("Port"),"Create Local Account":(0,W.Z)("Create Local Account")};var jP=(0,zn.jsxs)("div",{className:"email-providers",children:[(0,zn.jsx)("img",{src:"/resources/provider_proton.png",alt:"",width:"40",height:"40"}),(0,zn.jsx)("img",{src:"/resources/provider_gmail.png",alt:"",width:"40",height:"40"})," ",(0,zn.jsx)("img",{src:"/resources/provider_fastmail.png",alt:"",width:"40",height:"40"}),(0,zn.jsx)("img",{src:"/resources/provider_outlook.png",alt:"",width:"40",height:"40"}),(0,zn.jsx)("img",{src:"/resources/provider_icloud.png",alt:"",width:"40",height:"40"}),(0,zn.jsx)("img",{src:"/resources/provider_yahoo.png",alt:"",width:"40",height:"40"})]});class LP extends Un.PureComponent{static contextType=oi.Z;_isMounted=!1;constructor(e){super(e),this.state={isAdding:!0,status:_P,statusText:"",account:{MAIL_EMAIL:"",MAIL_PASSWORD:"",MAIL_SERVER:"",MAIL_PORT:993,MAIL_USER:"",MAIL_SMTP_SERVER:"",MAIL_SMTP_PORT:465,MAIL_SMTP_SOCKET_TYPE:"ssl",MAIL_SMTP_USER:"",MAIL_SMTP_PASSWORD:"",preFetch:"month",accountType:Nt.s9.IMAP},addressValidated:!1,incomingVerified:!1,smtpVerified:!1,userVerified:!1,isEdited:!1,showManual:!1,syncUsernames:!0,syncPasswords:!0,showConfirmOAuth:!1}}componentDidMount(){this._isMounted=!0}componentWillUnmount(){this._isMounted=!1}setAccountProperty=(e,t)=>{"MAIL_EMAIL"===e?this.setState((e=>{const s=e.syncUsernames&&e.account.MAIL_EMAIL===e.account.MAIL_USER&&e.account.MAIL_EMAIL===e.account.MAIL_SMTP_USER,n={...e.account,MAIL_EMAIL:t,MAIL_USER:s?t:e.account.MAIL_USER,MAIL_SMTP_USER:s?t:e.account.MAIL_SMTP_USER};return{addressValidated:!this.accountExists(t)&&(e.account.offline||TP.Z.isValidEmail(n)),account:n,syncUsernames:s}})):"MAIL_PASSWORD"===e?this.setState((e=>{const s=e.syncPasswords&&e.account.MAIL_PASSWORD===e.account.MAIL_SMTP_PASSWORD;return{account:{...e.account,MAIL_PASSWORD:t,MAIL_SMTP_PASSWORD:s?t:e.account.MAIL_SMTP_PASSWORD},syncPasswords:s}})):"MAIL_PORT"===e||"MAIL_SMTP_PORT"===e?this.setState((s=>({account:{...s.account,[e]:""!==t?Number(t):NaN},..."MAIL_PORT"===e?{incomingVerified:!1}:{smtpVerified:!1}}))):"MAIL_SERVER"===e||"MAIL_SMTP_SERVER"===e?this.setState((s=>({account:{...s.account,[e]:t},incomingVerified:"MAIL_SERVER"!==e&&s.incomingVerified,smtpVerified:"MAIL_SMTP_SERVER"!==e&&s.smtpVerified}))):this.setState((s=>({account:{...s.account,[e]:t}})))};accountExists(e){return(A.Z.get(Z.kMailAccounts)||[]).findIndex((t=>t.MAIL_EMAIL===e))>=0}onChangeAccountProperty=e=>{const{name:t,value:s}=e.target;this.setAccountProperty(t,s)};autofill=()=>{this.state.account.offline?this.createOffline():this.setState((e=>({isEdited:e.status===DP,status:PP,statusText:(0,W.Z)("Attempting account autodiscovery...")})),(async()=>{const[e,t]=await es.Z.autofill(this.state.account);this.autofillCallback(e,t)}))};signIn=()=>{this.setState((e=>({isAdding:!1,isEdited:e.status===DP,status:PP,statusText:(0,W.Z)("Attempting sign in...")})),(async()=>{const[e,t,s]=await es.Z.signIn(this.state.account);this.signInCallback(e,t,s)}))};completeDiscovery=e=>{this.setState({account:e,isAdding:!1,status:MP,statusText:(0,W.Z)("Autodiscovery completed."),incomingVerified:!0,smtpVerified:!0,userVerified:!1})};onCancel=()=>{this.setState({showConfirmOAuth:!1,status:MP})};onConfirmOAuth=e=>{this.setState((t=>({account:{...t.account,useOAuth:e},showConfirmOAuth:!1}))),e?this.signIn():this.completeDiscovery(this.state.account)};autofillCallback=(e,t)=>{if(this._isMounted)if(e===MP)(0,pP.Ap)(t)?this.setState({account:{...t},showConfirmOAuth:!0}):this.completeDiscovery(t);else if(e===DP){const e=t.MAIL_SERVER&&t.MAIL_PASSWORD&&t.MAIL_SMTP_SERVER&&t.MAIL_SMTP_PASSWORD;this.setState((s=>{const n={...s.account,...t};return{status:DP,statusText:e?(0,W.Z)("This should not happen"):(0,W.Z)("Autodiscovery failed. Please enter server settings"),showManual:!e,account:n,userVerified:!1}}))}};signInCallback=(e,t,s)=>{this._isMounted&&e===MP?this.setState({account:s,isAdding:!1,status:MP,statusText:(0,W.Z)("Login completed."),incomingVerified:!0,smtpVerified:!0,userVerified:!0},this.saveAccount):this._isMounted&&e===DP&&this.setState((e=>{const n={...e.account,...s};return{status:DP,statusText:t,account:n,userVerified:!1}}))};considerAddingAccount=e=>{const t=e.target.name||"",s="BACK"===t,n="OFFLINE"===t,i="MANUAL"===t&&!this.state.isAdding||s||n;"Enter"!==e.key||i||this.onSubmit()};createOffline=async()=>{const e=this.state.account.MAIL_EMAIL;await EP(e),this.saveAccount()};createAccountBooleanHandler=e=>t=>{const{checked:s}=t.target;this.setState((t=>({account:{...t.account,[e]:s}})))};saveAccount=async()=>{const{account:e}=this.state;await es.Z.addAccount(e),(0,xl.ZP)(e),NP(e)};setViewType=e=>{const t=e.target.name;this.setState((e=>({showManual:"MANUAL"===t})))};createLocalAccount=e=>{this.setState((e=>({account:{...e.account,offline:!0}})),this.createOffline)};onSubmit=()=>{!this.state.addressValidated||this.isCreating()||this.state.account.offline||(this.state.isAdding&&!this.state.showManual?this.autofill():this.signIn())};renderSubmitButton=()=>{const e=this.state.status!==DP&&!this.state.showManual,t=this.state.status===DP&&!this.state.showManual;let s;this.state.showManual?s=(0,W.Z)("Add Account"):this.state.isAdding?s=(0,W.Z)("Continue"):e?s=(0,W.Z)("Sign In"):t&&(s=(0,W.Z)("Retry Login"));const n=!this.state.addressValidated||this.isCreating();return(0,zn.jsx)("input",{onClick:this.onSubmit,className:"primary",disabled:n,type:"button",style:{marginRight:"auto"},value:s})};onChangeMailAccountType=e=>{const t=e.target.value===Nt.s9.POP?Nt.s9.POP:Nt.s9.IMAP;this.setState((e=>({account:{...e.account,accountType:t}})))};isCreating=()=>this.state.status===PP;renderStatusCheck=()=>{if(this.state.status===PP||this.state.status===DP)return(0,zn.jsx)(fa,{type:this.state.status===DP?"error":"info",children:this.state.statusText})};onSignUpClicked=()=>{c.ZP.openURL(this.context.vivaldiWindowId,"https://vivaldi.com/email-signup/"),this.props.onClose&&this.props.onClose()};showOAuthDialog=()=>{const e=(0,W.Z)("OAuth follows a standard login process."),t=(0,W.Z)("Alternatively use an app-specific password. They are single purpose passwords that you can generate to login permanently."),s=(0,W.Z)("More info on Vivaldi Help.");return(0,zn.jsx)($C,{title:(0,W.Z)("Pick Authentication Type"),prompt:[e,"",t,s],negative:(0,W.Z)("Use App-Specific Password"),positive:(0,W.Z)("Use OAuth"),onRequestClose:this.onCancel,onClose:this.onConfirmOAuth})};render(){const e=this.isCreating(),t=this.state.account.accountType===Nt.s9.POP,s=!this.state.account.useOAuth&&this.state.showManual;return(0,zn.jsxs)("div",{className:"detail",children:[(0,zn.jsxs)("div",{className:"detail-content",children:[(0,zn.jsxs)("div",{className:"setting-group-double",children:[this.state.isAdding&&!this.state.showManual&&(0,zn.jsxs)(zn.Fragment,{children:[jP,(0,zn.jsx)("h2",{children:this.props.emptyAccounts?OP["Add your First Account"]:OP["Add Mail Account"]}),(0,zn.jsx)("p",{className:"mail-setup-description faded-text",children:this.props.emptyAccounts?OP["Enter your email address to get started."]:OP["Enter your email address to add account."]})]}),!this.state.isAdding&&!this.state.showManual&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("h2",{children:OP["Enter your password"]}),(0,zn.jsx)("p",{className:"mail-setup-description no-margin",children:(0,W.Z)("Please provide the password for your account")}),(0,zn.jsx)("a",{className:"mail-setup-email-link",href:"mailto:"+this.state.account.MAIL_EMAIL,children:this.state.account.MAIL_EMAIL})]})]}),(0,zn.jsxs)("div",{className:"setting-group-double",onKeyPress:this.considerAddingAccount,children:[this.state.isAdding&&(0,zn.jsxs)("div",{className:"setting-single mail-address",children:[(0,zn.jsx)(Vr.Z,{focusInput:this.props.focusInput,type:"text",disabled:e,isVerified:this.state.addressValidated,label:"",name:"MAIL_EMAIL",onChange:this.onChangeAccountProperty,placeholder:(0,W.Z)("Your email address")}),(0,zn.jsxs)(Fa.Z,{className:"CreateMailAccount-dropdown",onChange:this.onChangeMailAccountType,value:this.state.account.accountType,children:[(0,zn.jsx)("option",{value:Nt.s9.IMAP,children:(0,W.Z)("IMAP")}),(0,zn.jsx)("option",{value:Nt.s9.POP,children:(0,W.Z)("POP3")})]})]}),!this.state.isAdding&&!this.state.showManual&&(0,zn.jsx)("div",{className:"setting-single mail-address",children:(0,zn.jsx)(Vr.Z,{type:"password",disabled:e,label:"",autoFocus:!0,placeholder:(0,W.Z)("My long safe password"),onChange:this.onChangeAccountProperty,name:"MAIL_PASSWORD"})}),t&&this.state.showManual&&(0,zn.jsx)(IP,{account:this.state.account,setAccountProperty:this.setAccountProperty})&&(0,zn.jsx)(ZP,{popMaxSize:this.state.account.popMaxSize,setAccountProperty:this.setAccountProperty}),this.state.showManual&&(0,zn.jsx)(bP,{account:this.state.account,incomingVerified:this.state.incomingVerified,searchableStrings:this.props.searchableStrings,showErrors:this.state.status===DP,smtpVerified:this.state.smtpVerified,userVerified:this.state.userVerified,setAccountProperty:this.setAccountProperty}),this.renderStatusCheck(),(0,zn.jsxs)("div",{className:"toolbar toolbar-default toolbar-wrap",children:[this.renderSubmitButton(),!s&&(0,zn.jsx)("input",{onClick:this.setViewType,type:"button",name:"MANUAL",value:this.state.isAdding?this.props.searchableStrings["Manual Setup"]:this.props.searchableStrings["Edit Servers"]}),!s&&(0,zn.jsx)("input",{onClick:this.createLocalAccount,type:"button",name:"OFFLINE",value:this.props.searchableStrings["Create Local Account"],disabled:!this.state.addressValidated||this.isCreating()}),s&&(0,zn.jsx)("input",{onClick:this.setViewType,type:"button",name:"BACK",value:this.props.searchableStrings.Back})]})]})]}),this.state.showConfirmOAuth&&this.showOAuthDialog()]})}}const RP=LP;class BP extends Un.Component{static contextType=oi.Z;focusSender=()=>{};constructor(e){super(e),this._initDraft()}_initDraft=()=>{this.signature=this.props.signature};componentDidMount(){this._isMounted=!0,this.onContentLoad()}componentWillUnmount(){this._isMounted=!1}componentDidUpdate(e){e.emailAddress!==this.props.emailAddress&&(this.signature=this.props.signature,this.onContentLoad())}onBodyChange=()=>this._isMounted&&this.refSignature.current?.getContentAsBodyParts?this.refSignature.current.getContentAsBodyParts().then(this.updateBody):Promise.reject();updateBody=(0,Wv.Z)((async e=>{const t=e[0].content;this.props.onChange(t)}),200,{leading:!1});onContentLoad=()=>{this.signature&&setTimeout((()=>{""!==this.signature&&this.refSignature.current&&this.refSignature.current.setContent([{content:this.signature,isPlainText:!1}]),this.signature=""}),150)};refSignature=Un.createRef();render(){return(0,zn.jsx)("main",{children:(0,zn.jsx)(lw,{ref:this.refSignature,windowId:this.context.vivaldiWindowId,onSignatureAttachmentDrop:this.props.onChange,focusPreviousElement:this.focusSender,onBodyChange:this.onBodyChange,onContentLoad:this.onContentLoad})})}}const FP=BP;var WP=s(59938);const UP={"Alias Address":(0,W.Z)("Alias Address"),"New Alias":(0,W.Z)("New Alias"),"Enable Rich Text and Images":(0,W.Z)("Enable Rich Text and Images"),"Replied Messages":(0,W.Z)("Replied Messages"),"Forwarded Messages":(0,W.Z)("Forwarded Messages"),Signature:(0,W.Z)("Signature"),"Sender Name":(0,W.Z)("Sender Name")};class VP extends Un.PureComponent{state={newAlias:""};autoSetAliasProperty=(e,t,s,n)=>{if((s??n)===this.props.aliases[e][t])return;const i=(0,C.Uy)(this.props.aliases,(i=>{switch(t){case"signatureReply":case"signatureForward":case"isSignatureRichText":i[e][t]=n;break;case"MAIL_EMAIL":case"MAIL_NAME":case"signature":i[e][t]=s||"";break;case"signaturePosition":"above"!==s&&"below"!==s||(i[e][t]=s);break;default:console.warn(`Unknown property "${t}"`)}}));i!==this.props.aliases&&this.props.setAliases(i)};toggleCheckboxAliasProperty=(e,t,s)=>{const{checked:n}=e.target;this.autoSetAliasProperty(t,s,void 0,n)};autoSaveAliasProperty=(e,t,s)=>{const{value:n}=e.target;this.autoSetAliasProperty(t,s,n)};changeNewAlias=e=>{this.setState({newAlias:e.target.value})};addNewAlias=()=>{const e=(0,C.Uy)(this.props.aliases,(e=>{e.push({MAIL_EMAIL:this.state.newAlias})}));this.props.setAliases(e),this.setState({newAlias:""})};removeAlias=e=>{const t=(0,C.Uy)(this.props.aliases,(t=>{t.splice(e,1)}));this.props.setAliases(t)};render(){return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("form",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:this.props.searchableStrings["New Alias"]}),(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)(Vr.Z,{type:"text",labelImportant:!0,isVerified:(0,cw.HZ)(this.state.newAlias),label:"",name:"MAIL_EMAIL",onChange:this.changeNewAlias,placeholder:this.props.defaultEmail.split("@").join("+label@")}),(0,zn.jsx)("input",{type:"submit",onClick:this.addNewAlias,disabled:!(0,cw.HZ)(this.state.newAlias),value:(0,W.Z)("Add Alias")})]})]}),this.props.aliases?.map(((e,t)=>(0,zn.jsxs)("div",{className:"MailAliasesForm-block",children:[(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:this.props.searchableStrings["Alias Address"]}),(0,zn.jsx)(Vr.Z,{type:"text",onChange:e=>this.autoSaveAliasProperty(e,t,"MAIL_EMAIL"),label:"",placeholder:"John Doe",value:e.MAIL_EMAIL?e.MAIL_EMAIL:""})]}),(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:this.props.searchableStrings["Sender Name"]}),(0,zn.jsx)(Vr.Z,{type:"text",onChange:e=>this.autoSaveAliasProperty(e,t,"MAIL_NAME"),label:"",placeholder:"John Doe",value:e.MAIL_NAME?e.MAIL_NAME:""})]}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)("input",{type:"submit",className:"danger",onClick:()=>this.removeAlias(t),value:(0,W.Z)("Remove Alias")})})]}),(0,zn.jsx)("div",{className:"setting-group setting-group-double",children:(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:this.props.searchableStrings.Signature}),(0,zn.jsxs)("div",{className:"mail-signature",children:[e.isSignatureRichText?(0,zn.jsx)(FP,{onChange:e=>this.autoSetAliasProperty(t,"signature",e),signature:e.signature||"",emailAddress:e.MAIL_EMAIL}):(0,zn.jsx)(Vr.Z,{type:"textarea",rows:"2",onChange:e=>this.autoSaveAliasProperty(e,t,"signature"),label:"",placeholder:void 0===e.signature?WP.F:"",value:e.signature||""}),(0,zn.jsxs)("div",{className:"mail-signature-footer",children:[(0,zn.jsxs)("div",{className:"mail-signature-footer-sidebar",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Include Signature in:")}),(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:void 0===e.signatureReply||e.signatureReply,onChange:e=>this.toggleCheckboxAliasProperty(e,t,"signatureReply")}),(0,zn.jsx)("span",{children:UP["Replied Messages"]})]}),(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:!!e.signatureForward,onChange:e=>this.toggleCheckboxAliasProperty(e,t,"signatureForward")}),(0,zn.jsx)("span",{children:UP["Forwarded Messages"]})]})]}),(0,zn.jsx)("div",{children:(0,zn.jsxs)(Fa.Z,{value:e.signaturePosition||"below",onChange:e=>this.autoSaveAliasProperty(e,t,"signaturePosition"),title:(0,W.Z)("Placement of signature"),children:[(0,zn.jsx)("option",{value:"above",children:(0,W.Z)("Place Signature at Top")}),(0,zn.jsx)("option",{value:"below",children:(0,W.Z)("Place Signature at Bottom")})]})}),(0,zn.jsx)("div",{children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:!!e.isSignatureRichText,onChange:e=>this.toggleCheckboxAliasProperty(e,t,"isSignatureRichText")}),(0,zn.jsx)("span",{children:UP["Enable Rich Text and Images"]})]})})]})]})]})})]},t)))]})}}const HP=VP,GP=[Z.kMailListButtons],KP=I.Z.getEventHandler;var zP=(0,zn.jsx)("span",{className:"ShowMailTipsAndTricks-fakeButton",children:"R"}),$P=(0,zn.jsx)("span",{className:"ShowMailTipsAndTricks-fakeButton",children:"T"}),YP=(0,zn.jsx)("span",{className:"ShowMailTipsAndTricks-fakeButton",children:"F"}),XP=(0,zn.jsx)("span",{className:"ShowMailTipsAndTricks-fakeButton",children:"G"}),QP=(0,zn.jsx)("span",{className:"ShowMailTipsAndTricks-fakeButton",children:"K"}),qP=(0,zn.jsx)("span",{className:"ShowMailTipsAndTricks-fakeButton",children:"E"}),JP=(0,zn.jsx)("span",{className:"ShowMailTipsAndTricks-fakeButton",children:"M"}),eM=(0,zn.jsx)("input",{type:"radio",value:"text_menu"}),tM=(0,zn.jsx)("input",{type:"radio",value:"icons_only"});class sM extends Un.PureComponent{static contextType=oi.Z;SM=["start","singlekey","unseen","filterbuttons","feeds","final"];state={current:this.props.isSettings?"singlekey":"start"};renderState(e){switch(this.state.current){case"start":return(0,zn.jsxs)("div",{className:"ShowMailTipsAndTricks-allSetContainer",children:[(0,zn.jsx)("span",{className:"ShowMailTipsAndTricks-allSetIcon",dangerouslySetInnerHTML:{__html:Kn.mXV}}),(0,zn.jsx)("h1",{className:"ShowMailTipsAndTricks-allSetTitle",children:(0,W.Z)("Great, you’re all set!")}),(0,zn.jsx)("p",{className:"ShowMailTipsAndTricks-description",children:(0,W.Z)("Where to next?")})]});case"singlekey":const t="https://help.vivaldi.com/desktop/shortcuts/keyboard-shortcuts/";return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("h1",{className:"ShowMailTipsAndTricks-title",children:(0,W.Z)("Mail Tips & Tricks")}),(0,zn.jsx)("h2",{className:"ShowMailTipsAndTricks-subtitle",children:(0,W.Z)("Single key shortcuts")}),(0,zn.jsx)("p",{className:"ShowMailTipsAndTricks-description",children:(0,W.Z)("When you’re in Mail you can hit a single key to get common tasks done faster")}),(0,zn.jsxs)("div",{className:"ShowMailTipsAndTricks-shortcuts",children:[(0,zn.jsxs)("label",{className:"ShowMailTipsAndTricks-shortcutContainer",children:[zP,(0,W.Z)("Reply")]}),(0,zn.jsxs)("label",{className:"ShowMailTipsAndTricks-shortcutContainer",children:[$P,(0,W.Z)("Threaded View")]}),(0,zn.jsxs)("label",{className:"ShowMailTipsAndTricks-shortcutContainer",children:[YP,(0,W.Z)("mail","Forward")]}),(0,zn.jsxs)("label",{className:"ShowMailTipsAndTricks-shortcutContainer",children:[XP,(0,W.Z)("Mark the current e-mail as read and jump to the next unread.")]}),(0,zn.jsxs)("label",{className:"ShowMailTipsAndTricks-shortcutContainer",children:[QP,(0,W.Z)("mail","Mark as Read")]}),(0,zn.jsxs)("label",{className:"ShowMailTipsAndTricks-shortcutContainer",children:[qP,(0,W.Z)("Enable Sender View (only show emails to and from the sender)")]}),(0,zn.jsxs)("label",{className:"ShowMailTipsAndTricks-shortcutContainer",children:[JP,(0,W.Z)("Mark Thread as Read")]}),(0,zn.jsx)("a",{href:t,className:"ShowMailTipsAndTricks-shortcutLink",onClick:()=>c.ZP.openURL(e,t),children:(0,W.Z)("Learn more about keyboard shortcuts")})]})]});case"unseen":const s="https://help.vivaldi.com/mail/mail-get-started/view-and-manage-messages/#Message_read_status";return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("h1",{className:"ShowMailTipsAndTricks-title",children:(0,W.Z)("Mail Tips & Tricks")}),(0,zn.jsx)("h2",{className:"ShowMailTipsAndTricks-subtitle",children:(0,W.Z)("Unseen and Unread")}),(0,zn.jsxs)("div",{className:"ShowMailTipsAndTricks-descriptionContainer",children:[(0,zn.jsx)("span",{className:"ShowMailTipsAndTricks-icon",dangerouslySetInnerHTML:{__html:Kn.tG3}}),(0,zn.jsxs)("div",{className:"ShowMailTipsAndTricks-descriptionSide ShowMailTipsAndTricks-descriptionSide--Unseen",children:[(0,zn.jsx)("p",{children:(0,W.Z)("In Vivaldi Mail, we separate between emails you’ve seen and those you have read.")}),(0,zn.jsx)("p",{children:(0,W.Z)("Emails are not marked read until you press K or G on the keyboard (or use the toolbar buttons).")}),(0,zn.jsx)("a",{href:s,onClick:()=>c.ZP.openURL(e,s),children:(0,W.Z)("Learn more about Unseen emails.")})]})]})]});case"filterbuttons":const n="https://help.vivaldi.com/mail/mail-get-started/view-and-manage-messages/#Display_messages_with_view_toggles";return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("h1",{className:"ShowMailTipsAndTricks-title",children:(0,W.Z)("Mail Tips & Tricks")}),(0,zn.jsx)("h2",{className:"ShowMailTipsAndTricks-subtitle",children:(0,W.Z)("View Filters")}),(0,zn.jsxs)("div",{className:"ShowMailTipsAndTricks-descriptionContainer",children:[(0,zn.jsxs)("div",{className:"ShowMailTipsAndTricks-descriptionSide",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Select View Filter style:")}),(0,zn.jsxs)(To.Z,{name:"maillistbuttonstips",value:this.props.prefValues[Z.kMailListButtons],onChange:KP(Z.kMailListButtons),className:"ShowMailTipsAndTricks-radioGroup",children:[(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[eM,(0,zn.jsx)("span",{children:(0,W.Z)("Text Menu")})]}),(0,zn.jsx)("div",{className:"text_menu"===this.props.prefValues[Z.kMailListButtons]?"img-setting":"img-setting disabled",children:(0,zn.jsx)("span",{className:"text_menu"===this.props.prefValues[Z.kMailListButtons]?"mail-settings-image image alternate":"mail-settings-image image",dangerouslySetInnerHTML:{__html:Kn.yYJ}})})]}),(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[tM,(0,zn.jsx)("span",{children:(0,W.Z)("Icons Only")})]}),(0,zn.jsx)("div",{className:"icons_only"===this.props.prefValues[Z.kMailListButtons]?"img-setting":"img-setting disabled",children:(0,zn.jsx)("span",{className:"icons_only"===this.props.prefValues[Z.kMailListButtons]?"mail-settings-image image alternate":"mail-settings-image image",dangerouslySetInnerHTML:{__html:Kn.EO4}})})]})]})]}),(0,zn.jsxs)("div",{className:"ShowMailTipsAndTricks-descriptionSide",children:[(0,zn.jsx)("p",{children:(0,W.Z)("They are Show Read, Show Custom IMAP folders, Show Mailing Lists, Show Feeds, Show Junk, and Show Deleted.")}),(0,zn.jsx)("p",{children:(0,W.Z)("For global views, such as the Unread view, you can quickly filter out messages that have already been dealt with (like read messages) or sorted (like e-mail in other folders than your Inbox).")}),(0,zn.jsx)("a",{href:n,onClick:()=>c.ZP.openURL(e,n),children:(0,W.Z)("Learn more about View Filters")})]})]})]});case"feeds":const i="https://help.vivaldi.com/mail/mail-feeds/feeds/";return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("h1",{className:"ShowMailTipsAndTricks-title",children:(0,W.Z)("Mail Tips & Tricks")}),(0,zn.jsx)("h2",{className:"ShowMailTipsAndTricks-subtitle",children:(0,W.Z)("Feeds")}),(0,zn.jsxs)("div",{className:"ShowMailTipsAndTricks-descriptionContainer",children:[(0,zn.jsx)("span",{className:"ShowMailTipsAndTricks-icon",dangerouslySetInnerHTML:{__html:Kn.ooy}}),(0,zn.jsxs)("div",{className:"ShowMailTipsAndTricks-descriptionSide",children:[(0,zn.jsx)("p",{children:(0,W.Z)("That’s right, we have a Feed reader built into our email client!")}),(0,zn.jsx)("p",{children:(0,W.Z)("You can add feeds directly in the Mail Panel, or use the standalone Feeds panel.")}),(0,zn.jsx)("a",{href:i,onClick:()=>c.ZP.openURL(e,i),children:(0,W.Z)("Learn more about the Feed reader")})]})]})]});case"final":const a="https://help.vivaldi.com/mail/#mail-get-started";return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("h1",{className:"ShowMailTipsAndTricks-title",children:(0,W.Z)("Mail Tips & Tricks")}),(0,zn.jsx)("h2",{className:"ShowMailTipsAndTricks-subtitle",children:(0,W.Z)("Get all the help you need")}),(0,zn.jsxs)("div",{className:"ShowMailTipsAndTricks-descriptionContainer",children:[(0,zn.jsx)("span",{className:"ShowMailTipsAndTricks-icon",dangerouslySetInnerHTML:{__html:Kn.Kuf}}),(0,zn.jsxs)("div",{className:"ShowMailTipsAndTricks-descriptionSide",children:[(0,zn.jsx)("p",{children:(0,W.Z)("Want more tips and tricks? Our Help pages contain all the documentation you need.")}),(0,zn.jsx)("p",{children:(0,W.Z)("Visit our Help pages for Mail.")}),(0,zn.jsx)("a",{href:a,onClick:()=>c.ZP.openURL(e,a),children:(0,W.Z)("Learn more about Vivaldi Mail")})]})]})]});default:return null}}getNextState=()=>{const e=this.SM.indexOf(this.state.current),t=this.SM[e+1];this.setState({current:t})};openMail=async()=>{const e=this.context.vivaldiWindowId;this.props.onClose&&this.props.onClose(),en.Z.showContent(e,"PanelMail",{setFocus:!0,selectId:"",reason:""});const t=await n.Z.tabs.query({windowType:"normal"}),s=await t.find((e=>e.url?.startsWith(vs.xy.mailpage)));s?n.Z.windows.update(s.windowId,{focused:!0},(()=>{n.Z.tabs.update(s.id,{active:!0})})):ue.Z.showMail(e),d.Z.selectFolder({name:(0,W.Z)("Unread"),accountId:Nt.of,path:Nt.tB,id:Nt.w1+"_"+Nt.tB})};render(){return(0,zn.jsxs)("div",{className:Gn()("ShowMailTipsAndTricks",this.props.isSettings&&"ShowMailTipsAndTricks--inSettings"),children:[this.renderState(this.context.vivaldiWindowId),(0,zn.jsx)("div",{className:Gn()("ShowMailTipsAndTricks-buttonContainer",this.props.isSettings&&"ShowMailTipsAndTricks-buttonContainer--inSettings"),children:(0,zn.jsxs)("div",{className:"ShowMailTipsAndTricks-buttonCenter",children:["final"!==this.state.current&&(0,zn.jsx)("input",{type:"submit",className:"ShowMailTipsAndTricks-button",value:"start"===this.state.current?(0,W.Z)("Show me tips and tricks"):(0,W.Z)("Next tip"),onClick:this.getNextState}),"start"===this.state.current&&(0,zn.jsx)("input",{type:"button",className:"ShowMailTipsAndTricks-button",value:(0,W.Z)("Add another account"),onClick:this.props.onCreateItem}),!this.props.isSettings&&(0,zn.jsx)("input",{type:"button",className:"ShowMailTipsAndTricks-button",value:(0,W.Z)("Open Vivaldi Mail"),onClick:this.openMail}),"final"===this.state.current&&this.props.isSettings&&(0,zn.jsx)("input",{type:"button",className:"ShowMailTipsAndTricks-button",value:(0,W.Z)("mail","Done"),onClick:()=>this.props.onClose&&this.props.onClose()})]})})]})}}const nM=(0,zd.Z)(sM,GP);class iM extends Un.PureComponent{constructor(e){if(super(e),e.children instanceof Array){const t=e.children[0];this.state={selectedTabId:e.activeTabId||t.props.id}}}componentDidUpdate(e){e.activeTabId!==this.props.activeTabId&&this.setState({selectedTabId:this.props.activeTabId})}onTabClick=e=>{this.props.onTabClick&&this.props.onTabClick(e),this.setState({selectedTabId:e})};render(){const{children:e,icons:t}=this.props,s=this.state.selectedTabId;return e instanceof Array&&e.length>1?(0,zn.jsxs)("div",{className:[this.props.className,"TabbedView"].join(" "),children:[(0,zn.jsx)("nav",{className:"TabbedView-List",role:"tablist",children:e.map(((e,n)=>{const{id:i,label:a,className:o}=e.props;return(0,zn.jsx)("button",{"aria-selected":i===s?"true":"false",type:"button",role:"tab",className:Gn()(i===s&&"active",o),onMouseDown:e=>e.preventDefault(),onClick:()=>this.onTabClick(i),dangerouslySetInnerHTML:{__html:(t?t[n]:"")+a}},i)}))}),e.map((e=>{if(e.props.id===s)return(0,zn.jsx)("div",{className:"TabbedView-Content",role:"tabpanel","aria-labelledby":e.props.id,children:e.props.children},e.props.id)}))]}):(console.warn("TabbedView error: expecting multiple TabGroupEntries"),null)}}const aM=iM;const{VERIFYING:oM,OK:rM,ERROR:lM,OFFLINE:dM}=Nt.In,cM={"Sender Name":(0,W.Z)("Sender Name"),"Account Display Name":(0,W.Z)("Account Display Name"),"Sync Options":(0,W.Z)("Sync Options"),Signature:(0,W.Z)("Signature"),"Download messages for offline viewing and better search results.":(0,W.Z)("Download messages for offline viewing and better search results."),"Take Account Offline":(0,W.Z)("Take Account Offline"),"Upload Sent Messages to Sent Folder":(0,W.Z)("Upload Sent Messages to Sent Folder"),"Update Account":(0,W.Z)("Update Account"),Aliases:(0,W.Z)("Aliases"),Identity:(0,W.Z)("Identity"),Servers:(0,W.Z)("Servers"),Tips:(0,W.Z)("Tips"),"Name and signature":(0,W.Z)("Name and signature"),"Add a sender name and signature for this account.":(0,W.Z)("Add a sender name and signature for this account."),"Enable Rich Text and Images":(0,W.Z)("Enable Rich Text and Images"),"Replied Messages":(0,W.Z)("Replied Messages"),"Forwarded Messages":(0,W.Z)("Forwarded Messages"),...gP,...UP};class hM extends Un.PureComponent{_isMounted=!1;_hasVerified=!1;constructor(e){super(e),this.state={status:rM,statusText:"",accountSettings:this.props.accountSettings,incomingVerified:!1,smtpVerified:!1,userVerified:!1,view:"identity"}}static getDerivedStateFromProps(e,t){return e.accountSettings.MAIL_EMAIL!==t.accountSettings.MAIL_EMAIL?{accountSettings:e.accountSettings}:null}componentDidMount(){this._isMounted=!0}componentWillUnmount(){this._isMounted=!1}async verify(e){if(e.offline)this.setState({status:dM,statusText:(0,W.Z)("mail","Offline")});else try{this.setState({status:oM,statusText:(0,W.Z)("Verifying..."),incomingVerified:!1,smtpVerified:!1,userVerified:!1}),await es.Z.verify(e);if(await function(e){const t=(0,Ry.BB)(e);return new Promise((e=>{re.Z.mailPrivate.getFileDirectory(t,(t=>{n.Z.runtime.lastError?e():e(t)}))}))}(e.MAIL_EMAIL)||EP(e.MAIL_EMAIL),!this._isMounted)return;this.setState({status:rM,statusText:(0,W.Z)("Verified"),incomingVerified:!0,smtpVerified:!0,userVerified:!0})}catch(t){if(!this._isMounted)return void ls.Z.error("Mail",["EditMailAccount"],t);const s="string"==typeof e.MAIL_SERVER&&e.MAIL_SERVER.length>3,n="string"==typeof e.MAIL_SMTP_SERVER&&e.MAIL_SMTP_SERVER.length>3;this.setState({status:lM,statusText:t.message||t,incomingVerified:s&&!isNaN(e.MAIL_PORT),smtpVerified:n&&!isNaN(e.MAIL_SMTP_PORT),userVerified:!1})}}saveAccount=async()=>{const e=this.props.accountSettings,t=this.state.accountSettings;e&&((0,xl.ZP)(t,e),(0,kP.q1)(e,t)&&(await this.verify(t),NP(t,e)))};setAccountProperty=(e,t)=>{"MAIL_PORT"===e||"MAIL_SMTP_PORT"===e?this.setState((s=>({accountSettings:{...s.accountSettings,[e]:Number(t)}}))):this.setState((s=>({accountSettings:{...s.accountSettings,[e]:t}})))};autoSetAccountProperty=(e,t)=>{t!==this.props.accountSettings[e]&&this.setState((s=>({accountSettings:{...s.accountSettings,[e]:t}})),(()=>{(0,xl.ZP)(this.state.accountSettings,this.props.accountSettings),"preFetch"===e&&"none"!==t&&setTimeout((()=>ts.Z.preFetch(this.state.accountSettings.MAIL_EMAIL)),200)}))};autoSaveAliases=e=>{this.autoSetAccountProperty("aliases",e)};autoSavePreFetch=e=>{const{value:t}=e.target;this.autoSetAccountProperty("preFetch",t)};autoSaveMailName=e=>{const{value:t}=e.target;this.autoSetAccountProperty("MAIL_NAME",t)};autoSaveDisplayName=e=>{const{value:t}=e.target;this.autoSetAccountProperty("displayName",t)};autoSaveSignature=e=>{const{value:t}=e.target;this.autoSetAccountProperty("signature",t)};autoSaveSignatureReply=e=>{const{checked:t}=e.target;this.autoSetAccountProperty("signatureReply",t)};autoSaveSignatureForward=e=>{const{checked:t}=e.target;this.autoSetAccountProperty("signatureForward",t)};autoSaveSignaturePosition=e=>{const{value:t}=e.target;this.autoSetAccountProperty("signaturePosition",t)};areNonAutosavedPropertiesSame=()=>{const e=this.props.accountSettings,t=this.state.accountSettings;return t.MAIL_EMAIL===e.MAIL_EMAIL&&t.MAIL_PASSWORD===e.MAIL_PASSWORD&&t.MAIL_PORT===e.MAIL_PORT&&t.MAIL_SERVER===e.MAIL_SERVER&&t.MAIL_SMTP_PASSWORD===e.MAIL_SMTP_PASSWORD&&t.MAIL_SMTP_PORT===e.MAIL_SMTP_PORT&&t.MAIL_SMTP_SERVER===e.MAIL_SMTP_SERVER&&t.MAIL_SMTP_USER===e.MAIL_SMTP_USER&&t.MAIL_USER===e.MAIL_USER&&t.popDeletion===e.popDeletion&&t.useOAuth===e.useOAuth&&t.MAIL_SMTP_SOCKET_TYPE===e.MAIL_SMTP_SOCKET_TYPE};toggleOffline=e=>{const{checked:t}=e.target,{offline:s}=this.state.accountSettings;this.setState((e=>({accountSettings:{...e.accountSettings,offline:t}})),(()=>{(0,xl.HV)(this.state.accountSettings),s&&!t?(this._hasVerified=!1,this.setViewType("servers")):!s&&t&&this.setState({status:dM,statusText:(0,W.Z)("mail","Offline")})}))};toggleUploadSent=e=>{const{checked:t}=e.target;this.setState((e=>({accountSettings:{...e.accountSettings,uploadSent:t}})),(()=>{(0,xl.HV)(this.state.accountSettings)}))};toggleSignatureRichText=e=>{const{checked:t}=e.target;this.setState((e=>({accountSettings:{...e.accountSettings,isSignatureRichText:t}})),(()=>{(0,xl.HV)(this.state.accountSettings)}))};setViewType=e=>{"servers"!==e||this._hasVerified||(this._hasVerified=!0,this.verify(this.state.accountSettings)),this.setState({view:e})};render(){const e=this.props.showTips,t=this.state.accountSettings,s=t.accountType===Nt.s9.POP,n=this.state.status===lM?"error":this.state.status===rM?"success":"info";return(0,zn.jsxs)("div",{className:"detail",children:[e&&(0,zn.jsxs)("div",{className:"tips",children:[(0,zn.jsx)("h2",{children:cM["Name and signature"]}),(0,zn.jsx)("p",{className:"mail-setup-description",children:cM["Add a sender name and signature for this account."]})]}),(0,zn.jsxs)(aM,{icons:["",this.state.status===lM?Kn.viW:"","",""],onTabClick:this.setViewType,activeTabId:this.state.view,className:e?"hide-navigation":"",children:[(0,zn.jsxs)("div",{id:"identity",label:cM.Identity,children:[(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:cM["Sender Name"]}),(0,zn.jsx)(Vr.Z,{type:"text",onChange:this.autoSaveMailName,name:"MAIL_NAME",label:"",placeholder:"John Doe",value:t.MAIL_NAME?t.MAIL_NAME:""})]}),(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:cM["Account Display Name"]}),(0,zn.jsx)(Vr.Z,{type:"text",onChange:this.autoSaveDisplayName,name:"displayName",label:"",placeholder:"My Home Mail Account",value:t.displayName?t.displayName:""})]})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[!s&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("h3",{children:cM["Sync Options"]}),(0,zn.jsx)("div",{className:"setting-single info",children:cM["Download messages for offline viewing and better search results."]}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)("label",{className:"setting-single",title:(0,W.Z)("Full messages are not downloaded and stored locally until they are selected and opened or if they were sent within the time limit set here. More locally stored messages mean more accurate search results."),children:(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)(Fa.Z,{name:"preFetch",value:t.preFetch,onChange:this.autoSavePreFetch,disabled:t.offline,children:[(0,zn.jsx)("option",{value:"none",children:(0,W.Z)("Opened messages")}),(0,zn.jsx)("option",{value:"day",children:(0,W.Z)("A day")}),(0,zn.jsx)("option",{value:"week",children:(0,W.Z)("A week")}),(0,zn.jsx)("option",{value:"month",children:(0,W.Z)("A month")}),(0,zn.jsx)("option",{value:"year",children:(0,W.Z)("A year")}),(0,zn.jsx)("option",{value:"all",children:(0,W.Z)("All messages")})]})})})})]}),!s&&(0,zn.jsxs)("label",{className:"setting-single",title:(0,W.Z)("Some mail servers (e.g. Outlook), will create a copy of the sent message in its Sent folder. It is only for such cases that this should be unchecked"),children:[(0,zn.jsx)("input",{type:"checkbox",checked:t.uploadSent??!0,onChange:this.toggleUploadSent,disabled:t.offline}),(0,zn.jsx)("span",{children:cM["Upload Sent Messages to Sent Folder"]})]}),s&&(0,zn.jsx)(ZP,{popMaxSize:t.popMaxSize,setAccountProperty:this.autoSetAccountProperty}),(0,zn.jsxs)("label",{className:"setting-single",title:(0,W.Z)("Account will no longer try connecting to a server to fetch new messages"),children:[(0,zn.jsx)("input",{type:"checkbox",checked:!!t.offline&&t.offline,onChange:this.toggleOffline}),(0,zn.jsx)("span",{children:cM["Take Account Offline"]})]})]}),(0,zn.jsxs)("div",{className:"setting-group-double",children:[(0,zn.jsx)("h3",{children:cM.Signature}),(0,zn.jsxs)("div",{className:"mail-signature",children:[t.isSignatureRichText?(0,zn.jsx)(FP,{onChange:e=>this.autoSetAccountProperty("signature",e),signature:t.signature||"",emailAddress:t.MAIL_EMAIL}):(0,zn.jsx)(Vr.Z,{type:"textarea",rows:"4",onChange:this.autoSaveSignature,name:"signature",label:"",placeholder:void 0===t.signature?WP.F:"",value:t.signature||""}),(0,zn.jsxs)("div",{className:"mail-signature-footer",children:[(0,zn.jsxs)("div",{className:"mail-signature-footer-sidebar",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Include Signature in:")}),(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",name:"signatureReply",checked:void 0===t.signatureReply||t.signatureReply,onChange:this.autoSaveSignatureReply}),(0,zn.jsx)("span",{children:cM["Replied Messages"]})]}),(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",name:"signatureForward",checked:!!t.signatureForward,onChange:this.autoSaveSignatureForward}),(0,zn.jsx)("span",{children:cM["Forwarded Messages"]})]})]}),(0,zn.jsx)("div",{children:(0,zn.jsxs)(Fa.Z,{value:t.signaturePosition||"below",onChange:this.autoSaveSignaturePosition,name:"signaturePosition",title:(0,W.Z)("Placement of signature"),children:[(0,zn.jsx)("option",{value:"above",children:(0,W.Z)("Place Signature at Top")}),(0,zn.jsx)("option",{value:"below",children:(0,W.Z)("Place Signature at Bottom")})]})}),(0,zn.jsx)("div",{children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:!!t.isSignatureRichText,onChange:this.toggleSignatureRichText}),(0,zn.jsx)("span",{children:cM["Enable Rich Text and Images"]})]})})]})]})]}),e&&(0,zn.jsx)("div",{className:"setting-group setting-group-double pad-top",children:(0,zn.jsx)("input",{type:"submit",value:(0,W.Z)("Continue"),onClick:()=>e()})})]}),(0,zn.jsx)("div",{id:"servers",label:cM.Servers,className:this.state.status===lM?"error":"",children:(0,zn.jsxs)("form",{onSubmit:this.saveAccount,children:[(0,zn.jsx)(bP,{disabled:t.useOAuth,account:t,incomingVerified:this.state.incomingVerified,showErrors:this.state.status===lM,smtpVerified:this.state.smtpVerified,userVerified:this.state.userVerified,setAccountProperty:this.setAccountProperty,searchableStrings:cM}),s&&(0,zn.jsx)(IP,{account:t,setAccountProperty:this.setAccountProperty}),(0,zn.jsxs)("div",{className:"setting-group-double",children:[this.state.statusText&&(0,zn.jsx)(fa,{type:n,children:this.state.statusText}),(0,zn.jsx)("input",{type:"submit",value:(0,W.Z)("Update Account"),disabled:this.areNonAutosavedPropertiesSame()||this.state.status===oM})]})]})}),(0,zn.jsx)("div",{id:"aliases",label:cM.Aliases,children:(0,zn.jsx)(HP,{aliases:t.aliases||[],setAliases:this.autoSaveAliases,searchableStrings:cM,defaultSignature:t.signature,defaultName:t.MAIL_NAME,defaultEmail:t.MAIL_EMAIL})}),(0,zn.jsx)("div",{id:"tips",label:cM.Tips,children:(0,zn.jsx)(nM,{onCreateItem:()=>{},onClose:()=>this.setState({view:"identity"}),isSettings:this.props.isSettings})})]})]})}}const uM=hM;class pM extends Un.PureComponent{state={deleteFiles:!1,deletePasswords:!0};_isMounted=!1;_isSyncingPasswords=!1;componentDidMount(){this._isMounted=!0,this.getSyncStateForPasswords()}componentWillUnmount(){this._isMounted=!1}getSyncStateForPasswords(){re.Z.sync.getEngineState((e=>{const t=e.dataTypes.find((e=>"passwords"===e.dataType));this._isSyncingPasswords=t?.enabled||!1,this._isMounted&&this.setState({deletePasswords:!1})}))}async onSubmit(e){const t=this.props.item,{MAIL_EMAIL:s,accountType:n}=t;e.preventDefault(),(0,xl.HV)({...t,isDeleted:!0}),d.Z.removeAccount(s,this.state.deleteFiles,this.state.deletePasswords,n),this.props.onClose()}onChangeFileDeletion(){this.setState((e=>({deleteFiles:!e.deleteFiles})))}onChangePasswordDeletion(){this.setState((e=>({deletePasswords:!e.deletePasswords})))}render(){const{MAIL_EMAIL:e,useOAuth:t}=this.props.item;return(0,zn.jsxs)("form",{onSubmit:e=>this.onSubmit(e),children:[(0,zn.jsxs)("header",{className:"dialog-double-header",children:[(0,zn.jsx)("div",{className:"header-icon",dangerouslySetInnerHTML:{__html:Kn.Si$.large}}),(0,zn.jsx)("h1",{className:"dialog-title",children:(0,W.Z)("Delete Account $1",[e])})]}),!t&&this._isSyncingPasswords&&(0,zn.jsxs)("div",{className:"dialog-content",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{autoFocus:!0,type:"checkbox",checked:this.state.deletePasswords,onChange:e=>this.onChangePasswordDeletion()}),(0,W.Z)("Delete email passwords from settings")]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("If checked, other instances and devices using the same sync account and Vivaldi Mail will sign out from this account.")})]}),(0,zn.jsxs)("div",{className:"dialog-content",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{autoFocus:!0,type:"checkbox",checked:this.state.deleteFiles,onChange:e=>this.onChangeFileDeletion()}),(0,W.Z)("Also delete message files from disk")]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("If checked, all message files for $1 will be deleted. Otherwise they will remain on disk.",[e])})]}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"submit",className:"danger",value:(0,W.Z)("verb","Delete"),autoFocus:!0}),(0,zn.jsx)("input",{type:"button",onClick:this.props.onClose,value:(0,W.Z)("Cancel")})]})]})}}const gM=pM;const mM="/resources/vivaldi_mail_default.png",fM=s(89182);class vM extends Un.PureComponent{static contextType=oi.Z;_isMounted=!1;state={isCreating:!1,accounts:[],setupStep:"setup",missingAccountIds:[],isRestoringAccounts:!1};loadAccountsAndCapabilities=async e=>{const t=await Zd.Z.loadAllAccounts();if(!this._isMounted)return;const s=function(e,t){let s=[];const n=Object.keys(t);return e.length>n.length&&(s=e.filter((e=>e.offline&&!e.isDeleted&&!n.some((t=>t===e.MAIL_EMAIL)))).map((e=>e.MAIL_EMAIL))),s}(t,It.Z.getAccounts());if(t.length<this.state.accounts.length)this.setState({accounts:t,missingAccountIds:s});else{let n;e&&t.length>this.state.accounts.length&&(n="signature"),n?this.setState({accounts:t,setupStep:n,isCreating:!1,missingAccountIds:s}):this.setState({accounts:t,missingAccountIds:s})}};componentDidMount(){this._isMounted=!0,this.loadAccountsAndCapabilities()}componentWillUnmount(){this._isMounted=!1}componentDidUpdate(e){if(e.prefValues[Z.kMailAccounts]!==this.props.prefValues[Z.kMailAccounts]){const e=!0;this.loadAccountsAndCapabilities(e)}}renderListItem=(e,t)=>{const{name:s,displayName:n}=t;let i="";"string"!=typeof t.MAIL_EMAIL?ls.Z.warn("Mail",["Account Settings"],"Invalid mail address",JSON.stringify(t.MAIL_EMAIL)):i=t.MAIL_EMAIL.split("@")[1]??"";const a=t.isDeleted?(0,W.Z)("Deleting..."):t.displayName?t.MAIL_EMAIL:i;return(0,zn.jsx)(TS,{title:n||s,meta:a,iconPath:i,iconFallbackPath:mM})};onContextMenu=(e,t)=>{const s=this.state.accounts[e],n=s&&s.MAIL_EMAIL,i=(0,Ry.BB)(n),a=[{handler:()=>oN(this.context.vivaldiWindowId,i),...(0,fi.Z)("Reveal Data Folder")}];(0,mi.Z)(this.context,a)(t)};renderCreateListItem=()=>(0,zn.jsx)(TS,{title:(0,W.Z)("New Account"),meta:(0,W.Z)("Setup in progress..."),iconFallbackPath:mM,isCreating:!0});renderContent=(e,t)=>{const s=this.state.accounts[e];return(0,zn.jsx)(uM,{accountSettings:s,searchableStrings:t,isSettings:!0})};renderCreate=e=>(0,zn.jsx)(RP,{focusInput:!0,emptyAccounts:0===this.state.accounts.length,searchableStrings:e},"create");renderEmpty=e=>(0,zn.jsx)(RP,{emptyAccounts:!0,searchableStrings:e},"empty");remapAccounts=()=>this.state.accounts.map((e=>({...e,key:e.MAIL_EMAIL,name:e.MAIL_EMAIL})));deleteDialog=e=>(0,zn.jsx)(gM,{...e});onCreateItem=()=>{this.setState({isCreating:!0,setupStep:"setup"})};onCancelCreateItem=()=>{this.setState({isCreating:!1})};moveItem=(e,t)=>{const s=this.props.prefValues[Z.kMailAccounts].slice(),[n]=s.splice(e,1);n&&(s.splice(t,0,n),I.Z.set(Z.kMailAccounts,s))};_restoreLostAccounts=async()=>{this.setState({isRestoringAccounts:!0}),await Hs(this.state.missingAccountIds),await this.loadAccountsAndCapabilities(),this._isMounted&&this.setState({isRestoringAccounts:!1})};render(){return this.state.missingAccountIds.length>0?(0,zn.jsx)(tb.Z,{filter:this.props.filter,children:(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Database Error Detected")}),(0,zn.jsx)("label",{title:(0,W.Z)("Offline accounts are missing from DB and need to be restored!"),children:(0,zn.jsx)("input",{type:"button",onClick:this._restoreLostAccounts,disabled:this.state.isRestoringAccounts,value:this.state.isRestoringAccounts?(0,W.Z)("Restoring Accounts ..."):(0,W.Z)("Restore Accounts")})})]})}):this.props.prefValues[Z.kFeaturesMail]?(0,zn.jsx)(SS.Z,{title:(0,W.Z)("Mail Accounts"),addTipString:(0,W.Z)("Add account"),items:this.remapAccounts(),masterLayout:0,onRemove:nr.Z,deleteDialog:this.deleteDialog,onContextMenu:this.onContextMenu,emptyListGraphic:fM,emptyListString:(0,W.Z)("No accounts added"),renderListItem:this.renderListItem,renderCreateListItem:this.renderCreateListItem,renderContent:this.renderContent,moveItem:this.moveItem,contentStrings:cM,isCreating:this.state.isCreating,onCreateItem:this.onCreateItem,onCancelCreateItem:this.onCancelCreateItem,renderCreate:this.renderCreate,className:"setting-mail-account",createStrings:OP,renderEmpty:this.renderEmpty,emptyStrings:OP,filter:this.props.filter}):null}}const bM=(0,zd.Z)(vM,[Z.kFeaturesMail,Z.kMailAccounts]);var CM=(0,zn.jsx)("input",{type:"radio",value:!0}),wM=(0,zn.jsx)("input",{type:"radio",value:!1});class yM extends Un.PureComponent{state={ignoredMailingLists:Fs.Z.getIgnored()};componentDidMount(){bt.Z.addListener(this.mailingListsChanged)}componentWillUnmount(){bt.Z.removeListener(this.mailingListsChanged)}mailingListsChanged=e=>{if("mailingLists"===e.target){const e=Fs.Z.getIgnored();if(this.state.ignoredMailingLists.length===e.length&&this.state.ignoredMailingLists.every(((t,s)=>t===e[s])))return;this.setState({ignoredMailingLists:e})}};remap=e=>e.map(((e,t)=>({name:e.listId,key:String(t)})));renderListItem=(e,t)=>(0,zn.jsx)("span",{title:t.listId,children:e});onRemove=e=>{d.Z.removeIgnoredMailingList(this.state.ignoredMailingLists[e])};onChangeIgnoreAll=e=>{const{value:t}=e.target,s="true"===t,n=Fs.Z.get(Nt.ZW);n&&n.isIgnored!==s&&(n.isIgnored=!n.isIgnored,d.Z.updateMailingListGroup(n))};render(){return(0,zn.jsx)("div",{className:"detail",children:(0,zn.jsxs)("div",{className:"detail-content",children:[(0,zn.jsxs)("div",{className:"setting-group unlimited",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Uncategorized mailing lists")}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Manage the rest of the mailing lists that have been automatically generated using the list-id attribute")})]}),(0,zn.jsxs)(To.Z,{name:"subFolderType",value:Fs.Z.areUncategorizedMailingListsIgnored(),onChange:this.onChangeIgnoreAll,className:"setting-group unlimited",children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[CM,(0,zn.jsx)("span",{children:(0,W.Z)("mailinglist subfolder","Ignore All")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[wM,(0,zn.jsx)("span",{children:(0,W.Z)("Ignore Selected")})]})})]}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(Hy.Z,{items:this.remap(this.state.ignoredMailingLists),renderListItem:this.renderListItem,filter:this.props.filter,deleteTipString:(0,W.Z)("Stop ignoring uncategorized mailing list"),supportDragAndDrop:!1,onRemove:this.onRemove})})]})})}}const xM=yM,IM={Sender:(0,W.Z)("Sender"),"List ID":(0,W.Z)("List ID")};var AM=(0,zn.jsx)("input",{type:"radio",value:"true"}),SM=(0,zn.jsx)("input",{type:"radio",value:"false"}),ZM=(0,zn.jsx)("hr",{});class TM extends Un.Component{state={mailingList:this.props.mailingList,updating:!1};componentDidUpdate(e){e.mailingList!==this.props.mailingList&&this.setState({mailingList:this.props.mailingList,updating:!1})}updateListId=e=>{const t=e.target.value;this.setState((0,C.Uy)((({mailingList:e})=>{e.listId===e.name&&(e.name=t),e.listId=t})))};updateName=e=>{const t=e.target.value;this.setState((0,C.Uy)((({mailingList:e})=>{e.name=t})))};onlyPathChanged=()=>Object.keys(this.state.mailingList).every((e=>"name"===e?this.state.mailingList[e]!==this.props.mailingList[e]:this.state.mailingList[e]===this.props.mailingList[e]));saveMailingList=async()=>{this.setState({updating:!0}),this.onlyPathChanged()?await d.Z.updateMailingListGroupName(this.state.mailingList):await d.Z.updateMailingListGroup(this.state.mailingList)};hasChanged=()=>this.state.mailingList!==this.props.mailingList;isIgnoredChanged=e=>{const t=e.target.value;this.setState((0,C.Uy)((({mailingList:e})=>{e.isIgnored="true"===t})))};onChangeSubfolderType=e=>{const t=e.target.value;this.setState((0,C.Uy)((({mailingList:e})=>{e.subFolderType=t})))};onChangeParentFolder=e=>{const t=e.target.value;this.setState((0,C.Uy)((({mailingList:e})=>{e.parentFolderType=t})))};cancel=()=>{this.setState({mailingList:this.props.mailingList})};render(){const e=this.state.mailingList;return(0,zn.jsxs)("form",{className:"detail",style:{overflowY:"scroll"},children:[(0,zn.jsxs)("div",{className:"detail-content",children:[(0,zn.jsxs)("div",{className:"setting-group unlimited",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Mailing List Group")}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Group your autogenerated mailing lists. When a match is found, the whole list ID is used to group messages.")})]}),(0,zn.jsxs)("div",{className:"setting-group unlimited",children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[this.props.searchableStrings["List ID"],(0,zn.jsxs)(Fa.Z,{name:"parentFolderType",value:e.parentFolderType,onChange:this.onChangeParentFolder,children:[(0,zn.jsx)("option",{value:"endsWith",children:(0,W.Z)("Ends with")}),(0,zn.jsx)("option",{value:"startsWith",children:(0,W.Z)("Starts with")})]}),(0,zn.jsx)("input",{type:"text",onChange:this.updateListId,value:e.listId,disabled:!this.props.isCreating})]})}),(0,zn.jsxs)(To.Z,{name:"mailcheckintervalgroup",value:e.isIgnored,onChange:this.isIgnoredChanged,className:"setting-single",children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[AM,(0,zn.jsx)("span",{children:(0,W.Z)("Not a Mailing List")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[SM,(0,zn.jsx)("span",{children:(0,W.Z)("A Mailing List")})]})})]}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("span",{children:(0,W.Z)("Folder Name")}),(0,zn.jsx)("input",{type:"text",onChange:this.updateName,disabled:e.isIgnored,value:e.name})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("span",{children:(0,W.Z)("Subfolder Grouping")}),(0,zn.jsxs)(Fa.Z,{disabled:e.isIgnored,name:"subFolderType",value:e.subFolderType,onChange:this.onChangeSubfolderType,children:[(0,zn.jsx)("option",{value:"none",children:(0,W.Z)("mailinglist subfolder","None")}),ZM,(0,zn.jsx)("option",{value:"title",children:(0,W.Z)("mailinglist subfolder","Subject (square brackets)")}),(0,zn.jsx)("option",{value:"host",children:(0,W.Z)("mailinglist subfolder","Sender Domain")}),(0,zn.jsx)("option",{value:"senderName",children:(0,W.Z)("mailinglist subfolder","Sender Name")})]})]})}),this.state.updating&&(0,zn.jsx)(fa,{type:"info",children:(0,W.Z)("Updating")})]})]}),(0,zn.jsxs)("div",{className:"detail-toolbar",children:[!this.props.isCreating&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("input",{type:"submit",className:"primary",disabled:!this.hasChanged()||this.state.updating,onClick:this.saveMailingList,value:(0,W.Z)("Update Mailing List Group")}),(0,zn.jsx)("input",{type:"button",disabled:!this.hasChanged(),onClick:this.cancel,value:(0,W.Z)("Cancel")})]}),this.props.isCreating&&(0,zn.jsx)("input",{type:"submit",className:"primary",disabled:this.props.mailingList===this.state.mailingList||this.state.updating,onClick:this.saveMailingList,value:(0,W.Z)("Add Mailing List Group")})]})]})}}const EM=TM,kM=[Z.kMailAccounts,Z.kFeaturesMail],NM={"Mailing lists added in the mail panel will appear here.":(0,W.Z)("Mailing lists added in the mail panel will appear here.")};var _M=(0,zn.jsxs)("svg",{className:"item-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",children:[(0,zn.jsx)("path",{opacity:".35",d:"M0 3h8v1H0zM0 5h3v1H0zM0 7h3v1H0z"}),(0,zn.jsx)("path",{d:"M15 5H5a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1zm-1 4l-4 2-4-2V7l4 2 4-2z"})]},0);class PM extends Un.PureComponent{constructor(e){super(e),this.state={mailingListGroups:this.getMailingLists()}}componentDidMount(){Fs.Z.addListener(this.mailingListGroupsChanged)}componentWillUnmount(){Fs.Z.removeListener(this.mailingListGroupsChanged)}mailingListGroupsChanged=()=>{const e=this.getMailingLists();this.state.mailingListGroups.length===e.length&&this.state.mailingListGroups.every(((t,s)=>t===e[s]))||this.setState({mailingListGroups:e})};getMailingLists=()=>Fs.Z.getGroups();remapMailingListGroups=e=>[...e,{name:"Uncategorized mailing lists",isDefault:!0}].map(((e,t)=>{let s=e.name;return e.listId&&s!==e.listId&&(s+=" ("+e.listId+")"),{...e,name:s,key:String(t)}}));getFavicon=e=>{if(e){const t=e.split("@");if(t&&2===t.length){const e=t[1].split(".");if(e&&e[1]&&e[1].length>1)return(0,zn.jsx)(Vn.ZP,{className:"item-icon",url:`${t[1]}`,loadType:"page"},0)}}return _M};renderListItem=(e,t)=>(0,zn.jsxs)(zn.Fragment,{children:["matches"!==t.parentFolderType&&this.getFavicon(t.listId),(0,zn.jsx)("div",{className:"item-title",children:e})]});renderContent=(e,t)=>this.state.mailingListGroups.length===e?(0,zn.jsx)(xM,{filter:this.props.filter}):(0,zn.jsx)(EM,{searchableStrings:t,mailingList:this.state.mailingListGroups[e]});renderEmpty=e=>(0,zn.jsx)("div",{className:"detail",children:(0,zn.jsx)("div",{className:"detail-content",children:(0,zn.jsx)("p",{children:e["Mailing lists added in the mail panel will appear here."]})})});renderCreateListItem=()=>(0,zn.jsx)("div",{className:"item-title",children:(0,W.Z)("New Mailing List Group")});renderCreate=e=>(0,zn.jsx)(EM,{isCreating:!0,searchableStrings:e,mailingList:{name:"",isIgnored:!1,subFolderType:"host",parentFolderType:"endsWith",listId:""}});removeAt=e=>{this.setState((t=>{const s=[...t.mailingListGroups],[n]=s.splice(e,1);return d.Z.removeMailingListGroup(n),{mailingListGroups:s}}))};render(){if(0===this.props.prefValues[Z.kMailAccounts].length||!this.props.prefValues[Z.kFeaturesMail])return null;const e=this.remapMailingListGroups(this.state.mailingListGroups);return(0,zn.jsx)(SS.Z,{title:(0,W.Z)("Mailing Lists"),className:"setting-mailing-lists",deleteTitle:(0,W.Z)("Delete List"),addTipString:(0,W.Z)("Add Mailing List"),deleteTipString:(0,W.Z)("Delete Mailing List"),items:e,onRemove:this.removeAt,masterLayout:1,renderListItem:this.renderListItem,renderContent:this.renderContent,contentStrings:IM,renderCreate:this.renderCreate,renderCreateListItem:this.renderCreateListItem,renderEmpty:this.renderEmpty,emptyStrings:NM,filter:this.props.filter},e.length)}}const MM=(0,zd.Z)(PM,kM),DM=[Z.kMailAccounts,Z.kMailAddArchiveFolder,Z.kMailAutoGenerateContacts,Z.kMailCheckInterval,Z.kMailComposerColors,Z.kMailColorQuotedText,Z.kFeaturesMail,Z.kMailMailtoInVivaldi,Z.kMailDefaultAccount,Z.kMailDeleteInOtherLocations,Z.kMailImapLogsOn,Z.kMailIncludeIdentifyingHeaders,Z.kMailMarkDeleteInOtherLocations,Z.kMailPreferredRendering,Z.kMailSmtpLogsOn,Z.kMailShowQuickReply,Z.kMailQuickReplyQuote,Z.kMailPrefetchOnDemand],OM=I.Z.getEventHandler;var jM=(0,zn.jsx)("input",{type:"radio",value:"one_minute"}),LM=(0,zn.jsx)("input",{type:"radio",value:"fifteen_minutes"}),RM=(0,zn.jsx)("input",{type:"radio",value:"manual"}),BM=(0,zn.jsx)("input",{type:"radio",value:"prefer_html"}),FM=(0,zn.jsx)("input",{type:"radio",value:"plaintext"}),WM=(0,zn.jsx)("input",{type:"radio",value:"hide"}),UM=(0,zn.jsx)("input",{type:"radio",value:"minimize"}),VM=(0,zn.jsx)("input",{type:"radio",value:"show"}),HM=(0,zn.jsx)("input",{type:"radio",value:Nt.Y6}),GM=(0,zn.jsx)("input",{type:"radio",value:"black_on_white"}),KM=(0,zn.jsx)("input",{type:"radio",value:"inherit_themes"});function zM(e){const t=(0,Eo.Z)(DM),s=t[Z.kMailAccounts].filter((e=>!e.offline));return(0,zn.jsxs)(zn.Fragment,{children:[t[Z.kFeaturesMail]&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsx)(bM,{filter:e.filter})}),(0,zn.jsxs)(Vy.Z,{categoryTitle:(0,W.Z)("Mail Settings"),filter:e.filter,children:[(0,zn.jsx)("div",{className:"setting-group",children:(0,zn.jsx)("div",{className:"setting-single pad-top",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kMailPrefetchOnDemand],onChange:OM(Z.kMailPrefetchOnDemand)}),(0,zn.jsx)("span",{children:(0,W.Z)("Download Messages to Generate Previews on Demand")})]})})}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Mailto Links")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kMailMailtoInVivaldi],onChange:OM(Z.kMailMailtoInVivaldi)}),(0,zn.jsx)("span",{children:(0,W.Z)("Handle Mailto Links in Vivaldi Mail")})]})})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Check For New Mail")}),(0,zn.jsxs)(To.Z,{name:"mailcheckintervalgroup",value:t[Z.kMailCheckInterval],onChange:OM(Z.kMailCheckInterval),children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[jM,(0,zn.jsx)("span",{children:(0,W.Z)("Every Minute")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[LM,(0,zn.jsx)("span",{children:(0,W.Z)("Every 15 Minutes")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[RM,(0,zn.jsx)("span",{children:(0,W.Z)("mail","Manually")})]})})]})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Mail Rendering")}),(0,zn.jsxs)(To.Z,{name:"mailpreferredrendering",value:t[Z.kMailPreferredRendering],onChange:OM(Z.kMailPreferredRendering),children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[BM,(0,zn.jsx)("span",{children:(0,W.Z)("Prefer HTML over Text")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[FM,(0,zn.jsx)("span",{children:(0,W.Z)("format","Text Only")})]})})]}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kMailColorQuotedText],onChange:OM(Z.kMailColorQuotedText)}),(0,zn.jsx)("span",{children:(0,W.Z)("Color Quoted Text")})]})})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Quick reply")}),(0,zn.jsxs)(To.Z,{name:"mailshowquickreply",value:t[Z.kMailShowQuickReply],onChange:OM(Z.kMailShowQuickReply),children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[WM,(0,zn.jsx)("span",{children:(0,W.Z)("Hide Quick Reply")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[UM,(0,zn.jsx)("span",{children:(0,W.Z)("Minimize Quick Reply")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[VM,(0,zn.jsx)("span",{children:(0,W.Z)("Show Quick Reply")})]})})]}),(0,zn.jsx)("div",{className:"setting-single pad-left",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kMailQuickReplyQuote],onChange:OM(Z.kMailQuickReplyQuote),disabled:!t[Z.kMailShowQuickReply]}),(0,zn.jsx)("span",{children:(0,W.Z)("Quote Original Message")})]})})]}),s&&(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Default Sender in New Messages")}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Used as fallback if no account is selected")}),(0,zn.jsxs)(To.Z,{name:"maildefaultaccountgroup",value:t[Z.kMailDefaultAccount]||Nt.Y6,onChange:OM(Z.kMailDefaultAccount),children:[(e=>e.map(((e,t)=>(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"radio",value:e.MAIL_EMAIL}),(0,zn.jsx)("span",{children:e.MAIL_EMAIL})]})},"default-account-"+t))))(s),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[HM,(0,zn.jsx)("span",{children:(0,W.Z)("Most Recently Used")})]})},"default-account-mru")]})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Contacts")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kMailAutoGenerateContacts],onChange:OM(Z.kMailAutoGenerateContacts)}),(0,zn.jsx)("span",{children:(0,W.Z)("Generate contacts for message recipients")})]})})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Composer Colors")}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Doesn’t affect the color of sent messages")}),(0,zn.jsxs)(To.Z,{name:"mailcomposercolors",value:t[Z.kMailComposerColors],onChange:OM(Z.kMailComposerColors),children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[GM,(0,zn.jsx)("span",{children:(0,W.Z)("Black on White")})]})},"composer-background-white"),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[KM,(0,zn.jsx)("span",{children:(0,W.Z)("Inherit Theme Colors")})]})},"composer-background-theme")]})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Optional Mail Headers")}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Mail headers to include when sending messages")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kMailIncludeIdentifyingHeaders],onChange:OM(Z.kMailIncludeIdentifyingHeaders)}),(0,zn.jsx)("span",{children:(0,W.Z)("mail","Mail client identification headers")})]})})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Delete Duplicate Messages")}),(0,zn.jsxs)(Fa.Z,{value:t[Z.kMailMarkDeleteInOtherLocations],onChange:OM(Z.kMailMarkDeleteInOtherLocations),children:[(0,zn.jsx)("option",{value:"ask",children:(0,W.Z)("Ask")}),(0,zn.jsx)("option",{value:"folders",children:(0,W.Z)("From All Folders on Current Account")}),(0,zn.jsx)("option",{value:"accounts",children:(0,W.Z)("From All Accounts and Folders")})]})]}),(0,zn.jsxs)("div",{className:"setting-single pad-top",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Permanently Delete Duplicate Messages")}),(0,zn.jsxs)(Fa.Z,{value:t[Z.kMailDeleteInOtherLocations],onChange:OM(Z.kMailDeleteInOtherLocations),children:[(0,zn.jsx)("option",{value:"ask",children:(0,W.Z)("Ask")}),(0,zn.jsx)("option",{value:"selected",children:(0,W.Z)("From the Current Folder Only")}),(0,zn.jsx)("option",{value:"folders",children:(0,W.Z)("From All Folders on Current Account")}),(0,zn.jsx)("option",{value:"accounts",children:(0,W.Z)("From All Accounts and Folders")})]})]})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Archive Actions")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kMailAddArchiveFolder],onChange:OM(Z.kMailAddArchiveFolder)}),(0,zn.jsx)("span",{children:(0,W.Z)("Add Archive Folder if Missing")})]})},"add-archive-folder")]})]}),(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsx)(MM,{filter:e.filter})}),(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsx)(Yy,{filter:e.filter})}),(0,zn.jsx)(BN,{filter:e.filter,settingsFeature:"mail"}),(0,zn.jsx)(Vy.Z,{categoryTitle:(0,W.Z)("Advanced Settings"),filter:e.filter,children:(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kMailImapLogsOn],onChange:OM(Z.kMailImapLogsOn)}),(0,zn.jsx)("span",{children:(0,W.Z)("Turn on IMAP Logs in Console")})]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Note that this will degrade performance of the mail client.")})]}),(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kMailSmtpLogsOn],onChange:OM(Z.kMailSmtpLogsOn)}),(0,zn.jsx)("span",{children:(0,W.Z)("Turn on SMTP Logs in Console")})]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Turn this on for debugging problems with sending mail.")})]})]})})]}),(0,zn.jsx)(YA,{categoryTitle:(0,W.Z)("Mail"),filter:e.filter,inform:!0})]})}const $M=Un.memo(zM),YM=40;const XM=class{points=[];points_buffer=[];stopped=!0;ctx;idx=0;timeout=0;requestId;animationId;current_point_index;constructor(e,t,s="#006ed7",n="#ffffff"){this.window=e,this.canvas=t,this.color=s,this.bgColor=n}#jt(){const{sequence:e}=this;let t,s=0,n=0,i=0,a=0,o=0,r=0;for(t=0;t<e.length;t++)"0"===e[t]?o+=1:"4"===e[t]&&(o-=1),o>s&&(s=o),o<n&&(n=o);for(t=0;t<e.length;t++)"2"===e[t]?r-=1:"6"===e[t]&&(r+=1),r>i&&(i=r),r<a&&(a=r);return n>0&&(n=0),a>0&&(a=0),120/Math.max(Math.abs(s-n),Math.abs(i-a))}init_points=function(){this.points=[],this.points_buffer=[];const e={x:YM,y:YM};this.points.push(e);const t=this.#jt();for(let e=0;e<this.sequence.length;e++)"0"===this.sequence[e]?this.points.push({x:this.points[e].x+t,y:this.points[e].y}):"2"===this.sequence[e]?this.points.push({x:this.points[e].x,y:this.points[e].y+t}):"4"===this.sequence[e]?this.points.push({x:this.points[e].x-t,y:this.points[e].y}):"6"===this.sequence[e]&&this.points.push({x:this.points[e].x,y:this.points[e].y-t});let s=this.points[0].x,n=this.points[0].y,i=this.points[0].x,a=this.points[0].y;for(let e=1;e<this.points.length;e++)this.points[e].x<s&&(s=this.points[e].x),this.points[e].x>i&&(i=this.points[e].x),this.points[e].y<n&&(n=this.points[e].y),this.points[e].y>a&&(a=this.points[e].y);if(s<YM){for(let e=0;e<this.points.length;e++)this.points[e].x+=-(s-YM);i+=-(s-YM)}if(n<YM){for(let e=0;e<this.points.length;e++)this.points[e].y+=-(n-YM);a+=-(n-YM)}for(let e=0;e<this.points.length;e++)this.points[e].x+=(160-i)/2,this.points[e].y+=(160-a-8)/2;for(let e=0;e<this.points.length;e++){const t={x:this.points[e].x,y:this.points[e].y};this.points_buffer.push(t)}};reset_points=function(){for(let e=0;e<this.points_buffer.length;e++)this.points[e].x=this.points_buffer[e].x,this.points[e].y=this.points_buffer[e].y};draw_point=function(e){this.ctx.beginPath(),this.ctx.arc(e.x,e.y,8,0,2*Math.PI,!0),this.ctx.closePath(),this.ctx.fillStyle=this.color,this.ctx.fill()};draw_segment=function(){if(!this.stopped){if(this.idx>=this.points.length)return this.timeout>=30?(this.timeout=0,this.idx=0,this.reset_points(),this.window.clearTimeout(this.requestId),void(this.requestId=setTimeout((()=>{this.animationId=this.window.requestAnimationFrame((()=>this.draw_segment()))}),1e3/60))):(this.ctx.fillStyle=Be()(this.bgColor).alpha(.15).css(),this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.timeout++,this.window.clearTimeout(this.requestId),void(this.requestId=setTimeout((()=>{this.animationId=this.window.requestAnimationFrame((()=>this.draw_segment()))}),1e3/60)));this.ctx.fillStyle=Be()(this.bgColor).alpha(.1).css(),this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.draw_point(this.points[this.idx]),!this.points[this.idx+1]||this.points[this.idx].x===this.points[this.idx+1].x&&this.points[this.idx].y===this.points[this.idx+1].y?(this.idx++,this.draw_segment()):(this.points[this.idx].x<this.points[this.idx+1].x?this.points[this.idx].x+=5:this.points[this.idx].x>this.points[this.idx+1].x&&(this.points[this.idx].x-=5),this.points[this.idx].y<this.points[this.idx+1].y?this.points[this.idx].y+=5:this.points[this.idx].y>this.points[this.idx+1].y&&(this.points[this.idx].y-=5),this.window.clearTimeout(this.requestId),this.requestId=setTimeout((()=>{this.window.requestAnimationFrame((()=>this.draw_segment()))}),1e3/60))}};clear_canvas=function(){this.ctx.fillStyle=this.bgColor,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)};start=function(e){this.sequence=e,this.ctx=this.canvas.getContext("2d"),this.ctx.lineWidth=3,this.clear_canvas(),this.init_points(),this.stopped&&(this.stopped=!1,this.animationId=this.window.requestAnimationFrame((()=>{this.draw_segment()})))};stop=function(){this.stopped=!0,this.current_point_index=0,this.timeout=0,this.idx=0,this.window.cancelAnimationFrame(this.animationId)}};var QM=s(34155);const qM={width:400,minWidth:"unset"},JM=vs.jk.settingCategories,eD=["colorHighlightBg","colorBg"],tD=[Z.kMouseGesturesAltGesturesEnabled,Z.kMouseGesturesDoubleClickMenuEnabled,Z.kMouseGesturesEnabled,Z.kMouseGesturesStrokeTolerance,Z.kMouseGesturesRockerGesturesEnabled,Z.kMouseGesturesRockerGesturesRightToLeft,Z.kMouseGesturesRockerGesturesLeftToRight],sD=I.Z.getEventHandler;const nD=function(){const e=2*Math.PI/4,t=2*Math.PI/100,s=[];for(let n=-e/2;n<=2*Math.PI-e/2;n+=t){const t=2*Math.floor((n+e/2)/e);s.push(t)}return s}();var iD=(0,zn.jsx)("hr",{}),aD=(0,zn.jsx)("span",{className:"meter-bg"});function oD(e){const t=Un.useContext(oi.Z),s=(0,Eo.Z)(tD),n=nI({filter:e.filter,prefPaths:tD,name:e.category.title}),i=Un.useRef(),a=Un.useRef(),o=Un.useRef(),r=Un.useRef(0),l=Un.useRef(0),d=Un.useRef(),c=Un.useRef(),h=Un.useRef(),u=Un.useRef(),p=Un.useRef(),g=iE(),m=Ue.Z.getBaseStylesByWindowId(t.vivaldiWindowId,eD),f=Ye.Z.getSettingsList(!0),v=e=>e.find((e=>e.gestures)),[b,C]=Un.useState(Ye.Z.getCommandsForGestures()),[w,y]=Un.useState(f),[x,A]=Un.useState(v(f)),[S,T]=Un.useState(0),[E,k]=Un.useState(!1),[N,_]=Un.useState(!1);const[P,M]=Un.useReducer((function(e,s){const n=a.current;return(e.bg!==s.bg||e.highlightBg!==s.highlightBg)&&p.current&&n&&(R(),p.current=new XM(t.window,n,s.highlightBg,s.bg),x?.gestures&&p.current.start(x.gestures[0])),s}),{highlightBg:String(m["--colorHighlightBg"]),bg:String(m["--colorBg"])}),[D,O]=Un.useState(f.find((e=>e.guid===s[Z.kMouseGesturesRockerGesturesLeftToRight]))),[j,L]=Un.useState(f.find((e=>e.guid===s[Z.kMouseGesturesRockerGesturesRightToLeft]))),R=Un.useCallback((()=>{p.current?.stop(),o.current=!1,c.current=[],h.current=[],u.current=[];const e=a.current;if(e){e.getContext("2d").clearRect(0,0,e.width,e.height)}}),[]);Un.useEffect((()=>{const s=()=>{const e=Ye.Z.getSettingsList(!0),t=Ye.Z.getCommandsForGestures();let s=!1;const n=x?.name,i=Object.keys(t);for(let e=0;e<i.length&&!s;e++){s=-1!==t[i[e]].findIndex((e=>e.name===n))}y(e),C(t),T(0),s||A(v(e)),0===i.length&&R()},n=()=>{const e=Ue.Z.getBaseStylesByWindowId(t.vivaldiWindowId,eD);M({highlightBg:String(e["--colorHighlightBg"]),bg:String(e["--colorBg"])})};Ue.Z.addListener(n),Ye.Z.addListener(s),oe.Z.addListener(s);const a=p.current;return e.category!==JM.all&&QM.nextTick((()=>i.current?.focus())),()=>{Ue.Z.removeListener(n),a?.stop(),Ye.Z.removeListener(s),oe.Z.removeListener(s)}}),[]);const B=e=>{const s=x;let n=e&&"focus"===e.type&&s&&s.gestures?s.gestures[0]:e.target.value;const i=e&&"focus"===e.type&&s?s:(o=n,w.find((e=>{if(e.gestures&&e.gestures[0]===o)return e})));var o;if(n){R();const e=a.current;e&&(p.current=new XM(t.window,e,P.highlightBg,P.bg)),0===n.indexOf("e")&&(n=n.substring(1,n.length)),p.current?.start(n),T(0),A(i)}},F=()=>{d.current=[],R();const e=w;T(0),k(!1),A(v(e))},U=()=>{const e=x;e&&(T(2),A(w.find((t=>t.name===e.name))))},V=()=>{ae.Z.restoreGestures(),_(!1)},H=()=>{_(!1)},G=(e,t,s)=>{c.current?.push(e),h.current?.push(t),s&&u.current?.push(s)},K=()=>{const e=a.current,t=e?.getContext("2d");if(!e||!t)return;t.clearRect(0,0,t.canvas.width,t.canvas.height),t.strokeStyle=P.highlightBg,t.lineJoin="round",t.lineWidth=16;const s=c.current,n=h.current;if(s&&n)for(let e=0;e<s.length;e++)t.beginPath(),u.current?.[e]&&e?t.moveTo(s[e-1],n[e-1]):t.moveTo(s[e]-1,n[e]),t.lineTo(s[e],n[e]),t.closePath(),t.stroke()},z=e=>{if(2!==S||e.button&&0!==e.button)return;e.touches&&(e=e.touches[0]),R(),d.current=[],o.current=!0;const t=a.current?.getBoundingClientRect()??{left:0,top:0};G(e.pageX-t.left,e.pageY-t.top),K()},$=e=>{if(2===S&&(e.touches&&(e=e.touches[0]),o.current)){const t=a.current?.getBoundingClientRect()??{left:0,top:0};if(G(e.pageX-t.left,e.pageY-t.top,!0),0===r.current)return r.current=e.pageX-t.left,void(l.current=e.pageY-t.top);const s=e.pageX-t.left-(r.current??0),n=e.pageY-t.top-(l.current??0),i=10;s*s+n*n>i*i&&(r.current=e.pageX-t.left,l.current=e.pageY-t.top,((e,t)=>{const s=2*Math.PI/4;let n=Math.atan2(t,e)+s/2;n<0&&(n+=2*Math.PI);const i=Math.floor(n/(2*Math.PI)*100);Array.isArray(d.current)&&d.current.push(nD[i])})(s,n)),K()}},Y=()=>{o.current=!1;const e=d.current;if(2!==S||!e||e.length<3)return;e.length&&(d.current=e.flatMap(((e,t,s)=>e!==s[t-1]&&e===s[t+1]?[e]:[])));let s=d.current?.join("")??"";s.length>5&&(s=s.substring(s.length-5));const n=a.current;let i;n&&(p.current=new XM(t.window,n,P.highlightBg,P.bg),p.current.start(s)),i=x&&(0,fc.jD)(x.name)?b["e"+s]:b[s],k(Boolean(i)),g()},X=()=>{o.current&&(o.current=!1,d.current=[])},Q=e=>{const t=w;let n="LTR"===e?D:j;const i=s[Z.kMouseGesturesRockerGesturesLeftToRight],a=s[Z.kMouseGesturesRockerGesturesRightToLeft];return"LTR"===e&&n&&i!==n.guid?n=t.find((e=>e.guid===i)):"RTL"===e&&n&&a!==n.guid&&(n=t.find((e=>e.guid===a))),(0,zn.jsx)(wZ.Z,{placeholder:(0,W.Z)("Filter commands..."),isClearable:!1,autoFocus:!1,selectedCommand:n,openMenuOnFocus:!0,isMulti:!1,setSelectedItem:t=>q(t,e),commands:t})},q=(e,t)=>{"LTR"===t?(I.Z.set(Z.kMouseGesturesRockerGesturesLeftToRight,e.guid),O(e)):(I.Z.set(Z.kMouseGesturesRockerGesturesRightToLeft,e.guid),L(e))},J=x,ee=J&&J.gestures?J.gestures[0]:void 0,te=!d.current||0===d.current.length,se=E&&!te?w.find((e=>e.gestures&&e.gestures.includes(d.current?.join("")))):void 0,ne=" "+(0,W.Z)("This setting requires a restart to take full effect.");return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsxs)(Vy.Z,{categoryTitle:(0,W.Z)("Mouse"),filter:e.filter,children:[N&&(0,zn.jsx)(Ha.Z,{style:qM,onRequestClose:H,title:(0,W.Z)("Restore Gestures?"),children:(0,zn.jsxs)("div",{className:"dialog-restore-shortcuts",children:[(0,zn.jsx)("div",{className:"dialog-content",children:(0,zn.jsx)("p",{children:(0,W.Z)("All command gestures will be restored to default settings.")})}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"button",className:"danger",onClick:V,value:(0,W.Z)("Restore")}),(0,zn.jsx)("input",{type:"button",onClick:H,value:(0,W.Z)("Cancel"),autoFocus:!0})]})]})}),(0,zn.jsxs)("div",{className:"setting-group unlimited",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Gestures")}),(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kMouseGesturesEnabled],onChange:sD(Z.kMouseGesturesEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("Allow Gestures")})]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Hold down right mouse button and perform a gesture to issue related command.")+ne})]}),(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kMouseGesturesAltGesturesEnabled],onChange:sD(Z.kMouseGesturesAltGesturesEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("win_linux","Perform Gestures with Alt Key")})]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Use gestures with trackpad or other input device.")})]})]}),(0,zn.jsx)("div",{className:"setting-group unlimited gestures",children:(0,zn.jsxs)("div",{className:"setting-single pad-top",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Gesture Mapping")}),(0,zn.jsxs)("div",{className:"gesture-map setting-single",children:[(0,zn.jsx)("select",{ref:i,className:"gesture-list",value:ee,onChange:B,onFocus:B,onBlur:R,size:"9",children:w.map((e=>{const{gestures:t}=e;return t?(0,zn.jsx)("option",{value:t[0],children:e.label},`id-gesture-${e.label.split(" ").join("_")}`):null}))}),(0,zn.jsx)("div",{className:2===S?"active gesture":"gesture",children:(0,zn.jsx)("canvas",{ref:a,width:"200",height:"200",onTouchStart:z,onTouchMove:$,onTouchEnd:Y,onTouchCancel:X,onMouseDown:z,onMouseMove:$,onMouseUp:Y,onMouseLeave:X})})]}),(0,zn.jsxs)("div",{className:"setting-single record-gesture",children:[0===S&&(0,zn.jsxs)("div",{className:"toolbar toolbar-default",children:[(0,zn.jsxs)("div",{className:"toolbar toolbar-group",children:[(0,zn.jsx)(oa.ZP,{tooltip:(0,W.Z)("New gesture"),onClick:()=>{T(1)},image:Kn.md4.medium}),iD,(0,zn.jsx)(oa.ZP,{tooltip:(0,W.Z)("Remove gesture"),onClick:()=>{const e=(()=>{const e=w.filter((e=>e.gestures));if(e&&x){const t=e.findIndex((e=>e.name===x.name));return t<e.length-1?e[t+1]:e[t-1]}})(),t=x;t&&(ae.Z.setGestures(t.name),A(e),p.current&&e?.gestures&&p.current?.start(e.gestures[0]))},disabled:!J,image:Kn.M2k.medium})]}),(0,zn.jsx)(oa.ZP,{tooltip:(0,W.Z)("Edit gesture"),onClick:U,disabled:!J,image:Kn.NNg.medium}),(0,zn.jsx)(oa.ZP,{title:(0,W.Z)("Restore Default Gestures"),onClick:()=>{_(!0)}})]}),1===S&&(0,zn.jsxs)("form",{onSubmit:U,children:[(0,zn.jsx)("h3",{className:"pad-top",children:(0,W.Z)("Pick a Command")}),(0,zn.jsxs)("div",{className:"toolbar",children:[(()=>{const t=w.filter((e=>!e.gestures&&e)),s=e.category!==JM.all;return(0,zn.jsx)(wZ.Z,{placeholder:(0,W.Z)("Filter commands..."),isClearable:!0,autoFocus:s,selectedCommand:x,openMenuOnFocus:!0,isMulti:!1,setSelectedItem:A,commands:t})})(),(0,zn.jsx)("input",{type:"submit",disabled:!J,value:(0,W.Z)("Next...")}),(0,zn.jsx)("input",{type:"button",onClick:F,value:(0,W.Z)("Cancel")})]})]}),J&&2===S&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("h3",{className:"pad-top",children:(0,W.Z)("Recording “$1” Gesture",[J.label])}),(0,zn.jsxs)("div",{className:"add-gesture",children:[(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Draw a new gesture in the highlighted area using the primary input. Gesture may consist of horizontal and vertical lines, limited to maximum of five strokes.")}),(0,zn.jsxs)("div",{className:"save",children:[(0,zn.jsx)("input",{type:"submit",value:(0,W.Z)("Save Gesture"),onClick:()=>{if(!d.current)return;let e=d.current.join("");const t=x;t&&((0,fc.jD)(t.name)&&(e="e"+e),ae.Z.setGestures(t.name,[e]),d.current=[],QM.nextTick((()=>i.current?.focus())))},disabled:te||E}),(0,zn.jsx)("input",{type:"button",onClick:F,value:(0,W.Z)("Cancel")}),se&&(0,zn.jsx)("p",{className:"alert",children:(0,W.Z)("This gesture is already used by “$1” command.",[se.label])})]})]})]})]})]})}),(0,zn.jsxs)("div",{className:"setting-group unlimited",children:[(0,zn.jsxs)("div",{className:"setting-single pad-top",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Gesture Sensitivity")}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Set minimum stroke length to be recognized as a gesture move.")}),(0,zn.jsxs)("div",{className:"setting-single tolerance",children:[(0,zn.jsxs)("div",{className:"gesture-preview",children:[aD,(0,zn.jsx)("span",{className:"meter",style:{width:s[Z.kMouseGesturesStrokeTolerance]+"px"}}),(0,zn.jsx)("span",{children:(0,W.Z)("$1 pixels",[s[Z.kMouseGesturesStrokeTolerance]])})]}),(0,zn.jsx)(tI,{min:5,max:100,step:5,onChange:sD(Z.kMouseGesturesStrokeTolerance),value:s[Z.kMouseGesturesStrokeTolerance]})]})]}),(0,zn.jsxs)("div",{className:"setting-single pad-top",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Rocker Gestures")}),(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kMouseGesturesRockerGesturesEnabled],onChange:sD(Z.kMouseGesturesRockerGesturesEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("Allow Rocker Gestures")})]}),(0,zn.jsx)("p",{className:"info",children:ne}),(0,zn.jsxs)("div",{className:"pad-left",children:[(0,zn.jsxs)("div",{className:"rocker-gesture-settings",children:[(0,zn.jsxs)("span",{className:"rocker-gesture-settings-title",children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.GmL}}),(0,W.Z)("other","Right")]}),Q("LTR")]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Press left mouse button followed by right button to execute.")})]}),(0,zn.jsxs)("div",{className:"pad-left",children:[(0,zn.jsxs)("div",{className:"rocker-gesture-settings",children:[(0,zn.jsxs)("span",{className:"rocker-gesture-settings-title",children:[(0,zn.jsx)("span",{style:{transform:"scale(-1, 1)"},dangerouslySetInnerHTML:{__html:Kn.GmL}}),(0,W.Z)("other","Left")]}),Q("RTL")]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Press right mouse button followed by left button to execute.")})]})]}),Fn.Z.isEnabled("double_click_menu")&&(0,zn.jsxs)("div",{className:"setting-single pad-top",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Double Click Context Menu")}),(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kMouseGesturesDoubleClickMenuEnabled],onChange:sD(Z.kMouseGesturesDoubleClickMenuEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("Allow Double Click to Show Context Menu")})]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Use a double click to show the context menu.")+ne})]})]})]})}),n]})}const rD=Un.memo(oD),lD=I.Z.getEventHandler,dD=[Z.kVivaldiClientHintsBrand,Z.kVivaldiClientHintsBrandAppendVivaldi,Z.kVivaldiClientHintsBrandCustomBrand,Z.kVivaldiClientHintsBrandCustomBrandVersion],cD=new RegExp(/[^\x20-\x21\x23-\x5B\x5D-\x7E]/),hD=new RegExp(/^[0-9.]*$/);function uD(e){const t=Un.useContext(oi.Z),s=(0,Eo.Z)(dD),n=nI({filter:e.filter,prefPaths:dD,name:e.category.title}),[i,a]=Un.useState(!1),[o,r]=Un.useState(!1),l=Boolean(navigator.userAgentData);return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsxs)(Vy.Z,{categoryTitle:(0,W.Z)("Network"),filter:e.filter,children:[(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Proxies")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Proxy Settings"),onClick:()=>{re.Z.utilities.launchNetworkSettings(t.vivaldiWindowId)}})})]}),l&&(0,zn.jsxs)("div",{className:"setting-group setting-group-double brand-masking",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("User Agent Brand Masking")}),(0,zn.jsxs)("p",{className:"info",children:[(0,W.Z)("This setting is intended for debugging websites by updating the Sec-CH-UA browser identity HTTP header. Changes may cause site compatibility issues.")," ",(0,W.Z)("This setting requires a restart to take full effect.")]}),(0,zn.jsx)("div",{children:(0,zn.jsxs)("label",{className:"stack-column",children:[(0,zn.jsx)("span",{children:(0,W.Z)("Report Browser Brand as")}),(0,zn.jsxs)(Fa.Z,{value:s[Z.kVivaldiClientHintsBrand].toString(),onChange:lD(Z.kVivaldiClientHintsBrand),children:[(0,zn.jsx)("option",{value:"0",children:(0,W.Z)("No Brand")}),(0,zn.jsx)("option",{value:"1",children:(0,W.Z)("Vivaldi")}),(0,zn.jsx)("option",{value:"2",children:(0,W.Z)("Custom")}),(0,zn.jsx)("option",{value:"3",children:(0,W.Z)("Google Chrome")}),(0,zn.jsx)("option",{value:"4",children:(0,W.Z)("Microsoft Edge")})]})]})}),(0,zn.jsx)("div",{className:"setting-single pad-top",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kVivaldiClientHintsBrandAppendVivaldi],onChange:lD(Z.kVivaldiClientHintsBrandAppendVivaldi),disabled:s[Z.kVivaldiClientHintsBrand]<2}),(0,zn.jsx)("span",{children:(0,W.Z)("Append Vivaldi Brand")})]})}),(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"text",value:s[Z.kVivaldiClientHintsBrandCustomBrand],onChange:e=>{const t=e.target.value;!cD.test(t)&&!t.includes('"')||""===t?(I.Z.set(Z.kVivaldiClientHintsBrandCustomBrand,t),i&&a(!1)):a(!0)},disabled:2!==s[Z.kVivaldiClientHintsBrand],maxLength:"50"}),(0,zn.jsx)("span",{children:(0,W.Z)("Custom Brand")})]}),i&&(0,zn.jsx)(fa,{type:"warning",children:(0,W.Z)("Brand is limited to 50 ASCII and punctuation characters except for a double quote.")})]}),(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"text",value:s[Z.kVivaldiClientHintsBrandCustomBrandVersion],onChange:e=>{const t=e.target.value;hD.test(t)||""===t?(I.Z.set(Z.kVivaldiClientHintsBrandCustomBrandVersion,t),o&&r(!1)):r(!0)},disabled:2!==s[Z.kVivaldiClientHintsBrand],maxLength:"20"}),(0,zn.jsx)("span",{children:(0,W.Z)("Custom Version")})]}),o&&(0,zn.jsx)(fa,{type:"warning",children:(0,W.Z)("Version is limited to 20 number or period characters.")})]}),(0,zn.jsxs)("div",{className:"setting-single pad-top",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Sec-CH-UA HTTP Header")}),(0,zn.jsx)("p",{children:(0,zn.jsx)("span",{className:"selectable",children:(()=>{const e=navigator.userAgentData?.brands.map((e=>`"${e.brand}";v="${e.version}"`)).join(",");return e??""})()})})]})]})]})}),n]})}const pD=Un.memo(uD),gD=[Z.kMailContactDefaultAction,Z.kMailSingleClickTabs,Z.kNotesCreationAddScreenshot,Z.kNotesCreationNotify,Z.kNotesCreationShowPanel,Z.kPanelsAsOverlayAutoClose,Z.kPanelsAsOverlayEnabled,Z.kPanelsLazyLoad,Z.kPanelsPosition,Z.kPanelsShowCloseButton,Z.kPanelsShowFolderBadge,Z.kPanelsShowToggle,Z.kPanelsTranslatePaste,Z.kPanelsTranslateRedirect,Z.kPanelsWindowDragToStack,Z.kPanelsWindowShowPinnedGroup,Z.kPanelsWindowShowUnread,Z.kPanelsWindowSingleClickOpens,Z.kReadingListPanelSingleClickOpens,Z.kReadingListShowCounter,Z.kPanelsWindowShowDuplicate,Z.kPanelsWindowShowInactive,Z.kPanelsWindowInactiveTabsDays],mD=I.Z.getEventHandler,fD=[...gD,Z.kFeaturesMail];var vD=(0,zn.jsx)("input",{type:"radio",value:"left"}),bD=(0,zn.jsx)("input",{type:"radio",value:"right"}),CD=(0,zn.jsx)("input",{type:"radio",value:"viewAllMessages"}),wD=(0,zn.jsx)("input",{type:"radio",value:"compose"});function yD(e){const t=(0,Eo.Z)(fD),s=nI({filter:e.filter,prefPaths:gD,name:e.category.title});return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsxs)(Vy.Z,{categoryTitle:(0,W.Z)("Panels"),filter:e.filter,children:[(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Panel Position")}),(0,zn.jsxs)(To.Z,{name:"panelPosition",value:t[Z.kPanelsPosition],onChange:mD(Z.kPanelsPosition),className:"group",children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[vD,(0,zn.jsx)("span",{children:(0,W.Z)("Left Side")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[bD,(0,zn.jsx)("span",{children:(0,W.Z)("Right Side")})]})})]})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Panel Options")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{title:(0,W.Z)("Display a panel toggle button along the side"),children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kPanelsShowToggle],onChange:mD(Z.kPanelsShowToggle)}),(0,zn.jsx)("span",{children:(0,W.Z)("Show Panel Toggle")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{title:(0,W.Z)("Overlay panel over browser content"),children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kPanelsAsOverlayEnabled],onChange:mD(Z.kPanelsAsOverlayEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("Floating Panel")})]})}),(0,zn.jsx)("div",{className:"setting-single pad-left",children:(0,zn.jsxs)("label",{title:(0,W.Z)("Automatically collapse panel upon losing focus"),children:[(0,zn.jsx)("input",{type:"checkbox",disabled:!t[Z.kPanelsAsOverlayEnabled],checked:t[Z.kPanelsAsOverlayAutoClose],onChange:mD(Z.kPanelsAsOverlayAutoClose)}),(0,zn.jsx)("span",{children:(0,W.Z)("Auto-Close Inactive Panel")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kPanelsShowCloseButton],onChange:mD(Z.kPanelsShowCloseButton)}),(0,zn.jsx)("span",{children:(0,W.Z)("Show Close Button")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kPanelsShowFolderBadge],onChange:mD(Z.kPanelsShowFolderBadge)}),(0,zn.jsx)("span",{children:(0,W.Z)("Show Folder Counters")})]})})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Web Panels")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{title:(0,W.Z)("Detect and display numeric notification from page title in Tabs and Web Panels"),children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kTabsCounterDetection],onChange:mD(Z.kTabsCounterDetection)}),(0,zn.jsx)("span",{children:(0,W.Z)("Detect Page Title Notifications")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{title:(0,W.Z)("Wait to Load Panels Until Activated"),children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kPanelsLazyLoad],onChange:mD(Z.kPanelsLazyLoad)}),(0,zn.jsx)("span",{children:(0,W.Z)("Lazy Load")})]})})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("title","Notes Panel")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{title:(0,W.Z)("Show panel content when adding a note from a page"),children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kNotesCreationShowPanel],onChange:mD(Z.kNotesCreationShowPanel)}),(0,zn.jsx)("span",{children:(0,W.Z)("Open Panel Automatically")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kNotesCreationNotify],onChange:mD(Z.kNotesCreationNotify)}),(0,zn.jsx)("span",{children:(0,W.Z)("Notify on Adding New Note")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{title:(0,W.Z)("Add a screenshot when adding a note from a page"),children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kNotesCreationAddScreenshot],onChange:mD(Z.kNotesCreationAddScreenshot)}),(0,zn.jsx)("span",{children:(0,W.Z)("Fetch Screenshot for New Notes")})]})})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("title","Windows Panel")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kPanelsWindowSingleClickOpens],onChange:mD(Z.kPanelsWindowSingleClickOpens)}),(0,zn.jsx)("span",{children:(0,W.Z)("Activate with Single Click")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kPanelsWindowShowPinnedGroup],onChange:mD(Z.kPanelsWindowShowPinnedGroup)}),(0,zn.jsx)("span",{children:(0,W.Z)("Pinned Folder")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kPanelsWindowDragToStack],onChange:mD(Z.kPanelsWindowDragToStack)}),(0,zn.jsx)("span",{children:(0,W.Z)("Create Tab Stack by Drag and Drop")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kPanelsWindowShowUnread],onChange:mD(Z.kPanelsWindowShowUnread)}),(0,zn.jsx)("span",{children:(0,W.Z)("Show Unread Tabs Badge")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kPanelsWindowShowDuplicate],onChange:mD(Z.kPanelsWindowShowDuplicate)}),(0,zn.jsx)("span",{children:(0,W.Z)("Show Duplicate Tabs")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kPanelsWindowShowInactive],onChange:mD(Z.kPanelsWindowShowInactive)}),(0,zn.jsx)("span",{children:(0,W.Z)("Show Inactive Tabs")})]})}),(0,zn.jsxs)("div",{className:"setting-single pad-left",children:[(0,zn.jsx)("span",{children:(0,W.Z)("Inactive for")}),(0,zn.jsx)(tI,{disabled:!t[Z.kPanelsWindowShowInactive],value:t[Z.kPanelsWindowInactiveTabsDays],min:1,max:90,step:1,onChange:mD(Z.kPanelsWindowInactiveTabsDays),label:(0,W.Z)("$1 day","$1 days",[t[Z.kPanelsWindowInactiveTabsDays]]),title:(0,W.Z)("Days inactive before showing in list")})]})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("title","Translate Panel")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kPanelsTranslateRedirect],onChange:mD(Z.kPanelsTranslateRedirect)}),(0,zn.jsx)("span",{children:(0,W.Z)("Use Panel Instead of Dialog")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kPanelsTranslatePaste],onChange:mD(Z.kPanelsTranslatePaste)}),(0,zn.jsx)("span",{children:(0,W.Z)("Translate when pasting text")})]})})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Reading List Panel")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kReadingListPanelSingleClickOpens],onChange:mD(Z.kReadingListPanelSingleClickOpens)}),(0,zn.jsx)("span",{children:(0,W.Z)("Activate with Single Click")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kReadingListShowCounter],onChange:mD(Z.kReadingListShowCounter)}),(0,zn.jsx)("span",{children:(0,W.Z)("Show Unread Counters")})]})})]}),t[Z.kFeaturesMail]&&(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("title","Contacts Panel")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kMailSingleClickTabs],onChange:mD(Z.kMailSingleClickTabs)}),(0,zn.jsx)("span",{children:(0,W.Z)("Activate with Single Click")})]})}),(0,zn.jsxs)("div",{className:"setting-single pad-top",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Default Contact Action")}),(0,zn.jsxs)(To.Z,{name:"contactDefaulAction",value:t[Z.kMailContactDefaultAction],onChange:mD(Z.kMailContactDefaultAction),className:"group",children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[CD,(0,zn.jsx)("span",{children:(0,W.Z)("View All Mail Messages")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[wD,(0,zn.jsx)("span",{children:(0,W.Z)("radio","Compose New Message")})]})})]})]})]})]})}),s]})}const xD=Un.memo(yD),ID=[Z.kAutofillProfileEnabled],AD=I.Z.getEventHandler,SD={guid:void 0,fields:[],languageCode:void 0,metadata:void 0},ZD="ADDRESS_HOME_COUNTRY",TD="ADDRESS_HOME_STREET_ADDRESS",ED="PHONE_HOME_WHOLE_NUMBER",kD="EMAIL_ADDRESS";class ND extends Un.PureComponent{static contextType=oi.Z;#v=!1;getAddressList=async()=>{n.Z.autofillPrivate.getAddressList((e=>{this.setState({addresses:e})}))};getAddressComponents=async()=>{this.state.countries.forEach((e=>{e.countryCode&&n.Z.autofillPrivate.getAddressComponents(e.countryCode).then((t=>{this.setState((s=>{s.addressComponents.set(e.countryCode??"",t)}))}))}))};getCountryList=async()=>{n.Z.autofillPrivate.getCountryList(!1,(e=>{this.setState({countries:e},(()=>this.getAddressComponents()))}))};constructor(e){super(e),this.state={addresses:[],countries:[],addressComponents:new Map,dialogVisible:"none",dialogAddress:SD}}async componentDidMount(){this.#v=!0,await this.getCountryList(),await this.getAddressList(),n.Z.autofillPrivate.onPersonalDataChanged.addListener((()=>{this.getAddressList()}))}componentWillUnmount(){this.#v=!1,n.Z.autofillPrivate.onPersonalDataChanged.removeListener((()=>{this.getAddressList()}))}handleInputChange(e,t){this.setState((s=>{const n=[...s.dialogAddress.fields];let i=!1;if(n.forEach((s=>{s.type===e&&(s.value=t,i=!0)})),!i){const s={type:e,value:t};n.push(s)}return{dialogAddress:{...s.dialogAddress,fields:n}}}))}showNewAddressDialog=()=>{const e=SD;if(this.state.countries[0].countryCode){const t={type:ZD,value:this.state.countries[0].countryCode};e.fields.push(t)}this.setState({dialogVisible:"new",dialogAddress:e})};showEditAddressDialog=e=>{this.setState({dialogVisible:"edit",dialogAddress:e})};handleOnCloseDialog=()=>{this.setState({dialogVisible:"none",dialogAddress:SD})};saveAddressAndCloseDialog=()=>{n.Z.autofillPrivate.saveAddress(this.state.dialogAddress),this.handleOnCloseDialog()};deleteAddressAndCloseDialog=()=>{"edit"===this.state.dialogVisible&&this.state.dialogAddress.guid&&n.Z.autofillPrivate.removeAddress(this.state.dialogAddress.guid),this.handleOnCloseDialog()};renderAddress=e=>{const t=new Map;e.fields.forEach((e=>t.set(e.type,e.value)));const s=t.get(ZD),n=this.state.countries.find((e=>e.countryCode===s))?.name||"",i=t.get("NAME_FULL")||t.get("COMPANY_NAME"),a=t.get(TD);return s&&n?(0,zn.jsxs)("div",{className:"CardDisplay Address",children:[i&&(0,zn.jsx)("strong",{children:i}),[a,n].filter(Boolean).join(", "),(0,zn.jsx)("button",{className:"CardDisplay-Edit",value:(0,W.Z)("Edit Address"),onClick:()=>this.showEditAddressDialog(e),children:"•••"})]},e.guid):null};renderEditDialogFields=()=>{const e=new Map;this.state.dialogAddress.fields.forEach((t=>e.set(t.type,t.value)));const t=e.get(ZD);if(!t)return null;const s=this.state.addressComponents.get(t),n=e.get(ED),i=e.get(kD);return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("div",{className:"dialog-row",children:(0,zn.jsx)("div",{className:"dialog-column",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("p",{children:(0,W.Z)("Country")}),(0,zn.jsx)(Fa.Z,{name:"countryCode",value:t,onChange:e=>{this.handleInputChange(ZD,e.target.value)},autoFocus:!0,children:this.state.countries.filter((e=>e.name&&e.countryCode)).map(((e,t)=>(0,zn.jsx)("option",{value:e.countryCode,children:(0,W.Z)("$1",[e.name||""])},t)))})]})})}),s&&s.components.map(((t,s)=>(0,zn.jsx)("div",{className:"dialog-row",children:t.row.map(((t,s)=>{const n=t.fieldName,i=e.get(t.field);return(0,zn.jsx)("div",{className:"dialog-column",children:n?(0,zn.jsxs)("label",{children:[(0,zn.jsx)("p",{children:n}),t.field===TD?(0,zn.jsx)("textarea",{rows:3,value:i||"",onChange:e=>this.handleInputChange(t.field,e.target.value)}):(0,zn.jsx)("input",{type:"text",value:i||"",onChange:e=>this.handleInputChange(t.field,e.target.value)})]}):null},s)}))},s))),(0,zn.jsxs)("div",{className:"dialog-row",children:[(0,zn.jsx)("div",{className:"dialog-column",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("p",{children:(0,W.Z)("Phone")}),(0,zn.jsx)("input",{type:"text",value:n||"",onChange:e=>this.handleInputChange(ED,e.target.value)})]})}),(0,zn.jsx)("div",{className:"dialog-column",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("p",{children:(0,W.Z)("Email")}),(0,zn.jsx)("input",{type:"email",value:i||"",onChange:e=>this.handleInputChange(kD,e.target.value)})]})})]})]})};render(){const e="none"!==this.state.dialogVisible;return(0,zn.jsxs)(zn.Fragment,{children:[e&&(0,zn.jsx)(Ha.Z,{onRequestClose:this.handleOnCloseDialog,className:"float address",ignoreClickOutside:!0,children:(0,zn.jsxs)("form",{children:[(0,zn.jsx)("div",{className:"dialog-header",children:(0,zn.jsx)("h1",{children:"new"===this.state.dialogVisible?(0,W.Z)("Add Address"):(0,W.Z)("Edit Address")})}),(0,zn.jsx)("div",{className:"dialog-content",children:this.renderEditDialogFields()}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"submit",onClick:this.saveAddressAndCloseDialog,value:(0,W.Z)("Save")}),"edit"===this.state.dialogVisible&&(0,zn.jsx)("input",{type:"button",className:"danger",onClick:this.deleteAddressAndCloseDialog,value:(0,W.Z)("verb","Delete")}),(0,zn.jsx)("input",{type:"button",onClick:this.handleOnCloseDialog,value:(0,W.Z)("Cancel")})]})]})}),(0,zn.jsx)(Vy.Z,{categoryTitle:(0,W.Z)("Addresses and More"),filter:this.props.filter,children:(0,zn.jsxs)("div",{className:"setting-group unlimited",children:[(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.props.prefValues[Z.kAutofillProfileEnabled],onChange:AD(Z.kAutofillProfileEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("Save and Fill Addresses")})]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Includes information such as phone numbers, email addresses and delivery addresses")})]}),(0,zn.jsxs)("div",{className:"setting-single pad-top",children:[this.state.addresses.length>0&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Saved Addresses")}),(0,zn.jsx)("div",{children:this.state.addresses.map((e=>this.renderAddress(e)))})]}),(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Add New Address"),disabled:!this.props.prefValues[Z.kAutofillProfileEnabled],onClick:this.showNewAddressDialog})]})]})})]})}}const _D=(0,zd.Z)(ND,ID),PD="https://downloads.vivaldi.com/",MD={"bb9915f1-2e78-4fa2-9c84-b5022e7b0b09":"DuckDuckGo Tracker Radar","18d85f61-147a-4aa6-aa6d-607f5ef79eef":"EasyPrivacy","8bef4dce-11b7-4452-8055-80eae7939dfb":"EasyList","3b9a77ec-f9cc-4626-ace3-bd2e2d679d4c":"ABP anti-circumvention list","bbf1b5e9-5adf-4b83-abaf-88adc681dcdf":"AdBlock Warning Removal List","9c67efc8-09e5-4e70-b525-fb8c147fb2c2":(0,W.Z)("Allow ads from our partners (support Vivaldi)"),"78610306-e2ab-4147-9a10-fb6072e6675e":(0,W.Z)("Remove cookie warnings ($1)",["Easylist Cookie List"]),"269f589f-0a17-4158-a961-ee5252120dad":(0,W.Z)("Remove annoyances, can break sites ($1)",["Fanboy's Annoyance List"]),"01b357a7-eddb-4dce-9c3f-4e90099bbfcd":(0,W.Z)("Arabic ($1)",["Liste AR"]),"e5d554e9-8249-47c1-abf8-004cd29f4172":(0,W.Z)("Bulgarian ($1)",["Bulgarian List"]),"439f5af1-9c74-4606-9b9e-b46863ac611c":(0,W.Z)("Chinese ($1)",["EasyList China"]),"923b5982-519e-4c7f-9854-3bd354b368b8":(0,W.Z)("Chinese ($1)",["CJX’s Annoyance List"]),"d0b816af-f803-4efa-9b8b-39bd1a0d5c75":(0,W.Z)("Colombian ($1)",["Colombian List by Yecarrillo"]),"5c9b517d-5182-401a-aee6-ae32414ca708":(0,W.Z)("Czech and Slovak ($1)",["Czech and Slovak filter list"]),"acf379b6-2c46-4802-88c9-6dd46bedfb32":(0,W.Z)("Dutch ($1)",["EasyList Dutch"]),"9c486dda-1589-4886-a40c-1be6484eb43d":(0,W.Z)("English ($1)",["Peter Lowe’s List"]),"288bb849-ca3b-4a6c-8c26-8f0f41e88af7":(0,W.Z)("Estonian ($1)",["Eesti saitidele kohandatud filter"]),"d8d2b8a5-f918-4a5f-b03c-0ee921aec48f":(0,W.Z)("Estonian ($1)",["Filters by Gurud.ee"]),"0979cdbb-6581-4f56-a57b-f7dc16fb47f8":(0,W.Z)("Farsi ($1)",["AdBlock Farsi"]),"c43fb9ca-bf75-4f07-ad52-1c79cd67a454":(0,W.Z)("Finnish ($1)",["EasyList Finland"]),"9be6251e-631e-4177-abec-d5dbef6be4f7":(0,W.Z)("French ($1)",["Liste FR"]),"933d897d-cb29-4282-a4f9-2451d83d1885":(0,W.Z)("German ($1)",["EasyList Germany"]),"9cc5cd12-945e-4948-8ae4-266a21c9165c":(0,W.Z)("Greek ($1)",["void.gr"]),"22263ec8-d105-418a-a187-36f5c9808dcf":(0,W.Z)("Hebrew ($1)",["EasyList Hebrew"]),"5ec4c886-a4b7-4fd4-9654-a7a138bf74bf":(0,W.Z)("Hungarian ($1)",["hufilter"]),"9bd24163-31fe-4889-b7e3-99e5bf742150":(0,W.Z)("Icelandic ($1)",["Icelandic ABP List"]),"98ed727f-d9c0-4bc6-bded-19b14b52d167":(0,W.Z)("Indian ($1)",["Indian List"]),"f7bc721e-5cd1-440c-8036-50813c063929":(0,W.Z)("Indonesian ($1)",["ABPindo"]),"53e46eb7-be5f-41b7-994c-d3155fc2025e":(0,W.Z)("Italian ($1)",["X Files"]),"364fff45-270d-4a62-a449-982856057678":(0,W.Z)("Italian ($1)",["EasyList Italy"]),"2450843a-66fb-4e8c-9c65-bdc530623690":(0,W.Z)("Japanese ($1)",["ABP Japanese filters"]),"88f940b8-990c-4caa-abff-bcdb0bfd9276":(0,W.Z)("Japanese ($1)",["もちフィルタ（広告ブロック）"]),"366ed9e8-aa6e-4fd2-b3ff-bdc151f48fa9":(0,W.Z)("Japanese ($1)",["たまごフィルタ（mobile filter）"]),"629f497d-0660-4b7d-8c82-afaf89345681":(0,W.Z)("Korean ($1)",["Korean List"]),"aa16a0f8-9ecf-40c1-9062-d72c153145af":(0,W.Z)("Korean ($1)",["YousList"]),"1810bcfd-dad7-4c42-82bb-0fc33ebe7892":(0,W.Z)("Latvian ($1)",["Latvian List"]),"4f1dbb65-d152-46c8-81db-b5f2cd6d66d5":(0,W.Z)("Lithuanian ($1)",["EasyList Lithuania"]),"a93efa90-ebea-4df2-a1a4-972445bc6d0f":(0,W.Z)("Nordic ($1)",["Dandelion Sprout’s Nordic Filters"]),"ef6d3c42-e166-4901-9b03-58f124fbebf3":(0,W.Z)("Polish ($1)",["EasyList Polish"]),"b1d9732d-c0f3-4c74-8596-e1518b42b356":(0,W.Z)("Portuguese ($1)",["EasyList Portuguese"]),"434d57a1-51ac-480f-a5af-cc1c127f0313":(0,W.Z)("Romanian ($1)",["ROLIST"]),"a3d2a41d-6659-4465-9819-ba8317185118":(0,W.Z)("Russian ($1)",["RU AdList"]),"3eae7230-473c-4ccd-a15f-f08e4bb86f71":(0,W.Z)("Spanish ($1)",["EasyList Spanish"]),"c29c4544-679b-4335-94f2-b27c7d099803":(0,W.Z)("Turkish ($1)",["Fanboy’s Turkish"]),"092a3a7f-b452-47e2-bbd7-b61e902ad0fd":(0,W.Z)("Vietnamese ($1)",["ABPVN List"])};const DD={width:500,minWidth:"unset"},OD={success:(0,W.Z)("Fetched successfully"),download_failed:(0,W.Z)("Failed to download"),file_not_found:(0,W.Z)("File cannot be located"),file_read_error:(0,W.Z)("File cannot be read"),file_unsupported:(0,W.Z)("Invalid format"),failed_saving_parsed_rules:(0,W.Z)("Cannot save to the profile"),unknown:(0,W.Z)("Fetch not completed")},jD={allowSnippets:!1,pureHost:!0,documentAllow:!0};var LD=(0,zn.jsx)("br",{}),RD=(0,zn.jsx)("br",{});class BD extends Un.PureComponent{static contextType=oi.Z;fileInput=Un.createRef();state={blockerSources:[],sortedList:[],cachedSource:void 0,newSource:"",showEditor:0,importError:"",...jD};componentDidMount(){this.updateSources(),re.Z.contentBlocking.onRuleSourceUpdated.addListener(this.updateSources),re.Z.contentBlocking.onRuleSourceDisabled.addListener(this.updateSources),re.Z.contentBlocking.onRuleSourceEnabled.addListener(this.updateSources)}componentWillUnmount(){re.Z.contentBlocking.onRuleSourceUpdated.removeListener(this.updateSources),re.Z.contentBlocking.onRuleSourceDisabled.removeListener(this.updateSources),re.Z.contentBlocking.onRuleSourceEnabled.removeListener(this.updateSources)}updateSources=()=>{re.Z.contentBlocking.getRuleSources(this.props.ruleGroup,(e=>{this.setState({blockerSources:e,sortedList:this.remapSources(e)})})),this.state.cachedSource&&this.updateCachedSource()};updateCachedSource=()=>{this.state.cachedSource&&re.Z.contentBlocking.getRuleSource(this.props.ruleGroup,this.state.cachedSource.id,(e=>{if("unknown"!==e.last_fetch_result)return"success"!==e.last_fetch_result?(this.state.cachedSource&&this.removeSource(this.state.cachedSource.id),void this.setState({cachedSource:void 0,showEditor:1,importError:OD[e.last_fetch_result],...jD})):void this.setState({cachedSource:e,allowSnippets:e.settings.allow_abp_snippets,pureHost:e.settings.naked_hostname_is_pure_host,documentAllow:e.settings.use_whole_document_allow,showEditor:3,importError:""})}))};remapSources=e=>{if(e){return e.map(((e,t)=>{const s=e.unsafe_adblock_metadata,n=(i=e.preset_id,MD[i]);var i;const a=e.is_from_url?e.source_url:e.source_file,o=void 0!==n?n:s.title?s.title:a;return{key:e.id.toString(),name:o,isDefault:e.source_url.startsWith(PD),enabled:e.loaded,id:e.id}})).sort(((e,t)=>e.name<t.name?-1:1)).sort(((e,t)=>e.isDefault&&!t.isDefault?-1:1))}return[]};updateNewSource=e=>{const{value:t}=e.currentTarget;this.setState({newSource:t})};onImportFromFile=e=>re.Z.utilities.selectFile({windowId:this.context.vivaldiWindowId,title:(0,W.Z)("Select a Blocker List Text File"),type:"file",accepts:[{ext:"txt"}]}).then((e=>{e&&this.importFromFile(e)}));importFromFile=e=>{re.Z.contentBlocking.addKnownSourceFromFile(this.props.ruleGroup,e,{allow_abp_snippets:this.state.allowSnippets,naked_hostname_is_pure_host:this.state.pureHost,use_whole_document_allow:this.state.documentAllow},(e=>this.finishImport(e)))};importFromUrl=()=>{this.state.newSource.includes(PD)?this.setState({importError:(0,W.Z)("Failed to add internal list.")}):re.Z.contentBlocking.addKnownSourceFromURL(this.props.ruleGroup,this.state.newSource,{allow_abp_snippets:this.state.allowSnippets,naked_hostname_is_pure_host:this.state.pureHost,use_whole_document_allow:this.state.documentAllow},(e=>this.finishImport(e)))};finishImport=e=>{n.Z.runtime.lastError?(console.warn(Object.values(n.Z.runtime.lastError)),this.setState({cachedSource:void 0,importError:(0,W.Z)("Failed to add list")})):re.Z.contentBlocking.getRuleSource(this.props.ruleGroup,e,(e=>{this.setState({cachedSource:e,allowSnippets:e.settings.allow_abp_snippets,pureHost:e.settings.naked_hostname_is_pure_host,documentAllow:e.settings.use_whole_document_allow,showEditor:2,importError:""},(()=>{this.updateCachedSource()}))}))};onToggleStatus=e=>{this.state.sortedList[e]&&this.toggleStatus(this.state.sortedList[e].id)};toggleStatus=e=>{const t=this.state.blockerSources.find((t=>t.id===e));t&&(t.loaded?re.Z.contentBlocking.disableSource(this.props.ruleGroup,e):re.Z.contentBlocking.enableSource(this.props.ruleGroup,e))};editSource=e=>{const t=this.state.blockerSources.find((t=>e===t.id));t&&this.setState({cachedSource:t,allowSnippets:t.settings.allow_abp_snippets,pureHost:t.settings.naked_hostname_is_pure_host,documentAllow:t.settings.use_whole_document_allow,showEditor:4,importError:""})};copySource=e=>{const t=this.state.blockerSources.find((t=>e===t.id));if(t){const e=t.is_from_url?t.source_url:t.source_file;jc.Z.set(e)}};onRemoveSource=e=>{this.state.sortedList[e]&&this.removeSource(this.state.sortedList[e].id)};removeSource=e=>{re.Z.contentBlocking.deleteKnownSource(this.props.ruleGroup,e)};restoreSources=()=>{re.Z.contentBlocking.resetPresetSources(this.props.ruleGroup),this.updateSources()};onContextMenu=(e,t)=>{const s=this.state.sortedList[e];if(!s)return;const n=[{handler:this.copySource.bind(null,s.id),...(0,fi.Z)("Copy List Origin")},{handler:this.toggleStatus.bind(null,s.id),isVisible:()=>!s.enabled,...(0,fi.Z)("Enable List")},{handler:this.toggleStatus.bind(null,s.id),isVisible:()=>s.enabled,...(0,fi.Z)("Disable List")},{...st.Z.separatorItem,isVisible:()=>!s.isDefault},{handler:this.editSource.bind(null,s.id),isVisible:()=>!s.isDefault,...(0,fi.Z)("Edit List")},{handler:this.removeSource.bind(null,s.id),isVisible:()=>!s.isDefault,...(0,fi.Z)("Remove List")},{handler:this.restoreSources,isVisible:()=>"ad_blocking"===this.props.ruleGroup,...(0,fi.Z)("Restore Built-In Lists")}];(0,mi.Z)(this.context,n)(t)};showDialog=()=>{this.setState({showEditor:1})};onCancel=()=>{4!==this.state.showEditor&&this.state.cachedSource&&this.removeSource(this.state.cachedSource.id),this.closeDialog()};closeDialog=()=>{this.setState({cachedSource:void 0,newSource:"",importError:"",showEditor:0,...jD})};saveSettings=()=>{const{cachedSource:e,allowSnippets:t,pureHost:s,documentAllow:n}=this.state;e&&re.Z.contentBlocking.setKnownSourceSettings(this.props.ruleGroup,e.id,{allow_abp_snippets:t,naked_hostname_is_pure_host:s,use_whole_document_allow:n},(()=>{this.closeDialog(),this.updateSources()}))};renderOptions=()=>{const{cachedSource:e,allowSnippets:t,pureHost:s,documentAllow:n}=this.state;return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("div",{className:"dialog-row",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t,disabled:e?.loaded,onChange:()=>this.setState({allowSnippets:!t})}),(0,zn.jsx)("span",{children:(0,W.Z)("Allow List to Use ABP Snippet Rules")})]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("ABP snippet rules can be misused for malicious script injection.")}),this.state.allowSnippets&&(0,zn.jsx)(fa,{type:"warning",children:(0,W.Z)("Make sure you trust the author of the list.")})]}),(0,zn.jsxs)("div",{className:"dialog-row",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s,disabled:e?.loaded,onChange:()=>this.setState({pureHost:!s})}),(0,zn.jsx)("span",{children:(0,W.Z)("Treat Plain Hostnames as a Pure Hostname Rule")})]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Disable this if the rule list expects to match hostnames in any part of the URL.")})]}),(0,zn.jsxs)("div",{className:"dialog-row",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:n,disabled:e?.loaded,onChange:()=>this.setState({documentAllow:!n})}),(0,zn.jsx)("span",{children:(0,W.Z)("Rules that allow the document type cause all resources to be allowed for matching pages.")})]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("This is the ABP behavior for document rules. The uBlock behavior is active regardless of this setting.")})]})]})};renderDialog=()=>{const{cachedSource:e,showEditor:t}=this.state,s=e?e.unsafe_adblock_metadata:void 0,n=e&&e.loaded;return(0,zn.jsx)(Ha.Z,{style:DD,className:"float",onRequestClose:this.state.showEditor<2?this.onCancel:nr.Z,labelledBy:Ha.t,children:(0,zn.jsxs)("form",{className:"ContentBlocker-Import",children:[(0,zn.jsx)("header",{className:"dialog-header",children:(0,zn.jsx)("h1",{className:"dialog-title",id:Ha.t,children:4!==t?(0,W.Z)("Import New Blocker List"):(0,W.Z)("Edit Blocker List")})}),1===t&&(0,zn.jsxs)("div",{className:"dialog-content",children:[(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Enter URL to import blocker rules")}),(0,zn.jsxs)("div",{className:"dialog-row input",children:[(0,zn.jsx)("input",{type:"text",value:this.state.newSource,onChange:this.updateNewSource,autoFocus:!0}),(0,zn.jsx)("label",{className:"button-toolbar",children:(0,zn.jsx)("button",{className:"FormButton",type:"button",title:(0,W.Z)("Import from a file..."),dangerouslySetInnerHTML:{__html:Kn._TQ.small},onClick:this.onImportFromFile})})]}),this.renderOptions()]}),e&&2===t&&(0,zn.jsx)("div",{className:"dialog-content",children:(0,zn.jsx)("h3",{children:(0,W.Z)("Loading...")})}),e&&3===t&&(0,zn.jsxs)("div",{className:"dialog-content",children:[s?.title&&(0,zn.jsx)("h3",{children:s.title}),(0,zn.jsx)("p",{className:"info",children:e.source_url}),(0,zn.jsxs)("p",{children:[(0,W.Z)("Valid rules: $1",[e.rules_info.valid_rules]),LD,(0,W.Z)("Invalid rules: $1",[e.rules_info.invalid_rules]),RD,(0,W.Z)("Unsupported rules: $1",[e.rules_info.unsupported_rules])]})]}),e&&4===t&&(0,zn.jsxs)("div",{className:"dialog-content",children:[n&&(0,zn.jsx)(fa,{type:"info",children:(0,W.Z)("Please disable the source list before editing.")}),(0,zn.jsxs)("p",{children:[(0,W.Z)("Source:")," ",e.source_url||e.source_file]}),this.renderOptions()]}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[this.state.importError&&(0,zn.jsx)("p",{className:"info",children:this.state.importError}),(1===t||2===t)&&(0,zn.jsx)("input",{type:"submit",onClick:this.importFromUrl,value:(0,W.Z)("Import...")}),3===t&&(0,zn.jsx)("input",{type:"submit",onClick:this.closeDialog,value:(0,W.Z)("blocker","Done"),autoFocus:!0}),4===t&&(0,zn.jsx)("input",{type:"submit",onClick:this.saveSettings,disabled:e?.loaded,value:(0,W.Z)("blocker","Save"),autoFocus:!0}),(0,zn.jsx)("input",{type:"button",onClick:this.onCancel,value:(0,W.Z)("Cancel")})]})]})})};renderItem=(e,t)=>{const s=this.state.blockerSources.find((e=>t.id===e.id));return s?(0,zn.jsxs)("div",{className:"ContentBlocker-SourceItem",children:[(0,zn.jsx)("input",{type:"checkbox",onMouseDown:e=>e.stopPropagation(),checked:t.enabled,onChange:this.toggleStatus.bind(null,s.id)}),(0,zn.jsx)("span",{className:"title",children:e}),(0,zn.jsxs)("p",{className:"info",children:[""!==s.rules_list_checksum?(0,W.Z)("Updated on $1",[V()(s.last_update).format("lll")]):s.loaded?(0,W.Z)("Not fetched"):(0,W.Z)("Disabled"),s.is_fetching?" "+(0,W.Z)("(Fetching...)"):""]})]}):null};render(){const{sortedList:e}=this.state,t=Math.min(44*e.length+22,200);return(0,zn.jsxs)(zn.Fragment,{children:[0!==this.state.showEditor&&this.renderDialog(),(0,zn.jsx)("h3",{children:this.props.title}),(0,zn.jsx)("div",{className:"ContentBlocker-Sources",style:{minHeight:t},children:(0,zn.jsx)(Hy.Z,{items:e,renderListItem:this.renderItem,filter:this.props.filter,onActivate:this.onToggleStatus,onContextMenu:this.onContextMenu,onCreateItem:this.showDialog,onRemove:this.onRemoveSource,addTipString:(0,W.Z)("Add List"),deleteTipString:(0,W.Z)("Remove List"),supportDragAndDrop:!1})})]})}}const FD=BD;var WD=s(96405);const UD=[Z.kPrivacyAdBlockerEnableDocumentBlocking],VD=I.Z.getEventHandler,HD=["tracking","ad_blocking"],GD={width:500,minWidth:"unset"};function KD(e){const t=(0,Eo.Z)(UD),s=Un.useContext(oi.Z),n=Un.useRef(),i=Un.useRef(),[a,o]=Un.useState(void 0),[r,l]=Un.useState([]),[d,c]=Un.useState(!1),[h,u]=Un.useState(!1),[p,g]=Un.useState({name:"",level:"2"}),[m,f]=Un.useState(!1),[v,b]=Un.useState(!1),[C,w]=Un.useState(!1),y=Un.useCallback((()=>re.Z.contentBlocking.getAllExceptionLists((e=>{const t=Object.values(e).reduce(((e,t)=>e.concat(t.exempt_list).concat(t.process_list)),[]),s=T((0,WD.Z)(t).sort());o(e),l(s)}))),[]),x=Un.useCallback((()=>HD.forEach((e=>(0,Ev.pg)(e,(e=>{"boolean"==typeof e.trackerBlockingEnabled&&c(e.trackerBlockingEnabled),"boolean"==typeof e.adBlockingEnabled&&u(e.adBlockingEnabled),y()}))))),[y]);Un.useEffect((()=>(x(),y(),re.Z.contentBlocking.onExceptionsChanged.addListener(y),re.Z.contentBlocking.onStateChanged.addListener(x),()=>{re.Z.contentBlocking.onExceptionsChanged.removeListener(y),re.Z.contentBlocking.onStateChanged.removeListener(x)})),[x,y]);const I=e=>{const{value:t}=e.target;switch(t){case"0":re.Z.contentBlocking.setActiveExceptionsList("tracking","process_list"),re.Z.contentBlocking.setActiveExceptionsList("ad_blocking","process_list");break;case"1":re.Z.contentBlocking.setActiveExceptionsList("tracking","exempt_list"),re.Z.contentBlocking.setActiveExceptionsList("ad_blocking","process_list");break;case"2":re.Z.contentBlocking.setActiveExceptionsList("tracking","exempt_list"),re.Z.contentBlocking.setActiveExceptionsList("ad_blocking","exempt_list")}x()},A=e=>{if("number"==typeof e&&r){const t=r[e].key;["tracking","ad_blocking"].forEach((e=>["process_list","exempt_list"].forEach((s=>re.Z.contentBlocking.removeExceptionForDomain(e,s,t))))),y()}},S=()=>{["tracking","ad_blocking"].forEach((e=>["process_list","exempt_list"].forEach((t=>re.Z.contentBlocking.removeAllExceptions(e,t))))),y()},T=e=>e?e.map((e=>({key:e,name:e}))):[],E=e=>{const t=e.currentTarget;"name"===t.name?g((e=>({...e,name:t.value}))):g((e=>({...e,level:t.value})))},k=()=>{g((e=>({...e,name:""}))),f(!1),w(!1)},N=()=>{const e=(0,Ar.Ph)((0,Ar.Qj)(p.name));e?((0,Ev.fs)(e,p.level),k()):w(!0)},_=e=>{const{name:t,value:s}=e.target,n=fe.ZP.isSettings(fe.ZP.getActiveWindowId())?void 0:Ze.ZP.getActivePage(fe.ZP.getLastActiveBrowserWindowId())?.id;(0,Ev.fs)(t,s,n)},P=0+(d?1:0)+(h?1:0);return(0,zn.jsxs)(Vy.Z,{categoryTitle:(0,W.Z)("title","Tracker and Ad Blocking"),"data-anchor":"tracker_and_ad_blocking",filter:e.filter,children:[m&&(0,zn.jsx)(Ha.Z,{style:GD,onRequestClose:k,className:"float",title:(0,W.Z)("Add a New Site to Exception List"),children:(0,zn.jsxs)("form",{className:"ContentBlocker-Exception",children:[(0,zn.jsxs)("div",{className:"dialog-content",children:[(0,zn.jsx)("input",{type:"text",name:"name",placeholder:(0,W.Z)("e.g. example.com"),value:p.name,onChange:E,autoFocus:!0}),C&&(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Enter a valid domain name excluding the protocol")}),(0,zn.jsxs)(Fa.Z,{value:p.level,onChange:E,name:"level",children:[(0,zn.jsx)("option",{value:"0",children:(0,W.Z)("No Blocking")}),(0,zn.jsx)("option",{value:"1",children:(0,W.Z)("Block Trackers")}),(0,zn.jsx)("option",{value:"2",children:(0,W.Z)("Block Trackers and Ads")})]})]}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"submit",className:"primary",onClick:N,value:(0,W.Z)("other","Add Site")}),(0,zn.jsx)("input",{type:"button",onClick:k,value:(0,W.Z)("Cancel")})]})]})}),(0,zn.jsxs)("div",{className:"ContentBlocker-Rules",children:[(0,zn.jsxs)("div",{className:"setting-group setting-group-double",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Blocking Level")}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Select default level of protection.")}),(0,zn.jsxs)("label",{className:Gn()({"ContentBlocker-Setting":!0,"ContentBlocker-Setting--Active":0===P}),children:[(0,zn.jsx)("button",{value:"0",title:(0,W.Z)("No content blocking will be applied to any site by default."),onClick:I,className:"ContentBlocker-Control",style:{"--no-blocking":1,"--base":0},dangerouslySetInnerHTML:{__html:Kn.Tu3}}),(0,zn.jsx)("span",{className:"keep-ea-words",children:(0,W.Z)("No Blocking")})]}),(0,zn.jsxs)("label",{className:Gn()({"ContentBlocker-Setting":!0,"ContentBlocker-Setting--Active":1===P}),children:[(0,zn.jsx)("button",{value:"1",title:(0,W.Z)("Online trackers collect personal information and browsing habits across multiple sites."),onClick:I,className:"ContentBlocker-Control",style:{"--trackers":1},dangerouslySetInnerHTML:{__html:Kn.Tu3}}),(0,zn.jsx)("span",{className:"keep-ea-words",children:(0,W.Z)("Block Trackers")})]}),(0,zn.jsxs)("label",{className:Gn()({"ContentBlocker-Setting":!0,"ContentBlocker-Setting--Active":2===P}),children:[(0,zn.jsx)("button",{value:"2",title:(0,W.Z)("Web advertisement supports existence of many sites but can also be used to build a personal profile for monetization."),onClick:I,className:"ContentBlocker-Control",style:{"--ads":1},dangerouslySetInnerHTML:{__html:Kn.Tu3}}),(0,zn.jsx)("span",{className:"keep-ea-words",children:(0,W.Z)("Block Trackers and Ads")})]})]}),(0,zn.jsxs)("div",{className:"setting-group setting-group-double",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Exceptions")}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Manage blocking level per site")}),r&&(0,zn.jsx)("div",{className:"ContentBlocker-Exceptions",children:(0,zn.jsx)(Hy.Z,{ref:i,items:r,renderListItem:(e,t)=>{if(!t)return null;const s=(e=>{if(!a)return;let t=0;return!a.tracking.process_list.includes(e)&&a.tracking.exempt_list.includes(e)||t++,!a.ad_blocking.process_list.includes(e)&&a.ad_blocking.exempt_list.includes(e)||t++,t})(t.key);return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("span",{children:e}),(0,zn.jsxs)("select",{value:s,name:t.name,onMouseDown:e=>e.stopPropagation(),onChange:_,tabIndex:"-1",children:[(0,zn.jsx)("option",{value:"0",children:(0,W.Z)("No Blocking")}),(0,zn.jsx)("option",{value:"1",children:(0,W.Z)("Block Trackers")}),(0,zn.jsx)("option",{value:"2",children:(0,W.Z)("Block Trackers and Ads")})]})]})},filter:e.filter,onContextMenu:(e,t)=>{const n=[{handler:A.bind(null,e),...(0,fi.Z)("Remove Site")},{handler:S,...(0,fi.Z)("Remove All Sites from List")}];(0,mi.Z)(s,n)(t)},onCreateItem:()=>f(!0),onRemove:A,addTipString:(0,W.Z)("Add Site Exception"),deleteTipString:(0,W.Z)("Remove Site Exception"),supportDragAndDrop:!1,onSelectItem:e=>{const{HTMLSelectElement:t}=s,a=i.current?.refItems.current?.children;if(!a||0===a.length)return;const o=a[e].children[1];o instanceof t&&(n.current=o)},onActivate:(e,t)=>{t.target!==n.current&&n.current?.focus()}})}),(0,zn.jsx)("input",{type:"button",value:v?(0,W.Z)("Hide Sources"):(0,W.Z)("Manage Sources"),onClick:()=>b((e=>!e))})]}),v&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kPrivacyAdBlockerEnableDocumentBlocking],onChange:VD(Z.kPrivacyAdBlockerEnableDocumentBlocking)}),(0,zn.jsx)("span",{children:(0,W.Z)("Strict blocking")})]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Allow blocking rules to block certain web pages.")})]}),(0,zn.jsx)("div",{className:"setting-group setting-group-double",children:(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(FD,{filter:e.filter,ruleGroup:"tracking",title:(0,W.Z)("Tracker Blocking Sources")})})}),(0,zn.jsx)("div",{className:"setting-group setting-group-double",children:(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(FD,{filter:e.filter,ruleGroup:"ad_blocking",title:(0,W.Z)("Ad Blocking Sources")})})})]})]})]})}const zD=Un.memo(KD);class $D extends Un.PureComponent{refButton=Un.createRef();handleDelete=async e=>{(0,wi.ZP)(e),this.props.onDeleteCookie(this.props.domain)};handleDeleteCookie=async(e,t)=>{(0,wi.ZP)(e),this.props.onDeleteCookie(this.props.domain,t)};toggleDetail=()=>{this.props.viewCookies?(this.props.onCollapse(this.props.domain),this.props.onHideInfo(this.props.domain)):this.props.onExpand(this.props.domain)};showDetail=()=>{this.props.onExpand(this.props.domain)};hideDetail=()=>{this.props.onHideInfo(this.props.domain),this.props.onCollapse(this.props.domain)};handleRowClicked=e=>{this.refButton.current?.focus(),this.toggleDetail()};showInfo=e=>{this.props.onShowInfo(this.props.domain,e)};focusCookie=e=>{const t=e.currentTarget,s=this.refButton.current?.querySelectorAll("a");if(s?.length)switch(e.key){case"ArrowRight":let e=Array.from(s).indexOf(t)+1;e>=s.length&&(e=0),s[e].focus();break;case"ArrowLeft":const n=Array.from(s).indexOf(t)-1;n<0?(this.toggleDetail(),this.refButton.current?.focus()):s[n].focus()}};sameSitePolicy=e=>{switch(e){case"no_restriction":return(0,W.Z)("policy","no restriction");case"lax":return(0,W.Z)("policy","lax");case"strict":return(0,W.Z)("policy","strict");default:return(0,W.Z)("policy","unspecified")}};handleKeyDown=e=>{switch(e.key){case"Enter":(0,wi.ZP)(e),this.toggleDetail();break;case"ArrowRight":(0,wi.ZP)(e),this.props.viewCookies?this.focusCookie(e):this.showDetail();break;case"ArrowLeft":(0,wi.ZP)(e),this.focusCookie(e);break;case"Escape":(0,wi.ZP)(e),this.hideDetail(),this.refButton.current?.focus();break;case"Delete":(0,wi.ZP)(e),this.props.onDeleteCookie(this.props.domain,this.props.viewInfo);break;default:this.props.onKeyDown(e)}};renderCookies=()=>this.props.items.map((e=>(0,zn.jsxs)("a",{tabIndex:"0",onFocus:()=>this.showInfo(e),onKeyDown:this.handleKeyDown,title:e.name,children:[(0,zn.jsx)("span",{children:e.name}),(0,zn.jsx)("input",{type:"button",className:"circular clearkey",tabIndex:-1,title:(0,W.Z)("Delete cookie"),onMouseDown:wi.ZP,onClick:t=>this.handleDeleteCookie(t,e)})]},"cookie-"+e.name.toLowerCase())));renderInfo=()=>{if(!this.props.viewInfo)return null;const{expirationDate:e,hostOnly:t,httpOnly:s,name:n,partitionKey:i,path:a,sameSite:o,secure:r,session:l,storeId:d,value:c}=this.props.viewInfo,h=e?V()(Math.round(1e3*e)).format("L LT"):(0,W.Z)("unset");return(0,zn.jsxs)("dl",{children:[(0,zn.jsx)("dt",{children:(0,W.Z)("Name:")}),(0,zn.jsx)("dd",{className:"selectable",children:n}),(0,zn.jsx)("dt",{children:(0,W.Z)("Expires:")}),(0,zn.jsx)("dd",{className:"selectable",children:h}),(0,zn.jsx)("dt",{children:(0,W.Z)("Session:")}),(0,zn.jsx)("dd",{className:"selectable",children:l.toString()}),(0,zn.jsx)("dt",{children:(0,W.Z)("Path:")}),(0,zn.jsx)("dd",{className:"selectable",children:a}),(0,zn.jsx)("dt",{children:(0,W.Z)("Secure:")}),(0,zn.jsx)("dd",{className:"selectable",children:r.toString()}),(0,zn.jsx)("dt",{children:(0,W.Z)("Host Only:")}),(0,zn.jsx)("dd",{className:"selectable",children:t.toString()}),(0,zn.jsx)("dt",{children:(0,W.Z)("HTTP Only:")}),(0,zn.jsx)("dd",{className:"selectable",children:s.toString()}),(0,zn.jsx)("dt",{children:(0,W.Z)("Store ID:")}),(0,zn.jsx)("dd",{className:"selectable",children:d}),(0,zn.jsx)("dt",{children:(0,W.Z)("Same Site:")}),(0,zn.jsx)("dd",{className:"selectable",children:this.sameSitePolicy(o)}),i&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("dt",{children:(0,W.Z)("Partition Key:")}),(0,zn.jsx)("dd",{className:"selectable",children:i.topLevelSite})]}),(0,zn.jsx)("dt",{children:(0,W.Z)("Value:")}),(0,zn.jsx)("dd",{className:"selectable",children:unescape(c)})]})};render(){const{domain:e,index:t}=this.props,s=e.replace(/^\./,""),n=(0,Ar.q9)(s);return(0,zn.jsxs)("button",{id:e,ref:this.refButton,style:{...this.props.style,overflowY:this.props.viewCookies?"auto":"hidden"},onKeyDown:this.handleKeyDown,className:t%2==0?"even":"odd",children:[(0,zn.jsxs)("div",{className:"overview",onClick:this.handleRowClicked,children:[(0,zn.jsx)(Vn.ZP,{className:"site-icon",url:n,loadType:"page"}),(0,zn.jsx)("span",{className:"domain",children:e}),!this.props.viewCookies&&(0,zn.jsx)("span",{className:"count",children:this.props.count}),(0,zn.jsx)("span",{className:"controls",children:(0,zn.jsx)("input",{type:"button",className:"circular clearkey",tabIndex:-1,title:(0,W.Z)("Delete all domain cookies"),onClick:this.handleDelete})})]}),this.props.viewCookies&&(0,zn.jsxs)("div",{className:"detail",children:[this.renderCookies(),this.props.viewInfo&&(0,zn.jsx)("div",{className:"info",children:this.renderInfo()})]})]})}}const YD=$D;var XD=s(78330),QD=s(6489),qD=s(34155);const JD={width:400,minWidth:"unset"};class eO extends Un.PureComponent{static contextType=oi.Z;refList=Un.createRef();#Lt=Un.createRef();visibleCookies=new Map;state={cookieData:{},cookieFilter:"",confirmation:!1,showCookies:!1,domains:[],expandedItems:[]};componentDidMount(){n.Z.cookies.onChanged.addListener(this.cookieChangeListener),this.getAllCookies()}componentWillUnmount(){n.Z.cookies.onChanged.removeListener(this.cookieChangeListener)}cookieChangeListener=e=>{const{removed:t}=e;t&&this.debouncedGetAllCookies()};getAllCookies=async()=>{const e=(await n.Z.cookies.getAll({partitionKey:{}})).reduce(((e,t)=>{const s=e[t.domain]||[];return s.push(t),e[t.domain]=s,e}),{}),t=this.state.cookieFilter.toLowerCase();this.setState({cookieData:e,domains:Object.keys(e).filter((e=>e.includes(t))).sort()},(()=>{qD.nextTick((()=>{this.refList.current?.recomputeRowHeights(),this.refList.current?.forceUpdate()}))}))};debouncedGetAllCookies=(0,Te.Z)(this.getAllCookies);deleteFilteredCookies=async()=>{const e=await n.Z.cookies.getAll({});await Promise.all(e.map((e=>e.domain.toLowerCase().includes(this.state.cookieFilter.toLowerCase())?n.Z.cookies.remove({url:this.getCookieUrl(e),name:e.name}):Promise.resolve())))};deleteAllCookies=async()=>{const e=await n.Z.cookies.getAll({});await Promise.all(e.map((e=>n.Z.cookies.remove({url:this.getCookieUrl(e),name:e.name})))),this.setState({cookieData:{},confirmation:!1,showCookies:!1,domains:[]})};getButtons=()=>Array.from(this.context.document.querySelectorAll(".setting-group.setting-cookies button"));getCookieUrl=e=>"http"+(e.secure?"s":"")+"://"+e.domain+e.path;removeChromeEntry=async e=>{await n.Z.cookies.remove({url:this.getCookieUrl(e),name:e.name,partitionKey:e.partitionKey})};handleDeleteCookie=async(e,t)=>{const{cookieData:s}=this.state,n=s[e];t&&n.length>1?(this.focusNextCookie(e,t),await this.removeChromeEntry(t)):(this.collapseRow(e),qD.nextTick((()=>{const t=this.getButtons();if(t.length>1){const s=t.findIndex((t=>t.id===e));(t[s]??t[s-1])?.focus()}else this.#Lt.current?.focus();Promise.all(n.map(this.removeChromeEntry))})))};focusNextCookie=(e,t)=>{const s=this.getButtons().find((t=>t.id===e)),n=Array.from(s?.querySelectorAll("a")??[]),i=n.findIndex((e=>e.title===t.name));(n[i+1]??n[i-1]??n[0])?.focus()};onSettingsFilter=e=>{this.setState({cookieFilter:e.target.value},(()=>{Un.startTransition((()=>{const e=this.state.cookieFilter.toLowerCase();this.setState((t=>({domains:Object.keys(t.cookieData).filter((t=>t.includes(e))).sort()})))}))}))};onAskToDelete=()=>{this.setState({confirmation:!0})};onCancel=()=>{this.setState({confirmation:!1})};renderModal=()=>(0,zn.jsx)(Ha.Z,{style:JD,onRequestClose:this.onCancel,title:(0,W.Z)("Delete All Cookies?"),children:(0,zn.jsxs)("div",{className:"dialog-delete-cookies",children:[(0,zn.jsx)("div",{className:"dialog-content",children:(0,zn.jsx)("p",{children:(0,W.Z)("All cookies will be removed.")})}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"button",className:"primary",onClick:this.deleteAllCookies,value:(0,W.Z)("other","Delete"),autoFocus:!0}),(0,zn.jsx)("input",{type:"button",onClick:this.onCancel,value:(0,W.Z)("Cancel")})]})]})});showCookieList=()=>{this.setState((e=>({showCookies:!e.showCookies})))};handleKeyDown=e=>{const{HTMLAnchorElement:t}=this.context,s=e.currentTarget instanceof t?e.currentTarget.parentElement?.parentElement:e.currentTarget,n=this.getButtons();if(n?.length)switch(e.key){case"ArrowUp":(0,wi.ZP)(e);const i=Array.from(n).indexOf(s),a=e.currentTarget instanceof t?i:i-1;a>=0&&n[a].focus();break;case"Delete":case"ArrowDown":(0,wi.ZP)(e);const o=Array.from(n).indexOf(s)+1;o<n.length&&n[o].focus();break;default:return}};handleExpandRow=e=>{this.setState((t=>({expandedItems:t.expandedItems.concat([e])}))),this.refList.current?.recomputeRowHeights(),this.refList.current?.forceUpdate()};collapseRow=e=>{this.setState((t=>({expandedItems:t.expandedItems.filter((t=>t!==e))}))),this.refList.current?.recomputeRowHeights(),this.refList.current?.forceUpdate()};handleShowInfo=(e,t)=>{this.visibleCookies.set(e,t),this.refList.current?.recomputeRowHeights(),this.refList.current?.forceUpdate()};hideInfo=e=>{this.visibleCookies.delete(e),this.refList.current?.recomputeRowHeights(),this.refList.current?.forceUpdate()};getRowHeight=({index:e})=>{const t=this.state.domains[e];if(this.state.expandedItems.includes(t)){const e=this.refList.current?.props.width,s=e?Math.floor(e/120):1,n=1+Math.ceil(this.state.cookieData[t].length/s);return this.visibleCookies.get(t)?28*n+230:28*n}return 28};renderRow=({index:e,parent:t,key:s,style:n})=>{const{domains:i,expandedItems:a,cookieData:o}=this.state,r=i[e],l=o[r];return(0,zn.jsx)(YD,{style:n,domain:r,index:e,count:l.length,items:l,onKeyDown:this.handleKeyDown,onExpand:this.handleExpandRow,onCollapse:this.collapseRow,viewCookies:a.includes(r),viewInfo:this.visibleCookies.get(r),onShowInfo:this.handleShowInfo,onHideInfo:this.hideInfo,onDeleteCookie:this.handleDeleteCookie},s)};render(){if(!this.state.cookieData)return(0,zn.jsx)("div",{className:"saved-passwords",children:(0,zn.jsx)("p",{children:(0,W.Z)("No cookies found.")})});const{cookieData:e,cookieFilter:t,domains:s}=this.state,n=s.length,i=s.reduce(((t,s)=>t+e[s].length),0);return(0,zn.jsx)(tb.Z,{filter:this.props.filter,children:(0,zn.jsxs)("div",{className:"setting-group setting-cookies unlimited",style:{"--cookieWidth":"120px"},children:[this.state.confirmation&&this.renderModal(),(0,zn.jsx)("h3",{children:(0,W.Z)("Saved Cookies")}),(0,zn.jsx)("p",{children:(0,W.Z)("Vivaldi currently stores $1 cookie entry $2.","Vivaldi currently stores $1 cookie entries $2.",[i,(0,W.Z)("from $1 domain","from $1 domains",[n])])}),this.state.showCookies&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)("input",{type:"search",ref:this.#Lt,placeholder:(0,W.Z)("Filter by domain"),value:t,onChange:this.onSettingsFilter})}),0===n&&t&&(0,zn.jsx)("div",{className:"empty-cookie-items",children:(0,W.Z)("Query “$1” matches no result.",[t])}),(0,zn.jsx)("div",{className:"cookie-list",children:(0,zn.jsx)("div",{className:"setting-single cookie-items",children:(0,zn.jsx)(XD.q,{children:({height:e,width:t})=>(0,zn.jsx)(QD.a,{ref:this.refList,width:t,height:e,rowHeight:this.getRowHeight,rowRenderer:this.renderRow,rowCount:n})})})})]}),(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("input",{type:"button",value:this.state.showCookies?(0,W.Z)("Hide Saved Cookies"):(0,W.Z)("Show Saved Cookies"),disabled:0===i,onClick:this.showCookieList}),(0,zn.jsx)("input",{type:"button",className:"danger",onClick:this.onAskToDelete,disabled:0===i,value:(0,W.Z)("Delete All Cookies")}),t&&(0,zn.jsx)("input",{type:"button",onClick:this.deleteFilteredCookies,value:(0,W.Z)("Delete Filtered Cookies")})]})]})})}}const tO=eO,sO=[Z.kExceptionsCookies];function nO(e){const t=(0,Eo.Z)(sO),[s,n]=Un.useState(""),[i,a]=Un.useState("off");Un.useEffect((()=>{re.Z.utilities.getDefaultContentSettings("cookies",(e=>{n(e)})),re.Z.utilities.getBlockThirdPartyCookies((e=>{a(e)}))}),[]);const o=()=>Object.keys(t[Z.kExceptionsCookies]).filter((e=>e.startsWith("*,"))).map((e=>({key:e,name:e.replace("*,","")})),[]).sort(),r="block"===s,l=o();return(0,zn.jsxs)(Vy.Z,{categoryTitle:(0,W.Z)("Cookies"),filter:e.filter,"data-anchor":"cookies",children:[(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Manage default cookie policy in Global Website Permissions.")}),(0,zn.jsx)(tO,{filter:e.filter}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Third-Party Cookies")}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Disabling third party cookies might make some pages fail to work as intended.")}),(0,zn.jsxs)(To.Z,{className:"cookieSelection",name:"cookieSelGroup2",value:i,onChange:e=>{const t=e.target.value;re.Z.utilities.setBlockThirdPartyCookies(t,(e=>{})),a(t)},children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"radio",value:"off",disabled:r}),(0,zn.jsx)("span",{children:(0,W.Z)("radio","Allow All")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"radio",value:"BlockThirdPartyIncognitoOnly",disabled:r}),(0,zn.jsx)("span",{children:(0,W.Z)("radio","Block in Incognito Mode Only")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"radio",value:"BlockThirdParty",disabled:r}),(0,zn.jsx)("span",{children:(0,W.Z)("radio","Block All")})]})})]})]}),l.length>0&&(0,zn.jsxs)("div",{className:"setting-group setting-group-double",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Third Party Cookie Exceptions")}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Manage sites allowing third-party cookies.")}),(0,zn.jsx)(Hy.Z,{items:l,filter:e.filter,renderListItem:(e,t)=>(0,zn.jsx)("span",{children:e}),onRemove:e=>{const s=o()[e].key,n=structuredClone(t[Z.kExceptionsCookies]);delete n[s],Object.keys(n).length?I.Z.set(Z.kExceptionsCookies,n):I.Z.reset(Z.kExceptionsCookies)},deleteTipString:(0,W.Z)("Remove Domain"),supportDragAndDrop:!1})]})]})}const iO=Un.memo(nO);var aO=s(64136);const oO=(0,Te.Z)(((e,t)=>{(async function(e){const t=F.ZP.UI_LANGUAGE.substring(0,2),s=await fetch(`https://weather.vivaldi.com/cities/?geodata=1&lang=${t}&s=${e}`),n=await s.json();return n&&n.results?n.results.slice(0,14).map((e=>{const t=`${e.city}, ${e.admin_division1}, ${e.country}`;return{value:{name:t,latitude:e.latitude,longitude:e.longitude,timezone:e.timezone},label:t}})):[]})(e).then(t)}),500,{leading:!0});function rO(){return(0,W.Z)("Loading...")}function lO(){return(0,W.Z)("No options")}const dO={title:(0,W.Z)("title","Name"),latitude:(0,W.Z)("Latitude"),longitude:(0,W.Z)("Longitude"),emptyTitle:(0,W.Z)("Add your First Location Override"),emptyDescription:(0,W.Z)("Press the “Add” button on the bottom left to add a new Location Override.")},cO=GN.lE.map((e=>({label:e.value,key:e.key,local:e.local}))),hO=[...ie.z].map((e=>{const t=e.replace(/_/g," ");return{identifier:e,label:t}}));const uO=function({geolocation:e,applySearchLocation:t,changeTimezone:s,changeLocale:n,changeName:i,changeLat:a,changeLong:o}){if(!e)return null;const{name:r,lat:l,long:d}=e,c=cO.find((t=>t.key===e.locale))??cO[0],h=hO.find((t=>t.identifier===e.timezone))??hO[0];return(0,zn.jsx)("div",{className:"detail",children:(0,zn.jsxs)("div",{className:"detail-content",children:[(0,zn.jsx)("div",{className:"setting-section",children:(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{className:"floating-label",children:[(0,zn.jsx)("strong",{children:(0,W.Z)("Search for City Name")}),(0,zn.jsx)(aO.Z,{className:"VivaldiSelector",classNamePrefix:"Inner",placeholder:r!==gO?r:(0,W.Z)("Berlin, Germany"),loadOptions:oO,loadingMessage:rO,noOptionsMessage:lO,onChange:e=>{const s=e.value;t(s)},"aria-labelledby":"arialabel",menuPlacement:"auto"})]})})}),(0,zn.jsxs)("div",{className:"setting-section",children:[(0,zn.jsx)("h2",{children:(0,W.Z)("Location Override Details")}),(0,zn.jsxs)("div",{className:"setting-group setting-group",children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(Vr.Z,{type:"text",label:dO.title,value:r||"",onChange:e=>i(e.target.value)})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(Vr.Z,{type:"number",label:dO.latitude,value:l,max:CO,min:`-${CO}`,step:"0.00001",onChange:e=>a(e.target.value)})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(Vr.Z,{label:dO.longitude,type:"number",value:d,max:wO,min:`-${wO}`,step:"0.00001",onChange:e=>o(e.target.value)})})]}),(0,zn.jsxs)("div",{className:"setting-group setting-group",children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("div",{className:"floating-label",children:[(0,zn.jsx)("span",{children:(0,W.Z)("Timezone")}),(0,zn.jsx)(wZ.Z,{autoFocus:!1,commands:hO,isClearable:!1,isMulti:!1,openMenuOnFocus:!1,placeholder:`${(0,W.Z)("Filter Timezones")}...`,setSelectedItem:s,selectedCommand:h})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("div",{className:"floating-label",children:[(0,zn.jsx)("span",{children:(0,W.Z)("Locale")}),(0,zn.jsx)(wZ.Z,{autoFocus:!1,commands:cO,isClearable:!1,isMulti:!1,openMenuOnFocus:!1,placeholder:`${(0,W.Z)("Filter Locales")}...`,setSelectedItem:n,selectedCommand:c})]})})]})]})]})})},pO=[Z.kGeolocationAccuracy,Z.kGeolocationDefaultLocationId,Z.kGeolocationLatitude,Z.kGeolocationList,Z.kGeolocationLongitude,Z.kGeolocationUseOverride],gO=(0,W.Z)("location","My Location"),mO=vs.jk.settingCategories,fO=I.Z.getEventHandler,vO=52.52007,bO=13.404954,CO=90,wO=180,yO=e=>isFinite(e)&&Math.abs(e)<=CO,xO=e=>isFinite(e)&&Math.abs(e)<=wO,IO=e=>{const t=parseFloat(e+.0135*(2*Math.random()-1));return Number(t.toFixed(5))};function AO({filter:e,category:t}){const s=(0,Eo.Z)(pO),[n,i]=Un.useState(s[Z.kGeolocationList]),a=Un.useRef(0);Un.useEffect((()=>{I.Z.set(Z.kGeolocationList,n)}),[n]);const o=e=>{if(e>=0&&e<n.length){const t=vO,o=bO;a.current=e;let{lat:r,long:l,location_id:d}=n[e];const c=yO(r),h=xO(l);if(!c||!h){const s=(0,C.Uy)(n,(s=>{const n=s[e];if(!c){const e=Number(t);n.lat=e,r=e}if(!h){const e=Number(o);n.long=e,l=e}}));i(s)}s[Z.kGeolocationUseOverride]||I.Z.set(Z.kGeolocationUseOverride,!0),p({lat:r,long:l,location_id:d})}},r=e=>{const{name:t,latitude:s,longitude:o,timezone:r}=e,l=(0,C.Uy)(n,(e=>{const n={...e[a.current]};n.name=t,n.timezone=r,n.lat=IO(s),n.long=IO(o),e[a.current]=n}));i(l)},l=e=>{const t=(0,C.Uy)(n,(t=>{const s={...t[a.current]};s.name=e,t[a.current]=s}));i(t)},d=e=>{const t=(0,C.Uy)(n,(t=>{const s={...t[a.current]};let n=Number(e);yO(n)||(n=0),s.lat=n,t[a.current]=s}));i(t)},c=e=>{const t=(0,C.Uy)(n,(t=>{const s={...t[a.current]};let n=Number(e);xO(n)||(n=0),s.long=n,t[a.current]=s}));i(t)},h=e=>{const t=(0,C.Uy)(n,(t=>{const s={...t[a.current]};s.timezone=e.identifier,t[a.current]=s}));i(t)},u=e=>{const t=(0,C.Uy)(n,(t=>{const s={...t[a.current]};s.locale=e.key,t[a.current]=s}));i(t)},p=({location_id:e,lat:t,long:s})=>{I.Z.set(Z.kGeolocationDefaultLocationId,e),I.Z.set(Z.kGeolocationLatitude,t),I.Z.set(Z.kGeolocationLongitude,s)},g=t!==mO.all,m=(e,t)=>(0,zn.jsx)(uO,{geolocation:n[e],focusInput:g,searchableStrings:t,applySearchLocation:r,changeName:l,changeLat:d,changeLong:c,changeTimezone:h,changeLocale:u}),f=n.map(((e,t)=>({key:`${e.name}-${t}`,isDefault:!1,label:e.name,...e}))),v=s[Z.kGeolocationDefaultLocationId],b=n.findIndex((e=>e.location_id===v)).toString();return(0,zn.jsxs)(Vy.Z,{filter:e,categoryTitle:(0,W.Z)("Geolocation"),children:[(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Spoof and protect your geolocation with Location Override.")}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kGeolocationUseOverride],onChange:fO(Z.kGeolocationUseOverride)}),(0,zn.jsx)("span",{children:(0,W.Z)("radio","Enable Location Override")})]})}),(0,zn.jsx)("div",{className:"setting-single pad-left",children:(0,zn.jsx)(Fa.Z,{value:b.toString(),onChange:e=>{o(Number(e.currentTarget.value))},children:n.map(((e,t)=>(0,zn.jsx)("option",{value:t.toString(),children:e.name},t)))})})]}),(0,zn.jsx)(SS.Z,{className:"Setting--GeoLocation",masterLayout:1,deleteTitle:(0,W.Z)("title","Delete Geolocation"),filter:e,subtitle:(0,W.Z)("Location Overrides"),onRemove:e=>{const t=(0,C.Uy)(n,(t=>{t.splice(e,1)[0]}));if(s[Z.kGeolocationUseOverride])if(t.length){e===t.length&&e--;const{lat:s,long:n,location_id:i}=t[e];p({lat:s,long:n,location_id:i})}else I.Z.set(Z.kGeolocationUseOverride,!1),p({lat:0,long:0,location_id:""});i(t)},renderListItem:(e,t)=>{const n=s[Z.kGeolocationDefaultLocationId],i=t.location_id===n&&s[Z.kGeolocationUseOverride];return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("div",{className:"item-title",children:t.name}),i&&(0,zn.jsx)("span",{className:"item-badge",title:(0,W.Z)("The Current Location in Use"),children:(0,W.Z)("Current")})]})},addTipString:(0,W.Z)("Add Geolocation"),deleteTipString:(0,W.Z)("tooltip","Delete Geolocation"),mimeType:"vivaldi/x-geolocation",onActivate:o,onCreateItem:()=>i((e=>[...e,{name:gO,lat:IO(vO),long:IO(bO),locale:F.ZP.UI_LANGUAGE,location_id:crypto.randomUUID(),timezone:"UTC"}])),supportDragAndDrop:!0,renderEmpty:e=>(0,zn.jsx)("div",{className:"detail",children:(0,zn.jsxs)("div",{className:"detail-content",children:[(0,zn.jsx)("h3",{children:e.emptyTitle}),(0,zn.jsx)("p",{children:e.emptyDescription})]})}),emptyListString:(0,W.Z)("No Location Overrides"),moveItem:(e,t)=>{const s=(0,C.Uy)(n,(s=>{const n=s.splice(e,1)[0];s.splice(t,0,n)}));i(s)},renderCreate:e=>{const t=n.length-1;return a.current=t,m(t,e)},items:f,contentStrings:dO,renderContent:(e,t)=>(a.current=e,m(e,t))})]})}const SO=[Z.kAutofillCreditCardEnabled],ZO=(new Date).getFullYear(),TO=(new Date).getMonth()+1,EO={guid:void 0,instrumentId:void 0,name:"",cardNumber:"",expirationMonth:String(TO),expirationYear:String(ZO),nickname:"",network:void 0,imageSrc:void 0,cvc:void 0,productTermsUrl:void 0,metadata:void 0};class kO extends Un.PureComponent{static contextType=oi.Z;getCreditCardsList(){n.Z.autofillPrivate.getCreditCardList((e=>{this.setState({creditCards:e})}))}constructor(e){super(e),this.state={creditCards:[],dialogVisible:"none",dialogCard:EO}}componentDidMount(){this.getCreditCardsList(),n.Z.autofillPrivate.onPersonalDataChanged.addListener((()=>{this.getCreditCardsList()}))}componentWillUnmount(){n.Z.autofillPrivate.onPersonalDataChanged.removeListener((()=>{this.getCreditCardsList()}))}handleInputChange(e){const{name:t,value:s}=e.target;this.setState((e=>({dialogCard:{...e.dialogCard,[t]:s}})))}handleOnCloseDialog=()=>{this.setState({dialogVisible:"none",dialogCard:EO})};showEditCardDialog=e=>{e&&n.Z.autofillPrivate.getLocalCard(e).then((e=>{this.setState({dialogVisible:"edit",dialogCard:e})}))};showNewCardDialog=()=>{this.setState({dialogVisible:"new",dialogCard:EO})};saveCardAndCloseDialog=()=>{n.Z.autofillPrivate.saveCreditCard(this.state.dialogCard),this.handleOnCloseDialog()};deleteCardAndCloseDialog=()=>{"edit"===this.state.dialogVisible&&this.state.dialogCard.guid&&n.Z.autofillPrivate.removePaymentsEntity(this.state.dialogCard.guid),this.handleOnCloseDialog()};renderCreditCardIcon=e=>{if(e.network)switch(e.network){case"Amex":return(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.tl8}});case"Diners Club":return(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.e$7}});case"Discover":return(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.POA}});case"Elo":return(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.$KT}});case"JCB":return(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.pM3}});case"Mastercard":return(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.S2C}});case"China UnionPay":return(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.NmO}});case"Visa":return(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.R7A}})}return(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.rur}})};renderCard=e=>e&&(0,zn.jsxs)("div",{className:"CardDisplay",children:[this.renderCreditCardIcon(e),(0,zn.jsxs)("div",{className:"CardDisplay-Details",children:[(0,zn.jsx)("span",{className:"CardDisplay-Label",children:e.nickname?e.nickname:(0,W.Z)("Card")}),e.cardNumber&&(0,zn.jsx)("span",{className:"CardDisplay-Number",children:"•••• "+e.cardNumber}),e.expirationMonth&&e.expirationYear&&(0,zn.jsx)("span",{className:"CardDisplay-Expiration",children:e.expirationMonth+" / "+e.expirationYear.substring(2,4)}),(0,zn.jsx)("button",{className:"CardDisplay-Edit",title:(0,W.Z)("Edit Card"),onClick:()=>this.showEditCardDialog(e.guid),children:"•••"})]})]},e.guid);render(){const e="none"!==this.state.dialogVisible,t="new"===this.state.dialogVisible;return(0,zn.jsxs)(zn.Fragment,{children:[e&&this.state.dialogCard&&(0,zn.jsx)(Ha.Z,{onRequestClose:this.handleOnCloseDialog,className:"float card",ignoreClickOutside:!0,children:(0,zn.jsxs)("form",{children:[(0,zn.jsx)("div",{className:"dialog-header",children:(0,zn.jsx)("h1",{children:t?(0,W.Z)("Add Card"):(0,W.Z)("Edit Card")})}),(0,zn.jsxs)("div",{className:"dialog-content",children:[(0,zn.jsx)("div",{className:"dialog-row",children:(0,zn.jsx)("div",{className:"dialog-column",children:(0,zn.jsxs)("label",{children:[(0,W.Z)("Card Number"),(0,zn.jsx)("input",{type:"number",name:"cardNumber",defaultValue:this.state.dialogCard.cardNumber,onChange:e=>this.handleInputChange(e),onInput:e=>{e.target.value=e.target.value.slice(0,19)},autoFocus:!0})]})})}),(0,zn.jsx)("div",{className:"dialog-row",children:(0,zn.jsx)("div",{className:"dialog-column",children:(0,zn.jsxs)("label",{children:[(0,W.Z)("Expiry Date"),(0,zn.jsxs)("div",{className:"CardDisplay-Date",children:[(0,zn.jsx)(Fa.Z,{id:"cc_expiry",name:"expirationMonth",value:this.state.dialogCard.expirationMonth,onChange:e=>this.handleInputChange(e),children:Array.from({length:12},((e,t)=>t+1)).map((e=>(0,zn.jsx)("option",{value:e,children:e},e)))}),(0,zn.jsx)(Fa.Z,{name:"expirationYear",value:this.state.dialogCard.expirationYear,onChange:e=>this.handleInputChange(e),children:Array.from({length:20},((e,t)=>ZO+t)).map((e=>(0,zn.jsx)("option",{value:e,children:e},e)))})]})]})})}),(0,zn.jsx)("div",{className:"dialog-row",children:(0,zn.jsx)("div",{className:"dialog-column",children:(0,zn.jsxs)("label",{children:[(0,W.Z)("Name on Card"),(0,zn.jsx)("input",{type:"text",name:"name",maxLength:"100",defaultValue:this.state.dialogCard.name,onChange:e=>this.handleInputChange(e)})]})})}),(0,zn.jsx)("div",{className:"dialog-row",children:(0,zn.jsx)("div",{className:"dialog-column",children:(0,zn.jsxs)("label",{children:[(0,W.Z)("Card Nickname"),(0,zn.jsx)("input",{id:"cc_nick",type:"text",name:"nickname",maxLength:"25",defaultValue:this.state.dialogCard.nickname,onChange:e=>this.handleInputChange(e)})]})})})]}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"submit",onClick:this.saveCardAndCloseDialog,value:(0,W.Z)("Save"),disabled:!this.state.dialogCard.name&&!this.state.dialogCard.cardNumber}),"edit"===this.state.dialogVisible&&(0,zn.jsx)("input",{type:"button",className:"danger",onClick:this.deleteCardAndCloseDialog,value:(0,W.Z)("verb","Delete")}),(0,zn.jsx)("input",{type:"button",onClick:this.handleOnCloseDialog,value:(0,W.Z)("Cancel")})]})]})}),(0,zn.jsxs)("div",{className:"setting-single pad-top",children:[this.state.creditCards.length>0&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Your Payment Cards")}),(0,zn.jsx)("div",{children:this.state.creditCards.map((e=>this.renderCard(e)))})]}),(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Add New Payment Card"),disabled:!this.props.prefValues[Z.kAutofillCreditCardEnabled],onClick:this.showNewCardDialog})]})]})}}const NO=(0,zd.Z)(kO,SO),_O=[Z.kAutofillCanMakePaymentEnabled,Z.kAutofillCreditCardEnabled];_O.push(Z.kAutofillMandatoryReauthEnabled);const PO=I.Z.getEventHandler;function MO(e){const t=(0,Eo.Z)(_O),[s,i]=Un.useState(!1);Un.useEffect((()=>{n.Z.autofillPrivate.checkIfDeviceAuthAvailable().then((e=>{i(e)})).catch((()=>{i(!1)}))}),[]);return(0,zn.jsx)(Vy.Z,{categoryTitle:(0,W.Z)("Payment Methods"),filter:e.filter,children:(0,zn.jsxs)("div",{className:"setting-group unlimited",children:[(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kAutofillCreditCardEnabled],onChange:PO(Z.kAutofillCreditCardEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("Save and Fill Payment Methods")})]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Fills in payment forms with your saved payment methods.")})]}),s&&(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kAutofillMandatoryReauthEnabled],onChange:()=>{n.Z.autofillPrivate.authenticateUserAndFlipMandatoryAuthToggle()},disabled:!t[Z.kAutofillCreditCardEnabled]}),(0,zn.jsx)("span",{children:(0,W.Z)("Always Verify when Using Autofill")})]}),(0,zn.jsx)("p",{className:"info",disabled:!t[Z.kAutofillCreditCardEnabled],children:(0,W.Z)("When turned off, you may be asked occasionally to verify for security purposes.")})]}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kAutofillCanMakePaymentEnabled],onChange:PO(Z.kAutofillCanMakePaymentEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("Allow Sites to Check for Saved Payment Methods")})]})}),(0,zn.jsx)(NO,{filter:e.filter})]})})}const DO=Un.memo(MO),OO=116444736e5;var jO=s(12964),LO=s(34155);const RO=[Z.kExceptionsAutoplay,Z.kExceptionsGeolocation,Z.kExceptionsCamera,Z.kExceptionsMic,Z.kExceptionsSensors,Z.kExceptionsNotifications,Z.kExceptionsJavaScript,Z.kExceptionsKeyShortcuts,Z.kExceptionsImage,Z.kExceptionsPopUp,Z.kExceptionsSubResource,Z.kExceptionsAutoDownload,Z.kExceptionsSound,Z.kExceptionsBluetooth,Z.kExceptionsMIDI,Z.kExceptionsIdle,Z.kExceptionsBackgroundSync,Z.kExceptionsUSB,Z.kExceptionsSerial,Z.kExceptionsFileEdit,Z.kExceptionsHID,Z.kExceptionsClipboard,Z.kExceptionsPayment,Z.kExceptionsAugmentedReality,Z.kExceptionsVirtualReality,Z.kExceptionsWebID,Z.kExceptionsWindowManagement,Z.kExceptionsFont,Z.kExceptionsCookies],BO=",*",FO=":443";function WO(e,t=!1){return e.startsWith("file:")?t?(0,Ar.Ph)(e.replace(BO,"")):e.split("/").pop().replace(BO,""):(0,Ar.Ph)(e.replace(BO,"").replace(FO,""))}function UO(e){return e.port||"https:"!==e.protocol?"":FO}var VO=(0,zn.jsx)("hr",{});function HO(e){const t=(0,Eo.Z)(RO),[s,n]=Un.useState(""),[i,a]=Un.useState(!1),[o,r]=Un.useState({}),[l,d]=Un.useState(""),[c,h]=Un.useState(""),u=Un.useRef([]),p=Un.useRef(),g=Un.useRef(),m=iE(),f=async()=>{const e={};for(const t of Object.keys(sb._)){const s=await re.Z.utilities.getDefaultContentSettings(t);e[t]=s}r((t=>({...t,...e})))};Un.useEffect((()=>{f()}),[]);const v=Un.useCallback((async()=>{s?(await RO.forEach((e=>{const n=structuredClone(t[e]);Object.keys(n).filter((e=>e.includes(s))).forEach((e=>delete n[e])),Object.keys(n).length?I.Z.set(e,n):I.Z.reset(e)})),y()):(await RO.forEach((e=>I.Z.reset(e))),y())}),[t,s]),b=e=>{const{value:t,dataset:s}=e.target,n=parseInt(t),i=s.pref,a=s.site;if(RO.includes(i)&&a){const e={...A.Z.get(i)};0===n?delete e[a]:e[a]={...e[a],setting:n,last_modified:(1e3*((o??new Date).getTime()+OO)).toString()},I.Z.set(i,e)}var o},C=()=>{const e=structuredClone(u.current)??[],t=(0,ve.Z)((0,Ar.q9)(l,!0));if(t){const s=UO(t);e.push(t.origin+s+BO),u.current=[...new Set([...e])],d("")}else h((0,W.Z)("Please provide valid domain name including protocol.")),g.current?.focus()},w=e=>{const{value:t}=e.currentTarget;d(t),h("")},y=()=>a(!1),x=()=>{const e=p.current?.refSortable.current?.state.selectedIndex;e&&p.current?.refSortable.current?.removeItem(e),d(""),h("")},S=Un.useCallback((e=>{const t=Object.keys(sb._).find((t=>sb._[t].path===e));if(t){const e=o[t]??"";switch(e){case"allow":return sb.w.Allow;case"block":return sb.w.Block;case"ask":return sb.w.Ask;case"session_only":return sb.w["Session Only"];default:return console.warn("Setting error",e),"?"}}return console.warn("Unknown permission",e),"?"}),[o]),T=Un.useCallback(((e,s)=>{const n=t[e][s]?.setting??0,i=e.split(".").pop(),a=Object.keys(sb._).find((e=>sb._[e].path===i)),{exceptions:o}=a?sb._[a]:{},r=0!==n;return(0,zn.jsxs)("label",{className:r?"changed":"default",children:[(0,zn.jsx)("span",{className:"icon",dangerouslySetInnerHTML:{__html:ib(i)}}),(0,zn.jsx)("span",{children:nb(i)}),(0,zn.jsxs)(Fa.Z,{"data-pref":e,"data-site":s,"data-type":i,value:n,onChange:b,children:[(0,zn.jsx)("option",{value:0,children:(0,W.Z)("Default ($1)",[S(i)])}),VO,!1!==o?.allow&&(0,zn.jsx)("option",{value:1,children:sb.w.Allow}),e===Z.kExceptionsCookies?(0,zn.jsx)("option",{value:4,children:sb.w["Session Only"]}):(o?.ask||!1===o?.allow)&&(0,zn.jsx)("option",{value:3,children:sb.w.Ask}),(0,zn.jsx)("option",{value:2,children:sb.w.Block})]},e+n)]},e)}),[t,S]),E=Un.useCallback(((t,s,n)=>{const i=RO.flatMap((e=>Object.keys(t[e]))),a=[...new Set([...i,...n])].filter((e=>!e.startsWith("*,"))).map((e=>({key:e,name:WO(e),number:i.filter((t=>t===e)).length})),[]);if(e.origin&&!a.some((t=>t.key.startsWith(e.origin)))){const t=UO(new URL(e.origin)),s=e.origin+t+BO;a.push({key:s,name:WO(s),number:0})}if(a.sort(((e,t)=>(0,Ut.qf)(e.name,t.name))),s){const e=a.filter((e=>e.name.includes(s)));return u.current=e.map((e=>e.key)),e}return u.current=a.map((e=>e.key)),a.unshift({key:"default",name:sb.w["Global Permissions"],number:0,isRemovable:!1}),a}),[e.origin]);var k=(0,zn.jsx)(fa,{type:"warning",children:c});const N=RO.flatMap((e=>Object.keys(t[e]))),_=N.length,P=[...new Set(N)].length,M=E(t,s,u.current??[]);let D;return e.origin&&(D=Math.max(0,M.findIndex((t=>t.key.startsWith(e.origin))))),(0,zn.jsxs)(Vy.Z,{filter:e.filter,categoryTitle:sb.w["Website Permissions"],"data-anchor":"permissions",children:[i&&(0,zn.jsx)(Ha.Z,{onRequestClose:y,className:"float",title:(0,W.Z)("Reset Website Permissions?"),children:(0,zn.jsxs)("div",{className:"dialog-delete-cookies",children:[(0,zn.jsx)("div",{className:"dialog-content",children:(0,zn.jsx)("p",{children:s?(0,W.Z)("Filtered website permission exceptions will be removed."):(0,W.Z)("All website permission exceptions will be removed.")})}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"button",className:"danger",onClick:v,value:(0,W.Z)("other","Reset"),autoFocus:!0}),(0,zn.jsx)("input",{type:"button",onClick:y,value:(0,W.Z)("Cancel")})]})]})}),(0,zn.jsx)("div",{className:"setting-group unlimited",children:(0,zn.jsx)("p",{children:(0,W.Z)("There is $1 exception to the default permissions $2.","There are $1 exceptions to the default permissions $2.",[_,(0,W.Z)("across $1 domain","across $1 domains",[P])])})}),(0,zn.jsx)(SS.Z,{ref:p,items:M,masterLayout:1,renderListItem:(e,t)=>(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("span",{children:e}),t.number>0&&(0,zn.jsx)("span",{className:"item-count",children:t.number})]}),renderContent:(t,n)=>{if((0,jO.Z)(o))return null;const i=""===s?1:0;if(i&&0===t)return(0,zn.jsx)(ob,{filter:e.filter,permissionList:o,reloadPermissions:f});const a=u.current?.[t-i]??"";return(0,zn.jsx)("div",{className:"detail",children:(0,zn.jsxs)("div",{className:"detail-content",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Permissions for “$1”",[WO(a,!0)])}),RO.map((e=>T(e,a)))]})})},contentStrings:sb.w,className:"setting-site-permissions",filter:e.filter,addTipString:(0,W.Z)("Add new domain"),deleteTipString:(0,W.Z)("Remove domain"),deleteTitle:(0,W.Z)("Remove Domain"),deleteLabel:(0,W.Z)("Removing a domain resets all of its current permissions."),renderCreate:e=>(0,zn.jsx)("form",{className:"detail",onSubmit:C,children:(0,zn.jsxs)("div",{className:"detail-content create",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Add a domain, including the protocol, to adjust permissions.")}),(0,zn.jsx)("label",{children:(0,zn.jsx)("input",{ref:g,type:"text",value:l,onChange:w,placeholder:(0,W.Z)("e.g. https://example.com"),spellCheck:"false",autoFocus:!0})}),c&&k,(0,zn.jsxs)("div",{className:"toolbar",children:[(0,zn.jsx)("input",{type:"submit",value:(0,W.Z)("Add Domain")}),(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Cancel"),onClick:x})]})]})}),renderCreateListItem:()=>(0,zn.jsx)("span",{children:""===l?(0,W.Z)("New domain"):l}),onRemove:e=>{const n=E(t,s,u.current??[])[e]?.key,i=RO.map(((e,s)=>{const i=structuredClone(t[e]);i[n]&&(delete i[n],Object.keys(i).length?I.Z.set(e,i):I.Z.reset(e))}));Promise.all(i).then((()=>{LO.nextTick((()=>{u.current?.splice(u.current.indexOf(n),1),m()}))}))},initialSelectedIndex:D}),(0,zn.jsxs)("div",{className:"setting-single setting-single-flex",children:[(0,zn.jsx)("input",{type:"search",placeholder:(0,W.Z)("Filter by domain"),value:s,onChange:e=>{n(e.target.value)}}),(0,zn.jsx)("input",{type:"button",disabled:0===P,onClick:()=>a(!0),value:(0,W.Z)(s?(0,W.Z)("Reset Filtered Website Permissions"):(0,W.Z)("Reset All Website Permissions"))})]})]})}const GO=Un.memo(HO),KO=[Z.kHistoryDaysToKeepVisits,Z.kSavingBrowserHistoryDisabled];class zO extends Un.Component{onHistoryDaysChanged=e=>{const t=parseInt(e.target.value,10);I.Z.set(Z.kHistoryDaysToKeepVisits,t),0===t?I.Z.set(Z.kSavingBrowserHistoryDisabled,!0):I.Z.set(Z.kSavingBrowserHistoryDisabled,!1)};render(){const e=this.props.prefValues[Z.kHistoryDaysToKeepVisits],t=[0,1,7,31,91,182,365,3650].includes(e);return(0,zn.jsx)(tb.Z,{filter:this.props.filter,children:(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("other","Save Browsing History")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)(Fa.Z,{onChange:this.onHistoryDaysChanged,value:e,children:[(0,zn.jsx)("option",{value:"0",children:(0,W.Z)("command","Session Only")}),(0,zn.jsx)("option",{value:"1",children:(0,W.Z)("One Day")}),(0,zn.jsx)("option",{value:"7",children:(0,W.Z)("One Week")}),(0,zn.jsx)("option",{value:"31",children:(0,W.Z)("One Month")}),(0,zn.jsx)("option",{value:"91",children:(0,W.Z)("Three Months")}),(0,zn.jsx)("option",{value:"182",children:(0,W.Z)("Six Months")}),(0,zn.jsx)("option",{value:"365",children:(0,W.Z)("One Year")}),(0,zn.jsx)("option",{value:"3650",children:(0,W.Z)("Forever")}),!t&&(0,zn.jsx)("option",{value:e,children:(0,W.Z)("Other ($1 Days)",[e])})]})}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Browser restart is required for new setting to take effect.")})]})})}}const $O=(0,zd.Z)(zO,KO);var YO=s(98109),XO=s(84782);class QO extends Un.Component{state={installed:!1,error_message:""};installExtension=()=>{re.Z.utilities.silentlyInstallExtension(u.Ug,(e=>{this.setState({installed:e.success,error_message:e.error})}))};componentDidMount(){n.Z.management.get(u.Ug,(()=>{n.Z.runtime.lastError?this.installExtension():this.setState({installed:!0})}))}componentDidUpdate(e,t){!t.installed&&this.state.installed&&this.props.onContinue()}render(){const{installed:e,error_message:t}=this.state;return(0,zn.jsxs)("div",{className:"proton-vpn-intro",children:[!e&&""===t&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("span",{className:"spinner",dangerouslySetInnerHTML:{__html:Kn.H0I}}),(0,zn.jsx)("div",{children:(0,W.Z)("Initializing...")})]}),""!==t&&(0,zn.jsxs)("div",{className:"proton-vpn-error",children:[(0,zn.jsx)("h2",{children:(0,W.Z)("Installation Failed")}),(0,zn.jsx)("p",{children:(0,W.Z)("The extension cannot be installed, please try again later.")}),(0,zn.jsx)("p",{className:"selectable",children:(0,W.Z)("Error: $1",[t])})]})]})}}const qO=QO,JO="VPNButton";class ej extends Un.PureComponent{static contextType=oi.Z;extensionActionPopupRef=Un.createRef();_buttonRef=Un.createRef();state={activeTabId:Ze.ZP.unsafeGetActivePage(this.context.vivaldiWindowId).id,extensions:YO.Z.getState(),popupVisible:!1,popupRect:void 0,popupPage:null,onVPN:!1,offline:!navigator.onLine};async componentDidMount(){if(this.props.inEditor||fe.ZP.isGuest())return;YO.Z.addListener(this._onExtensionStoreChange);const{selectWindow:e}=this.context;Ze.ZP.addListener(this._onPageStoreChange,e),n.Z.proxy.settings.onChange.addListener(this._onProxyChange);const t=fe.ZP.isIncognito(this.context.vivaldiWindowId);n.Z.proxy.settings.get({incognito:t},(e=>{this.handleProxyChange(e.value)})),this.context.addEventListener("online",this._onOnline),this.context.addEventListener("offline",this._onOffline),Rp._h.addListener(this._onPrefsChanged)}componentWillUnmount(){this.props.inEditor||(this.state.popupVisible&&this.popupWantsToClose(),YO.Z.removeListener(this._onExtensionStoreChange),Ze.ZP.removeListener(this._onPageStoreChange),n.Z.proxy?.settings.onChange.removeListener(this._onProxyChange),this.context.removeEventListener("online",this._onOnline),this.context.removeEventListener("offline",this._onOffline),Rp._h.removeListener(this._onPrefsChanged))}_onPrefsChanged=(e,t)=>{(0,Rp.VJ)(JO)||n.Z.management.setEnabled(u.Ug,!1,(()=>{}))};_onOnline=()=>{this.setState({offline:!1})};_onOffline=()=>{this.setState({offline:!0})};_onProxyChange=e=>{e&&"object"==typeof e&&e.value&&"object"==typeof e.value&&this.handleProxyChange(e.value)};handleProxyChange=e=>{"fixed_servers"===e.mode&&e.rules.singleProxy.host.endsWith(".protonvpn.net")?this.setState({onVPN:!0}):this.setState({onVPN:!1})};_onExtensionStoreChange=()=>{this.setState({extensions:YO.Z.getState()})};_onPageStoreChange=()=>{const e=this.context.vivaldiWindowId,t=Ze.ZP.unsafeGetActivePage(e);this.setState({activeTabId:t.id})};getVPNExtensionInfo=()=>{const e=this.state.extensions.get(u.Ug);if(!e)return;const t=e.get(this.state.activeTabId),s=e.get(-1);if(!s)throw new Error("Extension fallback not set! Something is wrong. "+u.Ug);return{...s,...t}};isExtensionInstalled=()=>!!this.getVPNExtensionInfo();handleClick=e=>{if(this.state.popupVisible)this.popupWantsToClose();else if(this.isExtensionInstalled()){const{HTMLElement:t}=this.context;if(e.target instanceof t){const t=e.target;this.onExtensionActionClicked(t.getBoundingClientRect(),e)}}else this.setState((e=>({popupVisible:!e.popupVisible})))};showOptionsPage=e=>{re.Z.extensionActionUtils.showExtensionOptions(e,this.context.vivaldiWindowId)};onCustomMenuSelected=(e,t)=>{re.Z.extensionActionUtils.executeMenuAction(e,this.context.vivaldiWindowId,t,(e=>{n.Z.runtime.lastError&&n.Z.runtime.lastError.message&&console.warn("Offline invoking menu item action: "+n.Z.runtime.lastError.message)}))};onExtensionActionClicked=(e,t)=>{re.Z.extensionActionUtils.executeExtensionAction(u.Ug,this.context.vivaldiWindowId,(t=>{t.popupUrl&&this.setState((s=>({popupVisible:!s.popupVisible,popupPage:t.popupUrl,popupRect:e})),(()=>{this.state.popupVisible&&this.extensionActionPopupRef.current?.recreateWebView()}))}))};popupWantsToClose=()=>{this.setState({popupVisible:!1}),this.extensionActionPopupRef.current?.removeWebView()};handleOnContinue=()=>{n.Z.management.setEnabled(u.Ug,!0,(()=>{this.setState({popupVisible:!1}),this.onExtensionActionClicked(this._buttonRef.current?.getRect())}))};hidePopup=()=>this.setState({popupVisible:!1});renderButton=e=>{let t="",s="";this.state.onVPN&&(this.state.offline?(t="offline",s=(0,W.Z)("connection","(Offline)")):(t="online",s=(0,W.Z)("connection","(Online)")));const n=fe.ZP.isGuest()?{display:"none"}:{};return(0,zn.jsx)(oa.ZP,{onClick:this.handleClick,tooltip:(0,W.Z)("Proton VPN $1",[s]),image:Kn.VNL[this.props.size||"large"],size:this.props.size,className:Gn()(u.Ug,"protonVPN",{[t]:!0}),style:n,menuOrigin:this.props.menuOrigin,customizeMenu:this.props.customizeMenu,isPopupVisible:this.state.popupVisible,popupLabelledBy:"popup-vpn-intro",popupWidth:370,popupPosition:this.props.popupPosition,hidePopup:this.hidePopup,draggable:this.props.draggable,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,onDrop:this.props.onDrop,onDragEnter:this.props.onDragEnter,onDragLeave:this.props.onDragLeave,onDragOver:this.props.onDragOver,mimeType:this.props.mimeType,name:JO,ref:this._buttonRef,children:!e&&(0,zn.jsx)("div",{id:"popup-vpn-intro",children:(0,zn.jsx)(qO,{onContinue:this.handleOnContinue,windowId:this.context.vivaldiWindowId})})},u.Ug)};render(){const e=!!this.isExtensionInstalled(),t=fe.ZP.isGuest();return(0,zn.jsxs)(zn.Fragment,{children:[this.renderButton(e),this.state.popupVisible&&e&&!t&&(0,zn.jsx)("div",{children:(0,zn.jsx)(XO.Z,{ref:this.extensionActionPopupRef,extensionId:u.Ug,outsideClickIgnoreClass:"protonVPN",popupVisible:this.state.popupVisible,popupPage:this.state.popupPage,popupPosition:this.props.popupPosition,popupWantsToClose:this.popupWantsToClose,popupRect:this.state.popupRect})})]})}}const tj=(0,cc.ZP)(ej);function sj(){if(A.Z.usesDefault(Z.kToolbarsNavigation))return;if((0,Rp.VJ)(JO))return;const e=A.Z.get(Z.kToolbarsNavigation).slice();if(e.includes(JO))return;let t=0;const s=["Extensions","UpdateButton","AccountButton","SearchField","AddressField"];for(let n=0;n<s.length;n++){const i=e.indexOf(s[n]);if(-1!==i){t=i+1;break}}e.splice(t,0,JO),I.Z.set(Z.kToolbarsNavigation,e)}function nj(){(0,Rp.yp)(JO)}function ij(e){n.Z.management.setEnabled(u.Ug,e)}const aj=class{isInstalled=!!YO.Z.getState().get(u.Ug);_onExtensionStoreChange=()=>{const e=this.isInstalled;this.isInstalled=!!YO.Z.getState().get(u.Ug),e!==this.isInstalled&&n.Z.management.get(u.Ug,(()=>{n.Z.runtime.lastError?e&&(nj(),this.isInstalled=!1):e||(re.Z.utilities.allowVPNIncognito(),sj(),this.isInstalled=!0)}))};start(){YO.Z.addListener(this._onExtensionStoreChange)}stop(){YO.Z.removeListener(this._onExtensionStoreChange)}},oj=[Z.kAddressBarInlineSearchEnabled,Z.kSearchSuggestEnabled,Z.kAddressBarSearchSuggestEnabled,Z.kAlternateErrorPagesEnabled,Z.kAutofillCreditCardEnabled,Z.kEnableDoNotTrack,Z.kPrivacyAdverseAdBlockEnabled,Z.kPrivacyAutofillServerAssist,Z.kPrivacyBlockPingsEnabled,Z.kPrivacyGoogleComponentExtensionsHangoutServices,Z.kPrivacyGoogleComponentExtensionsWebStore,Z.kSafeBrowsingEnabled,Z.kIncognitoShowIntro,Z.kVivaldiCrashReportingConsentGranted,Z.kWebRTCIPHandlingPolicy,Z.kCustomHandlersEnabled,Z.kAddressBarOmniboxShowTypedHistory];const rj=I.Z.getEventHandler,lj="https://vivaldi.com/protonvpn/";function dj(e){const t=Un.useContext(oi.Z),s=(0,Eo.Z)(oj),[n,i]=Un.useState(s[Z.kCustomHandlersEnabled]);Un.useEffect((()=>{i(s[Z.kCustomHandlersEnabled])}),[s]);const a=()=>["default","default_public_interface_only","default_public_and_private_interfaces"].includes(s[Z.kWebRTCIPHandlingPolicy]),o=Un.useCallback((()=>{return e=t.vivaldiWindowId,Rp.ZP.isComponentVisible(JO,e);var e}),[t.vivaldiWindowId]),[r,l]=Un.useState(o());Un.useEffect((()=>{const e=()=>l(o());return A.Z.addListener(Z.kToolbarsNavigation,e),()=>A.Z.removeListener(Z.kToolbarsNavigation,e)}),[o]);return(0,zn.jsxs)(Vy.Z,{categoryTitle:(0,W.Z)("Privacy"),displayPrivacyLink:!0,filter:e.filter,children:[(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Tracking Prevention")}),(0,zn.jsxs)("label",{title:(0,W.Z)("Send “Do Not Track” directive to supporting websites"),children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kEnableDoNotTrack],onChange:rj(Z.kEnableDoNotTrack)}),(0,zn.jsx)("span",{children:(0,W.Z)("Ask Websites Not to Track Me")})]})]}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{title:(0,W.Z)("Reject advertisement on websites listed by Google as privacy offenders"),children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kPrivacyAdverseAdBlockEnabled],onChange:rj(Z.kPrivacyAdverseAdBlockEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("Block Ads on Abusive Sites")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{title:(0,W.Z)("Block tracking on links with a “ping” attribute or via navigator.sendBeacon"),children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kPrivacyBlockPingsEnabled],onChange:rj(Z.kPrivacyBlockPingsEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("Block Hyperlink Audit Tracking")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{title:(0,W.Z)("Web Real-Time Communication broadcast may leak IP address to services"),children:[(0,zn.jsx)("input",{type:"checkbox",checked:a(),onChange:()=>{const e=a()?"disable_non_proxied_udp":"default";I.Z.set(Z.kWebRTCIPHandlingPolicy,e)}}),(0,zn.jsx)("span",{children:(0,W.Z)("Broadcast IP for Best WebRTC Performance")})]})})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Google Services")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kSafeBrowsingEnabled],onChange:rj(Z.kSafeBrowsingEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("Phishing and Malware Protection")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kAlternateErrorPagesEnabled],onChange:rj(Z.kAlternateErrorPagesEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("DNS to Help Resolve Navigation Errors")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kPrivacyAutofillServerAssist],onChange:rj(Z.kPrivacyAutofillServerAssist)}),(0,zn.jsx)("span",{children:(0,W.Z)("Form Autofill Assist")})]})})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Google Extensions")}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Browser restart is required for new settings to take effect.")}),(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kPrivacyGoogleComponentExtensionsHangoutServices],onChange:rj(Z.kPrivacyGoogleComponentExtensionsHangoutServices)}),(0,zn.jsx)("span",{children:(0,W.Z)("Meet (was Hangouts)")})]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Some Google services will break with this option disabled.")})]}),(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kPrivacyGoogleComponentExtensionsWebStore],onChange:rj(Z.kPrivacyGoogleComponentExtensionsWebStore)}),(0,zn.jsx)("span",{children:(0,W.Z)("Web Store")})]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("You will be unable to install extensions with this option disabled.")})]})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Proton VPN")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:r,onChange:()=>{o()?(ij(!1),nj()):(ij(!0),sj(),l(!0))}}),(0,zn.jsx)("span",{children:(0,W.Z)("Enable Proton VPN")})]})}),(0,zn.jsx)("a",{onClick:()=>c.ZP.openURL(t.vivaldiWindowId,lj),title:lj,className:"info",href:"",children:(0,W.Z)("Learn more about Proton VPN for Vivaldi")})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("noun","Search")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kAddressBarInlineSearchEnabled],onChange:rj(Z.kAddressBarInlineSearchEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("Search in Address Field")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kSearchSuggestEnabled],onChange:rj(Z.kSearchSuggestEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("Suggestions in Address Field")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kAddressBarSearchSuggestEnabled],onChange:rj(Z.kAddressBarSearchSuggestEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("Suggestions in Search Field")})]})})]}),(0,zn.jsx)($O,{filter:e.filter}),(0,zn.jsx)("div",{className:"setting-group",children:(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Private Windows")}),(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kIncognitoShowIntro],onChange:rj(Z.kIncognitoShowIntro)}),(0,zn.jsx)("span",{children:(0,W.Z)("Show Introduction")})]})]})}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Protocol handling")}),(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:n,onChange:()=>{re.Z.utilities.setProtocolHandling(!n),i((e=>!e))}}),(0,zn.jsx)("span",{children:(0,W.Z)("Sites can ask to handle protocols")})]})]}),!1]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Crash Reporting")}),(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:A.Z.get(Z.kVivaldiCrashReportingConsentGranted),onChange:()=>{I.Z.set(Z.kVivaldiCrashReportingConsentGranted,!A.Z.get(Z.kVivaldiCrashReportingConsentGranted))}}),(0,zn.jsx)("span",{children:(0,W.Z)("Allow Vivaldi to Send Automatic Crash Reports")})]}),(0,zn.jsxs)("p",{className:"info",children:[(0,W.Z)("Crash reports include the most recently visited webpage. It may send more personal information which is promptly deleted.")," ",(0,zn.jsx)(Vx.Z,{title:u.fg,onClick:()=>{c.ZP.openURL(t.vivaldiWindowId,u.fg)},children:(0,W.Z)("Privacy policy")})]})]})]})]})}const cj=Un.memo(dj);function hj(e){return(0,zn.jsx)("span",{children:e})}function uj({filter:e}){const[t,s]=(0,Un.useState)([]),i=(0,Un.useRef)();return(0,Un.useEffect)((()=>{async function e(){try{const e=await n.Z.passwordsPrivate.getPasswordExceptionList();s(e)}catch(e){console.warn(e)}}return n.Z.passwordsPrivate.onPasswordExceptionsListChanged.addListener(e),setTimeout(e,300),()=>n.Z.passwordsPrivate.onPasswordExceptionsListChanged.removeListener(e)}),[]),(0,Un.useEffect)((()=>(1===i.current?.length&&0===t.length&&s("cleared"),()=>{i.current=t})),[t]),t.length||"cleared"===t?(0,zn.jsx)(tb.Z,{filter:e,children:(0,zn.jsx)("div",{className:"setting-group setting-group-double",children:(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Declined Sites")}),(0,zn.jsx)("p",{className:"info",children:"cleared"===t?(0,W.Z)("No sites with password saving declined."):(0,W.Z)("Sites with password saving declined.")}),"cleared"!==t&&(0,zn.jsx)(Hy.Z,{items:t.map((e=>({name:e.urls.shown,key:e.id.toString()}))),renderListItem:hj,filter:e,onRemove:function(e){if("cleared"!==t){const s=t[e];s.id&&n.Z.passwordsPrivate.removePasswordException(s.id)}},deleteTipString:(0,W.Z)("Remove Site"),supportDragAndDrop:!1})]})})}):null}var pj=(0,zn.jsx)("span",{children:"•••••••"});class gj extends Un.Component{render(){const{origin:e,username:t,password:s}=this.props.savedPassword,{columns:n}=this.props;if(n.length<1||!this.props.savedPassword)return null;var i=(0,zn.jsx)(Vn.ZP,{url:e,loadType:"page"}),a=(0,zn.jsx)("span",{children:e}),o=(0,zn.jsx)("input",{type:"text",value:t,tabIndex:-1,readOnly:!0}),r=(0,zn.jsx)("input",{type:"text",value:s,tabIndex:-1,readOnly:!0});return n.map(((t,s)=>{switch(t.id){case"origin":return(0,zn.jsxs)("label",{children:[(0,zn.jsx)("span",{className:"site-icon",onDoubleClick:this.props.openLink.bind(null,e),title:(0,W.Z)("Double-click to visit $1",[e]),children:i}),a]},t.id+"__"+s);case"username":return(0,zn.jsx)("label",{children:o},t.id+"__"+s);case"password":return(0,zn.jsxs)("div",{children:[(0,zn.jsx)("label",{children:this.props.showPassword?r:pj}),(0,zn.jsx)("button",{type:"button",className:"listcontrol",title:this.props.showPassword?(0,W.Z)("Hide password"):(0,W.Z)("other","Show password"),tabIndex:-1,onClick:this.props.togglePassword.bind(null,this.props.savedPassword.index),dangerouslySetInnerHTML:{__html:Kn.sgm.medium}})]},t.id+"__"+s);default:return null}}))}}const mj=gj;class fj extends Un.PureComponent{static contextType=oi.Z;_passwordTree=Un.createRef();state={visiblePasswords:[]};componentDidMount(){this._passwordTree.current&&this._passwordTree.current.focusTree()}togglePassword=e=>{re.Z.savedpasswords.authenticate(this.context.vivaldiWindowId,(t=>{t&&this._onShowPassword(e)}))};_onShowPassword=e=>{this.getRowComponentProps=this.getRowComponentProps.bind(this),this.setState((t=>{const s=t.visiblePasswords.slice(0);return s.includes(e)?s.splice(s.indexOf(e),1):s.push(e),{visiblePasswords:s}}))};onPasswordDeleted=e=>{this.state.visiblePasswords.includes(e)&&this.setState((t=>{const s=t.visiblePasswords.slice(0);return s.splice(s.indexOf(e),1),{visiblePasswords:s}}))};openLink=e=>{c.ZP.openURL(this.context.vivaldiWindowId,e)};copyPassword=e=>{re.Z.savedpasswords.authenticate(this.context.vivaldiWindowId,(t=>{t&&jc.Z.set(e)}))};getContextMenuItems=e=>{const t=this.state.visiblePasswords.includes(e.index);return[{handler:this.togglePassword.bind(null,e.index),isVisible:()=>t,...(0,fi.Z)("Hide Password")},{handler:this.togglePassword.bind(null,e.index),isVisible:()=>!t,...(0,fi.Z)("Show Password")},st.Z.separatorItem,{handler:()=>this.copyPassword(e.password),...(0,fi.Z)("Copy Password")},{handler:()=>jc.Z.set(e.username),...(0,fi.Z)("Copy Account Name")},{handler:this.openLink.bind(null,e.origin),isVisible:()=>(0,Ar.q9)(e.origin).startsWith("http"),...(0,fi.Z)("Visit Page")},st.Z.separatorItem,{handler:this.props.onDelete.bind(null,e),...(0,fi.Z)("Delete Password")}]};onKeyDown=e=>{if(!this._passwordTree.current)return;const t=this._passwordTree.current.getSelectedItem();if(t)switch(e.key){case"Delete":case"Backspace":this.props.onDelete(t);break;case" ":e.preventDefault(),this.togglePassword(t.index);break;case"Enter":this.openLink(t.origin)}};onMouseDown=()=>{this._passwordTree.current&&this._passwordTree.current.focusTree()};getRowComponentProps=e=>({columns:this.props.columns,savedPassword:e.node,showPassword:this.state.visiblePasswords.includes(e.node.index),togglePassword:this.togglePassword,openLink:this.openLink});render(){return(0,zn.jsx)(Mi,{ref:this._passwordTree,rowComponent:mj,getRowComponentProps:this.getRowComponentProps,nodes:this.props.nodes,enableDragAndDrop:!1,onItemMouseDown:this.onMouseDown,onItemDoubleClick:nr.Z,onKeyDown:this.onKeyDown,getContextMenuItems:this.getContextMenuItems,isFolder:iy.Z,disableClipboard:!0,hasChildren:iy.Z,sorting:this.props.sorting,columns:this.props.columns,multiSelect:!1})}}const vj=fj;var bj=s(37461);const Cj=n.Z.passwordsPrivate.onPasswordsFileExportProgress,wj=[Z.kCredentialsEnableService],yj=I.Z.getEventHandler,xj="passwords",Ij={width:400,minWidth:"unset"},Aj=[{text:(0,W.Z)("Website"),value:"origin",fullScreenTitle:(0,W.Z)("Sort by website"),width:300,visible:!0,key:!0},{text:(0,W.Z)("title","Account Name"),value:"username",fullScreenTitle:(0,W.Z)("Sort by account name"),width:160,visible:!0},{text:(0,W.Z)("Password"),value:"password",fullScreenTitle:(0,W.Z)("Sort by password"),width:160,visible:!0}];function Sj(e,t){return e.index<t.index?1:-1}function Zj(e){const t=Un.useContext(oi.Z),s=(0,Eo.Z)(wj),i=Un.useRef(),[a,o]=Un.useState([]),[r,l]=Un.useState(!1),[d,c]=Un.useState(null),[h,u]=Un.useState(""),[p,g]=Un.useState(!1),[m,f]=Un.useState(xi().passwords||Ii(Aj)),[v,b]=Un.useState({sortOrder:1,sortField:"manually",comparator:Sj}),[C,w]=Un.useState("NOT_STARTED");Un.useEffect((()=>{function e(e){w(e.status)}return y(),n.Z.passwordsPrivate.onSavedPasswordsListChanged.addListener(y),Cj.addListener(e),n.Z.extension.inIncognitoContext||re.Z.savedpasswords.createDelegate(),()=>{Cj.removeListener(e),n.Z.passwordsPrivate.onSavedPasswordsListChanged.removeListener(y)}}),[]);const y=()=>re.Z.savedpasswords.getList((e=>{o(e)})),x=()=>{const e=d;e&&(re.Z.savedpasswords.remove(e.index,(()=>{i.current&&i.current.onPasswordDeleted(e.index)})),l(!1),c(null))},I=()=>{l(!1),c(null)},A=h.toLowerCase(),S=a.filter((e=>e.username.toLowerCase().includes(A)||e.origin.toLowerCase().includes(A)));return fe.ZP.isIncognito(t.vivaldiWindowId)?(0,zn.jsx)(Vy.Z,{categoryTitle:(0,W.Z)("Passwords"),filter:e.filter,className:"saved-passwords setting-group unlimited",children:(0,zn.jsx)("div",{className:"setting-group setting-group-double",children:(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("p",{children:(0,W.Z)("Passwords are not available in Private window.")}),(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Open Settings Window"),onClick:()=>ue.Z.showSettings(t.vivaldiWindowId,"privacy",{},!0)})]})})}):(0,zn.jsxs)(Vy.Z,{categoryTitle:(0,W.Z)("Passwords"),filter:e.filter,className:"saved-passwords setting-group unlimited",children:[r&&(()=>{const e=d;if(!e)return null;const t=(()=>{const e=d;return e?(0,ve.Z)(e.origin)?.hostname:null})();return(0,zn.jsx)(Ha.Z,{className:"float",onRequestClose:I,style:Ij,title:(0,W.Z)("Delete password for $1?",[t||e.origin]),children:(0,zn.jsxs)("div",{className:"dialog-delete-password",children:[(0,zn.jsx)("div",{className:"dialog-content",children:(0,zn.jsx)("p",{children:(0,W.Z)("Password for user “$1” on page “$2” will be removed.",[e.username,e.origin])})}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"button",className:"primary",onClick:x,value:(0,W.Z)("other","Delete"),autoFocus:!0}),(0,zn.jsx)("input",{type:"button",onClick:I,value:(0,W.Z)("Cancel")})]})]})})})(),(0,zn.jsxs)("div",{className:"setting-group unlimited",children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",onChange:yj(Z.kCredentialsEnableService),checked:s[Z.kCredentialsEnableService]}),(0,zn.jsx)("span",{children:(0,W.Z)("Save Webpage Passwords")})]})}),p&&(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)("input",{type:"search",defaultValue:"",placeholder:(0,W.Z)("Filter Passwords"),onChange:e=>u(e.target.value)})}),p&&(0,zn.jsxs)("div",{className:"saved-passwords-tree",children:[(0,zn.jsx)(Bu,{fields:Aj,fullsize:!0,onSortChange:(e,t)=>{b({sortOrder:e,sortField:t})},onSaveRow:()=>yi(m,xj),onUpdateRow:e=>f(e),columns:m,sortField:v.sortField,sortOrder:v.sortOrder,keyAccess:0,manualSorting:!1}),(0,zn.jsx)(vj,{ref:i,sorting:v,columns:m,onDelete:e=>{l(!0),c(e)},nodes:S})]}),0===S.length&&(0,zn.jsx)("div",{className:"saved-passwords",children:h?(0,W.Z)("Query “$1” matches no result.",[h]):(0,W.Z)("No saved passwords found.")}),S.length>0&&(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("input",{type:"button",onClick:()=>{g((e=>!e)),u("")},value:p?(0,W.Z)("Hide Passwords"):(0,W.Z)("Show Saved Passwords")}),(0,zn.jsx)("input",{type:"button",onClick:()=>(0,bj.T)(t.vivaldiWindowId),value:(0,W.Z)("Export Passwords"),disabled:"IN_PROGRESS"===C}),"FAILED_CANCELLED"===C||"FAILED_WRITE_FAILED"===C&&(0,zn.jsx)(fa,{type:"error",children:(0,W.Z)("Export failed.")},"error"),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Passwords are exported in clear text without encryption.")})]})]}),(0,zn.jsx)(uj,{filter:e.filter})]})}const Tj=Un.memo(Zj),Ej=[Z.kCertRevocationCheckingEnabled],kj=I.Z.getEventHandler;function Nj(e){const t=Un.useContext(oi.Z),s=(0,Eo.Z)(Ej);return(0,zn.jsx)(Vy.Z,{categoryTitle:(0,W.Z)("Security"),filter:e.filter,children:(0,zn.jsxs)("div",{className:"setting-group unlimited",children:[(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Manage Certificates"),onClick:e=>{const{vivaldiWindowId:s}=t;re.Z.utilities.showManageSSLCertificates(s,(()=>{}))}}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Manage HTTPS/SSL certificates and settings.")})]}),(0,zn.jsxs)("div",{className:"setting-single pad-top",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kCertRevocationCheckingEnabled],onChange:kj(Z.kCertRevocationCheckingEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("Enable additional Certificate Revocation Checks (OCSP/CRL)")})]}),(0,zn.jsx)("p",{className:"info",children:(0,zn.jsx)("span",{children:(0,W.Z)("CRLSets and Stapled OCSP are checked, even when this setting is disabled.")})})]})]})})}const _j=Un.memo(Nj),Pj=[...ID,...RO,..._O,...oj,...wj].concat([]),Mj=[Z.kExceptionsCookies,Z.kCustomHandlersEnabled,Z.kPrivacyBlockPingsEnabled],Dj=Pj.filter((e=>!Mj.includes(e)));function Oj({filter:e,category:t,origin:s}){const n=nI({filter:e,prefPaths:Dj,name:t.title});return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsx)(cj,{filter:e})}),(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsx)(zD,{filter:e})}),(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsx)(_j,{filter:e})}),(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsx)(Tj,{filter:e})}),(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsx)(DO,{filter:e})}),(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsx)(_D,{filter:e})}),(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsx)(GO,{filter:e,origin:s})}),(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsx)(iO,{filter:e})}),Fn.Z.isEnabled("location_override")&&(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsx)(AO,{filter:e,category:t})}),n]})}const jj=Un.memo(Oj);var Lj=s(5422);const Rj=[{key:"CALCULATOR",name:(0,W.Z)("Calculator"),pref:Z.kQuickCommandsShowCalculator},{key:"NORMAL_COMMAND",name:(0,W.Z)("Commands")},{key:"COMMAND_CHAIN",name:(0,W.Z)("Command Chains")},{key:"KEYWORD_SEARCH",name:(0,W.Z)("Web Search & URL Entry")},{key:"WORKSPACES",name:(0,W.Z)("Workspaces")},{key:"SEND_TAB_TO_SELF",name:(0,W.Z)("Send Tab to Your Devices")},{key:"OPEN_TABS",name:(0,W.Z)("Open Tabs")},{key:"BOOKMARK_ITEM_OR_FOLDER",name:(0,W.Z)("Bookmarks"),pref:Z.kQuickCommandsShowBookmarks},{key:"READING_LIST",name:(0,W.Z)("Reading List"),pref:Z.kQuickCommandsShowReadingList},{key:"NOTES_SEARCH",name:(0,W.Z)("Notes"),pref:Z.kQuickCommandsShowNotes},{key:"HISTORY",name:(0,W.Z)("Browsing History"),pref:Z.kQuickCommandsShowHistory},{key:"EXTENSIONS",name:(0,W.Z)("Extensions"),pref:Z.kQuickCommandsShowExtensions},{key:"PAGE_ACTIONS",name:(0,W.Z)("Page Actions"),pref:Z.kQuickCommandsShowPageActions},{key:"CLOSED_TABS",name:(0,W.Z)("Closed Tabs")}],Bj=[Z.kActions,Z.kQuickCommandsKeepValue,Z.kQuickCommandsOpenUrlInNewTab,Z.kQuickCommandsSearchEnglish,Z.kQuickCommandsMatchNickname,Z.kQuickCommandsNicknameMatchInNewTab,Z.kQuickCommandsLimitResults,Z.kQuickCommandsSearchPriority,Z.kQuickCommandsShowBookmarks,Z.kQuickCommandsShowCalculator,Z.kQuickCommandsShowExtensions,Z.kQuickCommandsShowHistory,Z.kQuickCommandsShowPageActions,Z.kQuickCommandsShowNotes,Z.kQuickCommandsShowReadingList,Z.kQuickCommandsUseNotesManager,Z.kWorkspacesEnabled,Z.kChainedCommandsCommandList],Fj=Bj.filter((e=>e!==Z.kWorkspacesEnabled&&e!==Z.kActions)),Wj=I.Z.getEventHandler;function Uj(e){const t=A.Z.get(Z.kWorkspacesEnabled);return e.filter((e=>t||"WORKSPACES"!==e)).map((e=>({key:e,name:Rj.find((t=>t.key===e))?.name||""})))}var Vj=(0,zn.jsx)("br",{});function Hj(e){const t=(0,Eo.Z)(Bj),s=nI({filter:e.filter,prefPaths:Fj,name:e.category.title}),n=t[Z.kActions][0].COMMAND_SHOW_QUICK_COMMANDS.shortcuts||[];return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("section",{className:"setting-section",children:[(0,zn.jsxs)(Vy.Z,{categoryTitle:(0,W.Z)("Quick Commands"),filter:e.filter,children:[(0,zn.jsx)("div",{className:"info",children:n.length>0&&(0,zn.jsxs)(zn.Fragment,{children:[(0,W.Z)("Open Quick Commands with:")," ",(0,zn.jsx)("span",{className:"shortcut",children:n.map((e=>(0,zn.jsx)("kbd",{children:(0,vc.$)(e)},e)))}),Vj,(0,W.Z)("Press $1 or $2 keys with $3 modifier to skip to next search result section. Press $4 key to auto-complete input from current list selection.",[(0,vc.$)("Down"),(0,vc.$)("Up"),(0,vc.$)("Alt"),(0,vc.$)("Right")])]})}),(0,zn.jsx)("div",{className:"setting-group setting-group-double",children:(0,zn.jsxs)("div",{className:"setting-single list-priority",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Search Types and Priority")}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Select data types to include in Quick Command search results. Reorder the list to change default search highlight priority.")}),(0,zn.jsx)(Hy.Z,{filter:e.filter,items:Uj(t[Z.kQuickCommandsSearchPriority]),moveItem:(e,s)=>{const n=e=>{let s=0;if(!A.Z.get(Z.kWorkspacesEnabled)){const n=t[Z.kQuickCommandsSearchPriority];for(let t=0;t<=e;t++)"WORKSPACES"===n[t]&&s++}return s};e+=n(e),s+=n(s);const i=t[Z.kQuickCommandsSearchPriority].map((e=>e)),a=i.splice(e,1)[0];i.splice(s,0,a),I.Z.set(Z.kQuickCommandsSearchPriority,i)},renderListItem:(e,s)=>{const n=Rj.find((e=>e.key===s.key))?.pref,i=n&&t[n];return(0,zn.jsxs)(zn.Fragment,{children:[n?(0,zn.jsx)("input",{type:"checkbox",value:s.key,checked:i,onChange:Wj(n)}):(0,zn.jsx)("span",{style:{width:16}}),s.name]})},supportDragAndDrop:!0,mimeType:"vivaldi/x-settings-quick-command-type"}),(0,zn.jsx)("input",{type:"button",onClick:()=>{I.Z.reset(Z.kQuickCommandsSearchPriority)},value:(0,W.Z)("Reset Priority")})]})}),(0,zn.jsxs)("div",{className:"setting-group setting-group-double",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Quick Command Options")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kQuickCommandsKeepValue],onChange:Wj(Z.kQuickCommandsKeepValue)}),(0,zn.jsx)("span",{children:(0,W.Z)("Keep Last Typed Value")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kQuickCommandsLimitResults],onChange:Wj(Z.kQuickCommandsLimitResults)}),(0,zn.jsx)("span",{children:(0,W.Z)("Limit Number of Visible Search Results")})]})}),!navigator.language.startsWith("en")&&(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kQuickCommandsSearchEnglish],onChange:Wj(Z.kQuickCommandsSearchEnglish)}),(0,zn.jsx)("span",{children:(0,W.Z)("Include English Search Terms")})]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Include English equivalent of command names in search results")})]}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kQuickCommandsOpenUrlInNewTab],onChange:Wj(Z.kQuickCommandsOpenUrlInNewTab)}),(0,zn.jsx)("span",{children:(0,W.Z)("Open Links in New Tab")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kQuickCommandsMatchNickname],onChange:Wj(Z.kQuickCommandsMatchNickname)}),(0,zn.jsx)("span",{children:(0,W.Z)("Open Bookmarks on Nickname Match")})]})}),(0,zn.jsx)("div",{className:"setting-single pad-left",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",disabled:!t[Z.kQuickCommandsMatchNickname],checked:t[Z.kQuickCommandsNicknameMatchInNewTab],onChange:Wj(Z.kQuickCommandsNicknameMatchInNewTab)}),(0,zn.jsx)("span",{children:(0,W.Z)("In a New Tab")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kQuickCommandsUseNotesManager],onChange:Wj(Z.kQuickCommandsUseNotesManager)}),(0,zn.jsx)("span",{children:(0,W.Z)("Open Notes in Notes Manager")})]})})]})]}),(0,zn.jsx)(Vy.Z,{categoryTitle:(0,W.Z)("Command Chains"),filter:e.filter,children:(0,zn.jsx)(Lj.Z,{filter:e.filter,category:e.category})})]}),s]})}const Gj=Un.memo(Hj);const Kj={title:(0,W.Z)("title","Name"),Nickname:(0,W.Z)("Nickname"),"Nickname in use by $1":(0,W.Z)("Nickname in use by $1",[""]),URL:(0,W.Z)("URL"),"POST Parameters":(0,W.Z)("POST Parameters"),"Substitute search keyword in addresses or post parameters with %s or %S":(0,W.Z)("Substitute search keyword in addresses or post parameters with %s or %S"),"Empty post parameters disable the use of POST. Post parameters are in the form name=value,name=value":(0,W.Z)("Empty post parameters disable the use of POST. Post parameters are in the form name=value,name=value"),"Suggest URL":(0,W.Z)("Suggest URL"),"Suggest POST Parameters":(0,W.Z)("Suggest POST Parameters"),"Image Search URL":(0,W.Z)("Image Search URL"),"Image Search POST Parameters":(0,W.Z)("Image Search POST Parameters"),"Set as Default Search":(0,W.Z)("Set as Default Search"),"Set as Private Search":(0,W.Z)("Set as Private Search")};function zj(e){const t=pn.Z.getByGuid(e);return t&&e?{guid:e,extensionId:t.extensionId,extensionName:"",name:t.name?t.name.trim():"",url:t.url.trim(),postParams:t.postParams?t.postParams.trim():"",suggestUrl:t.suggestUrl?t.suggestUrl.trim():"",suggestPostParams:t.suggestPostParams?t.suggestPostParams.trim():"",imageUrl:t.imageUrl?t.imageUrl.trim():"",imagePostParams:t.imagePostParams?t.imagePostParams.trim():"",faviconUrl:t.faviconUrl?t.faviconUrl.trim():"",keyword:t.keyword,default:pn.Z.isDefault(e,!1),private:pn.Z.isDefault(e,!0),nicknameTaken:!1,readOnly:t.readOnly}:{guid:e,extensionId:"",extensionName:"",name:"",url:"",postParams:"",suggestUrl:"",suggestPostParams:"",imageUrl:"",imagePostParams:"",faviconUrl:"",keyword:"",default:!1,private:!1,nicknameTaken:!1,readOnly:!0}}class $j extends Un.Component{static contextType=oi.Z;urlHasChanged=!1;constructor(e,t){super(e),this.state=zj(e.guid),this.convertExtensionIdToName(this.state.extensionId)}static getDerivedStateFromProps(e,t){return e.guid!==t.guid?zj(e.guid):null}componentDidMount(){pn.Z.addListener(this._onSearchEngineCacheChanged)}componentWillUnmount(){pn.Z.removeListener(this._onSearchEngineCacheChanged)}componentDidUpdate(e,t){e.guid!==this.props.guid&&(this.save(t,!1),this.urlHasChanged=!1)}_onSearchEngineCacheChanged=()=>{const e=pn.Z.getDefault(!1),t=pn.Z.getDefault(!0);this.setState({default:e?.guid===this.props.guid,private:t?.guid===this.props.guid})};convertExtensionIdToName=e=>{e&&n.Z.management.getAll().then((t=>t.find((t=>t.id===e))?.name)).then((e=>e&&this.setState({extensionName:e})))};handleKeyDown=e=>{"Enter"===e.key&&this.save()};handleBlur=()=>{this.props.guid===this.state.guid&&this.save()};getDataUri=(e,t)=>{const{document:s}=this.context,n=new Image;n.onload=function(){const n=s.createElement("canvas");n.width=this.naturalWidth,n.height=this.naturalHeight,n.getContext("2d").drawImage(this,0,0),t(n.toDataURL(e))},n.src=e};constructFavicon=e=>{const{document:t}=this.context;if((e=e.trim())&&!this.state.faviconUrl){const s=(0,Ar.q9)(e),n=t.createElement("a");n.href=s;const i=n.protocol+"//"+n.host+"/favicon.ico";this.getDataUri(i,(e=>{this.urlHasChanged&&this.setState({faviconUrl:e},(()=>this.save()))}))}};canSave=e=>Boolean(e.guid&&!e.nicknameTaken&&""!==e.keyword&&""!==e.name&&""!==e.url);save=(e=this.state,t=!0)=>{if(!this.canSave(e))return;const s=pn.Z.getByGuid(e.guid);if(!s)return;const n=structuredClone(s);n.guid=e.guid,n.name=e.name,n.keyword=e.keyword,n.url=e.url.trim(),n.postParams=e.postParams.trim(),n.suggestUrl=e.suggestUrl.trim(),n.suggestPostParams=e.suggestPostParams.trim(),n.imageUrl=e.imageUrl.trim(),n.imagePostParams=e.imagePostParams.trim(),n.suggestPostParams=e.suggestPostParams.trim(),this.urlHasChanged&&(n.faviconUrl=e.faviconUrl);const i=pn.Z.getDefault(!1)?.guid,a=pn.Z.getDefault(!0)?.guid;(0,sw.Z)(n,s)||re.Z.searchEngines.updateTemplateUrl(n),e.default!==(i===e.guid)&&(re.Z.searchEngines.setDefault("defaultSearch",e.guid),re.Z.searchEngines.setDefault("defaultSearchField",e.guid),re.Z.searchEngines.setDefault("defaultSpeeddials",e.guid)),e.private!==(a===e.guid)&&(e.private?(re.Z.searchEngines.setDefault("defaultPrivate",e.guid),re.Z.searchEngines.setDefault("defaultSearchFieldPrivate",e.guid),re.Z.searchEngines.setDefault("defaultSpeeddialsPrivate",e.guid)):a===s.guid&&i&&(re.Z.searchEngines.setDefault("defaultPrivate",i),re.Z.searchEngines.setDefault("defaultSearchFieldPrivate",i),re.Z.searchEngines.setDefault("defaultSpeeddialsPrivate",i)))};nameChange=e=>{this.setState({name:e.target.value})};nicknameChange=e=>{const t=e.target.value.trim();let s=t.length>0&&void 0!==pn.Z.getByKeyword(t);if(s&&this.props.guid){const e=pn.Z.getByGuid(this.props.guid);e&&e.keyword===t&&(s=!1)}this.setState({keyword:t,nicknameTaken:s})};urlChange=e=>{const t=e.target.value;(0,Ar.C3)(t)&&this.constructFavicon(t),this.setState({url:t}),this.urlHasChanged=!0};postParamsChange=e=>{this.setState({postParams:e.target.value})};suggestUrlChange=e=>{this.setState({suggestUrl:e.target.value})};suggestPostParamsChange=e=>{this.setState({suggestPostParams:e.target.value})};imageUrlChange=e=>{this.setState({imageUrl:e.target.value})};imagePostParamsChange=e=>{this.setState({imagePostParams:e.target.value})};defaultChange=e=>{this.setState({default:e.target.checked},(()=>this.save()))};privateChange=e=>{this.setState({private:e.target.checked},(()=>this.save()))};openExtensionsPage=()=>{const{extensionId:e}=this.state;e&&c.ZP.openURL(this.context.vivaldiWindowId,`vivaldi://extensions/?id=${e}`,{singleton:!0})};render(){const e=this.state.nicknameTaken?pn.Z.getByKeyword(this.state.keyword):null,t=e?e.name:"";return(0,zn.jsx)("div",{className:"detail",children:(0,zn.jsxs)("div",{className:"detail-content",children:[this.state.extensionId&&(0,zn.jsxs)(fa,{type:"info",children:[(0,W.Z)("This search engine is added by “$1” extension.",[this.state.extensionName])," ",(0,zn.jsx)(Vx.Z,{onClick:this.openExtensionsPage,children:(0,W.Z)("Show Extension")})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(Vr.Z,{type:"text",focusInput:this.props.focusNameInput,label:this.props.searchableStrings.title,value:this.state.name,onBlur:this.handleBlur,onChange:this.nameChange,onKeyDown:this.handleKeyDown,disabled:this.state.readOnly})}),""===this.state.name.trim()&&(0,zn.jsx)(fa,{type:"warning",children:(0,W.Z)("Name cannot be empty")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(Vr.Z,{type:"text",label:this.props.searchableStrings.Nickname,value:this.state.keyword,onBlur:this.handleBlur,onChange:this.nicknameChange,onKeyDown:this.handleKeyDown,disabled:this.state.readOnly})}),""===this.state.keyword&&(0,zn.jsx)(fa,{type:"warning",children:(0,W.Z)("Nickname cannot be empty")}),this.state.nicknameTaken&&(0,zn.jsx)(fa,{type:"warning",children:(0,W.Z)("Nickname in use by $1",[t])})]}),(0,zn.jsx)("p",{className:"info",children:this.props.searchableStrings["Substitute search keyword in addresses or post parameters with %s or %S"]}),(0,zn.jsx)("p",{className:"info",children:this.props.searchableStrings["Empty post parameters disable the use of POST. Post parameters are in the form name=value,name=value"]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(Vr.Z,{type:"text",label:this.props.searchableStrings.URL,value:this.state.url,onBlur:this.handleBlur,onChange:this.urlChange,onKeyDown:this.handleKeyDown,disabled:this.state.readOnly})}),""===this.state.url.trim()&&(0,zn.jsx)(fa,{type:"warning",children:(0,W.Z)("URL cannot be empty")}),""!==this.state.url.trim()&&(0,Ar.Zj)(this.state.url)&&!this.state.url.startsWith("{")&&(0,zn.jsx)(fa,{type:"warning",children:(0,W.Z)("You must provide a valid protocol")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(Vr.Z,{type:"text",label:this.props.searchableStrings["POST Parameters"],value:this.state.postParams,onBlur:this.handleBlur,onChange:this.postParamsChange,onKeyDown:this.handleKeyDown,disabled:this.state.readOnly})})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(Vr.Z,{type:"text",label:this.props.searchableStrings["Suggest URL"],value:this.state.suggestUrl,onBlur:this.handleBlur,onChange:this.suggestUrlChange,onKeyDown:this.handleKeyDown,disabled:this.state.readOnly})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(Vr.Z,{type:"text",label:this.props.searchableStrings["Suggest POST Parameters"],value:this.state.suggestPostParams,onBlur:this.handleBlur,onChange:this.suggestPostParamsChange,onKeyDown:this.handleKeyDown,disabled:this.state.readOnly})})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(Vr.Z,{type:"text",label:this.props.searchableStrings["Image Search URL"],value:this.state.imageUrl,onBlur:this.handleBlur,onChange:this.imageUrlChange,onKeyDown:this.handleKeyDown,disabled:this.state.readOnly})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(Vr.Z,{type:"text",label:this.props.searchableStrings["Image Search POST Parameters"],value:this.state.imagePostParams,onBlur:this.handleBlur,onChange:this.imagePostParamsChange,onKeyDown:this.handleKeyDown,disabled:this.state.readOnly})})]}),(0,zn.jsxs)("div",{className:"setting-group pad-top",children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.state.default,disabled:this.state.default,onChange:this.defaultChange}),(0,zn.jsx)("span",{children:this.props.searchableStrings["Set as Default Search"]})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.state.private,disabled:this.state.default&&this.state.private,onChange:this.privateChange}),(0,zn.jsx)("span",{children:this.props.searchableStrings["Set as Private Search"]})]})})]})]})})}}const Yj=$j;class Xj extends Un.Component{static contextType=oi.Z;state={currentSearchEngine:void 0,thanksState:!1};componentDidMount(){pn.Z.addListener(this._onSearchEngineCacheChanged)}componentWillUnmount(){pn.Z.removeListener(this._onSearchEngineCacheChanged)}_onSearchEngineCacheChanged=()=>{const e=fe.ZP.isIncognito(this.context.vivaldiWindowId),t=pn.Z.getDefault(e),s=pn.Z.getSpeeddialsSearch(e),n=pn.Z.getSearchField(e);t?.prepopulateId!==pn.A&&s?.prepopulateId!==pn.A&&n?.prepopulateId!==pn.A||this.setState({thanksState:!1,currentSearchEngine:void 0})};_updateCurrentEngine=e=>{const t=pn.Z.getByPrepopulateId(Number(e));t&&this.setState({currentSearchEngine:t,thanksState:!0},(()=>{const e=fe.ZP.isIncognito(this.context.vivaldiWindowId),s=pn.Z.getDefault(e),n=pn.Z.getSpeeddialsSearch(e),i=pn.Z.getSearchField(e);if(1===s?.prepopulateId){const s=e?"defaultPrivate":"defaultSearch";re.Z.searchEngines.setDefault(s,t.guid)}if(1===n?.prepopulateId){const s=e?"defaultSpeeddialsPrivate":"defaultSpeeddials";re.Z.searchEngines.setDefault(s,t.guid)}if(1===i?.prepopulateId){const s=e?"defaultSearchFieldPrivate":"defaultSearchField";re.Z.searchEngines.setDefault(s,t.guid)}}))};render(){const e=function(){const e=[3,4,5,7];return pn.Z.get().reduce(((e,t)=>{let s="";switch(t.prepopulateId){case 3:s=(0,W.Z)("Powerful AI tools. Speed.");break;case 4:s=(0,W.Z)("A better planet with every search.");break;case 5:s=(0,W.Z)("Powered by Google. Does not track you.");break;case 7:s=(0,W.Z)("Privacy first. Does not track you.");break;default:return e}return e.push({type:"Description",id:t.prepopulateId.toString(),name:t.name,icon:t.faviconUrl,description:s}),e}),[]).sort(((t,s)=>e.indexOf(t.id)-e.indexOf(s.id)))}(),{thanksState:t}=this.state;return(0,zn.jsxs)("div",{className:"tracker-warning",children:[(0,zn.jsx)("button",{className:"close",onClick:()=>{I.Z.set(Z.kStartpageSpeedDialTrackerSuggestionShow,!1)},dangerouslySetInnerHTML:{__html:Kn.kze}}),!this.props.hideImg&&(0,zn.jsx)("img",{className:"tony-illustration",src:t?"resources/tony_thanks.png":"resources/support_tony.png",align:"left"}),t?(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("h1",{children:(0,W.Z)("Thank you for supporting Vivaldi")}),(0,zn.jsx)("p",{children:(0,W.Z)("We appreciate your decision and thank you for helping us stay sustainable. You can try one of our other partners if you're unhappy with the results from your first choice.")})]}):(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("h1",{children:(0,W.Z)("Support Vivaldi")}),(0,zn.jsx)("p",{children:(0,W.Z)("We are building the best browser for you. To be able to do this we rely on revenue from our search partners. Consider one of these search engines to help support us:")})]}),(0,zn.jsxs)("div",{className:"engine-suggestion-container",children:[(0,zn.jsx)(WE,{className:"engine-suggestion",items:e,value:this.state.currentSearchEngine?.prepopulateId?.toString()??"",onValueChange:this._updateCurrentEngine,tooltip:(0,W.Z)("Select Default Search Engine")}),(0,zn.jsx)("a",{className:"support-vivaldi",href:"https://vivaldi.com/contribute/",onClick:()=>{c.ZP.openURL(this.context.vivaldiWindowId,"https://vivaldi.com/contribute/")},children:(0,W.Z)("Other Ways To Support Vivaldi")})]})]})}}const Qj=(0,zd.Z)(Xj,[]);var qj=s(34155);const Jj=[Z.kAddressBarInlineSearchEnabled,Z.kSearchSuggestEnabled,Z.kAddressBarInlineSearchSuggestOnNickname,Z.kAddressBarSearchAllowExtensionOverride,Z.kAddressBarSearchDisplay,Z.kAddressBarSearchInNewTab,Z.kAddressBarSearchKeepSelected,Z.kAddressBarSearchShowFavicon,Z.kAddressBarSearchShowKeyword,Z.kAddressBarSearchSuggestEnabled,Z.kPageSearchInBackground,Z.kAddressBarSearchKeepTypedText,Z.kStartpageSpeedDialDisplaySearch,Z.kAddressBarSearchDirectMatchEnabled,Z.kStartpageSpeedDialTrackerSuggestionShow],eL=Jj.filter((e=>e!==Z.kStartpageSpeedDialTrackerSuggestionShow)),tL=I.Z.getEventHandler,sL={width:400,minWidth:"unset"};function nL({engines:e,selectedEngine:t,onValueChange:s,tooltip:n}){const i=e.map((e=>({type:"Normal",id:e.guid,name:e.name,faviconUrl:e.faviconUrl,checked:t?.guid===e.guid})));return(0,zn.jsx)(WE,{items:i,value:t?t.guid:"",onValueChange:s,tooltip:n})}var iL=(0,zn.jsx)("input",{type:"radio",value:"field"}),aL=(0,zn.jsx)("input",{type:"radio",value:"button"}),oL=(0,zn.jsx)("div",{className:"setting-single pad-left"});function rL(e){const t=Un.useContext(oi.Z),s=(0,Eo.Z)(Jj),n=nI({filter:e.filter,prefPaths:eL,name:e.category.title}),i=Un.useRef(!1),a=Un.useRef(0),[o,r]=(Un.useRef(),Un.useState(!1)),[l,d]=Un.useState(!1),[h,u]=Un.useState(pn.Z.get());Un.useEffect((()=>{function e(){u(pn.Z.get())}return pn.Z.addListener(e),()=>pn.Z.removeListener(e)}),[]);const p=()=>{re.Z.searchEngines.repairPrepopulatedTemplateUrls(!l),r(!1)},g=(e,t)=>{re.Z.searchEngines.setDefault(t?"defaultPrivate":"defaultSearch",e),a.current=(a.current??0)+1},m=()=>{r(!1)};var f=(0,zn.jsx)("input",{type:"checkbox",checked:l,onChange:()=>{d((e=>!e))}});if(!h)return null;const v=pn.Z.getDefault(!1),b=pn.Z.getDefault(!0),C=pn.Z.getImageSearch(),w=h.filter((e=>e.imageUrl));C&&!w.find((e=>e.guid===C.guid))&&w.push(C);const y=h.map((e=>({key:e.guid,name:e.name,isDefault:e.guid===v?.guid,isStatic:""!==e.extensionId,isRemovable:pn.Z.isRemovable(e.guid)&&!e.extensionId})));return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsxs)(Vy.Z,{categoryTitle:(0,W.Z)("noun","Search"),filter:e.filter,children:[o&&(()=>{const e=l?(0,W.Z)("Search engines will be reset to default settings, but your custom search engines will be kept."):(0,W.Z)("Search engines will be reset to default settings, which will also reset your custom search engines.");return(0,zn.jsx)(Ha.Z,{style:sL,className:"float",onRequestClose:m,title:(0,W.Z)("Restore Default Search Engines?"),children:(0,zn.jsxs)("div",{className:"dialog-restore-search",children:[(0,zn.jsx)("div",{className:"dialog-content",children:(0,zn.jsx)("p",{children:e})}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsxs)("label",{children:[f,(0,zn.jsx)("span",{children:(0,W.Z)("Keep Custom Searches")})]}),(0,zn.jsx)("input",{type:"button",className:"danger",onClick:p,value:(0,W.Z)("Restore")}),(0,zn.jsx)("input",{type:"button",onClick:m,value:(0,W.Z)("Cancel"),autoFocus:!0})]})]})})})(),(0,zn.jsxs)("div",{children:[!1,(0,zn.jsx)("div",{className:"setting-group",children:(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Default Search Engine")}),(0,zn.jsx)(nL,{engines:h,selectedEngine:v,onValueChange:e=>{re.Z.searchEngines.setDefault("defaultSearch",e),re.Z.searchEngines.setDefault("defaultSearchField",e),re.Z.searchEngines.setDefault("defaultSpeeddials",e)},tooltip:(0,W.Z)("Select Default Search Engine")})]})}),(0,zn.jsx)("div",{className:"setting-group",children:(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Private Window Search Engine")}),(0,zn.jsx)(nL,{engines:h,selectedEngine:b,onValueChange:e=>{re.Z.searchEngines.setDefault("defaultPrivate",e),re.Z.searchEngines.setDefault("defaultSearchFieldPrivate",e),re.Z.searchEngines.setDefault("defaultSpeeddialsPrivate",e)},tooltip:(0,W.Z)("Select Private Window Search Engine")})]})}),(0,zn.jsx)("div",{className:"setting-group",children:(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Image Search Engine")}),(0,zn.jsx)(nL,{engines:w,selectedEngine:C,onValueChange:e=>re.Z.searchEngines.setDefault("defaultImage",e),tooltip:(0,W.Z)("Select Default Search Engine for Images")})]})})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Search Field Display")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)("label",{children:(0,zn.jsxs)(To.Z,{name:"renderSearchField",value:s[Z.kAddressBarSearchDisplay],onChange:tL(Z.kAddressBarSearchDisplay),children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[iL,(0,zn.jsx)("span",{children:(0,W.Z)("Show as a Text Field")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[aL,(0,zn.jsx)("span",{children:(0,W.Z)("Show as a Button")})]})})]})})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kAddressBarSearchShowKeyword],onChange:tL(Z.kAddressBarSearchShowKeyword)}),(0,zn.jsx)("span",{children:(0,W.Z)("Show Search Engine Nickname in Drop-Down Menu")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kAddressBarSearchInNewTab],onChange:tL(Z.kAddressBarSearchInNewTab)}),(0,zn.jsx)("span",{children:(0,W.Z)("Always Search in New Tab")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kAddressBarSearchShowFavicon],onChange:tL(Z.kAddressBarSearchShowFavicon)}),(0,zn.jsx)("span",{children:(0,W.Z)("Show Search Engine Icon")})]})})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Search Options")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kAddressBarInlineSearchEnabled],onChange:tL(Z.kAddressBarInlineSearchEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("Search in Address Field")})]})}),(0,zn.jsxs)("div",{className:"setting-single pad-left",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kAddressBarSearchAllowExtensionOverride],onChange:tL(Z.kAddressBarSearchAllowExtensionOverride)}),(0,zn.jsx)("span",{children:(0,W.Z)("Allow Control by Extensions")})]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Requires a restart to take effect")})]}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kStartpageSpeedDialDisplaySearch],onChange:tL(Z.kStartpageSpeedDialDisplaySearch)}),(0,zn.jsx)("span",{children:(0,W.Z)("Show Search Field on Speed Dial")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kAddressBarSearchKeepSelected],onChange:tL(Z.kAddressBarSearchKeepSelected)}),(0,zn.jsx)("span",{children:(0,W.Z)("Keep Last Selected Search Engine")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kAddressBarSearchKeepTypedText],onChange:tL(Z.kAddressBarSearchKeepTypedText)}),(0,zn.jsx)("span",{children:(0,W.Z)("Keep Typed Text After Searching")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kPageSearchInBackground],onChange:tL(Z.kPageSearchInBackground)}),(0,zn.jsx)("span",{children:(0,W.Z)("Page Selection Search in Background")})]})})]}),(0,zn.jsx)("div",{className:"setting-group",children:(0,zn.jsxs)("div",{id:"searchSuggest",className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Allow Search Suggestions")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kSearchSuggestEnabled],onChange:tL(Z.kSearchSuggestEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("searchengine","In Address Field")})]})}),(0,zn.jsx)("div",{className:"setting-single pad-left",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kAddressBarInlineSearchSuggestOnNickname],disabled:!s[Z.kSearchSuggestEnabled],onChange:tL(Z.kAddressBarInlineSearchSuggestOnNickname)}),(0,zn.jsx)("span",{children:(0,W.Z)("Only when Using Search Engine Nickname")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kAddressBarSearchSuggestEnabled],onChange:tL(Z.kAddressBarSearchSuggestEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("searchengine","In Search Field")})]})}),(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:s[Z.kAddressBarSearchDirectMatchEnabled],onChange:tL(Z.kAddressBarSearchDirectMatchEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("searchengine","Enable Direct Match")})]}),(0,zn.jsx)("a",{className:"info",onClick:()=>c.ZP.openURL(t.vivaldiWindowId,"https://help.vivaldi.com/others/what-is-direct-match/"),href:"https://help.vivaldi.com/others/what-is-direct-match/",children:(0,W.Z)("Learn more about Direct Match")})]})]})}),(0,zn.jsx)(SS.Z,{className:"setting-search-engine",filter:e.filter,subtitle:(0,W.Z)("Search Engine Editor"),deleteTitle:(0,W.Z)("title","Delete Search Engine"),addTipString:(0,W.Z)("Add Search Engine"),deleteTipString:(0,W.Z)("tooltip","Delete Search Engine"),items:y,supportDragAndDrop:!0,masterLayout:1,mimeType:"vivaldi/x-search-engine",renderListItem:(e,t)=>{const s=pn.Z.getByGuid(t.key);if(!s)return(0,zn.jsx)(zn.Fragment,{children:(0,zn.jsx)("div",{className:"item-title",children:e||"Error"})});const n=pn.Z.isDefault(s.guid,!0),i=s.guid===pn.Z.getImageSearch()?.guid;return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)(Vn.ZP,{className:"item-icon",url:s.faviconUrl,loadType:"faviconFromCache"}),(0,zn.jsx)("div",{className:"item-title",children:e||s.name}),n&&(0,zn.jsx)("span",{className:"item-badge",title:(0,W.Z)("Private Window Search Engine"),children:(0,W.Z)("Private")}),i&&(0,zn.jsx)("span",{className:"item-badge",title:(0,W.Z)("Default Image Search Engine"),children:(0,W.Z)("Image")}),(0,zn.jsx)("div",{className:"item-meta",children:s.keyword})]})},renderContent:(t,s)=>{const n=h[t];return n?(0,zn.jsx)(Yj,{focusNameInput:Boolean(i.current),searchableStrings:s,filter:e.filter,guid:n.guid},n.guid):null},contentStrings:Kj,moveItem:(e,t)=>{const s=e<t?t+1:t;if(e>=0&&e<h.length&&s>=0&&s<=h.length){const t=h[e];if(s===h.length)re.Z.searchEngines.moveTemplateUrl(t.guid);else{const e=h[s];re.Z.searchEngines.moveTemplateUrl(t.guid,e.guid)}}},onContextMenu:(e,s)=>{const n=[];if(e>=0&&e<h.length){const t=h[e];pn.Z.isDefault(t.guid,!1)||n.push({handler:()=>g(t.guid,!1),...(0,fi.Z)("searchengine","Set as Default Search")}),pn.Z.isDefault(t.guid,!0)||n.push({handler:()=>g(t.guid,!0),...(0,fi.Z)("searchengine","Set as Private Search")})}(0,mi.Z)(t,n)(s)},onActivate:e=>{if(e>=0&&e<h.length){const t=h[e];g(t.guid,!1)}},onRemove:e=>{if(e>=0&&e<h.length){const t=h[e];re.Z.searchEngines.removeTemplateUrl(t.guid)}},onCreateItem:async()=>{const e=xr();e.name=(0,W.Z)("New Engine"),await re.Z.searchEngines.addTemplateUrl(e),i.current=!0,qj.nextTick((()=>i.current=!1))}}),(0,zn.jsx)("div",{className:"setting-group unlimited",children:(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("input",{type:"button",onClick:()=>{r(!0),qj.nextTick((()=>{a.current=(a.current??0)+1}))},value:(0,W.Z)("Restore Defaults")}),oL]})})]})}),n]})}const lL=Un.memo(rL),dL=["appearance","tabs","qc","privacy","mail","all"];class cL extends Un.PureComponent{rowComponent=e=>{const t=e.node,s=this.props.selectedCategory.title===t.title;return(0,zn.jsxs)("div",{onMouseDown:e=>e.preventDefault(),className:Gn()({"button-category":!0,"category-selected":s,spacer:dL.includes(t.key),["group_"+t.group]:!0}),children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:t.icon}}),t.title]},t.id)};getHeight=e=>{const t=e.title.length;return 8*Math.ceil(t/24)+20+(dL.includes(e.key)?12:0)};handleItemClick=(e,{key:t})=>{this.props.onCategorySelected(t)};handleItemsActivated=(e,t)=>{this.props.onCategorySelected(t[0].key)};handleFilterChange=({currentTarget:e})=>{this.props.onFilterChange(e.value)};render(){return(0,zn.jsxs)("div",{className:"settings-sidebar",children:[(0,zn.jsx)("header",{className:"settings-navigation-header",children:(0,zn.jsx)("input",{className:"settings-search",type:"search",ref:this.props.focusRef,placeholder:(0,W.Z)("verb","Search"),value:this.props.filter,onChange:this.handleFilterChange,autoFocus:fe.ZP.isSettings(this.context.vivaldiWindowId),tabIndex:"0"})}),(0,zn.jsx)(Mi,{rowComponent:this.rowComponent,nodes:(this.props.selectedCategory,Object.keys(vs.mh).filter((e=>"chat"!==e&&!("reset"===e))).map((e=>({...vs.mh[e],key:e})))),className:"settings-navigation",settings:"SETTINGS_TREE",onItemClick:this.handleItemClick,onItemsActivated:this.handleItemsActivated,enableDragAndDrop:!1,rowHeight:this.getHeight,isFolder:iy.Z,hasChildren:iy.Z,multiSelect:!1})]})}}const hL=cL,uL=[Z.kStartpageNavigation,Z.kStartpageSpeedDialAddButtonVisible,Z.kStartpageSpeedDialAllowDnd,Z.kStartpageSpeedDialColumns,Z.kStartpageSpeedDialControlsVisible,Z.kStartpageSpeedDialDeleteVisible,Z.kStartpageSpeedDialFaviconVisible,Z.kDashboardEnabled,Z.kStartpageSpeedDialGameButtonShow,Z.kStartpageSpeedDialTitlesVisible,Z.kDashboardColumnLimit,Z.kStartpageSpeedDialRestorePage,Z.kStartpageSpeedDialSize,Z.kStartpageSpeedDialPrivacyStatsShow],pL=I.Z.getEventHandler,gL=new Map([["icon",{value:90,label:(0,W.Z)("other","Icon")}],["tiny",{value:120,label:(0,W.Z)("Tiny")}],["small",{value:170,label:(0,W.Z)("other","Small")}],["medium",{value:220,label:(0,W.Z)("other","Medium")}],["large",{value:270,label:(0,W.Z)("other","Large")}],["huge",{value:320,label:(0,W.Z)("Huge")}],["fit_to_columns",{value:-1,label:(0,W.Z)("Scale to Fit Columns")}]]);var mL=(0,zn.jsx)("input",{type:"radio",value:"on"}),fL=(0,zn.jsx)("input",{type:"radio",value:"speed_dial_only"}),vL=(0,zn.jsx)("input",{type:"radio",value:"off"}),bL=(0,zn.jsx)("input",{type:"radio",value:"true"}),CL=(0,zn.jsx)("input",{type:"radio",value:"false"}),wL=(0,zn.jsx)("option",{value:1,children:"1"}),yL=(0,zn.jsx)("option",{value:2,children:"2"}),xL=(0,zn.jsx)("option",{value:3,children:"3"}),IL=(0,zn.jsx)("option",{value:4,children:"4"}),AL=(0,zn.jsx)("input",{type:"radio",value:"always"}),SL=(0,zn.jsx)("input",{type:"radio",value:"hover"}),ZL=(0,zn.jsx)("input",{type:"radio",value:"never"}),TL=(0,zn.jsx)("option",{value:1,children:"1"}),EL=(0,zn.jsx)("option",{value:2,children:"2"}),kL=(0,zn.jsx)("option",{value:3,children:"3"}),NL=(0,zn.jsx)("option",{value:4,children:"4"}),_L=(0,zn.jsx)("option",{value:5,children:"5"}),PL=(0,zn.jsx)("option",{value:6,children:"6"}),ML=(0,zn.jsx)("option",{value:7,children:"7"}),DL=(0,zn.jsx)("option",{value:8,children:"8"}),OL=(0,zn.jsx)("option",{value:10,children:"10"}),jL=(0,zn.jsx)("option",{value:12,children:"12"});function LL(e){const t=(0,Eo.Z)(uL),s=nI({filter:e.filter,prefPaths:uL,name:e.category.title});return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("section",{className:"setting-section",children:[(0,zn.jsx)(Vy.Z,{categoryTitle:(0,W.Z)("verb","Start Page"),filter:e.filter,children:(0,zn.jsxs)("div",{className:"setting-group unlimited",children:[(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Start Page Navigation")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)(To.Z,{name:"StartPageNavigation",value:t[Z.kStartpageNavigation],onChange:pL(Z.kStartpageNavigation),children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[mL,(0,zn.jsx)("span",{children:(0,W.Z)("Show on Internal Pages")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[fL,(0,zn.jsx)("span",{children:(0,W.Z)("Show on Speed Dial and Dashboard")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[vL,(0,zn.jsx)("span",{children:(0,W.Z)("radio","Hide")})]})})]})})]}),(0,zn.jsx)("div",{className:"setting-group setting-group-double",children:(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)(To.Z,{name:"StartPageRestore",value:t[Z.kStartpageSpeedDialRestorePage],onChange:pL(Z.kStartpageSpeedDialRestorePage,"convert"),children:[(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Reopen Speed Dial with")}),(0,zn.jsxs)("label",{children:[bL,(0,zn.jsx)("span",{children:(0,W.Z)("Last Selected Group")})]})]}),(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[CL,(0,zn.jsx)("span",{children:(0,W.Z)("First Group")})]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Drag and drop groups in Speed Dial navigation to reorder.")})]})]})})})]})}),(0,zn.jsx)(Vy.Z,{categoryTitle:(0,W.Z)("verb","Dashboard"),filter:e.filter,children:(0,zn.jsx)("div",{className:"setting-group unlimited",children:(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kDashboardEnabled],onChange:E}),(0,zn.jsx)("span",{children:(0,W.Z)("Enable Dashboard")})]})}),(0,zn.jsxs)("div",{className:"setting-single pad-top",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Maximum Columns")}),(0,zn.jsxs)(Fa.Z,{className:"max-columns",value:t[Z.kDashboardColumnLimit],onChange:pL(Z.kDashboardColumnLimit),title:(0,W.Z)("Maximum number of Dashboard columns"),children:[wL,yL,xL,IL]})]})]})})}),(0,zn.jsxs)(Vy.Z,{categoryTitle:(0,W.Z)("Speed Dial"),filter:e.filter,children:[(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Speed Dial Appearance")}),(0,zn.jsxs)(To.Z,{name:"SpeedDialTitles",value:t[Z.kStartpageSpeedDialTitlesVisible],onChange:pL(Z.kStartpageSpeedDialTitlesVisible),children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[AL,(0,zn.jsx)("span",{children:(0,W.Z)("Show Title")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[SL,(0,zn.jsx)("span",{children:(0,W.Z)("Show Title on Hover")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[ZL,(0,zn.jsx)("span",{children:(0,W.Z)("Hide Title")})]})})]}),(0,zn.jsx)("div",{className:"setting-single pad-top",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kStartpageSpeedDialFaviconVisible],onChange:pL(Z.kStartpageSpeedDialFaviconVisible),disabled:"never"===t[Z.kStartpageSpeedDialTitlesVisible]}),(0,zn.jsx)("span",{children:(0,W.Z)("Show Favicon")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kStartpageSpeedDialDeleteVisible],onChange:pL(Z.kStartpageSpeedDialDeleteVisible)}),(0,zn.jsx)("span",{children:(0,W.Z)("Show Delete Button")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kStartpageSpeedDialControlsVisible],onChange:pL(Z.kStartpageSpeedDialControlsVisible)}),(0,zn.jsx)("span",{children:(0,W.Z)("Show Thumbnail Control Buttons")})]})}),(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kStartpageSpeedDialAddButtonVisible],onChange:pL(Z.kStartpageSpeedDialAddButtonVisible)}),(0,zn.jsx)("span",{children:(0,W.Z)("Show “Add” Button")})]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("When disabled, new bookmarks can be added by double-clicking the Speed Dial background.")})]}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kStartpageSpeedDialPrivacyStatsShow],onChange:pL(Z.kStartpageSpeedDialPrivacyStatsShow)}),(0,zn.jsx)("span",{children:(0,W.Z)("Show Privacy Statistics")})]})})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Maximum Columns")}),(0,zn.jsxs)(Fa.Z,{className:"max-columns",value:t[Z.kStartpageSpeedDialColumns],onChange:pL(Z.kStartpageSpeedDialColumns),title:(0,W.Z)("Maximum number of Speed Dial columns"),children:[TL,EL,kL,NL,_L,PL,ML,DL,OL,jL,(0,zn.jsx)("option",{value:99,children:(0,W.Z)("Unlimited")})]})]}),(0,zn.jsxs)("div",{className:"setting-single pad-top",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Speed Dial Size")}),(0,zn.jsx)(Fa.Z,{className:"max-columns",value:t[Z.kStartpageSpeedDialSize],onChange:pL(Z.kStartpageSpeedDialSize),children:Array.from(gL).map((([e,{label:t}])=>(0,zn.jsx)("option",{value:e,children:t},e)))})]}),(0,zn.jsx)("div",{className:"setting-single pad-top",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kStartpageSpeedDialAllowDnd],onChange:pL(Z.kStartpageSpeedDialAllowDnd)}),(0,zn.jsx)("span",{children:(0,W.Z)("Allow Drag and Drop Reordering")})]})})]}),(0,zn.jsx)("div",{className:"setting-group",children:(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Vivaldia, the Vivaldi Game")}),(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kStartpageSpeedDialGameButtonShow],onChange:pL(Z.kStartpageSpeedDialGameButtonShow)}),(0,zn.jsx)("span",{children:(0,W.Z)("Show on Speed Dial")})]})]})})]})]}),s]})}const RL=Un.memo(LL);class BL extends Un.PureComponent{state={remaining:V().duration({})};componentDidMount=()=>{this.timer=setInterval(this.nextTick,1e3)};componentWillUnmount=()=>clearInterval(this.timer);nextTick=()=>{this.setState({remaining:V().duration(this.props.end.diff(V()()))}),this.props.end.isAfter(V()())?this.props.onElapsed(!1):(this.props.onElapsed(!0),clearInterval(this.timer))};render(){const e=this.state.remaining;return(0,zn.jsx)("span",{children:(0,W.Z)(this.props.label,[e.minutes().toString().padStart(2,"0")+":"+e.seconds().toString().padStart(2,"0")])})}}const FL=BL,WL="/resources/default-avatar.png";function UL(e){c.ZP.openURL(e,"https://login.vivaldi.net/profile/samlsso")}function VL(){Bn.logout()}function HL({windowId:e,deviceName:t,pictureUrl:s,username:n,isLoggedIn:i,donationTier:a}){const[o,r]=Un.useState(!1),l="3"===a?(0,W.Z)("Advocate"):"2"===a?(0,W.Z)("Patron"):"1"===a?(0,W.Z)("Supporter"):"",d=Un.useCallback((e=>{const t=e.currentTarget.value;switch(e.key){case"Escape":r(!1),e.preventDefault();break;case"Enter":""===t.trim()?I.Z.reset(Z.kSyncSessionName):I.Z.set(Z.kSyncSessionName,t),r(!1),e.preventDefault()}}),[]);return(0,zn.jsxs)("div",{className:"sync-status",children:[(0,zn.jsxs)("div",{className:"avatar-username",children:[(0,zn.jsxs)("span",{className:"profile-picture-wrapper",children:[(0,zn.jsx)("img",{src:s||WL,className:"profile-picture",title:(0,W.Z)("View account profile page"),onClick:()=>UL(e),onError:e=>e.target.src=WL,alt:""}),a&&(0,zn.jsx)("img",{className:"Supporter-Badge",src:`/resources/badge-${hc(a)}-16@2x.png`,title:(0,W.Z)("Vivaldi $1\nThank you for your contribution!",[l])})]}),(0,zn.jsxs)("div",{className:"user-info",children:[(0,zn.jsx)("strong",{className:"username",title:(0,W.Z)("View account profile page"),onClick:()=>UL(e),children:n}),o?(0,zn.jsx)("input",{type:"text",defaultValue:t,onKeyDown:d,autoFocus:!0,onBlur:()=>r(!1)}):(0,zn.jsx)(zn.Fragment,{children:t&&(0,zn.jsxs)("label",{onClick:()=>r(!0),className:"device-name",title:(0,W.Z)("Edit device name"),children:[(0,zn.jsx)("span",{className:"info",children:" "+(0,W.Z)("on $1",[t])}),(0,zn.jsx)("span",{className:"edit-device-name",dangerouslySetInnerHTML:{__html:Kn.JHW}})]})})]})]}),i&&(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Log Out"),onClick:VL})]})}var GL=s(34155);class KL extends Un.PureComponent{_refInput=Un.createRef();state={type:"password"};toggleVisibility=()=>{const e={start:this._refInput.current?.selectionStart||0,end:this._refInput.current?.selectionEnd||0};this.setState((e=>({type:"text"===e.type?"password":"text"}))),GL.nextTick((()=>{this._refInput.current&&(this._refInput.current.selectionStart=e.start,this._refInput.current.selectionEnd=e.end)}))};render(){const{hideButton:e,...t}=this.props;return(0,zn.jsxs)("span",{className:"PasswordInputWrapper",children:[(0,zn.jsx)("input",{...t,ref:this._refInput,type:this.state.type,className:"PasswordInput"}),!e&&(0,zn.jsx)("button",{type:"button",title:"password"===this.state.type?(0,W.Z)("title","Show password"):(0,W.Z)("Hide password"),onClick:this.toggleVisibility,className:"PasswordToggle",tabIndex:"-1",dangerouslySetInnerHTML:{__html:Kn.sgm.medium}})]})}}const zL="•••••••",$L="17006";class YL extends Un.PureComponent{static contextType=oi.Z;constructor(e){super(e),this.state={username:e.accountState.accountInfo.username,password:e.accountState.hasSavedPassword?zL:"",sessionName:"",savePassword:!1,countdownElapsed:!1}}onCountDownElapsed=e=>{this.setState({countdownElapsed:e})};onUsernameChange=e=>{this.setState({username:e.target.value})};onPasswordChange=e=>{this.setState({password:e.target.value})};onDeviceNameChange=e=>{I.Z.set(Z.kSyncSessionName,e.target.value.trim())};onSavePasswordChange=e=>{this.setState({savePassword:e.target.checked})};onRecoverAccount=()=>{c.ZP.openURL(this.context.vivaldiWindowId,"https://login.vivaldi.net/profile/id/recoverAccount",{inCurrent:!1})};onPasswordReset=()=>{c.ZP.openURL(this.context.vivaldiWindowId,"https://login.vivaldi.net/profile/id/userInfoView",{inCurrent:!1})};onLogin=()=>{this.state.username&&this.state.password&&Bn.login(this.state.username,this.state.password===zL?"":this.state.password,this.state.savePassword)};onLogout=()=>{Bn.logout()};onRegister=()=>{this.props.onChangeDisplay()};renderForm=e=>{const t=""!==this.props.accountState.accountInfo.accountId,s=this.props.accountState.hasSavedPassword&&this.props.accountState.accountInfo.username===this.state.username,n=s&&this.state.password===zL;return(0,zn.jsxs)("form",{onSubmit:this.onLogin,noValidate:!0,children:[(0,zn.jsx)("h1",{children:(0,W.Z)("Log in to Your Account")}),(0,zn.jsxs)("p",{children:[(0,W.Z)("To begin with data synchronization, a confirmed Vivaldi account is required. New to Vivaldi?")," ",(0,zn.jsx)(Vx.Z,{onClick:this.onRegister,children:(0,W.Z)("Create an Account.")})]}),(0,zn.jsxs)("div",{className:"AccountSheet-Form",children:[(0,zn.jsxs)("label",{children:[(0,W.Z)("Username"),(0,zn.jsx)("input",{type:"text",value:this.state.username,disabled:t,onChange:this.onUsernameChange,autoFocus:this.props.autoFocus})]}),!n&&(0,zn.jsx)(Vx.Z,{onClick:this.onRecoverAccount,children:(0,W.Z)("Forgot Username?")}),(0,zn.jsxs)("label",{children:[(0,W.Z)("Password"),(0,zn.jsx)(KL,{value:this.state.password,onChange:this.onPasswordChange,hideButton:n})]}),!s&&(0,zn.jsx)(Vx.Z,{onClick:this.onPasswordReset,children:(0,W.Z)("Forgot Password?")}),(0,zn.jsxs)("label",{className:"AccountSheet-Password",children:[(0,zn.jsx)("input",{type:"checkbox",disabled:n,checked:this.state.savePassword||n,onChange:this.onSavePasswordChange}),(0,W.Z)("Save Password")]}),(0,zn.jsxs)("label",{children:[(0,W.Z)("Device Name"),(0,zn.jsx)("input",{type:"text",defaultValue:this.props.customSessionName,placeholder:this.props.defaultSessionName,onChange:this.onDeviceNameChange})]})]}),e&&(0,zn.jsx)(fa,{type:"error",children:e}),(0,zn.jsxs)("div",{className:"AccountSheet-Footer",children:[t&&(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Cancel"),onClick:this.onLogout}),(0,zn.jsx)("input",{type:"submit",value:(0,W.Z)("Login")})]})]})};render(){if(fe.ZP.isIncognitoOrGuest(this.context.vivaldiWindowId))return null;const{accountState:e,defaultSessionName:t}=this.props,s=e.accountInfo.username,n=e.lastTokenFetchError.serverMessage,i=e.lastTokenFetchError.errorCode,a=V()(e.nextTokenRequestTime),o=A.Z.get(Z.kSyncSessionName)||t;let r=null;switch(pe(e)){case"loggedIn":return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("h1",{children:(0,W.Z)("Connected")}),(0,zn.jsx)("p",{children:(0,W.Z)("Vivaldi account is active and connected.")}),(0,zn.jsx)(HL,{windowId:this.context.vivaldiWindowId,deviceName:o,pictureUrl:e.accountInfo.pictureUrl,username:s,isLoggedIn:!0})]});case"loginFailed":if(n){if(e.lastTokenFetchError.serverMessage.startsWith($L))break;r=function(e){const t=parseInt(e.substring(0,5));switch(t){case 17001:return(0,W.Z)("$1 Account doesn’t exist.",[t]);case 17002:return(0,W.Z)("$1 Invalid credentials are provided.",[t]);case 17003:return(0,W.Z)("$1 Account is locked after multiple incorrect login attempts, please wait 5 minutes.",[t]);case 17004:return(0,W.Z)("$1 Account is disabled.",[t]);case 17005:return(0,W.Z)("$1 Account has been temporarily locked as a result of multiple unsuccessful login attempts. Please wait 5 minutes before trying again.",[t]);case 17006:return(0,W.Z)("$1 Account hasn’t been activated yet. Please check your email to finish the registration process.",[t]);default:return e}}(n)}else r=-1===i?(0,W.Z)("You must use a vivaldi.net user account to log in."):(0,W.Z)("Vivaldi.net rejected your credentials: Error code $1",[i]);break;case"loggingIn":return a.isAfter(V()())&&("network_error"===e.lastTokenFetchError.errorType&&(r=(0,W.Z)("Unable to connect to vivaldi.net: $1 ($2)",[n,i])),"server_error"===e.lastTokenFetchError.errorType&&(r=n?(0,W.Z)("Vivaldi.net is experiencing issues: $1 ($2)",[n,i]):(0,W.Z)("Vivaldi.net is experiencing issues: Error code $1",[i]))),(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("div",{className:"AccountSheet-Form",children:(0,zn.jsxs)("p",{className:r?null:"in-progress",children:[(0,W.Z)("Logging in to Vivaldi.net as $1.",[s]),!r&&" "+(0,W.Z)("Please wait.")]})}),r&&(0,zn.jsxs)(fa,{type:"error",children:[r," ",(0,zn.jsx)(FL,{label:(0,W.Z)("Retrying in $1"),end:a,onElapsed:this.onCountDownElapsed})]}),(0,zn.jsx)("div",{className:"AccountSheet-Footer",children:(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Cancel"),onClick:this.onLogout})})]});case"credentialsMissing":r=e.hasEncryptedToken?(0,W.Z)("Failed to decrypt your credentials. Please log in again."):(0,W.Z)("Failed to retreive your credentials. Please log in again.")}return this.renderForm(r)}}const XL=YL;var QL=s(34155);const qL=/[a-zA-Z0-9]{3,30}/,JL=F.ZP.UI_LANGUAGE.replace("-","_");let eR=new AbortController;const tR=()=>eR.abort();function sR(e,t){tR();const s=new Promise(((s,n)=>{eR=new AbortController,fetch(e,{method:"POST",body:JSON.stringify(t),signal:eR.signal,headers:{"Content-Type":"application/json"}}).then((e=>{e.ok||n(e.text()),s(e.json())}))})),n=new Promise(((e,t)=>{const s=setTimeout((()=>{clearTimeout(s),t({status:0,statusText:"Error: Connection timed out [9010]"})}),6e4)}));return Promise.race([s,n])}class nR extends Un.PureComponent{static contextType=oi.Z;_refEmailField=Un.createRef();_refConfirmEmailField=Un.createRef();_refUsernameField=Un.createRef();_refAgeField=Un.createRef();_refPasswordField=Un.createRef();_refConfirmPasswordField=Un.createRef();_refVerifyAccountField=Un.createRef();constructor(e){super(e),this.state={username:e.accountState.accountInfo.username||"",email:"",error:"",age:-1,password:"",savePassword:!0,step:e.unverified?3:1,fetching:!1,agreedToTerms:!1,agreedToNewsletter:!1,activationCode:"",activationCount:0},e.unverified&&re.Z.vivaldiAccount.getPendingRegistration((e=>{e&&this.setState({username:e.username,email:e.recovery_email,password:e.password},(()=>this.goToStep(3)))}))}componentWillUnmount(){tR()}getError=e=>{switch(e){case 1001:case 1005:return{error:(0,W.Z)("Please choose a username between 3 and 30 letters (a-z) and numbers (0-9) only."),step:1,field:"username"};case 1002:return{error:(0,W.Z)("Please enter a valid email address."),step:1,field:"email"};case 1003:return{error:(0,W.Z)("We require our members to be at least 16 years old to join."),step:1,field:"age"};case 1004:return{error:(0,W.Z)("This email is already linked with another account."),step:1,field:"email"};case 1006:return{error:(0,W.Z)("Please choose a password at least 12 characters long."),step:2,field:"password"};case 1007:return{error:(0,W.Z)("Username “$1” already exists, please enter another one.",[this.state.username]),step:1,field:"username"};case 1008:return{error:(0,W.Z)("Email is in wrong format."),step:1,field:"email"};case 1010:return{error:(0,W.Z)("Please enter a realistic lifespan number."),step:1,field:"age"};case 2001:return{error:(0,W.Z)("Username contains a reserved word."),step:1,field:"username"};case 2002:return{error:(0,W.Z)("Email domain has been blacklisted."),step:1,field:"email"};case 2003:return{error:(0,W.Z)("IP address has been blacklisted."),step:1,field:"username"};case 3001:return{error:(0,W.Z)("Claims are missing."),step:1,field:"username"};case 4001:return{error:(0,W.Z)("Code does not match."),step:3,field:"activationCode"};case 4002:return{error:(0,W.Z)("The code has expired. Please request a new activation code."),step:3,field:"activationCode"};case 4004:return{error:(0,W.Z)("The code has been invalidated. Please request a new activation code."),step:3,field:"activationCode"};case 5001:return{error:(0,W.Z)("Failed to send account activation email."),step:3,field:"activationCode"};case 4003:case 5002:return{error:(0,W.Z)("Account has been locked."),step:3,field:"activationCode"};case 9e3:return{error:(0,W.Z)("Please fill in the required fields."),step:1,field:"username"};case 9001:return{error:(0,W.Z)("Email addresses need to match."),step:1,field:"email"};case 9002:return{error:(0,W.Z)("Passwords need to match."),step:2,field:"password"};case 9003:return{error:(0,W.Z)("You need to agree to Terms and Conditions."),step:2,field:"password"};case 9004:return{error:(0,W.Z)("Activation code should consist of $1 number.","Activation code should consist of $1 numbers.",[6]),step:3,field:"activationCode"};case 9010:return{error:(0,W.Z)("Connection error"),step:1,field:"username"};case 9020:return{error:(0,W.Z)("Please fill in the username"),step:1,field:"username"};case 9021:return{error:(0,W.Z)("Please provide your age"),step:2,field:"age"};case 9022:return{error:(0,W.Z)("Please provide your email"),step:1,field:"email"};case 9023:return{error:(0,W.Z)("Please fill in the email confirmation"),step:1,field:"confirmEmail"};case 9024:return{error:(0,W.Z)("Please provide your password"),step:3,field:"password"};case 9025:return{error:(0,W.Z)("Please fill in the password confirmation"),step:2,field:"confirmPassword"};default:return{error:(0,W.Z)("Unknown error"),step:1,field:"username"}}};onRegister=e=>{const t=e.currentTarget;t.password.checkValidity()&&t.confirmPassword.checkValidity()&&t.agreed.checkValidity()&&(this.setState({fetching:!0}),sR("https://login.vivaldi.net/profile/sync-registration",{username:this.state.username,emailaddress:this.state.email,password:this.state.password,age:this.state.age,lang:JL,disableNonce:!0,newsletter:this.state.agreedToNewsletter}).then((e=>{this.parseResponse(e)})).catch((e=>{console.warn("Registration request failed:",e.statusText),this.setState({fetching:!1,error:this.getError(9010).error})})))};onCheckUserCredentials=e=>{const t=e.currentTarget;t.username.checkValidity()&&t.age.checkValidity()&&t.email.checkValidity()&&t.confirmEmail.checkValidity()&&(this.setState({fetching:!0}),this.validateServerData("username").then((()=>this.validateServerData("email"))).then((()=>{this.goToStep(2),this.setState({fetching:!1})})).catch((e=>{console.warn("Account credentials validation failed",e.statusText),this.setState({fetching:!1})})))};parseResponse=e=>{if(e.error){const t=e.error,s=function(e){const t=e.match(/\[(\d+)\]/);return t?parseInt(t[1]):0}(t),{error:n,step:i,field:a}=this.getError(s);this.setState((a=>{if(0===s)return{error:t,step:a.step,activationCount:a.activationCount,fetching:!1};const o=4001===s?e.attempts_remaining:0;return{error:n,step:i,activationCount:o}})),QL.nextTick((()=>this.reportValidity(a,n)))}else e.success?.includes("Registration")?(this.goToStep(3),re.Z.vivaldiAccount.setPendingRegistration({username:this.state.username,recovery_email:this.state.email,password:this.state.savePassword?this.state.password:""})):e.success?.includes("Code has been sent")?this.setState({activationCount:-1}):e.success?.includes("verified")&&(this.resetActivation(),this.state.username&&this.state.password?Bn.login(this.state.username,this.state.password,this.state.savePassword):(this.goToStep(1),this.props.onChangeDisplay()))};validateServerData=e=>sR("https://login.vivaldi.net/profile/validateField",{field:e,value:this.state[e]}).then((e=>{this.parseResponse(e)})).catch((t=>(console.warn("Field validation failed",t.statusText,e),this.setState({fetching:!1,error:this.getError(9010).error}),Promise.reject())));debouncedValidate=(0,Te.Z)((e=>this.validateServerData(e).catch((()=>{}))),500);reportValidity=(e,t)=>{let s=null;switch(e){case"age":s=this._refAgeField.current;break;case"username":s=this._refUsernameField.current;break;case"email":s=this._refEmailField.current;break;case"confirmEmail":s=this._refConfirmEmailField.current;break;case"password":s=this._refPasswordField.current?._refInput.current;break;case"confirmPassword":s=this._refConfirmPasswordField.current;break;case"activationCode":s=this._refVerifyAccountField.current}s&&(s.setCustomValidity(t),s.focus())};onUsernameChange=e=>{this.resetValidity(e);const t=e.target.value.trim();qL.test(t)&&this.debouncedValidate("username"),this.setState({username:t})};onAgeChange=e=>{this.resetValidity(e),this.setState({age:parseInt(e.target.value)})};onEmailChange=e=>{this.resetValidity(e),this._refConfirmEmailField.current?.setCustomValidity("");const t=e.target.value;this.setState({email:t}),(0,cw.HZ)(t)&&this.debouncedValidate("email")};onPasswordChange=e=>{this.resetValidity(e),this._refConfirmPasswordField?.current?.setCustomValidity(""),this.setState({password:e.target.value})};onDeviceNameChange=e=>{I.Z.set(Z.kSyncSessionName,e.target.value.trim())};onSavePasswordChange=({target:e})=>{this.setState({savePassword:e.checked})};agreeToTerms=e=>{this.resetValidity(e),this.setState({agreedToTerms:e.target.checked})};agreeToNewsletter=({target:e})=>{this.setState({agreedToNewsletter:e.checked})};onActivationCodeChange=e=>{const{value:t}=e.target;this.resetValidity(e),this.setState({activationCode:t.trim().substring(0,6)})};verifyAccount=()=>{let{activationCode:e,username:t}=this.state;if(e=e.trim(),6!==e.length||/[^\d]/.test(e)){const{error:e,field:t}=this.getError(9004);return this.reportValidity(t,e),void this.setState({fetching:!1,error:this.getError(9004).error,activationCount:0})}sR("https://login.vivaldi.net/profile/activation-code",{username:t,activation_code:e,lang:JL}).then((e=>{this.parseResponse(e)})).catch((e=>{console.warn("Code verification failed",e.statusText),this.setState({fetching:!1,error:this.getError(9010).error})}))};sendVerificationCode=()=>{this.setState({error:"",activationCode:""}),sR("https://login.vivaldi.net/profile/resend-activation-code",{username:this.state.username,lang:JL}).then((e=>{this.parseResponse(e)})).catch((e=>{console.warn("Verification code request failed",e.statusText),this.setState({fetching:!1,error:this.getError(9010).error})}))};goToStep=e=>this.setState({step:e,error:"",activationCount:0});openNewsletterPage=()=>{c.ZP.openURL(this.context.vivaldiWindowId,"https://vivaldi.com/newsletter/",{inCurrent:!1})};openPrivacyPage=()=>{c.ZP.openURL(this.context.vivaldiWindowId,"https://vivaldi.com/privacy/",{inCurrent:!1})};setValidity=e=>{const{name:t,validity:s}=e.target;let n="";switch(!0){case s.rangeUnderflow&&"age"===t:n=this.getError(1003).error;break;case s.rangeOverflow&&"age"===t:n=this.getError(1010).error;break;case s.stepMismatch:case s.rangeUnderflow:case s.rangeOverflow:case s.typeMismatch:case s.patternMismatch:case s.badInput:case s.tooLong:case s.tooShort:"username"===t&&(n=this.getError(1001).error),"password"===t&&(n=this.getError(1006).error),"email"===t&&(n=this.getError(1002).error),"confirmEmail"===t&&(n=this.getError(9001).error),"confirmPassword"===t&&(n=this.getError(9002).error);break;case s.valueMissing:n=this.getError(9e3).error,"agreed"===t&&(n=this.getError(9003).error),"username"===t&&(n=this.getError(9020).error),"age"===t&&(n=this.getError(9021).error),"email"===t&&(n=this.getError(9022).error),"confirmEmail"===t&&(n=this.getError(9023).error),"password"===t&&(n=this.getError(9024).error),"confirmPassword"===t&&(n=this.getError(9025).error);break;case s.customError:n=e.target.validationMessage;case s.valid:}e.target.setCustomValidity(n),e.target.focus(),e.preventDefault(),this.setState({error:n})};resetValidity=e=>{e.target.setCustomValidity(""),this.setState({error:""})};resetActivation=()=>{re.Z.vivaldiAccount.setPendingRegistration()};renderUserDetails=()=>(0,zn.jsxs)("form",{onSubmit:this.onCheckUserCredentials,noValidate:!0,children:[(0,zn.jsx)("h1",{children:(0,W.Z)("Create an Account")}),(0,zn.jsxs)("p",{children:[(0,W.Z)("To start syncing data across devices, a confirmed Vivaldi account is required. Already have an account?")," ",(0,zn.jsx)(Vx.Z,{onClick:this.props.onChangeDisplay,children:(0,W.Z)("Log in.")})]}),(0,zn.jsxs)("div",{className:"AccountSheet-Form AccountSheet-FormGrid",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)($x,{label:(0,W.Z)("Username is used for email, blog link and forum display name. It can only contain letters and numbers, and cannot be changed."),children:(0,W.Z)("Username")}),(0,zn.jsx)("input",{ref:this._refUsernameField,type:"text",name:"username",value:this.state.username,onChange:this.onUsernameChange,onInvalid:this.setValidity,required:!0,pattern:qL.source,autoFocus:this.props.autoFocus})]}),(0,zn.jsxs)("label",{children:[(0,zn.jsx)($x,{label:(0,W.Z)("We need this information to prove to authorities that you are older than 16 to comply with the European General Data Protection Regulation (GDPR)."),children:(0,W.Z)("Age")}),(0,zn.jsx)("input",{ref:this._refAgeField,type:"number",name:"age",value:this.state.age>=0?this.state.age:"",onChange:this.onAgeChange,onInvalid:this.setValidity,required:!0,min:"16",max:"150"})]}),(0,zn.jsxs)("label",{children:[(0,zn.jsx)($x,{label:(0,W.Z)("We’ll use this email address to send you account-related messages (activation, password reset) and technical updates."),children:(0,W.Z)("Recovery Email")}),(0,zn.jsx)("input",{ref:this._refEmailField,type:"email",name:"email",placeholder:"name@provider.com",value:this.state.email,onChange:this.onEmailChange,onInvalid:this.setValidity,pattern:cw.s9.source,required:!0})]}),(0,zn.jsxs)("label",{children:[(0,W.Z)("Confirm Recovery Email"),(0,zn.jsx)("input",{ref:this._refConfirmEmailField,type:"email",name:"confirmEmail",defaultValue:"",onChange:this.resetValidity,onInvalid:this.setValidity,pattern:(0,xg.Z)(this.state.email),required:!0})]})]}),this.state.error&&(0,zn.jsx)(fa,{type:"error",children:this.state.error}),(0,zn.jsxs)("div",{className:"AccountSheet-Footer",children:[!this.state.fetching&&(0,zn.jsx)("input",{type:"submit",value:(0,W.Z)("Next")}),this.state.fetching&&(0,zn.jsx)("span",{className:"FormButton primary in-progress",children:(0,W.Z)("Checking...")})]})]});renderPasswordDetails=()=>(0,zn.jsxs)("form",{onSubmit:this.onRegister,noValidate:!0,children:[(0,zn.jsx)("h1",{children:(0,W.Z)("Create an Account")}),(0,zn.jsx)(HL,{windowId:this.context.vivaldiWindowId,pictureUrl:"",username:this.state.username,deviceName:this.state.email}),(0,zn.jsxs)("div",{className:"AccountSheet-Form AccountSheet-FormGrid",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)($x,{label:(0,W.Z)("Use 12 or more characters. We recommend using several words separated by spaces."),children:(0,W.Z)("Password")}),(0,zn.jsx)(KL,{ref:this._refPasswordField,name:"password",value:this.state.password,onChange:this.onPasswordChange,onInvalid:this.setValidity,minLength:"12",required:!0,autoFocus:this.props.autoFocus})]}),(0,zn.jsxs)("label",{children:[(0,W.Z)("Confirm Password"),(0,zn.jsx)("input",{type:"password",ref:this._refConfirmPasswordField,name:"confirmPassword",defaultValue:"",onChange:this.resetValidity,onInvalid:this.setValidity,pattern:(0,xg.Z)(this.state.password),required:!0})]}),(0,zn.jsxs)("label",{className:"columnRow",children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.state.savePassword,onChange:this.onSavePasswordChange}),(0,W.Z)("Save Password")]}),(0,zn.jsxs)("label",{className:"fullRow",children:[(0,W.Z)("Device Name"),(0,zn.jsx)("input",{type:"text",className:"device",defaultValue:this.props.customSessionName,placeholder:this.props.defaultSessionName,onChange:this.onDeviceNameChange})]}),(0,zn.jsxs)("span",{className:"fullRow columnRow link",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.state.agreedToNewsletter,onChange:this.agreeToNewsletter}),(0,W.Z)("I want to receive the Vivaldi newsletter.")]}),(0,zn.jsx)(Vx.Z,{title:(0,W.Z)("Learn more about Vivaldi Newsletter"),onClick:this.openNewsletterPage,children:(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.vvh.small}})})]}),(0,zn.jsxs)("span",{className:"fullRow columnRow link",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",name:"agreed",required:!0,checked:this.state.agreedToTerms,onInvalid:this.setValidity,onChange:this.agreeToTerms}),(0,W.Z)("I have read and agree to the Terms of Use and Privacy Policy.")]}),(0,zn.jsx)(Vx.Z,{title:(0,W.Z)("Visit Vivaldi Privacy page"),onClick:this.openPrivacyPage,children:(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.vvh.small}})})]})]}),this.state.error&&(0,zn.jsx)(fa,{type:"error",children:this.state.error}),(0,zn.jsxs)("div",{className:"AccountSheet-Footer AccountSheet-Footer--Justified",children:[(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("navigation","Back"),onClick:()=>{tR(),this.goToStep(1)}}),!this.state.fetching&&(0,zn.jsx)("input",{type:"submit",value:(0,W.Z)("Register")}),this.state.fetching&&(0,zn.jsx)("span",{className:"FormButton primary in-progress",children:(0,W.Z)("Registering...")})]})]});renderAccountVerification=()=>(0,zn.jsxs)("form",{onSubmit:this.verifyAccount,noValidate:!0,children:[(0,zn.jsx)("h1",{children:(0,W.Z)("Activate Your Account")}),(0,zn.jsx)(HL,{windowId:this.context.vivaldiWindowId,pictureUrl:"",username:this.state.username,deviceName:this.state.email}),(0,zn.jsxs)("div",{className:"AccountSheet-Form",children:[(0,zn.jsxs)("p",{children:[this.state.email?(0,W.Z)("Activation code has been sent to “$1”.",[this.state.email]):(0,W.Z)("Activation code has been sent to your email.")," ",(0,W.Z)("Please enter the 6 digit code.")]}),(0,zn.jsx)("input",{ref:this._refVerifyAccountField,type:"text",onChange:this.onActivationCodeChange,value:this.state.activationCode,name:"activationCode",className:"AccountSheet-Verification",size:6,placeholder:"000000",autoFocus:!0}),(0,zn.jsxs)("p",{children:[(0,W.Z)("Don’t see the email? Please check your spam folder.")," ",-1!==this.state.activationCount&&(0,zn.jsx)(Vx.Z,{onClick:this.sendVerificationCode,children:(0,W.Z)("Or get another activation code.")})]})]}),this.state.error&&(0,zn.jsxs)(fa,{type:"error",children:[this.state.error," ",this.state.error===this.getError(4001).error&&this.state.activationCount>0&&this.state.activationCount<3&&(0,W.Z)("$1 attempt remaining.","$1 attempts remaining.",[this.state.activationCount]),this.state.error===this.getError(4001).error&&0===this.state.activationCount&&(0,W.Z)("Please request a new activation code.")]}),!this.state.error&&-1===this.state.activationCount&&(0,zn.jsx)(fa,{type:"info",children:(0,W.Z)("New activation code was sent.")}),(0,zn.jsxs)("div",{className:"AccountSheet-Footer AccountSheet-Footer--Justified",children:[(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Cancel"),onClick:()=>{this.resetActivation(),this.props.onChangeDisplay()}}),(0,zn.jsx)("input",{type:"submit",value:(0,W.Z)("Activate Account")})]})]});render(){const{step:e}=this.state;return(0,zn.jsxs)(zn.Fragment,{children:[1===e&&this.renderUserDetails(),2===e&&this.renderPasswordDetails(),3===e&&this.renderAccountVerification()]})}}const iR=nR,aR=[Z.kSyncSessionName];class oR extends Un.PureComponent{#v=!1;constructor(e){super(e);const t=me.getState();this.state={display:"register"===this.props.view?"register":"login",accountState:t,defaultSessionName:"",unverified:!1}}componentDidMount(){this.#v=!0,me.addListener(this.onVivaldiAccountChange),this.onVivaldiAccountChange(),this.setDefaultSession()}setDefaultSession=async()=>{if(!this.#v)return;const e=await(async()=>re.Z.sync.getDefaultSessionName())();this.setState({defaultSessionName:e})};componentWillUnmount(){this.#v=!1,me.removeListener(this.onVivaldiAccountChange)}onVivaldiAccountChange=()=>{const e=me.getState();this.setState({accountState:e}),e.lastTokenFetchError.serverMessage.includes($L)&&"loginFailed"===pe(e)?this.setState({display:"register",unverified:!0}):re.Z.vivaldiAccount.getPendingRegistration((e=>{e&&this.setState({display:"register",unverified:!0})}))};onChangeDisplay=()=>{this.setState((e=>({display:"login"===e.display?"register":"login",unverified:!1})))};render(){const{display:e}=this.state;return(0,zn.jsxs)("div",{className:"AccountSheet",children:[(0,zn.jsx)("span",{className:"AccountSheet-Logo",dangerouslySetInnerHTML:{__html:s(38151)}}),"register"===e&&(0,zn.jsx)(iR,{autoFocus:this.props.autoFocus,onClose:this.props.onClose,onChangeDisplay:this.onChangeDisplay,defaultSessionName:this.state.defaultSessionName,customSessionName:this.props.prefValues[Z.kSyncSessionName],accountState:this.state.accountState,unverified:this.state.unverified}),"login"===e&&(0,zn.jsx)(XL,{autoFocus:this.props.autoFocus,onClose:this.props.onClose,onChangeDisplay:this.onChangeDisplay,defaultSessionName:this.state.defaultSessionName,accountState:this.state.accountState,customSessionName:this.props.prefValues[Z.kSyncSessionName]})]})}}const rR=(0,zd.Z)(oR,aR),lR={bookmarks:{label:(0,W.Z)("Bookmarks"),description:(0,W.Z)("Sync bookmarks and Speed Dials"),icon:Kn.CLf.small},preferences:{label:(0,W.Z)("Settings"),description:(0,W.Z)("Sync Vivaldi settings (not all settings are syncable)"),icon:Kn.bqs.small},passwords:{label:(0,W.Z)("Passwords"),description:(0,W.Z)("Sync stored webpage passwords"),icon:Kn._ZF},autofill:{label:(0,W.Z)("other","Autofill"),description:(0,W.Z)("Sync form autofill information"),icon:Kn.lku},history:{label:(0,W.Z)("History"),description:(0,W.Z)("Sync History and Typed Urls"),icon:Kn.hcy.small},extensions:{label:(0,W.Z)("Extensions"),description:(0,W.Z)("Sync browser extensions and settings"),icon:Kn.v9y.small},apps:{label:(0,W.Z)("Apps"),description:(0,W.Z)("Sync Web Apps"),icon:Kn.v9y.small},reading_list:{label:(0,W.Z)("Reading List"),description:(0,W.Z)("Sync the Reading List"),icon:Kn.R_e.small},tabs:{label:(0,W.Z)("Tabs"),description:(0,W.Z)("Sync open tabs"),icon:Kn.hcy.small},notes:{label:(0,W.Z)("Notes"),description:(0,W.Z)("Sync Vivaldi Notes (attachments are not syncable)"),icon:Kn.fbI}};class dR extends Un.Component{static contextType=oi.Z;syncAllId="syncAll__"+crypto.randomUUID();syncPartsId="syncParts__"+crypto.randomUUID();constructor(e){super(e),this.state={countdownElapsed:!1,showConfirmClearDataDialog:!1,showChangeFeedback:!1,dataTypes:e.syncState.engineData.dataTypes}}componentWillUnmount(){clearTimeout(this.changeTimeout)}onCountDownElapsed=e=>{this.setState({countdownElapsed:e})};onSyncEverythingChange=()=>{this.setChangeFeedback(),re.Z.sync.setTypes(!0,this.props.syncState.engineData.dataTypes),re.Z.sync.setupComplete(),this.setState((e=>({dataTypes:e.dataTypes.map((e=>(e.enabled=!0,e)))})))};onDataTypeChange=e=>{const t=e.target.name,s=e.target.checked;this.setState((e=>{const n=e.dataTypes,i=n.find((e=>e.dataType===t));return i&&(i.enabled=s),{dataTypes:n}})),re.Z.sync.setTypes(this.props.syncState.engineData.syncEverything,this.props.syncState.engineData.dataTypes)};setChangeFeedback=()=>{clearTimeout(this.changeTimeout),this.setState({showChangeFeedback:!0},(()=>this.changeTimeout=setTimeout(this.resetChangeFeedback,1e3)))};resetChangeFeedback=()=>{this.setState({showChangeFeedback:!1})};onApplyChanges=()=>{this.setChangeFeedback(),re.Z.sync.setTypes(!1,this.state.dataTypes),re.Z.sync.setupComplete()};onClearData=()=>{this.setState({showConfirmClearDataDialog:!0})};onConfirmClearDataDialog=e=>{this.setState({showConfirmClearDataDialog:!1}),e&&En.clearData()};onSaveBackupKey=()=>{re.Z.utilities.selectFile({windowId:this.context.vivaldiWindowId,title:(0,W.Z)("Save Backup Encryption Key"),type:"save_file",accepts:[{ext:"txt"}]}).then((e=>{e&&re.Z.sync.backupEncryptionToken(e,(e=>{e||console.warn("File not saved (vivaldi.sync)")}))}))};renderResetButton=()=>"configuration_pending"===this.props.syncState.engineData.engineState?null:(0,zn.jsx)("input",{type:"button",onClick:this.onClearData,value:(0,W.Z)("Reset Remote Data")});openVivaldiStatusPage=()=>{c.ZP.openURL(this.context.vivaldiWindowId,"https://vivaldistatus.com/")};render(){const{cycleData:e,engineData:t}=this.props.syncState,s="not_synced"!==this.props.syncState.cycleData.downloadUpdatesStatus?V()(this.props.syncState.cycleData.cycleStartTime).calendar():"...",n=this.state.dataTypes.map((e=>(0,zn.jsx)("li",{children:(0,zn.jsxs)("label",{className:"grid",children:[(0,zn.jsx)("span",{className:"icon",dangerouslySetInnerHTML:{__html:lR[e.dataType].icon}}),(0,zn.jsx)("h3",{children:lR[e.dataType].label}),(0,zn.jsx)("span",{className:"description",children:lR[e.dataType].description}),(0,zn.jsx)("input",{type:"checkbox",name:e.dataType,checked:e.enabled,onChange:this.onDataTypeChange})]})},e.dataType))),[i,a]=this.state.showChangeFeedback?[nv(e)[0],(0,W.Z)("Updating")]:nv(e),o=this.state.showChangeFeedback?"in_progress":e.commitStatus;let r=null;if(0!==parseInt(e.nextRetryTime)){const t=V()(e.nextRetryTime);r=t.isBefore(V()())?(0,zn.jsx)("p",{className:"in-progress",children:(0,W.Z)("Retrying")}):(0,zn.jsx)(FL,{label:(0,W.Z)("Retrying in $1"),end:t,onElapsed:this.onCountDownElapsed})}const l=t.syncEverything?this.syncAllId:this.syncPartsId,d="configuration_pending"===t.engineState;return(0,zn.jsxs)(tb.Z,{filter:this.props.filter,children:[(0,zn.jsxs)("div",{className:"setting-group-double",children:[!d&&(0,zn.jsxs)("div",{className:"sync-status detail",children:[(0,zn.jsxs)("span",{className:"time",children:[(0,W.Z)("Last sync:")," ",(0,zn.jsx)("strong",{children:s})]}),(0,zn.jsxs)("span",{className:`data-in ${e.downloadUpdatesStatus}`,children:[(0,zn.jsx)("span",{className:"icon",dangerouslySetInnerHTML:{__html:Kn.OXd}}),(0,W.Z)("Download: $1",[i])]}),(0,zn.jsxs)("span",{className:`data-out ${o}`,children:[(0,zn.jsx)("span",{className:"icon",dangerouslySetInnerHTML:{__html:Kn.uUH}}),(0,W.Z)("Upload: $1",[a])]})]}),av(this.props.syncState.problem)&&(0,zn.jsx)(iv,{windowId:this.context.vivaldiWindowId}),r&&(0,zn.jsx)(fa,{type:"info",children:r}),t.isEncryptingEverything&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("div",{className:"status",children:[(0,zn.jsx)("span",{className:"icon",dangerouslySetInnerHTML:{__html:Kn._ZF}}),(0,W.Z)("Data secured by encryption password.")]}),(0,zn.jsx)("div",{className:"status",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("span",{className:"icon",dangerouslySetInnerHTML:{__html:Kn.SpM}}),(0,zn.jsx)($x,{label:(0,W.Z)("Store the backup recovery key in a secure place. If you forget your encryption password, you may use this key to retrieve your sync data. We won’t be able to recover your data since your password and backup key are never sent to us."),children:(0,zn.jsx)(Vx.Z,{onClick:this.onSaveBackupKey,children:(0,W.Z)("Save Backup Encryption Key")})})]})})]}),!t.isEncryptingEverything&&(0,zn.jsx)(fa,{type:"error",children:(0,W.Z)("Sync encryption failed. We recommend that you clear remote Sync data and restart Sync with your current browser data.")}),this.state.showConfirmClearDataDialog&&(0,zn.jsx)($C,{title:(0,W.Z)("Delete Remote Sync Data"),prompt:[(0,W.Z)("This will remove all sync data stored on the Vivaldi server, reset your encryption password, and log you out.")],positive:(0,W.Z)("Delete Sync Data"),negative:(0,W.Z)("Cancel"),onClose:this.onConfirmClearDataDialog,danger:!0})]}),d&&(0,zn.jsx)("div",{className:"sync-status-confirmed",children:(0,zn.jsx)("h3",{children:(0,W.Z)("All set! Time to decide what data to sync between devices.")})}),(0,zn.jsx)("div",{className:"setting-group-double pad-top",children:(0,zn.jsxs)(aM,{activeTabId:l,icons:[Kn.uWq,Kn.o7J],children:[(0,zn.jsxs)("div",{label:(0,W.Z)("Sync All Data"),id:this.syncAllId,children:[(0,zn.jsx)("div",{className:"TabbedView--Padded",children:(0,zn.jsxs)("p",{children:[!d&&t.syncEverything&&(0,W.Z)("All data is synchronized, and synchronization of new data types is automatically enabled."),!d&&!t.syncEverything&&(0,W.Z)("Selected data subset is synchronized.")," ",(!t.isFirstSetupComplete||!t.syncEverything)&&(0,W.Z)("Sychronize all data, and automatically enable synchronization of new data types.")]})}),(0,zn.jsxs)("div",{className:"TabbedView-Footer",children:[this.renderResetButton(),(0,zn.jsx)("input",{type:"submit",value:t.isFirstSetupComplete?(0,W.Z)("Sync All Data"):(0,W.Z)("Start Syncing"),onClick:this.onSyncEverythingChange,disabled:t.syncEverything&&!d,autoFocus:t.isFirstSetupComplete&&this.props.autoFocus})]})]}),(0,zn.jsx)("div",{label:(0,W.Z)("Sync Selected Data"),id:this.syncPartsId,children:(0,zn.jsxs)("form",{onSubmit:this.onApplyChanges,children:[(0,zn.jsx)("ul",{children:n}),(0,zn.jsxs)("div",{className:"TabbedView-Footer",children:[this.renderResetButton(),(0,zn.jsx)("input",{type:"submit",disabled:!d&&(!t.isSetupInProgress&&t.isFirstSetupComplete||(0,sw.Z)(this.state.dataTypes,this.props.syncState.engineData.dataTypes)),value:t.isFirstSetupComplete?(0,W.Z)("Apply Changes"):(0,W.Z)("Start Syncing"),autoFocus:!t.isFirstSetupComplete&&this.props.autoFocus})]})]})})]})})]})}}const cR=dR;class hR extends Un.Component{static contextType=oi.Z;ID1="fm1__"+crypto.randomUUID();ID2="fm2__"+crypto.randomUUID();state={encryptionPassword:"",wrongPasswordEntered:!1,wrongBackupKey:"key"===this.props.unlockAttempt,showConfirmClearDataDialog:!1};onEncryptionPasswordChange=e=>{this.setState({wrongPasswordEntered:!1,wrongBackupKey:!1,encryptionPassword:e.target.value})};onDecrypt=()=>{this.setState({wrongPasswordEntered:!1}),En.setEncryptionPassword(this.state.encryptionPassword,(e=>{this.props.onUnlockAttempt("passphrase"),e||this.setState({wrongPasswordEntered:!0,wrongBackupKey:!1})}))};onPasswordLost=()=>{this.setState({showConfirmClearDataDialog:!0,wrongPasswordEntered:!1,wrongBackupKey:!1})};resetErrorState=()=>{this.setState({wrongPasswordEntered:!1,wrongBackupKey:!1})};onConfirmClearDataDialog=e=>{this.setState({showConfirmClearDataDialog:!1}),e&&En.clearData()};onUploadEncyptionKey=()=>{re.Z.utilities.selectFile({windowId:this.context.vivaldiWindowId,title:(0,W.Z)("Select Backup Encryption Key file"),type:"file",accepts:[{ext:"txt"}]}).then((e=>{e&&re.Z.sync.restoreEncryptionToken(e).then((e=>{this.props.onUnlockAttempt("key"),e||this.setState({wrongPasswordEntered:!1,wrongBackupKey:!0})}))}))};renderForgotPassword=()=>(0,zn.jsx)(Vx.Z,{onClick:this.onPasswordLost,children:(0,W.Z)("Forgot Password?")});render(){return(0,zn.jsx)(Vy.Z,{categoryTitle:(0,W.Z)("Encryption Password"),filter:this.props.filter,children:(0,zn.jsx)(tb.Z,{filter:this.props.filter,children:(0,zn.jsxs)("div",{className:"setting-group-double",children:[this.state.showConfirmClearDataDialog&&(0,zn.jsx)($C,{title:(0,W.Z)("Delete Remote Sync Data"),prompt:[(0,W.Z)("Without your current encryption password we’re unable to decrypt your data. Resetting this password requires deleting all existing Sync data on Vivaldi servers.")],positive:(0,W.Z)("Delete Sync Data"),negative:(0,W.Z)("Cancel"),onClose:this.onConfirmClearDataDialog,danger:!0}),(0,zn.jsxs)(aM,{activeTabId:"key"===this.props.unlockAttempt?this.ID2:void 0,icons:[Kn.WHX,Kn.c02],onTabClick:this.resetErrorState,children:[(0,zn.jsx)("div",{label:(0,W.Z)("Encryption Password"),id:this.ID1,children:(0,zn.jsxs)("form",{onSubmit:this.onDecrypt,children:[(0,zn.jsxs)("div",{className:"TabbedView--Padded",children:[(0,zn.jsx)("p",{children:(0,W.Z)("The data received from the Sync server is encrypted. Please provide your encryption password to decrypt it.")}),(0,zn.jsxs)("label",{className:"setting-single encryption",children:[(0,zn.jsx)("span",{children:(0,W.Z)("Encryption Password")}),(0,zn.jsx)(KL,{value:this.state.encryptionPassword,onChange:this.onEncryptionPasswordChange,autoFocus:this.props.autoFocus})]}),this.state.wrongPasswordEntered&&(0,zn.jsx)(fa,{type:"error",children:(0,W.Z)("Wrong password entered.")})]}),(0,zn.jsxs)("div",{className:"TabbedView-Footer",children:[this.renderForgotPassword(),(0,zn.jsx)("input",{type:"submit",value:(0,W.Z)("Decrypt")})]})]})}),(0,zn.jsxs)("div",{label:(0,W.Z)("Load Encryption Key"),id:this.ID2,children:[(0,zn.jsxs)("div",{className:"TabbedView--Padded",children:[(0,zn.jsx)("p",{children:(0,W.Z)("To recover data without a password, you may use your Backup Encryption Key, provided you have saved it earlier.")}),this.state.wrongBackupKey&&(0,zn.jsx)(fa,{type:"error",children:(0,W.Z)("Unable to decrypt with given backup encryption key.")})]}),(0,zn.jsxs)("div",{className:"TabbedView-Footer",children:[this.renderForgotPassword(),(0,zn.jsx)("input",{type:"button",onClick:this.onUploadEncyptionKey,value:(0,W.Z)("Load")})]})]})]})]})})})}}const uR=hR;class pR extends Un.Component{static contextType=oi.Z;_input=Un.createRef();state={encryptionPassword:"",shortPassword:!1};onSetPassword=()=>{!this.state.encryptionPassword||this.state.encryptionPassword.length<12?(this.setState({shortPassword:!0}),this._input.current?._refInput.current?.focus()):this.doSetPassword(this.state.encryptionPassword)};doSetPassword=e=>{En.setEncryptionPassword(e,(e=>{e&&this.setState({shortPassword:!1})}))};onEncryptionPasswordChange=e=>{this.setState({encryptionPassword:e.target.value}),e.target.value.length>=12&&this.setState({shortPassword:!1})};render(){return(0,zn.jsxs)(tb.Z,{filter:this.props.filter,children:[(0,zn.jsx)("h2",{children:(0,W.Z)("Set a New Encryption Password")}),(0,zn.jsx)("form",{onSubmit:this.onSetPassword,children:(0,zn.jsxs)("div",{className:"setting-group-double",children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)("p",{children:(0,W.Z)("To encrypt and protect your sync data (passwords, bookmarks, notes, and more), please create an encryption password. This password will never be sent to us.")})}),(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{className:"encryption-password",children:[(0,zn.jsx)("span",{className:"icon",dangerouslySetInnerHTML:{__html:Kn._ZF}}),(0,W.Z)("Encryption Password"),(0,zn.jsx)(KL,{ref:this._input,value:this.state.encryptionPassword,onChange:this.onEncryptionPasswordChange})]}),this.state.shortPassword&&(0,zn.jsx)(fa,{type:"error",children:(0,W.Z)("Minimum password length of $1 character is required.","Minimum password length of $1 characters is required.",[12])})]}),(0,zn.jsx)("div",{className:"setting-single align-right pad-top",children:(0,zn.jsx)("input",{type:"submit",value:(0,W.Z)("Save and Continue"),autoFocus:this.props.autoFocus})})]})})]})}}const gR=pR,mR=[Z.kSyncSessionName];function fR(e){const t=Un.useContext(oi.Z),s=(0,Eo.Z)(mR),[n,i]=Un.useState(hv.getState()),[a,o]=Un.useState(me.getState()),[r,l]=Un.useState(""),[d,c]=Un.useState("");Un.useEffect((()=>{function e(){i(hv.getState())}function t(){o(me.getState())}return hv.addListener(e),me.addListener(t),e(),t(),re.Z.sync.getDefaultSessionName(l),()=>{hv.removeListener(e),me.removeListener(t)}}),[]);const h=e=>{c(e)},u=()=>{En.start()};if(fe.ZP.isIncognitoOrGuest(t.vivaldiWindowId))return(0,zn.jsx)("p",{children:(0,W.Z)("Sync settings are unavailable in Private Windows.")});if(!n.engineData.isReady||!n.cycleData.isReady||!a.isReady)return null;const p=(()=>{const s=n.engineData;if(s.disableReasons.includes("enterprise_policy"))return(0,zn.jsx)("p",{children:(0,W.Z)("Sync has been disabled by your administrator")});const i=s.engineState;if(!a.hasToken)return null;switch(i){case"stopped":return(0,zn.jsxs)("div",{className:"setting-group-double",children:["disable_sync_on_client"===s.protocolErrorClientAction&&(0,zn.jsx)("p",{children:(0,W.Z)("Sync was stopped following a request from the server: $1",["not_my_birthday"===s.protocolErrorType?(0,W.Z)("Sync server data was reset"):s.protocolErrorDescription])}),(0,zn.jsx)("input",{type:"button",onClick:u,value:(0,W.Z)("Start Sync")})]});case"failed":if(s.disableReasons.includes("not_signed_in"))return(0,zn.jsx)("div",{className:"setting-group-double",children:(0,zn.jsx)("p",{className:"in-progress",children:(0,W.Z)("Waiting for account details")})});if(s.disableReasons.includes("flag"))return(0,zn.jsx)("p",{children:(0,W.Z)("Sync was disabled from the command line")});let i=(0,W.Z)("Unexpected error. You may need to restart Vivaldi.");if(s.disableReasons.includes("unrecoverable_error"))if("upgrade_client"===s.protocolErrorClientAction)i=(0,W.Z)("You must upgrade Vivaldi in order to use Sync");else i=(0,W.Z)("Sync could not be started: $1",[s.protocolErrorDescription]);return(0,zn.jsx)("p",{children:i});case"starting":{const e=a.accountInfo.username,s=(0,W.Z)("Connecting to Sync as “$1”...",[e]);return av(n.problem)?(0,zn.jsxs)("div",{children:[(0,zn.jsx)("p",{className:"in-progress",children:s}),(0,zn.jsx)(iv,{windowId:t.vivaldiWindowId})]}):(0,zn.jsx)("p",{className:"in-progress",children:s})}case"starting_server_error":return(0,zn.jsx)("p",{className:"in-progress",children:(0,W.Z)("The sync server is experiencing issues. Retrying initialization soon.")});case"clearing_data":return(0,zn.jsx)("p",{className:"in-progress",children:(0,W.Z)("Clearing Sync data. Please wait.")});case"configuration_pending":case"started":return s.needsDecryptionPassword?(0,zn.jsx)(uR,{filter:e.filter,autoFocus:e.category!==vs.jk.settingCategories.all,unlockAttempt:d,onUnlockAttempt:h}):s.usesEncryptionPassword?(0,zn.jsx)(cR,{filter:e.filter,syncState:n,autoFocus:e.category!==vs.jk.settingCategories.all}):(0,zn.jsx)(gR,{filter:e.filter,autoFocus:e.category!==vs.jk.settingCategories.all})}return null})(),{username:g,pictureUrl:m,donationTier:f}=a.accountInfo,v=s[Z.kSyncSessionName]||r;return(0,zn.jsxs)(Vy.Z,{categoryTitle:(0,W.Z)("Sync"),filter:e.filter,className:"sync-setup",children:[(0,zn.jsx)(tb.Z,{filter:e.filter,children:(0,zn.jsx)("div",{className:"setting-group-double",children:"loggedIn"!==pe(a)?(0,zn.jsx)(rR,{onClose:nr.Z,view:(b=e.url,"register"===(0,Ar.DP)(b).view?"register":"login"),autoFocus:e.category!==vs.jk.settingCategories.all},e.url):(0,zn.jsx)(HL,{windowId:t.vivaldiWindowId,pictureUrl:m,username:g,deviceName:v,isLoggedIn:!0,donationTier:f})})}),p&&(0,zn.jsx)(tb.Z,{filter:e.filter,children:p})]});var b}const vR=Un.memo(fR),bR=[Z.kMemorySaverModeState,Z.kMemorySaverModeTimeBeforeDiscardInMinutes];function CR(e){const t=(0,Eo.Z)(bR);return(0,zn.jsx)(tb.Z,{filter:e.filter,children:(0,zn.jsx)("div",{className:"setting-group",children:(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Memory Saver")}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Free up memory from inactive tabs.")}),(0,zn.jsxs)(Fa.Z,{onChange:e=>{const{value:s}=e.target;if("disabled"===s)0!==t[Z.kMemorySaverModeState]&&I.Z.set(Z.kMemorySaverModeState,0);else if("auto"===s)1!==t[Z.kMemorySaverModeState]&&I.Z.set(Z.kMemorySaverModeState,1);else{2!==t[Z.kMemorySaverModeState]&&I.Z.set(Z.kMemorySaverModeState,2);const e=parseInt(s);isNaN(e)||e===t[Z.kMemorySaverModeTimeBeforeDiscardInMinutes]||I.Z.set(Z.kMemorySaverModeTimeBeforeDiscardInMinutes,e)}},value:(e=>{switch(e){case 0:return"disabled";case 1:return"auto";default:return t[Z.kMemorySaverModeTimeBeforeDiscardInMinutes].toString()}})(t[Z.kMemorySaverModeState]),children:[(0,zn.jsx)("option",{value:"disabled",children:(0,W.Z)("memsaver","Disabled")}),(0,zn.jsx)("option",{value:"auto",children:(0,W.Z)("memsaver","Automatic")}),(0,zn.jsx)("option",{value:"60",children:(0,W.Z)("memsaver","After 1 Hour Idle")}),(0,zn.jsx)("option",{value:"120",children:(0,W.Z)("memsaver","After 2 Hours Idle")}),(0,zn.jsx)("option",{value:"180",children:(0,W.Z)("memsaver","After 3 Hours Idle")}),(0,zn.jsx)("option",{value:"360",children:(0,W.Z)("memsaver","After 6 Hours Idle")})]})]})})})}const wR=I.Z.getEventHandler,yR=[Z.kTabsActivationOnClose,Z.kTabsActivationPreferRelated,Z.kTabsAlignNext,Z.kTabsDoubleClick,Z.kTabsFocusWebview,Z.kTabsBarPosition,Z.kTabsNeverCloseLast,Z.kTabsConfirmClosingTabs,Z.kTabsConfirmClosingThreshold];var xR=(0,zn.jsx)("input",{type:"radio",value:"activation_order"}),IR=(0,zn.jsx)("input",{type:"radio",value:"left"}),AR=(0,zn.jsx)("input",{type:"radio",value:"right"}),SR=(0,zn.jsx)("input",{type:"radio",value:"rename"}),ZR=(0,zn.jsx)("input",{type:"radio",value:"close"}),TR=(0,zn.jsx)("input",{type:"radio",value:"ignore"});class ER extends Un.Component{confirmClosingTabsMinThreshold=1;confirmClosingTabsMaxThreshold=99;isHorizontal=()=>{const e=this.props.prefValues[Z.kTabsBarPosition];return"top"===e||"bottom"===e};render(){const{prefValues:e}=this.props;return(0,zn.jsx)(tb.Z,{filter:this.props.filter,children:(0,zn.jsxs)("span",{children:[(0,zn.jsx)("div",{className:"setting-group",children:(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Close Tab Activation")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{title:(0,W.Z)("Activate tabs related by origin first"),children:[(0,zn.jsx)("input",{type:"checkbox",checked:e[Z.kTabsActivationPreferRelated],onChange:wR(Z.kTabsActivationPreferRelated)}),(0,zn.jsx)("span",{children:(0,W.Z)("Always Activate Related Tab")})]})}),(0,zn.jsx)("div",{className:"setting-single pad-top",children:(0,zn.jsxs)(To.Z,{name:"tabActivate",value:e[Z.kTabsActivationOnClose],onChange:wR(Z.kTabsActivationOnClose),children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[xR,(0,zn.jsx)("span",{children:(0,W.Z)("Activate in Recently Used Order")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[IR,(0,zn.jsx)("span",{children:this.isHorizontal()?(0,W.Z)("Activate Left in Tab Order"):(0,W.Z)("Activate Above in Tab Order")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[AR,(0,zn.jsx)("span",{children:this.isHorizontal()?(0,W.Z)("Activate Right in Tab Order"):(0,W.Z)("Activate Below in Tab Order")})]})})]})})]})}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Tab Handling")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{title:(0,W.Z)("Align the close buttons to easily close multiple tabs"),children:[(0,zn.jsx)("input",{type:"checkbox",checked:e[Z.kTabsAlignNext],onChange:wR(Z.kTabsAlignNext)}),(0,zn.jsx)("span",{children:(0,W.Z)("Align Next Close Button")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{title:(0,W.Z)("Prevents window closing along with last tab."),children:[(0,zn.jsx)("input",{type:"checkbox",checked:e[Z.kTabsNeverCloseLast],onChange:wR(Z.kTabsNeverCloseLast)}),(0,zn.jsx)("span",{children:(0,W.Z)("Keep Window Open when Last Tab is Closed")})]})}),(0,zn.jsxs)("div",{className:"setting-single max-bookmarks",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.props.prefValues[Z.kTabsConfirmClosingTabs],onChange:wR(Z.kTabsConfirmClosingTabs)}),(0,zn.jsx)("span",{children:(0,W.Z)("Confirm Closing Tabs over Maximum of")})]}),(0,zn.jsx)("input",{type:"number",size:"2",disabled:!this.props.prefValues[Z.kTabsConfirmClosingTabs],value:this.props.prefValues[Z.kTabsConfirmClosingThreshold],onChange:wR(Z.kTabsConfirmClosingThreshold),min:this.confirmClosingTabsMinThreshold,max:this.confirmClosingTabsMaxThreshold})]}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{title:(0,W.Z)("Focus page content instead of addressfield"),children:[(0,zn.jsx)("input",{type:"checkbox",checked:e[Z.kTabsFocusWebview],onChange:wR(Z.kTabsFocusWebview)}),(0,zn.jsx)("span",{children:(0,W.Z)("Focus Page Content on New Tab")})]})}),(0,zn.jsxs)(To.Z,{name:"tabDoubleClick",value:e[Z.kTabsDoubleClick],onChange:wR(Z.kTabsDoubleClick),children:[(0,zn.jsx)("div",{className:"setting-single pad-top",children:(0,zn.jsxs)("label",{children:[SR,(0,zn.jsx)("span",{children:(0,W.Z)("Double-Click to Rename Tab")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[ZR,(0,zn.jsx)("span",{children:(0,W.Z)("Double-Click to Close Tab")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[TR,(0,zn.jsx)("span",{children:(0,W.Z)("Ignore Double-Click")})]})})]})]})]})})}}const kR=(0,zd.Z)(ER,yR),NR=I.Z.getEventHandler,_R=[Z.kMouseWheelTabSwitch,Z.kTabsCycleByRecentOrder,Z.kTabsMinimize,Z.kTabsVisualSwitchEnable,Z.kTabsVisualSwitchListLayout];var PR=(0,zn.jsx)("input",{type:"radio",value:"true"}),MR=(0,zn.jsx)("input",{type:"radio",value:"false"});class DR extends Un.Component{render(){const e=this.props.prefValues;return(0,zn.jsx)(tb.Z,{filter:this.props.filter,children:(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{htmlFor:"tabSelection",children:(0,W.Z)("Tab Cycling")}),(0,zn.jsxs)(To.Z,{name:"tabCyclingOrder",value:this.props.prefValues[Z.kTabsCycleByRecentOrder],onChange:NR(Z.kTabsCycleByRecentOrder,"convert"),children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[PR,(0,zn.jsx)("span",{children:(0,W.Z)("Cycle in Recently Used Order")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[MR,(0,zn.jsx)("span",{children:(0,W.Z)("Cycle in Tab Order")})]})})]}),(0,zn.jsx)("div",{className:"setting-single pad-top",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.props.prefValues[Z.kTabsVisualSwitchEnable],onChange:NR(Z.kTabsVisualSwitchEnable)}),(0,zn.jsx)("span",{children:(0,W.Z)("Show Tab Cycler")})]})}),(0,zn.jsx)("div",{className:"setting-single pad-left",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.props.prefValues[Z.kTabsVisualSwitchListLayout],disabled:!this.props.prefValues[Z.kTabsVisualSwitchEnable],onChange:NR(Z.kTabsVisualSwitchListLayout)}),(0,zn.jsx)("span",{children:(0,W.Z)("Display Tab Cycler as List")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{title:(0,W.Z)("Scroll over Tab Bar to switch tabs by order, or scroll anywhere else while holding Alt key to switch tabs per Tab Cycling setting."),children:[(0,zn.jsx)("input",{type:"checkbox",checked:e[Z.kMouseWheelTabSwitch],onChange:NR(Z.kMouseWheelTabSwitch)}),(0,zn.jsx)("span",{children:(0,W.Z)("Switch Tabs by Scrolling")})]})}),(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.props.prefValues[Z.kTabsMinimize],onChange:NR(Z.kTabsMinimize)}),(0,zn.jsx)("span",{children:(0,W.Z)("Minimize Active Tab")})]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Click current tab to switch to last active tab.")})]})]})})}}const OR=(0,zd.Z)(DR,_R),jR=I.Z.getEventHandler,LR=[Z.kTabsAutoMuting];var RR=(0,zn.jsx)("input",{type:"radio",value:"off"}),BR=(0,zn.jsx)("input",{type:"radio",value:"onlyActive"}),FR=(0,zn.jsx)("input",{type:"radio",value:"prioritizeActive"});class WR extends Un.Component{render(){return(0,zn.jsx)(tb.Z,{filter:this.props.filter,children:(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Mute Tab Audio")}),(0,zn.jsxs)(To.Z,{name:"mutableTabs",value:this.props.prefValues[Z.kTabsAutoMuting],onChange:jR(Z.kTabsAutoMuting),children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[RR,(0,zn.jsx)("span",{children:(0,W.Z)("Play All Audio")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[BR,(0,zn.jsx)("span",{children:(0,W.Z)("Play Only in Active Tab")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[FR,(0,zn.jsx)("span",{children:(0,W.Z)("Prioritize Active Tab")})]})})]})]})})}}const UR=(0,zd.Z)(WR,LR),VR=I.Z.getEventHandler,HR=[Z.kTabsActivationOnClone,Z.kTabsNewPlacement,Z.kTabsOpenNewInBackground];var GR=(0,zn.jsx)("input",{type:"radio",value:"rightofcurrent"}),KR=(0,zn.jsx)("input",{type:"radio",value:"directrightofcurrent"}),zR=(0,zn.jsx)("input",{type:"radio",value:"alwayslast"}),$R=(0,zn.jsx)("input",{type:"radio",value:"openintabstackwithrelated"}),YR=(0,zn.jsx)("input",{type:"radio",value:"rightofcurrent"}),XR=(0,zn.jsx)("input",{type:"radio",value:"alwayslast"});class QR extends Un.Component{render(){return(0,zn.jsx)(tb.Z,{filter:this.props.filter,children:(0,zn.jsxs)("span",{children:[(0,zn.jsx)("div",{className:"setting-group",children:(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("New Tab Position")}),(0,zn.jsxs)(To.Z,{name:"tabOpen",value:this.props.prefValues[Z.kTabsNewPlacement],onChange:VR(Z.kTabsNewPlacement),children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[GR,(0,zn.jsx)("span",{children:(0,W.Z)("After Related Tabs")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[KR,(0,zn.jsx)("span",{children:(0,W.Z)("After Active Tab")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[zR,(0,zn.jsx)("span",{children:(0,W.Z)("As Last Tab")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[$R,(0,zn.jsx)("span",{children:(0,W.Z)("As Tab Stack with Related Tab")})]})})]}),(0,zn.jsx)("div",{className:"setting-single pad-top",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.props.prefValues[Z.kTabsOpenNewInBackground],onChange:VR(Z.kTabsOpenNewInBackground)}),(0,zn.jsx)("span",{children:(0,W.Z)("New Tab from Link Opens in Background")})]})})]})}),(0,zn.jsx)("div",{className:"setting-group",children:(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Duplicated Tab Position")}),(0,zn.jsxs)(To.Z,{name:"tabClone",value:this.props.prefValues[Z.kTabsActivationOnClone],onChange:VR(Z.kTabsActivationOnClone),children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[YR,(0,zn.jsx)("span",{children:(0,W.Z)("Next to Original Tab")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[XR,(0,zn.jsx)("span",{children:(0,W.Z)("As Last Tab")})]})})]})]})})]})})}}const qR=(0,zd.Z)(QR,HR),JR=I.Z.getEventHandler,eB=[Z.kHoverCardMemoryUsageEnabled,Z.kTabsActiveMinSize,Z.kTabsAtEdge,Z.kTabsCloseButtonLeft,Z.kTabsCloseButtonPermanent,Z.kTabsCounterDetection,Z.kTabsDimHibernated,Z.kTabsHorizontalScrolling,Z.kTabsPageLoadInfo,Z.kTabsShowCloseButton,Z.kTabsShowSyncedTabsButton,Z.kTabsShowTrashCan,Z.kTabsThumbnails,Z.kTabsTooltip,Z.kTabsUnread];var tB=(0,zn.jsx)("input",{type:"radio",value:"progress_bar"}),sB=(0,zn.jsx)("input",{type:"radio",value:"progress_icon"}),nB=(0,zn.jsx)("input",{type:"radio",value:"spinner"}),iB=(0,zn.jsx)("input",{type:"radio",value:"none"});class aB extends Un.Component{render(){const{prefValues:e}=this.props,{hasToken:t,isReady:n}=me.getState();return(0,zn.jsxs)(tb.Z,{filter:this.props.filter,children:[(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("tbd","Tab Bar")}),(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:e[Z.kTabsHorizontalScrolling],onChange:JR(Z.kTabsHorizontalScrolling)}),(0,zn.jsx)("span",{children:(0,W.Z)("Enable Horizontal Scrolling")})]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Hold Shift key when “Switch Tabs by Scrolling” setting is enabled.")})]}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:e[Z.kTabsAtEdge],onChange:JR(Z.kTabsAtEdge)}),(0,zn.jsx)("span",{children:(0,W.Z)("Remove Tab Spacing in Maximized Windows")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:e[Z.kTabsShowTrashCan],onChange:JR(Z.kTabsShowTrashCan)}),(0,zn.jsx)("span",{children:(0,W.Z)("Display Trash Can")})]})}),(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:e[Z.kTabsShowSyncedTabsButton],onChange:JR(Z.kTabsShowSyncedTabsButton),disabled:!t&&!n}),(0,zn.jsx)("span",{children:(0,W.Z)("Display Synced Tabs Button")})]}),!t&&!n&&(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("This setting requires active Sync.")})]})]}),(0,zn.jsx)("div",{className:"setting-group",children:(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Tab Options")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:e[Z.kTabsTooltip],onChange:JR(Z.kTabsTooltip)}),(0,zn.jsx)("span",{children:(0,W.Z)("Show Popup Thumbnails")})]})}),(0,zn.jsx)("div",{className:"setting-single pad-left",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:e[Z.kHoverCardMemoryUsageEnabled],onChange:JR(Z.kHoverCardMemoryUsageEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("Show Tab Memory Usage")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:e[Z.kTabsThumbnails],onChange:JR(Z.kTabsThumbnails)}),(0,zn.jsx)("span",{children:(0,W.Z)("Show Tab Thumbnails")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:e[Z.kTabsShowCloseButton],onChange:JR(Z.kTabsShowCloseButton)}),(0,zn.jsx)("span",{children:(0,W.Z)("Display Close Button")})]})}),(0,zn.jsx)("div",{className:"setting-single pad-left",children:(0,zn.jsxs)("label",{title:(0,W.Z)("Display Close button on left side of a tab"),children:[(0,zn.jsx)("input",{type:"checkbox",disabled:!e[Z.kTabsShowCloseButton],checked:e[Z.kTabsCloseButtonLeft],onChange:JR(Z.kTabsCloseButtonLeft)}),(0,zn.jsx)("span",{children:(0,W.Z)("On Left Side")})]})}),(0,zn.jsx)("div",{className:"setting-single pad-left",children:(0,zn.jsxs)("label",{title:(0,W.Z)("Permanently display Close button"),children:[(0,zn.jsx)("input",{type:"checkbox",disabled:!e[Z.kTabsShowCloseButton],checked:e[Z.kTabsCloseButtonPermanent],onChange:JR(Z.kTabsCloseButtonPermanent)}),(0,zn.jsx)("span",{children:(0,W.Z)("Permanently")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{title:(0,W.Z)("Detect and display numeric notification from page title in Tabs and Web Panels"),children:[(0,zn.jsx)("input",{type:"checkbox",checked:e[Z.kTabsCounterDetection],onChange:JR(Z.kTabsCounterDetection)}),(0,zn.jsx)("span",{children:(0,W.Z)("Detect Page Title Notifications")})]})}),(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{title:(0,W.Z)("Display a triangle symbol for unread Tabs"),children:[(0,zn.jsx)("input",{type:"checkbox",checked:e[Z.kTabsUnread],onChange:JR(Z.kTabsUnread)}),(0,zn.jsx)("span",{children:(0,W.Z)("Use Unread Indicators")})]}),(0,zn.jsx)("div",{className:e[Z.kTabsUnread]?"img-setting":"img-setting disabled",children:(0,zn.jsx)("span",{className:"image",dangerouslySetInnerHTML:{__html:s(33271)}})})]}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:e[Z.kTabsDimHibernated],onChange:JR(Z.kTabsDimHibernated)}),(0,zn.jsx)("span",{children:(0,W.Z)("Dim Icon when Hibernated")})]})})]})}),(0,zn.jsxs)("div",{className:"setting-group tab-min-width",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Active Tab Minimum Width")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)(tI,{value:e[Z.kTabsActiveMinSize],min:30,max:180,step:30,onChange:JR(Z.kTabsActiveMinSize),label:(0,W.Z)("$1 pixel","$1 pixels",[e[Z.kTabsActiveMinSize]]),title:(0,W.Z)("Minimum width of horizontally scaled active tab")})})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Page Load Progress")}),(0,zn.jsxs)(To.Z,{name:"tabPageLoadInfo",value:this.props.prefValues[Z.kTabsPageLoadInfo],onChange:JR(Z.kTabsPageLoadInfo),children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{title:(0,W.Z)("Display tab progress bar while page is loading"),children:[tB,(0,zn.jsx)("span",{children:(0,W.Z)("Progress Bar")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{title:(0,W.Z)("Display circular progress in place of favicon while page is loading"),children:[sB,(0,zn.jsx)("span",{children:(0,W.Z)("Favicon Progress")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{title:(0,W.Z)("Display spinner in place of favicon while page is loading"),children:[nB,(0,zn.jsx)("span",{children:(0,W.Z)("Favicon Spinner")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{title:(0,W.Z)("Don’t display page loading progress"),children:[iB,(0,zn.jsx)("span",{children:(0,W.Z)("radio","None")})]})})]})]})]})}}const oB=(0,zd.Z)(aB,eB),rB=I.Z.getEventHandler,lB=[Z.kExtensionURLOverrides,Z.kTabsNewPageLink],dB=[Z.kTabsNewPageLink,Z.kTabsNewPageCustomUrl];class cB extends Un.Component{state={customUrl:A.Z.get(Z.kTabsNewPageCustomUrl)};_handleCustomUrlChange=({currentTarget:e})=>{const t=e.value;this.setState({customUrl:t}),this._saveCustomUrl(t)};_saveCustomUrl=e=>{const t=(0,Ar.q9)(e);I.Z.set(Z.kTabsNewPageCustomUrl,t),this.props.prefValues[Z.kTabsNewPageLink]!==u.Fp.CUSTOM&&I.Z.set(Z.kTabsNewPageLink,u.Fp.CUSTOM)};focusCustomUrlInput=()=>{this._customPageRef&&this._customPageRef.focus()};render(){const e=this.props.prefValues,t=e[Z.kExtensionURLOverrides].newtab?.some((e=>e.active)),s=e[Z.kTabsNewPageLink]===u.Fp.EXTENSION;return(0,zn.jsx)(tb.Z,{filter:this.props.filter,children:(0,zn.jsxs)("div",{className:"setting-group new-tab-page",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("title","New Tab Page")}),(0,zn.jsxs)(To.Z,{name:"tabPageSettings",value:e[Z.kTabsNewPageLink],onChange:rB(Z.kTabsNewPageLink),children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"radio",value:u.Fp.STARTPAGE,checked:e[Z.kTabsNewPageLink]===u.Fp.STARTPAGE||e[Z.kTabsNewPageLink]===u.Fp.EXTENSION,onChange:rB(Z.kTabsNewPageLink)}),(0,zn.jsx)("span",{children:(0,W.Z)("noun","Start Page")})]})}),(0,zn.jsx)("div",{className:"setting-single pad-left",children:(0,zn.jsxs)("label",{title:(0,W.Z)("Allow installed third-party extensions to control the Start Page"),children:[(0,zn.jsx)("input",{type:"checkbox",disabled:!t,checked:s,onChange:rB(Z.kTabsNewPageLink),value:s?u.Fp.STARTPAGE:u.Fp.EXTENSION}),(0,zn.jsx)("span",{children:(0,W.Z)("Controlled by Extension")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"radio",value:u.Fp.HOMEPAGE}),(0,zn.jsx)("span",{children:(0,W.Z)("other","Homepage")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"radio",value:u.Fp.BLANKPAGE}),(0,zn.jsx)("span",{children:(0,W.Z)("other","Blank Page")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"radio",className:"pad-top",onMouseUp:this.focusCustomUrlInput,value:u.Fp.CUSTOM}),(0,zn.jsx)("span",{children:(0,zn.jsx)("input",{type:"text",ref:e=>this._customPageRef=e,placeholder:(0,W.Z)("Specific Page"),onChange:this._handleCustomUrlChange,value:this.state.customUrl,tabIndex:e[Z.kTabsNewPageLink]===u.Fp.CUSTOM?0:-1})})]})})]})]})})}}const hB=(0,zd.Z)(cB,lB),uB=[Z.kTabsClosePinned,Z.kTabsShowSeparator,Z.kTabsClosePinnedInStack],pB=I.Z.getEventHandler;var gB=(0,zn.jsx)("input",{type:"radio",value:"off"}),mB=(0,zn.jsx)("input",{type:"radio",value:"bury"}),fB=(0,zn.jsx)("input",{type:"radio",value:"on"});class vB extends Un.Component{render(){return(0,zn.jsx)(tb.Z,{filter:this.props.filter,children:(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Pinned Tabs")}),(0,zn.jsxs)(To.Z,{name:"closablePinnedTabs",value:this.props.prefValues[Z.kTabsClosePinned],onChange:pB(Z.kTabsClosePinned),children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[gB,(0,zn.jsx)("span",{children:(0,W.Z)("Don’t Close Pinned Tabs")})]})}),(0,zn.jsx)("div",{className:"setting-single pad-left",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",disabled:!this.props.prefValues[Z.kTabsClosePinned],onChange:pB(Z.kTabsClosePinnedInStack),checked:this.props.prefValues[Z.kTabsClosePinnedInStack]}),(0,zn.jsx)("span",{children:(0,W.Z)("Allow Closing in Pinned Stacks")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[mB,(0,zn.jsx)("span",{children:(0,W.Z)("Minimize Instead of Close")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[fB,(0,zn.jsx)("span",{children:(0,W.Z)("Close as Other Tabs")})]})})]}),(0,zn.jsx)("div",{className:"setting-single pad-top",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.props.prefValues[Z.kTabsShowSeparator],onChange:pB(Z.kTabsShowSeparator)}),(0,zn.jsx)("span",{children:(0,W.Z)("Show Separator Below Pinned Tabs")})]})})]})})}}const bB=(0,zd.Z)(vB,uB),CB={top:(0,W.Z)("Top"),right:(0,W.Z)("title","Right"),bottom:(0,W.Z)("Bottom"),left:(0,W.Z)("title","Left")};var wB=(0,zn.jsxs)("g",{children:[(0,zn.jsx)("path",{className:"thumb-preview-colorBg",d:"M0 0h96v76H0z"}),(0,zn.jsx)("path",{className:"thumb-preview-colorBgDark",d:"M0 0h96v12H0z"}),(0,zn.jsx)("path",{className:"thumb-preview-non-active-tab",d:"M33 2h30v8H33zM64 2h30v8H64z"}),(0,zn.jsx)("path",{className:"thumb-preview-colorAccentBg",d:"M2 2h30v8H2z"})]}),yB=(0,zn.jsxs)("g",{children:[(0,zn.jsx)("path",{className:"thumb-preview-colorBg",d:"M0 0h96v76H0z"}),(0,zn.jsx)("path",{className:"thumb-preview-colorBgDark",d:"M62 0h34v76H62z"}),(0,zn.jsx)("path",{className:"thumb-preview-non-active-tab",d:"M64 11h30v8H64zM64 20h30v8H64z"}),(0,zn.jsx)("path",{className:"thumb-preview-colorAccentBg",d:"M64 2h30v8H64z"})]}),xB=(0,zn.jsxs)("g",{children:[(0,zn.jsx)("path",{className:"thumb-preview-colorBg",d:"M0 0h96v76H0z"}),(0,zn.jsx)("path",{className:"thumb-preview-colorBgDark",d:"M0 64h96v12H0z"}),(0,zn.jsx)("path",{className:"thumb-preview-non-active-tab",d:"M33 66h30v8H33zM64 66h30v8H64z"}),(0,zn.jsx)("path",{className:"thumb-preview-colorAccentBg",d:"M2 66h30v8H2z"})]}),IB=(0,zn.jsxs)("g",{children:[(0,zn.jsx)("path",{className:"thumb-preview-colorBg",d:"M0 0h96v76H0z"}),(0,zn.jsx)("path",{className:"thumb-preview-colorBgDark",d:"M0 0h34v76H0z"}),(0,zn.jsx)("path",{className:"thumb-preview-non-active-tab",d:"M2 11h30v8H2zM2 20h30v8H2z"}),(0,zn.jsx)("path",{className:"thumb-preview-colorAccentBg",d:"M2 2h30v8H2z"})]}),AB=(0,zn.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"selectbox-checkmark",viewBox:"0 0 16 16",children:(0,zn.jsx)("path",{d:"M5.3 13.3L1.5 9.5 3 8l2.3 2.5L13 2.7 14.6 4l-8 8z"})});class SB extends Un.Component{render(){if(!this.props.position)return null;const e=this.props.position,t=CB[this.props.position],s=Gn()({selectbox:!0,"selectbox-selected":this.props.selected}),n=(0,ys.Z)(this.props,["position","vivaldiSettings"]);return(0,zn.jsxs)("button",{className:s,title:t,...n,children:[(0,zn.jsxs)("div",{className:"selectbox-image",children:[(0,zn.jsxs)("svg",{viewBox:"0 0 96 76",xmlns:"http://www.w3.org/2000/svg",className:"tab-preview",children:["top"===e&&wB,"right"===e&&yB,"bottom"===e&&xB,"left"===e&&IB]}),AB]}),(0,zn.jsx)("div",{className:"selectbox-title",children:t})]})}}const ZB=SB,TB="left",EB="right",kB="bottom",NB=[Z.kTabsBarPosition,Z.kTabsVisible],_B=I.Z.getEventHandler;class PB extends Un.Component{setTabPosition=e=>{I.Z.set(Z.kTabsBarPosition,e)};render(){const e=this.props.prefValues,t=e[Z.kTabsBarPosition];return(0,zn.jsxs)(tb.Z,{filter:this.props.filter,children:[(0,zn.jsx)("div",{className:"setting-group unlimited",children:(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:e[Z.kTabsVisible],onChange:_B(Z.kTabsVisible)}),(0,zn.jsx)("span",{children:(0,W.Z)("radio","Show Tab Bar")})]})})}),(0,zn.jsx)("div",{className:"setting-group unlimited",children:(0,zn.jsxs)("div",{className:"setting-single tabbar-position",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Tab Bar Position")}),(0,zn.jsxs)("div",{className:"selectbox-container",children:[(0,zn.jsx)(ZB,{position:"top",selected:"top"===t,onClick:this.setTabPosition.bind(this,"top")}),(0,zn.jsx)(ZB,{position:"left",selected:t===TB,onClick:this.setTabPosition.bind(this,TB)}),(0,zn.jsx)(ZB,{position:"right",selected:t===EB,onClick:this.setTabPosition.bind(this,EB)}),(0,zn.jsx)(ZB,{position:"bottom",selected:t===kB,onClick:this.setTabPosition.bind(this,kB)})]})]})})]})}}const MB=(0,zd.Z)(PB,NB),DB=I.Z.getEventHandler,OB=[Z.kTabsSelectionEnabled,Z.kTabsSelectionIncludeActive];class jB extends Un.Component{render(){return(0,zn.jsx)(tb.Z,{filter:this.props.filter,children:(0,zn.jsx)("div",{className:"setting-group",children:(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Tab Selection")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{title:(0,W.Z)("Select multiple tabs with Ctrl and Shift"),children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.props.prefValues[Z.kTabsSelectionEnabled],onChange:DB(Z.kTabsSelectionEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("Enable Tab Selection")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{title:(0,W.Z)("The active tab will always be part of the initial tab selection"),children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.props.prefValues[Z.kTabsSelectionIncludeActive],onChange:DB(Z.kTabsSelectionIncludeActive)}),(0,zn.jsx)("span",{children:(0,W.Z)("Include Active Tab in Initial Selection")})]})})]})})})}}const LB=(0,zd.Z)(jB,OB),RB=I.Z.getEventHandler,BB=[Z.kTabsStackingAllowDnd,Z.kTabsStackingAutoExpand,Z.kTabsStackingMode,Z.kTabsStackingOpenInCurrent,Z.kTabsBarWidth,Z.kTabsStackingPreferDotted,Z.kTabsStackingDndDelay];class FB extends Un.Component{render(){const{prefValues:e}=this.props;return(0,zn.jsxs)(tb.Z,{filter:this.props.filter,children:[(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Tab Stacking")}),(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{name:"tab-stack-style",type:"radio",value:"dotted",checked:"dotted"===e[Z.kTabsStackingMode],onChange:RB(Z.kTabsStackingMode)}),(0,zn.jsx)("span",{children:(0,W.Z)("radio","Compact")})]}),(0,zn.jsx)("div",{className:"dotted"===e[Z.kTabsStackingMode]?"img-setting":"img-setting disabled",children:(0,zn.jsx)("span",{className:"image",dangerouslySetInnerHTML:{__html:s(18998)}})})]}),(0,zn.jsxs)("div",{className:"setting-single pad-top",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{name:"tab-stack-style",type:"radio",value:"substrip",checked:"substrip"===e[Z.kTabsStackingMode],onChange:()=>{I.Z.set(Z.kTabsBarWidth,260),I.Z.set(Z.kTabsStackingMode,"substrip")}}),(0,zn.jsx)("span",{children:(0,W.Z)("Two-Level")})]}),(0,zn.jsx)("div",{className:"substrip"===e[Z.kTabsStackingMode]?"img-setting":"img-setting disabled",children:(0,zn.jsx)("span",{className:e[Z.kTabsStackingPreferDotted]?"image alternate":"image",dangerouslySetInnerHTML:{__html:s(86681)}})})]}),(0,zn.jsx)("div",{className:"setting-single pad-left",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",disabled:"substrip"!==e[Z.kTabsStackingMode],checked:e[Z.kTabsStackingPreferDotted],onChange:RB(Z.kTabsStackingPreferDotted)}),(0,zn.jsx)("span",{children:(0,W.Z)("Use Compact Display Style")})]})}),(0,zn.jsxs)("div",{className:"setting-single pad-top",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{name:"tab-stack-style",type:"radio",value:"accordion",checked:"accordion"===e[Z.kTabsStackingMode],onChange:RB(Z.kTabsStackingMode)}),(0,zn.jsx)("span",{children:(0,W.Z)("Accordion")})]}),(0,zn.jsx)("div",{className:"accordion"===e[Z.kTabsStackingMode]?"img-setting":"img-setting disabled",children:(0,zn.jsx)("span",{className:"image",dangerouslySetInnerHTML:{__html:s(86484)}})})]}),(0,zn.jsx)("div",{className:"setting-single pad-left",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",disabled:"accordion"!==e[Z.kTabsStackingMode],checked:e[Z.kTabsStackingAutoExpand],onChange:RB(Z.kTabsStackingAutoExpand)}),(0,zn.jsx)("span",{children:(0,W.Z)("Auto Expand")})]})}),(0,zn.jsx)("div",{className:"setting-single pad-top",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{name:"tab-stack-style",type:"radio",value:"off",checked:"off"===e[Z.kTabsStackingMode],onChange:RB(Z.kTabsStackingMode)}),(0,zn.jsx)("span",{children:(0,W.Z)("Disable")})]})})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Tab Stack Options")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",disabled:"off"===e[Z.kTabsStackingMode],checked:e[Z.kTabsStackingOpenInCurrent],onChange:RB(Z.kTabsStackingOpenInCurrent)}),(0,zn.jsx)("span",{children:(0,W.Z)("Open Tabs in Current Tab Stack")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",disabled:"off"===e[Z.kTabsStackingMode],checked:e[Z.kTabsStackingAllowDnd],onChange:RB(Z.kTabsStackingAllowDnd)}),(0,zn.jsx)("span",{children:(0,W.Z)("Allow Stacking by Drag and Drop")})]})}),(0,zn.jsxs)("div",{className:"setting-single stacking-delay pad-left",children:[(0,zn.jsx)("label",{htmlFor:"stacking-delay",title:(0,W.Z)("Adjust tab stack drop detection delay when moving a tab over another one."),children:(0,W.Z)("Stacking Drop Delay")}),(0,zn.jsx)("input",{type:"range",id:"stacking-delay",value:e[Z.kTabsStackingDndDelay],min:50,max:850,step:200,disabled:!e[Z.kTabsStackingAllowDnd]||"off"===e[Z.kTabsStackingMode],onChange:RB(Z.kTabsStackingDndDelay)}),(0,zn.jsxs)("p",{className:"info stack-speed",children:[(0,zn.jsx)("span",{children:(0,W.Z)("Short")}),(0,zn.jsx)("span",{children:(0,W.Z)("Long")})]})]})]})]})}}const WB=(0,zd.Z)(FB,BB),UB=(I.Z.getEventHandler,[Z.kTabsTilingCollapseBorder]);const VB=["❤️","✨","😊","🎁","😂","🎉","👍","✅","⭐","👉","😉","🥰","👀","🤔","😭","🥳","💵","✈️","📚"],HB=({closeModal:e,onPick:t,top:s,left:n,activeIcon:i,activeEmoji:a})=>{const o=(0,Un.useRef)(),[r,l]=(0,Un.useState)(void 0!==a),d=e=>{if(r){const s=e.currentTarget.dataset.emoji;return void t(s)}const s=parseInt(e.currentTarget.dataset.id);isNaN(s)||t(s)};return(0,zn.jsx)(Ha.Z,{className:"icon-picker",onRequestClose:e,style:{width:230,minWidth:"unset",top:s,left:n,right:"auto"},labelledBy:"modal-dialog-workspace-icon",children:(0,zn.jsxs)("form",{onSubmit:s=>{const n=o.current?.value;n?t(n):e()},children:[(0,zn.jsxs)("header",{className:"dialog-header",children:[(0,zn.jsx)("span",{id:"modal-dialog-workspace-icon",children:(0,W.Z)("Select Workspace Icon")}),(0,zn.jsxs)("div",{className:"dialog-header buttons",children:[(0,zn.jsx)("input",{type:"button",className:r?"":"active",value:(0,W.Z)("title","Icon"),onClick:()=>l(!1)}),(0,zn.jsx)("input",{type:"button",className:r?"active":"",value:`${(0,W.Z)("Emoji")} 😀`,onClick:()=>l(!0)})]})]}),(0,zn.jsxs)("div",{className:"dialog-content workspaces",children:[!r&&(0,zn.jsx)("ul",{children:m_.S.map(((e,t)=>(0,zn.jsx)("li",{className:i===e?"active":"","data-id":t,onClick:d,children:(0,zn.jsx)("span",{className:"icon",dangerouslySetInnerHTML:{__html:e}})},t)))}),r&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("ul",{children:[VB.map(((e,t)=>(0,zn.jsx)("li",{className:a===e?"active":"","data-emoji":e,onClick:d,children:e},e))),a&&!VB.includes(a)&&(0,zn.jsx)("li",{className:"active","data-emoji":a,onClick:d,children:a},a)]}),(0,zn.jsx)("input",{ref:o,type:"text",pattern:"^(?:\\p{Emoji}+(?:\\ufe0f|\\u200d)|\\u20e3)*)+\\p{Emoji}?$",placeholder:(0,W.Z)("Paste any emoji here 👍"),onChange:e=>{const s=o.current,n=s?.value;n&&!s?.validity.patternMismatch&&t(n)}})]})]}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"submit",value:(0,W.Z)("OK"),autoFocus:!0}),(0,zn.jsx)("input",{type:"button",onClick:e,value:(0,W.Z)("Cancel"),autoFocus:!0})]})]})})};var GB=s(29104);function KB(){const e=m_.Z.getState(),t=(0,W.Z)("title","New Workspace");if(!e.some((e=>e.name===t)))return t;const s=`^${(0,W.Z)("New Workspace $1",["(\\d+)"])}$`,n=e.map((e=>{const t=e.name.match(s);if(t)return Number(t[1]).valueOf()})).filter(Boolean),i=0===n.length?0:Math.max(...n);return(0,W.Z)("New Workspace $1",[i+1])}function zB(){return m_.S[Math.floor(Math.random()*m_.S.length)]}class $B extends Un.PureComponent{static contextType=oi.Z;refTop=Un.createRef();state={name:KB(),isIconPickerVisible:!1,includeWindowTabs:!1,includeSelectedTabs:Boolean(!this.props.disableMoveTabs&&this.props.withPages&&!this.props.withPages.isEmpty()),activeIcon:zB(),activeEmoji:void 0};handleDismiss=this.props.onClose;handleChange=e=>{this.setState({name:e.currentTarget.value})};handleIncludeWindowTabs=()=>{this.setState((e=>({includeWindowTabs:!e.includeWindowTabs})))};handleIncludeSelectedTabs=()=>{this.setState((e=>({includeSelectedTabs:!e.includeSelectedTabs})))};handleCreate=e=>{const t=this.context.vivaldiWindowId,{name:s,activeIcon:n,activeEmoji:i,includeWindowTabs:a,includeSelectedTabs:o}=this.state,{withPages:r}=this.props;let l;o?l=r:a&&(l=Ze.ZP.getPages(t,{workspaceId:void 0})),e.preventDefault(),s&&n&&(GB.Z.addWorkspace(s,n,i,l,this.props.createInBackground),this.props.onClose())};showIconPicker=()=>{this.props.onShowIconPicker?this.props.onShowIconPicker():this.setState({isIconPickerVisible:!0})};hideIconPicker=()=>{this.setState({isIconPickerVisible:!1})};handlePick=e=>{if("number"==typeof e){const t=m_.S[e];this.setState({activeIcon:t,activeEmoji:void 0})}else this.setState({activeEmoji:e});this.hideIconPicker()};handleFocus=e=>{e.target instanceof this.context.HTMLInputElement&&e.target.select()};scrollIntoView=()=>{this.refTop.current?.scrollIntoViewIfNeeded()};render(){const{name:e,activeIcon:t,activeEmoji:s,includeWindowTabs:n,isIconPickerVisible:i}=this.state,a=this.props,o=void 0===Ze.ZP.getActiveWorkspace(a.windowId);return(0,zn.jsxs)("div",{ref:this.refTop,className:Gn()("workspace-new",a.className),style:a.style,children:[(0,zn.jsx)("header",{className:"dialog-header",children:(0,zn.jsx)("h1",{id:Ha.t,children:(0,W.Z)("workspaces","Create Workspace")})}),(0,zn.jsx)("div",{className:"dialog-content",children:(0,zn.jsxs)("form",{className:"create-form",onSubmit:this.handleCreate,children:[(0,zn.jsx)("div",{className:"icon-button",style:{alignItems:o?"center":"flex-end"},onClick:this.showIconPicker,dangerouslySetInnerHTML:{__html:s??t}}),(0,zn.jsxs)("div",{className:"inputs",children:[(0,zn.jsxs)("label",{children:[(0,W.Z)("Workspace Name"),(0,zn.jsx)("input",{type:"text",value:e,placeholder:(0,W.Z)("Choose Workspace Name"),onChange:this.handleChange,autoFocus:!0,onFocus:this.handleFocus})]}),o&&!a.disableMoveTabs&&!a.withPages&&(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:n,onChange:this.handleIncludeWindowTabs}),(0,W.Z)("Move tabs from current window to the new workspace")]}),!a.disableMoveTabs&&a.withPages&&!a.withPages.isEmpty()&&(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.state.includeSelectedTabs,onChange:this.handleIncludeSelectedTabs}),(0,W.Z)("Move selected tabs to the new workspace")]})]})]})}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Create"),className:"primary",disabled:!e,onClick:this.handleCreate}),(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Cancel"),onClick:this.handleDismiss})]}),i&&(0,zn.jsx)(HB,{closeModal:this.hideIconPicker,onPick:this.handlePick,activeIcon:t,activeEmoji:s,top:0,left:10})]})}}const YB=$B;var XB=s(5200),QB=s(59240);const qB="DRAGGABLE_RULE";var JB=(0,zn.jsx)("option",{value:""},"");function eF({windowId:e,rule:t,ruleCount:s,style:n,workspaces:i,findItem:a,moveItem:o,onDelete:r,onFocus:l,onTypeChanged:d,onExpressionChanged:c,onWorkspaceChanged:h,onDrop:u,onAddWorkspace:p}){const g=Un.useRef(null),m=a(t.id)?.index,f=(m??0)+1,[{isDragging:v,handlerId:b},C]=(0,XB.c)((()=>({type:qB,item:{id:t.id,originalIndex:m},collect:e=>({isDragging:e.isDragging(),handlerId:e.getHandlerId()})})),[t.id,m]),[,w]=(0,QB.L)((()=>({accept:qB,hover(e,s){if(!g.current||"number"!=typeof m)return;const n=e.originalIndex,i=m;if(n===i)return;const a=g.current?.getBoundingClientRect(),r=(a.bottom-a.top)/2,l=s.getClientOffset().y-a.top;n<i&&l<r||n>i&&l>r||(o(e.id,t.id),e.originalIndex=i)},drop:u})),[t.id,o]);return C(g),w(g),(0,zn.jsxs)("div",{ref:g,className:"WorkspaceLinkRouting-Item",style:{...n,opacity:v?0:1},"data-handler-id":b,children:[(0,zn.jsxs)("div",{className:"header",children:[(0,zn.jsx)("p",{className:"name",children:(0,W.Z)("Workspace Rule $1",[f])}),(0,zn.jsx)("div",{children:(0,zn.jsx)("input",{type:"button",className:"circular remove",title:(0,W.Z)("Remove Workspace Rule"),onClick:r})})]}),(0,zn.jsxs)("form",{children:[(0,zn.jsx)("div",{children:(0,W.Z)("If URL")}),(0,zn.jsxs)("div",{className:"inputs",children:[(0,zn.jsxs)(Fa.Z,{value:t.type,onChange:d,onFocus:l,children:[(0,zn.jsx)("option",{value:"CONTAINS",children:(0,W.Z)("contains")}),(0,zn.jsx)("option",{value:"EQUALS",children:(0,W.Z)("is")}),(0,zn.jsx)("option",{value:"STARTSWITH",children:(0,W.Z)("starts with")})]}),(0,zn.jsx)(Vr.Z,{label:"",className:"expression",type:"text",placeholder:(0,W.Z)("https://"),value:t.expression,onChange:c,onFocus:l,hasError:!t.expression})]}),(0,zn.jsx)("div",{children:(0,W.Z)("Open in")}),(0,zn.jsxs)("div",{className:"inputs",children:[i.length>0&&(0,zn.jsxs)(Fa.Z,{name:"workspaceId",value:t.workspaceId,onChange:h,onFocus:l,children:[!t.workspaceId&&JB,i.map((e=>(0,zn.jsx)("option",{value:e.id,children:e.name},e.id))),(0,zn.jsx)("option",{value:"NEW_WORKSPACE",children:(0,W.Z)("+ Create New Workspace")})]}),0===i.length&&(0,zn.jsx)("div",{className:"toolbar toolbar-default toolbar-group",children:(0,zn.jsx)("div",{className:"toolbar-group",children:(0,zn.jsx)(oa.ZP,{onClick:p,image:Kn.md4.medium,title:(0,W.Z)("Add Workspace")})})})]})]})]},t.id)}const tF=Un.memo(eF);function sF(e){const t={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=0);return t}function nF(e,t,s){for(const n in t){if(!Object.prototype.hasOwnProperty.call(t,n))continue;if(0!==s[n])return!1;const i="number"==typeof t[n]?t[n]:t[n].val;if(e[n]!==i)return!1}return!0}const iF=[0,0];function aF(e,t,s,n,i,a,o){const r=s+(-i*(t-n)+-a*s)*e,l=t+r*e;return Math.abs(r)<o&&Math.abs(l-n)<o?(iF[0]=n,iF[1]=0,iF):(iF[0]=l,iF[1]=r,iF)}function oF(e){const t={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]="number"==typeof e[s]?e[s]:e[s].val);return t}const rF=1e3/60;class lF extends Un.Component{static contextType=oi.Z;constructor(e){super(e),this.state=this.defaultState()}unmounting=!1;wasAnimating=!1;animationID=null;prevTime=0;accumulatedTime=0;defaultState(){const{defaultStyle:e,style:t}=this.props,s=e||oF(t),n=sF(s);return{currentStyle:s,currentVelocity:n,lastIdealStyle:s,lastIdealVelocity:n}}unreadPropStyle=null;clearUnreadPropStyle=e=>{let t=!1,{currentStyle:s,currentVelocity:n,lastIdealStyle:i,lastIdealVelocity:a}=this.state;for(const o in e){if(!Object.prototype.hasOwnProperty.call(e,o))continue;const r=e[o];"number"==typeof r&&(t||(t=!0,s={...s},n={...n},i={...i},a={...a}),s[o]=r,n[o]=0,i[o]=r,a[o]=0)}t&&this.setState({currentStyle:s,currentVelocity:n,lastIdealStyle:i,lastIdealVelocity:a})};startAnimationIfNecessary=()=>{if(this.unmounting||null!=this.animationID)return;const{requestAnimationFrame:e}=this.context;this.animationID=e((e=>{if(this.unmounting)return;const t=this.props.style;if(nF(this.state.currentStyle,t,this.state.currentVelocity))return this.wasAnimating&&this.props.onRest&&this.props.onRest(),this.animationID=null,this.wasAnimating=!1,void(this.accumulatedTime=0);this.wasAnimating=!0;const s=e||performance.now(),n=s-this.prevTime;if(this.prevTime=s,this.accumulatedTime=this.accumulatedTime+n,this.accumulatedTime>10*rF&&(this.accumulatedTime=0),0===this.accumulatedTime)return this.animationID=null,void this.startAnimationIfNecessary();const i=(this.accumulatedTime-Math.floor(this.accumulatedTime/rF)*rF)/rF,a=Math.floor(this.accumulatedTime/rF),o={},r={},l={},d={};for(const e in t){if(!Object.prototype.hasOwnProperty.call(t,e))continue;const s=t[e];if("number"==typeof s)l[e]=s,d[e]=0,o[e]=s,r[e]=0;else{let t=this.state.lastIdealStyle[e],n=this.state.lastIdealVelocity[e];for(let e=0;e<a;e++)[t,n]=aF(rF/1e3,t,n,s.val,s.stiffness,s.damping,s.precision);const[c,h]=aF(rF/1e3,t,n,s.val,s.stiffness,s.damping,s.precision);l[e]=t+(c-t)*i,d[e]=n+(h-n)*i,o[e]=t,r[e]=n}}this.animationID=null,this.accumulatedTime-=a*rF,this.setState({currentStyle:l,currentVelocity:d,lastIdealStyle:o,lastIdealVelocity:r}),this.unreadPropStyle=null,this.startAnimationIfNecessary()}))};componentDidMount(){this.prevTime=performance.now(),this.startAnimationIfNecessary()}UNSAFE_componentWillReceiveProps(e){null!=this.unreadPropStyle&&this.clearUnreadPropStyle(this.unreadPropStyle),this.unreadPropStyle=e.style,null==this.animationID&&(this.prevTime=performance.now(),this.startAnimationIfNecessary())}componentWillUnmount(){this.unmounting=!0,null!=this.animationID&&(this.context.cancelAnimationFrame(this.animationID),this.animationID=null)}render(){const e=this.props.children(this.state.currentStyle);return e&&Un.Children.only(e)}}var dF=s(64387),cF=s(92);const hF={stiffness:170,damping:26,precision:.01};function uF(e,t){return{...hF,...t,val:e}}var pF=s(81365),gF=s(57865);function mF(e){return(0,Un.forwardRef)((function(t,s){const n=(0,Un.useContext)(oi.Z);return(0,zn.jsx)(pF.W,{backend:gF.PD,context:n,children:(0,zn.jsx)(e,{ref:s,...t})})}))}var fF=s(34155);const vF={stiffness:500,damping:32},bF="CREATE_WORKSPACE_DIALOG";const CF=mF((function(e){const t=Un.useContext(oi.Z),s=iE(),n=Un.useRef(null),i=Un.useRef(null),a=Un.useRef(null),o=Un.useRef(cF.Z.getRules()),[r,l]=Un.useState(m_.Z.getState()),[d,c]=Un.useState(),[h,u]=Un.useState(""),p=o.current?.length??0,[g,m]=Un.useState(!1);Un.useEffect((()=>{function e(){const e=m_.Z.getState();l(e),c((t=>t?{...t,workspaceId:e[e.length-1]?.id}:t)),Wn.Z.focus(t.vivaldiWindowId)}function n(){o.current=cF.Z.getRules(),s()}return m_.Z.addListener(e),cF.Z.addListener(n),()=>{m_.Z.removeListener(e),cF.Z.removeListener(n)}}),[t.vivaldiWindowId,s]);const f=e=>{if(!d)return;const t=e.currentTarget.value;"CONTAINS"!==t&&"EQUALS"!==t&&"STARTSWITH"!==t||c({...d,type:t})},v=e=>{d&&c({...d,expression:e.target.value})},b=e=>{if(!d)return;const t=e.currentTarget.value;if("NEW_WORKSPACE"===t)return void w(d.id);const s=Number(e.currentTarget.value);""===t||isNaN(s)||c({...d,workspaceId:s})},w=e=>{u(e),fF.nextTick((()=>{i.current?.scrollIntoView()}))};Un.useEffect((()=>{d&&(d.id?dF.Z.updateLinkRoutingRule(d.id,d.type,d.expression,d.workspaceId):dF.Z.addLinkRoutingRule(d.type,d.expression,d.workspaceId).then((()=>c(void 0))))}),[d]);const y=Un.useCallback((()=>{const e=o.current?.map((e=>e.id))??[];dF.Z.setOrder(t.vivaldiWindowId,e)}),[t.vivaldiWindowId,o]),x=Un.useMemo((()=>({position:"relative",minHeight:114*p+8})),[p]),I=Un.useCallback((e=>{const t=o.current?.find((t=>t.id===e));if(t)return{item:t,index:o.current?.indexOf(t)??0}}),[o]),A=Un.useRef(null),S=Un.useCallback(((e,n)=>{const i=()=>{s(),A.current=null},a=I(e)?.index,r=o.current;if(r&&"number"==typeof a){const s=r.find((t=>t.id===e)),a=r.find((e=>e.id===n)),l=r.indexOf(s),d=r.indexOf(a);o.current=(0,C.Uy)(r,(e=>{const[t]=e.splice(l,1);e.splice(d,0,t)})),A.current||(A.current=t.requestAnimationFrame(i))}}),[t,I,s]);let Z;if(d)if(d.id){const e=o.current??[];Z=[];for(let t=0;t<e.length;t++){const s=e[t];s.id===d.id?Z.push(d):Z.push(s)}}else Z=o.current?.concat([d])??[d];else Z=o.current?[...o.current]:[];const T=h?Z.findIndex((({id:e})=>e===h)):-1;return T>-1&&Z.splice(T+1,0,{id:bF,type:"EQUALS",expression:"",workspaceId:-1}),fe.ZP.isIncognitoOrGuest(t.vivaldiWindowId)?null:(0,zn.jsxs)(tb.Z,{filter:e.filter,children:[(0,zn.jsxs)("div",{ref:a,className:Gn()("WorkspaceLinkRouting",{disabled:!e.enabled}),children:[(0,zn.jsxs)("div",{className:"WorkspaceLinkRouting-Description",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Open Websites in Workspaces Automatically")}),(0,zn.jsxs)("p",{className:"info",children:[(0,W.Z)("Set up rules to automatically open websites in specific Workspaces.")," ",(0,W.Z)("Example: All links from “vivaldi.net” open in a workspace called “Vivaldi”.")]})]}),(0,zn.jsx)("div",{ref:n,className:"WorkspaceLinkRouting-DragArea",style:x,children:Z.map(((e,s)=>(0,zn.jsx)(lF,{style:{posY:uF(114*s,vF)},children:({posY:s})=>e.id===bF?(0,zn.jsx)(YB,{ref:i,windowId:t.vivaldiWindowId,onClose:()=>Promise.resolve(u("")),onShowIconPicker:()=>m(!0),createInBackground:!0,disableMoveTabs:!0,className:"inline",style:{transform:`translate3d(0, ${s}px, 0)`}},e.id):(0,zn.jsx)(tF,{windowId:t.vivaldiWindowId,rule:e,ruleCount:p,style:{transform:`translate3d(0, ${s}px, 0)`},workspaces:r,findItem:I,moveItem:S,onDelete:()=>{var t;(t=e.id)?dF.Z.removeLinkRoutingRules([t]):c(void 0)},onFocus:()=>c(e),onTypeChanged:f,onExpressionChanged:v,onWorkspaceChanged:b,onDrop:y,onAddWorkspace:()=>w(e.id)})},e.id)))})]}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)("input",{type:"button",disabled:!e.enabled,value:(0,W.Z)("Add New Workspace Rule"),onClick:()=>{c({id:"",type:"CONTAINS",expression:"",workspaceId:r[0]?.id})}})}),g&&(0,zn.jsx)(HB,{closeModal:()=>m(!1),onPick:e=>{i.current?.handlePick(e),m(!1)},activeIcon:i.current?.state.activeIcon,activeEmoji:i.current?.state.activeEmoji,top:a.current?.offsetTop??0,left:90})]})})),wF=[Z.kWorkspacesButtonShowInTabbar,Z.kWorkspacesEnabled,Z.kWorkspacesButtonMouseWheelEnabled],yF=I.Z.getEventHandler;function xF({filter:e}){const t=(0,Eo.Z)(wF),[s,n]=(0,Un.useState)(!1),[i,a]=(0,Un.useState)("");(0,Un.useEffect)((()=>{re.Z.utilities.getStartupAction((e=>a(e)))}),[]);return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)(tb.Z,{filter:e,children:(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsxs)("div",{className:"setting-single",children:["last"!==i&&(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Enabling Workspaces will set “Startup with” setting to “Last Session”.")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kWorkspacesEnabled],onChange:()=>{t[Z.kWorkspacesEnabled]?n(!0):(I.Z.set(Z.kWorkspacesEnabled,!0),re.Z.utilities.setStartupAction("last",A.Z.get(Z.kURLsToRestoreOnStartup)))}}),(0,zn.jsx)("span",{children:(0,W.Z)("Enable Workspaces")})]})})]}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kWorkspacesButtonShowInTabbar],onChange:yF(Z.kWorkspacesButtonShowInTabbar),disabled:!t[Z.kWorkspacesEnabled]}),(0,zn.jsx)("span",{children:(0,W.Z)("Show Workspaces in Tab Bar")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kWorkspacesButtonMouseWheelEnabled],onChange:yF(Z.kWorkspacesButtonMouseWheelEnabled),disabled:!t[Z.kWorkspacesEnabled]}),(0,zn.jsx)("span",{children:(0,W.Z)("Switch Workspaces by Scrolling")})]})})]})}),s&&(0,zn.jsx)(b_,{onClose:e=>{n(!1),e&&I.Z.set(Z.kWorkspacesEnabled,!1)},from:"tabs"})]})}const IF=[...yR,...bR,..._R,...LR,...HR,...eB,...dB,...uB,...NB,...OB,...BB,...UB,...wF,Z.kWorkspacesLinkRoutes];function AF({filter:e,isWorkspacesEnabled:t,category:s}){const n=nI({filter:e,prefPaths:IF,name:s.title});return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("section",{className:"setting-section",children:[(0,zn.jsxs)(Vy.Z,{categoryTitle:(0,W.Z)("Tabs"),filter:e,children:[(0,zn.jsx)(MB,{filter:e}),(0,zn.jsx)(hB,{filter:e}),(0,zn.jsx)(qR,{filter:e}),(0,zn.jsx)(kR,{filter:e}),(0,zn.jsx)(CR,{filter:e})]}),(0,zn.jsx)(Vy.Z,{categoryTitle:(0,W.Z)("Tab Display"),filter:e,children:(0,zn.jsx)(oB,{filter:e})}),(0,zn.jsxs)(Vy.Z,{categoryTitle:(0,W.Z)("Tab Features"),filter:e,children:[(0,zn.jsx)(OR,{filter:e}),(0,zn.jsx)(LB,{filter:e}),(0,zn.jsx)(WB,{filter:e}),!1,(0,zn.jsx)(bB,{filter:e}),(0,zn.jsx)(UR,{filter:e})]}),(0,zn.jsxs)(Vy.Z,{categoryTitle:(0,W.Z)("Workspaces"),filter:e,children:[(0,zn.jsx)(xF,{filter:e}),(0,zn.jsx)(CF,{filter:e,enabled:t})]})]}),n]})}const SF=Un.memo(AF),ZF=[Z.kHueBridgeIp,Z.kHueEnabled,Z.kHueLights,Z.kHueUsername];class TF extends Un.PureComponent{initialState=()=>{const{lights:e,groups:t}=We.getState();return{groups:t,lights:e,validBridge:!1,validUsername:!1,waitingForButtonPress:!1,givenUp:!1,manualIp:""}};_isMounted=!1;state=this.initialState();componentDidMount(){this._isMounted=!0,We.addListener(this.onHueStoreChanged),this.props.prefValues[Z.kHueEnabled]&&this.props.prefValues[Z.kHueBridgeIp]&&this.verifyBridge()}componentWillUnmount(){We.removeListener(this.onHueStoreChanged),this._isMounted=!1}onHueStoreChanged=()=>{const{lights:e,groups:t}=We.getState();this.setState({lights:e,groups:t})};verifyBridge=()=>{const e=A.Z.get(Z.kHueBridgeIp);e?fetch(`http://${e}/description.xml`).then((e=>{e.ok?this.setState({validBridge:!0},this.verifyUsername):this.getBridge()})).catch((e=>{this.getBridge()})):this.getBridge()};getBridge=()=>{fetch("https://discovery.meethue.com/").then((e=>{e.ok?e.json().then((e=>{e&&e[0]&&e[0].internalipaddress?(I.Z.set(Z.kHueBridgeIp,e[0].internalipaddress),this.verifyBridge()):this.setState({givenUp:!0})})):this.setState({givenUp:!0})})).catch((e=>{this.setState({givenUp:!0})}))};setBridge=()=>{I.Z.set(Z.kHueBridgeIp,this.state.manualIp),this.verifyBridge()};verifyUsername=()=>{const e=A.Z.get(Z.kHueBridgeIp),t=A.Z.get(Z.kHueUsername);t?fetch(`http://${e}/api/${t}/`).then((e=>{e.ok?e.json().then((e=>{e[0]?.error?(I.Z.set(Z.kHueUsername,""),this.getUsername()):e?.config&&this.setState({validUsername:!0,waitingForButtonPress:!1},ze.updateLights)})):this.setState({givenUp:!0})})).catch((e=>{this.setState({givenUp:!0})})):this.getUsername()};getUsername=()=>{const e=A.Z.get(Z.kHueBridgeIp);e&&fetch(`http://${e}/api`,{method:"POST",body:JSON.stringify({devicetype:"vivaldi_browser#desktop_hue"})}).then((e=>{e.ok?e.json().then((e=>{e[0]?.success?.username?(I.Z.set(Z.kHueUsername,e[0].success.username),this.verifyUsername()):e[0]?.error&&101===e[0].error.type&&(this.setState({waitingForButtonPress:!0}),setTimeout((()=>{this._isMounted&&this.getUsername()}),1e3))})):this.setState({givenUp:!0})})).catch((e=>{this.setState({givenUp:!0})}))};toggleLight=(e,t)=>{const s=!A.Z.get(Z.kHueLights).includes(t),n=A.Z.get(Z.kHueLights).filter((e=>e!==t));s&&n.push(t),ze.flash(e),I.Z.set(Z.kHueLights,n)};resetBridge=()=>{I.Z.reset(Z.kHueBridgeIp),I.Z.reset(Z.kHueUsername),this.setState(this.initialState())};changeManualIp=e=>{this.setState({manualIp:e.currentTarget.value})};render(){const e=this.props.prefValues[Z.kHueEnabled],t=this.props.prefValues[Z.kHueLights],{waitingForButtonPress:s,validBridge:n,validUsername:i,groups:a,lights:o}=this.state;return(0,zn.jsxs)(Vy.Z,{categoryTitle:(0,W.Z)("Philips Hue Theme Integration"),filter:this.props.filter,children:[(0,zn.jsx)("div",{className:"setting-group",children:(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:e,onChange:I.Z.getEventHandler(Z.kHueEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("Enable Hue")})]}),e&&n&&!s?(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Connected to Hue Bridge at $1.",[this.props.prefValues[Z.kHueBridgeIp]])}):(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Requires a Philips Hue lighting system on the local network.")})]})}),e&&n&&(0,zn.jsx)("div",{className:"setting-group",children:(0,zn.jsx)("input",{type:"button",className:"danger",value:(0,W.Z)("Reset Bridge Connection"),onClick:this.resetBridge})}),e&&(!n||s)&&(0,zn.jsxs)("div",{className:"setting-group unlimited",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Bridge Discovery")}),!s&&(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)(Vr.Z,{type:"text",onChange:this.changeManualIp,label:(0,W.Z)("Bridge IP (Leave blank to autodiscover)"),placeholder:"127.0.0.1",value:this.state.manualIp}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)("input",{type:"button",className:"primary",value:this.state.manualIp?(0,W.Z)("Connect"):(0,W.Z)("Find Bridge"),onClick:this.state.manualIp?this.setBridge:this.getBridge})})]}),s&&(0,zn.jsxs)("div",{className:"setting-group unlimited",children:[(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Found Bridge at $1. Waiting for button press...",[this.props.prefValues[Z.kHueBridgeIp]])}),(0,zn.jsx)("div",{className:"hue-press-button",dangerouslySetInnerHTML:{__html:`${Kn.I_V}${(0,W.Z)("Press the button on your Bridge")}`}})]})]}),e&&i&&a.size>0&&o.size>0&&(0,zn.jsxs)("div",{className:"setting-group unlimited",children:[(0,zn.jsxs)("p",{className:"info",children:[(0,W.Z)("Only lights that support color can be selected."),"* "+(0,W.Z)("Light currently unreachable.")]}),[...a.keys()].map((e=>(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:a.get(e)?.name}),a.get(e)?.lights.map((e=>{const s=o.get(e);if(!s)return null;const n=t&&t.some((e=>e===s.uniqueid)),i=s.type.toLowerCase().includes("color light");return(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:n,disabled:!i,onChange:()=>{this.toggleLight(e,s.uniqueid)}}),(0,zn.jsxs)("span",{children:[s.name,!s.state.reachable&&"*"]})]})},s.uniqueid)}))]},e)))]})]})}}const EF=(0,zd.Z)(TF,ZF),kF=["keyboard","mouse","chromalink","mousemat","headset"],NF=[Z.kRazerChromaDevices,Z.kRazerChromaEnabled],_F=[{device:"keyboard",text:(0,W.Z)("Keyboard")},{device:"mouse",text:(0,W.Z)("Mouse")},{device:"mousemat",text:(0,W.Z)("Mouse Mat")},{device:"headset",text:(0,W.Z)("Headset")},{device:"chromalink",text:(0,W.Z)("Chroma Link")}];function PF(e){const t=(0,Eo.Z)(NF),s=(e,t)=>e.findIndex((e=>e===t))>-1;return(0,zn.jsx)(Vy.Z,{categoryTitle:(0,W.Z)("Razer Chroma Theme Integration"),filter:e.filter,children:(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kRazerChromaEnabled],onChange:e=>{const t=e.target.checked;I.Z.set(Z.kRazerChromaEnabled,t)}}),(0,zn.jsx)("span",{children:(0,W.Z)("Enable Razer Chroma Integration")})]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Requires Razer Chroma enabled devices connected to the local machine.")})]}),function(){const e=t[Z.kRazerChromaDevices],n=_F.map((n=>(0,zn.jsx)("div",{className:"setting-single pad-left",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",disabled:!t[Z.kRazerChromaEnabled],checked:s(e,n.device),onChange:e=>((e,n)=>{const i=e.target.checked,a=t[Z.kRazerChromaDevices],o=kF.filter((e=>n===e?i:s(a,e)));I.Z.set(Z.kRazerChromaDevices,o)})(e,n.device)}),(0,zn.jsx)("span",{children:n.text})]})},n.device)));return n}()]})})}const MF=Un.memo(PF),DF=["AccountButton","AddressField","Divider","FlexibleSpacer","MailSearch","PanelChat","PanelWidthSpacer","ShareVivaldi","Spacer","StatusInfo","VersionInfo","Zoom"];async function OF(e,t,s,n){let i=await n.arrayBuffer();n.name.endsWith(".svg")&&(i=(0,Si.tc)(i).buffer);const a=await re.Z.utilities.storeImage({data:i,mimeType:n.type});(0,Fo.kz)(e,(e=>{const n=e.find((e=>e.id===t));n?(n.buttons=n.buttons??{},n.buttons[s]=a):console.error("saveButtonImage: expected to find theme")}))}var jF=(0,zn.jsx)("span",{className:"label",children:"28 × 28"});function LF(e){const{showOpenFilePicker:t}=Un.useContext(oi.Z),{themePref:s,themeId:n,selectedButton:i,preventEditing:a}=e,o=i&&null!==Ue.Z.getToolbarButtonImage(i),r=Un.useCallback((async e=>{if(1!==e.length||!i)return;const[t]=e;try{OF(s,n,i,t)}catch(e){console.error("ThemeButtonsEditor: "+e.toString())}}),[i,s,n]);function l(e){return i?(0,zn.jsx)(ZJ,{name:i,index:0,draggable:!1,label:" ",size:e,mimeType:"",onDragEnter:nr.Z,onDragStart:nr.Z,onDragEnd:nr.Z,onDrop:nr.Z,preview:!0,inEditor:!0,forceIcon:!0,isMailWindow:!0},i):null}const{canDropFile:d,onDragLeave:c,onDragOver:h,onDrop:u}=aw(r);return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("div",{inert:a?"true":null,className:"Button-Area droparea",onDragEnter:e=>{e.currentTarget.classList.add("dragover")},onDragOver:e=>{e.preventDefault(),h(e)},onDragLeave:e=>{d&&c(e),e.currentTarget.classList.remove("dragover")},onDrop:e=>{d&&u(e),e.currentTarget.classList.remove("dragover")},onClick:async()=>{if(!i)return;const[e]=await t({types:[{description:(0,W.Z)("Image files"),accept:{"image/*":[".bmp",".gif",".jpg",".jpeg",".png",".webp",".svg"]}}]}),a=await e.getFile();OF(s,n,i,a)},children:[(0,zn.jsxs)("div",{className:"Button-Area-Large toolbar-large",children:[l("large"),jF]}),(0,zn.jsxs)("div",{className:"Button-Area-Preview",children:[l("large"),(0,zn.jsx)("span",{className:"label",children:(0,W.Z)("command","Preview")})]})]}),(0,zn.jsx)("div",{className:"Button-Area-Controls",children:(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Remove Custom Image"),disabled:!o,onClick:()=>{(0,Fo.kz)(s,(e=>{const t=e.find((e=>e.id===n));t?.buttons&&(delete t.buttons[i],0===Object.keys(t.buttons).length&&delete t.buttons)}))}})})]})}class RF extends Un.PureComponent{static contextType=oi.Z;state={selectedButton:""};changeButtonSelection=e=>{const t=e.target.value;this.setState({selectedButton:t})};renderCategory=e=>{let t=[];return t="chains"===e?A.Z.get(Z.kChainedCommandsCommandList).map((e=>({id:e.name,label:e.label}))):"mail"===e?[...Rp.ww.find((e=>"mail"===e.category))?.buttons||[],...Rp.ww.find((e=>"mail_composer"===e.category))?.buttons||[],...Rp.ww.find((e=>"mail_message"===e.category))?.buttons||[]]:Rp.ww.find((t=>t.category===e))?.buttons||[],t=[...new Set(t)],t.filter((e=>!DF.includes(e.id))).map(((e,t)=>(0,zn.jsx)("option",{value:e.id,children:e.label},e.id+"__"+t)))};render(){const{themeId:e,prefValues:t}=this.props,s=Si.ZP.getThemesWithButtons(),n=Boolean(t[Z.kThemesCurrentButtons]&&e!==t[Z.kThemesCurrentButtons]);return(0,zn.jsx)(zn.Fragment,{children:(0,zn.jsxs)("div",{className:"TabbedView--Padded Button-Settings",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Current Theme Icons")}),(0,zn.jsxs)("div",{className:"Button-Manager",children:[(0,zn.jsx)("div",{className:"Button-Selector",children:(0,zn.jsxs)("select",{size:"14",onChange:this.changeButtonSelection,onKeyDown:t=>{"Delete"!==t.key&&"Backspace"!==t.key||(0,Fo.kz)(this.props.themePref,(t=>{const s=t.find((t=>t.id===e));s?.buttons&&(delete s.buttons[this.state.selectedButton],0===Object.keys(s.buttons).length&&delete s.buttons)}))},children:[(0,zn.jsx)("option",{disabled:!0,children:(0,W.Z)("category","Navigation")}),this.renderCategory("navigation"),(0,zn.jsx)("option",{disabled:!0,children:(0,W.Z)("category","Status Bar")}),this.renderCategory("status"),(0,zn.jsx)("option",{disabled:!0,children:(0,W.Z)("category","Panel")}),this.renderCategory("panel"),(0,zn.jsx)("option",{disabled:!0,children:(0,W.Z)("category","Mail")}),this.renderCategory("mail"),(0,zn.jsx)("option",{disabled:!0,children:(0,W.Z)("category","Command Chains")}),this.renderCategory("chains")]})}),(0,zn.jsxs)("div",{className:"Button-Editor",children:[n?(0,zn.jsx)(fa,{type:"warning",children:(0,W.Z)("Only the currently active theme can be edited. Please switch to “$1” theme first, or change the Custom Buttons setting above.",[s.find((e=>e.id===t[Z.kThemesCurrentButtons]))?.name??""])}):(0,zn.jsxs)("p",{className:"info",children:[!this.state.selectedButton&&(0,W.Z)("Select a button from the list on the left.")," ",(0,W.Z)("Drop a custom icon in the area below. Supply images in bitmap or SVG format, designed to fit on a 28 × 28 pixel canvas.")," ",(0,zn.jsx)(Vx.Z,{onClick:()=>{c.ZP.openURL(this.context.vivaldiWindowId,"https://help.vivaldi.com/desktop/appearance-customization/creating-custom-icon-set/",{singleton:!0})},children:(0,W.Z)("Learn more.")})]}),this.state.selectedButton&&(0,zn.jsx)(LF,{themePref:this.props.themePref,themeId:e,selectedButton:this.state.selectedButton,preventEditing:n})]})]})]})})}}const BF=RF;var FF=(0,zn.jsx)("span",{className:"ThemeEditorColorPicker-HexSymbol",children:"#"});class WF extends Un.PureComponent{state={hexString:void 0};onKeyDown=e=>{const t="#"+e.currentTarget.value;switch(e.key){case"Enter":4!==t.length&&7!==t.length||!Be().valid(t)||(this.props.setColor(Be()(t).hex()),this.setState({hexString:void 0}));break;case"Escape":this.setState({hexString:void 0})}};updateHexString=e=>{const t="#"+e.currentTarget.value;"blur"===e.type&&4===t.length&&Be().valid(t)?(this.props.setColor(Be()(t).hex()),this.setState({hexString:void 0})):7===t.length&&Be().valid(t)?(this.props.setColor(t),this.setState({hexString:void 0})):this.setState({hexString:t})};render(){return(0,zn.jsxs)("div",{className:"ThemeEditorColorPicker",children:[this.props.label&&(0,zn.jsx)("div",{className:"ThemeEditorColorPicker-Label",children:this.props.label}),(0,zn.jsx)("input",{type:"color",className:"ThemeEditorColorPicker-ColorInput",disabled:this.props.disabled,value:this.props.color,onChange:e=>this.props.setColor(e.currentTarget.value)}),FF,(0,zn.jsx)("input",{className:"ThemeEditorColorPicker-HexInput",type:"text",disabled:this.props.disabled,value:(this.state.hexString||this.props.color).substring(1),onChange:this.updateHexString,onKeyDown:this.onKeyDown,onBlur:this.updateHexString})]})}}const UF=WF,VF=[Z.kThemeScheduleEnabled,Z.kThemeScheduleOS,Z.kThemeScheduleTimeline,Z.kThemesSystem,Z.kThemesUser,Z.kThemesCurrent,Z.kThemesCurrentPrivate],HF=["backgroundBlur","backgroundImage","colorAccentBg","colorAccentBgDark","colorAccentFg","colorBg","colorBgAlphaBlur","colorBgIntenser","colorBgLightIntense","colorBorder","colorFg","colorHighlightBg","colorTabBar","colorWindowBg","radius","radiusRounded"];var GF=(0,zn.jsxs)("div",{className:"ThemePreview-TabBar",children:[(0,zn.jsx)("div",{className:"ThemePreview-TabBar-Tab ThemePreview-TabBar-Tab--Active"}),(0,zn.jsx)("div",{className:"ThemePreview-TabBar-Tab"})]}),KF=(0,zn.jsxs)("div",{className:"ThemePreview-AddressBar",children:[(0,zn.jsx)("div",{className:"ThemePreview-AddressBar-Icon ThemePreview-AddressBar-Icon--Active"}),(0,zn.jsx)("div",{className:"ThemePreview-AddressBar-Icon ThemePreview-AddressBar-Icon--Active"}),(0,zn.jsx)("div",{className:"ThemePreview-AddressBar-Icon"}),(0,zn.jsx)("div",{className:"ThemePreview-AddressBar-Input"})]}),zF=(0,zn.jsxs)("div",{className:"ThemePreview-Panel",children:[(0,zn.jsx)("div",{className:"ThemePreview-Panel-Item ThemePreview-Panel-Item--Active"}),(0,zn.jsx)("div",{className:"ThemePreview-Panel-Item"}),(0,zn.jsx)("div",{className:"ThemePreview-Panel-Item"})]});class $F extends Un.PureComponent{constructor(e){super(e);const{backgroundImage:t,backgroundPosition:s,id:n}=this.props.theme;this.state={style:void 0},Si.ZP.getImageVars(t,s).then((e=>{this.setState({style:{...e,...Ue.Z.getBaseStylesByThemeId(n,HF)}})}))}componentDidUpdate(e,t){if(e.theme!==this.props.theme){const{backgroundImage:e,backgroundPosition:t,id:s}=this.props.theme;Si.ZP.getImageVars(e,t).then((e=>{this.setState({style:{...e,...Ue.Z.getBaseStylesByThemeId(s,HF)}})}))}}render(){const e=this.props.theme.id,t=this.props.prefValues[Z.kThemeScheduleEnabled],s=this.props.prefValues[Z.kThemeScheduleOS],n=this.props.prefValues[Z.kThemeScheduleTimeline],i=Si.ZP.createClassnames(this.props.theme,this.state.style),a=Gn()(this.props.className,"ThemePreview",{"ThemePreview--Selected":this.props.isCurrent&&this.props.themeChangeCallback}),o=this.props.themeChangeCallback?{role:"option","aria-selected":this.props.isCurrent,"aria-label":(0,W.Z)("$1 theme",[this.props.theme.name])}:{};return(0,zn.jsxs)("div",{className:a,role:"none",children:[(0,zn.jsxs)("button",{"data-id":e,disabled:!this.props.themeChangeCallback,onClick:this.props.themeChangeCallback?()=>{const e=this.props.theme.id;On.Z.setTheme(e),this.props.themeChangeCallback&&this.props.themeChangeCallback(e)}:null,className:"ThemePreview-Image",...o,children:[!this.state.style&&(0,zn.jsx)("div",{className:"ThemePreview-Browser ThemePreview-Browser--Loading",dangerouslySetInnerHTML:{__html:Kn.H0I}}),(0,zn.jsxs)("div",{className:Gn()("ThemePreview-Browser",i),style:this.state.style,children:[GF,KF,zF]})]}),(this.props.themeChangeCallback||this.props.welcomePage)&&(0,zn.jsx)("div",{className:"ThemePreview-Label","aria-hidden":"true",children:this.props.theme.name}),this.props.themeChangeCallback&&!this.props.welcomePage&&(0,zn.jsxs)("div",{className:"ThemePreview-Label-Meta",children:[this.props.theme.id===this.props.prefValues[Z.kThemesCurrentPrivate]&&(0,zn.jsx)("span",{children:(0,W.Z)("Private")}),"system"===t&&e===s.light&&(0,zn.jsx)("span",{children:(0,W.Z)("theme","Light")}),"system"===t&&e===s.dark&&(0,zn.jsx)("span",{children:(0,W.Z)("theme","Dark")}),"timeline"===t&&n.some((t=>t.themeId===e))&&(0,zn.jsx)("span",{children:(0,W.Z)("Schedule")})]}),!this.props.isSystem&&this.props.onConfirmDeletion&&(0,zn.jsx)("button",{className:"ThemePreview-Delete",onClick:()=>{void 0!==this.props.onConfirmDeletion&&this.props.onConfirmDeletion(e)},tabIndex:-1,dangerouslySetInnerHTML:{__html:Kn.uN0}})]})}}const YF=(0,zd.Z)($F,VF),XF="chrome://vivaldi-data/desktop-image/0",QF=[Z.kSystemAccentColor,Z.kSystemHasDesktopWallpaperProtocol,Z.kThemesPreferCustomButtons,Z.kThemesCurrentButtons,Z.kThemesSystem,Z.kThemesUser],qF={colorBg:(0,W.Z)("Background"),colorFg:(0,W.Z)("Foreground"),colorHighlightBg:(0,W.Z)("Highlight"),colorAccentBg:(0,W.Z)("Accent"),colorWindowBg:(0,W.Z)("background color","Window")},JF={"#EDEEF2":(0,W.Z)("background","Light"),"#1D1E21":(0,W.Z)("background","Dark"),"#BBDFEF":(0,W.Z)("background","Blue"),"#fce370":(0,W.Z)("background","Yellow"),"#a4edd9":(0,W.Z)("background","Green"),"#ffb6c9":(0,W.Z)("background","Pink"),"#A9C8B3":(0,W.Z)("background","Soft Green"),"#BEB0CB":(0,W.Z)("background","Purple"),"#EFE5DD":(0,W.Z)("background","Sand"),"#FA7C68":(0,W.Z)("background","Orange")},eW={"/resources/bg_gradient_01.webp":(0,W.Z)("Gradient"),"/resources/bg_gradient_09.webp":(0,W.Z)("Gradient"),"/resources/bg_landscape.webp":(0,W.Z)("Landscape"),"/resources/bg_pawel-czerwinski-Xk7ktUfyaNI-unsplash.webp":(0,W.Z)("Waves"),"/resources/bg_pawel-czerwinski-bWeZR1BQU9o-unsplash.webp":(0,W.Z)("Pink Waves"),"/resources/bg_alt_4.webp":(0,W.Z)("Beach"),"/resources/bg_richard-horvath-_nWaeTF6qo0-unsplash.webp":(0,W.Z)("Dark Shapes")},tW=(0,Te.Z)(((e,t)=>{(0,Fo.kz)(e,t)}),50,{leading:!1,trailing:!0}),sW=(0,Wv.Z)(((e,t)=>{(0,Fo.kz)(e,t)}),50,{leading:!0,trailing:!0});var nW=(0,zn.jsx)("img",{width:"24",height:"24",src:"../../../resources/emoji_party.png"});class iW extends Un.PureComponent{static contextType=oi.Z;_isIMEOpen=!1;colorId=crypto.randomUUID();backgroundId=crypto.randomUUID();settingsId=crypto.randomUUID();buttonsId=crypto.randomUUID();state={backgroundType:"image",baseBgShowPicker:!1,baseFgShowPicker:!1,highlightBgShowPicker:!1,accentBgShowPicker:!1,view:"colors"};render(){const{theme:e,isCurrent:t,isSystem:n,prefValues:i}=this.props,a=n?Z.kThemesSystem:Z.kThemesUser,o=i[Z.kThemesSystem].concat(i[Z.kThemesUser]),r=i[a].findIndex((t=>t.id===e.id)),l=o.reduce(((e,t)=>{const s=t.backgroundImage,n=[...Object.keys(e),...Object.keys(eW)];return s&&!n.includes(s)&&s!==XF&&(e[s]=(0,W.Z)("From $1",[t.name])),e}),{}),d={...eW,...l};return(0,zn.jsx)(tb.Z,{filter:this.props.filter,children:(0,zn.jsxs)("div",{className:"ThemeEditor",children:[(0,zn.jsxs)("div",{className:"ThemeEditor-Header",children:[(0,zn.jsxs)("div",{className:"ThemeEditor-HeaderBasics",children:[(0,zn.jsxs)("div",{className:"toolbar toolbar-default",children:[(0,zn.jsx)(Fa.Z,{value:e.id,onChange:e=>{this.props.themeChangeCallback&&this.props.themeChangeCallback(e.currentTarget.value)},children:o.map((e=>(0,zn.jsx)("option",{value:e.id,children:e.name},e.id)))}),(0,zn.jsx)("input",{type:"button",className:t?void 0:"primary",disabled:t,onClick:()=>On.Z.setTheme(e.id),value:(0,W.Z)("other","Enable")}),n&&(0,zn.jsx)("input",{type:"button",className:"danger",disabled:Si.ZP.isSystemThemeModified(Si.ZP.getThemeWithFallback(e.id)),onClick:()=>On.Z.revertSystemTheme(e.id),value:(0,W.Z)("Reset")}),!n&&e.url&&(0,zn.jsx)("input",{type:"button",className:"danger",disabled:!t,onClick:()=>On.Z.updateCustomTheme(e.id),value:(0,W.Z)("Reload")})]}),(0,zn.jsxs)("div",{className:"ThemeEditor-Name",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("theme","Name")}),(0,zn.jsx)("input",{className:"theme-name",type:"text",disabled:n,onCompositionStart:()=>this._isIMEOpen=!0,onCompositionEnd:e=>{this._isIMEOpen=!1,(0,Fo.kz)(a,(t=>{t[r].name=e.target.value}))},onChange:e=>{this._isIMEOpen||(0,Fo.kz)(a,(t=>{t[r].name=e.target.value}))},defaultValue:e.name},e.id)]}),!n&&(0,zn.jsxs)("div",{className:"toolbar toolbar-default",children:[nW,(0,zn.jsxs)("a",{className:"external-link",href:"https://themes.vivaldi.net",onClick:()=>c.ZP.openURL(this.context.vivaldiWindowId,"https://themes.vivaldi.net/upload"),children:[(0,W.Z)("Share your theme"),(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:s(70942)}})]})]})]}),(0,zn.jsx)("div",{children:(0,zn.jsx)(YF,{isCurrent:t,isSystem:n,theme:e},e.id)})]}),(0,zn.jsxs)(aM,{icons:[Kn.v5q.small,Kn.yhu.small,Kn.d$r.small,Kn.oMs.small],children:[(0,zn.jsxs)("div",{id:this.colorId,label:(0,W.Z)("Colors"),children:[(0,zn.jsxs)("div",{className:"ThemeEditorColors",children:[(0,zn.jsx)("div",{className:"ThemeEditorColors-Base",children:["colorBg","colorFg"].map((t=>(0,zn.jsx)(UF,{label:qF[t],color:e[t],setColor:e=>{tW(a,(s=>{s[r][t]=Be()(e).hex()}))}},e.id+t)))}),(0,zn.jsxs)("div",{className:"ThemeEditorColors-Accent",children:[["colorHighlightBg","colorAccentBg"].map((t=>(0,zn.jsx)(UF,{label:qF[t],disabled:["colorHighlightBg"].includes(t)&&e.preferSystemAccent,color:e[t],setColor:e=>{tW(a,(s=>{s[r][t]=Be()(e).hex()}))}},e.id+t))),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:e.preferSystemAccent,onChange:e=>{(0,Fo.kz)(a,(t=>{t[r].preferSystemAccent=e.target.checked}))}}),(0,zn.jsx)("span",{children:(0,W.Z)("Prefer System Color")})]})})]})]}),(0,zn.jsxs)("div",{className:"TabbedView--Padded",children:[(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Color Overrides")}),(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:e.accentFromPage,onChange:e=>{(0,Fo.kz)(a,(t=>{t[r].accentFromPage=e.target.checked}))}}),(0,zn.jsx)("span",{children:(0,W.Z)("Accent from Page")})]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Get accent color from current webpage. Apply accent color to transparent Tab Bar background.")})]}),(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:e.accentOnWindow,onChange:e=>{(0,Fo.kz)(a,(t=>{t[r].accentOnWindow=e.target.checked}))}}),(0,zn.jsx)("span",{children:(0,W.Z)("Accent on Window")})]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Apply accent color to window background instead of the toolbar.")})]})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Limit Accent Color Saturation")}),(0,zn.jsx)(tI,{min:.2,max:1,step:.05,value:e.accentSaturationLimit,onChange:e=>{sW(a,(t=>{t[r].accentSaturationLimit=Number(e.target.value)}))},label:`${Math.floor(100*e.accentSaturationLimit)}%`})]}),(0,zn.jsxs)("div",{className:"setting-single pad-top",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Color Contrast")}),(0,zn.jsx)(tI,{min:-10,max:20,step:1,onChange:e=>{sW(a,(t=>{t[r].contrast=Number(e.target.value)}))},value:e.contrast})]})]})]})]}),(0,zn.jsxs)("div",{id:this.backgroundId,label:(0,W.Z)("Background"),children:[(0,zn.jsxs)("div",{className:"ThemeEditor-BackgroundMeta",children:[(0,zn.jsxs)("div",{className:"ThemeEditor-BackgroundMetaBasic",children:[(0,zn.jsx)("span",{children:(0,W.Z)("Type:")}),(0,zn.jsxs)(Fa.Z,{value:this.state.backgroundType,onChange:e=>{const t=e.target.value;"image"!==t&&"color"!==t||this.setState({backgroundType:t})},children:[(0,zn.jsx)("option",{value:"image",children:(0,W.Z)("theme background","Image")}),(0,zn.jsx)("option",{value:"color",children:(0,W.Z)("theme background","Color")})]}),"color"===this.state.backgroundType&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("span",{children:(0,W.Z)("Custom Color")}),(0,zn.jsx)(UF,{color:e.colorWindowBg,setColor:e=>{tW(a,(t=>{t[r].colorWindowBg=Be()(e).hex()}))}})]}),"image"===this.state.backgroundType&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)(Fa.Z,{value:e.backgroundPosition,onChange:e=>{(0,Fo.kz)(a,(t=>{t[r].backgroundPosition=e.target.value}))},children:[(0,zn.jsx)("option",{value:"stretch",children:(0,W.Z)("Stretch to Fit")}),(0,zn.jsx)("option",{value:"repeat",children:(0,W.Z)("verb","Repeat")}),(0,zn.jsx)("option",{value:"center",children:(0,W.Z)("Center")})]}),this.props.prefValues[Z.kSystemHasDesktopWallpaperProtocol]&&(0,zn.jsx)("input",{className:"ThemeEditor-BackgroundCustomButton",type:"button",disabled:e.backgroundImage===XF,value:(0,W.Z)("Use Desktop Image"),onClick:()=>{(0,Fo.kz)(a,(e=>{e[r].backgroundImage=XF}))}}),(0,zn.jsx)("input",{className:"ThemeEditor-BackgroundCustomButton",type:"button",value:(0,W.Z)("Select Image..."),onClick:()=>{re.Z.utilities.selectLocalImage({windowId:this.context.vivaldiWindowId,title:(0,W.Z)("Select Background Image"),themeId:e.id})}})]})]}),"color"===this.state.backgroundType&&e.backgroundImage&&e.colorWindowBg&&(0,zn.jsxs)("div",{className:"ThemeEditor-BackgroundMetaInfoBar",children:[(0,zn.jsx)("span",{children:(0,W.Z)("This theme has a background image set that may obscure the color.")}),(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Clear Image"),onClick:()=>{(0,Fo.kz)(a,(e=>{e[r].backgroundImage=""}))}})]})]}),(0,zn.jsx)("div",{className:"ThemeEditor-Background",children:(0,zn.jsxs)("div",{className:"ThemeEditor-BackgroundList",children:["color"===this.state.backgroundType&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("button",{className:Gn()("selectbox",{"selectbox-selected":!e.colorWindowBg}),onClick:()=>{(0,Fo.kz)(a,(e=>{e[r].colorWindowBg=""}))},children:[(0,zn.jsx)("div",{className:"selectbox-image",style:{backgroundColor:e.colorBg},dangerouslySetInnerHTML:{__html:Kn.D7r.medium}}),(0,zn.jsx)("div",{className:"selectbox-title",children:(0,W.Z)("No color")})]}),Object.keys(JF).map((t=>(0,zn.jsxs)("button",{className:Gn()("selectbox",{"selectbox-selected":t===e.colorWindowBg}),onClick:e=>{(0,Fo.kz)(a,(e=>{e[r].colorWindowBg=t}))},children:[(0,zn.jsx)("div",{className:"selectbox-image",style:{backgroundColor:t},dangerouslySetInnerHTML:{__html:Kn.D7r.medium}}),(0,zn.jsx)("div",{className:"selectbox-title",children:JF[t]})]},t)))]}),"image"===this.state.backgroundType&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("button",{className:Gn()("selectbox",{"selectbox-selected":!e.backgroundImage}),onClick:e=>{(0,Fo.kz)(a,(e=>{e[r].backgroundImage=""}))},children:[(0,zn.jsx)("div",{className:"selectbox-image",style:{backgroundColor:e.colorWindowBg},dangerouslySetInnerHTML:{__html:Kn.D7r.medium}}),(0,zn.jsx)("div",{className:"selectbox-title",children:(0,W.Z)("Solid Color")})]}),Object.keys(d).map((t=>(0,zn.jsxs)("button",{className:Gn()("selectbox",{"selectbox-selected":t===e.backgroundImage}),onClick:e=>{(0,Fo.kz)(a,(e=>{e[r].backgroundImage=t}))},children:[(0,zn.jsx)("div",{className:"selectbox-image",style:{backgroundImage:`url(${t})`},dangerouslySetInnerHTML:{__html:Kn.D7r.medium}}),(0,zn.jsx)("div",{className:"selectbox-title",children:d[t]})]},t)))]})]})})]}),(0,zn.jsx)("div",{id:this.settingsId,label:(0,W.Z)("Settings"),children:(0,zn.jsxs)("div",{className:"TabbedView--Padded",children:[(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Transparency")}),(0,zn.jsx)(tI,{min:0,max:.25,step:.01,value:1-e.alpha,onChange:e=>{sW(a,(t=>{t[r].alpha=parseFloat((1-Number(e.currentTarget.value)).toFixed(2))}))},label:`${Math.round(100*(1-e.alpha))}%`}),(0,zn.jsx)("p",{className:"info pad-zero",children:(0,W.Z)("Adjust Panel transparency level.")})]}),(0,zn.jsx)("div",{className:"setting-single pad-top",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:e.transparencyTabBar,onChange:e=>{(0,Fo.kz)(a,(t=>{t[r].transparencyTabBar=e.target.checked}))}}),(0,zn.jsx)("span",{children:(0,W.Z)("Transparent Tab Bar")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:e.transparencyTabs,onChange:e=>{(0,Fo.kz)(a,(t=>{t[r].transparencyTabs=e.target.checked}))}}),(0,zn.jsx)("span",{children:(0,W.Z)("Transparent Background Tabs")})]})})]}),(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Blur")}),(0,zn.jsx)(tI,{min:0,max:10,step:1,value:e.blur,onChange:e=>{sW(a,(t=>{t[r].blur=Number(e.target.value)}))}}),(0,zn.jsx)("p",{className:"info pad-zero",children:(0,W.Z)("Apply blur effect to image in Panel and Tab Bar background.")})]}),(0,zn.jsxs)("div",{className:"setting-single pad-top",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Corner Rounding")}),(0,zn.jsx)(tI,{min:-1,max:14,value:e.radius,onChange:e=>{sW(a,(t=>{t[r].radius=Number(e.target.value)}))},label:-1===e.radius?(0,W.Z)("Disabled"):e.radius.toString()})]})]})]})}),(0,zn.jsx)("div",{id:this.buttonsId,label:(0,W.Z)("Icons"),children:(0,zn.jsx)(BF,{themeId:e.id,themePref:a,prefValues:i})})]})]})})}}const aW=(0,zd.Z)(iW,QF),oW=[Z.kThemeScheduleEnabled,Z.kThemeScheduleOS,Z.kThemeScheduleTimeline,Z.kThemesSystem,Z.kThemesUser],rW=I.Z.getEventHandler,lW=["colorFg","colorBg","colorBgDark","colorBgIntense","colorBorderIntense","colorAccentBg"];var dW=(0,zn.jsx)("hr",{});class cW extends Un.PureComponent{static contextType=oi.Z;refScheduleTimeline=Un.createRef();constructor(e){super(e),this.state={dragging:!1,now:new Date,selectedScheduleId:e.prefValues[Z.kThemeScheduleTimeline][0].id}}componentDidMount(){this.context.addEventListener("pointerup",this.stopPointerReschedule),this.timer=setInterval(this.updateNow,6e4)}componentWillUnmount(){clearInterval(this.timer),this.context.removeEventListener("pointerup",this.stopPointerReschedule)}updateNow=()=>{this.setState({now:new Date})};startPointerReschedule=(e,t)=>{t.persist(),t.preventDefault(),this.setState({dragging:!0,selectedScheduleId:e},(()=>{this.handlePointerReschedule(t)}))};pointerReschedule=e=>{e.preventDefault(),this.state.dragging&&this.handlePointerReschedule(e)};stopPointerReschedule=()=>{if(this.state.dragging){this.setState({dragging:!1});const e=Si.ZP.getTimerByDate(new Date,"current");e&&On.Z.setTheme(e.themeId)}};handlePointerReschedule=e=>{const t=this.refScheduleTimeline.current?.getBoundingClientRect()??{left:0,width:0},s=e.clientX-t.left,n=5*Math.floor(1439/t.width*s/5);n<0||n>1439||(0,Fo.kz)(Z.kThemeScheduleTimeline,(e=>{const t=e.findIndex((e=>e.id===this.state.selectedScheduleId));e[t].hours=Math.floor(n/60),e[t].minutes=n-60*e[t].hours}))};addSchedule=()=>{const e=this.props.prefValues[Z.kThemeScheduleTimeline],t=crypto.randomUUID();I.Z.set(Z.kThemeScheduleTimeline,[...e,{id:t,minutes:0,hours:12,themeId:Si.ZP.getDefaultTheme().id,undeletable:!1}]),this.setState({selectedScheduleId:t})};removeSelectedScheduleOnDelete=e=>{["KeyCode.KEY_BACK_SPACE","KeyCode.KEY_DELETE"].includes(e.keyCode)&&this.removeSelectedSchedule()};handleKeyboardReschedule=(e,t)=>{if([mo.Z.KEY_LEFT,mo.Z.KEY_RIGHT].includes(t.keyCode)){(0,Fo.kz)(Z.kThemeScheduleTimeline,(s=>{const n=s.findIndex((t=>t.id===e));let i=60*s[n].hours+s[n].minutes;t.shiftKey?t.keyCode===mo.Z.KEY_LEFT&&i>29?i-=30:t.keyCode===mo.Z.KEY_RIGHT&&i<1409&&(i+=30):t.keyCode===mo.Z.KEY_LEFT&&i>4?i-=5:t.keyCode===mo.Z.KEY_RIGHT&&i<1434&&(i+=5),s[n].hours=Math.floor(i/60),s[n].minutes=i-60*s[n].hours}))&&this.setState({selectedScheduleId:e})}else[mo.Z.KEY_BACK_SPACE,mo.Z.KEY_DELETE].includes(t.keyCode)&&this.removeSelectedSchedule()};removeSelectedSchedule=()=>{(0,Fo.kz)(Z.kThemeScheduleTimeline,(e=>{const t=e.findIndex((e=>e.id===this.state.selectedScheduleId));e[t].undeletable||e.splice(t,1)}))&&this.setState({selectedScheduleId:void 0})};updateOSTheme=e=>{const t=this.props.prefValues[Z.kThemeScheduleOS];I.Z.set(Z.kThemeScheduleOS,{...t,[e.target.name]:e.target.value})};indicatorFocus=(e,t)=>{t.stopPropagation(),this.setState({selectedScheduleId:e})};indicatorBlur=()=>{this.setState({selectedScheduleId:void 0})};render(){const e=[...this.props.prefValues[Z.kThemeScheduleTimeline]],t=this.state.now,s=(t.getMinutes()+60*t.getHours())/14.4+"%",{prefValues:n}=this.props,i=n[Z.kThemesSystem].concat(n[Z.kThemesUser]).sort(((e,t)=>e.name.localeCompare(t.name))),a="timeline"!==n[Z.kThemeScheduleEnabled],o="system"!==n[Z.kThemeScheduleEnabled],r=!1===e.find((e=>e.id===this.state.selectedScheduleId))?.undeletable;return e.sort(((e,t)=>60*e.hours+e.minutes-(60*t.hours+t.minutes))),e.unshift(e[e.length-1]),(0,zn.jsxs)(Vy.Z,{categoryTitle:(0,W.Z)("Theme Schedule"),className:"setting-group unlimited",filter:this.props.filter,onPointerMove:this.pointerReschedule,children:[(0,zn.jsxs)("div",{className:"setting-group-double",children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"radio",value:"off",checked:"off"===n[Z.kThemeScheduleEnabled],onChange:rW(Z.kThemeScheduleEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("No Schedule")})]})}),(0,zn.jsx)("div",{className:"setting-single pad-top",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"radio",value:"system",checked:"system"===n[Z.kThemeScheduleEnabled],onChange:rW(Z.kThemeScheduleEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("Operating System")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("span",{children:(0,W.Z)("theme","Light")}),(0,zn.jsx)(Fa.Z,{name:"light",value:n[Z.kThemeScheduleOS].light,disabled:o,onChange:this.updateOSTheme,children:i.map((e=>(0,zn.jsx)("option",{value:e.id,children:e.name},e.id)))})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("span",{children:(0,W.Z)("theme","Dark")}),(0,zn.jsx)(Fa.Z,{name:"dark",value:n[Z.kThemeScheduleOS].dark,disabled:o,onChange:this.updateOSTheme,children:i.map((e=>(0,zn.jsx)("option",{value:e.id,children:e.name},e.id)))})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"radio",value:"timeline",checked:"timeline"===n[Z.kThemeScheduleEnabled],onChange:rW(Z.kThemeScheduleEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("Manual Schedule")})]})})]}),(0,zn.jsxs)("div",{className:"theme-schedule-timeline"+(a?" schedule-disabled":""),ref:this.refScheduleTimeline,children:[!a&&(0,zn.jsx)("span",{className:"theme-schedule-now-indicator",style:{left:s},children:(0,W.Z)("Now")}),e.map(((t,s)=>{const n=0===s?0:(60*t.hours+t.minutes)/14.4,o=e[s+1],r=o?60*o.hours+o.minutes:1440,l=String(t.hours).padStart(2,"0"),d=String(t.minutes).padStart(2,"0"),{name:c}=Si.ZP.getThemeWithFallback(t.themeId),h=Ue.Z.getBaseStylesByThemeId(t.themeId,lW),u=this.state.selectedScheduleId===t.id;return(0,zn.jsxs)("div",{className:Gn()("theme-schedule-timeslice",{"timeslice-selected":!a&&u}),style:{width:r/14.4-n+"%",left:`${n}%`},children:[0!==s&&(0,zn.jsxs)(zn.Fragment,{children:[!a&&(0,zn.jsx)("div",{title:c,className:"timeslice-bubble",onFocus:this.indicatorFocus.bind(this,t.id),onBlur:this.indicatorBlur,disabled:a,onPointerDown:e=>this.startPointerReschedule(t.id,e),onKeyDown:this.handleKeyboardReschedule.bind(this,t.id),children:(0,zn.jsx)("div",{children:`${l}:${d}`})}),(0,zn.jsx)("div",{className:"theme-schedule-timeslice-indicator",children:(0,zn.jsx)("input",{type:"button",className:"theme-schedule-timeslice-draghandle",title:c,onFocus:this.indicatorFocus.bind(this,t.id),onBlur:this.indicatorBlur,disabled:a,onPointerDown:e=>this.startPointerReschedule(t.id,e),onKeyDown:this.handleKeyboardReschedule.bind(this,t.id)})})]}),(0,zn.jsx)("select",{disabled:a,value:t.themeId,style:h,title:c,onFocus:this.indicatorFocus.bind(this,t.id),onKeyDown:this.removeSelectedScheduleOnDelete,onChange:e=>{return s=t.id,n=e.target.value,void(0,Fo.kz)(Z.kThemeScheduleTimeline,(e=>{const t=e.findIndex((e=>e.id===s));-1!==t&&(e[t].themeId=n)}));var s,n},children:i.map((e=>(0,zn.jsx)("option",{value:e.id,children:e.name},e.id)))})]},s)}))]}),(0,zn.jsx)("div",{className:"toolbar toolbar-default toolbar-group",children:(0,zn.jsxs)("div",{className:"toolbar-group",children:[(0,zn.jsx)(oa.ZP,{disabled:a,onClick:this.addSchedule,image:Kn.md4.medium,title:(0,W.Z)("Add")}),dW,(0,zn.jsx)(oa.ZP,{disabled:a||!r||void 0===this.state.selectedScheduleId,onClick:this.removeSelectedSchedule,image:Kn.M2k.medium,title:(0,W.Z)("other","Remove")})]})})]})}}const hW=(0,zd.Z)(cW,oW);var uW=s(97899),pW=s(8959);const gW=I.Z.getEventHandler,mW=[Z.kSystemAccentColor,Z.kThemeScheduleEnabled,Z.kThemeScheduleOS,Z.kThemeScheduleTimeline,Z.kThemesCurrent,Z.kThemesCurrentButtons,Z.kThemesCurrentPrivate,Z.kThemesPreferCustomButtons,Z.kThemesPreview,Z.kThemesSystem,Z.kThemesUser];const fW=crypto.randomUUID(),vW=crypto.randomUUID();function bW(e){const{value:t}=e.currentTarget;"none"===t?I.Z.reset(Z.kThemesCurrentButtons):I.Z.set(Z.kThemesCurrentButtons,t)}var CW=(0,zn.jsx)("div",{className:"ThemePreview-Label-Meta"}),wW=(0,zn.jsx)("hr",{});function yW(e){const t=Un.useContext(oi.Z),n=(0,Eo.Z)(mW),i=Un.createRef(),[a,o]=Un.useState(On.Z.getCurrentIdWithoutPreview(t.vivaldiWindowId)),[r,l]=Un.useState(fW),[d,h]=Un.useState(void 0),u=e=>{h(e)},p=()=>{h(void 0)},g=()=>{d&&On.Z.deleteTheme(d),p()},m=(e,t)=>{switch(t.key){case"ArrowUp":f(e,"up"),(0,wi.ZP)(t);break;case"ArrowLeft":f(e,"left"),(0,wi.ZP)(t);break;case"ArrowDown":f(e,"down"),(0,wi.ZP)(t);break;case"ArrowRight":f(e,"right"),(0,wi.ZP)(t);break;default:return}},f=(e,t)=>{const s=i.current;if(s){bo(e,t,Array.from(s.querySelectorAll(".ThemePreviews .ThemePreview-Image")),Math.max(1,Math.floor((s.clientWidth-18)/158)))}};function v(e){return(0,zn.jsxs)("div",{className:"TabbedView-Footer",children:[(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Import Theme..."),onClick:()=>async function(e){On.Z.clearThemePreview();const[t]=await e.showOpenFilePicker({multiple:!1,types:[{description:(0,W.Z)("Select Theme to Import"),accept:{"application/zip":[".zip"]}}]}),s=(0,uW.Z)(await t.getFile()),n=new ReadableStream({pull:async e=>{const t=await s.next();if(t.done)return e.close();const{value:n}=t,{name:i}=n;let a;if(i.toLowerCase().endsWith(".svg")){const e=await n.arrayBuffer(),t=(0,Si.tc)(e);a=()=>new ReadableStream({start:e=>{e.enqueue(t),e.close()}})}else a=()=>n.stream();return e.enqueue({name:i,stream:a})}}),i=n.pipeThrough(new pW.Z).getReader(),a=[];let o=0;for(;;){const{done:e,value:t}=await i.read();if(e||!t)break;o+=t.byteLength,a.push(t)}const r=new Uint8Array(o);let l=0;for(const e of a)r.set(e,l),l+=e.byteLength;const{error:d}=await re.Z.themePrivate.import({dataBlob:r.buffer});if(d)throw new Error(`${d.kind} - ${d.details}`)}(t)}),(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Export Theme..."),onClick:async()=>{const s=Si.ZP.getThemeWithFallback(e);await On.Z.exportTheme(s,t.vivaldiWindowId)}}),(0,zn.jsxs)("a",{className:"external-link",href:"https://themes.vivaldi.net",onClick:()=>c.ZP.openURL(t.vivaldiWindowId,"https://themes.vivaldi.net"),style:{margin:"auto 0 auto auto"},children:[(0,W.Z)("Get more themes"),(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:s(70942)}})]})]})}const b=Si.ZP.getSystemThemes(),C=b.concat(n[Z.kThemesUser]),w=On.Z.getCurrentIdWithoutPreview(t.vivaldiWindowId),y=Si.ZP.getThemesWithButtons();return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)(Vy.Z,{filter:e.filter,categoryTitle:(0,W.Z)("Themes"),children:(0,zn.jsxs)(tb.Z,{filter:e.filter,children:[(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Select any of the pre-installed themes, make your own in the Theme Editor, or head over to themes.vivaldi.net to download themes shared by the Vivaldi community.")}),(0,zn.jsxs)(aM,{icons:[Kn.v5q.small,Kn.B$9.small],activeTabId:r,onTabClick:l,className:"ThemeEditor-Tabs-"+(r===fW?"Library":"Editor"),children:[(0,zn.jsxs)("div",{id:fW,label:(0,W.Z)("Library"),children:[(0,zn.jsxs)("div",{className:"TabbedView--Padded ThemePreviews",ref:i,children:[d&&(()=>{const e=Si.ZP.getThemeWithFallback(d).name;return(0,zn.jsxs)(Ha.Z,{onRequestClose:p,className:"float",title:(0,W.Z)("Deleting “$1”",[e]),children:[(0,zn.jsx)("div",{className:"dialog-content",children:(0,zn.jsx)("p",{children:(0,W.Z)("Do you want to permanently delete the “$1” theme?",[e])})}),(0,zn.jsxs)("div",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"button",className:"danger",onClick:g,value:(0,W.Z)("Delete Theme")}),(0,zn.jsx)("input",{type:"button",onClick:p,value:(0,W.Z)("Cancel")})]})]})})(),C.map((e=>(0,zn.jsx)("div",{onDoubleClick:()=>{l(vW)},onKeyDown:t=>m(e.id,t),children:(0,zn.jsx)(YF,{isCurrent:e.id===w,isSystem:b.some((t=>t.id===e.id)),theme:e,themeChangeCallback:o,onConfirmDeletion:u})},e.id))),(0,zn.jsxs)("div",{className:"ThemePreview ThemePreview--New",children:[(0,zn.jsx)("button",{onClick:e=>((e,t)=>{const s=t.currentTarget.closest(".settings-content");s&&s.scrollTop>150&&s.scrollTo({top:150,behavior:"smooth"}),o(On.Z.createTheme(e)),l(vW)})(w,e),className:"ThemePreview-Image",dangerouslySetInnerHTML:{__html:Kn.Clf},"data-id":"id__theme__preview",onKeyDown:e=>m("id__theme__preview",e)}),(0,zn.jsx)("div",{className:"ThemePreview-Label",children:(0,W.Z)("New Theme...")}),CW]})]}),v(w)]}),(0,zn.jsxs)("div",{id:vW,label:(0,W.Z)("Editor"),children:[(0,zn.jsx)("div",{className:"TabbedView--Padded",children:(0,zn.jsx)(aW,{theme:Si.ZP.getThemeWithFallback(a),isCurrent:a===w,isSystem:b.some((e=>e.id===a)),filter:e.filter,themeChangeCallback:o})}),v(a||w)]})]}),(0,zn.jsxs)("div",{className:"Button-Set-Picker setting-group unlimited pad-top",children:[(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:n[Z.kThemesPreferCustomButtons],onChange:gW(Z.kThemesPreferCustomButtons),disabled:!y.length}),(0,zn.jsx)("span",{children:(0,W.Z)("Use Icon Set")})]}),y.length>0&&(0,zn.jsxs)("label",{children:[(0,zn.jsx)("span",{children:(0,W.Z)("other","from")}),(0,zn.jsxs)(Fa.Z,{defaultValue:n[Z.kThemesCurrentButtons],onChange:bW,disabled:!n[Z.kThemesPreferCustomButtons],children:[(0,zn.jsx)("option",{value:"none",children:(0,W.Z)("Currently Active Theme")}),wW,y.map((e=>(0,zn.jsx)("option",{value:e.id,children:e.name},e.id)))]})]})]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Disable setting to always use default Vivaldi icon set. Or select a theme to apply its icon set to all other themes.")})]})]})}),(0,zn.jsx)(Vy.Z,{categoryTitle:(0,W.Z)("Private Window Theme"),filter:e.filter,children:(0,zn.jsx)("div",{className:"setting-single setting-single--LeadingText",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("span",{children:(0,W.Z)("Select theme for Private Windows")}),(0,zn.jsx)(Fa.Z,{value:n[Z.kThemesCurrentPrivate],onChange:e=>I.Z.set(Z.kThemesCurrentPrivate,e.currentTarget.value),children:C.map((e=>(0,zn.jsx)("option",{value:e.id,children:e.name},e.id)))})]})})}),(0,zn.jsx)(hW,{filter:e.filter})]})}const xW=Un.memo(yW),IW=[...ZF,...NF,...mW];function AW({filter:e,category:t}){const s=nI({filter:e,prefPaths:IW,name:t.title});return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsx)(xW,{filter:e})}),(0,zn.jsxs)("section",{className:"setting-section",children:[(0,zn.jsx)(MF,{filter:e}),(0,zn.jsx)(EF,{filter:e})]}),s]})}const SW=Un.memo(AW);var ZW=s(85619);const TW=[Z.kWebpagesCaptureDirectory,Z.kWebpagesCaptureSaveFilePattern],EW=I.Z.getEventHandler,kW=new Date,NW="139cea89-3ed1-4ccd-bd3c-7a6a36f824d5",_W=[{tag:"$timestamp",title:(0,W.Z)("Long date"),format:"YYYY-MM-DD HH.mm.ss"},{tag:"$year",title:(0,W.Z)("Year"),format:"YYYY"},{tag:"$month",title:(0,W.Z)("Month"),format:"MM"},{tag:"$day",title:(0,W.Z)("Day"),format:"DD"},{tag:"$hour",title:(0,W.Z)("Hour"),format:"HH"},{tag:"$minute",title:(0,W.Z)("Minute"),format:"mm"},{tag:"$second",title:(0,W.Z)("time","Second"),format:"ss"},{tag:"$ms",title:(0,W.Z)("Millisecond"),format:"SSS"},{tag:"$longid",title:(0,W.Z)("Unique ID"),value:NW},{tag:"$shortid",title:(0,W.Z)("Short unique ID"),value:NW.substring(24)},{tag:"$host",title:(0,W.Z)("Active tab host name"),value:"example.com"},{tag:"$title",title:(0,W.Z)("Active tab title"),value:(0,W.Z)("Example Page Title")}];function PW(e){const t=(0,Eo.Z)(TW),s=Un.useContext(oi.Z),n=Un.useRef(),i=e=>{const{dataTransfer:t,target:s}=e;t.setData("text/plain",s.innerText),t.dropEffect="none",t.effectAllowed="copyMove",t.setDragImage(s,0,0)},a=e=>{const{HTMLInputElement:t}=s,{target:i}=e;let a=i.innerText;if(n.current instanceof t){const e=n.current.selectionStart,t=n.current.value||"";a=" "+a+" ";let s=e>0?t.substr(0,e)+a+t.substr(e):t+a;s=s.replace(/ {2}/g," ").trim(),I.Z.set(Z.kWebpagesCaptureSaveFilePattern,s),n.current&&n.current.focus()}};return(0,zn.jsxs)(Vy.Z,{categoryTitle:(0,W.Z)("Image Capture"),filter:e.filter,children:[(0,zn.jsx)("div",{className:"setting-group",children:(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Capture Storage Folder")}),(0,zn.jsxs)("div",{className:"setting-single folder-selection",children:[(0,zn.jsx)("input",{type:"text",value:t[Z.kWebpagesCaptureDirectory],title:(0,W.Z)("Enter capture storage folder"),spellCheck:"false",onChange:EW(Z.kWebpagesCaptureDirectory)}),(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Select Folder..."),onClick:()=>{re.Z.utilities.selectFile({windowId:s.vivaldiWindowId,title:(0,W.Z)("Select Capture Folder"),type:"folder"}).then((e=>{e&&I.Z.set(Z.kWebpagesCaptureDirectory,e)}))}})]})]})}),(0,zn.jsx)("div",{className:"setting-group",children:(0,zn.jsxs)("div",{className:"setting-single capture-name-template",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Capture File Name Template")}),(0,zn.jsx)("input",{type:"text",ref:n,onDragEnter:e=>{const{dataTransfer:t,target:s}=e;s&&t.types.includes("text/plain")&&(s.setSelectionRange(s.value.length,s.value.length),s.focus())},value:t[Z.kWebpagesCaptureSaveFilePattern],title:(0,W.Z)("Modify file name template"),spellCheck:"false",onChange:EW(Z.kWebpagesCaptureSaveFilePattern)}),(0,zn.jsx)("p",{className:"info",children:(()=>{let e=t[Z.kWebpagesCaptureSaveFilePattern];return _W.forEach((t=>{const s=new RegExp((0,ZW.Z)(t.tag),"gi"),n=t.format?V()(kW).format(t.format):t.value;e=e.replace(s,n)})),(e||NW)+".png"})()}),(0,zn.jsx)("p",{className:"info",children:_W.map(((e,t)=>(0,zn.jsx)("span",{draggable:"true",onDoubleClick:a,onDragStart:i,title:e.title+(e.format?" ("+e.format+")":""),children:e.tag},t)))}),(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Restore Default"),onClick:()=>{I.Z.reset(Z.kWebpagesCaptureSaveFilePattern)}})]})})]})}const MW=Un.memo(PW),DW={standard:{localizedFamily:(0,W.Z)("Standard")},sansserif:{localizedFamily:(0,W.Z)("Sans-serif")},serif:{localizedFamily:(0,W.Z)("Serif")},fixed:{localizedFamily:(0,W.Z)("Monospaced")},cursive:{localizedFamily:(0,W.Z)("Cursive")},fantasy:{localizedFamily:(0,W.Z)("Fantasy")}},OW=[9,10,11,12,13,14,16,18,20,24],jW=[0,4,6,7,8,...OW],LW=[Z.kWebKitDefaultFontSize,Z.kWebKitMinimumFontSize],RW=I.Z.getEventHandler,BW=[...LW,Z.kWebKitCursiveFontFamily,Z.kWebKitFantasyFontFamily,Z.kWebKitFixedFontFamily,Z.kWebKitSansSerifFontFamily,Z.kWebKitSerifFontFamily,Z.kWebKitStandardFontFamily];function FW(e,t){return Object.keys(e).flatMap((s=>e[s]?t(s,e[s]):[]))}function WW(e){const t=(0,Eo.Z)(LW),[s,i]=Un.useState([]),[a,o]=Un.useState({}),r=Un.useRef(new Set);Un.useEffect((()=>(n.Z.fontSettings.onFontChanged.addListener(l),n.Z.fontSettings.getFontList((e=>{r.current=new Set(e.map((e=>e.fontId))),i(e)})),FW(DW,((e,t)=>{n.Z.fontSettings.getFont({genericFamily:e},(s=>{o((n=>({...n,[e]:{font:s.fontId,localizedFamily:t.localizedFamily}})))}))})),()=>n.Z.fontSettings.onFontChanged.removeListener(l))),[]);const l=e=>{o((t=>({...t,[e.genericFamily]:{font:e.fontId,localizedFamily:DW[e.genericFamily]?.localizedFamily}})))},d=e=>{const s="default"===e?parseInt(t[Z.kWebKitDefaultFontSize]):parseInt(t[Z.kWebKitMinimumFontSize]),n="default"===e?OW:jW;return n.includes(s)||(n.push(s),n.sort(((e,t)=>e-t))),n.map((e=>(0,zn.jsx)("option",{children:e},e)))},c=s.map((e=>(0,zn.jsx)("option",{value:e.fontId,children:e.displayName},e.fontId)));return(0,zn.jsxs)(Vy.Z,{categoryTitle:(0,W.Z)("Fonts"),filter:e.filter,className:"setting-group unlimited",children:[(0,zn.jsxs)("div",{className:"setting-group-double font-slider",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("span",{children:(0,W.Z)("Default Font Size")}),(0,zn.jsxs)("span",{className:"fake-dataset",children:[(0,zn.jsx)("input",{type:"number",min:"6",max:"99",value:t[Z.kWebKitDefaultFontSize],onChange:RW(Z.kWebKitDefaultFontSize)}),(0,zn.jsx)(Fa.Z,{value:t[Z.kWebKitDefaultFontSize],onChange:RW(Z.kWebKitDefaultFontSize),children:d("default")})]})]}),(0,zn.jsxs)("label",{children:[(0,zn.jsx)("span",{children:(0,W.Z)("Minimum Font Size")}),(0,zn.jsxs)("span",{className:"fake-dataset",children:[(0,zn.jsx)("input",{type:"number",min:"0",max:"99",value:t[Z.kWebKitMinimumFontSize],onChange:RW(Z.kWebKitMinimumFontSize)}),(0,zn.jsx)(Fa.Z,{value:t[Z.kWebKitMinimumFontSize],onChange:RW(Z.kWebKitMinimumFontSize),children:d("minimum")})]})]})]}),(0,zn.jsxs)("div",{className:"setting-group-double pad-top font-face-list",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Default Fonts")}),FW(a,((e,t)=>{const{font:s,localizedFamily:n}=t,i=void 0===s||r.current?.has(s)?"":(0,zn.jsx)("option",{value:s,children:(0,W.Z)("Fallback for “$1”",[s])},s);return(0,zn.jsxs)("label",{className:"setting-single",children:[(0,zn.jsx)("span",{children:n}),(0,zn.jsxs)(Fa.Z,{onChange:t=>((e,t)=>{const s=t.target.value;switch(e){case"standard":default:I.Z.set(Z.kWebKitStandardFontFamily,s);break;case"fantasy":I.Z.set(Z.kWebKitFantasyFontFamily,s);break;case"fixed":I.Z.set(Z.kWebKitFixedFontFamily,s);break;case"sansserif":I.Z.set(Z.kWebKitSansSerifFontFamily,s);break;case"serif":I.Z.set(Z.kWebKitSerifFontFamily,s);break;case"cursive":I.Z.set(Z.kWebKitCursiveFontFamily,s)}})(e,t),value:s,children:[i,c]})]},e)}))]})]})}const UW=Un.memo(WW),VW=I.Z.getEventHandler,HW=[Z.kWebpagesReaderAllowVertical,Z.kWebpagesReaderControls,Z.kWebpagesReaderStyle],GW=["ja","ja-KS","ko","zh-CN","zh-TW"].includes(navigator.language),KW={min:.5,max:4,step:.1},zW={min:1,max:2,step:.1},$W={min:20,max:100,step:2};var YW=(0,zn.jsx)("hr",{}),XW=(0,zn.jsx)("hr",{}),QW=(0,zn.jsx)("hr",{}),qW=(0,zn.jsx)("hr",{}),JW=(0,zn.jsx)("hr",{}),eU=(0,zn.jsx)("hr",{});function tU(e){const t=Un.useContext(oi.Z),s=Un.useRef(null),n=(0,Eo.Z)(HW),[i,a]=Un.useState(!1),[o,r]=Un.useState(String(Ue.Z.getReaderThemeColor(t.vivaldiWindowId)["--colorFg"])),l=n[Z.kWebpagesReaderStyle];Un.useEffect((()=>{function e(){r(String(Ue.Z.getReaderThemeColor(t.vivaldiWindowId)["--colorFg"]))}return Ue.Z.addListener(e),()=>Ue.Z.removeListener(e)}),[t.vivaldiWindowId]);const d=e=>()=>{m({themeStyle:e})},c=e=>()=>{m({fontFamily:e})},h=e=>()=>{const{step:t}=zW,s=(l.lineHeight+("increment"===e?t:-t)).toFixed(1);m({lineHeight:parseFloat(s)})},u=e=>()=>{const{step:t}=KW,s=(l.fontSize+("increment"===e?t:-t)).toFixed(1);m({fontSize:parseFloat(s)})},p=e=>()=>{const{step:t}=$W;m({width:l.width+("increment"===e?t:-t)})},g=e=>()=>{m({writingMode:e})},m=(0,Wv.Z)((e=>{I.Z.set(Z.kWebpagesReaderStyle,{...l,...e}),hn.Z.setReaderModeStyle(t.vivaldiWindowId)}),300,{leading:!0,trailing:!0}),f=()=>{a((e=>!e))},v=n[Z.kWebpagesReaderAllowVertical],b="vertical-rl"===l.writingMode;if(e.prefs&&l){const s=(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("h2",{children:(0,W.Z)("Reader")}),(0,zn.jsxs)("div",{className:"setting-group-unlimited",children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:n[Z.kWebpagesReaderControls],onChange:VW(Z.kWebpagesReaderControls)}),(0,zn.jsx)("span",{children:(0,W.Z)("Display Settings on Page in Reader")})]})}),!GW&&(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:v,onChange:VW(Z.kWebpagesReaderAllowVertical)}),(0,zn.jsx)("span",{children:(0,W.Z)("Allow Vertical Text Direction")})]})})]}),(0,zn.jsxs)("div",{className:"setting-group pad-top",children:[(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Font Face")}),(0,zn.jsx)("div",{className:"toolbar toolbar-default",children:(0,zn.jsxs)("div",{className:"toolbar toolbar-group",children:[(0,zn.jsx)(oa.ZP,{title:(0,W.Z)("Sans-serif"),image:Kn.g4W.medium,isPressed:"sans-serif"===l.fontFamily,onClick:c("sans-serif")}),YW,(0,zn.jsx)(oa.ZP,{title:(0,W.Z)("Serif"),image:Kn.USP.medium,isPressed:"serif"===l.fontFamily,onClick:c("serif")})]})})]}),(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Font Size")}),(0,zn.jsx)(tI,{label:Math.round(100*l.fontSize)+" %",value:l.fontSize,min:KW.min,max:KW.max,step:KW.step,onChange:e=>m({fontSize:Number(e.currentTarget.value)})})]}),(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Line Height")}),(0,zn.jsx)(tI,{value:l.lineHeight,min:zW.min,max:zW.max,step:zW.step,onChange:e=>m({lineHeight:Number(e.currentTarget.value)})})]}),(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Column Width")}),(0,zn.jsx)(tI,{value:l.width,min:$W.min,max:$W.max,step:$W.step,onChange:e=>m({width:Number(e.currentTarget.value)})})]}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Reset to Defaults"),onClick:()=>hn.Z.resetReaderModeStyle(t.vivaldiWindowId)})})]}),(0,zn.jsxs)("div",{className:"setting-group pad-top",children:[(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Color Scheme")}),(0,zn.jsx)("div",{className:"toolbar toolbar-default",children:(0,zn.jsxs)("div",{className:"toolbar toolbar-group",children:[(0,zn.jsx)(oa.ZP,{title:(0,W.Z)("other","Light"),image:Kn.XQw.medium,onClick:d("light"),isPressed:"light"===l.themeStyle,buttonStyle:{"--kIconCircleFill":"#f6f6f6","--kIconCircleStroke":"var(--colorFg)"}}),XW,(0,zn.jsx)(oa.ZP,{title:(0,W.Z)("other","Dark"),image:Kn.XQw.medium,onClick:d("dark"),isPressed:"dark"===l.themeStyle,buttonStyle:{"--kIconCircleFill":"#111111","--kIconCircleStroke":"var(--colorFg)"}}),QW,(0,zn.jsx)(oa.ZP,{title:(0,W.Z)("other","Theme"),image:Kn.XQw.medium,isPressed:"theme"===l.themeStyle,onClick:d("theme"),buttonStyle:{"--kIconCircleFill":"var(--colorBgLight)","--kIconCircleStroke":"var(--colorHighlightBg)"}})]})})]}),(GW||v)&&(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Text Direction")}),(0,zn.jsx)("div",{className:"toolbar toolbar-default",children:(0,zn.jsxs)("div",{className:"toolbar toolbar-group",children:[(0,zn.jsx)(oa.ZP,{tooltip:(0,W.Z)("Horizontal Text"),title:(0,W.Z)("title","Horizontal"),onClick:g("unset"),isPressed:"vertical-rl"!==l.writingMode,image:Kn.weK,disabled:!(GW||v)}),(0,zn.jsx)(oa.ZP,{tooltip:(0,W.Z)("Vertical Text"),title:(0,W.Z)("title","Vertical"),isPressed:"vertical-rl"===l.writingMode,onClick:g("vertical-rl"),image:Kn.lIQ,disabled:!(GW||v)})]})})]})]})]});return(0,zo.ZP)(s,e.filter)}return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)(Jb.Z,{classNames:"reader-toolbar",in:i,mountOnEnter:!0,unmountOnExit:!0,timeout:{enter:300,exit:150},nodeRef:s,children:(0,zn.jsxs)("div",{ref:s,className:"toolbar toolbar-default reader-toolbar",children:[(0,zn.jsxs)("div",{className:"toolbar-group",children:[(0,zn.jsx)(oa.ZP,{tooltip:(0,W.Z)("Sans-serif"),image:Kn.g4W.medium,isPressed:"sans-serif"===l.fontFamily,onClick:c("sans-serif")}),(0,zn.jsx)(oa.ZP,{tooltip:(0,W.Z)("Serif"),image:Kn.USP.medium,buttonStyle:{fontFamily:"serif"},isPressed:"serif"===l.fontFamily,onClick:c("serif")})]}),(0,zn.jsxs)("div",{className:"toolbar-group",children:[(0,zn.jsx)(oa.ZP,{className:"decrease-font-size",tooltip:(0,W.Z)("Decrease font size"),image:Kn.g4W.medium,disabled:!(l.fontSize>KW.min),onClick:u("decrement")}),qW,(0,zn.jsx)(oa.ZP,{className:"increase-font-size",tooltip:(0,W.Z)("Increase font size"),image:Kn.g4W.medium,disabled:!(l.fontSize<KW.max),onClick:u("increment")})]}),(0,zn.jsxs)("div",{className:"toolbar-group",children:[(0,zn.jsx)(oa.ZP,{className:b?"button-rotateimage":"",tooltip:(0,W.Z)("Tighten line spacing"),disabled:!(l.lineHeight>zW.min),onClick:h("decrement"),image:Kn.sss}),JW,(0,zn.jsx)(oa.ZP,{className:b?"button-rotateimage":"",tooltip:(0,W.Z)("Loosen line spacing"),disabled:!(l.lineHeight<zW.max),onClick:h("increment"),image:Kn.zDC})]}),(0,zn.jsxs)("div",{className:"toolbar-group",children:[(0,zn.jsx)(oa.ZP,{className:b?"button-rotateimage":"",tooltip:(0,W.Z)("Shrink column"),disabled:!(l.width>$W.min),onClick:p("decrement"),image:Kn.Gpq}),eU,(0,zn.jsx)(oa.ZP,{className:b?"button-rotateimage":"",tooltip:(0,W.Z)("Grow column"),disabled:!(l.width<$W.max),onClick:p("increment"),image:Kn.Fib})]}),(GW||v)&&(0,zn.jsxs)("div",{className:"toolbar-group",children:[(0,zn.jsx)(oa.ZP,{tooltip:(0,W.Z)("Horizontal Text"),isPressed:"vertical-rl"!==l.writingMode,onClick:g("unset"),image:Kn.weK}),(0,zn.jsx)(oa.ZP,{tooltip:(0,W.Z)("Vertical Text"),isPressed:"vertical-rl"===l.writingMode,onClick:g("vertical-rl"),image:Kn.lIQ})]}),(0,zn.jsxs)("div",{className:"toolbar-group",children:[(0,zn.jsx)(oa.ZP,{tooltip:(0,W.Z)("other","Light"),image:Kn.XQw.medium,onClick:d("light"),isPressed:"light"===l.themeStyle,buttonStyle:{"--kIconCircleFill":"white","--kIconCircleStroke":"var(--colorFg)"}}),(0,zn.jsx)(oa.ZP,{tooltip:(0,W.Z)("other","Dark"),image:Kn.XQw.medium,onClick:d("dark"),image:Kn.XQw.medium,isPressed:"dark"===l.themeStyle,buttonStyle:{"--kIconCircleFill":"black","--kIconCircleStroke":"var(--colorFg)"}}),(0,zn.jsx)(oa.ZP,{tooltip:(0,W.Z)("other","Inherit Theme"),image:Kn.XQw.medium,isPressed:"theme"===l.themeStyle,onClick:d("theme"),buttonStyle:{"--kIconCircleFill":"var(--colorBgLight)","--kIconCircleStroke":"var(--colorHighlightBg)"}})]})]})},"toolbar"),(0,zn.jsx)(oa.ZP,{buttonStyle:i?void 0:{fill:o},className:"reader-settings-toggle",onClick:f,tooltip:(0,W.Z)("Reader settings"),image:Kn.bqs.medium},"reader-settings-toggle")]})}const sU=Un.memo(tU),nU=[Z.kPluginsAlwaysOpenPdfExternally,Z.kPluginsWidevineEnabled],iU=I.Z.getEventHandler;function aU(e){const t=(0,Eo.Z)(nU);return(0,zn.jsx)(Vy.Z,{categoryTitle:(0,W.Z)("Plugins"),filter:e.filter,children:(0,zn.jsxs)("div",{className:"setting-group unlimited",children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:!t[Z.kPluginsAlwaysOpenPdfExternally],onChange:iU(Z.kPluginsAlwaysOpenPdfExternally,"inverse")}),(0,zn.jsx)("span",{children:(0,W.Z)("Enable Internal PDF Viewer")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kPluginsWidevineEnabled],onChange:iU(Z.kPluginsWidevineEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("Enable Widevine Plugin")})]})})]})})}const oU=Un.memo(aU);class rU extends Un.PureComponent{state={zoom:1};#v=!1;componentDidMount(){this.#v=!0,re.Z.zoom.onDefaultZoomChanged.addListener(this._onDefaultZoomChanged),re.Z.zoom.getDefaultZoom(this._onDefaultZoomChanged)}componentWillUnmount(){this.#v=!1,re.Z.zoom.onDefaultZoomChanged.removeListener(this._onDefaultZoomChanged)}rangeCheck=e=>Math.min(Math.max(e,df.VH),df.oJ);_onDefaultZoomChanged=e=>{this.#v&&this.setState({zoom:this.rangeCheck(e)})};setZoomLevel=e=>{const t=this.rangeCheck(e);re.Z.zoom.setDefaultZoom(t)};render(){const{zoom:e}=this.state;return(0,zn.jsx)(rf.Z,{zoom:e,defaultZoomLevel:df.XZ,scrolling:!0,inFooter:!1,maxLevel:df.oJ,minLevel:df.VH,step:df.s5,disabled:!1,onZoomUpdated:this.setZoomLevel},"zoomslider")}}const lU=rU,dU=[Z.kMouseWheelPageZoom,Z.kWebpagesTabZoomEnabled],cU=I.Z.getEventHandler;var hU=(0,zn.jsx)("div",{className:"toolbar toolbar-default",children:(0,zn.jsx)(lU,{})});class uU extends Un.Component{handleZoomUpdated=e=>{re.Z.zoom.setDefaultZoom(e)};render(){return(0,zn.jsx)(tb.Z,{filter:this.props.filter,children:(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Default Webpage Zoom")}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("This affects all webpages with default zoom level.")}),hU]}),(0,zn.jsx)("div",{className:"setting-single pad-top",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.props.prefValues[Z.kMouseWheelPageZoom],onChange:cU(Z.kMouseWheelPageZoom)}),(0,zn.jsx)("span",{children:(0,W.Z)("Use $1+Scroll to Zoom Page",["Ctrl"])})]})}),(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.props.prefValues[Z.kWebpagesTabZoomEnabled],onChange:cU(Z.kWebpagesTabZoomEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("Use Tab Zoom")})]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Retain zoom level when navigating between websites")})]})]})})}}const pU=(0,zd.Z)(uU,dU),gU=[Z.kWebpagesFindShortcutIsAToggle],mU=I.Z.getEventHandler(Z.kWebpagesFindShortcutIsAToggle);function fU(e){const t=(0,Eo.Z)(gU);return(0,zn.jsx)(tb.Z,{filter:e.filter,children:(0,zn.jsx)("div",{className:"setting-group unlimited",children:(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:t[Z.kWebpagesFindShortcutIsAToggle],onChange:mU}),(0,zn.jsx)("span",{children:(0,W.Z)("Toggle Find in Page when using Shortcut")})]})})})})}const vU=Un.memo(fU),bU=[];bU.push(Z.kWebpagesFullScreenHideMouse);const CU=I.Z.getEventHandler;class wU extends Un.Component{render(){return(0,zn.jsx)(tb.Z,{filter:this.props.filter,children:(0,zn.jsx)("span",{children:(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Fullscreen Mode")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.props.prefValues[Z.kWebpagesFullScreenHideMouse],onChange:CU(Z.kWebpagesFullScreenHideMouse)}),(0,zn.jsx)("span",{children:(0,W.Z)("Hide the Mouse Cursor for Page-initiated Fullscreen")})]})})]})})})}}const yU=(0,zd.Z)(wU,bU),xU=[Z.kHardwareAccelerationModeEnabled],IU=I.Z.getEventHandler;class AU extends Un.Component{render(){return(0,zn.jsx)(tb.Z,{filter:this.props.filter,children:(0,zn.jsx)("div",{className:"setting-group unlimited",children:(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.props.prefValues[Z.kHardwareAccelerationModeEnabled],onChange:IU(Z.kHardwareAccelerationModeEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("Use Hardware Acceleration When Available")})]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("This setting requires a restart to take full effect.")})]})})})}}const SU=(0,zd.Z)(AU,xU);var ZU=(0,zn.jsx)("input",{type:"radio",value:"allowed"}),TU=(0,zn.jsx)("input",{type:"radio",value:"once"}),EU=(0,zn.jsx)("input",{type:"radio",value:"none"});class kU extends Un.Component{state={animationPolicy:"allowed"};componentDidMount(){n.Z.accessibilityFeatures.animationPolicy.onChange.addListener(this._onAnimationPolicyChanged),this._onAnimationPolicyChanged()}componentWillUnmount(){n.Z.accessibilityFeatures.animationPolicy.onChange.removeListener(this._onAnimationPolicyChanged)}_onAnimationPolicyChanged=()=>{n.Z.accessibilityFeatures.animationPolicy.get({},(({value:e})=>{this.setState({animationPolicy:e})}))};onSelected=e=>{const t=e.target.value;this.setState({animationPolicy:t},(()=>{n.Z.accessibilityFeatures.animationPolicy.set({value:t},(()=>{}))}))};render(){return(0,zn.jsx)(tb.Z,{filter:this.props.filter,children:(0,zn.jsx)("div",{className:"setting-group",children:(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Play Image Animation")}),(0,zn.jsxs)(To.Z,{name:"animationPolicy",value:this.state.animationPolicy,onChange:this.onSelected,children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[ZU,(0,zn.jsx)("span",{children:(0,W.Z)("command","Loop")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[TU,(0,zn.jsx)("span",{children:(0,W.Z)("Once")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[EU,(0,zn.jsx)("span",{children:(0,W.Z)("radio","Never")})]})})]})]})})})}}const NU=kU,_U=[Z.kPageImageLoading],PU=I.Z.getEventHandler;var MU=(0,zn.jsx)("input",{type:"radio",value:"always"}),DU=(0,zn.jsx)("input",{type:"radio",value:"never"}),OU=(0,zn.jsx)("input",{type:"radio",value:"cache"});class jU extends Un.Component{render(){return(0,zn.jsx)(tb.Z,{filter:this.props.filter,children:(0,zn.jsx)("div",{className:"setting-group",children:(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("page settings","Load Images")}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Image loading setting for new tabs.")}),(0,zn.jsxs)(To.Z,{name:"imageLoadingPolicy",value:this.props.prefValues[Z.kPageImageLoading],onChange:PU(Z.kPageImageLoading),children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[MU,(0,zn.jsx)("span",{children:(0,W.Z)("radio","Always")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[DU,(0,zn.jsx)("span",{children:(0,W.Z)("radio","Never")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[OU,(0,zn.jsx)("span",{children:(0,W.Z)("radio","Cached")})]})})]})]})})})}}const LU=(0,zd.Z)(jU,_U),RU=[Z.kWebpagesPictureInPictureButtonEnabled],BU=I.Z.getEventHandler;class FU extends Un.Component{render(){return(0,zn.jsx)(tb.Z,{filter:this.props.filter,children:(0,zn.jsx)("div",{className:"setting-group unlimited",children:(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.props.prefValues[Z.kWebpagesPictureInPictureButtonEnabled],onChange:BU(Z.kWebpagesPictureInPictureButtonEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("Picture-in-Picture Button on Videos")})]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("This setting requires a restart to take effect.")})]})})})}}const WU=(0,zd.Z)(FU,RU),UU=[Z.kNetworkPredictionOptions];function VU(e){const t=(0,Eo.Z)(UU);return(0,zn.jsx)(tb.Z,{filter:e.filter,children:(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Prefetch")}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Follow webpage suggestions to prefetch DNS, and to preload resources and documents early.")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:2!==t[Z.kNetworkPredictionOptions],onChange:e=>{const{checked:t}=e.currentTarget;I.Z.set(Z.kNetworkPredictionOptions,t?0:2)}}),(0,zn.jsx)("span",{children:(0,W.Z)("Prefetch Resources")})]})})]})})}const HU=[Z.kWebpagesAllowSelectionInLinks],GU=I.Z.getEventHandler;class KU extends Un.Component{render(){return(0,zn.jsx)(tb.Z,{filter:this.props.filter,children:(0,zn.jsx)("div",{className:"setting-group unlimited",children:(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.props.prefValues[Z.kWebpagesAllowSelectionInLinks],onChange:GU(Z.kWebpagesAllowSelectionInLinks)}),(0,zn.jsx)("span",{children:(0,W.Z)("Allow Text Selection in Links")})]})})})})}}const zU=(0,zd.Z)(KU,HU),$U=[Z.kWebpagesSmoothScrollingEnabled],YU=I.Z.getEventHandler;class XU extends Un.Component{render(){return(0,zn.jsx)(tb.Z,{filter:this.props.filter,children:(0,zn.jsx)("div",{className:"setting-group unlimited",children:(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.props.prefValues[Z.kWebpagesSmoothScrollingEnabled],onChange:YU(Z.kWebpagesSmoothScrollingEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("Smooth Scrolling")})]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("This setting requires a restart to take full effect.")})]})})})}}const QU=(0,zd.Z)(XU,$U),qU=I.Z.getEventHandler,JU=[Z.kWebpagesTabFocusesLinks];var eV=(0,zn.jsx)("input",{type:"radio",value:"false"}),tV=(0,zn.jsx)("input",{type:"radio",value:"true"});class sV extends Un.Component{render(){return(0,zn.jsx)(tb.Z,{filter:this.props.filter,children:(0,zn.jsx)("div",{className:"setting-group",children:(0,zn.jsxs)("div",{className:"setting-single",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Webpage Focus")}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("This setting takes effect in new tabs or windows only.")}),(0,zn.jsxs)(To.Z,{name:"tabToFocusSetting",className:"setting-single",value:this.props.prefValues[Z.kWebpagesTabFocusesLinks],onChange:qU(Z.kWebpagesTabFocusesLinks,"convert"),children:[(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[eV,(0,zn.jsx)("span",{children:(0,W.Z)("Focus Forms Only")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{className:"setting-single",children:[tV,(0,zn.jsx)("span",{children:(0,W.Z)("Focus All Controls and Links")})]})})]})]})})})}}const nV=(0,zd.Z)(sV,JU),iV=[Z.kWebpagesTranslateSelectionButtonEnabled],aV=I.Z.getEventHandler;class oV extends Un.Component{render(){return(0,zn.jsx)(tb.Z,{filter:this.props.filter,children:(0,zn.jsx)("div",{className:"setting-group unlimited",children:(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.props.prefValues[Z.kWebpagesTranslateSelectionButtonEnabled],onChange:aV(Z.kWebpagesTranslateSelectionButtonEnabled)}),(0,zn.jsx)("span",{children:(0,W.Z)("Show Selected Text Translate Button")})]})})})})}}const rV=(0,zd.Z)(oV,iV),lV=[...dU,...bU,...xU,..._U,...RU,...UU,...HU,...$U,...JU,...iV,...gU];function dV(e){return(0,zn.jsxs)(Vy.Z,{categoryTitle:(0,W.Z)("Webpages"),filter:e.filter,children:[(0,zn.jsx)(QU,{filter:e.filter}),(0,zn.jsx)(SU,{filter:e.filter}),(0,zn.jsx)(WU,{filter:e.filter}),(0,zn.jsx)(zU,{filter:e.filter}),(0,zn.jsx)(rV,{filter:e.filter}),(0,zn.jsx)(vU,{filter:e.filter}),(0,zn.jsx)(nV,{filter:e.filter}),(0,zn.jsx)(yU,{filter:e.filter}),(0,zn.jsx)(NU,{filter:e.filter}),(0,zn.jsx)(LU,{filter:e.filter}),(0,zn.jsx)(VU,{filter:e.filter}),(0,zn.jsx)(pU,{filter:e.filter})]})}const cV=Un.memo(dV),hV=[Z.kWebpagesSpatialNavigationEnabled],uV=[...TW,...BW,...HW,...nU,...lV,...hV];function pV({filter:e,category:t}){const{filter:s,name:n}=Un.useMemo((()=>({filter:e,name:t.title})),[e,t.title]),i=nI({filter:s,prefPaths:uV,name:n});return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsx)(cV,{filter:e})}),(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsx)(oU,{filter:e})}),(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsx)(sU,{prefs:!0,filter:e})}),(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsx)(MW,{filter:e})}),(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsx)(UW,{filter:e})}),i]})}const gV=Un.memo(pV),mV=vs.jk.settingCategories,fV="http://example.com/?path=",vV=[Z.kThemesPreview,Z.kThemesUser,Z.kSettingsMonoIcons,Z.kWorkspacesEnabled];function bV(e){const t=(0,Ar.DP)(e);return t.permissionorigin?t.permissionorigin:""}function CV(e){const t=(0,Ar.DP)(e),s=t.query,n=s?"all":t.path,i=n?n.split("/"):[];let a;if(!s&&i.length>0&&mV[i[0]]&&(a=mV[i[0]],i.length>1)){const e=i.join("_");a=mV[e]}return a||(s?mV.all:mV.general)}var wV=(0,zn.jsx)("svg",{className:"guest-intro-background",viewBox:"0 0 1244 860",children:(0,zn.jsx)("path",{fill:"url(#guest-intro-bg-gradient)",d:"M0 0h153.513c16.141 27.93 32.15 55.734 47.912 83.11 16.086 27.94 32.722 56.832 49.076 85.128 11.01 19.031 22.079 38.316 32.781 56.967 25.186 43.883 51.228 89.259 77.402 132.848 33.382 55.651 75.894 82.121 137.77 85.829 3.205.192 6.454.288 9.655.288 39.673 0 78.14-14.461 108.316-40.722 21.644-18.834 48.687-52.291 54.604-104.667.749-6.654 1.357-13.708 1.855-19.573-1.07-29.74-6.476-52.92-17.294-74.518C622.935 139.46 612.708 67.99 625.087 0h136.676C747.1 44.93 749.845 96.364 774.32 145.251c20.839 41.6 30.654 85.7 31.485 138.023-.568 6.192-1.472 18.273-2.83 30.356-17.572 155.524-149.172 263.318-294.866 263.318-5.816 0-11.67-.173-17.526-.521C382.84 569.97 301.9 518.174 246.822 426.358c-38.015-63.313-74.255-127.68-111.253-191.634C90.359 156.507 45.49 78.062 0 0zm1113.47 0H1244v140.1c-7.496 27.86-18.849 54.995-34.031 81.275a1299530.57 1299530.57 0 0 1-170.255 294.799A1223193.145 1223193.145 0 0 0 841.018 860.24H687.72c135.675-235.123 271.527-470.147 407.26-705.25 22.311-38.621 31.22-79.696 25.368-124.548A170.12 170.12 0 0 0 1113.471 0z"})});function yV(e){return(0,zn.jsxs)("div",{className:"guest-intro",children:[wV,(0,zn.jsxs)("div",{className:"guest-intro-content",children:[(0,zn.jsx)("h1",{children:(0,W.Z)("Settings Unavailable")}),(0,zn.jsx)("p",{children:(0,W.Z)("Settings are not available in guest windows.")}),(0,zn.jsx)("p",{children:(0,zn.jsx)("a",{tabIndex:0,href:BC,onClick:t=>FC(e.windowId,t),children:(0,W.Z)("Learn more about Guest Profiles")})})]})]})}var xV=(0,zn.jsx)("img",{srcSet:"chrome://theme/IDR_PRODUCT_LOGO_16 1x,chrome://theme/IDR_PRODUCT_LOGO_16@2x 2x",width:"16",height:"16",alt:""}),IV=(0,zn.jsx)(qk,{});function AV(e){const t=Un.useContext(oi.Z),s=(0,Eo.Z)(vV),n=Un.useRef(),i=Un.useRef(),a=Un.useRef(),o=Un.useRef(),r=Un.useRef(s[Z.kThemesPreview].length),[l,d]=Un.useState(CV(e.url)),[h,u]=Un.useState(bV(e.url)),[p,g]=Un.useState((m=e.url,(0,Ar.DP)(m)?.search||""));var m;const[f,v]=Un.useState(void 0),b=Un.useDeferredValue(p.length>=2?p:"");Un.useEffect((()=>{e.url.startsWith(fV)||d(CV(e.url))}),[e.url]);const C=Un.useCallback((e=>{const s=function(e){const t=(0,Ar.DP)(e);return t.scroll?t.scroll:""}(e),n=bV(e);if(!s&&!n)return;const a=i.current?.focusRef.current;if(a instanceof t.HTMLElement){if(!s)return n?(u(n),a.querySelector("[data-anchor='permissions']")?.scrollIntoView(!0),void a.querySelector(".setting-site-permissions .item.item-selected")?.focus()):void 0;a.querySelector(`[data-anchor='${s}']`)?.scrollIntoView(!0)}}),[t.HTMLElement]),w=Un.useCallback((()=>l?(0,W.Z)("Vivaldi Settings: $1",[l.title]):(0,W.Z)("Vivaldi Settings")),[l]);Un.useEffect((()=>{e.isActive?(n.current?.focus(),n.current=void 0):n.current=t.document.activeElement??void 0}),[e.isActive,t.document.activeElement]),Un.useEffect((()=>{setTimeout((()=>C(e.url)),200)}),[e.url,C]),Un.useEffect((()=>()=>{0}),[t,e.url]),Un.useEffect((()=>{const{document:e,vivaldiWindowId:s}=t;fe.ZP.isSettings(s)&&(e.title=w()),S()}),[l,t,w]);const y=s[Z.kThemesUser],x=s[Z.kThemesPreview];Un.useEffect((()=>{const s=x.length;if((r.current??-1)<s){const{name:e,id:s}=x[0];fe.ZP.isSettings(t.vivaldiWindowId)&&fe.ZP.isActive(t.vivaldiWindowId)?v({themeName:e,isUpdate:y.findIndex((e=>e.id===s))>-1}):I()}r.current=s,C(e.url)}),[t.vivaldiWindowId,y,x,e.url,C]);const I=()=>v(void 0),A=e=>l&&l===mV.all||l&&l===e,S=()=>{o.current&&(o.current.scrollTop=0)},T=e=>{const s=t.vivaldiWindowId;fe.ZP.isSettings(s)?d(mV[e]):c.ZP.openURL(s,vs.jk.internalUrl("settings",e),{inCurrent:!0})},E=Un.useCallback((e=>{const t=Qe.Z.keyComboFromEvent(e.nativeEvent);if(!t)return;"ctrl+f"===t&&a.current?.focus()}),[]);return fe.ZP.isGuest()?(0,zn.jsx)(yV,{windowId:t.vivaldiWindowId}):(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("header",{className:"settings-header",children:[xV,(0,zn.jsx)("h1",{children:w()})]}),(0,zn.jsxs)(Zo.Z,{ref:i,focusName:"focus_settings",className:Gn()("vivaldi-settings",{"mono-icons":s[Z.kSettingsMonoIcons]}),onKeyDown:E,children:[(0,zn.jsx)(hL,{focusRef:a,filter:p,onFilterChange:e=>{g(e),l!==mV.all&&T("all")},selectedCategory:l,onCategorySelected:e=>{g(""),T(e)}}),l&&(0,zn.jsxs)("div",{className:"settings-content",ref:o,children:[l===mV.general&&IV,A(mV.general)&&(0,zn.jsx)(O_,{filter:b,category:l}),A(mV.sync)&&(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsx)(vR,{url:e.url,category:l,filter:b})}),A(mV.appearance)&&(0,zn.jsx)(YI,{filter:b,category:l}),A(mV.themes)&&(0,zn.jsx)(SW,{filter:b,category:l}),A(mV.startpage)&&(0,zn.jsx)(RL,{category:l,filter:b}),A(mV.tabs)&&(0,zn.jsx)(SF,{category:l,filter:b,isWorkspacesEnabled:s[Z.kWorkspacesEnabled]}),A(mV.panel)&&(0,zn.jsx)(xD,{category:l,filter:p}),A(mV.addressbar)&&(0,zn.jsx)(mI,{category:l,filter:b}),A(mV.bookmarks)&&(0,zn.jsx)(HA,{filter:b,category:l}),A(mV.search)&&(0,zn.jsx)(lL,{category:l,filter:b}),A(mV.qc)&&(0,zn.jsx)(Gj,{filter:b,category:l}),A(mV.keyboard)&&(0,zn.jsx)(uP,{filter:b,category:l,view:"editable"}),A(mV.mouse)&&(0,zn.jsx)(rD,{filter:b,category:l}),A(mV.privacy)&&(0,zn.jsx)(jj,{filter:b,category:l,origin:h}),A(mV.downloads)&&(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsx)(sN,{category:l,filter:b})}),A(mV.webpages)&&(0,zn.jsx)(gV,{filter:b,category:l}),A(mV.network)&&(0,zn.jsx)(pD,{category:l,filter:b}),A(mV.mail)&&(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsx)($M,{filter:b})}),A(mV.calendar)&&(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsx)(zk,{filter:b})}),A(mV.feeds)&&(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsx)(UN,{filter:b})}),Fn.Z.isEnabled("chat")&&A(mV.chat)&&(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsx)($k,{filter:b})}),A(mV.biscuit)&&(0,zn.jsx)("section",{className:"setting-section",children:(0,zn.jsx)(TA,{filter:b})}),!1]}),f&&(0,zn.jsx)(Vd,{onClose:I,themeName:f.themeName,isUpdate:f.isUpdate})]})]})}const SV=Un.memo(AV);class ZV{#Rt;#Bt=0;#Ft=(0,qe.aV)();#Wt=new Event("undoredo");#Ut=!0;#Vt=!0;constructor(e=500){if(e<1)throw new Error("Stack size must be greater than 0");this.#Rt=e}record(e){this.#Ft=this.#Ft.slice(this.#Bt,this.#Rt-1+this.#Bt).unshift(e),this.#Bt=0,this._onChange()}clear(){this.#Ft=(0,qe.aV)(),this.#Bt=0,this._onChange()}undo(){this.#Ut||(this.#Ft.get(this.#Bt)?.undo(),this.#Bt+=1,this._onChange(),document.dispatchEvent(this.#Wt))}redo(){this.#Vt||(this.#Bt-=1,this.#Ft.get(this.#Bt)?.redo(),this._onChange(),document.dispatchEvent(this.#Wt))}_onChange(){this.#Ut=this.#Bt===this.#Ft.size,this.#Vt=0===this.#Bt}canUndo(){return!this.#Ut}canRedo(){return!this.#Vt}}class TV{#Ht;#Gt;constructor(e,t,s){this.#Ht=e,this.#Gt=t,this._updateFunction=s}undo(){this._updateFunction(this.#Ht)}redo(){this._updateFunction(this.#Gt)}}var EV=s(64626);class kV{cut=(e,t)=>ne.Z.cut(e,t);copy=(e,t)=>ne.Z.copy(e,t);constructor(){this.undoStack=new ZV}undo(){this.undoStack.undo()}redo(){this.undoStack.redo()}canUndo(){return this.undoStack.canUndo()}canRedo(){return this.undoStack.canRedo()}clearUndoStack(){this.undoStack.clear()}async paste(e,t,s){const n=g.Z.getCutIds(),i=n.length>0?g.Z.getItemById(n[0]).parentId:"",a=await ne.Z.paste(e,t,s),{isCut:o,ids:r}=a;return this.undoStack.record(new TV({sourceId:i,isCut:o,ids:r},{sourceId:i,targetId:t,isCut:o,ids:r},(e=>{e.targetId?ne.Z.move(e.ids,e.targetId,0):o?ne.Z.move(e.ids,e.sourceId,0):ne.Z.remove(e.ids)}))),a}async create(e){const t=await n.Z.bookmarks.create(e);if(t)return this.undoStack.record(new TV({createdId:t.id,remove:!0},{createdId:t.id,parentId:t.parentId},(e=>{e.remove?ne.Z.remove([e.createdId]):ne.Z.move([e.createdId],e.parentId||"",t.index||0)}))),t}async createWithPromise(e,t,s){const n=await ne.Z.createWithPromise(e,t,s),i=(Array.isArray(n)?n:[n]).map((e=>e.id));return this.undoStack.record(new TV({createdIds:i,parentId:t,index:s,remove:!0},{createdIds:i,parentId:t,index:s},(e=>{e.remove?ne.Z.remove(e.createdIds):ne.Z.move(e.createdIds,e.parentId,e.index||0)}))),n}update(e,t){const s=g.Z.getItemById(e);return n.Z.bookmarks.update(e,t).then((i=>(this.undoStack.record(new TV({nodeId:e,item:(0,EV.Z)(s,Object.keys(t))},{nodeId:e,item:t},(e=>{n.Z.bookmarks.update(e.nodeId,e.item)}))),i)))}async mergeWithPromise(e,t,s){const n=(await this.createWithPromise([{parentId:e.parentId,children:[],title:s}],e.parentId||"",t.index))[0].id;return await this.move([e.id,t.id],n,0),n}async move(e,t,s){const n=e.length>0?g.Z.getItemById(e[0]).parentId:"",i=await ne.Z.move(e,t,s);return this.undoStack.record(new TV({ids:e,parentId:n,index:0},{ids:e,parentId:t,index:s},(e=>{ne.Z.move(e.ids,e.parentId,e.index)}))),i}async reorder(e,t){const s={nodeId:t,order:g.Z.getItemById(t)?.children?.map((e=>e.id))??[]},n=await ne.Z.reorder(e,t);return this.undoStack.record(new TV(s,{nodeId:t,order:e},(e=>{ne.Z.reorder(e.order,e.nodeId)}))),n}async remove(e=[]){if(0===e.length)return;const t={removed:e,parentId:g.Z.getItemById(e[0]).parentId};await ne.Z.remove(e),this.undoStack.record(new TV(t,{ids:e},(e=>{e.removed?ne.Z.move(e.removed,e.parentId||"",0):ne.Z.remove(e.ids)})))}async duplicate(e,t,s){const n=await ne.Z.duplicate(e,t,s);return this.undoStack.record(new TV({ids:n,remove:!0},{ids:n,parentId:t,index:s},(e=>{e.remove?ne.Z.remove(e.ids):ne.Z.move(e.ids,e.parentId,e.index)}))),n}async createBookmarks(e,t,s){const n=await ne.Z.createBookmarks(e,t,s,"none");return this.undoStack.record(new TV({ids:n,remove:!0},{ids:n,parentId:t,index:s},(e=>{e.remove?ne.Z.remove(e.ids):ne.Z.move(e.ids,e.parentId,e.index)}))),n}onDropEvent(e,t,s,n){if(e.dataTransfer.types.includes(Jn.yR)){const i=JSON.parse(e.nativeEvent.dataTransfer.getData(Jn.yR));Jn.ZP.isCopyModifierPressed(e)||n&&n.disableMove?this.duplicate(i,t,s):this.move(i,t,s)}else Jn.ZP.getUrlsFromEventPromise(e,!0).then((e=>this.createBookmarks(e,t,s)))}}class NV extends Un.PureComponent{_imageElementKey=0;_reloadRetryCount=0;state={titleAsFallback:!1};componentDidUpdate(e){e.src!==this.props.src&&(this.setState({titleAsFallback:!1}),this.finishErrorRecovery())}componentWillUnmount(){this.finishErrorRecovery()}finishErrorRecovery(){this._reloadRetryCount=0,void 0!==this._reloadRetryTimer&&(clearTimeout(this._reloadRetryTimer),this._reloadRetryTimer=void 0)}onImageLoad=()=>{this.setState({titleAsFallback:!1})};onImageError=()=>{if(this.props.isFolder||this.setState({titleAsFallback:!0}),void 0!==this._reloadRetryTimer)return;if(this._reloadRetryCount>=4)return void(4===this._reloadRetryCount&&(this._reloadRetryCount=5,this.props.onImageLoadError&&this.props.onImageLoadError(this.props.src)));this._reloadRetryCount++;const e=1e3*Math.pow(2,this._reloadRetryCount);this._reloadRetryTimer=setTimeout(this.onTryReload,e)};onTryReload=()=>{this._reloadRetryTimer=void 0,this._imageElementKey++,this.forceUpdate()};_getTitle=()=>{if(void 0!==this.props.pageId){const e=Ze.ZP.getPageById(this.props.pageId);return e&&!vs.jk.isInternalUrl(e.url)&&(0,Ar.C3)(e.url)?new URL(e.url).hostname:vs.jk.getDisplayTitleByUrl(e?.url??"","")}return"---"===this.props.title?"":this.props.title};render(){const e=this.props.className||"thumbnail-image";if(this.props.src){const t=this.state.titleAsFallback?{gridTemplateRows:"auto 0px",backgroundColor:this.props.backgroundColor??"var(--colorBgDarker)"}:{},s=this.props.backgroundColor?Be()(this.props.backgroundColor).luminance()>nC.$J?nC.E5:nC.Cj:"var(--colorFg)";return(0,zn.jsxs)("div",{className:e,style:t,onPointerEnter:this.props.onPointerEnter,onPointerLeave:this.props.onPointerLeave,onPointerDown:this.props.onPointerDown,onPointerUp:this.props.onPointerUp,children:[this.state.titleAsFallback&&(0,zn.jsx)("span",{style:{color:s},children:this._getTitle()}),(0,zn.jsx)("img",{width:"100%",height:"auto",src:this.props.src,onError:this.onImageError,onLoad:this.onImageLoad},this._imageElementKey)]})}if(this.props.title&&!this.props.isFolder){const t=this.props.backgroundColor?Be()(this.props.backgroundColor).luminance()>nC.$J?nC.E5:nC.Cj:"var(--colorFg)";return(0,zn.jsx)("div",{className:e,style:{backgroundColor:this.props.backgroundColor??"var(--colorBgDarker)"},onPointerEnter:this.props.onPointerEnter,onPointerLeave:this.props.onPointerLeave,onPointerDown:this.props.onPointerDown,onPointerUp:this.props.onPointerUp,children:(0,zn.jsx)("span",{style:{color:t},children:this._getTitle()})})}return(0,zn.jsx)("div",{className:e,onPointerEnter:this.props.onPointerEnter,onPointerLeave:this.props.onPointerLeave,onPointerDown:this.props.onPointerDown,onPointerUp:this.props.onPointerUp,dangerouslySetInnerHTML:this.props.isFolder?{__html:Kn.feS}:{__html:Kn.$B$}})}}const _V=NV;var PV=s(34155);const MV=[Z.kBookmarksBarVisible],DV=Object.freeze({bookmarkbar:!1,description:"",id:"",nickname:"",partner:"",themeColor:"",speeddial:!1,thumbnail:"",title:"",trash:!1});var OV=(0,zn.jsx)("input",{type:"submit",hidden:!0});class jV extends Un.Component{static contextType=oi.Z;refTitle=Un.createRef();refUrlField=Un.createRef();_isCreating=!1;_isMounted=!1;_disableSaveOnBlur=!1;_id=crypto.randomUUID();_pageContext={};state={item:DV,unmodifiedItem:DV,nickError:!1};componentDidMount(){this._isMounted=!0,wg.addListener(this._onUrlFieldStoreChanged,(e=>e.get(this._id))),g.Z.addListener(this.onBookmarkStoreChange)}componentWillUnmount(){wg.removeListener(this._onUrlFieldStoreChanged),g.Z.removeListener(this.onBookmarkStoreChange),this._save(),PV.nextTick((()=>{vg.Z.reset(this._id),this.refUrlField.current?.hideDropdown()})),Ma.unlinkBookmarkComponent(this),this._isMounted=!1}setIsCreating=e=>{this._isCreating=e};getIsCreating=()=>this._isCreating;_onUrlFieldStoreChanged=()=>{const{typedUrl:e}=wg.getUrlfieldState(this._id);this.setState((t=>({item:{...t.item,url:e??""}})))};onSubmit=()=>{this._save(),this.props.onFocusTree()};_save=async()=>{const{item:e,unmodifiedItem:t}=this.state;if(e===t||g.Z.isTrashed(e)||g.Z.isSeparator(e)||this.state.nickError||""===e.id)return;const{autocompleteValue:s,typedUrl:i}=wg.getUrlfieldState(this._id),a=s||i||t.url,o=Jn.ZP.verifyForUpdate({title:e.title,url:"string"==typeof a?a.trim():a,nickname:e.nickname,description:e.description,speeddial:e.speeddial},g.Z.isFolder(e));return n.Z.bookmarks.update(e.id,o)};_saveOnBlur=()=>{!1===this._disableSaveOnBlur&&this._save().then(this.setIsCreating(!1))};_updateStateWithItem=e=>{const t=e.id===this.state.item.id;return new Promise((s=>{this.setState((s=>{if(!t||e.id===s.item.id)return{item:{...e,url:e.url===Aa.p?"":e.url},unmodifiedItem:e,nickError:!1}}),s)}))};handleKeyPress=e=>{if(e.stopPropagation(),"Escape"===e.key){e.preventDefault(),vg.Z.reset(this._id),this.refUrlField.current?.hideDropdown();const t=this.state.item.id;if(!t)return;if(this.getIsCreating())this.setIsCreating(!1),this._updateStateWithItem(DV).then(this.props.onCancel(t,!0));else{const e=g.Z.getItemById(t);e?this._updateStateWithItem(e).then((()=>this.props.onCancel(t,!1))):this.props.onCancel(t,!1)}}};focusUrlField=()=>{this.refUrlField.current&&(0,mg.x0)(this.context,this._id)};focusTitleField=()=>{this.refTitle.current&&this.refTitle.current.focus()};handleFocus=e=>{const{HTMLInputElement:t}=this.context;e.target instanceof t&&e.target.select()};handleUpdateThumbnail=e=>{if(e.stopPropagation(),g.Z.isFolder(this.state.item))return void n.Z.bookmarks.update(this.state.item.id,{thumbnail:""});const t=Jn.ZP.verifyForUpdate({url:this.state.item.url},!1);t.url&&Ma.updateForBookmark(this.state.item.id,t.url)};onBookmarkStoreChange=()=>{const{item:e}=this.state;if(""!==e.id){const t=g.Z.getItemById(e.id);t&&t.id===e.id&&this._updateStateWithItem(t)}};handleSetCustomThumbnail=e=>{e?.stopPropagation?.(),re.Z.utilities.selectLocalImage({windowId:this.context.vivaldiWindowId,title:(0,W.Z)("Select Custom Image"),thumbnailBookmarkId:this.state.item.id})};checkChangeSpeeddial=()=>{this.setState((e=>({item:{...e.item,speeddial:!e.item.speeddial}})),(()=>{this._save()}))};isBookmarkBarChecked=()=>g.Z.getBookmarkBarFolderId()===this.state.item.id&&this.props.prefValues[Z.kBookmarksBarVisible];checkChangeBookmarkBar=()=>{ne.Z.setBookmarkBarFolderAndToggleVisibility(this.state.item.id)};onInputChange=(e,t)=>{this.setState((s=>({item:{...s.item,[e]:t.target.value}}))),"nickname"===e&&(g.Z.hasNickname(t.target.value)?this.setState({nickError:!0}):this.setState({nickError:!1}))};setItem=e=>{this._save().then((()=>{if(this._isMounted){const e=this.props.getSelectedItem();this._setItem(e??DV)}}))};_setItem=e=>(vg.Z.reset(this._id),this.refUrlField.current?.hideDropdown(),this._updateStateWithItem(e).then((()=>{this.getIsCreating()&&(this._disableSaveOnBlur=!0,g.Z.isFolder(this.state.item)?this.focusTitleField():g.Z.isTrashed(this.state.item)||this.focusUrlField(),this._disableSaveOnBlur=!1)})));render(){const{item:e,unmodifiedItem:t}=this.state,s=g.Z.isFolder(e),n=Ma.linkAndQueryUpdatingBookmark(this,this.state.item.id),i=V()(e.dateAdded).format("LLL"),a=!e.id||g.Z.isSeparator(e)||g.Z.isTrashed(e)||g.Z.isMobileFolder(e),o=this.state.item.title?this.state.item.title:this.state.item.url?re.Z.utilities.urlToThumbnailText(this.state.item.url):"";return(0,zn.jsx)("div",{className:"manager-editor",onKeyDown:this.handleKeyPress,children:(0,zn.jsxs)("form",{className:"addbookmark-cardwrapper cardview",onSubmit:this.onSubmit,children:[(0,zn.jsxs)("div",{className:"upper-half",children:[(0,zn.jsxs)("div",{className:"title-and-address",children:[(0,zn.jsx)("div",{className:"fieldset",children:(0,zn.jsx)("input",{className:"cardview title",ref:this.refTitle,placeholder:(0,W.Z)("Title"),onChange:this.onInputChange.bind(this,"title"),value:e.title,title:e.title,disabled:a,type:"text",onFocus:this.handleFocus,onBlur:this._saveOnBlur})}),(0,zn.jsx)("div",{className:s?"fieldset collapse":"fieldset",children:(0,zn.jsx)(ym,{ref:this.refUrlField,pageId:this._id,pageContext:this._pageContext,autocompletionEnabled:!0,typedHistoryEnabled:!1,autoFocus:!1,className:"cardview address",disabled:a||s,displayUrl:t.url===Aa.p?"":t.url??"",typedUrl:this.state.item.url,handleDrop:!0,onBlur:this._saveOnBlur,onFocus:this.handleFocus,onKeyPress:this.handleKeyPress,placeholder:(0,W.Z)("Address"),title:e.url??(0,W.Z)("Enter webpage address"),inputId:this._id,urlFragments:null})}),(0,zn.jsx)("div",{className:"fieldset",children:(0,zn.jsx)("input",{className:"cardview nickname",placeholder:(0,W.Z)("Nickname"),value:e.nickname,title:e.nickname,onChange:this.onInputChange.bind(this,"nickname"),type:"text",disabled:a,onFocus:this.handleFocus,onBlur:this._saveOnBlur})})]}),(0,zn.jsxs)("div",{className:"preview",title:`${o}\n${this.state.item.url??""}`,children:[(0,zn.jsx)(_V,{isFolder:s,src:e.thumbnail,backgroundColor:this.state.item.themeColor||void 0},e.id),!a&&(0,zn.jsxs)("div",{className:"thumb-controls",children:[(0,zn.jsx)("button",{type:"button",tabIndex:"-1",className:Gn()({circular:!0,"update-thumbnail":!0,updating:n}),title:(0,W.Z)("Update thumbnail"),onClick:this.handleUpdateThumbnail,dangerouslySetInnerHTML:{__html:Kn.GO5.medium}}),(0,zn.jsx)("button",{type:"button",tabIndex:"-1",onClick:this.handleSetCustomThumbnail,className:Gn()({circular:!0,"set-custom-thumbnail":!0}),title:(0,W.Z)("Select custom thumbnail"),dangerouslySetInnerHTML:{__html:Kn.md4.medium}})]})]})]}),this.state.nickError&&(0,zn.jsx)("div",{className:"fieldset",children:(0,zn.jsx)(fa,{type:"warning",children:(0,W.Z)("This nickname is already in use.")})}),(0,zn.jsxs)("div",{className:"lower-half",children:[(0,zn.jsx)("div",{className:"fieldset resizable",children:(0,zn.jsx)("textarea",{className:"description",placeholder:(0,W.Z)("Description"),value:e.description,onChange:this.onInputChange.bind(this,"description"),type:"text",disabled:a,onFocus:this.handleFocus,onBlur:this._saveOnBlur})}),(0,zn.jsxs)("div",{className:"speeddial-bookmarksbar",children:[(0,zn.jsx)("div",{className:s?"fieldset center cardview":"fieldset center collapse",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{className:"cardview",disabled:a||!s,checked:e.speeddial,onChange:this.checkChangeSpeeddial,onFocus:this.handleFocus,type:"checkbox"}),(0,zn.jsx)("span",{children:(0,W.Z)("Speed Dial")})]})}),(0,zn.jsx)("div",{className:s?"fieldset center cardview":"fieldset center collapse",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{className:"cardview",disabled:a||!s,checked:this.isBookmarkBarChecked(),onChange:this.checkChangeBookmarkBar,onFocus:this.handleFocus,type:"checkbox"}),(0,zn.jsx)("span",{children:(0,W.Z)("Bookmark Bar")})]})})]}),e.dateAdded&&(0,zn.jsxs)("div",{className:"fieldset",children:[(0,zn.jsx)("div",{className:"meta-icon date fieldset",dangerouslySetInnerHTML:{__html:Kn.V_c}}),(0,zn.jsx)("span",{className:"dateCreated bookmark",title:(0,W.Z)("Date created"),children:i})]})]}),OV]})})}}const LV=(0,zd.Z)(jV,MV);var RV=s(34155);function BV(e){return!!e&&g.Z.isTrashed(e)}function FV(e){return!e.trash&&!KV(e)}function WV(e){return!BV(e)}function UV(e,t){const s=QV(t)?t.title:vs.jk.getHoverUrl(g.Z.getUrlByNode(t));h.Z.setStatus(e,s)}function VV(e){h.Z.clearStatus(e)}function HV(e,t){t.button===ai.Z.kCenter&&(t.preventDefault(),t.stopPropagation())}function GV(e){return e&&Boolean(e.trash)}function KV(e){return e&&g.Z.isMobileFolder(e)}function zV(e,t){n.Z.bookmarks.update(e,{title:t})}function $V(e){return Boolean(e.speeddial)}function YV(e){return!GV(e)&&!KV(e)}function XV(e){return!!e.children&&e.children.length>0}function QV(e){return!(!e||!e.children&&e.url)}function qV(e){const{columns:t,level:s,isExpanded:n,node:i}=e,{onExpandClick:a,inManager:o,fullView:r,windowId:l}=e,d=g.Z.isSeparator(i),c=(s+1)*Ni+"px";if(d){const e=t?t.findIndex((e=>"title"===e.id)):0,s=o&&0===e||!o?c:0;return(0,zn.jsx)("label",{"data-parent":i.parentId,children:(0,zn.jsx)("hr",{style:{marginLeft:s},className:"separator"})},"0")}return r?t.map((t=>{switch(t.id){case"title":return(0,zn.jsx)(Di,{node:i,inlineEditText:e.inlineEditText,onExpandClick:a,inManager:o,fullView:r,isExpanded:e.isExpanded,level:s,onChange:e.onChange,onBlur:e.onBlur,onFocus:e.onFocus,showBadge:e.showBadge,onMouseEnter:()=>UV(l,i),onMouseLeave:()=>VV(l)},i.id);case"url":const n=(0,Kg.dO)(g.Z.getUrlByNode(i));return(0,zn.jsx)("label",{children:XV(i)&&r?(0,zn.jsx)("span",{className:"secondary",children:(0,W.Z)("$1 item","$1 items",[i.children.length])}):(0,zn.jsx)(lm,{windowId:l,urlFragments:n,displayUrl:i.url,shouldShowFullUrl:!0,onGoToPath:nr.Z,onBaseDomainObscured:nr.Z,shouldHighlightBaseDomain:!1,rawDisplay:!0})},t.id);case"nickname":return(0,zn.jsx)("label",{children:(0,zn.jsx)("span",{children:i.nickname})},t.id);case"description":return(0,zn.jsx)("label",{children:(0,zn.jsx)("span",{children:i.description})},t.id);case"dateAdded":return(0,zn.jsx)("label",{className:"right-aligned",children:(0,zn.jsx)("span",{children:V()(i.dateAdded).format("ll")})},t.id)}})):(0,zn.jsx)(Di,{node:i,inlineEditText:e.inlineEditText,onExpandClick:a,inManager:o,fullView:r,isExpanded:n,level:s,onChange:e.onChange,onBlur:e.onBlur,onFocus:e.onFocus,showBadge:e.showBadge,onMouseEnter:()=>UV(l,i),onMouseLeave:()=>VV(l)},i.id)}class JV extends Un.PureComponent{refTreeList=Un.createRef();static contextType=oi.Z;winId=this.context.vivaldiWindowId;state={nodes:[],cutIds:[],showBadge:A.Z.get(Z.kPanelsShowFolderBadge)};_isMounted=!1;_hasSeenSelection=!1;expandModel={};componentDidMount(){this._isMounted=!0,g.Z.addListener(this._onStoreChange),A.Z.addListener(Z.kPanelsShowFolderBadge,this._onBadgeChanged),this.onFilterChange(this.props.filter,this._monitorInitialSelection)}componentDidUpdate(e,t){if(this.props.filter!==e.filter){const t=this.props.filter.length,s=e.filter.length;0===s&&t>0&&this.refTreeList.current&&(this.expandModel=this.refTreeList.current.getExpandModel()),this.onFilterChange(this.props.filter,(e=>{t>0?RV.nextTick((()=>{this.refTreeList.current?.expandAllExcept(e)})):s>0&&0===t&&RV.nextTick((()=>{this.refTreeList.current?.expandWithModel(this.expandModel)}))}))}0!==this.state.nodes.length&&t.nodes!==this.state.nodes&&RV.nextTick((()=>{this.onBookmarksUpdatedIsEmpty()}))}componentWillUnmount(){A.Z.removeListener(Z.kPanelsShowFolderBadge,this._onBadgeChanged),g.Z.removeListener(this._onStoreChange),this._isMounted=!1}_onStoreChange=()=>{this.onFilterChange(this.props.filter,this._monitorInitialSelection)};onBookmarksUpdatedIsEmpty=()=>{const{onBookmarksUpdatedIsEmpty:e,filter:t}=this.props;if(e&&0===t.length){e(!(!this.state.nodes||this.state.nodes.every((e=>(GV(e)||KV(e))&&0===e.children?.length))))}};onFilterChange=(e,t)=>{if(e&&e.length>0){const s={bookmarks:!0,folders:!0};if("tree"===this.refTreeList.current?.getSearchStyle()){const n=g.Z.getFilteredTree(e,s);this.setState({nodes:n.nodes,cutIds:g.Z.getCutIds()},t?.(n.collapsed))}else{const n=g.Z.getFilteredFlat(e,s);this.setState({nodes:n,cutIds:g.Z.getCutIds()},t?.([]))}}else this.setState({nodes:g.Z.getTopNodes(),cutIds:g.Z.getCutIds()},t?.([]))};_monitorInitialSelection=()=>{this._hasSeenSelection||RV.nextTick((()=>{if(this._isMounted){const e=this.refTreeList.current?.getSelectedItem();e&&(this._hasSeenSelection=!0,this.props.onSelect(e))}}))};_onBadgeChanged=(e,t)=>{this.setState({showBadge:Boolean(t)})};deleteSelectedItems=()=>this.refTreeList.current?.onDelete();expandAll=()=>{this.refTreeList.current?.expandAll()};collapseAll=()=>{this.refTreeList.current?.collapseAll()};setSearchStyle=e=>{this.refTreeList.current?.setSearchStyle(e)};onSearchStyleChanged=e=>{this.props.filter&&this.onFilterChange(this.props.filter,(t=>{"tree"===e&&RV.nextTick((()=>{this.refTreeList.current?.expandAllExcept(t)}))}))};scrollToId=e=>{this.refTreeList.current?.scrollToId(e)};expandAndHighlight=e=>{this.refTreeList.current?.expandToId(e),this.refTreeList.current?.expand(e),this.refTreeList.current?.selectById(e)};getTargetSpec=(e,t)=>{const s={...Jn.ZP.getEmptyNode(),id:e.id,index:0,parentId:void 0};if((GV(e)||KV(e))&&"on"!==t){const e=g.Z.getLastTopNode();e?(s.parentId=e.parentId,s.index=(e.index||0)+1):s.parentId=g.Z.getRootId()}else if(QV(e)&&"on"===t)s.parentId=e.id;else{Boolean(this.refTreeList.current?.isExpanded(e.id))&&"below"===t?s.parentId=e.id:(s.parentId=e.parentId,s.index=(e.index||0)+("below"===t?1:0))}return s};onDrop=(e,t,s)=>{const n=this.getTargetSpec(t,s),i=n.parentId,a=n.index;return void 0===i||void 0===a?Promise.resolve([]):Jn.ZP.getUrlsFromEventPromise(e,!0).then((e=>{const t=e.map((e=>({...Jn.ZP.getEmptyNode(),url:e.url,title:e.title})));return this.onCreate(t,i,a,!1)}))};onAdd=e=>{this.refTreeList.current?.onAdd(e?"folder":"item")};buildItem=(e,t)=>"folder"===e?{title:(0,W.Z)("title","New Folder"),children:[]}:"separator"===e?{separator:!0}:{...t};bookmarkActivePage=async e=>{const t=Ze.ZP.getActivePage(this.context.vivaldiWindowId);if(t){const s=this.refTreeList.current?.getParentAndIndex(e,!0);if(void 0!==s?.parentId){const e=await ne.Z.bookmarkPages(t,!1,s.parentId,s.index);"string"==typeof e&&this.refTreeList.current?.selectById(e)}}};bookmarkAllOpenPages=async e=>{const t=this.refTreeList.current?.getParentAndIndex(e,!0);if(void 0!==t?.parentId){const e=await ne.Z.bookmarkAllOpenPages(this.winId,t.parentId,t.index);"string"==typeof e&&this.refTreeList.current?.selectById(e)}};onRootPasteContextMenu=e=>{const{document:t}=this.context;t.addEventListener("paste",this.onRootPaste),t.execCommand("paste"),t.removeEventListener("paste",this.onRootPaste)};onRootPaste=e=>{const t=g.Z.getRootId();void 0!==t&&ne.Z.paste(e,t,!0)};getSelectedBookmarks=()=>(this.refTreeList.current?.getAllSelectedItems()||[]).map((e=>Jn.ZP.getBookmarksByNode(e))).flat();getSelectedItem=()=>this.refTreeList.current?.getSelectedItem();_onNodesActivated=(e,t)=>{const s=this.context.vivaldiWindowId,n=(0,fo.ZP)(s,{button:e.button,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,metaKey:e.metaKey},re.Z.historyPrivate.TransitionType.AUTO_BOOKMARK),i=t.map((e=>Jn.ZP.getBookmarksByNode(e))).flat();Jn.ZP.open(s,i,n,!0)};_openInNewTab=e=>{const t={inCurrent:!1,inBackground:e||A.Z.get(Z.kTabsOpenNewInBackground),inNewWindow:!1,incognito:!1,transition:re.Z.historyPrivate.TransitionType.AUTO_BOOKMARK};Jn.ZP.open(this.context.vivaldiWindowId,this.getSelectedBookmarks(),t,!0)};_openInNewWindow=(e,t)=>{const s={inCurrent:!1,inBackground:!1,inNewWindow:!0,incognito:e,transition:re.Z.historyPrivate.TransitionType.AUTO_BOOKMARK};Jn.ZP.open(this.context.vivaldiWindowId,t,s,!0)};_openBookmark=()=>{const e={inCurrent:!0,inBackground:!1,inNewWindow:!1,incognito:!1,transition:re.Z.historyPrivate.TransitionType.AUTO_BOOKMARK};Jn.ZP.open(this.context.vivaldiWindowId,this.getSelectedBookmarks(),e,!0)};_supportSingleClick=()=>A.Z.get(Z.kBookmarksSingleClickOpens)&&!this.props.inManager;getMenuCapability=async(e,t,s)=>{const i=this.winId,a=Boolean(s)&&!GV(s)&&!KV(s)&&!g.Z.isSeparator(s);switch(e.action){case"CONTEXT_OPEN_IN_NEW_TAB":return{handler:()=>this._openInNewTab(!1),isVisible:()=>a,...t(i,e,{})};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{handler:()=>this._openInNewTab(!0),isVisible:()=>a&&!A.Z.get(Z.kTabsOpenNewInBackground),...t(i,e,{})};case"CONTEXT_OPEN_IN_TAB":return{handler:this._openBookmark,isVisible:()=>a,...t(i,e,{})};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{handler:()=>this._openInNewWindow(!1,this.getSelectedBookmarks()),isVisible:()=>a,...t(i,e,{})};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{handler:()=>this._openInNewWindow(!0,this.getSelectedBookmarks()),isVisible:()=>a,...t(i,e,{})};case"CONTEXT_CONTAINER_OPEN_IN_WINDOW":{const s=Jn.ZP.getUrlsByNodes(this.refTreeList.current?.getAllSelectedItems()||[]),n=await ro.getMenu(i,!0,s);return{isVisible:()=>a&&n.length>0,items:n,...t(i,e,{})}}case"CONTEXT_SET_SPEEDDIAL":return{handler:()=>{ne.Z.addSpeeddialGroup(s)},isVisible:()=>Boolean(s)&&!BV(s)&&!KV(s)&&!$V(s)&&QV(s)&&g.Z.validateForEdit(s.id),...t(i,e,{})};case"CONTEXT_UNSET_SPEEDDIAL":return{handler:()=>{ne.Z.removeSpeeddialGroup(s)},isVisible:()=>Boolean(s)&&!BV(s)&&!KV(s)&&$V(s)&&QV(s)&&g.Z.validateForEdit(s.id),...t(i,e,{})};case"CONTEXT_SET_BOOKMARK_BAR":{const n=Boolean(s)&&A.Z.get(Z.kBookmarksBarVisible)&&g.Z.getBookmarkBarFolderId()===s.id;return{handler:()=>{if(s)ne.Z.setBookmarkBarFolderAndToggleVisibility(s.id);else{const e=g.Z.getRootId();void 0!==e&&ne.Z.setBookmarkBarFolderAndShow(e)}},isVisible:()=>!s||QV(s)&&!n&&!GV(s)&&!KV(s),...t(i,e,{})}}case"CONTEXT_UNSET_BOOKMARK_BAR":{const n=Boolean(s)&&A.Z.get(Z.kBookmarksBarVisible)&&g.Z.getBookmarkBarFolderId()===s.id;return{handler:()=>ne.Z.setBookmarkBarFolderAndToggleVisibility(s.id),isVisible:()=>n,...t(i,e,{})}}case"CONTEXT_MOVE_TO_BOOKMARK_BAR":return{handler:()=>async function(e){const t=g.Z.getBookmarkBarFolderId();if(void 0===t)return;const s=g.Z.getItemById(t);if(!s||g.Z.isDescendantOf(s,e))return;const i=g.Z.getItemById(e);i&&i.parentId!==t&&await n.Z.bookmarks.move(e,{parentId:t})}(s.id),isVisible:()=>Boolean(s)&&!GV(s)&&!KV(s),...t(i,e,{})};case"CONTEXT_BOOKMARK":return{handler:()=>{if(s)this.bookmarkActivePage(s);else{const e=g.Z.getRootId();if(void 0!==e){const t=g.Z.getItemById(e);t&&this.bookmarkActivePage(t)}}},isVisible:()=>!GV(s),...t(i,e,{})};case"CONTEXT_BOOKMARK_ALL":return Promise.resolve({handler:()=>{if(s)this.bookmarkAllOpenPages(s);else{const e=g.Z.getRootId();if(void 0!==e){const t=g.Z.getItemById(e);t&&this.bookmarkAllOpenPages(t)}}},isVisible:()=>!GV(s),...t(i,e,{})});case"CONTEXT_EMPTY_TRASH":return{handler:()=>{ne.Z.emptyTrash()},isVisible:()=>Boolean(s)&&GV(s),...t(i,e,{})};default:return{...t(i,e,{})}}};getMenuVisibility=(e,t)=>{if(t)if(GV(t))switch(e.action){case"CONTEXT_IMPORT":case"CONTEXT_CONTAINER_SEARCH":return!0;default:return!1}else switch(e.action){case"CONTEXT_NEW_ITEM":case"CONTEXT_NEW_FOLDER":case"CONTEXT_PASTE":case"CONTEXT_EXPAND_ALL":case"CONTEXT_COLLAPSE_ALL":case"CONTEXT_IMPORT":case"CONTEXT_CONTAINER_SEARCH":return!0;case"CONTEXT_NEW_SEPARATOR":return this.props.sorting.sortOrder===ui.Z.NO_SORTING;case"CONTEXT_RENAME":return g.Z.validateForEdit(t.id);case"CONTEXT_CUT":case"CONTEXT_COPY":return!g.Z.isSeparator(t)&&!KV(t);case"CONTEXT_DELETE":return!KV(t);default:return!1}else switch(e.action){case"CONTEXT_NEW_ITEM":case"CONTEXT_NEW_FOLDER":case"CONTEXT_PASTE":case"CONTEXT_EXPAND_ALL":case"CONTEXT_COLLAPSE_ALL":case"CONTEXT_IMPORT":case"CONTEXT_CONTAINER_SEARCH":return!0;case"CONTEXT_NEW_SEPARATOR":return this.props.sorting.sortOrder===ui.Z.NO_SORTING;default:return!1}};onContextMenu=e=>{this.refTreeList.current?.onContextMenu(e)};getDropSupport=(e,t)=>{const s=t.dataTransfer.types.some((e=>Jn.ZP.isUriListType(e)||"text/plain"===e||e===Jn.yR));return{available:s,onto:s&&QV(e),edge:"both"}};handleExpandClick=(e,t)=>{this.refTreeList.current?.toggleSelectedExpansion(e,t)};onItemClick=(e,t)=>{e.button!==ai.Z.kCenter&&this._supportSingleClick()&&!QV(t)&&void 0===this.refTreeList.current?.getInlineEditId()&&this.openWithEventModifiers(e)};onItemDoubleClick=(e,t)=>{e.button===ai.Z.kCenter||this._supportSingleClick()||QV(t)||this.openWithEventModifiers(e)};onItemMouseUp=(e,t)=>{t.button===ai.Z.kCenter&&(this._openInNewTab(!0),t.preventDefault(),t.stopPropagation())};openWithEventModifiers=e=>{const t=this.context.vivaldiWindowId,s=(0,fo.ZP)(t,{button:e.button,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,metaKey:e.metaKey},re.Z.historyPrivate.TransitionType.AUTO_BOOKMARK);Jn.ZP.open(t,this.getSelectedBookmarks(),s,!0)};getRowComponentProps=e=>({...e,childCount:e.node.children?e.node.children.length:0,columns:this.props.columns||[],showBadge:this.state.showBadge,windowId:this.context.vivaldiWindowId});unSelectAll=()=>{this.refTreeList.current?.unSelectAll()};onSelect=async e=>{if(e){const t=g.Z.getItemById(e.id);t&&this.props.onSelect(t)}else this.props.onSelect()};onCreate=async(e,t,s,n)=>{const i=await ne.Z.createWithPromise(e,t??"",s??0),a=1===i.length&&g.Z.isSeparator(Jn.ZP.convertToPrivateType(i[0]));return this.props.onCreate(!a&&n),i};onMove=(e,t)=>{const{parentId:s="",index:n}=t;return ne.Z.move(e,s,n)};handleCut=(e,t)=>{const s=t.filter(FV).map((e=>e.id));ne.Z.cut(e,s)};handleCopy=(e,t)=>{const s=t.filter(FV).map((e=>e.id));ne.Z.copy(e,s)};menu={name:"bookmarklist",getCapability:this.getMenuCapability,getVisibility:this.getMenuVisibility};render(){return(0,zn.jsx)(Mi,{ref:this.refTreeList,rowComponent:e=>(0,zn.jsx)(qV,{...e,onExpandClick:(e,t)=>this.handleExpandClick(e,t),inManager:this.props.inManager,fullView:this.props.fullView}),getRowComponentProps:this.getRowComponentProps,nodes:this.state.nodes,cutIds:this.state.cutIds,onSelect:this.onSelect,onItemClick:this.onItemClick,onItemDoubleClick:this.onItemDoubleClick,onItemMouseDown:HV,onItemMouseUp:this.onItemMouseUp,onItemsActivated:this._onNodesActivated,buildItem:this.buildItem,onCreate:this.onCreate,onSearchStyleChanged:this.onSearchStyleChanged,delete:ne.Z.remove,onMove:this.onMove,onEdit:this.props.onEdit,onCut:this.handleCut,onCopy:this.handleCopy,onImport:()=>ue.Z.showImportDataDialog(this.context.vivaldiWindowId),isFolder:QV,isSeparator:g.Z.isSeparator,supportsInlineEdit:!0,menu:this.menu,mimeType:Jn.yR,getDropSupport:this.getDropSupport,getDragData:g.Z.getDragData,hasChildren:XV,settings:this.props.inManager?"BOOKMARKS_MANAGER":"BOOKMARKS_PANEL",multiSelect:!this._supportSingleClick(),setCutIds:ne.Z.setCutIds,getTitle:g.Z.getTitle,saveTitle:zV,getTargetSpec:this.getTargetSpec,sorting:this.props.sorting,onDrop:this.onDrop,rootId:g.Z.getRootId(),isValidAddTarget:WV,isValidDragSource:YV,isValidToEdit:g.Z.validateForEdit,validateForDrag:g.Z.validateForDrag,validateForDeletion:g.Z.validateForDeletion,columns:this.props.columns,onRowsRendered:this.props.onRowsRendered})}}const eH=JV,tH=[{text:(0,W.Z)("Title"),value:"title",fullScreenTitle:(0,W.Z)("Sort by title"),width:300,visible:!0,key:!0},{text:(0,W.Z)("Address"),value:"url",icon:Kn.iD7,fullScreenTitle:(0,W.Z)("Sort by address"),width:300,visible:!0},{text:(0,W.Z)("Nickname"),value:"nickname",icon:Kn.vvh.small,fullScreenTitle:(0,W.Z)("Sort by nickname"),width:100,visible:!0},{text:(0,W.Z)("Description"),value:"description",icon:Kn.sWI,fullScreenTitle:(0,W.Z)("Sort by description"),width:200,visible:!0},{text:(0,W.Z)("Date Created"),value:"dateAdded",icon:Kn.V_c,fullScreenTitle:(0,W.Z)("Sort by creation date"),width:150,visible:!1}];class sH extends Un.PureComponent{static contextType=oi.Z;refEditor=Un.createRef();refTree=Un.createRef();#Kt=!0;state={filter:"",sorting:{sortOrder:ui.Z.NO_SORTING,sortField:"manually",comparator:this.sortComparator},columns:xi().bookmarks||Ii(tH)};componentDidMount(){const e=A.Z.get(Z.kBookmarksManagerSorting);this.onSortChange(e.sortOrder,e.sortField)}componentDidUpdate(e){this.props.highlightId&&e.highlightId!==this.props.highlightId&&(this.#Kt=!0,this.#zt())}#$t=()=>{this.#zt()};#zt=()=>{const{highlightId:e}=this.props;this.#Kt&&e&&this.refTree.current?.expandAndHighlight(e),this.#Kt=!1};onSortChange=(e,t)=>{const s={sortOrder:e,sortField:t,comparator:this.sortComparator};this.setState({sorting:s});const n={sortOrder:e,sortField:t};I.Z.set(Z.kBookmarksManagerSorting,n)};sortComparator=(e,t)=>g.Z.treeSortComparator(e,t,this.state.sorting);importData=()=>{ue.Z.showImportDataDialog(this.context.vivaldiWindowId)};focusTree=()=>{this.refTree.current?.refTreeList.current?.focusTree()};onSelect=e=>{this.refEditor.current?.setItem(e)};onCreate=e=>{e&&this.setState({filter:""},(()=>{this.refEditor.current?.setIsCreating(!0),this.onSelect(this.getSelectedItem())}))};onEditorCanceled=(e,t)=>{const s=this.refTree.current;s&&t&&e?s.deleteSelectedItems()?.then((()=>{n.Z.bookmarks.remove(e),this.focusTree()})):this.focusTree()};onUpdateRow=e=>{this.setState({columns:e})};onSaveRow=()=>{yi(this.state.columns,"bookmarks")};getSelectedItem=()=>this.refTree.current?.getSelectedItem();deleteItem=()=>{this.refTree.current?.deleteSelectedItems()};_updateThumbnails=()=>{const e=[],t=this.refTree.current?.getSelectedBookmarks();if(t)for(const s of g.Z.iterateTrees(t,!0))s.url&&e.push({id:s.id,url:s.url});Ma.updateForBookmarks(e)};onSearchChange=e=>{this.setState({filter:e.target.value})};createBookmark=()=>{this.refTree.current?.onAdd(!1)};createFolder=()=>{this.refTree.current?.onAdd(!0)};onContextMenu=e=>{e.nativeEvent.buttons>0&&this.refTree.current?.unSelectAll(),this.refTree.current?.onContextMenu(e)};render(){return(0,zn.jsxs)("div",{className:"bookmark manager",children:[(0,zn.jsxs)("div",{className:"toolbar toolbar-default",role:"toolbar","aria-label":(0,W.Z)("toolbar label","Bookmark Actions"),children:[(0,zn.jsx)("input",{value:this.state.filter,onChange:this.onSearchChange,type:"search",tabIndex:"0",placeholder:(0,W.Z)("verb","Search")}),(0,zn.jsxs)("div",{className:"toolbar-group",children:[(0,zn.jsx)(oa.ZP,{onClick:this.createBookmark,image:Kn.md4.small,tooltip:(0,W.Z)("New Bookmark")}),(0,zn.jsx)(oa.ZP,{onClick:this.deleteItem,image:Kn.M2k.small,tooltip:(0,W.Z)("other","Delete")})]}),(0,zn.jsx)(oa.ZP,{onClick:this.createFolder,image:Kn._TQ.small,title:(0,W.Z)("command","New Folder")}),(0,zn.jsxs)("div",{className:"toolbar-group",style:{marginLeft:"auto"},children:[(0,zn.jsx)(oa.ZP,{onClick:this.importData,image:Kn.feZ.small,title:(0,W.Z)("Import...")}),(0,zn.jsx)(oa.ZP,{onClick:this._updateThumbnails,image:Kn.GO5.small,title:(0,W.Z)("Update Thumbnails")})]})]}),(0,zn.jsxs)("div",{className:"manager-content",children:[(0,zn.jsxs)("div",{className:"manager-treeview",children:[(0,zn.jsx)(Bu,{fields:tH,onSortChange:this.onSortChange,fullsize:!0,sortField:this.state.sorting.sortField,sortOrder:this.state.sorting.sortOrder,columns:this.state.columns,onUpdateRow:this.onUpdateRow,onSaveRow:this.onSaveRow,keyAccess:A.Z.get(Z.kKeyboardTabToAll)}),(0,zn.jsx)("div",{className:"vivaldi-tree-container",onContextMenu:this.onContextMenu,children:(0,zn.jsx)(eH,{filter:this.state.filter,ref:this.refTree,fullView:!0,inManager:!0,onEdit:this.onSelect,onSelect:this.onSelect,onCreate:this.onCreate,sorting:this.state.sorting,columns:this.state.columns,onRowsRendered:this.#$t})})]}),(0,zn.jsx)(LV,{ref:this.refEditor,getSelectedItem:this.getSelectedItem,onCancel:this.onEditorCanceled,onFocusTree:this.focusTree})]})]})}}const nH=sH;var iH=s(56284);class aH extends iH.Z{#Yt=(new Date).getDate();#A;addListener(e){super.addListener(e),this.#A||this.#E()}removeListener(e){super.removeListener(e),0===this._listeners.size&&(clearTimeout(this.#A),this.#A=null)}#E(){this.#A=setTimeout((()=>{const e=(new Date).getDate();e!==this.#Yt&&(this.#Yt=e,this.emitChange()),this.#E()}),be.lb)}}const oH=new aH;var rH=s(34930),lH=s(9126),dH=s(47543);const cH=function(e,t){const s=Un.useContext(oi.Z).vivaldiWindowId,n=Un.useCallback((t=>t.get(e)),[e]),i=(0,dS.Z)(Mc.Z,n).get(e),a=!!t?.filter,[o,r]=Un.useState(t?.filter),l=o||(i??(0,lH.l)(e)),d=Un.useRef(),[c,h]=Un.useState((()=>{if(t?.draft){const s=_r.ZP.initializeEvent(e,t?.draft);return d.current=structuredClone(s),s}})),u=Un.useRef();u.current=c;const p=Un.useRef();p.current=o;const g=Un.useRef(d.current),m=Un.useRef(),f=Un.useRef(!1);Un.useEffect((()=>{TZ.Z.init(e)}),[e]);const{anchorDate:v,allDaySelected:b,displayMode:C,filterText:w,selectedEvent:y,selectedDate:x}=l,{accounts:I,calendars:S,events:T,tasks:E,currentEdit:k}=(0,dS.Z)(Pr.Z),N=Un.useCallback((function(){if(x&&x.valueOf()<(new Date).valueOf()){const t=V()().hour(x.hour()).minute(x.minute());if(a&&p.current){const s=TZ.Z.selectDate(e,t,{allDay:b,setToday:!0,filter:p.current});r(s)}else TZ.Z.selectDate(e,t,{allDay:b,setToday:!0})}}),[e,b,x,a]);Un.useEffect((()=>{function e(){N()}return oH.addListener(e),()=>{oH.removeListener(e)}}),[N]);const _=Un.useCallback((function(t){d.current?.id===k.eventId&&s===k.windowId&&e===k.pageId&&ie.ZP.updateEditState(s,e,null);const n=t||u.current?.id;if(d.current=null,u.current=null,h(),a&&p.current){const t=TZ.Z.selectEvent(e,{eventId:n,filter:p.current});r(t)}else TZ.Z.selectEvent(e,{eventId:n})}),[s,e,k,a]),P=Un.useCallback((async function(){if(!u.current)return;const t=u.current.id,s=await ie.ZP.saveEvent(u.current,d.current,e);return await new Promise((e=>setTimeout(e,1))),s.clearDraft&&!f.current&&_(t||s.event?.id),f.current=!1,s.event}),[_,e]),M=Un.useCallback((async function(e){"cancel"===A.Z.get(Z.kCalendarClickOutside)?_():await P(),e&&(h(e),d.current=e)}),[_,P]),D=Un.useCallback((async function(t){u.current&&await M(),a&&p.current?r(TZ.Z.selectEvent(e,{...t,filter:p.current})):TZ.Z.selectEvent(e,t)}),[e,M,a]),O=Un.useCallback((function(e){const{eventDraft:t,cache:s}=function(e,t,s,n){let i=t?.start!==e.start||t?.end!==e.end?null:s;if(t&&t.task!==e.task)if(i=s?null:{start:e.start,end:e.end},e.task)s?(e.start=s.start,e.end=s.end):(e.end=e.start,e.start=0);else if(s&&e.end===s.start&&(e.start=s.start,e.end=s.end),!e.start){const t=A.Z.get(Z.kCalendarDefaultDuration);e.end?e.start=e.end-t:(n.selectedDate?e.start=(0,Kc.zX)(n.selectedDate.valueOf()):e.start=(0,Kc.zX)(Date.now()),e.end=e.start+t)}return s&&t&&!t.start&&e.start&&s.start===e.end&&(e.start=s.start,e.end=s.end),t&&t.allDay!==e.allDay&&(e.allDay?e.start&&e.end&&(e.end=e.end+be.hd):(e.start&&e.end&&(e.end=e.end-be.hd),e.timezone===be.$T&&(e.timezone=""))),{eventDraft:e,cache:i}}(e,g.current,m.current,l);m.current=s;const n=function(e,t,s){if(s.filterText&&""===e.id&&(e.filteredOut=!_r.ZP.eventHasText(e,s.filterText)&&"DELETE"!==_r.ZP.shouldSaveEvent(e)),s.calendarIds.size&&!s.calendarIds.has(e.calendarId)&&(e.filteredOut=!0),!e.organizer&&e.invites?.length){const{invites:t}=e,s=rH.Z.getOrganizerForEvent(e);e.organizer=s,s&&!t.find((e=>e.address===s))&&t.push({id:"",event_id:e.id,address:s,partstat:"ACCEPTED"})}const{calendarId:n,task:i}=e;let{account:a,calendar:o}=_r.ZP.getAccountAndCalendar(n);return(i&&!o?.supportedCalendarComponent.vtodo||!i&&!o?.supportedCalendarComponent.vevent)&&(e.calendarId=_r.ZP.getDefaultCalendar(i)?.id||"",({account:a,calendar:o}=_r.ZP.getAccountAndCalendar(n))),"google"===a?.account_type&&i&&(e.allDay=!0,e.timezone=be.$T),!e.rrule||e.start||e.end||(e.rrule=""),e}(t,g.current,l);h({...n}),g.current=n}),[l]),j=Un.useCallback((function(t,s){if(u.current&&M(),a&&p.current){const n=p.current,i=y?TZ.Z.selectEvent(e,{date:t,allDay:s,filter:n}):TZ.Z.selectDate(e,t,{allDay:s,filter:n});r(i)}else y?TZ.Z.selectEvent(e,{date:t,allDay:s}):TZ.Z.selectDate(e,t,{allDay:s})}),[e,y,M,a]),L=Un.useCallback((async function(t,n){const i=n?_r.ZP.initializeEvent(e,n):structuredClone(t);if(_r.ZP.doesCalendarsExistsAndShowWarning(s,i?.task)&&(u.current&&(u.current.uid===i?.uid?_():await M(),await new Promise((e=>setTimeout(e,1)))),h(i),d.current=structuredClone(i),g.current=d.current,m.current=null,ie.ZP.updateEditState(s,e,i?.id),i)){const{start:e,end:t}=i,s=!!i.allDay||l.allDaySelected;if(e&&t&&e!==t){const n=x?.valueOf()??0;if(n<e||n>t){_r.ZP.getDisplayRange(v,C).contains(e)&&j(V()(e),s)}}else(e||t)&&j(V()(e||t),s)}}),[s,e,_,M,j,v,C,x,l.allDaySelected]),R=Un.useCallback((function(t){a&&p.current?r(TZ.Z.setCalendarIds(e,t,{filter:p.current})):TZ.Z.setCalendarIds(e,t)}),[e,a]),B=Un.useCallback((function(){a&&p.current?r(TZ.Z.showCompletedTasks(e,{filter:p.current})):TZ.Z.showCompletedTasks(e)}),[e,a]),F=Un.useRef({selectDate:j,selectEvent:D,selectCalendars:R,toggleShowCompleted:B,editEvent:L,updateEventEdit:O,saveEventEdit:P,endEventEdit:M,cancelEventEdit:_});F.current.selectDate=j,F.current.selectEvent=D,F.current.editEvent=L,F.current.updateEventEdit=O,F.current.saveEventEdit=P,F.current.endEventEdit=M,F.current.cancelEventEdit=_,!c||s===k.windowId&&e===k.pageId||M();const{calendarIds:W,showTasks:U}=l,H=Un.useMemo((()=>new Set(S.filter((e=>!e.hidden&&(0===W.size||W.has(e.id)))).map((e=>e.id)))),[S,W]),[G,K]=Un.useMemo((()=>{const e=T.filter((e=>H.has(e.calendarId)&&(U||!e.task)));return(0,oT.Z)(e,(e=>!e.trash))}),[T,H,U]),z=sh.tV.call(G,v,C),$=Un.useMemo((()=>w?["agenda","year"].includes(C)?z.filter((e=>_r.ZP.eventSearchPredicate(e,w))):z.map((e=>_r.ZP.eventSearchPredicate(e,w)?e:{...e,filteredOut:!0})):z),[C,w,z]),{showCompletedTasks:Y}=l,X=Un.useMemo((()=>{const e=new Set;for(const t of E)if(t.recurrenceExceptions)for(const s of t.recurrenceExceptions)e.add(s.exception_event_id);return E.flatMap((t=>{if(t.trash||e.has(t.id)||t.complete&&!Y||!H.has(t.calendarId))return[];const{rrule:s,timezone:n}=t;if(!s)return t;let i=(0,Kc.oJ)(t);if(!t.recurrenceExceptions?.length&&i)return{...t,id:`${t.id}:${(0,Kc.oJ)(t)}`};const a=(0,dH.Qj)(s,n,i);if(!i||!a)return t;const o=new Set((t.recurrenceExceptions??[]).map((e=>e.date)));let r=[];const l=[];do{const e=new Date(i),s=new Date(8e15);r=(0,dH.qh)(a,e,s,100,t.timezone);for(const e of r){o.delete(e.valueOf());const s=(0,sh.Km)(e,t);if(s.event)if(s.event.complete&&Y)l.push(s.event);else if(!s.event.complete)return l.push(s.event),o.size&&Y&&o.forEach((e=>{const s=(0,sh.Km)(new Date(e),t);s.event?.complete&&l.push(s.event)})),l}i=r.length&&r[r.length-1].valueOf()+1e3}while(r.length);return l}))}),[E,H,Y]),Q=Un.useMemo((()=>w?X.filter((e=>_r.ZP.eventSearchPredicate(e,w))):X),[X,w]),q=""===d.current?.id,J=Un.useMemo((()=>{const e=d.current;return q&&e?e.uid?[...$.filter((t=>t.uid!==e.uid)),e]:[...$,e]:$}),[$,q]),ee=Un.useMemo((()=>q&&d.current?.task?[...Q,d.current]:Q),[Q,q]);if(l.editing){if(l.selectedEvent===c?.id)f.current=!0;else{const e=z.find((e=>e.id===l.selectedEvent));setTimeout((()=>L(e)),1)}a&&p.current?r(TZ.Z.selectEvent(e,{eventId:l.selectedEvent,edit:!1,filter:p.current})):TZ.Z.selectEvent(e,{eventId:l.selectedEvent,edit:!1})}return{stateHandler:F.current,calendarFilter:l,eventDraft:c,accounts:I,calendars:S,events:J,trashedEvents:K,tasks:ee,hasTasks:E.length>0}};var hH=s(87852);const uH=[Z.kCalendarDisplayDensity],pH={allDaySelected:!1,anchorDate:V()(),calendarIds:new Set,displayMode:"day",editing:!1,filterText:"",selectedDate:V()(),selectedEvent:"",showCompletedTasks:!1,showTasks:!0};const gH=function(e){const t=(0,Eo.Z)(uH)[Z.kCalendarDisplayDensity],{anchorDate:s,displayMode:n,pageId:i}=e,a=cH(hH.Q9,{filter:pH}),o=!!a.eventDraft,r=Un.useMemo((()=>{const e={...a.stateHandler,selectDate:function(e,t){TZ.Z.selectDate(i,e,{allDay:t})}};return{pageId:hH.Q9,displayDensity:t,isPanel:!0,isEditing:o,isWidget:!1,isTaskList:"agenda"===n,handler:e}}),[t,n,a.stateHandler,o,i]);Un.useEffect((()=>{a.stateHandler.selectDate(s)}),[s,a.stateHandler]);const l=a.calendarFilter.selectedDate??s,d="agenda"===n?(0,W.Z)("Tasks"):l.format(F.ZP.getWeekdayFormat("LL"));return(0,zn.jsxs)("div",{className:"manager-detail",children:[(0,zn.jsx)("div",{className:"header",children:(0,zn.jsx)("h1",{children:d})}),(0,zn.jsx)(WS.Provider,{value:r,children:(0,zn.jsx)(gE,{filter:a.calendarFilter,events:"agenda"===n?a.tasks:a.events,trashedEvents:a.trashedEvents,anchorDate:l,displayMode:"agenda"===n?"agenda":"day",eventDisplayStyle:"solid",editingEvent:a.eventDraft})}),"agenda"===n&&(0,zn.jsx)("div",{className:"footer cal-tasks",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:a.calendarFilter.showCompletedTasks,onChange:a.stateHandler.toggleShowCompleted}),(0,zn.jsx)("span",{children:(0,W.Z)("Show Completed Tasks")})]})})]})};var mH=s(41198);class fH extends Un.Component{cache={};state={eventsToRender:[],resultCount:0};static contextType=WS;density="";listRef=Un.createRef();constructor(e,t){super(e),this.cache=new mH.t1({defaultHeight:50}),this.density=t?.displayDensity}static getDerivedStateFromProps=(e,t)=>{const s=Pr.Z.getEvents()||[],n=_r.ZP.searchEvents(s,e.filterText).reduce(((e,t)=>{const s=(0,Kc.oJ)(t),n=s?V()(s).startOf("day").valueOf():0,i=e.findIndex((e=>e.timestamp===n));return-1===i?e.push({timestamp:n,events:[t]}):e[i].events.unshift(t),e}),[]),i=n.reduce(((e,t)=>e+t.events.length),0);return{eventsToRender:n,resultCount:i}};componentDidUpdate(e,t){this.props.filterText===e.filterText&&this.density===this.context?.displayDensity||(this.cache.clearAll(),this.density=this.context?.displayDensity,this.listRef.current?.forceUpdateGrid())}selectEvent=e=>{const t=V()(e.start);this.context.handler.selectDate(t)};setSelectedIndex=e=>{const{selectedEvent:t}=this.props,{eventsToRender:s}=this.state,n=s.flatMap((e=>e.events));if(t){let s=n.findIndex((e=>e.id===t));"Up"===e?s=Math.max(0,s-1):"Down"===e&&(s=Math.min(n.length-1,s+1)),this.context.handler.selectEvent({event:n[s]})}else this.context.handler.selectEvent({event:n[0]})};onKeyDown=e=>{switch(JS.Z[e.keyCode]){case"Up":case"Down":this.setSelectedIndex(JS.Z[e.keyCode])}};renderDay=({index:e,parent:t,key:s,style:n})=>{const{eventsToRender:i}=this.state;if(0===i.length)return;const a=i[e],o=a.events.map(((e,t)=>this.renderEvent(e))),r=V()(a.timestamp);return(0,zn.jsx)(mH.Z8,{cache:this.cache,parent:t,columnIndex:0,rowIndex:e,children:(0,zn.jsxs)("div",{className:"cal-tasks-row",style:n,children:[(0,zn.jsxs)("div",{className:"cal-tasks-row-date",children:[(0,zn.jsx)("span",{className:"cal-tasks-row-dow",children:r.format("dddd")}),(0,zn.jsx)("span",{className:"cal-tasks-row-doy",children:r.format("ll")})]}),(0,zn.jsx)("div",{className:Gn()("cal-tasks-row-events"),children:o})]})},s)};eventClick=e=>{this.props.onSelectEvent(e.id)};renderEvent=e=>{const t=_r.ZP.isMultiDayEvent(e),{selectedEvent:s}=this.props,n=s===e.id,i=!!this.props.editingEvent&&this.props.editingEvent.id===e.id,a=_r.ZP.isRecurringEvent(e),o=Boolean(this.props.filterText);let r;if(a){const t=e.rrule&&(0,dH.Qj)(e.rrule,e.timezone,e.start);if(t){const e=(0,dZ.p)(t),s=(0,dH.qh)(t,new Date,V()().add(1,"y").toDate(),3).map((e=>V()(e).format("LL")));r=`${(0,W.Z)("Next occurrences:")}\n          ${s.join(", ")}. ${e}.`}}return(0,zn.jsxs)("div",{onClick:this.eventClick.bind(null,e),className:"event-container",children:[(0,zn.jsx)(eT,{event:e,displayStyle:"transparent",isSelected:n,isEditing:i,isMultiDay:t,isFiltering:o}),r&&(0,zn.jsx)("div",{children:r})]},e.id)};render(){return(0,zn.jsx)("div",{className:"manager-content search-result",children:(0,zn.jsxs)("div",{className:"calendar-viewport",onFocus:this.props.onFocus,children:[(0,zn.jsx)("style",{children:_r.ZP.getCalendarColors()}),(0,zn.jsxs)("div",{className:"search-results",children:[(0,W.Z)("$1 result for “$2”","$1 results for “$2”",[this.state.resultCount,this.props.filterText]),(0,zn.jsx)("button",{onClick:this.props.onClose,children:(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.kze}})})]}),(0,zn.jsx)("div",{className:"calendar-grid-agenda search-results-list",onKeyDown:this.onKeyDown,children:(0,zn.jsx)(XD.q,{children:({height:e,width:t})=>(0,zn.jsx)(QD.a,{ref:this.listRef,width:t,height:e,defferredMeasurementCache:this.cache,rowHeight:this.cache.rowHeight,rowRenderer:this.renderDay,rowCount:this.state.eventsToRender.length})})})]})})}}const vH=fH;var bH=s(98035);class CH extends Un.PureComponent{static contextType=WS;undeleteEvent=e=>{ie.ZP.restoreEvent(this.context.pageId,e)};undo=()=>{const{trashedEvents:e}=this.props;e.length>0&&this.undeleteEvent(e[0])};trimTitle=e=>(e.length>70&&(e=e.substring(0,70)+"..."),e);getContextMenuItems=()=>this.props.trashedEvents.sort(((e,t)=>(t.trash_time||0)-(e.trash_time||0))).map((e=>({mnemonic:!1,url:e.id,handler:this.undeleteEvent.bind(this,e),...st.Z.makeLabelPair(e.title||Vc.gT)}))).filter(Boolean).concat([st.Z.separatorItem,{handler:this.clearAll,...(0,fi.Z)("other","Clear All")}]);clearAll=()=>{const{trashedEvents:e}=this.props;e.forEach((e=>{const{id:t,syncPending:s}=e;s?bH.Z.updateEvent({id:t,deletePending:!0}):ie.ZP.deleteEvent(t)}))};onDrop=e=>{const t=e.dataTransfer.getData(um);if(t){e.preventDefault(),e.stopPropagation();const s=JSON.parse(t),{id:n}=s;ie.ZP.trashEvent(n)}};render(){return(0,zn.jsx)(oa.ZP,{className:"toggle-trash",onDrop:this.onDrop,onDragEnter:nr.Z,disabled:0===this.props.trashedEvents.length,image:Kn.nre.small,onMiddleClick:this.undo,menu:this.getContextMenuItems,menuOrigin:"bottomLeft",mimeType:um,edgeAmount:0,tooltip:(0,W.Z)("Trashed Events")})}}const wH=CH,yH=e=>{ie.ZP.toggleCalendarVisibility(e)},xH=e=>{const{key:t}=e;" "!==t&&"Enter"!==t||e.target.dispatchEvent(new Event("click",{bubbles:!0}))};var IH=(0,zn.jsx)("div",{className:"CalendarPicker-Separator"}),AH=(0,zn.jsx)("div",{className:"CalendarPicker-Separator"}),SH=(0,zn.jsx)("div",{className:"CalendarPicker-Separator"});const ZH=function(e){const t=Un.useRef(),s=Un.useRef(),n=Un.useRef(),i=Un.useRef(!1),a=Un.useRef(),o=Un.useContext(oi.Z),{document:r}=o,[l,d]=Un.useState(!1);Un.useEffect((()=>(t.current&&t.current.focus(),()=>{a.current&&clearTimeout(a.current)})),[]);const c=e=>{ie.ZP.setDefaultCalendarId(e),t.current&&t.current.focus()},h=e=>{e.currentTarget.focus();const t=e.currentTarget.classList.contains("CalendarPicker-Item--Submenu")||e.currentTarget.closest(".CalendarPicker-Item--Submenu");t?l?a.current&&(a.current=clearTimeout(a.current)):d(!0):!t&&l&&(a.current=setTimeout((()=>{d(!1),a.current=null}),500))},u=e=>{t.current&&t.current.focus()},p=_r.ZP.getDefaultCalendar()?.id,g=i.current;i.current=!1;const{accounts:m,calendars:f}=e,v=[],b=[];let C=!1;return m.forEach((e=>{const t=f.filter((t=>t.accountId===e.id));v.push({account:e,calendars:t}),e.url&&t.length&&(C=!0),"ical"!==e.account_type&&b.push(...t)})),v.sort(((e,t)=>"local"===e.account.account_type?-1:"local"===t.account.account_type?1:0)),(0,zn.jsxs)("div",{className:"CalendarPicker",onKeyDown:e=>{const a=r.activeElement,{key:o}=e;if(a&&a.classList.contains("CalendarPicker-Item")){if(a){const e=((e,t)=>{const s=e.parentElement&&e.parentElement.children;return s&&s.length?[...s].filter((e=>e.classList.contains(t))):[]})(a,"CalendarPicker-Item"),s=e.indexOf(a);if(0===e.length||-1===s)return;if("ArrowDown"===o)e[(s+1)%e.length].focus();else if("ArrowUp"===o)e[(s-1+e.length)%e.length].focus();else if("ArrowLeft"===o){if(l&&t.current){const e=t.current.querySelector(".CalendarPicker-Item--Submenu");e&&e.focus(),d(!1)}}else if("ArrowRight"===o&&a.classList.contains("CalendarPicker-Item--Submenu"))if(l){const e=a.querySelectorAll(".CalendarPicker-Item");e.length&&e[0].focus()}else d(!0),i.current=!0}}else"ArrowUp"===o?n.current&&n.current.focus():"ArrowDown"===o&&(s.current?s.current.focus():n.current&&n.current.focus())},ref:t,tabIndex:0,children:[e.calendars.length>0&&(0,zn.jsxs)(zn.Fragment,{children:[v.map((e=>(0,zn.jsxs)(Un.Fragment,{children:[v.length>1&&(0,zn.jsx)("h3",{className:"CalendarPicker-Account",children:"local"===e.account.account_type?(0,W.Z)("Local Calendars"):e.account.name||e.account.url}),!!e.calendars.length&&e.calendars.map(((e,t)=>{const n=_r.ZP.createCalendarIcon(e,16,!e.hidden);return(0,zn.jsxs)("button",{onMouseEnter:h,onMouseLeave:u,className:"CalendarPicker-Item",onClick:yH.bind(null,e.id),ref:0===t?s:null,children:[(0,zn.jsx)("span",{className:"CalendarPicker-Icon",dangerouslySetInnerHTML:{__html:n}}),(0,zn.jsx)("span",{className:Gn()("CalendarPicker-Title",{"CalendarPicker-Title--Default":e.id===p}),children:_r.ZP.getCalendarDisplayName(e)})]},e.id)})),!e.calendars.length&&(0,zn.jsx)("div",{children:(0,zn.jsx)("span",{className:"CalendarPicker-Title",children:(0,W.Z)("No Calendars")})})]},e.account.id))),b.length>0&&(0,zn.jsxs)(zn.Fragment,{children:[IH,(0,zn.jsxs)("div",{className:"CalendarPicker-Item CalendarPicker-Item--Submenu",onClick:()=>d(!l),onMouseEnter:h,onMouseLeave:u,onKeyUp:xH,tabIndex:0,children:[(0,zn.jsx)("span",{className:"CalendarPicker-Title",children:(0,W.Z)("Default Calendar")}),(0,zn.jsx)("span",{className:"CalendarPicker-SubmenuIcon",dangerouslySetInnerHTML:{__html:Kn.nfH}}),l&&(0,zn.jsx)("div",{className:"CalendarPicker-Submenu",children:b.map(((e,t)=>{const s=p===e.id,n=_r.ZP.createCalendarIcon(e,16,s);return(0,zn.jsxs)("button",{className:"CalendarPicker-Item",onClick:c.bind(null,e.id),onMouseEnter:h,onMouseLeave:u,autoFocus:0===t&&g,children:[(0,zn.jsx)("span",{className:"CalendarPicker-Icon",dangerouslySetInnerHTML:{__html:n}}),(0,zn.jsx)("span",{className:"CalendarPicker-Title",children:_r.ZP.getCalendarDisplayName(e,!0)})]},e.id)}))})]})]}),AH]}),(0,zn.jsxs)("button",{className:"CalendarPicker-Item",onClick:()=>{ue.Z.showCreateCalendarDialog(o.vivaldiWindowId),e.requestClose&&e.requestClose()},onMouseEnter:h,onMouseLeave:u,children:[(0,zn.jsx)("span",{className:"CalendarPicker-Icon",dangerouslySetInnerHTML:{__html:Kn.md4.medium}}),(0,zn.jsx)("span",{className:"CalendarPicker-Title",children:(0,W.Z)("verb","New Calendar")})]}),C&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("button",{className:"CalendarPicker-Item",onClick:async()=>{e.requestClose&&e.requestClose(),ie.ZP.pollAllCalDAVAccountsWithStatus()},onMouseEnter:h,onMouseLeave:u,children:[(0,zn.jsx)("span",{className:"CalendarPicker-Icon",dangerouslySetInnerHTML:{__html:Kn.GO5.medium}}),(0,zn.jsx)("span",{className:"CalendarPicker-Title",children:(0,W.Z)("Refresh")})]}),SH]}),(0,zn.jsxs)("button",{className:"CalendarPicker-Item",onClick:()=>{ue.Z.showSettings(o.vivaldiWindowId,"calendar"),e.requestClose&&e.requestClose()},onMouseEnter:h,onMouseLeave:u,ref:n,children:[(0,zn.jsx)("span",{className:"CalendarPicker-Icon",dangerouslySetInnerHTML:{__html:Kn.bqs.medium}}),(0,zn.jsx)("span",{className:"CalendarPicker-Title",children:(0,W.Z)("Calendar Settings")})]})]})},TH={width:"auto",minWidth:"unset"};const EH=function(e){const[t,s]=Un.useState(!1);return(0,zn.jsx)(zn.Fragment,{children:(0,zn.jsxs)("div",{className:"toolbar-dropdown-container",children:[(0,zn.jsx)(oa.ZP,{image:Kn.bcq.small,isPressed:t,onClick:()=>s(!t),popupPosition:"below",hidePopup:nr.Z,title:(0,W.Z)("Calendars"),isMenuIndicatorVisible:!0,isMenuIndicatorDisabled:!0}),t&&(0,zn.jsx)(Ha.Z,{style:TH,className:"calendar-picker",onRequestClose:e=>{e&&e.target.addEventListener("click",wi.ZP,{once:!0}),s(!1)},label:(0,W.Z)("Calendar Picker"),children:(0,zn.jsx)(ZH,{accounts:e.accounts,calendars:e.calendars,requestClose:()=>s(!1)})})]})})};var kH=s(46884);const{searchEvents:NH}=_r.ZP,_H={events:[],count:0,totalCount:0};var PH=(0,zn.jsx)("br",{});const MH=function(e){const t=Un.useContext(oi.Z),s=Un.useContext(WS),{document:n}=t,[i,a]=Un.useState(!1),[o,r]=Un.useState(_H),[l,d]=Un.useState(-1),c=Un.useRef(),h=Un.useRef();Un.useEffect((()=>{i&&c.current?.focus()}),[i]),Un.useEffect((()=>{function e(e){e===t.vivaldiWindowId&&(h.current?.focus(),a(!0))}return go.Z.addListener("COMMAND_CALENDAR_SEARCH",e),()=>{go.Z.removeListener("COMMAND_CALENDAR_SEARCH",e)}}),[t.vivaldiWindowId]);const u=t=>{m(),e.onSelectEvent(t)},p=()=>{m(),e.onShowSearchResults()},g=t=>{const s=Pr.Z.getEvents()||[];let n=NH(s,t||e.filterText);const i=n.length;return i>10&&(n=n.slice(0,10)),{events:n,count:n.length,totalCount:i}},m=()=>{a(!1),d(-1)},f=t=>{switch(JS.Z[t.keyCode]){case"Enter":r(g()),a(!0);break;case"Escape":e.onSearchChange(""),a(!1)}};function v(e,t){if(e.valueOf()&&t.isAfter(e,"day"))return(0,W.Z)("$1 - $2 $3",[e.format(F.ZP.getShortDateFormat()),t.format(F.ZP.getShortDateFormat()),e.format("YYYY")]);const s=e.valueOf()?e:t;return(0,W.Z)("$1. $2",[s.format("ddd"),s.format("ll")])}function b(e,t){return e.valueOf()?`${e.format("LT")}-${t.format("LT")}`:t.format("LT")}const C=s.isPanel?(0,W.Z)("verb","Search"):(0,W.Z)("Filter and Search"),w=Un.useRef(null),y=Un.useCallback((()=>m),[]),x=Un.useCallback((()=>w.current),[]);return(0,kH.Z)(x,y),(0,zn.jsxs)("div",{ref:w,className:"toolbar-group FilterAndSearch",children:[(0,zn.jsx)("input",{type:"search",className:"FilterAndSearch-Input no-page-focus",tabIndex:"0",ref:h,placeholder:C,title:(0,W.Z)("Type to filter. Press enter or click button to search."),value:e.filterText,onChange:t=>{const{value:s}=t.target;e.onSearchChange(s),""===s&&m(),i&&r(g(s))},onKeyDown:f}),(0,zn.jsx)("input",{className:"FilterAndSearch-Button",type:"button",disabled:0===e.filterText.length,onClick:p,value:(0,W.Z)("verb","Search")}),i&&(0,zn.jsxs)("div",{className:"SearchDropdown",ref:c,tabIndex:"0",onFocus:e=>{e.target===c.current&&l<0&&d(0)},onKeyDown:e=>{switch(JS.Z[e.keyCode]){case"Space":case"Enter":l>=0&&l<o.count&&(u(o.events[l].id),e.stopPropagation());break;case"Escape":m(),h.current&&h.current.focus();break;case"Up":d((e=>Math.max(0,e-1)));break;case"Down":d((e=>Math.min(o.count-1,e+1)));break;case"Tab":n.activeElement===c.current&&(!e.shiftKey&&l<o.count-1?(d((e=>e+1)),e.preventDefault()):e.shiftKey&&l>0&&(d((e=>e-1)),e.preventDefault()))}},children:[0===o.count&&(0,zn.jsx)("div",{className:"SearchDropdown-NoItems",children:(0,W.Z)("No events found")}),o.count>0&&(0,zn.jsx)("ul",{children:o.events.map(((t,s)=>{const n=Pr.Z.getCalendars(),{title:i,id:a}=t,{start:o,end:r}=(0,Kc.aE)(t),c=n.find((e=>e.id===t.calendarId)),h=c?_r.ZP.createCalendarIcon(c,9):"";return(0,zn.jsxs)("li",{className:Gn()("SearchDropdown-Item",{"SearchDropdown-Item--Selected":l===s}),onKeyDown:f,onMouseUp:()=>u(a),onMouseOver:()=>d(s),children:[(0,zn.jsx)("div",{className:"SearchDropdown-ItemEvent",children:(0,zn.jsx)("p",{className:"SearchDropdown-ItemEventTitle",children:(0,zo.CH)(i,e.filterText)})}),(0,zn.jsxs)("div",{className:"SearchDropdown-ItemMetaData",children:[(0,zn.jsx)("div",{className:"SearchDropdown-ItemIcon",children:(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:h}})}),(0,zn.jsx)("p",{className:"SearchDropdown-ItemEventCalendar",children:!!c&&_r.ZP.getCalendarDisplayName(c,!0)}),!!t.end&&(0,zn.jsxs)("div",{className:"SearchDropdown-ItemDate",children:[v(o,r),PH,!t.allDay&&b(o,r)]})]})]},s)}))}),o.count!==o.totalCount&&(0,zn.jsx)("div",{className:"SearchDropdown-MoreItems",children:(0,W.Z)("More results, showing first $1 items out of $2 total.",[o.count,o.totalCount])}),o.count>0&&(0,zn.jsx)("input",{className:"SearchDropdown-Button",type:"button",onClick:p,value:(0,W.Z)("Go to Search Results")})]})]})};function DH(e){return"day"===e||"week"===e?"month":"year"}const OH=function(e){const{document:t,HTMLElement:s}=Un.useContext(oi.Z),n=Un.useRef(),i=Un.useRef(),a=Un.useRef(e.initialPeriod),o=(0,Eo.Z)([Z.kKeyboardTabToAll]),[r,l]=Un.useState(e.mode),[d,c]=Un.useState((()=>e.initialPeriod.clone()));function h(){const e="year"===r?12:1,t=DH(r);c(d.clone().subtract(e,t))}function u(){const e="year"===r?12:1,t=DH(r);c(d.clone().add(e,t))}function p(t){e.setPeriod(t),e.requestClose()}function g(t){r===e.mode?p(t):(c(t),l(e.mode))}function m(e){const t=e.currentTarget;if(t instanceof s){const e=t.dataset.period;g("month"===r?d.clone().month(parseInt(e)):d.clone().year(parseInt(e)))}}function f(t){if("number"==typeof t.keyCode){const e=JS.Z[t.keyCode];if(t.repeat||"Space"!==e&&"Enter"!==e)return}t.stopPropagation(),t.preventDefault(),l(r===e.mode?DH(r):e.mode)}Un.useEffect((()=>(n.current=t.activeElement,i.current?.focus(),c(e.initialPeriod.clone()),l(e.mode),()=>{n.current?.focus()})),[t,e.initialPeriod,e.mode]);const v=d.year()-d.year()%12;let b="",C="",w="",y="";switch(r){case"year":C=(0,W.Z)("Previous Years"),w=(0,W.Z)("Next Years"),b=`${v} - ${v+11}`;break;case"month":C=(0,W.Z)("Previous Year"),w=(0,W.Z)("Next Year"),y="month"===e.mode?(0,W.Z)("Show Years"):(0,W.Z)("Show Month"),b=d.format("YYYY");break;case"week":case"day":C=(0,W.Z)("Previous Month"),w=(0,W.Z)("Next Month"),y=e.mode===r?(0,W.Z)("Show Year"):(0,W.Z)("Show Month"),b=d.format("MMMM YYYY")}let x="";if(d!==a.current){let e=!1;if("year"===r){Math.floor(a.current.year()/12)!==Math.floor(d.year()/12)&&(e=!0)}else{const t=DH(r);a.current.isSame(d,t)||(e=!0)}e&&(x=a.current.valueOf()<d.valueOf()?"DatePickerPopup-Contents--Increase":"DatePickerPopup-Contents--Decrease"),a.current=d}const I=d.get(DH(r));return(0,zn.jsxs)("div",{className:"DatePickerPopup panel-clickoutside-ignore",ref:i,onMouseDown:wi.ZP,onClick:wi.ZP,onKeyDown:function(t){let s;switch(JS.Z[t.keyCode]){case"Left":s=d.clone().subtract(1,r);break;case"Right":s=d.clone().add(1,r);break;case"Up":s="month"===r||"year"===r?d.clone().subtract(3,r):d.clone().subtract(1,"week");break;case"Down":s="month"===r||"year"===r?d.clone().add(3,r):d.clone().add(1,"week");break;case"PageUp":h(),(0,wi.ZP)(t);break;case"PageDown":u(),(0,wi.ZP)(t);break;case"Enter":if((0,wi.ZP)(t),t.target!==t.currentTarget)return;g(d.clone());break;case"Escape":(0,wi.ZP)(t),e.requestClose()}s&&(c(s),(0,wi.ZP)(t))},tabIndex:"0",children:[(0,zn.jsxs)("div",{className:"toolbar toolbar-default",children:[(0,zn.jsx)("h1",{className:"year"!==r?"button":"",onMouseDown:f,onKeyDown:f,title:y,tabIndex:"year"!==r?o[Z.kKeyboardTabToAll]:"-1",children:b}),(0,zn.jsxs)("div",{className:"toolbar-group",style:{marginLeft:"auto"},children:[(0,zn.jsx)(oa.ZP,{className:"button-narrow",onClick:h,tooltip:C,image:Kn.mgF.medium}),(0,zn.jsx)(oa.ZP,{onClick:function(){c(V()().startOf("hour")),l(e.mode)},title:(0,W.Z)("calendar","Today")}),(0,zn.jsx)(oa.ZP,{className:"button-narrow",onClick:u,tooltip:w,image:Kn.Zu.medium})]})]}),(0,zn.jsxs)("div",{className:`DatePickerPopup-Contents ${x}`,onAnimationEnd:function(e){const t=e.target;x&&t instanceof s&&t.classList.remove(x)},children:[("day"===r||"week"===r)&&(0,zn.jsx)(sE,{events:[],month:d,onSelect:p,selectedDate:d,showOutOfMonthDays:!0,showWeekNumber:!0,showWeekDays:!0,highlightMode:"week"===r?"week":"day",fixedHeight:!0}),"month"===r&&(0,zn.jsx)("div",{className:"DatePickerPopup-YearMonths",children:V().months().map(((t,s)=>{const n=s===e.initialPeriod.month()&&e.initialPeriod.year()===d.year(),i=s===d.month();return(0,zn.jsx)("div",{className:Gn()("DatePickerPopup-YearMonth",{"DatePickerPopup-YearMonth--Selected":i,"DatePickerPopup-YearMonth--Highlighted":n}),"data-period":s,onClick:m,children:t},t)}))}),"year"===r&&(0,zn.jsx)("div",{className:"DatePickerPopup-YearMonths",children:(0,NT.Z)(v,v+12).map((t=>{const s=t===e.initialPeriod.year(),n=t===d.year();return(0,zn.jsx)("div",{className:Gn()("DatePickerPopup-YearMonth",{"DatePickerPopup-YearMonth--Selected":n,"DatePickerPopup-YearMonth--Highlighted":s}),"data-period":t,onClick:m,children:t},t)}))})]},I)]})};const jH=function(e){const[t,s]=Un.useState(!1),n=(0,Eo.Z)([Z.kKeyboardTabToAll]),i=Un.useContext(oi.Z),a=Un.useRef(),o=Un.useRef(),r=Un.useRef(0),[l,d]=Un.useState("full"),c=Un.useCallback((e=>{o.current||(o.current=i.requestAnimationFrame((()=>{const t=e?.querySelector("h1").childNodes[0];if(e&&t){const s=e.getBoundingClientRect().width,n=document.createRange();n.setStart(t,0),n.setEnd(t,t.textContent.length-1);n.getClientRects().length>=2&&"full"===l?(d("compact"),r.current=s+5):s>r.current&&d("full")}o.current=null})))}),[i,l]);function h(){s(!1)}function u(e){if("number"==typeof e.keyCode){const t=JS.Z[e.keyCode];if(e.repeat||"Space"!==t&&"Enter"!==t||e.target!==e.currentTarget)return}s(!t)}Un.useEffect((()=>{const e=a.current?.parentElement;if(!e)return;const t=new i.ResizeObserver((function(){c(e)}));return t.observe(e),()=>{e&&t.unobserve(e)}}),[a,c,i]),Un.useEffect((()=>{function t(t){if(t!==i.vivaldiWindowId)return;const{area:n}=Xe.Z.getContext(i.vivaldiWindowId);(!e.inPanel&&"panel"!==n||e.inPanel&&"panel"===n)&&s(!0)}return go.Z.addListener("COMMAND_CALENDAR_GOTO_DATE",t),()=>{go.Z.removeListener("COMMAND_CALENDAR_GOTO_DATE",t)}}),[e.inPanel,i]);const p="full"===l?"ll":F.ZP.getShortDateFormat();let g,m;switch(e.displayMode){case"year":m="year",g=e.startDate.year();break;case"month":m="month",g=(0,W.Z)("$1 $2",[e.initialPeriod.format("MMMM"),e.initialPeriod.format("YYYY")]);break;case"multiweek":case"week":m="week",g=(0,W.Z)("$1 – $2",[e.startDate.format(p),e.endDate?.format(p)??""]);break;case"day":m="day",g=V()(e.startDate).format("LL");break;case"agenda":m="day",g=(0,W.Z)("$1 – $2",[e.startDate.format(p),e.endDate?.format(p)??""]);break;default:m="day"}return(0,zn.jsxs)("div",{ref:a,className:"PeriodPicker no-page-focus",onKeyDown:u,onMouseDown:u,tabIndex:n[Z.kKeyboardTabToAll],children:[(0,zn.jsx)("h1",{children:g}),(0,zn.jsx)(oa.ZP,{tooltip:(0,W.Z)("Select calendar view period from a yearly calendar"),label:(0,W.Z)("Period Selector"),popupLabel:(0,W.Z)("Period Selector"),popupPosition:"below",image:Kn.yaZ.small,onClick:u,hidePopup:h,isPopupVisible:t,popupWidth:300,outsideClickIgnoreClass:"PeriodPicker",tabIndex:-1,children:(0,zn.jsx)(OH,{initialPeriod:e.initialPeriod,setPeriod:e.setPeriod,mode:m,requestClose:h})})]})};var LH=s(34155);const RH=(0,aT.extendMoment)(V()),{minimalCreateEvent:BH,doesCalendarsExistsAndShowWarning:FH}=_r.ZP,WH=[Z.kCalendarDisplayDensity,Z.kCalendarDisplayWeekNumber,Z.kFeaturesCalendar];function UH(){I.Z.set(Z.kCalendarDisplayDensity,"minimal")}function VH(){I.Z.set(Z.kCalendarDisplayDensity,"compact")}function HH(){I.Z.set(Z.kCalendarDisplayDensity,"full")}const GH=mF((function(e){const t=Un.useContext(oi.Z),{vivaldiWindowId:s}=t,n=Un.useRef(),{pageId:i}=e,[a,o]=Un.useState(A.Z.get(Z.kCalendarShowDaySidebar)),[r,l]=Un.useState(A.Z.get(Z.kCalendarShowTasksSidebar)),[d,c]=Un.useState(!1),h=(0,Eo.Z)(WH),{stateHandler:u,calendarFilter:p,accounts:g,calendars:m,events:f,eventDraft:v,trashedEvents:b}=cH(i),{displayMode:C,anchorDate:w,selectedDate:y,filterText:x}=p,S=["week","multiweek","month","year"].includes(C)&&(!0===a||"year"===C)||"agenda"===C&&r;Un.useEffect((()=>()=>{LH.nextTick((()=>u.endEventEdit()))}),[s,i,u,t.selectWindow]),Un.useEffect((()=>{A.Z.get(Z.kCalendarOnboardingShown)||LH.nextTick((()=>{!Pr.Z.getAccounts().some((e=>"local"!==e.account_type))&&ue.Z.showCalendarAccountDialog(t.vivaldiWindowId)}))}),[t]),Un.useEffect((()=>{const e=t.document.activeElement;if(!n.current||n.current?.contains(e))return;const s=t.document.getElementById("browser")?.querySelector(".DatePickerPopup");s?.contains(e)||n.current?.querySelector(".calendar-grid")?.focus()}),[C,t.document]);const T=!!v,E=h[Z.kCalendarDisplayDensity],k=Un.useMemo((()=>({pageId:e.pageId,displayDensity:E,isPanel:!1,isEditing:T,isWidget:!1,handler:u})),[E,u,e.pageId,T]);function N(e){TZ.Z.setViewMode(i,e)}function _(e){v&&u.endEventEdit(),TZ.Z.selectDate(i,e)}function P(){x&&TZ.Z.search(i,""),c(!1)}function M(e){const t=Pr.Z.getEvent(e);t&&TZ.Z.selectEvent(i,{event:t,allDay:t.allDay})}if(!h[Z.kFeaturesCalendar])return(0,zn.jsx)(Mw,{windowId:t.vivaldiWindowId});d&&!x&&P();const D=_r.ZP.getDisplayRange(w,C),O=!!x&&(["agenda","year"].includes(C)?0===f.length:f.every((e=>!0===e.filteredOut)));let j="";if(y&&h[Z.kCalendarDisplayWeekNumber])if("day"===C)j=(0,W.Z)("Week $1",[y.week()]);else if("week"===C)j=(0,W.Z)("Week $1",[y.week()]);else if("multiweek"===C){const{start:e,end:t}=D;j=(0,W.Z)("Weeks $1 - $2",[e.week(),t.week()])}else if("month"===C){const e=RH(w);j=(0,W.Z)("Weeks $1 - $2",[e.startOf("month").week(),e.endOf("month").week()])}else if("agenda"===C){const{start:e,end:t}=D;j=(0,W.Z)("Weeks $1 - $2",[e.week(),t.week()])}return(0,zn.jsx)(Zo.Z,{focusName:"focus_calendar",noInitialFocus:!0,children:(0,zn.jsxs)("div",{className:"manager calendar",onClick:function(e){e.stopPropagation(),v&&u.endEventEdit()},ref:n,children:[(0,zn.jsxs)("div",{className:"toolbar toolbar-default",role:"toolbar","aria-label":(0,W.Z)("toolbar label","Calendar"),children:[(0,zn.jsx)(oa.ZP,{onClick:function(){if(!FH(s))return;const e=p.selectedDate?.valueOf()??0;ie.ZP.addEventCommand(t.vivaldiWindowId,BH({start:e}))},title:(0,W.Z)("New Event"),image:Kn.md4.small,commandId:"COMMAND_ADD_CALENDAR_EVENT"}),(0,zn.jsx)(EH,{accounts:g,calendars:m}),(0,zn.jsxs)("div",{className:"toolbar-group",style:{marginLeft:"auto"},children:[(0,zn.jsx)("span",{className:"density-label",children:(0,W.Z)("calendar","View")}),(0,zn.jsx)(oa.ZP,{tooltip:(0,W.Z)("Minimal view"),isPressed:"minimal"===E,onClick:UH,image:Kn.NBh.small}),(0,zn.jsx)(oa.ZP,{tooltip:(0,W.Z)("Compact view"),isPressed:"compact"===E,onClick:VH,image:Kn.EEk.small}),(0,zn.jsx)(oa.ZP,{tooltip:(0,W.Z)("Full view"),isPressed:"full"===E,onClick:HH,image:Kn.Bd5.small})]}),(0,zn.jsx)(MH,{filterText:x,onSearchChange:function(e){TZ.Z.search(i,e)},onSelectEvent:M,onShowSearchResults:function(){c(!0)}})]}),(0,zn.jsxs)("div",{className:"toolbar toolbar-default",role:"toolbar","aria-label":(0,W.Z)("toolbar label","Display Period"),children:[(0,zn.jsxs)("div",{className:"toolbar-group",style:{marginRight:"auto"},children:[(0,zn.jsx)(oa.ZP,{className:"button-narrow",onClick:function(){TZ.Z.viewPreviousPeriod(e.pageId)},tooltip:(0,W.Z)("Previous"),image:Kn.mgF.small}),(0,zn.jsx)(oa.ZP,{onClick:function(){_(RH((0,Kc.zX)(Date.now())))},disabled:!!y&&(0,Kc.KC)(y.toDate(),new Date),title:(0,W.Z)("calendar","Today")}),(0,zn.jsx)(oa.ZP,{className:"button-narrow",onClick:function(){TZ.Z.viewNextPeriod(e.pageId)},tooltip:(0,W.Z)("Next"),image:Kn.Zu.small})]}),(0,zn.jsx)(jH,{initialPeriod:w,setPeriod:_,startDate:D.start,endDate:D.end,displayMode:C,inPanel:!1}),j&&(0,zn.jsx)("p",{className:"weeks",children:j}),(0,zn.jsxs)("div",{className:"toolbar-group",style:{marginLeft:"auto"},children:[(0,zn.jsx)(oa.ZP,{onClick:()=>N("day"),title:(0,W.Z)("Day"),tooltip:(0,W.Z)("Day (d)"),isPressed:"day"===C}),(0,zn.jsx)(oa.ZP,{onClick:()=>N("week"),title:(0,W.Z)("Week"),tooltip:(0,W.Z)("Week (w)"),isPressed:"week"===C}),(0,zn.jsx)(oa.ZP,{onClick:()=>N("multiweek"),title:(0,W.Z)("Multiweek"),tooltip:(0,W.Z)("Multiweek (n)"),isPressed:"multiweek"===C}),(0,zn.jsx)(oa.ZP,{onClick:()=>N("month"),title:(0,W.Z)("Month"),tooltip:(0,W.Z)("Month (m)"),isPressed:"month"===C}),(0,zn.jsx)(oa.ZP,{onClick:()=>N("year"),title:(0,W.Z)("Year"),tooltip:(0,W.Z)("Year (y)"),isPressed:"year"===C}),(0,zn.jsx)(oa.ZP,{onClick:()=>N("agenda"),title:(0,W.Z)("Agenda"),tooltip:(0,W.Z)("Agenda (a)"),isPressed:"agenda"===C})]}),(0,zn.jsxs)("div",{className:"toolbar-group",children:[(0,zn.jsx)(wH,{trashedEvents:b}),(0,zn.jsx)(oa.ZP,{onClick:function(){"agenda"===p.displayMode?l((e=>(I.Z.set(Z.kCalendarShowTasksSidebar,!e),!e))):o((e=>(I.Z.set(Z.kCalendarShowDaySidebar,!e),!e)))},disabled:"day"===C||"year"===C,tooltip:(0,W.Z)("Show Sidebar"),isPressed:"agenda"===C?r:a||"year"===C,image:Kn.S8w.small})]})]}),!d&&O&&(0,zn.jsx)("div",{className:"no-search-results",children:(0,zn.jsx)(fa,{type:"info",children:(0,W.Z)("Showing filtered results. Press “Search” for full results.")})}),(0,zn.jsxs)("div",{className:`manager-view ${C}`,children:[d&&(0,zn.jsx)(vH,{selectedEvent:p.selectedEvent,onSelectEvent:M,filterText:x,onClose:P,editingEvent:v}),!d&&(0,zn.jsx)("div",{className:"manager-content",children:(0,zn.jsx)(WS.Provider,{value:k,children:(0,zn.jsx)(gE,{filter:p,events:f,trashedEvents:b,editingEvent:v})})}),S&&(0,zn.jsx)(gH,{anchorDate:y||w,displayMode:C,pageId:i})]})]})})})),KH=Un.createContext({onMoveItem:nr.Z,onDrop:nr.Z,findItem:nr.Z,viewWidth:812,columns:2,onMoveNew:nr.Z,animate:!1}),zH=Ci()((e=>"double_height"===e?{height:2,width:1}:{height:1,width:1}),{maxSize:2}),$H=zH;function YH(e){return e.startsWith("#")}function XH(e,t,s,n,i,a){const o=[{type:"separator",label:"",labelEnglish:""}];return i&&i.length>1&&o.push({items:[{type:"checkbox",checked:"regular"===s,handler:()=>O(e,"regular"),...(0,fi.Z)("Regular")},{type:"checkbox",checked:"double_height"===s,handler:()=>O(e,"double_height"),...(0,fi.Z)("Tall")}],...(0,fi.Z)("Widget Size")}),o.push({items:[{type:"checkbox",checked:"solid"===n,handler:()=>j(e,b.bz),...(0,fi.Z)("Solid")},{type:"checkbox",checked:"semi-transparent"===n,handler:()=>j(e,b.UQ),...(0,fi.Z)("Semi-Transparent")},{type:"checkbox",checked:"transparent"===n,handler:()=>j(e,b.Au),...(0,fi.Z)("Transparent")},{type:"checkbox",checked:YH(n),handler:()=>a(),...(0,fi.Z)("Custom")}],...(0,fi.Z)("Background Style")}),o.push({handler:()=>{var s;s=e,S.Z.dispatch({actionType:"DASHBOARD_REMOVE_WIDGET",widgetId:s}),x.Z.closeAssociatedTabsByWidget(s),"sticky-note"===t&&function(e){S.Z.dispatch({actionType:"STICKY_NOTE_REMOVE",widgetId:e})}(e)},...(0,fi.Z)("Remove Widget")}),o}const QH=[Z.kThemeUseAnimation];function qH({id:e,index:t,type:s,title:n,className:i,children:a,getMenu:o,hideMenu:r=!1,size:l,background:d,sizeOptions:c}){const h=(0,Eo.Z)(QH),u=Un.useContext(oi.Z),p=Un.useContext(KH),g=Un.useRef(),m=Un.useRef(),f=Un.useRef(),{viewWidth:v,columns:C,animate:w}=p;Un.useEffect((()=>{function e(){f.current&&(f.current.disabled=!0)}return u.document.addEventListener("mousedown",e),()=>u.document.removeEventListener("mousedown",e)}),[u]);const[y,x]=Un.useMemo((()=>YH(d)?[d,b.sg]:["",d]),[d]),[{isDragging:I},A,S]=(0,XB.c)((()=>({type:b.Zg,item:{id:e},collect:e=>({isDragging:e.isDragging()})})),[]),[,T]=(0,QB.L)((()=>({accept:b.Zg,hover:(t,s)=>{t.id!==e&&p.onMoveItem(t.id,e)},drop:p.onDrop})),[]),[,E]=(0,QB.L)((()=>({accept:b.qk,hover:(t,s)=>{p.onMoveNew(e,t.type)},drop:p.onDrop})),[]),k=Un.useCallback((()=>{const t=XH(e,s,l,d,c,(function(){const e=f.current;e&&(e.disabled=!1,e.click())}));return o?o().concat(t):t}),[d,o,e,l,c,s,f]),N=Un.useCallback(((e,t)=>{const s=e%C,n=Math.round(s*(t+b.cX));return w&&h[Z.kThemeUseAnimation]?uF(n,b.Y3):n}),[C,w,h]),_=Un.useCallback((e=>{const t=Math.floor(e/C),s=Math.round(t*(b.EE+b.cX));return w&&h[Z.kThemeUseAnimation]?uF(s,b.Y3):s}),[C,w,h]),{height:P}=$H(l),M=Un.useMemo((()=>Math.min((v-b.cX)/C,b.V9)),[v,C]),D=Un.useMemo((()=>P>1?b.EE*P+b.cX*(P-1):b.EE),[P]),O=b.sB[s];if(!O)return console.warn("No defaults have been created for this widget type."),null;const L=(0,Te.Z)((t=>j(e,t.target.value)),200,{leading:!0});return A(g),S(T(m)),E(m),(0,zn.jsx)(lF,{style:{posX:N(t,M),posY:_(t)},children:({posX:e,posY:t})=>(0,zn.jsxs)("div",{ref:m,className:Gn()("dashboard-widget",i,l,x),style:{opacity:I?0:1,height:D,width:M,position:"absolute",transform:`translate3d(${e}px, ${t}px, 0)`,backgroundColor:y},children:[(0,zn.jsx)("div",{className:"dashboard-widget-header",children:(0,zn.jsxs)("h1",{ref:g,className:"title",children:[(0,zn.jsx)("span",{children:n??O.defaultTitle}),(0,zn.jsx)("input",{ref:f,type:"color",disabled:!0,...Boolean(y)&&{value:y},onChange:L}),!r&&(0,zn.jsx)(oa.ZP,{className:"dashboard-widget-menubutton",image:Kn.VZO,menu:k,menuOrigin:"bottomLeft",tooltip:(0,W.Z)("Open menu")})]})}),a]})},e)}const JH=e=>{const{children:t,...s}=e;return(0,zn.jsx)(Kd,{level:"tabs",children:(0,zn.jsx)(qH,{...s,children:t})})},eG=["regular","double_height"],tG=[Z.kCalendarDisplayDensity];function sG(e){const t=Un.useContext(oi.Z),[s,n]=Un.useState([]),i=(0,Eo.Z)(tG),a=t.vivaldiWindowId,o=Un.useMemo((()=>Ze.ZP.getActivePage(a)?.id??-1),[a]),r=Un.useMemo((()=>({filter:{...(0,lH.l)(),displayMode:"agenda",showTasks:!1,calendarIds:new Set(e.calendarIds)}})),[e.calendarIds]),{stateHandler:l,calendarFilter:d,eventDraft:c,trashedEvents:h,events:u}=cH(o,r);Un.useEffect((()=>{TZ.Z.setViewMode(o,"agenda",{save:!1})}),[o]),Un.useEffect((()=>{function e(){Pr.Z.isInitialized()?n(function(){const e=Pr.Z.getAccounts(),t=Pr.Z.getVisibleCalendars();return e.reduce(((e,s)=>{const n=t.filter((e=>e.accountId===s.id&&e.supportedCalendarComponent.vevent));return n.length>0&&e.push({account:s,calendars:n}),e}),[]).sort(((e,t)=>"local"===e.account.account_type?-1:"local"===t.account.account_type?1:0))}()):setTimeout(e,500)}return Pr.Z.addListener(e),e(),()=>Pr.Z.removeListener(e)}),[e.calendarIds]);const p=Un.useMemo((()=>new Set(e.calendarIds)),[e.calendarIds]),g=Un.useRef(p),m=Un.useCallback(((t,n)=>{if(n){const n=new Set(g.current);0===n.size?s.forEach((({calendars:e})=>{e.forEach((e=>{e.id!==t&&n.add(e.id)}))})):n.has(t)?n.delete(t):n.add(t),g.current=n,l.selectCalendars(n),function(e,t){S.Z.dispatch({actionType:"DASHBOARD_UPDATE_WIDGET",widgetId:e,calendarIds:t})}(e.id,n)}return g.current.has(t)}),[s,e.id,l]),f=Un.useCallback((()=>[{items:s.flatMap((({account:e,calendars:t})=>{const s=[{isEnabled:iy.Z,label:e.name,labelEnglish:e.name}];return t.reduce(((e,t)=>(e.push({type:"checkbox",persistent:!0,checked:p.has(t.id)||0===p.size,checkedHandler:(e,s)=>Promise.resolve(m(t.id,s)),label:t.description??(0,W.Z)("Unnamed calendar"),labelEnglish:t.description??"Unnamed calendar"}),e)),s)})),...(0,fi.Z)("Select Calendars")}]),[s,p,m]),v=Un.useMemo((()=>({pageId:o,displayDensity:i[Z.kCalendarDisplayDensity],isPanel:!1,isEditing:!1,isWidget:!0,handler:l})),[o,i,l]);return(0,zn.jsx)(JH,{id:e.id,index:e.index,type:"calendar",size:e.size,sizeOptions:eG,background:e.background,keyAccess:e.keyAccess,getMenu:f,className:"Dashboard-CalendarWidget",children:(0,zn.jsxs)("div",{className:"scrollable",children:[0===u.length&&(0,zn.jsx)("div",{className:"widget-image-intro",children:(0,zn.jsx)("span",{className:"icon",dangerouslySetInnerHTML:{__html:Kn.Ase["regular"===e.size?"medium":"large"]}})}),(0,zn.jsx)(WS.Provider,{value:v,children:(0,zn.jsx)(gE,{filter:d,events:u,trashedEvents:h,editingEvent:c,displayMode:"agenda",eventDisplayStyle:"transparent"})})]})})}const nG=Un.memo(sG),iG=[{id:"HUF",name:(0,W.Z)("Hungarian forint")},{id:"DKK",name:(0,W.Z)("Danish krone")},{id:"CZK",name:(0,W.Z)("Czech koruna")},{id:"CAD",name:(0,W.Z)("Canadian dollar")},{id:"BRL",name:(0,W.Z)("Brazilian real")},{id:"VND",name:(0,W.Z)("Vietnamese dong")},{id:"BYN",name:(0,W.Z)("Belarusian new rouble")},{id:"TWD",name:(0,W.Z)("New Taiwan dollar")},{id:"SGD",name:(0,W.Z)("Singapore dollar")},{id:"SEK",name:(0,W.Z)("Swedish krona")},{id:"RUB",name:(0,W.Z)("Russian rouble")},{id:"PHP",name:(0,W.Z)("Philippine peso")},{id:"MMK",name:(0,W.Z)("Myanmar kyat")},{id:"KRW",name:(0,W.Z)("South Korean won")},{id:"IDR",name:(0,W.Z)("Indonesian rupiah")},{id:"ILS",name:(0,W.Z)("Israeli new shekel")},{id:"TRY",name:(0,W.Z)("Turkish lira")},{id:"GBP",name:(0,W.Z)("Pound sterling")},{id:"HKD",name:(0,W.Z)("Hong Kong dollar")},{id:"RON",name:(0,W.Z)("New Romanian leu")},{id:"CNY",name:(0,W.Z)("Chinese yuan")},{id:"PKR",name:(0,W.Z)("Pakistani rupee")},{id:"NZD",name:(0,W.Z)("New Zealand dollar")},{id:"MXN",name:(0,W.Z)("Mexican peso")},{id:"JPY",name:(0,W.Z)("Japanese yen")},{id:"BDT",name:(0,W.Z)("Bangladeshi taka")},{id:"USD",name:(0,W.Z)("US dollar")},{id:"THB",name:(0,W.Z)("Thai baht")},{id:"INR",name:(0,W.Z)("Indian rupee")},{id:"PLN",name:(0,W.Z)("Polish zloty")},{id:"AUD",name:(0,W.Z)("Australian dollar")},{id:"MYR",name:(0,W.Z)("Malaysian ringgit")},{id:"EUR",name:(0,W.Z)("Euro")},{id:"CHF",name:(0,W.Z)("Swiss franc")},{id:"BGN",name:(0,W.Z)("Bulgarian lev")},{id:"HRK",name:(0,W.Z)("Croatian kuna")},{id:"ISK",name:(0,W.Z)("Icelandic krona")},{id:"ZAR",name:(0,W.Z)("South African rand")},{id:"NOK",name:(0,W.Z)("Norwegian krone")}];iG.sort(((e,t)=>e.id.localeCompare(t.id)));const aG=["USD","EUR","JPY","GBP","CNY","AUD"];const oG=new class{#Xt;#Qt;#qt;constructor(){this.#Xt=new Map([["NOK",[1,0]]]),this.#Qt=[],this.#qt={}}async fetchFromApi(e,t){const s=["https://data.norges-bank.no/api/data/EXR/B.",e.join("+"),".NOK.SP?format=sdmx-json&lastNObservations=",t,"&locale=en"].join(""),n=await fetch(s),i=await n.json();return{dataSet:i.data.dataSets[0].series,currencies:i.data.structure.dimensions.series.find((e=>"BASE_CUR"===e.id))?.values.map((e=>e.id))??[],decimals:i.data.structure.attributes.series.find((e=>"DECIMALS"===e.id))?.values.map((e=>parseFloat(e.id)))??[],unitMultipliers:i.data.structure.attributes.series.find((e=>"UNIT_MULT"===e.id))?.values.map((e=>parseFloat(e.id)))??[]}}async getCurrent(e){if(e.every((e=>this.#Xt.has(e))))return this.#Xt;{const{dataSet:t,currencies:s,decimals:n,unitMultipliers:i}=await this.fetchFromApi(e,1);return s.forEach(((e,s)=>{const a=Object.values(t[`0:${s}:0:0`].observations)[0][0]/Math.pow(10,i[s]??i.at(-1));this.#Xt.set(e,[a,n[s]??n.at(-1)])})),this.#Xt}}async getChartData(e,t){const s=`${e}+${t}`;if(this.#qt[s])return this.#qt[s];const{dataSet:n,currencies:i,unitMultipliers:a,decimals:o}=await this.fetchFromApi([e,t],30),r=i.indexOf(e),l=i.indexOf(t),d="NOK"===e?[...Array(30)].map((e=>1)):Object.values(n[`0:${r}:0:0`].observations).map((e=>e[0]/Math.pow(10,a[r]??a.at(-1)))),c="NOK"===t?[...Array(30)].map((e=>1)):Object.values(n[`0:${l}:0:0`].observations).map((e=>e[0]/Math.pow(10,a[l]??a.at(-1)))),h={values:d.map(((e,t)=>e/c[t])),decimals:Math.max(...o)};return this.#qt[s]=h,h}async getTrends(){if(this.#Qt.length>0)return{trends:this.#Qt,rates:this.#Xt};const{dataSet:e,currencies:t,decimals:s,unitMultipliers:n}=await this.fetchFromApi(aG,2),i={},a=[];for(let o=0;o<t.length;o++)for(let r=0;r<t.length;r++){if(o===r)continue;const l=t[o],d=t[r];i[l]||(i[l]=Object.values(e[`0:${o}:0:0`].observations).map((e=>e[0]/Math.pow(10,n[o]??n.at(-1))))),i[d]||(i[d]=Object.values(e[`0:${r}:0:0`].observations).map((e=>e[0]/Math.pow(10,n[r]??n.at(-1))))),a.push([`${l}+${d}`,i[l][1]/i[d][1]-i[l][0]/i[d][0]]),this.#Xt.set(l,[i[l][1],s[o]??s.at(-1)]),this.#Xt.set(d,[i[d][1],s[r]??s.at(-1)])}return this.#Qt=a,{trends:this.#Qt,rates:this.#Xt}}};var rG=s(97891),lG=s(38775),dG=s(85871);const cG={top:6,bottom:25,left:40},hG={top:6,bottom:40,left:40},uG={x:"time",y:"linear"},pG={axis:{stroke:"var(--colorFg)"},axisLabel:{fontSize:12,padding:20},grid:{stroke:"var(--colorFgAlpha)"},tickLabels:{fill:"var(--colorFg)",angle:0,textAnchor:"end",fontSize:12,padding:5,fontWeight:400,fontFamily:"inherit"}},gG={...pG,tickLabels:{...pG.tickLabels,angle:-45}},mG={axis:{stroke:"var(--colorFg)"},axisLabel:{fontSize:12},grid:{stroke:"var(--colorFgAlpha)"},ticks:{stroke:"var(--colorFg)"},tickLabels:{fill:"var(--colorFg)",fontSize:10,padding:3,fontFamily:"inherit"}},fG={data:{stroke:"var(--colorHighlightBg)"}};var vG=(0,zn.jsx)(rG.y,{constrainToVisibleArea:!0,flyoutStyle:{stroke:"var(--colorBorderSubtle)",fill:"var(--colorBgLightIntense)"},style:{fill:"var(--colorHighlightBgDark)"}});function bG(e){const[t,s]=Un.useState(),[n,i]=Un.useState(0),a="double_height"===e.size;Un.useEffect((()=>{!async function(){const t=await oG.getChartData(e.currencyA,e.currencyB);s(t),i(t.values.length)}()}),[e.currencyA,e.currencyB]);const o=Un.useMemo((()=>{const e=new Date,t=[];for(let s=0;s<n;s++)t.unshift(new Date(e.setDate(e.getDate()-1)));return t}),[n]),r=Un.useMemo((()=>t?.values.map(((e,t)=>({x:o[t],y:e})))),[t,o]),l=Un.useMemo((()=>{let e;if(t){const s=t.values.reduce(((e,t)=>Math.max(e,t)),-1),[n,i]=s.toFixed(t.decimals).split("."),a=6;e=n.length>a?0:n.length>1?a-n.length:Math.min(i.length,a)}return t=>t.toFixed(e)}),[t]),d=Un.useMemo((()=>e=>V()(e).format(a?"MMM D":"D")),[a]),c=Un.useMemo((()=>({datum:s})=>`${V()(s.x).format("L")}\n1 ${e.currencyA} = ${s.y.toFixed(t?.decimals)} ${e.currencyB}`),[t?.decimals,e.currencyA,e.currencyB]);return r?(0,zn.jsx)("div",{children:(0,zn.jsxs)($h.k,{height:a?310:120,padding:a?hG:cG,scale:uG,format:!0,containerComponent:(0,zn.jsx)(lG.i6,{voronoiDimension:"x",labels:c,labelComponent:vG}),children:[(0,zn.jsx)(zh.E,{tickCount:n,tickFormat:d,standalone:!1,style:a?gG:pG,fixLabelOverlap:!0}),(0,zn.jsx)(zh.E,{dependentAxis:!0,standalone:!1,style:mG,fixLabelOverlap:!0,tickFormat:l}),(0,zn.jsx)(dG.j,{style:fG,data:r})]})}):null}function CG({converterState:e,dispatch:t,showError:s,widgetId:n,currencyA:i,currencyB:a}){const o=Un.useCallback((e=>{L(n,e.target.value,a)}),[a,n]),r=Un.useCallback((e=>{L(n,i,e.target.value)}),[i,n]);return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("form",{className:"converter",children:[(0,zn.jsxs)("div",{className:"input-group",children:[(0,zn.jsx)("input",{type:"number",id:"amountA",placeholder:"Amount",value:e.amountA,onChange:function(e){t({type:"setAmountA",value:e.target.value,currencyA:i,currencyB:a})},onFocus:e=>e.target.select()}),(0,zn.jsx)("input",{type:"number",id:"amountB",placeholder:"Amount",value:e.amountB,onChange:function(e){t({type:"setAmountB",value:e.target.value,currencyA:i,currencyB:a})},onFocus:e=>e.target.select()})]}),(0,zn.jsx)("div",{className:"switch",children:(0,zn.jsx)("button",{id:"switch-btn",onClick:function(){L(n,a,i)},children:(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn._lj}})})}),(0,zn.jsxs)("div",{className:"input-group",children:[(0,zn.jsx)(Fa.Z,{id:"currencyA",name:"currencyA",onChange:o,value:i,children:iG.filter((e=>e.id!==a)).map((({id:e,name:t})=>(0,zn.jsxs)("option",{value:e,children:[e," ",t]},`${i}-${e}`)))}),(0,zn.jsx)(Fa.Z,{id:"currencyB",name:"currencyB",onChange:r,value:a,children:iG.filter((e=>e.id!==i)).map((({id:e,name:t})=>(0,zn.jsxs)("option",{value:e,children:[e," ",t]},`${a}-${e}`)))})]})]}),s&&(0,zn.jsx)("div",{className:"error",children:(0,W.Z)("Failed to fetch exchange rates.")})]})}const wG=["EUR+USD","EUR+JPY","EUR+GBP","USD+EUR","USD+JPY","GBP+JPY"],yG=[...wG,"USD+CNY","EUR+CNY","JPY+CNY","GBP+CNY","USD+AUD","EUR+AUD","JPY+AUD","GBP+AUD"];function xG(e){const[t,s]=Un.useState([]),n="double_height"===e.size;return Un.useEffect((()=>{!async function(){const{trends:e,rates:t}=await oG.getTrends(),i=n?yG:wG,a=e.filter((([e])=>i.includes(e))).map((([e,s])=>{const[n,i]=e.split("+"),[a,o]=[t.get(n),t.get(i)];return{id:`${n} / ${i}`,trend:s,rate:a&&o?(a[0]/o[0]).toFixed(Math.max(4,a[1],o[1])):"0"}}));s(a)}()}),[n]),(0,zn.jsx)("ul",{className:"currency-overview",children:t.map((({id:e,trend:t,rate:s})=>(0,zn.jsxs)("li",{children:[(0,zn.jsx)("div",{className:"arrow "+(t<0?"down":"up"),children:(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.KUb}})}),(0,zn.jsxs)("div",{className:"name-and-rate",children:[(0,zn.jsx)("div",{children:e}),(0,zn.jsx)("div",{children:s})]}),(0,zn.jsxs)("div",{className:"trend",children:[Math.abs(t).toFixed(2),"%"]})]},e)))})}function IG(){const e=Un.useContext(oi.Z),t="https://www.norges-bank.no/en";return(0,zn.jsxs)("div",{className:"provider",children:[(0,W.Z)("Data from")," ",(0,zn.jsx)("a",{className:"external-link",href:t,onClick:s=>{s.preventDefault(),s.stopPropagation(),c.ZP.openURL(e.vivaldiWindowId,t,{singleton:!0})},children:"Norges Bank"})]})}function AG(e,t){switch(t.type){case"setRates":{const[s,n]=[t.value.get(t.currencyA),t.value.get(t.currencyB)];if(s&&n)return{...e,rates:t.value,amountB:(parseFloat(e.amountA)*s[0]/n[0]).toFixed(Math.max(4,s[1],n[1]))}}break;case"setAmountA":{const[s,n]=[e.rates?.get(t.currencyA),e.rates?.get(t.currencyB)];if(s&&n)return{...e,amountA:t.value,amountB:(parseFloat(t.value)*s[0]/n[0]).toFixed(Math.max(4,s[1],n[1]))}}break;case"setAmountB":{const[s,n]=[e.rates?.get(t.currencyA),e.rates?.get(t.currencyB)];if(s&&n)return{...e,amountA:(parseFloat(t.value)*n[0]/s[0]).toFixed(Math.max(4,s[1],n[1])),amountB:t.value}}}return e}const SG=["regular","double_height"];var ZG=(0,zn.jsx)(IG,{}),TG=(0,zn.jsx)(IG,{});function EG(e){const{currencyA:t,currencyB:s}=e,n=Un.useId(),i=Un.useId(),a=Un.useId(),[o,r]=Un.useReducer(AG,{rates:void 0,amountA:"1",amountB:""}),[l,d]=Un.useState(!1);return Un.useEffect((()=>{d(!1),async function(){try{const e=await oG.getCurrent([t,s]);e&&r({type:"setRates",value:e,currencyA:t,currencyB:s})}catch(e){console.error(e),d(!0)}}()}),[t,s]),(0,zn.jsx)(JH,{id:e.id,index:e.index,type:"currency",size:e.size,sizeOptions:SG,background:e.background,keyAccess:e.keyAccess,className:"Dashboard-CurrencyWidget",children:"double_height"===e.size?(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)(CG,{converterState:o,dispatch:r,showError:l,widgetId:e.id,currencyA:t,currencyB:s}),(0,zn.jsxs)(aM,{activeTabId:i,className:`doubleHeight ${YH(e.background)?b.sg:e.background}`,children:[(0,zn.jsx)("div",{id:i,label:(0,W.Z)("Currencies"),children:(0,zn.jsx)(xG,{size:e.size})}),(0,zn.jsx)("div",{id:a,label:(0,W.Z)("Chart"),children:(0,zn.jsx)(bG,{currencyA:t,currencyB:s,size:e.size})})]}),ZG]}):(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)(aM,{activeTabId:n,className:YH(e.background)?b.sg:e.background,children:[(0,zn.jsx)("div",{id:n,label:(0,W.Z)("Convert"),children:(0,zn.jsx)(CG,{converterState:o,dispatch:r,showError:l,widgetId:e.id,currencyA:t,currencyB:s})}),(0,zn.jsx)("div",{id:i,label:(0,W.Z)("Currencies"),children:(0,zn.jsx)(xG,{size:e.size})}),(0,zn.jsx)("div",{id:a,label:(0,W.Z)("Chart"),children:(0,zn.jsx)(bG,{currencyA:t,currencyB:s,size:e.size})})]}),TG]})})}function kG(e="minutes"){const[t,s]=Un.useState(new Date);return Un.useEffect((()=>{function t(e){s(e)}return Wh.addListener(e,t),()=>Wh.removeListener(t)}),[e]),t}function NG(e){const t=V()(kG("minutes"));return(0,zn.jsx)(JH,{id:e.id,index:e.index,type:"date",size:e.size,background:e.background,keyAccess:e.keyAccess,className:"Dashboard-Date",children:(0,zn.jsxs)("div",{className:"date-wrapper",children:[(0,zn.jsx)("p",{className:"day-display",children:t.format("dddd")}),(0,zn.jsx)("p",{className:"date-display",children:(0,zn.jsx)("span",{className:"date",children:t.format("LL")})}),(0,zn.jsx)("p",{className:"week-display",children:(0,W.Z)("Week $1",[t.week()])}),(0,zn.jsx)("p",{className:"time-display",children:t.format("LT")})]})})}function _G(e){const{vivaldiWindowId:t}=Un.useContext(oi.Z),[s,n]=Un.useState(Nt.of),i=A.Z.get(Z.kMailAccounts),a=[Nt.of].concat(i.map((e=>e.MAIL_EMAIL)));return(0,zn.jsx)("form",{className:"widget-config",children:0===i.length?(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("div",{className:"widget-config-intro",children:[(0,zn.jsx)("span",{className:"icon",dangerouslySetInnerHTML:{__html:Kn.ms3[e.iconSize]}}),(0,zn.jsx)("p",{children:(0,W.Z)("Add your mail account first in order to view your recent messages.")})]}),(0,zn.jsx)("footer",{className:"widget-config-footer",children:(0,zn.jsx)("input",{type:"submit",value:(0,W.Z)("Add Mail Account"),onClick:()=>ue.Z.showMailAccountDialog(t)})})]}):(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("div",{className:"widget-config-content",children:[(0,zn.jsx)("span",{children:(0,W.Z)("Select Account:")}),(0,zn.jsx)(Fa.Z,{value:s,onChange:e=>{n(e.target.value)},children:a.map((e=>(0,zn.jsx)("option",{value:e,children:e},e)))})]}),(0,zn.jsx)("footer",{className:"widget-config-footer",children:(0,zn.jsx)("input",{type:"submit",value:(0,W.Z)("verb","Done"),onClick:()=>e.onChange(s)})})]})})}const PG=[Z.kCalendarRelativeDates],MG=["regular","double_height"],DG=[];var OG=(0,zn.jsx)("span",{}),jG=(0,zn.jsx)("hr",{});function LG(e){const t=Un.useContext(oi.Z),s=e.accountId||Nt.of,n=s===Nt.of?Nt.ik:Nt.Gf,[i,a]=Un.useState(qt.getList(s,n)||DG),[o,r]=Un.useState(!0),l=(0,Eo.Z)(PG),d=Un.useRef(e.accountId);Un.useEffect((()=>{function t(){if(qt.isInitialized()){d.current=e.accountId;const t=qt.getList(s,n);t&&a(t),r(!1)}}return qt.addListener(t),d.current!==e.accountId&&t(),()=>qt.removeListener(t)}),[i,e.accountId,s,n]);const c=Un.useCallback((()=>[{handler:()=>k(e.id,""),...(0,fi.Z)("Change Folder")}]),[e.id]);function h(e,s){const n=(0,fo.wJ)(t.vivaldiWindowId,e);n&&rs.Z.messages.get(s).then((e=>(0,bp.Z)(fe.ZP.getMailWindowId(),e,{inBackground:n.inBackground,inCurrent:!1,groupId:A.Z.get(Z.kTabsStackingOpenInCurrent)?Ze.ZP.getActiveGroupId(t.vivaldiWindowId):void 0})))}const u=Un.useCallback(((e,s)=>{e.persist(),(0,wi.ZP)(e),vp("mailandfeeds",t.vivaldiWindowId,s,!1,(function(e,t){(0,bp.Z)(fe.ZP.getMailWindowId(),e,t)})).then((s=>{(0,mi.Z)(t,s)(e)}))}),[t]);return e.accountId===b.$c&&1===A.Z.get(Z.kMailAccounts).length&&k(e.id,Nt.of),(0,zn.jsx)(JH,{id:e.id,index:e.index,type:"email",size:e.size,sizeOptions:MG,background:e.background,keyAccess:e.keyAccess,className:"Dashboard-EmailWidget",getMenu:c,title:e.accountId?e.accountId===Nt.of?(0,W.Z)("All Recent Messages"):(0,W.Z)("Recent in $1",[e.accountId]):void 0,children:e.accountId?(0,zn.jsxs)("div",{className:"email-wrapper scrollable",children:[i.map(((e,t,s)=>{const n=!kt.Z.call(e.sources);return(0,zn.jsxs)(Un.Fragment,{children:[(0,zn.jsxs)("div",{className:Gn()("email-item",{unread:n,unseen:e.unseen}),onPointerDown:t=>function(e,t){e.button,ai.Z.kCenter,h(e,t)}(t,e.id),onKeyDown:t=>function(e,t){"Enter"!==e.key&&" "!==e.key||h(e,t)}(t,e.id),tabIndex:0,onContextMenu:t=>u(t,e),children:[(0,zn.jsxs)("div",{className:"data-row",children:[n?(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.AtI.small}}):OG,(0,zn.jsx)("div",{className:"title",children:(0,cw.Qb)(e.fromIds).contactString}),(0,zn.jsx)("div",{className:"date",children:l[Z.kCalendarRelativeDates]?V()(e.sentDate).calendar(null,b.BO):V()(e.sentDate).format(b.BO.sameElse)})]}),(0,zn.jsx)("div",{className:"subject-row",children:(0,zn.jsx)("div",{className:"title",children:e.subject})}),(0,zn.jsx)("div",{className:"content-row",children:(0,zn.jsx)("div",{className:"content",children:e.preview})})]}),t<s.length-1&&jG]},`email_${e.id}`)})),0===i.length&&!o&&(0,zn.jsxs)("div",{className:"empty-widget-message",children:[(0,zn.jsx)("div",{dangerouslySetInnerHTML:{__html:Kn.Fii}}),o?"":(0,W.Z)("No messages to display.")]})]}):(0,zn.jsx)(_G,{iconSize:"regular"===e.size?"medium":"large",onChange:t=>{k(e.id,t)}})})}const RG=Un.memo(LG);function BG({id:e,feeds:t,onValidate:s,iconSize:n}){const[i,a]=Un.useState(""),o=Un.useContext(oi.Z);return Un.useEffect((()=>{t.length>0&&a(t[0].path??""),1===t.length&&s(t[0].path)}),[t,s]),(0,zn.jsxs)("form",{className:"widget-config",children:[0!==t.length?(0,zn.jsxs)("div",{className:"widget-config-content",children:[(0,zn.jsx)("span",{children:(0,W.Z)("Select a Feed:")}),(0,zn.jsxs)(Fa.Z,{value:i,onChange:e=>a(e.target.value),children:[(0,zn.jsx)("option",{value:Nt.of,children:(0,W.Z)("All Messages")}),t.map((e=>(0,zn.jsx)("option",{value:e.path,children:e.name},e.id)))]})]}):(0,zn.jsxs)("div",{className:"widget-config-intro",children:[(0,zn.jsx)("span",{className:"icon",dangerouslySetInnerHTML:{__html:Kn.L_F[n]}}),(0,zn.jsx)("p",{children:(0,W.Z)("Look for RSS feed icon in address bar to add feeds from websites that offer them. Or test with our own, Vivaldi Browser Feed.")})]}),(0,zn.jsx)("footer",{className:"widget-config-footer",children:0===t.length?(0,zn.jsx)("input",{type:"submit",onClick:()=>{const t=F.ZP.UI_LANGUAGE.substring(0,2),s={url:["de","es","fr","ja","pl","ru"].includes(t)?`https://vivaldi.com/${t}/feed/`:"https://vivaldi.com/feed/",title:(0,W.Z)("Vivaldi Browser Feed"),feedId:crypto.randomUUID(),offline:!1,refreshInterval:120};ue.Z.showAddFeed(o.vivaldiWindowId,{feeds:[s],widgetId:e})},title:(0,W.Z)("Vivaldi Browser Feed"),value:(0,W.Z)("Add a Feed")}):(0,zn.jsx)("input",{type:"submit",value:(0,W.Z)("verb","Done"),onClick:()=>{i.length>0&&s(i)}})})]})}var FG=s(55603);function WG({message:e}){const[t,s]=Un.useState();return(0,FG.F7)(e).then((e=>{s(e[0])})),t?(0,zn.jsx)("img",{src:t}):null}const UG=Un.memo(WG);var VG=s(34155);const HG=[Z.kCalendarRelativeDates],GG=["regular","double_height"];var KG=(0,zn.jsx)("hr",{});function zG(e){const t=Un.useContext(oi.Z),s=(0,Eo.Z)(HG),[n,i]=Un.useState([]),[a,o]=Un.useState([]),r=Un.useRef(crypto.randomUUID()),[l,h]=Un.useState(Boolean(e.feedId));Un.useEffect((()=>{function t(){if(qt.isInitialized()){const t=bt.Z.getByAccountId(Nt.u4).filter((e=>Nt.pG.test(e.path))).map((e=>({id:e.id,name:e.name,path:e.path}))),s=t.find((e=>e.path===r.current));s&&(VG.nextTick((()=>{N(e.id,s.path)})),r.current=crypto.randomUUID()),o(t),e.feedId&&i(function(e){try{return(e===Nt.of?qt.getList(Nt.u4,Nt.ym):qt.getList(Nt.u4,e)).slice(0,b.bb)}catch(e){return console.error(e),[]}}(e.feedId)),h(!1)}else setTimeout(t,500)}return qt.addListener(t),t(),()=>qt.removeListener(t)}),[e.feedId,e.feedDisplay,e.id]);const u=Un.useCallback((()=>{const s=crypto.randomUUID();return[{items:a.reduce(((t,s)=>(t.push({type:"checkbox",checked:!!e.feedId&&s.path.endsWith(e.feedId),handler:()=>N(e.id,s.path),label:s.name,labelEnglish:s.name}),t)),[{type:"checkbox",checked:e.feedId===Nt.of,handler:()=>N(e.id,Nt.of),...(0,fi.Z)("All Recent Feeds")}]),...(0,fi.Z)("Select Feed")},{items:[{type:"checkbox",checked:"list"===e.feedDisplay,handler:()=>_(e.id,"list"),...(0,fi.Z)("List")},{type:"checkbox",checked:"focusFirst"===e.feedDisplay,handler:()=>_(e.id,"focusFirst"),...(0,fi.Z)("Focus First Item")},{type:"checkbox",checked:"titleOnly"===e.feedDisplay,handler:()=>_(e.id,"titleOnly"),...(0,fi.Z)("Title only")}],...(0,fi.Z)("Select Display")},{handler:()=>ue.Z.showAddFeed(t.vivaldiWindowId,{feeds:[{url:"",path:r.current??s,title:"",refreshInterval:0,feedId:s,offline:!1}],widgetId:e.id}),...(0,fi.Z)("title","Add Feed")}]}),[t.vivaldiWindowId,a,e.feedId,e.id,e.feedDisplay]),p=Un.useCallback((e=>a.find((t=>t.id===e))?.name??""),[a]);async function g(e,s){const n=bt.Z.getListEntry(s),i=(0,fo.wJ)(t.vivaldiWindowId,e);if(i&&n){const e=await(0,FG.ME)(n);if(e){d.Z.markAllListEntriesRead([n]);const s=t.vivaldiWindowId;i.inNewWindow?Wn.Z.openBrowserWindow(s,e,{incognito:i.incognito,transition:re.Z.historyPrivate.TransitionType.LINK}):c.ZP.openURL(s,e,{inCurrent:i.inCurrent,inBackground:i.inBackground,transition:re.Z.historyPrivate.TransitionType.LINK,groupId:!i.inCurrent&&A.Z.get(Z.kTabsStackingOpenInCurrent)?Ze.ZP.getActiveGroupId(s):void 0})}else rs.Z.messages.get(s).then((e=>(0,bp.Z)(fe.ZP.getMailWindowId(),e,{inBackground:i.inBackground,inCurrent:!1})))}}const m=Un.useMemo((()=>a.find((t=>t.path===e.feedId))?.name??(0,W.Z)("Feed")),[a,e.feedId]),f=Un.useCallback(((e,s)=>{e.persist(),(0,wi.ZP)(e),vp("mailandfeeds",t.vivaldiWindowId,s,!0,(function(e,t){(0,bp.Z)(fe.ZP.getMailWindowId(),e,t)})).then((s=>{(0,mi.Z)(t,s)(e)}))}),[t]);return(0,zn.jsx)(JH,{id:e.id,index:e.index,type:"feed",size:e.size,sizeOptions:GG,background:e.background,keyAccess:e.keyAccess,className:"Dashboard-FeedWidget",getMenu:u,title:e.feedId?e.feedId===Nt.of?(0,W.Z)("Recent Feeds"):(0,W.Z)("Recent in $1",[m]):void 0,children:e.feedId?(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("div",{className:"feed-wrapper scrollable",children:n.map(((t,n,i)=>{const a=!kt.Z.call(t.sources);return(0,zn.jsxs)(Un.Fragment,{children:[(0,zn.jsxs)("div",{className:Gn()("feed-row",{"focus-first":"focusFirst"===e.feedDisplay&&0===n,"title-only":"titleOnly"===e.feedDisplay,unread:a,unseen:t.unseen}),onPointerDown:e=>function(e,t){e.button,ai.Z.kCenter,g(e,t)}(e,t.id),onKeyDown:e=>function(e,t){"Enter"!==e.key&&" "!==e.key||g(e,t)}(e,t.id),tabIndex:0,onContextMenu:e=>f(e,t),children:[(0,zn.jsx)("div",{className:"preview-image",children:(0,zn.jsx)(UG,{message:t})}),(0,zn.jsxs)("div",{className:"title-row",children:[(0,zn.jsx)("div",{className:"title",children:p(t.sourceFilterIds[0])}),(0,zn.jsx)("div",{className:"date",children:s[Z.kCalendarRelativeDates]?V()(t.sentDate).calendar(null,b.BO):V()(t.sentDate).format(b.BO.sameElse)})]}),(0,zn.jsx)("div",{className:"subject-row",children:(0,zn.jsx)("div",{className:"title",children:t.subject})}),(0,zn.jsx)("div",{className:"content-row",children:(0,zn.jsx)("div",{className:"content",children:t.preview})})]}),n<i.length-1&&KG]},`feed_${t.id}`)}))}),0===n.length&&!l&&(0,zn.jsxs)("div",{className:"empty-widget-message",children:[(0,zn.jsx)("div",{dangerouslySetInnerHTML:{__html:Kn.Fii}}),l?"":(0,W.Z)("No messages to display.")]})]}):(0,zn.jsx)(BG,{id:e.id,feeds:a,onValidate:t=>{N(e.id,t)},iconSize:"regular"===e.size?"medium":"large"})})}const $G=Un.memo(zG);var YG=(0,zn.jsx)(aa,{type:"blocker-shield",size:32,className:"Blocker-Shield-Trackers Modal-Shield"}),XG=(0,zn.jsx)(aa,{type:"blocker-shield",size:32,className:"Blocker-Shield-Ads Modal-Shield"});function QG(e){const t=Un.useContext(oi.Z),[s,n]=Un.useState({reportingStart:0,adsBlocked:0,trackersBlocked:0});return Un.useEffect((()=>{re.Z.contentBlocking.getAdBlockingStats((function(e,t,s,i,a){n({reportingStart:e,adsBlocked:t,trackersBlocked:s})}))}),[]),(0,zn.jsx)(JH,{id:e.id,type:"privacy-stats",index:e.index,size:e.size,background:e.background,keyAccess:e.keyAccess,className:"Dashboard-PrivacyStatsWidget",children:(0,zn.jsxs)("div",{className:"privacy-stats-wrapper scrollable",children:[(0,zn.jsxs)("div",{className:"counter-wrapper",onClick:()=>ue.Z.showPrivacyStatsDialog(t.vivaldiWindowId),children:[(0,zn.jsxs)("div",{children:[(0,zn.jsxs)("div",{className:"counter",children:[YG,(0,F.uf)(s.trackersBlocked)]}),(0,zn.jsx)("div",{className:"title",children:(0,W.Z)("Trackers prevented from profiling you")})]}),(0,zn.jsxs)("div",{children:[(0,zn.jsxs)("div",{className:"counter",children:[XG,(0,F.uf)(s.adsBlocked)]}),(0,zn.jsx)("div",{className:"title",children:(0,W.Z)("Ads blocked")})]})]}),(0,zn.jsx)("p",{children:s.reportingStart>0?(0,W.Z)("Since $1",[V()(s.reportingStart).format("LL")]):""})]})})}class qG extends Un.Component{componentDidMount(){const e=this.props.bookmark.url;this.props.showThumbnail&&0===this.props.bookmark.thumbnail.length&&e&&(Ma.linkAndQueryUpdatingBookmark(this,this.props.bookmark.id),Ma.updateForBookmark(this.props.bookmark.id,e))}render(){const{bookmark:e}=this.props,t=e.url??"",s=e.faviconUrl||vs.jk.getFavicon(t)||t,n=e.faviconUrl?"faviconFromCache":"page";return(0,zn.jsx)(zn.Fragment,{children:this.props.showThumbnail?(0,zn.jsx)(_V,{className:"icon-wrapper",src:this.props.bookmark.thumbnail,title:e.title?e.title:e.url?re.Z.utilities.urlToThumbnailText(e.url):""}):(0,zn.jsx)("span",{className:"icon-wrapper",children:(0,zn.jsx)(Vn.ZP,{className:"favicon",url:s,loadType:n,size:32})})})}}class JG extends Un.Component{static contextType=oi.Z;openUrl=e=>{e=e||{};const t=this.props.node,s=this.context.vivaldiWindowId;e.newWindow?Wn.Z.openBrowserWindow(s,t.url,{incognito:e.incognito,transition:re.Z.historyPrivate.TransitionType.AUTO_BOOKMARK}):c.ZP.openURL(s,t.url,{inCurrent:!e.newTab,inBackground:e.background,bookmarkId:t.id,transition:re.Z.historyPrivate.TransitionType.AUTO_BOOKMARK,groupId:e.newTab&&A.Z.get(Z.kTabsStackingOpenInCurrent)?Ze.ZP.getActiveGroupId(s):void 0})};copyUrl=()=>{const{document:e}=this.context;e.addEventListener("copy",this.onCopy),e.execCommand("copy"),e.removeEventListener("copy",this.onCopy)};onCopy=e=>{ne.Z.copy(e,[this.props.node.id]),(0,wi.ZP)(e)};removeBookmark=async()=>{ne.Z.remove([this.props.node.id])};handleEdit=()=>{ue.Z.showBookmarkDialog(this.context.vivaldiWindowId,{mode:"edit",id:this.props.node.id,index:-1})};openAll=()=>{Jn.ZP.open(this.context.vivaldiWindowId,Jn.ZP.getBookmarksByNode(this.props.node),{inCurrent:!1,inBackground:!0,inNewWindow:!1,incognito:!1,transition:re.Z.historyPrivate.TransitionType.AUTO_TOPLEVEL},!0)};getContextMenuItems=e=>{const t=this.context.vivaldiWindowId,s=ei.Z.getOptionFunction(e),n={};return ei.Z.getNamedMenu(t,e,(async e=>{switch(e.action){case"CONTEXT_OPEN_IN_NEW_TAB":return{handler:()=>this.openUrl({newTab:!0}),...s(t,e,n)};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{handler:()=>this.openUrl({newTab:!0,background:!0}),...s(t,e,n)};case"CONTEXT_OPEN_IN_TAB":return{handler:()=>this.openUrl({newTab:!1}),...s(t,e,n)};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{handler:()=>this.openUrl({newWindow:!0}),...s(t,e,n)};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{handler:()=>this.openUrl({newWindow:!0,incognito:!0}),...s(t,e,n)};case"CONTEXT_CONTAINER_OPEN_IN_WINDOW":{const i=await ro.getMenu(t,!0,[this.props.node.url||""]);return{isVisible:()=>i.length>0,items:i,...s(t,e,n)}}case"CONTEXT_OPEN_ALL":return{handler:()=>this.openAll(),...s(t,e,n)};case"CONTEXT_EDIT":return{handler:()=>this.handleEdit(),...s(t,e,n)};case"CONTEXT_COPY":return{handler:()=>this.copyUrl(),...s(t,e,n)};case"CONTEXT_DELETE":return{handler:()=>this.removeBookmark(),...s(t,e,n)};default:return{...s(t,e,n)}}}))};handleContextMenu=e=>{e.persist(),(0,wi.ZP)(e),this.props.isFolder?this.getContextMenuItems("shortcutfolder").then((t=>{(0,mi.Z)(this.context,t)(e)})):this.getContextMenuItems("shortcut").then((t=>{(0,mi.Z)(this.context,t)(e)}))};#Jt=e=>{const{node:t}=this.props;if(t.isParent)this.props.dispatchNavigate({type:"leave"});else if(g.Z.isFolder(t))this.props.dispatchNavigate({type:"enter",id:t.id});else{const t=(0,fo.wJ)(this.context.vivaldiWindowId,e);t&&this.openUrl({newWindow:t.inNewWindow,background:t.inBackground,newTab:!t.inCurrent})}};#es=e=>{e.button,ai.Z.kCenter,this.#Jt(e)};#_t=e=>{const t=(0,vi.Z)(e);switch(e.key){case"Enter":case" ":this.#Jt(e);break;case"ArrowLeft":if(t||!this.props.moveFocus(this.props.node.id,"left"))return;(0,wi.ZP)(e);break;case"ArrowRight":if(t||!this.props.moveFocus(this.props.node.id,"right"))return;(0,wi.ZP)(e);break;case"ArrowUp":if(t||!this.props.moveFocus(this.props.node.id,"up"))return;(0,wi.ZP)(e);break;case"ArrowDown":if(t||!this.props.moveFocus(this.props.node.id,"down"))return;(0,wi.ZP)(e)}};render(){const{node:e,showTitle:t,isFolder:s,keyAccess:n,showThumbnail:i,background:a}=this.props,o=e.isParent?(0,W.Z)("Parent Folder"):e.title;return(0,zn.jsxs)("div",{className:Gn()("item",YH(a)?b.sg:a,{"show-title":t}),onContextMenu:this.handleContextMenu,onPointerDown:this.#es,onKeyDown:this.#_t,tabIndex:n,title:o,role:"link","aria-label":o,"data-id":this.props.node.id,children:[s?e.isParent?(0,zn.jsx)("span",{className:"icon-wrapper folder-back",dangerouslySetInnerHTML:{__html:Kn.zwh}}):(0,zn.jsx)("span",{className:"icon-wrapper",dangerouslySetInnerHTML:{__html:Kn.feS}}):(0,zn.jsx)(qG,{bookmark:e,showThumbnail:i}),t&&!e.isParent&&(0,zn.jsx)("p",{children:e.title||(e.url?e.url.substring((0,Ar.Df)(e.url)):"")})]},e.id)}}function eK({onValidate:e}){const[t,s]=Un.useState(""),[n,i]=Un.useState([]);return Un.useEffect((()=>{n.length>0&&s(n[0].id)}),[n]),Un.useEffect((()=>{const e=[...g.Z.getFilteredTree("",{folders:!0,bookmarks:!1,root:!0}).nodes][0]?.children??[];i(e)}),[]),(0,zn.jsxs)("form",{className:"widget-config",children:[(0,zn.jsxs)("div",{className:"widget-config-content shortcuts-config",children:[(0,zn.jsx)("span",{style:{gridArea:"folder-label"},children:(0,W.Z)("Folder:")}),(0,zn.jsx)(Va,{onChange:e=>s(e.target.value),selectedItemID:t})]}),(0,zn.jsx)("footer",{className:"widget-config-footer",children:(0,zn.jsx)("input",{type:"submit",value:(0,W.Z)("verb","Done"),onClick:()=>{t.length>0&&e({folderId:t})}})})]})}const tK=["regular","double_height"],sK={"--shortcut-item-width":"78px","--shortcut-list-gap":"24px"};function nK(e){const t=Un.useContext(oi.Z).vivaldiWindowId,s=Un.useRef(),[n,i]=Un.useState(g.Z.getItemById(e.folderId)?.children??[]),a=Un.useCallback(((t,s)=>{switch(s.type){case"leave":return{id:t.parentId??e.folderId,parentId:void 0};case"init":return{id:s.id,parentId:void 0};case"enter":return{id:s.id,parentId:t.id}}}),[e.folderId]),[o,r]=Un.useReducer(a,{id:e.folderId,parentId:void 0});Un.useEffect((()=>{function t(){!function(){const t=[...g.Z.getItemById(o.id)?.children??[]];o.id!==e.folderId&&t.unshift({isParent:!0,id:crypto.randomUUID()});i(t.filter((e=>!g.Z.isSeparator(e))))}()}return g.Z.addListener(t),t(),()=>g.Z.removeListener(t)}),[o.id,o.parentId,e.folderId]);const l=Un.useCallback((()=>[{handler:()=>M(e.id,{folderId:""}),...(0,fi.Z)("Select Folder")},{handler:()=>ue.Z.showBookmarks(t,o.id),...(0,fi.Z)("Edit Bookmarks")},{type:"checkbox",checked:e.showTitle,handler:()=>M(e.id,{showTitle:!e.showTitle}),...(0,fi.Z)("Show Site Title")},{type:"checkbox",checked:e.showThumbnail,handler:()=>M(e.id,{showThumbnail:!e.showThumbnail}),...(0,fi.Z)("Show Thumbnail")}]),[e.showTitle,e.showThumbnail,e.id,t,o.id]),d=Un.useMemo((()=>g.Z.getItemById(e.folderId)?.title),[e.folderId]),c=(e,t)=>{const n=s.current;if(n){const s=Math.floor((n.clientWidth-(0,Si.np)())/90);return bo(e,t,Array.from(n.querySelectorAll(".item")),s)}return!1};return(0,zn.jsx)(JH,{id:e.id,index:e.index,type:"shortcuts",size:e.size,sizeOptions:tK,background:e.background,keyAccess:e.keyAccess,getMenu:l,className:"Dashboard-Shortcuts",title:d,children:""===e.folderId?(0,zn.jsx)(eK,{onValidate:t=>{t.folderId&&r({type:"enter",id:t.folderId}),M(e.id,t)}}):(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("div",{ref:s,className:"shortcut-list scrollable",style:sK,children:n.map(((t,s)=>{const n=g.Z.isFolder(t);return(0,zn.jsx)(JG,{node:t,isFolder:n,keyAccess:0===s?0:-1,showThumbnail:e.showThumbnail,showTitle:e.showTitle,dispatchNavigate:r,background:e.background,moveFocus:c},t.id)}))}),0===n.length&&(0,zn.jsx)("div",{className:"empty-widget-message",children:(0,W.Z)("No bookmarks to display.")})]})})}const iK=Un.memo(nK);class aK extends m.Z{getInitialState(){return[]}getContentByWidgetId(e){return this.getState().find((t=>t.widgetId===e))?.content}reduce(e,t){switch(t.actionType){case"STICKY_NOTE_INIT":return[...t.notes];case"STICKY_NOTE_UPDATE":{const s=(0,C.Uy)(e,(e=>{const s=e.find((e=>e.widgetId===t.widgetId));s?s.content=t.content:e.push({widgetId:t.widgetId,content:t.content})}));return I.Z.set(Z.kDashboardStickyNotes,s),s}case"STICKY_NOTE_REMOVE":{const s=(0,C.Uy)(e,(e=>e.filter((e=>e.widgetId!==t.widgetId))));return I.Z.set(Z.kDashboardStickyNotes,s),s}default:return e}}}const oK=new aK,rK=(0,Te.Z)(((e,t)=>{var s,n;s=e,n=t.target.value,S.Z.dispatch({actionType:"STICKY_NOTE_UPDATE",widgetId:s,content:n})}),1e3);function lK(e){const t=Un.useContext(oi.Z),s=Un.useRef(null),[n,i]=Un.useState(!1),[a,o]=Un.useState("");Un.useEffect((()=>{o(oK.getContentByWidgetId(e.id)??""),i(!0)}),[e.id]),Un.useEffect((()=>{const t=()=>{const t=oK.getContentByWidgetId(e.id);"string"==typeof t&&o(t)};return oK.addListener(t),()=>oK.removeListener(t)}),[e.id]);const r=Un.useCallback((()=>[{handler:()=>Js.Z.createNote(t.vivaldiWindowId,{content:a,type:"note"},!1),isEnabled:()=>""!==a,...(0,fi.Z)("Save to a Note")}]),[t.vivaldiWindowId,a]);return(0,zn.jsx)(JH,{id:e.id,index:e.index,type:"sticky-note",size:e.size,background:e.background,keyAccess:e.keyAccess,className:"Dashboard-StickyNoteWidget",getMenu:r,children:(0,zn.jsx)("textarea",{ref:s,className:"note-editor scrollable",value:a,placeholder:n?(0,W.Z)("Start typing your note"):void 0,onChange:t=>{o(t.currentTarget.value),rK(e.id,t)}})})}const dK=Un.memo(lK),cK=[Z.kCalendarDisplayDensity],hK=["regular","double_height"],uK={...(0,lH.l)(),displayMode:"agenda"};function pK(e){const t=Un.useContext(oi.Z).vivaldiWindowId,s=(0,Eo.Z)(cK),n=Un.useMemo((()=>Ze.ZP.getActivePage(t)?.id??-1),[t]),{stateHandler:i,calendarFilter:a,eventDraft:o,tasks:r,trashedEvents:l}=cH(n,{filter:uK}),d=Un.useMemo((()=>({pageId:n,displayDensity:s[Z.kCalendarDisplayDensity],isPanel:!1,isEditing:!1,isWidget:!0,isTaskList:!0,handler:i})),[n,s,i]);return(0,zn.jsx)(JH,{id:e.id,index:e.index,type:"tasks",size:e.size,sizeOptions:hK,background:e.background,keyAccess:e.keyAccess,className:"Dashboard-TasksWidget",children:(0,zn.jsxs)("div",{id:"tasks-widget",className:"scrollable",children:[0===r.length&&(0,zn.jsx)("div",{className:"widget-image-intro",children:(0,zn.jsx)("span",{className:"icon",dangerouslySetInnerHTML:{__html:Kn.tDC["regular"===e.size?"medium":"large"]}})}),(0,zn.jsx)(WS.Provider,{value:d,children:(0,zn.jsx)(gE,{filter:a,events:r,trashedEvents:l,editingEvent:o,displayMode:"agenda",eventDisplayStyle:"transparent"})})]})})}const gK=Un.memo(pK);function mK(e){const t=Un.useContext(oi.Z),[s,n]=Un.useState(!1);function i(t,s){const n=e.tipLink;n&&s&&(s.newWindow?Wn.Z.openBrowserWindow(t,n,{incognito:s.incognito,transition:re.Z.historyPrivate.TransitionType.LINK}):c.ZP.openURL(t,n,{inCurrent:!s.newTab,inBackground:s.background,transition:re.Z.historyPrivate.TransitionType.LINK}))}function a(t){const{clipboardData:s}=t,n=e.tipLink;s&&n&&s.setData("text/plain",n)}function o(s){const n=t.vivaldiWindowId,o=ei.Z.getOptionFunction(s),r={};return ei.Z.getNamedMenu(n,s,(async s=>{switch(s.action){case"CONTEXT_OPEN_IN_NEW_TAB":return{handler:()=>i(n,{newTab:!0}),...o(n,s,r)};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{handler:()=>i(n,{newTab:!0,background:!0}),...o(n,s,r)};case"CONTEXT_OPEN_IN_TAB":return{handler:()=>i(n,{newTab:!1}),...o(n,s,r)};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{handler:()=>i(n,{newWindow:!0}),...o(n,s,r)};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{handler:()=>i(n,{newWindow:!0,incognito:!0}),...o(n,s,r)};case"CONTEXT_CONTAINER_OPEN_IN_WINDOW":{const t=await ro.getMenu(n,!0,[e.tipLink||""]);return{isVisible:()=>t.length>0,items:t,...o(n,s,r)}}case"CONTEXT_COPY":return{isVisible:()=>e.tipLink.length>0,handler:()=>function(){const{document:e}=t;e.addEventListener("copy",a),e.execCommand("copy"),e.removeEventListener("copy",a)}(),...o(n,s,r)};default:return{...o(n,s,r)}}}))}return Un.useEffect((()=>{const t=(new Date).valueOf();(!e.tipContent||e.tipTimestamp+144e5<t)&&function(){const e="ja"===F.ZP.UI_LANGUAGE.substring(0,2)?"https://vivaldi.com/ja/feed/desktop-tip/":"https://downloads.vivaldi.com/feeds/desktop-tip.atom",t=new XMLHttpRequest;return new Promise(((s,n)=>{t.onload=()=>{let{responseXML:n}=t;null===n&&/^\s/.test(t.responseText)&&(n=(new DOMParser).parseFromString(t.responseText.trim(),"text/xml"));const i=(0,Ps.t5)(n,t.responseText,e);if(i&&"string"!=typeof i){const e=i.feeditems[0];return s({content:e.htmlsummary,url:e.links.alternate[0].url})}return s()},t.onerror=()=>n("Unable to fetch tip of the day."),t.overrideMimeType("text/xml"),t.open("GET",e,!0),t.send(null)}))}().then((s=>{var i,a;s?.content&&e.tipContent!==s.content&&(i=e.id,a={tipContent:s.content,tipLink:s.url,tipTimestamp:t},S.Z.dispatch({actionType:"DASHBOARD_UPDATE_WIDGET",widgetId:i,tipData:a})),n(!0)})).catch((e=>{console.error(e),n(!0)}))}),[e.id,e.tipContent,e.tipLink,e.tipTimestamp]),(0,zn.jsx)(JH,{id:e.id,index:e.index,type:"tip",size:e.size,background:e.background,keyAccess:e.keyAccess,className:"Dashboard-TipWidget",children:e.tipLink?(0,zn.jsx)("div",{className:"tip",onPointerDown:function(s){if(s.button,ai.Z.kCenter,!e.tipLink)return;const n=t.vivaldiWindowId,a=(0,fo.wJ)(n,s);a&&i(n,{newWindow:a.inNewWindow,background:a.inBackground,newTab:!a.inCurrent}),s.stopPropagation()},title:(0,W.Z)("Read more at $1",[e.tipLink]),onContextMenu:function(e){e.persist(),(0,wi.ZP)(e),o("tip").then((s=>{(0,mi.Z)(t,s)(e)}))},children:(0,zn.jsx)("h1",{dangerouslySetInnerHTML:{__html:e.tipContent}})}):s&&(0,zn.jsx)("span",{children:(0,W.Z)("No Tip Available.")})})}const fK=Un.memo(mK);class vK extends Un.Component{static contextType=oi.Z;#ts=e=>{e=e||{};const t=this.props.node,s=this.context.vivaldiWindowId;e.newWindow?Wn.Z.openBrowserWindow(s,t.url,{incognito:e.incognito,transition:re.Z.historyPrivate.TransitionType.AUTO_BOOKMARK}):c.ZP.openURL(s,t.url,{inCurrent:!e.newTab,inBackground:e.background,bookmarkId:t.id,transition:re.Z.historyPrivate.TransitionType.AUTO_BOOKMARK,groupId:e.newTab&&A.Z.get(Z.kTabsStackingOpenInCurrent)?Ze.ZP.getActiveGroupId(s):void 0})};#ss=()=>{const{document:e}=this.context;e.addEventListener("copy",this.#ns),e.execCommand("copy"),e.removeEventListener("copy",this.#ns)};#ns=e=>{ne.Z.copy(e,[this.props.node.id]),(0,wi.ZP)(e)};#is=async()=>{const e=this.props.node.url;return e&&(await n.Z.history.deleteUrl({url:e}),re.Z.historyPrivate.updateTopSites()),this.props.onItemRemoved(),Promise.resolve()};#as=e=>{const t=this.context.vivaldiWindowId,s=ei.Z.getOptionFunction(e),n={};return ei.Z.getNamedMenu(t,e,(async e=>{switch(e.action){case"CONTEXT_OPEN_IN_NEW_TAB":return{handler:()=>this.#ts({newTab:!0}),...s(t,e,n)};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{handler:()=>this.#ts({newTab:!0,background:!0}),...s(t,e,n)};case"CONTEXT_OPEN_IN_TAB":return{handler:()=>this.#ts({newTab:!1}),...s(t,e,n)};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{handler:()=>this.#ts({newWindow:!0}),...s(t,e,n)};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{handler:()=>this.#ts({newWindow:!0,incognito:!0}),...s(t,e,n)};case"CONTEXT_CONTAINER_OPEN_IN_WINDOW":{const i=await ro.getMenu(t,!0,[this.props.node.url||""]);return{isVisible:()=>i.length>0,items:i,...s(t,e,n)}}case"CONTEXT_COPY":return{handler:()=>this.#ss(),...s(t,e,n)};case"CONTEXT_DELETE":return{handler:()=>this.#is(),isVisible:()=>!this.props.node.partner,...s(t,e,n)};case"CONTEXT_HIDE_SUGGESTIONS":return{handler:()=>{I.Z.set(Z.kDashboardTopSitesHideSuggestions,!0),ne.Z.setTopSites()},isVisible:()=>Boolean(this.props.node.partner),...s(t,e,n)};default:return{...s(t,e,n)}}}))};#L=e=>{e.persist(),(0,wi.ZP)(e),this.#as("topsite").then((t=>{(0,mi.Z)(this.context,t)(e)}))};#Jt=e=>{const t=(0,fo.wJ)(this.context.vivaldiWindowId,e);t&&this.#ts({newWindow:t.inNewWindow,background:t.inBackground,newTab:!t.inCurrent})};#es=e=>{e.button,ai.Z.kCenter,this.#Jt(e)};#_t=e=>{const t=(0,vi.Z)(e);switch(e.key){case"Enter":case" ":this.#Jt(e);break;case"ArrowLeft":if(t||!this.props.moveFocus(this.props.node.id,"left"))return;(0,wi.ZP)(e);break;case"ArrowRight":if(t||!this.props.moveFocus(this.props.node.id,"right"))return;(0,wi.ZP)(e);break;case"ArrowUp":if(t||!this.props.moveFocus(this.props.node.id,"up"))return;(0,wi.ZP)(e);break;case"ArrowDown":if(t||!this.props.moveFocus(this.props.node.id,"down"))return;(0,wi.ZP)(e)}};render(){const{favIconUrl:e,favIconLoadType:t}=vs.jk.getBookmarkFavicon(this.props.node.url,this.props.node.faviconUrl);return(0,zn.jsxs)("div",{className:Gn()("item",this.props.background,{"show-title":this.props.showTitle}),onPointerDown:this.#es,onContextMenu:this.#L,onKeyDown:this.#_t,tabIndex:this.props.keyAccess,title:this.props.node.title,"aria-label":this.props.node.title,role:"link","data-id":this.props.node.id,children:[(0,zn.jsx)("span",{className:"icon-wrapper",children:(0,zn.jsx)(Vn.ZP,{className:"favicon",url:e,loadType:t,size:32})}),this.props.showTitle&&(0,zn.jsx)("p",{children:this.props.node.title})]})}}const bK={"--shortcut-item-width":"78px","--shortcut-list-gap":"12px"};function CK(e){const[t,s]=Un.useState(g.Z.getTopSiteFolder()?.children??[]),n=Un.useRef();Un.useEffect((()=>{const e=()=>{if(g.Z.isInitialized()){const e=g.Z.getTopSiteFolder()?.children??[];s(e)}else setTimeout(e,500)};return g.Z.addListener(e),()=>g.Z.removeListener(e)}),[]);const i=Un.useCallback((()=>[{type:"checkbox",checked:e.showTitle,handler:()=>{return t=e.id,s=!e.showTitle,void S.Z.dispatch({actionType:"DASHBOARD_UPDATE_WIDGET",widgetId:t,showTitle:s});var t,s},...(0,fi.Z)("Show Site Title")}]),[e.id,e.showTitle]),a=(e,t)=>{const s=n.current;if(s){const n=Math.floor((s.clientWidth-(0,Si.np)())/90);return bo(e,t,Array.from(s.querySelectorAll(".item")),n)}return!1};return(0,zn.jsx)(JH,{id:e.id,index:e.index,type:"top-sites",size:e.size,background:e.background,keyAccess:e.keyAccess,className:"Dashboard-TopSites",getMenu:i,children:t.length?(0,zn.jsx)("div",{ref:n,className:"top-sites-wrapper scrollable",style:bK,children:t.slice(0,8).map(((n,i)=>(0,zn.jsx)(vK,{node:n,showTitle:e.showTitle,keyAccess:0===i?0:-1,onItemRemoved:()=>s(t.filter((e=>e.id!==n.id))),background:e.background,moveFocus:a},n.url)))}):(0,zn.jsxs)("div",{className:"widget-config-intro",children:[(0,zn.jsx)("span",{className:"icon",dangerouslySetInnerHTML:{__html:Kn.ObT.medium}}),(0,zn.jsx)("p",{children:(0,W.Z)("After some time of browsing in Vivaldi, Top Sites will populate with frequently visites web pages.")})]})})}function wK(e){return 1.8*e+32}function yK(e,t){return"fahrenheit"===t?(0,W.Z)("$1°",[Math.round(wK(e))]):(0,W.Z)("$1°",[Math.round(e)])}function xK(e,t){switch(t){case"kph":return(0,W.Z)("$1 km/h",[(3.6*e).toFixed(1)]);case"mph":return(0,W.Z)("$1 mph",[(2.236936*e).toFixed(1)]);default:return(0,W.Z)("$1 m/s",[e.toFixed(1)])}}function IK(e,t){return"inches"===t?(0,W.Z)("$1 in",[(.0393700787*e).toFixed(2)]):(0,W.Z)("$1 mm",[e.toFixed(1)])}function AK(e,t,s){return e>27?function(e,t){return 1.61139411*e-8.784695+2.338549*t-.14611605*e*t-.01230809*Math.pow(e,2)-.01642482*Math.pow(t,2)+.00221173*Math.pow(e,2)*t+72546e-8*e*Math.pow(t,2)-358e-8*Math.pow(e,2)*Math.pow(t,2)}(e,t):e<10?function(e,t){return 13.12+.6215*e-11.37*Math.pow(t,.16)+.3965*e*Math.pow(t,.16)}(e,s):e}const SK={sameDay:(0,W.Z)("[Later]"),nextDay:(0,W.Z)("[Tomorrow]"),nextWeek:"dddd",lastDay:"dddd",lastWeek:"dddd",sameElse:"dddd"};function ZK(e){return e.reduce(((e,t)=>e+t.data.precipitation_amount),0)}function TK({todayForecast:e,forecast:t,temperatureUnit:s,windspeedUnit:n,precipitationUnit:i,locationId:a,view:o="WEEK",onViewChanged:r,background:l}){const d=(0,Eo.Z)([Z.kCalendarRelativeDates]),c=Un.useId(),h=Un.useId(),u=Un.useMemo((()=>{const e=t?.forecast.properties.dates??{},s={};for(const t of Object.keys(e))if(s[t]=e[t],7===Object.keys(s).length)break;return s}),[t]),p=Un.useCallback((e=>{r({locationId:a,view:e===c?"WEEK":"DAY"})}),[a,r,c]),g=Un.useMemo((()=>{const e=F.ZP.getShortDateFormat();return t=>d[Z.kCalendarRelativeDates]?t.calendar(SK):t.format(e)}),[d]);return(0,zn.jsxs)(aM,{activeTabId:"WEEK"===o?c:h,onTabClick:p,className:YH(l)?b.sg:l,children:[(0,zn.jsx)("div",{id:h,label:(0,W.Z)("Today's Forecast","Today"),children:(0,zn.jsx)("table",{className:"hourly-forecast",children:(0,zn.jsx)("tbody",{children:"DAY"!==o?null:e.map((e=>{const{symbol_code:a,air_temperature:o,precipitation_amount:r,wind_speed:l,wind_from_direction:d}=e.data;return(0,zn.jsxs)("tr",{children:[(0,zn.jsx)("td",{children:xZ().tz(e.time,t?.city.timezone).add(30,"minute").startOf("hour").format("LT")}),(0,zn.jsx)("td",{children:(0,zn.jsx)("img",{src:`resources/weather_icons_svg/${a}.svg`,height:24,width:24,alt:a})}),(0,zn.jsx)("td",{children:yK(o,s)}),(0,zn.jsx)("td",{children:IK(r,i)}),(0,zn.jsx)("td",{children:xK(l,n)}),(0,zn.jsx)("td",{children:(0,zn.jsx)("span",{style:{rotate:`${d}deg`,height:"16px",width:"16px"},dangerouslySetInnerHTML:{__html:Kn.lWf}})})]},e.time)}))})})}),(0,zn.jsx)("div",{id:c,label:(0,W.Z)("Week"),children:(0,zn.jsx)("table",{className:"week-forecast",children:(0,zn.jsx)("tbody",{children:"WEEK"!==o?null:Object.keys(u).map(((e,t)=>{const a=u[e],o=function(e){const t=Object.groupBy(e,(e=>e.data.symbol_code));let s="",n=0;for(const[e,i]of Object.entries(t))i.length>n&&(s=e,n=i.length);return s}(a),r=o.replace(/(_night|_polartwilight)/g,"_day");const l=function(e,t){const[s,n]=e.reduce(((e,t)=>{const s=t.data.air_temperature;return[s<e[0]?s:e[0],s>e[1]?s:e[1]]}),[1/0,-1/0]);return{minTemperature:Math.round("fahrenheit"===t?wK(s):s),maxTemperature:Math.round("fahrenheit"===t?wK(n):n)}}(a,s),d=0===(c=a).length?0:c.reduce(((e,t)=>e+t.data.wind_speed),0)/c.length;var c;const h=xZ()(e);return(0,zn.jsxs)("tr",{children:[(0,zn.jsx)("td",{title:h.format(F.ZP.getWeekdayFormat()),children:g(h)}),(0,zn.jsx)("td",{children:(0,zn.jsx)("img",{src:`resources/weather_icons_svg/${r}.svg`,onError:({currentTarget:e})=>e.src=`resources/weather_icons_svg/${o}.svg`,height:24,width:24,alt:o})}),(0,zn.jsxs)("td",{children:[(0,zn.jsx)("span",{children:(0,W.Z)("$1°",[l.minTemperature])})," / ",(0,zn.jsx)("strong",{children:(0,W.Z)("$1°",[l.maxTemperature])})]}),(0,zn.jsx)("td",{children:IK(ZK(a),i)}),(0,zn.jsx)("td",{children:xK(d,n)})]},e)}))})})})]})}const EK=Un.memo(TK);function kK(e,t,s){return(0,zn.jsx)(zn.Fragment,{children:"celsius"===t?(0,zn.jsx)("span",{className:s,children:(0,W.Z)("$1°C",[Math.round(e)])}):(0,zn.jsx)("span",{className:s,children:(0,W.Z)("$1°F",[Math.round(wK(e))])})})}function NK({todayForecast:e,forecast:t,temperatureUnit:s,windspeedUnit:n,precipitationUnit:i,multipleViews:a}){const o=xZ()(kG("minutes")),r=o.hour(),l=Un.useMemo((()=>e.find((e=>new Date(e.time).getHours()===r))),[r,e]),d=Un.useMemo((()=>{const e=t?.city,s=l?.time;if(s&&e)return a?xZ().tz(o,e.timezone).format("LT"):xZ().tz(o,e.timezone).format(F.ZP.getWeekdayFormat(F.ZP.getShortDateFormat(!1)))}),[t?.city,l?.time,a,o]);if(!l||!t)return null;const{symbol_code:c,air_temperature:h,relative_humidity:u,wind_speed:p,precipitation_amount:g}=l.data;return(0,zn.jsxs)("div",{className:"today-forecast-wrapper",children:[(0,zn.jsxs)("div",{children:[(0,zn.jsx)("span",{className:"heading block",children:t.city.name}),(0,zn.jsx)("span",{className:"date",children:d}),(0,zn.jsxs)("div",{className:"current-forecast",children:[(0,zn.jsx)("img",{src:`resources/weather_icons_svg/${c}.svg`,height:48,width:48,alt:c}),kK(h,s,"heading")]})]}),(0,zn.jsxs)("div",{className:"forecast-details",children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.kHg}}),(0,zn.jsx)("span",{children:(0,W.Z)("Feels like")}),(0,zn.jsx)("strong",{children:kK(AK(h,u,p),s)}),(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.RBC}}),(0,zn.jsx)("span",{children:(0,W.Z)("Rain")}),(0,zn.jsx)("strong",{children:IK(g,i)}),(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.Xzh}}),(0,zn.jsx)("span",{children:(0,W.Z)("Wind")}),(0,zn.jsx)("strong",{children:xK(p,n)})]})]})}const _K=Un.memo(NK);const PK=(0,Te.Z)(((e,t)=>{(async function(e){const t=F.ZP.UI_LANGUAGE.substring(0,2),s=await fetch(`https://weather.vivaldi.com/cities/?lang=${t}&s=${e}`),n=await s.json();return n&&n.results?n.results.slice(0,4).map((e=>({value:e.id,label:`${e.city}, ${e.admin_division1}, ${e.country}`}))):[]})(e).then(t)}),500,{leading:!0});function MK(){return(0,W.Z)("Loading...")}function DK(){return(0,W.Z)("No options")}var OK=(0,zn.jsx)("input",{type:"radio",value:"celsius"}),jK=(0,zn.jsx)("input",{type:"radio",value:"fahrenheit"}),LK=(0,zn.jsx)("input",{type:"radio",value:"mm"}),RK=(0,zn.jsx)("input",{type:"radio",value:"inches"});function BK(e){const[t,s]=Un.useState(),[n,i]=Un.useState(e.temperatureUnit),[a,o]=Un.useState(e.windspeedUnit),[r,l]=Un.useState(e.precipitationUnit);const d=Un.useCallback((e=>s(e.value)),[]),c=Un.useCallback((e=>{const{value:t}=e.target;i("fahrenheit"===t?t:"celsius")}),[]),h=Un.useCallback((e=>{const{value:t}=e.target;switch(t){case"ms":case"kph":case"mph":o(t);break;default:console.error("Invalid windspeed unit")}}),[]),u=Un.useCallback((e=>{const{value:t}=e.target;l("inches"===t?t:"mm")}),[]);return(0,zn.jsxs)("form",{className:"widget-config vivaldi-settings",children:[(0,zn.jsx)("div",{className:"widget-config-content",children:(0,zn.jsxs)("div",{className:"setting-group",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("forecast","Location")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsx)("label",{className:"floating-label",children:(0,zn.jsx)(aO.Z,{className:"VivaldiSelector",classNamePrefix:"Inner",placeholder:(0,W.Z)("Enter City Name"),loadOptions:PK,loadingMessage:MK,noOptionsMessage:DK,onChange:d,"aria-labelledby":"arialabel",menuPlacement:"auto",autoFocus:!0})})}),(0,zn.jsx)(To.Z,{name:"WeatherWidgetTemperature",onChange:c,value:n,className:"setting-group temperature-radio-group",children:(0,zn.jsxs)("div",{className:"setting-single pad-top",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Temperature:")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[OK,(0,zn.jsx)("span",{children:(0,W.Z)("Celsius (°C)")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[jK,(0,zn.jsx)("span",{children:(0,W.Z)("Fahrenheit (°F)")})]})})]})}),(0,zn.jsxs)("div",{className:"setting-single pad-top",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Wind speed:")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)(Fa.Z,{value:a,onChange:h,children:[(0,zn.jsx)("option",{value:"ms",children:(0,W.Z)("Meters per Second (m/s)")}),(0,zn.jsx)("option",{value:"kph",children:(0,W.Z)("Kilometers per Hour (km/h)")}),(0,zn.jsx)("option",{value:"mph",children:(0,W.Z)("Miles per Hour (mph)")})]})})]}),(0,zn.jsx)(To.Z,{name:"WeatherWidgetPrecipitation",onChange:u,value:r,className:"setting-group precipitation-radio-group",children:(0,zn.jsxs)("div",{className:"setting-single pad-top",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Precipitation:")}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[LK,(0,zn.jsx)("span",{children:(0,W.Z)("Millimeters (mm)")})]})}),(0,zn.jsx)("div",{className:"setting-single",children:(0,zn.jsxs)("label",{children:[RK,(0,zn.jsx)("span",{children:(0,W.Z)("Inches (in)")})]})})]})})]})}),(0,zn.jsx)("footer",{className:"widget-config-footer",children:(0,zn.jsx)("input",{type:"submit",value:(0,W.Z)("verb","Done"),disabled:void 0===t,onClick:function(){e.onChange({locationId:t,temperatureUnit:n,windspeedUnit:a,precipitationUnit:r})}})})]})}function FK(e=0){return xZ()().add(e,"day").toISOString().split("T")[0]}const WK=["regular","double_height"];function UK(e){const t=function(e){const[t,s]=Un.useState(e?v.getForecastByLocationId(e):void 0),n=Un.useRef();return Un.useEffect((()=>{let t;return e&&async function e(s){const i=v.getNextUpdate(s),a=new Date;(s!==n.current||!i||i<=a)&&te(s),n.current=s,t=setTimeout((async()=>e(s)),6e5)}(e),()=>clearTimeout(t)}),[e]),Un.useEffect((()=>{function t(){e&&s(v.getForecastByLocationId(e))}return v.addListener(t),()=>v.removeListener(t)}),[e]),t}(e.locationId),s=Un.useMemo((()=>{const e=new Date;e.setMinutes(0,0,0);const s=e.getTime();return[FK(),FK(1)].reduce(((e,n)=>e.concat(t?.forecast.properties.dates[n]?.filter((e=>new Date(e.time).getTime()>=s))??[])),[]).slice(0,24)}),[t]),n=Un.useCallback((t=>D(e.id,t)),[e.id]),i=Un.useMemo((()=>{const e=t?.forecast.properties.meta.updated_at;return e?xZ()(e).format(xZ()(e).isSame(new Date,"day")?"LT":"ll"):""}),[t?.forecast.properties.meta.updated_at]),a=Un.useCallback((()=>{const{id:t,locationId:s,temperatureUnit:n,windspeedUnit:i,precipitationUnit:a}=e;return[{handler:()=>{D(t,{locationId:void 0})},...(0,fi.Z)("Change Location")},{items:[{type:"checkbox",checked:"celsius"===n,handler:()=>D(t,{locationId:s,temperatureUnit:"celsius",windspeedUnit:i,precipitationUnit:a}),...(0,fi.Z)("Celsius")},{type:"checkbox",checked:"fahrenheit"===n,handler:()=>D(t,{locationId:s,temperatureUnit:"fahrenheit",windspeedUnit:i,precipitationUnit:a}),...(0,fi.Z)("Fahrenheit")}],...(0,fi.Z)("Temperature Unit")},{items:[{type:"checkbox",checked:"ms"===i,handler:()=>D(t,{locationId:s,temperatureUnit:n,windspeedUnit:"ms",precipitationUnit:a}),...(0,fi.Z)("m/s")},{type:"checkbox",checked:"kph"===i,handler:()=>D(t,{locationId:s,temperatureUnit:n,windspeedUnit:"kph",precipitationUnit:a}),...(0,fi.Z)("km/h")},{type:"checkbox",checked:"mph"===i,handler:()=>D(t,{locationId:s,temperatureUnit:n,windspeedUnit:"mph",precipitationUnit:a}),...(0,fi.Z)("mph")}],...(0,fi.Z)("Wind Speed Unit")},{items:[{type:"checkbox",checked:"mm"===a,handler:()=>D(t,{locationId:s,temperatureUnit:n,windspeedUnit:i,precipitationUnit:"mm"}),...(0,fi.Z)("millimeters")},{type:"checkbox",checked:"inches"===a,handler:()=>D(t,{locationId:s,temperatureUnit:n,windspeedUnit:i,precipitationUnit:"inches"}),...(0,fi.Z)("inches")}],...(0,fi.Z)("Precipitation Unit")}]}),[e]),{onLine:o}=navigator;return(0,zn.jsxs)(JH,{id:e.id,index:e.index,type:"weather",size:e.size,sizeOptions:WK,background:e.background,keyAccess:e.keyAccess,getMenu:a,className:"Dashboard-WeatherWidget",children:[!o&&(0,zn.jsx)("div",{className:"weather-wrapper",children:(0,W.Z)("No internet connection")}),o&&void 0!==e.locationId&&(0,zn.jsx)("div",{className:"weather-wrapper",children:s&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)(_K,{todayForecast:s,forecast:t,temperatureUnit:e.temperatureUnit,windspeedUnit:e.windspeedUnit,precipitationUnit:e.precipitationUnit,multipleViews:e.multipleViews}),"double_height"===e.size&&(0,zn.jsx)(EK,{todayForecast:s,forecast:t,temperatureUnit:e.temperatureUnit,windspeedUnit:e.windspeedUnit,precipitationUnit:e.precipitationUnit,locationId:e.locationId,view:e.view,onViewChanged:n,background:e.background}),(0,zn.jsxs)("div",{className:"provider",children:[(0,zn.jsx)("div",{children:(0,W.Z)("Forecast from MET.no")}),i&&(0,zn.jsx)("div",{children:(0,W.Z)("Updated at $1",[i])})]})]})}),o&&void 0===e.locationId&&(0,zn.jsx)("section",{children:(0,zn.jsx)(BK,{id:e.id,onChange:n,temperatureUnit:e.temperatureUnit,windspeedUnit:e.windspeedUnit,precipitationUnit:e.precipitationUnit})})]})}const VK=Un.memo(UK),HK=void 0,GK=(0,W.Z)("You must provide a URL.");function KK({id:e,onValidate:t,widgetUrl:s,iconSize:n,shareTheme:i}){const a=Un.useContext(oi.Z),[o,r]=Un.useState(s),[l,d]=Un.useState(i),[c,h]=Un.useState(HK);return Un.useEffect((()=>{function t(t){(0,mg.RT)(a,e)&&h(HK)}return a.document.addEventListener("keydown",t),()=>a.document.removeEventListener("keydown",t)}),[a,e]),Un.useEffect((()=>{function t(){const{typedUrl:t}=wg.getUrlfieldState(e);r(t)}return wg.addListener(t),()=>wg.removeListener(t)}),[e]),(0,zn.jsxs)("form",{className:"widget-config",children:[(0,zn.jsxs)("div",{className:"widget-config-intro",children:[(0,zn.jsx)("span",{className:"icon",dangerouslySetInnerHTML:{__html:Kn.LQS[n]}}),(0,zn.jsx)("p",{children:(0,W.Z)("A simple webpage view. Enter the address below.")})]}),(0,zn.jsxs)("label",{className:"widget-config-content",title:(0,W.Z)("Enter webpage address"),children:[(0,zn.jsx)("span",{children:(0,W.Z)("URL")}),(0,zn.jsx)(ym,{placeholder:"https://vivaldi.net",displayUrl:"",typedUrl:o,autocompletionEnabled:!0,typedHistoryEnabled:!1,pageId:e,inputId:e,pageContext:{},autoFocus:!0}),c&&(0,zn.jsx)("p",{className:"error",children:c})]}),(0,zn.jsxs)("label",{className:"widget-config-content",title:(0,W.Z)("Allow webpages in this widget to access current theme base colors."),children:[(0,zn.jsx)("input",{type:"checkbox",checked:l,onChange:e=>d(e.currentTarget.checked)}),(0,zn.jsx)("span",{children:(0,W.Z)("Share Theme Colors")})]}),(0,zn.jsx)("footer",{className:"widget-config-footer",children:(0,zn.jsx)("input",{type:"submit",value:(0,W.Z)("verb","Done"),onClick:function(){let s=c;const{autocompleteValue:n}=wg.getUrlfieldState(e),i=(n||o||"").trim(),a=(0,Ar.q9)(i,!0).trim();i.includes(" ")&&(s=GK),0===a.length||s||t(a,l),s&&h(s)}})})]})}const zK={contentload:"handleContentLoad",dialog:"handleDialog",loadabort:"handleAbort",loadstop:"handleLoadStop",newwindow:"handleNewWindow",permissionrequest:"handleOnPermissionRequest",targeturlchanged:"handleTargetURLChanged",close:"handleOnClose"};function $K(){let e=navigator.userAgent;const t=e.indexOf("("),s=e.indexOf(")",t);return t>=0&&s>t&&(e=e.substring(0,t+1)+"Linux; Android 10; K"+e.substring(s)),e=e.replace("Safari","Mobile Safari"),e}var YK=(0,zn.jsx)(aa,{type:"close",size:16});class XK extends Un.PureComponent{static contextType=oi.Z;nodeRef=Un.createRef();refWebpanelwebview=Un.createRef();winId=this.context.vivaldiWindowId;messageId=this.props.webPanel.id;state={title:(0,W.Z)("Loading..."),tooltip:void 0,canGoBack:!1,canGoForward:!1,canReload:!1,muted:!1,tabId:void 0};_lookupFavicon=!0;#os=!1;#rs;componentDidMount(){const e=this.refWebpanelwebview.current;if(e)if(this.props.webPanel.mobileMode&&e.setUserAgentOverride($K()),1!==this.props.webPanel.zoom&&e.setZoom(this.props.webPanel.zoom),this.attachWebViewEventHandlers(e),Ko.Z.isExtPanel(this.props.webPanel.id))e.src=this.props.webPanel.activeUrl;else{const t=fe.ZP.isIncognito(this.context.vivaldiWindowId);this.props.webPanel.activeUrl&&!t?e.src=this.props.webPanel.activeUrl:e.src=this.props.webPanel.url}tn.ZP.addListener(this.onPanelStoreChange),tt.Z.addListener(this._alarmsChanged),(0,Gs.Tg)(this._onMessageReceived),Wn.Z.setPanelHasBeenVisible(this.context.vivaldiWindowId,this.props.webPanel.id,!0)}componentWillUnmount(){clearTimeout(this.#rs);const e=this.refWebpanelwebview.current;e&&this.removeWebViewEventHandlers(e),tn.ZP.removeListener(this.onPanelStoreChange),tt.Z.removeListener(this._alarmsChanged),(0,Gs.eL)(this._onMessageReceived)}attachWebViewEventHandlers=e=>{Object.keys(zK).forEach((t=>{e.addEventListener(t,this[zK[t]])}))};removeWebViewEventHandlers=e=>{Object.keys(zK).forEach((t=>{e.removeEventListener(t,this[zK[t]])}))};_alarmsChanged=e=>{const t=e?.find((e=>e&&"RELOAD"===e.type&&this.props.webPanel.id.endsWith(e.id)));t&&this.reload()};componentDidUpdate(e){if(this.#os)return;const{document:t}=this.context,s=this.refWebpanelwebview.current;this.props.webPanel.mobileMode!==s?.isUserAgentOverridden()&&(this.props.webPanel.mobileMode?s?.setUserAgentOverride($K()):s?.setUserAgentOverride(navigator.userAgent),this.home()),s?.setZoom(this.props.webPanel.zoom||1);const n=e.webPanel,i=this.props.webPanel,a=Ko.Z.isExtPanel(i.id);!this.props.isVisible||!this.props.focusContent&&!a||!t.activeElement||t.activeElement===this.refWebpanelwebview.current||e.isVisible&&i.activeUrl===n.activeUrl||(a&&s&&s.src!==i.activeUrl&&(s.src=i.activeUrl),t.activeElement.blur(),this.refWebpanelwebview.current?.focus())}onPanelStoreChange=()=>{const e=tn.ZP.getWindowData(this.winId),t=tn.ZP.getChangeReason();if(!e)return;const{document:s}=this.context;if("setFocus"===t)this.props.isVisible&&!(0,vo.sT)(s,this.nodeRef.current)&&s.activeElement&&(s.activeElement.blur(),this.refWebpanelwebview.current?.focus());else{const e=tn.ZP.getIsMuted(this.winId,this.props.webPanel.id);if(this.state.muted!==e){const t=x.Z.find(this.props.webPanel.id,this.winId);t&&this.setState({muted:e},(()=>{re.Z.tabsPrivate.update(t.tabId,{muteTab:e})}))}}};_onMessageReceived=(e,t,s)=>{if("WEB_PANEL_TITLE_CHANGED"===e.type&&e.messageId===this.messageId){const t=e.title;this._setWebPanelStringValue(this.props.webPanel.id,"title",t),this.setTitle(t)}};handleNewWindow=async e=>{switch(e.windowOpenDisposition){case"current_tab":case"new_foreground_tab":e.preventDefault(),e.window.accept(this.winId+";1");break;case"new_background_tab":e.preventDefault(),e.window.accept(this.winId+";0");break;case"new_window":case"off_the_record":e.preventDefault(),Wn.Z.openBrowserWindow(this.winId,e.targetUrl,{incognito:"off_the_record"===e.windowOpenDisposition});break;case"new_popup":e.preventDefault()}};handleOnClose=async e=>{this.#os=!0,Wn.Z.setPanelHasBeenVisible(this.winId,this.props.webPanel.id,!1),en.Z.closePanel(this.winId)};handleDialog=e=>{"confirm"===e.messageType||"prompt"===e.messageType?e.dialog.cancel():"alert"===e.messageType&&e.dialog.ok("")};handleTargetURLChanged=({newUrl:e})=>{const t=(0,Bb.ZP)(e);h.Z.setStatus(this.winId,t)};getFaviconHost=()=>{const e=(0,ve.Z)(this.refWebpanelwebview.current?.src??"");return e?.protocol&&e?.host?e.protocol+"//"+e.host+"/":""};_setWebPanelStringValue=(e,t,s)=>{en.Z.setWebPanelStringValue(e,t,s,this.context.vivaldiWindowId)};handleLoadStop=e=>{const t=this.refWebpanelwebview.current;if(Ko.Z.isExtPanel(this.props.webPanel.id))this.setState({canGoBack:!1,canGoForward:!1,canReload:!1});else{this.setState({canGoBack:t?.canGoBack(),canGoForward:t?.canGoForward(),canReload:!0});if(!fe.ZP.isIncognito(this.context.vivaldiWindowId)){const e=this.refWebpanelwebview.current?.src??"";this._setWebPanelStringValue(this.props.webPanel.id,"activeUrl",e)}}if(this._lookupFavicon){const e=this.props.webPanel;Ko.Z.isExtPanel(e.id)?this._setWebPanelStringValue(e.id,"faviconUrl",e.url):this.#rs=setTimeout(this.onSetFaviconUrl.bind(this),1e3),this._lookupFavicon=!1}t?.setZoomMode("per-view")};handleContentLoad=e=>{if(this.refWebpanelwebview.current?.executeScript({code:"document.title"},(e=>{if(Array.isArray(e)&&e.length>0&&"string"==typeof e[0]){const t=e[0];this.setState({title:t,tooltip:void 0}),this._setWebPanelStringValue(this.props.webPanel.id,"title",t)}})),this.props.webPanel.id.startsWith(nc.j9))return;const t=`(function() {\n      const target = document.querySelector('title');\n      const observer = new MutationObserver(mutations => {\n        chrome.runtime.sendMessage({\n          type: "WEB_PANEL_TITLE_CHANGED",\n          messageId: "${this.messageId}",\n          title: mutations[0].target.innerText\n        });\n      });\n      observer.observe(target, { subtree: true, characterData: true, childList: true });\n    })()`;this.refWebpanelwebview.current?.executeScript({code:t},(()=>{n.Z.runtime.lastError&&console.warn("listenForTitleChange:",n.Z.runtime.lastError)})),this.refWebpanelwebview.current?.executeScript({file:"inject-all-bundle.js"})};handleAbort=e=>{const t=(0,W.Z)("Aborted"),s=(0,W.Z)("Loading aborted with reason $1",[e.reason]);this.setState({title:t,tooltip:s})};onSetFaviconUrl=()=>{const e=this.refWebpanelwebview.current?.src??"";this._setWebPanelStringValue(this.props.webPanel.id,"faviconUrl",e)};reload=()=>{this.setState({title:(0,W.Z)("Loading..."),tooltip:void 0,canReload:!1}),this.refWebpanelwebview.current?.reload()};setMobileMode=()=>{Ko.Z.setMobileMode(this.props.webPanel.id,!this.props.webPanel.mobileMode,this.context.vivaldiWindowId)};home=()=>{if(Ko.Z.isExtPanel(this.props.webPanel.id))return;this.setState({title:(0,W.Z)("Loading..."),tooltip:void 0,canReload:!1});const e=this.refWebpanelwebview.current;e&&(e.src=this.props.webPanel.url)};back=()=>{this.refWebpanelwebview.current?.back()};forward=()=>{this.refWebpanelwebview.current?.forward()};setTitle=e=>{this.setState({title:e})};onContextMenu=e=>{e.persist(),e.preventDefault(),e.stopPropagation(),km.getPromise(this.winId,this.props.webPanel.id,{title:this.props.webPanel.title,url:this.props.webPanel.url,activeUrl:this.props.webPanel.activeUrl,faviconUrl:this.props.webPanel.faviconUrl,muted:tn.ZP.getIsMuted(this.winId,this.props.webPanel.id),mobileMode:this.props.webPanel.mobileMode}).then((t=>{(0,mi.Z)(this.context,t)(e)}))};handleOnPermissionRequest=e=>{if(e.preventDefault(),"download"===e.permission)_e.Z.doDownload(e,this.context,this.refWebpanelwebview.current)};setZoomLevel=e=>{if(!this.refWebpanelwebview.current)return;const{zoom:t=1,id:s}=this.props.webPanel,n=e?t+df.Zh:t-df.Zh,i=Math.min(Math.max(n,df.XF),df.qt),a=Number(i.toFixed(1));Ko.Z.setZoom(s,a)};resetZoom=()=>Ko.Z.setZoom(this.props.webPanel.id,1);decreaseZoom=()=>this.setZoomLevel(!1);increaseZoom=()=>this.setZoomLevel(!0);render(){const e=Gn()({panel:!0,webpanel:!0,visible:this.props.isVisible});let t=Ko.Z.makePanelId(this.props.webPanel.id,this.winId);return this.props.webPanel.tabId&&(t=""+this.props.webPanel.tabId),(0,zn.jsxs)("div",{ref:this.nodeRef,className:e,children:[this.props.isVisible&&this.props.panelUI.showToolbar&&(0,zn.jsx)("header",{className:"webpanel-header",onContextMenu:this.onContextMenu,children:(0,zn.jsxs)("div",{className:"toolbar toolbar-default full-width",role:"toolbar","aria-labelledby":"webpanel-title",children:[(0,zn.jsx)("h1",{className:"webpanel-title",title:this.state.tooltip||this.state.title,children:(0,zn.jsx)("span",{id:"webpanel-title",children:this.state.title})}),(0,zn.jsxs)("div",{className:"toolbar toolbar-group",children:[this.props.panelUI.zoomControls&&(0,zn.jsxs)("div",{className:"toolbar-group pad-right",children:[(0,zn.jsx)("div",{className:"button-toolbar",children:(0,zn.jsx)("button",{className:"ToolbarButton-Button",title:(0,W.Z)("Reset Zoom"),onClick:this.resetZoom,disabled:!this.refWebpanelwebview||1===this.props.webPanel.zoom,dangerouslySetInnerHTML:{__html:Kn.kze}})}),(0,zn.jsx)("div",{className:"button-toolbar",children:(0,zn.jsx)("button",{className:"ToolbarButton-Button",title:(0,W.Z)("Zoom Out"),onClick:this.decreaseZoom,disabled:!this.refWebpanelwebview,dangerouslySetInnerHTML:{__html:Kn.M2k.small}})}),(0,zn.jsx)("div",{className:"button-toolbar",children:(0,zn.jsx)("button",{className:"ToolbarButton-Button",title:(0,W.Z)("Zoom In"),onClick:this.increaseZoom,disabled:!this.refWebpanelwebview,dangerouslySetInnerHTML:{__html:Kn.md4.small}})})]}),this.props.panelUI.deviceControl&&(0,zn.jsx)("div",{className:"toolbar-group pad-right",children:(0,zn.jsx)("div",{className:"button-toolbar",children:(0,zn.jsx)("button",{className:"ToolbarButton-Button",title:this.props.webPanel.mobileMode?(0,W.Z)("Switch to Desktop View"):(0,W.Z)("Switch to Mobile View"),onClick:this.setMobileMode,dangerouslySetInnerHTML:this.props.webPanel.mobileMode?{__html:Kn.X6J}:{__html:Kn.hPK}})})}),this.props.panelUI.allControls&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("div",{className:"button-toolbar",children:(0,zn.jsx)("button",{className:"button-toolbar back",title:(0,W.Z)("navigation","Back"),onClick:this.back,disabled:!this.state.canGoBack,dangerouslySetInnerHTML:{__html:Kn.mgF.small}})}),(0,zn.jsx)("div",{className:"button-toolbar",children:(0,zn.jsx)("button",{className:"button-toolbar forward",title:(0,W.Z)("navigation","Forward"),onClick:this.forward,disabled:!this.state.canGoForward,dangerouslySetInnerHTML:{__html:Kn.Zu.small}})}),(0,zn.jsx)("div",{className:"button-toolbar",children:(0,zn.jsx)("button",{className:"button-toolbar reload",title:(0,W.Z)("Reload"),onClick:this.reload,disabled:!this.state.canReload,dangerouslySetInnerHTML:{__html:Kn.GO5.small}})})]}),(0,zn.jsx)("div",{className:"button-toolbar",children:(0,zn.jsx)("button",{className:"button-toolbar home",title:(0,W.Z)("Home"),onClick:this.home,disabled:!this.state.canReload,dangerouslySetInnerHTML:{__html:Kn.PaK.small}})})]}),this.props.showCloseButton&&(0,zn.jsx)("button",{className:"close transparent",onClick:()=>en.Z.closePanel(this.winId),title:(0,W.Z)("Close Panel"),children:YK})]})}),(0,zn.jsx)("section",{className:"webpanel-content",children:(0,zn.jsx)("webview",{tab_id:t,parent_tab_id:"0",ref:this.refWebpanelwebview,name:"vivaldi-webpanel"},t)})]})}}const QK=XK;var qK=s(60339);const JK=["regular","double_height"];function ez(e){return e?(0,ve.Z)(e)?.hostname:""}function tz(e){const t=Un.useContext(oi.Z),s=Un.useRef(null),i=Un.useRef(null),[a,o]=Un.useState(!e.url),[r,l]=Un.useState((0,W.Z)("Title: $1",[ez(e.url)??""])),[d,c]=Un.useState((0,Kg.dO)(e.url??"about:blank")),[h,u]=Un.useState(void 0),[p,g]=Un.useState(!(0,qK.Qz)(e.pageId)||e.isActive),m=t.vivaldiWindowId,f=Un.useCallback((()=>{const e=s.current;if(!e)return;const t=Ue.Z.getBaseStylesByWindowId(m,["colorFg","colorBg","colorBgLight","colorHighlightFg","colorHighlightBg","radius"]),n=Si.ZP.isThemeDark({"--colorBg":t["--colorBg"]}),i=`:root {\n      --colorFg: ${t["--colorFg"]};\n      --colorBg: ${t["--colorBgLight"]};\n      --colorHighlightFg: ${t["--colorHighlightFg"]};\n      --colorHighlightBg: ${t["--colorHighlightBg"]};\n      --radius: ${t["--radius"]};\n      --isDarkTheme: ${n?1:0};\n    }`;e.insertCSS({code:i})}),[m]);Un.useEffect((()=>{e.shareTheme&&Ue.Z.addListener(f,(e=>e.theme.id))}),[f,e.shareTheme]),Un.useEffect((()=>{const t=()=>{g(!(0,qK.Qz)(e.pageId)||e.isActive)};t(),Ze.ZP.addListener(t)}),[e.isActive,e.pageId]);const v=Un.useCallback((e=>{let t;t=e&&"string"==typeof e?(0,Kg.dO)(e):(0,Kg.dO)("about:blank"),c((0,qe.TS)(d,t))}),[d]),b=Un.useCallback((async e=>{const t=parseInt(e);if(!t)return;const s=await n.Z.tabs.get(t),{url:i,title:a}=s;v(i);const o=(0,vs.Rf)(i??"");l("string"!=typeof a||""===a||o?i&&!o?(0,W.Z)("Title: $1",[ez(i)??""]):void 0:(0,W.Z)("Title: $1",[a]))}),[v]),C=Un.useCallback((t=>{function n(e){u(e.SSLState)}function a(t){t.isTopLevel&&(e.shareTheme&&f(),v(t.url))}function o(){if(!t?.tab_id)return;const e=t.tab_id.startsWith(nc.zs)?x.Z.resolve(t.tab_id):t.tab_id;e&&b(e)}s.current=t,i.current?.(),t?(t.addEventListener("contentload",o),t.addEventListener("loadcommit",a),t.addEventListener("sslstatechanged",n),t.setUserAgentOverride($K()),i.current=()=>{t.removeEventListener("contentload",o),t.removeEventListener("loadcommit",a),t.removeEventListener("sslstatechanged",n)}):i.current=null}),[e.shareTheme,v,b,f]);Un.useEffect((()=>{const t=s.current;if(!t)return;const n=e.url;n&&(t.tab_id.startsWith(nc.zs)?t.src=n:b(t.tab_id))}),[e.url,b]);const w=Un.useCallback((()=>{const t=s.current;if(!t)return[];const n=e.url;return[{handler:()=>{n&&(o(!1),t.src=n)},...t.src===n?(0,fi.Z)("Reload"):(0,fi.Z)("Go to Home Page")},{handler:()=>o(!0),...(0,fi.Z)("Change Webpage URL")}]}),[e.url]),[{canDrag:y},I]=(0,XB.c)((()=>({type:"DASHBOARD_WIDGET",item:{id:e.id},collect:e=>({canDrag:e.canDrag()})})));I(s.current);const A=x.Z.resolveWebWidget(m,e.id);return(0,zn.jsxs)(JH,{id:e.id,index:e.index,type:"webpage",size:e.size,sizeOptions:JK,background:e.background,keyAccess:e.keyAccess,className:"Dashboard-Webpage",getMenu:w,title:a?void 0:r,children:[e.url&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("div",{className:"url-wrapper",tabIndex:"-1",children:!a&&d&&(0,zn.jsxs)(zn.Fragment,{children:["warning"===h&&(0,zn.jsxs)("span",{className:"not-secure",children:["[",(0,W.Z)("Not Secure"),"]"]}),"security_error"===h&&(0,zn.jsxs)("span",{className:"not-secure",children:["[",(0,W.Z)("Dangerous"),"]"]}),(0,zn.jsx)(lm,{windowId:t.vivaldiWindowId,displayUrl:(0,Bb.gC)(d),shouldShowFullUrl:!1,onGoToPath:nr.Z,shouldHighlightBaseDomain:!1,urlFragments:d,rawDisplay:!0})]})}),(0,zn.jsx)("section",{style:{pointerEvents:y?"initial":"none",display:a?"none":"initial"},children:p?(0,zn.jsx)("webview",{ref:C,tab_id:A,role:"document",name:"vivaldi-webpage-widget",parent_tab_id:m}):(0,zn.jsxs)("div",{className:"webview-placeholder",children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.MSA.small}}),(0,zn.jsx)("p",{children:(0,W.Z)("Webpage is accessible in the active tile only.")})]})})]}),a&&(0,zn.jsx)(KK,{id:e.id,widgetUrl:e.url||"",onValidate:(t,n)=>{const i=s.current;var a,r;t===e.url&&n===e.shareTheme||(a=e.id,r={url:t,shareTheme:n},S.Z.dispatch({actionType:"DASHBOARD_UPDATE_WIDGET",widgetId:a,webpageData:r}),i&&(i.src=t),n||Ue.Z.ensureRemovedListener(f)),o(!1)},iconSize:"regular"===e.size?"medium":"large",shareTheme:e.shareTheme})]})}const sz=Un.memo(tz);var nz=s(79336);function iz(e,t){if(!t)return{display:"none"};return{transform:`translate(${t.x-b.V9/2}px, ${t.y-e/2}px)`,height:e,width:b.V9}}function az(){const{item:e,isDragging:t,sourceClientOffset:s}=(0,nz.f)((e=>({item:e.getItem(),isDragging:e.isDragging(),sourceClientOffset:e.getSourceClientOffset()}))),n=e?.type&&b.sB[e.type];if(!n||!t)return null;const{size:i,icon:a}=n,o="double_height"===i?2*b.EE+b.cX:b.EE;return(0,zn.jsx)("div",{className:"widget-drag-layer",children:(0,zn.jsx)("div",{style:iz(o,s),children:(0,zn.jsx)("span",{className:"icon",dangerouslySetInnerHTML:{__html:a?a.medium:""}})})})}var oz=s(46408);function rz(e){const t=Un.useContext(KH),{type:s,disabled:n,onClick:i,onKeyUp:a,title:o,icon:r}=e,l=Un.useRef(),[,d,c]=(0,XB.c)((()=>({type:b.qk,item:{type:s},collect:e=>({isDragging:e.isDragging()}),end:(e,s)=>{s.didDrop()||t.onDrop()}})),[]);return Un.useEffect((()=>{c((0,oz.r)(),{captureDraggingState:!0})}),[c]),d(l),(0,zn.jsxs)("button",{ref:l,className:"add-button",disabled:n,onClick:i,onKeyUp:a,children:[(0,zn.jsx)("span",{className:"icon",dangerouslySetInnerHTML:{__html:r?r.medium:""}}),(0,zn.jsx)("div",{children:o})]},s)}function lz({onClose:e,onAddWidget:t,widgets:s}){const n=Un.useCallback((t=>{"Escape"===t.key&&e()}),[e]);return(0,zn.jsxs)("div",{className:"dashboard-list-wrapper",children:[(0,zn.jsxs)("div",{className:"dashboard-list-header",children:[(0,zn.jsx)("h2",{children:(0,W.Z)("Add a New Widget")}),(0,zn.jsx)("button",{className:"close",tabIndex:"-1",dangerouslySetInnerHTML:{__html:Kn.kze},onClick:e})]}),(0,zn.jsx)("div",{className:"button-wrapper",children:Object.entries(b.sB).filter((([e,t])=>!(t.singular&&s.includes(e)))).map((([e])=>{const{icon:s,defaultTitle:i}=b.sB[e];return(0,zn.jsx)(rz,{type:e,title:i,icon:s,disabled:!1,onClick:()=>t(e),onKeyUp:n},e)}))})]})}function dz(e,t,s,n){let i=s,a=n;for(;void 0!==e[i]?.[a];)a<t-1?a+=1:(i+=1,a=0);return[i,a]}function cz(e,t){if(0===e.length)return[[],0];const s=[0];if(1===t){for(const t of e){const{height:e}=$H(t.size),n=s.at(-1)??0;s.push(n+e)}const t=s.at(-1)??0;return[s.slice(0,-1),t]}{const s=function(e,t){let s=[],n=[0,0];for(let i=0;i<e.length;i++){const a=e[i],{height:o}=$H(a.size);if(s[n[0]]){const e=s[n[0]],a=e.findIndex((e=>void 0===e));if(1===o){e[a]=i,s[n[0]]=e,n=dz(s,t,n[0],a);continue}{const e=[...s];for(let s=n[0];s<n[0]+o;s++){const n=e[s];if(n&&void 0!==n[a])break;if(n)e[s][a]=i;else{const s=new Array(t).with(a,i);e.push(s)}}s=e,n=dz(s,t,n[0],a);continue}}if(s.push(new Array(t).with(0,i)),n[1]=1,o>1){n[1]=1;for(let e=1;e<o;e++)s.push(new Array(t).with(0,i))}}return s}(e,t),n=function(e){const t=e[0].length,s=[0];let n=0;for(let i=0;i<e.length;i++){const a=e[i];for(let e=0;e<a.length;e++)a[e]&&a[e]>n&&(n=a[e],s.push(t*i+e))}return s}(s);return[n,s.length]}}const hz=Object.keys(b.sB).reduce(((e,t)=>{const{requiresMailEnabled:s}=b.sB[t];return s&&e.push(t),e}),[]),uz=[Z.kFeaturesMail,Z.kFeaturesFeeds,Z.kKeyboardTabToAll,Z.kDashboardColumnLimit];var pz=(0,zn.jsx)(az,{});const gz=mF((e=>{const t=Un.useContext(oi.Z),s=(0,Eo.Z)(uz),n=iE(),i=Un.useRef(y.getState()),a=Un.useRef(null),[o,r]=Un.useState(!1),[l,d]=Un.useState(),c=Boolean(l),[h,u]=Un.useState(),p=Boolean(h),m=function(e,t){let s=2;return e>1800?s=4:e>1200?s=3:e<600&&(s=1),Math.min(t,s)}(e.maxWidth,s[Z.kDashboardColumnLimit]),[f,v]=Un.useState(),[w,x]=Un.useState(),I=Un.useRef(),A=Un.useRef();Un.useEffect((()=>{function e(){i.current=y.getState(),n()}return y.addListener(e),()=>y.removeListener(e)}),[n]);const T=Un.useCallback((e=>{const t=i.current??[],s=t.find((t=>t.id===e));if(s)return{item:s,index:t.indexOf(s)}}),[]),E=Un.useRef(""),k=Un.useRef(""),N=Un.useCallback(((e,s)=>{if(e===E.current&&s===k.current)return;E.current=e,k.current=s;const o=()=>{n(),a.current=null,setTimeout((()=>{E.current="",k.current=""}),500)},r=i.current,l=T(e)?.index??0,d=T(s)?.index??0;r&&l!==d&&(i.current=(0,C.Uy)(r,(e=>{const t=e[d];e[d]=e[l],e[l]=t})),a.current||(a.current=t.requestAnimationFrame(o)))}),[t,T,n]),_=Un.useCallback((()=>{const e=i.current?.map((e=>e.id))??[];var t;t=e,S.Z.dispatch({actionType:"DASHBOARD_SET_WIDGET_ORDER",widgetIds:t}),v(void 0),x(void 0)}),[]),D=Un.useCallback(((e,t)=>{f?N(f,e):(v(e),x(t))}),[N,f]),O=Un.useMemo((()=>{const t={onMoveItem:N,onDrop:_,findItem:T,viewWidth:Math.max(320,e.maxWidth-160),columns:m,onMoveNew:D,animate:!1};return setTimeout((()=>t.animate=!0),1e3),t}),[m,T,_,N,D,e.maxWidth]),j=wt.Z.isMailOn(),L=wt.Z.isFeedsOn(),R=Un.useMemo((()=>j?[]:L?hz:[...hz,"feed"]),[L,j]),B=Un.useCallback(((e,t)=>{R.includes(e)?"feed"===e?(wt.Z.ensureFeedsIsOn(),P("feed",{index:t?.index})):R.includes("feed")?u({type:e,index:t?.index}):d({type:e,index:t?.index}):(P(e,t||{index:void 0}),r(!1))}),[R]),F=Un.useMemo((()=>s[Z.kKeyboardTabToAll]),[s]),U=[];for(const e of i.current??[])if(!R.includes(e.type)){if(e.id===f&&w){const e={id:"fake",type:w,size:b.sB[w].size};U.push(e)}U.push(e)}const[V,H]=cz(U,m),G=Un.useMemo((()=>({"--dashboardMaxWidth":`${Math.min(m*b.V9+(m-1)*b.cX,Math.max(320,e.maxWidth-160))}px`,"--widgetsHeight":`${Math.max(b.EE,H*(b.EE+b.cX))}px`})),[m,H,e.maxWidth]),[,K]=(0,QB.L)((()=>({accept:b.qk,drop:({type:e})=>{if(i.current){const t=i.current.findIndex((e=>e.id===f));B(e,{index:Math.max(t,0)}),v(void 0),x(void 0)}}})),[f,B]),[,z]=(0,QB.L)((()=>({accept:b.qk,hover:(e,t)=>{t.isOver({shallow:!0})&&v(void 0)},drop:({type:e},t)=>{if(t.isOver({shallow:!0})&&i.current){const t=i.current.length;B(e,{index:Math.max(t,0)}),v(void 0),x(void 0)}}})),[]),$=Boolean(U.filter((e=>"weather"===e.type))?.length>1);return K(A),z(I),(0,zn.jsxs)(KH.Provider,{value:O,children:[(0,zn.jsxs)("div",{ref:I,className:"Dashboard",style:G,children:[(0,zn.jsx)("div",{ref:A,className:"Dashboard-Widgets",children:U.map(((t,s)=>{if("fake"!==t.id)switch(t.type){case"email":return(0,zn.jsx)(RG,{id:t.id,index:V[s],size:t.size,background:t.background,keyAccess:F,accountId:t.accountId},t.id);case"calendar":return(0,zn.jsx)(nG,{id:t.id,index:V[s],size:t.size,background:t.background,keyAccess:F,calendarIds:t.calendarIds},t.id);case"shortcuts":let n=t.folderId;return"DEFAULT"===n&&(n=function(e){const t=g.Z.getTopNodes();let s=t.find((e=>"7dc00b6d-b26b-4371-83cb-2cd63274b9b8"===e.partner))?.id;return s||(console.error("Could not find home folder."),s=t[0]?.id??"1"),M(e,{folderId:s}),s}(t.id)),(0,zn.jsx)(iK,{id:t.id,index:V[s],size:t.size,background:t.background,keyAccess:F,folderId:n,showTitle:t.showTitle,showThumbnail:t.showThumbnail},t.id);case"tasks":return(0,zn.jsx)(gK,{id:t.id,index:V[s],size:t.size,background:t.background,keyAccess:F},t.id);case"feed":return(0,zn.jsx)($G,{id:t.id,index:V[s],size:t.size,background:t.background,keyAccess:F,feedId:t.feedId,feedDisplay:t.feedDisplay},t.id);case"sticky-note":return(0,zn.jsx)(dK,{id:t.id,index:V[s],size:t.size,background:t.background,keyAccess:F},t.id);case"tip":return(0,zn.jsx)(fK,{id:t.id,index:V[s],size:t.size,background:t.background,keyAccess:F,tipContent:t.tipContent,tipLink:t.tipLink,tipTimestamp:t.tipTimestamp},t.id);case"top-sites":return(0,zn.jsx)(CK,{id:t.id,index:V[s],size:t.size,background:t.background,keyAccess:F,showTitle:t.showTitle},t.id);case"privacy-stats":return(0,zn.jsx)(QG,{id:t.id,index:V[s],size:t.size,background:t.background,keyAccess:F},t.id);case"webpage":return(0,zn.jsx)(sz,{id:t.id,index:V[s],size:t.size,background:t.background,keyAccess:F,url:t.url,shareTheme:Boolean(t.shareTheme),pageId:e.pageId,isActive:e.isActive},t.id);case"date":return(0,zn.jsx)(NG,{id:t.id,index:V[s],size:t.size,background:t.background,keyAccess:F},t.id);case"weather":return(0,zn.jsx)(VK,{id:t.id,index:V[s],size:t.size,background:t.background,keyAccess:F,locationId:t.locationId,temperatureUnit:t.temperatureUnit,windspeedUnit:t.windspeedUnit,precipitationUnit:t.precipitationUnit??"mm",view:t.view,multipleViews:$},t.id);case"currency":return(0,zn.jsx)(EG,{id:t.id,index:V[s],size:t.size,background:t.background,keyAccess:F,currencyA:t.currencyA,currencyB:t.currencyB},t.id);default:return console.warn(`Widget ${t.type} does not exist.`),null}}))}),(0,zn.jsxs)("button",{className:Gn()("add-button",{pressed:o}),onClick:()=>r(!0),children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.md4.small}}),(0,zn.jsx)("p",{children:(0,W.Z)("Add a Widget")})]})]}),o&&(0,zn.jsx)(lz,{widgets:U.map((e=>e.type)),onClose:()=>r(!1),onAddWidget:B}),pz,c&&(0,zn.jsx)($C,{title:(0,W.Z)("Would you like to enable Mail and Calendar?"),prompt:[(0,W.Z)("Enjoy Dashboard widgets displaying your latest mail and calendar events")],positive:(0,W.Z)("Enable Components"),negative:(0,W.Z)("Not Now"),onClose:e=>{if(e&&(wt.Z.ensureMailIsOn(),l)){const{type:e,index:t}=l;P(e,{index:t})}d()}}),p&&(0,zn.jsx)($C,{title:(0,W.Z)("Would you like to enable Mail, Calendar and Feeds?"),prompt:[(0,W.Z)("Enjoy Dashboard widgets displaying your latest mail, calendar events, or RSS feed news.")],positive:(0,W.Z)("Enable Components"),negative:(0,W.Z)("Not Now"),onClose:e=>{if(e&&(wt.Z.ensureMailIsOn(),h)){const{type:e,index:t}=h;P(e,{index:t})}u()}})]})})),mz=gz;var fz=s(34155);const vz=function(e){const[t,s]=(0,Un.useState)(),n=(0,aT.extendMoment)(V()),i=n.range(e.minDate,e.maxDate),a=Array.from(i.by("month")),o=(0,Un.createRef)(),r=t=>{e.onSelect(t),s(void 0)},l=({index:s,parent:n,key:i,style:o})=>(0,zn.jsx)(sE,{style:e.isHeatMap?o:{},events:[],month:a[s],selectedDate:e.selectedDate,onSelect:r,showOutOfMonthDays:e.isHeatMap,renderMonthDay:e.renderMonthDay,highlightMode:"day",fixedHeight:!1,highlightedDate:t},i);return(0,zn.jsx)("div",{ref:o,onMouseDown:e=>{e.currentTarget?.focus()},onKeyDown:a=>{const l=t&&n(t).within(i)?t:e.selectedDate;let d;switch(JS.Z[a.keyCode]){case"Left":if(l.isSame(e.minDate.startOf("month"),"day"))break;d=l.clone().subtract(1,"day");break;case"Right":if(l.isSame(e.maxDate.endOf("month"),"day"))break;d=l.clone().add(1,"day");break;case"Up":if(l.isSame(e.minDate.startOf("month"),"day"))break;d=l.clone().subtract(1,"week"),l.isSame(e.minDate,"month")&&l.date()<8&&(d=l.clone().startOf("month"));break;case"Down":if(l.isSame(e.maxDate.endOf("month"),"day"))break;d=l.clone().add(1,"week"),l.isSame(e.maxDate,"month")&&l.clone().endOf("month").date()-l.date()<8&&(d=l.clone().endOf("month"));break;case"Space":case"Enter":a.preventDefault(),r(l);break;case"Escape":a.preventDefault(),s(void 0)}if(d&&(a.preventDefault(),s(d),e.isHeatMap)){const e=o.current?.children[0].querySelector(".CalendarMonth-Day--Highlighted");fz.nextTick((()=>e?.scrollIntoViewIfNeeded()))}},tabIndex:"0",className:e.isHeatMap?"timeline-grid":"month-view-grid",children:(0,zn.jsx)(XD.q,{children:({height:t,width:s})=>(0,zn.jsx)(QD.a,{width:s,height:t,rowHeight:t=>e.isHeatMap?(({index:t})=>{const s=6===a[t].endOf("month").weekday()||a[t].endOf("month").isSame(e.maxDate)?0:1;return 50*(Math.ceil((a[t].daysInMonth()+a[t].startOf("month").weekday())/7)-s)})(t):e.maxHeight,rowRenderer:l,rowCount:a.length,estimatedRowSize:e.isHeatMap?250:e.maxHeight,overscanRowCount:1,scrollToIndex:e.isHeatMap?a.length-1:void 0},e.isHeatMap?void 0:e.selectedDate.format("YY-MM"))})})};const bz=function(e){if(0===e.length)return{combinedTopPages:[],linkTypes:[],linkTypeColors:[],linkTypeTotal:0,pageCount:0,siteCount:0};const t={},s={};let n=Ue.Z.getState().theme.colorHighlightBg,i=Be()(n).get("hsl.h"),a=Be()(n).get("hsl.s");const o=Be()(n).get("hsl.l");(a<.2||o<.4)&&(n="#006ed7",i=Be()(n).get("hsl.h"),a=Be()(n).get("hsl.s"));const r=Be().scale([n,Be()(n).set("hsl.h",i+50).desaturate(a),Be()(n).set("hsl.h",i+130).desaturate(a),Be()(n).set("hsl.h",i+180).desaturate(a),Be()(n).set("hsl.h",i+230).desaturate(a),Be()(n).set("hsl.h",i-50).desaturate(a)]).mode("lab").colors(6);let l=[{type:"auto_toplevel",count:0,color:r[0],print:(0,W.Z)("linktype","Direct")},{type:"typed",count:0,color:r[1],print:(0,W.Z)("linktype","Typed")},{type:"link",count:0,color:r[2],print:(0,W.Z)("linktype","Link")},{type:"reload",count:0,color:r[3],print:(0,W.Z)("linktype","Reload")},{type:"form_submit",count:0,color:r[4],print:(0,W.Z)("linktype","Form")},{type:"other",count:0,color:r[5],print:(0,W.Z)("linktype","Other")}];e.forEach((e=>{l=e.children.map((e=>e.transitionType)).filter(Boolean).reduce(((e,t)=>{const s=e.find((e=>e.type===t));if(s)s.count=s.count+1;else{const t=e.find((e=>"other"===e.type));t&&(t.count=t.count+1)}return e}),l)}));const d=l.map((e=>e.color)),c=l.reduce(((e,t)=>e+t.count),0);e.forEach((e=>{e.children.forEach((e=>{e&&(t[e.address]=t[e.address]?e.visitCount+t[e.address]||0:e.visitCount,s[e.url]=s[e.url]?e.visitCount+s[e.url]||0:e.visitCount)}))}));const h=Object.keys(s).length,u=Object.keys(t).length;return{linkTypeColors:d,linkTypeTotal:c,combinedTopPages:Object.keys(t).map((e=>({url:e,visitCount:t[e]}))).sort(((e,t)=>t.visitCount-e.visitCount)),linkTypes:l,pageCount:h,siteCount:u}};var Cz=s(9740),wz=s(76148),yz=s(97599);const xz=(0,aT.extendMoment)(V()),Iz={top:6,right:12,bottom:40,left:30},Az={axis:{stroke:"var(--colorFg)"},axisLabel:{fontSize:12,padding:20},grid:{stroke:"var(--colorFgAlpha)"},tickLabels:{angle:-45,textAnchor:"end",fontSize:11,padding:5,fontWeight:600,fontFamily:"inherit"}},Sz={labels:{fontSize:13,padding:0,fontFamily:"inherit"}},Zz={labels:{fontSize:13,padding:0,fontFamily:"inherit"}};var Tz=(0,zn.jsx)(lG.i6,{mouseFollowTooltips:!0,voronoiDimension:"x"}),Ez=(0,zn.jsx)(zh.E,{dependentAxis:!0,standalone:!1,style:{axis:{stroke:"var(--colorFg)"},axisLabel:{fontSize:12,padding:20},grid:{stroke:"var(--colorFgAlpha)"},ticks:{stroke:"var(--colorFg)"},tickLabels:{fontSize:11,padding:5,fontFamily:"inherit"}}}),kz=(0,zn.jsx)(rG.y,{constrainToVisibleArea:!0,pointerLength:0,flyoutStyle:{stroke:"var(--colorBorder)",fill:"var(--colorBg)"}}),Nz=(0,zn.jsx)(rG.y,{center:{x:80,y:80},pointerWidth:0,pointerLength:0,cornerRadius:0,flyoutStyle:{stroke:"none",fill:"transparent"}});class _z extends Un.PureComponent{state={externalMutations:[]};#ls=Ci()((function(e){return e.filter((e=>e.children.length>0))}));#ds=Ci()((function(e,t){if(1===t.length&&t[0].id){const e=[];for(let s=0;s<=24;s++){const n=t[0],i=n.visitTime+3600*s*1e3,a=n.children.filter((e=>{const t=e.visitTime-i;return t>0&&t<36e5}));e.push({hour:s,pages:a.length,visits:a.reduce(((e,t)=>e+t.visitCount),0),unixDate:i})}return e}{const{range:s}=e;let n=s.start.clone(),i=s.end.clone();t.length===s.duration("days")&&(n=n.startOf(e.displayMode),i=i.endOf(e.displayMode));const a=xz.range(n,i),o=new Map;for(const e of t){const t=e.id,s=xz(t,"YYYY-MM-DD");s.within(a)&&o.set(t,{hour:0,pages:e.children.length,visits:e.visitCount,unixDate:s.valueOf()})}const r=new Map,l=n.clone().subtract(1,"d"),d=n,c=n.clone().add(1,"d"),h=a.diff("days")<32;do{const e=(0,F.SI)(d);!o.has(e)&&(h||o.has((0,F.SI)(l))||o.has((0,F.SI)(c)))&&r.set(e,{hour:0,pages:0,visits:0,unixDate:d.valueOf()}),l.add(1,"d"),d.add(1,"d"),c.add(1,"d")}while(d.diff(i)<=0);const u=[...o.values(),...r.values()].sort(((e,t)=>e.unixDate-t.unixDate)),p=200;if(u.length>p)for(;u.length>p;){const e=Math.floor(Math.random()*u.length);u.splice(e,1)}return u}}));#cs=Ci()((function(e){if(e.length>2){const t=[e[0].id,e[e.length-1].id];return xz(t[0]).diff(xz(t[1]),"days")}return e.length}));formatTick=e=>{const t=this.#cs(this.#ls(this.props.nodes));let s;switch(!0){case t<6:s="H:00",0===xz(e).hour()&&(s="ddd D");break;case t<20:s="H:00",0===xz(e).hour()&&(s="ddd D"),1===xz(e).date()&&(s="MMM",0===xz(e).month()&&(s="MMM YYYY"));break;case t<80:s="ddd D",1===xz(e).date()&&(s="MMM D",0===xz(e).month()&&(s="MMM YYYY"));break;default:s="MMM",0===xz(e).month()&&(s="YYYY")}return xz(e).format(s)};formatTotalLabel=({datum:e})=>{if(!e)return null;const t=this.formatTick(new Date(Math.round(e.unixDate)));return e.visits<1?t:(0,W.Z)("$1\nViews: $2\nPages: $3",[t,Math.round(e.visits),Math.round(e.pages)])};formatPieLabel=e=>{const t=e.slice.data;if(Number.isInteger(t.count)){const{linkTypeTotal:e}=this.#hs(this.#ls(this.props.nodes)),s=(0,yz.Z)(t.count/e*100,0);if(s>0)return`${t.print}\n${s} %`}};removeMutation=()=>{this.setState({externalMutations:[]})};toggleLabel=(e,t)=>{this.setState({externalMutations:[{target:"labels",eventKey:"all",mutation:()=>({active:!1}),callback:()=>this.removeMutation()},{target:"data",eventKey:"all",mutation:()=>({style:void 0}),callback:()=>this.removeMutation()},{target:"labels",eventKey:String(e),mutation:()=>({active:t}),callback:()=>this.removeMutation()},{target:"data",eventKey:String(e),mutation:()=>t?{style:{opacity:.5,fill:this.#hs(this.#ls(this.props.nodes)).linkTypeColors[e],stroke:"var(--colorBg)",strokeWidth:2}}:{style:void 0},callback:()=>this.removeMutation()}]})};formatAreaXValue=e=>xz(e.unixDate).toDate();formatAreaYValue=e=>e.visits-e.pages;pieEvents=[{target:"data",eventHandlers:{onMouseEnter:()=>[{target:"labels",mutation:()=>({active:!0})},{target:"data",mutation:e=>{const{linkTypeColors:t}=this.#hs(this.#ls(this.props.nodes));return{style:{...e.style,fill:t[e.index],opacity:.5,stroke:"var(--colorBg)",strokeWidth:2}}}}],onMouseOut:()=>[{target:"labels",mutation:()=>({active:!1})},{target:"data",mutation:()=>({style:void 0})}]}}];#hs=Ci()((function(e){return bz(e)}));render(){const{title:e,filter:t,max:s,scaleY:n,pageViewsCount:i}=this.props,a=this.#ls(this.props.nodes),o=this.#hs(a),r=this.#ds(t,a),l=0===a.length,{linkTypeColors:d,linkTypes:c,combinedTopPages:h,pageCount:u,siteCount:p}=o,g=this.#cs(a)<2,m={y:g?[0,s/2]:[0,s]},f={x:"time",y:n},v=[d[0],d[3]],b="linear";return(0,zn.jsxs)("div",{className:"manager-editor more-info",children:[(0,zn.jsx)("div",{className:"header",children:(0,zn.jsx)("h1",{children:e})}),(0,zn.jsxs)("div",{className:"moreinfo-stats",children:[(0,zn.jsx)("h2",{children:(0,W.Z)("Browsing Activity")}),(0,zn.jsx)("div",{className:"moreinfo-activity",children:!1===l&&(0,zn.jsxs)($h.k,{containerComponent:Tz,width:245,height:200,padding:Iz,domain:m,scale:f,children:[(0,zn.jsx)(zh.E,{tickCount:g?13:void 0,tickFormat:this.formatTick,standalone:!1,style:Az}),Ez,(0,zn.jsxs)(Cz.N,{standalone:!0,responsive:!1,colorScale:v,style:Sz,labels:this.formatTotalLabel,labelComponent:kz,children:[(0,zn.jsx)(Yh.b,{data:r,interpolation:b,standalone:!1,x:this.formatAreaXValue,y:"pages"}),(0,zn.jsx)(Yh.b,{data:r,interpolation:b,standalone:!1,x:this.formatAreaXValue,y:this.formatAreaYValue})]})]})}),(0,zn.jsxs)("ul",{className:"moreinfo-activity-labels",children:[(0,zn.jsxs)("li",{className:"visits",children:[(0,zn.jsx)("span",{style:{backgroundColor:v[1]}}),(0,W.Z)("Page Views: $1",[i])]}),(0,zn.jsxs)("li",{className:"pages",children:[(0,zn.jsx)("span",{style:{backgroundColor:v[0]}}),(0,W.Z)("Pages: $1",[u])]})]}),(0,zn.jsx)("h2",{children:(0,W.Z)("Link Transition Type")}),(0,zn.jsxs)("div",{className:"moreinfo-link-types",children:[!1===l&&(0,zn.jsx)(wz.b,{externalEventMutations:this.state.externalMutations,data:c,x:"type",y:"count",width:160,height:160,innerRadius:40,padding:10,colorScale:d,style:Zz,labels:this.formatPieLabel,labelComponent:Nz,events:this.pieEvents}),!1===l&&(0,zn.jsx)("ul",{className:"moreinfo-link-labels",children:c.map(((e,t)=>(0,zn.jsxs)("li",{onMouseEnter:()=>this.toggleLabel(t,!0),onMouseOut:()=>this.toggleLabel(t,!1),title:e.print.length>7?e.print:null,className:0===e.count?"disabled":null,children:[(0,zn.jsx)("span",{style:{backgroundColor:e.color}}),e.print]},e.type)))})]}),(0,zn.jsx)("h2",{children:(0,W.Z)("Top Domains of $1 Total",[p])}),h.length>0&&(0,zn.jsx)("ul",{className:"moreinfo-top-domains",children:h.map(((e,t)=>{if(t<5)return(0,zn.jsxs)("li",{onClick:this.props.onOpenDomain.bind(this,e.url),onContextMenu:this.props.onDomainContextMenu.bind(this,e.url),children:[(0,zn.jsx)(Vn.ZP,{url:(0,Ar.q9)(e.url),loadType:"page"}),(0,zn.jsx)("span",{className:"title link",children:e.url?e.url:"localhost"}),(0,zn.jsx)("span",{className:"item-count",children:e.visitCount})]},"top_domain_"+t)}))})]})]})}}const Pz=_z;var Mz=s(62819),Dz=s(10334);const Oz=[(0,fi.Z)("keyword","title"),(0,fi.Z)("keyword","url")].map((e=>{const t=(0,Dz.lp)({label:e.label});return{...e,labelMatch:t,wordMatch:new RegExp(t,"i")}})),jz=Oz.map((e=>e.labelMatch)).join("|"),Lz=new RegExp(`(${jz}):\\s*((['"])([^'"]*)\\3|\\S*([^:\\w]|\\w+\\b(?!:))*)`,"gi"),Rz=function(e){const t=e.match(Lz);if(!t)return{title:"",url:"",query:e.length?e.trim():""};const s=t[0],n=e.indexOf(s),i={query:e.substring(0,n).trim(),url:"",title:""};return t.forEach((e=>{const[t,s]=e.split(":");switch(Oz.find((e=>e.wordMatch.test(t)))?.labelEnglish){case"query":i.query=s.trim();break;case"title":i.title=s.trim();break;case"url":i.url=s.trim()}})),i};class Bz extends Un.Component{static contextType=oi.Z;refSearch=Un.createRef();refDatePicker=Un.createRef();search=e=>{this.props.search({...this.props.filter,...e})};focusField=()=>{this.refSearch.current?.focus()};onSearchChange=e=>{this.updateFilter(e.target.value)};updateFilter=e=>{const t=Rz(e.trim()),s={text:e,parsedFilter:t};this.search(s)};onStartTimeChange=e=>{const t=V()(e.target.value).startOf("day");t.isValid()&&this.search({startTime:t})};onEndTimeChange=e=>{const t=V()(e.target.value).endOf("day");this.search({endTime:t})};onSelectOption=()=>{const e=function(e){const t=parseInt(e);if(!isNaN(t))return t;switch(e){case"today":case"yesterday":case"last_month":case"all":case"date_range":return e;default:return"today"}}(this.refDatePicker.current?.value),t=Mz.Z.getTimeByRange({rangePicker:e},this.props.minDate.startOf("day"));this.search(t)};onClearBrowsingData=()=>{ue.Z.showClearBrowsingHistoryDialog(this.context.vivaldiWindowId)};convertDate=e=>(0,F.SI)(V()(e));render(){const e=this.props.filter,t=this.convertDate(new Date);return(0,zn.jsx)(zn.Fragment,{children:(0,zn.jsxs)("div",{className:"toolbar toolbar-default toolbar-wrap",children:[(0,zn.jsx)("input",{ref:this.refSearch,type:"search",tabIndex:"0",style:{flexShrink:2},value:e.text,onChange:this.onSearchChange,onFocus:this.props.onFocus,onBlur:this.props.onBlur,placeholder:(0,W.Z)("verb","Search"),disabled:!this.props.hasHistory}),this.props.showPicker&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)(Fa.Z,{ref:this.refDatePicker,value:this.props.filter.rangePicker,onChange:this.onSelectOption,children:[(0,zn.jsx)("option",{value:"today",children:(0,W.Z)("other","Today")}),(0,zn.jsx)("option",{value:"yesterday",children:(0,W.Z)("Yesterday")}),(0,zn.jsx)("option",{value:"7",children:(0,W.Z)("Last 7 Days")}),(0,zn.jsx)("option",{value:"30",children:(0,W.Z)("Last 30 Days")}),(0,zn.jsx)("option",{value:"date_range",children:(0,W.Z)("Date Range...")}),(0,zn.jsx)("option",{value:"all",children:(0,W.Z)("All History")})]}),"date_range"===e.rangePicker&&(0,zn.jsxs)("div",{className:"date-range",children:[(0,zn.jsx)(wx.Z,{title:(0,W.Z)("Start Date"),max:t,value:this.convertDate(e.startTime),onChange:this.onStartTimeChange}),(0,zn.jsx)(wx.Z,{title:(0,W.Z)("End Date"),max:t,value:this.convertDate(e.endTime),onChange:this.onEndTimeChange})]})]}),this.props.showClearBtn&&(0,zn.jsx)(oa.ZP,{onClick:this.onClearBrowsingData,tooltip:(0,W.Z)("title","Clear browsing data"),image:Kn.DwE.small,commandId:"COMMAND_SHOW_CLEAR_PRIVATE_DATA"})]})})}}const Fz=Bz;class Wz extends Un.Component{handleClick=(e,t)=>{e.preventDefault(),e.altKey?this.props.isExpanded?this.props.collapseAll():this.props.expandAll():this.props.toggle(t)};render(){const{folder:e,children:t}=this.props,s=t.reduce(((e,t)=>e+t.visitCount),0),n=F.ZP.getWeekdayFormat("LL"),i=V()(e.visitTime).format(n),a=e.id;return(0,zn.jsxs)("label",{"data-parent":a,onClick:this.props.fullView?e=>this.handleClick(e,a):null,children:[!this.props.fullView&&(0,zn.jsx)("span",{className:"expand-icon",onMouseDown:wi.ZP,onMouseUp:e=>this.handleClick(e,a),dangerouslySetInnerHTML:{__html:Kn.nfH}}),(0,zn.jsx)("span",{className:"url",children:i}),!0===this.props.showBadge&&(0,zn.jsx)("span",{className:"item-count",children:s})]})}}const Uz=Wz;var Vz=(0,zn.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",children:(0,zn.jsx)("path",{d:"M4.5,13.5v-12h7v12L8,10.7L4.5,13.5z"})});function Hz(e){const{node:t}=e,s=Un.useContext(oi.Z);function n(e){const{document:n}=s;var i=n.createElement("img");i.srcset="chrome://favicon/size/16@1x/"+t.url+" 1x,chrome://favicon/size/16@2x/"+t.url+" 2x",e.dataTransfer.setDragImage(i,i.width-i.width/3,i.height-i.height/3),i.remove(),lo(e,t.url,t.title)}const i=V()(t.visitTime),a=t.url.split("\\").pop()?.split("/").pop()||t.url,o=F.ZP.getWeekdayFormat("LL"),r=Un.useMemo((()=>(0,Kg.dO)(t.url)),[t.url]);return e.fullView?e.columns?(0,zn.jsx)(zn.Fragment,{children:e.columns.map((e=>{switch(e.id){case"visitTime":return(0,zn.jsx)("label",{className:"date",title:i.format(o),draggable:"true",onDragStart:n,children:(0,zn.jsx)("span",{children:i.format("LTS")})},e.id);case"title":return(0,zn.jsxs)("label",{className:"title",title:t.title?t.title:a,draggable:"true",onDragStart:n,children:[(0,zn.jsx)(Vn.ZP,{url:t.url,loadType:"page"}),(0,zn.jsx)("span",{children:t.title?t.title:a})]},e.id);case"address":return(0,zn.jsxs)("label",{className:"url",title:t.url,draggable:"true",onDragStart:n,children:[g.Z.findByUrl(t.url)&&Vz,(0,zn.jsx)(lm,{windowId:s.vivaldiWindowId,urlFragments:r,displayUrl:t.url,shouldShowFullUrl:!0,onGoToPath:nr.Z,onBaseDomainObscured:nr.Z,shouldHighlightBaseDomain:!1,rawDisplay:!0})]},e.id);case"visitCount":return(0,zn.jsx)("label",{className:"visits",draggable:"true",onDragStart:n,children:t.visitCount>1&&(0,zn.jsx)("span",{className:"item-count",children:t.visitCount})},e.id);default:console.warn("Unknown sorting field:",e.id)}}))}):null:(0,zn.jsxs)("label",{title:i.format("LTS")+u.YV+i.format(o)+u.YV+(t.title?(0,W.Z)("Title: $1",[t.title])+u.YV:"")+(0,W.Z)("Address: $1",[t.url]),onMouseEnter:function(){const e=t.url;h.Z.setStatus(s.vivaldiWindowId,e)},onMouseLeave:function(){h.Z.clearStatus(s.vivaldiWindowId)},draggable:"true",onDragStart:n,className:e.isLastChild?"last-in-group":"",children:[(0,zn.jsx)(Vn.ZP,{url:t.url,loadType:"page"}),(0,zn.jsxs)("span",{className:"title",children:[(0,zn.jsx)("span",{className:"time",children:i.format("LT")}),t.title?t.title:t.url]}),t.visitCount>1&&(0,zn.jsx)("span",{className:"item-count",children:t.visitCount})]})}function Gz(e,t,s){Jn.ZP.openUrls(e,(0,WD.Z)(t),s,!0)}class Kz extends Un.PureComponent{static contextType=oi.Z;refTreeList=Un.createRef();_isPrivateWindow=fe.ZP.isIncognito(this.context.vivaldiWindowId);state={showBadge:A.Z.get(Z.kPanelsShowFolderBadge)};componentDidMount(){A.Z.addListener(Z.kPanelsShowFolderBadge,this._onBadgeChanged)}componentWillUnmount(){A.Z.removeListener(Z.kPanelsShowFolderBadge,this._onBadgeChanged)}_onBadgeChanged=(e,t)=>{this.setState({showBadge:Boolean(t)})};hasChildren=e=>Boolean(e.children?.length);isFolder=e=>Boolean(e.children);unSelectAll=()=>{this.refTreeList.current?.unSelectAll()};getSelectedItem=()=>this.refTreeList.current?.getSelectedItem();getSelectedUrls=()=>this.refTreeList.current?.getAllSelectedItems().map((e=>e.url))??[];getItemById=e=>{const t=function(s){for(let n=0;n<s.length;n++){const i=s[n];if(i.id===e)return i;if(i.children){const e=t(i.children);if(e)return e}}};return t(this.props.nodes)};getItemsByIds=(e,t)=>{const s=[];return e.forEach((e=>{const n=this.getItemById(e);n&&(n.children&&t?s.push(...n.children):s.push(n))})),s};getUrlsByIds=e=>this.getItemsByIds(e,!0).map((e=>e.url)).filter(Boolean);openSelected=()=>{const e=this.getSelectedUrls(),t={inCurrent:!0,inNewWindow:!1,inBackground:!1,incognito:!1,transition:re.Z.historyPrivate.TransitionType.AUTO_TOPLEVEL};Gz(this.context.vivaldiWindowId,e,t)};openSelectedInNewTab=e=>{const t=this.getSelectedUrls(),s={inCurrent:!1,inNewWindow:!1,inBackground:e||A.Z.get(Z.kTabsOpenNewInBackground),incognito:!1,transition:re.Z.historyPrivate.TransitionType.AUTO_TOPLEVEL};Gz(this.context.vivaldiWindowId,t,s)};openSelectedInNewWindow=e=>{const t=this.getSelectedUrls(),s={inCurrent:!1,inNewWindow:!0,inBackground:!1,incognito:e,transition:re.Z.historyPrivate.TransitionType.AUTO_TOPLEVEL};Gz(this.context.vivaldiWindowId,t,s)};copy=(e,t)=>{const{clipboardData:s}=e;if(s){const e=t.map((e=>e.id)),n=this.getUrlsByIds(e);s.setData("text/plain",n.join("\r\n")),s.setData("text/uri-list",n.join("\r\n")),s.setData("vivaldi/x-uri-list",n.join("\r\n"))}e.preventDefault()};delete=e=>{const t=[];return this.getItemsByIds(e,this.props.filter&&this.props.filter.text.length>0).forEach((e=>{e.children?t.push({isFolder:!0,visitTime:e.visitTime}):t.push({isFolder:!1,url:e.url,visitTime:e.visitTime})})),Le.deleteHistoryPromise(t)};_saveBookmarks=e=>{const t=g.Z.getRootId();if(void 0!==t){const s=this.getItemsByIds(e,!0).map((e=>{if(!e.children)return{url:e.url,title:e.title}})).filter(Boolean);ne.Z.createBookmarks(s,t,0,"history")}};handleExpandClick=e=>{this.refTreeList.current?.toggleSelectedExpansion(e)};expandAll=()=>{this.refTreeList.current?.expandAll()};collapseAll=()=>{this.refTreeList.current?.collapseAll()};getMenuCapability=async(e,t,s)=>{const n=this.context.vivaldiWindowId,i={address:s.children?"":s.address,selectedCount:this.refTreeList.current?.getSelectedCount()??2};switch(e.action){case"CONTEXT_OPEN_IN_NEW_TAB":return{handler:()=>this.openSelectedInNewTab(!1),isVisible:()=>Boolean(s),...t(n,e,i)};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{handler:()=>this.openSelectedInNewTab(!0),isVisible:()=>!A.Z.get(Z.kTabsOpenNewInBackground)&&Boolean(s),...t(n,e,i)};case"CONTEXT_OPEN_IN_TAB":return{handler:this.openSelected,isVisible:()=>Boolean(s),...t(n,e,i)};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{handler:()=>this.openSelectedInNewWindow(!1),isVisible:()=>Boolean(s),...t(n,e,i)};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{handler:()=>this.openSelectedInNewWindow(!0),isVisible:()=>Boolean(s),...t(n,e,i)};case"CONTEXT_CONTAINER_OPEN_IN_WINDOW":{const i=this.getSelectedUrls(),a=await ro.getMenu(n,!0,i);return{isVisible:()=>Boolean(s)&&a.length>0,items:a,...t(n,e,{})}}case"CONTEXT_FILTER_BY":return{handler:()=>this.props.onSearchDomain(i.address),isVisible:()=>Boolean(s)&&!this.isFolder(s),...t(n,e,i)};default:return{...t(n,e,i)}}};getMenuVisibility=(e,t)=>{if(t)switch(e.action){case"CONTEXT_COPY":case"CONTEXT_SAVE":case"CONTEXT_DELETE":case"CONTEXT_EXPAND_ALL":case"CONTEXT_COLLAPSE_ALL":return!0;default:return!1}else switch(e.action){case"CONTEXT_EXPAND_ALL":case"CONTEXT_COLLAPSE_ALL":return!0;default:return!1}};onContextMenu=e=>{this.refTreeList.current?.onContextMenu(e)};onItemMouseDown=(e,t)=>{t.button===ai.Z.kCenter&&(t.preventDefault(),t.stopPropagation())};onItemMouseUp=(e,t)=>{t.button===ai.Z.kCenter&&(this.openSelectedInNewTab(!0),t.preventDefault(),t.stopPropagation())};onItemDoubleClick=e=>{if(e.button!==ai.Z.kCenter){const t=this.context.vivaldiWindowId;Gz(t,this.getSelectedUrls(),{...(0,fo.ZP)(t,{button:e.button,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,metaKey:e.metaKey})})}};onItemsActivated=(e,t)=>{const s=this.context.vivaldiWindowId;Gz(s,this.getUrlsByIds(t.map((e=>e.id))),{...(0,fo.ZP)(s,{ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,metaKey:e.metaKey})})};handleSelect=e=>{if(e&&!e.children&&this.refTreeList.current?.isItemSelected(e.id)){const t=(0,Mz.E)(e.visitTime),s=this.refTreeList.current?.findTreeItem(t);if(s&&this.refTreeList.current?._isFolderWithChildren(s)&&this.refTreeList.current?.isItemSelected(s.id)){const e=!1;this.refTreeList.current?.SelectionMixinSelectItem(s.id,!e,!1,e)}}};validateForDeletion=vI.Z;getRowComponentProps=e=>({...e,columns:this.props.columns,showBadge:this.state.showBadge});rowComponent=e=>{const{columns:t,node:s,isExpanded:n,isLastChild:i}=e;return s.children?(0,zn.jsx)(Uz,{folder:s,children:s.children,isExpanded:n,toggle:this.handleExpandClick,expandAll:this.expandAll,collapseAll:this.collapseAll,showBadge:e.showBadge,fullView:this.props.fullView},"history_tree_folder_"+s.id+"_"+s.visitTime):(0,zn.jsx)(Hz,{node:s,columns:t,isPrivateWindow:this._isPrivateWindow,fullView:this.props.fullView,isLastChild:i},"history_tree_item_"+s.id+"_"+s.visitTime)};getRowHeight=(e,t)=>{const s=Ti();if(this.props.inManager)return s;return e.children?0===e.index?s+6:s+6+6:t?s+3:s};menu={name:"historylist",getCapability:this.getMenuCapability,getVisibility:this.getMenuVisibility};render(){if(!this.props.nodes)return null;const e={sortOrder:this.props.filter.sortOrder,sortField:this.props.filter.sortField,onlyScroll:!0},{filter:t,nodes:s}=this.props,{text:n,displayMode:i}=t;if("week"!==i&&!s.some((e=>Boolean(e.children?.length))))return(0,zn.jsx)("div",{className:"vivaldi-tree-empty",children:(0,W.Z)("The search term “$1” did not return any results.",[n])});const a=s.some((e=>Boolean(e.children)));return(0,zn.jsx)(Mi,{settings:this.props.inManager?"HISTORY_MANAGER":"HISTORY_PANEL",ref:this.refTreeList,rowComponent:this.rowComponent,getRowComponentProps:this.getRowComponentProps,nodes:(a?s.filter((e=>Boolean(e.children?.length))):s).map(((e,t)=>({index:t,...e}))),columns:this.props.columns,folderMode:"expand",hasChildren:this.hasChildren,isFolder:this.isFolder,onItemDoubleClick:this.onItemDoubleClick,onItemMouseDown:this.onItemMouseDown,onItemMouseUp:this.onItemMouseUp,onItemsActivated:this.onItemsActivated,onCopy:this.copy,onSave:this._saveBookmarks,menu:this.menu,delete:this.delete,disableSelectAfterDelete:!1,enableDragAndDrop:!1,validateForDeletion:this.validateForDeletion,sorting:e,onSelect:this.handleSelect,rowHeight:this.getRowHeight})}}const zz=Kz;function $z(e){return{text:"",startTime:V()().startOf("day"),endTime:V()().endOf("day"),rangePicker:"today",displayMode:"day",parsedFilter:{title:"",url:"",query:""},searchURL:!0,searchTitle:!0,range:null,sortOrder:ui.Z.DESCENDING_SORT,sortField:"visitTime",...e}}const Yz=[Z.kStartpageNavigation],Xz=[{text:(0,W.Z)("Date"),fullScreenTitle:(0,W.Z)("Sort by visit time"),value:"visitTime",icon:Kn.V_c,width:100,visible:!0},{text:(0,W.Z)("Title"),fullScreenTitle:(0,W.Z)("Sort by page title"),value:"title",width:300,visible:!0,key:!0},{text:(0,W.Z)("Address"),fullScreenTitle:(0,W.Z)("Sort by page address"),value:"address",icon:Kn.iD7,width:300,visible:!0},{text:(0,W.Z)("Views"),fullScreenTitle:(0,W.Z)("Sort by number of page views"),value:"visitCount",icon:Kn.boz,width:100,visible:!0}],Qz=(0,aT.extendMoment)(V()),qz=F.ZP.UI_LANGUAGE.startsWith("de")?"L":"l";function Jz(e,t){return e.find((e=>e.id===t))??Mz.Z.getState().items.find((e=>e.id===t))}class e$ extends Un.PureComponent{static contextType=oi.Z;_locale={weekdays:[],weekdaysShort:[],monthsShort:[],weekStartsOn:0};_weekdaysSorted;_selecting=!1;_selectionHighlight=!1;_anchorDate=Qz();_shortDayFormat="";constructor(e){super(e);const t=function(e){let t={...Ze.ZP.getHistoryManagerState(e)};return 0===Object.getOwnPropertyNames(t).length?(t={...Rs.Z.getSync("HISTORY_MANAGER_STATE")},t.endTime=Qz(),"range"===t.displayMode?(t.startTime?t.startTime=Qz(t.startTime):Mz.Z.getOldestDate()?t.startTime=Mz.Z.getOldestDate():Qz().startOf("month"),t.range=Qz.range(t.startTime,t.endTime)):(t.startTime=Qz().startOf(t.displayMode),t.range=Qz.range(Qz(t.startTime).startOf(t.displayMode),Qz(t.endTime).endOf(t.displayMode)))):(t.startTime=t.startTime?Qz(t.startTime):Qz(),t.endTime=t.endTime?Qz(t.endTime):Qz(),t.range=Qz.range(Qz(t.startTime).startOf("day"),Qz(t.endTime).endOf("day"))),{...$z({range:Qz.range(Qz().startOf("day"),Qz().endOf("day"))}),...t}}(e.pageId),{dayPickerVisible:s,moreInfoVisible:n,monthEntriesVisible:i,...a}=t;this.state={loaded:!1,columns:xi().history||Ii(Xz),filter:a,nodes:Mz.Z.getTreeNodes(a),oldestDate:Mz.Z.getOldestDate(),dayPickerVisible:s??!1,moreInfoVisible:n??!0,monthEntriesVisible:i??!0,themeKey:0};const o=F.ZP.getWeekdays("long"),r=Qz.localeData().firstDayOfWeek();this._locale={weekdays:o,weekdaysShort:F.ZP.getWeekdays("short"),monthsShort:F.ZP.getMonths("short"),weekStartsOn:r},this._weekdaysSorted=o.slice(r).concat(o.slice(0,r)),this._shortDayFormat=F.ZP.getWeekdayFormat(F.ZP.getShortDateFormat())}componentDidMount(){Le.loadAll().then((()=>this.setState({loaded:!0}))),Mz.Z.addListener(this.#us),Ue.Z.addListener(this.#ps)}componentWillUnmount(){Mz.Z.removeListener(this.#us),Ue.Z.removeListener(this.#ps)}#us=()=>{this.setState((e=>{const{filter:t}=e;return{nodes:Mz.Z.getTreeNodes(t),oldestDate:Mz.Z.getOldestDate()}}))};#ps=()=>{this.setState((e=>({themeKey:e.themeKey+1})))};#gs=e=>{const t={displayMode:e.displayMode,startTime:e.startTime.valueOf(),endTime:e.endTime.valueOf(),dayPickerVisible:this.state.dayPickerVisible,moreInfoVisible:this.state.moreInfoVisible,monthEntriesVisible:this.state.monthEntriesVisible};c.ZP.setHistoryManagerState(this.props.pageId,t),Rs.Z.set({HISTORY_MANAGER_STATE:{displayMode:t.displayMode,startTime:t.startTime.valueOf(),endTime:t.endTime.valueOf(),dayPickerVisible:t.dayPickerVisible,moreInfoVisible:t.moreInfoVisible,monthEntriesVisible:t.monthEntriesVisible}})};_setRange=(e,t,s=null,n=!1)=>{const{filter:i}=this.state,a=Qz.range(Qz(e).startOf("day"),Qz(t).endOf("day")),o={...i,startTime:a.start,endTime:a.end,displayMode:s||i.displayMode,range:a};this._selectionHighlight=n,this.onSearch(o)};_setDayPickRange=(e,t)=>{const{filter:s}=this.state,n=Qz.range(s.startTime,s.endTime),i=Qz.range(Qz(e).startOf("day"),Qz(t).endOf("day"));if(Qz(e).within(n)&&Qz(t).within(n)){const e={...s,range:i};this.onSearch(e),this._selectionHighlight=!0}else if(i.overlaps(n)){const e=i.add(n);this._setRange(e.start,e.end,null,!1)}else this._setRange(Qz(t).startOf(s.displayMode),Qz(t).endOf(s.displayMode),null,!1)};toggleDayPicker=()=>{this.setState((e=>({dayPickerVisible:!e.dayPickerVisible})),(()=>{this.#gs(this.state.filter)}))};toggleMoreInfo=()=>{this.setState((e=>({moreInfoVisible:!e.moreInfoVisible})),(()=>{this.#gs(this.state.filter)}))};#ms=e=>{this.setState((e=>({monthEntriesVisible:!e.monthEntriesVisible})),(()=>{this.#gs(this.state.filter)}))};onSortChange=(e,t)=>{if(1===e)return;const{filter:s}=this.state,n={...s,sortOrder:e,sortField:t};this.onSearch(n)};onUpdateRow=e=>{this.setState({columns:e})};onSaveRow=()=>{yi(this.state.columns,"history")};onSelectAll=()=>{const e=Qz(),t=this.state.oldestDate,{filter:s}=this.state,n={...s,startTime:t,endTime:e.endOf("day")};this.onSearch(n),this._setRange(t,e.endOf("day"),"range",!1)};onIncludeUrlChange=()=>{const{filter:e}=this.state,t=!e.searchURL,s={...e,searchURL:t};this.onSearch(s)};onClearBrowsingData=()=>{ue.Z.showClearBrowsingHistoryDialog(this.context.vivaldiWindowId)};onCalendarSelect=(e,t)=>{if(!0===this._selecting)return this._selecting=!1,Promise.resolve();const s=Qz(e);if(t?.shiftKey){const e=this.expandRange(s);this._setRange(e.start,e.end)}else this._anchorDate=s,this._setRange(s,s,null,!0);return this._selectionHighlight=!0,Promise.resolve()};expandRange=e=>{const t=this.state.filter.range,s=Qz.range(e,e);return t.contains(s)?t:e.unix()>t.start.unix()?Qz.range(t.start,s.end.endOf("day")):Qz.range(s.start.startOf("day"),t.end)};handleMouseDown=(e,t)=>{const{button:s,ctrlKey:n,shiftKey:i}=t;if(s&&0!==s)return;const a=Qz(e);let o;i?(o=this.expandRange(a),this._setDayPickRange(o.start,o.end)):this._setDayPickRange(a,a),this._selecting=!0,this._anchorDate=Qz(e)};handleMouseUp=(e,t)=>{this._selecting&&this.state.filter.range&&(this._selecting=!1)};handleMouseEnter=(e,t)=>{if(!this._selecting||!this.state.filter.range)return;const s=this.expandRange(Qz(e));this._setDayPickRange(s.start,s.end)};onSearch=e=>{this.#gs(e),this.setState({filter:e,nodes:Mz.Z.getTreeNodes(e)})};onSearchDomain=e=>{e=Rb(e);const{filter:t}=this.state,s={...t,text:e,parsedFilter:Rz(e),searchURL:!0};this.onSearch(s)};onOpenDomain=e=>{c.ZP.openURL(this.context.vivaldiWindowId,(0,Ar.q9)(e))};handleDisplayModeChange=(e="day")=>{if("range"===e)this._anchorDate=Qz(),this._setRange(this.state.oldestDate,Qz(),e,!1);else{const t=this._anchorDate||Qz();this._setRange(Qz(t).startOf(e),Qz(t).endOf(e),e,!1)}};restoreSelection=()=>{this._selectionHighlight=!1;const{displayMode:e}=this.state.filter;this.handleDisplayModeChange(e)};viewCurrent=()=>{const{displayMode:e}=this.state.filter;this._setRange(Qz().startOf(e),Qz().endOf(e))};viewPrevious=e=>{const{startTime:t,displayMode:s}=this.state.filter,n="range"===s?"day":s,i=Qz(t).subtract(1,n).startOf(n),a=Qz(i).endOf(n);this._setRange(i,a)};viewNext=()=>{const{startTime:e,displayMode:t}=this.state.filter,s="range"===t?"day":t,n=Qz(e).add(1,s).startOf(s),i=Qz(n).endOf(s);this._setRange(n,i)};getNumWeeksForMonth=(e,t)=>{let s=new Date(e,t-1,1).getDay()-this._locale.weekStartsOn;s<0&&(s+=7);const n=new Date(e,t,0).getDate();return Math.ceil((n+s)/7)};getDomainMenuItems=e=>[{handler:()=>this.onSearchDomain(e),...(0,fi.Z)("Filter by “$1”",[e])},{handler:()=>this.onOpenDomain(e),...(0,fi.Z)("Go to “$1”",[e])}];onDomainContextMenu=(e,t)=>{(0,mi.Z)(this.context,this.getDomainMenuItems(e))(t)};getActivityLevel=(e,t,s)=>e>=t-t/10?"max":e>=s&&e<t-t/10?"high":e>=s/2&&e<s?"mid":e>0&&e<s/2?"low":"min";#fs=(e,t,s,n,i,a)=>{a=Qz(a);const{filter:o}=this.state,r=Jz(e,(0,F.SI)(a));if(!r||0===r.children.length)return(0,zn.jsx)("div",{className:a.within(o.range)?"selected":null,onClick:e=>this.onCalendarSelect(a,e),style:{height:n},children:(0,zn.jsx)("span",{className:"Cal__Day__day",children:a.date()})},a.valueOf());const l=this.getActivityLevel(r.visitCount,t,s),d=Math.max(Math.floor((n-72)/15),1);let c;if(0===o.text.length){const e=Object.groupBy(r.children,(e=>e.address));c=Object.keys(e).map((t=>({url:t,visitCount:e[t].reduce(((e,t)=>e+t.visitCount),0)})))}else c=r.children.slice();c.sort(((e,t)=>t.visitCount-e.visitCount)),c=c.slice(0,d);const h=c.map((({url:e},t)=>(0,zn.jsx)("li",{title:e,onContextMenu:this.onDomainContextMenu.bind(this,e),children:e},a.unix()+"_"+t)));return(0,zn.jsxs)("div",{className:a.within(o.range)?"selected":null,onClick:e=>this.onCalendarSelect(a,e),style:{height:n},children:[(0,zn.jsx)("span",{className:"Cal__Day__day",children:a.date()}),(0,zn.jsxs)("h4",{className:Gn()({heat:!0,[`${l}`]:!0}),children:[(0,zn.jsxs)("span",{className:"visits",children:[(0,zn.jsx)("strong",{children:r.visitCount}),(0,W.Z)("view","views",[r.visitCount])]}),(0,zn.jsxs)("span",{className:"pages",children:[(0,zn.jsx)("strong",{children:r.children.length}),(0,W.Z)("page","pages",[r.children.length])]})]}),(0,zn.jsx)("ul",{className:"top-links",children:h})]})};renderCalWeek=()=>{const{filter:e,nodes:t}=this.state,{range:s}=e;let n=Array.from(s.by("days"));if(Qz(n[0]).day()!==this._locale.weekStartsOn||n.length<7){const e=Qz(n[0]).startOf("week"),t=Qz(n[0]).endOf("week");n=Array.from(Qz.range(e,t).by("days"))}else n.length>7&&(n=n.slice(0,6));return(0,zn.jsx)("div",{className:"week-container",children:n.map((n=>{const i=Qz(n).within(s),a=(0,F.SI)(n),o=t.find((e=>e.id===a)),r=Qz(n).within(Qz.range(this.state.oldestDate,Qz()));return(0,zn.jsxs)("div",{className:"week-day",children:[(0,zn.jsx)("header",{onClick:r?this._setDayPickRange.bind(this,n,n):null,className:Gn()({selected:i,disabled:!r}),children:n.format(this._shortDayFormat)}),(0,zn.jsx)("div",{className:"tree",children:o?.children&&(0,zn.jsx)(zz,{fullView:!1,inManager:!0,nodes:o.children,filter:e,onSearchDomain:this.onSearchDomain},"week_"+n.id)})]},"week_"+a)}))})};#vs=(e,t,s,n)=>{n=Qz(n);const{filter:i}=this.state,a=Qz(this.state.oldestDate).within(i.range)&&Qz().within(i.range),o=Jz(e,(0,F.SI)(n));let r,l="min";return o&&0!==o.children.length?(r=o.visitCount,l=this.getActivityLevel(r,t,s)):r=0,(0,zn.jsxs)("span",{title:(0,W.Z)("$1 visit","$1 visits",[r]),className:Gn()({heat:!0,selected:!a&&n.within(i.range),[`${l}`]:!0}),onMouseDown:e=>this.handleMouseDown(n,e),onMouseUp:e=>this.handleMouseUp(n,e),onMouseEnter:e=>this.handleMouseEnter(n,e),children:[(0,zn.jsx)("span",{children:n.format("D")}),"1"===n.format("D")&&(0,zn.jsx)("span",{className:"Cal__Day__month",children:n.format("MMM")}),"1"===n.format("D")&&n.year()!==Qz().year()&&(0,zn.jsx)("span",{className:"Cal__Day__year",children:n.format("YYYY")})]},n.unix()+"_"+n)};render(){const{dayPickerVisible:e,moreInfoVisible:t,monthEntriesVisible:s}=this.state,{filter:n}=this.state,i=n.range,a=(0,F.SI)(i.start),o=(0,F.SI)(i.end);let r=this.state.nodes.filter((e=>e.id>=a&&e.id<=o));r.length===this.state.nodes.length&&(r=this.state.nodes);const l=t||n.text.length>1?r.reduce(((e,t)=>e+t.visitCount),0):0,d=Qz(n.startTime),c=this.getNumWeeksForMonth(d.year(),d.month()+1),h=(0,F.SI)(i.start)===(0,F.SI)(Qz(this.state.oldestDate))&&(0,F.SI)(i.end)===(0,F.SI)(Qz());let u,p,g,m=[],f="";if(r.length>1){const e=r[0],t=r[r.length-1];e&&t&&(m=[Qz(e.visitTime).format(qz),Qz(t.visitTime).format(qz)],f="visitTime"===n.sortField&&2===n.sortOrder?m[0]+" – "+m[1]:m[1]+" – "+m[0])}switch(u="month"===n.displayMode?(0,W.Z)("$1 $2",[Qz(d).format("MMMM"),Qz(d).format("YYYY")]):"week"===n.displayMode?(0,W.Z)("Week $1, $2",[Qz(d).week(),Qz(d).year()]):r.length>1?f:Qz(n.startTime).format("LL"),p=r.length>1?f:1===r.length?Qz(r[0].visitTime).format("LL"):Qz(n.startTime).format("LL"),n.displayMode){case"month":g=(0,W.Z)("This Month");break;case"week":g=(0,W.Z)("This Week");break;default:g=(0,W.Z)("other","Today")}const v=Qz(r.map((e=>e.id)).sort()[0]).startOf("month"),b=Qz(),C=Qz(this.state.oldestDate).isBefore(b.subtract(2,"m"))?Qz(this.state.oldestDate):b.subtract(2,"m"),w=Mz.Z.getState().items.map((e=>e.visitCount)),y=Math.max(Math.max.apply(Math,w),10);w.sort(((e,t)=>e-t));const x=(w[Math.floor((w.length-1)/2)]+w[Math.ceil((w.length-1)/2)])/2,I="on"===this.props.prefValues[Z.kStartpageNavigation]?51:0,A=n.text.length>1?40:0,S=(this.props.maxHeight-(I+A+40+21))/c,T=Boolean(this.props.pageId&&Ze.ZP.getPageInWindow(this.context.vivaldiWindowId,this.props.pageId)?.active);return(0,zn.jsxs)("div",{className:"history manager",children:[(0,zn.jsxs)("div",{className:"toolbar toolbar-default",role:"toolbar","aria-label":(0,W.Z)("toolbar label","History"),children:[(0,zn.jsx)(oa.ZP,{onClick:this.toggleDayPicker,tooltip:(0,W.Z)("Day picker calendar"),isPressed:e,image:Kn.eVT}),(0,zn.jsx)(Fz,{search:this.onSearch,filter:n,minDate:this.state.oldestDate,hasHistory:0!==r.length,showClearBtn:!1}),(0,zn.jsx)("h1",{onClick:this.restoreSelection,style:{marginLeft:"auto",marginRight:"auto",flexShrink:5},children:u}),(0,zn.jsx)(oa.ZP,{onClick:this.viewCurrent,title:g}),(0,zn.jsxs)("div",{className:"toolbar-group",children:[(0,zn.jsx)(oa.ZP,{onClick:this.viewPrevious.bind(this,v),tooltip:(0,W.Z)("Previous"),className:"button-narrow",disabled:Qz(this.state.oldestDate).within(i),image:Kn.mgF.small}),(0,zn.jsx)(oa.ZP,{onClick:this.viewNext,className:"button-narrow",tooltip:(0,W.Z)("Next"),disabled:b.within(i),image:Kn.Zu.small})]}),(0,zn.jsxs)("div",{className:"toolbar-group",children:[(0,zn.jsx)(oa.ZP,{title:(0,W.Z)("List"),isPressed:"range"===n.displayMode,onClick:()=>this.handleDisplayModeChange("range")}),(0,zn.jsx)(oa.ZP,{title:(0,W.Z)("Day"),isPressed:"day"===n.displayMode,onClick:()=>this.handleDisplayModeChange("day")}),(0,zn.jsx)(oa.ZP,{title:(0,W.Z)("Week"),isPressed:"week"===n.displayMode,onClick:()=>this.handleDisplayModeChange("week")}),(0,zn.jsx)(oa.ZP,{title:(0,W.Z)("Month"),isPressed:"month"===n.displayMode,onClick:()=>this.handleDisplayModeChange("month")})]}),(0,zn.jsx)(oa.ZP,{onClick:this.onClearBrowsingData,tooltip:(0,W.Z)("title","Clear browsing data"),image:Kn.DwE.small}),(0,zn.jsx)(oa.ZP,{onClick:this.toggleMoreInfo,tooltip:t?(0,W.Z)("Hide info"):(0,W.Z)("More info"),image:Kn.GH$,isPressed:t})]}),n.text.length>1&&(0,zn.jsxs)("div",{className:"toolbar toolbar-default search-options",children:[(0,zn.jsx)(oa.ZP,{onClick:this.onSelectAll,title:(0,W.Z)("Search All History"),disabled:h}),(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:n.searchURL,onChange:this.onIncludeUrlChange}),(0,W.Z)("Include Address in Search Results")]}),(0,zn.jsx)("div",{className:"filtered-entries",children:(0,W.Z)("$1 Entry","$1 Entries",[l])})]}),(0,zn.jsxs)("div",{className:Gn()({"history-view":!0,selecting:this._selectionHighlight}),children:[e&&(0,zn.jsxs)("div",{className:"manager-editor",children:[(0,zn.jsx)("div",{className:"CalendarMonth-Weekdays",children:this._weekdaysSorted.map((e=>(0,zn.jsx)("span",{className:"CalendarMonth-DayOfWeek",children:Qz().day(e).format("ddd")},`hdr-${e.toString()}`)))}),(0,zn.jsx)("div",{className:"timeline",onMouseLeave:this.handleMouseUp,children:(0,zn.jsx)(vz,{selectedDate:i.start,minDate:C,maxDate:b.endOf("month"),renderMonthDay:e=>this.#vs(r,y,x,e),onSelect:this.onCalendarSelect,isHeatMap:!0})})]}),(0,zn.jsxs)("div",{className:"manager-content history-calendar-container",children:["range"===n.displayMode&&(0,zn.jsxs)("div",{className:"view range",children:[(0,zn.jsx)(Bu,{fields:Xz,columns:this.state.columns,fullsize:!0,manualSorting:!1,keyAccess:this.props.keyAccess,onUpdateRow:this.onUpdateRow,onSaveRow:this.onSaveRow,onSortChange:this.onSortChange,sortField:n.sortField,sortOrder:n.sortOrder}),r.length>0?(0,zn.jsx)("div",{className:"history-tree",children:(0,zn.jsx)(zz,{nodes:r,fullView:!0,inManager:!0,columns:this.state.columns,onSearchDomain:this.onSearchDomain,filter:n})}):(0,zn.jsx)("div",{className:"vivaldi-tree-empty",children:(0,W.Z)("No browsing history data for selected period")})]}),"day"===n.displayMode&&(0,zn.jsxs)("div",{className:"view day",children:[(0,zn.jsx)(Bu,{fields:Xz,columns:this.state.columns,fullsize:!0,manualSorting:!1,keyAccess:this.props.keyAccess,onUpdateRow:this.onUpdateRow,onSaveRow:this.onSaveRow,onSortChange:this.onSortChange,sortField:n.sortField,sortOrder:n.sortOrder}),r.length>0?(0,zn.jsx)("div",{className:"history-tree",children:(0,zn.jsx)(zz,{nodes:r,fullView:!0,inManager:!0,columns:this.state.columns,filter:n,onSearchDomain:this.onSearchDomain})}):(0,zn.jsx)("div",{className:"vivaldi-tree-empty",children:(0,W.Z)("No browsing history data for selected period")})]}),"week"===n.displayMode&&(0,zn.jsx)("div",{className:"view week",children:this.renderCalWeek()}),"month"===n.displayMode&&(0,zn.jsxs)("div",{className:"view month",children:[(0,zn.jsxs)("div",{className:"month-calendar",children:[(0,zn.jsx)("div",{className:"CalendarMonth-Weekdays",children:this._weekdaysSorted.map((e=>(0,zn.jsx)("span",{className:"CalendarMonth-DayOfWeek",children:Qz().day(e).format("dddd")},`hdr-${e.toString()}`)))}),(0,zn.jsx)(vz,{selectedDate:i.start,minDate:Qz(d.startOf("month")),maxDate:Qz(d.endOf("month")),renderMonthDay:e=>this.#fs(r,y,x,S,Math.floor(this.props.maxWidth/7),e),onSelect:this.onCalendarSelect,maxHeight:this.props.maxHeight})]}),s&&(0,zn.jsxs)("div",{className:"month-links",children:[(0,zn.jsx)("ul",{className:"CalendarMonth-Weekdays",children:(0,zn.jsx)("li",{className:"CalendarMonth-DayOfWeek",children:(0,W.Z)("Entries")})}),(0,zn.jsx)(zz,{nodes:r,fullView:!1,inManager:!0,filter:n,onSearchDomain:this.onSearchDomain})]}),(0,zn.jsx)("button",{className:"toggle-month-entries",title:s?(0,W.Z)("Hide entries"):(0,W.Z)("Show entries"),onClick:this.#ms,value:"monthEntriesVisible",tabIndex:this.props.keyAccess,children:s?">":"<"})]})]}),t&&this.state.loaded&&(0,zn.jsx)(Pz,{title:p,filter:n,nodes:r,pageViewsCount:l,onOpenDomain:this.onOpenDomain,max:y,scaleY:"sqrt",onDomainContextMenu:this.onDomainContextMenu,pageIsActive:T},this.state.themeKey)]})]})}}const t$=(0,zd.Z)(e$,Yz);var s$=s(62882),n$=s(60007),i$=s.n(n$),a$=s(89927),o$=s(63549),r$=s(27856),l$=s(57570),d$=s.n(l$),c$=s(96936),h$=s.n(c$),u$=s(5460),p$=s.n(u$),g$=s(61519),m$=s.n(g$),f$=s(56827),v$=s.n(f$),b$=s(6691),C$=s.n(b$),w$=s(74006),y$=s.n(w$),x$=s(4499),I$=s.n(x$),A$=s(91833),S$=s.n(A$),Z$=s(45253),T$=s.n(Z$),E$=s(27055),k$=s.n(E$),N$=s(85215),_$=s.n(N$),P$=s(29560),M$=s.n(P$),D$=s(37721),O$=s.n(D$),j$=s(96344),L$=s.n(j$),R$=s(82026),B$=s.n(R$),F$=s(23874),W$=s.n(F$),U$=s(93839),V$=s.n(U$),H$=s(61083),G$=s.n(H$),K$=s(41304),z$=s.n(K$),$$=s(42387),Y$=s.n($$),X$=s(61896),Q$=s.n(X$),q$=s(78529),J$=s.n(q$),eY=s(30308),tY=s.n(eY),sY=s(58473),nY=s.n(sY),iY=s(36632),aY=s.n(iY),oY=s(19514),rY=s.n(oY),lY=s(97181),dY=s.n(lY),cY=s(26306),hY=s.n(cY),uY=s(91533),pY=s.n(uY),gY=s(17151),mY=s.n(gY),fY=s(42157),vY=s.n(fY);const bY={FORBID_TAGS:["style"],ALLOW_UNKNOWN_PROTOCOLS:!0};class CY{constructor(e){d$().registerLanguage("apache",h$()),d$().registerLanguage("applescript",p$()),d$().registerLanguage("bash",m$()),d$().registerLanguage("basic",v$()),d$().registerLanguage("coffeescript",C$()),d$().registerLanguage("cpp",y$()),d$().registerLanguage("css",I$()),d$().registerLanguage("diff",S$()),d$().registerLanguage("django",T$()),d$().registerLanguage("dockerfile",k$()),d$().registerLanguage("dos",_$()),d$().registerLanguage("ini",M$()),d$().registerLanguage("java",O$()),d$().registerLanguage("javascript",L$()),d$().registerLanguage("json",B$()),d$().registerLanguage("less",W$()),d$().registerLanguage("markdown",V$()),d$().registerLanguage("mathematica",G$()),d$().registerLanguage("matlab",z$()),d$().registerLanguage("nginx",Y$()),d$().registerLanguage("objectivec",Q$()),d$().registerLanguage("perl",J$()),d$().registerLanguage("python",tY()),d$().registerLanguage("ruby",nY()),d$().registerLanguage("scss",aY()),d$().registerLanguage("shell",rY()),d$().registerLanguage("sql",dY()),d$().registerLanguage("swift",hY()),d$().registerLanguage("typescript",pY()),d$().registerLanguage("vim",mY()),d$().registerLanguage("xml",vY()),this.remarkable=new a$._("commonmark",{emptyLines:!0,html:!0,breaks:!0,typographer:!1,quotes:e.quotes,highlight:(e,t)=>{if(t&&d$().getLanguage(t))try{return d$().highlight(t,e).value}catch(e){}return""}}),this.remarkable.use(i$()),this.remarkable.use(o$.N);const t=this.remarkable.inline.validateLink,s=/^\s*data:([a-z]+\/[a-z]+(;[a-z-]+=[a-z-]+)?)?(;base64)?,[a-z0-9!$&',()*+,;=\-._~:@/?%\s]*\s*$/i,n=/^\s*blob:chrome-extension:\/\/[a-z0-9!$&',()*+,;=\-._~:@/?%\s]*\s*$/i,i=/^\s*file:\/\/[a-z0-9!$&',()*+,;=\-._~:@/?%\s]*\s*$/i;this.remarkable.inline.validateLink=e=>t(e)||e.match(s)||e.match(n)||e.match(i),this.remarkable.inline.ruler.enable(["del","mark","sub","sup"]),this.remarkable.block.ruler.enable(["table"])}getRawMarkup(e){return(0,r$.sanitize)(this.remarkable.render(e),bY)}}class wY extends Un.Component{static contextType=oi.Z;refWebview=Un.createRef();constructor(e,t){super(e),this.state={startOffsetOnNewline:0,createLinkModalOpen:!1,caretState:{bold:!1,italic:!1,strikeThrough:!1,formatBlock:"p",insertOrderedList:!1,insertUnorderedList:!1},windowStyle:Ue.Z.getBaseStylesByWindowId(t.vivaldiWindowId,tw)}}componentDidMount(){Ue.Z.addListener(this.onThemeStoreChanged),this.refWebview.current?.addEventListener("consolemessage",this.handleConsoleMessage),this.refWebview.current?.addEventListener("contentload",this.handleContentLoad),this.refWebview.current?.addEventListener("newwindow",this.handleGoToURL)}componentWillUnmount(){Ue.Z.removeListener(this.onThemeStoreChanged),this.refWebview.current?.removeEventListener("consolemessage",this.handleConsoleMessage),this.refWebview.current?.removeEventListener("contentload",this.handleContentLoad),this.refWebview.current?.removeEventListener("newwindow",this.handleGoToURL)}onThemeStoreChanged=()=>{const e=Ue.Z.getBaseStylesByWindowId(this.context.vivaldiWindowId,tw);e!==this.state.windowStyle&&this.setState({windowStyle:e},this.setStyle)};postMessage=e=>{this.refWebview.current?.contentWindow?.postMessage?.(e,"*")};handleContentLoad=()=>{this.setStyle(),this.props.onContentLoad(),this.postMessage({type:"CONTENT_LOAD_REPLY",translatedStrings:{bold:(0,W.Z)("Strong text"),italic:(0,W.Z)("Emphasized text"),strikeThrough:(0,W.Z)("Deleted text"),quotes:(0,W.Z)("“”‘’")}})};handleGoToURL=e=>{e.preventDefault(),e.targetUrl.startsWith("#")||c.ZP.openURL(this.context.vivaldiWindowId,e.targetUrl)};onCaretStateEvent(e){if(!e)return;let t;try{t=JSON.parse(e)}catch(e){return}this._updateCaretState(t)}_updateCaretState(e){this.setState((t=>({caretState:{...t.caretState,...e}})),(()=>this.props.updateButtonState?.()))}focus(){this.refWebview.current?.focus()}blur(){this.refWebview.current?.blur()}hasFocus(){const{document:e}=this.context;return Boolean(this.refWebview.current)&&this.refWebview.current===e.activeElement}getContentAsBodyParts=()=>{const e=this.refWebview.current;return e?new Promise(((t,s)=>{e.executeScript({code:"document.body.innerText"},(e=>{e&&Array.isArray(e)&&"string"==typeof e[0]?t([{type:"text",content:e[0],charset:"UTF-8"}]):s("PlainTextEdit.getContentAsBodyParts: Couldn't get content from Webview")}))})):Promise.reject("RichTextEdit.getContentAsBodyParts: Webview doesn't exist")};onClick=e=>{if("createLink"===e)this.props.handleLinkEvent({type:e});else this.execCommand(e,""),this.props.updateButtonState?.()};onChange=(e,t)=>{this.execCommand(e,t.currentTarget.value),this.props.updateDropdownState?.()};execCommand(e,t){this.postMessage({type:"BUTTON_CLICK",command:e,value:t})}setContent=e=>{this.refWebview.current?.executeScript({code:`document.body.innerText = unescape('${escape(e)}');`},this.setStyle)};setStyle=()=>{this.refWebview.current?.executeScript({code:"document.head.innerHTML = `<style>"+Si.ZP.createStyleRoot(this.state.windowStyle)+"\n    html, body, iframe {\n      background-color: var(--colorBg);\n      padding: 0;\n      margin: 0;\n      font-family: sans-serif;\n      overflow: initial;\n    }\n    body[contenteditable=\"plaintext-only\"] {\n      font-family: monospace;\n    }\n    body {\n      --EditorPadding: 12px;\n      --MaxWidth: 700px;\n      margin-left: var(--EditorPadding);\n      padding-left: calc(calc(50% - calc(var(--MaxWidth) / 2) - var(--EditorPadding))) !important;\n      padding-right: calc(50% - calc(var(--MaxWidth) / 2)) !important;\n      padding-top: var(--EditorPadding);\n      padding-bottom: calc(var(--EditorPadding) * 3);\n      color: var(--colorFgIntense);\n      font-size: 100%;\n      cursor: text;\n    }\n    img {\n      display: inline-block;\n      vertical-align: top;\n      max-width: 100%;\n      height: auto;\n    }\n    a:-webkit-any-link {\n      color: var(--colorHighlightBg);\n      cursor: pointer;\n    }\n  \n    html {\n      width: calc(100% - 12px);\n    }\n    html, body, iframe {\n      font-size: 100%;\n    }\n    input[type=checkbox] {\n      appearance: none;\n      position: relative;\n      width: 16px;\n      height: 16px;\n      min-width: 16px;\n      min-height: 16px;\n      vertical-align: middle;\n      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1) inset;\n      margin: unset;\n      border-width: 1px;\n      border-style: solid;\n      border-color: rgba(0,0,0,0.2);\n      background-color: var(--colorBgIntense);\n    }\n    input[type='checkbox']:disabled {\n      opacity: 1;\n      filter: grayscale(1);\n    }\n    input[type=checkbox]:before,\n    input[type=checkbox]:after {\n      content: '';\n      position: absolute;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background-color: var(--colorHighlightBg);\n      transform-origin: 0 0;\n    }\n    input[type=checkbox]:before {\n      transform: rotate(-45deg) translateY(45%) translateX(-30%) scaleX(0.25) scaleY(0);\n    }\n    input[type=checkbox]:checked:before {\n      transform: rotate(-45deg) translateY(45%) translateX(-30%) scaleX(0.25) scaleY(0.4);\n    }\n    input[type=checkbox]:after {\n      transform: rotate(225deg) translateY(-30%) translateX(-95%) scaleX(0.25) scaleY(0);\n    }\n    input[type=checkbox]:checked:after {\n      transform: rotate(225deg) translateY(-30%) translateX(-95%) scaleX(0.25) scaleY(1.2);\n    }\n    \n    .tooltip {\n      --TipWidth: 480px;\n      position: relative;\n    }\n    .tooltip .tooltip-text * {\n      user-select: none;\n    }\n    .tooltip-text input {\n      margin-left: 3px;\n      border: 1px solid var(--colorBorder);\n      border-radius: 2px;\n      font-size: 13px;\n      opacity: 0.8;\n      color: var(--colorFg);\n      background-color: var(--colorBg);\n    }\n    .tooltip-text input:active {\n      background-color: var(--colorBgDark);\n    }\n    .tooltip-text input:first-of-type {\n      margin-left: 12px;\n    }\n    .tooltip-text a {\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      color: var(--colorFg);\n    }\n    .tooltip .tooltip-text {\n      cursor: default;\n      position: absolute;\n      z-index: 1;\n      display: flex;\n      align-items: center;\n      top: 100%;\n      left: -6px;\n      max-width: var(--TipWidth);\n      padding: 6px 6px 6px 12px;\n      color:var(--colorFg);\n      background-color: var(--colorBg);\n      border: 1px solid var(--colorBgDark);\n      box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.1), 0 3px 10px rgba(0, 0, 0, 0.3);\n      border-radius: 3px;\n    }\n  \n  ".replace(/\n|\r/g,"")+"</style>`;"})};debouncedUpdateState=(0,Te.Z)((()=>{this.props.updateButtonState?.(),this.props.updateDropdownState?.()}),100);handleConsoleMessage=e=>{const[t,s]=e.message.split(" ",2);switch(t){case"caretState":this.onCaretStateEvent(s);break;case"selectionchange":this.debouncedUpdateState();break;case"input":this.debouncedUpdateState(),this.props.onChange(e);break;case"createLink":this.props.handleLinkEvent({type:t});break;default:throw new Error(e.message)}};setZoomLevel=e=>{const t=this.refWebview.current;t&&(t.setZoomMode("per-view"),t.setZoom(e))};render(){const{disabled:e,hidden:t}=this.props;return(0,zn.jsx)("div",{className:"editor-html",children:(0,zn.jsx)("webview",{className:"editor-webview",name:"markdowneditor",ref:this.refWebview,style:t||e?{display:"none"}:{},allowtransparency:"on",src:'data:text/html,<html id="content" tabindex="-1">\n  <head><script src="chrome-extension://mpognobbkildjkofajifpdfhcoklimli/markdowneditor-bundle.js"><\/script></head>\n  <body contenteditable="plaintext-only"></body>\n</html>'})})}}var yY=s(50564),xY=s(50036);class IY{constructor(){this.turndownService=new xY.Z({headingStyle:"atx",codeBlockStyle:"fenced"}),this.turndownService.use(yY.r0),this.turndownService.addRule("strikethrough",{filter:["del","s","strike"],replacement:e=>"~~"+e+"~~"}),this.turndownService.addRule("listItem",{filter:"li",replacement:function(e,t,s){e=e.replace(/^\n+/,"").replace(/\n+$/,"\n").replace(/\n/gm,"\n    ");let n=s.bulletListMarker+" ",i=t.parentNode;if("OL"===i.nodeName){const e=i.getAttribute("start"),s=Array.from(i.children).indexOf(t);n=(e?Number(e)+s:s+1)+". "}let a=-1;for(;i&&("OL"===i.nodeName||"UL"===i.nodeName);)a+=1,i=i.parentNode;return"    ".repeat(a)+n+e+(t.nextSibling&&!/\n$/.test(e)?"\n":"")}})}}function AY({disabled:e,keyAccess:t,noteId:s,text:n,onOpenDialog:i}){const a=Un.useRef(null);return(0,zn.jsxs)("label",{className:Gn()("button-toolbar",{disabled:e}),title:(0,W.Z)("Attach new file..."),tabIndex:t,children:[(0,zn.jsx)("input",{ref:a,type:"file",style:{display:"none"},accept:"image/*",disabled:e,onChange:e=>Js.Z.addFile(s,e.target.files[0])}),(0,zn.jsxs)("button",{disabled:e,tabIndex:t,onClick:function(){i?.(),a.current?.click()},children:[(0,zn.jsx)("div",{style:{display:"contents"},dangerouslySetInnerHTML:{__html:Kn.onv}}),(0,zn.jsx)("span",{children:n})]})]})}function SY({onDelete:e,onContextMenu:t,url:s,onOpen:n,onDragStart:i,draggable:a}){return(0,zn.jsxs)("div",{className:"AttachmentItem",onDragStart:i?e=>i(e,s):null,draggable:a,children:[(0,zn.jsx)("img",{className:"AttachmentItem-Image",src:s}),(0,zn.jsx)("button",{className:"AttachmentItem-DeleteButton",title:(0,W.Z)("Remove attachment"),onClick:()=>e(),tabIndex:"-1",dangerouslySetInnerHTML:{__html:Kn.M2k.medium}}),(0,zn.jsx)("button",{className:Gn()({"AttachmentItem-ViewOverlayButton":!0,"dragging-enabled":a}),title:(0,W.Z)("View attachment"),onContextMenu:t,onClick:n,dangerouslySetInnerHTML:{__html:Kn.YvR.large}})]})}function ZY(e,t,s,n){const i={inCurrent:s,inBackground:n};c.ZP.openURL(e,t,i)}function TY(e,t,s){const n={inNewWindow:!0,incognito:s};c.ZP.openURL(e,t,n)}class EY extends Un.Component{static contextType=oi.Z;onContextMenu=(e,t,s)=>{const n=this.context.vivaldiWindowId,i=[{items:[{handler:()=>ZY(n,t,!0,!1),...(0,fi.Z)("Current Tab")},{handler:()=>ZY(n,t,!1,A.Z.get(Z.kTabsOpenNewInBackground)),...(0,fi.Z)("open in","New Tab")},{handler:()=>ZY(n,t,!1,!0),isVisible:()=>!A.Z.get(Z.kTabsOpenNewInBackground),...(0,fi.Z)("Background Tab")},st.Z.separatorItem,{handler:()=>TY(n,t,!1),...(0,fi.Z)("open in","New Window")},{handler:()=>TY(n,t,!0),...(0,fi.Z)("open in","Private Window")}],...(0,fi.Z)("Open in")},st.Z.separatorItem,{handler:(e=>{e&&this.props.onInsertMarkdown?.(e)}).bind(null,t),...(0,fi.Z)("Insert Markdown"),isVisible:()=>!!this.props.onInsertMarkdown},{handler:this.props.onRemoveAttachment.bind(null,e),...(0,fi.Z)("verb","Remove")}];(0,mi.Z)(this.context,i)(s)};onDragStart=(e,t)=>{"html"===this.props.dragFormat?e.dataTransfer.setData("text/html",`<img src="${t}" />`):e.dataTransfer.setData("text/plain",`attachment:${t}`)};render(){const{attachments:e}=this.props;return(0,zn.jsx)("div",{className:"NotesAttachments",children:e.map(((e,t)=>{const s=e.content?`chrome://vivaldi-data/synced-store/${e.content}`:"";return(0,zn.jsx)(SY,{url:s,onContextMenu:this.onContextMenu.bind(null,e.id,s),onOpen:e=>c.ZP.openURL(this.context.vivaldiWindowId,s),onDelete:this.props.onRemoveAttachment.bind(null,e.id),onDragStart:this.onDragStart,draggable:!!this.props.onInsertMarkdown},e.id)}))})}}const kY=EY;function NY({noteId:e,attachments:t,onRemoveAttachment:s,onInsertMarkdown:n,dragFormat:i}){return(0,zn.jsxs)("div",{className:"NotesAttachmentPopup",children:[(0,zn.jsx)(kY,{attachments:t,onRemoveAttachment:s,onInsertMarkdown:n,dragFormat:i}),(0,zn.jsx)(AY,{noteId:e,disabled:!1,keyAccess:-1,text:(0,W.Z)("Add attachment")})]})}const _Y=[[{command:"bold",text:(0,W.Z)("Bold"),icon:Kn.q7H},{command:"italic",text:(0,W.Z)("Italic"),icon:Kn.znb},{command:"strikeThrough",text:(0,W.Z)("Strike through"),icon:Kn._QD}],[{command:"insertOrderedList",text:(0,W.Z)("Numbered list"),icon:Kn.o_D},{command:"insertUnorderedList",text:(0,W.Z)("Bullet list"),icon:Kn.rr$},{command:"outdent",text:(0,W.Z)("Remove indentation"),icon:Kn.XKb},{command:"indent",text:(0,W.Z)("Indent"),icon:Kn.b2r}],[{command:"createLink",text:(0,W.Z)("Create Link"),icon:Kn.v2I}],[{command:"undo",text:(0,W.Z)("win_linux","Undo"),icon:Kn.LwO},{command:"redo",text:(0,W.Z)("win_linux","Redo"),icon:Kn.W9w}]];class PY extends Un.Component{static contextType=oi.Z;isAnchor=!1;anchorOrSelection="";state={buttonState:[],createLinkModalOpen:!1,formatBlock:"p",isAttachmentPopupOpen:!1};updateButtonState=(e,t)=>{this.setState((s=>({buttonState:e||s.buttonState,formatBlock:t||s.formatBlock})))};updateLinkState=e=>{this.isAnchor=e.isAnchor,this.anchorOrSelection=e.anchorOrSelection};onCreateLink=e=>{this.setState({createLinkModalOpen:!1}),this.props.onCreateLink(e)};onCancelCreateLink=()=>{this.setState({createLinkModalOpen:!1}),this.props.onCancelCreateLink()};showCreateLinkModal=()=>this.setState({createLinkModalOpen:!0});cacheFocus=()=>{const{document:e}=this.context;e.activeElement?this._focusCache=e.activeElement:this._focusCache=void 0};restoreFocus=()=>{this._focusCache&&this._focusCache.focus()};toggleAttachmentPopup=()=>this.setState((e=>({isAttachmentPopupOpen:!e.isAttachmentPopupOpen})));hideAttachmentPopup=()=>this.setState({isAttachmentPopupOpen:!1});enableVisualMode=()=>this.props.setVisualMode(!0);disableVisualMode=()=>this.props.setVisualMode(!1);handleFindInPage=(e,t)=>sp.Z.findInPage(this.context.vivaldiWindowId,this.props.pageId,e,t);handleFindNextInPage=(e,t,s)=>sp.Z.findNextInPage(this.context.vivaldiWindowId,this.props.pageId,e,t,s);render(){const{noteId:e}=this.props;let t=0;return(0,zn.jsxs)("div",{className:"NotesManager-Toolbar",children:[this.state.createLinkModalOpen&&(0,zn.jsx)(qC,{onCreateLink:this.onCreateLink,onCancelCreateLink:this.onCancelCreateLink,isAnchor:this.isAnchor,anchorOrSelection:this.anchorOrSelection}),(0,zn.jsxs)("div",{className:"toolbar toolbar-default NotesManager-Buttons",role:"toolbar","aria-label":(0,W.Z)("toolbar label","Notes"),children:[(0,zn.jsx)(oa.ZP,{tooltip:this.props.inFullView?(0,W.Z)("Enter Full View"):(0,W.Z)("Exit Full View"),onClick:this.props.toggleFullEditor,image:this.props.inFullView?Kn.ADs.medium:Kn.BB1.medium}),(0,zn.jsxs)(Fa.Z,{onChange:e=>{this.props.onParagraphFormatChange("formatBlock",e),this.restoreFocus()},onMouseDown:this.cacheFocus,value:this.state.formatBlock,title:(0,W.Z)("Paragraph Format"),tabIndex:"-1",disabled:this.props.disabled,children:[(0,zn.jsx)("option",{value:"h1",children:(0,W.Z)("Heading 1")}),(0,zn.jsx)("option",{value:"h2",children:(0,W.Z)("Heading 2")}),(0,zn.jsx)("option",{value:"h3",children:(0,W.Z)("Heading 3")}),(0,zn.jsx)("option",{value:"h4",children:(0,W.Z)("Heading 4")}),(0,zn.jsx)("option",{value:"p",children:(0,W.Z)("Paragraph")}),(0,zn.jsx)("option",{value:"pre",children:(0,W.Z)("Preformatted")})]}),_Y.map(((e,s)=>{const n=e.map(((e,s)=>(0,zn.jsx)(oa.ZP,{tooltip:e.text,image:e.icon,onClick:()=>this.props.onStylingButtonClicked(e.command),tabIndex:-1,disabled:this.props.disabled,isPressed:!0===this.state.buttonState[t+s]},e.command)));return t+=n.length,(0,zn.jsx)("div",{className:"toolbar-group",children:n},s)})),(0,zn.jsx)(oa.ZP,{className:"attachment-button push-right",title:(0,W.Z)("$1 Attachment","$1 Attachments",[this.props.attachments.length]),onClick:this.toggleAttachmentPopup,isPopupVisible:this.state.isAttachmentPopupOpen,hidePopup:this.hideAttachmentPopup,popupClassName:"ToolbarButtonPopup-DefaultStyles",popupWidth:222,popupPosition:"below",image:Kn.onv,disabled:this.props.disabled,children:e&&(0,zn.jsx)(NY,{attachments:this.props.attachments,noteId:e,onRemoveAttachment:e=>{Js.Z.removeNode(e)},onInsertMarkdown:this.props.handleAttachmentMarkdown,dragFormat:this.props.visualMode?"html":"url"})}),(0,zn.jsxs)("div",{className:"toolbar-group",children:[(0,zn.jsx)(oa.ZP,{title:(0,W.Z)("Text"),onClick:this.disableVisualMode,isPressed:!this.props.visualMode,disabled:this.props.disabled}),(0,zn.jsx)(oa.ZP,{title:(0,W.Z)("Visual"),onClick:this.enableVisualMode,isPressed:this.props.visualMode,disabled:this.props.disabled})]})]}),(0,zn.jsx)(sC,{isActive:this.props.isActive,pageId:this.props.pageId,onFindInPage:this.handleFindInPage,onFindNextInPage:this.handleFindNextInPage})]})}}function MY(e,t){if(e.title)return e.title;if(!e.content)return t||"";return e.content.split("\n")[0].trim().replace(/ {2,}/g," ").replace(/^#+ /g,"").substr(0,128).trim()}function DY({content:e}){return e?e.replace(/\n+/g,"").length:0}function OY({content:e}){return e?e.trim().split(/\s+/g).length:0}var jY=s(34155);class LY extends Un.Component{static contextType=oi.Z;refMarkdownEditor=Un.createRef();refVisualEditor=Un.createRef();refToolbar=Un.createRef();markdownFormatter=new CY({quotes:(0,W.Z)("“”‘’")});turndownFormatter=new IY;state={visualMode:!A.Z.get(Z.kNotesManagerShowMarkdown),attachments:this.props.note?.children?this.props.note.children:[]};componentDidMount(){s$.ZP.addListener(this._onNoteStoreChanged)}componentDidUpdate(e){e.note!==this.props.note&&(this.hasFocus()||(this.onRichContentLoad(),this.onMarkdownContentLoad()),this.setState({attachments:this.props.note?.children?this.props.note.children:[]}))}componentWillUnmount(){s$.ZP.removeListener(this._onNoteStoreChanged)}_onNoteStoreChanged=e=>{if(this.props.note){const e=s$.ZP.getNodeById(this.props.note.id);e&&this.setState({attachments:e.children})}};focus=()=>{this.state.visualMode?this.refVisualEditor.current?.focus():this.refMarkdownEditor.current&&this.refMarkdownEditor.current.focus()};blur=()=>{this.state.visualMode?this.refVisualEditor.current?.blur():this.refMarkdownEditor.current&&this.refMarkdownEditor.current.blur()};hasFocus=()=>this.state.visualMode&&this.refVisualEditor.current?this.refVisualEditor.current.hasFocus():!!this.refMarkdownEditor.current&&this.refMarkdownEditor.current.hasFocus();handleAttachmentMarkdown=async e=>{this.refVisualEditor.current&&this.props.note&&this.refVisualEditor.current.execCommand("insertImage",e)};onHtmlChange=()=>{if(!this.refVisualEditor.current)throw new Error("VisualEditor: Building body parts after body is gone");return this.refVisualEditor.current.getContentAsBodyParts().then((e=>{if("html"===e[0].type){const t=this.turndownFormatter.turndownService.turndown(e[0].content);this.props.updateNoteContent(t,(()=>{this.refMarkdownEditor&&this.refMarkdownEditor.current&&this.refMarkdownEditor.current.setContent(t)}))}}))};onMarkDownChange=async()=>{if(!this.refMarkdownEditor.current)throw new Error("MarkdownEditor: Building body parts after body is gone");const e=await this.refMarkdownEditor.current.getContentAsBodyParts();if("text"!==e[0].type)return;const t=e[0].content;this.props.updateNoteContent(t,(()=>{}))};setZoomLevel=()=>{const e=lf.Z.getNotesZoom();this.refVisualEditor.current?.setZoomLevel(e),this.refMarkdownEditor.current?.setZoomLevel(e)};onRichContentLoad=()=>{const{note:e}=this.props,t=this.markdownFormatter.getRawMarkup(e?.content??"").replace(/<p><\/p>/g,"<p><br></p>");jY.nextTick((()=>{this.refVisualEditor.current?.setContent([{content:t,isPlainText:!1}]),this.setZoomLevel()}))};onMarkdownContentLoad=()=>{const{note:e}=this.props;jY.nextTick((()=>{this.refMarkdownEditor.current?.setContent(e?.content||""),this.setZoomLevel()}))};onStylingButtonClicked=e=>{this.state.visualMode?this.refVisualEditor.current?.onClick(e):this.refMarkdownEditor.current?.onClick(e)};onParagraphFormatChange=(e,t)=>{this.state.visualMode?this.refVisualEditor.current?.onChange(e,t):this.refMarkdownEditor.current?.onChange(e,t)};onCreateLink=e=>{const t=this.state.visualMode?this.refVisualEditor.current:this.refMarkdownEditor.current;t&&(""===e?t.execCommand("unlink"):"https://"!==e&&t.execCommand("createLink",e),t.focus())};onCancelCreateLink=()=>{this.focus()};handleLinkEvent=e=>{const t=this.refToolbar.current;if(!t)return;const{isAnchor:s,anchorOrSelection:n}=t;switch(e.type){case"selectionchange":t.updateLinkState(e);break;case"createLink":case"editLink":t.showCreateLinkModal();break;case"copyLink":break;case"unlink":s&&n&&this.refVisualEditor.current?.unlink();break;case"createLinkClicked":s&&n&&this.refVisualEditor.current?.selectSurrounding(),t.showCreateLinkModal()}};setActiveWebView=()=>{this.clearActiveWebViews();const e=this.refVisualEditor.current?.refWebview.current,t=this.refMarkdownEditor.current?.refWebview.current,s=this.context.vivaldiWindowId;this.state.visualMode&&e?Fb.Z.setActiveWebView(s,e):this.refMarkdownEditor&&t&&Fb.Z.setActiveWebView(s,t)};clearActiveWebViews=()=>{const e=this.refVisualEditor.current?.refWebview.current,t=this.refMarkdownEditor.current?.refWebview.current,s=this.context.vivaldiWindowId;e&&Fb.Z.clearIfActive(s,e),t&&Fb.Z.clearIfActive(s,t)};setVisualMode=e=>{this.setState({visualMode:e},(()=>{this.setActiveWebView(),this.onRichContentLoad(),I.Z.set(Z.kNotesManagerShowMarkdown,!e)}))};updateDropdownAndColorState=()=>{this.refVisualEditor.current?.executeScript({code:"['formatBlock'].map(command => document.queryCommandValue(command));"}).then((e=>{if(Array.isArray(e)&&1===e.length&&Array.isArray(e[0])){const[t]=e[0],s=""===t||"div"===t?"p":t;this.refToolbar.current?.updateButtonState(void 0,s)}}))};updateButtonState=()=>{const e=this.refToolbar.current;if(e)if(this.state.visualMode){const t=`[${'"'+_Y.flat().map((e=>e.command)).join('","')+'"'}].map(command => document.queryCommandState(command));`;this.refVisualEditor.current?.executeScript({code:t}).then((t=>{const s=_Y.flat().map((e=>e.command)).indexOf("createLink"),n=t&&Array.isArray(t[0])?t[0].map(Boolean):[];n[s]=e.isAnchor,e.updateButtonState(n)}))}else{const t=this.refMarkdownEditor.current;if(!t)return;const s=_Y.flat().map((e=>e.command)).reduce(((e,s)=>(Object.hasOwn(t.state.caretState,s)&&"boolean"==typeof t.state.caretState[s]&&e.push(t.state.caretState[s]),e)),[]),{formatBlock:n}=t.state.caretState;e.updateButtonState(s,n)}};render(){const{note:e}=this.props;return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)(PY,{ref:this.refToolbar,isActive:this.props.isActive,noteId:e?.id,pageId:this.props.pageId,attachments:this.state.attachments,disabled:!e||this.props.isFolder,inFullView:this.props.inFullView,visualMode:this.state.visualMode,handleAttachmentMarkdown:this.handleAttachmentMarkdown,onCreateLink:this.onCreateLink,onCancelCreateLink:this.onCancelCreateLink,onParagraphFormatChange:this.onParagraphFormatChange,onStylingButtonClicked:this.onStylingButtonClicked,setVisualMode:this.setVisualMode,toggleFullEditor:this.props.toggleFullEditor}),(0,zn.jsxs)("div",{className:"NotesManager-Editor",children:[(0,zn.jsx)("div",{className:"editor-html",children:(0,zn.jsx)(iw,{ref:this.refVisualEditor,onChange:this.onHtmlChange,onContentLoad:this.onRichContentLoad,focusPreviousElement:nr.Z,isNote:!0,hidden:!this.state.visualMode,disabled:!e||this.props.isFolder,updateDropdownAndColorState:this.updateDropdownAndColorState,updateButtonState:this.updateButtonState,handleLinkEvent:this.handleLinkEvent})}),(0,zn.jsx)(wY,{ref:this.refMarkdownEditor,onChange:this.onMarkDownChange,onContentLoad:this.onMarkdownContentLoad,hidden:this.state.visualMode,disabled:this.state.visualMode||!e||this.props.isFolder,updateDropdownState:this.updateDropdownAndColorState,updateButtonState:this.updateButtonState,handleLinkEvent:this.handleLinkEvent})]}),e&&(0,zn.jsx)("footer",{className:"NotesManager-Footer",children:(0,zn.jsx)("div",{className:"NotesManager-WordCount",children:(0,W.Z)("$1 word","$1 words",[OY(e)])+", "+(0,W.Z)("$1 character","$1 characters",[DY(e)])})})]})}}function RY(e,t){c.ZP.openURL(e,vs.jk.internalUrl("notes",t.id),{singleton:!0})}class BY extends Un.PureComponent{refTreeList=Un.createRef();static contextType=oi.Z;_isAdding=!1;state={nodes:[],populated:!1,cutIds:[],showBadge:A.Z.get(Z.kPanelsShowFolderBadge)};expandModel={};componentDidMount(){A.Z.addListener(Z.kPanelsShowFolderBadge,this._onBadgeChanged),s$.ZP.addListener(this._onStoreChange),this._onStoreChange({reason:"init",id:"-1"})}componentWillUnmount(){A.Z.removeListener(Z.kPanelsShowFolderBadge,this._onBadgeChanged),s$.ZP.removeListener(this._onStoreChange)}componentDidUpdate(e){if(this.props.filter!==e.filter){const t=this.props.filter.length,s=e.filter.length;0===s&&t>0&&this.refTreeList.current&&(this.expandModel=this.refTreeList.current.getExpandModel()),this.onFilterChange(this.props.filter,(e=>{t>0?this.refTreeList.current?.expandAllExcept(e):s>0&&0===t&&this.refTreeList.current?.expandWithModel(this.expandModel)}))}}isEmpty=()=>this.state.populated&&0===this.state.nodes.length;isInManager=()=>Boolean(this.props.columns);deleteSelectedItems=()=>this.refTreeList.current?.onDelete()||Promise.reject();delete=(e=[])=>Promise.all(e.map((e=>"string"!=typeof e?Promise.resolve():new Promise((t=>{re.Z.notes.get(e,(s=>{s&&s.length>0&&!this.isTrashCan(s[0])?re.Z.notes.remove(e,t):t()}))})))));isFolder=e=>s$.ZP.isFolder(e);isTrashCan=e=>Boolean("trash"===e.type);getUrlsByNodes=e=>e.map((e=>s$.ZP.getNodeById(e.id))).map((e=>e?.url?(0,Ar.q9)(e.url):void 0)).filter(Boolean);onItemMouseDown=(e,t)=>{t.button===ai.Z.kCenter&&(0,wi.ZP)(t)};onItemMouseUp=(e,t)=>{if(t.button===ai.Z.kCenter){const s=this.getUrlsByNodes([e]),n=this.context.vivaldiWindowId;s.length>0?c.ZP.openUrls(n,s,{...(0,fo.ZP)(n,{button:t.button,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey},re.Z.historyPrivate.TransitionType.LINK)}):RY(this.context.vivaldiWindowId,e),(0,wi.ZP)(t)}};onItemDoubleClick=(e,t)=>{const s=this.getUrlsByNodes([t]),n=this.context.vivaldiWindowId;s.length>0?c.ZP.openUrls(n,s,{...(0,fo.ZP)(n,{button:e.button,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,metaKey:e.metaKey},re.Z.historyPrivate.TransitionType.LINK)}):RY(n,t)};onNodesActivated=(e,t)=>{const s=this.getUrlsByNodes(t),n=this.context.vivaldiWindowId;c.ZP.openUrls(n,s,{...(0,fo.ZP)(n,{ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,metaKey:e.metaKey},re.Z.historyPrivate.TransitionType.LINK)})};onFilterChange=(e,t=nr.Z)=>{let s=[],n=[];if(s$.ZP.hasNotes())if(e.length>0){let t=e.toLowerCase();const i={};if(t.startsWith("url:")?(t=t.substring(4),i.url=t.length>0,i.content=!1):t.startsWith("content:")&&(t=t.substring(8),i.url=!1,i.content=t.length>0),"."===t&&(i.url=!1),"tree"===this.refTreeList.current?.getSearchStyle()){const e=s$.ZP.getFilteredTree(t,i);s=e.nodes,n=e.collapsed}else s=s$.ZP.getFilteredFlat(t,i)}else s=s$.ZP.getRootNode().children;this.setState({nodes:s,populated:!0,cutIds:s$.ZP.getCutIds()},(()=>{t(n)}))};_onStoreChange=(e,t)=>{this._isAdding&&"added"===e.reason||this.onFilterChange(this.props.filter,(()=>{"removed"!==e.reason&&"moved"!==e.reason||this.refTreeList.current?.pruneExpandModel(),this.props.onStoreChange(e,Boolean(t))}))};_onBadgeChanged=(e,t)=>{this.setState({showBadge:Boolean(t)})};hasChildren=e=>"note"!==e.type&&!!e.children&&e.children.length>0;handleExpandClick=(e,t)=>{const s=e.altKey;this.refTreeList.current?.toggleSelectedExpansion(t,s)};unSelectAll=()=>{this.refTreeList.current?.unSelectAll()};getSelectedItem=()=>this.refTreeList.current?.getSelectedItem();expandAll=()=>{this.refTreeList.current?.expandAll()};collapseAll=()=>{this.refTreeList.current?.collapseAll()};setSearchStyle=e=>{this.refTreeList.current?.setSearchStyle(e)};onSearchStyleChanged=e=>{this.props.filter&&this.onFilterChange(this.props.filter,(t=>{"tree"===e&&this.refTreeList.current?.expandAllExcept(t)}))};isValidForClipboard=e=>!this.isTrashCan(e);isValidDragSource=e=>!this.isTrashCan(e);isValidAddTarget=e=>!this.isTrashed(e);isTrashed=e=>!!e&&(!!this.isTrashCan(e)||!!e.parentId&&this.isTrashed(this.refTreeList.current?.findTreeItem(e.parentId)));onAddFolder=()=>{const e={title:(0,W.Z)("title","New Folder")};this.refTreeList.current?.onAdd("folder",e)};onAddNote=e=>{this.refTreeList.current?.onAdd("item",e)};selectById=e=>{this.refTreeList.current?.expandToId(e),this.refTreeList.current?.selectById(e)};onDrop=(e,t,s)=>{const n=e.dataTransfer.getData("text/plain");if(n.length>0){const e=this.getTargetSpec(t,s),i={id:"",content:n,title:"",type:"note"};return this.onCreate([i],e.parentId,e.index,!0)}return Promise.resolve()};getTargetSpec=(e,t)=>{const s={index:0,parentId:void 0,pageIndex:void 0};if(this.isTrashCan(e)&&"on"!==t){const e=s$.ZP.getLastTopNode();e?(s.parentId=e.parentId,s.index=(e.index||0)+1):s.parentId=s$.ZP.getRootNode().id}else if(this.isFolder(e)&&"on"===t)s.parentId=e.id;else{Boolean(this.refTreeList.current?.isExpanded(e.id))&&"below"===t?s.parentId=e.id:(s.parentId=e.parentId,s.index=(e.index||0)+("below"===t?1:0))}return s};buildNode=(e,t)=>({...t,type:"item"===e?"note":e});onCreate=async(e,t,s,n)=>{const i=void 0===e[0].children;this.props.onBeforeCreate(i),this._isAdding=!0;const a=await Js.Z.createNotesFromTreeNodes(e,t||"",s);this._isAdding=!1,a.length>0&&this._onStoreChange({reason:"added",id:a[0].id},!0)};onMove=async(e,t,s)=>{if("number"!=typeof t.index)return[];const n=t.index,i=t.parentId??"",a=s$.ZP.validateForDrag(e);let o=0;for(let e=0;e<a.length;e++){const t=a[e],s=s$.ZP.getNodeById(t),r=s?.index??-1;if(!(r<0)){if(0===e)o=n;else{const e=i!==s?.parentId;o+=r<n&&!e?0:1}await re.Z.notes.move(t,{parentId:i,index:o})}}return[]};getText=()=>new Promise((e=>{const t=Ze.ZP.getActivePage(this.context.vivaldiWindowId);t?re.Z.utilities.getSelectedText(t.id,e):e("")}));getMenuCapability=async(e,t,s)=>{const n=this.context.vivaldiWindowId,i={inManager:this.isInManager()};switch(e.action){case"CONTEXT_OPEN_ADDRESS":{const a=s?.url;return{handler:()=>!!a&&c.ZP.openUrls(n,[a],{inNewWindow:!1,inCurrent:!1,inBackground:A.Z.get(Z.kTabsOpenNewInBackground)}),isVisible:()=>!!a,...t(n,e,i)}}case"CONTEXT_CONTAINER_OPEN_IN_WINDOW":{const i=s?.url,a=await ro.getMenu(n,!0,[i||""]);return{isVisible:()=>!!i&&a.length>0,items:a,...t(n,e,{})}}case"CONTEXT_NEW_FROM_SELECTION":return this.getText().then((s=>{const a=Ze.ZP.getActivePage(n),o=a?.url??"";return{isVisible:()=>!!s&&!!a,handler:()=>{this.refTreeList.current?.onAdd("item",{content:s,url:o})},...t(n,e,i)}}));case"CONTEXT_EDIT":return{handler:()=>RY(this.context.vivaldiWindowId,s),isVisible:()=>Boolean(s)&&!this.isTrashCan(s),...t(n,e,i)};case"CONTEXT_EMPTY_TRASH":return{handler:()=>Js.Z.emptyTrash(),isVisible:()=>Boolean(s)&&this.isTrashCan(s),...t(n,e,i)};default:return{...t(n,e,i)}}};getMenuVisibility=(e,t)=>{if(t)if(this.isTrashCan(t))switch(e.action){case"CONTEXT_EXPAND_ALL":case"CONTEXT_COLLAPSE_ALL":case"CONTEXT_CONTAINER_SEARCH":return!0;default:return!1}else{const s=this.isTrashCan(t)||s$.ZP.isSeparator(t);switch(e.action){case"CONTEXT_NEW_ITEM":case"CONTEXT_NEW_FOLDER":case"CONTEXT_CUT":case"CONTEXT_COPY":case"CONTEXT_PASTE":case"CONTEXT_DELETE":return!this.isTrashCan(t);case"CONTEXT_NEW_SEPARATOR":return!this.isTrashCan(t)&&this.props.sorting.sortOrder===ui.Z.NO_SORTING;case"CONTEXT_RENAME":return!s;case"CONTEXT_EXPAND_ALL":case"CONTEXT_COLLAPSE_ALL":case"CONTEXT_CONTAINER_SEARCH":return!0;default:return!1}}else switch(e.action){case"CONTEXT_NEW_ITEM":case"CONTEXT_NEW_FOLDER":case"CONTEXT_PASTE":case"CONTEXT_EXPAND_ALL":case"CONTEXT_COLLAPSE_ALL":case"CONTEXT_CONTAINER_SEARCH":return!0;case"CONTEXT_NEW_SEPARATOR":return this.props.sorting.sortOrder===ui.Z.NO_SORTING;default:return!1}};onContextMenu=e=>{this.refTreeList.current?.onContextMenu(e)};getDropSupport=(e,t)=>{const s={available:!1,onto:!1,edge:"both"};return s.available=t.dataTransfer.types.some((e=>Jn.ZP.isUriListType(e)||"text/plain"===e||e===s$.d0)),s.available&&(s.onto=this.isFolder(e)),s};saveTitle=(e,t)=>{re.Z.notes.update(e,{title:t})};handleCut=(e,t)=>{const s=t.filter(this.isValidForClipboard),n=s.map((e=>e.id));(0,wi.ZP)(e),Js.Z.setClipboard(e,s,!0),Js.Z.setCutIds(n)};handleCopy=(e,t)=>{(0,wi.ZP)(e),Js.Z.setClipboard(e,t.filter(this.isValidForClipboard),!1)};renderTitleRow=e=>{const t=e.node,s=e.level,n=(s+1)*Ni+"px",i=s*Ni+"px",a=this.isFolder(t);return(0,zn.jsxs)("label",{children:[a&&this.hasChildren(t)&&(0,zn.jsx)("span",{className:"expand-icon",style:{marginLeft:i},onMouseDown:wi.ZP,onMouseUp:e=>this.handleExpandClick(e,t.id),dangerouslySetInnerHTML:{__html:Kn.nfH}}),a&&(0,zn.jsx)(qn,{trash:this.isTrashCan(t),open:e.isExpanded,leftMargin:this.hasChildren(t)?0:n}),!a&&!t.url&&(0,zn.jsx)("span",{style:{marginLeft:n},className:"tree-icon",dangerouslySetInnerHTML:{__html:Kn.zKr}}),!a&&!!t.url&&(0,zn.jsx)("span",{style:{marginLeft:n},className:"tree-icon",dangerouslySetInnerHTML:{__html:Kn.NwZ}}),void 0!==e.inlineEditText&&(0,zn.jsx)("input",{type:"text",value:e.inlineEditText,onChange:e.onChange,onFocus:e.onFocus,onBlur:e.onBlur,autoFocus:!0}),void 0===e.inlineEditText&&(0,zn.jsx)("span",{className:"title",title:MY(t),children:MY(t)}),e.showBadge&&!this.props.fullView&&this.hasChildren(t)&&(0,zn.jsx)("span",{className:"item-count",children:t.children?.length})]},t.id)};getRowComponentProps=e=>({...e,childCount:e.node.children&&"note"!==e.node.type?e.node.children.length:0,columns:this.props.columns,showBadge:this.state.showBadge});rowComponent=e=>{const t=e.node,s=e.level,n=s$.ZP.isSeparator(t),i=this.isFolder(t),a=(s+1)*Ni+"px",{columns:o}=e,r=[];return n?r.push((0,zn.jsx)("label",{"data-parent":t.parentId,children:(0,zn.jsx)("hr",{style:{marginLeft:a},className:"separator"})},`${t.id}__separator__${r.length}`)):this.props.fullView?(o||[]).map((s=>{switch(s.id){case"title":r.push(this.renderTitleRow(e));break;case"url":r.push((0,zn.jsx)("label",{children:(0,zn.jsx)("span",{children:t.url})},s.id));break;case"content":r.push((0,zn.jsxs)("label",{children:[!i&&(0,zn.jsx)("span",{children:t.content}),i&&t.children&&t.children.length>0&&(0,zn.jsx)("span",{className:"secondary",children:(0,W.Z)("$1 item","$1 items",[t.children.length])})]},s.id));break;case"attachments":r.push((0,zn.jsx)("label",{className:"right-aligned",children:(0,zn.jsx)("span",{children:"note"===t.type&&t.children&&t.children.length>0?t.children.length:""})},s.id));break;case"dateAdded":r.push((0,zn.jsx)("label",{className:"right-aligned",children:!i&&(0,zn.jsx)("span",{children:V()(t.dateAdded).format("ll")})},s.id));break;case"dateModified":r.push((0,zn.jsx)("label",{className:"right-aligned",children:!i&&(0,zn.jsx)("span",{children:V()(t.dateModified).format("ll")})},s.id))}})):r.push(this.renderTitleRow(e)),r};menu={name:"noteslist",getCapability:this.getMenuCapability,getVisibility:this.getMenuVisibility};render(){if(!this.state.populated&&!this.props.filter)return null;const e=s$.ZP.getRootNode().id;return(0,zn.jsx)(Mi,{ref:this.refTreeList,rowComponent:this.rowComponent,getRowComponentProps:this.getRowComponentProps,nodes:this.state.nodes,cutIds:this.state.cutIds,settings:this.props.settings,rootId:e,buildItem:this.buildNode,onSelect:this.props.onItemSelected,onItemDoubleClick:this.onItemDoubleClick,onItemMouseDown:this.onItemMouseDown,onItemMouseUp:this.onItemMouseUp,onItemsActivated:this.onNodesActivated,onCreate:this.onCreate,onSearchStyleChanged:this.onSearchStyleChanged,delete:this.delete,onMove:this.onMove,onDrop:this.onDrop,onCut:this.handleCut,onCopy:this.handleCopy,supportsInlineEdit:!0,mimeType:s$.d0,getDropSupport:this.getDropSupport,getDragData:s$.ZP.getDragData,isFolder:this.isFolder,isSeparator:s$.ZP.isSeparator,hasChildren:this.hasChildren,menu:this.menu,setCutIds:Js.Z.setCutIds,getTitle:s$.ZP.getTitle,saveTitle:this.saveTitle,getTargetSpec:this.getTargetSpec,isValidAddTarget:this.isValidAddTarget,isValidDragSource:this.isValidDragSource,isValidToEdit:s$.ZP.validateForEdit,validateForDrag:s$.ZP.validateForDrag,validateForDeletion:s$.ZP.validateForDeletion,sorting:this.props.sorting,columns:this.props.columns})}}const FY=BY;function WY({onAddNote:e}){return(0,zn.jsx)("div",{className:"notes-welcome",children:(0,zn.jsxs)("div",{className:"note-empty-state",onClick:e,children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.SXC}}),(0,zn.jsx)("h1",{children:(0,W.Z)("Write your first note")}),(0,zn.jsx)("p",{className:"faded-text",children:(0,W.Z)("Click the “+” to create a new note, or select text on any webpage and create a note from the contextual menu.")})]})})}class UY extends Un.PureComponent{refSearch=Un.createRef();focusSearch(){this.refSearch.current&&this.refSearch.current.focus()}render(){const{editorLayout:e,filter:t,onFilterValueChange:s,onAddNote:n,onDeleteSelectedItems:i,onAddFolder:a,onSetLayout:o,isDeleteDisabled:r}=this.props;return(0,zn.jsxs)("div",{className:"toolbar toolbar-default toolbar-small toolbar-wrap",role:"toolbar","aria-label":(0,W.Z)("toolbar label","Notes"),children:[(0,zn.jsx)("input",{ref:this.refSearch,type:"search",className:"notesearch",placeholder:(0,W.Z)("verb","Search"),value:t,title:(0,W.Z)("Limit the search to address or content by $1 or $2",["URL:","CONTENT:"]),disabled:!this.props.hasNotes,onChange:({currentTarget:e})=>s(e.value)}),(0,zn.jsxs)("div",{className:"toolbar",style:e?{flexGrow:1}:{},children:[(0,zn.jsxs)("div",{className:"toolbar-group",children:[(0,zn.jsx)(oa.ZP,{onClick:n,tooltip:(0,W.Z)("New Note"),image:Kn.md4.small}),(0,zn.jsx)(oa.ZP,{onClick:i,tooltip:(0,W.Z)("other","Delete"),image:Kn.M2k.small,disabled:r})]}),(0,zn.jsx)("div",{className:"toolbar-group",children:(0,zn.jsx)(oa.ZP,{onClick:a,image:Kn._TQ.small,tooltip:(0,W.Z)("command","New Folder")})}),e&&(0,zn.jsx)(oa.ZP,{name:"MailViewLayout",className:"layout-toggle push-right",onClick:o,image:Kn.EVi.small,tooltip:(0,W.Z)("command","Toggle Layout"),style:{"--modeVerticalWide":0,"--modeVertical":"vertical"===e?1:0,"--modeHorizontal":"horizontal"===e?1:0}})]})]})}}var VY=s(34155);const HY=[{text:(0,W.Z)("Title"),value:"title",fullScreenTitle:(0,W.Z)("Sort by title"),width:300,visible:!0,key:!0},{text:(0,W.Z)("Content"),value:"content",icon:Kn.sWI,fullScreenTitle:(0,W.Z)("Sort by content"),width:300,visible:!1},{text:(0,W.Z)("Address"),value:"url",icon:Kn.iD7,fullScreenTitle:(0,W.Z)("Sort by address"),width:300,visible:!0},{text:(0,W.Z)("Date Created"),value:"dateAdded",icon:Kn.V_c,fullScreenTitle:(0,W.Z)("Sort by creation date"),width:120,visible:!0},{text:(0,W.Z)("Date Modified"),value:"dateModified",icon:Kn.JHW,fullScreenTitle:(0,W.Z)("Sort by last modified date"),width:120,visible:!0},{text:(0,W.Z)("Attachments"),value:"attachments",icon:Kn.onv,fullScreenTitle:(0,W.Z)("Sort by attachments"),width:60,visible:!0}],GY=(0,Te.Z)(KY,s$.mS,{trailing:!0,leading:!1});function KY({id:e,changes:t}){return new Promise(((s,i)=>{re.Z.notes.update(e,t,(()=>n.Z.runtime.lastError?i(n.Z.runtime.lastError):s()))}))}class zY extends Un.PureComponent{static contextType=oi.Z;refBody=Un.createRef();_tree=Un.createRef();_treeWrapper=Un.createRef();constructor(e,t){super(e),this.winId=t.vivaldiWindowId;const s=A.Z.get(Z.kNotesManagerSorting),n=A.Z.get(Z.kNotesManagerLayout),i="horizontal"===n?"notes":"notes_vertical";this.state={filter:"",note:void 0,markdownScrollPosition:0,editorScrollPosition:0,isAttachmentPopupOpen:!1,editorCursorPosition:0,editorLayout:n,editLinkModal:!1,treeViewSize:"vertical"===n?A.Z.get(Z.kNotesManagerTreeWidth):A.Z.get(Z.kNotesManagerTreeHeight),sorting:{sortOrder:s.sortOrder,sortField:s.sortField,comparator:this.sortComparator},columns:xi()[i]||Ii(HY),showWelcome:!s$.ZP.hasNotes()}}componentDidMount(){const{selectWindow:e}=this.context;Ze.ZP.addListener(this._onPageStoreChange,e),this.props.id&&"-1"!==this.props.id&&VY.nextTick((()=>{this.selectById(this.props.id)}))}componentWillUnmount(){Ze.ZP.removeListener(this._onPageStoreChange)}_onPageStoreChange=()=>{const e=Ze.ZP.getActivePage(this.context.vivaldiWindowId);if(e&&e.id===this.props.pageId)VY.nextTick((()=>{const{note:e}=this.state;if(e){e.id!==this.props.id&&this.selectById(this.props.id);const t=MY(e);c.ZP.setTitle(this.props.pageId,this.winId,t)}this.refBody.current?.setActiveWebView()}));else{const e=this.refBody.current;e&&VY.nextTick(e.clearActiveWebViews)}};_onStoreChange=(e,t)=>{switch(e.reason){case"added":{if(this.setState({showWelcome:!1}),!t)return;const s=s$.ZP.getNodeById(e.id);return void this.setState({note:s},(()=>{if(s&&!s$.ZP.isSeparator(s))if(this.selectById(s.id),s$.ZP.isFolder(s)){const e=this._tree.current?.refTreeList.current;e?.startInlineEditForSelectedItem()}else this.refBody.current&&this.refBody.current.focus()}))}case"moved":e.id===this.state.note?.id&&this._tree?.current?.selectById(e.id);break;case"removed":e.id===this.state.note?.id&&this._tree?.current?.selectById(""),this.setState({showWelcome:!s$.ZP.hasNotes()});break;case"changed":if(!this.state.note||this.state.note.id!==e.id)return;this.setState({note:s$.ZP.getNodeById(this.props.id)});break;case"init":this.selectById(this.props.id),this.setState({note:s$.ZP.getNodeById(this.props.id),showWelcome:!s$.ZP.hasNotes()})}};selectById=e=>{this._tree.current?.selectById(e)};sortComparator=(e,t)=>{if("trash"===e.type)return 1;if("trash"===t.type)return-1;if(s$.ZP.isFolder(e)&&!s$.ZP.isFolder(t))return-1;if(s$.ZP.isFolder(t)&&!s$.ZP.isFolder(e))return 1;const{sortOrder:s,sortField:n}=this.state.sorting;if("title"===n)return this.sortByTitle(e,t,s);return ui.Z.getDefaultComparator(s,n)(e,t)};sortByTitle=(e,t,s)=>{if(s<=ui.Z.NO_SORTING)return 0;const n=e.title||MY(e),i=t.title||MY(t);return n||i?n?i?s===ui.Z.ASCENDING_SORT?n.toLowerCase().localeCompare(i.toLowerCase()):i.toLowerCase().localeCompare(n.toLowerCase()):s===ui.Z.ASCENDING_SORT?-1:1:s===ui.Z.ASCENDING_SORT?1:-1:0};onSortChange=(e,t)=>{this.setState((s=>({sorting:{...s.sorting,sortOrder:e,sortField:t}}))),I.Z.set(Z.kNotesManagerSorting,{sortOrder:e,sortField:t})};onUpdateRow=e=>{this.setState({columns:e})};onSaveRow=()=>{yi(this.state.columns,"horizontal"===this.state.editorLayout?"notes":"notes_vertical")};onItemSelected=(0,Te.Z)((e=>{if(!e&&!this.state.note)return;this.setState({note:e,markdownScrollPosition:0,editorScrollPosition:0,isAttachmentPopupOpen:!1,editorCursorPosition:0});const t=e?.id||"";c.ZP.openURL(this.context.vivaldiWindowId,vs.jk.internalUrl("notes",t),{inSpecificPageId:this.props.pageId})}),200);handleFilterChange=e=>{this.setState({filter:e})};onBeforeCreate=e=>{this.setState({filter:""})};onAddNote=()=>{this.refBody.current?.blur(),this._tree.current?.onAddNote()};onAddFolder=()=>{this._tree.current?.onAddFolder()};onDeleteSelectedItems=()=>{this.refBody.current?.blur(),this._tree.current?.deleteSelectedItems()};toggleFullEditor=()=>{this.setState((e=>{const t="vertical"===e.editorLayout?Z.kNotesManagerTreeWidth:Z.kNotesManagerTreeHeight;let s;return 0!==e.treeViewSize?(this.restoreSize=e.treeViewSize,s=0):s=this.restoreSize??A.Z.getDefault(t),I.Z.set(t,s),{treeViewSize:s}}))};onSlidebarPosition=(e,t)=>{if(!this._treeWrapper.current)return;const s=this._treeWrapper.current.getBoundingClientRect(),{width:n,height:i,top:a,left:o}=s,r="vertical"===this.state.editorLayout?(e-o)/n:(t-a)/i;this.setState((e=>({treeViewSize:Math.max(100*r,0)})))};onSlidebarStop=()=>{this.setState((e=>{const t="horizontal"===e.editorLayout?Z.kNotesManagerTreeHeight:Z.kNotesManagerTreeWidth,s=e.treeViewSize>5?e.treeViewSize:0;return I.Z.set(t,s),{treeViewSize:s}}))};updateNoteContent=(e,t)=>{this.setState((t=>t.note?{note:{...t.note,content:e}}:null),t),this.state.note&&GY({id:this.state.note.id,changes:{content:e}})};onSaveLink=e=>{const{note:t}=this.state;t&&KY({id:t.id,changes:{url:e}}),this.setState({editLinkModal:!1})};onCancelEditLink=()=>this.setState({editLinkModal:!1});onEditLink=()=>this.setState({editLinkModal:!0});toggleManagerLayout=()=>this.setState((e=>{const t="horizontal"===e.editorLayout?"vertical":"horizontal",s="horizontal"===t?A.Z.get(Z.kNotesManagerTreeHeight):A.Z.get(Z.kNotesManagerTreeWidth),n="horizontal"===t?"notes":"notes_vertical";return I.Z.set(Z.kNotesManagerLayout,t),{editorLayout:t,treeViewSize:s,columns:xi()[n]||Ii(HY)}}));render(){const{note:e,editorLayout:t,showWelcome:s}=this.state,n=!!e&&s$.ZP.isFolder(e),i=e&&!n,a=!i&&!s;return(0,zn.jsxs)("div",{ref:this._treeWrapper,className:Gn()({"NotesManager manager":!0,"NotesManager--Horizontal":"horizontal"===t,"NotesManager--Vertical":"vertical"===t}),children:[this.state.editLinkModal&&(0,zn.jsx)(qC,{onCreateLink:this.onSaveLink,onCancelCreateLink:this.onCancelEditLink,anchorOrSelection:e?.url??"",isAnchor:!0,useAddress:!0}),(0,zn.jsxs)("div",{className:Gn()({"NotesManager-Tree":!0,"NotesManager-Tree--Collapsed":0===this.state.treeViewSize}),style:{flexBasis:`${this.state.treeViewSize}%`},children:[(0,zn.jsx)(UY,{filter:this.state.filter,onFilterValueChange:this.handleFilterChange,onAddNote:this.onAddNote,onAddFolder:this.onAddFolder,onDeleteSelectedItems:this.onDeleteSelectedItems,onSetLayout:this.toggleManagerLayout,editorLayout:t,isDeleteDisabled:!this.state.note,hasNotes:s$.ZP.hasNotes()}),(0,zn.jsxs)("div",{className:"NotesManager-Tree-Container",children:[(0,zn.jsx)(Bu,{fields:HY,onSortChange:this.onSortChange,fullsize:!0,sortField:this.state.sorting.sortField,sortOrder:this.state.sorting.sortOrder,columns:this.state.columns,onUpdateRow:this.onUpdateRow,onSaveRow:this.onSaveRow,keyAccess:A.Z.get(Z.kKeyboardTabToAll),manualSorting:!0},this.state.editorLayout),(0,zn.jsx)(FY,{ref:this._tree,settings:`NOTES_MANAGER_TREE_${this.props.pageId}`,filter:this.state.filter,sorting:this.state.sorting,onItemSelected:this.onItemSelected,onStoreChange:this._onStoreChange,onBeforeCreate:this.onBeforeCreate,editLink:this.onEditLink,columns:this.state.columns,noteId:this.state.note?this.state.note.id:"-1",pageId:this.props.pageId,fullView:!0})]})]}),s&&(0,zn.jsx)(WY,{onAddNote:this.onAddNote}),(0,zn.jsxs)("div",{className:a?"NotesManager-EmptyPlaceholder":"NotesManager-Note",onClick:a?this.onAddNote:null,children:[(0,zn.jsx)(Mu.Z,{onSlidebarPosition:this.onSlidebarPosition,onStop:this.onSlidebarStop,onDoubleClick:this.toggleFullEditor,position:"vertical"===t?"right":"bottom"}),i&&(0,zn.jsx)(LY,{ref:this.refBody,inFullView:this.state.treeViewSize>0,note:this.state.note,pageId:this.props.pageId,isFolder:n,toggleFullEditor:this.toggleFullEditor,updateNoteContent:this.updateNoteContent,isActive:this.props.isActive}),a&&(0,W.Z)("Add a new note")]})]})}}function $Y(e){Un.useContext(oi.Z);const[t,s]=Un.useState(!1),[n,i]=Un.useState(!1);return null}const YY="category__",XY=[(0,W.Z)("Popular Sites"),(0,W.Z)("Travel"),(0,W.Z)("Shopping"),(0,W.Z)("Gaming"),(0,W.Z)("Social"),(0,W.Z)("Finance"),(0,W.Z)("News"),(0,W.Z)("Education"),(0,W.Z)("Sport"),(0,W.Z)("Streaming"),(0,W.Z)("Food"),(0,W.Z)("Health"),(0,W.Z)("Parenting"),(0,W.Z)("Books"),(0,W.Z)("Photography"),(0,W.Z)("Tools")],QY=["popular_sites","travel","shopping","gaming","social","finance","news","education","sport","streaming","food","health","parenting","books","photography","tools"];const qY=function({nodeLinks:e,popularSites:t,onSetCategory:s,addSpeedDial:n,categoryOverride:i}){const a=Un.createRef(),o=Un.createRef(),[r,l]=Un.useState("number"==typeof i?i:-1),d=(e,t)=>{const s=a.current;if(s){return bo(e,t,Array.from(s.querySelectorAll("button.SpeedDial")),XY.length)}return!1},c=(e,t)=>{const s=o.current;if(s){return bo(e,t,Array.from(s.querySelectorAll("button.SpeedDial")),Math.floor((s.clientWidth+6)/96))}return!1},h=-1===r;return t?.length?(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("section",{className:"drawer-categories",style:h?void 0:{display:"none"},children:[(0,zn.jsx)("h2",{children:(0,W.Z)("Categories")}),(0,zn.jsx)("div",{className:"SpeedDials",ref:a,children:t.filter((e=>0!==e.category&&e.bookmarks.length>=4)).map(((e,t)=>{const n=XY[e.category]||"",i=QY[e.category]||"";return(0,zn.jsxs)("button",{className:`SpeedDial ${i}`,onClick:()=>{l(e.category),s(!0)},onKeyDown:t=>((e,t)=>{switch(t.key){case"ArrowLeft":d(e,"left"),(0,wi.ZP)(t);break;case"ArrowRight":d(e,"right"),(0,wi.ZP)(t);break;default:return}})(YY+e.category,t),tabIndex:0===t?"0":"-1","data-id":YY+e.category,children:[(0,zn.jsx)("img",{src:`../../resources/dm_${i}.svg`,alt:""}),(0,zn.jsx)("span",{children:n})]},e.category)}))}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Vivaldi may earn an affiliate commission if you make a purchase after clicking some of these links. This helps support Vivaldi’s development and keeps the browser independent. Thank you for your support!")})]}),!h&&(0,zn.jsxs)("section",{className:"drawer-suggestions",children:[t.map((t=>{if(t.category===r)return(0,zn.jsxs)(Un.Fragment,{children:[(0,zn.jsx)("h2",{children:XY[t.category]}),(0,zn.jsx)("div",{className:"SpeedDials",ref:o,children:t.bookmarks.map(((s,i)=>{const a=e.includes((0,Ar.q9)(s.redirect_url));return(0,zn.jsxs)("button",{className:Gn()("SpeedDial",{disabled:a}),"data-id":s.redirect_url,tabIndex:0===i?"0":"-1",autoFocus:0!==t.category&&0===i,onClick:a?void 0:()=>n(s.name,s.redirect_url),onKeyDown:e=>((e,t)=>{switch(t.key){case"ArrowLeft":c(e,"left"),(0,wi.ZP)(t);break;case"ArrowRight":c(e,"right"),(0,wi.ZP)(t);break;case"ArrowUp":c(e,"up"),(0,wi.ZP)(t);break;case"ArrowDown":c(e,"down"),(0,wi.ZP)(t);break;default:return}})(s.redirect_url,e),children:[(0,zn.jsx)("div",{className:"dial-image",children:(0,zn.jsx)("img",{width:"32",height:"32",src:s.image_path,alt:""})}),(0,zn.jsx)("div",{className:"dial-title",children:s.name})]},s.redirect_url)}))})]},t.category)})),0!==i&&(0,zn.jsx)("input",{type:"button",className:"back",onClick:()=>{l(-1),s(!1)},value:(0,W.Z)("navigation","Back")})]})]}):null},JY=({nodeLinks:e,nodeId:t,keyAccess:s,onSpeedDialDrawerDone:n})=>{const i=Un.useContext(oi.Z),a=Un.createRef(),[o,r]=Un.useState([]),l=Un.useCallback((()=>{fe.ZP.isIncognitoOrGuest(i.vivaldiWindowId)||(0,xm.Z)().then((t=>{const s=t.filter((t=>!e.includes(t.url)));r(s)}))}),[i.vivaldiWindowId,e]);Un.useEffect((()=>{l()}),[l]);const d=e=>{e.preventDefault()},c=(e,t)=>{const{HTMLElement:s}=i,n=a.current;if(n instanceof s){return bo(e,t,Array.from(n.querySelectorAll("button.SpeedDial")),Math.floor((n.clientWidth-36)/90))}return!1};return o.length?(0,zn.jsxs)("section",{ref:a,className:"drawer-suggestions",children:[(0,zn.jsx)("header",{children:(0,zn.jsx)("h2",{children:(0,W.Z)("Frequently Visited")})}),(0,zn.jsx)("div",{className:"SpeedDials",children:o.map(((e,i)=>{const a=i.toString();return(0,zn.jsxs)("button",{className:"SpeedDial",tabIndex:0===i?"0":s,"data-id":a,title:e.title+"\n"+e.url,onMouseDown:d,onMouseUp:d,onKeyDown:e=>((e,t)=>{switch(t.key){case"ArrowLeft":c(e,"left");break;case"ArrowRight":c(e,"right");break;case"ArrowUp":c(e,"up");break;case"ArrowDown":c(e,"down");break;default:return}t.preventDefault(),t.stopPropagation()})(a,e),onClick:s=>((e,s)=>{if(t){const i={parentId:t,title:e,url:(0,Ar.q9)(s)};n(i)}else n()})(e.title,e.url),"data-dialurl":e.url,children:[(0,zn.jsx)("div",{className:"dial-image suggest-thumbnail-image",children:(0,zn.jsx)(Vn.ZP,{url:e.url,size:32,loadType:"page"})}),(0,zn.jsx)("div",{className:"dial-title",children:e.title})]},i)}))})]}):null};const eX=function({node:e,keyAccess:t,onSpeedDialDrawerDone:s,popularSites:n}){const i=Un.useMemo((()=>crypto.randomUUID()),[]),[a,o]=Un.useState(""),[r,l]=Un.useState(""),[d,c]=Un.useState(!1),[h,u]=Un.useState(!1);Un.useEffect((()=>{const e=()=>{const{autocompleteValue:e,typedUrl:t}=wg.getUrlfieldState(i),s=e||t||"";l(t||""),c(function(e){const t=e.trim();return!!(0,Ar.K2)((0,Ar.q9)(t))||!(0,Ar.Zj)(t)}(s))};return wg.addListener(e,(e=>e.get(i))),()=>{wg.removeListener(e),vg.Z.reset(i)}}),[i]);const p=(t,n,i=!0)=>{if(e&&e.id){const a={parentId:e.id,title:t,url:(0,Ar.q9)(n),thumbnail:void 0};s(a,i)}},g=()=>{s()},m=(()=>{const t=[];return e?.children&&e.children.forEach((e=>{e.url?t.push(e.url):Array.isArray(e.children)&&e.children.forEach((e=>{e.url&&t.push(e.url)}))})),t})();return(0,zn.jsxs)(Ha.Z,{onRequestClose:g,className:"startpage-drawer",children:[(0,zn.jsx)("button",{className:"close",tabIndex:"-1",dangerouslySetInnerHTML:{__html:Kn.kze},onClick:g}),!h&&(0,zn.jsxs)("section",{className:"drawer-adddial",children:[(0,zn.jsx)("header",{children:(0,zn.jsx)("h2",{children:(0,W.Z)("Add Bookmark to Speed Dial")})}),(0,zn.jsxs)("form",{className:"drawer-addform",onSubmit:e=>{e.stopPropagation(),e.preventDefault();const{autocompleteValue:t}=wg.getUrlfieldState(i);let s=(t||r||"").trim();if(s=(0,Ar.q9)(s),0===s.length)return;const n=a||(e=>e.startsWith("file://")?e.replace(/^file:\/\//,""):e.replace(/^[a-zA-Z0-9+-.]+:\/\/(www\.)?/,""))(s);p(n,s,!1)},children:[(0,zn.jsx)("span",{children:(0,W.Z)("Address")}),(0,zn.jsx)(ym,{pageId:i,pageContext:{},autoFocus:!0,autocompletionEnabled:!1,typedHistoryEnabled:!1,className:"address",displayUrl:"",typedUrl:r,handleDrop:!0,title:(0,W.Z)("Enter page address"),placeholder:"https://vivaldi.com",inputId:i}),(0,zn.jsx)("span",{children:(0,W.Z)("Title")}),(0,zn.jsx)("input",{type:"text",name:"title",className:"title",value:a,onChange:e=>o(e.currentTarget.value)}),(0,zn.jsxs)("span",{className:"controls",children:[(0,zn.jsx)("input",{className:"add-dial-submit primary",type:"submit",disabled:!d,value:(0,W.Z)("Add")}),(0,zn.jsx)("button",{type:"button",className:"FormButton",onClick:t=>{if(e){const t={parentId:e.id,title:a||(0,W.Z)("title","New Folder")};s(t)}},dangerouslySetInnerHTML:{__html:Kn._TQ.small+(0,W.Z)("command","New Folder")}})]})]})]}),!h&&(0,zn.jsx)(JY,{onSpeedDialDrawerDone:s,keyAccess:t,nodeId:e?.id,nodeLinks:m}),!h&&(0,zn.jsx)(qY,{popularSites:n,categoryOverride:0,onSetCategory:u,addSpeedDial:p,nodeLinks:m}),(0,zn.jsx)(qY,{popularSites:n,onSetCategory:u,addSpeedDial:p,nodeLinks:m})]})},tX=[Z.kDashboardColumnLimit,Z.kDashboardEnabled,Z.kStartpageNavigation,Z.kStartpageSpeedDialAddButtonVisible,Z.kStartpageSpeedDialColumns,Z.kStartpageSpeedDialDeleteVisible,Z.kStartpageSpeedDialDisplaySearch,Z.kStartpageSpeedDialGameButtonShow,Z.kStartpageSpeedDialPrivacyStatsShow,Z.kStartpageSpeedDialRestorePage,Z.kStartpageSpeedDialSize,Z.kStartpageSpeedDialTitlesVisible,Z.kThemesSystem,Z.kThemesUser],sX={...eW,"":(0,W.Z)("Solid Color")};var nX=(0,zn.jsx)(aa,{type:"close",size:16}),iX=(0,zn.jsx)(aa,{type:"checkmark"}),aX=(0,zn.jsx)("hr",{}),oX=(0,zn.jsx)("hr",{}),rX=(0,zn.jsx)("option",{value:1,children:"1"}),lX=(0,zn.jsx)("option",{value:2,children:"2"}),dX=(0,zn.jsx)("option",{value:3,children:"3"}),cX=(0,zn.jsx)("option",{value:4,children:"4"}),hX=(0,zn.jsx)("option",{value:5,children:"5"}),uX=(0,zn.jsx)("option",{value:6,children:"6"}),pX=(0,zn.jsx)("option",{value:7,children:"7"}),gX=(0,zn.jsx)("option",{value:8,children:"8"}),mX=(0,zn.jsx)("option",{value:10,children:"10"}),fX=(0,zn.jsx)("option",{value:12,children:"12"}),vX=(0,zn.jsx)("hr",{}),bX=(0,zn.jsx)("option",{value:1,children:"1"}),CX=(0,zn.jsx)("option",{value:2,children:"2"}),wX=(0,zn.jsx)("option",{value:3,children:"3"}),yX=(0,zn.jsx)("option",{value:4,children:"4"}),xX=(0,zn.jsx)(aa,{size:16,type:"settings"});function IX(e){const t=(0,Eo.Z)(tX),{vivaldiWindowId:s}=Un.useContext(oi.Z),n=I.Z.getEventHandler,[i,a]=Un.useState(!!e.startOpened),[o,r]=Un.useState(sX),[l,d]=Un.useState(On.Z.getCurrentIdWithoutPreview(s)),[h,u]=Un.useState(Si.ZP.getThemeWithFallback(l)),[p,g]=Un.useState(!1);Un.useEffect((()=>{function e(){const e=On.Z.getCurrentIdWithoutPreview(s);d(e),u(Si.ZP.getThemeWithFallback(e))}return Ue.Z.addListener(e),()=>Ue.Z.removeListener(e)}),[s]),Un.useEffect((()=>{const e=t[Z.kThemesSystem].concat(t[Z.kThemesUser]).reduce(((e,t)=>{const s=t.backgroundImage,n=[...Object.keys(e),...Object.keys(sX)];return s&&!n.includes(s)&&s!==XF&&(e[s]=(0,W.Z)("From $1",[t.name])),e}),{});r({...sX,...e})}),[t]),Un.useEffect((()=>{const e=()=>a(!1);return i&&Qe.Z.bind("esc",e),()=>{Qe.Z.unbind("esc",e)}}),[i]),Un.useEffect((()=>{(0,Ev.pg)("tracking",(e=>{e.trackerBlockingEnabled&&g(!0)})),(0,Ev.pg)("ad_blocking",(e=>{e.adBlockingEnabled&&g(!0)}))}),[]);const m=e=>{const t=function(e){return Si.ZP.getSystemThemes().some((t=>t.id===e))?Z.kThemesSystem:Z.kThemesUser}(l);(0,Fo.kz)(t,(t=>{const s=t.findIndex((e=>e.id===l));-1!==s&&(t[s].backgroundImage=e)}))};return(0,zn.jsxs)(zn.Fragment,{children:[i&&(0,zn.jsx)(Zo.Z,{focusName:"focus-speeddial-settings",children:(0,zn.jsxs)("div",{className:Gn()("SpeedDialView-Settings",{"navigation-title":"off"!==A.Z.get(Z.kStartpageNavigation)}),onDoubleClick:wi.ZP,role:"dialog","aria-labelledby":"speeddial-settings-title",id:"speeddial-settings-pane",children:[(0,zn.jsxs)("div",{className:"SpeedDialView-Settings-Head",children:[(0,zn.jsx)("h1",{id:"speeddial-settings-title",children:(0,W.Z)("Quick Settings")}),(0,zn.jsx)("button",{className:"close",onClick:()=>a(!1),label:(0,W.Z)("Close"),tabIndex:A.Z.get(Z.kKeyboardTabToAll),children:nX})]}),(0,zn.jsxs)("div",{className:"SpeedDialView-Settings-BackgroundImages",children:[(0,zn.jsx)("h2",{children:(0,W.Z)("Background Images")}),(0,zn.jsx)("div",{className:"images",children:Object.keys(o).sort().map((e=>(0,zn.jsxs)("button",{title:o[e],className:Gn()("selectbox",{"selectbox-selected":e===h.backgroundImage}),onClick:()=>m(e),children:[(0,zn.jsx)("div",{className:"selectbox-image",style:{backgroundColor:""===e?h.colorWindowBg:void 0,backgroundImage:`url(${e})`},children:iX}),""===e&&(0,zn.jsx)("div",{className:"selectbox-label",children:o[""]})]},e)))}),(0,zn.jsxs)("div",{className:"actions",children:[(0,zn.jsx)("a",{href:"https://themes.vivaldi.net",onClick:()=>c.ZP.openURL(s,"https://themes.vivaldi.net"),children:(0,W.Z)("Get More Background Images")}),(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Select Image..."),title:(0,W.Z)("Select Background Image"),onClick:()=>{re.Z.utilities.selectLocalImage({title:(0,W.Z)("Select Background Image"),themeId:l,windowId:s})}})]})]}),aX,(0,zn.jsxs)("div",{className:"SpeedDialView-Settings-StartPage",children:[(0,zn.jsx)("h2",{children:(0,W.Z)("title","Start Page")}),(0,zn.jsxs)("div",{className:"row",children:[(0,zn.jsx)("label",{htmlFor:"navigationToggle",children:(0,W.Z)("Start Page Navigation")}),(0,zn.jsxs)(Fa.Z,{id:"navigationToggle",value:t[Z.kStartpageNavigation],onChange:n(Z.kStartpageNavigation),children:[(0,zn.jsx)("option",{value:"on",children:(0,W.Z)("Show on Internal Pages")}),(0,zn.jsx)("option",{value:"speed_dial_only",children:(0,W.Z)("Show on Speed Dial and Dashboard")}),(0,zn.jsx)("option",{value:"off",children:(0,W.Z)("radio","Hide")})]})]}),(0,zn.jsxs)("div",{className:"row",children:[(0,zn.jsx)("label",{htmlFor:"privacyStatsToggle",children:(0,W.Z)("Reopen Speed Dial with Last Selected Group")}),(0,zn.jsx)(vE,{inputId:"privacyStatsToggle",checked:t[Z.kStartpageSpeedDialRestorePage],onChange:n(Z.kStartpageSpeedDialRestorePage)})]}),(0,zn.jsxs)("div",{className:"row",children:[(0,zn.jsx)("label",{htmlFor:"searchFieldToggle",children:(0,W.Z)("Search Field")}),(0,zn.jsx)(vE,{inputId:"searchFieldToggle",checked:t[Z.kStartpageSpeedDialDisplaySearch],onChange:n(Z.kStartpageSpeedDialDisplaySearch)})]}),p&&(0,zn.jsxs)("div",{className:"row",children:[(0,zn.jsx)("label",{htmlFor:"privacyStatsToggle",children:(0,W.Z)("Privacy Statistics")}),(0,zn.jsx)(vE,{inputId:"privacyStatsToggle",checked:t[Z.kStartpageSpeedDialPrivacyStatsShow],onChange:n(Z.kStartpageSpeedDialPrivacyStatsShow)})]}),(0,zn.jsxs)("div",{className:"row",children:[(0,zn.jsx)("label",{htmlFor:"gameToggle",children:(0,W.Z)("Vivaldia Game")}),(0,zn.jsx)(vE,{inputId:"gameToggle",checked:t[Z.kStartpageSpeedDialGameButtonShow],onChange:n(Z.kStartpageSpeedDialGameButtonShow)})]})]}),oX,(0,zn.jsxs)("div",{className:"SpeedDialView-Settings-Appearance",children:[(0,zn.jsx)("h2",{children:(0,W.Z)("Speed Dial Appearance")}),(0,zn.jsxs)("div",{className:"row",children:[(0,zn.jsx)("label",{className:"dropdown",htmlFor:"thumbnailSelect",children:(0,W.Z)("Thumbnail Size")}),(0,zn.jsx)(Fa.Z,{id:"thumbnailSelect",value:t[Z.kStartpageSpeedDialSize],onChange:n(Z.kStartpageSpeedDialSize),children:Array.from(gL).map((([e,{label:t}])=>(0,zn.jsx)("option",{value:e,children:t},e)))})]}),(0,zn.jsxs)("div",{className:"row",children:[(0,zn.jsx)("label",{className:"dropdown",htmlFor:"maxColumnSelect",children:(0,W.Z)("Maximum Columns")}),(0,zn.jsxs)(Fa.Z,{id:"maxColumnSelect",value:t[Z.kStartpageSpeedDialColumns],onChange:n(Z.kStartpageSpeedDialColumns),title:(0,W.Z)("Maximum number of Speed Dial columns"),children:[rX,lX,dX,cX,hX,uX,pX,gX,mX,fX,(0,zn.jsx)("option",{value:99,children:(0,W.Z)("Unlimited")})]})]}),(0,zn.jsxs)("div",{className:"row",children:[(0,zn.jsx)("label",{className:"dropdown",htmlFor:"titleSelect",children:(0,W.Z)("Speed Dial Title")}),(0,zn.jsxs)(Fa.Z,{id:"titleSelect",value:t[Z.kStartpageSpeedDialTitlesVisible],onChange:n(Z.kStartpageSpeedDialTitlesVisible),children:[(0,zn.jsx)("option",{value:"always",children:(0,W.Z)("verb","Show")}),(0,zn.jsx)("option",{value:"hover",children:(0,W.Z)("Show on Hover")}),(0,zn.jsx)("option",{value:"never",children:(0,W.Z)("verb","Hide")})]})]}),(0,zn.jsxs)("div",{className:"row",children:[(0,zn.jsx)("label",{htmlFor:"addButtonToggle",children:(0,W.Z)("Show Add Button")}),(0,zn.jsx)(vE,{inputId:"addButtonToggle",checked:t[Z.kStartpageSpeedDialAddButtonVisible],onChange:n(Z.kStartpageSpeedDialAddButtonVisible)})]}),(0,zn.jsxs)("div",{className:"row",children:[(0,zn.jsx)("label",{htmlFor:"deleteButtonToggle",children:(0,W.Z)("Show Delete Button")}),(0,zn.jsx)(vE,{inputId:"deleteButtonToggle",checked:t[Z.kStartpageSpeedDialDeleteVisible],onChange:n(Z.kStartpageSpeedDialDeleteVisible)})]})]}),vX,(0,zn.jsxs)("div",{className:"SpeedDialView-Settings-Dashboard",children:[(0,zn.jsx)("h2",{children:(0,W.Z)("Dashboard")}),(0,zn.jsxs)("div",{className:"row",children:[(0,zn.jsx)("label",{htmlFor:"dashboardToggle",children:(0,W.Z)("Enable Dashboard")}),(0,zn.jsx)(vE,{inputId:"dashboardToggle",checked:t[Z.kDashboardEnabled],onChange:E})]}),(0,zn.jsxs)("div",{className:"row",children:[(0,zn.jsx)("label",{htmlFor:"dashboardColumns",children:(0,W.Z)("Maximum Columns")}),(0,zn.jsxs)(Fa.Z,{id:"dashboardColumns",className:"max-columns",value:t[Z.kDashboardColumnLimit],onChange:n(Z.kDashboardColumnLimit),title:(0,W.Z)("Maximum number of Dashboard columns"),children:[bX,CX,wX,yX]})]})]}),(0,zn.jsx)("div",{className:"toolbar toolbar-default SpeedDial-Show-Settings",children:(0,zn.jsx)(oa.ZP,{label:(0,W.Z)("Start Page Settings"),title:(0,W.Z)("Open Start Page Settings"),onClick:()=>{ue.Z.showSettings(s,"startpage"),a(!1)},image:Kn.bqs.small,className:"button-show-setting",tabIndex:-1})})]})}),(0,zn.jsx)("button",{className:"SpeedDialView-Settings-Button",onClick:()=>a(!0),title:(0,W.Z)("Show Start Page Settings"),label:(0,W.Z)("Start Page Settings"),"aria-expanded":i,"aria-haspopup":"dialog","aria-controls":"speeddial-settings-pane",tabIndex:A.Z.get(Z.kKeyboardTabToAll),children:xX})]})}const AX={click:function(){},repeat:function(e=2){}},SX=AX;var ZX=s(34844);function TX(e,t){const{children:s=[]}=e,n=[];for(let i=0;i<Math.min(s.length,4);i++){const a=s[i];n.push((0,zn.jsx)(_V,{src:a.thumbnail?a.thumbnail:"",className:"Mini-Thumbnail",onImageLoadError:t,isFolder:!!a.children},`thumb__${e.id}__${i}`))}return n}var EX=(0,zn.jsx)(_V,{src:"",className:"thumbnail-folder-image",isFolder:!0});function kX(e){const{bookmark:t}=e,s=Array.isArray(t.children)&&0===t.children.length,n=Boolean(t.thumbnail),i=!s&&!n;return(0,zn.jsxs)("div",{className:Gn()("thumbnail-image",{"drop-hover":e.canDrop,"thumbnail-image-preview":i}),title:t.url,onPointerEnter:e.onPointerEnter,onPointerLeave:e.onPointerLeave,onPointerDown:e.onPointerDown,onPointerUp:e.onPointerUp,onPointerCancel:e.onPointerCancel,onDoubleClick:wi.ZP,onDragOver:e.onDragOver,onDragLeave:e.onDragLeave,onDrop:e.onDrop,children:[s&&!n&&EX,i&&(0,zn.jsx)("div",{className:"preview",children:TX(t,e.onImageLoadError)}),n&&(0,zn.jsx)(_V,{className:"thumbnail-folder-image",src:t.thumbnail,onImageLoadError:e.onImageLoadError})]},t.id)}function NX(e,t=[]){const s=[];for(let n=0;n<Math.min(t.length,4);n++){const i=t[n],{url:a=""}=i;s.push((0,zn.jsx)(Vn.ZP,{className:"favicon",url:i.faviconUrl||vs.jk.getFavicon(a)||a,loadType:i.faviconUrl?"faviconFromCache":"page"},`thumb__${e}__${n}`))}return s}var _X=(0,zn.jsx)(_V,{src:"",isFolder:!0});function PX(e){const{bookmark:t}=e,s=Boolean(t.children);return"icon"===e.speedDialSize?s?(0,zn.jsx)("div",{className:Gn()("thumbnail-favicon-folder",{"drop-hover":e.canDrop}),title:t.url,onPointerEnter:e.onPointerEnter,onPointerLeave:e.onPointerLeave,onPointerDown:e.onPointerDown,onPointerUp:e.onPointerUp,onPointerCancel:e.onPointerCancel,onDoubleClick:wi.ZP,onDragOver:e.onDragOver,onDragLeave:e.onDragLeave,onDrop:e.onDrop,children:t.children&&0===t.children.length?_X:NX(t.id,t.children)},t.id):(0,zn.jsx)("div",{className:"thumbnail-favicon",onPointerEnter:e.onPointerEnter,onPointerLeave:e.onPointerLeave,onPointerDown:e.onPointerDown,onPointerUp:e.onPointerUp,children:(0,zn.jsx)(Vn.ZP,{className:"favicon",url:e.faviconUrl,loadType:e.faviconLoadType,size:32})}):s?(0,zn.jsx)(kX,{bookmark:t,canDrop:e.canDrop,onPointerEnter:e.onPointerEnter,onPointerLeave:e.onPointerLeave,onPointerDown:e.onPointerDown,onPointerUp:e.onPointerUp,onImageLoadError:e.onImageLoadError,onPointerCancel:e.onPointerCancel,onDragOver:e.onDragOver,onDragLeave:e.onDragLeave,onDrop:e.onDrop}):(0,zn.jsx)(_V,{onPointerEnter:e.onPointerEnter,onPointerLeave:e.onPointerLeave,onPointerDown:e.onPointerDown,onPointerUp:e.onPointerUp,src:t.thumbnail,title:t.title?t.title:t.url?re.Z.utilities.urlToThumbnailText(t.url):"",backgroundColor:t.themeColor||void 0,onImageLoadError:e.onImageLoadError},t.id)}var MX=s(34155);class DX extends Un.PureComponent{static contextType=oi.Z;bookmarkActions=this.props.bookmarkActions||ne.Z;nodeRef=Un.createRef();refInput=Un.createRef();state={isEditing:this.props.needsInitialEdit,title:this.props.bookmark.title,fallbackTitle:this.props.bookmark.title};componentDidMount(){this.state.isEditing&&this._focusInput()}componentDidUpdate(e,t){!1===e.needsInitialEdit&&!0===this.props.needsInitialEdit&&!1===this.state.isEditing&&this.enableEditing(),!1===t.isEditing&&!0===this.state.isEditing&&this._focusInput()}_documentClickHandler=e=>{const t=this.nodeRef.current,s=e.target,{document:n,HTMLElement:i}=this.context;t&&s instanceof i&&!t.contains(s)?this.refInput.current?.blur():n.removeEventListener("click",this._documentClickHandler)};_focusInput(){const e=this.refInput.current,t=e?.value;e&&t&&(e.setSelectionRange(0,t.length),e.focus())}enableEditing(){if(!1===this.state.isEditing&&this.props.bookmark.id!==b.N4){const{document:e}=this.context;e.addEventListener("click",this._documentClickHandler),this.setState({isEditing:!0})}}isTopSite(){return g.Z.isTopSite(this.props.bookmark.id)}handleClick=e=>{(0,wi.ZP)(e),"click"!==this.props.howToEdit?this.props.onSelect&&this.props.onSelect(e):MX.nextTick((()=>this.enableEditing()))};handleDoubleClick=e=>{"doubleClick"===this.props.howToEdit&&this.enableEditing()};finishEdit(e){if(!1===this.state.isEditing)return;const{document:t}=this.context;t.removeEventListener("click",this._documentClickHandler),this.props.needsInitialEdit&&this.props.setSpeedDialAwaitingEdit("");const s=this.props.bookmark.id;switch(e){case"save":this.setState({isEditing:!1},(()=>{n.Z.bookmarks.update(s,{title:this.state.title}).then((()=>{this.props.onFinished&&this.props.onFinished(!1)}))}));break;case"undo":this.setState((e=>({title:e.fallbackTitle,isEditing:!1})),(()=>{n.Z.bookmarks.update(s,{title:this.state.title}).then((()=>{this.props.onFinished&&this.props.onFinished(!1)}))}));break;case"delete":this.setState({isEditing:!1},(()=>{this.props.onFinished&&this.props.onFinished(!0),this.bookmarkActions.remove([s])}))}}handleBlur=e=>{this.finishEdit("save")};handleChange=e=>{const t=e.target.value;this.setState({title:t})};handleKeyDown=e=>{switch(e.stopPropagation(),e.key){case"Enter":this.finishEdit("save");break;case"Escape":{const e=this.props.bookmark.children??[];this.props.needsInitialEdit&&this.state.title===g.Z.getDefaultFolderName()&&0===e.length?this.finishEdit("delete"):this.finishEdit("undo");break}}};removeSpeedDial=()=>{const e=g.Z.getItemById(this.props.bookmark.id);e&&ne.Z.removeSpeeddialGroup(e)};onContextMenu=e=>{this.state.isEditing?e.stopPropagation():(e.persist(),e.preventDefault(),e.stopPropagation(),this.props.getContextMenuItemsPromise(this.props.bookmark).then((t=>{(0,mi.Z)(this.context,t)(e)})))};render(){const e=Gn()({"editable-title-container":!0,edit:this.state.isEditing});return(0,zn.jsx)("span",{ref:this.nodeRef,className:e,onBlur:wi.UW,onFocus:wi.UW,onContextMenu:this.onContextMenu,draggable:!this.state.isEditing&&(this.props.draggable??!1),onDragEnter:this.props.onDragEnter??nr.Z,onDragOver:this.props.onDragOver??nr.Z,onDragStart:this.props.onDragStart??nr.Z,onDragEnd:this.props.onDragEnd??nr.Z,onDrop:this.props.onDrop??nr.Z,children:this.state.isEditing?(0,zn.jsx)("input",{type:"text",ref:this.refInput,className:"sd-title-editor",value:this.state.title,onBlur:this.handleBlur,style:this.props.style,onKeyDown:this.handleKeyDown,onPointerUp:wi.ZP,onChange:this.handleChange,autoFocus:!0}):(0,zn.jsx)("button",{className:this.props.className,"data-id":this.props.bookmark.id,tabIndex:this.props.keyAccess,onClick:this.handleClick,onDoubleClick:this.handleDoubleClick,onPointerUp:wi.ZP,title:this.props.bookmark.title||this.props.bookmark.url,onKeyDown:this.props.onKeyDown?this.props.onKeyDown.bind(this,this.props.bookmark.id):void 0,children:this.props.bookmark.title||(this.props.bookmark.url?this.props.bookmark.url.substring((0,Ar.Df)(this.props.bookmark.url)):"")})})}}const OX=DX;var jX=s(34155);const LX=new Set;var RX=(0,zn.jsx)(qn,{rightMargin:0,className:"favicon"});class BX extends Un.PureComponent{static contextType=oi.Z;nodeRef=Un.createRef();refTitle=Un.createRef();focusedElement=null;_hasClipboardListener=!1;_customThumbnail=!1;state={canDrop:!1,isHovered:!1};componentWillUnmount(){this.disableClipboardListener(),Ma.unlinkBookmarkComponent(this)}componentDidUpdate(e){this.props.highlight&&!e.highlight&&SX.click()}isFolder(){return!this.props.node.url}isBookmark(){return!this.isFolder()}handleRemoveDial=()=>{const e=(0,vo.sT)(this.context.document,this.nodeRef.current)?this.props.getNextFocusable(this.props.node.id):"";this.props.bookmarkActions.remove([this.props.node.id]).then((()=>{e&&this.props.moveFocus(e,"current")}))};enableClipboardListener=()=>{if(this._hasClipboardListener)return;this._hasClipboardListener=!0;const{document:e}=this.context;e.addEventListener("cut",this.onCut),e.addEventListener("copy",this.onCopy),e.addEventListener("paste",this.onPaste)};disableClipboardListener=()=>{if(!this._hasClipboardListener)return;this._hasClipboardListener=!1;const{document:e}=this.context;e.removeEventListener("cut",this.onCut),e.removeEventListener("copy",this.onCopy),e.removeEventListener("paste",this.onPaste)};handleCutDial=()=>{const{document:e}=this.context,t=this._hasClipboardListener;t||e.addEventListener("cut",this.onCut),e.execCommand("cut"),t||e.removeEventListener("cut",this.onCut)};handleCopyDial=()=>{const{document:e}=this.context,t=this._hasClipboardListener;t||e.addEventListener("copy",this.onCopy),e.execCommand("copy"),t||e.removeEventListener("copy",this.onCopy)};handlePasteDial=()=>{const{document:e}=this.context,t=this._hasClipboardListener;t||e.addEventListener("paste",this.onPaste),e.execCommand("paste"),t||e.removeEventListener("paste",this.onPaste)};handleRename=()=>{this.refTitle.current?.enableEditing()};onRenameFinished=e=>{e?jX.nextTick((()=>{this.props.moveFocus("add","current")})):this.props.moveFocus(this.props.node.id,"current")};handleEdit=()=>{ue.Z.showBookmarkDialog(this.context.vivaldiWindowId,{mode:"edit",id:this.props.node.id,index:-1})};handleUpdateThumbnail=()=>{this.props.node.url&&Ma.updateForBookmark(this.props.node.id,this.props.node.url)};handleSetCustomThumbnail=()=>{re.Z.utilities.selectLocalImage({windowId:this.context.vivaldiWindowId,title:(0,W.Z)("Select Custom Image"),thumbnailBookmarkId:this.props.node.id})};handleClearCustomThumbnail=()=>{this.props.bookmarkActions.update(this.props.node.id,{thumbnail:""})};onThumbnailImageLoadError=e=>{e&&!(0,Ar.Li)(e)&&re.Z.bookmarksPrivate.isCustomThumbnail(this.props.node.id,(t=>{e===this.props.node.thumbnail&&(t||LX.has(e)||(LX.add(e),this.props.node.url&&Ma.updateForBookmark(this.props.node.id,this.props.node.url)))}))};openSpeedDialNodeHandler=e=>{const t=this.context.vivaldiWindowId,s=(0,fo.wJ)(t,e);e.button,ai.Z.kCenter,s&&s.inNewWindow?Wn.Z.openBrowserWindow(t,this.props.node.url,{incognito:!1,transition:re.Z.historyPrivate.TransitionType.AUTO_BOOKMARK}):void 0!==s&&(e.stopPropagation(),this.openSpeedDialNode(this.props.node,{openInBackground:s.inBackground,openInNewTab:!s.inCurrent}),h.Z.clearStatus(t))};openSpeedDialNode=(e,t)=>{this.props.openSpeedDialNode(e,t)};handleThumbnailPointerEnter=()=>{const{node:e}=this.props,{children:t}=e,s=t?(0,W.Z)("$1 Folder",[e.title||""]):e?vs.jk.getHoverUrl(g.Z.getUrlByNode(e)):"";h.Z.setStatus(this.context.vivaldiWindowId,s)};handleThumbnailPointerLeave=()=>{h.Z.clearStatus(this.context.vivaldiWindowId)};handlePointerEnter=e=>{this.setState({isHovered:!0})};handlePointerLeave=e=>{this.setState({isHovered:!1})};dialPointerDownHandler=e=>{this.props.onPointerDown(this.props.node,e)};pointerDownHandler=e=>{e.button,ai.Z.kCenter,e.button!==ai.Z.kLeft&&e.preventDefault(),re.Z.bookmarksPrivate.isCustomThumbnail(this.props.node.id,(e=>{this._customThumbnail=e}))};pointerUpHandler=e=>{this.props.lastPress===this.props.node.id&&(this.openSpeedDialNodeHandler(e),this.focusedElement&&this.context.requestAnimationFrame((()=>{this.focusedElement?.focus(),this.focusedElement=null})))};keyDownHandler=e=>{const t=(0,vi.Z)(e);switch(e.key){case" ":case"Enter":this.openSpeedDialNodeHandler(e);break;case"F2":this.handleRename();break;case"ArrowLeft":if(t||!this.props.moveFocus(this.props.node.id,"left"))return;break;case"ArrowRight":if(t||!this.props.moveFocus(this.props.node.id,"right"))return;break;case"ArrowUp":if(!this.props.moveFocus(this.props.node.id,"up"))return;break;case"ArrowDown":if(!this.props.moveFocus(this.props.node.id,"down"))return;break;default:return}(0,wi.ZP)(e)};getContextMenuItems=(e,t)=>{const s=this.context.vivaldiWindowId,n=ei.Z.getOptionFunction(e),i="always"===this.props.titleVisibility,a={};return ei.Z.getNamedMenu(s,e,(async e=>{switch(e.action){case"CONTEXT_OPEN_IN_NEW_TAB":return{handler:this.openSpeedDialNode.bind(this,t,{openInNewTab:!0,openInBackground:this.props.openTabsInBackground}),isVisible:()=>this.isBookmark(),...n(s,e,a)};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{handler:this.openSpeedDialNode.bind(this,t,{openInNewTab:!0,openInBackground:!0}),isVisible:()=>this.isBookmark()&&!this.props.openTabsInBackground,...n(s,e,a)};case"CONTEXT_OPEN_IN_TAB":return{handler:()=>this.openSpeedDialNode(t),isVisible:()=>this.isBookmark(),...n(s,e,a)};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{handler:this.openSpeedDialNode.bind(this,t,{openInNewWindow:!0}),isVisible:()=>this.isBookmark(),...n(s,e,a)};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{handler:this.openSpeedDialNode.bind(this,t,{openInNewWindow:!0,incognito:!0}),isVisible:()=>this.isBookmark(),...n(s,e,a)};case"CONTEXT_CONTAINER_OPEN_IN_WINDOW":{const i=await ro.getMenu(s,!0,[t.url||""]);return{isVisible:()=>this.isBookmark()&&i.length>0,items:i,...n(s,e,a)}}case"CONTEXT_OPEN_ALL":return{handler:this.openSpeedDialNode.bind(this,t,{openInBackground:!0}),isVisible:()=>this.isFolder(),...n(s,e,a)};case"CONTEXT_SET_THUMBNAIL":return{handler:this.handleSetCustomThumbnail,isVisible:()=>(this.isBookmark()||this.isFolder())&&!this.props.incognito,...n(s,e,a)};case"CONTEXT_CLEAR_THUMBNAIL":return{handler:this.handleClearCustomThumbnail,isVisible:()=>this._customThumbnail,...n(s,e,a)};case"CONTEXT_RELOAD":return{handler:this.handleUpdateThumbnail,isVisible:()=>(this.isBookmark()||this.isFolder())&&!this.props.incognito,...n(s,e,a)};case"CONTEXT_EDIT":return{handler:this.handleEdit,...n(s,e,a)};case"CONTEXT_RENAME":return{handler:this.handleRename,isVisible:()=>i,...n(s,e,a)};case"CONTEXT_CUT":return{handler:this.handleCutDial,...n(s,e,a)};case"CONTEXT_COPY":return{handler:this.handleCopyDial,...n(s,e,a)};case"CONTEXT_PASTE":return{handler:this.handlePasteDial,...n(s,e,a)};case"CONTEXT_DELETE":return{handler:this.handleRemoveDial,...n(s,e,a)};default:return{...n(s,e,a)}}}))};handleContextMenu=e=>{const t=this.props.node;e.persist(),(0,wi.ZP)(e),this.getContextMenuItems("speeddialitem",t).then((t=>{(0,mi.Z)(this.context,t)(e)}))};onDragOver=e=>{e.dataTransfer.types.some((e=>Jn.ZP.isUriListType(e)||"text/plain"===e||e===Jn.yR))&&((0,wi.ZP)(e),e.dataTransfer.dropEffect=Jn.ZP.isCopyModifierPressed(e)?"copy":"move",this.setState({canDrop:!0}))};onDragLeave=e=>{this.state.canDrop&&this.setState({canDrop:!1})};onDrop=e=>{(0,wi.ZP)(e),this.props.bookmarkActions.onDropEvent(e,this.props.node.id,0),this.setState({canDrop:!1})};onCut=e=>{this.props.bookmarkActions.cut(e,[this.props.node.id]),(0,wi.ZP)(e)};onCopy=e=>{this.props.bookmarkActions.copy(e,[this.props.node.id]),(0,wi.ZP)(e)};onPaste=e=>{this.props.bookmarkActions.paste(e,this.props.node.id),(0,wi.ZP)(e)};getContextMenuItemsPromise=e=>this.getContextMenuItems("speeddialitem",e);getTitleStyle=Ci()((e=>e?{}:{textAlign:"center"}));render(){const{node:e,showFavicon:t,titleVisibility:s,deleteVisible:n,controlsVisible:i}=this.props,{children:a,url:o=""}=e,r=Ma.linkAndQueryUpdatingBookmark(this,e.id),l=e.faviconUrl||vs.jk.getFavicon(o)||o,d=e.faviconUrl?"faviconFromCache":o.startsWith(vs.LA)&&(0,vs.i8)(o)?"faviconSkipCache":"page",c="never"!==s,h=c?45:10,u="never"===s||"hover"===s&&!this.state.isHovered?{"aria-label":e.title}:{};return(0,zn.jsxs)("div",{ref:this.nodeRef,tabIndex:this.props.keyAccess,onPointerDown:this.dialPointerDownHandler,className:Gn()("draggable","SpeedDial",`SpeedDial--${this.props.tileSize}`,{"SpeedDial--Thumbnail":"Icon"!==this.props.tileSize,dragging:this.props.dragging,dragover:this.props.highlight,folder:Boolean(a),isCut:this.props.isCut}),style:this.props.style,"data-id":e.id,onContextMenu:this.handleContextMenu,onBlur:this.disableClipboardListener,onFocus:this.enableClipboardListener,onKeyDown:this.keyDownHandler,onPointerEnter:this.handlePointerEnter,onPointerLeave:this.handlePointerLeave,onDoubleClick:wi.ZP,role:"link",...u,children:[(0,zn.jsx)(PX,{bookmark:e,canDrop:this.state.canDrop,faviconUrl:l,faviconLoadType:d,onPointerEnter:this.handleThumbnailPointerEnter,onPointerLeave:this.handleThumbnailPointerLeave,onPointerDown:this.pointerDownHandler,onPointerUp:this.pointerUpHandler,onImageLoadError:this.onThumbnailImageLoadError,onPointerCancel:this.pointerUpHandler,onDragOver:this.onDragOver,onDragLeave:this.onDragLeave,onDrop:this.onDrop,speedDialSize:this.props.size}),e.url&&i&&(0,zn.jsxs)("div",{className:"thumb-controls",style:{bottom:h},children:[!this.props.incognito&&(0,zn.jsx)("button",{tabIndex:"-1",onClick:this.handleUpdateThumbnail,className:Gn()("circular","update-thumbnail",{updating:r}),disabled:r,title:(0,W.Z)("Update thumbnail"),dangerouslySetInnerHTML:{__html:Kn.GO5.medium}}),(0,zn.jsx)("button",{tabIndex:"-1",onClick:this.handleSetCustomThumbnail,className:"circular set-custom-thumbnail",title:(0,W.Z)("Select custom thumbnail"),dangerouslySetInnerHTML:{__html:Kn.md4.medium}})]}),n&&(0,zn.jsx)("button",{tabIndex:"-1",onClick:this.handleRemoveDial,disabled:!this.state.isHovered,title:(0,W.Z)("other","Delete"),className:"close circular",dangerouslySetInnerHTML:{__html:Kn.M2k.medium}}),c&&(0,zn.jsxs)("div",{className:Gn()("thumbnail-title",{hidden:"hover"===s}),onPointerUp:this.pointerUpHandler,children:[t&&!a&&(0,zn.jsx)(Vn.ZP,{className:"favicon",url:l,loadType:d}),t&&a&&RX,(0,zn.jsx)(OX,{ref:this.refTitle,bookmark:e,bookmarkActions:this.props.bookmarkActions,className:"button-title",getContextMenuItemsPromise:this.getContextMenuItemsPromise,howToEdit:"doubleClick",keyAccess:-1,needsInitialEdit:this.props.awaitingInitialEditId===e.id,onSelect:this.pointerUpHandler,setSpeedDialAwaitingEdit:this.props.setSpeedDialAwaitingEdit,style:this.getTitleStyle(t),onFinished:this.onRenameFinished,titleMargin:this.props.titleMargin})]})]})}}const FX=BX;var WX=(0,zn.jsx)(aa,{className:"Blocker-Shield-Blocking",type:"blocker-shield",size:16}),UX=(0,zn.jsx)(aa,{className:"Info-Icon",type:"info",size:16});class VX extends Un.PureComponent{static contextType=oi.Z;state={totalAdBlocked:0,totalTrackerBlocked:0};componentDidMount(){re.Z.contentBlocking.getAdBlockingStats(this.setAdBlockingStats)}setAdBlockingStats=(e,t,s,n,i)=>{this.setState({totalAdBlocked:t,totalTrackerBlocked:s})};formatPrivacyDataNumber(e){return e.split(/(\d+)/).map(((e,t)=>/\d/.test(e)?(0,zn.jsx)("strong",{children:(0,F.uf)(e)},t):e))}render(){const{totalAdBlocked:e,totalTrackerBlocked:t}=this.state;return(0,zn.jsx)("div",{className:"SpeedDial-Blocked-Counter",onClick:()=>ue.Z.showPrivacyStatsDialog(this.context.vivaldiWindowId),onDoubleClick:wi.ZP,children:(0,zn.jsxs)("div",{className:"SpeedDial-Blocked-Counter-Container",children:[WX,(0,zn.jsxs)("p",{className:"Blocked-Info",children:[this.formatPrivacyDataNumber((0,W.Z)("$1 tracker and","$1 trackers and",[t]))," ",this.formatPrivacyDataNumber((0,W.Z)("$1 ad blocked","$1 ads blocked",[e]))]}),UX]})})}}const HX=[Z.kAddressBarSearchSuggestEnabled,Z.kThemeUseAnimation,Z.kStartpageSpeedDialAddButtonVisible,Z.kStartpageSpeedDialAllowDnd,Z.kStartpageSpeedDialColumns,Z.kStartpageSpeedDialControlsVisible,Z.kStartpageSpeedDialDeleteVisible,Z.kStartpageSpeedDialFaviconVisible,Z.kStartpageSpeedDialTitlesVisible,Z.kStartpageSpeedDialSize,Z.kTabsOpenNewInBackground,Z.kStartpageNavigation,Z.kStartpageSpeedDialDisplaySearch,Z.kStartpageSpeedDialGameButtonShow,Z.kStartpageSpeedDialOrder,Z.kStartpageSpeedDialPrivacyStatsShow,Z.kThemesSystem,Z.kThemesUser,Z.kStartpageSpeedDialTrackerSuggestionShow,Z.kAddressBarSearchKeepSelected];function GX(e,t){const s=Array(e);for(let n=0;n<e;n++)s[n]=t(n);return s}let KX=null;var zX=(0,zn.jsx)(VX,{});class $X extends Un.PureComponent{static contextType=oi.Z;animate=!1;dragStartX=0;dragStartY=0;dragDialStartPos=[0,0];refSpeedDial=Un.createRef();refParentFolderButton=Un.createRef();refSpeedDialDefaultSearchEngine=Un.createRef();constructor(e){super(e),this.state={dialNodes:[],pressed:"none",lastPress:null,dragDialXY:[0,0],transitionType:"down",dialId:null,highlightParentButton:!1,showSupportDialog:this.shouldShowSupportDialog(e.incognito),blockTrackers:!1,blockAds:!1}}componentDidMount(){Ca.Z.addListener(this._onWebpageViewStoreChanged),pn.Z.addListener(this._handleSupportDialogDisplay),this.timeout=setTimeout((()=>this.animate=!0),300),(0,Ev.pg)("tracking",(e=>{this.setState({blockTrackers:e.trackerBlockingEnabled})})),(0,Ev.pg)("ad_blocking",(e=>{this.setState({blockAds:e.adBlockingEnabled})}))}componentDidUpdate(e,t){const{HTMLElement:s,DOMRect:n}=this.context,i=this.refParentFolderButton.current;if(i instanceof s){const e=i.getBoundingClientRect();e instanceof n&&(this.parentButtonRect=e)}}componentWillUnmount(){this.timeout&&clearTimeout(this.timeout),Ca.Z.removeListener(this._onWebpageViewStoreChanged),pn.Z.removeListener(this._handleSupportDialogDisplay),this.finishPointerClick(!1)}static getDerivedStateFromProps(e,t){const s=t.dialId,n=e.speedDialNode,i=n&&n.id,a=(n&&n.children||[]).filter((e=>!g.Z.isSeparator(e)));if(s===i){let{lastPress:e}=t;if(null===e||KX||a.every((t=>t.id!==e))&&(e=null),null===e)KX=null;else if(KX){const e=t.dialNodes;e.length===a.length&&e.every(((e,t)=>e.id===a[t].id))||(KX=null)}return{dialNodes:a,lastPress:e}}let o="down";if(n&&s&&s!==n.parentId)if(a.some((e=>e.id===s)))o="up";else{const t=e.prefValues[Z.kStartpageSpeedDialOrder].length?e.prefValues[Z.kStartpageSpeedDialOrder]:e.speedDialSet.map((e=>e.id));if(t){const e=t.findIndex((e=>e===s)),n=t.findIndex((e=>e===i));-1!==n&&-1!==e&&(n<e?o="right":n>e&&(o="left"))}}return{dialNodes:a,lastPress:null,transitionType:o,dialId:i}}getLastPressPosition(){const{dialNodes:e,lastPress:t}=this.state;return KX?KX.findIndex((e=>e===t)):e.findIndex((e=>e.id===t))}maybeSpring(e,t){return this.animate&&this.props.prefValues[Z.kThemeUseAnimation]?uF(e,t):e}_handleSupportDialogDisplay=()=>{const e=this.shouldShowSupportDialog(this.props.incognito);this.setState({showSupportDialog:e})};shouldShowSupportDialog(e){return!1}_onWebpageViewStoreChanged=e=>{e.winId===this.context.vivaldiWindowId&&"WEBPAGEVIEW_RELOAD"===e.type&&this._handlePageReload()};handleSpeedDialPointerDown=(e,t)=>{const{document:s}=this.context;"none"!==this.state.pressed&&this.finishPointerClick(!1,t),t.button!==ai.Z.kLeft&&t.button!==ai.Z.kCenter||s.activeElement&&"sd-title-editor"===s.activeElement.className||(this.setState({pressed:"pressed",lastPress:e.id}),this.dragStartX=t.pageX,this.dragStartY=t.pageY)};onPointerMove=e=>{const{pressed:t}=this.state;if("none"===t||!this.props.prefValues[Z.kStartpageSpeedDialAllowDnd])return;if(0===e.buttons)return void this.finishPointerClick(!1,e);if(!(1&e.buttons))return;const{lastPress:s}=this.state;if(null===s||"dragcancel"===t)return;const n=this.isPointerOverParentButton(e);this.setState((e=>(!e.highlightParentButton&&n&&SX.click(),{highlightParentButton:n})));const i=e.pageX-this.dragStartX,a=e.pageY-this.dragStartY;if("pressed"===t&&Math.abs(i)<=5&&Math.abs(a)<=5)return;const o=this.getSpeedDialGeometry(),r=this.getLastPressPosition();"pressed"===t&&(this.setDialDragListeners(!0),this.dragDialStartPos=this.computeLayout(o,r),this.setState({pressed:"dragging"}));let[l,d]=this.dragDialStartPos;l+=i,d+=a,this.setState({dragDialXY:[l,d]});const{cols:c,rows:h,dialWidth:u,dialHeight:p,thumbnailWidth:g,backgroundHeight:m}=this.getSpeedDialGeometry(),f=this.state.dialNodes.length,v=l+Math.ceil(g/3.5),b=d+Math.ceil(m/3.5),C=i<0?Math.round:Math.floor,w=a<0?Math.round:Math.floor,y=(0,kf.Z)(C(v/u),0,c-1),x=(0,kf.Z)(w(b/p),0,h-1),I=Math.min(x*c+y,f-1);r!==I&&this.moveDial(I,r)};moveDial=(e,t)=>{KX=(0,C.Uy)(KX??this.state.dialNodes.map((e=>e.id)).slice(0),(s=>{const n=s.splice(t,1)[0];s.splice(e,0,n)}))};setDialDragListeners(e){if(!this.props.prefValues[Z.kStartpageSpeedDialAllowDnd])return;const{document:t}=this.context;e?(this.context.addEventListener("pointermove",this.onPointerMove,!0),this.context.addEventListener("pointerup",this.onPointerPressEnd,!1),this.context.addEventListener("pointercancel",this.onPointerPressEnd,!0),this.context.addEventListener("pointerdown",this.onPointerPressEnd,!0),Qe.Z.bind("esc",this.onDragEscapeKey)):(this.context.removeEventListener("pointermove",this.onPointerMove,!0),this.context.removeEventListener("pointerup",this.onPointerPressEnd,!1),this.context.removeEventListener("pointercancel",this.onPointerPressEnd,!0),this.context.removeEventListener("pointerdown",this.onPointerPressEnd,!0),Qe.Z.unbind("esc",this.onDragEscapeKey));const s=t.getElementById("browser");s&&(s.style.pointerEvents=e?"none":"auto")}onPointerPressEnd=e=>{const{pressed:t}=this.state;if("dragging"!==t&&"dragcancel"!==t||(0,wi.ZP)(e),"dragging"===t){const e=this.context.document.querySelector(".SpeedDial.dragover")?.getAttribute("data-id");e&&this.mergeSpeedDials(e)}this.finishPointerClick(!0,e)};onDragEscapeKey=()=>{KX=null,this.setState({pressed:"dragcancel"})};isPointerOverParentButton=e=>!(!e||!this.parentButtonRect)&&(e.pageX>this.parentButtonRect.x&&e.pageX<this.parentButtonRect.x+this.parentButtonRect.width&&e.pageY>this.parentButtonRect.y&&e.pageY<this.parentButtonRect.y+this.parentButtonRect.height);async finishPointerClick(e,t){const{pressed:s}=this.state;if("none"!==s){if(this.setDialDragListeners(!1),"dragging"===s||"dragcancel"===s){let n=!1;const i=this.getDraggedNode();if("dragging"===s&&e&&this.isPointerOverParentButton(t)){const e=this.props.speedDialNode&&this.props.speedDialNode.parentId;i&&e&&(await this.props.bookmarkActions.move([i.id],e,0),n=!0)}else if("dragging"===s&&e){const e=this.getLastPressPosition();if(!i)return;if(("number"==typeof i.index?i.index:e)!==e&&KX){const e=i.parentId||"";await this.props.bookmarkActions.reorder(KX,e),n=!0}}n?this.onBookmarksMoved():KX=null}this.setState({pressed:"none",highlightParentButton:!1})}}getDraggedNode=()=>{const{dialNodes:e}=this.state,t=this.getLastPressPosition();return KX?e.find((e=>e.id===KX?.[t])):e[t]};mergeSpeedDials=async e=>{if("dragging"!==this.state.pressed||!this.state.lastPress)return;const t=g.Z.getItemById(this.state.lastPress);if(t&&t.id!==e){const s=g.Z.getItemById(e);if(Boolean(s?.children))await this.props.bookmarkActions.move([t.id],e,0);else if(function(e){return!!e&&!e.url}(t))await this.props.bookmarkActions.move([e],t.id,0);else{const e=await this.props.bookmarkActions.mergeWithPromise(t,s,(0,W.Z)("title","New Folder"));this.props.setSpeedDialAwaitingEdit(e)}this.onBookmarksMoved(),this.setState({pressed:"dragcancel"})}else this.finishPointerClick(!0)};onBookmarksMoved=()=>{n.Z.runtime.lastError&&(KX=null,console.warn("Error moving bookmark: ",n.Z.runtime.lastError))};openParentNode=e=>{(0,wi.ZP)(e),this.props.speedDialNode&&this.props.speedDialNode.parentId&&n.Z.bookmarks.getSubTree(this.props.speedDialNode.parentId,(e=>{if(n.Z.runtime.lastError)return;const t=e[0];t&&this.props.openSpeedDialNode(t)}))};openSpeedDialNode=(e,t)=>{this.props.openSpeedDialNode(e,t)};isTopLevel=()=>!this.props.speedDialNode||!this.props.speedDialSetNode||this.props.speedDialNode.id===this.props.speedDialSetNode.id;_handlePageReload=()=>{!this.props.incognito&&this.props.speedDialNode&&n.Z.bookmarks.getChildren(this.props.speedDialNode.id,(e=>{if(!e)return;const t=[];e.forEach(((e,s,n)=>{re.Z.bookmarksPrivate.isCustomThumbnail(e.id,(i=>{!1===i&&e.url&&t.push({id:e.id,url:e.url}),s===n.length-1&&Ma.updateForBookmarks(t)}))}))}))};onDragUrlOver=e=>{e.dataTransfer.types.some((e=>Jn.ZP.isUriListType(e)||"text/plain"===e||e===Jn.yR))&&((0,wi.ZP)(e),e.dataTransfer.dropEffect="copy")};onDropUrlOn=e=>{const t=this.props.speedDialNode;if(t){const s=t.children?t.children.length:0,n={disableMove:!0};this.props.bookmarkActions.onDropEvent(e,t.id,s,n)}};onKeyDown=e=>{const t=e.key.toLowerCase();if(e.ctrlKey)switch(t){case"z":e.shiftKey?this.props.bookmarkActions.redo():this.props.bookmarkActions.undo();break;case"y":this.props.bookmarkActions.redo()}};onPaste=e=>{this.props.speedDialNode&&this.props.bookmarkActions.paste(e,this.props.speedDialNode.id,!0),(0,wi.ZP)(e)};getSpeedDialSize(){const{prefValues:e}=this.props;return e[Z.kStartpageSpeedDialSize]}getSpeedDialGeometry(){const{prefValues:e}=this.props,t=this.getSpeedDialSize();let s=gL.get(t)?.value;const n="always"===e[Z.kStartpageSpeedDialTitlesVisible];if(!s||"fit_to_columns"===t){const e=Math.round(this.props.maxWidth/(1.4*this.props.prefValues[Z.kStartpageSpeedDialColumns]));s=Math.max(Math.min(e,320),120)}const i=s<150?26:33,a="icon"===t?s-i:Math.round(s/1.22),o=Math.round(s/12),r=this.state.dialNodes.length,l=6*o,d=e[Z.kStartpageSpeedDialColumns],c=a+(n?i:0),h=s+2*o,u=c+2*o;let p=Math.max(1,Math.min(Math.floor((this.props.maxWidth-l)/h),d));this.props.maxWidth<h*p+l&&(p=1);return{backgroundHeight:c,count:r,cols:p,rows:Math.ceil(r/p),dialWidth:h,dialHeight:u,thumbnailWidth:s,thumbnailHeight:a,dialSpace:o}}computeLayout(e,t){const s=Math.floor(t/Number(e.cols)),n=t%Number(e.cols);return[Number(e.dialWidth)*n,Number(e.dialHeight)*s]}getNextFocusable=e=>{const{HTMLElement:t}=this.context,s=this.refSpeedDial.current;if(s instanceof t){const t=Array.from(s.querySelectorAll("div.SpeedDial")).map((e=>e.getAttribute("data-id"))).filter(Boolean);let n=t.indexOf(e);return-1===n?"":(n=n>0?n-1:n+1,n>=t.length?"":t[n])}return""};moveFocus=(e,t)=>{const{HTMLElement:s}=this.context,n=this.refSpeedDial.current;if(n instanceof s){const{cols:s}=this.getSpeedDialGeometry(),i=bo(e,t,Array.from(n.querySelectorAll(".SpeedDial")),s);if(!i&&"up"===t){const e=n.querySelector(".button-startpage.up-level");return!!e&&(e.focus(),!0)}return i}return!1};getTileSize=e=>{switch(!0){case e>=320:return"Huge";case e>=270:return"Large";case e>=220:return"Medium";case e>=170:return"Small";case e>=120:return"Tiny";default:return"Icon"}};renderNavigation=()=>this.isTopLevel()?null:(0,zn.jsx)("nav",{className:"startpage-folder-navigation",children:(0,zn.jsxs)("button",{ref:this.refParentFolderButton,onClick:this.openParentNode,title:(0,W.Z)("Show Parent Folder"),"data-name":"up-button",className:Gn()("button-startpage","up-level",{highlight:this.state.highlightParentButton}),children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.zwh}}),this.props.speedDialNode?this.props.speedDialNode.title:""]})});render(){const{maxWidth:e,prefValues:t}=this.props;if(!e)return null;const s=t[Z.kStartpageSpeedDialAllowDnd],n="icon"===this.getSpeedDialSize(),i=t[Z.kStartpageSpeedDialFaviconVisible]&&!n,a=t[Z.kStartpageSpeedDialTitlesVisible],o=t[Z.kTabsOpenNewInBackground],r=t[Z.kStartpageSpeedDialControlsVisible]&&!n,l=t[Z.kStartpageSpeedDialDeleteVisible],d=t[Z.kStartpageSpeedDialDisplaySearch],c=t[Z.kStartpageSpeedDialPrivacyStatsShow]&&(this.state.blockTrackers||this.state.blockAds),h=c&&d?900:500,{pressed:u,dialId:p,dialNodes:g}=this.state,m=Gn()({SpeedDials:!0,"sd-titles-onhover":"hover"===a}),f=this.getSpeedDialGeometry(),{backgroundHeight:v,count:C,cols:w,rows:y,dialWidth:x,dialHeight:I,thumbnailWidth:A,thumbnailHeight:S,dialSpace:T}=f,E=w*x-2*T,k=Math.round(A/20),N=C<w?C*x-2*T:void 0;return(0,zn.jsxs)("div",{ref:this.refSpeedDial,className:"SpeedDialView",children:[(0,zn.jsxs)("div",{className:"SpeedDialView-Head",style:{maxWidth:Math.min(E,h)},children:[this.state.showSupportDialog&&this.props.prefValues[Z.kStartpageSpeedDialTrackerSuggestionShow]&&(0,zn.jsx)(Qj,{ref:this.refSpeedDialDefaultSearchEngine,hideImg:w<3}),d&&(0,zn.jsx)("div",{className:"on-speeddial",children:(0,zn.jsx)(Lf,{className:"SpeedDialView-SearchField",origin:"speed_dial_view",suggestEnabled:t[Z.kAddressBarSearchSuggestEnabled],size:"large",name:"SearchField"},"speed_dial_search")}),c&&zX]}),(0,zn.jsx)(ZX.Z,{className:Gn()({"SpeedDials-Wrapper":!0,dragging:"dragging"===u,"dragging-disabled":!s}),transitionName:this.state.transitionType,transitionEnterTimeout:300,transitionLeaveTimeout:300,overflowHidden:!1,children:(0,zn.jsxs)("div",{onDragOver:this.onDragUrlOver,onDrop:this.onDropUrlOn,onKeyDown:this.onKeyDown,className:m,children:[this.renderNavigation(),(0,zn.jsx)("div",{className:"SpeedDials-Wrapper",onPointerMove:"pressed"===u&&s?this.onPointerMove:null,onPointerUp:this.onPointerPressEnd,onPointerCancel:this.onPointerPressEnd,style:{width:E,height:Math.max(y*I,v),marginLeft:"auto",marginRight:"auto",maxWidth:N,"--thumbnailHeight":S+"px","--thumbnailWidth":A+"px","--backgroundHeight":v+"px"},children:GX(C,(e=>{const t=KX?g.find((t=>t.id===KX?.[e])):g[e],s=!!t&&t.id===this.state.lastPress,n=s&&"dragging"===u,[d,c]=this.state.dragDialXY,[h,p]=this.computeLayout(f,e);let m={};m=n?{translateX:d,translateY:c,opacity:this.maybeSpring(.95,b.Y3)}:t?{translateX:this.maybeSpring(h,b.Y3),translateY:this.maybeSpring(p,b.Y3),opacity:this.maybeSpring(1,b.Y3)}:{translateX:this.maybeSpring(h,b.Y3),translateY:this.maybeSpring(p,b.Y3),opacity:1};const v=Boolean("dragging"===u&&this.state.lastPress&&t?.id!==this.state.lastPress&&d>h-x/2&&d<=h+x/2&&c>p-I/2&&c<=p+I/2);return(0,zn.jsx)(lF,{style:m,children:nr.Z,children:({translateX:d,translateY:c,opacity:h})=>{if(t)return(0,zn.jsx)(FX,{incognito:this.props.incognito,onPointerDown:this.handleSpeedDialPointerDown,dragging:n,style:{transform:`translate3d(${d}px, ${c}px, 0)`,zIndex:s?999:e,opacity:h,pointerEvents:n?"none":"auto"},isCut:this.props.cutIds.includes(t.id),highlight:v,titleMargin:k,node:t,lastPress:this.state.lastPress,bookmarkActions:this.props.bookmarkActions,keyAccess:0===e?0:-1,moveFocus:this.moveFocus,getNextFocusable:this.getNextFocusable,openSpeedDialNode:(e,t)=>{"dragcancel"!==u&&this.openSpeedDialNode(e,t)},awaitingInitialEditId:this.props.awaitingInitialEditId,setSpeedDialAwaitingEdit:this.props.setSpeedDialAwaitingEdit,showFavicon:i,titleVisibility:a,openTabsInBackground:o,controlsVisible:r,deleteVisible:l,size:this.getSpeedDialSize(),tileSize:this.getTileSize(A)})}},t?.id)}))})]},"node__"+(p||"unset"))}),t[Z.kStartpageSpeedDialAddButtonVisible]&&(0,zn.jsxs)("button",{className:Gn()("add-button",{pressed:this.props.drawerIsOpen}),onClick:this.props.toggleStartpageDrawer,children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.md4.small}}),(0,zn.jsx)("p",{children:(0,W.Z)("Add a Speed Dial")})]})]})}}const YX=(0,zd.Z)($X,HX),XX=[Z.kDashboardEnabled,Z.kFeaturesMail,Z.kStartpageSpeedDialAddButtonVisible,Z.kStartpageSpeedDialOrder];function QX(e){const t=(0,Un.useContext)(oi.Z),s=(0,Eo.Z)(XX),n=(0,Un.createRef)(),i=new Map,[a,o]=(0,Un.useState)([]),[r,l]=(0,Un.useState)(),[d,h]=(0,Un.useState)(""),[u,p]=(0,Un.useState)(""),g=(s,n,i)=>{s===Ux.Mail?ue.Z.showMail(t.vivaldiWindowId):s!==Ux.SpeedDial||e.section!==Ux.SpeedDial?((0,mg.gR)(t),c.ZP.openURL(t.vivaldiWindowId,vs.jk.internals[s],{inCurrent:!0}),n&&e.showSpeedDialGroup(n)):s===Ux.SpeedDial&&n&&e.showSpeedDialGroup(n)},m=e=>{const s="startpagebar",n=t.vivaldiWindowId,i=ei.Z.getOptionFunction(s);return ei.Z.getNamedMenu(n,s,(async t=>{switch(t.action){case"CONTEXT_SET_AS_DEFAULT":return{isVisible:()=>e.length>0,handler:()=>{const t=e,s=a[0];k(t,s),I.Z.set(Z.kStartpageSpeedDialRestorePage,!1)},...i(n,t,{})};case"CONTEXT_RENAME":return{isVisible:()=>e.length>0,isEnabled:()=>e!==b.N4,handler:()=>f(e),...i(n,t,{})};case"CONTEXT_REMOVE":return{isVisible:()=>e.length>0,handler:()=>e===b.N4?E():v(e),...i(n,t,{})};default:return{...i(n,t,{})}}}))},f=e=>{i.get(e)?.enableEditing()},v=e=>{i.get(e)?.removeSpeedDial()},C=(e,t)=>{switch(t.key){case"ArrowLeft":w(e,"left",!1);break;case"ArrowRight":w(e,"right",!1);break;default:return}(0,wi.ZP)(t)},w=(e,s,i)=>{const{document:a,HTMLElement:o}=t,r=n.current;if(r instanceof o&&(!0===i||(0,vo.sT)(a,r))){const t=Array.from(r.querySelectorAll("button.button-startpage")).map((e=>e.getAttribute("data-id"))).filter(Boolean);if("current"===s){if(""===e){const t=a.getElementsByClassName("div.button-startpage active")[0];t instanceof o&&(e=t.dataset.id)}const s=t.indexOf(e);if(-1===s)return;e=t[s]}else if("right"===s||"left"===s){if(1===t.length)return;let n=t.indexOf(e);if(-1===n)return;n="right"===s?n+1>=t.length?0:n+1:n<=0?t.length-1:n-1,e=t[n]}const n=r.querySelector(`button.button-startpage[data-id="${e}"]`);n&&n.focus()}};let y=-1===e.keyAccess;const x=e=>{let t=-1;return!y&&e&&(y=!0,t=0),t},A=e=>a.findIndex((t=>t===e)),S=()=>{h(""),p(""),l(void 0)},T=e=>{d!==u&&(e.stopPropagation(),k(d,u)),h(""),p(""),l(void 0)},k=(e,t)=>{let s=A(t);const n=A(e);n<s&&s--;let i=[...a];const l=i[n].slice();i=i.filter((e=>e!==l)),i.splice(s+("right"===r?1:0),0,l),o(i),I.Z.set(Z.kStartpageSpeedDialOrder,i)},N=(0,Un.useMemo)((()=>{const n=[...e.speedDialSet];s[Z.kDashboardEnabled]&&!fe.ZP.isIncognito(t.vivaldiWindowId)&&n.push(b.h6);const i=s[Z.kStartpageSpeedDialOrder];return n.sort(((e,t)=>i.length?i.indexOf(e.id)>i.indexOf(t.id)?1:-1:0)),o(n.map((e=>e.id),[])),n}),[e.speedDialSet,s,t.vivaldiWindowId]),_=s[Z.kDashboardEnabled]&&!fe.ZP.isIncognito(t.vivaldiWindowId)&&e.speedDialSet.length||e.speedDialSet.length>1;return(0,zn.jsxs)("nav",{ref:n,className:"startpage-navigation toolbar-medium",role:"toolbar","aria-label":(0,W.Z)("toolbar label","Start Navigation"),onContextMenu:e=>{e.persist(),(0,wi.ZP)(e),m("").then((s=>{(0,mi.Z)(t,s)(e)}))},onDragOver:wi.PF,onDrop:T,children:[(0,zn.jsxs)("div",{className:"startpage-navigation-group",children:[N.map(((t,s)=>{const n=e.section===Ux.SpeedDial&&e.speedDialSetNode&&e.speedDialSetNode.id===t.id,a=t.id,c=_?{draggable:!0,onDragStart:e=>((e,t)=>{e.persist(),e.stopPropagation(),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("vivaldi/x-speeddial-entry",t),h(t),o(N.map((e=>e.id),[]))})(e,t.id),onDragEnter:()=>{return e=t.id,void(d!==e&&p(e));var e},onDragOver:e=>((e,t)=>{if(e.stopPropagation(),e.dataTransfer.dropEffect="move",!d||t===d)return;e.preventDefault();const s=e.currentTarget.getBoundingClientRect(),n=e.clientX-s.left>s.width/2?"right":"left";l(n)})(e,t.id),onDragEnd:S,onDrop:T}:{draggable:!1};return(0,zn.jsx)(OX,{className:Gn()({active:n,"button-startpage":!0,"no-page-focus":!0,collapsed:d===t.id,"hover-left":d!==t.id&&u===t.id&&"left"===r,"hover-right":d!==t.id&&u===t.id&&"right"===r}),ref:e=>{return t=a,void((s=e)?i.set(t,s):i.delete(t));var t,s},bookmark:t,howToEdit:"doubleClick",getContextMenuItemsPromise:()=>m(a),keyAccess:x(!!n),onSelect:e=>g(Ux.SpeedDial,t),onKeyDown:C,needsInitialEdit:e.initialEditSpeedDialSet===t.id,setSpeedDialAwaitingEdit:e.setSpeedDialAwaitingEdit,...c},t.id)}),this),s[Z.kStartpageSpeedDialAddButtonVisible]&&(0,zn.jsx)("button",{onClick:()=>{e.section!==Ux.SpeedDial&&c.ZP.openURL(t.vivaldiWindowId,vs.jk.internals[Ux.SpeedDial],{inCurrent:!0}),e.createSpeedDialSet()},"data-id":"add",className:"button-startpage add-set no-page-focus",title:(0,W.Z)("New Group"),tabIndex:x(!0),onKeyDown:e=>C("add",e),dangerouslySetInnerHTML:{__html:Kn.md4.medium}})]}),(0,zn.jsxs)("div",{className:"startpage-navigation-group",children:[(0,zn.jsx)(oa.ZP,{name:"PanelBookmarks",onClick:e=>g(Ux.Bookmarks,void 0),onKeyDown:e=>C(Ux.Bookmarks,e),"data-id":Ux.Bookmarks,tabIndex:x(!0),className:Gn()({"button-startpage":!0,"no-page-focus":!0,active:e.section===Ux.Bookmarks}),title:(0,W.Z)("Bookmarks"),size:"medium",image:Kn.CLf.large,commandId:"COMMAND_SHOW_BOOKMARKS"}),(0,zn.jsx)(oa.ZP,{name:"PanelHistory",onClick:e=>g(Ux.History,void 0),onKeyDown:e=>C(Ux.History,e),title:(0,W.Z)("History"),"data-id":Ux.History,tabIndex:x(!0),className:Gn()({"button-startpage":!0,"no-page-focus":!0,active:e.section===Ux.History}),size:"medium",image:Kn.hcy.large,commandId:"COMMAND_SHOW_HISTORY"}),(0,zn.jsx)(oa.ZP,{name:"PanelNotes",onClick:e=>g(Ux.NotesManager,void 0),onKeyDown:e=>C(Ux.NotesManager,e),title:(0,W.Z)("Notes"),"data-id":Ux.NotesManager,tabIndex:x(!0),className:Gn()({"button-startpage":!0,"no-page-focus":!0,active:e.section===Ux.NotesManager}),size:"medium",image:Kn.cyI.large,commandId:"COMMAND_SHOW_NOTES"}),s[Z.kFeaturesMail]&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)(oa.ZP,{name:"PanelCalendar",onClick:e=>g(Ux.Calendar,void 0),onKeyDown:e=>C(Ux.Calendar,e),title:(0,W.Z)("Calendar"),"data-id":Ux.Calendar,tabIndex:x(!0),className:Gn()({"button-startpage":!0,"no-page-focus":!0,active:e.section===Ux.Calendar}),size:"medium",image:Kn.bcq.large,commandId:"COMMAND_SHOW_CALENDAR"}),(0,zn.jsx)(oa.ZP,{name:"PanelMail",onClick:e=>g(Ux.Mail,void 0),onKeyDown:e=>C(Ux.Mail,e),title:(0,W.Z)("Mail"),"data-id":Ux.Mail,tabIndex:x(!0),className:Gn()({"button-startpage":!0,"no-page-focus":!0,active:e.section===Ux.Mail}),size:"medium",image:Kn.lvj.large,commandId:"COMMAND_SHOW_MAIL"})]})]})]})}const qX=(0,Un.memo)(QX),JX=[Z.kBookmarksConfirmOpening,Z.kBookmarksConfirmOpeningThreshold,Z.kDashboardEnabled,Z.kKeyboardTabToAll,Z.kStartpageNavigation,Z.kStartpageSpeedDialAddButtonVisible,Z.kStartpageSpeedDialGameButtonShow,Z.kStartpageSpeedDialRestorePage,Z.kTabsBarPosition,Z.kTabsBarWidth,Z.kStartpageSpeedDialOrder,Z.kBiscuitPromote];function eQ(e,t,s,n){const i=s.prefValues[Z.kStartpageSpeedDialRestorePage]?g.Z.getActiveGroup(e):s.prefValues[Z.kStartpageSpeedDialOrder][0],a=s.prefValues[Z.kDashboardEnabled]&&!n;let o;return a&&i===b.N4?o=b.h6:i&&(o=t.find((e=>e.id===i))),o??t[0]??(a?b.h6:void 0)}var tQ=(0,zn.jsx)(IX,{}),sQ=(0,zn.jsx)("div",{className:"StartPage-GameButton",children:(0,zn.jsx)(tp,{isStartPage:!0})});class nQ extends Un.PureComponent{static contextType=oi.Z;refSDdWrapper=Un.createRef();refSpeedDialView=Un.createRef();bookmarkActions=new kV;_hasClipboardListener=!1;constructor(e,t){super(e);const s=g.Z.getSpeeddialFolders(),n=eQ(t.vivaldiWindowId,s,e,fe.ZP.isIncognito(t.vivaldiWindowId)),i=tn.ZP.getWidth(t.vivaldiWindowId),a=e.prefValues[Z.kTabsBarWidth],o=e.prefValues[Z.kTabsBarPosition],r="left"===o||"right"===o?a:0;this.state={section:e.view,bookmarksAvailable:void 0!==g.Z.getRootId(),speeddialFolders:s,menuSpeeddial:n,currentSpeeddial:n,drawerIsOpen:!1,awaitingInitialEditId:"",initialEditSpeedDialSet:"",viewWidth:t.innerWidth-i-r,viewHeight:t.innerHeight,wallpaperId:crypto.randomUUID(),cutIds:g.Z.getCutIds(),isResizing:!1,popularSites:[]}}componentDidMount(){g.Z.addListener(this._onStoreChange),Wf.addListener(this._onTaskStoreChange),this.context.addEventListener("resize",this.handleWindowResize,!1),this.initDirectMatchData(),re.Z.directMatch.onPopularSitesReady.addListener(this.onDirectMatchAdded)}componentWillUnmount(){g.Z.removeListener(this._onStoreChange),Wf.removeListener(this._onTaskStoreChange),Qe.Z.unbind("esc",this.closeStartpageDrawer),this.context.removeEventListener("resize",this.handleWindowResize,!1),re.Z.directMatch.onPopularSitesReady.removeListener(this.onDirectMatchAdded),clearTimeout(this._resizingTimeout)}componentDidUpdate(e,t){t.drawerIsOpen!==this.state.drawerIsOpen&&(this.state.drawerIsOpen?Qe.Z.bind("esc",this.closeStartpageDrawer):Qe.Z.unbind("esc",this.closeStartpageDrawer)),e.view!==this.props.view&&this.setState({section:this.props.view}),e.prefValues[Z.kDashboardEnabled]!==this.props.prefValues[Z.kDashboardEnabled]&&this._onStoreChange()}onDirectMatchAdded=()=>{this.initDirectMatchData()};initDirectMatchData=()=>{vs.jk.getDirectMatchPopularSites().then((e=>{if(e.length){const t=e.reduce(((e,t,s)=>{s<10&&(e[0]||(e[0]=[]),e[0].push(t));const n=t.category;return n>XY.length||(e[n]||(e[n]=[]),e[n].push(t)),e}),{}),s=Object.entries(t).map((([e,t])=>({category:parseInt(e),bookmarks:t})));this.setState({popularSites:s})}}))};handleWindowResize=()=>{clearTimeout(this._resizingTimeout),this.setState({isResizing:!0}),this.freezeProps||(this.freezeProps={viewWidth:this.state.viewWidth,viewHeight:this.state.viewHeight}),this._resizingTimeout=setTimeout((()=>{this.setState({isResizing:!1}),this.freezeProps=void 0}),1e3)};_onStoreChange=()=>{this.setState((e=>{const t=g.Z.getSpeeddialFolders();let{menuSpeeddial:s,currentSpeeddial:n}=e;e.bookmarksAvailable||(s=eQ(this.context.vivaldiWindowId,t,this.props,fe.ZP.isIncognito(this.context.vivaldiWindowId)),n=s);for(const i of t)this.getUpdatedNode(i,e.currentSpeeddial)&&(n=this.getUpdatedNode(i,e.currentSpeeddial)),this.getUpdatedNode(i,e.menuSpeeddial)&&(s=this.getUpdatedNode(i,e.menuSpeeddial));return{bookmarksAvailable:!0,speeddialFolders:t,menuSpeeddial:s,currentSpeeddial:n,cutIds:g.Z.getCutIds()}}))};_onTaskStoreChange=()=>{this.forceUpdate()};jumpToTop=()=>{const{HTMLElement:e}=this.context,t=this.refSDdWrapper.current;t instanceof e&&(t.scrollTop=0)};onResize=e=>{const t=e[0].contentRect;(this.state.viewHeight!==t.height||this.state.viewWidth!==t.width)&&this.setState({viewWidth:t.width,viewHeight:t.height})};getUpdatedNode=(e,t)=>{if(e&&e.id&&t&&t.id){if(e.id===t.id)return e;if(e.children){for(var s=0;s<e.children.length;s++){var n=this.getUpdatedNode(e.children[s],t);if(n&&n.id===t.id)return n}return}}else;};showStartpageDrawer=(e,t)=>{this.setState({drawerIsOpen:e},(()=>{!1===e&&""===this.state.awaitingInitialEditId&&this.refSpeedDialView.current?.moveFocus(t||"add","current")}))};closeStartpageDrawer=()=>{this.showStartpageDrawer(!1,"")};toggleStartpageDrawer=()=>{0===this.state.speeddialFolders.length?this.createSpeedDialSet():this.showStartpageDrawer(!this.state.drawerIsOpen)};handleDoubleClick=e=>{e.target.className&&this.state.menuSpeeddial?.id!==b.N4&&this.state.section===Ux.SpeedDial&&!this.props.prefValues[Z.kStartpageSpeedDialAddButtonVisible]&&this.toggleStartpageDrawer()};onSetClipboardListener=e=>{this._hasClipboardListener=e};handlePaste=()=>{const{document:e}=this.context,t=this._hasClipboardListener;t||e.addEventListener("paste",this.onPaste),e.execCommand("paste"),t||e.removeEventListener("paste",this.onPaste)};onPaste=e=>{this.state.currentSpeeddial&&(this.bookmarkActions.paste(e,this.state.currentSpeeddial.id,!0),e.stopPropagation(),e.preventDefault())};createSpeedDialSet=async()=>{const e=await this.bookmarkActions.create({parentId:g.Z.getRootId(),title:g.Z.getDefaultFolderName()});e&&this.bookmarkActions.update(e.id,{speeddial:!0}).then((e=>{this.setState({initialEditSpeedDialSet:e.id})}))};showSpeedDialGroup=e=>{ne.Z.setActiveGroup(this.context.vivaldiWindowId,e.id),this.props.updatePageThumbnailWithActiveWebview(1e3),this.jumpToTop(),this.setState({section:Ux.SpeedDial,menuSpeeddial:e,currentSpeeddial:e})};isFolder=e=>!e.url;openFolder=(e,t)=>{!0===(t=t||{}).openInBackground?Jn.ZP.open(this.context.vivaldiWindowId,Jn.ZP.getBookmarksByNode(e),{inCurrent:!1,inBackground:!0,inNewWindow:!1,incognito:!1,transition:re.Z.historyPrivate.TransitionType.AUTO_BOOKMARK},!0):(this.jumpToTop(),this.setState({currentSpeeddial:e},(()=>{this.refSpeedDialView.current?.moveFocus("","current"),this.bookmarkActions.clearUndoStack()})))};openSpeedDialNode=(e,t)=>{t=t||{},this.isFolder(e)?this.openFolder(e,t):t.openInNewWindow?Wn.Z.openBrowserWindow(this.context.vivaldiWindowId,e.url,{incognito:t.incognito,transition:re.Z.historyPrivate.TransitionType.AUTO_BOOKMARK}):e.url&&c.ZP.openURL(this.context.vivaldiWindowId,e.url,{inCurrent:!t.openInNewTab,inBackground:t.openInBackground,bookmarkId:e.id,addOpenerTabId:!0,inSpecificPageId:t.openInNewTab?void 0:this.props.pageId,transition:re.Z.historyPrivate.TransitionType.AUTO_BOOKMARK})};setSpeedDialAwaitingEdit=e=>{this.setState({awaitingInitialEditId:e})};onSpeedDialDrawerDone=async(e,t=!1)=>{if(!e)return void this.closeStartpageDrawer();const s=await this.bookmarkActions.create(e);if(!s)return void this.closeStartpageDrawer();const n=s.url;n?fe.ZP.isIncognito(this.context.vivaldiWindowId)||Ma.updateForBookmark(s.id,n):this.setSpeedDialAwaitingEdit(s.id),t||this.showStartpageDrawer(!1,s.id)};customize=()=>{ue.Z.showSettings(this.context.vivaldiWindowId,"startpage")};renderSection=e=>{switch(this.state.section){case Ux.Bookmarks:const t=new URL(this.props.url).searchParams.get("path");return(0,zn.jsx)(nH,{highlightId:t});case Ux.History:return(0,zn.jsx)(t$,{pageId:this.props.pageId,keyAccess:this.props.prefValues[Z.kKeyboardTabToAll],maxWidth:this.freezeProps?.viewWidth??this.state.viewWidth,maxHeight:this.freezeProps?.viewHeight??this.state.viewHeight});case Ux.SpeedDial:return this.state.bookmarksAvailable?this.state.currentSpeeddial?.id!==b.N4||e?(0,zn.jsx)(YX,{ref:this.refSpeedDialView,bookmarkActions:this.bookmarkActions,cutIds:this.state.cutIds,speedDialNode:this.state.currentSpeeddial,speedDialSetNode:this.state.menuSpeeddial,speedDialSet:this.state.speeddialFolders,keyAccess:this.props.prefValues[Z.kKeyboardTabToAll],drawerIsOpen:this.state.drawerIsOpen,maxWidth:this.state.viewWidth,maxHeight:this.state.viewHeight,openSpeedDialNode:this.openSpeedDialNode,toggleStartpageDrawer:this.toggleStartpageDrawer,onSetClipboardListener:this.onSetClipboardListener,incognito:e,setSpeedDialAwaitingEdit:this.setSpeedDialAwaitingEdit,awaitingInitialEditId:this.state.awaitingInitialEditId}):(0,zn.jsx)(mz,{maxWidth:this.state.viewWidth,isActive:this.props.isActive,pageId:this.props.pageId}):null;case Ux.Calendar:return(0,zn.jsx)(GH,{pageId:this.props.pageId,url:this.props.url});case Ux.NotesManager:{const e=new URL(this.props.url).searchParams.get("path")||"-1";return(0,zn.jsx)(zY,{id:e,pageId:this.props.pageId,isActive:this.props.isActive},`notes-manager-${this.props.pageId}`)}default:return console.warn("Unknown Startpage Section: ",this.state.section),null}};getContextMenuItems=e=>{const t=this.context.vivaldiWindowId,s=!1===this.state.drawerIsOpen&&Boolean(this.state.currentSpeeddial)&&!fe.ZP.isGuest(),n=!1===this.state.drawerIsOpen&&!this.state.currentSpeeddial&&!fe.ZP.isGuest(),i=ei.Z.getOptionFunction(e);return ei.Z.getNamedMenu(t,e,(async e=>{switch(e.action){case"CONTEXT_ADD_BOOKMARK_TO_SPEEDDIAL":return{handler:this.toggleStartpageDrawer,isVisible:()=>s,...i(t,e,{})};case"CONTEXT_ADD_FOLDER_TO_SPEEDDIAL":return{handler:this.createSpeedDialSet,isVisible:()=>n,...i(t,e,{})};case"CONTEXT_PASTE":return{handler:this.handlePaste,...i(t,e,{})};case"CONTEXT_CUSTOMIZE":return{handler:this.customize,isVisible:()=>!fe.ZP.isGuest(),...i(t,e,{})};case"CONTEXT_UNDO":return{handler:()=>this.bookmarkActions.undo(),isEnabled:()=>this.bookmarkActions.canUndo(),...i(t,e,{})};case"CONTEXT_REDO":return{handler:()=>this.bookmarkActions.redo(),isEnabled:()=>this.bookmarkActions.canRedo(),...i(t,e,{})};default:return Promise.resolve({...i(t,e,{})})}}))};onContextMenu=e=>{e.persist(),e.preventDefault(),e.stopPropagation(),this.getContextMenuItems("startpage").then((t=>{(0,mi.Z)(this.context,t)(e)}))};render(){if(!this.props.open)return null;const e=fe.ZP.isIncognito(this.context.vivaldiWindowId);return(0,zn.jsxs)(ti.Z,{className:"startpage",onResize:this.onResize,children:[("on"===this.props.prefValues[Z.kStartpageNavigation]||"speed_dial_only"===this.props.prefValues[Z.kStartpageNavigation]&&this.state.section===Ux.SpeedDial)&&(0,zn.jsx)(qX,{showSpeedDialGroup:this.showSpeedDialGroup,section:this.state.section,speedDialSet:this.state.speeddialFolders,speedDialSetNode:this.state.menuSpeeddial,createSpeedDialSet:this.createSpeedDialSet,initialEditSpeedDialSet:this.state.initialEditSpeedDialSet,setSpeedDialAwaitingEdit:this.setSpeedDialAwaitingEdit,keyAccess:this.props.prefValues[Z.kKeyboardTabToAll]}),(0,zn.jsxs)("div",{className:"startpage-content",onContextMenu:this.state.section===Ux.SpeedDial&&this.state.currentSpeeddial?.id!==b.N4?this.onContextMenu:null,onDoubleClick:this.handleDoubleClick,children:[(0,zn.jsxs)("div",{className:Gn()("sdwrapper",{"has-SpeedDial":this.state.section===Ux.SpeedDial&&this.state.currentSpeeddial?.id!==b.N4,"has-Dashboard":this.state.section===Ux.SpeedDial&&this.state.currentSpeeddial?.id===b.N4}),ref:this.refSDdWrapper,children:[this.renderSection(e),this.state.section===Ux.SpeedDial&&tQ]}),!e&&this.props.prefValues[Z.kDashboardEnabled]&&this.state.section===Ux.SpeedDial&&this.state.currentSpeeddial?.id!==b.N4&&(0,zn.jsx)(zn.Fragment,{children:A.Z.get(Z.kBiscuitPromote)?(0,zn.jsx)("div",{className:"StartPage-PromoteButton",children:(0,zn.jsx)($Y,{onChange:()=>{this.showSpeedDialGroup(b.h6)}})}):(0,zn.jsx)(zn.Fragment,{children:this.props.prefValues[Z.kStartpageSpeedDialGameButtonShow]&&this.state.currentSpeeddial?.id!==b.N4&&sQ})})]}),this.state.section===Ux.SpeedDial&&this.state.drawerIsOpen&&(0,zn.jsx)(eX,{node:this.state.currentSpeeddial,keyAccess:this.props.prefValues[Z.kKeyboardTabToAll],onSpeedDialDrawerDone:this.onSpeedDialDrawerDone,popularSites:this.state.popularSites})]})}}const iQ=(0,zd.Z)(nQ,JX);class aQ extends Un.PureComponent{static contextType=oi.Z;state={windowStyle:Ue.Z.getState().windowStyles.get(this.context.vivaldiWindowId)||{}};componentDidMount(){Ue.Z.addListener(this.onThemeStoreChanged)}componentWillUnmount(){Ue.Z.removeListener(this.onThemeStoreChanged)}onThemeStoreChanged=()=>{const e=Ue.Z.getState().windowStyles.get(this.context.vivaldiWindowId);this.setState({windowStyle:e})};render(){const e=Object.entries(this.state.windowStyle),t=e.filter((([e,t])=>e.includes("colorSuccess")||e.includes("colorWarning")||e.includes("colorError"))),s=e.filter((([e,t])=>e.includes("radius"))),n=e.filter((([e,t])=>e.includes("colorBg"))),i=e.filter((([e,t])=>e.includes("colorFg"))),a=e.filter((([e,t])=>e.includes("colorAccent"))),o=e.filter((([e,t])=>e.includes("colorHighlight"))),r=e.filter((([e,t])=>e.includes("colorBorder")));return(0,zn.jsxs)("div",{className:"theme-test",tabIndex:"0",children:[(0,zn.jsx)("h1",{children:(0,W.Z)("Theme Color Test Page")}),(0,zn.jsx)("p",{children:(0,W.Z)("$1 color and $2 radius variables created",[Object.entries(this.state.windowStyle).length,s.length])}),(0,zn.jsxs)("div",{children:[(0,zn.jsx)("h2",{children:`${(0,W.Z)("Info Colors")} (${t.length})`}),(0,zn.jsx)("div",{className:"list",children:t.map((([e,t])=>(0,zn.jsxs)("div",{style:{backgroundColor:t},children:[(0,zn.jsx)("input",{type:"text",value:e,readOnly:!0}),(0,zn.jsx)("input",{type:"text",value:t,readOnly:!0})]},e)))})]}),(0,zn.jsxs)("div",{children:[(0,zn.jsx)("h2",{children:`${(0,W.Z)("Foreground Colors")} (${i.length})`}),(0,zn.jsx)("div",{className:"list",children:i.map((([e,t])=>(0,zn.jsxs)("div",{style:{backgroundColor:t},children:[(0,zn.jsx)("input",{type:"text",value:e,readOnly:!0}),(0,zn.jsx)("input",{type:"text",value:t,readOnly:!0})]},e)))})]}),(0,zn.jsxs)("div",{children:[(0,zn.jsx)("h2",{children:`${(0,W.Z)("Background Colors")} (${n.length})`}),(0,zn.jsx)("div",{className:"list",children:n.map((([e,t])=>(0,zn.jsxs)("div",{style:{backgroundColor:t},children:[(0,zn.jsx)("input",{type:"text",value:e,readOnly:!0}),(0,zn.jsx)("input",{type:"text",value:t,readOnly:!0})]},e)))})]}),(0,zn.jsxs)("div",{children:[(0,zn.jsx)("h2",{children:`${(0,W.Z)("Border Colors")} (${r.length})`}),(0,zn.jsx)("div",{className:"list",children:r.map((([e,t])=>(0,zn.jsxs)("div",{style:{backgroundColor:t},children:[(0,zn.jsx)("input",{type:"text",value:e,readOnly:!0}),(0,zn.jsx)("input",{type:"text",value:t,readOnly:!0})]},e)))})]}),(0,zn.jsxs)("div",{children:[(0,zn.jsx)("h2",{children:`${(0,W.Z)("Accent Colors")} (${a.length})`}),(0,zn.jsx)("div",{className:"list",children:a.map((([e,t])=>(0,zn.jsxs)("div",{style:{backgroundColor:t},children:[(0,zn.jsx)("input",{type:"text",value:e,readOnly:!0}),(0,zn.jsx)("input",{type:"text",value:t,readOnly:!0})]},e)))})]}),(0,zn.jsxs)("div",{children:[(0,zn.jsx)("h2",{children:`${(0,W.Z)("Highlight Colors")} (${o.length})`}),(0,zn.jsx)("div",{className:"list",children:o.map((([e,t])=>(0,zn.jsxs)("div",{style:{backgroundColor:t},children:[(0,zn.jsx)("input",{type:"text",value:e,readOnly:!0}),(0,zn.jsx)("input",{type:"text",value:t,readOnly:!0})]},e)))})]}),(0,zn.jsxs)("div",{children:[(0,zn.jsx)("h2",{children:`${(0,W.Z)("Border radius")} (${s.length})`}),(0,zn.jsx)("div",{className:"list",children:s.map((([e,t])=>(0,zn.jsxs)("div",{style:{radius:t},children:[(0,zn.jsx)("input",{type:"text",value:e,readOnly:!0}),(0,zn.jsx)("input",{type:"text",value:t,readOnly:!0})]},e)))})]})]})}}const oQ=aQ,rQ=(0,Gm.Z)("button",500);var lQ=(0,zn.jsx)("div",{className:"welcome-account-media"});function dQ(e,t){const[s,n]=(0,Un.useState)(""),[i,a]=(0,Un.useState)(0);return(0,zn.jsx)("div",{ref:t,className:"welcome-content-outer",children:(0,zn.jsxs)("form",{className:"welcome-content-inner",onSubmit:t=>{if(""===s||i)return a(0),void e.continue();if((0,cw.HZ)(s)){const t={headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},method:"POST",body:new URLSearchParams({email:s,listid:"mGeXxGKeW"})};fetch("https://vivaldi.com/wp-content/themes/vivaldicom-theme/newsletter/ajaxsubscribe.php",t).then((t=>{t.ok?e.continue():(console.error("Error:",t),a(1))}))}},children:[(0,zn.jsxs)("div",{className:"welcome-account",children:[(0,zn.jsxs)("div",{className:"welcome-account-panel",children:[(0,zn.jsx)("h1",{children:e.title}),(0,zn.jsxs)("div",{className:"welcome-account-wrapper",children:[(0,zn.jsx)("p",{children:e.callout[0]}),(0,zn.jsxs)("ul",{children:[(0,zn.jsx)("li",{children:e.callout[1]}),(0,zn.jsx)("li",{children:e.callout[2]}),(0,zn.jsx)("li",{children:e.callout[3]}),(0,zn.jsx)("li",{children:e.callout[4]}),(0,zn.jsx)("li",{children:e.callout[5]})]}),(0,zn.jsx)("h2",{children:e.callout[6]}),(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"email",name:"email",value:s,placeholder:e.callout[7],onChange:t=>{const{value:s}=t.target;n(s),t.target.setCustomValidity(""),s&&(t=>{const s=t.target,{validity:n,value:i}=t.target;n.valid&&!(0,cw.HZ)(i)?(s.setCustomValidity(e.callout[10]),s.reportValidity()):i.endsWith("@vivaldi.net")?(s.setCustomValidity(""),a(2)):a(0)})(t)},required:!1,autoFocus:!0}),(0,zn.jsx)($x,{label:e.callout[8],position:"right"})]}),i>0&&(0,zn.jsx)(fa,{type:1===i?"warning":"info",children:1===i?e.callout[12]:e.callout[11]})]})]}),lQ]}),(0,zn.jsx)(rQ,{tabIndex:0,type:"submit",className:"welcome-button primary",children:""===s||s.endsWith("@vivaldi.net")||i?(0,W.Z)("Skip"):e.continueText})]})})}const cQ=(0,Un.forwardRef)(dQ),hQ=(0,Gm.Z)("button",500);var uQ=(0,zn.jsx)("div",{className:"card-outline"});class pQ extends Un.Component{render(){const e=this.props.style||{};return this.props.backgroundImage&&(e.backgroundImage=`url(${this.props.backgroundImage})`),(0,zn.jsxs)(hQ,{className:Gn()({"welcome-card":!0,"card-has-background":this.props.backgroundImage,"card-has-image-zoom":this.props.hasImageZoom,"card-is-done":this.props.done,"card-is-selected":this.props.selected}),disabled:this.props.done,onClick:this.props.onClick,title:this.props.tooltip??this.props.title,style:e,"aria-selected":this.props.selected,role:"option",children:[uQ,this.props.image&&(0,zn.jsx)("div",{className:"card-image",children:(0,zn.jsx)("img",{src:this.props.image,height:"78",width:"78",alt:""})}),this.props.svg&&(0,zn.jsx)("div",{className:"card-image",dangerouslySetInnerHTML:{__html:this.props.svg}}),this.props.renderContent&&this.props.renderContent(),(0,zn.jsx)("div",{className:"card-text",children:this.props.title})]})}}const gQ=pQ,mQ=[{names:["chrome"],imageName:"welcomepage-chrome.png"},{names:["chromium"],imageName:"welcomepage-chromium.png"},{names:["mozilla firefox"],imageName:"welcomepage-firefox.png"},{names:["opera gx"],imageName:"welcomepage-operagx.png"},{names:["opera 12"],imageName:"welcomepage-opera-12.png"},{names:["opera"],imageName:"welcomepage-opera.png"},{names:["safari"],imageName:"welcomepage-safari.png"},{names:["edge legacy"],imageName:"welcomepage-edge.png"},{names:["explorer"],imageName:"welcomepage-explorer.png"},{names:["vivaldi"],imageName:"welcomepage-vivaldi.png"},{names:["brave"],imageName:"welcomepage-brave.png"},{names:["edge"],imageName:"welcomepage-edge-chromium.png"},{names:["yandex","яндекс"],imageName:"welcomepage-yandex.png"},{names:["arc"],imageName:"welcomepage-arc.png"}],fQ=["safari","edge","explorer"],vQ=["Thunderbird"],bQ=(0,Gm.Z)("button",500);function CQ(e){const t=e.toLowerCase();for(let e=0;e<mQ.length;e++)for(let s=0;s<mQ[e].names.length;s++)if(t.includes(mQ[e].names[s]))return{name:mQ[e].names[s],imageName:mQ[e].imageName};return{name:e,imageName:""}}var wQ=(0,zn.jsx)("br",{});class yQ extends Un.Component{static contextType=oi.Z;constructor(e){super(e),this.state={error:null,profileStatus:[],profiles:[],toImport:[],requiresInteractiveImport:null,importsExtensions:!1,importsTabs:!1}}componentDidMount(){this.refreshProfileList(),re.Z.importData.onImportEnded.addListener(this.onImportEnded)}componentWillUnmount(){re.Z.importData.onImportEnded.removeListener(this.onImportEnded)}refreshProfileList=()=>{re.Z.runtimePrivate.getUserProfiles((e=>{this.refreshProfileListWithIgnorePaths(e.map((e=>e.path)))}))};refreshProfileListWithIgnorePaths=e=>{re.Z.importData.getProfiles((t=>{const s=t.filter((t=>!(t.detectedProfilePath&&e.some((e=>e.startsWith(t.detectedProfilePath))))));this.setState({profileStatus:s.map((()=>"IDLE")),profiles:s})}))};selectProfileFolder=()=>{if(null!=this.state.requiresInteractiveImport){const e=this.state.profiles[this.state.requiresInteractiveImport];re.Z.utilities.selectFile({windowId:this.context.vivaldiWindowId,title:(0,W.Z)("Select $1 Folder",[e.name]),type:"folder",defaultPath:e.suggestedProfilePath}).then((t=>{t&&e.requiresAccessPermission&&(this.refreshProfileList(),this.handleOnCloseDialog())}))}};toggleImport=e=>{const{toImport:t}=this.state;if(t.includes(e))t.splice(t.indexOf(e),1);else{t.push(e);const s=this.state.profiles[e];s.requiresInteractiveImport&&this.setState({requiresInteractiveImport:e}),s.extensions&&this.setState({importsExtensions:!0}),s.tabs&&this.setState({importsTabs:!0})}this.setState({toImport:t})};importSelected=()=>{this.startImport(this.state.toImport[0]),this.toggleImport(this.state.toImport[0])};onImportEnded=e=>{const t=[...this.state.profileStatus];for(let s=0;s<this.state.profileStatus.length;s++)"STARTED"===t[s]&&(t[s]=0===e?"COMPLETED":"FAILED");0===e?this.setState({error:null,profileStatus:t}):this.setState({error:(0,W.Z)("An error occurred during import"),profileStatus:t}),this.state.toImport.length>0&&this.importSelected(),this.state.importsExtensions&&(c.ZP.openURL(this.context.vivaldiWindowId,vs.xy.extensions,{inBackground:!0,singleton:!0}),this.state.importsExtensions=!1),this.state.importsTabs&&(this.state.importsTabs=!1)};startImport(e){const t=this.state.profiles[e];let s="";t.UserProfiles&&t.UserProfiles[0]&&t.UserProfiles[0].profileName&&(s=t.UserProfiles[0].profileName);const n={history:t.history,favorites:t.favorites,passwords:t.passwords,notes:t.notes,speeddial:t.speeddial,extensions:t.extensions,tabs:t.tabs};this.setState((t=>{const s=[...t.profileStatus];return s[e]="STARTED",{profileStatus:s}}),(()=>{re.Z.importData.startImport(e,true,s,n,"","",(()=>{}))}))}handleOnCloseDialog=()=>{this.setState({requiresInteractiveImport:null})};render(){const e=this.state.profileStatus.some((e=>"COMPLETED"===e)),t=this.state.profiles.filter((e=>(e.hasDefaultInstall||fQ.includes(CQ(e.name).name))&&!vQ.includes(CQ(e.name).name))),s=t.length,n=null!=this.state.requiresInteractiveImport?this.state.profiles[this.state.requiresInteractiveImport]:void 0;return(0,zn.jsxs)(zn.Fragment,{children:[n&&(0,zn.jsxs)(Ha.Z,{onRequestClose:this.handleOnCloseDialog,className:"welcome-import-data-dialog float",title:(0,W.Z)("Import Browser Data"),children:[(0,zn.jsx)("div",{className:"import-data",children:(0,zn.jsx)("div",{className:"dialog-content",children:(0,zn.jsxs)("div",{className:"import-pathname",children:[n.requiresAccessPermission&&(0,zn.jsxs)(zn.Fragment,{children:[(0,W.Z)("Vivaldi needs your permission to read the $1 folder.",[n.name]),wQ]}),(0,W.Z)("Select the $1 folder to begin import.",[n.name])]})})}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"button",className:"primary",onClick:this.selectProfileFolder,value:(0,W.Z)("Select $1 Folder",[n.name||"Profile"])}),(0,zn.jsx)("input",{type:"button",onClick:this.handleOnCloseDialog,value:(0,W.Z)("Cancel")})]})]}),(0,zn.jsx)("div",{ref:this.props.forwardRef,className:"welcome-content-outer",children:(0,zn.jsxs)("div",{className:"welcome-content-inner welcome-center-horizontal welcome-center-vertical",children:[(0,zn.jsx)("h1",{children:this.props.title}),0===s?(0,zn.jsx)("p",{children:this.props.callout[1]}):(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("p",{children:this.props.callout[0]}),(0,zn.jsx)("div",{className:Gn()("cards-container","cards-container-import pad-top"),role:"listbox","aria-label":(0,W.Z)("Installed browsers"),children:t.map(((e,t)=>{const{imageName:s}=CQ(e.name),n=this.state.profileStatus[t];return(0,zn.jsx)(gQ,{done:"COMPLETED"===n,onClick:()=>this.toggleImport(t),selected:this.state.toImport.includes(t),title:"COMPLETED"===n?(0,W.Z)("Imported"):e.name,image:`resources/${s}`},t)}))})]}),this.state.toImport.length?(0,zn.jsx)("input",{type:"submit",className:"welcome-button",onClick:this.importSelected,value:(0,W.Z)("Import Selected")}):(0,zn.jsx)(bQ,{tabIndex:0,className:"welcome-button primary",onClick:this.props.continue,children:e||0===this.state.profiles.length?this.props.continueText:(0,W.Z)("Skip")}),this.state.error&&(0,zn.jsx)("p",{children:this.state.error})]})})]})}}const xQ=yQ,IQ=[Z.kVivaldiCrashReportingConsentGranted],AQ=(I.Z.getEventHandler,(0,Gm.Z)("button",500));var SQ=(0,zn.jsx)("div",{}),ZQ=(0,zn.jsx)("img",{className:"welcome-icon",src:"../../resources/vivaldi-icon-macos.png",alt:""});class TQ extends Un.Component{static contextType=oi.Z;openPrivacyPage=()=>{c.ZP.openURL(this.context.vivaldiWindowId,u.fg)};renderCrashReportingConsent(){return SQ}render(){const e=navigator.deviceMemory<8||navigator.hardwareConcurrency<=4||screen.colorDepth<24||window.matchMedia("(prefers-reduced-motion: reduce)").matches?"startup-static":"startup";return(0,zn.jsxs)("div",{ref:this.props.forwardRef,className:"welcome-content-outer",children:[(0,zn.jsx)("div",{className:"effect-container",style:{backgroundImage:`url('/resources/${e}.svg')`}}),(0,zn.jsxs)("div",{className:"welcome-content-inner welcome-center-horizontal welcome-center-vertical intro",children:[ZQ,(0,zn.jsx)("h1",{children:this.props.title}),(0,zn.jsx)("p",{children:this.props.callout[0]}),(0,zn.jsx)(AQ,{tabIndex:0,className:"welcome-button primary",onClick:this.props.continue,children:this.props.continueText}),this.renderCrashReportingConsent()]})]})}}const EQ=(0,zd.Z)(TQ,IQ),kQ=[Z.kThemeScheduleEnabled,Z.kThemeScheduleOS,Z.kThemeScheduleTimeline,Z.kThemesCurrent,Z.kThemesSystem],NQ=(0,Gm.Z)("button",500);class _Q extends Un.Component{static contextType=oi.Z;context;toggleOSSchedule=()=>{const e="system"===this.props.prefValues[Z.kThemeScheduleEnabled]?"off":"system";I.Z.set(Z.kThemeScheduleEnabled,e)};render(){const{prefValues:e}=this.props,t=On.Z.getCurrentIdWithoutPreview();return(0,zn.jsx)("div",{ref:this.props.forwardRef,className:"welcome-content-outer",children:(0,zn.jsxs)("div",{className:"welcome-content-inner welcome-center-horizontal welcome-center-vertical",children:[(0,zn.jsx)("h1",{children:this.props.title}),(0,zn.jsx)("p",{children:this.props.callout[0]}),(0,zn.jsxs)("label",{className:"welcome-pref-checkbox",children:[(0,zn.jsx)(vE,{value:"system",checked:"system"===e[Z.kThemeScheduleEnabled],onChange:this.toggleOSSchedule}),(0,zn.jsx)("span",{children:this.props.callout[1]})]}),(0,zn.jsx)("div",{className:"cards-container cards-container-themes",role:"listbox","aria-label":(0,W.Z)("Pick a theme"),children:e[Z.kThemesSystem].slice(0,4).map((e=>{const s=e.id===t,n=Gn()("ThemePreview","ThemePreview-Welcome","welcome-card",{"card-is-selected":s});return(0,zn.jsx)(YF,{className:n,theme:e,welcomePage:!0,themeChangeCallback:On.Z.setTheme,isCurrent:s,isSystem:!0},e.id)}))}),(0,zn.jsx)(NQ,{tabIndex:0,className:"welcome-button primary",onClick:this.props.continue,children:this.props.continueText})]})})}}const PQ=(0,zd.Z)(_Q,kQ),MQ="fullyLoaded",DQ="essentials",OQ="https://vivaldi.com/getstarted/",jQ="https://vivaldi.com/getstarted-mail/",LQ=(0,Gm.Z)("button",500),RQ=[Z.kFeaturesMail,Z.kPanelsWindowDefaults,Z.kStatusBarDisplay,Z.kToolbarsNavigation];var BQ=(0,zn.jsx)("div",{className:"card-image",children:(0,zn.jsx)("img",{src:"/resources/welcome-client.webp",alt:""})});class FQ extends Un.Component{static contextType=oi.Z;context;getUIMode=()=>this.props.prefValues[Z.kFeaturesMail]?MQ:DQ;render(){const e=this.context.vivaldiWindowId,t=this.getUIMode()===DQ;return(0,zn.jsx)("div",{ref:this.props.forwardRef,className:"welcome-content-outer",children:(0,zn.jsxs)("div",{className:"welcome-content-inner welcome-center-horizontal welcome-center-vertical",children:[(0,zn.jsxs)("div",{className:"cards-container cards-container-choice",children:[(0,zn.jsxs)("div",{className:"card-text",children:[(0,zn.jsx)("h1",{children:this.props.title}),(0,zn.jsx)("p",{children:this.props.callout[0]}),(0,zn.jsxs)("label",{className:"feature-choice-switch mail-and-calendar",children:[(0,zn.jsx)(vE,{value:t?MQ:DQ,checked:this.props.prefValues[Z.kFeaturesMail],onChange:wt.Z.toggleMail}),(0,zn.jsx)("span",{children:this.props.callout[2]})]})]}),BQ]}),(0,zn.jsx)("link",{rel:"prefetch",href:t?OQ:jQ}),(0,zn.jsx)(LQ,{className:"welcome-button primary",onClick:()=>{!t&&ue.Z.showMailAccountDialog(e),navigator.onLine?c.ZP.openURL(e,t?OQ:jQ,{inCurrent:!0}):this.props.continue()},children:t?this.props.callout[3]:this.props.callout[4]})]})})}}const WQ=(0,zd.Z)(FQ,RQ),UQ=[Z.kTabsBarPosition],VQ={top:{title:(0,W.Z)("Top"),image:s(48753)},left:{title:(0,W.Z)("title","Left"),image:s(31614)},bottom:{title:(0,W.Z)("Bottom"),image:s(34511)},right:{title:(0,W.Z)("title","Right"),image:s(76201)}},HQ=(0,Gm.Z)("button",500);class GQ extends Un.Component{setPosition=e=>{I.Z.set(Z.kTabsBarPosition,e),I.Z.set(Z.kPanelsPosition,"left"===e?"right":"left")};render(){return(0,zn.jsx)("div",{ref:this.props.forwardRef,className:"welcome-content-outer",children:(0,zn.jsxs)("div",{className:"welcome-content-inner welcome-center-horizontal welcome-center-vertical",children:[(0,zn.jsx)("h1",{children:this.props.title}),(0,zn.jsx)("p",{children:this.props.callout[0]}),(0,zn.jsx)("div",{className:"cards-container cards-container-tabs",children:Object.keys(VQ).map((e=>(0,zn.jsx)(gQ,{onClick:this.setPosition.bind(this,e),title:VQ[e].title,selected:e===this.props.prefValues[Z.kTabsBarPosition],svg:VQ[e].image},e)))}),(0,zn.jsx)(HQ,{tabIndex:0,className:"welcome-button primary",onClick:this.props.continue,children:this.props.continueText})]})})}}const KQ=(0,zd.Z)(GQ,UQ),zQ=(0,Gm.Z)("button",500);class $Q extends Un.Component{state={trackerBlockingEnabled:!1,adBlockingEnabled:!1};componentDidMount(){this.updateRules(),re.Z.contentBlocking.onStateChanged.addListener(this.updateRules)}componentWillUnmount(){re.Z.contentBlocking.onStateChanged.removeListener(this.updateRules)}updateRules=()=>{["ad_blocking","tracking"].forEach((e=>{re.Z.contentBlocking.getActiveExceptionsList(e,(t=>{const s="tracking"===e?"trackerBlockingEnabled":"adBlockingEnabled";this.setState({[s]:"exempt_list"===t})}))}))};setNoBlocking=()=>{re.Z.contentBlocking.setActiveExceptionsList("tracking","process_list"),re.Z.contentBlocking.setActiveExceptionsList("ad_blocking","process_list"),this.updateRules()};setTrackerBlocking=()=>{re.Z.contentBlocking.setActiveExceptionsList("tracking","exempt_list"),re.Z.contentBlocking.setActiveExceptionsList("ad_blocking","process_list"),this.updateRules()};setTrackerAndAdBlocking=()=>{re.Z.contentBlocking.setActiveExceptionsList("tracking","exempt_list"),re.Z.contentBlocking.setActiveExceptionsList("ad_blocking","exempt_list"),this.updateRules()};getBlockLevel=()=>{let e=0;return this.state.trackerBlockingEnabled&&(e=1),this.state.trackerBlockingEnabled&&this.state.adBlockingEnabled&&(e=2),e};render(){const e=this.getBlockLevel();return(0,zn.jsx)("div",{ref:this.props.forwardRef,className:"welcome-content-outer",children:(0,zn.jsxs)("div",{className:"welcome-content-inner welcome-center-horizontal welcome-center-vertical",children:[(0,zn.jsx)("h1",{children:this.props.title}),this.props.callout.map(((e,t)=>(0,zn.jsx)("p",{children:e},t))),(0,zn.jsxs)("div",{className:"cards-container card-blocker",role:"listbox","aria-label":(0,W.Z)("Content blocker options"),children:[(0,zn.jsx)(gQ,{onClick:this.setNoBlocking,title:(0,W.Z)("No Blocking"),hasImageZoom:!0,tooltip:(0,W.Z)("No content blocking will be applied to any site by default."),selected:0===e,svg:Kn.Tu3,style:{"--no-blocking":1,"--base":0}}),(0,zn.jsx)(gQ,{onClick:this.setTrackerBlocking,title:(0,W.Z)("Block Trackers"),hasImageZoom:!0,tooltip:(0,W.Z)("Online trackers collect personal information and browsing habits across multiple sites."),selected:1===e,svg:Kn.Tu3,style:{"--trackers":1}}),(0,zn.jsx)(gQ,{onClick:this.setTrackerAndAdBlocking,title:(0,W.Z)("Block Trackers and Ads"),hasImageZoom:!0,tooltip:(0,W.Z)("Web advertisement supports existence of many sites but can also be used to build a personal profile for monetization."),selected:2===e,svg:Kn.Tu3,style:{"--ads":1}})]}),(0,zn.jsx)(zQ,{tabIndex:0,className:"welcome-button primary",onClick:this.props.continue,children:this.props.continueText})]})})}}const YQ=$Q;var XQ=s(55667);const QQ=[Z.kTabsBarPosition,Z.kWelcomeReadPages],qQ={enter:1e3,exit:1e3};var JQ=(0,zn.jsx)("svg",{className:"guest-intro-background",viewBox:"0 0 1244 860",children:(0,zn.jsx)("path",{fill:"url(#guest-intro-bg-gradient)",d:"M0 0h153.513c16.141 27.93 32.15 55.734 47.912 83.11 16.086 27.94 32.722 56.832 49.076 85.128 11.01 19.031 22.079 38.316 32.781 56.967 25.186 43.883 51.228 89.259 77.402 132.848 33.382 55.651 75.894 82.121 137.77 85.829 3.205.192 6.454.288 9.655.288 39.673 0 78.14-14.461 108.316-40.722 21.644-18.834 48.687-52.291 54.604-104.667.749-6.654 1.357-13.708 1.855-19.573-1.07-29.74-6.476-52.92-17.294-74.518C622.935 139.46 612.708 67.99 625.087 0h136.676C747.1 44.93 749.845 96.364 774.32 145.251c20.839 41.6 30.654 85.7 31.485 138.023-.568 6.192-1.472 18.273-2.83 30.356-17.572 155.524-149.172 263.318-294.866 263.318-5.816 0-11.67-.173-17.526-.521C382.84 569.97 301.9 518.174 246.822 426.358c-38.015-63.313-74.255-127.68-111.253-191.634C90.359 156.507 45.49 78.062 0 0zm1113.47 0H1244v140.1c-7.496 27.86-18.849 54.995-34.031 81.275a1299530.57 1299530.57 0 0 1-170.255 294.799A1223193.145 1223193.145 0 0 0 841.018 860.24H687.72c135.675-235.123 271.527-470.147 407.26-705.25 22.311-38.621 31.22-79.696 25.368-124.548A170.12 170.12 0 0 0 1113.471 0z"})});function eq(e){return(0,zn.jsxs)("div",{className:"guest-intro",children:[JQ,(0,zn.jsxs)("div",{className:"guest-intro-content",children:[(0,zn.jsx)("h1",{children:(0,W.Z)("Welcome Page Unavailable")}),(0,zn.jsx)("p",{children:(0,W.Z)("Welcome page is not available in guest windows.")}),(0,zn.jsx)("p",{children:(0,zn.jsx)("a",{tabIndex:0,href:BC,onClick:t=>FC(e.windowId,t),children:(0,W.Z)("Learn more about Guest Profiles")})})]})]})}class tq extends Un.Component{static contextType=oi.Z;ref={};constructor(e,t){super(e);const s=this.getNextUnread(),n=Object.keys(Cn),i=s||n[n.length-1];n.forEach((e=>this.ref[e]=Un.createRef())),this.state={currentPageKey:i,shouldShowImport:!0,shouldShowAccount:!0}}componentDidMount(){In.isFirstStart()&&"intro"===this.state.currentPageKey&&this.setCurrentPageRead(),this.setDocumentTitle(this.state.currentPageKey);const e="loggedIn"!==pe(me.getState());S_().then((t=>this.setState({shouldShowImport:!t,shouldShowAccount:e})))}setDocumentTitle=e=>{const t=this.context.vivaldiWindowId,s=Ze.ZP.getActivePage(t)?.id;s&&c.ZP.setTitle(s,t,Cn[e])};setPage=e=>{this.scrollToTop(),this.setDocumentTitle(e),this.setState({currentPageKey:e},(()=>this.setCurrentPageRead()))};getNextUnread=e=>{const t=Object.keys(Cn),s=this.props.prefValues[Z.kWelcomeReadPages],n=e?t.indexOf(e):-1;for(let e=-1;e<t.length;e++){const i=e+1;if(t[i]&&!s.includes(t[i])&&i>n)return t[i]}return In.getUnreadPageKeys()[0]};getFilteredKeys=()=>Object.keys(Cn).filter((e=>!("account"===e&&!this.state.shouldShowAccount||"import_data"===e&&!this.state.shouldShowImport)));getNextPageKey=()=>{const e=this.getFilteredKeys();return e?.find(((t,s)=>this.state.currentPageKey===e[s-1]))};setCurrentPageRead=()=>{const e=this.props.prefValues[Z.kWelcomeReadPages],t=this.state.currentPageKey;e.includes(t)||I.Z.set(Z.kWelcomeReadPages,e.concat([t]))};continue=()=>{const e=this.getNextPageKey();if(e)this.setPage(e);else{const e=this.context.vivaldiWindowId;c.ZP.openURL(e,Ze.ZP.getDefaultStartpage(e),{inCurrent:!0})}};getContinueText=()=>In.getUnreadPageKeys().length===Object.keys(Cn).length&&this.state.currentPageKey===Object.keys(Cn)[0]?(0,W.Z)("Let’s Go"):(0,W.Z)("Continue");scrollToTop=()=>{const{Element:e}=this.context,t=this.ref[this.state.currentPageKey].current;t instanceof e&&t.scrollTo({behavior:"smooth",top:0})};render(){if(fe.ZP.isGuest())return(0,zn.jsx)(eq,{windowId:this.context.vivaldiWindowId});const e=this.getContinueText(),{prefValues:t}=this.props;return(0,zn.jsxs)("div",{className:Gn()("welcome-wrapper",this.state.currentPageKey),children:[(0,zn.jsxs)(XQ.Z,{className:"welcome-content",children:["intro"===this.state.currentPageKey&&(0,zn.jsx)(Jb.Z,{classNames:"welcome-page",timeout:qQ,nodeRef:this.ref[this.state.currentPageKey],children:(0,zn.jsx)(EQ,{forwardRef:this.ref[this.state.currentPageKey],continue:this.continue,continueText:e,title:Cn[this.state.currentPageKey],callout:wn[this.state.currentPageKey]})}),"account"===this.state.currentPageKey&&(0,zn.jsx)(Jb.Z,{classNames:"welcome-page",timeout:qQ,nodeRef:this.ref[this.state.currentPageKey],children:(0,zn.jsx)(cQ,{ref:this.ref[this.state.currentPageKey],continue:this.continue,continueText:e,title:Cn[this.state.currentPageKey],callout:wn[this.state.currentPageKey]})}),"welcome_feature_amount"===this.state.currentPageKey&&(0,zn.jsx)(Jb.Z,{classNames:"welcome-page",timeout:qQ,nodeRef:this.ref[this.state.currentPageKey],children:(0,zn.jsx)(WQ,{forwardRef:this.ref[this.state.currentPageKey],continue:this.continue,continueText:e,title:Cn[this.state.currentPageKey],callout:wn[this.state.currentPageKey]})}),"tracker_and_ad"===this.state.currentPageKey&&(0,zn.jsx)(Jb.Z,{classNames:"welcome-page",timeout:qQ,nodeRef:this.ref[this.state.currentPageKey],children:(0,zn.jsx)(YQ,{forwardRef:this.ref[this.state.currentPageKey],continue:this.continue,continueText:e,title:Cn[this.state.currentPageKey],callout:wn[this.state.currentPageKey]})}),"import_data"===this.state.currentPageKey&&(0,zn.jsx)(Jb.Z,{classNames:"welcome-page",timeout:qQ,nodeRef:this.ref[this.state.currentPageKey],children:(0,zn.jsx)(xQ,{forwardRef:this.ref[this.state.currentPageKey],continue:this.continue,continueText:e,title:Cn[this.state.currentPageKey],callout:wn[this.state.currentPageKey]})}),"personalize"===this.state.currentPageKey&&(0,zn.jsx)(Jb.Z,{classNames:"welcome-page",timeout:qQ,nodeRef:this.ref[this.state.currentPageKey],children:(0,zn.jsx)(PQ,{forwardRef:this.ref[this.state.currentPageKey],continue:this.continue,continueText:e,title:Cn[this.state.currentPageKey],callout:wn[this.state.currentPageKey]})}),"tabs"===this.state.currentPageKey&&(0,zn.jsx)(Jb.Z,{classNames:"welcome-page",timeout:qQ,nodeRef:this.ref[this.state.currentPageKey],children:(0,zn.jsx)(KQ,{forwardRef:this.ref[this.state.currentPageKey],continue:this.continue,continueText:e,title:Cn[this.state.currentPageKey],callout:wn[this.state.currentPageKey]})})]}),(0,zn.jsx)("nav",{className:"welcome-navigation",children:this.getFilteredKeys()?.map((e=>(0,zn.jsx)("button",{onClick:()=>this.setPage(e),title:Cn[e],tabIndex:-1,className:Gn()("nav-page",{"nav-page-current":e===this.state.currentPageKey,"nav-page-completed":e!==this.state.currentPageKey&&t[Z.kWelcomeReadPages].includes(e)})},e)))})]})}}const sq=(0,zd.Z)(tq,QQ);var nq=(0,zn.jsx)(sq,{},"welcome"),iq=(0,zn.jsx)(oQ,{},"welcome"),aq=(0,zn.jsx)(RC,{},"experiments"),oq=(0,zn.jsx)(VC,{},"guest-intro"),rq=(0,zn.jsx)(Fx,{},"private-intro"),lq=(0,zn.jsx)(MC,{},"actionlog"),dq=(0,zn.jsx)(Wx,{}),cq=(0,zn.jsx)("div",{},"mailmessage"),hq=(0,zn.jsx)("div",{},"chat"),uq=(0,zn.jsx)(Gx,{});class pq extends Un.PureComponent{static contextType=oi.Z;refComponent=Un.createRef();focus=()=>{const e=this.refComponent.current,{document:t,HTMLDivElement:s}=this.context;if(!(e instanceof s))return;if(e.contains(t.activeElement))return;const n=e.querySelector('[tabindex="0"]:not(.no-page-focus)');n?.focus()};getComponent=()=>{const{url:e}=this.props;if(vs.jk.matchInternal("welcome",e))return nq;if(vs.jk.matchInternal("themecolors",e))return iq;if(vs.jk.matchInternal("settings",e))return(0,zn.jsx)(SV,{url:e,isActive:this.props.isActive},"settings");if(vs.jk.matchInternal("experiments",e))return aq;if(vs.jk.matchInternal("guest-intro",e))return oq;if(vs.jk.matchInternal("private-intro",e))return rq;if(vs.jk.matchInternal("actionlog",e))return lq;if(vs.jk.matchInternal("saga",e))return dq;if(vs.jk.matchInternal("mailpage",e)){if(wt.Z.isFeedsOn()){if(vs.jk.matchUrl(vs.jk.internalUrl("mailpage","composer"),e)){const t=(0,Ar.DP)(e);let s;if(t.query)try{const e=JSON.parse(t.query);"object"==typeof e&&e.id&&bt.Z.isInDraftOrOutbox(e.id)&&(s=e.id)}catch(e){console.warn(e)}return(0,zn.jsx)(Pw,{pageId:this.props.pageId,searchListId:s,mailto:t.mailto,url:e,isActive:this.props.isActive},"mail")}if(vs.jk.matchUrl(vs.jk.internalUrl("mailpage","message"),e)){let t=-1;const s=(0,Ar.DP)(e);if(s.path){const e=s.path.split("/");2===e.length&&(t=parseInt(e[1]))}return t>-1?(0,zn.jsx)(jw,{id:t,isActive:this.props.isActive},"mailmessage"):cq}return(0,zn.jsx)(Dx,{id:this.props.pageId,isActive:this.props.isActive},"mailview")}return(0,zn.jsx)(Mw,{windowId:this.context.vivaldiWindowId})}if(vs.jk.matchInternal("chat",e)&&Fn.Z.isEnabled("chat")){const t=new URL(e).searchParams.get("path");t&&t.includes("@");return hq}return vs.jk.matchInternal("session-recovery",e)?uq:null};render(){const{isVisible:e,url:t}=this.props;let s=Ux.SpeedDial;const n=vs.jk.isStartPage(t);return(0,vs.rl)(t)&&(vs.jk.matchInternal("bookmarks",t)?s=Ux.Bookmarks:vs.jk.matchInternal("history",t)?s=Ux.History:vs.jk.matchInternal("calendar",t)?s=Ux.Calendar:vs.jk.matchInternal("notes",t)&&(s=Ux.NotesManager)),(0,zn.jsx)("div",{className:"internal-page",ref:this.refComponent,children:(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)(iQ,{open:n&&e||s!==Ux.SpeedDial,pageId:this.props.pageId,url:t,view:s,updatePageThumbnailWithActiveWebview:this.props.updatePageThumbnailWithActiveWebview,isActive:this.props.isActive},"startpage"),this.getComponent()]})})}}const gq=pq;var mq=s(7168);const fq=new class{setUtilityWebView(e,t){S.Z.dispatch({actionType:"UTILITY_WEBVIEW_SET_VIEW",windowId:e,webview:t})}};class vq extends Un.PureComponent{refWebView=Un.createRef();componentDidMount(){const e=this.refWebView.current;e&&(e.addEventListener("contentload",this.handleContentload),e.addEventListener("contentscreated",this.handleContentscreated),e.addEventListener("createsearch",this.handleCreatesearch),e.addEventListener("contentallowed",this.handleContentallowed),e.addEventListener("contentblocked",this.handleContentblocked),e.addEventListener("dialog",this.handleDialog),e.addEventListener("findupdate",this.handleFindupdate),e.addEventListener("fullscreen",this.handleFullscreen),e.addEventListener("loadabort",this.handleLoadabort),e.addEventListener("loadcommit",this.handleLoadcommit),e.addEventListener("loadprogress",this.handleLoadprogress),e.addEventListener("loadredirect",this.handleLoadredirect),e.addEventListener("loadstart",this.handleLoadstart),e.addEventListener("loadstop",this.handleLoadstop),e.addEventListener("newwindow",this.handleNewwindow),e.addEventListener("pasteandgo",this.handlePasteandgo),e.addEventListener("permissionrequest",this.handlePermissionrequest),e.addEventListener("sslstatechanged",this.handleSslstatechanged),e.addEventListener("targeturlchanged",this.handleTargetUrlChanged),e.addEventListener("windowblocked",this.handleWindowblocked),this.props.discarded&&this.props.isVisible&&re.Z.tabsPrivate.loadViaLifeCycleUnit(this.props.id),re.Z.tabsPrivate.update(this.props.id,{showImages:"never"!==A.Z.get(Z.kPageImageLoading),loadFromCacheOnly:"cache"===A.Z.get(Z.kPageImageLoading)}))}componentWillUnmount(){const e=this.refWebView.current;e&&(e.removeEventListener("contentload",this.handleContentload),e.removeEventListener("contentscreated",this.handleContentscreated),e.removeEventListener("createsearch",this.handleCreatesearch),e.removeEventListener("contentallowed",this.handleContentallowed),e.removeEventListener("contentblocked",this.handleContentblocked),e.removeEventListener("dialog",this.handleDialog),e.removeEventListener("findupdate",this.handleFindupdate),e.removeEventListener("fullscreen",this.handleFullscreen),e.removeEventListener("loadabort",this.handleLoadabort),e.removeEventListener("loadcommit",this.handleLoadcommit),e.removeEventListener("loadprogress",this.handleLoadprogress),e.removeEventListener("loadredirect",this.handleLoadredirect),e.removeEventListener("loadstart",this.handleLoadstart),e.removeEventListener("loadstop",this.handleLoadstop),e.removeEventListener("newwindow",this.handleNewwindow),e.removeEventListener("pasteandgo",this.handlePasteandgo),e.removeEventListener("permissionrequest",this.handlePermissionrequest),e.removeEventListener("sslstatechanged",this.handleSslstatechanged),e.removeEventListener("targeturlchanged",this.handleTargetUrlChanged),e.removeEventListener("windowblocked",this.handleWindowblocked))}componentDidUpdate(){this.props.discarded&&this.props.isVisible&&re.Z.tabsPrivate.loadViaLifeCycleUnit(this.props.id)}handleContentload=e=>{this.props.onContentLoad?.(e)};handleContentscreated=e=>{this.props.onContentsCreated?.(e)};handleCreatesearch=e=>{this.props.onCreateSearch?.(e)};handleContentallowed=e=>{this.props.onContentAllowed?.(e)};handleContentblocked=e=>{this.props.onContentBlocked?.(e)};handleDialog=e=>{this.props.onDialog?.(e)};handleFindupdate=e=>{this.props.onFindUpdate?.(e)};handleFullscreen=e=>{this.props.onFullscreen?.(e)};handleLoadabort=e=>{this.props.onLoadAbort?.(e)};handleLoadcommit=e=>{this.props.onLoadCommit?.(e)};handleLoadprogress=e=>{this.props.onLoadProgress?.(e)};handleLoadredirect=e=>{this.props.onLoadRedirect?.(e)};handleLoadstart=e=>{this.props.onLoadStart?.(e)};handleLoadstop=e=>{this.props.onLoadStop?.(e)};handleNewwindow=e=>{this.props.onNewWindow?.(e)};handlePasteandgo=e=>{this.props.onPasteAndGo?.(e)};handlePermissionrequest=e=>{this.props.onPermissionRequest?.(e)};handleSslstatechanged=e=>{this.props.onSslStateChanged?.(e)};handleTargetUrlChanged=e=>{this.props.onTargetUrlChanged?.(e)};handleWindowblocked=e=>{this.props.onWindowBlocked?.(e)};canGoBack=()=>!!this.refWebView.current&&this.refWebView.current.canGoBack();canGoForward=()=>!!this.refWebView.current&&this.refWebView.current.canGoForward();executeScript=e=>new Promise(((t,s)=>{this.refWebView.current?.executeScript(e,(e=>{n.Z.runtime.lastError?s(n.Z.runtime.lastError.message):t(e)}))}));reload=()=>{this.refWebView.current?.reload()};stop=()=>{this.refWebView.current?.stop()};sendRequest=(e,t,s,n,i,a)=>{this.refWebView.current?.sendRequest(e,t,s,n,i,a)};render(){return(0,zn.jsx)("webview",{ref:this.refWebView,role:"document",id:this.props.id,tab_id:this.props.id})}}var bq=s(2497);var Cq=s(34155);const wq=[Z.kFeaturesMail,Z.kRssDetectFeeds,Z.kWebpagesReaderControls,Z.kWebpagesReaderStyle],yq=(0,Te.Z)((e=>e()));var xq=(0,zn.jsx)(sU,{prefs:!1,filter:""});class Iq extends Un.PureComponent{static contextType=oi.Z;captureScheduled=!1;viewUnchangedFlags={};_localStatus=!1;refInternalPage=Un.createRef();refWebview=Un.createRef();nodeRef=Un.createRef();constructor(e){super(e),this.state={draggedLength:null,activeDialogs:new Map,dockingState:"off",undockedIsUnmounted:!0,undockedDevtoolsWindowId:void 0,pendingDockingState:void 0,viewWidth:"auto",viewHeight:"auto",viewTop:0,viewLeft:0,hideInspectedContents:!1,disableWebviewEvents:!1,tabIsFullscreen:!1,mediaState:mq.Z.getState().get(this.props.id)||(0,qe.l4)()}}componentDidMount(){this.attachEventHandlers(),this.updateFocus(this.props.id,this.props.url),this.props.isActive&&Cq.nextTick((()=>{const e=this.getWebviewElement();e&&fq.setUtilityWebView(this.context.vivaldiWindowId,e)})),mq.Z.addListener(this._onMediaStateStoreChanged)}componentDidUpdate(e,t){const{target:s}=this.props;if(s&&s!==e.target){const{transition:e,fromUrlField:t,postParams:n,headers:i}=s;this.props.url&&Cq.nextTick((()=>{this.refWebview.current?.sendRequest(this.props.url,e,Boolean(t),void 0!==n&&""!==n,n||"",i||"")}))}if(this.props.url!==e.url){let t="",s="";try{t=new URL(e.url).origin}catch(e){}try{s=new URL(this.props.url).origin}catch(e){}t!==s&&Cq.nextTick((()=>{yv.Z.resetPermissions(e.id),yv.Z.resetPageHasBlockedContent(e.id),yv.Z.resetBlockedPopups(e.id)}))}(s&&s!==e.target||e.url!==this.props.url||e.isActive!==this.props.isActive||e.discarded!==this.props.discarded)&&this.updateFocus(this.props.id,this.props.url);const n=this.getWebviewElement();if(n){const t=e.discarded&&!this.props.discarded,s=(!e.isActive||t)&&this.props.isActive;if(s){Cq.nextTick((()=>fq.setUtilityWebView(this.context.vivaldiWindowId,n)));!this.props.vivExtData.thumbnail&&Cq.nextTick((()=>{this.updatePageThumbnailWithActiveWebview(0)}))}const i=e.isActive&&!this.props.isActive,a=(0,vs.cw)(e.url),o=(0,vs.cw)(this.props.url),r=!a&&o;o||!s&&!a?(i||r)&&Cq.nextTick((()=>{if(this.clearWebview(),this.state.tabIsFullscreen){this.getWebviewElement()?.setIsFullscreen(!1)}})):Cq.nextTick((()=>{const e=this.getWebviewElement();e&&Fb.Z.setActiveWebView(this.context.vivaldiWindowId,e)}))}Boolean(this.props.vivExtData.readerMode)!==Boolean(e.vivExtData.readerMode)&&(this.props.vivExtData.readerMode?Ue.Z.ensureAddedListener(this.updateReaderStyle):Ue.Z.ensureRemovedListener(this.updateReaderStyle),this.refWebview.current?.reload()),this.props.prefValues[Z.kWebpagesReaderStyle]!==e.prefValues[Z.kWebpagesReaderStyle]&&this.updateReaderStyle(),this.updateViewUnchangedFlag(e,this.props);const i=e.prefValues[Z.kRssDetectFeeds],a=!this.props.prefValues[Z.kRssDetectFeeds];i&&a&&un.resetRssFeeds(this.props.id)}componentWillUnmount(){this.state.tabIsFullscreen&&Cq.nextTick((()=>{Wn.Z.restoreStateAfterHTMLFullscreen(this.context.vivaldiWindowId)})),this.removeEventHandlers(),re.Z.devtoolsPrivate.closeDevtools(this.props.id,(e=>{})),this.state.undockedDevtoolsWindowId&&Wn.Z.close(this.state.undockedDevtoolsWindowId),Cq.nextTick(this.clearWebview),mq.Z.removeListener(this._onMediaStateStoreChanged),Ue.Z.ensureRemovedListener(this.updateReaderStyle)}_onMediaStateStoreChanged=()=>{this.setState({mediaState:mq.Z.getState().get(this.props.id)||(0,qe.l4)()})};updateReaderStyle=()=>{hn.Z.setReaderModeStyle(this.context.vivaldiWindowId)};getWebviewElement=()=>this.refWebview.current?.refWebView.current;clearWebview=()=>{const e=this.getWebviewElement();e&&Fb.Z.clearIfActive(this.context.vivaldiWindowId,e)};toggleImageInspector=()=>{c.ZP.setImageInspector(this.props.id,this.context.vivaldiWindowId,!this.props.showImageInspector)};updateViewUnchangedFlag=(e,t)=>{e.isActive===t.isActive&&e.vivExtData.tiling===t.vivExtData.tiling||(this.viewUnchangedFlags={})};shouldCaptureThumbnail=()=>A.Z.get(Z.kTabsTooltip)||A.Z.get(Z.kTabsThumbnails)||A.Z.get(Z.kTabsVisualSwitchEnable);updatePageThumbnailWithActiveWebview=e=>{const t=fe.ZP.isIncognitoOrGuest(this.context.vivaldiWindowId),s=crypto.randomUUID();this.shouldCaptureThumbnail()&&(this.viewUnchangedFlags[s]=!0===this.props.isActive,setTimeout((()=>{const e=this.getWebviewElement();if(e)if((0,vs.cw)(this.props.url))this.viewUnchangedFlags[s]&&e&&Ma.getPageThumbnail(e,{compact:!0},(e=>{this.props.isActive&&this.viewUnchangedFlags[s]&&e&&c.ZP.setThumbnail(this.props.id,e)}));else{const e={encodeFormat:"jpg",encodeQuality:80,fullPage:!1,width:330,height:270};re.Z.thumbnails.captureTab(this.props.id,e,((e,t)=>{!n.Z.runtime.lastError&&e&&c.ZP.setThumbnail(this.props.id,t)}))}}),e));const{bookmarkThumbnailQueue:i}=this.props.pageContext;if(!t&&i&&i.url===this.props.url){const e=i.bookmarkId;n.Z.bookmarks.get(e,(t=>{if(n.Z.runtime.lastError)console.warn("chrome.bookmarks.get failed:",e,n.Z.runtime.lastError);else{const e=t&&1===t.length?t[0]:null,i=this.getWebviewElement();e&&!e.thumbnail&&i&&Ma.getPageThumbnail(i,{compact:!1},(t=>{t&&(this.props.isActive&&e&&this.viewUnchangedFlags&&this.viewUnchangedFlags[s]?n.Z.bookmarks.update(e.id,{thumbnail:t}):console.warn("Cannot update thumbnail as page was not active"))}))}})),this.props.pageContext.bookmarkThumbnailQueue=void 0}};attachEventHandlers=()=>{Ca.Z.addListener(this._onWebpageviewStoreChanged),re.Z.devtoolsPrivate.onDockingSizesChanged.addListener(this.onDockingSizesChanged),re.Z.devtoolsPrivate.onDockingStateChanged.addListener(this.onDockingStateChanged),re.Z.devtoolsPrivate.onClosed.addListener(this.onDevtoolsClosed),re.Z.devtoolsPrivate.onDevtoolsUndocked.addListener(this.onDevtoolsUndocked),re.Z.tabsPrivate.onTabIsAttached.addListener(this.onWebViewElementIsAttached),re.Z.tabsPrivate.onTabIsDetached.addListener(this.onWebViewElementIsDetached)};removeEventHandlers=()=>{Ca.Z.removeListener(this._onWebpageviewStoreChanged),re.Z.devtoolsPrivate.onDockingSizesChanged.removeListener(this.onDockingSizesChanged),re.Z.devtoolsPrivate.onDockingStateChanged.removeListener(this.onDockingStateChanged),re.Z.devtoolsPrivate.onClosed.removeListener(this.onDevtoolsClosed),re.Z.devtoolsPrivate.onDevtoolsUndocked.removeListener(this.onDevtoolsUndocked),re.Z.tabsPrivate.onTabIsAttached.removeListener(this.onWebViewElementIsAttached),re.Z.tabsPrivate.onTabIsDetached.removeListener(this.onWebViewElementIsDetached)};updateNavigationState=(e,t,s)=>{const n={canGoBack:Boolean(this.refWebview.current?.canGoBack()),canGoForward:Boolean(this.refWebview.current?.canGoForward()),isLoading:e,reason:s,trigger:t};yv.Z.setNavigationState(this.props.id,this.context.vivaldiWindowId,n,this.props.pageContext.isUrlFieldFocused)};handleLoadCommit=e=>{if(!e.isTopLevel||void 0===e.url)return;const{url:t}=e;un.resetRssFeeds(this.props.id),(0,vs.cw)(t)&&Me.Z.setFastForwardUrl(this.props.id,"");const s=this.getWebviewElement();s&&Me.Z.setRewindInfo(s,this.props.id),this.updateNavigationState(!0,"commit")};handleLoadStart=e=>{if(!e.isTopLevel)return;const{urlForThumbnail:t}=this.props.vivExtData;t!==e.url&&c.ZP.setThumbnail(this.props.id,null),yv.Z.resetPermissions(this.props.id),sp.Z.closeFindInPageToolbar(this.context.vivaldiWindowId,this.props.id),this.updateNavigationState(!0,"start"),yv.Z.resetPageHasBlockedContent(this.props.id),yv.Z.resetBlockedPopups(this.props.id),jn.Z.resetTranslationParameters(this.props.id),this.props.pageContext.isUrlFieldFocused||vg.Z.reset(this.props.id),this.captureScheduled=!1};handleLoadStop=e=>{this.updateNavigationState(!1,"stop"),this.props.vivExtData.thumbnail||this.updatePageThumbnailWithActiveWebview(0),!1===this.captureScheduled&&(this.captureScheduled=!0,this.updatePageThumbnailWithActiveWebview(5e3))};handleLoadRedirected=e=>{if(e.isTopLevel){const t=e.newUrl,s=e.oldUrl;c.ZP.setThumbnail(this.props.id,null),this.captureScheduled=!1;const{bookmarkThumbnailQueue:n}=this.props.pageContext;n&&n.url===s&&(n.url=t)}};handleContentAllowed=({allowedType:e})=>{if("midi"===e||"midi-sysex"===e||"geolocation"===e||"notifications"===e){const t=this.props.url?new URL(this.props.url).origin:"";yv.Z.setPermission(this.props.id,t,e,null,"allowed")}};handleContentBlocked=({blockedType:e})=>{if("popups"!==e&&"sound"!==e&&"notifications"!==e&&"idle-detection"!==e&&"sensors"!==e&&"geolocation"!==e&&"clipboard"!==e)if("midi"===e||"midi-sysex"===e){const t=this.props.url?new URL(this.props.url).origin:"";yv.Z.setPermission(this.props.id,t,e,null,"blocked")}else yv.Z.setPageHasBlockedContent(this.props.id,e)};handleLoadAbort=e=>{e.preventDefault(),e.isTopLevel&&this.updateNavigationState(!1,"abort",e.reason)};handleOnLoadProgress=e=>{if((0,vs.pM)(e.url))return;const t={url:e.url,progress:e.progress,loadedBytes:e.loadedBytes,loadedElements:e.loadedElements,totalElements:e.totalElements,isFetching:!1};(class{static setProgressState(e,t){S.Z.dispatch({actionType:"PAGE_SET_PROGRESS",pageId:e,progressState:t})}}).setProgressState(this.props.id,t)};handleOnFullscreen=e=>{!1===mq.Z.hasMediaState(this.props.id,"capturing")&&Wn.Z.onHTML5FullScreen(e.enterFullscreen,e.windowId),this.setState({tabIsFullscreen:e.enterFullscreen})};handleBlockedPopup=e=>{yv.Z.addBlockedPopupEvent(this.props.id,e)};onNewPopup=e=>{e.targetUrl||(e.targetUrl=u.f4);const t=fe.ZP.isIncognito(this.context.vivaldiWindowId);ue.Z.openNewPopAsTabOrWindow(this.context.vivaldiWindowId,e,t)};handleOnNewWindow=e=>{const t=fe.ZP.isPopup(this.context.vivaldiWindowId);let s=t?0:this.context.vivaldiWindowId;const n=fe.ZP.isIncognito(this.context.vivaldiWindowId);if(t)for(const[e]of fe.ZP.getState()){if(n&&fe.ZP.isIncognitoOrGuest(e)&&fe.ZP.isTabbedBrowser(e)){s=e;break}if(fe.ZP.isTabbedBrowser(e)){s=e;break}}let i=e.windowOpenDisposition;switch(0===s&&(i=n?"off_the_record":"new_window"),i){case"current_tab":case"new_foreground_tab":e.preventDefault(),e.window.accept(s+";1");break;case"new_background_tab":e.preventDefault(),e.window.accept(s+";0");break;case"off_the_record":case"new_window":e.preventDefault();const t="off_the_record"===e.windowOpenDisposition?{incognito:!0,transition:re.Z.historyPrivate.TransitionType.LINK}:{};Wn.Z.openBrowserWindow(this.context.vivaldiWindowId,e.targetUrl,t);break;case"new_popup":e.preventDefault(),this.onNewPopup(e)}};showDialog=e=>{e.webview=this.getWebviewElement(),this.setState((t=>{const s=new Map(t.activeDialogs);return s.set(e.dialogtype,e),{activeDialogs:s}}))};handleOnCloseDialog=e=>{this.setState((t=>{const s=new Map(t.activeDialogs);return s.delete(e),{activeDialogs:s}}))};handleOnJavascriptDialog=e=>{e.preventDefault(),e.dialogtype="javascript",e.url.startsWith(u.Fv)?re.Z.extensionActionUtils.getToolbarExtensions((t=>{const{url:s}=e,n=s?.replace(u.Fv,"").split("/")[0],i=t.filter((e=>e.id===n))[0]?.name;this.showDialog({...e,url:i})})):this.showDialog(e)};handleOnPermissionRequest=e=>{e.preventDefault();const t=e.url?new URL(e.url).origin:"";switch(e.permission){case"geolocation":case"idle_detection":case"clipboard":case"microphone":case"microphone_and_camera":case"midi":case"midi-sysex":case"camera":case"notifications":case"protocol_handling":yv.Z.setPermission(this.props.id,t,e.permission,e.request,"undecided",e.protocolDisplayName,e.suppressedPrompt);break;case"pointerLock":e.request.allow(),e.dialogtype=e.permission,this.showDialog(e);break;case"download":_e.Z.doDownload(e,this.context,this.getWebviewElement());break;case"media":e.request.allow();break;default:e.dialogtype=e.permission,this.showDialog(e)}};handleOnSSLStateChanged=e=>{if(e.SSLState){const t={state:e.SSLState,issuer:e.issuerstring};yv.Z.setSSLState(this.props.id,t)}};handleOnTargetURLChanged=e=>{const t=(0,Bb.ZP)(e.newUrl);h.Z.setStatus(this.context.vivaldiWindowId,t),this._localStatus=!0};handleOnCreateSearch=e=>{e.dialogtype="createSearch",this.showDialog(e)};handleOnPasteAndGo=e=>{e.preventDefault();const t={ctrlKey:e.modifiers.includes("ctrl"),shiftKey:e.modifiers.includes("shift"),altKey:e.modifiers.includes("alt"),metaKey:!1},s=this.context.vivaldiWindowId,n=e.clipBoardText,i=(0,fo.ZP)(s,t,re.Z.historyPrivate.TransitionType.TYPED);"search"===e.pasteTarget&&sp.Z.doAction(s,this.props.id,"searchPasteAndGo",{clipboardText:n,openOptions:i}),"url"===e.pasteTarget&&sp.Z.doAction(s,this.props.id,"urlPasteAndGo",{clipboardText:n,openOptions:i})};_onWebpageviewStoreChanged=e=>{if(e.pageId!==this.props.id)return;const t=this.getWebviewElement();switch(e.type){case"WEBPAGEVIEW_CLOSE_FIND_IN_PAGE":return t?.stopFinding("keep"),void this.focusWebView(this.props.url);case"WEBPAGEVIEW_GO":return this.props.vivExtData.readerMode&&c.ZP.setReaderState(e.pageId,!1),void t?.go(e.index);case"WEBPAGEVIEW_BACK":return this.props.vivExtData.readerMode&&c.ZP.setReaderState(e.pageId,!1),void t?.back();case"WEBPAGEVIEW_FORWARD":return this.props.vivExtData.readerMode&&c.ZP.setReaderState(e.pageId,!1),void t?.forward();case"WEBPAGEVIEW_GET_HISTORY":return void t?.getPageHistory(e.callback);case"WEBPAGEVIEW_STOP":{const e=cg.getNavigationInfo(this.props.id);return void((!e||e&&e.isLoading)&&this.refWebview.current?.stop())}case"WEBPAGEVIEW_RELOAD":return void(this.props.id===e.pageId&&n.Z.tabs.reload(e.pageId,{bypassCache:e.bypassCache}));case"WEBPAGEVIEW_ACTIONS":switch(e.action){case"focusWebView":return void this.focusWebView(this.props.url);case"pageScrollUp":return void this.pageScrollUp();case"pageScrollDown":return void this.pageScrollDown();case"pageScrollTop":return void this.pageScrollTop();case"pageScrollBottom":return void this.pageScrollBottom();case"print":{const e=this.context.vivaldiWindowId,s=af.Z.getActiveWebView(e);return void(s===t?re.Z.utilities.print(e):s&&s.print())}}}};focusWebView=e=>{(0,vs.cw)(e)?this.refInternalPage.current?.focus():this.getWebviewElement()?.focus()};pageScrollUp=()=>{const e=Ze.ZP.getActivePage(this.context.vivaldiWindowId);e&&re.Z.tabsPrivate.scrollPage(e.id,"pageup",0,(()=>{n.Z.runtime.lastError&&console.warn("vivaldi.tabsPrivate.scrollPage failed: "+(n.Z.runtime.lastError.message||""))}))};pageScrollDown=()=>{const e=Ze.ZP.getActivePage(this.context.vivaldiWindowId);e&&re.Z.tabsPrivate.scrollPage(e.id,"pagedown",0,(()=>{n.Z.runtime.lastError&&console.warn("vivaldi.tabsPrivate.scrollPage failed: "+(n.Z.runtime.lastError.message||""))}))};pageScrollTop=()=>{const e=Ze.ZP.getActivePage(this.context.vivaldiWindowId);e&&re.Z.tabsPrivate.scrollPage(e.id,"top",0,(()=>{n.Z.runtime.lastError&&console.warn("vivaldi.tabsPrivate.scrollPage failed: "+(n.Z.runtime.lastError.message||""))}))};pageScrollBottom=()=>{const e=Ze.ZP.getActivePage(this.context.vivaldiWindowId);e&&re.Z.tabsPrivate.scrollPage(e.id,"bottom",0,(()=>{n.Z.runtime.lastError&&console.warn("vivaldi.tabsPrivate.scrollPage failed: "+(n.Z.runtime.lastError.message||""))}))};onKeyDown=e=>{"Escape"===e.key&&sp.Z.closeFindInPageToolbar(this.context.vivaldiWindowId,this.props.id)&&e.preventDefault()};onMouseDown=()=>{c.ZP.activateTab(this.props.id,this.context.vivaldiWindowId)};onMouseLeave=()=>{this._localStatus&&(this._localStatus=!1,h.Z.clearStatus(this.context.vivaldiWindowId))};updateDockingSizes_=e=>{re.Z.devtoolsPrivate.getDockingStateSizes(e,(e=>{const t=e.hideInspectedContents,s=e.inspectedHeight,n=e.inspectedLeft,i=e.inspectedTop,a=e.inspectedWidth;re.Z.zoom.getVivaldiUIZoom((e=>this.setState({hideInspectedContents:t,viewWidth:a/e,viewHeight:s/e,viewTop:i/e,viewLeft:n/e,disableWebviewEvents:!0},(()=>{this._eventGuard&&clearTimeout(this._eventGuard),this._eventGuard=setTimeout((()=>{this.setState({disableWebviewEvents:!1})}),300)}))))}))};onDockingSizesChanged=e=>{e===this.props.id&&this.updateDockingSizes_(e)};onDockingStateChanged=(e,t)=>{e===this.props.id&&this.state.dockingState!==t&&("undocked"===this.state.dockingState?this.setState({pendingDockingState:t}):this.setState({dockingState:t}),c.ZP.setPageInspected(e,this.context.vivaldiWindowId,"off"!==t))};onDevtoolsClosed=e=>{e===this.props.id&&(this.setState({dockingState:"off",viewWidth:"auto",viewHeight:"auto",viewTop:0,viewLeft:0}),c.ZP.setPageInspected(e,this.context.vivaldiWindowId,!1))};onDevtoolsWindowClosed=e=>{if(this.state.pendingDockingState){const e=this.state.pendingDockingState;this.setState((t=>({pendingDockingState:void 0,dockingState:e})))}else re.Z.devtoolsPrivate.closeDevtools(e,(e=>{}));c.ZP.setPageInspected(e,this.context.vivaldiWindowId,!1)};onDevtoolsUndocked=(e,t,s)=>{e===this.props.id&&this.setState({dockingState:"undocked"},(async()=>{const t={bounds:{left:s.left,top:s.top,width:s.right-s.left,height:s.bottom-s.top},focused:!0,windowDecoration:!0,incognito:fe.ZP.isIncognitoOrGuest(this.context.vivaldiWindowId),windowKey:"DevToolsUndocked_"+e.toString()},n=await Wn.Z.openWindow(this.context.vivaldiWindowId,"devtools.html","devtools",t),i=(0,bq.Z)(n);if(i){i.vivaldiInspectTabId=e,i.vivaldiWindowId=this.context.vivaldiWindowId,this.setState({undockedIsUnmounted:!1,undockedDevtoolsWindowId:n});const t=s=>{s===n&&(this.setState({undockedIsUnmounted:!0,undockedDevtoolsWindowId:void 0}),this.onDevtoolsWindowClosed(e),re.Z.windowPrivate.onWindowClosed.removeListener(t))};re.Z.windowPrivate.onWindowClosed.addListener(t)}}))};onWebViewElementIsAttached=(e,t)=>{const{id:s,isActive:n,url:i}=this.props,a=this.getWebviewElement();e===s&&a&&n&&!(0,vs.cw)(i)&&Fb.Z.setActiveWebView(t,a)};onWebViewElementIsDetached=(e,t)=>{e===this.props.id&&this.clearWebview()};updateFocus=(e,t)=>{if(!this.props.discarded)if(this.props.isActive){const e=this.nodeRef.current;e instanceof Node&&e.contains(this.activeElement)?yq((()=>{this.activeElement&&(this.activeElement.focus(),delete this.activeElement)})):this.props.pageContext.isUrlFieldFocused||function({winId:e,pageId:t,url:s,activeElement:n}){if(Ze.ZP.getPageInWindow(e,t)?.isMailPage)return"";if(Uo.getCapturingState(e))return"capture";if(Mc.Z.getStateForPage(t).selectedEvent)return"calendarEditor";if("quick-command-search"===n?.className)return"quickCommands";let i=!1;try{i=!0===Ca.Z.getFindResultsForPage(t).isFindInPageToolbarOpen}catch(e){console.warn(e)}return!0===i?"findInPage":""}({winId:this.context.vivaldiWindowId,pageId:this.props.id,url:t,activeElement:this.activeElement||this.context.document.activeElement})||yq((()=>this.focusWebView(t)))}else this.activeElement=this.context.document.activeElement};_onFindInPage=(e,t)=>{sp.Z.findInPage(this.context.vivaldiWindowId,this.props.id,e,t)};_onFindNextInPage=(e,t,s)=>{sp.Z.findNextInPage(this.context.vivaldiWindowId,this.props.id,e,t,s)};render(){const e=this.props.supportsReaderMode,t=this.props.vivExtData.readerMode&&e&&!(0,vs.cw)(this.props.url),s=Ze.ZP.isDisplayingImage(this.props.id),n="off"!==this.state.dockingState&&!(0,vs.cw)(this.props.url),i="auto"===this.state.viewWidth||0===this.state.viewWidth?"100%":this.state.viewWidth+this.state.viewLeft,a=0!==this.state.viewWidth,o=0!==this.state.viewHeight,r=this.state.mediaState.has("recording")||this.state.mediaState.has("capturing"),l={visibility:r||this.props.isVisible?"inherit":"hidden",zIndex:this.props.isVisible?"initial":"-1",opacity:this.props.isVisible?1:0};if(this.state.tabIsFullscreen&&r){const e=1920,t=1080,s=this.props.contentWidth/e;l.transform=`scale(${s})`,l.left=(this.props.contentWidth-e)/2,l.top=(this.props.contentHeight-t)/2,l.width=e,l.height=t,l.position="absolute"}const d=Number(this.props.id),c=(0,vs.cw)(this.props.url),h=Gn()("webpageview",{active:this.props.isActive,internal:c,tiled:(0,qK.Qz)(this.props.id),visible:this.props.isVisible,pagefocusstop:this.props.isVisible});return(0,zn.jsx)(Kd,{level:"tabs",children:(0,zn.jsxs)("div",{ref:this.nodeRef,className:h,style:l,"data-id":this.props.id,tabIndex:"-1",onKeyDown:this.onKeyDown,onMouseLeave:this.onMouseLeave,onMouseDown:this.onMouseDown,children:[t&&this.props.prefValues[Z.kWebpagesReaderControls]&&!(n&&"undocked"!==this.state.dockingState)&&xq,!s&&!(0,vs.Gp)(this.props.url)&&(0,zn.jsx)(sC,{isActive:this.props.isActive,pageId:this.props.id,onFindInPage:this._onFindInPage,onFindNextInPage:this._onFindNextInPage}),(0,zn.jsx)(Hb,{tabId:d}),(0,zn.jsx)(Yb,{url:this.props.url}),(0,zn.jsxs)("div",{className:"row-wrapper",children:[(0,zn.jsxs)("div",{className:"devtools-container",children:[(0,zn.jsx)(zb,{active:this.props.isActive,tabId:d,dockingState:c?"off":this.state.dockingState,undockedIsUnmounted:this.state.undockedIsUnmounted}),(0,zn.jsx)("div",{className:"webpage",style:n?{top:this.state.viewTop,left:this.state.viewLeft,width:a?this.state.viewWidth:"none",height:o?this.state.viewHeight:"none",pointerEvents:this.state.disableWebviewEvents?"none":null}:null,children:(0,zn.jsx)(vq,{ref:this.refWebview,id:d,pinned:this.props.pinned,discarded:this.props.discarded,isVisible:this.props.isVisible,onCreateSearch:this.handleOnCreateSearch,onContentAllowed:this.handleContentAllowed,onContentBlocked:this.handleContentBlocked,onDialog:this.handleOnJavascriptDialog,onFullscreen:this.handleOnFullscreen,onLoadAbort:this.handleLoadAbort,onLoadCommit:this.handleLoadCommit,onLoadProgress:this.handleOnLoadProgress,onLoadRedirect:this.handleLoadRedirected,onLoadStart:this.handleLoadStart,onLoadStop:this.handleLoadStop,onNewWindow:this.handleOnNewWindow,onPasteAndGo:this.handleOnPasteAndGo,onPermissionRequest:this.handleOnPermissionRequest,onSslStateChanged:this.handleOnSSLStateChanged,onTargetUrlChanged:this.handleOnTargetURLChanged,onWindowBlocked:this.handleBlockedPopup})}),(0,zn.jsx)(gq,{ref:this.refInternalPage,pageId:this.props.id,url:this.props.url,isVisible:this.props.isVisible,isActive:this.props.isActive,updatePageThumbnailWithActiveWebview:this.updatePageThumbnailWithActiveWebview}),s&&!this.props.showImageInspector&&(0,zn.jsx)("button",{className:"inspector",title:(0,W.Z)("Image Properties"),style:{left:i},onClick:this.toggleImageInspector,dangerouslySetInnerHTML:{__html:Kn.GH$}})]}),s&&(0,zn.jsx)(_C,{url:this.props.url,open:this.props.showImageInspector,toggleImageInspector:this.toggleImageInspector}),this.props.isActive&&[...this.state.activeDialogs.entries()].map((([e,t])=>(0,zn.jsx)(Hd,{customData:t,closeDialog:()=>this.handleOnCloseDialog(e)},e)))]})]})})}}const Aq=(0,zd.Z)(Iq,wq);var Sq=s(34155);function Zq(e,t){return function(s){s.stopPropagation(),Tq(e,t.vivaldiWindowId)}}function Tq(e,t){let s;s="content"===e?function(e){const t=Ze.ZP.getActivePage(e);return t?.isMailPage?wt.Z.isMailOn()?"mail":"feeds":t?.url&&vs.jk.getDisplayUrlFromMapping(t.url).startsWith("vivaldi://calendar")?"calendar":"browser"}(t):"panel"===e?function(e){switch(tn.ZP.getSelected(e)){case"PanelMail":case"PanelContacts":return"mail";case"PanelFeeds":return"feeds";case"PanelTasks":case"PanelCalendar":return"calendar";default:return"browser"}}(t):"browser";const n={actionType:"SWITCH_CONTEXT",context:{area:e,feature:s},windowId:t};S.Z.isDispatching()?Sq.nextTick((()=>S.Z.dispatch(n))):S.Z.dispatch(n)}var Eq=s(34155);const kq=[Z.kAddressBarAutocompleteEnabled,Z.kAddressBarExtensionsVisible,Z.kAddressBarExtensionsRenderInDropdown,Z.kAddressBarExtensionsShowAllToggle,Z.kAddressBarInlineSearchEnabled,Z.kAddressBarPosition,Z.kAddressBarSearchSuggestEnabled,Z.kAddressBarShowQrGenerator,Z.kPopupsShowInTab,Z.kKeyboardTabToAll,Z.kAddressBarSearchShowFavicon,Z.kAddressBarOmniboxShowTypedHistory,Z.kPrivacyPartnersExceptionsDismissed,Z.kAddressBarOmniboxShowTypedHistoryButton];function Nq(e){return{blockedPageContent:cg.getblockedPageContents(e),blockedPopups:cg.getBlockedPopupsById(e),permissionInfo:cg.getPermissionsById(e),sslInfo:cg.getSSLInfo(e),trigger:cg.getNavigationInfo(e).trigger}}function _q(e){const{blockedPageContent:t,blockedPopups:s,permissionInfo:n,sslInfo:i,trigger:a}=Nq(e),{typedUrl:o}=wg.getUrlfieldState(e);return{prevPageId:e,blockedPageContent:t,blockedPopups:s,permissionInfo:n,sslInfo:i,trigger:a,typedUrl:o,feeds:xb.getFeeds(e)}}class Pq extends Un.PureComponent{static contextType=oi.Z;#v;refPageloadProgress=Un.createRef();refPopupBlockerNotificator=Un.createRef();urlBarRef=Un.createRef();passwordElm=Un.createRef();siteInfoElm=Un.createRef();refUrlField=Un.createRef();constructor(e,t){super(e),this.state={isBaseDomainObscured:!1,showPasswordIcon:!1,selectedItem:void 0,defaultSearchEngine:pn.Z.getDefault(fe.ZP.isIncognito(t.vivaldiWindowId)),..._q(e.id)},this.trackContextOnFocus=Zq("tabBar",t)}static getDerivedStateFromProps(e,t){const s={};return e.id!==t.prevPageId&&Object.assign(s,_q(e.id)),s}componentDidUpdate(e,t){const s=e.id!==this.props.id;s&&this.hideDropdown(),s&&this.props.pageContext.isUrlFieldFocused&&yq((()=>(0,mg.i6)(this.context)))}componentDidMount(){this.#v=!0,Ca.Z.addListener(this._onWebpageviewStoreChanged),wg.addListener(this._onUrlFieldStoreChanged,(e=>e.get(this.props.id))),cg.addListener(this._onNavigationStoreChanged),pn.Z.addListener(this._onSearchEngineCacheChanged),re.Z.windowPrivate.onPositionChanged.addListener(this._onWindowPositionChanged),re.Z.utilities.onPasswordIconStatusChanged.addListener(this.togglePasswordIcon),xb.addListener(this._onRssDetectStoreChanged),this.props.pageContext.isUrlFieldFocused&&yq((()=>(0,mg.i6)(this.context)))}componentWillUnmount(){this.#v=!1,Ca.Z.removeListener(this._onWebpageviewStoreChanged),wg.removeListener(this._onUrlFieldStoreChanged),cg.removeListener(this._onNavigationStoreChanged),pn.Z.removeListener(this._onSearchEngineCacheChanged),re.Z.windowPrivate.onPositionChanged.removeListener(this._onWindowPositionChanged),re.Z.utilities.onPasswordIconStatusChanged.removeListener(this.togglePasswordIcon),xb.removeListener(this._onRssDetectStoreChanged)}getUrlFragments=Ci()(Kg.dO);getReaderContextMenu=()=>{const e=this.context.vivaldiWindowId;return[{handler:()=>ue.Z.showSettings(e,"webpages"),isVisible:()=>!fe.ZP.isGuest(),...(0,fi.Z)("Configure Reader View")}]};setSelectedItem=e=>{this.state.selectedItem!==e&&this.setState({selectedItem:e})};_onUrlFieldStoreChanged=()=>{const{typedUrl:e}=wg.getUrlfieldState(this.props.id);this.setState({typedUrl:e})};_onNavigationStoreChanged=()=>{const e=Nq(this.props.id);if(this.state.blockedPageContent===e.blockedPageContent&&this.state.blockedPopups===e.blockedPopups&&this.state.permissionInfo===e.permissionInfo&&this.state.sslInfo===e.sslInfo&&this.state.trigger===e.trigger)return;const t=()=>{this.setState({blockedPageContent:e.blockedPageContent,blockedPopups:e.blockedPopups,permissionInfo:e.permissionInfo,sslInfo:e.sslInfo,trigger:e.trigger})};this.state.permissionInfo===e.permissionInfo?t():setTimeout(t,200)};_onSearchEngineCacheChanged=()=>{this.setState({defaultSearchEngine:pn.Z.getDefault(fe.ZP.isIncognito(this.context.vivaldiWindowId))})};_onRssDetectStoreChanged=()=>{const e=xb.getFeeds(this.props.id);this.state.feeds!==e&&this.setState({feeds:e})};selectAddressField=()=>{this.#v&&(0,mg.i6)(this.context)};focusAddressField=()=>{this.#v&&(0,mg.x0)(this.context)};blurAddressField=()=>{this.#v&&((0,mg.gR)(this.context),Eq.nextTick((()=>{this.hideDropdown()})))};_onWebpageviewStoreChanged=e=>{e.winId===this.context.vivaldiWindowId&&("WEBPAGEVIEW_ACTIONS"===e.type?"focusAddressField"===e.action?Eq.nextTick((()=>{this.focusAddressField(),this.selectAddressField()})):"urlPasteAndGo"===e.action&&e.payload&&this.urlPasteAndGo(e.payload):"WEBPAGEVIEW_URLFIELD_BLUR"===e.type&&Eq.nextTick((()=>this.hideDropdown())))};urlPasteAndGo=async e=>{const{HTMLInputElement:t}=this.context,{clipboardText:s}=e;if(!s)return;const n=this.refUrlField.current?._urlInput.current?.refUrlInput.current?.inputField.current;n instanceof t&&(await Fg.Z.go(this.context.vivaldiWindowId,s,{...e.openOptions,transition:re.Z.historyPrivate.TransitionType.TYPED,fromUrlField:!0,enableSearch:!0}),this.blurAddressField())};onPasswordFocus=e=>{re.Z.utilities.isDialogOpen("password",(e=>{re.Z.utilities.focusDialog("password",(e=>{}))}))};compareProtocol=e=>{if((0,Ar.C3)(e)&&(0,Ar.Zj)(e)&&this.props.url&&Rb(e)===Rb(this.props.url)){const t=(0,ve.Z)(this.props.url),s=(0,ve.Z)(e);if(s&&t&&(s.protocol=t.protocol,(0,Ar.K2)(s.href)))return s.href}return e};handleUrlFieldSubmit=async({url:e,options:t})=>{const s=this.context.vivaldiWindowId,n=A.Z.get(Z.kAddressBarOmniboxEnabled)?void 0:g.Z.getNicknamed(e,!0)[0];if(n)return void Jn.ZP.open(s,[n],t,!1);const i=mm(this.state.typedUrl),a=Boolean(i||this.props.prefValues[Z.kAddressBarInlineSearchEnabled]);i||(e=this.compareProtocol(e)),await Fg.Z.go(s,e,{...t,enableSearch:a})};easterEggNavigation=async()=>{const e=wg.getUrlfieldState(this.props.id);if(!e||!e.autocompleteValue&&!e.typedUrl)return;const t=e?.autocompleteValue||e?.typedUrl||"";this.hideDropdown(),await Fg.Z.go(this.context.vivaldiWindowId,vs.jk.getUrl(t),{enableSearch:!0,transition:re.Z.historyPrivate.TransitionType.TYPED})};onSiteInfoButtonFieldGo=()=>{this.easterEggNavigation(),(0,mg.gR)(this.context)};showPasswordDialog=()=>{re.Z.utilities.showPasswordDialog(this.context.vivaldiWindowId)};onUrlFieldDrop=e=>{const t=this.context.vivaldiWindowId,s=e.dataTransfer;if(!s)return;const n=Jn.ZP.extractUriListFromEvent(e);if(n.length>0){const e=n.split("\n");e.length>0&&Fg.Z.goToMany(t,e)}else{const e=s.getData("text/plain");e.length>0&&((0,Ar.K2)(e)?Fg.Z.go(t,e):(vg.Z.updateState(this.props.id,{typedUrl:e}),this.focusAddressField()))}};togglePasswordIcon=(e,t)=>{e===this.context.vivaldiWindowId&&this.setState({showPasswordIcon:t})};setUrlDragEvent=e=>{e.stopPropagation();const{document:t,devicePixelRatio:s,vivaldiWindowId:n}=this.context,i=t.createElement("img");i.src=this.props.favIconUrl||"/resources/default_favicon_64.png",i.width=32,i.height=32,e.dataTransfer.setDragImage(i,i.width*s,i.height*s),i.remove();const a=Ze.ZP.getActivePage(n),o=this.state.typedUrl??this.props.url;lo(e,o,a?.title??""),e.dataTransfer.effectAllowed="all"};onReaderModeClicked=()=>{c.ZP.setReaderState(this.props.id,!this.props.isReaderModeActive)};onPopupAllowed=e=>{yv.Z.removeBlockedPopup(this.props.id,e.targetUrl),this.refPopupBlockerNotificator.current?.onDialogClosed(),this.openNewPopAsTabOrWindow(e)};openNewPopAsTabOrWindow=e=>{const t=fe.ZP.isIncognito(this.context.vivaldiWindowId);ue.Z.openNewPopAsTabOrWindow(this.context.vivaldiWindowId,e,t)};hideDropdown=()=>{this.refUrlField.current?.hideDropdown()};_storeDialogAnchorRect=(e,t)=>{const s="top"===this.props.prefValues[Z.kAddressBarPosition]?"down":"up";re.Z.zoom.getVivaldiUIZoom((n=>{re.Z.utilities.setDialogPosition(t,this.context.vivaldiWindowId,{left:Math.round(e.left*n),top:Math.round(e.top*n),width:Math.round(e.width*n),height:Math.round(e.height*n)},s)}))};_updateDialogPositions=()=>{const e=this.passwordElm.current;if(e){const t=e.getRect();t&&this._passwordPopupPos!==t&&(this._passwordPopupPos=t,this._storeDialogAnchorRect({left:t.left,top:t.top,width:t.width,height:t.height},"password"))}const{Element:t}=this.context,s=this.siteInfoElm.current?.refSiteInfoButton.current;if(s instanceof t){const e=s.getBoundingClientRect();this._permissionPopupPos!==e&&(this._permissionPopupPos=e,this._storeDialogAnchorRect({left:e.left,top:e.top,width:e.width,height:e.height},"permission"))}n.Z.windows.get(this.context.vivaldiWindowId,{},(e=>{if(!n.Z.runtime.lastError){let{left:t=0,top:s=0,width:n,height:i}=e;n=n||0,i=i||0,this._storeDialogAnchorRect({left:Math.round(t+n/2),top:Math.round(s+i/2),width:0,height:0},"chromecast")}}))};_onWindowPositionChanged=e=>{e===this.context.vivaldiWindowId&&this._sendBatchedUpdatedBounds()};_sendBatchedUpdatedBounds=()=>{this._resizeDelayRunning||(this._resizeDelayRunning=!0,setTimeout((()=>{this._updateDialogPositions(),this._resizeDelayRunning=!1}),500))};onUrlbarResized=e=>{this._sendBatchedUpdatedBounds()};blurUnfocused=e=>{this.context.document.activeElement!==this.refUrlField.current&&"Escape"===e.key&&(e.stopPropagation(),e.preventDefault(),this.refUrlField.current?._onEscPressed())};onBaseDomainObscured=e=>{this.setState({isBaseDomainObscured:e})};getOffsetWidth=()=>this.urlBarRef.current?.offsetWidth??0;getPlaceholderUrlFieldText=()=>this.props.prefValues[Z.kAddressBarInlineSearchEnabled]?pn.Z.systemDefaultEngineChanged()?(0,W.Z)("Search $1 [NEW] or enter an address",[this.state.defaultSearchEngine?.name??""]):(0,W.Z)("Search $1 or enter an address",[this.state.defaultSearchEngine?.name??""]):(0,W.Z)("Enter an address");toggleTypedHistory=()=>{!this.state.typedUrl&&this.refUrlField.current?.isOmniDropdownOpen()?(this.refUrlField.current?.revertUrl(),this.refUrlField.current?.hideDropdown((()=>{yq((()=>(0,mg.i6)(this.context)))}))):(this.state.typedUrl&&this.refUrlField.current?.revertUrl(),this.refUrlField.current?.performZeroSuggestion(),yq((()=>(0,mg.i6)(this.context))))};render(){const{preview:e=!1}=this.props;if(e)return(0,zn.jsx)("input",{type:"text",className:"AddressField",name:"AddressField",value:(0,W.Z)("url","Address"),...(0,cc.uu)({draggable:this.props.draggable,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,onDragEnter:this.props.onDragEnter,onDragOver:this.props.onDragOver,onDragLeave:this.props.onDragLeave,onDrop:this.props.onDrop}),readOnly:!0});const{isBaseDomainObscured:t,feeds:s,selectedItem:n,trigger:i}=this.state,{prefValues:a,url:o}=this.props,r=(0,W.Z)("Save your password"),l=this.props.menuOrigin||"bottomLeft",d=this.props.popupPosition||"below",c=this.getUrlFragments(this.props.url),h=(0,Bb.gC)(c),u=function(e){return Boolean(e)&&!vs.jk.isInternalUrl(e)&&!vs.jk.isNewTabPage(e)}(o),p=vs.jk.isInternalUrl(o)||o.startsWith("chrome://"),m=(0,Ar.tn)(o,c),f=(0,Ar.C3)(escape(o))&&!(p||(0,Ar.Sc)(o)||m),v="commit"===i||"start"===i,b=g.Z.getRootId()&&void 0!==this.props.id&&Jn.ZP.isBookmarkable(o),{favIconType:C,favIconUrl:w}=function(e,t,s,n){const i=mm(e);if(i)return{favIconUrl:i.faviconUrl,favIconType:"img"};if(t){let e="favicon";return"url"===t.faviconType?e="url":"img"===t.faviconType&&(e="img"),{favIconUrl:t.faviconUrl,favIconType:e}}if(A.Z.get(Z.kAddressBarInlineSearchEnabled)&&(e||s)){const e=pn.Z.getDefault(fe.ZP.isIncognitoOrGuest(n));if(e)return{favIconUrl:e.faviconUrl,favIconType:"img"}}return{favIconUrl:"",favIconType:"favicon"}}(this.state.typedUrl,n,this.refUrlField.current?.deleteKeyPressed??!1,this.context.vivaldiWindowId),y="string"==typeof this.state.typedUrl&&0===this.state.typedUrl.length||"string"!=typeof this.state.typedUrl&&0===h.length,x="string"==typeof this.state.typedUrl&&this.state.typedUrl!==h,I=Boolean(n&&(0,Sg.eE)(n)),S=this.props.prefValues[Z.kAddressBarOmniboxShowTypedHistory]&&this.props.prefValues[Z.kAddressBarOmniboxShowTypedHistoryButton];return(0,zn.jsxs)("div",{ref:this.urlBarRef,className:Gn()("UrlBar-AddressField urlfield-anchor",this.props.buttonClasses,d),name:"AddressField",onFocus:this.trackContextOnFocus,...(0,cc.uu)({draggable:this.props.draggable,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,onDragEnter:this.props.onDragEnter,onDragOver:this.props.onDragOver,onDragLeave:this.props.onDragLeave,onDrop:this.props.onDrop}),onKeyDown:this.blurUnfocused,children:[(0,zn.jsxs)("div",{className:"toolbar toolbar-small toolbar-insideinput",children:[!p&&(0,zn.jsx)(Fv,{blockerVisible:f,position:d,tabIndex:a[Z.kKeyboardTabToAll],pageId:this.props.id,url:o,exceptionDismissed:this.props.prefValues[Z.kPrivacyPartnersExceptionsDismissed]>0}),(0,zn.jsx)(kb,{ref:this.siteInfoElm,draggable:!p,isInternal:p,isLocal:m,isLoading:v,onDragStart:this.setUrlDragEvent,fieldGo:this.onSiteInfoButtonFieldGo,sslState:this.state.sslInfo.state,tabIndex:a[Z.kKeyboardTabToAll],favIconType:C,favIconUrl:w,isEditingUrl:x,isUrlEmpty:y,skipCache:I,isZeroSuggestion:!this.state.typedUrl&&void 0!==n})]}),(0,zn.jsx)("div",{className:"UrlBar-UrlFieldWrapper",children:(0,zn.jsx)(ti.Z,{className:"observer",onResize:this.onUrlbarResized,children:(0,zn.jsx)(ym,{ref:this.refUrlField,isUrlBar:!0,getOffsetWidth:this.getOffsetWidth,onBaseDomainObscured:this.onBaseDomainObscured,urlFragments:c,onSubmit:this.handleUrlFieldSubmit,className:"UrlBar-UrlField url vivaldi-addressfield uifocusstop",typedUrl:this.state.typedUrl,displayUrl:h,setSelectedItem:this.setSelectedItem,pageId:this.props.id,pageContext:this.props.pageContext,onUrlDrag:this.setUrlDragEvent,autoFocus:!1,autocompletionEnabled:a[Z.kAddressBarAutocompleteEnabled],typedHistoryEnabled:a[Z.kAddressBarOmniboxShowTypedHistory],onDrop:this.onUrlFieldDrop,placeholder:this.getPlaceholderUrlFieldText(),defaultSearchEngine:this.state.defaultSearchEngine,readonly:this.props.readonly})})}),(0,zn.jsxs)("div",{className:"toolbar toolbar-small toolbar-insideinput",children:[t&&(0,zn.jsx)("div",{title:(0,W.Z)("Caution!\nThe entire domain name cannot be shown. Make sure you trust this website before submitting data."),className:"UrlBar-UrlObfuscationWarning",dangerouslySetInnerHTML:{__html:Kn.Si$.small}}),(0,zn.jsx)($v,{pageId:this.props.id,ref:this.refPageloadProgress,open:!p}),(0,zn.jsx)(hb,{pageId:this.props.id,pagePermissions:this.state.permissionInfo,popupPosition:d}),this.state.blockedPopups.size>0&&(0,zn.jsx)(mb,{ref:this.refPopupBlockerNotificator,url:o,blockedPopups:this.state.blockedPopups,onPopupAllowed:this.onPopupAllowed,popupPosition:d}),this.state.blockedPageContent.length>0&&(0,zn.jsx)(Sv,{pageId:this.props.id,url:o,position:d,blockedPageContent:this.state.blockedPageContent}),s&&s.length>0&&(0,zn.jsx)(Cb,{feeds:s}),this.state.showPasswordIcon&&(0,zn.jsx)(oa.ZP,{ref:this.passwordElm,className:"password-icon",tooltip:r,onClick:this.showPasswordDialog,image:Kn.hXX,tabIndex:0,onFocus:this.onPasswordFocus}),!p&&this.props.supportsReaderMode&&(0,zn.jsx)(oa.ZP,{menu:this.getReaderContextMenu,menuOrigin:l,isPressed:this.props.isReaderModeActive,image:Kn.sWI,onClick:this.onReaderModeClicked,tooltip:(0,W.Z)("Reader View"),commandId:"COMMAND_READERVIEW_TOGGLE"}),u&&a[Z.kAddressBarShowQrGenerator]&&(0,zn.jsx)(vb,{popupPosition:d,size:this.props.size,data:o}),u&&(0,zn.jsx)(Lb,{popupPosition:d,size:this.props.size,tabId:this.props.id,url:o}),b&&(0,zn.jsx)(La,{pageId:this.props.id,url:this.props.url,popupPosition:d},o),S&&(0,zn.jsx)("div",{className:"button-toolbar drop-down-menu",children:(0,zn.jsx)("button",{className:"urlfield-clickoutside-ignore",title:(0,W.Z)("Show typed history"),tabIndex:a[Z.kKeyboardTabToAll],onMouseDown:this.toggleTypedHistory,dangerouslySetInnerHTML:{__html:Kn.yaZ.small}})})]})]})}}const Mq=(0,zd.Z)((0,cc.ZP)(Pq),kq),Dq=[Z.kBiscuitVersion,Z.kPanelsPosition,Z.kFeaturesMail],Oq=(0,W.Z)("$1 click to toggle panel floating",[(0,W.Z)("key","Shift")]),jq=function(e){const t=Ze.ZP.unsafeGetActivePage(e);return{activePageUrl:t.url,activePageId:t.id,activePageContext:t.context,activePageSupportsReaderMode:t.supportsReaderMode,activePageIsReaderModeActive:Boolean(t.vivExtData.readerMode),active:t.active,favIconUrl:t.favIconUrl,isMailPage:t.isMailPage&&wt.Z.isMailOn()}};let Lq="";const Rq=function(){if(!Lq){const{vivaldiVersion:e,chromiumVersion:t}=re.Z.utilities.getVersion();Lq=`Vivaldi ${e} / Chrome ${t}`}return Lq};class Bq extends Un.PureComponent{static contextType=oi.Z;_isMounted=!1;constructor(e,t){super(e),this.winId=t.vivaldiWindowId,this.state={panelBarVisible:tn.ZP.getIsBarVisible(this.winId),statusBarDisplay:fe.ZP.getVisibleUI(this.winId).statusBar,...jq(this.winId)}}componentDidMount(){if(this.props.inEditor)return;const{selectWindow:e}=this.context;this._isMounted=!0,Ze.ZP.addListener(this._onPageStoreChange,e),tn.ZP.addListener(this._onPanelStoreChanged),fe.ZP.addListener(this._onWindowStoreChanged,e)}componentWillUnmount(){this.props.inEditor||(this._isMounted=!1,tn.ZP.removeListener(this._onPanelStoreChanged),Ze.ZP.removeListener(this._onPageStoreChange),fe.ZP.removeListener(this._onWindowStoreChanged))}_onPageStoreChange=()=>{this._isMounted&&this.setState(jq(this.winId))};_onPanelStoreChanged=()=>{this._isMounted&&this.setState({panelBarVisible:tn.ZP.getIsBarVisible(this.winId)})};_onWindowStoreChanged=()=>{const e=fe.ZP.getVisibleUI(this.winId).statusBar;this._isMounted&&this.state.statusBarDisplay!==e&&this.setState({statusBarDisplay:e})};#bs=()=>{en.Z.togglePanel(this.winId)};#Cs=()=>{ue.Z.showSettings(this.winId)};render(){const{preview:e,name:t,size:s,label:n,popupPosition:i,customizeMenu:a,draggable:o,onDragStart:r,onDragEnd:l,onDrop:d,onDragEnter:c,mimeType:h,menuOrigin:u}=this.props,p={size:s,name:t,customizeMenu:a,menuOrigin:u,draggable:o,popupPosition:i,onDragStart:r,onDragEnd:l,onDrop:d,onDragEnter:c,mimeType:h};switch(this.props.name){case"AddressField":return(0,zn.jsx)(Mq,{...p,readonly:!1,url:this.state.activePageUrl,id:this.state.activePageId,supportsReaderMode:this.state.activePageSupportsReaderMode,isReaderModeActive:this.state.activePageIsReaderModeActive,active:this.state.active,favIconUrl:this.state.favIconUrl,label:n,pageContext:this.state.activePageContext,preview:this.props.inEditor});case"SearchField":return(0,zn.jsx)(Lf,{...p,className:"UrlBar-SearchField",preview:this.props.preview,inEditor:this.props.inEditor,forceIcon:this.props.forceIcon});case"PanelToggle":return(0,zn.jsx)(oa.ZP,{...p,className:"panel-clickoutside-ignore",tooltip:this.state.panelBarVisible?(0,W.Z)("verb","Hide Panel"):(0,W.Z)("verb","Show Panel"),tooltipExtra:Oq,onClick:this.#bs,onMiddleClick:e=>en.Z.toggleFloating(),style:{"--panelOpen":this.state.panelBarVisible?1:0,transform:"right"===this.props.prefValues[Z.kPanelsPosition]?"scaleX(-1)":"unset"},image:Kn.sxI[this.props.size],label:n,commandId:"COMMAND_TOGGLE_PANEL"});case"SyncStatus":return!fe.ZP.isIncognitoOrGuest(this.winId)&&(0,zn.jsx)(pv,{...p,preview:this.props.inEditor});case"StatusInfo":return"overlay"!==this.state.statusBarDisplay||this.props.preview?(0,zn.jsx)(Yf,{...p,preview:e}):null;case"VersionInfo":return this.props.prefValues[Z.kBiscuitVersion]?(0,zn.jsxs)("div",{className:"biscuit-setting-version",children:[(0,zn.jsx)("span",{className:"application-icon-biscuit",dangerouslySetInnerHTML:{__html:Kn.Qa2}}),(0,zn.jsxs)("span",{className:"biscuit-string",children:[" ",Rq()," "]})]}):null;case"CaptureImages":return(0,zn.jsx)(tf,{...p,winId:this.context.vivaldiWindowId});case"TilingToggle":return(0,zn.jsx)(wv,{...p,pageId:this.state.activePageId,disabled:!1});case"ImagesToggle":return(0,zn.jsx)(vv,{...p,disabled:!1});case"PageActions":return(0,zn.jsx)(nf,{...p,pageId:this.state.activePageId,disabled:!1});case"Zoom":return(0,zn.jsx)(uf,{...p,pageId:this.state.activePageId,preview:this.props.inEditor});case"Settings":return(0,zn.jsx)(oa.ZP,{...p,className:"panel-clickoutside-ignore",tooltip:(0,Rp.wY)("Settings"),onClick:this.#Cs,image:Kn.bqs[this.props.size],label:n,commandId:"COMMAND_SHOW_SETTINGS"});default:return null}}}const Fq=(0,zd.Z)(Bq,Dq),Wq={onDidAbortWithError:(0,W.Z)("Update Failed"),onDidFindValidUpdate:(0,W.Z)("Update Available"),onUpdaterDidNotFindUpdate:(0,W.Z)("Up to Date"),onWillDownloadUpdate:(0,W.Z)("Downloading Update"),onDidDownloadUpdate:(0,W.Z)("Installing Update"),onWillInstallUpdateOnQuit:(0,W.Z)("Restart Required"),onNeedRestartToReloadCodecs:(0,W.Z)("Restart Required"),onUpdaterDidRelaunchApplication:(0,W.Z)("Vivaldi Updated")};class Uq extends Un.Component{static contextType=oi.Z;state={hasAutoUpdates:!1};componentDidMount(){this.refreshAutoInstallUpdates()}refreshAutoInstallUpdates=()=>{re.Z.autoUpdate.getAutoInstallUpdates((e=>{this.setState({hasAutoUpdates:e})}))};openDownloadPage=()=>{c.ZP.openURL(this.context.vivaldiWindowId,"https://vivaldi.com/download/"),this.props.hidePopup()};render(){const{status:e,version:t,releaseNotesUrl:s}=this.props.updateState;if(!e)return null;const n=(0,Gm.Z)("input"),i=fe.ZP.isIncognito(this.context.vivaldiWindowId),a="onWillInstallUpdateOnQuit"===e||"onNeedRestartToReloadCodecs"===e,{vivaldiVersion:o}=re.Z.utilities.getVersion();return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("h2",{id:"popup-label-updatepending",children:Wq[e]}),(0,zn.jsxs)("div",{className:"popup-scrollarea",children:["onDidAbortWithError"===e&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("p",{className:"popup-infotext",children:(0,W.Z)("Unable to check for update.")}),(0,zn.jsxs)("p",{className:"popup-infotext",children:[(0,W.Z)("Please try again later or visit")," ",(0,zn.jsx)(Vx.Z,{onClick:this.openDownloadPage,children:"vivaldi.com/download"})]})]}),"onDidFindValidUpdate"===e&&!this.state.hasAutoUpdates&&(0,zn.jsx)("p",{className:"popup-infotext",children:(0,W.Z)("An update to version $1 is available.",[t??""])}),"onDidFindValidUpdate"===e&&this.state.hasAutoUpdates&&(0,zn.jsx)("p",{className:"popup-infotext",children:(0,W.Z)("An update to version $1 is available and scheduled for download.",[t??""])}),"onUpdaterDidNotFindUpdate"===e&&(0,zn.jsx)("p",{className:"popup-infotext",children:(0,W.Z)("You are already running the latest version of Vivaldi ($1).",[o])}),"onWillDownloadUpdate"===e&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("p",{className:"popup-infotext",children:(0,W.Z)("An update to Vivaldi version $1 is being downloaded.",[t??""])}),(0,zn.jsx)("p",{className:"popup-infotext",children:(0,W.Z)("Please wait...")})]}),"onDidDownloadUpdate"===e&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("p",{className:"popup-infotext",children:(0,W.Z)("Installing Vivaldi update version $1.",[t??""])}),(0,zn.jsx)("p",{className:"popup-infotext",children:(0,W.Z)("Please wait...")})]}),"onWillInstallUpdateOnQuit"===e&&""!==t&&(0,zn.jsx)("p",{className:"popup-infotext",children:(0,W.Z)("Restart Vivaldi to begin using the new version $1.",[t??""])}),"onWillInstallUpdateOnQuit"===e&&""===t&&(0,zn.jsx)("p",{className:"popup-infotext",children:(0,W.Z)("Vivaldi has been updated in the background. Please restart now to complete the update.",[t])}),"onNeedRestartToReloadCodecs"===e&&(0,zn.jsx)("p",{className:"popup-infotext",children:(0,W.Z)("Audio and video support has been updated. Please restart to allow playing additional types of media.")}),"onUpdaterDidRelaunchApplication"===e&&(0,zn.jsx)("p",{className:"popup-infotext",children:(0,W.Z)("Vivaldi successfully updated to version $1.",[o])})]}),i&&a&&(0,zn.jsx)("p",{className:"popup-warning",children:(0,W.Z)("This will reset your Private Windows.")}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:["onDidFindValidUpdate"===e&&this.state.hasAutoUpdates&&(0,zn.jsx)("input",{type:"submit",className:"primary",onClick:()=>{c.ZP.openURL(this.context.vivaldiWindowId,s),this.props.hidePopup()},value:(0,W.Z)("Show Release Notes")}),"onDidFindValidUpdate"===e&&!this.state.hasAutoUpdates&&(0,zn.jsx)("input",{type:"submit",className:"primary",onClick:()=>{re.Z.autoUpdate.checkForUpdates(!0),this.props.hidePopup()},value:(0,W.Z)("Update Vivaldi")}),a&&(0,zn.jsx)(n,{type:"submit",className:"danger",onClick:()=>re.Z.autoUpdate.installUpdateAndRestart(),value:(0,W.Z)("browser","Restart")})]})]})}}const Vq=Uq,Hq={display:"none"};class Gq extends Un.PureComponent{constructor(e){super(e);this.state={autoUpdateEnabled:!1,popupVisible:!1,updateState:{status:void 0,version:void 0,releaseNotesUrl:void 0}}}componentDidMount(){if(this.props.inEditor)return;re.Z.autoUpdate.isUpdateNotifierEnabled((e=>{this.setState({autoUpdateEnabled:e})}));const{onDidAbortWithError:e,onDidFindValidUpdate:t,onWillDownloadUpdate:s,onDidDownloadUpdate:n,onWillInstallUpdateOnQuit:i,onNeedRestartToReloadCodecs:a,onUpdaterDidRelaunchApplication:o,onUpdateFinished:r}=re.Z.autoUpdate;e.addListener(this.#ws),t.addListener(this.#ys),s.addListener(this.#xs),n.addListener(this.#Is),i.addListener(this.#As),a.addListener(this.#Ss),o.addListener(this.#Zs),r.addListener(this.#Ts)}componentWillUnmount(){if(this.props.inEditor)return;const{onDidAbortWithError:e,onDidFindValidUpdate:t,onWillDownloadUpdate:s,onDidDownloadUpdate:n,onWillInstallUpdateOnQuit:i,onNeedRestartToReloadCodecs:a,onUpdaterDidRelaunchApplication:o,onUpdateFinished:r}=re.Z.autoUpdate;e.removeListener(this.#ws),t.removeListener(this.#ys),s.removeListener(this.#xs),n.removeListener(this.#Is),i.removeListener(this.#As),a.removeListener(this.#Ss),o.removeListener(this.#Zs),r.removeListener(this.#Ts)}#ws=(e,t)=>{e&&console.warn(e,t),this.setState((0,C.Uy)((({updateState:e})=>{e.status="onDidAbortWithError"})))};#ys=(e,t)=>{this.setState((0,C.Uy)((({updateState:s})=>{s.status="onDidFindValidUpdate",s.version=t,s.releaseNotesUrl=e})))};#xs=e=>{this.setState((0,C.Uy)((({updateState:t})=>{t.status="onWillDownloadUpdate",t.version=e})))};#Is=e=>{this.setState((0,C.Uy)((({updateState:t})=>{t.status="onDidDownloadUpdate",t.version=e})))};#As=e=>{this.setState((0,C.Uy)((({updateState:t})=>{t.status="onWillInstallUpdateOnQuit",t.version=e})))};#Ss=()=>{this.setState((0,C.Uy)((({updateState:e})=>{e.status="onNeedRestartToReloadCodecs"})))};#Zs=()=>{this.setState((0,C.Uy)((({updateState:e})=>{e.status="onUpdaterDidRelaunchApplication"})))};#Ts=()=>{this.setState((0,C.Uy)((({updateState:e})=>{e.status=void 0}))),this.hidePopup()};togglePopup=()=>{this.setState((e=>({popupVisible:!e.popupVisible})))};hidePopup=()=>{this.setState({popupVisible:!1})};render(){let{status:e}=this.state.updateState;const t=this.props.preview||this.props.inEditor;!e&&t&&(e="onUpdaterDidNotFindUpdate");const s=!this.state.autoUpdateEnabled&&!t,n="onNeedRestartToReloadCodecs"===e||"onWillInstallUpdateOnQuit"===e,i="onWillDownloadUpdate"===e||"onDidDownloadUpdate"===e;let a=Kn.nuh[this.props.size];n&&(a=Kn.Tlc);const o=!e||s?Hq:void 0,r=Gn()({updating:i,restart:n});return(0,zn.jsx)(oa.ZP,{style:{...o,"--installingUpdate":i?1:0},image:a,imageOverride:n||i?"none":void 0,title:e?Wq[e]:" ",titleIsStatus:!0,onClick:this.togglePopup,customizeMenu:this.props.customizeMenu,menuOrigin:this.props.menuOrigin,buttonClasses:r,popupClassName:"UpdatePopup ToolbarButtonPopup-DefaultStyles",popupLabelledBy:"popup-label-updatepending",popupPosition:this.props.popupPosition,hidePopup:this.hidePopup,isPopupVisible:this.state.popupVisible,size:this.props.size,draggable:this.props.draggable,onDragStart:this.props.onDragStart??nr.Z,onDragEnd:this.props.onDragEnd??nr.Z,onDrop:this.props.onDrop??nr.Z,onDragEnter:this.props.onDragEnter??nr.Z,onDragLeave:this.props.onDragLeave??nr.Z,onDragOver:this.props.onDragOver??nr.Z,mimeType:this.props.mimeType,name:this.props.name,children:(0,zn.jsx)(Vq,{hidePopup:this.hidePopup,updateState:this.state.updateState})})}}const Kq=(0,cc.ZP)(Gq);class zq extends Vo.Z{dispatchAction(e){switch(e.actionType){case"MAIN_SHOW_CLEAR_BROWSING_HISTORY_DIALOG":case"MAIN_SHOW_MAIL_ACCOUNT_DIALOG":case"MAIN_SHOW_CALENDAR_ACCOUNT_DIALOG":case"MAIN_SHOW_CREATE_CALENDAR_DIALOG":case"MAIN_SHOW_IMPORT_DATA_DIALOG":case"MAIN_SHOW_MAIL_INFO_DIALOG":case"MAIN_SHOW_KEYBOARDS_SHORTCUTS":case"MAIN_SHOW_PAGE_ACCESS_KEYS":case"MAIN_SHOW_OPEN_SESSION_DIALOG":case"MAIN_SHOW_QUICKCOMMANDS":case"MAIN_SHOW_PRIVACY_STATS":case"MAIN_SHOW_CREATE_LABEL":case"MAIN_SHOW_LABEL_FLAG_DIALOG":case"MAIN_TOOLBAR_SPACER_UPDATE":case"MAIN_SHOW_SHARE_VIVALDI_DIALOG":this.emitChange({winId:e.winId,type:e.actionType});break;case"MAIN_SELECTING_TOOLBAR":this.emitChange({winId:e.winId,type:"MAIN_SELECTING_TOOLBAR",options:e.options});break;case"MAIN_SHOW_CONFIRM_OPEN_LINKS_DIALOG":this.emitChange({winId:e.winId,type:"MAIN_SHOW_CONFIRM_OPEN_LINKS_DIALOG",options:e.options});break;case"MAIN_SHOW_CONFIRM_CLOSE_OTHER_TABS_DIALOG":this.emitChange({winId:e.winId,type:"MAIN_SHOW_CONFIRM_CLOSE_OTHER_TABS_DIALOG",options:e.options});break;case"MAIN_SHOW_BOOKMARK_DIALOG":this.emitChange({winId:e.winId,type:"MAIN_SHOW_BOOKMARK_DIALOG",options:e.options});break;case"MAIN_SHOW_SAVE_SESSION_DIALOG":this.emitChange({winId:e.winId,type:"MAIN_SHOW_SAVE_SESSION_DIALOG",options:e.options});break;case"MAIN_SHOW_ADD_FEED":this.emitChange({winId:e.winId,type:"MAIN_SHOW_ADD_FEED",options:e.options});break;case"MAIN_SHOW_ADD_MAIL_FOLDER":this.emitChange({winId:e.winId,type:"MAIN_SHOW_ADD_MAIL_FOLDER",options:e.options});break;case"MAIN_SHOW_DELETE_MAIL_FOLDER":this.emitChange({winId:e.winId,type:"MAIN_SHOW_DELETE_MAIL_FOLDER",options:e.options});break;case"MAIN_SHOW_ADD_FEED_FOLDER":this.emitChange({winId:e.winId,type:"MAIN_SHOW_ADD_FEED_FOLDER",options:e.options});break;case"MAIN_SHOW_DELETE_FEED_FOLDER":this.emitChange({winId:e.winId,type:"MAIN_SHOW_DELETE_FEED_FOLDER",options:e.options});break;case"MAIN_SHOW_DELETE_WORKSPACE":this.emitChange({winId:e.winId,type:"MAIN_SHOW_DELETE_WORKSPACE",options:e.options});break;case"MAIN_SHOW_WORKSPACE_DIALOG":this.emitChange({winId:e.winId,type:"MAIN_SHOW_WORKSPACE_DIALOG",options:e.options});break;case"MAIN_SHOW_NOTE_SELECTION_DIALOG":this.emitChange({winId:e.winId,type:"MAIN_SHOW_NOTE_SELECTION_DIALOG",options:e.options});break;case"MAIN_SHOW_MAIL_AUTHENTICATION_DIALOG":this.emitChange({winId:e.winId,type:"MAIN_SHOW_MAIL_AUTHENTICATION_DIALOG",options:e.options});break;case"MAIN_SHOW_MAIL_UNSUBSCRIBE_DIALOG":this.emitChange({winId:e.winId,type:"MAIN_SHOW_MAIL_UNSUBSCRIBE_DIALOG",options:e.options});break;case"MAIN_SHOW_MAIL_DELETE_DIALOG_ACCOUNTS":this.emitChange({winId:e.winId,type:"MAIN_SHOW_MAIL_DELETE_DIALOG_ACCOUNTS",options:e.options});break;case"MAIN_SHOW_MAIL_DELETE_DIALOG_CONFIRM_ALL":this.emitChange({winId:e.winId,type:"MAIN_SHOW_MAIL_DELETE_DIALOG_CONFIRM_ALL",options:e.options});break;case"MAIN_SHOW_DELETE_LABEL_CONFIRMATION":this.emitChange({winId:e.winId,type:"MAIN_SHOW_DELETE_LABEL_CONFIRMATION",options:e.options});break;case"MAIN_SHOW_DELETE_FILTER_CONFIRMATION":this.emitChange({winId:e.winId,type:"MAIN_SHOW_DELETE_FILTER_CONFIRMATION",options:e.options});break;case"MAIN_SHOW_DELETE_FEED_CONFIRMATION":this.emitChange({winId:e.winId,type:"MAIN_SHOW_DELETE_FEED_CONFIRMATION",options:e.options});break;case"MAIN_SHOW_MAIL_VIEW_FILTER_CONFIRMATION":this.emitChange({winId:e.winId,type:"MAIN_SHOW_MAIL_VIEW_FILTER_CONFIRMATION",options:e.options});break;case"MAIN_SHOW_MAIL_UPLOAD_CONFIRMATION":this.emitChange({winId:e.winId,type:"MAIN_SHOW_MAIL_UPLOAD_CONFIRMATION",options:e.options});break;case"MAIN_SHOW_MAIL_MESSAGE_MOVE_CONFIRMATION":this.emitChange({winId:e.winId,type:"MAIN_SHOW_MAIL_MESSAGE_MOVE_CONFIRMATION",options:e.options});break;case"MAIN_SHOW_MAIL_CREATE_ARCHIVE_FOLDER_CONFIRMATION":this.emitChange({winId:e.winId,type:"MAIN_SHOW_MAIL_CREATE_ARCHIVE_FOLDER_CONFIRMATION",options:e.options});break;case"MAIN_SHOW_TOOLBAR_RESET":this.emitChange({winId:e.winId,type:"MAIN_SHOW_TOOLBAR_RESET",options:e.options});break;case"MAIN_SHOW_MAIL_DELETE_DIALOG_FOLDERS":this.emitChange({winId:e.winId,type:"MAIN_SHOW_MAIL_DELETE_DIALOG_FOLDERS",options:e.options});break;case"MAIN_SHOW_MAIL_DELETE_DIALOG_SETTING":this.emitChange({winId:e.winId,type:"MAIN_SHOW_MAIL_DELETE_DIALOG_SETTING",options:e.options});break;case"MAIN_SHOW_ACCOUNT_SHEET":this.emitChange({winId:e.winId,type:"MAIN_SHOW_ACCOUNT_SHEET",options:e.options});break;case"MAIN_SHOW_CALENDAR_ALARM":this.emitChange({winId:e.winId,type:"MAIN_SHOW_CALENDAR_ALARM",options:e.options});break;case"MAIN_SHOW_CALENDAR_EDIT_EVENT":this.emitChange({winId:e.winId,type:"MAIN_SHOW_CALENDAR_EDIT_EVENT",options:e.options});break;case"MAIN_SHOW_CALENDAR_EDIT_TEMPLATE":this.emitChange({winId:e.winId,type:"MAIN_SHOW_CALENDAR_EDIT_TEMPLATE",options:e.options});break;case"MAIN_SHOW_CALENDAR_IMPORT_EVENTS_DIALOG":this.emitChange({winId:e.winId,type:"MAIN_SHOW_CALENDAR_IMPORT_EVENTS_DIALOG",options:e.options});break;case"MAIN_SHOW_MODAL_DIALOG":this.emitChange({winId:e.winId,type:"MAIN_SHOW_MODAL_DIALOG",options:e.options});break;case"MAIN_SHOW_MODAL_INFO":this.emitChange({winId:e.winId,type:"MAIN_SHOW_MODAL_INFO",options:e.options});break;case"MAIN_SHOW_DIALOG":this.emitChange({winId:e.winId,type:e.actionType,options:e.options,onAfterClose:e.onAfterClose});break;case"MAIN_SHOW_BOOKMARK_ADDED_POPUP":this.emitChange({winId:e.winId,type:"MAIN_SHOW_BOOKMARK_ADDED_POPUP",options:e.options});break;case"MAIN_SHOW_ENABLE_SESSION_AUTOSAVE_DIALOG":this.emitChange({type:"MAIN_SHOW_ENABLE_SESSION_AUTOSAVE_DIALOG",winId:e.winId,options:e.options});break;case"MAIN_SHOW_ENABLE_WORKSPACE_DIALOG":this.emitChange({winId:e.winId,type:"MAIN_SHOW_ENABLE_WORKSPACE_DIALOG",options:e.options});break;case"MAIN_SHOW_INCLUDE_WORKSPACE_DIALOG":this.emitChange({winId:e.winId,type:"MAIN_SHOW_INCLUDE_WORKSPACE_DIALOG",options:e.options});break;case"MAIN_SHOW_CONTEXT_DIALOG":this.emitChange({winId:e.winId,type:"MAIN_SHOW_CONTEXT_DIALOG",options:e.options})}}}const $q=new zq(S.Z),Yq=[Z.kAddressBarPosition,Z.kMailViewLayout,Z.kMenuDisplay,Z.kPanelsAsOverlayEnabled,Z.kPanelsPosition,Z.kTabsBarPosition,Z.kWindowsLinuxAltControls];function Xq(e){return"PanelWidthSpacer"===e.name}class Qq extends Un.PureComponent{static contextType=oi.Z;id=crypto.randomUUID();state={enforcedWidth:0};componentDidMount(){this.props.inEditor||Xq(this.props)&&(this.delayedSpacerUpdate(),$q.addListener(this.onMainStoreChanged),tn.ZP.addListener(this.delayedSpacerUpdate))}componentDidUpdate(e){if(this.props.inEditor!==e.inEditor)throw new Error("PanelButton: Invalid props change");Xq(this.props)&&e.prefValues!==this.props.prefValues&&this.delayedSpacerUpdate(),this.props.inEditor||Xq(this.props)!==Xq(e)&&(Xq(this.props)?($q.addListener(this.onMainStoreChanged),tn.ZP.addListener(this.delayedSpacerUpdate)):($q.removeListener(this.onMainStoreChanged),tn.ZP.removeListener(this.delayedSpacerUpdate)))}componentWillUnmount(){this.props.inEditor||Xq(this.props)&&($q.removeListener(this.onMainStoreChanged),tn.ZP.removeListener(this.delayedSpacerUpdate))}onMainStoreChanged=e=>{"MAIN_TOOLBAR_SPACER_UPDATE"===e.type&&this.delayedSpacerUpdate()};delayedSpacerUpdate=()=>{this.frame=this.context.requestAnimationFrame(this.setSpacerWidth)};shouldEnforceWidth=()=>{if(Xq(this.props)&&!this.props.inEditor&&!this.props.preview){const{document:e}=this.context,t=e.getElementById(this.id);if(!t||!t?.checkVisibility())return!1;const s=t.parentElement;if(s&&!s.className.includes("toolbar-panel"))return this.props.index===[...s.querySelectorAll(":scope > *:not(.window-buttongroup, .vivaldi)")].indexOf(t)}return!1};setSpacerWidth=()=>{if(!this.shouldEnforceWidth())return;const e=this.getSpacerWidth();e>=0&&this.setState({enforcedWidth:e})};getImage=()=>{switch(this.props.name){case"PanelWidthSpacer":return Kn.GYw[this.props.size];case"FlexibleSpacer":return Kn.K3w[this.props.size];default:return Kn.Vzw[this.props.size]}};getSpacerWidth=()=>{const e=34,{vivaldiWindowId:t}=this.context,s=tn.ZP.getSelected(t);if(this.props.prefValues[Z.kPanelsAsOverlayEnabled]||s&&tn.ZP.getSeparateFloating(s,t))return e;const{document:n}=this.context,i=n.getElementById(this.id),a=i?.parentElement?.clientWidth;if(!i||!a)return-1;const o=Math.min(tn.ZP.getWidth(this.context.vivaldiWindowId),this.context.innerWidth/3);if(i.offsetLeft<a/2){if(!i.parentElement)return-1;if("left"===this.props.prefValues[Z.kPanelsPosition]){const t=i.previousElementSibling?.getBoundingClientRect(),s=t?.right?t.right+1:0;return Math.max(o-s,e)}return e}if(i.offsetLeft>a/2){if(!i?.parentElement)return-1;if("right"===this.props.prefValues[Z.kPanelsPosition]){const t=i?.nextElementSibling,s=t?.getBoundingClientRect(),n=this.context.innerWidth-(s?.left?s.left+1:0);return Math.max(o-n,e)}return e}return e};getControlsWidth=()=>{let e=0;return"top"===this.props.prefValues[Z.kTabsBarPosition]||"top"===this.props.prefValues[Z.kMenuDisplay]||this.props.prefValues[Z.kWindowsLinuxAltControls]||(e=44),e};executeChain=e=>{const{ctrlKey:t,altKey:s,shiftKey:n,metaKey:i}=e,{chain:a}=A.Z.get(Z.kChainedCommandsCommandList).find((e=>e.name===this.props.name));(0,Dz.hT)({origin:"button",context:this.context,windowId:this.context.vivaldiWindowId,keyState:{ctrlKey:t,altKey:s,shiftKey:n,metaKey:i,key:""}},a)};render(){if(this.props.commandButton){const e=A.Z.get(Z.kChainedCommandsCommandList).find((e=>e.name===this.props.name));return e?(0,zn.jsx)(oa.ZP,{name:e.name,customizeMenu:this.props.customizeMenu,image:Kn.Znx[this.props.size],draggable:this.props.draggable,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,onDrop:this.props.onDrop,onDragEnter:this.props.onDragEnter,className:"toolbar-command",tooltip:e.label,onClick:this.executeChain,mimeType:this.props.mimeType,size:this.props.size}):null}if("Divider"===this.props.name)return(0,zn.jsx)(oa.ZP,{customizeMenu:this.props.customizeMenu,name:this.props.name,image:Kn.Fm3[this.props.size],mimeType:this.props.mimeType,draggable:this.props.draggable,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,onDrop:this.props.onDrop,onDragEnter:this.props.onDragEnter,className:"toolbar-divider",tooltip:" ",disabled:!this.props.preview,alwaysMenu:!0});let e={};if(!this.props.inEditor&&Xq(this.props))if(this.state.enforcedWidth)e={flexBasis:this.state.enforcedWidth};else if("top"===this.props.prefValues[Z.kAddressBarPosition]){const t=this.getControlsWidth();e={flexBasis:tn.ZP.getWidth(this.context.vivaldiWindowId)-t-34*this.props.index}}return(0,zn.jsx)(oa.ZP,{style:e,id:Xq(this.props)?this.id:void 0,customizeMenu:this.props.customizeMenu,name:this.props.name,image:this.getImage(),mimeType:this.props.mimeType,draggable:this.props.draggable,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,onDrop:this.props.onDrop,onDragEnter:this.props.onDragEnter,className:Gn()({"toolbar-spacer-panel":Xq(this.props),"toolbar-spacer-flexible":"FlexibleSpacer"===this.props.name,"toolbar-spacer":"Spacer"===this.props.name}),disabled:!this.props.preview,tooltip:" ",alwaysMenu:!0,ariaHidden:!0})}}const qq=(0,zd.Z)(Qq,Yq);var Jq=s(88901);function eJ(e,t,s,n,i){if(!s||!n||!i)return{display:"none"};const a=s.x,[o,r]=t,l=e/2;return{transform:`translate(${a}px, ${(0,kf.Z)(i.y+(n.y-s.y),o+l,r-l)}px)`}}var tJ=(0,zn.jsx)("div",{className:"checkmark",children:(0,zn.jsx)(aa,{type:"checkmark"})}),sJ=(0,zn.jsx)(aa,{type:"reorder"});function nJ({itemHeight:e,refDragArea:t,refScrollArea:s,workspaceCount:n}){const{item:i,isDragging:a,initialClientOffset:o,initialSourceClientOffset:r,sourceClientOffset:l}=(0,nz.f)((e=>({item:e.getItem(),isDragging:e.isDragging(),initialClientOffset:e.getInitialClientOffset(),initialSourceClientOffset:e.getInitialSourceClientOffset(),sourceClientOffset:e.getSourceClientOffset()})));if(!a)return null;const d=m_.Z.getWorkspaceById(i.id);if(!d)return null;const{tabCount:c,isActive:h,isActiveInAnotherWindow:u}=i,{name:p,icon:g,emoji:m}=d,f=function(e,t){const s=e?.getBoundingClientRect(),n=t?.getBoundingClientRect();return s&&n?[Math.max(s.top,n.top),n.bottom]:[0,0]}(t.current,s.current),v=Boolean(s.current&&s.current.scrollHeight>s.current.clientHeight);return(0,zn.jsx)("div",{className:Gn()("workspace-custom-drag-layer",{"has-scrollbar":v}),children:(0,zn.jsxs)("button",{style:eJ(e,f,r,l,o),className:Gn()("workspace-item-wrapper",{selected:h&&!u}),title:p,children:[(0,zn.jsx)("div",{className:"avatar picker",dangerouslySetInnerHTML:{__html:m??g}}),(0,zn.jsxs)("div",{className:"title",children:[(0,zn.jsx)("p",{children:p}),(0,zn.jsx)("p",{className:"tab-count",children:u?(0,W.Z)("Active in another window"):(0,W.Z)("$1 tab","$1 tabs",[c])})]}),h&&!u?tJ:n>1?sJ:null]})})}function iJ({windowId:e,activeWorkspaceId:t,toolbarSize:s,onClick:n}){const i=Ze.ZP.isSelecting(e),a=!t,o=i||a,r=(0,Un.useCallback)((()=>{n()}),[n]),l=(0,Un.useCallback)((()=>{const t=i?Ze.ZP.getSelectedPages(e):a?Ze.ZP.getPages(e,{workspaceId:void 0}):(0,qe.aV)();return[{handler:()=>n(),...(0,fi.Z)("command","New Workspace")},...t.isEmpty()?[]:[{handler:()=>n(t),...(0,fi.Z)("New Workspace with $1 Selected Tab","New Workspace with $1 Selected Tabs",[t.size])}]]}),[a,i,n,e]);return(0,zn.jsx)(oa.ZP,{buttonClasses:"FormButton FormButton--WithIcon",menuOrigin:"bottomLeft",menu:o?l:void 0,isMenuIndicatorVisible:o,onClick:r,title:(0,W.Z)("command","New Workspace"),tabIndex:0,commandId:"COMMAND_WORKSPACE_CREATE_NEW"})}const aJ="draggable-workspace",oJ=Kn.S0Y;var rJ=(0,zn.jsx)("div",{className:"checkmark",children:(0,zn.jsx)(aa,{type:"checkmark"})}),lJ=(0,zn.jsx)(aa,{type:"reorder"});const dJ=Un.forwardRef((function({id:e,name:t,icon:s,emoji:n,audioStatus:i,tabCount:a,hibernatedCount:o,windowId:r,workspaceCount:l,isActive:d,isActiveInAnotherWindow:c,isRenaming:h,isPickingIcon:u,onSelect:p,onContextMenu:g,onShowIconModal:m,onToggleMuteWorkspaceTabs:f,findItem:v,moveItem:b,onDrop:C,nameInput:w,style:y,onKeyDown:x},I){const S=Un.useRef(),T=v(e)?.index,[{isDragging:E,handlerId:k},N,_]=(0,XB.c)((()=>({type:aJ,item:{id:e,originalIndex:T,name:t,tabCount:a,isActive:d,isActiveInAnotherWindow:c,workspaceCount:l},collect:e=>({isDragging:e.isDragging(),handlerId:e.getHandlerId()})})),[e,T,b]),[,P]=(0,QB.L)((()=>({accept:aJ,hover(t,s){if(!S.current||"number"!=typeof T)return;const n=t.originalIndex,i=T;if(n===i)return;const a=S.current?.getBoundingClientRect(),o=(a.bottom-a.top)/2,r=s.getClientOffset().y-a.top;n<i&&r<o||n>i&&r>o||(b(t.id,e),t.originalIndex=i)},drop:C})),[e,b]);return Un.useEffect((()=>{_((0,oz.r)(),{captureDraggingState:!0})}),[_]),l>1&&(N(S),P(S)),(0,zn.jsxs)("button",{ref:S,style:{...y,opacity:E?0:1},className:Gn()("workspace-item-wrapper draggable",{selected:d&&!c}),title:`${t} ${!c&&o>0?"\r\n"+(0,W.Z)("$1 hibernated tab","$1 hibernated tabs",[o]):""}`,onPointerUp:t=>t.button===ai.Z.kLeft&&p(e),onClick:t=>{t.preventDefault(),p(e)},onContextMenu:t=>g(t,e),"data-handler-id":k,onKeyDown:x,children:[(0,zn.jsx)("div",{ref:I,className:"avatar picker",onPointerDown:t=>m(t,e),onPointerUp:u?wi.ZP:nr.Z,onClick:wi.ZP,dangerouslySetInnerHTML:{__html:n??s??oJ}}),h&&w,!h&&(0,zn.jsxs)("div",{className:"title",children:[(0,zn.jsx)("p",{children:t}),(0,zn.jsx)("p",{className:"tab-count",children:c?(0,W.Z)("Active in another window"):(0,W.Z)("$1 tab","$1 tabs",[a])})]}),i&&(0,zn.jsx)("div",{className:Gn()("audio-container",{"workspace-inactive":!d||c}),onClick:wi.ZP,onPointerUp:t=>f(t,r,e,i),children:(0,zn.jsx)(Jq.Z,{animated:A.Z.get(Z.kThemeUseAnimation),mediaState:(0,qe.l4)([i]),src:"tab"})}),d&&!c?rJ:l>1?lJ:null]},e)})),cJ=Un.memo(dJ);function hJ({workspaceName:e,name:t,submitOnBlur:s,onSubmitEdit:n,onCancelEdit:i,onNameChange:a},o){const r=(0,Un.useContext)(oi.Z),[l,d]=(0,Un.useState)(!1),c=()=>{d(!0)};return(0,zn.jsx)("input",{ref:o,type:"text",name:t,value:e,onKeyDown:e=>{l||(e.keyCode===mo.Z.KEY_ENTER||e.keyCode===mo.Z.KEY_RETURN?n():e.keyCode===mo.Z.KEY_ESCAPE&&i())},onBlur:s?n:nr.Z,onFocus:e=>{e.target instanceof r.HTMLInputElement&&e.target.select()},onChange:a,onCompositionStart:c,onCompositionUpdate:c,onCompositionEnd:()=>{d(!1)}})}const uJ=(0,Un.forwardRef)(hJ);var pJ=s(34155);const gJ={stiffness:500,damping:32};function mJ(e,t){const s=Ze.ZP.getPageHistory(e);for(let t=s.length-1;t>-1;t--){const n=s[t],i=Ze.ZP.getPageInWindow(e,n);if(i&&void 0===(0,hg.cm)(i))return vs.jk.getDisplayTitle(i)}return""}function fJ(e,t,s,n){e.stopPropagation();const i=Ze.ZP.getPages(t,{workspaceId:s});"playing"===n?c.ZP.setMuting(t,"selection","mute",i):c.ZP.setMuting(t,"selection","unmute",i)}function vJ(){return m_.S[Math.floor(Math.random()*m_.S.length)]}var bJ=(0,zn.jsx)(oa.ZP,{image:Kn.BmN,tooltip:" ",size:"small",className:"avatar",imageOnly:!0,name:"WorkspaceButton"}),CJ=(0,zn.jsx)("div",{className:"checkmark",children:(0,zn.jsx)(aa,{type:"checkmark"})}),wJ=(0,zn.jsx)("hr",{});const yJ=Un.forwardRef((function(e,t){const{windowId:s,activeWorkspaceId:n,hidePopup:i}=e,a=Un.useContext(oi.Z),o=iE(),r=Un.useRef(),l=Un.useRef(null),d=Un.useRef(null),h=Ze.ZP.getActiveWorkspaces(),[u,p]=Un.useState(void 0),[g,m]=Un.useState(void 0),[f,v]=Un.useState(""),[b,w]=Un.useState(),[y,x]=Un.useState(0),I=Un.useRef(),S=Un.useRef(),T=Un.useMemo((()=>new Map),[]),{counts:E,playingAudio:k}=function(e){const t=m_.Z.getState(),s=fe.ZP.isIncognitoOrGuest(e),n=new Map(t.map((e=>[e.id,[0,0]]))),i=new Map(t.map((e=>[e.id,void 0])));let a=new qe.l4;const o=(0,dS.Z)(Ze.ZP);for(const[t,r]of o)s===fe.ZP.isIncognitoOrGuest(t)&&r.list.groupBy(hg.cm).forEach(((s,o)=>{let r;void 0===o&&e!==t||(s.some((e=>e.audible&&!e.vivExtData.vivaldi_tab_muted?(r="playing",!0):(e.audible&&e.vivExtData.vivaldi_tab_muted&&(r="muting"),!1))),i.set(o,r),!o||n.has(o)||fe.ZP.isIncognitoOrGuest(t)||(console.warn(`Workspace ${o} no longer exists.`),a=a.add(o)),n.set(o,[s.size,s.count((e=>e.discarded))]))}));for(const e of a)GB.Z.addWorkspaceWithId(e,(0,W.Z)("Restored workspace"),vJ(),void 0);return{counts:n,playingAudio:i}}(s),[N,_]=Un.useState(""),[P,M]=Un.useState(""),[D,O]=Un.useState(),[j,L]=Un.useState(!1),R=k.get(void 0),B=e.workspaces.length,F=Un.useRef(!0);Un.useEffect((()=>{if(!F.current||"number"!=typeof n)return;const e=T.get(n)?.current;e&&a.requestAnimationFrame((()=>{e.scrollIntoViewIfNeeded(!0),F.current=!1}))}));const[U,V]=Un.useState(e.workspaces),H=Un.useRef(e.workspaces);U!==e.workspaces&&(H.current=e.workspaces,V(e.workspaces));const G=Un.useCallback((async e=>{g&&e===g||(e!==n&&c.ZP.setActiveWorkspace(s,e),i())}),[n,i,g,s]),K=Un.useCallback(((e,t)=>{const a="workspacelist",o=Boolean(t&&h.has(t)),r=o&&t!==n,l=ei.Z.getOptionFunction(a),d=t?Ze.ZP.getWorkspacePages(t):Ze.ZP.getPages(s,{workspaceId:void 0});return ei.Z.getNamedMenu(s,a,(async e=>{switch(e.action){case"CONTEXT_WORKSPACE_RENAME":return{handler:()=>{m(t);const e=H.current?.find((e=>e.id===t))?.name??"";_(e),pJ.nextTick((()=>{S.current?.select()}))},isVisible:()=>Boolean(t),...l(s,e,t)};case"CONTEXT_WORKSPACE_DELETE":return{isEnabled:()=>!r,handler:()=>{i(),t&&ue.Z.showDeleteWorkspace(s,{workspaceId:t})},isVisible:()=>Boolean(t),...l(s,e,t)};case"CONTEXT_WORKSPACE_OPEN_IN_NEW_WINDOW":return{isEnabled:()=>!o,handler:e=>{t&&c.ZP.detachWorkspace(s,t).finally(i)},isVisible:()=>Boolean(t),...l(s,e,t)};case"CONTEXT_WORKSPACE_HIBERNATE":return{handler:()=>{d.filter((e=>!(e.active||e.discarded))).forEach(c.ZP.discardPage),i()},isVisible:()=>d.some((e=>!(e.active||e.discarded))),...l(s,e,t)};case"CONTEXT_WORKSPACE_COPY_URLS":case"COMMAND_PAGE_COPY_ALL_URLS":{const n=void 0===t?s===fe.ZP.getActiveWindowId()&&void 0===Ze.ZP.getActiveWorkspace(s):t===Ze.ZP.getActiveWorkspace(s),a={...l(s,{...e,action:"COMMAND_PAGE_COPY_ALL_URLS"},t)};return{...a,handler:()=>{c.ZP.copyAllUrls(s,t),i()},shortcuts:n?a.shortcuts:[]}}default:return{...l(s,e,t)}}}))}),[n,h,i,s,H]),z=Un.useCallback(((e,t)=>{e.persist(),e.preventDefault(),e.stopPropagation(),K(e,t).then((t=>{(0,mi.Z)(a,t)(e)}))}),[a,K]),$=e=>{const t=e.currentTarget,s=t.parentElement?.parentElement?.querySelectorAll(".this-window,.workspace-item-wrapper:not([disabled])");if(s?.length)switch(e.key){case"ArrowUp":let e=Array.from(s).indexOf(t)-1;e<0&&(e=s.length-1),s[e].focus();break;case"ArrowDown":let n=Array.from(s).indexOf(t)+1;n>=s.length&&(n=0),s[n].focus();break;default:return}},Y=Un.useCallback(((t,s)=>{if(t.button!==ai.Z.kLeft)return;(0,wi.ZP)(t);const n=I.current?.getBoundingClientRect().top??0,i=T.get(s)?.current?.getBoundingClientRect().top??0;if(i-30+266>a.window.innerHeight-133){x(-(n-i+30+266))}else{x(i-n+30)}const o=e.workspaces.find((e=>e.id===s));o?.emoji?w(o.emoji):o?.icon&&(v(o.icon),w(void 0)),p(s)}),[a.window.innerHeight,T,e.workspaces]),X=()=>{p(void 0)},Q=(e,t)=>{if(t){const s=Un.createRef();s.current=t,T.set(e,s)}else T.delete(e)},q=Un.useCallback((()=>{N&&P&&(L(!1),m(void 0),GB.Z.addWorkspace(N,P,D,r.current),i())}),[i,D,P,N]),J=Un.useCallback((()=>{const e=g;m(void 0),N&&e&&GB.Z.setName(e,N)}),[g,N]),ee=Un.useCallback((e=>{_(e.currentTarget.value)}),[]),te=Un.useCallback((()=>{g?J():q()}),[q,J,g]),se=Un.useCallback((()=>{L(!1),m(void 0)}),[]),ne=Un.useCallback((e=>{const t=H.current??[],s=t.find((t=>t.id===e));if(s)return{item:s,index:t.indexOf(s)}}),[H]),ie=Un.useRef(null),ae=Un.useCallback(((e,t)=>{const s=()=>{o(),ie.current=null},n=ne(e)?.index,i=H.current;if(i&&"number"==typeof n){const n=i.find((t=>t.id===e)),o=i.find((e=>e.id===t)),r=i.indexOf(n),l=i.indexOf(o);H.current=(0,C.Uy)(i,(e=>{const[t]=e.splice(r,1);e.splice(l,0,t)})),ie.current||(ie.current=a.requestAnimationFrame(s))}}),[a,ne,o]),oe=Un.useCallback((()=>{const e=H.current?.map((e=>e.id))??[];GB.Z.setOrder(e)}),[]),re=Un.useMemo((()=>({position:"relative",minHeight:44*B+8})),[B]),[le,de]=E.get(void 0)??[0,0];return(0,zn.jsxs)("div",{ref:I,className:"WorkspacePopup",onDoubleClick:wi.ZP,children:[(0,zn.jsxs)("div",{ref:d,className:"WorkspacePopup-Items",children:[B>0&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("button",{ref:t,className:"this-window",onPointerUp:e=>e.button===ai.Z.kLeft&&G(void 0),onClick:e=>{e.preventDefault(),G(void 0)},onContextMenu:z,onKeyDown:$,children:[bJ,(0,zn.jsxs)("div",{className:"title",children:[(0,zn.jsx)("p",{children:mJ(s)}),(0,zn.jsx)("p",{className:"tab-count",title:de>0?(0,W.Z)("$1 hibernated tab","$1 hibernated tabs",[de]):"",children:(0,W.Z)("$1 tab","$1 tabs",[le])})]}),R&&(0,zn.jsx)("div",{className:Gn()("audio-container",{"workspace-inactive":void 0!==Ze.ZP.getActiveWorkspace(s)}),onClick:e=>fJ(e,s,void 0,R),children:(0,zn.jsx)(Jq.Z,{animated:A.Z.get(Z.kThemeUseAnimation),mediaState:(0,qe.l4)([R]),src:"tab"})}),void 0===Ze.ZP.getActiveWorkspace(s)&&CJ]}),wJ]}),!j&&0===B&&(0,zn.jsxs)("div",{className:"no-workspaces-note",children:[(0,zn.jsx)("h1",{children:(0,W.Z)("Get organized with Workspaces")}),(0,zn.jsx)("p",{className:"faded-text",children:(0,W.Z)("Organize tabs by separating your social, work, and hobbies into Workspaces.")})]}),(0,zn.jsx)("div",{ref:l,className:"WorkspacePopup-DragArea",style:re,children:H.current?.map((({name:e,icon:t,emoji:i,id:a},o)=>{const r=h.has(a),l=r&&a!==n,d=g===a,c=k.get(a);return(0,zn.jsx)(lF,{style:{posY:uF(44*o,gJ)},children:({posY:n})=>{const[o,h]=E.get(a)??[0,0];return(0,zn.jsx)(cJ,{ref:e=>Q(a,e),id:a,windowId:s,name:e,icon:t,emoji:i,audioStatus:c,isActive:r,isActiveInAnotherWindow:l,isPickingIcon:!!u,isRenaming:d,tabCount:o,hibernatedCount:h,workspaceCount:B,onSelect:G,onContextMenu:z,onShowIconModal:Y,onToggleMuteWorkspaceTabs:fJ,findItem:ne,moveItem:ae,onDrop:oe,style:{transform:`translate3d(0, ${n}px, 0)`},onKeyDown:$,nameInput:d?(0,zn.jsx)(uJ,{ref:S,name:"",workspaceName:N,submitOnBlur:!0,onNameChange:ee,onSubmitEdit:te,onCancelEdit:se}):null})}},a)}))}),(0,zn.jsx)(nJ,{itemHeight:44,refDragArea:l,refScrollArea:d,workspaceCount:B}),j&&(0,zn.jsxs)(zn.Fragment,{children:[0===B&&(0,zn.jsx)("label",{htmlFor:"workspace-title",className:"first-workspace-info",children:(0,W.Z)("Workspace Name")}),(0,zn.jsxs)("button",{className:"workspace-item-wrapper",title:(0,W.Z)("title","New Workspace"),children:[(0,zn.jsx)("div",{className:"avatar picker",ref:e=>Q(1,e),onClick:e=>Y(e,1),dangerouslySetInnerHTML:{__html:D??P}}),(0,zn.jsx)("div",{className:"title",children:(0,zn.jsx)(uJ,{name:"workspace-title",ref:S,workspaceName:N,submitOnBlur:!j,onNameChange:ee,onSubmitEdit:te,onCancelEdit:se})})]},"NEW_WORKSPACE")]})]}),(0,zn.jsxs)("div",{className:"actions",children:[j&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("input",{type:"button",className:"primary",value:(0,W.Z)("Create"),disabled:!N,onClick:q}),(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Cancel"),onClick:se})]}),!j&&(0,zn.jsx)(iJ,{windowId:s,activeWorkspaceId:n,toolbarSize:"small",onClick:e=>{r.current=e;const t=vJ(),s=KB();_(s),M(t),O(void 0),L(!0),pJ.nextTick((()=>{S.current?.focus()}))}})]}),u&&(0,zn.jsx)(HB,{closeModal:X,onPick:e=>{u?(1!==u?"number"==typeof e?GB.Z.setIcon(u,e):GB.Z.setEmoji(u,e):j&&("number"==typeof e?(M(m_.S[e]),O(void 0)):O(e)),X()):X()},top:y,left:10,activeIcon:f,activeEmoji:b})]})})),xJ=mF(yJ),IJ=[Z.kWorkspacesEnabled];class AJ extends Un.PureComponent{static contextType=oi.Z;refPopup=Un.createRef();constructor(e,t){super(e),this.windowId=t.vivaldiWindowId;const s=m_.Z.getState(),n=Ze.ZP.getActiveWorkspace(this.windowId);this.state={activeWorkspaceId:n,popupVisible:!1,workspaces:s,showName:this.getShowName(),pageIdPlayingAudio:void 0},this.props.inEditor||(m_.Z.addListener(this._onWorkspaceStoreChanged),Ze.ZP.addListener(this._onPageStoreChanged),A.Z.addListener(Z.kWorkspacesButtonShowName,this._onPrefsChange),go.Z.addListener("COMMAND_SHOW_WORKSPACE_MENU",this._onCommandSpy))}componentWillUnmount(){this.props.inEditor||(m_.Z.removeListener(this._onWorkspaceStoreChanged),Ze.ZP.removeListener(this._onPageStoreChanged),A.Z.removeListener(Z.kWorkspacesButtonShowName,this._onPrefsChange),go.Z.removeListener("COMMAND_SHOW_WORKSPACE_MENU",this._onCommandSpy))}componentDidUpdate(e,t){!t.popupVisible&&this.state.popupVisible&&this.focusPopup()}_onCommandSpy=e=>{this.props.inTabbar&&e===this.context.vivaldiWindowId&&this.togglePopup()};_onPageStoreChanged=()=>{const e=Ze.ZP.getActiveWorkspace(this.windowId),t=fe.ZP.isIncognitoOrGuest(this.windowId),s=(()=>{if(void 0!==this.state.pageIdPlayingAudio){const t=Ze.ZP.getPageById(this.state.pageIdPlayingAudio);if(t&&t.audible&&!t.vivExtData.vivaldi_tab_muted&&e!==(0,hg.cm)(t))return this.state.pageIdPlayingAudio}for(const[s,n]of Ze.ZP.getState()){if(t!==fe.ZP.isIncognitoOrGuest(s))continue;const i=n.list.groupBy(hg.cm).find(((t,n)=>{if(n!==e&&(void 0!==n||s===this.windowId))return t.find((e=>e.audible&&!e.vivExtData.vivaldi_tab_muted))}))?.first();if(i)return i.id}})();this.setState({activeWorkspaceId:e,pageIdPlayingAudio:s})};_onWorkspaceStoreChanged=()=>{this.setState({workspaces:m_.Z.getState()})};_onPrefsChange=()=>{this.setState({showName:this.getShowName()})};isVertical=()=>{const e=A.Z.get(Z.kTabsBarPosition);return"left"===e||"right"===e};getShowName=()=>this.props.inTabbar?Boolean(A.Z.get(Z.kWorkspacesButtonShowName)||this.isVertical()):A.Z.get(Z.kWorkspacesButtonShowName);getIcon=e=>e?.emoji??e?.icon??Kn.M8b.medium;togglePopup=()=>{this.setState((e=>({popupVisible:!e.popupVisible})))};hidePopup=()=>this.setState({popupVisible:!1});focusPopup=()=>{this.refPopup.current?.focus()};handleWheel=(0,Wv.Z)((e=>{if(e.deltaY&&A.Z.get(Z.kWorkspacesButtonMouseWheelEnabled)){const t=this.context.vivaldiWindowId;e.deltaY>0?GB.Z.activateNextByOrder(t):GB.Z.activatePreviousByOrder(t)}}),500);getContextMenu=()=>[{handler:()=>I.Z.set(Z.kWorkspacesButtonShowName,!A.Z.get(Z.kWorkspacesButtonShowName)),type:"checkbox",checked:A.Z.get(Z.kWorkspacesButtonShowName),isEnabled:()=>!this.props.inTabbar||!this.isVertical(),...(0,fi.Z)("Display Workspace Name")},{handler:()=>I.Z.set(Z.kWorkspacesButtonShowInTabbar,!A.Z.get(Z.kWorkspacesButtonShowInTabbar)),type:"checkbox",checked:A.Z.get(Z.kWorkspacesButtonShowInTabbar),...(0,fi.Z)("Show Workspaces in Tab Bar")}];render(){if(!this.props.prefValues[Z.kWorkspacesEnabled]&&!this.props.inEditor&&!this.props.preview)return null;const{showName:e,pageIdPlayingAudio:t,workspaces:s,activeWorkspaceId:n}=this.state,i=this.state.workspaces.find((e=>e.id===n));let a="";this.props.inEditor?a=(0,W.Z)("Workspaces"):e&&(a=i?.name??(0,W.Z)("Workspaces"));const o=a||(0,W.Z)("Workspaces"),r=Math.min(o.length,16);return(0,zn.jsx)(oa.ZP,{image:this.props.inEditor?Kn.BmN:this.getIcon(i),imageOverride:this.props.inEditor||!n?"WorkspaceButton":"none",label:(0,W.Z)("Workspaces"),tooltip:o,onClick:this.togglePopup,onPointerDown:this.togglePopup,customizeMenu:this.props.customizeMenu,menuOrigin:this.props.menuOrigin,popupPosition:this.props.popupPosition,className:Gn()("workspace-popup workspace-anchor",{"tabbar-workspace-button":this.props.inTabbar,label:A.Z.get(Z.kWorkspacesButtonShowName)&&n,"no-icon":void 0!==t&&this.isVertical()&&this.props.maxWidth&&this.props.maxWidth<60}),popupClassName:"ToolbarButtonPopup-DefaultStyles",popupLabel:(0,W.Z)("dialog title","Workspaces"),popupWidth:250,hidePopup:this.hidePopup,isPopupVisible:this.state.popupVisible,size:this.props.size,draggable:this.props.draggable||!1,onDragStart:this.props.onDragStart??nr.Z,onDragEnd:this.props.onDragEnd??nr.Z,onDrop:this.props.onDrop??nr.Z,onDragEnter:this.props.onDragEnter??nr.Z,onDragLeave:this.props.onDragLeave??nr.Z,onDragOver:this.props.onDragOver??nr.Z,onWheel:this.handleWheel,mimeType:this.props.mimeType,name:this.props.name,title:this.props.maxWidth&&this.props.maxWidth<80?void 0:a,isMenuIndicatorVisible:!this.props.maxWidth||this.props.maxWidth>=60,isMenuIndicatorDisabled:!0,menu:this.getContextMenu,style:this.props.maxWidth?{width:this.props.maxWidth}:{"--titleChars":r+"ex"},mediaState:void 0!==t,mediaStateType:"workspace",onFocus:this.focusPopup,commandId:"COMMAND_SHOW_WORKSPACE_MENU",children:(0,zn.jsx)(xJ,{ref:this.refPopup,windowId:this.context.vivaldiWindowId,activeWorkspaceId:n,workspaces:s,hidePopup:this.hidePopup})})}}const SJ=(0,zd.Z)((0,cc.ZP)(AJ),IJ);class ZJ extends Un.Component{render(){const{index:e,name:t,preview:s,label:n="",customizeMenu:i=(()=>[]),popupPosition:a="below",menuOrigin:o="bottomLeft",mimeType:r,onDragStart:l,onDragEnd:d,onDrop:c,onDragEnter:h,draggable:u,inEditor:p=!1,forceIcon:g=!1}=this.props,m={name:t,label:n,customizeMenu:i,size:"large",popupPosition:a,menuOrigin:o,draggable:u,onDragStart:l,onDragEnd:d,onDrop:c,onDragEnter:h,mimeType:r,preview:s};if(t.startsWith("COMMAND_"))return(0,zn.jsx)(qq,{...m,commandButton:!0,index:e,inEditor:p});if(nc.ZP.isWebPanel(t))return(0,Un.createElement)(jm,{...m,key:t,inEditor:p,isMailWindow:this.props.isMailWindow});switch(t){case"Back":case"Forward":case"Rewind":case"FastForward":case"Reload":case"Stop":case"Home":return(0,zn.jsx)(pg,{...m,inEditor:p});case"BreakMode":return(0,zn.jsx)(_c,{...m,inEditor:p});case"Clock":return(0,zn.jsx)(Gh,{...m,inEditor:p});case"AccountButton":return(0,zn.jsx)(mc,{...m});case"ReadingList":return(0,zn.jsx)(Hm,{...m,inEditor:p});case"Extensions":return(0,zn.jsx)(qu.C,{...m,inEditor:p});case"UpdateButton":return(0,zn.jsx)(Kq,{...m,inEditor:p});case"MailStatus":return(0,zn.jsx)(_p,{...m,inEditor:p,isMailWindow:this.props.isMailWindow});case"CalendarStatus":return(0,zn.jsx)(Zh,{...m,inEditor:p,isMailWindow:this.props.isMailWindow});case"DownloadButton":return(0,zn.jsx)(Qu,{...m,inEditor:p});case"WorkspaceButton":return(0,zn.jsx)(SJ,{...m,inEditor:p});case"AddressField":case"SearchField":case"PanelToggle":case"SyncStatus":case"StatusInfo":case"VersionInfo":case"CaptureImages":case"TilingToggle":case"ImagesToggle":case"PageActions":case"Zoom":case"Settings":case"Proxy":return(0,zn.jsx)(Fq,{...m,inEditor:p,forceIcon:g});case"ShareVivaldi":return(0,zn.jsx)(ef,{...m,inEditor:p});case"MailBack":case"MailForward":case"MailReload":case"MailRenderingMethod":case"MailRenderingMethodText":case"MailViewLayout":case"MailViewThreading":case"MailViewThreadingFlat":case"MailViewQuickResponse":return(0,zn.jsx)(gp,{...m,disabled:!1});case"MailSearch":return(0,zn.jsx)(dp,{...m,inEditor:p});case"MailMsgEdit":case"MailMsgReply":case"MailMsgReplyToAll":case"MailMsgForward":case"MailMsgStatusRead":case"MailMsgStatusUnread":case"MailMsgFlag":case"MailMsgLabel":case"MailMsgSend":case"MailMsgShowHeaders":case"MailMsgSpam":case"MailMsgSpamRestore":case"MailMsgDiscard":case"MailMsgAttach":case"MailMsgTrash":case"MailMsgTrashRestore":case"MailMsgMove":case"MailMsgArchive":case"MailMsgArchiveRestore":case"MailCompose":case"MailUndo":return(0,zn.jsx)(ag,{...m,inEditor:p});case"PanelBookmarks":case"PanelReadingList":case"PanelDownloads":case"PanelHistory":case"PanelNotes":case"PanelWindow":case"PanelTranslate":case"PanelMail":case"PanelCalendar":case"PanelTasks":case"PanelFeeds":case"PanelContacts":case"PanelChat":case"PanelSession":case"PanelWeb":return(0,Un.createElement)(jm,{...m,key:t,inEditor:p,isMailWindow:this.props.isMailWindow});case"Game":return(0,zn.jsx)(tp,{...m,isStartPage:!1});case"Spacer":case"FlexibleSpacer":case"PanelWidthSpacer":case"Divider":return(0,zn.jsx)(qq,{...m,index:e,inEditor:p});case"VPNButton":return(0,zn.jsx)(tj,{...m,index:e,inEditor:p});default:return console.warn(`ToolbarButton “${t}” not found`),null}}}class TJ extends Un.PureComponent{static contextType=oi.Z;lastKeyWasAltDown=!1;componentDidMount(){const{selectWindow:e}=this.context;re.Z.tabsPrivate.onMouseChanged.addListener(this._onMouseChanged),re.Z.tabsPrivate.onKeyboardChanged.addListener(this._keyEventListener),re.Z.windowPrivate.onPositionChanged.addListener(this._onWindowPositionChanged),go.Z.addListener("COMMAND_FOCUS_MAINMENU",this._onCommandSpy),fe.ZP.addListener(this._onWindowStoreChanged,e)}componentWillUnmount(){re.Z.tabsPrivate.onMouseChanged.removeListener(this._onMouseChanged),re.Z.tabsPrivate.onKeyboardChanged.removeListener(this._keyEventListener),re.Z.windowPrivate.onPositionChanged.removeListener(this._onWindowPositionChanged),go.Z.removeListener("COMMAND_FOCUS_MAINMENU",this._onCommandSpy),fe.ZP.removeListener(this._onWindowStoreChanged)}_onCommandSpy=e=>{e===this.context.vivaldiWindowId&&fe.ZP.isActive(this.context.vivaldiWindowId)&&this.props.changeFocus()};_onWindowStoreChanged=()=>{!fe.ZP.isActive(this.context.vivaldiWindowId)&&this.props.showAccessKeys&&this.props.showAccessKeys(!1)};_onMouseChanged=e=>{!1===e&&(this.lastKeyWasAltDown=!1)};_onWindowPositionChanged=()=>{this.lastKeyWasAltDown=!1};_keyEventListener=(e,t,s,n,i,a)=>{if(n===mo.Z.KEY_ALT&&!a&&this.context.vivaldiWindowId===e&&fe.ZP.isActive(e)){const e=t?4===s:0===s;e&&this.props.showAccessKeys&&this.props.showAccessKeys(t),!t&&!i&&this.lastKeyWasAltDown&&A.Z.get(Z.kKeyboardShortcutsAltOpensMenu)&&this.props.changeFocus(),this.lastKeyWasAltDown=e&&t}else this.lastKeyWasAltDown=!1};render(){return null}}const EJ=TJ;let kJ=0,NJ=0,_J=0,PJ=!1;const MJ=new Map;let DJ=!1;const OJ=function(e,t,s,n,i,a){const o=t.filter((t=>!t.isVisible||t.isVisible(e,!1))).map((t=>{const o={item:void 0,separator:void 0,container:void 0,children:void 0};if(t.isList){if(_J<s)return PJ=!0,o;if(_J<NJ)return PJ=!0,o}else _J<NJ&&(PJ=!0);const r=t.isList?_J--:NJ++,l=st.Z.getDisplayName(t);if(t.handler&&(l||t.url)&&MJ.set(r,t.handler),t.container?.details)o.container=t.container.details;else if(st.Z.isSeparator(t))o.separator={};else{const d=void 0!==t.id&&""!==n&&t.id===n;let c;switch((t.iconPNG||t.iconPNGWhite)&&(c=[t.iconPNG||"",t.iconPNGWhite||""]),"folder"===t.type||t.commandName||console.warn("Menu element. Not a folder nor a command",l),t.type){case"checkbox":case"radio":o.item={id:r,name:l,type:t.type,radiogroup:t.radiogroup?t.radiogroup:-1,checked:t.checked,enabled:!t.isEnabled||t.isEnabled(e),shortcut:st.Z.getShortcut(t,i).value,url:t.url,icons:c};break;default:o.item={id:r,name:l,type:t.items?"folder":"command",selected:d,persistent:t.persistent,enabled:!t.isEnabled||t.isEnabled(e),shortcut:st.Z.getShortcut(t,i).value,url:t.url,icons:c},t.items&&(o.children=OJ(e,t.items,s,n,i,a))}}return o}));return a?o.filter((e=>e.item||e.separator||e.container)):o},jJ={show:function(e,t,s,n,i){const a=e.vivaldiWindowId,o=st.Z.getShortcutSettings();let r;const l=function(e){i&&i(e)},d=function(){u(),i&&i(-1)},c=function(t){const s=MJ.get(t.id);if(s){const n={origin:"menu",context:e,windowId:a,keyState:{shiftKey:t.state.shift,ctrlKey:t.state.ctrl,altKey:t.state.alt,metaKey:t.state.command,key:""}};t.state.left?n.button=0:t.state.right?n.button=2:t.state.center&&(n.button=1),s(n)}},h=function(e){console.warn(e)},u=function(){Xa.Z.onHover(a,""),re.Z.menubarMenu.onAction.removeListener(c),re.Z.menubarMenu.onOpenBookmark.removeListener(Xa.Z.onOpen),re.Z.menubarMenu.onBookmarkAction.removeListener(Xa.Z.onAction),re.Z.menubarMenu.onHover.removeListener(Xa.Z.onHover),re.Z.menubarMenu.onOpen.removeListener(l),re.Z.menubarMenu.onClose.removeListener(d),re.Z.menubarMenu.onError.removeListener(h),clearInterval(r),setTimeout((()=>{DJ=!1}),1)},p=function(e){s.forEach((e=>{st.Z.installMnemonics(e.menu.items,e.menu.preferred)})),NJ=0,_J=e,MJ.clear(),PJ=!1;let n=s.map((e=>({id:e.id,rect:e.rect,children:OJ(a,e.menu.items,0,e.menu.expandId,o,!1)})));if(PJ){console.warn("Menu truncated. Too many items");const t=NJ;NJ=0,_J=e,MJ.clear(),n=s.map((e=>({id:e.id,rect:e.rect,children:OJ(a,e.menu.items,t,e.menu.expandId,o,!0)})))}(function(e){return re.Z.zoom.getVivaldiUIZoom().then((t=>{e.forEach((e=>{e.rect.x=parseInt((e.rect.x+1)*t),e.rect.y=parseInt((e.rect.y+0)*t),e.rect.width=parseInt(e.rect.width*t),e.rect.height=parseInt(e.rect.height*t)}))}))})(n).then((()=>{re.Z.menubarMenu.onAction.addListener(c),re.Z.menubarMenu.onOpenBookmark.addListener(Xa.Z.onOpen),re.Z.menubarMenu.onBookmarkAction.addListener(Xa.Z.onAction),re.Z.menubarMenu.onHover.addListener(Xa.Z.onHover),re.Z.menubarMenu.onOpen.addListener(l),re.Z.menubarMenu.onClose.addListener(d),re.Z.menubarMenu.onError.addListener(h),r=setInterval((()=>{re.Z.utilities.emulateUserInput(a)}),2e3),re.Z.menubarMenu.show({windowId:a,id:t,siblings:n,icons:[nt.Z,Ja.Z,eo.Z,to.Z,so.Z,Qa.Z,qa.Z]},(()=>{}))}))};DJ||(DJ=!0,0===kJ?re.Z.menubarMenu.getMaxId((e=>{kJ=e,p(kJ)})):p(kJ))}},LJ=jJ,RJ=[Z.kKeyboardShortcutsAltOpensMenu,Z.kMenuIconType],BJ="vivaldi";class FJ extends Un.Component{static contextType=oi.Z;refButton=Un.createRef();shortcuts=[];hasMenu=!1;state={keyShortcut:""};componentDidMount(){A.Z.addListener(Z.kKeyboardShortcutsAltOpensMenu,this._onPrefsChange),Ye.Z.addListener(this._onCommandStoreChange),this.hasMenu=Ye.Z.isNamedMenuAvailable(BJ),this.hasMenu?this._setupShortcuts(!0):this._requestMenu(),this._setButtonKeyshortcut()}componentWillUnmount(){A.Z.removeListener(Z.kKeyboardShortcutsAltOpensMenu,this._onPrefsChange),Ye.Z.removeListener(this._onCommandStoreChange),this.shortcuts.forEach((e=>{e.shortcut&&Qe.Z.unbind(e.shortcut,this._showSubMenu)}))}_setButtonKeyshortcut(){this.setState({keyShortcut:Ye.Z.getShortcut("COMMAND_FOCUS_MAINMENU",!1)})}_onPrefsChange=()=>{this._setupShortcuts(!1)};_onCommandStoreChange=e=>{switch(e){case"init":this._requestMenu(),this._setButtonKeyshortcut();break;case"menu":this.hasMenu=!0,this._setupShortcuts(!1);break;case"shortcut":this._setupShortcuts(!1),this._setButtonKeyshortcut()}};_changeFocus=()=>{this._showMenu(-1)};_requestMenu(){this.hasMenu||ae.Z.requestNamedMenu(BJ)}_getMenuItems=e=>Ye.Z.getNamedMenu(this.context.vivaldiWindowId,BJ,e);_setupShortcuts=e=>{this.shortcuts.forEach((e=>{e.shortcut&&Qe.Z.unbind(e.shortcut,this._showSubMenu)})),this.shortcuts=[],this.props.prefValues[Z.kKeyboardShortcutsAltOpensMenu]?(this.shortcuts=st.Z.getShortcutsForSubMenus(this._getMenuItems(!1)),this.shortcuts.forEach((e=>{e.shortcut&&Qe.Z.bind(e.shortcut,this._showSubMenu)}))):e&&this._getMenuItems(!1)};_showMenu=e=>{const t=this.refButton.current?.getBoundingClientRect();if(!t)return;const s=this._getMenuItems(!0),n=e<0?"":s[e].id||"",i={id:0,rect:{x:parseInt(t.left),y:parseInt(t.top),width:parseInt(t.width),height:parseInt(t.height)},menu:{items:s,expandId:n,preferred:this.shortcuts}};LJ.show(this.context,i.id,[i],"bottom")};_showSubMenu=e=>{this.shortcuts.forEach((t=>{t.shortcut&&t.key===e.keyState.key&&this._showMenu(t.index)}))};_handleDoubleClick=e=>{e.preventDefault(),e.stopPropagation()};_handleKeyDown=e=>{switch(e.key){case"ArrowDown":case"Enter":this._showMenu(-1);break;case"Escape":ae.Z.executeActions("shortcut",this.context,"COMMAND_FOCUS_WEBVIEW");break;default:return}(0,wi.ZP)(e)};render(){const{keyShortcut:e}=this.state,{inert:t}=this.props,s=(0,W.Z)("Menu"),n=e?(0,W.Z)("$1 ($2)",[s,e]):s;return(0,zn.jsxs)(Un.Fragment,{children:[(0,zn.jsx)(EJ,{changeFocus:this._changeFocus}),(0,zn.jsxs)("button",{ref:this.refButton,className:"vivaldi",style:{boxShadow:"none",display:this.props.isHidden?"none":void 0},onMouseDown:()=>this._showMenu(-1),onKeyDown:this._handleKeyDown,onDoubleClick:this._handleDoubleClick,tabIndex:this.props.keyAccess,inert:t?"inert":null,title:n,"aria-label":s,"aria-keyshortcuts":e,children:["icon"===this.props.prefValues[Z.kMenuIconType]&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("span",{className:"vivaldi-v",dangerouslySetInnerHTML:{__html:Kn.Qa2}}),(0,zn.jsx)("span",{className:"expand-arrow",dangerouslySetInnerHTML:{__html:Kn.uIM}})]}),"burger"===this.props.prefValues[Z.kMenuIconType]&&(0,zn.jsx)("span",{className:"burger-icon",dangerouslySetInnerHTML:{__html:Kn.nl2}})]})]})}}const WJ=(0,zd.Z)(FJ,RJ);var UJ=s(34155);const VJ="vivaldi/x-toolbar-name",HJ="vivaldi/x-button-index";let GJ=!1;var KJ=(0,zn.jsx)(sc,{onMainBar:!0});class zJ extends Un.PureComponent{static contextType=oi.Z;refToolbar=Un.createRef();_dropOnSelf=!1;_dragIndex=null;constructor(e,t){super(e),this.state={modifier:!1,editMode:""!==xt.Z.getState(),isMailWindow:fe.ZP.isMail(t.vivaldiWindowId),buttons:e.showDefaultSet?(0,Rp.Gt)(t.vivaldiWindowId,!0,A.Z.getDefault(e.name)):(0,Rp.Gt)(t.vivaldiWindowId,!1,A.Z.get(e.name)),dragging:!1}}componentDidMount(){this.props.showDefaultSet||(Ye.Z.addListener(this.onCommandStoreChanged),A.Z.addListener(this.props.name,this.onPrefsChanged),xt.Z.addListener(this.editModeListener),fe.ZP.addListener(this.onWindowStoreChanged),re.Z.tabsPrivate.onKeyboardChanged.addListener(this.modifierKeyListener))}componentWillUnmount(){this.props.showDefaultSet||(Ye.Z.removeListener(this.onCommandStoreChanged),A.Z.removeListener(this.props.name,this.onPrefsChanged),xt.Z.removeListener(this.editModeListener),fe.ZP.removeListener(this.onWindowStoreChanged),re.Z.tabsPrivate.onKeyboardChanged.removeListener(this.modifierKeyListener))}onCommandStoreChanged=e=>{"shortcut"===e&&UJ.nextTick((()=>{const e=A.Z.get(this.props.name);if(e.some((e=>e.startsWith("COMMAND_")))){const t=A.Z.get(Z.kChainedCommandsCommandList).map((e=>e.name)),s=e.reduce(((e,s)=>(s.startsWith("COMMAND_")&&!t.includes(s)||e.push(s),e)),[]);e.length!==s.length&&I.Z.set(this.props.name,s)}}))};onWindowStoreChanged=()=>{this.state.modifier&&this.setState({modifier:!1});const e=fe.ZP.isMail(this.context.vivaldiWindowId);e!==this.state.isMailWindow&&this.setState({isMailWindow:e,buttons:(0,Rp.Gt)(this.context.vivaldiWindowId,!1,A.Z.get(this.props.name))})};modifierKeyListener=(e,t,s,n)=>{this.context.vivaldiWindowId!==e||fe.ZP.isGuest()||n===mo.Z.KEY_CONTROL&&this.setState({modifier:t})};editModeListener=()=>{this.setState({editMode:""!==xt.Z.getState()})};onPrefsChanged=(e,t)=>{this.setState({buttons:(0,Rp.Gt)(this.context.vivaldiWindowId,Boolean(this.props.showDefaultSet),t)})};editToolbar=e=>ic.Z.edit(e);reset=()=>{const e=this.props.name;ue.Z.showResetToolbarConfirmation(this.context.vivaldiWindowId,(t=>{t&&((0,Rp.Np)(this.context.vivaldiWindowId,e),I.Z.reset(e))}),(0,W.Z)("Reset $1 to Default?",[(0,Rp.qS)(e)]),(0,W.Z)("Toolbar will be restored to its default layout."))};removeButton=e=>{const t=this.props.name,s=this.state.buttons,n=s[e];en.Z.setRemovedButton(this.context.vivaldiWindowId,t,n),I.Z.set(t,s.filter(((t,s)=>e!==s))),nc.ZP.isWebPanel(n)&&Ko.Z.removeById(n,t)};onDragOver=e=>e.preventDefault();onDrop=(e,t,s)=>{this.setState({dragging:!1,modifier:!1});const n=e.dataTransfer.getData(oa.f2);if(!n)return;e.stopPropagation(),GJ=!0;let i=this.state.buttons.slice();const a=("vertical"===this.props.layout?"bottom"===s:"right"===t)?1:0,o=e.currentTarget.classList.contains("toolbar-droptarget")?i.length:(this._dragIndex||0)+a;if(this._dropOnSelf=this.props.name===e.dataTransfer.getData(VJ),this._dropOnSelf){i[parseInt(e.dataTransfer.getData(HJ))]=null,i.splice(o,0,n),this.props.name&&I.Z.set(this.props.name,i.filter(Boolean))}else{i.splice(o,0,n),Rp.aX.includes(n)||(i=i.filter(((e,t)=>e!==n||t===o)));const e=this.props.name;Ko.Z.isExtPanel(n)&&Ko.Z.installExtensionById(this.context.vivaldiWindowId,n),I.Z.set(e,i.filter(Boolean)),en.Z.setAddedButton(this.context.vivaldiWindowId,e,n,!1)}};getButtonIndex=e=>{let t=-1;const s=e.target?.getAttribute("name");return Rp.aX.includes(s)?t=Array.from(this.refToolbar.current?.children??[]).filter((e=>e.className&&!e.className.includes("window-buttongroup")&&!e.className.includes("biscuit-setting-version"))).findIndex((t=>t.children[0]===e.target)):s&&(t=this.state.buttons.findIndex((e=>e===s))),t};getButtonMenu=e=>fe.ZP.isGuest()?[]:[st.Z.separatorItem,{handler:()=>{const t=this.state.buttons.findIndex((t=>t===e));t>-1&&this.removeButton(t)},...(0,fi.Z)("Remove from Toolbar")},st.Z.separatorItem,{handler:()=>this.editToolbar(this.props.name||Z.kToolbarsNavigation),...(0,fi.Z)("Customize Toolbar"),ellipsis:!0},{handler:this.reset,...(0,fi.Z)("Reset Toolbar to Default")}];getToolbarMenu=async e=>{if(e.target.classList?.contains("toolbar")){let t=[];if(this.props.menu){const e=this.props.menu();t=Array.isArray(e)?e:await e}(0,mi.Z)(this.context,t.concat([st.Z.separatorItem,{handler:()=>this.editToolbar(this.props.name||Z.kToolbarsNavigation),...(0,fi.Z)("Customize Toolbar"),ellipsis:!0},{handler:this.reset,...(0,fi.Z)("Reset Toolbar to Default")}]))(e)}};handleDragStart=e=>{const t=this.getButtonIndex(e);t<0||(GJ=!1,this._dropOnSelf=!1,e.dataTransfer.setData(HJ,t),e.dataTransfer.setData(VJ,this.props.name),this.setState({dragging:!0}))};handleDragEnd=e=>{const t=this.getButtonIndex(e);t<0||(!this._dropOnSelf&&GJ&&this.removeButton(t),this._dropOnSelf=!1,this._dragIndex=null,this.setState({dragging:!1,modifier:!1}))};handleDragEnter=e=>{const t=this.getButtonIndex(e);t<0||(this._dragIndex=t)};render(){const e=this.props.name===Z.kToolbarsNavigation||this.props.name===Z.kToolbarsMail||this.props.name===Z.kToolbarsMailComposer||this.props.name===Z.kToolbarsMailMessage,t=!e&&this.props.name===Z.kToolbarsPanel,n=e&&this.props.controlButtonsVisible,i=!1,a=this.props.menuDisplay;return(0,zn.jsxs)("div",{ref:this.refToolbar,role:t?"tablist toolbar":"toolbar","aria-label":this.props.label,"aria-orientation":this.props.layout||"horizontal",inert:this.props.inert&&!this.state.editMode?"inert":null,className:Gn()("toolbar","toolbar-droptarget",this.props.className,"toolbar-"+this.props.size,{dragging:this.state.dragging,"toolbar-vertical":"vertical"===this.props.layout}),onContextMenu:this.getToolbarMenu,onDragOver:this.onDragOver,onDrop:this.onDrop,children:[n&&KJ,i,a&&(0,zn.jsx)(WJ,{isHidden:!1,inert:this.props.inert||!1,keyAccess:this.props.keyAccess??0}),this.state.buttons.map(((e,t)=>(0,zn.jsx)(ZJ,{index:t,name:e,preview:this.props.showDefaultSet||this.state.editMode,menuOrigin:this.props.menuOrigin,customizeMenu:this.getButtonMenu,popupPosition:this.props.popupPosition,size:this.props.size,draggable:this.state.editMode||this.state.modifier,inEditor:this.props.showDefaultSet,onDragStart:this.handleDragStart,onDragEnd:this.handleDragEnd,onDrop:this.onDrop,onDragEnter:this.handleDragEnter,mimeType:oa.f2,isMailWindow:this.state.isMailWindow},e+"__"+(Rp.aX.includes(e)?t:"")))),this.props.name===Z.kToolbarsNavigation&&fe.ZP.isIncognito(this.context.vivaldiWindowId)&&(0,zn.jsx)("div",{className:"UrlBar-PrivateWindowIndicator",title:(0,W.Z)("Private Browsing Window"),dangerouslySetInnerHTML:{__html:s(2018)+(0,W.Z)("Private")}}),i]})}}const $J=[Z.kToolbarsMail,Z.kToolbarsMailComposer,Z.kToolbarsMailMessage],YJ="toolbar-mainbar toolbar-mailbar";class XJ extends Un.PureComponent{render(){const{className:e,menuDisplay:t,menuOrigin:s,popupPosition:n,url:i,inert:a}=this.props;return(0,zn.jsxs)(zn.Fragment,{children:[!(0,Pt.vE)(i)&&!(0,Pt.Ds)(i)&&(0,zn.jsx)(zJ,{name:Z.kToolbarsMail,label:(0,W.Z)("toolbar label","Mail"),className:`${YJ} ${e}`,controlButtonsVisible:this.props.controlButtonsVisible,menuDisplay:t,menuOrigin:s,popupPosition:n,size:"large",inert:a}),(0,Pt.Ds)(i)&&(0,zn.jsx)(zJ,{name:Z.kToolbarsMailMessage,label:(0,W.Z)("toolbar label","Mail Message"),className:`${YJ} ${e} message`,controlButtonsVisible:this.props.controlButtonsVisible,menuDisplay:t,menuOrigin:s,popupPosition:n,size:"large",inert:a}),(0,Pt.vE)(i)&&(0,zn.jsx)(zJ,{name:Z.kToolbarsMailComposer,label:(0,W.Z)("toolbar label","Compose Mail"),className:`${YJ} ${e} composer`,controlButtonsVisible:this.props.controlButtonsVisible,menuDisplay:t,menuOrigin:s,popupPosition:n,size:"large",inert:a})]})}}const QJ=(0,zd.Z)(XJ,$J);var qJ=s(38768);const JJ=[Z.kAddressBarPosition,Z.kAddressBarVisible,Z.kAppearanceDisableTitleBar,Z.kKeyboardTabToAll,Z.kMenuDisplay,Z.kTabsBarPosition,Z.kTabsVisible],e0="toolbar-hidden",t0="toolbar-visible";function s0(e){return{url:e.url,isMailPage:e.isMailPage&&wt.Z.isFeedsOn()}}class n0 extends Un.PureComponent{static contextType=oi.Z;state={...s0(Ze.ZP.unsafeGetActivePage(this.context.vivaldiWindowId))};componentDidMount(){const{selectWindow:e}=this.context;Ze.ZP.addListener(this.pageStoreChanged,e)}componentWillUnmount(){Ze.ZP.removeListener(this.pageStoreChanged)}pageStoreChanged=()=>{const e=Ze.ZP.getActivePage(this.context.vivaldiWindowId);e&&this.setState(s0(e))};controlButtonsVisible=()=>{const e=(0,qJ.H)(this.context.vivaldiWindowId);if(e&&this.props.fullScreenState||this.props.native)return!1;return!(this.props.windowState.visibleUI.tabs&&"top"===this.props.prefValues[Z.kTabsBarPosition])&&!e};render(){const e="top"===this.props.prefValues[Z.kAddressBarPosition],t=e?"bottomLeft":"topLeft",s=e?"below":"above",n="vivaldi"===this.props.prefValues[Z.kMenuDisplay]&&!(0,qJ.H)(this.context.vivaldiWindowId),i=this.props.prefValues[Z.kKeyboardTabToAll],a=this.controlButtonsVisible(),o=wt.Z.isFeedsOn()&&fe.ZP.isMail(this.context.vivaldiWindowId),{inert:r=!1}=this.props.windowState,{isMailPage:l}=this.state,d=r||!l,c=r||l;return(0,zn.jsxs)("div",{className:"mainbar",children:[(o||l)&&(0,zn.jsx)(Zo.Z,{focusName:"focus_mailbar",children:(0,zn.jsx)(QJ,{url:this.state.url,controlButtonsVisible:a,menuOrigin:t,popupPosition:s,className:l?t0:e0,menuDisplay:n,inert:d})}),(0,zn.jsx)(Zo.Z,{focusName:"focus_addressbar",children:(0,zn.jsx)(zJ,{name:Z.kToolbarsNavigation,label:(0,W.Z)("toolbar label","Address"),className:"toolbar-mainbar "+(l?e0:t0),controlButtonsVisible:a,menuOrigin:t,menuDisplay:n,keyAccess:i,popupPosition:s,size:"large",inert:c})})]})}}const i0=(0,zd.Z)(n0,JJ);class a0 extends Un.PureComponent{constructor(e){super(e),this.state={folderName:""}}addFeedFolder=()=>{let{path:e}=this.props.options;e=e.split("/").filter((e=>e!==Nt.ym)).join("/");const t={name:this.state.folderName,accountId:Nt.u4,path:e?e+"/"+this.state.folderName:this.state.folderName,filterValue:{include:[],...Wt.ZP.getSearchListButtons(Nt.u4),showSubFolders:!0}};d.Z.addFilter(t),this.props.onClose()};onDismiss=()=>{this.props.onClose()};onChange=e=>{const{value:t}=e.target;this.setState({folderName:t})};render=()=>{const{path:e}=this.props.options;return(0,zn.jsxs)("form",{className:"dialog-add-folder-name",children:[(0,zn.jsxs)("header",{className:"dialog-header",children:[(0,zn.jsx)("h1",{id:Ha.t,children:(0,W.Z)("feed","New Folder")}),e!==Nt.ym&&(0,zn.jsx)("p",{children:(0,W.Z)("Create a new folder under $1",[e])})]}),(0,zn.jsx)("div",{className:"dialog-content",children:(0,zn.jsx)("input",{autoFocus:!0,type:"text",placeholder:(0,W.Z)("feed","New Folder"),onChange:this.onChange,title:(0,W.Z)("Folder Name"),value:this.state.folderName,name:"folderName"})}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"submit",value:(0,W.Z)("Add Folder"),className:"primary",onClick:this.addFeedFolder,disabled:!this.state.folderName}),this.props.dismissable&&(0,zn.jsx)("input",{type:"button",onClick:this.onDismiss,value:(0,W.Z)("Cancel")})]})]})}}const o0=a0;class r0 extends Un.PureComponent{constructor(e){super(e),this.state={folderName:""}}addMailFolder=()=>{const{accountId:e,path:t}=this.props.options;ts.Z.createMailbox(e,t,this.state.folderName),this.props.onClose()};onDismiss=()=>{this.props.onClose()};onChange=e=>{const{value:t}=e.target;this.setState({folderName:t})};render=()=>{const{accountId:e,path:t}=this.props.options,s=It.Z.getFolder(e,t),n=t&&t!==Nt.ym&&s?(0,W.Z)("Create Folder for $1 in $2",[e,s.name]):(0,W.Z)("Create Folder for $1",[e]);return(0,zn.jsxs)("div",{className:"dialog-add-folder-name",children:[(0,zn.jsx)("header",{className:"dialog-header",children:(0,zn.jsx)("h1",{id:Ha.t,children:n})}),(0,zn.jsx)("div",{className:"dialog-content",children:(0,zn.jsx)("input",{type:"text",placeholder:(0,W.Z)("mail","New Folder"),onChange:this.onChange,title:(0,W.Z)("Folder Name"),value:this.state.folderName,name:"folderName"})}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Create Folder"),className:"primary",onClick:this.addMailFolder,disabled:!this.state.folderName}),this.props.dismissable&&(0,zn.jsx)("input",{type:"button",onClick:this.onDismiss,value:(0,W.Z)("Cancel")})]})]})}}const l0=r0;function d0(e){const[t,s]=Un.useState(!1);return Un.useEffect((()=>()=>{I.Z.set(Z.kCalendarOnboardingShown,!0)}),[]),(0,zn.jsxs)("div",{className:"CalendarAccountSheet",children:[(0,zn.jsx)("button",{className:"CalendarAccountSheet-Exit",onClick:e.onClose,children:(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.kze}})}),!t&&(0,zn.jsx)("div",{className:"setting-section",children:(0,zn.jsx)(AS,{searchableStrings:RS,filter:"",showTips:()=>s(!0),done:e.onClose,onboarding:!0})}),t&&(0,zn.jsx)(PS,{onClose:e.onClose,windowId:e.windowId,onboarding:!0})]})}function c0(e){e&&e.target.addEventListener("click",wi.ZP,{once:!0})}const h0=function(e){const t=Un.useContext(oi.Z),[s,n]=(0,Un.useState)(""),{document:i,requestAnimationFrame:a,HTMLElement:o}=t,{stateHandler:r,eventDraft:l}=cH(hH.W$,{draft:e.event}),d=Un.useRef(!1),{cancelEventEdit:c,endEventEdit:h,saveEventEdit:u}=r;if(Un.useEffect((()=>()=>{d.current||h()}),[h]),!l)return null;function p(){a((()=>{const e=i.getElementsByClassName("calendar-grid")[0];e instanceof o&&e.focus()}))}async function g(s){d.current=!0,c0(s);try{const s=await u();s&&(e.onClose().then(p),function(e,t){const s=Ze.ZP.getActivePage(e);if(s&&vs.jk.getDisplayUrlFromMapping(s?.url).startsWith("vivaldi://calendar"))return;let n="";const i=t.start||t.end;if(i){const e=V()(i);n=t.allDay?e.format("L"):V()().isSame(i,"day")?e.format("LT"):`${e.format("L")} ${e.format("LT")}`}(0,H.c)({title:`${n} ${t.title||Vc.gT}`,body:t.task?(0,W.Z)("New Task Created"):(0,W.Z)("New Event Created"),onClick:()=>{ue.Z.showCalendar(e,t.id)},timeout:3e4,tag:"CALENDAR_CREATE_EVENT"})}(t.vivaldiWindowId,s))}catch(e){ls.Z.warn("Calendar",["Event not created"],e),n(e)}}function m(t){d.current=!0,c0(t),c(),e.onClose().then(p)}return(0,zn.jsx)(WS.Provider,{value:{displayDensity:"full",pageId:hH.W$,isPanel:!1,isEditing:!0,isWidget:!1,handler:r},children:(0,zn.jsxs)("div",{className:"dialog-add-event",onKeyDown:function(e){const t=JS.Z[e.keyCode];"Enter"!==t||e.shiftKey?"Escape"===t&&m():(e.preventDefault(),e.stopPropagation(),g())},children:[(0,zn.jsxs)("div",{className:"dialog-content",children:[(0,zn.jsx)(mE,{event:l}),s&&(0,zn.jsx)(fa,{type:"info",children:Jl([s])})]}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"button",className:"primary",value:l.id?(0,W.Z)("calendar","Done"):l.task?(0,W.Z)("Add Task"):(0,W.Z)("Add Event"),onClick:g}),(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Cancel"),onClick:m}),!!l.id&&(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("verb","Delete"),onClick:function(t){d.current=!0,c0(t),l?.id&&ie.ZP.trashEvent(l.id),e.onClose().then(p)}})]})]})})};function u0(e){const{onClose:t}=e,[s,n]=(0,Un.useState)(""),i=(0,Un.useRef)(nr.Z);const a=(0,Un.useCallback)((e=>{i.current=e}),[]),o=!!e.templateId,r=o?(0,W.Z)("Edit Event Template"):(0,W.Z)("Add an Event Template"),l=o?(0,W.Z)("Save Template"):(0,W.Z)("Create Template");return(0,zn.jsxs)("div",{className:"dialog-add-template",children:[(0,zn.jsx)("div",{className:"dialog-header",children:(0,zn.jsx)("h1",{className:"dialog-title",children:r})}),(0,zn.jsx)("form",{className:"dialog-content",children:(0,zn.jsx)(wE,{templateId:e.templateId,event:e.event,name:e.name,properties:e.properties,setSaveTemplate:a,children:s&&(0,zn.jsx)(fa,{type:"error",children:s})})}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"button",className:"primary",value:l,onClick:async function(){n("");try{i.current(),t()}catch(e){n(e.message)}}}),(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Cancel"),onClick:t})]})]})}const p0=function(e){const{filePath:t}=e,[s,n]=(0,Un.useState)({state:"info",message:"",eventCount:0}),[i,a]=(0,Un.useState)(t.startsWith("webcal")),o=(0,Un.useMemo)((()=>{const e=t.replace(/^\w+:\/\//,"");return Pr.Z.getAccounts().some((t=>"ical"===t.account_type&&t.url.replace(/^\w+:\/\//,"")===e))}),[t]),[r,l]=(0,Un.useState)(!1),d=(0,dS.Z)(gl),c=(0,Un.useCallback)(((e,t,s=!1)=>{n({message:e,eventCount:t,state:s?"error":"info"})}),[]);function h(){Dr.Z.clearImportProgress("Calendar","OpenIcsFileDialog"),e.onClose()}let u=0,p=0,g=0;d.Calendar&&Object.keys(d.Calendar).forEach((e=>{u+=d.Calendar[e].current,p=d.Calendar[e].total,g=Math.round(u/p*100)})),p>0&&u===p&&(h(),ue.Z.showCalendar(e.windowId));const m=i?(0,W.Z)("Import Calendar"):(0,W.Z)("Import Calendar Events");return(0,zn.jsxs)(Zo.Z,{className:"dialog-import-events",focusName:"import-events",onKeyDown:function(e){const t=JS.Z[e.keyCode];"Enter"!==t||e.shiftKey?"Escape"===t&&h():(e.preventDefault(),e.stopPropagation(),l(!0))},forceTrap:!0,children:[(0,zn.jsx)("header",{className:"dialog-header",children:(0,zn.jsx)("h1",{className:"dialog-title",id:Ha.t,children:m})}),(0,zn.jsxs)("div",{className:"dialog-content",children:[i&&(0,zn.jsx)(Kr,{showBody:!0,subscribe:r,onStatus:c,url:t}),!i&&(0,zn.jsx)(Fr,{standAlone:!0,file:t,import:r,onStatus:c}),(0,zn.jsxs)("div",{children:[u>0&&(0,zn.jsx)(fa,{type:"info",children:(0,W.Z)("Imported $1 of $2 ($3%)",[u,p,g])}),0===u&&s.message&&(0,zn.jsx)(fa,{type:s.state,children:s.message}),o&&!r&&(0,zn.jsx)(fa,{type:"warning",children:(0,W.Z)("You are already subscribed to this calendar")})]})]}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[i&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("input",{type:"button",disabled:!s.eventCount||r,className:"primary",onClick:()=>l(!0),value:(0,W.Z)("Subscribe")}),(0,zn.jsx)("input",{type:"button",onClick:()=>a(!1),disabled:!s.eventCount,value:s.eventCount?(0,W.Z)("Import $1 event","Import $1 events",[s.eventCount]):(0,W.Z)("Import")})]}),!i&&(0,zn.jsx)(zn.Fragment,{children:(0,zn.jsx)("input",{type:"button",disabled:!s.eventCount||r,className:"primary",onClick:()=>l(!0),value:(0,W.Z)("Import")})}),(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Close"),onClick:h})]})]})};const g0=function(e){const t=Un.useContext(oi.Z),{modal:s,resolve:n=(e=>{})}=e;function i(i){const{document:a,HTMLInputElement:o,HTMLTextAreaElement:r}=t,l=s.checks?.reduce(((e,{name:t})=>{const s=a.querySelector(`input[name="${t}"]`);return s instanceof o&&(e[t]=Boolean(s.checked)),e}),{}),d=s.inputs?.reduce(((e,{name:t})=>{const s=a.querySelector(`textarea[name="${t}"]`);return s instanceof r&&(e[t]=s.value),e}),{});n({action:i,checks:l,inputs:d}),e.onClose()}const a=s.actions.find((e=>e.default))??s.cancelAction;return(0,zn.jsx)(Ha.Z,{className:"calendar-dialog slide",onRequestClose:()=>n({action:s.cancelAction.action}),title:s.title,children:(0,zn.jsxs)("form",{onSubmit:()=>i(a.action),onKeyDown:function(e){if("Escape"===JS.Z[e.keyCode])i(s.cancelAction.action),(0,wi.ZP)(e)},children:[(0,zn.jsxs)("div",{className:"dialog-content",children:[s.body,s.inputs&&(0,zn.jsx)("div",{className:"dialog-inputs",children:s.inputs.map(((e,t)=>(0,zn.jsxs)(Un.Fragment,{children:[(0,zn.jsx)("label",{htmlFor:e.name,children:e.label}),(0,zn.jsx)("textarea",{name:e.name})]},t)))}),s.checks&&(0,zn.jsx)("div",{className:"dialog-inputs",children:s.checks.map(((e,t)=>(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",name:e.name}),(0,zn.jsx)("span",{children:e.label})]},t)))})]}),(0,zn.jsx)("footer",{className:"dialog-footer",children:s.actions.concat([s.cancelAction]).map((e=>{const t=a.action===e.action;return(0,zn.jsx)("input",{autoFocus:t,onClick:()=>{i(e.action)},type:t?"submit":"button",value:e.title},e.title)}))})]})})};var m0=s(33499),f0=s(17673);const v0=function(e){const t=Un.useRef(),s=Un.useRef({effects:null,isCaptured:!1,canvasReady:!1,imageData:""}).current,[n,i]=Un.useState(!1),a=Un.useContext(oi.Z),o=a.innerWidth,r=a.innerHeight,l=a.vivaldiWindowId,{children:d,effect:c,showDialog:h}=e,u=Un.useCallback((e=>{switch(e){case"showDialog":h();break;case"done":0===Un.Children.count(d)&&h(),i(!0)}}),[d,h]);function p(){s.isCaptured&&s.canvasReady&&("melt"===c?s.effects=function(e,t,s,n,i,a){const{document:o,requestAnimationFrame:r,cancelAnimationFrame:l,Image:d}=e,c=200,h=.04,u=1e3,p=Math.round(n/c),g=n/p,m=Math.round(i*h),f=4*m;let v="initial";const b=[];let C,w=0;const y=o.createElement("canvas");y.width=n,y.height=i;const x=y.getContext("2d"),I=new d(n,i);return I.onload=()=>x.drawImage(I,0,0,n,i),I.src=s,{effect:function e(s){if(!t.current)return;if(0===b.length){for(let e=0;e<g;e++)b[e]=0===e?-Math.floor(Math.random()*f):b[e-1]+(Math.floor(Math.random()*m)-m/2),b[e]>0?b[e]=0:b[e]<-f&&(b[e]=-f);w=s}if(w===s)return void(C=r(e));const o=t.current?.getContext("2d");let l=!0,d=0,c=i;const h=i*(s-w)/u;w=s,o?.clearRect(0,0,n,i);for(let e=0;e<g;e++)b[e]+=h,b[e]<0?(l=!1,d=0):b[e]<i?(l=!1,d=b[e]):d=i,c=Math.min(d,c),o?.drawImage(y,e*p,0,p,i,e*p,d,p,i);"showDialog"!==v&&c>i/2&&!l&&(v="showDialog",a(v)),l?a("done"):C=r(e)},cleanUp:function(){C&&l(C)}}}(a,t,s.imageData,o,r,u):"burn"===c&&(s.effects=function(e,t,s,n,i,a){const{document:o,requestAnimationFrame:r,cancelAnimationFrame:l}=e,d=320,c=82,h=2,u=4.25,p=1600,g=1600;let m;const f=o.createElement("canvas");f.width=d,f.height=c;const v=f.getContext("2d"),b=v.getImageData(0,0,d,c),C=b.data,w=[];for(let e=0;e<256;e++)w[e]=Be().hsl(Math.round(e/3),1,Math.min(1,e/192)).rgb();const y=[...Array(c).keys()].map((e=>Array(d)));for(let e=0;e<c;++e)for(let t=0;t<d;++t)y[e][t]=0;let x,I=h,A=u,S=0,Z="initial";return{effect:function e(s){const o=t.current;if(!o)return;if(x=x||s,S===s)return void(m=r(e));const l=s-S;S=s;for(let e=0;e<d;e++)y[c-1][e]=Math.random()>.5?255:0;let u=0;for(let e=0;e<c-1;++e)for(let t=0;t<d;++t){let s=y[(e+1)%c][(t-1+d)%d]+y[(e+1)%c][t]+y[(e+1)%c][(t+1)%d]+y[(e+2)%c][t];s/=A,y[e][t]=Math.floor(s)}for(let e=0;e<c;++e)for(let t=0;t<d;++t){let s=e*d*4+4*t;u=y[e][t];const[n,i,a]=w[u],o=Math.min(255,2*(n+i+a));C[s]=n,C[++s]=i,C[++s]=a,C[++s]=o}v.putImageData(b,0,0);const T=o.getContext("2d");T.clearRect(0,0,n,i),T.drawImage(f,0,0,d,c-I,0,0,n,i);const E=s-x;if(E>p){"showDialog"!==Z&&(Z="showDialog",a(Z));const e=E-p;A+=l/g*3,I=Math.round(h+10*e/g)}E>p+g?a("done"):m=r(e)},cleanUp:function(){m&&l(m)}}}(a,t,s.imageData,o,r,u)),s.isCaptured=!0,s.effects?.effect?a.requestAnimationFrame(s.effects.effect):(console.warn("Failed to get notification effect"),i(!0),h()))}if(!s.isCaptured){const e={windowId:l,posX:0,posY:0,width:o,height:r,saveToDisk:!1};re.Z.thumbnails.captureUI(e,((e,t)=>{e?(s.isCaptured=!0,s.imageData=t,p()):(ls.Z.warn("Calendar","Failed to capture UI for wipe effect"),s.isCaptured=!0,i(!0),h())}))}return Un.useEffect((()=>()=>{s.effects?.cleanUp}),[s.effects]),(0,zn.jsxs)(zn.Fragment,{children:[s.isCaptured&&Un.Children.count(e.children)&&(0,zn.jsx)("div",{className:"wipe-container",onClick:e.showDialog,children:e.children}),!n&&(0,zn.jsx)("canvas",{width:o,height:r,ref:e=>{e&&!t.current&&(t.current=e,s.canvasReady=!0,p())}})]})},b0=[[1,(0,W.Z)("$1 minute","$1 minutes",[1]),"1 minute"],[2,(0,W.Z)("$1 minute","$1 minutes",[2]),"2 minutes"],[5,(0,W.Z)("$1 minute","$1 minutes",[5]),"5 minutes"],[10,(0,W.Z)("$1 minute","$1 minutes",[10]),"10 minutes"],[15,(0,W.Z)("$1 minute","$1 minutes",[15]),"15 minutes"],[20,(0,W.Z)("$1 minute","$1 minutes",[20]),"20 minutes"],[30,(0,W.Z)("$1 minute","$1 minutes",[30]),"30 minutes"],[45,(0,W.Z)("$1 minute","$1 minutes",[45]),"45 minutes"],[60,(0,W.Z)("$1 hour","$1 hours",[1]),"1 hour"],[120,(0,W.Z)("$1 hour","$1 hours",[2]),"2 hours"],[240,(0,W.Z)("$1 hour","$1 hours",[4]),"4 hours"],[360,(0,W.Z)("$1 hour","$1 hours",[6]),"6 hours"],[720,(0,W.Z)("$1 hour","$1 hours",[12]),"12 hours"],[1440,(0,W.Z)("$1 day","$1 days",[1]),"1 day"],[2880,(0,W.Z)("$1 day","$1 days",[2]),"2 days"],[4320,(0,W.Z)("$1 day","$1 days",[3]),"3 days"],[5760,(0,W.Z)("$1 day","$1 days",[4]),"4 days"],[7200,(0,W.Z)("$1 day","$1 days",[5]),"5 days"],[8640,(0,W.Z)("$1 day","$1 days",[6]),"6 days"],[10080,(0,W.Z)("$1 week","$1 weeks",[1]),"1 week"]],C0=b0.map((([e,t])=>(0,zn.jsx)("option",{value:e.toString(),children:t},e)));function w0(e){const t=fe.ZP.getLastActiveBrowserWindowId();t!==fe.Ex&&e&&ue.Z.showCalendar(t,e)}function y0(e){const[t,s]=Un.useState("5"),n=Un.useRef(!1);Un.useEffect((()=>(n.current=!0,()=>{n.current=!1})),[]);function i(){w0(e.notification.event_id),e.onClose(e.notification.id)}const{notification:a}=e,o=V()(a.eventTime),r=(0,m0.y6)(o,a.allDay);return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("div",{className:"CalendarNotification-Content",tabIndex:"0",onClick:i,onKeyDown:function(e){"Enter"!==e.key&&"Space"!==e.key||i()},children:[(0,zn.jsx)("span",{className:"CalendarNotification-Time",children:o.format(r)}),(0,zn.jsx)("span",{className:"CalendarNotification-Text",id:"notification-calendar-event-title",children:a.title})]}),(0,zn.jsxs)("footer",{className:"dialog-footer CalendarNotifications-Footer",children:[(0,zn.jsx)("input",{className:"CalendarNotification-Button primary",type:"button",value:(0,W.Z)("Dismiss"),onClick:()=>e.onClose(e.notification.id)}),(0,zn.jsx)("span",{children:(0,W.Z)("or")}),(0,zn.jsx)("input",{className:"CalendarNotification-Button",type:"button",value:(0,W.Z)("Snooze"),onClick:()=>{const s=parseInt(t);m0.ZP.snooze(e.notification,s||5),e.onClose(e.notification.id)}}),(0,zn.jsx)(Fa.Z,{onChange:e=>{s(e.target.value)},defaultValue:"5",children:C0})]})]})}var x0=(0,zn.jsx)("div",{className:"CalendarNotification-HoverBackground"});function I0(e){function t(){w0(e.notification.event_id),e.onClose("All")}const s=V()(e.notification.eventTime),n=(0,m0.y6)(s,e.notification.allDay);return(0,zn.jsxs)("div",{className:"CalendarNotification-Content",tabIndex:"0",onClick:t,onKeyDown:function(e){"Enter"!==e.key&&"Space"!==e.key||t()},children:[(0,zn.jsx)("span",{className:"CalendarNotification-Time",children:s.format(n)}),(0,zn.jsx)("span",{className:"CalendarNotification-Text",children:e.notification.title}),(0,zn.jsxs)("div",{className:"CalendarNotification-Actions",children:[(0,zn.jsx)(oa.ZP,{title:(0,W.Z)("Snooze"),tabIndex:0,isMenuIndicatorVisible:!0,menu:()=>b0.map((([t,s,n])=>({handler:()=>{return s=t,m0.ZP.snooze(e.notification,s),void e.onClose(e.notification.id);var s},label:s,labelEnglish:n}))),menuOrigin:"bottomRight"}),(0,zn.jsx)(oa.ZP,{onClick:()=>{e.onClose(e.notification.id)},title:(0,W.Z)("Dismiss"),tabIndex:0}),x0]})]})}function A0(e){const t=e.notifications;Un.useEffect((()=>()=>{const t=e.windowToRestore;"number"==typeof t&&fe.ZP.isFullscreen(t)&&Wn.Z.toggleFullscreen(t)}),[e.windowToRestore]);const[s,n]=Un.useState(1===t.length);function i(){e.notifications.forEach((t=>e.onClose(t.id)))}function a(t){"All"===t?i():e.onClose(t)}return Un.useEffect((()=>{s&&t.length>1&&n(!1)}),[s,t.length]),(0,zn.jsx)(Zo.Z,{focusName:"focus_notfications",forceTrap:!0,children:(0,zn.jsxs)("div",{className:Gn()("CalendarNotifications",{"CalendarNotifications--FadeUp":"up"===e.fade,"CalendarNotifications--FadeDown":"down"===e.fade}),children:[(0,zn.jsxs)("header",{className:"dialog-header CalendarNotifications-Header",children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.l0O.medium}}),(0,zn.jsx)("span",{className:"CalendarNotifications-Title",id:Ha.t,children:t.length>1?(0,W.Z)("Reminders"):(0,W.Z)("Reminder")})]}),!s&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("div",{className:"CalendarNotifications-List",children:t.map((e=>(0,zn.jsx)(I0,{notification:e,onClose:a},e.id)))}),(0,zn.jsx)("footer",{className:"dialog-footer CalendarNotifications-Footer",children:(0,zn.jsx)("input",{className:"CalendarNotifications-Button primary",type:"button",value:(0,W.Z)("Dismiss All"),onClick:i})})]}),s&&t[0]&&(0,zn.jsx)(y0,{notification:t[0],onClose:e.onClose})]})})}const S0=function(e){const t=A.Z.get(Z.kCalendarNotificationType),[s,n]=Un.useState(!("melt"===t||"burn"===t)),[i,a]=Un.useState(f0.Z.getState().activeNotifications),o=e.onClose,r=0!==i.length;Un.useEffect((()=>{function e(){const e=f0.Z.getState().activeNotifications;0===e.length?r&&o():a(e)}return f0.Z.addListener(e),()=>f0.Z.removeListener(e)}),[o,r]);const l=Un.useCallback((()=>{n(!0)}),[]);Un.useEffect((()=>{let e;return"melt"!==t&&"burn"!==t||(e=setTimeout(l,8e3)),()=>{e&&clearTimeout(e)}}),[t,l]);const d={notifications:i,onClose:function(e){S.Z.dispatch({actionType:"MAIN_HIDE_CALENDAR_ALARM",notificationId:e})},fade:"melt"===t?"down":"up",windowToRestore:e.windowToRestore};return(0,zn.jsxs)(zn.Fragment,{children:[("melt"===t||"burn"===t)&&(0,zn.jsx)(v0,{effect:t,showDialog:l,children:s&&(0,zn.jsx)(A0,{...d})}),"dialog"===t&&(0,zn.jsx)(A0,{...d})]})};const Z0=function(e){return(0,zn.jsx)($C,{danger:!0,title:e.label?(0,W.Z)("title","Delete Feed"):(0,W.Z)("title","Delete All Feeds"),prompt:e.label?[(0,W.Z)("Feed '$1' will be removed",[e.label])]:[(0,W.Z)("All feeds will be removed")],negative:(0,W.Z)("Cancel"),positive:e.label?(0,W.Z)("command","Delete Feed"):(0,W.Z)("command","Delete All Feeds"),onRequestClose:()=>{e.handleClose(e.dialog)},onClose:t=>{e.callback(t),e.handleClose(e.dialog)}},e.dialog)};const T0=function(e){return(0,zn.jsx)($C,{danger:!0,title:(0,W.Z)("title","Delete Filter"),prompt:[(0,W.Z)("The filter '$1' will be removed",[e.label])],negative:(0,W.Z)("Cancel"),positive:(0,W.Z)("command","Delete Filter"),onRequestClose:()=>{e.handleClose(e.dialog)},onClose:t=>{e.callback(t),e.handleClose(e.dialog)}},e.dialog)};const E0=function(e){return(0,zn.jsx)($C,{danger:!0,title:(0,W.Z)("title","Delete Label"),prompt:[(0,W.Z)("The '$1' label will be removed from all messages",[e.label])],negative:(0,W.Z)("Cancel"),positive:(0,W.Z)("command","Delete Label"),onRequestClose:()=>{e.handleClose(e.dialog)},onClose:t=>{e.callback(t),e.handleClose(e.dialog)}},e.dialog)};const k0=function(e){return(0,zn.jsx)($C,{title:(0,W.Z)("title","Upload messages to server?"),prompt:[(0,W.Z)("Do you want to upload imported messages to server for $1",[e.accountId])],negative:(0,W.Z)("No, keep them internal"),positive:(0,W.Z)("Yes, upload to server"),onRequestClose:()=>{e.handleClose(e.dialog)},onClose:t=>{e.callback(t),e.handleClose(e.dialog)}},e.dialog)};const N0=function(e){return(0,zn.jsx)($C,{danger:!0,title:(0,W.Z)("Trigger Mail Action"),prompt:[(0,W.Z)("This saved filter ($1) has an action which will be applied to all its messages. Would you like to proceed?",[e.label])],negative:(0,W.Z)("Cancel"),positive:(0,W.Z)("Apply Action to Mails"),onRequestClose:()=>{e.callback(!1),e.handleClose(e.dialog)},onClose:t=>{e.callback(t),e.handleClose(e.dialog)}},e.dialog)};function _0(e){const t=_r.ZP.getDefaultAccount()?.id;let s=e.find((e=>e.id===t));return!s&&e.length&&(s=e[0]),s}const P0=function(e){const t=Pr.Z.getAccounts().filter((e=>"ical"!==e.account_type)),[s,n]=(0,Un.useState)(""),[i,a]=(0,Un.useState)({vevent:!0,vtodo:"local"===_0(t)?.account_type,vjournal:!1}),[o,r]=(0,Un.useState)(_r.ZP.getCalendarCreateColor()),[l,d]=(0,Un.useState)(""),[c,h]=(0,Un.useState)(!1),[u,p]=(0,Un.useState)(_0(t)?.id||"");function g(e){d(e)}return(0,zn.jsxs)("div",{className:"dialog-add-calendar",children:[(0,zn.jsx)("div",{className:"dialog-header",children:(0,zn.jsx)("h1",{className:"dialog-title",id:Ha.t,children:(0,W.Z)("Add a New Calendar")})}),0===t.length?(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("div",{className:"dialog-content",children:(0,W.Z)("You have no suitable calendar account set up. Add one in Settings.")}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"button",className:"primary",value:(0,W.Z)("Open Calendar Settings"),onClick:function(t){ue.Z.showSettings(e.windowId,"calendar"),e.onClose()}}),(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Cancel"),onClick:e.onClose})]})]}):(0,zn.jsxs)("form",{onSubmit:async function(){if(""===u)return void g((0,W.Z)("No suitable calendar account found."));h(!0);const n=t.find((e=>e.id===u)),a={name:s,accountId:u,description:s,color:o,supportedCalendarComponent:i},{result:r}=await ie.ZP.createCalendar(a,n,!0);r.status?e.onClose():g(r.message)},children:[(0,zn.jsxs)("div",{className:"dialog-content",children:[t.length>1&&(0,zn.jsxs)("label",{className:"floating-label",children:[(0,zn.jsx)("span",{children:(0,W.Z)("Account")}),(0,zn.jsx)(Fa.Z,{onChange:function(e){p(e.target.value)},value:u,children:t.map((e=>(0,zn.jsx)("option",{value:e.id,children:e.name},e.id)))})]}),(0,zn.jsx)(Vr.Z,{type:"text",onChange:function(e){n(e.target.value)},label:(0,W.Z)("Calendar Name"),value:s,autoFocus:!0}),(0,zn.jsx)(GE,{label:(0,W.Z)("Calendar color","Color"),colorKey:"color",colorValue:o,setColor:function(e,t,s=!1){r(e.hex())},predefinedColors:Vc.hx}),(0,zn.jsx)(XE,{supportedCalendarComponent:i,updateCalendarComponent:function(e){a(e)},disabled:!1}),l&&(0,zn.jsx)(fa,{type:"warning",children:l})]}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"submit",value:(0,W.Z)("Add Calendar"),disabled:!_r.ZP.isCalendarValidToCreate({accountId:u,description:s,supportedCalendarComponent:i,name:""})||c}),(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Cancel"),onClick:e.onClose})]})]})]})};class M0 extends Un.PureComponent{constructor(e){super(e)}deleteFeedFolder=async()=>{const{path:e}=this.props.options,t=[],s=At.Z.getByFolderId([Nt.u4,e]);if(s){const e=Wt.ZP.getSubFilters(s);for(const s of e){const{ancestorPath:e,feedPath:n}=Wt.ZP.parseFeedFolderPath(s.path);await as.Z.move(Nt.u4,e,"",n),t.push(s.id)}d.Z.removeFilter(s.id),t.push(s.id)}At.Z.updateFilters(t),this.props.onClose()};onDismiss=()=>{this.props.onClose()};render=()=>(0,zn.jsxs)("div",{className:"dialog-delete-folder-name",children:[(0,zn.jsxs)("header",{className:"dialog-header",children:[(0,zn.jsx)("h1",{id:Ha.t,children:(0,W.Z)("Delete Feed Folder “$1”",[this.props.options.path])}),(0,zn.jsx)("h2",{children:(0,W.Z)("Note that the feeds in that folder will move to the root folder.")})]}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Delete Feed Folder"),className:"primary",onClick:this.deleteFeedFolder}),this.props.dismissable&&(0,zn.jsx)("input",{type:"button",onClick:this.onDismiss,value:(0,W.Z)("Cancel")})]})]})}const D0=M0;class O0 extends Un.PureComponent{constructor(e){super(e)}deleteMailFolder=()=>{const{accountId:e,path:t}=this.props.options,s=It.Z.getFolder(e,t);if(!s)throw new Error(`Folder not found for ${e} ${t}`);const{subscribed:n}=s;!async function(){try{await d.Z.removeAccountPath(e,t),(0,_t.mq)(e)&&n&&await ts.Z.deleteMailbox(e,t)}catch(s){ls.Z.error("Mail",`Failed to remove folder ${(0,Vs.kF)(t)} from ${e}`)}}(),this.props.onClose()};onDismiss=()=>{this.props.onClose()};render=()=>(0,zn.jsxs)("div",{className:"dialog-delete-folder-name",children:[(0,zn.jsxs)("header",{className:"dialog-header",children:[(0,zn.jsx)("h1",{id:Ha.t,children:(0,W.Z)("Delete Folder “$1” From Account “$2”",[(0,Vs.kF)(this.props.options.path),this.props.options.accountId])}),(0,zn.jsx)("h2",{children:(0,W.Z)("Note that all messages in that folder will also be deleted.")})]}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Delete Folder"),className:"primary",onClick:this.deleteMailFolder}),this.props.dismissable&&(0,zn.jsx)("input",{type:"button",onClick:this.onDismiss,value:(0,W.Z)("Cancel")})]})]})}const j0=O0;class L0 extends Un.Component{static contextType=oi.Z;context;state={saveDays:A.Z.get(Z.kSessionsSaveDays)};_onEnable=()=>{I.Z.set(Z.kSessionsSaveOnExit,"on"),I.Z.set(Z.kSessionsSaveDays,this.state.saveDays),this.props.onClose()};_onCancel=()=>{this.props.onClose()};_onSaveDaysChange=e=>{const{HTMLSelectElement:t}=this.context;e.target instanceof t&&this.setState({saveDays:parseInt(e.target.value)})};_renderSaveDays=()=>[1,3,5,30].map((e=>(0,zn.jsx)("option",{value:e,children:1===e?(0,W.Z)("One day"):(0,W.Z)("$1 day","$1 days",[e])},e)));render(){const e="intro"===this.props.options.mode?(0,W.Z)("title","Enable"):(0,W.Z)("Save");return(0,zn.jsx)(Ha.Z,{onRequestClose:this._onCancel,title:(0,W.Z)("title","Automatic Session Backup"),children:(0,zn.jsxs)("form",{onSubmit:this._onEnable,children:[(0,zn.jsxs)("div",{className:"dialog-content",children:[(0,zn.jsx)("p",{children:(0,W.Z)("Sessions back up on an hourly basis. Select how many days worth of backups to keep.")}),(0,zn.jsx)(Fa.Z,{value:this.state.saveDays,onChange:this._onSaveDaysChange,children:this._renderSaveDays()}),"size"===this.props.options.mode&&(0,zn.jsx)(zn.Fragment,{children:(0,zn.jsx)("p",{children:(0,W.Z)("Any excess sessions are moved to Trash.")})})]}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"button",onClick:this._onCancel,value:(0,W.Z)("Cancel")}),(0,zn.jsx)("input",{type:"submit",onClick:this._onEnable,value:e})]})]})})}}class R0 extends Un.Component{static contextType=oi.Z;state={enableWorkspaces:!0};_onWithWorkspaces=()=>{this.setState({enableWorkspaces:!0})};_onNoWorkspaces=()=>{this.setState({enableWorkspaces:!1})};_onCancel=()=>{this.props.onClose()};_onOpen=()=>{I.Z.set(Z.kWorkspacesEnabled,this.state.enableWorkspaces),this.props.onClose(),this.props.options.onClose(!this.state.enableWorkspaces)};render(){return(0,zn.jsx)(Ha.Z,{onRequestClose:this._onCancel,title:(0,W.Z)("Enable Workspaces?"),children:(0,zn.jsxs)("form",{onSubmit:this._onOpen,children:[(0,zn.jsxs)("div",{className:"dialog-content",children:[(0,zn.jsx)("p",{children:(0,W.Z)("Session contains tabs inside Workspaces")}),(0,zn.jsxs)("label",{className:"dialog-checkbox",children:[(0,zn.jsx)("input",{type:"radio",checked:this.state.enableWorkspaces,onChange:this._onWithWorkspaces}),(0,zn.jsx)("span",{children:(0,W.Z)("Enable Workspaces and Open")})]}),(0,zn.jsxs)("label",{className:"dialog-checkbox",children:[(0,zn.jsx)("input",{type:"radio",checked:!this.state.enableWorkspaces,onChange:this._onNoWorkspaces}),(0,zn.jsx)("span",{children:(0,W.Z)("Open as Tabs")})]})]}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"button",onClick:this._onOpen,value:(0,W.Z)("Open"),autoFocus:!0}),(0,zn.jsx)("input",{type:"button",onClick:this._onCancel,value:(0,W.Z)("Cancel")})]})]})})}}class B0 extends Un.Component{static contextType=oi.Z;state={workspaceAsTabs:!1};_onWithWorkspaces=()=>{this.setState({workspaceAsTabs:!1})};_onNoWorkspaces=()=>{this.setState({workspaceAsTabs:!0})};_onCancel=()=>{this.props.onClose()};_onOpen=()=>{this.props.onClose(),this.props.options.onClose(this.state.workspaceAsTabs)};render(){return(0,zn.jsx)(Ha.Z,{onRequestClose:this._onCancel,title:(0,W.Z)("Open Session with Workspaces?"),children:(0,zn.jsxs)("form",{onSubmit:this._onWithWorkspaces,children:[(0,zn.jsxs)("div",{className:"dialog-content",children:[(0,zn.jsx)("p",{children:(0,W.Z)("New Workspaces will be added next to existing")}),(0,zn.jsxs)("label",{className:"dialog-checkbox",children:[(0,zn.jsx)("input",{type:"radio",checked:!this.state.workspaceAsTabs,onChange:this._onWithWorkspaces}),(0,zn.jsx)("span",{children:(0,W.Z)("Open with Workspaces")})]}),(0,zn.jsxs)("label",{className:"dialog-checkbox",children:[(0,zn.jsx)("input",{type:"radio",checked:this.state.workspaceAsTabs,onChange:this._onNoWorkspaces}),(0,zn.jsx)("span",{children:(0,W.Z)("Open as Tabs")})]})]}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"button",onClick:this._onOpen,value:(0,W.Z)("Open"),autoFocus:!0}),(0,zn.jsx)("input",{type:"button",onClick:this._onCancel,value:(0,W.Z)("Cancel")})]})]})})}}class F0 extends Un.PureComponent{_isMounted=!1;constructor(e){super(e),this.state={accounts:[],currentAccount:void 0,setupStep:"setup"}}componentDidMount(){this._isMounted=!0,this.loadAccountsAndCapabilities()}componentDidUpdate(e){if(e.prefValues[Z.kMailAccounts]!==this.props.prefValues[Z.kMailAccounts]){const e=!0;this.loadAccountsAndCapabilities(e)}}loadAccountsAndCapabilities=async e=>{const t=await Zd.Z.loadAllAccounts();let s=this.state.currentAccount;if(t.length<this.state.accounts.length)s=void 0,this.setState({accounts:t,currentAccount:s});else{let n;e&&t.length>this.state.accounts.length&&(s=t.find((e=>!this.state.accounts.some((t=>t.MAIL_EMAIL===e.MAIL_EMAIL)))),n="signature"),this._isMounted&&(n?this.setState({accounts:t,setupStep:n,currentAccount:s}):this.setState({accounts:t,currentAccount:s}))}};showTips=()=>{this.setState({setupStep:"tips"})};onCreateItem=()=>{this.setState({setupStep:"setup"})};render(){return"tips"===this.state.setupStep?(0,zn.jsxs)("div",{className:"MailAccountSheet vivaldi-settings",children:[(0,zn.jsx)("button",{className:"MailAccountSheet-exit",onClick:this.props.onClose,children:(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.kze}})}),(0,zn.jsx)(nM,{onClose:this.props.onClose,onCreateItem:this.onCreateItem})]}):(0,zn.jsxs)("div",{className:"MailAccountSheet vivaldi-settings",children:[(0,zn.jsx)("button",{className:"MailAccountSheet-exit",onClick:this.props.onClose,children:(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.kze}})}),(0,zn.jsxs)("div",{className:"setting-section",children:["setup"===this.state.setupStep&&(0,zn.jsx)(RP,{onClose:this.props.onClose,focusInput:!0,emptyAccounts:0===this.state.accounts.length,searchableStrings:OP},"create"),"signature"===this.state.setupStep&&this.state.currentAccount&&(0,zn.jsx)(uM,{accountSettings:this.state.currentAccount,searchableStrings:cM,showTips:"signature"===this.state.setupStep?()=>this.showTips():void 0})]})]})}}const W0=(0,zd.Z)(F0,[Z.kMailAccounts]);function U0(e){const[t,s]=Un.useState(e.options.account.MAIL_USER||""),[n,i]=Un.useState(e.options.account.MAIL_PASSWORD||""),[a,o]=Un.useState(!1);return(0,zn.jsxs)("form",{onSubmit:function(s){s.preventDefault();const i={...e.options.account,MAIL_USER:t,MAIL_PASSWORD:n};(0,xl.ZP)(i,e.options.account),NP(i,e.options.account),e.onClose()},children:[(0,zn.jsxs)("header",{className:"dialog-double-header",children:[(0,zn.jsx)("div",{className:"header-icon",dangerouslySetInnerHTML:{__html:Kn.Si$.large}}),(0,zn.jsx)("h1",{className:"dialog-title",id:Ha.t,children:(0,W.Z)("Authentication Error")}),(0,zn.jsx)("p",{className:"info full-width",children:(0,W.Z)("Enter credentials for $1",[e.options.account.MAIL_EMAIL])})]}),(0,zn.jsxs)("div",{className:"dialog-content",children:[(0,zn.jsx)("h4",{children:(0,W.Z)("IMAP Username")}),(0,zn.jsx)("div",{className:"toolbar toolbar-default",children:(0,zn.jsx)("input",{type:"text",placeholder:"user@vivaldi.net",value:t,onChange:function(e){s(e.target.value)}})}),(0,zn.jsx)("h4",{children:(0,W.Z)("IMAP Password")}),(0,zn.jsxs)("div",{className:"toolbar toolbar-default",children:[(0,zn.jsx)("input",{autoFocus:!0,type:a?"text":"password",placeholder:(0,W.Z)("My long safe password"),value:n,onChange:function(e){i(e.target.value)}}),(0,zn.jsx)(oa.ZP,{tooltip:(0,W.Z)("tooltip","Show password"),image:Kn.sgm.medium,isPressed:a,onClick:function(){o(!a)}})]})]}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"submit",value:(0,W.Z)("mail","Save"),autoFocus:!0}),(0,zn.jsx)("input",{type:"button",onClick:e.onClose,value:(0,W.Z)("Cancel")})]})]})}function V0(e,t){return t?(0,zn.jsx)("h1",{children:(0,W.Z)("Permanently Delete $1 Message","Permanently Delete $1 Messages",[e])}):(0,zn.jsx)("h1",{children:(0,W.Z)("Delete $1 Message","Delete $1 Messages",[e])})}var H0=(0,zn.jsx)("input",{type:"radio",value:"selected",autoFocus:!0}),G0=(0,zn.jsx)("input",{type:"radio",value:"folders"}),K0=(0,zn.jsx)("input",{type:"radio",value:"accounts"});const z0=function(e){const{options:t,onClose:s}=e,{entries:n,deletePermanently:i}=t,[a,o]=Un.useState((()=>{const e=new Map;return n.forEach((t=>{t.sources.forEach(((t,s)=>{if(!t.deleted){const t=bt.Z.get(s);e.set(t.accountId,!0)}}))})),e}));return(0,zn.jsxs)("form",{onSubmit:function(t){t.preventDefault(),Pp.Z.delete(e.windowId,n,i,{accountIds:a}),s()},children:[(0,zn.jsxs)("header",{className:"dialog-header",children:[(0,zn.jsx)("span",{id:Ha.t,children:V0(n.length,i)}),(0,zn.jsx)("p",{children:(0,W.Z)("From which folders would you like to delete the message?","From which folders would you like to delete the messages?",[n.length])})]}),(0,zn.jsx)("div",{className:"dialog-content label-list",children:[...a.entries()].map(((e,t)=>{const[s,n]=e;return(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",autoFocus:0===t,checked:n,onChange:()=>{a.set(s,!n),o(new Map([...a.entries()]))}}),(0,zn.jsx)("span",{children:s})]},s)}))}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"submit",className:"danger",value:(0,W.Z)("mail","Delete")}),(0,zn.jsx)("input",{type:"button",onClick:s,value:(0,W.Z)("Cancel"),autoFocus:!0})]})]})},$0=function(e){const{options:t,onClose:s}=e,{entries:n,deletePermanently:i}=t,a=new Set;n.forEach((e=>{e.sources.forEach(((e,t)=>{e.deleted||a.add(t)}))}));const o=bt.Z.getByIds([...a]);return(0,zn.jsxs)("form",{onSubmit:function(t){t.preventDefault(),Pp.Z.delete(e.windowId,n,i,{setting:"accounts"}),s()},children:[(0,zn.jsxs)("header",{className:"dialog-header",children:[(0,zn.jsx)("span",{id:Ha.t,children:V0(n.length,i)}),(0,zn.jsx)("p",{children:(0,W.Z)("Are you sure you want to purge the message from the following folders?","Are you sure you want to purge your deleted messages from the following folders?",[n.length])})]}),(0,zn.jsx)("div",{className:"dialog-content label-list",children:(0,zn.jsx)("ul",{children:o.map((e=>{const{id:t,accountId:s,path:n}=e,i=It.Z.getFolderName(s,n);return(0,zn.jsxs)("li",{children:[(0,zn.jsx)("span",{children:s}),(0,zn.jsx)("span",{className:"folder-path",children:i})]},t)}))})}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"submit",className:"danger",value:(0,W.Z)("mail","Delete")}),(0,zn.jsx)("input",{type:"button",onClick:s,value:(0,W.Z)("Cancel"),autoFocus:!0})]})]})},Y0=function(e){const{options:t,onClose:s}=e,{entries:n,deletePermanently:i}=t,[a,o]=Un.useState((()=>{const e=new Map;return n.forEach((t=>{t.sources.forEach(((t,s)=>{t.deleted||e.set(s,!0)}))})),e})),r=bt.Z.getByIds([...a.keys()]);return(0,zn.jsxs)("form",{onSubmit:function(t){t.preventDefault(),Pp.Z.delete(e.windowId,n,i,{sourceFilterIds:a}),s()},children:[(0,zn.jsxs)("header",{className:"dialog-header",children:[(0,zn.jsx)("span",{id:Ha.t,children:V0(n.length,i)}),(0,zn.jsx)("p",{children:(0,W.Z)("From which folders would you like to delete the message?","From which folders would you like to delete the messages?",[n.length])})]}),(0,zn.jsx)("div",{className:"dialog-content label-list",children:r.map(((e,t)=>{const{id:s,accountId:n,path:i}=e,r=It.Z.getFolderName(n,i),l=a.get(s);return(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",autoFocus:0===t,checked:l,onChange:()=>{a.set(s,!l),o(new Map([...a.entries()]))}}),(0,zn.jsxs)("span",{children:[n," ",r]})]},s)}))}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"submit",className:"danger",value:(0,W.Z)("mail","Delete")}),(0,zn.jsx)("input",{type:"button",onClick:s,value:(0,W.Z)("Cancel"),autoFocus:!0})]})]})},X0=function(e){const{options:t,onClose:s}=e,{entries:n,deletePermanently:i,showSelected:a,showFolders:o,showAccounts:r}=t;let l="folders",d=!1;return(0,zn.jsxs)("form",{onSubmit:function(t){if(t.preventDefault(),Pp.Z.delete(e.windowId,n,i,{setting:l}),d){const e=i?Z.kMailDeleteInOtherLocations:Z.kMailMarkDeleteInOtherLocations;I.Z.set(e,l)}s()},children:[(0,zn.jsx)("header",{className:"dialog-header",id:Ha.t,children:V0(n.length,i)}),(0,zn.jsxs)(To.Z,{className:"dialog-content label-list",name:"mail_delete_dialog_setting",value:l,onChange:e=>{l=e.target.value},children:[a&&(0,zn.jsxs)("label",{children:[H0,(0,zn.jsx)("span",{children:(0,W.Z)("From the Current Folder Only")})]}),o&&(0,zn.jsxs)("label",{children:[G0,(0,zn.jsx)("span",{children:(0,W.Z)("From All Folders on Current Account")})]}),r&&(0,zn.jsxs)("label",{children:[K0,(0,zn.jsx)("span",{children:(0,W.Z)("From All Accounts and Folders")})]})]}),(0,zn.jsxs)("footer",{className:"dialog-footer label-list",children:[(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",value:d,onChange:e=>d=e.target.value}),(0,zn.jsx)("span",{children:(0,W.Z)("Don’t Ask Again")})]}),(0,zn.jsx)("input",{type:"submit",className:"danger",value:(0,W.Z)("mail","Delete")}),(0,zn.jsx)("input",{type:"button",onClick:s,value:(0,W.Z)("Cancel"),autoFocus:!0})]})]})};var Q0=s(34155);class q0 extends Un.Component{#Pt=()=>{const e=se.Z.getActiveListEntry();return e?(0,Dp.Q3)(e.flags):[]};#Es=()=>{const e=se.Z.getActiveListEntry(),t=e?(0,Dp.Zr)(e.flags):"";return!t&&e?Nt.T4.CLEAR_FLAGS:t};static contextType=oi.Z;wrapperRef=Un.createRef();state={labels:this.#Pt(),flag:this.#Es(),activeTabId:"labels"};componentDidMount(){se.Z.addListener(this.#ks);const{document:e}=this.context;e.addEventListener("keydown",this.#Ns)}componentWillUnmount(){se.Z.removeListener(this.#ks);const{document:e}=this.context;e.removeEventListener("keydown",this.#Ns)}#_s=(e,t)=>{const s=e?.keyCode===mo.Z.KEY_UP?"up":"down",n=this.wrapperRef.current;if(n){const e=1;return bo(t||"",s,Array.from(n.querySelectorAll(".MailLabelFlagDlg-itemCanFocus")),e)}return!1};#Ps=(e,t="")=>(e.keyCode===mo.Z.KEY_DOWN||e.keyCode===mo.Z.KEY_UP)&&(e.stopPropagation(),e.preventDefault(),this.#_s(e,t));#Ns=e=>{if(e.keyCode===mo.Z.KEY_SPACE)return;e.stopPropagation(),e.preventDefault();const t=(0,Dp.lN)();if(e.keyCode!==mo.Z.KEY_ENTER&&e.keyCode!==mo.Z.KEY_RETURN)if(e.keyCode===mo.Z.KEY_TAB&&this.setState((e=>({activeTabId:"flags"===e.activeTabId?"labels":"flags"})),(()=>Q0.nextTick((()=>this.#_s())))),"flags"===this.state.activeTabId){let t;const s=(0,fp.a)();switch(e.key){case"0":t=s[7];break;case"1":t=s[0];break;case"2":t=s[1];break;case"3":t=s[2];break;case"4":t=s[3];break;case"5":t=s[4];break;case"6":t=s[5];break;case"7":t=s[6]}t&&Pp.Z.setStandardFlag(this.props.windowId,t)}else{let s;switch(e.key){case"1":s=t[0];break;case"2":s=t[1];break;case"3":s=t[2];break;case"4":s=t[3];break;case"5":s=t[4];break;case"6":s=t[5];break;case"7":s=t[6];break;case"8":s=t[7];break;case"9":s=t[8]}s&&Pp.Z.toggleLabel(this.props.windowId,s,this.state.labels)()}else this.props.onClose()};#ks=()=>{this.setState({labels:this.#Pt(),flag:this.#Es()})};#Ms=async()=>{this.props.onClose()};#Ds=e=>{const t=e.currentTarget.value;Pp.Z.toggleLabel(this.props.windowId,t,this.state.labels)()};#Os=e=>{e.currentTarget.value!==this.state.flag&&Pp.Z.toggleStandardFlag(this.props.windowId,e.currentTarget.value,this.state.flag)};#js=e=>this.state.labels.includes(e);#Ls=e=>this.state.flag===e;#Rs=e=>{this.setState({activeTabId:e},(()=>Q0.nextTick((()=>this.#_s()))))};render(){const e=(0,Dp.lN)(),t=(0,fp.a)();return(0,zn.jsxs)("div",{ref:this.wrapperRef,children:[(0,zn.jsxs)("header",{className:"dialog-header",children:[(0,zn.jsx)("h1",{className:"dialog-title",id:"popup-label-addmaillabel",children:(0,W.Z)("Add Labels or Flag")}),(0,zn.jsx)("button",{className:"MailLabelFlagDlg-icon MailLabelFlagDlg-itemCanFocus",title:(0,W.Z)("Mail Label Settings"),dangerouslySetInnerHTML:{__html:Kn.bqs.small},"data-id":"MailLabelFlagDlg-settings",onKeyDown:e=>this.#Ps(e,"MailLabelFlagDlg-settings"),onClick:()=>ue.Z.showSettings(this.context.vivaldiWindowId,wt.Z.isMailOn()?"mail":"feeds",{scroll:"labels"})}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("Select which labels or flag you'd like to add")})]}),(0,zn.jsxs)("form",{onSubmit:this.#Ms,children:[(0,zn.jsxs)(aM,{activeTabId:this.state.activeTabId,icons:[Kn.rpm.small,Kn.nyn.small],className:"dialog-content",onTabClick:this.#Rs,children:[(0,zn.jsx)("div",{className:"dialog-content MailLabelFlagDlg-tab",label:(0,W.Z)("Labels"),id:"labels",children:e.map(((e,t)=>(0,zn.jsxs)("label",{"data-id":e,onKeyDown:t=>this.#Ps(t,e),className:"MailLabelFlagDlg-labelWrapper MailLabelFlagDlg-itemCanFocus",children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.#js(e),value:e,onChange:this.#Ds,autoFocus:0===t}),(0,zn.jsx)("span",{children:(0,Zy.X)(e)}),t+1<10&&(0,zn.jsx)("span",{className:"MailLabelFlagDlg-shortcut",children:(0,zn.jsx)("kbd",{children:t+1})})]},e)))}),(0,zn.jsx)("div",{className:"MailLabelFlagDlg-tab",label:(0,W.Z)("Flags"),id:"flags",children:t.map(((e,t)=>(0,zn.jsxs)("label",{"data-id":e,onKeyDown:t=>this.#Ps(t,e),className:"MailLabelFlagDlg-labelWrapper MailLabelFlagDlg-itemCanFocus",children:[(0,zn.jsx)("input",{type:"radio",checked:this.#Ls(e),value:e,onChange:this.#Os}),e!==Nt.T4.CLEAR_FLAGS&&(0,zn.jsx)("span",{className:`MailLabelFlagDlg-icon flag-color flag-${e.toLowerCase()}`,title:(0,W.Z)("Flagged"),dangerouslySetInnerHTML:{__html:Kn.nyn.small}}),(0,zn.jsx)("span",{children:(0,Uy.M)(e)}),(0,zn.jsx)("span",{className:"MailLabelFlagDlg-shortcut",children:(0,zn.jsx)("kbd",{children:e===Nt.T4.CLEAR_FLAGS?0:t+1})})]},e)))})]}),(0,zn.jsx)("footer",{className:"dialog-footer",children:(0,zn.jsx)("input",{type:"submit",className:"primary MailLabelFlagDlg-itemCanFocus","data-id":"Submit-button-done",onKeyDown:e=>this.#Ps(e,"Submit-button-done"),value:(0,W.Z)("process","Done")})})]})]})}}const J0=q0;function e1(e){const t=(0,Un.useContext)(oi.Z),[s,n]=(0,Un.useState)(!1),{folder:i}=e.options,{accountId:a,path:o}=i,r=It.Z.getFolderName(a,o);return(0,zn.jsxs)("form",{onSubmit:function(n){n.preventDefault(),d.Z.unsubscribeMailbox(t.vivaldiWindowId,i,s),e.onClose()},children:[(0,zn.jsxs)("header",{className:"dialog-double-header",children:[(0,zn.jsx)("div",{className:"header-icon",dangerouslySetInnerHTML:{__html:Kn.Si$.large}}),(0,zn.jsx)("h1",{className:"dialog-title",id:Ha.t,children:(0,W.Z)("Unsubscribe from IMAP folder $1",[r])})]}),(0,zn.jsxs)("div",{className:"dialog-content",children:[(0,zn.jsxs)("div",{className:"toolbar toolbar-default",children:[(0,zn.jsx)("input",{autoFocus:!0,type:"checkbox",checked:s,onChange:function(){n(!s)}}),(0,zn.jsx)("span",{children:(0,W.Z)("Remove messages from this device")})]}),(0,zn.jsx)("p",{className:"info",children:(0,W.Z)("If checked, all message files for $1 on $2 will be deleted. Otherwise they will remain on disk.",[r,a])})]}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"submit",className:"danger",value:(0,W.Z)("mail","Unsubscribe"),autoFocus:!0}),(0,zn.jsx)("input",{type:"button",onClick:e.onClose,value:(0,W.Z)("Cancel")})]})]})}class t1 extends Un.PureComponent{static contextType=oi.Z;refTreeList=Un.createRef();notes=s$.ZP.getRootNode().children.filter((e=>"trash"!==e.type));state={selectedId:void 0,filter:"",filteredNotes:this.notes};handleConfirm=()=>{this.state.selectedId&&(this.props.onSelected(this.state.selectedId),this.props.onClose())};handleSelected=e=>{e?.id&&this.setState({selectedId:e.id})};handleDoubleClick=(e,t)=>{t.id&&(this.props.onSelected(t.id),this.props.onClose())};hasChildren=e=>"note"!==e.type&&!!e.children&&e.children.length>0;handleExpandClick=(e,t)=>{const s=e.altKey;this.refTreeList.current?.toggleSelectedExpansion(t,s)};handleFilterChange=({currentTarget:e})=>{const t=e.value;if(0===t.length)return void this.setState({filteredNotes:this.notes,filter:""});let s=t.toLowerCase();const n={};s.startsWith("url:")?(s=s.substring(4),n.url=s.length>0,n.content=!1):s.startsWith("content:")&&(s=s.substring(8),n.url=!1,n.content=s.length>0),"."===s&&(n.url=!1);const{collapsed:i,nodes:a}=s$.ZP.getFilteredTree(s,n);this.setState({filteredNotes:a,filter:t},(()=>{this.refTreeList.current?.expandAllExcept(i)}))};renderTitleRow=e=>{const t=e.node,s=e.level,n=(s+1)*Ni+"px",i=s*Ni+"px",a=s$.ZP.isFolder(t);return(0,zn.jsxs)("label",{children:[a&&this.hasChildren(t)&&(0,zn.jsx)("span",{className:"expand-icon",style:{marginLeft:i},onMouseDown:wi.ZP,onMouseUp:e=>this.handleExpandClick(e,t.id),dangerouslySetInnerHTML:{__html:Kn.nfH}}),a&&(0,zn.jsx)(qn,{trash:!1,open:e.isExpanded,leftMargin:this.hasChildren(t)?0:n}),!a&&!t.url&&(0,zn.jsx)("span",{style:{marginLeft:n},className:"tree-icon",dangerouslySetInnerHTML:{__html:Kn.zKr}}),!a&&!!t.url&&(0,zn.jsx)("span",{style:{marginLeft:n},className:"tree-icon",dangerouslySetInnerHTML:{__html:Kn.NwZ}}),void 0!==e.inlineEditText&&(0,zn.jsx)("input",{type:"text",value:e.inlineEditText,onChange:e.onChange,onFocus:e.onFocus,onBlur:e.onBlur,autoFocus:!0}),void 0===e.inlineEditText&&(0,zn.jsx)("span",{className:"title",title:MY(t),children:MY(t)}),e.showBadge&&this.hasChildren(t)&&(0,zn.jsx)("span",{className:"item-count",children:t.children?.length})]},t.id)};rowComponent=e=>{const t=e.node,s=e.level,n=s$.ZP.isSeparator(t),i=(s+1)*Ni+"px",a=[];return n?a.push((0,zn.jsx)("label",{"data-parent":t.parentId,children:(0,zn.jsx)("hr",{style:{marginLeft:i},className:"separator"})},`${t.id}__separator__${a.length}`)):a.push(this.renderTitleRow(e)),a};render(){const{props:e}=this,t=s$.ZP.getRootNode().id;return(0,zn.jsxs)("div",{className:e.className,style:e.style,children:[(0,zn.jsx)("header",{className:"dialog-header",children:(0,zn.jsx)("h1",{id:"moodal-dialog-title",children:(0,W.Z)("notes","Choose which note to append the selected text")})}),(0,zn.jsxs)("div",{className:"dialog-content",children:[(0,zn.jsx)("input",{className:"notes-filter",type:"search",placeholder:(0,W.Z)("verb","Filter"),value:this.state.filter,onChange:this.handleFilterChange,autoFocus:!0,tabIndex:"0"}),(0,zn.jsx)(Mi,{ref:this.refTreeList,rowComponent:this.rowComponent,nodes:this.state.filteredNotes,rootId:t,onSelect:this.handleSelected,onItemDoubleClick:this.handleDoubleClick,supportsInlineEdit:!1,isSeparator:s$.ZP.isSeparator,hasChildren:this.hasChildren,isFolder:s$.ZP.isFolder})]}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Add to Note"),className:"primary",disabled:!this.state.selectedId,onClick:this.handleConfirm}),(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Cancel"),onClick:this.props.onClose})]})]})}}const s1=t1,n1="shift+alt+";class i1 extends Un.PureComponent{static contextType=oi.Z;state={accessKeys:[],shown:!1,page:null};componentDidMount(){const e=Ze.ZP.getActivePage(this.context.vivaldiWindowId);e&&re.Z.accessKeys.getAccessKeysForPage(e.id,(t=>{this.setState({accessKeys:t,shown:!0,page:e},(()=>this.bindKeystrokes()))}))}componentWillUnmount(){this.unbindKeystrokes()}bindKeystrokes=()=>{const{accessKeys:e}=this.state;e.forEach((e=>{Qe.Z.bind(e.access_key,this.pressKey),Qe.Z.bind(n1+e.access_key,this.pressKey)}))};unbindKeystrokes=()=>{const{accessKeys:e}=this.state;e.forEach((e=>{Qe.Z.unbind(e.access_key,this.pressKey),Qe.Z.unbind(n1+e.access_key,this.pressKey)}))};onClose=()=>{this.state.shown&&(this.setState({shown:!1}),this.props.onClose())};getLink=e=>{const t=(0,ve.Z)(this.state.page?.url??"");if(t){if(e.startsWith("#")&&t.href)return t.href.split("#")[0]+e;if(e.startsWith("/")&&t.protocol&&t.host)return t.protocol+"//"+t.host+e}return e};pressKey=e=>{this.triggerKey(e.keyState.key)};triggerKey=e=>{const t=Ze.ZP.getActivePage(this.context.vivaldiWindowId);t&&re.Z.accessKeys.action(t.id,e),this.onClose()};render(){if(!this.state.shown)return null;const{accessKeys:e,page:t}=this.state;return(0,zn.jsxs)("div",{className:"dialog-access-keys",children:[(0,zn.jsx)("header",{className:"dialog-header",children:(0,zn.jsxs)("h1",{className:"dialog-title",children:[(0,zn.jsx)("span",{id:Ha.t,children:(0,W.Z)("Access Key Shortcuts")}),t&&(0,zn.jsx)("span",{className:"info",children:(0,W.Z)("for $1",[t.title||t.url])})]})}),(0,zn.jsxs)("div",{className:"dialog-content",children:[0===e.length&&(0,W.Z)("This page doesn’t seem to contain access key shortcuts."),e.length>0&&e.map(((e,t)=>(0,zn.jsxs)("label",{className:"keycombo",title:e.href,children:[(0,zn.jsx)("input",{type:"button",className:"item",onClick:this.triggerKey.bind(null,e.access_key),value:e.access_key}),(0,zn.jsx)("span",{children:e.title.replace(/\[.*?\]/g,"")||e.textContent.trim()||e.href})]},t)))]}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsxs)("p",{className:"info",children:[A.Z.get(Z.kWebpagesAccessKeys)?(0,W.Z)("Access key shortcuts are allowed in keyboard settings."):(0,W.Z)("Access key shortcuts are disabled in keyboard settings.")," ",(0,W.Z)("Run shortcuts on page with $1 modifier keys.",["Shift+Alt"])]}),(0,zn.jsx)("input",{type:"button",onClick:this.onClose,value:(0,W.Z)("Close"),className:"primary",autoFocus:!0})]})]})}}const a1=i1;function o1(e){return function(t){return(0,zn.jsx)("div",{"data-selected":t.selected?"":null,className:"quick-command",style:t.style,onMouseOver:()=>t.onMouseOver(t.item),onClick:e=>t.onItemClick(t.item,e),children:(0,zn.jsx)(e,{...t})})}}class r1 extends Un.PureComponent{render(){const{name:e}=this.props.item;return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("span",{className:"quick-command-favicon",dangerouslySetInnerHTML:{__html:Kn.VLT}}),(0,zn.jsx)("span",{className:"quick-command-title",children:e}),(0,zn.jsx)("span",{className:"view quick-command-shortcut",children:(0,W.Z)("Press Enter to Copy")})]})}}const l1=o1(r1);class d1 extends Un.PureComponent{render(){const{item:e,searchTerm:t,icon:s}=this.props,n=e.faviconUrl||e.pageUrlForFavicon||e.url||void 0,i=e.faviconUrl?"faviconFromCache":"page";return(0,zn.jsxs)(zn.Fragment,{children:[s&&(0,zn.jsx)("span",{className:"quick-command-workspace-icon",dangerouslySetInnerHTML:{__html:s}}),n&&(0,zn.jsx)(Vn.ZP,{className:"quick-command-favicon",url:n,loadType:i,style:e.read?{filter:"saturate(0) opacity(0.5)"}:{}}),t.length?Ag(t,e.name,!1,"quick-command-title"):(0,zn.jsx)("span",{className:"quick-command-title",children:e.name}),e.url&&(t.length?Ag(t,e.url,!1,"quick-command-url"):(0,zn.jsx)("span",{className:"view quick-command-url",children:e.url})),e.nickname&&(t.length?Ag(t,e.nickname,!1,"view quick-command-nickname"):(0,zn.jsx)("span",{className:"view quick-command-nickname",children:e.nickname})),e.meta&&(0,zn.jsx)("span",{className:"view quick-command-meta",children:(0,vc.$)(e.meta)})]})}}const c1=o1(d1);class h1 extends Un.PureComponent{render(){const{name:e,url:t,faviconUrl:s,visitCount:n,visitTime:i}=this.props.item,{searchTerm:a}=this.props,o=V()(i).format("l, LT"),r=e||t;return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)(Vn.ZP,{url:s||t,loadType:s?"faviconFromCache":"page",className:"quick-command-favicon"}),Ag(a,r,!1,"quick-command-title"),(0,zn.jsx)("span",{className:"quick-command-timestamp",children:o}),(0,zn.jsx)("span",{className:"item-count",children:n})]})}}const u1=o1(h1);const p1="/resources/folder@2x.png";class g1 extends Un.PureComponent{render(){const{item:e,searchTerm:t}=this.props,s=function(e,t){return t?p1:e?Kn.NwZ:Kn.cyI.small}(e.hasOwnProperty("url"),Boolean(e.isFolder));return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)(Vn.ZP,{url:s,loadType:"faviconFromCache",className:"quick-command-favicon"}),e.name&&Ag(t,e.name,!1,"quick-command-title"),!e.nickname&&e.url&&Ag(t,e.url,!1,"quick-command-url"),e.nickname&&Ag(t,e.nickname,!1,"quick-command-url"),e.hasAttachment&&(0,zn.jsx)("span",{className:"quick-command-attachment",dangerouslySetInnerHTML:{__html:Kn.onv}})]})}}const m1=o1(g1);class f1 extends Un.PureComponent{render(){const{item:e,style:t,selected:s}=this.props,{name:n,subtitle:i,count:a}=e;return(0,zn.jsxs)("div",{"data-selected":s?"":null,style:t,className:"quick-command-sectionheader",children:[n,i&&(0,zn.jsx)("span",{className:"QuickCommand-Title--Subtitle",children:i}),a>0&&(0,zn.jsx)("span",{className:"item-count",children:a})]})}}const v1=f1;var b1=s(34155);class C1 extends Un.PureComponent{static contextType=oi.Z;state={selectedIndex:1};_keyedNavigation=!1;_startIndex=0;_stopIndex=0;setKeyedNavigation=e=>{this._keyedNavigation=e};getSelectedIndex=()=>this.state.selectedIndex;selectByIndex=e=>{this.props.setNavigatingList(!0),this.props.hintChange(e),this.setState({selectedIndex:e}),this.rerenderVisibleTreeItems()};onKeyDown=e=>{const t={ctrl:Boolean(e.ctrlKey),alt:Boolean(e.altKey),shift:Boolean(e.shiftKey),command:!1},s=this.props.renderedArray;let n=this.getSelectedIndex(),i=n;if(!t.ctrl&&t.alt&&!t.shift&&!t.command)switch(e.key){case"ArrowUp":n>0&&"title"===s[n-1].type&&n--,i=0;for(let e=n-1;e>=0;e--)if("title"===s[e].type){i=e+1;break}e.preventDefault();break;case"ArrowDown":for(let e=n;e<s.length;e++)if("title"===s[e].type){i=e+1;break}e.preventDefault()}else if(!(t.ctrl||t.alt||t.shift||t.command)){const t=this._stopIndex-this._startIndex;switch(e.key){case"ArrowUp":i=Math.max(0,n-1),e.preventDefault();break;case"ArrowDown":i=Math.min(n+1,s.length-1),e.preventDefault();break;case"PageUp":i=Math.max(0,this._startIndex-t);break;case"PageDown":i=Math.min(this._stopIndex+t,s.length-1)}}i!==n&&("title"===s[i].type&&(i=i>n?++i:Math.max(0,--i)),this.selectByIndex(i))};_onMouseOver=e=>{this._keyedNavigation||void 0===e.index||(this.selectByIndex(e.index),b1.nextTick((()=>this.props.syncOffset())))};_onMouseMove=()=>{this.setKeyedNavigation(!1)};rerenderVisibleTreeItems=()=>{this.refList&&this.refList.forceUpdateGrid()};_onIndexChanged=e=>{this._startIndex=e.startIndex,this._stopIndex=e.stopIndex};_getWorkspaceIcon=e=>{const t=this.props.workspaces.find((t=>t.id===e));return t?.emoji??t?.icon??void 0};renderTreeItem=({index:e,style:t})=>{const{filtering:s,searchTerm:n}=this.props,i=this.props.renderedArray[e],a=`${i.type}__${e}`;"noteAdd"!==i.type&&"title"!==i.type&&(i.index=e);const o=this.state.selectedIndex===e,r=s&&"noteAdd"!==i.type&&"search"!==i.type&&"keywordSearch"!==i.type&&"commandChain"!==i.type?n.split(":")[1].trim():n;switch(i.type){case"title":return(0,zn.jsx)(v1,{selected:o,item:i,style:t},a);case"history":{const e=i;return(0,zn.jsx)(u1,{selected:o,item:e,style:t,searchTerm:r,onItemClick:this.props.onExecuteCommand,onMouseOver:this._onMouseOver},a)}case"calculator":{const e=i;return(0,zn.jsx)(l1,{style:t,selected:o,onItemClick:this.props.onExecuteCommand,onMouseOver:this._onMouseOver,item:e},a)}case"note":case"noteAdd":return(0,zn.jsx)(m1,{item:i,style:t,selected:o,onItemClick:this.props.onExecuteCommand,searchTerm:r,onMouseOver:this._onMouseOver},a);default:{const e=i;let s;return e.workspaceId?s=this._getWorkspaceIcon(e.workspaceId):e.deviceType&&(s=(0,Dz.bj)(e.deviceType)),(0,zn.jsx)(c1,{selected:o,item:e,style:t,searchTerm:r,onItemClick:this.props.onExecuteCommand,onMouseOver:this._onMouseOver,icon:s},a)}}};render(){const{innerHeight:e}=this.context,t=28+((0,Si.mM)()?4:0),s=this.props.renderedArray.length*t;let n=s>10*t?10*t:s;return e/2<n&&(n=Math.round(e/2)),(0,zn.jsx)("div",{className:"quick-commands",tabIndex:"1",onKeyDown:this.onKeyDown,onMouseMove:this._onMouseMove,children:(0,zn.jsx)(QD.a,{ref:e=>this.refList=e,onRowsRendered:this._onIndexChanged,scrollToIndex:this.state.selectedIndex,height:n,rowHeight:t,width:520,rowRenderer:this.renderTreeItem,rowCount:this.props.renderedArray.length})})}}const w1=C1;var y1=s(34155);const x1=(0,W.Z)("Filter Quick Commands"),I1=[Z.kAddressBarStripJavascriptOnPaste,Z.kQuickCommandsKeepValue,Z.kQuickCommandsOpenUrlInNewTab,Z.kQuickCommandsSearchEnglish,Z.kQuickCommandsFirstRunTipDismissed,Z.kQuickCommandsSearchPriority,Z.kQuickCommandsMatchNickname,Z.kQuickCommandsNicknameMatchInNewTab,Z.kChainedCommandsCommandList,Z.kQuickCommandsShowBookmarks,Z.kQuickCommandsShowCalculator,Z.kQuickCommandsShowExtensions,Z.kQuickCommandsShowHistory,Z.kQuickCommandsShowNotes,Z.kQuickCommandsShowPageActions,Z.kQuickCommandsLimitResults,Z.kQuickCommandsShowReadingList,Z.kQuickCommandsUseNotesManager,Z.kWorkspacesEnabled];let A1=!1;const S1=(0,fi.Z)("keyword","bookmark"),Z1=(0,fi.Z)("keyword","note"),T1=(0,fi.Z)("keyword","tab"),E1=(0,fi.Z)("keyword","nick"),k1=(0,fi.Z)("keyword","history"),N1=(0,fi.Z)("keyword","command"),_1=(0,fi.Z)("keyword","action"),P1=(0,fi.Z)("keyword","extension"),M1=(0,fi.Z)("keyword","workspace"),D1=[{...(0,Dz.jn)({labelPair:S1,initialPart:"^",endingPart:"$"}),...S1,type:"bookmark"},{...(0,Dz.jn)({labelPair:Z1,initialPart:"^",endingPart:"$"}),...Z1,type:"note"},{...(0,Dz.jn)({labelPair:T1,initialPart:"^",endingPart:"$"}),...T1,type:"tab"},{...(0,Dz.jn)({labelPair:E1,initialPart:"^",endingPart:"$"}),...E1,type:"bookmarkNick"},{...(0,Dz.jn)({labelPair:k1,initialPart:"^",endingPart:"$"}),...k1,type:"history"},{...(0,Dz.jn)({labelPair:N1,initialPart:"^",endingPart:"$"}),...N1,type:"command"},{...(0,Dz.jn)({labelPair:_1,initialPart:"^",endingPart:"$"}),..._1,type:"contentScript"},{...(0,Dz.jn)({labelPair:P1,initialPart:"^",endingPart:"$"}),...P1,type:"extension"},{...(0,Dz.jn)({labelPair:M1,initialPart:"^",endingPart:"$"}),...M1,type:"workspace"}];var O1=(0,zn.jsx)(aa,{type:"close",size:16});class j1 extends Un.PureComponent{static contextType=oi.Z;state={quickCommandSearchValue:this.props.quickCommandValue||"",typeAheadHint:x1,filtering:null,renderedArray:[]};#v=!1;_isIMEOpen=!1;_justClosedIME=!1;contentScripts=[];hasSearchedForFullHistory=!1;_imeProcessSpace=!1;defaultEngine;chainShortcuts=[];refQuickCommandInput=Un.createRef();refQuickCommandHint=Un.createRef();extensions=[];commandChains=[];sendTabToSelfTargets=[];constructor(e,t){super(e),A1||(A1=!0,Le.loadAll()),this.defaultEngine=pn.Z.getDefault(fe.ZP.isIncognito(t.vivaldiWindowId))}componentDidMount(){this.#v=!0,Ca.Z.addListener(this._onWebpageviewStoreChanged),this._initialSetup(),re.Z.pageActions.getScripts((e=>{this.contentScripts=e}))}_initialSetup=()=>{const e=(0,Dz.IZ)(this.context.vivaldiWindowId,""),t=(0,Dz.JQ)(""),s=A.Z.get(Z.kWorkspacesEnabled),n=s?(0,Dz.fX)(""):[];this.chainShortcuts=Ye.Z.getChainCommandsShortcuts(),(0,Dz.pN)().then((e=>this.extensions=e));const i=Ze.ZP.getActivePage(this.context.vivaldiWindowId);(0,Dz.a$)(i?i.id:-1).then((e=>{this.sendTabToSelfTargets=e})),this.commandChains=this.props.prefValues[Z.kChainedCommandsCommandList];const a=(0,Dz.$J)(this.context,{searchText:"",chains:this.commandChains,shortcuts:this.chainShortcuts});let o=[];if(this.props.prefValues[Z.kQuickCommandsSearchPriority].forEach((i=>{switch(i){case"OPEN_TABS":o=[...o,...t];break;case"NORMAL_COMMAND":o=[...o,...e];break;case"WORKSPACES":s&&(o=[...o,...n]);break;case"COMMAND_CHAIN":o=[...o,...a]}})),this.setState({renderedArray:o},(()=>{const{selectIndex:e}=this.getSelectPriority();this.hintChange(e)})),this.props.prefValues[Z.kQuickCommandsKeepValue]&&this.refQuickCommandInput.current?.value===this.props.quickCommandValue){const e=this.state.quickCommandSearchValue;e.length&&(this.refQuickCommandInput.current?.setSelectionRange(0,e.length),this.searchChange(e))}};componentWillUnmount(){const e=this.state.quickCommandSearchValue;this.props.prefValues[Z.kQuickCommandsKeepValue]&&e.length?this.props.storeQuickCommandValue(e):this.props.storeQuickCommandValue(""),Ca.Z.removeListener(this._onWebpageviewStoreChanged),this.#v=!1}componentDidUpdate(){this._imeProcessSpace&&this._isIMEOpen&&(this._imeProcessSpace=!1),this.commandChains!==this.props.prefValues[Z.kChainedCommandsCommandList]&&(this.commandChains=this.props.prefValues[Z.kChainedCommandsCommandList])}_onWebpageviewStoreChanged=e=>{if(this.#v&&"qcPasteAndGo"===e.action&&e.payload){const t=this.refQuickCommandInput.current?.selectionStart??0,s=this.refQuickCommandInput.current?.selectionEnd??0,{clipboardText:n}=e.payload,{quickCommandSearchValue:i}=this.state,a=(0,hm.Z)({textToStrip:n,caretPosition:t,selectionEnd:s,currentValue:i}),{renderedArray:o,filtering:r}=this.processRenderedArray({qcInputText:a,renderedArray:[]});this.setState({renderedArray:o,filtering:r},(()=>{const{selectIndex:e}=this.getSelectPriority(),t=this.state.renderedArray[e];setTimeout((()=>{this.executeCommand(t,{ctrlKey:!1,altKey:!1,metaKey:!1,shiftKey:!1}),this.props.onClose()}),5)}))}};onKeyDown=e=>{switch(this.qclist.setKeyedNavigation(!0),e.key){case"Process":this._isIMEOpen&&(this._imeProcessSpace=!0);break;case"Escape":this.onEscape(),e.preventDefault(),e.stopPropagation();break;case"ArrowUp":case"ArrowDown":case"PageUp":case"PageDown":this.qclist.onKeyDown(e),e.preventDefault();break;case"Enter":{if(this._isIMEOpen||this.expireTimeout)break;const t=this.qclist.getSelectedIndex(),{renderedArray:s}=this.state,n=s[t];this.executeCommand(n,e),e.preventDefault(),e.stopPropagation();break}case"Tab":case"ArrowRight":if((0,vi.Z)(e)||this._isIMEOpen)break;this.autoCompleteHint(),"Tab"===e.key&&e.preventDefault()}this._justClosedIME=!1,y1.nextTick((()=>this.syncOffset()))};onCompositionStart=()=>{this._isIMEOpen=!0};onCompositionEnd=()=>{this._isIMEOpen=!1,this._justClosedIME=!0,this.searchChange(this.state.quickCommandSearchValue)};onEscape=()=>{this._isIMEOpen||(this.state.quickCommandSearchValue.length>0&&!this._justClosedIME&&!this._isIMEOpen?(this.props.storeQuickCommandValue(""),this.setState({quickCommandSearchValue:"",typeAheadHint:x1},(()=>this.searchChange("")))):this._justClosedIME||this.props.onClose()),this._justClosedIME=!1};syncOffset=()=>{const{HTMLInputElement:e}=this.context,t=this.refQuickCommandInput.current?.scrollLeft??-1;t>-1&&this.refQuickCommandHint.current instanceof e&&(this.refQuickCommandHint.current.scrollLeft=t)};autoCompleteHint=()=>{const{typeAheadHint:e,renderedArray:t}=this.state,s=t[this.qclist.getSelectedIndex()];if(!e.length||"calculator"===s.type)return;const n="commandKeyword"===s.type&&s.searchString?s.searchString+" ":s.name;this.setState({quickCommandSearchValue:n},(()=>this.searchChange(n)))};executeCommand=(e,t)=>{const{ctrlKey:s,altKey:i,metaKey:a,shiftKey:o}=t,r={ctrlKey:s,altKey:i,metaKey:a,shiftKey:o},l=(0,Dz.vD)(this.context.vivaldiWindowId,r),d=this.context.vivaldiWindowId;switch(e.type){case"openTab":if(e.windowId&&e.pageId){const{windowId:t,pageId:s,workspaceId:i}=e;i!==Ze.ZP.getActiveWorkspace(d)&&c.ZP.setActiveWorkspace(t,i),n.Z.windows.update(t,{focused:!0},(()=>{n.Z.tabs.update(s,{active:!0})}))}break;case"readingList":e.url&&c.ZP.openURL(d,e.url,{...l});break;case"closedTab":e.command&&Ln.Z.undeleteTab(e.command.sessionId);break;case"calculator":{const{name:t}=e;this.context.navigator.clipboard.writeText(t);break}case"commandChain":e.action&&e.action();break;case"bookmarkFolder":case"bookmarkNick":e.folderId?(0,Dz.hV)(this.context.vivaldiWindowId,e.folderId):e.url&&c.ZP.openURL(d,e.url,{...l,transition:re.Z.historyPrivate.TransitionType.TYPED});break;case"bookmark":if(e.url){const{url:t}=e;c.ZP.openURL(d,t,{...l,transition:re.Z.historyPrivate.TransitionType.TYPED})}break;case"sendtabtoself":{const{pageUrl:t,title:s,guid:n}=e;t&&n&&re.Z.tabsPrivate.sendSendTabToSelfTarget(t,s??"",n);break}case"extension":if(e.id&&void 0!==e.enabled){const{id:t,enabled:s,optionsUrl:n=""}=e,i={id:t,enabled:s,optionsPage:(0,Zi.Ek)(r),optionsUrl:n};(0,Dz.de)(d,i)}break;case"url":{const{name:t}=e;c.ZP.openURL(d,t,{transition:re.Z.historyPrivate.TransitionType.TYPED,...l});break}case"keywordSearch":case"search":e.searchQuery&&"string"==typeof e.searchQuery&&Fg.Z.goSearchUrl(d,e.searchQuery,{...l,transition:re.Z.historyPrivate.TransitionType.GENERATED});break;case"command":case"commandKeyword":if(e.commandName){const{commandName:t,value:s,name:n}=e;return void this.props.onClose().then((()=>{ae.Z.executeActions("qc",this.context,t,s),h.Z.setStatus(d,(0,W.Z)("Command: $1",[n]),3e3),this.props.storeQuickCommandValue("")}))}break;case"history":if(e.url){const{url:t}=e;c.ZP.openURL(d,t,{...l,transition:re.Z.historyPrivate.TransitionType.TYPED})}break;case"contentScript":{const t=Ze.ZP.getActivePage(d);if(t&&e.script){const s=t.id,{script:n}=e;re.Z.pageActions.getScriptOverridesForTab(s,(e=>{const t=e.find((e=>e.script===n)),i=t&&"enabled"===t.override?"no_override":"enabled";re.Z.pageActions.setScriptOverrideForTab(n,s,i,(()=>{}))}))}break}case"note":if(e.id){const{id:t}=e;this.handleNotesOpening(t,{...l})}break;case"noteAdd":if(e.value&&"string"==typeof e.value){const{value:t}=e;Js.Z.createNote(d,{content:t,type:"note"})}break;case"workspace":{const{workspaceId:t}=e;c.ZP.setActiveWorkspace(d,t);break}}this.#v&&(this.setState({quickCommandSearchValue:""}),this.props.storeQuickCommandValue("")),y1.nextTick((()=>{this.closeTip(),this.props.onClose()}))};onSearchChange=e=>{const t=e.target;this.searchChange(t.value)};handleNotesOpening=(e,t)=>{const s=this.props.prefValues,n=this.context.vivaldiWindowId;s[Z.kQuickCommandsUseNotesManager]||!tn.ZP.hasPanel(n,"PanelNotes")?c.ZP.openURL(n,vs.jk.internalUrl("notes",e),{...t}):en.Z.showContent(n,"PanelNotes",{setFocus:!0,selectId:e,reason:""})};handleHistoryFullSearchTimeout=(0,Te.Z)((e=>{if(this.hasSearchedForFullHistory||!this.state.quickCommandSearchValue.length)return!1;if(this.isNavigatingList)return this.hasSearchedForFullHistory=!1,this.handleHistoryFullSearchTimeout(e),!1;this.hasSearchedForFullHistory=!0;let t=e;const s=e.indexOf(":");-1===s||(0,Ar.K2)(e)||(t=e.substring(s+1).trim());const n=(0,Dz.s1)({searchText:t,today:!1}),i=this.state.renderedArray[this.qclist?.getSelectedIndex()],{renderedArray:a,filtering:o}=this.processRenderedArray({qcInputText:e,renderedArray:n});this.setState({renderedArray:a,filtering:o},(()=>this.performFullSearchSelection(i)))}),750);performFullSearchSelection=e=>{const t=e;if("history"!==t.type||void 0===t.url)return;const s=this.state.renderedArray.findIndex((s=>{const n=s.url;return!(!n||!e)&&n.toLowerCase()===t.url?.toLowerCase()}));-1!==s&&(this.selectByIndex(s),this.qclist.rerenderVisibleTreeItems())};setNavigatingList=e=>{this.isNavigatingList=e,this.closeTip(),this.debounceNavigationOfList()};debounceNavigationOfList=(0,Te.Z)((()=>{this.isNavigatingList=!1}),500);processRenderedArray=e=>{const{qcInputText:t,renderedArray:s}=e,n=t.trim(),i=this.props.prefValues,a=this.props.prefValues[Z.kQuickCommandsSearchPriority];let o,r,l,d=[];const c=n.indexOf(":");-1===c||(0,Ar.K2)(n)||(r=n.substring(0,c).trim(),l=n.substring(c+1).trim(),o=D1.find((e=>(0,Dz.Fm)(r,e))));const h=(0,Dz.xh)(n);h.forEach((e=>d.push(e)));const u=n.length;if(i[Z.kQuickCommandsShowCalculator]&&(0,Dz.CD)(n).forEach((e=>d.push(e))),u&&!h.length){const e=(0,Dz.JC)(n,this.defaultEngine);d.push(e)}i[Z.kQuickCommandsShowNotes]&&(0,Dz.Dj)(n).forEach((e=>d.push(e)));const p=l?.trim()||n,g=l?.trim()?.length||u,m=void 0!==o,f=Boolean(!m&&g);return a.forEach((e=>{switch(e){case"OPEN_TABS":{if(!("tab"===o?.type)&&m)break;const e=(0,Dz.JQ)(p);d=[...d,...e];break}case"NORMAL_COMMAND":{if(!("command"===o?.type)&&m)break;const e=(0,Dz.IZ)(this.context.vivaldiWindowId,p);d=[...d,...e];break}case"SEND_TAB_TO_SELF":{const e=(0,Dz.fJ)(this.context.vivaldiWindowId,p,this.sendTabToSelfTargets);d=[...d,...e];break}case"EXTENSIONS":{const e=i[Z.kQuickCommandsShowExtensions]&&g,t="extension"===o?.type;if(!e||!t&&m)break;const s=(0,Dz.nX)(p,this.extensions);d=[...d,...s];break}case"COMMAND_CHAIN":u&&(0,Dz.$J)(this.context,{searchText:n,chains:this.commandChains,shortcuts:this.chainShortcuts}).forEach((e=>d.push(e)));break;case"BOOKMARK_ITEM_OR_FOLDER":{const e=i[Z.kQuickCommandsShowBookmarks]&&g,t="bookmark"===o?.type,s="bookmarkNick"===o?.type;if(!e)break;(s||f)&&(0,Dz.hm)(p).forEach((e=>d.push(e)));let n=[],a=[];(t||f)&&(n=(0,Dz.Xz)(p),a=(0,Dz.oE)(p)),d=[...d,...n,...a];break}case"READING_LIST":if(u&&i[Z.kQuickCommandsShowReadingList]){const e=(0,Dz.Lm)(n);d=[...d,...e]}break;case"NOTES_SEARCH":{const e=i[Z.kQuickCommandsShowNotes]&&g,t="note"===o?.type;if(!e||!t&&m)break;const s=(0,Dz.Kk)(p);d=[...d,...s];break}case"HISTORY":{const e=i[Z.kQuickCommandsShowHistory]&&g>1,t="history"===o?.type;if(!e||!t&&m)break;if(!s.length){const e=this.throttleHistory(n);d=[...d,...e]}else d=[...d,...s];break}case"CLOSED_TABS":{if(!("tab"===o?.type)&&m)break;const e=(0,Dz.S4)(p);d=[...d,...e];break}case"KEYWORD_SEARCH":(0,Dz.Gr)(n).forEach((e=>d.push(e)));break;case"PAGE_ACTIONS":{const e=i[Z.kQuickCommandsShowPageActions]&&g,t="contentScript"===o?.type,s=Ze.ZP.isActiveExternal(this.context.vivaldiWindowId);if(!e||!t&&m||!s)break;const n=(0,Dz.sh)(p,this.contentScripts);d=[...d,...n];break}case"WORKSPACES":if(A.Z.get(Z.kWorkspacesEnabled)){const e=(0,Dz.fX)(p);d=[...d,...e]}}})),{renderedArray:d,filtering:o}};searchChange=(e,t=-1)=>{this.hasSearchedForFullHistory=!1;const{renderedArray:s,filtering:n}=this.processRenderedArray({qcInputText:e,renderedArray:[]});this.setState({renderedArray:s,filtering:n,quickCommandSearchValue:e},(()=>{-1!==t&&this.refQuickCommandInput.current?.setSelectionRange(t,t),this.performSelection()}))};throttleHistory=e=>(A.Z.get(Z.kQuickCommandsLimitResults)||this.handleHistoryFullSearchTimeout(e),(0,Dz.s1)({searchText:e,today:!0}));onPaste=e=>{const{clipboardData:t}=e;if(t.types[0]!==gm)return;const s=t.getData(gm);s.trim()||e.preventDefault();const{prefValues:n}=this.props,{quickCommandSearchValue:i}=this.state,a=/^(\s*javascript:)+/i;if(n[Z.kAddressBarStripJavascriptOnPaste]){const t=a.test(s),n=a.test(i+s);if(t||n){e.preventDefault();const{selectionEnd:t,selectionStart:n}=e.currentTarget,i=(0,hm.Z)({textToStrip:s,caretPosition:n,selectionEnd:t,currentValue:this.state.quickCommandSearchValue}),a=e.currentTarget.selectionStart+i.length-this.state.quickCommandSearchValue.length;this.searchChange(i,a)}}};getSelectPriority=()=>{const{renderedArray:e,filtering:t,quickCommandSearchValue:s}=this.state,{prefValues:n}=this.props;let i=0;const a=n[Z.kQuickCommandsSearchEnglish];if(t){const{type:s}=t,n=e.findIndex((e=>void 0!==e.selectPriority&&e.type.toLowerCase().includes(s.toLowerCase())));if(n>-1){const t=e[n];return(0,Dz.Jg)(t,n)}}const o=s.toLowerCase(),r=e.findIndex((e=>{const t=e.name.toLowerCase();if(a&&e.labelEnglish){const s=e.labelEnglish.toLowerCase();return o===t||o===s}return o===t}));if(r>-1){const t=e[r];return(0,Dz.Jg)(t,r)}let l=n[Z.kQuickCommandsSearchPriority].length;return e.forEach(((e,t)=>{void 0!==e.selectPriority&&e.selectPriority<l&&(i=t,l=e.selectPriority)})),{priority:l,selectIndex:i}};openBookmark=e=>{const t=this.props.prefValues;if(t[Z.kQuickCommandsMatchNickname]){if(e.folderId)(0,Dz.hV)(this.context.vivaldiWindowId,e.folderId);else if(e.url){const s={inCurrent:!1===t[Z.kQuickCommandsNicknameMatchInNewTab],inBackground:!1,inNewWindow:!1,incognito:!1,transition:re.Z.historyPrivate.TransitionType.AUTO_BOOKMARK};Jn.ZP.openUrls(this.context.vivaldiWindowId,[e.url],s,!1)}this.expireTimeout=setTimeout((()=>{this.props.storeQuickCommandValue(""),this.setState({quickCommandSearchValue:""},(()=>{this.props.onClose()}))}),200)}};performSelection=()=>{const{quickCommandSearchValue:e}=this.state,{renderedArray:t}=this.state;let{priority:s,selectIndex:n}=this.getSelectPriority();const i=t[n],a=this.props.prefValues[Z.kQuickCommandsSearchPriority];if("bookmarkNick"===i.type)this.openBookmark(i);else if(s===a.length){const s=t.findIndex((t=>"history"===t.type&&t.name.toLowerCase().includes(e.toLowerCase())));n=-1!==s?s:0}this.selectByIndex(n),this.hintChange(n),this.qclist?.rerenderVisibleTreeItems()};hintChange=e=>{let t;const{renderedArray:s,filtering:n,quickCommandSearchValue:i}=this.state,a=s[e];let o=i;switch(n&&(o=o.split(":")[1]),a.type){case"url":case"noteAdd":case"search":case"keywordSearch":t="";break;case"commandKeyword":case"command":if(a.value)t="";else{const{name:e}=a,s=(0,Dz.ue)(e,o);t=i+e.substring(s+o.length)}break;case"calculator":if(a.searchString&&a.name){const{searchString:e,name:s}=a;t=e!==s?`${o} = ${s}`:""}break;default:{let e="";const{name:s="",url:n="",nickname:r=""}=a,l=(0,Dz.ue)(s,o),d=n?(0,Dz.ue)(n,o):-1,c=(0,Dz.ue)(r,o);-1!==l?e=s.substring(l+o.length):n&&-1!==d?e=n.substring(d+o.length):-1!==c&&(e=r.substring(c+o.length)),t=i+e}}o.length||"title"!==a.type||(t=x1),this.setState({typeAheadHint:t}),this.qclist.rerenderVisibleTreeItems()};closeTip=()=>{I.Z.set(Z.kQuickCommandsFirstRunTipDismissed,!0)};selectByIndex(e){this.qclist&&this.qclist.selectByIndex(e)}render(){const{renderedArray:e,filtering:t,quickCommandSearchValue:s}=this.state,n=A.Z.get(Z.kWorkspacesEnabled)?m_.Z.getState():[];return(0,zn.jsxs)("div",{className:"quick-command-container",children:[(0,zn.jsxs)("div",{className:"qc-entry",children:[(0,zn.jsx)("input",{tabIndex:"-1",readOnly:!0,ref:this.refQuickCommandHint,className:"quick-command-search-hint",value:this.state.typeAheadHint}),(0,zn.jsx)("input",{type:"search",autoFocus:!0,ref:this.refQuickCommandInput,className:"quick-command-search",onKeyDown:this.onKeyDown,onScroll:()=>y1.nextTick(this.syncOffset),onCompositionStart:this.onCompositionStart,onCompositionEnd:this.onCompositionEnd,value:this.state.quickCommandSearchValue,onChange:this.onSearchChange,onPaste:this.onPaste})]}),!this.props.prefValues[Z.kQuickCommandsFirstRunTipDismissed]&&(0,zn.jsx)("div",{className:"quick-command-tip",children:(0,zn.jsx)(fa,{type:"info",children:(0,zn.jsxs)("div",{className:"quick-command-tip-content",children:[(0,W.Z)("Press $1 or $2 keys with $3 modifier to skip to next search result section. Press $4 key to auto-complete input from current list selection.",[(0,vc.$)("Down"),(0,vc.$)("Up"),(0,vc.$)("Alt"),(0,vc.$)("Right")]),(0,zn.jsx)("span",{className:"close-tip",onClick:this.closeTip,children:O1})]})})}),(0,zn.jsx)(w1,{ref:e=>this.qclist=e,renderedArray:e,onExecuteCommand:this.executeCommand,syncOffset:this.syncOffset,filtering:Boolean(t),setNavigatingList:this.setNavigatingList,searchTerm:s.trim(),hintChange:this.hintChange,workspaces:n})]})}}const L1=(0,zd.Z)(j1,I1),R1=[Z.kKeyboardShortcutsEnable,Z.kKeyboardShortcutsEnableSingleKey];class B1 extends Un.Component{refComboFilter=Un.createRef();state={filter:""};componentDidMount(){this.refComboFilter.current?.focus()}onSettingsFilter=e=>{const t=e.target.value.toLowerCase().replace(/⌘/g,"meta").replace(/⌥/g,"alt").replace(/⇧/g,"shift").replace(/⌃/g,"ctrl");this.setState({filter:t})};onKeyDown=e=>{"Escape"===e.nativeEvent.code&&0===this.refComboFilter.current?.value.length&&(this.props.onClose(),e.stopPropagation(),e.preventDefault())};render(){let e="keystrokes";return this.props.prefValues[Z.kKeyboardShortcutsEnable]?this.props.prefValues[Z.kKeyboardShortcutsEnableSingleKey]||(e+=" singlekeydisabled"):e+=" shortcutsdisabled",(0,zn.jsxs)("div",{className:"keyboardShortcutsWrapper",tabIndex:"0",onKeyDown:this.onKeyDown,children:[(0,zn.jsxs)("header",{children:[(0,zn.jsx)("h1",{id:Ha.t,children:(0,W.Z)("Keyboard Cheat Sheet")}),(0,zn.jsx)("input",{className:"search",ref:this.refComboFilter,type:"search",placeholder:(0,W.Z)("Filter Commands"),onChange:this.onSettingsFilter}),(0,zn.jsx)("button",{className:"close",onClick:this.props.onClose,dangerouslySetInnerHTML:{__html:Kn.kze}})]}),(0,zn.jsx)("div",{className:e,children:(0,zn.jsx)(uP,{filter:this.state.filter,view:"read-only"})})]})}}const F1=(0,zd.Z)(B1,R1),W1=[Z.kThemeUseAnimation];class U1 extends Un.Component{static contextType=oi.Z;state={mediaState:mq.Z.getState().get(this.props.page.id)||(0,qe.l4)()};componentDidMount(){mq.Z.addListener(this._onMediaStateStoreChanged)}componentDidUpdate(e,t){e.page.id!==this.props.page.id&&this._onMediaStateStoreChanged()}componentWillUnmount(){mq.Z.removeListener(this._onMediaStateStoreChanged)}_onMediaStateStoreChanged=()=>{this.setState({mediaState:mq.Z.getState().get(this.props.page.id)||(0,qe.l4)()})};onClickAudio=(e,t,s)=>{if((0,wi.ZP)(e),s.has("pip"))c.ZP.exitPictureInPicture(this.props.page.id);else{const e=s.has("muting")?"unmute":"mute";c.ZP.setMuting(this.context.vivaldiWindowId,"selection",e,qe.aV.of(t))}};selectPage=e=>{(0,wi.ZP)(e),this.props.selectPage?.(this.props.page)};_renderMediaIcon=(e,t)=>!(0===e.size||t.discarded)&&(0,zn.jsx)("span",{className:"tab-audio",onMouseDown:s=>this.onClickAudio(s,t,e),children:(0,zn.jsx)(Jq.Z,{animated:A.Z.get(Z.kThemeUseAnimation),mediaState:e,src:"tab"})});render(){const{page:e,selected:t,listType:s}=this.props,{active:n}=e,{mediaState:i}=this.state,a=vs.jk.getFavicon(e.url);return(0,zn.jsxs)(zn.Fragment,{children:["minimal"===s&&(0,zn.jsxs)("li",{onContextMenu:wi.ZP,onMouseDown:this.selectPage,className:Gn()({"visual-list":!0,selected:t,"active-page":n}),children:[(0,zn.jsx)(Vn.ZP,{className:"visual-tab-list-favicon",url:a||e.url,loadType:a?"faviconFromCache":"page"}),this._renderMediaIcon(i,e),vs.jk.getDisplayTitle(e)]}),"visual"===s&&(0,zn.jsxs)("div",{className:"visual-tab-switcher-title",children:[this._renderMediaIcon(i,e),vs.jk.getDisplayTitle(e)]})]})}}const V1=(0,zd.Z)(U1,W1);var H1=s(71193);const G1=212;class K1 extends Un.PureComponent{static contextType=oi.Z;constructor(e,t){super(e),this.pages=(0,H1.Z)(t.vivaldiWindowId),this.workingPageSet=this.pages.map((e=>({uid:Math.ceil(Math.random()*Math.pow(10,12)),page:e})));const s=this.props.forward?1:-1,n=Ze.ZP.unsafeGetActivePage(t.vivaldiWindowId),i=this.getSelectedPageWithOffset(n,s);this.state={selected:i,offset:s}}getMaxAllowedWidth=()=>this.context.innerWidth-G1;getNumberOfPreviews=()=>{const{pages:e}=this;if(e.size*G1<this.getMaxAllowedWidth())return e.size;let t=1;for(;(t+1)*G1+24<this.getMaxAllowedWidth()&&t<e.size;)t++;return t};getSelectedPageWithOffset=(e,t)=>{const{pages:s}=this;let n=s.indexOf(e)+t;n=(n%s.size+s.size)%s.size;const i=s.get(n);return i||e};cancelEvent=e=>{e.stopPropagation(),e.preventDefault()};navigateWithOffset=e=>{const{document:t}=this.context;this.setState((t=>({selected:this.getSelectedPageWithOffset(t.selected,e),offset:e})),(()=>{const e=t.querySelector(".visual-list.selected");e&&e.scrollIntoViewIfNeeded()}))};selectBack=()=>{this.navigateWithOffset(-1)};selectForward=()=>{this.navigateWithOffset(1)};selectByUid=e=>{const t=this.workingPageSet.find((t=>t.uid===e));t&&this.selectPage(t.page)};selectPage=e=>{this.setState({selected:e})};renderMinimalList=()=>{const{pages:e}=this,{selected:t}=this.state;return(0,zn.jsxs)("div",{className:"tabswitcher list",children:[(0,zn.jsx)("img",{className:Gn()({"visual-list-preview":!0,"active-page":t.active}),src:t.vivExtData.thumbnail,onContextMenu:this.cancelEvent,onMouseDown:()=>this.selectPage(t),title:vs.jk.getDisplayUrlFromMapping(t.url)||vs.jk.getDisplayTitle(t),alt:""}),(0,zn.jsx)("ul",{className:"listed-tabs",children:e.map((e=>{const s=e.id===t.id;return(0,zn.jsx)(V1,{selectPage:this.selectPage,listType:"minimal",page:e,selected:s},"visual-tab-list-"+e.id)}))})]})};renderVisualList=()=>{const{pages:e,workingPageSet:t}=this,{selected:s,offset:n}=this.state,i=this.getNumberOfPreviews(),a=i*G1+24,o=e.indexOf(this.state.selected);let r=t;if(t.size>i){const e=Math.min(Math.max(o-Math.floor(i/2)+(-1!==n||i%2?0:1),0),t.size-i);r=t.reduce(((t,s,n)=>n>=e&&n<e+i?t.push(s):t),(0,qe.aV)())}return(0,zn.jsxs)("div",{className:"tabswitcher",tabIndex:"1",style:{width:a},onContextMenu:this.cancelEvent,children:[(0,zn.jsx)("div",{className:"visual-tabs",children:r.map((e=>{const{page:t,uid:n}=e,{active:i,id:a,url:o}=t,r=vs.jk.getFavicon(t.url);return(0,zn.jsx)("div",{onMouseDown:this.selectByUid.bind(this,n),style:{backgroundImage:`url('${t.vivExtData.thumbnail??""}')`},title:vs.jk.getDisplayTitle(t),className:Gn()({"visual-tab":!0,selected:a===s.id,"active-page":i}),children:(0,zn.jsx)("div",{className:"visual-tab-favicon-container",children:(0,zn.jsx)(Vn.ZP,{className:"visual-tab-favicon",url:r||o,loadType:r?"faviconFromCache":"page"})})},n)}))}),(0,zn.jsx)(V1,{page:s,listType:"visual"})]})};render(){return A.Z.get(Z.kTabsVisualSwitchListLayout)?this.renderMinimalList():this.renderVisualList()}}const z1=K1;const $1=function({windowId:e,workspaceId:t,onClose:s}){const n=m_.Z.getWorkspaceById(t),i=n?.id?cF.Z.getWorkspaceRules(n.id).length:0,a=n?.name??"",o=Ze.ZP.getWorkspacePages(t).size,r=o>0||i>0;return(0,zn.jsxs)("div",{className:"dialog-delete-workspace",children:[(0,zn.jsx)("header",{className:"dialog-header",children:(0,zn.jsx)("h1",{className:"dialog-title",id:Ha.t,children:(0,W.Z)("Delete the “$1” workspace?",[a])})}),r&&(0,zn.jsxs)("div",{className:"dialog-content",children:[o>0&&(0,zn.jsx)("p",{className:"error",children:(0,W.Z)("Deleting the workspace will close the $1 tab inside it.","Deleting the workspace will close the $1 tabs inside it.",[o])}),o>0&&i>0&&(0,zn.jsx)("p",{className:"error",children:(0,W.Z)("It will also delete the $1 link route associated with it.","It will also delete the $1 link routes associated with it.",[i])}),0===o&&i>0&&(0,zn.jsx)("p",{className:"error",children:(0,W.Z)("Deleting the workspace will delete the $1 link route associated with it.","Deleting the workspace will delete the $1 link routes associated with it.",[i])})]}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"button",className:"danger",value:(0,W.Z)("verb","Delete"),onClick:async()=>{await GB.Z.removeWorkspace(e,t),s()}}),(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Cancel"),autoFocus:!0,onClick:s})]})]})};class Y1 extends Un.Component{static contextType=oi.Z;refVisualTabSwitcher=Un.createRef();handleClose=e=>{const{dialog:t,onClose:s}=this.props;return e!==t?Promise.resolve():s()};render(){const{dialog:e,options:t}=this.props;let s,n,i="float",a=!1;switch(e){case"MAIN_SHOW_TAB_CYCLER":i="modal-tabswitcher",n=(0,W.Z)("dialog-title","Tabs");break;case"MAIN_SHOW_QUICKCOMMANDS":i="qc-modal float top no-fade-background",n=(0,W.Z)("Quick Command Prompt");break;case"MAIN_SHOW_KEYBOARDS_SHORTCUTS":i="show-keyboard-shortcuts-modal-top float top no-fade-background",s=Ha.t;break;case"MAIN_SHOW_PAGE_ACCESS_KEYS":i="page-access-keys",s=Ha.t;break;case"MAIN_SHOW_MAIL_ACCOUNT_DIALOG":i="onboarding",n=(0,W.Z)("Mail Account Wizard");break;case"MAIN_SHOW_CALENDAR_ACCOUNT_DIALOG":i="onboarding",n=(0,W.Z)("Calendar Account Wizard");break;case"MAIN_SHOW_CALENDAR_EDIT_EVENT":i="calendar-new",n=(0,W.Z)("New Event");break;case"MAIN_SHOW_CALENDAR_EDIT_TEMPLATE":i="calendar-new",n=(0,W.Z)("Edit Template");break;case"MAIN_SHOW_CREATE_CALENDAR_DIALOG":case"MAIN_SHOW_CALENDAR_IMPORT_EVENTS_DIALOG":i="calendar-new",s=Ha.t;break;case"MAIN_SHOW_ACCOUNT_SHEET":i="slide",n=(0,W.Z)("title","Browser Accounts");break;case"MAIN_SHOW_CALENDAR_ALARM":i=t.fullscreen?"calendar-fullscreen-alarm":"calendar-alarm",s=Ha.t;break;case"MAIN_SHOW_WORKSPACE_DIALOG":i="workspace-new float no-fade-background",s=Ha.t;break;case"MAIN_SHOW_LABEL_FLAG_DIALOG":i="float MailLabelFlagDlg",a=!0;break;case"MAIN_SHOW_DELETE_WORKSPACE":case"MAIN_SHOW_ADD_FEED":case"MAIN_SHOW_MAIL_AUTHENTICATION_DIALOG":case"MAIN_SHOW_MAIL_DELETE_DIALOG_ACCOUNTS":case"MAIN_SHOW_MAIL_DELETE_DIALOG_CONFIRM_ALL":case"MAIN_SHOW_MAIL_DELETE_DIALOG_FOLDERS":case"MAIN_SHOW_MAIL_DELETE_DIALOG_SETTING":case"MAIN_SHOW_MAIL_UNSUBSCRIBE_DIALOG":case"MAIN_SHOW_ADD_MAIL_FOLDER":case"MAIN_SHOW_DELETE_MAIL_FOLDER":case"MAIN_SHOW_ADD_FEED_FOLDER":case"MAIN_SHOW_DELETE_FEED_FOLDER":s=Ha.t;break;case"MAIN_SHOW_NOTE_SELECTION_DIALOG":i="note-selection-dialog",s=Ha.t;break;case"MAIN_SHOW_MODAL_DIALOG":case"MAIN_SHOW_CREATE_LABEL":case"MAIN_SHOW_MODAL_INFO":case"MAIN_SHOW_DELETE_LABEL_CONFIRMATION":case"MAIN_SHOW_DELETE_FILTER_CONFIRMATION":case"MAIN_SHOW_DELETE_FEED_CONFIRMATION":case"MAIN_SHOW_MAIL_VIEW_FILTER_CONFIRMATION":case"MAIN_SHOW_MAIL_UPLOAD_CONFIRMATION":case"MAIN_SHOW_MAIL_MESSAGE_MOVE_CONFIRMATION":case"MAIN_SHOW_MAIL_CREATE_ARCHIVE_FOLDER_CONFIRMATION":case"MAIN_SHOW_ENABLE_WORKSPACE_DIALOG":case"MAIN_SHOW_ENABLE_SESSION_AUTOSAVE_DIALOG":case"MAIN_SHOW_INCLUDE_WORKSPACE_DIALOG":case"MAIN_SHOW_TOOLBAR_RESET":a=!0;break;case"MAIN_SHOW_SHARE_VIVALDI_DIALOG":a=!0,i="float share-vivaldi-dialog"}return(0,zn.jsx)(Kd,{level:"tabs",children:(0,zn.jsxs)(Ha.Z,{onRequestClose:this.handleClose.bind(this,e),className:i,ignoreClickOutside:"MAIN_SHOW_CALENDAR_ALARM"===e||"MAIN_SHOW_SHARE_VIVALDI_DIALOG"===e,labelledBy:s,label:n,a11yIgnored:a,..."MAIN_SHOW_CALENDAR_EDIT_EVENT"===e?{outsideClickIgnoreClass:"Participants-Dropdown"}:{},children:["MAIN_SHOW_QUICKCOMMANDS"===e&&(0,zn.jsx)(L1,{onClose:this.handleClose.bind(this,e),quickCommandValue:this.props.quickCommandValue,storeQuickCommandValue:this.props.storeQuickCommandSearch},"MAIN_SHOW_QUICKCOMMANDS"),"MAIN_SHOW_KEYBOARDS_SHORTCUTS"===e&&(0,zn.jsx)(F1,{onClose:this.handleClose.bind(this,e)},"MAIN_SHOW_KEYBOARDS_SHORTCUTS"),"MAIN_SHOW_PAGE_ACCESS_KEYS"===e&&(0,zn.jsx)(a1,{onClose:this.handleClose.bind(this,e)},"MAIN_SHOW_PAGE_ACCESS_KEYS"),"MAIN_SHOW_TAB_CYCLER"===e&&(0,zn.jsx)(z1,{ref:this.refVisualTabSwitcher,forward:t.forward},"MAIN_SHOW_TAB_CYCLER"),"MAIN_SHOW_CALENDAR_ALARM"===e&&(0,zn.jsx)(S0,{onClose:this.handleClose.bind(this,e),windowToRestore:t.windowToRestore},"MAIN_SHOW_CALENDAR_ALARM"),"MAIN_SHOW_CALENDAR_EDIT_EVENT"===e&&(0,zn.jsx)(h0,{event:t.event,onClose:this.handleClose.bind(this,e)}),"MAIN_SHOW_CALENDAR_EDIT_TEMPLATE"===e&&(0,zn.jsx)(u0,{...t,onClose:this.handleClose.bind(this,e)}),"MAIN_SHOW_CALENDAR_IMPORT_EVENTS_DIALOG"===e&&(0,zn.jsx)(p0,{windowId:this.context.vivaldiWindowId,filePath:t.uri,onClose:this.handleClose.bind(this,e)}),"MAIN_SHOW_CREATE_CALENDAR_DIALOG"===e&&(0,zn.jsx)(P0,{windowId:this.context.vivaldiWindowId,onClose:this.handleClose.bind(this,e)}),"MAIN_SHOW_MAIL_AUTHENTICATION_DIALOG"===e&&(0,zn.jsx)(U0,{onClose:this.handleClose.bind(this,e),options:t}),"MAIN_SHOW_MAIL_DELETE_DIALOG_ACCOUNTS"===e&&(0,zn.jsx)(z0,{windowId:this.context.vivaldiWindowId,onClose:this.handleClose.bind(this,e),options:t}),"MAIN_SHOW_MAIL_DELETE_DIALOG_CONFIRM_ALL"===e&&(0,zn.jsx)($0,{windowId:this.context.vivaldiWindowId,onClose:this.handleClose.bind(this,e),options:t}),"MAIN_SHOW_MAIL_DELETE_DIALOG_FOLDERS"===e&&(0,zn.jsx)(Y0,{windowId:this.context.vivaldiWindowId,onClose:this.handleClose.bind(this,e),options:t}),"MAIN_SHOW_MAIL_DELETE_DIALOG_SETTING"===e&&(0,zn.jsx)(X0,{windowId:this.context.vivaldiWindowId,onClose:this.handleClose.bind(this,e),options:t}),"MAIN_SHOW_MAIL_UNSUBSCRIBE_DIALOG"===e&&(0,zn.jsx)(e1,{onClose:this.handleClose.bind(this,e),options:t}),"MAIN_SHOW_MODAL_DIALOG"===e&&(0,zn.jsx)(g0,{onClose:this.handleClose.bind(this,e),modal:t.modal,resolve:t.resolve}),"MAIN_SHOW_MODAL_INFO"===e&&(0,zn.jsx)($C,{onClose:t=>{this.handleClose(e)},title:t.title,prompt:[t.body],positive:(0,W.Z)("Close"),hideNegative:!0,preventInnerModal:!0}),"MAIN_SHOW_ADD_FEED"===e&&(0,zn.jsx)(rl,{onClose:this.handleClose.bind(this,e),feedsToAdd:t.feeds,widgetId:t.widgetId,dismissable:!0},e),"MAIN_SHOW_ADD_MAIL_FOLDER"===e&&(0,zn.jsx)(l0,{onClose:this.handleClose.bind(this,e),options:t,dismissable:!0},e),"MAIN_SHOW_ADD_FEED_FOLDER"===e&&(0,zn.jsx)(o0,{onClose:this.handleClose.bind(this,e),options:t,dismissable:!0},e),"MAIN_SHOW_CREATE_LABEL"===e&&(0,zn.jsx)(jp,{windowId:this.context.vivaldiWindowId,onClose:this.handleClose.bind(this,e),viewMode:"float"},e),"MAIN_SHOW_LABEL_FLAG_DIALOG"===e&&(0,zn.jsx)(J0,{windowId:this.context.vivaldiWindowId,onClose:this.handleClose.bind(this,e),viewMode:"float"},e),"MAIN_SHOW_DELETE_MAIL_FOLDER"===e&&(0,zn.jsx)(j0,{onClose:this.handleClose.bind(this,e),options:t,dismissable:!0},e),"MAIN_SHOW_DELETE_FEED_FOLDER"===e&&(0,zn.jsx)(D0,{onClose:this.handleClose.bind(this,e),options:t,dismissable:!0},e),"MAIN_SHOW_DELETE_WORKSPACE"===e&&(0,zn.jsx)($1,{windowId:this.context.vivaldiWindowId,workspaceId:t.workspaceId,onClose:this.handleClose.bind(this,e)},e),"MAIN_SHOW_DELETE_LABEL_CONFIRMATION"===e&&E0({dialog:e,handleClose:this.handleClose,label:t.label,callback:t.callback}),"MAIN_SHOW_DELETE_FILTER_CONFIRMATION"===e&&T0({dialog:e,handleClose:this.handleClose,label:t.label,callback:t.callback}),"MAIN_SHOW_DELETE_FEED_CONFIRMATION"===e&&Z0({dialog:e,handleClose:this.handleClose,label:t.label,callback:t.callback}),"MAIN_SHOW_MAIL_VIEW_FILTER_CONFIRMATION"===e&&N0({dialog:e,handleClose:this.handleClose,label:t.label,callback:t.callback}),"MAIN_SHOW_MAIL_UPLOAD_CONFIRMATION"===e&&k0({dialog:e,handleClose:this.handleClose,accountId:t.accountId,callback:t.callback}),"MAIN_SHOW_MAIL_MESSAGE_MOVE_CONFIRMATION"===e&&(0,zn.jsx)($C,{onClose:s=>{t.callback(s),this.handleClose(e)},title:t.title,prompt:[t.body],positive:(0,W.Z)("Move All Messages"),negative:(0,W.Z)("Cancel"),danger:!0,preventInnerModal:!0}),"MAIN_SHOW_MAIL_CREATE_ARCHIVE_FOLDER_CONFIRMATION"===e&&(0,zn.jsx)($C,{onClose:s=>{t.callback(s),this.handleClose(e)},title:t.title,prompt:[t.body],positive:(0,W.Z)("Create Archive Folder"),negative:(0,W.Z)("Cancel"),preventInnerModal:!0}),"MAIN_SHOW_TOOLBAR_RESET"===e&&(0,zn.jsx)($C,{onClose:s=>{t.callback(s),this.handleClose(e)},title:t.title,prompt:[t.body],positive:(0,W.Z)("Reset Toolbar"),negative:(0,W.Z)("Cancel"),preventInnerModal:!0}),"MAIN_SHOW_ACCOUNT_SHEET"===e&&(0,zn.jsx)(rR,{onClose:this.handleClose.bind(this,e),view:t,autoFocus:!0},e),"MAIN_SHOW_MAIL_ACCOUNT_DIALOG"===e&&(0,zn.jsx)(W0,{onClose:this.handleClose.bind(this,e)},e),"MAIN_SHOW_CALENDAR_ACCOUNT_DIALOG"===e&&(0,zn.jsx)(d0,{windowId:this.context.vivaldiWindowId,onClose:this.handleClose.bind(this,e)},e),"MAIN_SHOW_WORKSPACE_DIALOG"===e&&(0,zn.jsx)(YB,{windowId:this.context.vivaldiWindowId,onClose:this.handleClose.bind(this,e),createInBackground:t.createInBackground,withPages:t.withPages}),"MAIN_SHOW_NOTE_SELECTION_DIALOG"===e&&(0,zn.jsx)(s1,{windowId:this.context.vivaldiWindowId,onClose:()=>this.handleClose(e),onSelected:t.onSelected}),"MAIN_SHOW_ENABLE_WORKSPACE_DIALOG"===e&&(0,zn.jsx)(R0,{options:t,onClose:()=>this.handleClose(e)}),"MAIN_SHOW_ENABLE_SESSION_AUTOSAVE_DIALOG"===e&&(0,zn.jsx)(L0,{options:t,onClose:()=>this.handleClose(e)}),"MAIN_SHOW_INCLUDE_WORKSPACE_DIALOG"===e&&(0,zn.jsx)(B0,{options:t,onClose:()=>this.handleClose(e)}),"MAIN_SHOW_SHARE_VIVALDI_DIALOG"===e&&(0,zn.jsx)(Xm,{hidePopup:()=>{this.handleClose(e)},animate:!0})]})})}}const X1=Y1;var Q1=s(18237),q1=s(14022);class J1 extends Un.PureComponent{static contextType=oi.Z;state={dummy:!1};onHistoryClicked=e=>{e.stopPropagation(),this.props.onToggleHistory(this.props.node.id)};render(){const{node:e}=this.props,t=Q1.ZP.isTrashFolder(e.id),s="history"===e.type,n=Q1.ZP.isHistoryParent(e.id);return(0,zn.jsxs)("div",{style:{minHeight:`${this.props.height}px`},className:"SessionItem-Wrapper",title:q1.Z.getTooltipString(e),children:[!t&&!s&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsxs)("div",{className:"SessionItem-Entry",children:[void 0!==this.props.inlineEditText?(0,zn.jsx)("input",{type:"text",value:this.props.inlineEditText,onChange:this.props.onChange,onFocus:this.props.onFocus,onBlur:this.props.onBlur,autoFocus:!0}):(0,zn.jsx)("div",{className:"SessionItem-Title",children:q1.Z.getNameString(e)}),(0,zn.jsx)("div",{className:"SessionItem-Info",children:q1.Z.getContentString(e)}),(0,zn.jsx)("div",{className:"SessionItem-Date",children:q1.Z.getDateModifyString(e)})]}),n&&(0,zn.jsx)("button",{type:"button",className:"ActionButton",onClick:this.onHistoryClicked,title:(0,W.Z)("Show history"),tabIndex:"-1",dangerouslySetInnerHTML:{__html:Kn.yaZ.small}})]}),!t&&s&&(0,zn.jsxs)("div",{className:"SessionItem-Entry",children:[(0,zn.jsx)("div",{className:"SessionItem-Info",children:q1.Z.getContentString(e)}),(0,zn.jsx)("div",{className:"SessionItem-Date",children:q1.Z.getDateModifyString(e)})]}),t&&void 0===this.props.inlineEditText&&(0,zn.jsx)("span",{className:"SessionItem-Title",children:q1.Z.getNameString(e)})]})}}const e3=J1;function t3(e,t){const s=function(e,n){const i={id:e.id,containerId:e.containerId,type:e.type,name:e.name,createDateJS:e.createDateJS,modifyDateJS:e.modifyDateJS,windows:e.windows,tabs:e.tabs,quarantined:e.quarantined,workspaces:e.workspaces,parentId:e.parentId,index:n};if(e.children){if(!t&&"folder"===e.type)return;i.children=e.children.map(((e,t)=>s(e,t))).filter(Boolean)}return i},n=Q1.ZP.getFiltered(e).map(((e,t)=>s(e,t))).filter(Boolean);return 1===n.length&&Q1.ZP.isTrashFolder(n[0].id)&&!n[0].children?.length?[]:n}class s3 extends Un.PureComponent{static contextType=oi.Z;refTreeList=Un.createRef();id=crypto.randomUUID();checkSelection=!0;historyIds=[];constructor(e){super(e),this.state={nodes:t3(e.filter,e.showFolders)}}componentDidMount(){Q1.ZP.addListener(this.onStoreChanged),Q1.ZP.hasSessions()&&this.focusTree(),this.setInitialSelection(),this.reportContentCount()}componentWillUnmount(){Q1.ZP.removeListener(this.onStoreChanged)}componentDidUpdate(e){this.props.filter!==e.filter&&this.setState({nodes:t3(this.props.filter,this.props.showFolders)},(()=>this.reportContentCount()))}onStoreChanged=e=>{switch(e.reason){case"init":this.setState({nodes:t3(this.props.filter,this.props.showFolders)},(()=>this.setInitialSelection()));break;case"added":this.setState({nodes:t3(this.props.filter,this.props.showFolders)},(()=>{e.info&&e.owner===this.id?this.selectById(e.info.item.id):this.setInitialSelection(),this.reportContentCount()}));break;case"changed":case"moved":this.setState({nodes:t3(this.props.filter,this.props.showFolders)});break;case"deleted":this.setState({nodes:t3(this.props.filter,this.props.showFolders)},(()=>{this.state.nodes.length||(this.checkSelection=!0),this.reportContentCount()}))}};setInitialSelection=()=>{this.checkSelection&&this.state.nodes.length>0&&(0===this.getSelected().length&&(this.refTreeList.current?.setSelectedIds([this.state.nodes[0].id]),this.reportSelectionState()),this.checkSelection=!1)};reportContentCount=()=>{this.props.onContentCount&&this.props.onContentCount(this.state.nodes.length)};reportSelectionState=()=>{this.props.onSelectionState&&this.props.onSelectionState(this.getSelected().length>0)};getNodeById=e=>{const t=function(s){for(let n=0;n<s.length;n++){const i=s[n];if(i.id===e)return i;if(i.children){const e=t(i.children);if(e)return e}}};return t(this.state.nodes)};isPanel=()=>!this.props.columns;focusTree=()=>{this.refTreeList.current?.focusTree()};isFolder=e=>"folder"===e.type||this.isHistoryParent(e);isTrashFolder=e=>Q1.ZP.isTrashFolder(e.id);isHistoryParent=e=>"node"===e.type&&Boolean(e.children);isHistoryChild=e=>"history"===e.type;canMoveUpDown=(e,t)=>!this.isTrashFolder(e)&&!this.isHistoryChild(e);hasChildren=e=>this.isFolder(e)&&Boolean(e.children?.length);hasHistoryId=e=>-1!==e.containerId;isValidForEdit=e=>!Q1.ZP.isTrash(e,!0)&&!Q1.ZP.isHistoryChild(e);allowDoubleClick=e=>!this.isFolder(e)||this.isHistoryParent(e);isValidDragSource=e=>!this.isTrashFolder(e);validateForDeletion=e=>e.filter((e=>!Q1.ZP.isTrashFolder(e))).map((e=>this.getNodeById(e))).filter(Boolean).map((e=>e.id));validateForDrag=e=>{const t=e.filter((e=>!Q1.ZP.isTrashFolder(e))).map((e=>this.getNodeById(e))).filter(Boolean),s=t.some((e=>this.hasHistoryId(e))),n=t.some((e=>!this.hasHistoryId(e)));return s&&n||s&&t.some((e=>-1===e.containerId||e.containerId!==t[0].containerId))?[]:t.map((e=>e.id))};getDragData=(e,t)=>{const s=t.map((e=>this.getNodeById(e))).filter(Boolean);switch(e){case"text/plain":case"vivaldi/x-title":{const e=[];return s.forEach((t=>{e.push(t.name)})),e.join("\r\n")}default:return""}};setEventBehavior=(e,t)=>{const s=t.map((e=>this.getNodeById(e))).filter(Boolean);s.some((e=>this.hasHistoryId(e)))?(this.historyIds=s.map((e=>e.containerId)),e.dataTransfer.setData(Q1.iq,JSON.stringify(s.map((e=>e.id))))):(this.historyIds=[],e.dataTransfer.setData(Q1.m8,JSON.stringify(s.map((e=>e.id)))))};getDropSupport=(e,t)=>{let s={available:!1,onto:!1,edge:"both"};return this.isHistoryParent(e)&&t.dataTransfer.types.some((e=>e===Q1.iq))?this.historyIds.some((t=>t!==e.id))?s:{available:!0,onto:!0,edge:"none"}:this.isHistoryChild(e)?t.dataTransfer.types.some((e=>e===Q1.iq))?this.historyIds.some((t=>t!==e.containerId))?s:{available:!0,onto:!1,edge:"both"}:s:t.dataTransfer.types.some((e=>e===Q1.iq))?(this.isTrashFolder(e)?s={available:!0,onto:!0,edge:"none"}:Q1.ZP.isTrash(e.id,!1)?s={available:!0,onto:!1,edge:"both"}:this.historyIds.some((t=>t===e.id))&&(s={available:!0,onto:!0,edge:"none"}),s):(this.isHistoryParent(e)&&this.refTreeList.current?.isExpanded(e.id)&&(s.edge="above"),s.available=t.dataTransfer.types.some((e=>e===Q1.m8)),s.available&&(s.onto=this.isFolder(e)&&!this.isHistoryParent(e)),s)};getTargetSpec=(e,t)=>{const s={index:0,parentId:void 0,pageIndex:void 0};switch(t){case"above":s.index=parseInt(e.index),s.parentId=e.parentId;break;case"on":s.parentId=e.id;break;case"below":this.refTreeList.current&&this.refTreeList.current.isExpanded(e.id)?s.parentId=e.id:(s.index=parseInt(e.index)+1,s.parentId=e.parentId)}return s};handleExpandClick=(e,t)=>{const s=e.altKey;this.refTreeList.current?.toggleSelectedExpansion(t,s)};onMove=(e,t)=>void 0!==t.parentId?gn.Z.move(e,t.parentId,t.index??0):Promise.resolve([]);getMenuCapability=async(e,t,s)=>{const n=this.context.vivaldiWindowId,i=this.refTreeList.current?.getSelectedCount()??0;switch(e.action){case"CONTEXT_OPEN_IN_NEW_WINDOW":return{handler:()=>this.onOpen(!0),isVisible:()=>i>0&&!Q1.ZP.isTrash(s.id,!0),...t(n,e,{})};case"CONTEXT_OPEN":return{handler:()=>this.onOpen(!1),isVisible:()=>i>0&&!fe.ZP.isIncognito(this.context.vivaldiWindowId)&&!Q1.ZP.isTrash(s.id,!0),...t(n,e,{})};case"CONTEXT_UPDATE":return{handler:()=>{const e=this.getSelected().map((e=>e.id));1===e.length&&this.onUpdate(e[0])},isVisible:()=>1===i&&!Q1.ZP.isTrash(s.id,!0)&&!Q1.ZP.isAutoSaveNode(s.id)&&!Q1.ZP.isHistoryChild(s.id),...t(n,e,{})};case"CONTEXT_RESTORE":return{handler:()=>gn.Z.restore(this.getSelected().map((e=>e.id))),isVisible:()=>Q1.ZP.isTrash(s.id,!1)&&!Q1.ZP.isTrashFolder(s.id),...t(n,e,{})};case"CONTEXT_EMPTY_TRASH":return{handler:()=>{gn.Z.emptyTrash()},isVisible:()=>Q1.ZP.isTrashFolder(s.id),...t(n,e,{})};case"CONTEXT_DUPLICATE":return{handler:()=>{gn.Z.duplicate(s.id,Q1.ZP.getRootId(),0,this.id)},isVisible:()=>Q1.ZP.isHistoryChild(s.id),...t(n,e,{})};case"CONTEXT_MOVE_TO_TOP":return{handler:()=>{const e=this.getSelected().map((e=>e.id));1===e.length&&gn.Z.makeContainer(e[0]).then((()=>{this.refTreeList.current?.setSelectedIds([s.parentId])}))},isVisible:()=>1===i&&this.isHistoryChild(s),...t(n,e,{})};case"CONTEXT_AUTOMATIC_BACKUP":return{handler:()=>{"on"===A.Z.get(Z.kSessionsSaveOnExit)?I.Z.set(Z.kSessionsSaveOnExit,"off"):ue.Z.showEnableSessionAutosaveDialog(n,{mode:"size"})},checked:"on"===A.Z.get(Z.kSessionsSaveOnExit),...t(n,e,{})};case"CONTEXT_AUTOSAVE_SIZE":return{handler:()=>{},isVisible:()=>!1,...t(n,e,{})};case"CONTEXT_HISTORY":return{handler:()=>{this.refTreeList.current?.toggleSelectedExpansion(s.id,!1)},isVisible:()=>this.isHistoryParent(s),checked:Boolean(this.refTreeList.current?.isExpanded(s.id)),...t(n,e,{})};default:return{...t(n,e,{})}}};getMenuVisibility=(e,t)=>{const s=this.refTreeList.current?.getSelectedCount()??0;switch(e.action){case"CONTEXT_NEW_ITEM":return!Q1.ZP.isTrash(t.id,!0);case"CONTEXT_RENAME":return 1===s&&this.isValidForEdit(t.id);case"CONTEXT_EDIT":return 1===s&&!this.isTrashFolder(t);case"CONTEXT_DELETE":return s>0&&!Q1.ZP.isTrashFolder(t.id)}return!0};getSelected=()=>(this.refTreeList.current?.getAllSelectedItems()??[]).map((e=>this.getNodeById(e.id))).filter(Boolean);selectById=e=>{this.refTreeList.current?.selectById(e)};onKeyDown=e=>{"Enter"===JS.Z[e.keyCode]&&this.onOpen(!!this.isPanel()||void 0),("Escape"===JS.Z[e.keyCode]||"."===JS.Z[e.keyCode]&&e.metaKey)&&this.props.onClose&&this.props.onClose(),"Up"!==JS.Z[e.keyCode]&&"Down"!==JS.Z[e.keyCode]||this.reportSelectionState()};add=()=>{this.refTreeList.current?.onAdd("item")};onCreate=async(e,t,s,n)=>new Promise((e=>{ue.Z.showSaveSessionDialog(this.context.vivaldiWindowId,{mode:"all",parentId:t??-1,index:s??-1,owner:this.id,onClose:t=>{e()}})}));onUpdate=async e=>new Promise((t=>{ue.Z.showSaveSessionDialog(this.context.vivaldiWindowId,{mode:"all",updateId:e,onClose:e=>{t()}})}));onEdit=()=>{const e=this.getSelected().map((e=>e.id));1===e.length&&this.props.onEdit&&this.props.onEdit(e[0])};deleteSelected=()=>this.refTreeList.current?.onDelete()||Promise.reject();onDelete=e=>gn.Z.remove(e);onOpen=e=>{const t=this.getSelected().filter((e=>!Q1.ZP.isTrash(e.id,!1))).map((e=>e.id));this.props.onOpen(t)};getRowHeight=e=>this.getRowHeightById(e.id??-1);getRowHeightById=e=>Q1.ZP.isTrashFolder(e)?Ti():Q1.ZP.isHistoryChild(e)?46:70;getRowComponentProps=e=>({...e,columns:this.props.columns??[]});rowComponent=e=>{const t=e.node,s=Q1.ZP.isTrashFolder(t.id),n=Q1.ZP.isTrash(t.id,!1),i=this.hasHistoryId(t),a=e.level,o=(a+1)*Ni+"px",r=a*Ni+"px";return this.isPanel()?(0,zn.jsxs)("div",{className:Gn()("SessionItem",{"SessionItem-Trash":s,"SessionItem-Trashed":n}),children:[s&&this.hasChildren(t)&&(0,zn.jsx)("span",{className:"expand-icon",style:{marginLeft:r},onMouseUp:e=>this.handleExpandClick(e,t.id),dangerouslySetInnerHTML:{__html:Kn.nfH}}),s&&(0,zn.jsx)(qn,{trash:!0,open:e.isExpanded,leftMargin:this.hasChildren(t)?0:o}),(n||i)&&(0,zn.jsx)("span",{style:{marginLeft:r},className:"tree-icon"}),(0,zn.jsx)(e3,{node:t,height:this.getRowHeightById(t.id),inlineEditText:e.inlineEditText,onChange:e.onChange,onFocus:e.onFocus,onBlur:e.onBlur,onToggleHistory:e=>{this.refTreeList.current?.toggleSelectedExpansion(e,!1)}})]},t.id):s?null:(this.props.columns??[]).map((e=>{switch(e.id){case"name":return(0,zn.jsx)("label",{children:(0,zn.jsx)("span",{children:q1.Z.getNameString(t)})},"0");case"createDateJS":return(0,zn.jsx)("label",{children:(0,zn.jsx)("span",{children:q1.Z.getDateCreateString(t)})},"1");case"modifyDateJS":return(0,zn.jsx)("label",{children:(0,zn.jsx)("span",{children:q1.Z.getDateModifyString(t)})},"2");case"tabs":return(0,zn.jsx)("label",{children:(0,zn.jsx)("span",{children:q1.Z.getContentString(t)})},"3");default:console.warn("Unknown sorting field:",e.id)}})).filter(Boolean)};onItemDoubleClick=()=>this.onOpen(!!this.isPanel()||void 0);onItemsActivated=()=>this.onOpen(!!this.isPanel()||void 0);menu={name:"sessionlist",getCapability:this.getMenuCapability,getVisibility:this.getMenuVisibility};render(){return(0,zn.jsx)(Mi,{ref:this.refTreeList,rootId:Q1.ZP.getRootId(),nodes:this.state.nodes,settings:this.isPanel()?"SETTINGS_TREE":void 0,rowComponent:this.rowComponent,getRowComponentProps:this.getRowComponentProps,overrideDoubleClick:this.allowDoubleClick,onItemMouseDown:this.reportSelectionState,onItemDoubleClick:this.onItemDoubleClick,onItemsActivated:this.onItemsActivated,onMove:this.onMove,onKeyDown:this.onKeyDown,onCreate:this.onCreate,onEdit:this.onEdit,delete:this.isPanel()?this.onDelete:void 0,isFolder:this.isFolder,isTrashFolder:this.isTrashFolder,hasChildren:this.hasChildren,supportsUpDownMove:this.canMoveUpDown,getTitle:Q1.ZP.getTitle,saveTitle:gn.Z.setTitle,disableClipboard:!0,isValidToEdit:this.isValidForEdit,isValidDragSource:this.isValidDragSource,validateForDeletion:this.validateForDeletion,validateForDrag:this.validateForDrag,mimeType:Q1.m8,setCustomEventBehavior:this.setEventBehavior,getDragData:this.getDragData,getDropSupport:this.getDropSupport,getTargetSpec:this.getTargetSpec,menu:this.isPanel()?this.menu:void 0,supportsInlineEdit:!0,sorting:this.props.sorting,columns:this.props.columns,rowHeight:this.isPanel()?this.getRowHeight:void 0})}}const n3=s3,i3=[Z.kSessionsDialogSorting,Z.kKeyboardTabToAll],a3={width:800,minWidth:"unset"},o3=[{text:(0,W.Z)("title","Name"),value:"name",fullScreenTitle:(0,W.Z)("Sort by Name"),width:350,visible:!0,key:!0},{text:(0,W.Z)("Creation Date"),value:"createDateJS",fullScreenTitle:(0,W.Z)("Sort by Creation Date"),width:260,visible:!0},{text:(0,W.Z)("Modified Date"),value:"modifyDateJS",fullScreenTitle:(0,W.Z)("Sort by Modifcation Date"),width:260,visible:!1},{text:(0,W.Z)("Info"),value:"tabs",fullScreenTitle:(0,W.Z)("Sort by Info"),width:150,visible:!0}];class r3 extends Un.Component{static contextType=oi.Z;refSessionTree=Un.createRef();constructor(e){super(e);const t=this.props.prefValues[Z.kSessionsDialogSorting];this.state={columns:xi().sessions||Ii(o3),hasSelection:!1,hasContent:!0,sorting:{sortOrder:t.sortOrder,sortField:t.sortField,comparator:this.sortComparator}}}sortComparator=(e,t)=>{const{sortOrder:s,sortField:n}=this.state.sorting;return ui.Z.getDefaultComparator(s,n)(e,t)};getSelected=()=>this.refSessionTree.current?.getSelected()??[];onContentCount=e=>{this.setState({hasContent:e>0})};onSelectionState=e=>{this.setState({hasSelection:e})};onDelete=()=>{gn.Z.remove(this.getSelected().map((e=>e.id)))};onOpen=e=>{gn.Z.open(this.context.vivaldiWindowId,e,!0),this.props.onClose()};onSortChange=(e,t)=>{this.setState((s=>({sorting:{sortOrder:e,sortField:t,comparator:s.sorting.comparator}}))),I.Z.set(Z.kSessionsDialogSorting,{sortOrder:e,sortField:t})};onUpdateRow=e=>{this.setState({columns:e})};onSaveRow=()=>{yi(this.state.columns,"sessions")};render(){return(0,zn.jsx)(Ha.Z,{onRequestClose:this.props.onClose,style:a3,title:(0,W.Z)("Open Session"),children:(0,zn.jsx)("div",{className:"open-session",children:(0,zn.jsxs)("form",{className:"dialog-session",onSubmit:()=>{this.onOpen(this.getSelected().map((e=>e.id)))},children:[(0,zn.jsx)("div",{className:"dialog-content",children:this.state.hasContent?(0,zn.jsxs)("div",{className:"session-list",children:[(0,zn.jsx)(Bu,{fields:o3,fullsize:!0,onSortChange:this.onSortChange,onSaveRow:this.onSaveRow,onUpdateRow:this.onUpdateRow,columns:this.state.columns,sortField:this.state.sorting.sortField,sortOrder:this.state.sorting.sortOrder,keyAccess:this.props.prefValues[Z.kKeyboardTabToAll],manualSorting:!1}),(0,zn.jsx)(n3,{ref:this.refSessionTree,filter:"",showFolders:!1,columns:this.state.columns,sorting:this.state.sorting,onOpen:this.onOpen,onClose:this.props.onClose,onContentCount:this.onContentCount,onSelectionState:this.onSelectionState})]}):(0,zn.jsx)("div",{children:(0,W.Z)("No saved session.")})}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"submit",disabled:!this.state.hasSelection,value:(0,W.Z)("session","Open")}),(0,zn.jsx)("input",{type:"button",onClick:this.props.onClose,value:(0,W.Z)("session","Cancel")})]})]})})})}}const l3=(0,zd.Z)(r3,i3);var d3=s(34155);const c3=[Z.kBookmarksPanelEditorHeight],h3=[{text:(0,W.Z)("Title"),value:"title",fullScreenTitle:(0,W.Z)("Sort by Title")},{text:(0,W.Z)("Address"),value:"url",fullScreenTitle:(0,W.Z)("Sort by Address")},{text:(0,W.Z)("Nickname"),value:"nickname",fullScreenTitle:(0,W.Z)("Sort by Nickname")},{text:(0,W.Z)("Description"),value:"description",fullScreenTitle:(0,W.Z)("Sort by Description")},{text:(0,W.Z)("Created"),value:"dateAdded",fullScreenTitle:(0,W.Z)("Sort by Date Created")}];class u3 extends Un.PureComponent{static contextType=oi.Z;nodeRef=Un.createRef();#Bs=Un.createRef();#Fs=Un.createRef();state={filter:"",editorHeight:this.props.prefValues[Z.kBookmarksPanelEditorHeight],failedUpgrade:!1,sorting:{sortOrder:ui.Z.NO_SORTING,sortField:"manually",comparator:this.sortComparator},hasBookmark:!0};componentDidMount(){const e=A.Z.get(Z.kBookmarksPanelSorting);this.onSortChange(e.sortOrder,e.sortField),tn.ZP.addListener(this.onPanelStoreChange),g.Z.addListener(this.onBookmarkStoreChange)}componentWillUnmount(){tn.ZP.removeListener(this.onPanelStoreChange),g.Z.removeListener(this.onBookmarkStoreChange)}componentDidUpdate(e,t){!e.open&&this.props.open&&d3.nextTick((()=>this.focusTree()))}hasFocus=()=>{const{document:e,HTMLElement:t}=this.context,s=this.nodeRef.current;return s instanceof t&&(0,vo.sT)(e,s)};onPanelStoreChange=()=>{const e=tn.ZP.getChangeReason();this.props.open&&"setFocus"===e&&!this.hasFocus()&&this.focusTree()};onBookmarkStoreChange=()=>{this.setState({failedUpgrade:g.Z.isFailedUpgrade()})};onSelect=e=>{this.#Bs.current?.setItem(e)};addBookmark=()=>{this.onAdd(!1)};addFolder=()=>{this.onAdd(!0)};onAdd=e=>{this.state.editorHeight>u.mT&&this.#Bs.current?this.#Bs.current._save().then((()=>this.#Fs.current?.onAdd(e))):this.#Fs.current?.onAdd(e)};onCreate=e=>{e&&this.setState({filter:""},(()=>{this.setEditorVisible(),this.#Bs.current&&this.#Bs.current.setIsCreating(!0),this.onSelect(this.getSelectedItem())}))};onEditorCanceled=(e,t)=>{t&&e&&this.#Fs.current?this.#Fs.current.deleteSelectedItems()?.then((()=>{n.Z.bookmarks.remove(e),this.focusTree()})):this.focusTree()};setEditorVisible=()=>{const e=this.state.editorHeight<230?Math.max(this.props.prefValues[Z.kBookmarksPanelEditorHeight],230):this.state.editorHeight;this.updateEditorVisiblityWithHeight(e,!0)};focusTree=()=>{this.#Fs.current?.refTreeList.current?.focusTree()};deleteSelectedItems=()=>{this.#Fs.current?.deleteSelectedItems()};onSortChange=(e,t)=>{const s={sortOrder:e,sortField:t,comparator:this.sortComparator};this.setState({sorting:s});const n={sortOrder:e,sortField:t};I.Z.set(Z.kBookmarksPanelSorting,n)};sortComparator=(e,t)=>g.Z.treeSortComparator(e,t,this.state.sorting);getSelectedItem=()=>this.#Fs.current?.getSelectedItem();onContextMenu=e=>{e.nativeEvent.buttons>0&&this.#Fs.current?.unSelectAll(),this.#Fs.current?.onContextMenu(e)};onSearchChange=e=>{this.setState({filter:e.target.value})};onSlidebarPosition=(e,t)=>{this.setState((e=>({editorHeight:Math.max(Math.min(e.editorHeight-t,600),u.mT)})))};onSlideBarStop=()=>{this.updateEditorVisiblityWithHeight(this.state.editorHeight,!0)};onSlidebarToggle=()=>{const e=this.state.editorHeight>u.Cn?u.mT:230;this.updateEditorVisiblityWithHeight(e,!0)};updateEditorVisiblityWithHeight=(e,t)=>{e<u.Cn?e=u.mT:e>600&&(e=600),t&&I.Z.set(Z.kBookmarksPanelEditorHeight,e),this.setState({editorHeight:e})};renderEmptyState=()=>(0,zn.jsxs)("div",{className:"panel-empty-state",children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.Zgq}}),(0,zn.jsx)("h1",{children:(0,W.Z)("Add your first bookmark")}),(0,zn.jsx)("p",{className:"faded-text",children:(0,W.Z)("Click the “+” button to add a new bookmark.")})]});render(){if(!this.props.open)return null;const e=this.props.title+(this.state.failedUpgrade?" (needs upgrade)":"");return(0,zn.jsxs)("div",{ref:this.nodeRef,className:"panel panel-bookmarks",children:[(0,zn.jsxs)("header",{children:[(0,zn.jsx)(Cu,{title:e,showCloseButton:this.props.showCloseButton}),(0,zn.jsxs)("div",{className:"toolbar toolbar-default toolbar-wrap",role:"toolbar","aria-label":(0,W.Z)("toolbar label","Bookmarks"),children:[(0,zn.jsx)("input",{type:"search",placeholder:(0,W.Z)("verb","Search"),value:this.state.filter,disabled:!this.state.hasBookmark,onChange:this.onSearchChange}),(0,zn.jsxs)("div",{className:"toolbar",children:[(0,zn.jsxs)("div",{className:"toolbar-group",children:[(0,zn.jsx)(oa.ZP,{onClick:this.addBookmark,tooltip:(0,W.Z)("New Bookmark"),image:Kn.md4.small}),(0,zn.jsx)(oa.ZP,{onClick:this.deleteSelectedItems,tooltip:(0,W.Z)("other","Delete"),image:Kn.M2k.small})]}),(0,zn.jsx)(oa.ZP,{onClick:this.addFolder,tooltip:(0,W.Z)("command","New Folder"),image:Kn._TQ.small})]})]})]}),!this.state.hasBookmark&&this.renderEmptyState(),this.state.hasBookmark&&(0,zn.jsx)(Bu,{fields:h3,onSortChange:this.onSortChange,keyAccess:this.props.keyAccess,sortField:this.state.sorting.sortField,sortOrder:this.state.sorting.sortOrder}),(0,zn.jsx)("section",{onContextMenu:this.onContextMenu,className:"panel-bookmarks-tree "+(this.state.hasBookmark?"outerScrollbar":"hide-bookmark-tree"),children:(0,zn.jsx)(eH,{ref:this.#Fs,filter:this.state.filter,fullView:!1,inManager:!1,onSelect:this.onSelect,onCreate:this.onCreate,sorting:this.state.sorting,onBookmarksUpdatedIsEmpty:e=>this.setState({hasBookmark:e})})}),this.state.hasBookmark&&(0,zn.jsxs)("section",{className:Gn()("panel-bookmarks-edit","outerScrollbar",{collapsed:this.state.editorHeight===u.mT}),style:{flexBasis:this.state.editorHeight},children:[(0,zn.jsx)(Mu.Z,{onStop:this.onSlideBarStop,onSlidebarPosition:this.onSlidebarPosition,onDoubleClick:this.onSlidebarToggle,returnOffset:!0,position:"bottom"}),this.state.editorHeight>0&&(0,zn.jsx)(LV,{ref:this.#Bs,getSelectedItem:this.getSelectedItem,onCancel:this.onEditorCanceled,onFocusTree:this.focusTree})]})]})}}const p3=(0,zd.Z)(u3,c3);const g3=function(e){const t=e.date.clone(),s=new Date,n=s.getFullYear(),i=s.getMonth(),a=s.getDate(),o=e.date.year(),r=e.date.month(),l=e.date.week(),d=e.date.date();t.startOf("month").subtract(1,"week").startOf("week");const c=[];for(;c.length<7;){const e=t.format("dd");c.push((0,zn.jsx)("div",{className:"MonthDayPicker-DayOfWeek",children:e},e)),t.add(1,"day")}const h=e.date.clone().endOf("month");for(;t.isSameOrBefore(h)||0!==t.weekday();){const s=t.date()===a&&t.month()===i&&t.year()===n,h=t.date()===d&&t.month()===r&&t.year()===o,u=t.week()===l&&t.year()===o,p=t.clone();c.push((0,zn.jsx)("div",{className:Gn()("MonthDayPicker-Day",{"MonthDayPicker-Day--Current":s,"MonthDayPicker-Day--Selected":h,"MonthDayPicker-Day--SelectedWeek":u&&!h&&!s,"MonthDayPicker-Day--OtherMonth":t.month()!==i}),onClick:()=>TZ.Z.selectDate(e.pageId,p),children:t.date()},t.format("M-D"))),t.add(1,"day")}return(0,zn.jsxs)("div",{className:"MonthDayPicker",children:[(0,zn.jsxs)("header",{className:"MonthDayPicker-Header",children:[(0,zn.jsxs)("div",{className:"toolbar-group",children:[(0,zn.jsx)(oa.ZP,{className:"button-narrow button-transparent",onClick:()=>function(e,t){TZ.Z.selectDate(e,t.clone().subtract(1,"month"))}(e.pageId,e.date),tooltip:(0,W.Z)("Previous"),image:Kn.mgF.small}),(0,zn.jsx)(oa.ZP,{className:"button-narrow button-transparent",onClick:()=>function(e,t){TZ.Z.selectDate(e,t.clone().add(1,"month"))}(e.pageId,e.date),tooltip:(0,W.Z)("Next"),image:Kn.Zu.small})]}),(0,zn.jsx)("h2",{className:"MonthDayPicker-Month",children:e.date.format("MMMM YYYY")})]}),c]})},m3=[Z.kCalendarDisplayDensity,Z.kCalendarOnboardingShown,Z.kCalendarPanelCalendarHeight],f3=hH.G6;let v3=!1;const b3=()=>TZ.Z.viewPreviousPeriod(f3),C3=()=>TZ.Z.viewNextPeriod(f3);function w3(e){TZ.Z.selectDate(f3,e)}function y3(){TZ.Z.selectToday(f3)}function x3(){TZ.Z.setViewMode(f3,"day")}function I3(){TZ.Z.setViewMode(f3,"week")}function A3(){TZ.Z.setViewMode(f3,"agenda")}function S3(e){return(0,zn.jsxs)("div",{className:"panel-empty-state",children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.VA7}}),(0,zn.jsx)("h1",{children:(0,W.Z)("Add your first calendar account")}),(0,zn.jsx)("p",{className:"faded-text",children:(0,W.Z)("You can add a local or online calendar to Vivaldi Calendar.")}),(0,zn.jsx)("input",{type:"button",onClick:()=>ue.Z.showCalendarAccountDialog(e.windowId),value:(0,W.Z)("Add Calendar Account")})]})}function Z3(e){return(0,zn.jsxs)("div",{className:"panel-empty-state",onClick:e.onCreateEvent,children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.VA7}}),(0,zn.jsx)("h1",{children:(0,W.Z)("Your calendar is empty")}),(0,zn.jsx)("p",{className:"faded-text",children:(0,W.Z)("Click the “+” button to add a new event.")})]})}function T3(e){const t=Un.useContext(oi.Z),{stateHandler:s,calendarFilter:n,eventDraft:i,events:a,trashedEvents:o}=cH(f3),r=(0,Eo.Z)(m3),l=r[Z.kCalendarPanelCalendarHeight]||u.mT,[d,c]=Un.useState(!1),[h,p]=Un.useState(l);Un.useEffect((()=>p(l)),[l]);const g=Un.useMemo((()=>({pageId:f3,displayDensity:r[Z.kCalendarDisplayDensity],isPanel:!0,isEditing:!!i,isWidget:!1,handler:s})),[r,s,i]),m=Un.useCallback((()=>{ue.Z.showCalendar(t.vivaldiWindowId)}),[t.vivaldiWindowId]),{editEvent:f}=s,v=Un.useCallback((()=>{f(null,_r.ZP.minimalCreateEvent({}))}),[f]);if(!e.open)return v3=!1,null;function b(){A&&TZ.Z.search(f3,""),c(!1)}function C(e){const t=Pr.Z.getEvent(e);t&&TZ.Z.selectEvent(f3,{event:t,allDay:t.allDay})}!1===v3&&e.open&&(ie.ZP.pollAllCalDAVAccounts({throttle:!0}),v3=!0);const{anchorDate:w,selectedDate:y,displayMode:x,filterText:A}=n,S=_r.ZP.getDisplayRange(w,x),T=0===Pr.Z.getCalendars().length||!r[Z.kCalendarOnboardingShown]&&0===Pr.Z.getEvents().length&&!Pr.Z.getAccounts().some((e=>"local"!==e.account_type)),E=!i&&!Pr.Z.getEvents().length;d&&!A&&b();const k=!!A&&(["agenda","year"].includes(x)?0===a.length:a.every((e=>!0===e.filteredOut))),N=!d&&k&&!E;return(0,zn.jsx)("div",{className:"panel",id:"calendar_panel",onClick:function(e){e.stopPropagation(),i&&s.endEventEdit()},children:(0,zn.jsxs)(WS.Provider,{value:g,children:[(0,zn.jsxs)("header",{children:[(0,zn.jsx)(Cu,{title:(0,W.Z)("Calendar"),showCloseButton:e.showCloseButton}),!T&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("div",{className:"toolbar toolbar-default",role:"toolbar","aria-label":(0,W.Z)("toolbar label","Calendar"),children:(0,zn.jsx)(MH,{filterText:A,onSearchChange:function(e){TZ.Z.search(f3,e)},onSelectEvent:C,onShowSearchResults:function(){c(!0)}})}),(0,zn.jsxs)("div",{className:"toolbar toolbar-default",children:[(0,zn.jsx)(jH,{initialPeriod:w,setPeriod:w3,startDate:S.start,endDate:S.end,displayMode:x,inPanel:!0}),(0,zn.jsxs)("div",{className:"toolbar-group",style:{marginLeft:"auto"},children:[(0,zn.jsx)(oa.ZP,{className:"button-narrow",onClick:b3,tooltip:(0,W.Z)("Previous"),image:Kn.mgF.small}),(0,zn.jsx)(oa.ZP,{onClick:y3,disabled:!!y&&(0,Kc.KC)(y.toDate(),new Date),title:(0,W.Z)("calendar","Today")}),(0,zn.jsx)(oa.ZP,{className:"button-narrow",onClick:C3,tooltip:(0,W.Z)("Next"),image:Kn.Zu.small})]})]}),(0,zn.jsxs)("div",{className:"toolbar toolbar-default toolbar-wrap",role:"toolbar","aria-label":(0,W.Z)("toolbar label","Display Period"),children:[(0,zn.jsxs)("div",{className:"toolbar-group",style:{marginRight:"auto"},children:[(0,zn.jsx)(oa.ZP,{onClick:x3,title:(0,W.Z)("Day"),isPressed:"day"===x}),(0,zn.jsx)(oa.ZP,{onClick:I3,title:(0,W.Z)("Week"),isPressed:"week"===x}),(0,zn.jsx)(oa.ZP,{onClick:A3,title:(0,W.Z)("Agenda"),isPressed:"agenda"===x})]}),(0,zn.jsx)(oa.ZP,{className:"left-gap",onClick:m,tooltip:(0,W.Z)("Open Calendar in Tab"),label:(0,W.Z)("Open Calendar"),image:Kn.bcq.small,commandId:"COMMAND_SHOW_CALENDAR"}),(0,zn.jsx)(oa.ZP,{onClick:v,tooltip:(0,W.Z)("title","Create New Event"),image:Kn.md4.small})]})]})]}),T&&(0,zn.jsx)(S3,{windowId:t.vivaldiWindowId}),!T&&E&&(0,zn.jsx)(Z3,{onCreateEvent:v}),N&&(0,zn.jsx)(fa,{type:"info",children:(0,W.Z)("Showing filtered results. Press “Search” for full results.")}),!E&&!d&&(0,zn.jsx)(gE,{filter:n,events:a,trashedEvents:o,editingEvent:i}),d&&(0,zn.jsx)(vH,{selectedEvent:n.selectedEvent,onSelectEvent:C,filterText:A,onClose:b,editingEvent:i}),(0,zn.jsxs)("div",{className:Gn()("CalendarPanel-MiniCalendar",{collapsed:h<=u.mT}),style:{height:Math.abs(be.yn-h)>10?h:be.yn},children:[(0,zn.jsx)(Mu.Z,{onSlidebarPosition:function(e,t){p((e=>e-t))},onStop:function(){p((e=>{let t=e;return t<=u.Cn&&(t=u.mT),I.Z.set(Z.kCalendarPanelCalendarHeight,t),t}))},onDoubleClick:function(){p((e=>{let t=e;return t=t>u.Cn?u.mT:be.yn,I.Z.set(Z.kCalendarPanelCalendarHeight,t),t}))},returnOffset:!0,position:"bottom"}),h>=u.mT&&(0,zn.jsx)(g3,{date:n.selectedDate??n.anchorDate,pageId:f3})]})]})})}const E3=Un.memo(T3);var k3=s(92521);const N3=[{text:(0,W.Z)("other","Name"),value:"name",fullScreenTitle:(0,W.Z)("Sort by Name")}];class _3 extends Un.PureComponent{refTreeList=Un.createRef();static contextType=oi.Z;winId=this.context.vivaldiWindowId;state={sorting:A.Z.get(Z.kContactPanelSorting)};onSortChange=(e,t)=>{const s={sortOrder:e,sortField:t};this.setState({sorting:s}),I.Z.set(Z.kContactPanelSorting,{sortOrder:e,sortField:t})};sortComparator=(e,t)=>{if(e.trash)return 1;if(t.trash)return-1;if(this.isFolder(e)&&!this.isFolder(t))return-1;if(this.isFolder(t)&&!this.isFolder(e))return 1;const s=e=>e.emailAddresses&&e.emailAddresses.length>0?e.emailAddresses[0].emailAddress:"";e.name||(e.name=s(e)),t.name||(t.name=s(t));const{sortOrder:n,sortField:i}=this.state.sorting;return ui.Z.getDefaultComparator(n,i)(e,t)};getSelectedIds=()=>(this.refTreeList.current?.getAllSelectedItems()||[]).map((e=>e.id));getSelectedItems=()=>{const e=[];for(const t of this.getSelectedIds()){const s=ml.Z.getNodeById(t);s&&e.push(s)}return e};getSelectedItem=()=>this.refTreeList.current?.getSelectedItem();getNodeName=e=>e.name?e.name:e.emailAddresses&&e.emailAddresses.length>0?e.emailAddresses[0].emailAddress:"";isFolder=iy.Z;hasChildren=e=>!!e.children&&e.children.length>0;unSelectAll=()=>{this.refTreeList.current?.unSelectAll()};deleteSelected=()=>{this.refTreeList.current?.onDelete()};deleteByIds=e=>{this.refTreeList.current?.onDeleteItems(e)};validateForEdit=k3.Z;isValidAddTarget=k3.Z;getTitle=e=>{if("string"==typeof e){const t=ml.Z.getNodeById(e);return t?this.getNodeName(t):""}return""};saveTitle=(e,t)=>{const s=ml.Z.getNodeById(e);s&&(s.name=t,o.Z.updateContact(s))};onAdd=e=>{this.refTreeList.current?.onAdd(e?"folder":"item")};getMenuCapability=async(e,t,s)=>{const n=this.winId;switch(e.action){case"CONTEXT_COMPOSE_MAIL":return{handler:this.compose,isVisible:()=>Boolean(s),...t(n,e,{})};case"CONTEXT_VIEW_ALL_MESSAGES":return{handler:this.viewAll,isVisible:()=>Boolean(s),...t(n,e,{})};case"CONTEXT_CONTAINER_DEFAULT_ACTION":{const s=this.props.prefValues[Z.kMailContactDefaultAction];return{items:[{type:"radio",radiogroup:1,checked:"compose"===s,handler:()=>this.setDefaultAction("compose"),...(0,fi.Z)("Compose")},{type:"radio",radiogroup:1,checked:"viewAllMessages"===s,handler:()=>this.setDefaultAction("viewAllMessages"),...(0,fi.Z)("View All Messages")}],...t(n,e,{})}}default:return{...t(n,e,{})}}};getMenuVisibility=(e,t)=>{if(!t)return"CONTEXT_NEW_ITEM"===e.action;switch(e.action){case"CONTEXT_NEW_ITEM":case"CONTEXT_EDIT":case"CONTEXT_DELETE":return!0;default:return!1}};onContextMenu=e=>{this.refTreeList.current?.onContextMenu(e)};setDefaultAction=e=>{I.Z.set(Z.kMailContactDefaultAction,e)};onDoubleClick=e=>{0!==e.button||this.props.prefValues[Z.kMailSingleClickTabs]||this.openTabForSelectedNode()};onNodeMouseDown=(e,t)=>{this.props.focusTree(),0===t.button&&this.props.prefValues[Z.kMailSingleClickTabs]&&this.openTabForSelectedNode()};openTabForSelectedNode=()=>{const e=this.props.prefValues[Z.kMailContactDefaultAction];"compose"===e?this.compose():"viewAllMessages"===e&&this.viewAll()};compose=()=>{const e=this.getSelectedItems();if(e&&e.length>0){const t=e.flatMap((e=>e.emailAddresses)).map((({emailAddress:e})=>({address:e})));ns.Z.createDraft({to:t})}};viewAll=()=>{const e=this.getSelectedItems();if(e&&e.length>0){const t=this.context.vivaldiWindowId;o.Z.selectContact(e[0]),d.Z.selectContactById(t,e[0].id),c.ZP.openURL(t,vs.jk.internals.mailpage,{singleton:!0})}};rowComponent=e=>{const t=e.node,s=t?this.getNodeName(t):"";return(0,zn.jsxs)("label",{tabIndex:"-1",children:[(0,zn.jsx)("span",{className:"tree-row-image",children:(0,zn.jsx)("img",{src:t.avatarUrl?t.avatarUrl:xx.g,alt:""})}),(0,zn.jsx)("span",{className:"title",title:s,children:s})]},`contact__list__${t.id}`)};selectById=e=>{this.refTreeList.current?.selectById(e)};menu={name:"contactlist",getCapability:this.getMenuCapability,getVisibility:this.getMenuVisibility};render(){const e={sortOrder:this.state.sorting.sortOrder,sortField:this.state.sorting.sortField,comparator:this.sortComparator};return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)(Bu,{fields:N3,manualSorting:!1,onSortChange:this.onSortChange,keyAccess:this.props.keyAccess,compact:!0,sortField:this.state.sorting.sortField,sortOrder:this.state.sorting.sortOrder}),(0,zn.jsx)("section",{className:"outerScrollbar",children:(0,zn.jsx)(Mi,{ref:this.refTreeList,settings:"CONTACT_TREE",rowComponent:this.rowComponent,nodes:this.props.nodes,menu:this.menu,delete:o.Z.deleteContactsByIds,enableDragAndDrop:!1,isFolder:this.isFolder,hasChildren:this.hasChildren,supportsInlineEdit:!1,isValidToEdit:iy.Z,getTitle:this.getTitle,saveTitle:this.saveTitle,isValidAddTarget:this.isValidAddTarget,sorting:e,onSelect:this.props.onItemSelected,onItemMouseDown:this.onNodeMouseDown,onCreate:this.props.onCreate,onEdit:this.props.onEdit,onItemsActivated:this.openTabForSelectedNode,onItemDoubleClick:this.onDoubleClick})})]})}}const P3=_3,M3=256,D3=["../resources/contact-person.png","../resources/contact-company.png"];class O3 extends Un.PureComponent{static contextType=oi.Z;nodeRef=Un.createRef();refPhotoPicker=Un.createRef();state={drawerOpen:!1,isDropTarget:!1,initialPhoto:"",id:""};componentDidUpdate(e,t){const s=this.props.id;s&&s!==e.id&&this.setState({initialPhoto:this.props.photo,id:s}),!0===t.drawerOpen&&!1===this.state.drawerOpen?this.props.disableOnClickOutside?.():!1===t.drawerOpen&&!0===this.state.drawerOpen&&this.props.enableOnClickOutside()}getNode(){return this.nodeRef.current}onToggleOverlay=()=>{this.setState((e=>({drawerOpen:!e.drawerOpen})))};handleClickOutside=()=>{this.setState({drawerOpen:!1})};photoChange=()=>{this.refPhotoPicker.current?.click()};setContactPhoto=e=>{if(e.target.files&&e.target.files.length>0){var t=e.target.files[0],s=new FileReader;s.onloadend=()=>{this.setState({drawerOpen:!1,isDropTarget:!1}),"string"==typeof s.result&&this.props.attributeChange(s.result)},s.readAsDataURL(t)}};photoDragOver=e=>{e.preventDefault()};photoDragEnter=()=>{this.setState({isDropTarget:!0})};photoDragLeave=()=>{this.setState({isDropTarget:!1})};photoDrop=e=>{const t=e.dataTransfer.files[0];if(this.setState({isDropTarget:!1}),t&&/image.*/.test(t.type)){const e=new FileReader;e.onloadend=()=>{"string"==typeof e.result&&this.setPhoto(e.result)},e.readAsDataURL(t)}};getGravatar=()=>{const e=Ts()(this.props.emailAddress);fetch(`https://secure.gravatar.com/avatar/${e}?s=512&d=404`).then((e=>{e.ok&&e.blob().then((e=>{const t=new FileReader;t.addEventListener("loadend",(()=>{"string"==typeof t.result&&this.setPhoto(t.result),this.setState({drawerOpen:!1,isDropTarget:!1})})),t.readAsDataURL(e)}))}))};openGravatarPrivacy=()=>{c.ZP.openURL(this.context.vivaldiWindowId,"https://gravatar.com/privacy/")};setPhoto=e=>{const{document:t}=this.context;if(!e)return this.props.attributeChange(""),void this.setState({drawerOpen:!1,isDropTarget:!1});const s=t.createElement("canvas"),n=s.getContext("2d"),i=t.createElement("img");let a=0,o=0;s.width=M3,s.height=M3,i.onload=()=>{i.height>i.width?(i.height*=M3/i.width,i.width=M3,o=.5*-(i.height-M3)):(i.width*=M3/i.height,i.height=M3,a=.5*-(i.width-M3)),n.drawImage(i,a,o,i.width,i.height),this.props.attributeChange(s.toDataURL("image/jpeg",.9)),this.setState({drawerOpen:!1})},i.src=e};render(){const e=this.props.photo,t=Gn()({"contact-photo-is-droptarget":this.state.isDropTarget,"contact-photo":!0});return(0,zn.jsxs)("span",{ref:this.nodeRef,className:"contact-photo-picker",children:[(0,zn.jsx)("button",{className:t,onDrop:this.photoDrop,onDragEnter:this.photoDragEnter,onDragLeave:this.photoDragLeave,onDragOver:this.photoDragOver,style:e?{backgroundImage:`url(${e})`}:{backgroundImage:`url(${xx.g})`},disabled:-1===this.props.id,onClick:this.onToggleOverlay}),(0,zn.jsx)("input",{type:"file",tabIndex:"-1",accept:"image/*",ref:this.refPhotoPicker,disabled:-1===this.props.id,onChange:this.setContactPhoto,style:{position:"absolute",visibility:"hidden",height:0,width:0}}),this.state.drawerOpen&&(0,zn.jsxs)("div",{className:"contact-photo-picker-overlay",children:[(0,zn.jsxs)("div",{className:"photo-picker-suggestions",children:[(0,zn.jsx)("button",{className:"photo-picker-suggestion",onClick:this.props.disabled?void 0:this.setPhoto.bind(this,this.state.initialPhoto),style:{backgroundImage:this.state.initialPhoto?`url(${this.state.initialPhoto})`:`url(${xx.g})`}}),D3.map(((e,t)=>(0,zn.jsx)("button",{className:"photo-picker-suggestion",onClick:this.setPhoto.bind(this,D3[t]),style:{backgroundImage:`url(${e})`}},`photo-picker-suggestion-${t}`)))]}),(0,zn.jsx)("input",{type:"button",className:"primary",onClick:this.photoChange,value:(0,W.Z)("Browse Files...")}),(0,zn.jsx)("input",{type:"button",onClick:this.getGravatar,value:(0,W.Z)("Get Gravatar")}),(0,zn.jsx)("small",{children:(0,zn.jsx)("a",{href:"https://gravatar.com/privacy/",onClick:this.openGravatarPrivacy,children:(0,W.Z)("Gravatar Privacy Policy")})})]})]})}}const j3=(0,Dg.Z)(O3);class L3 extends Un.PureComponent{isIMEOpen=!1;nodeRef=Un.createRef();state={values:this.props.values};resetValues(){this.setState({values:this.props.values})}_handleChange=(e,t)=>{if(this.isIMEOpen)return!1;const s=t.target.value,n=t.target.name;this.setState((t=>{const i=[...t.values];return i[e]={...t.values[e],[n]:s},{values:i}}))};_handleAdd=e=>{0===e.button&&this._handleChange(this.props.values.length,e)};_handleRemove=(e,t)=>{0===t.button&&(e?this.props.onRemove(e):this.resetValues())};_handleSubmit=()=>{this.props.onChange(this.state.values)};_handleFormSubmit=e=>{e.preventDefault(),this._handleSubmit()};_handleInputKeyDown=e=>{switch(e.key){case"Escape":return void this.resetValues();case"Enter":return void this._handleSubmit()}};onCompositionUpdate=()=>{this.isIMEOpen=!0};onCompositionEnd=(e,t)=>{this.isIMEOpen=!1,this._handleChange(e,t)};renderSimpleForm(e,t){return(0,zn.jsxs)("form",{children:[this.renderTypes(e,0),this.props.label&&(0,zn.jsx)("input",{className:"contact-field",type:e,defaultValue:this.props.values[0],placeholder:t,title:t,name:"value",onChange:e=>this._handleChange(0,e),onKeyDown:this._handleInputKeyDown,onBlur:this._handleFormSubmit,onCompositionStart:this.onCompositionUpdate,onCompositionUpdate:this.onCompositionUpdate,onCompositionEnd:e=>this.onCompositionEnd(0,e)})]})}renderTypes(e,t){return(0,zn.jsxs)(Fa.Z,{className:"contact-type-picker",name:"type",onChange:this._handleChange.bind(this,t),onBlur:this._handleFormSubmit,value:e,children:[(0,zn.jsx)("option",{value:"",children:(0,W.Z)("contact type","default")}),(0,zn.jsx)("option",{value:"home",children:(0,W.Z)("home")}),(0,zn.jsx)("option",{value:"work",children:(0,W.Z)("work")})]})}render(){const{values:e}=this.state,{inputType:t="text",label:s}=this.props;return 0===e.length?this.renderSimpleForm(t,s):(0,zn.jsx)(zn.Fragment,{children:(0,zn.jsx)("form",{ref:this.nodeRef,onSubmit:this._handleFormSubmit,children:e.map(((n,i)=>(0,zn.jsxs)(Un.Fragment,{children:[this.renderTypes(n.type||"",i),(0,zn.jsxs)("span",{className:"contact-field",children:[this.props.label&&(0,zn.jsx)("input",{type:t,name:"value",defaultValue:n.value||"",placeholder:s,title:s,onChange:this._handleChange.bind(this,i),onBlur:this._handleFormSubmit,onKeyDown:this._handleInputKeyDown,onCompositionStart:this.onCompositionUpdate,onCompositionUpdate:this.onCompositionUpdate,onCompositionEnd:this.onCompositionEnd,autoFocus:i===e.length-1}),(0,zn.jsx)("button",{type:"button",className:"remove",title:(0,W.Z)("verb","Remove"),onMouseUp:this._handleRemove.bind(this,n.id),onClick:this._handleRemove.bind(this,n.id),children:"–"})]}),i===e.length-1&&(0,zn.jsx)("input",{type:"button",value:this.props.actionLabel,className:"add",onMouseUp:this._handleAdd,onClick:this._handleAdd})]},n.id+"_"+i)))})})}}var R3=(0,zn.jsx)("span",{className:"spacer"}),B3=(0,zn.jsx)("span",{className:"spacer"}),F3=(0,zn.jsx)("span",{className:"spacer"}),W3=(0,zn.jsx)("span",{className:"spacer"}),U3=(0,zn.jsx)("span",{className:"spacer"}),V3=(0,zn.jsx)("span",{className:"spacer"}),H3=(0,zn.jsx)("span",{className:"spacer"}),G3=(0,zn.jsx)("span",{className:"spacer"}),K3=(0,zn.jsx)("span",{className:"spacer"});class z3 extends Un.Component{static contextType=oi.Z;refName=Un.createRef();refPhotoPicker=Un.createRef();state={contact:this.props.contact,editMode:!1};static getDerivedStateFromProps(e,t){return{contact:e.contact}}focus=()=>{this.refName.current?.focus()};changeProperty=(e,t)=>{const{contact:s}=this.state;switch(e){case"birthday":{const e=V()(t.target.value).valueOf();s.birthday!==e&&(s.birthday=e,this.setState({contact:s}));break}case"note":case"name":{const n=t.target.value;s[e]!==n&&(s[e]=n,this.setState({contact:s}));break}}};updateCheckboxProperty=e=>{const{contact:t}=this.state;-1!==t.id&&o.Z.update(t.id,{trusted:e.target.checked})};updateAvatar=e=>{const{contact:t}=this.state;o.Z.update(t.id,{avatarUrl:e}),this.setState((t=>({contact:{...t.contact,avatarUrl:e}})))};update=e=>{const{contact:t}=this.state;switch(e){case"name":return o.Z.update(t.id,{name:t.name,generatedFromSentMail:!1});case"birthday":return o.Z.update(t.id,{birthday:t.birthday,generatedFromSentMail:!1});case"note":return o.Z.update(t.id,{note:t.note,generatedFromSentMail:!1})}};_handleEmailsChanged=e=>{const{contact:t}=this.state;e.forEach((e=>{const s=e.id,n=t.emailAddresses.find((e=>e.id===s));n?(0,sw.Z)(n,e)||o.Z.updateEmailAddress(s,{contactId:t.id,emailAddress:e.value,type:e.type}):o.Z.addEmailAddress({contactId:t.id,emailAddress:e.value,type:e.type})}))};_handleEmailsRemoved=e=>{o.Z.removeEmailAddress({contactId:this.props.contact.id,emailAddressId:e})};_handlePropertyValueChanged=({propertyName:e,propertyCollectionName:t,values:s})=>{if(0===s.length)return;const{contact:n}=this.state,i=n.id;s.forEach((s=>{const a=s.id,r=Array.isArray(n[t])?n[t].find((e=>e.id===a)):void 0;(r||s.value)&&(r?o.Z.updatePropertyItem({contactId:i,propertyName:e,propertyId:a,type:s.type,propertyValue:s.value}):o.Z.addPropertyItem({contactId:i,propertyName:e,type:s.type||"",propertyValue:s.value}))}))};_handlePhoneNumbersChanged=e=>{this._handlePropertyValueChanged({values:e,propertyName:"phoneNumber",propertyCollectionName:"phoneNumbers"})};_handlePhoneNumbersRemoved=e=>{o.Z.removePropertyItem({propertyName:"phoneNumber",contactId:this.state.contact.id,propertyId:e})};_handlePostalAddressesChanged=e=>{this._handlePropertyValueChanged({values:e,propertyName:"postalAddress",propertyCollectionName:"postalAddresses"})};_handlePostalAddressesRemoved=e=>{o.Z.removePropertyItem({propertyName:"postalAddress",contactId:this.state.contact.id,propertyId:e})};onKeyDown=(e,t)=>{"Enter"!==t.key||this.update(e)};call=(e="",t)=>{const s=e.replace(/[^\d]/g,"");s&&(t.stopPropagation(),c.ZP.openURL(this.context.vivaldiWindowId,`tel:+${s}`))};compose=(e="",t)=>{e&&(t.stopPropagation(),ns.Z.createDraft({to:(0,cw.D$)(e)}))};showMap=(e="",t)=>{e&&(t.stopPropagation(),c.ZP.openURL(this.context.vivaldiWindowId,`map:+${e}`))};enableEditMode=()=>{this.setState({editMode:!0},(()=>this.focus()))};toggleEditMode=()=>{this.setState((e=>({editMode:!e.editMode})))};addSpaces=e=>e.split("").reverse().join("").replace(/(.{3})/g,"$1 ").split("").reverse().join("").replace("+ ","+");renderDisplayMode=()=>{const{contact:e}=this.state;return(0,zn.jsxs)("div",{className:"contact-view cardview",onClick:this.props.onEdit,children:[(0,zn.jsxs)("div",{className:"contact-header",children:[(0,zn.jsx)(j3,{ref:this.refPhotoPicker,id:e.id,disabled:!0,attributeChange:this.updateAvatar,photo:e.avatarUrl||"",emailAddress:e.emailAddresses.length>0?e.emailAddresses[0].emailAddress:""}),(0,zn.jsx)("div",{className:Gn()({"contact-name":!0,selectable:e.name,disabled:!e.name}),children:e.name||(0,W.Z)("noun","Name")})]}),R3,e.emailAddresses.map((e=>{if(e.emailAddress)return(0,zn.jsxs)(Un.Fragment,{children:[(0,zn.jsxs)("div",{className:"contact-field-type",children:[(0,zn.jsx)("span",{className:"info",children:e.type}),(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.HXY},className:"contact-action-button",onClick:this.compose.bind(null,e.emailAddress),title:(0,W.Z)("Compose new mail")+"\n"+Ye.Z.getShortcut("COMMAND_MAIL_COMPOSE_NEW_MESSAGE")})]}),(0,zn.jsx)("p",{className:"contact-email selectable",children:e.emailAddress})]},e.id)})),B3,e.phoneNumbers.map((e=>{if(e.phoneNumber)return(0,zn.jsxs)(Un.Fragment,{children:[(0,zn.jsxs)("div",{className:"contact-field-type",children:[(0,zn.jsx)("span",{className:"info",children:e.type}),(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.Mqy},className:"contact-action-button",onClick:this.call.bind(null,e.phoneNumber),title:(0,W.Z)("Call")})]}),(0,zn.jsx)("p",{className:"contact-phone selectable",children:this.addSpaces(e.phoneNumber)})]},e.id)})),F3,e.postalAddresses.map((e=>{if(e.postalAddress)return(0,zn.jsxs)(Un.Fragment,{children:[(0,zn.jsxs)("div",{className:"contact-field-type",children:[(0,zn.jsx)("span",{className:"info",children:e.type}),(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.rnU},className:"contact-action-button",onClick:this.showMap.bind(null,e.postalAddress),title:(0,W.Z)("Open map")})]}),(0,zn.jsx)("p",{className:"contact-phone selectable",children:e.postalAddress})]},e.id)})),0!==e.birthday&&(0,zn.jsxs)(zn.Fragment,{children:[W3,(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.bcq.small},className:"contact-field-type contact-action-button"}),(0,zn.jsx)("p",{className:"contact-birthday selectable",children:V()(e.birthday).format("LL")})]}),e.note&&(0,zn.jsxs)(zn.Fragment,{children:[U3,(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.NNg.small},className:"contact-field-type contact-action-button",onClick:this.toggleEditMode,title:(0,W.Z)("Edit note")}),(0,zn.jsx)("p",{className:"contact-note selectable",children:e.note})]})]})};render(){const{contact:e}=this.state,t=e.emailAddresses[0]&&e.emailAddresses[0].emailAddress;return this.state.editMode?(0,zn.jsxs)("div",{className:"contact-view cardview",children:[(0,zn.jsxs)("div",{className:"contact-header",children:[(0,zn.jsx)(j3,{id:e.id,attributeChange:this.updateAvatar,photo:e.avatarUrl||"",emailAddress:t}),(0,zn.jsx)("span",{className:"contact-name",children:(0,zn.jsx)("input",{ref:this.refName,type:"text",value:e.name||"",placeholder:(0,W.Z)("other","Name"),onChange:this.changeProperty.bind(this,"name"),onKeyDown:this.onKeyDown.bind(this,"name"),onBlur:this.update.bind(this,"name")})})]}),(0,zn.jsx)(L3,{values:e.emailAddresses.map((({emailAddress:e,id:t,type:s})=>({value:e,id:t,type:s}))),label:(0,W.Z)("Email"),actionLabel:(0,W.Z)("Add another Email"),inputType:"email",onChange:this._handleEmailsChanged,onRemove:this._handleEmailsRemoved},`emailAddresses-${Math.max(e.emailAddresses.length,1)}`),(0,zn.jsxs)("label",{className:"contact-trusted",children:[(0,zn.jsx)("input",{type:"checkbox",checked:e.trusted||!1,onChange:this.updateCheckboxProperty}),(0,zn.jsx)("span",{children:(0,W.Z)("Always allow external content in emails")})]}),V3,(0,zn.jsx)(L3,{values:e.phoneNumbers.map((({phoneNumber:e,id:t,type:s})=>({value:e,id:t,type:s}))),label:(0,W.Z)("Phone Number"),actionLabel:(0,W.Z)("Add another Phone Number"),inputType:"tel",onChange:this._handlePhoneNumbersChanged,onRemove:this._handlePhoneNumbersRemoved},`phoneNumbers-${e.phoneNumbers.length}`),H3,(0,zn.jsx)(L3,{values:e.postalAddresses.map((({postalAddress:e,id:t,type:s})=>({value:e,id:t,type:s}))),label:(0,W.Z)("Postal Address"),actionLabel:(0,W.Z)("Add another Postal Address"),inputType:"text",onChange:this._handlePostalAddressesChanged,onRemove:this._handlePostalAddressesRemoved},`postalAddresses-${e.postalAddresses.length}`),G3,(0,zn.jsxs)("span",{className:"contact-field",children:[(0,zn.jsx)(wx.Z,{className:"contact-bday",value:e.birthday?V()(e.birthday).format("YYYY-MM-DD"):"",title:(0,W.Z)("title","Birthday"),onChange:this.changeProperty.bind(this,"birthday"),onKeyDown:this.onKeyDown.bind(this,"birthday"),onBlur:this.update.bind(this,"birthday"),placeholder:(0,W.Z)("title","Birthday")}),(0,zn.jsx)("button",{type:"button",className:"remove",title:(0,W.Z)("Remove Birthday"),onMouseUp:this.changeProperty.bind({target:{value:0}},"birthday"),children:"–"})]}),K3,(0,zn.jsx)("textarea",{className:"contact-edit-note",type:"text",value:e.note||"",title:e.note||"",onChange:this.changeProperty.bind(this,"note"),onKeyDown:this.onKeyDown.bind(this,"note"),onBlur:this.update.bind(this,"note"),placeholder:(0,W.Z)("Note")})]}):this.renderDisplayMode()}}const $3=z3;var Y3=(0,zn.jsx)("input",{type:"checkbox",disabled:!0}),X3=(0,zn.jsx)("span",{className:"spacer"}),Q3=(0,zn.jsx)("span",{className:"spacer"}),q3=(0,zn.jsx)("span",{className:"spacer"}),J3=(0,zn.jsx)("span",{className:"spacer"});function e2(){return(0,zn.jsxs)("div",{className:"contact-view cardview",children:[(0,zn.jsxs)("div",{className:"contact-header",children:[(0,zn.jsx)("span",{className:"contact-photo-picker",children:(0,zn.jsx)("div",{className:"contact-photo",style:{backgroundImage:"url('/resources/contact-person.png')"}})}),(0,zn.jsx)("input",{className:"contact-name",type:"text",placeholder:(0,W.Z)("other","Name"),disabled:!0})]}),(0,zn.jsx)("input",{className:"contact-email",type:"email",placeholder:(0,W.Z)("Email"),disabled:!0}),(0,zn.jsxs)("label",{className:"contact-trusted",children:[Y3,(0,zn.jsx)("span",{children:(0,W.Z)("Always allow external content in emails")})]}),X3,(0,zn.jsx)("input",{className:"contact-email",type:"tel",placeholder:(0,W.Z)("Phone number"),disabled:!0}),Q3,(0,zn.jsx)("input",{className:"contact-email",type:"text",placeholder:(0,W.Z)("Postal address"),disabled:!0}),q3,(0,zn.jsx)("input",{className:"contact-email",type:"text",placeholder:(0,W.Z)("title","Birthday"),disabled:!0}),J3,(0,zn.jsx)("input",{className:"contact-postal",type:"text",placeholder:(0,W.Z)("Notes"),disabled:!0})]})}var t2=s(34155);const s2=[Z.kContactPanelEditorHeight,Z.kMailContactDefaultAction,Z.kMailSingleClickTabs];var n2=(0,zn.jsx)(e2,{});class i2 extends Un.PureComponent{static contextType=oi.Z;winId=this.context.vivaldiWindowId;nodeRef=Un.createRef();_tree=Un.createRef();_editor=Un.createRef();state={items:ml.Z.getAsTree(""),filter:"",editorHeight:this.props.prefValues[Z.kContactPanelEditorHeight],contact:{id:ml.s}};componentDidMount(){0===this.state.items.length&&o.Z.initialize(),tn.ZP.addListener(this.onPanelStoreChange),ml.Z.addListener(this.onContactStoreChange)}componentWillUnmount(){tn.ZP.removeListener(this.onPanelStoreChange),ml.Z.removeListener(this.onContactStoreChange)}componentDidUpdate(e,t){!e.open&&this.props.open&&t2.nextTick((()=>this._applyTransitionState()))}_applyTransitionState=()=>{const e=tn.ZP.getTransitionState(this.winId,"PanelContacts");en.Z.clearTransitionState(this.winId,"PanelContacts"),this._tree.current&&e?(e.selectId&&this._tree.current.selectById(e.selectId),"edit"===e.reason?this.onEdit():e.setFocus&&this.focusTree()):this.focusTree()};onPanelStoreChange=()=>{const e=tn.ZP.getChangeReason();if(this.props.open)switch(e){case"setFocus":(0,vo.sT)(this.context.document,this.nodeRef.current)||this.focusTree();break;case"display":t2.nextTick((()=>this._applyTransitionState()))}};onContactStoreChange=e=>{switch(e.reason){case"selectedContact":{const t=e.focusContactView;return this.onContactSelectedChange(e.contact,t)}case"newContact":{const t=e.focusContactView;return this.onContactSelectedChange(e.contact,t,{items:ml.Z.getAsTree(this.state.filter)})}case"startup":{const e=Rs.Z.getSync("SELECTION_CONTACT_TREE")?.selectedIds_[0]?.id,t=e&&ml.Z.getNodeById(e)||{id:ml.s};this.setState((e=>({contact:t,items:ml.Z.getAsTree(e.filter)})));break}case"addContacts":case"deleteContact":case"updatedContact":return this.setState((e=>({contact:ml.Z.getSelected()||{id:ml.s},items:ml.Z.getAsTree(e.filter)})))}};onContactSelectedChange=(e,t,s)=>{this.setState({...s,contact:e},(()=>{t&&e.id!==ml.s&&(this._editor.current&&this._editor.current.enableEditMode(),this._tree.current&&this._tree.current.selectById(e.id))}))};newItem=e=>{this._tree.current&&this._tree.current.onAdd(e)};onCreate=(e,t,s,n)=>(this.onEdit(),o.Z.newEmptyContact());onEdit=()=>{this.state.editorHeight<u.Cn&&this.onSlidebarToggle();(this.state.contact||ml.Z.getSelected()||{id:ml.s})&&this._editor.current&&this._editor.current.enableEditMode()};deleteSelected=()=>{this._tree.current&&this._tree.current.deleteSelected()};handleFilterChange=e=>{const t=e.target.value;this.setState({filter:t,items:ml.Z.getAsTree(t)})};onCompose=()=>{this._tree.current&&this._tree.current.compose()};focusTree=()=>{this._tree.current&&this._tree.current.refTreeList.current?.focusTree()};onItemSelected=e=>{if(e){if(e.id===this.state.contact.id)return;o.Z.selectContact(e,!1)}else this.setState({contact:{id:ml.s}})};onContextMenu=e=>{e.nativeEvent.buttons>0&&this._tree.current?.unSelectAll(),this._tree.current?.onContextMenu(e)};onSlidebarPosition=(e,t)=>{this.setState((e=>({editorHeight:Math.max(Math.min(e.editorHeight-t,800),u.mT)})))};onSlideBarStop=()=>{this.setState((e=>{let t=e.editorHeight;return t<=u.Cn&&(t=u.mT),I.Z.set(Z.kContactPanelEditorHeight,t),{editorHeight:t}}))};onSlidebarToggle=()=>{this.setState((e=>{let t=e.editorHeight;return t>u.Cn?(t=u.mT,I.Z.set(Z.kContactPanelEditorHeight,t)):(t=320,I.Z.reset(Z.kContactPanelEditorHeight)),{editorHeight:t}}))};renderEmptyState=()=>(0,zn.jsxs)("div",{className:"panel-empty-state",children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.h5j}}),(0,zn.jsx)("h1",{children:(0,W.Z)("Your contact list is empty")}),(0,zn.jsx)("p",{className:"faded-text",children:(0,W.Z)("Click the “+” button to add a new contact.")})]});renderNoContactFound=()=>(0,zn.jsxs)("div",{className:"panel-empty-state",children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.h5j}}),(0,zn.jsx)("h1",{children:(0,W.Z)("No contact found")})]});render(){if(!this.props.open)return null;const e=this.state.contact&&this.state.contact.id!==ml.s?this.state.contact:void 0;return(0,zn.jsxs)("div",{ref:this.nodeRef,className:"panel",id:"contacts",children:[(0,zn.jsxs)("header",{children:[(0,zn.jsx)(Cu,{title:this.props.title,showCloseButton:this.props.showCloseButton}),(0,zn.jsxs)("div",{className:"toolbar toolbar-default toolbar-wrap",role:"toolbar","aria-label":(0,W.Z)("toolbar label","Contacts"),children:[(0,zn.jsx)("input",{type:"search",placeholder:(0,W.Z)("verb","Search"),value:this.state.filter,onChange:this.handleFilterChange}),(0,zn.jsxs)("div",{className:"toolbar",children:[(0,zn.jsxs)("div",{className:"toolbar-group",children:[(0,zn.jsx)(oa.ZP,{onClick:this.newItem.bind(this,!1),tooltip:(0,W.Z)("New Contact"),image:Kn.md4.small}),(0,zn.jsx)(oa.ZP,{onClick:this.deleteSelected,disabled:this.state.contact.id===ml.s,image:Kn.M2k.small,tooltip:(0,W.Z)("other","Delete")})]}),(0,zn.jsx)(oa.ZP,{onClick:this.onCompose,tooltip:(0,W.Z)("Compose mail to contact"),disabled:this.state.contact.id===ml.s,image:Kn.XTV.small})]})]})]}),0===this.state.items.length&&(this.state.filter?this.renderNoContactFound():this.renderEmptyState()),(0,zn.jsx)(P3,{ref:this._tree,nodes:this.state.items,keyAccess:this.props.keyAccess,onCreate:this.onCreate,onEdit:this.onEdit,focusTree:this.focusTree,prefValues:this.props.prefValues,onItemSelected:this.onItemSelected}),this.state.items.length>0&&(0,zn.jsxs)("section",{className:Gn()("panel-contacts-edit","outerScrollbar",{collapsed:this.state.editorHeight===u.mT}),style:{flexBasis:this.state.editorHeight},children:[(0,zn.jsx)(Mu.Z,{onSlidebarPosition:this.onSlidebarPosition,onStop:this.onSlideBarStop,onDoubleClick:this.onSlidebarToggle,returnOffset:!0,position:"bottom"}),this.state.editorHeight>u.mT&&e?(0,zn.jsx)($3,{ref:this._editor,contact:e,onEdit:this.onEdit},e.id):n2]})]})}}const a2=(0,zd.Z)(i2,s2),o2=(0,aT.extendMoment)(V()),r2=[{text:(0,W.Z)("Date"),value:"visitTime",fullScreenTitle:(0,W.Z)("Sort by Date")},{text:(0,W.Z)("Title"),value:"title",fullScreenTitle:(0,W.Z)("Sort by Title")},{text:(0,W.Z)("Address"),value:"address",fullScreenTitle:(0,W.Z)("Sort by Address")},{text:(0,W.Z)("Views"),value:"visitCount",fullScreenTitle:(0,W.Z)("Sort by Page Views")}];class l2 extends Un.PureComponent{static contextType=oi.Z;hasLoadedData=!1;refSearch=Un.createRef();constructor(e){super(e);const t=function(){let e=$z({range:o2.range(o2().startOf("day"),o2().endOf("day"))});const t=Rs.Z.getSync("HISTORY_PANEL");if(t&&t.startTime&&t.endTime){const s=Mz.Z.getTimeByRange({rangePicker:t.rangePicker,startTime:o2(t.startTime),endTime:o2(t.endTime)});e={...e,...s}}else{const t=Mz.Z.getTimeByRange({rangePicker:e.rangePicker});e={...e,endTime:t.endTime?t.endTime:e.endTime,startTime:t.startTime?t.startTime:e.startTime}}return e}();this.state={filter:t,nodes:Mz.Z.getTreeNodes(t),oldestDate:Mz.Z.getOldestDate()}}componentDidMount(){Mz.Z.addListener(this.#us)}componentDidUpdate(e){!e.open&&this.props.open&&this.refSearch.current?.focusField(),this.props.open&&!this.hasLoadedData&&(this.hasLoadedData=!0,Le.loadAll())}componentWillUnmount(){Mz.Z.removeListener(this.#us)}#us=()=>{this.setState((e=>{const{filter:t}=e;return{nodes:Mz.Z.getTreeNodes(t),oldestDate:Mz.Z.getOldestDate()}}))};onSearch=e=>{Rs.Z.set({HISTORY_PANEL:{rangePicker:e.rangePicker,startTime:e.startTime.valueOf(),endTime:e.endTime.valueOf()}}),this.setState({filter:e,nodes:Mz.Z.getTreeNodes(e)})};onSearchDomain=e=>{e=Rb(e);const{filter:t}=this.state,s={...t,text:e,parsedFilter:Rz(e),searchURL:!0};this.onSearch(s)};onSortChange=(e,t)=>{if(1===e)return;const{filter:s}=this.state,n={...s,sortOrder:e,sortField:t};this.onSearch(n)};renderHistory=()=>0===Mz.Z.getNumerOfItems()?(0,zn.jsxs)("div",{className:"panel-empty-state",children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.dgq}}),(0,zn.jsx)("h1",{children:(0,W.Z)("No browsing history to show")}),(0,zn.jsx)("p",{children:(0,W.Z)("As soon as you start browsing, your history will show here.")})]}):this.state.nodes.length>0?(0,zn.jsx)("section",{className:"outerScrollbar",children:(0,zn.jsx)(zz,{fullView:!1,inManager:!1,nodes:this.state.nodes,filter:this.state.filter,onSearchDomain:this.onSearchDomain})}):(0,zn.jsx)("section",{children:(0,zn.jsx)("p",{children:(0,W.Z)("No browsing history data for selected period.")})});render(){if(!this.props.open)return null;const{filter:e}=this.state,{nodes:t}=this.state;return(0,zn.jsxs)("div",{className:"panel",id:"history-panel",children:[(0,zn.jsxs)("header",{children:[(0,zn.jsx)(Cu,{title:this.props.title,showCloseButton:this.props.showCloseButton}),(0,zn.jsx)("div",{className:"toolbar toolbar-default toolbar-wrap",role:"toolbar","aria-label":(0,W.Z)("toolbar label","History"),children:(0,zn.jsx)(Fz,{ref:this.refSearch,showPicker:!0,search:this.onSearch,filter:e,minDate:this.state.oldestDate,hasHistory:0!==t.length,showClearBtn:!0})})]}),t.length>0&&(0,zn.jsx)(Bu,{fields:r2,onSortChange:this.onSortChange,keyAccess:this.props.keyAccess,sortField:e.sortField,sortOrder:e.sortOrder,fullsize:!1,manualSorting:!1}),this.renderHistory()]})}}const d2=l2;class c2 extends Un.PureComponent{static contextType=oi.Z;markdownFormatter=new CY({quotes:(0,W.Z)("“”‘’")});refRender=Un.createRef();constructor(e){super(e);const t=this.props.attachments.map((e=>e.content?`[${e.content}]: chrome://vivaldi-data/synced-store/${e.content}`:"")).join("\n"),s=`${this.props.body}\n\n${t}\n`;this.state={markup:s}}componentDidMount(){this.refRender.current&&(this.refRender.current.scrollTop=this.props.initialScrollPosition||0)}onScroll=({currentTarget:e})=>{this.props.onScrollValueChange&&this.props.onScrollValueChange(e.scrollTop)};selectAll=e=>{const{document:t,getSelection:s}=this.context;e.focus();const n=s();n&&n.removeAllRanges();const i=t.createRange();i.selectNodeContents(e),n&&n.addRange(i)};onKeyDown=e=>{const{getSelection:t}=this.context;switch(e.key){case"a":return void(e.ctrlKey&&(e.preventDefault(),this.selectAll(e.currentTarget)));case"Escape":{const e=t();return void(e&&e.removeAllRanges())}}};render(){const{className:e}=this.props,t=this.markdownFormatter.getRawMarkup(this.state.markup);return(0,zn.jsx)("div",{ref:this.refRender,onMouseUp:e=>function(e,t){if(t.button!==ai.Z.kLeft)return;const{vivaldiWindowId:s,HTMLAnchorElement:n}=e,i=t.target;if(i instanceof n&&i.href){const e=i.getAttribute("href");if(!e||e&&e.startsWith("#"))return;if((0,vi.Z)(t))return;c.ZP.openURL(s,i.href,{inCurrent:!1,inBackground:A.Z.get(Z.kTabsOpenNewInBackground),transition:re.Z.historyPrivate.TransitionType.LINK})}}(this.context,e),onKeyDown:this.onKeyDown,className:Gn()("MarkdownRender",e),tabIndex:"0",onScroll:this.onScroll,children:(0,zn.jsx)("div",{dangerouslySetInnerHTML:{__html:t}})})}}const h2=c2;class u2 extends Un.PureComponent{_isIMEOpen=!1;state={content:this.props.content};refContent=Un.createRef();focus=()=>{this.refContent.current?.focus()};reset=(0,Te.Z)((()=>{this.setState({content:this.props.content})}),s$.mS,{leading:!1,trailing:!0});_save=(0,Te.Z)((()=>{this.waitForCompositionEnd.then((()=>{this.props.onSave(this.state.content)}))}),s$.mS,{leading:!1,trailing:!0});handleContentChange=({currentTarget:e})=>{this.props.onChange(e.value),this.setState({content:e.value},this._save)};waitForCompositionEnd=Promise.resolve();resolveComposition=nr.Z;_handleCompositionStart=()=>{this._isIMEOpen=!0,this.waitForCompositionEnd=(()=>new Promise((e=>{this.resolveComposition=e})))()};_handleCompositionEnd=()=>{this._isIMEOpen=!1,this.resolveComposition()};handleKeyDown=e=>{(e.metaKey||e.ctrlKey)&&"s"===e.key&&(e.preventDefault(),this.props.onSave(this.state.content)),"Escape"===e.key&&this._isIMEOpen&&(e.preventDefault(),e.stopPropagation())};handleFocus=e=>{e.persist(),e.currentTarget.selectionStart=this.props.content.length,e.currentTarget.selectionEnd=this.props.content.length};render(){const{disabled:e,className:t}=this.props,{content:s}=this.state;return(0,zn.jsx)("textarea",{ref:this.refContent,className:t,placeholder:(0,W.Z)("Note"),title:(0,W.Z)("Write a note"),value:s,disabled:e,onFocus:this.handleFocus,onChange:this.handleContentChange,onCompositionStart:this._handleCompositionStart,onCompositionEnd:this._handleCompositionEnd,onKeyDown:this.handleKeyDown,onBlur:this.props.onBlur})}}function p2({windowId:e,disabled:t,onToggleMarkDown:s,onDoCapture:n,onOpenDialog:i,keyAccess:a,viewMarkdown:o,noteId:r}){const l=t?-1:a;return(0,zn.jsxs)("div",{className:"toolbar toolbar-default",children:[(0,zn.jsxs)("div",{className:"toolbar-group",children:[(0,zn.jsx)("div",{className:"button-toolbar",children:(0,zn.jsx)("button",{disabled:t,onClick:n,title:(0,W.Z)("Add capture of selected area or full page"),tabIndex:l,dangerouslySetInnerHTML:{__html:Kn.F_h}})}),(0,zn.jsx)(AY,{onOpenDialog:i,disabled:t,keyAccess:l,noteId:r}),(0,zn.jsx)("div",{className:"button-toolbar",children:(0,zn.jsx)("button",{className:"button-toolbar"+(o?" button-pressed":""),disabled:t,onClick:s,title:o?(0,W.Z)("Switch to Editor"):(0,W.Z)("Switch Markdown View"),tabIndex:l,dangerouslySetInnerHTML:{__html:Kn.Pje}})})]}),(0,zn.jsx)("div",{className:"button-toolbar open-in-tab-button",children:(0,zn.jsx)("button",{disabled:t,onClick:()=>function(e,t){c.ZP.openURL(e,vs.jk.internalUrl("notes",t),{singleton:!0})}(e,r),title:(0,W.Z)("Open in Tab"),tabIndex:l,dangerouslySetInnerHTML:{__html:Kn.vvh.medium}})})]})}function g2(e,{title:t,content:s,url:i}){const a={};return"string"==typeof i&&(a.url=(0,Ar.q9)(i.trim())),void 0!==t&&(a.title=t),void 0!==s&&(a.content=s),async function(e,t){const s=await re.Z.notes.update(e,t);if(!n.Z.runtime.lastError)return s}(e,a)}function m2(e){return{id:e.note?.id??"",typedUrl:e.note?.url,title:e.note?.title,content:e.note?.content,attachments:"note"===e.note?.type?e.note.children:void 0}}class f2 extends Un.Component{static contextType=oi.Z;refFolderName=Un.createRef();refContainer=Un.createRef();refTextEditor=Un.createRef();_id=crypto.randomUUID();_pageContext={};state=m2(this.props);componentDidMount(){vg.Z.updateState(this._id,{typedUrl:this.props.note?.url??""}),wg.addListener(this._onUrlFieldStoreChanged,(e=>e.get(this._id))),s$.ZP.addListener(this._onNoteStoreChanged)}componentDidUpdate(e,t){this.props.note&&this.props.note.content!==t.content&&this.updateState()}componentWillUnmount(){if(wg.removeListener(this._onUrlFieldStoreChanged),vg.Z.reset(this._id),s$.ZP.removeListener(this._onNoteStoreChanged),!this.props.note)return;const{id:e,content:t}=this.state;g2(e,{content:"string"==typeof t?t:void 0,url:this.#Ws()})}updateState=(0,Te.Z)((()=>{(0,vo.sT)(this.context.document,this.refTextEditor.current?.refContent.current??null)||this.setState({...m2(this.props)},(()=>this.refTextEditor.current?.reset()))}),s$.mS,{trailing:!0,leading:!1});focusPrimaryInput=()=>{if(!this.props.note)return;s$.ZP.isFolder(this.props.note)?this.refFolderName.current?.focus():this.refTextEditor.current?.focus()};_doCapture=()=>{const e=this.props.note;var t;e&&(t=this.context.vivaldiWindowId,new Promise((e=>{A.Z.get(Z.kPanelsAsOverlayEnabled)&&en.Z.toggleContent(t,"PanelNotes"),setTimeout((()=>e()),200)}))).then((()=>{Ao.Z.captureFromNote(this.context.vivaldiWindowId,e.id)}))};_openUrl=e=>{if(ai.Z.isContextMenuButton(e.button))return;const t=(0,Ar.q9)(this.props.note?.url??"");if(!t)return;const s=this.context.vivaldiWindowId,{metaKey:n,shiftKey:i,ctrlKey:a,altKey:o,button:r}=e,l=(0,fo.ZP)(s,{metaKey:n,shiftKey:i,ctrlKey:a,altKey:o,button:r},re.Z.historyPrivate.TransitionType.LINK);c.ZP.openURL(s,t,l)};_toggleMarkdown=()=>{this._saveUrlAndContent(),this.props.toggleMarkdown()};_saveUrlAndContent=async()=>{const{note:e}=this.props;if(!e||"trash"===e.type)return Promise.resolve();const{content:t}=this.state;return await g2(e.id,{url:this.#Ws(),content:"string"==typeof t?t:void 0})};_saveContent=e=>{const{note:t}=this.props;t&&g2(t.id,{content:e})};#Ws=()=>{const{autocompleteValue:e,typedUrl:t}=wg.getUrlfieldState(this._id);return(e||t)?.trim()};_onUrlFieldStoreChanged=()=>{const{typedUrl:e}=wg.getUrlfieldState(this._id);e!==this.state.typedUrl&&this.setState({typedUrl:e})};_onNoteStoreChanged=e=>{if("note"===this.props.note?.type){const e=s$.ZP.getNodeById(this.props.note.id);e&&this.setState({attachments:e.children})}};handleTitleChange=({currentTarget:e})=>{const{note:t}=this.props;if(!t)return;const s=e.value;this.setState({title:s},(()=>{g2(this.state.id,{title:s})}))};handleTitleKeyUp=e=>{e.keyCode!==mo.Z.KEY_RETURN&&e.keyCode!==mo.Z.KEY_ENTER||(e.stopPropagation(),e.preventDefault(),this.props.focusTree())};onUrlBlur=()=>{const{note:e}=this.props;e&&"trash"!==e.type&&g2(this.state.id,{url:this.#Ws()})};onTextBlur=()=>{const{note:e}=this.props;if(!e||"trash"===e.type)return;const{id:t,content:s}=this.state;"string"==typeof s&&g2(t,{content:s})};deleteAttachment=e=>{this.props.note&&Js.Z.removeNode(e)};handleTextEditorChange=e=>{this.setState({content:e})};handleFocus=e=>{e.currentTarget.select()};render(){const{note:e}=this.props,t=e&&!s$.ZP.isFolder(e),s=e&&s$.ZP.isFolder(e),n=!e,i=e?V()(e.dateAdded).format("l, LTS"):"",a=e?V()(e.dateModified).format("l, LTS"):"",o=Boolean(!e||s$.ZP.isSeparator(e)||s);return(0,zn.jsxs)("div",{className:Gn()("NotesEditor","cardview",{"NotesEditor--HasAttachments":e&&"note"===e.type&&e.children&&e.children.length>0}),ref:this.refContainer,onKeyDown:this.props.onKeyDown,children:[(0,zn.jsx)(p2,{windowId:this.context.vivaldiWindowId,disabled:o,onToggleMarkDown:this._toggleMarkdown,onDoCapture:this._doCapture,keyAccess:this.props.keyAccess,viewMarkdown:this.props.viewMarkdown,noteId:e?e.id:"-1",onOpenDialog:this.props.onOpenDialog}),t&&!this.props.viewMarkdown&&e&&(0,zn.jsx)("span",{className:"NotesEditor-Editor-Background",children:(0,zn.jsx)(u2,{ref:this.refTextEditor,onBlur:this.onTextBlur,className:"NotesEditor-Editor",disabled:o,content:e.content||"",onChange:this.handleTextEditorChange,onSave:this._saveContent},e.id)}),t&&this.props.viewMarkdown&&e&&(0,zn.jsx)(h2,{body:e.content||"",attachments:[]},e.content?e.content.length:"-1"),s&&e&&(0,zn.jsx)("div",{className:"folder",children:(0,zn.jsx)("input",{ref:this.refFolderName,type:"text",placeholder:(0,W.Z)("Folder"),title:(0,W.Z)("Edit folder name"),value:this.state.title,disabled:"trash"===e.type,onFocus:this.handleFocus,onChange:this.handleTitleChange,onKeyUp:this.handleTitleKeyUp})}),n&&(0,zn.jsx)("div",{className:"NotesEditor-EmptyPlaceholder ",onClick:this.props.onAdd,children:(0,W.Z)("Add a new note")}),e&&"note"===e.type&&(0,zn.jsx)(kY,{className:"NotesEditor-Attachments",attachments:this.state.attachments||[],onRemoveAttachment:this.deleteAttachment}),(0,zn.jsxs)("div",{className:Gn()("NotesEditor-Metadata",{disabled:o}),children:[(0,zn.jsx)("button",{className:"NotesEditor-MetaIcon NotesEditor-MetaIcon--Url",title:(0,W.Z)("Go to address"),disabled:o,tabIndex:o?-1:this.props.keyAccess,onClick:this._openUrl,onAuxClick:this._openUrl,dangerouslySetInnerHTML:{__html:Kn.iD7}}),(0,zn.jsx)(ym,{onBlur:this.onUrlBlur,autoFocus:!1,title:(0,W.Z)("Enter webpage address"),className:"cardview address",disabled:o,displayUrl:e?.url??"",typedUrl:this.state.typedUrl,autocompletionEnabled:!0,typedHistoryEnabled:!1,pageId:this._id,pageContext:this._pageContext,placeholder:e?(0,W.Z)("Address"):null,inputId:this._id,urlFragments:null}),(0,zn.jsxs)("div",{className:"NotesEditor-Created dateCreated",children:[(0,zn.jsx)("div",{className:"NotesEditor-MetaIcon",dangerouslySetInnerHTML:{__html:Kn.V_c}}),(0,zn.jsx)("span",{className:"NotesEditor-MetaIcon-Label",children:(0,W.Z)("Created:")}),(0,zn.jsx)("span",{children:i})]}),(0,zn.jsxs)("div",{className:"NotesEditor-Modified dateModified",title:(0,W.Z)("Date modified"),children:[(0,zn.jsx)("div",{className:"NotesEditor-MetaIcon",dangerouslySetInnerHTML:{__html:Kn.JHW}}),(0,zn.jsx)("span",{className:"NotesEditor-MetaIcon-Label",children:(0,W.Z)("Modified:")}),(0,zn.jsx)("span",{children:a})]})]})]})}}const v2=f2;var b2=s(34155);const C2=[Z.kKeyboardTabToAll,Z.kNotesPanelEditorHeight,Z.kNotesPanelShowMarkdown],w2=[{text:(0,W.Z)("Title"),value:"title",fullScreenTitle:(0,W.Z)("Sort by Title")},{text:(0,W.Z)("Address"),value:"url",fullScreenTitle:(0,W.Z)("Sort by Address")},{text:(0,W.Z)("Content"),value:"content",fullScreenTitle:(0,W.Z)("Sort by Content")},{text:(0,W.Z)("Created"),value:"dateAdded",fullScreenTitle:(0,W.Z)("Sort by Date Created")},{text:(0,W.Z)("Modified"),value:"dateModified",fullScreenTitle:(0,W.Z)("Sort by Last Modified Date")}];class y2 extends Un.PureComponent{static contextType=oi.Z;_editor=Un.createRef();_tree=Un.createRef();canDrop=!1;editorMaxHeight=900;refPanel=Un.createRef();refToolbar=Un.createRef();constructor(e){super(e);const t=A.Z.get(Z.kNotesPanelSorting);this.state={hasNotes:s$.ZP.hasNotes(),selectedNote:void 0,filter:"",editorHeight:this.props.prefValues[Z.kNotesPanelEditorHeight],sorting:{sortOrder:t.sortOrder,sortField:t.sortField,comparator:this.sortComparator}}}componentDidMount(){tn.ZP.addListener(this._onPanelStoreChange),this.context.addEventListener("resize",this._onWindowResize,!1),this._onWindowResize()}componentWillUnmount(){tn.ZP.removeListener(this._onPanelStoreChange),this.context.removeEventListener("resize",this._onWindowResize)}componentDidUpdate(e,t){!e.open&&this.props.open&&b2.nextTick((()=>this._applyTransitionState()))}_onWindowResize=()=>{const e=this.refPanel.current?.getBoundingClientRect().height;this.editorMaxHeight=e?e-250:900};_onStoreChange=(e,t)=>{switch(e.reason){case"added":{if(!t)return void this.setState({hasNotes:!0});const s=s$.ZP.getNodeById(e.id);this.setState({selectedNote:s},(()=>{s&&(this._tree.current?.selectById(e.id),this._editor.current?.focusPrimaryInput())}));break}case"changed":if(this.state.selectedNote?.id!==e.id)return;case"init":if(this.state.selectedNote){const e=this.state.selectedNote.id;this.setState({selectedNote:s$.ZP.getNodeById(e)})}}const s=s$.ZP.hasNotes();!s&&this.state.hasNotes&&(this.setState({selectedNote:void 0}),this.focusSearch()),this.setState({hasNotes:s})};onDropPanelButton=e=>{const t=e.dataTransfer.getData("text/plain"),s=this.context.vivaldiWindowId;(async function(e,t){const s=Ze.ZP.getActivePage(e);if(s){const{id:e,url:n}=s;if(await re.Z.utilities.getSelectedText(e)===t)return n}})(s,t).then((e=>{this.onBeforeCreate(!0),e?Js.Z.createNote(s,{content:t,url:e,type:"note"}):Js.Z.createNote(s,{content:t,type:"note"})}))};_applyTransitionState=()=>{const e=this.context.vivaldiWindowId,t=tn.ZP.getTransitionState(e,"PanelNotes");en.Z.clearTransitionState(e,"PanelNotes"),this._tree.current&&t?(t.selectId&&this._tree.current.selectById(t.selectId),t.setFocus&&this.focusTree()):this._tree.current&&!0===this.state.hasNotes?this.focusTree():this.focusSearch()};_onPanelStoreChange=()=>{const e=tn.ZP.getChangeReason();if(this.props.open)switch(e){case"setFocus":(0,vo.sT)(this.context.document,this.refPanel.current)||this.focusTree();break;case"display":b2.nextTick((()=>this._applyTransitionState()))}};onItemSelected=e=>{this.setState({selectedNote:e})};unSelectAll=()=>{this._tree.current?.unSelectAll(),this.setState({selectedNote:void 0})};onSortChange=(e,t)=>{this.setState((s=>({sorting:{...s.sorting,sortOrder:e,sortField:t}}))),I.Z.set(Z.kNotesPanelSorting,{sortOrder:e,sortField:t})};sortComparator=(e,t)=>{if("trash"===e.type)return 1;if("trash"===t.type)return-1;if(s$.ZP.isFolder(e)&&!s$.ZP.isFolder(t))return-1;if(s$.ZP.isFolder(t)&&!s$.ZP.isFolder(e))return 1;const{sortOrder:s,sortField:n}=this.state.sorting;if("title"===n)return this.sortByTitle(e,t,s);return ui.Z.getDefaultComparator(s,n)(e,t)};sortByTitle=(e,t,s)=>{if(s<=ui.Z.NO_SORTING)return 0;const n=e.title||MY(e),i=t.title||MY(t);return n||i?n?i?s===ui.Z.ASCENDING_SORT?n.toLowerCase().localeCompare(i.toLowerCase()):i.toLowerCase().localeCompare(n.toLowerCase()):s===ui.Z.ASCENDING_SORT?-1:1:s===ui.Z.ASCENDING_SORT?1:-1:0};getSelectedItem=()=>this._tree.current?.getSelectedItem();onBeforeCreate=e=>{e&&(this.props.prefValues[Z.kNotesPanelShowMarkdown]&&this.toggleMarkdown(),this.state.editorHeight===u.mT&&this.resizeToDefault()),this.setState({filter:""})};onAddNote=()=>{this._tree.current?.onAddNote()};onAddFolder=()=>{this._tree.current?.onAddFolder()};deleteSelectedItems=()=>{this._tree.current?.deleteSelectedItems()};handleFilterChange=e=>{this.setState({filter:e})};onSlidebarPosition=(e,t)=>{this.setState((e=>({editorHeight:Math.max(Math.min(e.editorHeight-t,this.editorMaxHeight),u.mT)})))};onSlidebarStop=()=>{this.setState((e=>{let t=e.editorHeight;return t<=u.Cn&&(t=u.mT),I.Z.set(Z.kNotesPanelEditorHeight,parseInt(t)),{editorHeight:t}}))};toggleMarkdown=()=>{I.Z.toggle(Z.kNotesPanelShowMarkdown,!0,!1)};resizeToDefault=()=>{this.setState((e=>{let t=e.editorHeight;return t>u.Cn?(t=u.mT,I.Z.set(Z.kNotesPanelEditorHeight,parseInt(t))):(t=300,I.Z.reset(Z.kNotesPanelEditorHeight)),{editorHeight:t}}))};focusSearch=()=>{this.refToolbar.current?.focusSearch()};focusTree=()=>{this._tree.current?.refTreeList.current?.focusTree()};onContextMenu=e=>{e.nativeEvent.buttons>0&&this.unSelectAll(),this._tree.current?.onContextMenu(e)};onDragEnter=e=>{this.canDrop=-1!==e.dataTransfer.types.findIndex((e=>"text/plain"===e)),e.preventDefault(),e.stopPropagation()};onDragOver=e=>{this.canDrop&&e.nativeEvent.dataTransfer&&(e.nativeEvent.dataTransfer.dropEffect="copy"),e.preventDefault(),e.stopPropagation()};onDrop=e=>{if(this.canDrop){const t=e.dataTransfer.getData("text/plain");t.length>0&&this._tree.current?.onAddNote({content:t})}e.preventDefault(),e.stopPropagation()};_onKeyDown=e=>{if("Escape"===e.key)return this.focusTree(),e.stopPropagation(),void e.preventDefault()};render(){if(!this.props.open)return null;const e=this.state.editorHeight>u.mT,t=Boolean(!this.state.selectedNote||this.state.selectedNote&&"trash"===this.state.selectedNote.type);return(0,zn.jsxs)("div",{ref:this.refPanel,className:"panel",id:"notes-panel",children:[(0,zn.jsxs)("header",{children:[(0,zn.jsx)(Cu,{title:this.props.title,showCloseButton:this.props.showCloseButton}),(0,zn.jsx)(UY,{ref:this.refToolbar,filter:this.state.filter,hasNotes:this.state.hasNotes,isDeleteDisabled:t,onFilterValueChange:this.handleFilterChange,onAddNote:this.onAddNote,onDeleteSelectedItems:this.deleteSelectedItems,onAddFolder:this.onAddFolder})]}),!0===this.state.hasNotes&&(0,zn.jsx)(Bu,{fields:w2,onSortChange:this.onSortChange,keyAccess:this.props.prefValues[Z.kKeyboardTabToAll],sortField:this.state.sorting.sortField,sortOrder:this.state.sorting.sortOrder}),(0,zn.jsxs)("section",{className:"outerScrollbar",onClick:this.unSelectAll,onContextMenu:!0===this.state.hasNotes?this.onContextMenu:null,children:[!1===this.state.hasNotes&&(0,zn.jsx)("div",{className:"no-notes",onDragEnter:this.onDragEnter,onDragOver:this.onDragOver,onDrop:this.onDrop,children:(0,zn.jsx)(WY,{onAddNote:this.onAddNote})}),(0,zn.jsx)(FY,{ref:this._tree,settings:"NOTES_TREE",filter:this.state.filter,sorting:this.state.sorting,onBeforeCreate:this.onBeforeCreate,onItemSelected:this.onItemSelected,onStoreChange:this._onStoreChange})]}),(0,zn.jsxs)("div",{className:Gn()("notes-editor",{collapsed:this.state.editorHeight===u.mT}),onDragEnter:!0===this.state.hasNotes?null:this.onDragEnter,onDragOver:!0===this.state.hasNotes?null:this.onDragOver,onDrop:!0===this.state.hasNotes?null:this.onDrop,style:{height:this.state.editorHeight},children:[(0,zn.jsx)(Mu.Z,{onSlidebarPosition:this.onSlidebarPosition,onStop:this.onSlidebarStop,onDoubleClick:this.resizeToDefault,returnOffset:!0,position:"bottom"}),e&&(0,zn.jsx)(v2,{ref:this._editor,note:this.state.selectedNote,onAdd:this.onAddNote,onOpenDialog:this.props.onOpenDialog,toggleMarkdown:this.toggleMarkdown,viewMarkdown:this.props.prefValues[Z.kNotesPanelShowMarkdown],keyAccess:this.props.prefValues[Z.kKeyboardTabToAll],onKeyDown:this._onKeyDown,focusTree:this.focusTree},this.state.selectedNote?this.state.selectedNote.id:-1)]})]})}}const x2=(0,zd.Z)(y2,C2),I2=[{text:(0,W.Z)("title","Title"),value:"title",fullScreenTitle:(0,W.Z)("Sort by Title")},{text:(0,W.Z)("Read state"),value:"read",fullScreenTitle:(0,W.Z)("Sort by Read State")},{text:(0,W.Z)("Date"),value:"lastUpdate",fullScreenTitle:(0,W.Z)("Sort by Date Updated")},{text:(0,W.Z)("Address"),value:"url",fullScreenTitle:(0,W.Z)("Sort by Address")}];class A2 extends Un.PureComponent{refTreeList=Un.createRef();static contextType=oi.Z;state={sorting:this.props.prefValues[Z.kReadingListPanelSorting]};onSortChange=(e,t)=>{const s={sortOrder:e,sortField:t};this.setState({sorting:s}),I.Z.set(Z.kReadingListPanelSorting,{sortOrder:e,sortField:t})};sortComparator=(e,t)=>{const{sortOrder:s,sortField:n}=this.state.sorting;return ui.Z.getDefaultComparator(s,n)(e,t)};getSelectedIds=()=>(this.refTreeList.current?.getAllSelectedItems()||[]).map((e=>e.id));deleteSelected=()=>{this.refTreeList.current?.onDelete()};onClickUrl=e=>{c.ZP.openURL(this.context.vivaldiWindowId,e,{singleton:!0}),R.Bz(e,!0)};onClick=(e,t)=>{this.onClickUrl(t.url)};onItemsActivated=(e,t)=>{t.forEach((e=>{e.url&&this.onClickUrl(e.url)}))};onOpenSelected=()=>{const e=this.getSelectedIds();e&&e.forEach((e=>{e&&this.onClickUrl(e)}))};onClickMark=(e,t,s)=>{s&&(0,wi.ZP)(s),R.Bz(e,t)};copy=e=>{jc.Z.copyTextToClipboard(e)};onRemoveSelected=async e=>{e.forEach((e=>R.Od(e)))};rowComponent=e=>{const t=e.node;return(0,zn.jsx)("div",{className:"readinglist-item-large",children:(0,zn.jsx)(Rm,{onClickMark:this.onClickMark,onClickRemove:()=>{},entry:t})},t.url)};getMenuCapability=async(e,t,s)=>{const n=this.context.vivaldiWindowId;switch(e.action){case"CONTEXT_OPEN":return{handler:()=>this.onOpenSelected(),isVisible:()=>Boolean(s),...t(n,e,{})};case"CONTEXT_MARK_READ":return{handler:()=>this.onClickMark(s.url,!0),isVisible:()=>Boolean(s)&&!s.read,...t(n,e,{})};case"CONTEXT_MARK_UNREAD":return{handler:()=>this.onClickMark(s.url,!1),isVisible:()=>Boolean(s)&&s.read,...t(n,e,{})};case"CONTEXT_COPY_URL":return{handler:()=>this.copy(s.url),isVisible:()=>Boolean(s),...t(n,e,{})};default:return{...t(n,e,{})}}};getMenuVisibility=(e,t)=>{if(!t)return!1;switch(e.action){case"CONTEXT_OPEN":case"CONTEXT_COPY_URL":case"CONTEXT_MARK_READ":case"CONTEXT_MARK_UNREAD":case"CONTEXT_DELETE":return!0;default:return!1}};menu={name:"readinglist",getCapability:this.getMenuCapability,getVisibility:this.getMenuVisibility};render(){const e=this.props.prefValues[Z.kReadingListPanelSingleClickOpens],t={sortOrder:this.state.sorting.sortOrder,sortField:this.state.sorting.sortField,comparator:this.sortComparator};return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)(Bu,{fields:I2,manualSorting:!1,onSortChange:this.onSortChange,keyAccess:this.props.keyAccess,compact:!0,sortField:this.state.sorting.sortField,sortOrder:this.state.sorting.sortOrder}),(0,zn.jsx)("section",{className:"outerScrollbar",children:(0,zn.jsx)(Mi,{ref:this.refTreeList,settings:"READING_LIST_TREE",rowComponent:this.rowComponent,nodes:this.props.nodes,onSelect:this.props.onItemSelected,menu:this.menu,hasChildren:iy.Z,isFolder:iy.Z,onItemsActivated:this.onItemsActivated,onItemClick:e?this.onClick:void 0,onItemDoubleClick:e?void 0:this.onClick,delete:this.onRemoveSelected,enableDragAndDrop:!1,supportsInlineEdit:!1,sorting:t,rowHeight:68})})]})}}const S2=A2,Z2=[Z.kReadingListPanelSingleClickOpens,Z.kReadingListPanelSorting];function T2(e){return e.map((e=>({...e,id:e.url})))}class E2 extends Un.PureComponent{static contextType=oi.Z;winId=this.context.vivaldiWindowId;_tree=Un.createRef();state={items:[],selected:"",isUrlSupported:!1,filter:""};componentDidMount(){const{selectWindow:e}=this.context;Nm.Z.addListener(this._onStoreChanged),Ze.ZP.addListener(this._onPageStoreChanged,e),this._onStoreChanged(),this._onPageStoreChanged()}componentWillUnmount(){Nm.Z.removeListener(this._onStoreChanged),Ze.ZP.removeListener(this._onPageStoreChanged)}_onStoreChanged=()=>{const e=this.state.filter?Nm.Z.getFilter(this.state.filter):Nm.Z.getList();this.setState({items:T2(e)})};_onPageStoreChanged=()=>{const{url:e}=Ze.ZP.unsafeGetActivePage(this.winId);this.setState({isUrlSupported:R.MT(e)})};addCurrentPage=()=>R.IH(this.context.vivaldiWindowId);deleteSelected=()=>this._tree.current?.deleteSelected();onToggleReadStatus=()=>{this.setState((e=>{const t=e.items.find((t=>t.id===e.selected));t&&R.Bz(t.url,!t.read)}))};handleFilterChange=e=>{const t=e.target.value;this.setState({filter:t}),Un.startTransition((()=>{const e=T2(t?Nm.Z.getFilter(t):Nm.Z.getList());this.setState({items:e})}))};focusTree=()=>{this._tree.current&&this._tree.current.refTreeList.current?.focusTree()};onItemSelected=e=>{if(e){if(e.id===this.state.selected)return;this.setState({selected:e.id})}else this.setState({selected:""})};renderEmptyState=()=>(0,zn.jsxs)("div",{className:"panel-empty-state",children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.MLu}}),(0,zn.jsx)("h1",{children:(0,W.Z)("Add your first entry to the reading list")}),(0,zn.jsx)("p",{className:"faded-text",children:(0,W.Z)("Click the “+“ button to add the current webpage to the reading list.")})]});render(){if(!this.props.open)return null;const e=this.state.items.find((e=>e.url===this.state.selected)),t=0===this.state.items.length&&!this.state.filter;return(0,zn.jsxs)("div",{className:"panel",id:"readinglist",children:[(0,zn.jsxs)("header",{children:[(0,zn.jsx)(Cu,{title:this.props.title,showCloseButton:this.props.showCloseButton}),(0,zn.jsxs)("div",{className:"toolbar toolbar-default toolbar-wrap",role:"toolbar","aria-label":(0,W.Z)("toolbar label","Reading List"),children:[(0,zn.jsx)("input",{type:"search",placeholder:(0,W.Z)("verb","Search"),value:this.state.filter,disabled:t,onChange:this.handleFilterChange}),(0,zn.jsxs)("div",{className:"toolbar",children:[(0,zn.jsxs)("div",{className:"toolbar-group",children:[(0,zn.jsx)(oa.ZP,{onClick:this.addCurrentPage,tooltip:(0,W.Z)("Add current page"),disabled:!this.state.isUrlSupported,image:Kn.md4.small}),(0,zn.jsx)(oa.ZP,{onClick:this.deleteSelected,disabled:""===this.state.selected,image:Kn.M2k.small,tooltip:(0,W.Z)("other","Delete")})]}),(0,zn.jsx)(oa.ZP,{onClick:this.onToggleReadStatus,tooltip:e?.read?(0,W.Z)("Set as Unread"):(0,W.Z)("Set as Read"),disabled:""===this.state.selected,image:e?.read?Kn.sgm.small:Kn.D7r.small})]})]})]}),t?this.renderEmptyState():(0,zn.jsx)(S2,{ref:this._tree,nodes:this.state.items,keyAccess:this.props.keyAccess,focusTree:this.focusTree,prefValues:this.props.prefValues,onItemSelected:this.onItemSelected})]})}}const k2=(0,zd.Z)(E2,Z2);var N2=(0,zn.jsxs)("g",{fill:"none",stroke:"currentColor",children:[(0,zn.jsx)("path",{d:"M1 1.5h3.5v-1h7v1h-8H15"}),(0,zn.jsx)("path",{d:"M3.5 3.5v11h9v-11zm3 8v-4zm3 0v-4z"})]});function _2(){return N2}var P2=(0,zn.jsxs)("g",{fill:"none",stroke:"currentColor",children:[(0,zn.jsx)("path",{d:"M1.5,1.5 L1.5,9.5"}),(0,zn.jsx)("path",{d:"M9.5,1.5 L9.5,9.5"}),(0,zn.jsx)("path",{d:"M1.5,9.5 L9.5,9.5"}),(0,zn.jsx)("path",{d:"M1.5,1.5 L9.5,1.5"}),(0,zn.jsx)("path",{d:"M3.5,9.5 L3.5,11.5"}),(0,zn.jsx)("path",{d:"M11.5,3.5 L11.5,11.5"}),(0,zn.jsx)("path",{d:"M3.5,11.5 L11.5,11.5"}),(0,zn.jsx)("path",{d:"M9.5,3.5 L11.5,3.5"}),(0,zn.jsx)("path",{d:"M5.5,11.5 L5.5,13.5"}),(0,zn.jsx)("path",{d:"M13.5,5.5 L13.5,13.5"}),(0,zn.jsx)("path",{d:"M5.5,13.5 L13.5,13.5"}),(0,zn.jsx)("path",{d:"M11.5,5.5 L13.5,5.5"})]});function M2(){return P2}var D2=(0,zn.jsxs)("g",{transform:"translate(3, 2)",fill:"none",stroke:"currentColor",children:[(0,zn.jsx)("polygon",{points:"2.5 5.5 6.5 9.5 7.5 9.5 7.5 5.5 11.5 2.5 9.5 0.5 6.5 4.5 2.5 4.5"}),(0,zn.jsx)("polygon",{points:"0 12 3 8 4 9"})]});function O2(){return D2}var j2=(0,zn.jsxs)("g",{fill:"none",stroke:"currentColor",children:[(0,zn.jsx)("path",{d:"M13 12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h10Z"}),(0,zn.jsx)("path",{fill:"currentColor",d:"M6 12h4v2H6z",opacity:".5"}),(0,zn.jsx)("path",{fill:"currentColor",d:"M1 10h14a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2Z"})]});function L2(){return j2}var R2=(0,zn.jsxs)("g",{fill:"none",stroke:"currentColor",children:[(0,zn.jsx)("path",{d:"M10 15C11.1046 15 12 14.1046 12 13V3C12 1.89543 11.1046 1 10 1H6C4.89543 1 4 1.89543 4 3V13C4 14.1046 4.89543 15 6 15H10Z",stroke:"currentColor"}),(0,zn.jsx)("path",{d:"M4 13H12V13C12 14.1046 11.1046 15 10 15H6C4.89543 15 4 14.1046 4 13V13Z",fill:"currentColor"}),(0,zn.jsx)("circle",{cx:"8",cy:"3.25",r:"0.75",fill:"currentColor"})]});function B2(){return R2}var F2=(0,zn.jsxs)("g",{fill:"none",stroke:"currentColor",children:[(0,zn.jsx)("path",{stroke:"currentColor",d:"M11 15a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h6Z"}),(0,zn.jsx)("path",{fill:"currentColor",d:"M3 2a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v1H3V2ZM3 14a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1H3v1Z"})]});function W2(){return F2}var U2=(0,zn.jsx)("g",{fill:"none",stroke:"currentColor",children:(0,zn.jsx)("path",{d:"M13.246 7.338C14.268 7.668 15 8.558 15 9.6c0 1.326-1.17 2.9-2.634 2.9H3.5C2.044 12.5 1 10.922 1 9.6c0-1.051.735-1.944 1.77-2.269C2.913 6.354 3.827 5.6 4.936 5.6c.584 0 1.114.208 1.505.549C6.92 4.899 8.22 4 9.75 4c1.934 0 3.5 1.432 3.5 3.2l-.004.138Z"})});function V2(){return U2}var H2=(0,zn.jsx)("polygon",{points:"16.5 3.5 16.5 0.5 1.5 0.5 1.5 3.5"}),G2=(0,zn.jsx)("path",{d:"M1.5,3.5 L1.5,12.5"}),K2=(0,zn.jsx)("path",{d:"M16.5,3.5 L16.5,12.5"}),z2=(0,zn.jsx)("path",{d:"M1.5,12.5 L16.5,12.5"}),$2=(0,zn.jsx)("path",{d:"M4.5,0.5 L4.5,3.5"}),Y2=(0,zn.jsx)("path",{d:"M7.5,0.5 L7.5,3.5"}),X2=(0,zn.jsx)("polygon",{points:"4.5 6.5 4.5 8.5 7.5 6.5",strokeWidth:"2"});function Q2({activeWindow:e}){return(0,zn.jsxs)("g",{transform:"translate(-1, 1)",fill:"none",stroke:"currentColor",children:[H2,G2,K2,z2,$2,Y2,e&&X2]})}var q2=(0,zn.jsxs)("g",{stroke:"currentColor",fill:"none",children:[(0,zn.jsx)("path",{d:"M6.53846 15C5.68879 15 5 14.3112 5 13.4614V6.53862C5 5.68844 5.68945 4.9994 6.53954 5L13.4626 5.00489C14.3118 5.00549 15 5.69418 15 6.54354V13.4614C15 14.3112 14.3112 15 13.4615 15H6.53846Z",strokeLinecap:"round",strokeLinejoin:"round"}),(0,zn.jsx)("path",{d:"M11 4.85666V2.20471C11 1.54223 10.4632 1.00506 9.80084 1.0046L3.20084 1C2.53777 0.999538 2 1.53698 2 2.20011V8.79989C2 9.46271 2.53726 10 3.2 10H4.85714",strokeLinejoin:"round",strokeDasharray:"2 2"})]});function J2(){return q2}var e4=(0,zn.jsxs)("g",{stroke:"currentColor",fill:"none",children:[(0,zn.jsx)("path",{d:"M2 4.54545L8 1L14 4.54545L8 8L2 4.54545Z",strokeLinecap:"round",strokeLinejoin:"round"}),(0,zn.jsx)("path",{d:"M14 8L8 11.5L2 8",strokeLinecap:"round",strokeLinejoin:"round"}),(0,zn.jsx)("path",{d:"M14 11.5L8 15L2 11.5",strokeLinecap:"round",strokeLinejoin:"round"})]});function t4(){return e4}var s4=(0,zn.jsxs)("g",{stroke:"currentColor",fill:"none",children:[(0,zn.jsx)("path",{d:"M8.66668 1.36626C8.44741 1.34449 8.22501 1.33334 8.00001 1.33334C4.31811 1.33334 1.33334 4.31811 1.33334 8.00001C1.33334 11.6819 4.31811 14.6667 8.00001 14.6667C11.6819 14.6667 14.6667 11.6819 14.6667 8.00001C14.6667 7.54341 14.6207 7.09748 14.5333 6.66668",strokeLinecap:"round",strokeLinejoin:"round"}),(0,zn.jsx)("path",{d:"M6.66667 7.33333H5.80474C5.5029 7.33333 5.21343 7.2134 5 7M9.33333 7.33333H10.1953C10.4971 7.33333 10.7866 7.2134 11 7",strokeLinecap:"round",strokeLinejoin:"round"}),(0,zn.jsx)("path",{d:"M7.99999 12C8.73637 12 9.33332 11.4031 9.33332 10.6667C9.33332 9.9303 8.73637 9.33334 7.99999 9.33334C7.26361 9.33334 6.66666 9.9303 6.66666 10.6667C6.66666 11.4031 7.26361 12 7.99999 12Z",strokeLinecap:"round",strokeLinejoin:"round"}),(0,zn.jsx)("path",{d:"M11.3333 1.33334H13.2983C13.7117 1.33334 13.9183 1.33334 13.9734 1.46674C14.0285 1.60014 13.8878 1.76016 13.6065 2.08021L11.9897 3.91981C11.7085 4.23986 11.5678 4.39988 11.6229 4.53328C11.6779 4.66668 11.8846 4.66668 12.298 4.66668H14",strokeLinecap:"round",strokeLinejoin:"round"})]});function n4(){return s4}var i4=(0,zn.jsx)(_2,{}),a4=(0,zn.jsx)(M2,{}),o4=(0,zn.jsx)(O2,{}),r4=(0,zn.jsx)(L2,{}),l4=(0,zn.jsx)(B2,{}),d4=(0,zn.jsx)(W2,{}),c4=(0,zn.jsx)(V2,{}),h4=(0,zn.jsx)(J2,{}),u4=(0,zn.jsx)(t4,{}),p4=(0,zn.jsx)(n4,{});function g4({shape:e,url:t,activeWindow:s=!1,leftMargin:n}){const i="trash"===e,a=Gn()({"folder-icon":!i,"folder-trash":i});return"emoji"===e||"workspace"===e?t?(0,zn.jsx)(Vn.ZP,{className:"workspace-icon",url:t,loadType:"emoji"===e?"emoji":"faviconFromCache"}):(console.warn("Url missing for workspace/emoji type"),null):(0,zn.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",className:a,style:n?{marginLeft:n}:null,children:[i&&i4,"stack"===e&&a4,"pinned"===e&&o4,"desktop"===e&&r4,"phone"===e&&l4,"tablet"===e&&d4,"syncFolder"===e&&c4,"folder"===e&&(0,zn.jsx)(Q2,{activeWindow:s}),"duplicatesFolder"===e&&h4,"workspacesFolder"===e&&u4,"inactiveFolder"===e&&p4]})}const m4=Un.memo(g4),f4=!1;function v4(e,t,s){const n=(e,t,s,n,i)=>{const a=(e,t,s,n)=>{const i=[];for(let a=0;a<s.length;a++){const o=s[a];if(o.group){let s=i.find((e=>"stack"===e.type&&e.group===o.group));if(s||(s={type:"stack",id:o.id.toString()+"_tabstack",index:t+i.length,parentId:e,group:o.group,url:"",name:(0,W.Z)("title","Stack")+" - "+(o.groupName||o.name),rawName:o.groupName||o.name,quarantine:!1,children:[]},i.push(s)),s.children){const e=s.children.length;s.children.push({type:"tab",id:o.id.toString(),index:e,parentId:s.id,group:"",url:o.url,name:o.name,quarantine:o.quarantine})}}else void 0!==n&&n!==o.quarantine||i.push({type:"tab",id:o.id.toString(),index:t+i.length,parentId:e,group:"",url:o.url,name:o.name,quarantine:o.quarantine})}return i},o=n.filter((e=>e.pinned===s)).map(((s,n)=>{if(void 0===i||i===s.quarantine)return{type:"tab",id:s.id.toString(),index:t+n,parentId:e,group:s.group,groupName:s.group?s.fixedGroupName:void 0,url:s.url,name:s.fixedName||(0,vs.d6)(s.url,s.name||s.url),quarantine:s.quarantine}})).filter(Boolean);if(s){const s=e+"_pinned";return[{type:"pinned",id:s,parentId:e,index:t,group:"",url:"",name:(0,W.Z)("Pinned Tabs"),children:a(s,0,o,i),quarantine:!1}]}return a(e,t,o)},i=(e,s,i)=>t.windows.map((t=>{const s=t.id.toString()+"_"+e,a=n(s,0,!0,t.tabs,i),o=n(s,a.length,!1,t.tabs,i),r=[...a,...o];if(r.length)return{type:"window",id:s,index:0,parentId:e,group:"",name:(0,W.Z)("title","Window"),url:"",quarantine:!1,children:r}})).filter(Boolean).map(((e,t)=>({...e,index:t+s}))),a=(e,s,i)=>t.workspaces.map((t=>{const s=t.id.toString()+"_"+e,a=n(s,0,!0,t.tabs,i),o=n(s,a.length,!1,t.tabs,i),r=[...a,...o];if(r.length)return{type:"workspace",id:s,index:0,parentId:e,group:"",name:(0,W.Z)("title","Workspace")+" - "+t.name,rawName:t.name,url:"",icon:t.icon,emoji:t.emoji,quarantine:!1,children:r}})).filter(Boolean).map(((e,t)=>({...e,index:t+s}))),o=i(e,0,void 0),r=a(e,o.length,void 0);let l=[];if(s){const t="trash",s=i(t,0,!0),n=a(t,s.length,!0);l=[{type:"trash",id:t,index:o.length+r.length,parentId:e,group:"",name:(0,W.Z)("Trash"),url:"",quarantine:!1,children:[...s,...n]}]}return[...o,...r,...l]}function b4(e,t,s){if(!t.trim())return v4(e,s,f4);const n=(e,t)=>e.name.toLowerCase().includes(t),i=function(e,t,s){let a=!1;for(let o=0;o<e.length;o++){const r=e[o];let l=!1;if(r.children){const e={...r,children:[]};i(r.children,e.children,s)&&(t.push(e),a=!0,l=!0)}if(!l&&n(r,s)){const e={...r};t.push(e),a=!0}}return a},a=[];return i(v4(e,s,f4),a,t.toLowerCase()),a}class C4 extends Un.PureComponent{static contextType=oi.Z;refTreeList=Un.createRef();constructor(e){super(e),this.state={rootId:"0",nodes:b4("0",e.filter,e.content)}}componentDidUpdate(e){this.props.content===e.content&&this.props.filter===e.filter||this.setState({nodes:b4("0",this.props.filter,this.props.content)})}_getNodeById=e=>{const t=function(s){for(let n=0;n<s.length;n++){const i=s[n];if(i.id===e)return i;if(i.children){const e=t(i.children);if(e)return e}}};return t(this.state.nodes)};_isFolder=e=>"tab"!==e.type;_isTab=e=>"tab"===e.type;_isStack=e=>"stack"===e.type;_isPin=e=>"pinned"===e.type;_isWorkspace=e=>"workspace"===e.type;_isWindow=e=>"window"===e.type;_isPinnable=e=>this._isTab(e)||this._isStack(e);_isPinned=e=>{if(this._isPinnable(e)){let t=this._getNodeById(e.parentId);for(;t;){if("pinned"===t.type)return!0;t=this._getNodeById(t.parentId)}}return!1};_isStacked=e=>{if(this._isTab(e)){let t=this._getNodeById(e.parentId);for(;t;){if(this._isStack(t))return!0;t=this._getNodeById(t.parentId)}}return!1};_isValidForEdit=e=>{const t=this._getNodeById(e);return!!t&&(this._isWorkspace(t)||this._isStack(t)||this._isTab(t))};_hasChildren=e=>this._isFolder(e)&&Boolean(e.children?.length);_handleExpandClick=(e,t)=>{const s=e.altKey;this.refTreeList.current?.toggleSelectedExpansion(t,s)};_getChildren=e=>e.children??[];_getWindow=e=>{let t=e;for(;t&&!this._isWindow(t);)t=this._getNodeById(t.parentId);return t};_getWorkspace=e=>{let t=e;for(;t&&!this._isWorkspace(t);)t=this._getNodeById(t.parentId);return t};_getGroup=e=>{let t=e;for(;t&&!this._isStack(t);)t=this._getNodeById(t.parentId);return t};_getSelected=()=>(this.refTreeList.current?.getAllSelectedItems()??[]).map((e=>this._getNodeById(e.id))).filter(Boolean);_getSelectedUrls=()=>this._getSelected().filter((e=>this._isTab(e))).map((e=>e.url));_openSession=e=>{const t=this._getSelected().filter((e=>this._isTab(e))).map((e=>Number(e.id)));gn.Z.open(this.context.vivaldiWindowId,[this.props.content.id],e,t)};_openInTab=(e,t)=>{const s={inCurrent:e,inBackground:!e&&(t||A.Z.get(Z.kTabsOpenNewInBackground)),inNewWindow:!1,incognito:!1,transition:re.Z.historyPrivate.TransitionType.AUTO_TOPLEVEL};Jn.ZP.openUrls(this.context.vivaldiWindowId,this._getSelectedUrls(),s,!0)};_openInNewWindow=e=>{const t={inCurrent:!1,inBackground:!1,inNewWindow:!0,incognito:e,transition:re.Z.historyPrivate.TransitionType.AUTO_TOPLEVEL};Jn.ZP.openUrls(this.context.vivaldiWindowId,this._getSelectedUrls(),t,!0)};_onNodeDoubleClick=(e,t)=>{this._isTab(t)&&e.button!==ai.Z.kCenter&&this._openSession(!0)};_onNodeMouseUp=(e,t)=>{this._isTab(e)&&t.button===ai.Z.kCenter&&(this._openSession(!0),t.preventDefault(),t.stopPropagation())};_openWithEventModifiers=e=>{this._openSession(!0)};_isValidDragSource=e=>this._isTab(e)||this._isStack(e);_validateForDrag=e=>{const t=e.map((e=>this._getNodeById(e))).filter(Boolean);if(1===t.length&&this._isStack(t[0]))return[t[0].id];return t.filter((e=>this._isStack(e))).length>1?[]:e.map((e=>this._getNodeById(e))).filter(Boolean).filter((e=>this._isTab(e))).map((e=>e.id))};_getDragData=(e,t)=>{const s=t.map((e=>this._getNodeById(e))).filter(Boolean).filter((e=>this._isTab(e)));switch(e){case"text/plain":case"vivaldi/x-title":{const e=[];return s.forEach((t=>{e.push(t.name)})),e.join("\r\n")}case"text/uri-list":case"vivaldi/x-uri-list":{const e=[];return s.forEach((t=>{this._isTab(t)&&e.push(t.url)})),e.join("\r\n")}default:return""}};_getDropSupport=(e,t)=>{const s={available:!1,onto:!1,edge:"both"};return t.dataTransfer.types.some((e=>e===Q1.AP))&&(s.available=!0,s.onto=this._isFolder(e),this._isWindow(e)?s.edge="none":this._isPin(e)&&(s.edge="below")),s};_copy=(e,t)=>{const{clipboardData:s}=e;if(s){const e=t.map((e=>e.url)).filter(Boolean).map((e=>vs.jk.getHoverUrl(e))).join("\n");s.setData("text/plain",e),s.setData("text/uri-list",e),s.setData("vivaldi/x-uri-list",e)}e.preventDefault()};_onDelete=e=>gn.Z.modifyContent(this.props.content.id,{ids:this._validateForDeletion(e).map((e=>Number(e))),remove:!0});_onDeleteWithoutQuarantine=()=>{const e=this._getSelected().filter((e=>this._isTab(e))).map((e=>Number(e.id)));return gn.Z.modifyContent(this.props.content.id,{ids:e,remove:!0})};_setPinned=e=>{const t=this._getSelected(),s=t.filter((e=>"stack"===e.type)).map((e=>this._getChildren(e))).filter(Boolean).reduce(((e,t)=>e.concat(t)),[]),n=t.filter((e=>this._isTab(e))).filter((e=>-1===s.findIndex((t=>t===e.id)))),i=[...s,...n].map((e=>Number(e.id)));gn.Z.modifyContent(this.props.content.id,{pin:e,ids:i})};_getNodesForNewStack=()=>this._getSelected().filter((e=>!this._isWindow(e)&&!this._isWorkspace(e))).flatMap((e=>e.children||e)).flatMap((e=>e.children||e));_setTabStack=e=>{const t=this._getNodesForNewWindow();if(t.length>0){const s=t.map((e=>Number(e.id)));e?gn.Z.modifyContent(this.props.content.id,{tabstack:!0,ids:s,target:{beforeTabId:-1,group:crypto.randomUUID()}}):gn.Z.modifyContent(this.props.content.id,{tabstack:!1,ids:s})}};_getNodesForNewWindow=()=>this._getSelected().filter((e=>!this._isWindow(e)&&!this._isWorkspace(e))).flatMap((e=>e.children||e)).flatMap((e=>e.children||e));_setWindow=()=>{const e=this._getNodesForNewWindow();if(e.length>0){const t=[];e.forEach((e=>{const s=this._getGroup(e);s&&!t.find((e=>e.group===s.group))&&t.push({group:s.group,alias:crypto.randomUUID()})})),gn.Z.modifyContent(this.props.content.id,{window:!0,ids:e.map((e=>Number(e.id))),groupAliases:t})}};_setWorkspace=()=>{const e=this._getNodesForNewWindow();if(e.length>0){const t=[];e.forEach((e=>{const s=this._getGroup(e);s&&!t.find((e=>e.group===s.group))&&t.push({group:s.group,alias:crypto.randomUUID()})})),gn.Z.modifyContent(this.props.content.id,{workspace:!0,ids:e.map((e=>Number(e.id))),groupAliases:t,workspaceId:Date.now(),workspaceState:{groups:t,item:{id:Date.now(),name:(0,W.Z)("command","New Workspace"),icon:m_.Z.getDefaultIcon(),emoji:""}}})}};_validateForDeletion=e=>e.map((e=>this._getNodeById(e))).filter(Boolean).filter((e=>Boolean(e?.quarantine))).map((e=>e.id));_setQuarantine=async e=>{const t=this._getSelected().filter((e=>this._isTab(e))).map((e=>Number(e.id)));gn.Z.modifyContent(this.props.content.id,{ids:t,quarantine:e})};_getTitle=e=>{const t=this._getNodeById(e);return t?t.rawName??t.name:""};_getId=e=>e.split("_")[0];_setTitle=(e,t)=>{const s=this._getNodeById(e);if(s)switch(s.type){case"workspace":gn.Z.modifyContent(this.props.content.id,{ids:[Number(this._getId(e))],type:"workspace",title:t});break;case"stack":s.children?.length&&gn.Z.modifyContent(this.props.content.id,{ids:s.children.map((e=>Number(e.id))),type:"group",title:t});break;case"tab":s.children||gn.Z.modifyContent(this.props.content.id,{ids:[Number(s.id)],type:"tab",title:t})}};_canMoveUpDown=(e,t)=>this._isTab(e)||this._isStack(e);_onMove=(e,t,s)=>{const n=e=>{for(const t of e){if(this._isTab(t))return t;if(this._isStack(t)&&t.children){const e=n(t.children);if(e)return e}}for(const t of e)if(t.children){const e=n(t.children);if(e)return e}},i=void 0===t.parentId?void 0:this._getNodeById(t.parentId),a=this._getNodeById(e[0]);if(i&&a){let s,o,r;this._isPin(i)||this._isPinned(i)?this._isPinned(a)||(s=!0):this._isPinned(a)&&(s=!1),this._isStack(i)?(this._getGroup(a)?.group??"")!==i.group&&(o=i.group):this._getGroup(a)&&(this._isStack(a)||(o=""));const l=this._getWorkspace(i);let d;l?(this._getWorkspace(a)?.id??"")!==l.id&&(r=Number(this._getId(l.id))):this._getWorkspace(a)&&(r=-1),this._isStack(a)&&(e=a.children?a.children.map((e=>e.id)):[]);const c=t.index??0;if(i.children&&i.children.length>c){const e=i.children,t=e[c];d=this._isTab(t)?t:n(e.slice(c))}const h=this._getWindow(i),u={beforeTabId:d?Number(d.id):-1};void 0!==o&&(u.group=o),void 0!==s&&(u.pinned=s),h&&(u.windowId=Number(this._getId(h.id))),void 0!==r&&(u.workspace=r),gn.Z.modifyContent(this.props.content.id,{move:!0,ids:e.map((e=>Number(this._getId(e)))),target:u})}return Promise.resolve([])};_handleMouseEnter=(e,t)=>{this._isTab(t)&&h.Z.setStatus(e,vs.jk.getHoverUrl(t.url))};_handleMouseLeave=e=>{h.Z.clearStatus(e)};getMenuCapability=async(e,t,s)=>{const n=this.context.vivaldiWindowId,i="tab"===s.type,a=this.refTreeList.current?.getSelectedCount()??0;switch(e.action){case"CONTEXT_OPEN_SESSION_IN_NEW_WINDOW":return{handler:()=>this._openSession(!0),isVisible:()=>i,...t(n,e,{})};case"CONTEXT_OPEN_SESSION":return{handler:()=>this._openSession(!1),isVisible:()=>i,...t(n,e,{})};case"CONTEXT_OPEN_IN_NEW_TAB":return{handler:()=>this._openInTab(!1,!1),isVisible:()=>i,...t(n,e,{})};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{handler:()=>this._openInTab(!1,!0),isVisible:()=>i&&!A.Z.get(Z.kTabsOpenNewInBackground),...t(n,e,{})};case"CONTEXT_OPEN_IN_TAB":return{handler:()=>this._openInTab(!0,!1),isVisible:()=>i,...t(n,e,{})};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{handler:()=>this._openInNewWindow(!1),isVisible:()=>i,...t(n,e,{})};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{handler:()=>this._openInNewWindow(!0),isVisible:()=>i,...t(n,e,{})};case"CONTEXT_OPEN_LINK_MENU":return{handler:()=>{},isVisible:()=>i,...t(n,e,{})};case"CONTEXT_QUARANTINE":return{handler:()=>this._setQuarantine(!s.quarantine),isVisible:()=>i,checked:s.quarantine,...t(n,e,{})};case"CONTEXT_DELETE_WITHOUT_QUARANTINE":return{handler:()=>this._onDeleteWithoutQuarantine(),isVisible:()=>i,...t(n,e,{})};case"CONTEXT_PIN":return{handler:()=>this._setPinned(!this._isPinned(s)),isVisible:()=>this._isPinnable(s)&&!this._isPinned(s),...t(n,e,{})};case"CONTEXT_UNPIN":return{handler:()=>this._setPinned(!this._isPinned(s)),isVisible:()=>this._isPinnable(s)&&this._isPinned(s),...t(n,e,{})};case"CONTEXT_NEW_STACK":return{handler:()=>this._setTabStack(!0),isVisible:()=>this._getNodesForNewStack().length>=2,...t(n,e,{})};case"CONTEXT_REMOVE_STACK":return{handler:()=>this._setTabStack(!1),isVisible:()=>1===a&&this._isStack(s),...t(n,e,{})};case"CONTEXT_NEW_WINDOW":return{handler:()=>this._setWindow(),isVisible:()=>this._getNodesForNewWindow().length>0,...t(n,e,{})};case"CONTEXT_NEW_WORKSPACE":return{handler:()=>this._setWorkspace(),isVisible:()=>this._getNodesForNewWindow().length>0,...t(n,e,{})};default:return{...t(n,e,{})}}};getMenuVisibility=(e,t)=>{if(t)switch(e.action){case"CONTEXT_COPY":return this._isTab(t);case"CONTEXT_RENAME":return this._isValidForEdit(t.id);case"CONTEXT_DELETE":return t.quarantine;case"CONTEXT_EXPAND_ALL":case"CONTEXT_COLLAPSE_ALL":return!0;default:return!1}else switch(e.action){case"CONTEXT_EXPAND_ALL":case"CONTEXT_COLLAPSE_ALL":return!0;default:return!1}};getFolderShape=e=>{switch(e.type){case"trash":return"trash";case"stack":return"stack";case"pinned":return"pinned";case"workspace":if(e.emoji)return"emoji";if(e.icon)return"workspace"}return"folder"};getFolderIconUrl=e=>{if("workspace"===e.type){if(e.emoji)return e.emoji;if(e.icon)return e.icon}return""};_getChildCount=e=>{let t=0;const s=e=>{e.forEach((e=>{this._isFolder(e)&&e.children?s(e.children):t++}))};return this._isFolder(e)&&e.children&&(s(e.children),0===t&&this._isWindow(e)&&(t=1)),t};rowComponent=e=>{const t=e.node,s=e.level,n=(s+1)*Ni,i=s*Ni,a=i+10,o=t.url,r=t.quarantine&&!0,l=t.children?this._getChildCount(t):0,{favIconUrl:d,favIconLoadType:c}=(0,vs.yl)(o,""),h=this.context.vivaldiWindowId;return[(0,zn.jsxs)("label",{title:t.name,onMouseEnter:()=>this._handleMouseEnter(h,t),onMouseLeave:()=>this._handleMouseLeave(h),children:[this._hasChildren(t)&&(0,zn.jsx)("span",{className:"expand-icon",style:{marginLeft:i},onMouseUp:e=>this._handleExpandClick(e,t.id),dangerouslySetInnerHTML:{__html:Kn.nfH}}),this._isFolder(t)&&(0,zn.jsx)(m4,{leftMargin:this._hasChildren(t)?0:n,shape:this.getFolderShape(t),url:this.getFolderIconUrl(t)}),!this._isFolder(t)&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("span",{style:{marginLeft:a}}),o.startsWith("<svg")?(0,zn.jsx)("span",{className:"svg-icon",dangerouslySetInnerHTML:{__html:o}}):(0,zn.jsx)(Vn.ZP,{className:"fav-icon",url:d,loadType:c})]}),void 0!==e.inlineEditText&&(0,zn.jsx)("input",{type:"text",value:e.inlineEditText,onChange:e.onChange,onFocus:e.onFocus,onBlur:e.onBlur,autoFocus:!0}),void 0===e.inlineEditText&&r&&(0,zn.jsx)("span",{children:(0,zn.jsx)("s",{children:t.name})}),void 0===e.inlineEditText&&!r&&(0,zn.jsx)("span",{children:t.name}),this._hasChildren(t)&&(0,zn.jsx)("span",{className:"item-count",children:l})]},"window__panel__"+t.id)]};getRowComponentProps=e=>({...e});menu={name:"sessioncontentlist",getCapability:this.getMenuCapability,getVisibility:this.getMenuVisibility};render(){return(0,zn.jsx)(Mi,{ref:this.refTreeList,rootId:this.state.rootId,nodes:this.state.nodes,folderMode:"expand",settings:"CONTENT_TREE",onItemMouseUp:this._onNodeMouseUp,onItemDoubleClick:this._onNodeDoubleClick,onItemsActivated:this._openWithEventModifiers,supportsUpDownMove:this._canMoveUpDown,onMove:this._onMove,isValidToEdit:this._isValidForEdit,validateForDeletion:this._validateForDeletion,isValidDragSource:this._isValidDragSource,validateForDrag:this._validateForDrag,mimeType:Q1.AP,getDragData:this._getDragData,getDropSupport:this._getDropSupport,getTitle:this._getTitle,saveTitle:this._setTitle,onCopy:this._copy,delete:this._onDelete,rowComponent:this.rowComponent,getRowComponentProps:this.getRowComponentProps,hasChildren:this._hasChildren,isFolder:this._isFolder,menu:this.menu,supportsInlineEdit:!0})}}const w4=C4;var y4=(0,zn.jsx)("br",{});function x4({onAdd:e}){return(0,zn.jsx)("div",{className:"notes-welcome",children:(0,zn.jsxs)("div",{className:"note-empty-state",onClick:e,children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.vOf}}),(0,zn.jsx)("h1",{children:(0,W.Z)("Sessions")}),(0,zn.jsx)("p",{className:"faded-text",children:(0,W.Z)("Save and restore your tabs and Workspaces with Sessions.")}),y4,(0,zn.jsx)("p",{className:"faded-text",children:(0,W.Z)("Click the “+” button above to save your first Session backup.")})]})})}var I4=s(34155);const A4=[{text:(0,W.Z)("Title"),value:"name",fullScreenTitle:(0,W.Z)("Sort by Title")},{text:(0,W.Z)("Created"),value:"createDateJS",fullScreenTitle:(0,W.Z)("Sort by Date Created")},{text:(0,W.Z)("Modified"),value:"modifyDateJS",fullScreenTitle:(0,W.Z)("Sort by Date Modified")}],S4={id:-1,windows:[],workspaces:[]},Z4=[Z.kKeyboardTabToAll,Z.kSessionsPanelSorting,Z.kSessionsSaveDays,Z.kSessionsSaveOnExit];class T4 extends Un.PureComponent{static contextType=oi.Z;refTree=Un.createRef();nodeRef=Un.createRef();id=crypto.randomUUID();constructor(e){super(e);const t=this.props.prefValues[Z.kSessionsPanelSorting];this.state={mode:"main",content:S4,contentTitle:"",hasSessions:Q1.ZP.hasSessions(),autoSave:!0,sessionFilter:"",contentFilter:"",sorting:{sortOrder:t.sortOrder,sortField:t.sortField,comparator:this._sortComparator}}}componentDidMount(){Q1.ZP.addListener(this._onStoreChanged)}componentWillUnmount(){Q1.ZP.removeListener(this._onStoreChanged)}componentDidUpdate(e,t){!e.open&&this.props.open&&Q1.ZP.hasSessions()&&I4.nextTick((()=>this._focusTree()))}_onStoreChanged=e=>{const t=e=>void 0!==e&&e===this.state.content.id;switch(e.reason){case"init":case"added":this.setState({hasSessions:Q1.ZP.hasSessions()});break;case"deleted":this.setState({hasSessions:Q1.ZP.hasSessions()}),t(e.info?.item.id)&&this._onLeaveEdit();break;case"changed":if(e.info?.item){const s=e.info.item.id;t(s)&&this.setState({contentTitle:Q1.ZP.getTitle(s)})}break;case"content":if(e.info?.item.content){const s=e.info.item.content;(e.owner===this.id||t(s.id))&&this.setState({mode:"edit",content:s,contentTitle:Q1.ZP.getTitle(s.id)})}}};_onSortChange=(e,t)=>{this.setState((s=>({sorting:{sortOrder:e,sortField:t,comparator:s.sorting.comparator}}))),I.Z.set(Z.kSessionsPanelSorting,{sortOrder:e,sortField:t})};_sortComparator=(e,t)=>{if(Q1.ZP.isTrashFolder(e.id))return 1;if(Q1.ZP.isTrashFolder(t.id))return-1;if(Q1.ZP.isAutoSaveNode(e.id))return 1;if(Q1.ZP.isAutoSaveNode(t.id))return-1;const{sortOrder:s,sortField:n}="history"===e.type&&"history"===t.type?{sortOrder:ui.Z.DESCENDING_SORT,sortField:"modifyDateJS"}:this.state.sorting;return ui.Z.getDefaultComparator(s,n)(e,t)};_getSelected=()=>this.refTree.current?.getSelected()??[];_focusTree=()=>{this.refTree.current?.focusTree()};_onSessionFilterChange=e=>{this.setState({sessionFilter:e.target.value})};_onContentFilterChange=e=>{this.setState({contentFilter:e.target.value})};_onAdd=()=>{this.refTree.current?.add()};_onDelete=()=>{this.refTree.current?.deleteSelected()};_onOpen=e=>{gn.Z.open(this.context.vivaldiWindowId,e,!0)};_onEdit=e=>{gn.Z.requestContent(e,this.id)};_onLeaveEdit=()=>{this.setState({mode:"main",content:S4,contentTitle:""})};_onEditFromButton=()=>{const e=this._getSelected();1===e.length&&gn.Z.requestContent(e[0].id,this.id)};_onUpdateAutoSave=()=>{this.setState((e=>({autoSave:!e.autoSave})))};onAutosaveChanged=()=>{"on"!==this.props.prefValues[Z.kSessionsSaveOnExit]?ue.Z.showEnableSessionAutosaveDialog(this.context.vivaldiWindowId,{mode:"intro"}):I.Z.toggle(Z.kSessionsSaveOnExit,"on","off")};getSaveDaysText=()=>{if("on"!==this.props.prefValues[Z.kSessionsSaveOnExit])return"";const e=this.props.prefValues[Z.kSessionsSaveDays];return 1===e?(0,W.Z)("One day"):(0,W.Z)("$1 day","$1 days",[e])};renderHeader=()=>{const e="edit"===this.state.mode?(0,W.Z)('Edit "$1"',[this.state.contentTitle]):this.props.title;return(0,zn.jsxs)("header",{children:[(0,zn.jsxs)("div",{className:"toolbar-back-navigation",role:"toolbar","aria-label":(0,W.Z)("toolbar label","Session Editor"),children:["edit"===this.state.mode&&(0,zn.jsx)(oa.ZP,{tooltip:(0,W.Z)("command","Go Back to Session List"),tabIndex:this.props.prefValues[Z.kKeyboardTabToAll],onClick:this._onLeaveEdit,image:Kn.mgF.small}),(0,zn.jsx)(Cu,{title:e,showCloseButton:this.props.showCloseButton})]}),(0,zn.jsxs)("div",{className:"toolbar toolbar-default toolbar-wrap",role:"toolbar","aria-label":(0,W.Z)("toolbar label","Sessions"),children:["main"===this.state.mode&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("input",{type:"search",className:"tabsearch",placeholder:(0,W.Z)("verb","Search"),value:this.state.sessionFilter,onChange:this._onSessionFilterChange}),(0,zn.jsxs)("div",{className:"toolbar-group",children:[(0,zn.jsx)(oa.ZP,{tooltip:(0,W.Z)("command","Save Tabs as Session"),tabIndex:this.props.prefValues[Z.kKeyboardTabToAll],onClick:this._onAdd,image:Kn.md4.small}),(0,zn.jsx)(oa.ZP,{tooltip:(0,W.Z)("command","Delete Session"),tabIndex:this.props.prefValues[Z.kKeyboardTabToAll],onClick:this._onDelete,image:Kn.M2k.small})]}),(0,zn.jsx)(oa.ZP,{tooltip:(0,W.Z)("command","Edit Session"),tabIndex:this.props.prefValues[Z.kKeyboardTabToAll],onClick:this._onEditFromButton,image:Kn.NNg.small})]}),"edit"===this.state.mode&&(0,zn.jsx)(zn.Fragment,{children:(0,zn.jsx)("input",{type:"search",className:"tabsearch",placeholder:(0,W.Z)("verb","Search"),value:this.state.contentFilter,onChange:this._onContentFilterChange})})]})]})};renderMain=()=>(0,zn.jsxs)(zn.Fragment,{children:[this.state.hasSessions&&(0,zn.jsx)(Bu,{fields:A4,onSortChange:this._onSortChange,keyAccess:this.props.keyAccess,sortField:this.state.sorting.sortField,sortOrder:this.state.sorting.sortOrder}),!this.state.hasSessions&&(0,zn.jsx)(x4,{onAdd:this._onAdd}),(0,zn.jsx)("section",{className:"outerScrollbar",children:(0,zn.jsx)(n3,{ref:this.refTree,filter:this.state.sessionFilter,showFolders:!0,sorting:this.state.sorting,onOpen:this._onOpen,onEdit:this._onEdit})}),(0,zn.jsx)("footer",{children:(0,zn.jsxs)("label",{title:this.getSaveDaysText(),children:[(0,zn.jsx)("input",{type:"checkbox",checked:"on"===this.props.prefValues[Z.kSessionsSaveOnExit],onChange:this.onAutosaveChanged}),(0,zn.jsx)("span",{children:(0,W.Z)("verb","Automatic Session Backup")})]})})]});renderEdit=()=>(0,zn.jsx)("section",{className:"outerScrollbar",children:(0,zn.jsx)(w4,{content:this.state.content,filter:this.state.contentFilter})});render(){return this.props.open?(0,zn.jsxs)("div",{ref:this.nodeRef,className:"panel",id:"session-panel",children:[this.renderHeader(),"main"===this.state.mode&&this.renderMain(),"edit"===this.state.mode&&this.renderEdit()]}):null}}const E4=(0,zd.Z)(T4,Z4),{minimalCreateEvent:k4}=_r.ZP,N4=[Z.kCalendarDisplayDensity,Z.kCalendarOnboardingShown],_4=hH.Nw;let P4=!1;function M4(e){return(0,zn.jsxs)("div",{className:"panel-empty-state",children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.C1I}}),(0,zn.jsx)("h1",{children:(0,W.Z)("Add your first calendar account")}),(0,zn.jsx)("p",{className:"faded-text",children:(0,W.Z)("You can add a local or online calendar to Vivaldi Calendar.")}),(0,zn.jsx)("input",{type:"button",onClick:()=>ue.Z.showCalendarAccountDialog(e.windowId),value:(0,W.Z)("Add Calendar Account")})]})}function D4(e){return(0,zn.jsxs)("div",{className:"panel-empty-state",onClick:e.onCreateTask,children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.C1I}}),(0,zn.jsx)("h1",{children:(0,W.Z)("Your task list is empty")}),(0,zn.jsx)("p",{children:(0,W.Z)("Click the “Add Task” button to add a new task.")})]})}function O4(e){return(0,zn.jsxs)("div",{className:"panel-empty-state",onClick:e.onCreateTask,children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.C1I}}),(0,zn.jsx)("h1",{children:(0,W.Z)("No tasks found.")})]})}function j4(e){const t=Un.useContext(oi.Z),{stateHandler:s,calendarFilter:n,eventDraft:i,tasks:a,hasTasks:o,trashedEvents:r}=cH(_4),[l,d]=Un.useState(!1),c=(0,Eo.Z)(N4),h=Un.useMemo((()=>({pageId:_4,displayDensity:c[Z.kCalendarDisplayDensity],isPanel:!0,isEditing:!!i,isWidget:!1,isTaskList:!0,handler:s})),[c,s,i]);if(!e.open)return P4=!1,null;function u(){d(!0),s.editEvent(null,k4({task:!0}))}!1===P4&&e.open&&(ie.ZP.pollAllCalDAVAccounts({throttle:!0}),P4=!0),l&&!i&&d(!1);let p=null;return!l&&(0===Pr.Z.getCalendars().length||!c[Z.kCalendarOnboardingShown]&&0===Pr.Z.getEvents().length&&!Pr.Z.getAccounts().some((e=>"local"!==e.account_type)))?p=(0,zn.jsx)(M4,{windowId:t.vivaldiWindowId}):a.length||n.filterText||l?a.length||!n.filterText||l||(p=(0,zn.jsx)(O4,{onCreateTask:u})):p=(0,zn.jsx)(D4,{onCreateTask:u}),(0,zn.jsxs)("div",{className:"panel",id:"tasks_panel",onClick:function(e){e.stopPropagation(),i&&s.endEventEdit()},children:[(0,zn.jsxs)("header",{children:[(0,zn.jsx)(Cu,{title:e.title,showCloseButton:e.showCloseButton}),(0,zn.jsxs)("div",{className:"toolbar toolbar-default",role:"toolbar","aria-label":(0,W.Z)("toolbar label","Tasks"),children:[(0,zn.jsx)("input",{type:"search",placeholder:(0,W.Z)("verb","Search"),title:(0,W.Z)("Type to filter tasks"),value:n.filterText,onChange:function(e){TZ.Z.search(_4,e.target.value)}}),(0,zn.jsx)(oa.ZP,{title:(0,W.Z)("Add Task"),label:(0,W.Z)("Add Task"),tooltip:(0,W.Z)("Add a New Task"),onClick:u,image:Kn.md4.small})]})]}),p,(!!a.length||l)&&(0,zn.jsx)(WS.Provider,{value:h,children:(0,zn.jsx)(gE,{filter:n,events:a,trashedEvents:r,editingEvent:i,displayMode:"agenda"})}),o&&(0,zn.jsx)("footer",{children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:n.showCompletedTasks,onChange:function(){TZ.Z.showCompletedTasks(_4)}}),(0,zn.jsx)("span",{children:(0,W.Z)("Show Completed Tasks")})]})})]})}const L4=Un.memo(j4);class R4 extends Un.PureComponent{refTreeList=Un.createRef();static contextType=oi.Z;winId=this.context.vivaldiWindowId;_languageFromCode=e=>{const t=this.props.languages.findIndex((t=>t.id===e));return-1===t?e:this.props.languages[t].historyName};_onNodesActivated=(e,t)=>{this.props.onActivated(t[0].id)};_onNodeDoubleClick=(e,t)=>{this.props.onActivated(t.id)};_onCopyAll=()=>{const{document:e}=this.context,t=e=>{const t=(this.refTreeList.current?.getAllSelectedItems()||[]).map((e=>e.id));this.props.onItemsCopy(e,t,!0)};e.addEventListener("copy",t),e.execCommand("copy"),e.removeEventListener("copy",t)};_onCopy=(e,t)=>{const s=t.map((e=>e.id));this.props.onItemsCopy(e,s,!1)};_getMenuCapability=async(e,t,s)=>{const n=this.winId;return"CONTEXT_COPY_ALL"===e.action?{handler:this._onCopyAll,isVisible:()=>Boolean(s),...t(n,e,{})}:{...t(n,e,{})}};_getMenuVisibility=(e,t)=>{if(!t)return!1;switch(e.action){case"CONTEXT_COPY":case"CONTEXT_DELETE":return!0;default:return!1}};clipByWord=e=>{if(e.length<=560)return e;const t=e.substring(0,560),s=t.lastIndexOf(" ");return t.substring(0,s)+"..."};getRowHeight=e=>e.translatedItem?.text?.length>140?98:68;rowComponent=e=>{const t=e.node,s=`${this._languageFromCode(t.srcItem.code)} → ${this._languageFromCode(t.translatedItem.code)}`,n=["TranslatePanel-Row",t.translatedItem.text?.length<=140?"TranslatePanel-Row-Narrow":""].join(" ");return(0,zn.jsxs)("div",{className:n,title:(0,W.Z)("Go to full translation"),children:[(0,zn.jsx)("label",{className:"TranslatePanel-Row-Heading",children:(0,zn.jsx)("span",{children:s})},t.id),(0,zn.jsx)("label",{className:"TranslatePanel-Row-Source",children:(0,zn.jsx)("span",{children:this.clipByWord(t.srcItem.text)})}),(0,zn.jsx)("label",{className:"TranslatePanel-Row-Result",children:(0,zn.jsx)("span",{children:this.clipByWord(t.translatedItem.text)})})]})};menu={name:"translatehistory",getCapability:this._getMenuCapability,getVisibility:this._getMenuVisibility};render(){return(0,zn.jsx)("section",{className:"outerScrollbar",children:(0,zn.jsx)(Mi,{ref:this.refTreeList,settings:"TRANSLATE_HISTORY_TREE",rowComponent:this.rowComponent,nodes:this.props.nodes,menu:this.menu,isFolder:iy.Z,hasChildren:iy.Z,delete:this.props.onItemsDelete,onSelect:nr.Z,onCopy:this._onCopy,enableDragAndDrop:!1,onItemDoubleClick:this._onNodeDoubleClick,onItemsActivated:this._onNodesActivated,rowHeight:this.getRowHeight})})}}const B4=R4;class F4 extends Un.PureComponent{render(){return this.props.showPlaceholder?(0,zn.jsx)("textarea",{className:"TranslatePanel-TranslatedText",type:"text",placeholder:(0,W.Z)("Please wait"),readOnly:!0}):(0,zn.jsx)("textarea",{className:"TranslatePanel-TranslatedText",type:"text",value:this.props.text,readOnly:!0})}}const W4=F4,U4=[Z.kPanelsTranslateAutomatic,Z.kTranslateTargetLanguage,Z.kVivaldiTranslateLanguageList],V4=Ci()((function(e){return Nb.Z.getTranslationLocales().map((e=>({id:Nb.Z.getTranslationCode(e.key),name:_b(e),historyName:e.value})))}));var H4=(0,zn.jsx)(Vn.ZP,{url:Kn.eIC,loadType:"faviconFromCache"});class G4 extends Un.PureComponent{static contextType=oi.Z;_errorId=null;_hasLoadedHistory=!1;_idleId=null;_pendingText="";constructor(e){super(e),this.state={busy:!1,error:"none",history:[],showPlaceholder:!1,srcLanguage:"auto",srcStrings:[""],translatedText:"",viewMode:"main",translatePageIndex:0}}componentDidMount(){this._isMounted=!0,re.Z.tabsPrivate.onWebviewClickCheck.addListener(this._onWebviewClicked),re.Z.utilities.onBroadcastMessage.addListener(this._onBroadcastMessage),this._loadHistory(),this._runAutoTranslate(this.props.prefValues[Z.kPanelsTranslateAutomatic])}componentWillUnmount(){this._isMounted=!1,this._idleId&&clearTimeout(this._idleId),re.Z.utilities.onBroadcastMessage.removeListener(this._onBroadcastMessage),re.Z.tabsPrivate.onWebviewClickCheck.removeListener(this._onWebviewClicked),this._hasLoadedHistory&&(re.Z.translateHistory.onAdded.removeListener(this._onAdded),re.Z.translateHistory.onMoved.removeListener(this._onMoved),re.Z.translateHistory.onRemoved.removeListener(this._onRemoved)),this._setError("none")}componentDidUpdate(e,t){!e.open&&this.props.open?(this._loadHistory(),this._runAutoTranslate(this.props.prefValues[Z.kPanelsTranslateAutomatic])):e.open&&!this.props.open&&this._setError("none")}_loadHistory=()=>{this.props.open&&!this._hasLoadedHistory&&re.Z.translateHistory.get().then((e=>{this._isMounted&&(this._hasLoadedHistory=!0,re.Z.translateHistory.onAdded.addListener(this._onAdded),re.Z.translateHistory.onMoved.addListener(this._onMoved),re.Z.translateHistory.onRemoved.addListener(this._onRemoved),this.setState({history:e}))}))};_getItemById=e=>this.state.history.find((t=>t.id===e));_detectLanguage=async(e,t,s)=>{const n=await Nb.Z.detectTextLanguage(e,s);return n&&t!==n?n:t};_onBroadcastMessage=e=>{if(!e.translate)return;const{winId:t,lang:s,text:n}=e.translate;t===this.context.vivaldiWindowId&&this.setState({srcStrings:[n],translatePageIndex:0,srcLanguage:s||"auto"},this._onTranslate)};_onAdded=(e,t)=>{this.setState((s=>{const n=[...s.history];return e.forEach(((e,s)=>{n.splice(t+s,0,e)})),{history:n}}))};_onMoved=(e,t)=>{const s=this.state.history.findIndex((t=>t.id===e));-1!==s&&s!==t&&this.setState((e=>{const n=[...e.history],i=n.splice(s,1);return n.splice(t>s?t-1:t,0,i[0]),{history:n}}))};_onRemoved=e=>{0===e.length?this.setState({history:[]}):this.setState((t=>{const s=[...t.history];return e.forEach((e=>{const t=s.findIndex((t=>t.id===e));-1!==t&&s.splice(t,1)})),{history:s}}))};_onSourceLanguageSelected=e=>{const{value:t}=e.currentTarget;this.setState({srcLanguage:t})};_onTargetLanguageSelected=e=>{const{value:t}=e.currentTarget;Nb.Z.setTargetTranslationCode(t)};_onSrcEditChanged=e=>{this._setError("none");let t=[e.target.value];if(t[0].length>Nb.k){if(-1===t[0].search(/[ ,\n.]/))return void this._setError("system");this._setError("NbCharExceeded"),t=this.splitSrcTextInPages(t[0])}this.setState((s=>({srcLanguage:e.target.value?s.srcLanguage:"auto",srcStrings:t,translatePageIndex:0,translatedText:"",showPlaceholder:!1})))};_onKeyDown=e=>{const{ctrlKey:t,altKey:s,shiftKey:n,metaKey:i}=e,a={ctrlKey:t,altKey:s,shiftKey:n,metaKey:i};"Enter"===e.key&&(0,Zi.VV)(a)&&(e.stopPropagation(),e.preventDefault(),this._onTranslate())};_onKeyDownMonitor=e=>{this._setError("none")};_onPaste=e=>{this.setState({srcLanguage:"auto"},(()=>{setTimeout((()=>{(A.Z.get(Z.kPanelsTranslatePaste)||this.state.srcStrings.length>1)&&this._onTranslate()}))}))};_onWebviewClicked=(e,t,s,n,i)=>{const{document:a}=this.context;if(this.props.open&&this.props.prefValues[Z.kPanelsTranslateAutomatic]&&e===this.context.vivaldiWindowId&&!1===t&&0===s){"WEBVIEW"===a.elementFromPoint(Math.round(n),Math.round(i))?.tagName&&this._getSelectionAndTranslate()}};_getSelectionAndTranslate=()=>{const e=Ze.ZP.unsafeGetActivePage(this.context.vivaldiWindowId);re.Z.utilities.getSelectedText(e.id,(e=>{e&&(e===this.getCurrentSrcText()&&(e=""),this.setState({srcLanguage:"auto",srcStrings:[e],translatePageIndex:0},this._onTranslate))}))};_toggleAutoTranslate=()=>{const e=!this.props.prefValues[Z.kPanelsTranslateAutomatic];I.Z.set(Z.kPanelsTranslateAutomatic,e),this._runAutoTranslate(e)};_runAutoTranslate=e=>{e&&(this.getCurrentSrcText()||this._getSelectionAndTranslate())};_onTranslate=async()=>{const e=this.getCurrentSrcText().trim();if(!Nb.Z.canTranslateText(e))return void this.setState({translatedText:"",showPlaceholder:!1});if(this.state.busy)return void(this._pendingText=e);this._setError("none"),this.setState({translatedText:"",showPlaceholder:!0,busy:!0});let t=await this._detectLanguage(Ze.ZP.unsafeGetActivePage(this.context.vivaldiWindowId).id,this.state.srcLanguage,e);"auto"===t&&(t="");const s=t?Nb.Z.getTranslationCode(t):"",n=Nb.Z.getTranslationCode(this.props.prefValues[Z.kTranslateTargetLanguage]),i=await re.Z.utilities.translateText(s,n,[e]);if(this._isMounted){if("no_error"!==i.error){this.setState({showPlaceholder:!1});let e="system";"unknown_language"===i.error?e="unknownLangServer":s&&(e="noDetect"),this._setError(e)}else{const e={id:"",srcItem:{code:i.detectedSourceLanguage,text:i.sourceText[0]},translatedItem:{code:n,text:i.translatedText[0]}};this._addToHistory(e),"auto"===this.state.srcLanguage&&this.setState({srcLanguage:i.detectedSourceLanguage})}this._idleId&&clearTimeout(this._idleId),this._idleId=setTimeout(this._idleEnds,1e3)}};_idleEnds=()=>{if(this._idleId&&clearTimeout(this._idleId),this._pendingText){const e=this._pendingText;this._pendingText="",this.setState({busy:!1,srcStrings:[e],translatePageIndex:0},this._onTranslate)}else this.setState({busy:!1})};_errorEnds=()=>{this._errorId&&clearTimeout(this._errorId),this._setError("none")};_addToHistory=e=>{fe.ZP.isIncognitoOrGuest(this.context.vivaldiWindowId)?(this.setState({translatedText:e.translatedItem.text,showPlaceholder:!1}),this._setError("none")):re.Z.translateHistory.add(e,0).then((t=>{const s=n.Z.runtime.lastError;s&&console.error(s.message),this.setState({translatedText:e.translatedItem.text,showPlaceholder:!1}),this._setError("none")}))};_onItemActivated=e=>{const t=this._getItemById(e);t&&this.setState({viewMode:"main"},(()=>{Nb.Z.setTargetTranslationCode(t.translatedItem.code),this.setState({srcLanguage:t.srcItem.code,srcStrings:[t.srcItem.text],translatePageIndex:0,translatedText:t.translatedItem.text,showPlaceholder:!1})}))};_onItemsDelete=e=>re.Z.translateHistory.remove(e).then((()=>Promise.resolve()));_onClearHistory=()=>{re.Z.translateHistory.reset(0)};_onClearText=()=>{this._pendingText="",this.setState({srcLanguage:"auto",srcStrings:[""],translatePageIndex:0,translatedText:""})};_onSwapLanguage=()=>{"auto"!==this.state.srcLanguage&&this.setState((e=>{Nb.Z.setTargetTranslationCode(e.srcLanguage);const t=e.translatedText.length>0;return{srcLanguage:this.props.prefValues[Z.kTranslateTargetLanguage],srcStrings:t?[e.translatedText]:e.srcStrings,translatePageIndex:t?0:e.translatePageIndex,translatedText:t?e.srcStrings[e.translatePageIndex]:e.translatedText}}))};_onItemsCopy=(e,t,s)=>{const n=t.map((e=>this._getItemById(e))).filter(Boolean),i=[];n.forEach((e=>{s&&i.push(e.srcItem.text),i.push(e.translatedItem.text)})),e.clipboardData&&(e.clipboardData.setData("text/plain",i.join("\r\n")),e.stopPropagation(),e.preventDefault())};_setError=e=>{const{document:t}=this.context;"none"===e?"none"!==this.state.error&&(t.removeEventListener("keydown",this._onKeyDownMonitor),this._errorId&&clearTimeout(this._errorId)):"none"===this.state.error&&(t.addEventListener("keydown",this._onKeyDownMonitor),this._errorId&&clearTimeout(this._errorId),this._errorId=setTimeout(this._errorEnds,3e3)),this._isMounted&&this.setState({error:e})};_errorMessage=e=>{switch(e){case"unknownLangServer":return(0,W.Z)("Translation failed. Server could not determine the language.");case"noDetect":return(0,W.Z)("Translation failed. Try selecting another language.");case"system":return(0,W.Z)("Translation failed.");case"NbCharExceeded":return(0,W.Z)("You cannot translate more than $1 characters. Use the arrows to translate more.",[Nb.k]);default:return""}};_onCopyText=()=>{const{document:e}=this.context,t=e=>{e.clipboardData&&(e.clipboardData.setData("text/plain",this.state.translatedText),e.stopPropagation(),e.preventDefault())};e.addEventListener("copy",t),e.execCommand("copy"),e.removeEventListener("copy",t)};_renderToolbar=()=>{if("main"===this.state.viewMode){const e=[{id:"auto",name:(0,W.Z)("Automatic Detection")}].concat(V4(this.props.prefValues[Z.kVivaldiTranslateLanguageList])).map((e=>(0,zn.jsx)("option",{value:e.id,children:e.name},e.id))),t=V4(this.props.prefValues[Z.kVivaldiTranslateLanguageList]).map((e=>(0,zn.jsx)("option",{value:e.id,children:e.name},e.id)));return(0,zn.jsxs)("div",{className:"TranslatePanel-FromTo toolbar toolbar-default",role:"toolbar","aria-label":(0,W.Z)("toolbar label","Pick Languages"),children:[(0,zn.jsx)(Fa.Z,{autoFocus:!0,value:this.state.srcLanguage,onChange:this._onSourceLanguageSelected,"aria-label":(0,W.Z)("From Language"),children:e}),(0,zn.jsx)("input",{type:"button",style:{paddingLeft:6,paddingRight:6},value:"⇆","aria-label":(0,W.Z)("Swap To/From Languages"),disabled:"auto"===this.state.srcLanguage,onClick:this._onSwapLanguage}),(0,zn.jsx)(Fa.Z,{value:this.props.prefValues[Z.kTranslateTargetLanguage],onChange:this._onTargetLanguageSelected,"aria-label":(0,W.Z)("To Language"),children:t})]})}return(0,zn.jsxs)("div",{className:"toolbar toolbar-default toolbar-wrap",role:"toolbar","aria-label":(0,W.Z)("toolbar label","Translation History Actions"),children:[(0,zn.jsx)("input",{type:"button",onClick:()=>this.setState({viewMode:"main"}),value:(0,W.Z)("navigation","Back")}),(0,zn.jsx)("input",{type:"button",className:"danger",onClick:this._onClearHistory,value:(0,W.Z)("Clear Translate History")})]})};splitText=e=>{let t=0;const s=e.split(/([ ,\n])/).reduce(((e,s)=>(s.length+e[t].length>Nb.k?(e.push(s),t+=1):e[t]=e[t]+s,e)),[""]);return!s[0].length&&s.shift(),s};splitSrcTextInPages=e=>{let t=0;const s=e.split(/(\.)/).reduce(((e,s)=>"."===s?(e[t].concat("."),e):((s=s.trim()).length>Nb.k?e.push(...this.splitText(s)):s.length+e[t].length>Nb.k?(e.push(s),t+=1):e[t]=e[t]+s,e)),[""]);return!s[0].length&&s.shift(),s};changeTranslationPage=e=>{this.setState({translatePageIndex:e},this._onTranslate)};getCurrentSrcText=()=>{const{srcStrings:e,translatePageIndex:t}=this.state;return t>=e.length?(this.setState({translatePageIndex:0}),e[0]):e[t]};_renderTranslatePages=()=>{const{translatePageIndex:e,srcStrings:t,busy:s}=this.state,n=e<t.length-1;return(0,zn.jsxs)("div",{className:"TranslatePanel-Pages",children:[(0,zn.jsxs)("div",{className:"Translate-Characters",children:[(0,zn.jsx)("p",{children:t[e]?.length??0}),H4]}),(0,zn.jsxs)("p",{className:"Translate-Page-Index",children:[e+1,"/",t.length]}),(0,zn.jsx)(oa.ZP,{className:"Previous-Translate",image:Kn.eFz.small,tooltip:(0,W.Z)("Previous"),disabled:e<1||s,onClick:()=>this.changeTranslationPage(e-1)}),(0,zn.jsx)(oa.ZP,{image:Kn.S$A.small,tooltip:(0,W.Z)("Next"),disabled:!n||s,onClick:()=>this.changeTranslationPage(e+1)})]})};_renderMain=()=>{const e=this.state.srcStrings[this.state.translatePageIndex],t=!this.state.busy&&Nb.Z.canTranslateText(e);return(0,zn.jsxs)("div",{className:"TranslatePanel",children:[(0,zn.jsxs)("div",{className:"TranslatePanel-Content",children:[(0,zn.jsx)("textarea",{className:"TranslatePanel-SrcText",type:"text",value:e,placeholder:(0,W.Z)("Enter text to translate"),onChange:this._onSrcEditChanged,onKeyDown:this._onKeyDown,onPaste:this._onPaste,autoFocus:!e}),"none"!==this.state.error&&(0,zn.jsx)("div",{onPointerDown:()=>this._setError("none"),children:(0,zn.jsx)(fa,{type:"system"===this.state.error?"error":"warning",children:this._errorMessage(this.state.error)})}),this.state.srcStrings.length>1&&this._renderTranslatePages(),(0,zn.jsxs)("div",{className:"TranslatePanel-BottomToolbar",children:[(0,zn.jsx)("input",{type:"submit",disabled:!t,autoFocus:t,value:(0,W.Z)("verb","Translate")}),(0,zn.jsx)("input",{type:"button",title:(0,W.Z)("Copy translation"),value:(0,W.Z)("verb","Copy"),onClick:this._onCopyText,disabled:!this.state.translatedText}),(0,zn.jsx)("input",{type:"button",className:"clear",onClick:this._onClearText,value:(0,W.Z)("Clear")})]}),(0,zn.jsx)(W4,{text:this.state.translatedText,showPlaceholder:this.state.showPlaceholder})]}),(0,zn.jsx)("div",{className:"TranslatePanel-CheckboxArea",children:(0,zn.jsxs)("label",{children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.props.prefValues[Z.kPanelsTranslateAutomatic],onChange:this._toggleAutoTranslate}),(0,zn.jsx)("span",{children:(0,W.Z)("Auto-translate selected text")})]})}),(0,zn.jsxs)("div",{className:"TranslatePanel-ShowTranslateHistory",children:[(0,zn.jsx)("input",{type:"button",onClick:()=>this.setState({viewMode:"history"}),value:(0,W.Z)("Show Translate History")}),(0,zn.jsx)("span",{className:"credits",children:(0,W.Z)("Powered by Lingvanex, hosted by Vivaldi.")})]})]})};_renderHistory=()=>(0,zn.jsx)("div",{className:"TranslatePanel TranslatePanel-History",children:(0,zn.jsx)(B4,{nodes:this.state.history,languages:V4(this.props.prefValues[Z.kVivaldiTranslateLanguageList]),onActivated:this._onItemActivated,onItemsCopy:this._onItemsCopy,onItemsDelete:this._onItemsDelete})});render(){return this.props.open?(0,zn.jsxs)("div",{className:"panel",id:"translate-panel",children:[(0,zn.jsx)("header",{children:(0,zn.jsx)(Cu,{title:this.props.title,showCloseButton:this.props.showCloseButton})}),(0,zn.jsxs)("form",{className:"main"===this.state.viewMode?"Translate-Main-Form":"Translate-History-Form",onSubmit:this._onTranslate,children:[this._renderToolbar(),"main"===this.state.viewMode&&this._renderMain()]}),"history"===this.state.viewMode&&this._renderHistory()]}):null}}const K4=(0,zd.Z)(G4,U4);var z4=s(94420),$4=s(1810),Y4=s(50012),X4=s(32782),Q4=s(54189),q4=s(70025);const J4=class{windowId;device;workspaceNames;windowNodes;browserWindows;workspaces;panels;tabsInStackCount;constructor(e,t){if(this.windowId=t,this.device=e,this.browserWindows=new Map,this.windowNodes=new Map,this.workspaces=new Map,this.panels=new Map,this.tabsInStackCount=new Map,e.tabs)for(let t=0;t<e.tabs.length;++t)this._addTab(e.tabs[t]);e.windows&&e.windows.forEach((e=>{this.windowNodes.set(e.id,e),e.tabs.forEach((e=>{this._addTab(e)}))}))}_getFavicon=e=>vs.jk.getFaviconWithFallback(e.url||"",e.favIconUrl||"");_getPanelTitle(e){let t;return e.id&&(t=this.panels.get(e.id)?.tab?.title),t||(t=e?.title),t||(t=e?.url),t||"..."}_getPanelUrl(e){let t;return e.id&&(t=this.panels.get(e.id)?.tab?.url),t||(t=e.url),t||"about:blank"}_createPanelLeaf(e,t){const s=t.url;if(!s||(0,Ar.xl)(s))return;return{id:`panel-${e}-${this.device.id}`,type:"panel",parentId:"none",title:this._getPanelTitle(t),index:-1,pageIndex:void 0,wid:this.windowId,workspaceId:void 0,syncItem:{url:this._getPanelUrl(t),loadType:"page",faviconUrl:t.initialFaviconUrl?t.initialFaviconUrl:"",windowId:""}}}_getTabTitle(e){return e.fixedTitle?e.fixedTitle:e.name}_createLeaf(e,t,s,n,i){const a={id:t.id,type:n,parentId:"none",title:this._getTabTitle(t),index:s,pageIndex:void 0,wid:this.windowId,workspaceId:i,syncItem:{url:t.url,loadType:"page",faviconUrl:this._getFavicon(t.tab),windowId:t.windowId}},o=t.stackId;if(o){const e=this.tabsInStackCount.get(o);if(!e||e<2)return a}if(!o)return a;let r=e.get(o);if(!r){let s="Stack";return t.fixedGroupTitle&&(s=t.fixedGroupTitle),r=this._createFolder(o,"stack",s,[]),e.set(o,r),r.children||(r.children=[]),r.children.push(a),r}r.children||(r.children=[]),r.children.push(a)}_createFolder(e,t,s,n){return{id:e,type:t,parentId:"none",title:(0,W.Z)("title",s),index:0,pageIndex:void 0,wid:this.windowId,workspaceId:void 0,children:n}}_getTabGroupName(e,t){if("window"===t){const t=this.windowNodes.get(String(e));return t?t.name:"1"}if("syncPanels"===t)return"Panel";const s=this.device?.workspaceNames?.get(Number(e))?.name;return s||"..."}_getWorkspaceIcon(e,t){const s=this.device?.workspaceNames?.get(t);s&&(s.emoji?e.emoji=s.emoji:"number"==typeof s.iconId?e.icon=m_.S[s.iconId]:e.icon=s.icon)}_createTabGroup(e,t,s,n){const i=new Map,a=t.pinned.map(((e,t)=>this._createLeaf(i,e,t,"tab",n))).filter(Boolean),o=t.regular.map(((e,t)=>this._createLeaf(i,e,t,"tab",n))).filter(Boolean);let r=[];if(a.length>0){const t=this._createFolder(`pinned-${e}`,"pinned","Pinned Tabs",a);r.push(t)}return o&&(r=[...r,...o]),r}_createTabGroupFolder(e,t,s,n){const i=this._createTabGroup(e,t,s,n);return this._createFolder(e,s,this._getTabGroupName(e,s),i)}_fillBack(e,t){return t&&(e.parentId=t.id),e.children&&e.children.forEach(((t,s)=>{t.index=s,e.count=(e.count??0)+this._fillBack(t,e)})),e.count??1}build(e){const t=[],s=(e,s,n,i)=>{if(!s?.pinned?.length&&!s?.regular?.length)return;const a=this._createTabGroupFolder(String(e),s,n,i);"workspace"===n&&i&&this._getWorkspaceIcon(a,i),t.push(a)};if(1===this.browserWindows.size?this.browserWindows.forEach(((e,s)=>{const n=this._createTabGroup(String(s),e,"window");t.push(...n)})):this.browserWindows.forEach(((e,t)=>{s(t,e,"window")})),this.workspaces.forEach(((e,t)=>{s(t,e,"workspace",t)})),this.device.panels){const e=this.device.panels.map(((e,t)=>this._createPanelLeaf(t,e))).filter(Boolean);if(e.length>0){const s=this._createFolder(`panels-${this.device.id}`,"syncPanels","Web Panels",e);t.push(s)}}const n=this._createFolder(`device-${this.device.id}`,"syncDevice",this.device.name,t);return this._fillBack(n,e),n.deviceType=this.device.deviceType,n}#Us(e){return e.length>70&&(e=e.substring(0,70)+"..."),e}_createMenuFolder(e){const t=e=>({url:e.url,mnemonic:!1,handler:()=>Dn.openTabs([e.id]),...st.Z.makeLabelPair(this.#Us(e.name||""))}),s=e=>{const s=new Map,n=[];return e.forEach(((e,i)=>{const a=e.stackId;if(!a)return void n.push(t(e));let o=s.get(a);if(!o){o=[],s.set(a,o);const e={items:o,labelEnglish:"Stack",label:(0,W.Z)("title","Stack"),iconPNG:Y4.Z,iconPNGWhite:X4.Z};n.push(e)}o.push(t(e))})),n};s(e.regular);const n=s(e.pinned),i=s(e.regular);let a=[];n.length>0&&(a=[{items:n,iconPNG:z4.Z,iconPNGWhite:$4.Z,...(0,fi.Z)("Pinned Tabs")}]),a=[...a,...i];const o=[...e.pinned.map((e=>e.id)),...e.regular.map((e=>e.id))];return a.push(st.Z.separatorItem),a.push({mnemonic:!1,handler:()=>{Dn.openWindows(o)},...(0,fi.Z)("Open All")}),a}buildContextMenuTree(){let e=[];if(1===this.browserWindows.size)this.browserWindows.forEach((t=>{e=this._createMenuFolder(t)}));else{let t=0;this.browserWindows.forEach((s=>{t++,e.push({items:this._createMenuFolder(s),iconPNG:Q4.Z,iconPNGWhite:q4.Z,...(0,fi.Z)("Window "+t)})}))}if(e.push(st.Z.separatorItem),this.workspaces.forEach(((t,s)=>{const n=this._getTabGroupName(s,"workspace"),i={items:this._createMenuFolder(t),labelEnglish:"Workspace "+n,label:(0,W.Z)("title","Workspace")+" "+n,iconPNG:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABZWlDQ1BEaXNwbGF5IFAzAAB4nHWQvUvDUBTFT6tS0DqIDh0cMolD1NIKdnFoKxRFMFQFq1OafgltfCQpUnETVyn4H1jBWXCwiFRwcXAQRAcR3Zw6KbhoeN6XVNoi3sfl/Ticc7lcwBtQGSv2AijplpFMxKS11Lrke4OHnlOqZrKooiwK/v276/PR9d5PiFlNu3YQ2U9cl84ul3aeAlN//V3Vn8maGv3f1EGNGRbgkYmVbYsJ3iUeMWgp4qrgvMvHgtMunzuelWSc+JZY0gpqhrhJLKc79HwHl4plrbWD2N6f1VeXxRzqUcxhEyYYilBRgQQF4X/8044/ji1yV2BQLo8CLMpESRETssTz0KFhEjJxCEHqkLhz634PrfvJbW3vFZhtcM4v2tpCAzidoZPV29p4BBgaAG7qTDVUR+qh9uZywPsJMJgChu8os2HmwiF3e38M6Hvh/GMM8B0CdpXzryPO7RqFn4Er/QfBIQM2AAAA0ElEQVR4AbVSiQ2CQBAcrYASoANLwA4o4UqgA+jAEqATtALtgFgBsQLdy83qeqAiCZNMLuw/uwArIxc6LEAq7IQ92dA2wjb6ToQVk0/CjLwKz/R9RPGjm7e1jHGx0xvumKdXY4spx7cJvLyDcBCWatQd7PjuhTeEHZQmuWLxDcJOLibnWcB292zxukJn7HqdtwKKms6KwQ7hX9DrDIxBLMExsaWMjJ3AQj1fbz/S5+LubkKGjp9zioZTjJJhutVGhsKOn2AGUkwv8W84hPHXwwNmHziySwmKKQAAAABJRU5ErkJggg==",iconPNGWhite:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABZWlDQ1BEaXNwbGF5IFAzAAB4nHWQvUvDUBTFT6tS0DqIDh0cMolD1NIKdnFoKxRFMFQFq1OafgltfCQpUnETVyn4H1jBWXCwiFRwcXAQRAcR3Zw6KbhoeN6XVNoi3sfl/Ticc7lcwBtQGSv2AijplpFMxKS11Lrke4OHnlOqZrKooiwK/v276/PR9d5PiFlNu3YQ2U9cl84ul3aeAlN//V3Vn8maGv3f1EGNGRbgkYmVbYsJ3iUeMWgp4qrgvMvHgtMunzuelWSc+JZY0gpqhrhJLKc79HwHl4plrbWD2N6f1VeXxRzqUcxhEyYYilBRgQQF4X/8044/ji1yV2BQLo8CLMpESRETssTz0KFhEjJxCEHqkLhz634PrfvJbW3vFZhtcM4v2tpCAzidoZPV29p4BBgaAG7qTDVUR+qh9uZywPsJMJgChu8os2HmwiF3e38M6Hvh/GMM8B0CdpXzryPO7RqFn4Er/QfBIQM2AAAA2klEQVR4AbVSbQ2DMBR8RQESOgdI2BwgoRLmABxMAjhhU7A5IFOwTEF3L1yXpikl/OAll5T30Xd3ReTI8N6fASd7A0MWmICZGDSX662SwRrocJyAhzHmpMD5DTxZW93alraR1cgelxadX8LJtrzQ2+YKJQYq7wZ8gKvEHiDR8PsCfNWDuInaZ8AA6skrmlkuiLcneme+iE1ep8np61ns2Oz4L9TMKf0+nqli/TiOlKE0J/ZY0rfM38nCSclEItAPLAaycJILDv1lxCYG+nqRbMWaibI3golyZPwA4iNOsOEBLSEAAAAASUVORK5CYII="};e.push(i)})),this.device.panels?.length){const t=this.device.panels.map((e=>{if(e.title){const t=this._getPanelUrl(e);return{label:this._getPanelTitle(e),labelEnglish:this._getPanelTitle(e),url:t,mnemonic:!1,handler:()=>{c.ZP.openURL(this.windowId,t)}}}})).filter(Boolean);e.push({items:t,label:(0,W.Z)("title","Web Panels"),labelEnglish:"Web Panels"})}return e}_ensureMainWorkspace(e){let t=this.browserWindows.get(e);return t||(t={pinned:[],regular:[]},this.browserWindows.set(e,t)),t}_addTab(e){const t=this._ensureMainWorkspace(e.windowId),s=e.tab;let n,i=0;try{const t=e.stackId;if(t){const e=this.tabsInStackCount.get(t);this.tabsInStackCount.set(t,e?e+1:1)}let s=e.panelId;if(s){if(s.startsWith(nc.zs))return;if(s.startsWith("WEBPANEL_")){const t=s.split("_");return 3===t.length&&(s=t[0]+"_"+t[1]),void("string"==typeof s&&this.panels.set(s,e))}}e.workspaceId&&(i=e.workspaceId)}catch(e){}0===i?n=t:(this.workspaces.get(i)||this.workspaces.set(i,{pinned:[],regular:[]}),n=this.workspaces.get(i)),n&&(s.pinned?n.pinned.push(e):n.regular.push(e))}};var e5=s(63365);const t5=[Z.kPanelsWindowShowPinnedGroup,Z.kTabsDimHibernated,Z.kThemeUseAnimation,Z.kTabsUnread,Z.kPanelsShowFolderBadge];function s5(e,t){switch(e.type){case"pinned":return"pinned";case"stack":return"stack";case"syncFolder":return"syncFolder";case"syncDevice":return function(e){switch(e.deviceType){case"desktop":return"desktop";case"tablet":return"tablet";case"phone":return"phone"}return"desktop"}(e);case"syncWindow":return"folder";case"trashFolder":return e.trashItem?.window?"folder":"trash";case"workspace":return t?.emoji?"emoji":t?.icon?"workspace":e.emoji?"emoji":"workspace";case"duplicatesFolder":return"duplicatesFolder";case"workspacesFolder":return"workspacesFolder";case"inactiveFolder":return"inactiveFolder"}return"folder"}function n5(e,t){const{emoji:s,icon:n}=t??e;return s||n||""}function i5({node:e,isSelected:t}){const s=Un.useRef(),n=()=>{s.current?.focus()};return(0,zn.jsx)("div",{onClick:n,onFocus:n,className:Gn()("window-entry window-child last-window-child window-entry-button",{selected:t}),children:(0,zn.jsx)("input",{ref:s,type:"button",onClick:()=>e.buttonItem?.onClick(),value:e.title})},"window__panel__"+e.id)}var a5=(0,zn.jsxs)("g",{transform:"translate(2, 2)",fill:"none",stroke:"currentColor",children:[(0,zn.jsx)("polygon",{points:"2.5 5.5 6.5 9.5 7.5 9.5 7.5 5.5 11.5 2.5 9.5 0.5 6.5 4.5 2.5 4.5"}),(0,zn.jsx)("polygon",{points:"0 12 3 8 4 9"})]});function o5({node:e,level:t,inlineEditText:s,onChange:n,onFocus:i,onBlur:a,isInPinnedFolder:o,getPageByNode:r,isInTrashFolder:l,isInSyncFolder:d,isTrashFolder:c,isFolder:u,hasChildren:p,handleExpandClick:g,setMediaState:m,closeWithId:f,deleteWithId:v,isLastChild:b,isSelected:C}){const w=Un.useContext(oi.Z),y=(0,Eo.Z)(t5),x=w.vivaldiWindowId,I=y[Z.kPanelsShowFolderBadge],{pageItem:A,syncItem:S,trashItem:T,buttonItem:E}=e,k=!(!y[Z.kTabsUnread]||!A?.page)&&Ze.ZP.isUnread(A.page),N="inactiveFolder"!==e.type&&"duplicatesFolder"!==e.type&&"syncFolder"!==e.type?(t+1)*Ni:0,_=t*Ni,P=o&&!y[Z.kPanelsWindowShowPinnedGroup],M=Boolean(A?.page.discarded)&&y[Z.kTabsDimHibernated],D=r(e),O=!E&&D&&Ze.ZP.canClosePage(D)&&!l&&!d&&"window"!==e.type&&"workspace"!==e.type,j=!O&&l&&!c,L=A?.page&&mq.Z.getState().get(A?.page.id)||(0,qe.l4)(),R=0===L.size||M;const B=u||P?"":A?.faviconUrl||S?.faviconUrl||T?.tab?.faviconUrl||"",F=u||P?"faviconFromCache":A?.loadType||S?.loadType||T?.tab?.loadType||"faviconFromCache",U="workspace"===e.type&&void 0!==e.workspaceId?m_.Z.getWorkspaceById(e.workspaceId):void 0,V=Un.useMemo((()=>R?{marginLeft:N}:void 0),[N,R]),H=t>0;return"button"===e.type?(0,zn.jsx)(i5,{node:e,isSelected:C}):(0,zn.jsxs)("label",{onMouseEnter:function(){const e=A?.url||S?.url||T?.tab?.url;e&&h.Z.setStatus(x,vs.jk.getHoverUrl(e))},onMouseLeave:function(){h.Z.clearStatus(x)},title:e.title,className:Gn()("window-entry",{"window-parent":u,"window-child":H,"last-window-child":b}),children:[u&&(0,zn.jsx)("span",{className:"expand-icon",style:{marginLeft:_,visibility:p?"visible":"hidden"},onClick:wi.ZP,onMouseDown:wi.ZP,onMouseUp:t=>g(t,e.id),dangerouslySetInnerHTML:{__html:Kn.nfH}}),!R&&!u&&!E&&(0,zn.jsx)("span",{className:"tab-audio",onClick:function(){L.has("pip")&&A?.page},children:(0,zn.jsx)(Jq.Z,{animated:y[Z.kThemeUseAnimation],mediaState:L,src:"tab"})}),u&&(0,zn.jsx)(m4,{leftMargin:p?0:N,shape:s5(e,U),url:n5(e,U)}),!u&&!P&&!E&&(0,zn.jsx)(zn.Fragment,{children:B.startsWith("<svg")?(0,zn.jsx)("span",{className:"svg-icon",style:V,dangerouslySetInnerHTML:{__html:B}}):(0,zn.jsx)(Vn.ZP,{url:B,loadType:F,className:Gn()({discarded:M}),style:V})}),P&&(0,zn.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",className:"pinned-icon",style:V,children:a5}),void 0!==s&&(0,zn.jsx)("input",{type:"text",value:s,onChange:n,onFocus:i,onBlur:a,autoFocus:!0}),void 0===s&&!E&&(0,zn.jsxs)("span",{className:Gn()({title:!0,active:A?.active,unread:k}),children:[(0,zn.jsx)("div",{className:"text",children:e.title}),"duplicateTab"===e.type&&e.count&&(0,zn.jsx)("div",{className:"pill",children:(0,W.Z)("$1 copies",[e.count])})]}),I&&p&&(0,zn.jsx)("span",{className:"item-count",children:e.count??0}),O&&(0,zn.jsx)("span",{className:"close",title:(0,W.Z)("Close"),tabIndex:"-1",onClick:t=>f(e.id,t),dangerouslySetInnerHTML:{__html:Kn.kze}}),j&&(0,zn.jsx)("span",{className:"close",title:(0,W.Z)("verb","Delete"),tabIndex:"-1",onClick:t=>v(e.id,t),dangerouslySetInnerHTML:{__html:Kn.kze}})]},"window__panel__"+e.id)}var r5=s(42578),l5=s(7065),d5=s(34155);const c5=[Z.kPanelsShowFolderBadge,Z.kPanelsWindowDragToStack,Z.kPanelsWindowSingleClickOpens,Z.kPanelsWindowShowPinnedGroup,Z.kTabsAutoMuting,Z.kTabsDimHibernated,Z.kTabsStackingMode,Z.kTabsUnread,Z.kThemeUseAnimation,Z.kWorkspacesEnabled,Z.kPanelsWindowShowDuplicate,Z.kPanelsWindowShowInactive,Z.kPanelsWindowInactiveTabsDays],h5="root",u5="trash",p5="duplicatesFolder",g5="inactive",m5="vivaldi/x-window-item",f5=[p5,g5,u5];function v5(e){return e.startsWith("www.")?e.substring(4):e}function b5(e,t){const s=(0,ve.Z)(e.url)?.hostname||"",n=!e.url||!e.favIconUrl&&!(0,vs.pM)(e.url)&&!(0,vs.QB)(e.url),i=vs.jk.getFaviconWithFallback(e.url||"",e.favIconUrl||"");return{page:e,hostname:s,url:e.url,domain:v5(s),loadType:t,faviconUrl:i,useDefaultIcon:n,active:Ze.ZP.isActivePage(e.windowId,e.id)}}class C5 extends Un.PureComponent{refTreeList=Un.createRef();static contextType=oi.Z;isDroppingOnWindowOrWorkspace=!1;constructor(e,t){super(e),this.state={windowIds:this.getWindowIds(t.vivaldiWindowId),nodes:[],hasContent:!1,inactivePages:[]}}expandModel={};blockPageStoreChange=!1;lastActivePinnedId="";centerDownId="";componentDidMount(){mq.Z.addListener(this._onPageStoreChanged),Ze.ZP.addListener(this._onPageStoreChanged),Nn.addListener(this._onSyncedTabsStoreChanged),e5.Z.addListener(this._onTrashStoreChanged),fe.ZP.addListener(this._onWindowStoreChanged),m_.Z.addListener(this._onWorkspaceStoreChanged),this._onFilterChange(this.props.filter,nr.Z),this.#Vs().then((e=>this.setState({inactivePages:e,nodes:this._getNodes(e)})))}componentWillUnmount(){mq.Z.removeListener(this._onPageStoreChanged),Ze.ZP.removeListener(this._onPageStoreChanged),Nn.removeListener(this._onSyncedTabsStoreChanged),e5.Z.removeListener(this._onTrashStoreChanged),fe.ZP.removeListener(this._onWindowStoreChanged),m_.Z.removeListener(this._onWorkspaceStoreChanged)}componentDidUpdate(e){if(this.props.filter!==e.filter){const t=this.props.filter.length,s=e.filter.length;0===s&&t>0&&this.refTreeList.current&&(this.expandModel=this.refTreeList.current.getExpandModel()),this._onFilterChange(this.props.filter,(e=>{t>0?d5.nextTick((()=>{this.refTreeList.current?.expandAllExcept(e)})):s>0&&0===t&&d5.nextTick((()=>{this.refTreeList.current?.expandWithModel(this.expandModel)}))}))}else(this.props.prefValues[Z.kThemeUseAnimation]!==e.prefValues[Z.kThemeUseAnimation]||this.props.prefValues[Z.kTabsStackingMode]!==e.prefValues[Z.kTabsStackingMode]||this.props.prefValues[Z.kTabsUnread]!==e.prefValues[Z.kTabsUnread]||this.props.prefValues[Z.kPanelsWindowShowPinnedGroup]!==e.prefValues[Z.kPanelsWindowShowPinnedGroup]||this.props.prefValues[Z.kWorkspacesEnabled]!==e.prefValues[Z.kWorkspacesEnabled]||this.props.prefValues[Z.kPanelsWindowShowDuplicate]!==e.prefValues[Z.kPanelsWindowShowDuplicate]||this.props.prefValues[Z.kPanelsWindowShowInactive]!==e.prefValues[Z.kPanelsWindowShowInactive]||this.props.prefValues[Z.kPanelsWindowInactiveTabsDays]!==e.prefValues[Z.kPanelsWindowInactiveTabsDays]||this.props.sorting!==e.sorting&&"manually"===this.props.sorting.sortField)&&d5.nextTick((()=>{this.setState({nodes:this._getNodes(),hasContent:!0})}))}focusTree=()=>{this.refTreeList.current?.focusTree()};async#Vs(){const e=this.props.prefValues[Z.kPanelsWindowInactiveTabsDays],t=Date.now()-864e5*e;return(await n.Z.tabs.query({discarded:!0})).filter((e=>e.lastAccessed<t)).map(l5.OK)}_onPageStoreChanged=()=>{this.blockPageStoreChange||this._onFilterChange(this.props.filter,nr.Z);const e=Ze.ZP.getActivePage(this.context.vivaldiWindowId);e&&e.pinned&&(this.lastActivePinnedId=e.id.toString()),this.#Vs().then((e=>this.setState({inactivePages:e})))};_onSyncedTabsStoreChanged=()=>{this._onFilterChange(this.props.filter,nr.Z)};_onTrashStoreChanged=()=>{this._onFilterChange(this.props.filter,nr.Z)};_onWindowStoreChanged=()=>{const e=this.getWindowIds(this.context.vivaldiWindowId);(0,sw.Z)(e,this.state.windowIds)||this.setState({windowIds:e})};_onWorkspaceStoreChanged=()=>{this.setState({nodes:this._getNodes(),hasContent:!0})};getWindowIds=e=>{const t=fe.ZP.isIncognito(e);return fe.ZP.getIds("normal").filter((e=>t===fe.ZP.isIncognito(e)))};#Hs(e,t,s,n,i){let a=0;const o=e.flatMap(((e,o)=>{if("tab"===e.type){a+=1;return[{id:e.id.toString(),type:"tab",parentId:t,title:e.page.vivExtData.fixedTitle??vs.jk.getDisplayTitle(e.page),index:o,pageIndex:e.page.index,wid:s,workspaceId:n,pageItem:b5(e.page,i),count:1}]}return"group"===e.type?(a+=e.pages.size,[{id:e.id,type:"stack",parentId:t,title:(0,hg.XN)(e.page)??vs.jk.getDisplayTitle(e.page),index:o,pageIndex:void 0,wid:s,workspaceId:n,count:e.pages.size,children:e.pages.map(((t,a)=>({id:t.id.toString(),type:"tab",parentId:e.id,title:t.vivExtData.fixedTitle??vs.jk.getDisplayTitle(t),index:a,pageIndex:t.index,wid:s,workspaceId:n,pageItem:b5(t,i),count:1}))).toArray()}]):[]}));return[a,o.toArray()]}#Gs(e){const t="off"===this.props.prefValues[Z.kTabsStackingMode];return this.state.windowIds.map(((s,n)=>{let i=0;const a=Ze.ZP.getWorkspaceTabsInWindow(s,void 0,t);if(0===a.size)return;const[o,r]=this.props.prefValues[Z.kPanelsWindowShowPinnedGroup]?a.partition((e=>e.page.pinned)):[a,(0,qe.aV)()],l=`window-${s}`,d=[];if(!r.isEmpty()){const t=`pinned-${s}`,[n,a]=this.#Hs(r,t,s,void 0,e);i+=n,d.push({id:t,type:"pinned",parentId:l,title:(0,W.Z)("title","Pinned Tabs"),index:0,pageIndex:void 0,wid:s,workspaceId:void 0,children:a,count:n})}const[c,h]=this.#Hs(o,l,s,void 0,e);i+=c;const u=Ze.ZP.getActivePage(s);return{id:l,type:"window",parentId:h5,title:u?vs.jk.getDisplayTitle(u):"",index:n,pageIndex:void 0,wid:s,workspaceId:void 0,children:[...d,...h],count:i}})).filter(Boolean)}#Ks(e,t){const s="workspaces",n=m_.Z.getState();let i=0;const a=n.map(((t,n)=>{const a=Ze.ZP.getWorkspaceTabs(t.id,!1),[o,r]=this.props.prefValues[Z.kPanelsWindowShowPinnedGroup]?a.partition((e=>e.page.pinned)):[a,(0,qe.aV)()],l=t.id,d=`workspace-${l}`,c=a.first()?.page?.windowId,h=[];let u=0;if(c&&!r.isEmpty()){const t=`pinned-${l}`,[s,n]=this.#Hs(r,t,c,l,e);u+=s,h.push({id:t,type:"pinned",parentId:d,title:(0,W.Z)("title","Pinned Tabs"),index:0,pageIndex:void 0,wid:c,workspaceId:l,children:n,count:s})}const[p,g]=c?this.#Hs(o,d,c,l,e):[0,[]];return u+=p,i+=u,{id:d,type:"workspace",parentId:s,title:t.name,index:n,pageIndex:void 0,wid:c,workspaceId:l,children:[...h,...g],count:u}}));if(i>0)return{id:s,type:"workspacesFolder",parentId:h5,title:(0,W.Z)("Workspaces"),index:t,pageIndex:void 0,wid:this.context.vivaldiWindowId,workspaceId:void 0,children:a,count:i}}#zs(e,t,s){const n=(0,ve.Z)(t.url??"")?.hostname??"",{favIconUrl:i,favIconLoadType:a}=vs.jk.getBookmarkFavicon(t.url);return{id:t.sessionId??"",parentId:e,type:"trash",index:s,title:vs.jk.getDisplayTitle(t),wid:this.context.vivaldiWindowId,workspaceId:void 0,pageIndex:void 0,count:1,trashItem:{tab:{handle:t,url:t.url??"",hostname:n,domain:v5(n),loadType:a,faviconUrl:i,useDefaultIcon:!1}}}}#$s(e){let t=0;const s={id:u5,type:"trashFolder",parentId:h5,title:(0,W.Z)("title","Closed Tabs"),index:e,pageIndex:void 0,wid:this.context.vivaldiWindowId,workspaceId:void 0,children:e5.Z.getTrash().map(((e,s)=>{if(e.tab)return t+=1,this.#zs(u5,e.tab,s);if(e.window&&e.window.tabs&&e.window.sessionId){const n=e.window,i=e.window.tabs,a=e.window.sessionId;return t+=i.length,{id:a,parentId:u5,type:"trash",index:s,title:(0,W.Z)("Window with $1 Tab","Window with $1 Tabs",[i.length]),wid:this.context.vivaldiWindowId,workspaceId:void 0,pageIndex:void 0,trashItem:{window:{handle:n}},count:i.length,children:i.map(((e,t)=>this.#zs(a,e,t)))}}})).filter(Boolean)};return s.count=t,s}#Ys(e){if(!Nn.hasSupport())return;const t={id:"sync",type:"syncFolder",parentId:h5,title:(0,W.Z)("title","Synced Tabs"),index:e,pageIndex:void 0,wid:this.context.vivaldiWindowId,workspaceId:void 0,children:[]},s=Nn.getDeviceTree();let n=0;return t.children=s.map(((e,s)=>{const i=new J4(e,this.context.vivaldiWindowId).build(t);return n+=i.count??0,i})),t.count=n,t}#Xs(e,t){const s=Ze.ZP.getState().values().flatMap((e=>e.list.toArray())),n=Object.groupBy(s,(e=>e.url));let i=0;const a=Object.entries(n).reduce(((t,[s,n],a)=>{if(n.length<2)return t;const o=n.filter((e=>Ze.ZP.canClosePage(e)));if(o.length>1){const n=o[0];i+=o.length,t.push({id:`duplicate-${s}`,type:"duplicateTab",parentId:p5,title:n.vivExtData.fixedTitle??vs.jk.getDisplayTitle(n),index:a,pageIndex:n.index,wid:n.windowId,workspaceId:void 0,pageItem:b5(n,e),count:o.length})}return t}),[]);if(a.length>0)return a.push({id:"duplicate-actionbutton",type:"button",parentId:p5,wid:a[0].wid,title:(0,W.Z)("Close All Duplicate Tabs"),index:a.length,pageIndex:void 0,workspaceId:void 0,buttonItem:{onClick:()=>a.forEach((({pageItem:e})=>e?.url&&c.ZP.closeDuplicateTabs(e.url)))},count:1}),{id:p5,type:"duplicatesFolder",parentId:h5,title:(0,W.Z)("title","Duplicate Tabs"),index:t,pageIndex:void 0,wid:this.context.vivaldiWindowId,workspaceId:void 0,children:a,count:i}}#Qs(e,t,s){const n={id:g5,type:"inactiveFolder",parentId:h5,title:(0,W.Z)("title","Inactive Tabs"),index:t,pageIndex:void 0,wid:this.context.vivaldiWindowId,workspaceId:void 0,children:[],count:0},i="inactive",a=s.map(((t,s)=>({id:`inactive-${t.id}`,type:"inactiveTab",parentId:i,title:t.vivExtData.fixedTitle??vs.jk.getDisplayTitle(t),index:s,pageIndex:t.index,wid:t.windowId,workspaceId:void 0,pageItem:b5(t,e),count:1}))),o=a.length;if(o>0)return a.push({id:"inactive-actionbutton",type:"button",parentId:i,wid:a[0].wid,title:(0,W.Z)("Close All Inactive Tabs"),index:a.length,pageIndex:void 0,workspaceId:void 0,buttonItem:{onClick:()=>c.ZP.closePage((0,qe.aV)(this.state.inactivePages))},count:1}),n.children=a,n.count=o,n}_getNodes=(e=this.state.inactivePages)=>{const t=fe.ZP.isIncognito(this.context.vivaldiWindowId)?"faviconSkipCache":"faviconFromCache",s=this.#Gs(t);if(this.props.prefValues[Z.kWorkspacesEnabled]){const e=this.#Ks(t,s.length);e&&s.push(e)}if(this.props.prefValues[Z.kPanelsWindowShowDuplicate]){const e=this.#Xs(t,s.length);e&&s.push(e)}const n=this.#Ys(s.length);if(n&&s.push(n),this.props.prefValues[Z.kPanelsWindowShowInactive]){const n=this.#Qs(t,s.length,e);n&&s.push(n)}return s.push(this.#$s(s.length)),s};_getRootNode=e=>({id:h5,parentId:"",type:"root",title:"",index:0,pageIndex:void 0,wid:this.context.vivaldiWindowId,workspaceId:void 0,children:e});_getChildren=e=>e?.children??[];_hasSyncChildren=e=>{switch(e.type){case"syncFolder":if(e.children)for(let t=0;t<e.children.length;t++)if(this._hasSyncChildren(e.children[t]))return!0;break;case"syncWindow":return Boolean(e.children?.length);case"syncDevice":if(e.children)for(let t=0;t<e.children.length;t++){const s=e.children[t];if("tab"===s.type)return!0;if("syncWindow"===s.type&&Boolean(s.children?.length))return!0}}return!1};_getPageIndex=e=>e.pageIndex;_getFilteredTree=e=>{const t=function(e,t){let s=!1;return e.pageItem?s=e.pageItem.url.includes(t):e.syncItem&&(s=e.syncItem.url.includes(t)),s||"window"===e.type||(s=e.title.toLowerCase().includes(t)),s},s=function(e,n,i,a){let o=!1;for(let r=0;r<e.length;r++){const l=e[r];let d=!1;if(l.children){const e={...l,children:[]};s(l.children,e.children,i,a)&&(n.push(e),o=!0,d=!0)}if(!d&&t(l,a)){const e={...l};n.push(e),l.children&&i.push(l),o=!0}}return o},n=[],i=[];return{nodes:n,collapsed:i,hasContent:s(this._getNodes(),n,i,e.toLowerCase())}};_onFilterChange=(e,t)=>{if(e&&e.length>0){const s=this._getFilteredTree(e);s.nodes.forEach(((e,t)=>{e.index=t})),this.setState({nodes:s.nodes,hasContent:s.hasContent},t(s.collapsed))}else this.setState({nodes:this._getNodes(),hasContent:!0},t([]))};getSelectedItem=()=>this.refTreeList.current?.getSelectedItem();getSelectedItems=()=>this.refTreeList.current?.getAllSelectedItems()||[];unSelectAll=()=>{this.refTreeList.current?.unSelectAll()};_isTrashFolder=e=>"trash"===e.type&&!e.trashItem;_isPinnedFolder=e=>"pinned"===e.type;_getSelectedBackgroundPages=()=>{const e=this.getSelectedItems(),t=e.filter((e=>"window"===e.type||"workspace"===e.type));return t.length>0?t.flatMap((e=>e.children||[e])).flatMap((e=>e.children||[e])).map((e=>e.pageItem)).filter(Boolean).filter((e=>e.page!==Ze.ZP.getActivePage(e.page.windowId))).map((e=>e.page)):e.flatMap((e=>e.children||[e])).map((e=>e.pageItem)).filter(Boolean).filter((e=>e.page!==Ze.ZP.getActivePage(e.page.windowId))).map((e=>e.page))};_getDiscardablePages=()=>this._getSelectedBackgroundPages().filter((e=>!e.discarded&&!e.isInspected));#qs(e){let t=e;if(1===t.length&&"stack"===t[0].type)return[];return t=t.filter((e=>"tab"===e.type||"stack"===e.type)).flatMap((e=>e.children??[e])).filter((e=>e.pageItem)),(e=>{const t=[];return e.forEach((e=>{e.pageItem&&-1===t.findIndex((t=>e.wid))&&t.push(e.wid)})),t})(t).length>1?[]:t}#Js(e){return e.filter((e=>"tab"===e.type||"trash"===e.type||"stack"===e.type)).flatMap((e=>e.children??[e])).filter((e=>e.pageItem||e.trashItem))}_getStackableNodesForHost=(e,t,s)=>this.state.nodes.filter((s=>("window"===s.type||"workspace"===s.type)&&s.wid===e&&s.workspaceId===t)).flatMap((e=>e.children??[e])).filter((e=>e.pageItem&&!e.pageItem.page.pinned&&e.pageItem.hostname===s));_getTileableSelectedNodes=()=>{const e=this.getSelectedItems();if(1===e.length&&"stack"!==e[0].type)return[];if(1===e.length&&"stack"===e[0].type){const t=new Map,s=this._getChildren(e[0]);for(let e=0;e<s.length;e++){const n=s[e].pageItem,i=n?(0,hg.jA)(n.page):void 0;if(void 0===i){t.clear();break}t.set(i,"")}if(1===t.size)return[]}const t=this._filterNodesToTabs().filter((e=>void 0!==e.pageItem)),s=new Set(t.map((e=>e.pageItem?.page&&(0,hg.jA)(e.pageItem.page))));return 1!==s.size||s.has(void 0)?t:[]};_filterNodesToTabs=()=>this.getSelectedItems().filter((e=>"tab"===e.type||"stack"===e.type||"pinned"===e.type)).flatMap((e=>e.children||e));_allTabsHaveTheSameTilingId=()=>{const e=new Set(this._filterNodesToTabs().map((e=>e.pageItem?(0,hg.jA)(e.pageItem.page):void 0)));return 1===e.size&&!e.has(void 0)};_getSelectedTilingItems=()=>this._filterNodesToTabs().map((e=>{const t=e.pageItem?(0,hg.jA)(e.pageItem.page):void 0;return t?{node:e,tid:t}:void 0})).filter(Boolean).filter(((e,t,s)=>s.indexOf(e)===t));_getNodesWithMediaState=(e,t)=>{let s=[];return"selection"===t?s=this.getSelectedItems():"all"===t?s=this.state.nodes:"active"===t&&(s=this.state.nodes.filter((e=>Boolean(e.pageItem&&e.pageItem.page.active)))),s.filter((e=>"window"===e.type||"tab"===e.type||"stack"===e.type||"pinned"===e.type)).map((e=>e.children||e)).reduce(((e,t)=>e.concat(t)),[]).filter((t=>{const s=t.pageItem?.page;return s&&("playing"===e?mq.Z.hasMediaState(s.id,"playing")&&!mq.Z.hasMediaState(s.id,"muting"):mq.Z.hasMediaState(s.id,e))&&!s.discarded}))};_getMuteableNodesFrom=e=>this._getNodesWithMediaState("playing",e);_muteOthers=e=>{if(e.pageItem)c.ZP.muteAllExcept(e.wid,[e.pageItem.page]);else{const t=this._getChildren(e).map((e=>e.pageItem?.page)).filter(Boolean);c.ZP.muteAllExcept(e.wid,t)}};_getPlayableNodesFrom=(e,t)=>{const s=this._getNodesWithMediaState("muting",e),n=t.pageItem?.page;switch(this.props.prefValues[Z.kTabsAutoMuting]){case"onlyActive":return s.filter((e=>e.pageItem?.page?.active));case"prioritizeActive":if(s.length>1){const e=Ze.ZP.getActivePage(t.wid);return e&&mq.Z.hasMediaState(e.id,"playing")?[]:s.filter((e=>e.pageItem?.page===n))}}return s};_isInStackFolder=e=>"stack"===e.type||Boolean(e.pageItem&&(0,hg.av)(e.pageItem.page));_isInTrashFolder=e=>"trash"===e.type||Boolean(e.trashItem);_isInPinnedFolder=e=>"pinned"===e.type||Boolean(e.pageItem?.page.pinned);_isSyncFolder=e=>"syncFolder"===e.type||"syncDevice"===e.type||"syncWindow"===e.type;_isInSyncFolder=e=>this._isSyncFolder(e)||Boolean(e.syncItem);_hasSyncUrls=e=>this._isSyncFolder(e)&&Boolean(e.children?.length)||Boolean(e.syncItem);_isWithinFolder=(e,t)=>{if(this._isFolder(e)){const s=Boolean(this.refTreeList.current?.isExpanded(e.id));return"on"===t||s&&"below"===t}return void 0!==e.parentId};_getStackFolderByNode=e=>{let t=e;return t?.pageItem&&(t=this._getNodeById(t.parentId)),"stack"===t?.type?t:void 0};_getPageByNode=e=>{if("stack"===e.type){const t=this._getChildren(e);return t.length>0?t[0].pageItem?.page:void 0}return e.pageItem?.page};_getPageIdByNode=e=>this._getPageByNode(e)?.id;_getNodeById=e=>{const t=s=>{for(let n=0;n<s.length;n++){const i=s[n];if(i.id===e)return i;if(i.children){const e=t(i.children);if(e)return e}}};return e===h5?this._getRootNode(this.state.nodes):t(this.state.nodes)};_getNodeByParentAndIndex=(e,t)=>{const s=this._getNodeById(e);return s&&s.children&&s.children.length>0?(t<0?t=0:t>=s.children.length&&(t=s.children.length-1),s.children[t]):s};_getNodeByParentAndPageIndex=(e,t)=>{const s=this._getNodeById(e)?.wid??this.context.vivaldiWindowId,n=Ze.ZP.getPages(s).find((e=>e.index===t));if(n)return this._getNodeById(n.id.toString())};_hasChildren=e=>Boolean(e.children&&e.children.length>0);_isFolder=e=>Boolean(e.children);_hasSwgIcon=e=>Boolean(e.icon);expandAll=()=>{this.refTreeList.current?.expandAll()};_onNodeClick=(e,t)=>{ai.Z.isNoModifierPressed(e)&&e.button===ai.Z.kLeft&&this.props.prefValues[Z.kPanelsWindowSingleClickOpens]&&this._onNodesActivated(e,[t])};_onNodeMouseDown=(e,t)=>{ai.Z.isNoModifierPressed(t)&&t.button===ai.Z.kCenter&&(this.centerDownId=e.id)};_onNodeMouseUp=(e,t)=>{ai.Z.isNoModifierPressed(t)&&t.button===ai.Z.kCenter&&this.centerDownId===e.id&&e.pageItem&&!e.pageItem.page.pinned&&this._closeWithId(e.id,t),this.centerDownId=""};_onNodeDoubleClick=(e,t)=>{if(e.button===ai.Z.kLeft&&!this.props.prefValues[Z.kPanelsWindowSingleClickOpens])if("panel"===t.type){const e=t?.syncItem?.url;e&&c.ZP.newTab(t.wid,e)}else this._onNodesActivated(e,[t])};handleNodesActivated=(e,t)=>{this._onNodesActivated(e,t)};_activateTab=e=>{if(e.pageItem){const t=e.pageItem.page.id,s=Ze.ZP.getPageById(t)?.windowId??e.wid,n=this.context.vivaldiWindowId,i=Ze.ZP.getActiveWorkspace(n);if(n===s)e.workspaceId!==i&&c.ZP.setActiveWorkspace(n,e.workspaceId);else{const t=Ze.ZP.getActiveWorkspaces();e.workspaceId&&!t.has(e.workspaceId)?c.ZP.setActiveWorkspace(n,e.workspaceId):e.workspaceId||c.ZP.setActiveWorkspace(s,e.workspaceId)}Wn.Z.focus(s).then((()=>{c.ZP.activateTab(t,s)}))}else e.syncItem&&Dn.openTabs([e.id])};_openSyncItems=e=>{const t=(e,s,n)=>{for(let i=0;i<e.length;i++){const a=e[i];"tab"===a.type?n.push(a.id):"window"===a.type&&s.push(a.id),a.children&&t(a.children,s,n)}},s=[],n=[];t(e,s,n),Dn.openTabs(n),Dn.openWindows(s)};_onNodesActivated=(e,t)=>{const s=t[0];if(s.trashItem)s.trashItem.tab?Ln.Z.undeleteTab(s.trashItem.tab.handle.sessionId):s.trashItem.window&&Ln.Z.undeleteWindow(s.trashItem.window.handle.sessionId);else if(s.pageItem)this._activateTab(s);else if(s.syncItem)this._activateTab(s);else if(s.buttonItem)s.buttonItem.onClick();else if(this._isPinnedFolder(s)){let e=this._getNodeById(this.lastActivePinnedId);!e&&s.children&&s.children.length>0&&(e=s.children[0]),e?.pageItem&&this._activateTab(e)}};_closeByIds=e=>{let t=e.map((e=>this._getNodeById(e))).filter(Boolean);const s=t.filter((e=>"stack"===e.type)),n=t.filter((e=>"workspace"===e.type)),i=t.filter((e=>"window"===e.type)),a=t.filter((e=>"trash"===e.type)),o=s.map((e=>e.children)).filter(Boolean).reduce(((e,t)=>e.concat(t)),[]);if(t=t.filter((e=>"stack"!==e.type&&"workspace"!==e.type)).filter((e=>-1===o.findIndex((t=>t.id===e.id)))),i.length>0)return i.forEach((e=>Wn.Z.close(e.wid))),Promise.resolve([]);if(1===n.length&&1===e.length){const e=n[0]?.workspaceId;if(e)return ue.Z.showDeleteWorkspace(this.context.vivaldiWindowId,{workspaceId:e}),Promise.resolve([])}s.forEach((e=>{const t=this._getPageIdByNode(e);"number"==typeof t&&c.ZP.closeTabStack(t)})),c.ZP.closePage((0,qe.aV)(t.map((e=>e.pageItem?.page)).filter(Boolean)));const r=a.flatMap((e=>{if(e.trashItem?.window&&e.children){return e.children.map((e=>e.trashItem?.tab?.handle.sessionId)).filter(Boolean)}return e.trashItem?.tab?.handle.sessionId})).filter(Boolean);return Ln.Z.removeTabs(r),Promise.resolve([])};_getPagesByIds=e=>{const t=[];return e.map((e=>this._getNodeById(e))).filter(Boolean).forEach((e=>{e.pageItem?t.push(e.pageItem.page):e.children&&("window"===e.type?t.push(...this._getChildren(e).map((e=>e.children||e)).reduce(((e,t)=>e.concat(t)),[]).map((e=>e.pageItem?.page)).filter(Boolean)):t.push(...this._getChildren(e).map((e=>e.pageItem?e.pageItem.page:void 0)).filter(Boolean)))})),t};_getSyncNodesByIds=e=>{const t=[];for(let s=0;s<e.length;s++){const n=this._getNodeById(e[s]);if(n?.syncItem)t.push(n);else if(n?.children){const e=n.children.map((e=>e.id));t.push(...this._getSyncNodesByIds(e))}}return t};_saveBookmarkByIds=e=>{const t=g.Z.getRootId();if(void 0!==t)if(0===e.length)ne.Z.bookmarkAllOpenPages(this.context.vivaldiWindowId,t);else{const s=this._getNodeById(e[0]);if(s&&this._isInSyncFolder(s)){const s=this._getSyncNodesByIds(e).map((e=>{if(e.syncItem)return{url:e.syncItem.url,title:e.title}})).filter(Boolean);ne.Z.createBookmarks(s,t,0,"sync")}else ne.Z.bookmarkPages((0,qe.aV)(this._getPagesByIds(e)),!1,t)}};_saveSessionByIds=e=>{const t=this.context.vivaldiWindowId;if(0===e.length)ue.Z.showSaveSessionDialog(t,{mode:"all"});else{const s=this._getPagesByIds(e).map((e=>e.id));s.length>0&&ue.Z.showSaveSessionDialog(t,{mode:"ids",ids:s})}};_handleExpandClick=(e,t)=>{(0,wi.ZP)(e);const s=e.altKey;this.refTreeList.current?.toggleSelectedExpansion(t,s)};_validateForDrag=e=>{const t=e.map((e=>this._getNodeById(e))).filter(Boolean).filter((e=>e&&!this._isSyncFolder(e)));return t.every((e=>"workspace"===e.type))?t.map((e=>e.id)):t.reduce(((e,t)=>{switch(t.type){case"tab":case"stack":case"trash":case"pinned":case"panel":case"syncDevice":case"syncWindow":case"syncPanels":e.push(t.id)}return e}),[])};_getDragData=(e,t)=>{const s=t.map((e=>this._getNodeById(e))).filter(Boolean);if("text/plain"===e){return s.map((e=>e.pageItem?e.pageItem.url:e.trashItem?.tab?e.trashItem.tab.url:e.syncItem?.url?e.syncItem.url:e.title)).join("\r\n")}if(Jn.ZP.isUriListType(e)){return s.map((e=>e.pageItem?e.pageItem.url:e.trashItem?.tab?.url||"")).filter(Boolean).join("\r\n")}return""};_setCustomEventBehavior=(e,t)=>{const s=t.map((e=>this._getNodeById(e))).filter(Boolean),n=s.map((e=>Boolean(e.trashItem))),i=s.map((e=>Boolean(e.pageItem?.page.pinned))),a=s.map((e=>Boolean(e.syncItem)));if(n.some((e=>!0===e))&&e.dataTransfer.setData("vivaldi/x-tab-closed",JSON.stringify(n)),i.some((e=>!0===e))&&e.dataTransfer.setData("vivaldi/x-tab-pinned",JSON.stringify(i)),a.some((e=>!0===e))&&e.dataTransfer.setData("vivaldi/x-tab-sync",JSON.stringify(a)),1===s.length){const t=this._getTitle(s[0].id);t&&e.dataTransfer.setData("vivaldi/x-title",t)}};_getDropSupport=(e,t)=>{const s={available:!1,onto:!1,edge:"both"};if(this._isInSyncFolder(e)||"duplicatesFolder"===e.type||"duplicateTab"===e.type||"inactiveFolder"===e.type||"inactiveTab"===e.type||"button"===e.type)return s.edge="none",s;if(-1!==t.dataTransfer.types.findIndex((e=>"vivaldi/x-tab-sync"===e)))return s.edge="none",s;if(-1!==t.dataTransfer.types.findIndex((e=>"vivaldi/x-tab-closed"===e)))return s.available=!this._isInTrashFolder(e),s.onto=s.available&&this._canDropOnto(e,t),s;if(-1!==t.dataTransfer.types.findIndex((e=>"vivaldi/x-tab-pinned"===e))){if(!this.props.prefValues[Z.kPanelsWindowShowPinnedGroup])return s.available=Boolean(e.pageItem?.page.pinned),s.onto=s.available&&this._canDropOnto(e,t),s;if(this._isInTrashFolder(e))return s}return t.dataTransfer.types.some((e=>Jn.ZP.isUriListType(e)||"text/plain"===e))&&(t.dataTransfer.types.includes(m5)?(s.available=!0,this._isTrashFolder(e)&&(s.edge="none")):s.available=!this._isInTrashFolder(e),s.onto=s.available&&this._canDropOnto(e,t)),s};_canDropOnto=(e,t)=>!this._isInSyncFolder(e)&&(!!this._isFolder(e)||!(t.dataTransfer.types.includes(m5)&&(!this.props.prefValues[Z.kPanelsWindowDragToStack]||this._isInPinnedFolder(e)||this._isInStackFolder(e)))&&!this._isInTrashFolder(e));_getDropIndexByNode=(e,t)=>{let s=0;if(e.pageItem){const n=e.pageItem.page.id;s=Ze.ZP.getPages(e.wid).findIndex((e=>e.id===n)),"below"===t&&(s+=1)}else if(e.children){const n=this._getChildren(e);if(n.length>0){if("above"===t||"below"===t){const e=n[0];if(e.pageItem){const t=e.pageItem.page.id;s=Ze.ZP.getPages(e.wid).findIndex((e=>e.id===t))}}"below"===t&&(s+=1)}}return s};_onDrop=async(e,t,s)=>{const n=Jn.ZP.extractUriListFromEvent(e).split("\n").map((e=>e));if(n.length>0)if("on"===s&&t.pageItem)c.ZP.openURL(t.wid,n[0],{inCurrent:!0,inSpecificPageId:t.pageItem.page.id});else{const e=this._getTargetSpec(t,s),i=this._getDropIndexByNode(t,s),a=t.wid,o=this._getStackFolderByNode(t),r=this._getPageByNode(t),l=o&&r&&(0,hg.av)(r);try{const d=await c.ZP.newTab(a,n[0],{index:i,workspaceId:t.workspaceId,groupId:l}),h=Ze.ZP.getPageById(d);if(h&&this._isWithinFolder(t,s)&&this._isInPinnedFolder(t)){c.ZP.setPinned(qe.aV.of(h),!0);const t=e.pageIndex??e.index??0;await c.ZP.moveToIndex(h.windowId,h,t)}else if(h&&l&&o){const e=r?.index??this._getPageIndex(o)??0;c.ZP.moveToIndex(a,h,e)}this.refTreeList.current?.selectById(d.toString())}catch(e){console.warn(e)}}return Promise.resolve([])};_moveWorkspaces(e,t,s){const n=e.workspaceId,i=m_.Z.getState().map((e=>e.id)),a=t.map((e=>e.workspaceId)).filter(Boolean).toArray(),o=[];if("workspace"===e.type||e.parentId.startsWith("workspace"))for(const e of i)a.includes(e)||(e===n?"above"===s?o.push(...a,e):o.push(e,...a):o.push(e));else if(e.parentId.startsWith("window")){o.push(...a);for(const e of i)o.includes(e)||o.push(e)}o.length===i.length&&GB.Z.setOrder(o)}_getTargetPage=(e,t,s)=>{const n=t.pageIndex,i=e?.index??0;if(!n||e?.windowId!==t.wid)return this._getPageByNode(t);let a=0;i<n?a="above"===s?-1:0:i>n&&(a="below"===s?1:0);const o=n+a;return Ze.ZP.getPages(t.wid).find((e=>e.index===o))};_onMove=async(e,t,s)=>{const{parentId:n=""}=t;let i=t.index??0;const a=this._getNodeById(n);if(!a||!n)return;this.isDroppingOnWindowOrWorkspace&&"above"===s?s="below":this.isDroppingOnWindowOrWorkspace&&!this._isTrashFolder(a)&&"on"===s?s="above":"stack"===a.type&&"on"===s&&(s="below",i=this._getChildren(a).length),this.isDroppingOnWindowOrWorkspace=!1;const o=void 0!==t.pageIndex?this._getNodeByParentAndPageIndex(n,t.pageIndex):this._getNodeByParentAndIndex(n,i);if(!o)return;const r=(0,qe.aV)(e).map(this._getNodeById).filter(Boolean),l=r.flatMap((e=>e.children?(0,qe.aV)(e.children):qe.aV.of(e))).map(this._getPageByNode).filter(Boolean);let d=this._getTargetPage(l.first(),o,s);d||(d=this._isInPinnedFolder(a)?Ze.ZP.getTabs(a.wid).find((e=>e.page.pinned))?.page:Ze.ZP.getTabs(a.wid).find((e=>!e.page.pinned))?.page);const h=this._getNodeById(e[0]);if(!h)return;const u=h.wid;if(this._isInTrashFolder(o))return void this._closeByIds(e);if(h.trashItem)return void r.forEach((e=>{e.trashItem?.tab?Ln.Z.undeleteTab(e.trashItem.tab.handle.sessionId):e.trashItem?.window&&Ln.Z.undeleteWindow(e.trashItem.window.handle.sessionId)}));const p=o.workspaceId;if(r.every((e=>"workspace"===e.type)))return void this._moveWorkspaces(o,r,s);const g=o.pageItem&&(0,hg.av)(o.pageItem.page),m=e.filter((e=>Ze.ZP.isGroup(e,u)));if("stack"===a.type&&Ze.ZP.isGroup(g,o.wid))await c.ZP.treeMove({windowId:u,pages:l,groups:m,targetArea:"stack",targetPage:d,targetGroup:g,targetWorkspaceId:p});else if(this.props.prefValues[Z.kPanelsWindowShowPinnedGroup]&&this._isInPinnedFolder(a)){const e=l.first();let t=e?(0,hg.av)(e):"";t&&l.size>1&&(Ze.ZP.getGroup(t,u).size!==l.size||l.some((e=>(0,hg.av)(e)!==t)))&&(t=""),await c.ZP.treeMove({windowId:u,pages:l,groups:m,targetArea:"pinned",targetPage:d,targetGroup:t,targetWorkspaceId:p})}else if("on"===s&&void 0!==t.pageIndex&&this.props.prefValues[Z.kPanelsWindowDragToStack]){if(d){const e=d.id,t=l.filter((t=>t.id!==e));let s=d.index,n=0;for(let e=0;e<t.size;e++){const i=t.get(e);i&&s>i.index&&n++}s-=n;const i=Ze.ZP.getNewGroupId();c.ZP.createTabStack(t.splice(0,0,d),s,i),this.refTreeList.current?.selectById(i)}}else await c.ZP.treeMove({windowId:u,pages:l,groups:m,targetArea:"regular",targetPage:d,targetWorkspaceId:p});l.some((e=>e.active))&&c.ZP.setActiveWorkspace(u,p);const f=new Map([...m_.Z.getWorkspacePageCounts()]);for(const[e,t]of f)if(0===t){const{pageId:t}=await c.ZP.openURL(u,"",{inBackground:!0}),s=await Ze.ZP.getPageInWindow(u,t);s&&c.ZP.moveToWorkspace(s,e)}};_onCopy=(e,t)=>{const s=t.filter(this._isValidForClipboard),n=s.map((e=>e.pageItem?.page)).filter(Boolean),i=s.map((e=>e.syncItem?.url)).filter(Boolean),a=s.map((e=>e.trashItem?.tab?e.trashItem.tab.url:"")).filter(Boolean);c.ZP.copyUrls((0,qe.aV)(n),(0,qe.aV)([...i,...a])),e.preventDefault()};_isValidForClipboard=e=>Boolean(e.pageItem||e.syncItem||e.trashItem?.tab);_isValidToDelete=e=>e.map((e=>this._getNodeById(e))).filter(Boolean).filter((e=>!this._isInPinnedFolder(e))).filter((e=>!this._isInSyncFolder(e))).map((e=>e.id));_getTargetSpec=(e,t)=>{const s={index:0,parentId:void 0,pageIndex:e.pageIndex},n=Boolean(this.refTreeList.current?.isExpanded(e.id)),i=this._isFolder(e);if(!i||"window"!==e.type&&"workspace"!==e.type&&"trash"!==e.type)i&&("on"===t||n&&"below"===t)?s.parentId=e.id:e.parentId?(s.parentId=e.parentId,s.index=e.index+("below"===t?1:0)):(s.parentId=e.id,s.index=0);else if(this.isDroppingOnWindowOrWorkspace=!0,"above"===t){const t=this.state.nodes.findIndex((t=>t.id===e.id)),n=this.state.nodes[Math.max(0,t-1)];s.parentId=n.id,s.index=n.children?.length}else s.parentId=e.id;return s};_reload=()=>{const e=this.getSelectedItems(),t=e.filter((e=>"window"===e.type)).map((e=>this._getChildren(e))).filter(Boolean).reduce(((e,t)=>e.concat(t)),[]).map((e=>e.children||e)).reduce(((e,t)=>e.concat(t)),[]),s=e.filter((e=>"stack"===e.type||"pinned"===e.type)).map((e=>this._getChildren(e))).filter(Boolean).reduce(((e,t)=>e.concat(t)),[]).filter((e=>-1===t.findIndex((t=>t===e.id)))),n=e.filter((e=>"tab"===e.type&&Boolean(e.pageItem))).filter((e=>-1===t.findIndex((t=>t===e.id)))).filter((e=>-1===s.findIndex((t=>t===e.id))));[t,s,n].forEach((e=>{const t=e.map((e=>e.pageItem?.page.id)).filter(Boolean);c.ZP.reloadPage((0,qe.aV)(t))}))};_tile=()=>{const e=this._getTileableSelectedNodes();e.length>1&&c.ZP.tilePages((0,qe.aV)(e.map((e=>e.pageItem?.page)).filter(Boolean)),"row")};_untileTileGroup=()=>{this._getSelectedTilingItems().forEach((e=>{c.ZP.untileTileGroup(e.node.wid,e.tid)}))};_removeTile=()=>{const e=this._getSelectedTilingItems().reduce(((e,{node:t})=>t.pageItem?.page?e.push(t.pageItem.page):e),(0,qe.aV)());c.ZP.untilePages(e)};_setMediaState=(e,t)=>{if("playing"===e){const e=this._getPlayableNodesFrom("selection",t).map((e=>e.pageItem?.page)).filter(Boolean);c.ZP.setMuting(t.wid,"selection","unmute",(0,qe.aV)(e))}else if("muting"===e){const e=this._getMuteableNodesFrom("selection").map((e=>e.pageItem?.page)).filter(Boolean);c.ZP.setMuting(t.wid,"selection","mute",(0,qe.aV)(e))}};newTab=e=>{const t=Ze.ZP.getActiveWorkspace(e);c.ZP.newTab(e,"",{workspaceId:t}).then((e=>{this.refTreeList.current?.expandToId(e.toString()),this.refTreeList.current?.selectById(e.toString())})).catch((e=>{console.warn(e)}))};_newTabAfter=e=>{const t=this._getNodeById(e);if(!t)return;const s=this._getTargetSpec(t,"below"),n="window"===t.type||"workspace"===t.type?"on":"below",i=this._getDropIndexByNode(t,n);this.blockPageStoreChange=!0,c.ZP.newTab(t.wid,"",{index:i,workspaceId:t.workspaceId}).then((e=>{if(this._isWithinFolder(t,"below")){const n=Ze.ZP.getPages(t.wid).find((t=>t.id===e));if(this._isInPinnedFolder(t)){const e=this._getPageIndex(t);n&&void 0!==e&&(c.ZP.setPinned(qe.aV.of(n),!0),c.ZP.moveToIndex(n.windowId,n,e))}else if(this._isInStackFolder(t)){const e=this._getPageByNode(t),i=this._getStackFolderByNode(t);if(e&&i){const t=this._getChildren(i).map((e=>e.pageItem?.page)).filter(Boolean);t.splice(s.index??0,0,n),c.ZP.createTabStack((0,qe.aV)(t.filter(Boolean)),this._getPageIndex(i),e.vivExtData.group)}}}this.blockPageStoreChange=!1,this._onPageStoreChanged(),this.refTreeList.current?.expandToId(e.toString()),this.refTreeList.current?.selectById(e.toString())})).catch((e=>{console.warn(e)}))};_cloneTab=()=>{const e=this.getSelectedItems().map((e=>e.pageItem?.page)).filter(Boolean);c.ZP.clonePages((0,qe.aV)(e))};_pinTab=()=>{const e=this.getSelectedItems().filter((e=>!this._isInStackFolder(e))).map((e=>e.pageItem?.page)).filter(Boolean).filter((e=>!e.pinned));c.ZP.setPinned((0,qe.aV)(e),!0)};_unpinTab=()=>{const e=this.getSelectedItems().map((e=>e.pageItem?.page)).filter(Boolean).filter((e=>e.pinned));c.ZP.setPinned((0,qe.aV)(e),!1)};_closeWithId=(e,t)=>{(0,wi.ZP)(t);const s=this._getNodeById(e);if(s)if("tab"===s.type||"inactiveTab"===s.type)this.refTreeList.current?.onDeleteItems([s.id]);else if("stack"===s.type){const e=this._getPageIdByNode(s);"number"==typeof e&&c.ZP.closeTabStack(e)}else"duplicateTab"===s.type&&s.pageItem?.url&&c.ZP.closeDuplicateTabs(s.pageItem.url)};_deleteWithId=(e,t)=>{(0,wi.ZP)(t);const s=this._getNodeById(e);s&&this.refTreeList.current?.onDeleteItems([s.id])};_close=()=>{const e=this.getSelectedItems(),t=e.filter((e=>"stack"===e.type)),s=t.map((e=>this._getChildren(e))).filter(Boolean).reduce(((e,t)=>e.concat(t)),[]),n=e.filter((e=>Boolean(e.pageItem))).filter((e=>-1===s.findIndex((t=>t===e.id))));this.blockPageStoreChange=!0;let i=t.map((e=>this._getPageByNode(e))).filter(Boolean);i.forEach((e=>{c.ZP.closeTabStack(e.id)})),i=n.map((e=>e.pageItem?.page)).filter(Boolean).filter((e=>!e.pinned)),c.ZP.closePage((0,qe.aV)(i)),this.blockPageStoreChange=!1,this._onPageStoreChanged()};_reopen=()=>{const e=this.getSelectedItems().filter((e=>Boolean(e.trashItem))),t=e.filter((e=>Boolean(e.trashItem?.window))),s=t.map((e=>e.children)).filter(Boolean).reduce(((e,t)=>e.concat(t)),[]),n=e.filter((e=>-1===s.findIndex((t=>t===e.id))));t.forEach((e=>{e.trashItem?.window&&Ln.Z.undeleteWindow(e.trashItem.window.handle.sessionId)})),n.forEach((e=>{e.trashItem?.tab&&Ln.Z.undeleteTab(e.trashItem.tab.handle.sessionId)}))};_createTabStack=e=>{if(e.length<2)return;let t=-1;for(let s=0;s<e.length;s++){let n=e[s];if(n&&this._isInStackFolder(n)&&(n=this._getNodeById(n.parentId)),!n)return;{const e=this._getPageIndex(n)??-1;(-1===t||t>e)&&(t=e)}}const s=e.map((e=>e.pageItem?.page)).filter(Boolean);if(s.length<2)return;const n=Ze.ZP.getNewGroupId();return c.ZP.createTabStack((0,qe.aV)(s),-1===t?0:t,n),this.refTreeList.current?.selectById(n),n};_disolveTabStack=()=>{const e=this.getSelectedItems(),t=e.filter((e=>"stack"===e.type)),s=t.map((e=>this._getPageByNode(e))).filter(Boolean);s.forEach((e=>{const t=(0,hg.av)(e);t&&c.ZP.expandTabStack(e.windowId,t)})),s.length>0&&e.length===t.length&&this.refTreeList.current?.selectById(s[0].id.toString())};_hibernate=()=>{this._getDiscardablePages().forEach((e=>{c.ZP.discardPage(e)}))};_reopenLastClosedTab=()=>{Ln.Z.undeletePreviousTab()};_validateForEdit=e=>{const t=this._getNodeById(e);return!!t&&("workspace"===t.type||Ze.ZP.isGroup(e,t.wid)||Boolean(t.pageItem))};_getTitle=e=>{let t;const s=this._getNodeById(e);if(s?.pageItem)t=s.pageItem.page.vivExtData.fixedTitle;else if("stack"===s?.type){const e=s?.children;e&&e[0]?.pageItem&&(t=(0,hg.XN)(e[0]?.pageItem.page))}return t??s?.title??""};_setTitle=(e,t)=>{const s=this._getNodeById(e);s&&("workspace"===s.type&&s.workspaceId?t&&GB.Z.setName(s.workspaceId,t):s.pageItem?c.ZP.setFixedTitle(s.pageItem.page.id,t):Ze.ZP.isGroup(e,s.wid)&&c.ZP.setFixedStackTitle(s.wid,e,t))};_getMenuCapability=async(e,t,s)=>{const n=s?s.wid:this.context.vivaldiWindowId,i=s?.pageItem?.page,a="tab"===s?.type,o=a||"stack"===s?.type,r=o||"window"===s?.type,l="workspace"===s?.type,d=Boolean(s&&this._isInTrashFolder(s)),h=s&&this._isInSyncFolder(s),u=this.getSelectedItems(),p=this.#Js(u),g=this.#qs(u),m={hostname:i?(0,r5.q)(i):"",selectedCount:p.length,selectedStackableCount:g.length,isInTrashFolder:d};let f,v=!1;if(i)f=(0,hg.av)(i);else if(!a&&s?.children&&"stack"===s?.type){const e=s.children[0]?.pageItem?.page;e?.pinned&&(v=!0),f=e&&(0,hg.av)(e)}switch(e.action){case"CONTEXT_NEW":return{handler:()=>{s?this._newTabAfter(s.id):this.newTab(n)},isVisible:()=>!s||!d&&!h,...t(n,e,m)};case"CONTEXT_NEW_WINDOW":return{handler:()=>{fe.ZP.isGuest()?Wn.Z.openIncognitoWindow(n):Wn.Z.openBrowserWindow(n)},isVisible:()=>!s||!d&&!h,...t(n,e,m)};case"CONTEXT_NEW_WORKSPACE":return{handler:()=>ue.Z.showWorkspaceDialog(n),isVisible:()=>this.props.prefValues[Z.kWorkspacesEnabled]&&(!s||!d&&!h),...t(n,e,m)};case"CONTEXT_ACTIVATE_WORKSPACE":return{handler:()=>{s&&"workspace"===s.type&&c.ZP.setActiveWorkspace(this.context.vivaldiWindowId,s.workspaceId)},isVisible:()=>"workspace"===s?.type,...t(n,e,m)};case"CONTEXT_NEW_STACK":return{handler:()=>this._createTabStack(g),isVisible:()=>{const e=g.filter((e=>e.pageItem?.page.pinned)).length;return(0===e||e===g.length)&&!h&&o&&g.length>1},...t(n,e,m)};case"CONTEXT_NEW_STACK_FOR_HOST":if(!s)return{isVisible:()=>!1,...t(n,e,m)};const{pageItem:p,workspaceId:b}=s,C=p?.hostname||"",w=C?this._getStackableNodesForHost(s.wid,b,C):[];return{handler:()=>c.ZP.createGroupByHost(s.wid,b,C),isVisible:()=>a&&!h&&1===u.length&&w.length>1,...t(n,e,m)};case"CONTEXT_TABSTACK_UNGROUP":return{handler:()=>{this._disolveTabStack()},isVisible:()=>"stack"===s?.type,...t(n,e,m)};case"CONTEXT_CLONE":return{handler:()=>{this._cloneTab()},isVisible:()=>a&&!d&&!h,...t(n,e,m)};case"CONTEXT_ACTIVATE":return{handler:()=>{if(Wn.Z.focus(n),i){const e=(0,hg.cm)(i);e!==Ze.ZP.getActiveWorkspace(n)&&c.ZP.setActiveWorkspace(n,e),c.ZP.activateTab(i.id,n)}},isVisible:()=>("window"!==s?.type||n!==this.context.vivaldiWindowId)&&(r&&!d&&!h),...t(n,e,m)};case"CONTEXT_RELOAD":return{handler:()=>{this._reload()},isVisible:()=>r&&!d&&!h,...t(n,e,m)};case"CONTEXT_HIBERNATE":return{handler:()=>{this._hibernate()},isEnabled:()=>this._getDiscardablePages().length>0,isVisible:()=>(r||l)&&!d&&!h,...t(n,e,m)};case"CONTEXT_PIN":return{handler:()=>{this._pinTab()},isVisible:()=>Boolean(i&&!i.pinned&&!d&&!f&&"inactiveTab"!==s?.type&&"duplicateTab"!==s?.type),...t(n,e,m)};case"CONTEXT_PIN_STACK":return{handler:()=>f&&c.ZP.pinTabStack(f,this.context.vivaldiWindowId),isVisible:()=>!v&&Ze.ZP.isGroup(f,n)&&"stack"===s?.type,...t(n,e,m)};case"CONTEXT_UNPIN":return{handler:()=>{this._unpinTab()},isVisible:()=>Boolean(i?.pinned)&&!d&&!f,...t(n,e,m)};case"CONTEXT_UNPIN_STACK":return{handler:()=>f&&c.ZP.unpinTabStack(f,this.context.vivaldiWindowId),isVisible:()=>v,...t(n,e,m)};case"CONTEXT_TILE_TABS":return{handler:()=>{this._tile()},isVisible:()=>{if(o&&!h){const e=Ze.ZP.getActiveWorkspace(n),t=this._getTileableSelectedNodes();return t.length>0&&t.every((t=>{const s=t?.pageItem?.page;return s&&t.wid===n&&(0,hg.cm)(s)===e}))}return!1},...t(n,e,m)};case"CONTEXT_UNTILE_TAB":return{handler:this._removeTile,isVisible:()=>o&&this._allTabsHaveTheSameTilingId(),...t(n,e,m)};case"CONTEXT_UNTILE_TILE_GROUP":return{handler:this._untileTileGroup,isVisible:()=>o&&this._allTabsHaveTheSameTilingId(),...t(n,e,m)};case"CONTEXT_MUTE":return{handler:()=>{s&&this._setMediaState("muting",s)},isVisible:()=>r&&!d&&!h&&this._getMuteableNodesFrom("selection").length>0,...t(n,e,m)};case"CONTEXT_MUTE_OTHER":{const i="window"===s?.type&&Boolean(s.wid!==this.context.vivaldiWindowId);return{handler:()=>{s&&this._muteOthers(s)},isVisible:()=>!!s&&((o||i)&&this._getMuteableNodesFrom("all").filter((e=>e.id!==s.id)).length>0),...t(n,e,m)}}case"CONTEXT_UNMUTE":return{handler:()=>{s&&this._setMediaState("playing",s)},isVisible:()=>!!s&&(r&&this._getPlayableNodesFrom("selection",s).length>0),...t(n,e,m)};case"CONTEXT_EMPTY_TRASH":return{handler:()=>{Ln.Z.emptyTrash()},isVisible:()=>"trashFolder"===s?.type&&!e5.Z.isEmpty(),...t(n,e,m)};case"CONTEXT_REOPEN":return{handler:()=>{s?this._reopen():this._reopenLastClosedTab()},isVisible:()=>Boolean((!s||s.trashItem)&&!e5.Z.isEmpty()),...t(n,e,m)};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{handler:()=>s?.workspaceId&&c.ZP.detachWorkspace(n,s.workspaceId),isVisible:()=>"workspace"===s?.type,isEnabled:()=>{const e=Ze.ZP.getActiveWorkspaces();return"number"==typeof s?.workspaceId&&!e.has(s.workspaceId)},...t(n,e,m)};case"CONTEXT_OPEN_SYNC_ITEMS":return{handler:()=>{s&&this._openSyncItems(u)},isVisible:()=>void 0!==s&&"syncFolder"!==s.type&&this._isInSyncFolder(s)&&this._hasSyncUrls(s),...t(n,e,m)};case"CONTEXT_REGISTER_SYNC":return{handler:()=>{ue.Z.showSettings(this.context.vivaldiWindowId,"sync",{view:"register"})},isVisible:()=>void 0!==s&&this._isInSyncFolder(s)&&!Nn.getLoggedIn(),...t(n,e,m)};case"CONTEXT_SIGNIN_SYNC":return{handler:()=>{ue.Z.showSettings(this.context.vivaldiWindowId,"sync")},isVisible:()=>void 0!==s&&this._isInSyncFolder(s)&&!Nn.getLoggedIn(),...t(n,e,m)};case"COMMAND_PAGE_COPY_ALL_URLS":{const i={...t(n,e,m)};let a=!1;return s&&("workspace"===s.type?a=s.workspaceId===Ze.ZP.getActiveWorkspace(s.wid):"window"===s.type&&(a=s.wid===fe.ZP.getActiveWindowId()&&void 0===Ze.ZP.getActiveWorkspace(s.wid))),{...i,shortcuts:a?i.shortcuts:[],handler:()=>{s&&c.ZP.copyAllUrls(s.wid,s.workspaceId)},isVisible:()=>"workspace"===s?.type||"window"===s?.type}}default:return{...t(n,e,m)}}};_getMenuVisibility=(e,t)=>{if(t&&"button"!==t.type)if(this._isTrashFolder(t)||"duplicatesFolder"===t.type||"duplicateTab"===t.type||"inactiveFolder"===t.type||"inactiveTab"===t.type||"window"===t.type||"workspacesFolder"===t.type||"syncFolder"===t.type||"trashFolder"===t.type)switch(e.action){case"CONTEXT_EXPAND_ALL":case"CONTEXT_COLLAPSE_ALL":return!0;default:return!1}else if("workspace"===t.type)switch(e.action){case"CONTEXT_RENAME":return this._validateForEdit(t.id)&&1===this.getSelectedItems().length;case"CONTEXT_SAVE":case"CONTEXT_SAVE_ALL":case"CONTEXT_DELETE":case"CONTEXT_EXPAND_ALL":case"CONTEXT_COLLAPSE_ALL":return!0;default:return!1}else{const s=this._isValidToDelete([t.id]).length>0,n=!fe.ZP.isGuest()&&(this._isInSyncFolder(t)?this._hasSyncUrls(t):!this._isInTrashFolder(t)),i=n&&!this._isInSyncFolder(t),a=this.getSelectedItems();switch(e.action){case"CONTEXT_RENAME":return this._validateForEdit(t.id)&&1===a.length;case"CONTEXT_COPY":return this._isValidForClipboard(t);case"CONTEXT_SAVE":case"CONTEXT_SAVE_ALL":return n;case"CONTEXT_EXPORT_ALL":return i;case"CONTEXT_EXPORT":return i&&a.length>0;case"CONTEXT_DELETE":return s;case"CONTEXT_EXPAND_ALL":case"CONTEXT_COLLAPSE_ALL":return!0;default:return!1}}else switch(e.action){case"CONTEXT_EXPAND_ALL":case"CONTEXT_COLLAPSE_ALL":return!0;default:return!1}};_getMenuState=e=>{const t=e?.pageItem?.page,s=this.getSelectedItems(),n=this.#Js(s),i=this.#qs(s),a=Boolean(e&&this._isInTrashFolder(e));return{hostname:t?(0,r5.q)(t):"",selectedStackableCount:i.length,selectedCount:n.length,isInTrashFolder:a}};onContextMenu=e=>{this.refTreeList.current?.onContextMenu(e)};getRowHeight=(e,t)=>function(e,t,s){const n=Ti();switch(e){case"window":return 0===t?n+6:n+6+6;case"workspacesFolder":case"syncFolder":case"duplicatesFolder":case"inactiveFolder":case"trashFolder":return n+6+6;case"button":return 1.5*n;default:return s?n+3:n}}(e.type,e.index,t);getRowComponentProps=e=>({...e,getPageByNode:this._getPageByNode,isInPinnedFolder:this._isInPinnedFolder(e.node),isInTrashFolder:this._isInTrashFolder(e.node),isInSyncFolder:this._isInSyncFolder(e.node),isTrashFolder:this._isTrashFolder(e.node),isFolder:this._isFolder(e.node),hasChildren:this._hasChildren(e.node),handleExpandClick:this._handleExpandClick,setMediaState:this._setMediaState,closeWithId:this._closeWithId,deleteWithId:this._deleteWithId});menu={name:"windowlist",getCapability:this._getMenuCapability,getVisibility:this._getMenuVisibility,getState:this._getMenuState};render(){return 0!==this.state.nodes.length&&this.state.hasContent?(0,zn.jsx)(Mi,{ref:this.refTreeList,settings:"WINDOWS_PANEL",collapsedOnMount:f5,rowComponent:o5,getRowComponentProps:this.getRowComponentProps,rowHeight:this.getRowHeight,nodes:this.state.nodes,folderMode:"expand",hasChildren:this._hasChildren,isFolder:this._isFolder,supportsInlineEdit:!0,isValidToEdit:this._validateForEdit,getTitle:this._getTitle,saveTitle:this._setTitle,onItemClick:this._onNodeClick,onItemDoubleClick:this._onNodeDoubleClick,onItemMouseDown:this._onNodeMouseDown,onItemMouseUp:this._onNodeMouseUp,onItemsActivated:this.handleNodesActivated,delete:this._closeByIds,onExport:this._saveSessionByIds,onSave:this._saveBookmarkByIds,onDrop:this._onDrop,onMove:this._onMove,onCopy:this._onCopy,validateForDeletion:this._isValidToDelete,menu:this.menu,mimeType:m5,validateForDrag:this._validateForDrag,getDropSupport:this._getDropSupport,getTargetSpec:this._getTargetSpec,getDragData:this._getDragData,setCustomEventBehavior:this._setCustomEventBehavior,supportsDeepCopy:!1,sorting:this.props.sorting}):this.props.filter?(0,zn.jsx)("p",{children:(0,W.Z)("Nothing found")}):null}}const w5=(0,zd.Z)(C5,c5);var y5=s(34155);const x5=[{text:"",value:"title",fullScreenTitle:(0,W.Z)("Sort by Title")},{text:"",value:"pageItem.hostname",fullScreenTitle:(0,W.Z)("Sort by Host")},{text:"",value:"pageItem.domain",fullScreenTitle:(0,W.Z)("Sort by Domain")},{text:"",value:"sound",fullScreenTitle:(0,W.Z)("Sort by Audio Status")}],I5=[Z.kKeyboardTabToAll,Z.kPanelsWindowSorting,Z.kWorkspacesEnabled];class A5 extends Un.PureComponent{refTree=Un.createRef();static contextType=oi.Z;nodeRef=Un.createRef();constructor(e){super(e);const t=this.props.prefValues[Z.kPanelsWindowSorting];this.state={filter:"",sorting:{sortOrder:t.sortOrder,sortField:t.sortField,comparator:this.sortComparator}}}componentDidMount(){tn.ZP.addListener(this.onPanelStoreChange)}componentWillUnmount(){tn.ZP.removeListener(this.onPanelStoreChange)}componentDidUpdate(e,t){!e.open&&this.props.open&&y5.nextTick((()=>this.focusTree()))}onPanelStoreChange=()=>{const e=tn.ZP.getWindowData(this.context.vivaldiWindowId),t=tn.ZP.getChangeReason();this.props.open&&e?.focusContent&&"setFocus"===t&&!(0,vo.sT)(this.context.document,this.nodeRef.current)&&this.focusTree()};onSortChange=(e,t)=>{this.setState((s=>({sorting:{sortOrder:e,sortField:t,comparator:s.sorting.comparator}}))),I.Z.set(Z.kPanelsWindowSorting,{sortOrder:e,sortField:t})};sortComparator=(e,t)=>{switch(e.type){case"window":case"workspacesFolder":case"duplicatesFolder":case"inactiveFolder":case"trashFolder":case"syncFolder":return e.index-t.index}if("button"===e.type)return 1;if("pinned"===e.type)return-1;if("pinned"===t.type)return 1;if("stack"===e.type&&"stack"!==t.type)return-1;if("stack"===t.type&&"stack"!==e.type)return 1;const{sortOrder:s,sortField:n}=this.state.sorting;if("sound"===n)return this.sortForSound(e,t,s);return ui.Z.getDefaultComparator(s,n)(e,t)};sortForSound=(e,t,s)=>{if(s<=ui.Z.NO_SORTING)return 0;let n="";if(e.pageItem){const{page:t}=e.pageItem;t.discarded||(mq.Z.hasMediaState(t.id,"playing")||mq.Z.hasMediaState(t.id,"muting"))&&(n="playing")}let i="";if(t.pageItem){const{page:e}=t.pageItem;e.discarded||(mq.Z.hasMediaState(e.id,"playing")||mq.Z.hasMediaState(e.id,"muting"))&&(i="playing")}if("playing"===n)return-1;if("playing"===i)return 1;return ui.Z.getDefaultComparator(s,"title")(e,t)};focusTree=()=>{this.refTree.current?.focusTree()};handleFilterChange=e=>{const t=e.target.value;this.setState({filter:t})};onContextMenu=e=>{this.refTree.current?.onContextMenu(e)};getNewItemMenu=()=>{const e=this.context.vivaldiWindowId;return[{handler:()=>this.refTree.current?.newTab(e),...(0,fi.Z)("command","New Tab")},{handler:()=>{fe.ZP.isGuest()?Wn.Z.openIncognitoWindow(e):Wn.Z.openBrowserWindow(e)},...(0,fi.Z)("command","New Window")},{handler:()=>ue.Z.showWorkspaceDialog(e),isVisible:()=>this.props.prefValues[Z.kWorkspacesEnabled],...(0,fi.Z)("command","New Workspace")}]};render(){if(!this.props.open)return null;return(0,zn.jsxs)("div",{ref:this.nodeRef,className:"panel",id:"window-panel",children:[(0,zn.jsxs)("header",{children:[(0,zn.jsx)(Cu,{title:this.props.title,showCloseButton:this.props.showCloseButton}),(0,zn.jsxs)("div",{className:"toolbar toolbar-default toolbar-wrap",role:"toolbar","aria-label":(0,W.Z)("toolbar label","Windows Panel"),children:[(0,zn.jsx)("input",{type:"search",className:"tabsearch",placeholder:(0,W.Z)("verb","Search"),value:this.state.filter,onChange:this.handleFilterChange}),(0,zn.jsx)(oa.ZP,{tooltip:(0,W.Z)("command","New"),tabIndex:this.props.prefValues[Z.kKeyboardTabToAll],image:Kn.md4.small,menu:this.getNewItemMenu,menuOrigin:"bottomLeft"})]})]}),(0,zn.jsx)(Bu,{fields:x5,onSortChange:this.onSortChange,keyAccess:this.props.keyAccess,sortField:this.state.sorting.sortField,sortOrder:this.state.sorting.sortOrder}),(0,zn.jsx)("section",{className:"outerScrollbar",onContextMenu:this.onContextMenu,children:(0,zn.jsx)(w5,{ref:this.refTree,sorting:this.state.sorting,filter:this.state.filter})})]})}}const S5=(0,zd.Z)(A5,I5),Z5={PanelBookmarks:{title:(0,W.Z)("Bookmarks"),panel:p3},PanelMail:{title:(0,W.Z)("Mail"),panel:bx},PanelFeeds:{title:(0,W.Z)("Feeds"),panel:bx},PanelContacts:{title:(0,W.Z)("Contacts"),panel:a2},PanelDownloads:{title:(0,W.Z)("Downloads"),panel:Yu},PanelNotes:{title:(0,W.Z)("Notes"),panel:x2},PanelHistory:{title:(0,W.Z)("History"),panel:d2},PanelWindow:{title:(0,W.Z)("title","Windows and Tabs"),panel:S5},PanelCalendar:{title:(0,W.Z)("Calendar"),panel:E3},PanelTasks:{title:(0,W.Z)("Tasks"),panel:L4},PanelChat:{title:(0,W.Z)("Chat"),panel:$k},PanelTranslate:{title:(0,W.Z)("title","Translate"),panel:K4},PanelReadingList:{title:(0,W.Z)("Reading List"),panel:k2},PanelSession:{title:(0,W.Z)("Sessions"),panel:E4}};function T5(e){return{selectedPanel:tn.ZP.getSelected(e),panelWidth:tn.ZP.getWidth(e),barVisible:tn.ZP.getIsBarVisible(e),contentVisible:tn.ZP.getIsContentVisible(e),focusContent:tn.ZP.getFocusContent(e),isMailWindow:fe.ZP.isMail(e),regPanels:tn.ZP.getRegPanels(e),webPanels:tn.ZP.getWebPanels(e),changeReason:tn.ZP.getChangeReason()}}function E5(e,t){const s=e.faviconUrl?e.faviconUrl:e.url;return{id:e.id,title:e.title,faviconUrl:s,faviconUrlValid:!1!==e.faviconUrlValid,hasBeenActive:t,activeUrl:e.activeUrl}}function k5(e){const t=(e.panelToggleVisible?tn.fG:0)+(e.barVisible?tn.Pv+2*(0,Si.mM)():0);return e.panelWidth<=t}const N5=[Z.kAppearanceDensity,Z.kKeyboardTabToAll,Z.kPanelsAsOverlayAutoClose,Z.kPanelsAsOverlayEnabled,Z.kPanelsLazyLoad,Z.kPanelsShowCloseButton,Z.kThemeUseAnimation,Z.kTabsBarPosition,Z.kPanelsWebToolbar,Z.kToolbarsPanel,Z.kMailDisplayMailPanelViewingMail,Z.kMailOpenPanelAutomaticallyViewingMail];class _5 extends Un.PureComponent{static contextType=oi.Z;refPanelsContainer=Un.createRef();refFocusContainer=Un.createRef();nodeRef=Un.createRef();isDraggingOverButton=!1;blockNextBlur=!1;delayTimeout=null;dndTimerId=null;resizingTimeout=null;dropMode={support:!1,copy:!1};constructor(e,t){super(e);const s=t.vivaldiWindowId;this.winId=s,this.trackContextOnFocus=Zq("panel",t);const n=T5(s),i=k5(n),a=[];n.webPanels.forEach((e=>{const t=e.id===n.selectedPanel&&!i;a.push(E5(e,t))})),this.state={isResizing:!1,minimized:tn.ZP.getIsBarVisible(s)&&!tn.ZP.getIsContentVisible(s)?"buttons":"auto",panelToggleVisible:fe.ZP.getVisibleUI(s).panelToggle,webPanelData:a,hasPanelBeenVisible:null,...n}}componentDidMount(){const{selectWindow:e}=this.context;this.context.addEventListener("resize",this.onWindowResize,!1),tn.ZP.addListener(this._onPanelStoreChange),fe.ZP.addListener(this._onWindowStoreChanged,e),go.Z.addListener("COMMAND_FOCUS_PANELBAR",this.onCommandSpy),this._onPanelStoreChange()}componentDidUpdate(e){e.prefValues[Z.kAppearanceDensity]!==this.props.prefValues[Z.kAppearanceDensity]&&this._onPanelStoreChange();this.state.selectedPanel&&tn.ZP.getIsWebPanel(this.state.selectedPanel)&&tn.ZP.getIsContentVisible(this.winId)&&this.state.selectedPanel&&Wn.Z.setPanelHasBeenVisible(this.winId,this.state.selectedPanel,!0)}componentWillUnmount(){this.context.addEventListener("resize",this.onWindowResize,!1),tn.ZP.removeListener(this._onPanelStoreChange),fe.ZP.removeListener(this._onWindowStoreChanged),go.Z.removeListener("COMMAND_FOCUS_PANELBAR",this.onCommandSpy),this.clearDndTimer(),clearTimeout(this.resizingTimeout)}getNode(){return this.refFocusContainer.current}onWindowResize=()=>{this.state.panelWidth<=nc.Ej||(this.setState({isResizing:!0}),clearTimeout(this.resizingTimeout),this.resizingTimeout=setTimeout((()=>{this.setState({isResizing:!1}),this.state.selectedPanel&&en.Z.setWidth(this.winId,this.state.selectedPanel,this.limitPanelWidth(this.state.panelWidth))}),1e3))};_onPanelStoreChange=()=>{const e=T5(this.winId),{selectedPanel:t,contentVisible:s=!1,regPanels:n,webPanels:i,focusContent:a=!1,barVisible:o=!1,panelWidth:r,isMailWindow:l,changeReason:d}=e,c=i.length===this.state.webPanelData.length&&t===this.state.selectedPanel&&k5(this.state)===k5(e)?void 0:e.selectedPanel,h=this.setupWebPanelData(i,c);this.setState((e=>{let{minimized:c,isResizing:u}=e;const p=tn.Pv+2*(0,Si.mM)();!s&&r<=tn.fG?c="auto":!s&&r<=p+tn.fG&&(c="buttons");return{panelWidth:u?e.panelWidth:r,webPanelData:h,minimized:c,selectedPanel:t,regPanels:n,webPanels:i,contentVisible:s,focusContent:a,barVisible:o,isMailWindow:l,isResizing:u,changeReason:d}}))};_onWindowStoreChanged=()=>{const e=fe.ZP.getVisibleUI(this.winId).panelToggle,t=fe.ZP.isMail(this.winId);(this.state.panelToggleVisible!==e||this.state.isMailWindow!==t||fe.ZP.getWindowState(this.winId)?.hasPanelBeenVisible)&&this.setState({panelToggleVisible:e,isMailWindow:t,panelWidth:tn.ZP.getWidth(this.winId),hasPanelBeenVisible:fe.ZP.getWindowState(this.winId)?.hasPanelBeenVisible})};onCommandSpy=e=>{e===this.winId&&((0,vo.sT)(this.context.document,this.refPanelsContainer.current?.focusRef.current??null)||this.moveFocus("current",!0))};handleDoubleClick=()=>{this.props.prefValues[Z.kPanelsAsOverlayEnabled]&&this.props.prefValues[Z.kPanelsAsOverlayAutoClose]||this.handlePanelSwitch()};handleClickOutside=()=>{if(!this.state.contentVisible)return;this.autoClosePanel(0);const e=this.refPanelsContainer.current,{document:t,Element:s}=this.context;e&&e.focusRef.current instanceof s&&e.focusRef.current.contains(t.activeElement)&&en.Z.removeFocus(this.winId)};onSlidebarPosition=(e,t)=>{let s;switch(this.props.position){case"left":s=Math.round(e);break;case"right":s=Math.round(this.context.innerWidth-e);break;default:throw new Error("Unknown tabbar position")}s=this.limitPanelWidth(s),this.setState({panelWidth:s}),this.state.selectedPanel&&en.Z.setWidth(this.winId,this.state.selectedPanel,s)};limitPanelWidth=e=>(0,kf.Z)(e,nc.Ej,.618*this.context.innerWidth);handlePanelSwitch=()=>en.Z.togglePanel(this.winId);shouldShowCloseButton=e=>this.props.prefValues[Z.kPanelsShowCloseButton]&&!((tn.ZP.getSeparateFloating(e,this.winId)||this.props.prefValues[Z.kPanelsAsOverlayEnabled])&&this.props.prefValues[Z.kPanelsAsOverlayAutoClose]);autoClosePanel=(e=600)=>{if(!this.props.canAutoClose())return;if(!this.state.selectedPanel||!this.props.prefValues[Z.kPanelsAsOverlayAutoClose])return;const t=tn.ZP.getSeparateFloating(this.state.selectedPanel,this.winId),s=this.props.prefValues[Z.kPanelsAsOverlayEnabled];(!1!==t&&s||!0===t&&!s)&&(this.cancelTimeout(),this.delayTimeout=setTimeout((()=>{"PanelMail"===this.state.selectedPanel&&!1===tn.ZP.getSeparateFloating("PanelMail",this.winId)&&this.props.prefValues[Z.kMailDisplayMailPanelViewingMail]&&(this.props.prefValues[Z.kMailOpenPanelAutomaticallyViewingMail]||this.state.contentVisible)||this.state.contentVisible&&en.Z.closePanel(this.winId)}),e))};cancelTimeout=()=>clearTimeout(this.delayTimeout);onDialogOpen=()=>{this.props.prefValues[Z.kPanelsAsOverlayEnabled]&&this.props.prefValues[Z.kPanelsAsOverlayAutoClose]&&this.state.contentVisible&&(this.blockNextBlur=!0)};handleBlur=e=>{const{Element:t}=this.context;this.blockNextBlur||e.target instanceof t&&e.target.classList.contains("home")?(this.blockNextBlur=!1,this.cancelTimeout()):this.autoClosePanel()};getWebPanelDataById=e=>this.state.webPanelData.find((t=>t.id===e));setupWebPanelData=(e,t)=>e.map((e=>{const{faviconUrl:s,url:n,faviconUrlValid:i}=e,a=e.id,o=a===t,r=this.getWebPanelDataById(a);return r?{...r,faviconUrl:s||n,faviconUrlValid:!1!==i,hasBeenActive:!(r.hasBeenActive||!o)||r.hasBeenActive}:E5(e,o)}));isPanelOpen=e=>this.state.contentVisible&&this.state.selectedPanel===e;clearDndTimer=()=>{this.dndTimerId&&clearTimeout(this.dndTimerId),this.dndTimerId=null};onDragEnterBar=e=>{if(e.preventDefault(),e.stopPropagation(),fe.ZP.isGuest())this.dropMode={support:!1,copy:!1};else{const t=e.dataTransfer.types.some((e=>Jn.ZP.isUriListType(e)||"text/plain"===e)),s=t&&!e.dataTransfer.types.some((e=>e===u.Up));this.dropMode={copy:s,support:t}}};onDragOverBar=e=>{e.preventDefault(),this.dropMode.support?(this.clearDndTimer(),this.dropMode.copy,e.dataTransfer.dropEffect=this.dropMode.copy?"copy":"move"):e.dataTransfer.dropEffect="none"};onDropBar=e=>{this.dropMode.support&&Jn.ZP.getUrlsFromEventPromise(e,!0).then((e=>{e.forEach((e=>{Ko.Z.addByUrl(this.winId,e.url,!0)}))}))};onDragLeave=e=>{e.preventDefault(),e.stopPropagation(),this.clearDndTimer(),this.dndTimerId=setTimeout((()=>{this.isDraggingOverButton=!1,this.dndTimerId=null}),u._p)};handleSliderDown=()=>this.setState({isResizing:!0});handleSliderUp=()=>this.setState({isResizing:!1});handlePanelButtonKeyDown=e=>{switch(e.key){case"ArrowUp":this.moveFocus("left",!1);break;case"ArrowDown":this.moveFocus("right",!1);break;case"Escape":this.leaveBar();break;default:return}e.preventDefault(),e.stopPropagation()};moveFocus=(e,t)=>{const{document:s}=this.context,n=this.refPanelsContainer.current?.focusRef.current??null,i=s.querySelector(".toolbar-panel .uifocusstop");if(!0===t||(0,vo.sT)(s,n))if("current"===e)i?.focus();else if("left"===e||"right"===e){const t=Array.from(s.querySelectorAll(".toolbar-panel > *:not(.toolbar-spacer-flexible, .toolbar-spacer, .toolbar-divider)"));if(1===t.length)return;let n=t.indexOf(s.activeElement?.parentElement||i?.parentElement);n="right"===e?n+1>=t.length?0:n+1:n<=0?t.length-1:n-1,t[n].querySelector("input[type=text], input[type=search], button")?.focus()}};leaveBar=()=>{ue.Z.setPaneFocus(this.winId,!1),ae.Z.executeActions("event",this.context,"COMMAND_FOCUS_WEBVIEW")};getBarContextMenu=e=>{const t=this.winId,s=ei.Z.getOptionFunction(e);return ei.Z.getNamedMenu(t,e,(async e=>{if("CONTAINER_CLOSED_WEBPANEL"===e.action){const n={...s(t,e,{})};return 0===n.items?.length&&(n.isVisible=()=>!1),n}return{...s(t,e,{})}}))};renderAllPanels=()=>{const e=this.state.selectedPanel&&tn.ZP.getIsWebPanel(this.state.selectedPanel);return(0,zn.jsxs)(zn.Fragment,{children:[this.state.regPanels.map((e=>{const t=e.id,s=Z5[t];if(s)return(0,zn.jsx)(Kd,{level:"tabs",children:(0,zn.jsx)(s.panel,{keyAccess:this.props.prefValues[Z.kKeyboardTabToAll],title:s.title,panelId:t,open:this.isPanelOpen(t),onOpenDialog:this.onDialogOpen,showCloseButton:this.shouldShowCloseButton(t),focusContent:"layout"!==this.state.changeReason})},"panel-"+t)})).filter(Boolean),(0,zn.jsx)("div",{className:e?"webpanel-stack":"webpanel-stack hidden",children:this.state.webPanels.map((e=>!this.props.prefValues[Z.kPanelsLazyLoad]||this.state.hasPanelBeenVisible&&this.state.hasPanelBeenVisible.has(e.id)?this.renderWebPanel(e):null))})]})};renderWebPanel=e=>{const t=this.state.contentVisible&&this.state.selectedPanel===e.id;return(0,zn.jsx)(QK,{isVisible:t,focusContent:this.state.focusContent&&t,panelUI:this.props.prefValues[Z.kPanelsWebToolbar],webPanel:e,showCloseButton:this.shouldShowCloseButton(e.id)},e.id)};renderSlidebar=e=>(0,zn.jsx)(Mu.Z,{style:e?{left:e}:void 0,onSlidebarPosition:this.onSlidebarPosition,onStart:this.handleSliderDown,onStop:this.handleSliderUp,onDoubleClick:this.handleDoubleClick,offset:1,position:this.props.position});toolbarMenu=()=>this.getBarContextMenu("panelbar");render(){const{barVisible:e,contentVisible:t,panelWidth:s,isResizing:n}=this.state,{position:i,prefValues:a}=this.props,o=this.state.panelToggleVisible?tn.fG:0,r=2*(0,Si.mM)(),l=o+(e?tn.Pv+r:0),d=k5(this.state),c=a[Z.kPanelsAsOverlayEnabled],h=this.state.selectedPanel?tn.ZP.getSeparateFloating(this.state.selectedPanel,this.winId):void 0;let u;u=void 0===h?c:h;const p=Gn()({[i]:!0,button:this.state.panelToggleVisible,switcher:s<=tn.fG,icons:e&&!t,overlay:u,minimized:u&&"buttons"===this.state.minimized,resizing:n||"layout"===this.state.changeReason}),g="right"===i&&e||"left"===i&&!e?"0 0 0 8 4 4":"4 0 4 8 0 4",m=a[Z.kThemeUseAnimation]&&!n&&"layout"!==this.state.changeReason?t?128:64:0,f=s-l+(u?0:1),v=u&&a[Z.kPanelsAsOverlayAutoClose]&&t,b="left"===i?2:3,C="left"===i?s-b:-(s-l+b);return(0,zn.jsxs)(Zo.Z,{focusName:"focus_panel",id:"panels-container",ref:this.refPanelsContainer,className:p,style:{width:u?s-f:s,"--duration":m+"ms",transition:`width ${u?"0ms":"var(--duration)"} ease-out`},children:[(0,zn.jsxs)("div",{id:"panels",ref:this.refFocusContainer,onBlur:v?this.handleBlur:null,onFocus:e=>{this.trackContextOnFocus(e),v&&this.cancelTimeout()},inert:this.props.inert?"inert":null,children:[this.state.panelToggleVisible&&(0,zn.jsx)("div",{id:"panel_switch",title:e?(0,W.Z)("Hide Panel"):(0,W.Z)("verb","Show Panel"),onClick:this.handlePanelSwitch,children:(0,zn.jsx)("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"4px",height:"8px",viewBox:"0 0 4 8",children:(0,zn.jsx)("polygon",{points:g})})}),(0,zn.jsx)("div",{id:"switch",className:"slim-scrollbar",onDragEnter:this.onDragEnterBar,onDragLeave:this.onDragLeave,onDragOver:this.onDragOverBar,onDrop:this.onDropBar,onKeyDown:this.handlePanelButtonKeyDown,children:(0,zn.jsx)(zJ,{name:Z.kToolbarsPanel,label:(0,W.Z)("toolbar label","Panels"),className:"toolbar-panel",menuOrigin:"left"===i?"topRight":"topLeft",popupPosition:"left"===i?"right":"left",menu:this.toolbarMenu,layout:"vertical",size:"medium"})}),this.state.selectedPanel&&(0,zn.jsx)("div",{className:"panel-group",inert:this.props.editToolbar?"true":null,style:u?{width:d?0:s-l,[i]:l}:null,children:(0,zn.jsx)("div",{className:"panel-collapse-guard",role:"tabpanel","aria-labelledby":"ui-region-panel-title","aria-hidden":d,id:"ui-region-panel",style:{minWidth:n?"unset":f-1,maxWidth:n?"unset":f-1},children:this.renderAllPanels()})}),!d&&u&&this.renderSlidebar(C)]}),!d&&!u&&this.renderSlidebar()]})}}const P5=(0,zd.Z)((0,Dg.Z)(_5),N5);const M5=function(e){const{domain:t,ads_blocked:s,trackers_blocked:n}=e.blockedData,{columns:i}=e;if(i.length<1||!e.blockedData)return null;var a=(0,zn.jsx)("span",{children:t});return i.map((e=>{switch(e.id){case"domain":return(0,zn.jsx)("label",{children:a},e.id);case"trackers_blocked":return(0,zn.jsx)("label",{className:"count",children:(0,zn.jsx)("span",{children:(0,F.uf)(n)})},e.id);case"ads_blocked":return(0,zn.jsx)("label",{className:"count",children:(0,zn.jsx)("span",{children:(0,F.uf)(s)})},e.id);default:return null}}))},D5="privacy_stats_origin",O5=[{text:(0,W.Z)("Address"),value:"domain",fullScreenTitle:(0,W.Z)("Sort by Address"),width:300,visible:!0,key:!0},{text:(0,W.Z)("Trackers"),value:"trackers_blocked",fullScreenTitle:(0,W.Z)("Sort by Trackers"),width:90,visible:!0},{text:(0,W.Z)("Ads"),value:"ads_blocked",fullScreenTitle:(0,W.Z)("Sort by Ads"),width:90,visible:!0}];class j5 extends Un.PureComponent{constructor(e){super(e);const t=xi().privacy_stats_origin;this.state={sorting:{sortOrder:1,sortField:"manually"},columns:t||Ii(O5)}}getFormattedData=()=>{const{blockedData:e}=this.props;return e};onSortChange=(e,t)=>{this.setState({sorting:{sortOrder:e,sortField:t}})};onUpdateRow=e=>this.setState({columns:e});onSaveRow=()=>yi(this.state.columns,D5);getRowComponentProps=e=>({columns:this.state.columns,blockedData:e.node});render(){const{columns:e,sorting:t}=this.state,{blockedData:s}=this.props;return(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)(Bu,{fields:O5,fullsize:!0,columns:e,keyAccess:0,manualSorting:!1,sortField:t.sortField,sortOrder:t.sortOrder,onSortChange:this.onSortChange,onSaveRow:this.onSaveRow,onUpdateRow:this.onUpdateRow}),Array.isArray(s)&&s.length&&(0,zn.jsx)(Mi,{rowComponent:M5,getRowComponentProps:this.getRowComponentProps,nodes:s,enableDragAndDrop:!1,isFolder:iy.Z,disableClipboard:!0,hasChildren:iy.Z,sorting:t,columns:e,multiSelect:!1,onItemDoubleClick:nr.Z})]})}}const L5=j5,R5=["tracking","ad_blocking"];var B5=(0,zn.jsx)(aa,{type:"blocker-shield",size:40,className:"Blocker-Shield-Trackers Modal-Shield"}),F5=(0,zn.jsx)(aa,{type:"blocker-shield",size:40,className:"Blocker-Shield-Ads Modal-Shield"});class W5 extends Un.PureComponent{static contextType=oi.Z;isMounted=!1;websiteId=crypto.randomUUID();trackerId=crypto.randomUUID();constructor(e){super(e),this.state={totalAdBlocked:0,totalTrackerBlocked:0,blockedData:{blocked_domains:[],blocked_for_origin:[]},currentTabId:this.websiteId,startBlockingDate:0,trackerBlockingEnabled:!1,adBlockingEnabled:!1}}componentDidMount(){re.Z.contentBlocking.getAdBlockingStats(this.setAdblockingStats),this.getRules(),this.isMounted=!0}handleCloseModal=()=>{this.props.onClose()};setAdblockingStats=(e,t,s,n,i)=>{const a={blocked_domains:[],blocked_for_origin:[]};a.blocked_domains=n,a.blocked_for_origin=i,this.setState({totalAdBlocked:t,totalTrackerBlocked:s,blockedData:a,startBlockingDate:e})};clearBlockedData=()=>{re.Z.contentBlocking.clearAdBlockingStats(),this.setState({totalAdBlocked:0,totalTrackerBlocked:0,blockedData:{blocked_domains:[],blocked_for_origin:[]},startBlockingDate:0})};setDefaultBlocking=e=>{const{value:t}=e.target;switch(t){case"0":re.Z.contentBlocking.setActiveExceptionsList("tracking","process_list"),re.Z.contentBlocking.setActiveExceptionsList("ad_blocking","process_list");break;case"1":re.Z.contentBlocking.setActiveExceptionsList("tracking","exempt_list"),re.Z.contentBlocking.setActiveExceptionsList("ad_blocking","process_list");break;case"2":re.Z.contentBlocking.setActiveExceptionsList("tracking","exempt_list"),re.Z.contentBlocking.setActiveExceptionsList("ad_blocking","exempt_list")}this.getRules()};getRules=()=>R5.forEach((e=>(0,Ev.pg)(e,(e=>this.setState(e)))));render(){if(!this.isMounted)return null;const{startBlockingDate:e,totalTrackerBlocked:t,totalAdBlocked:s,currentTabId:n,blockedData:i,trackerBlockingEnabled:a,adBlockingEnabled:o}=this.state,r=0+(a?1:0)+(o?1:0);return(0,zn.jsxs)(Ha.Z,{className:"slide Privacy-Stats-Modal",onRequestClose:this.handleCloseModal,labelledBy:"dialog-privacy-stats-title",children:[(0,zn.jsxs)("header",{className:"dialog-header",children:[(0,zn.jsx)("h1",{id:"dialog-privacy-stats-title",children:(0,W.Z)("Privacy Statistics")}),(0,zn.jsx)("p",{children:e?(0,W.Z)("Trackers and ads blocked since: $1",[V()(e).format("LLL")]):(0,W.Z)("Nothing has been blocked yet. Please select an appropriate blocking level below.")})]}),(0,zn.jsxs)("div",{className:"dialog-content",children:[(0,zn.jsxs)("div",{className:"Blocked-Stats-Container",children:[(0,zn.jsxs)("div",{className:"Blocked-Stats",children:[B5,(0,zn.jsxs)("div",{children:[(0,zn.jsx)("p",{className:"Number-Blocked",children:(0,F.uf)(t)}),(0,zn.jsx)("p",{children:(0,W.Z)("Tracker prevented from profiling you","Trackers prevented from profiling you",[t])})]})]}),(0,zn.jsxs)("div",{className:"Blocked-Stats",children:[F5,(0,zn.jsxs)("div",{children:[(0,zn.jsx)("p",{className:"Number-Blocked",children:(0,F.uf)(s)}),(0,zn.jsx)("p",{children:(0,W.Z)("Ad blocked","Ads blocked",[s])})]})]})]}),(t>0||s>0)&&(0,zn.jsxs)(aM,{className:"Privacy-Stats-Board",activeTabId:n,onTabClick:e=>this.setState({currentTabId:e}),children:[(0,zn.jsx)("div",{label:(0,W.Z)("Websites"),id:this.websiteId,children:(0,zn.jsx)(L5,{blockedData:i.blocked_for_origin})}),(0,zn.jsx)("div",{label:(0,W.Z)("Trackers"),id:this.trackerId,children:(0,zn.jsx)(L5,{blockedData:i.blocked_domains})})]}),(0,zn.jsxs)("div",{className:"Blocking-Level",children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Blocking Level:")}),(0,zn.jsxs)(Fa.Z,{className:"Blocking-Level-Select",value:r,onChange:this.setDefaultBlocking,title:(0,W.Z)("Select default level of protection."),children:[(0,zn.jsx)("option",{value:0,children:(0,W.Z)("No Blocking")}),(0,zn.jsx)("option",{value:1,children:(0,W.Z)("Block Trackers")}),(0,zn.jsx)("option",{value:2,children:(0,W.Z)("Block Trackers and Ads")})]})]})]}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("button",{className:"privacy-btn-icon",title:(0,W.Z)("Privacy Settings"),dangerouslySetInnerHTML:{__html:Kn.sgm.medium+(0,W.Z)("Privacy Settings")},onClick:()=>{ue.Z.showSettings(this.context.vivaldiWindowId,"privacy"),this.handleCloseModal()}}),(0,zn.jsx)("input",{type:"button",className:"danger",value:(0,W.Z)("Reset Statistics"),onClick:this.clearBlockedData}),(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Close"),onClick:()=>this.handleCloseModal()})]})]})}}const U5=W5,V5=[Z.kRazerChromaHasShownPromotion],H5={width:400,minWidth:"unset"};class G5 extends Un.Component{static contextType=oi.Z;constructor(e){super(e)}onClose=()=>{I.Z.set(Z.kRazerChromaHasShownPromotion,!0),this.props.onClose()};openSettings=()=>{ue.Z.showSettings(this.context.vivaldiWindowId,"themes"),this.onClose()};render(){return(0,zn.jsxs)(Ha.Z,{onRequestClose:nr.Z,style:H5,className:"slide",title:(0,W.Z)("Razer Chroma device detected"),children:[(0,zn.jsx)("div",{className:"dialog-content",children:(0,zn.jsx)("p",{children:(0,W.Z)("Vivaldi supports connected Razer Chroma devices. You can enable them with Vivaldi from the Themes section in settings.")})}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"submit",value:(0,W.Z)("Go to Theme Settings"),onClick:this.openSettings,autoFocus:!0}),(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Close"),onClick:this.onClose})]})]})}}const K5=(0,zd.Z)(G5,V5),z5=I.Z.getEventHandler,$5=[Z.kSessionsSaveAllWorkspaces];class Y5 extends Un.Component{static contextType=oi.Z;state={shown:!0,name:void 0===this.props.options.updateId?"":Q1.ZP.getTitle(this.props.options.updateId),errorSaving:!1,saveOnlyCurrentWindow:!1};_getSaveByIds=()=>"ids"===this.props.options.mode&&Boolean(this.props.options.ids?.length);_close=()=>{this.state.shown&&this.setState((e=>({shown:!1})),(()=>{this.props.options.onClose&&this.props.options.onClose(0),this.props.onClose()}))};_onSaveSession=async()=>{const e=this.state.saveOnlyCurrentWindow?this.context.vivaldiWindowId:0;let t=[];switch((()=>this._getSaveByIds()?"ids":this.props.prefValues[Z.kSessionsSaveAllWorkspaces]?"all":"visible")()){case"ids":t=this.props.options.ids??[];break;case"visible":(()=>{const e=new Map;return fe.ZP.getIds("normal").forEach((t=>{e.set(t,Ze.ZP.getActiveWorkspace(t))})),e})().forEach(((s,n)=>{0!==e&&e!==n||(s?t.push(...Ze.ZP.getWorkspacePages(s).map((e=>e.id)).toArray()):t.push(...Ze.ZP.getPages(n,{workspaceId:void 0}).map((e=>e.id)).toArray()))}))}const s=void 0===this.props.options.updateId?await gn.Z.add(this.state.name,this.props.options.parentId??-1,this.props.options.index??-1,this.props.options.owner??"",e,t):await gn.Z.update(this.props.options.updateId,e,t);0===s?(this.props.options.onClose&&this.props.options.onClose(s),this.props.onClose()):this.setState({errorSaving:!0})};_nameChange=e=>{this.setState({name:e.target.value})};_toggleSaveOnlyCurrentWindow=()=>{this.setState((e=>({saveOnlyCurrentWindow:!e.saveOnlyCurrentWindow})))};render(){const e=this.state.errorSaving?(0,W.Z)("Error saving the session."):"",t=void 0!==this.props.options.updateId,s=t?(0,W.Z)("Update Session"):this._getSaveByIds()?(0,W.Z)("session","Save Selected Tabs as Session"):(0,W.Z)("session","Save Open Tabs as Session");return(0,zn.jsx)(Ha.Z,{onRequestClose:this._close,title:s,children:(0,zn.jsx)("div",{className:"save-session",children:(0,zn.jsxs)("form",{children:[(0,zn.jsxs)("div",{className:"dialog-content session-dialog",children:[t&&(0,zn.jsx)("span",{className:"selectable",children:this.state.name}),!t&&(0,zn.jsx)("input",{type:"text",placeholder:(0,W.Z)("Session Name"),value:this.state.name,onChange:this._nameChange,spellCheck:"false",autoFocus:!0}),!this._getSaveByIds()&&(0,zn.jsxs)("label",{className:"dialog-checkbox",children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.props.prefValues[Z.kSessionsSaveAllWorkspaces],onChange:z5(Z.kSessionsSaveAllWorkspaces)}),(0,zn.jsx)("span",{children:(0,W.Z)("Include All Workspaces")})]}),!this._getSaveByIds()&&(0,zn.jsxs)("label",{className:"dialog-checkbox",children:[(0,zn.jsx)("input",{type:"checkbox",checked:this.state.saveOnlyCurrentWindow,disabled:this.props.prefValues[Z.kSessionsSaveAllWorkspaces],onChange:this._toggleSaveOnlyCurrentWindow}),(0,zn.jsx)("span",{children:(0,W.Z)("Save Only Tabs In Current Window")})]}),""!==e&&(0,zn.jsx)("div",{className:"error-validation",children:e})]}),(0,zn.jsxs)("footer",{className:"dialog-footer",children:[(0,zn.jsx)("input",{type:"submit",className:"primary",onClick:this._onSaveSession,value:(0,W.Z)("Save"),autoFocus:t}),(0,zn.jsx)("input",{type:"button",onClick:this._close,value:(0,W.Z)("Cancel")})]})]})})})}}const X5=(0,zd.Z)(Y5,$5),Q5={width:380,minWidth:"unset"};var q5=(0,zn.jsx)("img",{src:"resources/support-donate.webp",alt:""}),J5=(0,zn.jsx)("p",{className:"info",children:"100% of your donations will be used to fund the long-term development of Vivaldi and our fight for a better web."});class e6 extends Un.Component{static contextType=oi.Z;state={switchPromptData:null,selectedPartnerSearchIdx:0,donateDismissed:!1};componentDidMount(){re.Z.searchEngines.getSwitchPromptData((e=>this.setState({switchPromptData:e})))}onClose=()=>{re.Z.searchEngines.acknowledgeSwitchPrompt(!0),this.props.onClose()};onSetId=e=>{this.setState({selectedPartnerSearchIdx:parseInt(e.currentTarget.value)})};replaceSearchEngine=()=>{const{switchPromptData:e,selectedPartnerSearchIdx:t}=this.state;e&&(re.Z.searchEngines.setDefault("defaultSearch",e.partnerSearchEngines[t].guid),re.Z.searchEngines.setDefault("defaultSearchField",e.partnerSearchEngines[t].guid),re.Z.searchEngines.setDefault("defaultSpeeddials",e.partnerSearchEngines[t].guid)),this.onClose()};getMultichoiceDialog=(e,t,s)=>{const{switchPromptData:n,selectedPartnerSearchIdx:i}=this.state;if(!n||0===n.partnerSearchEngines.length||n.partnerSearchEngines.length<i)return null;const a=n.partnerSearchEngines,o=n.partnerSearchEngines[i];return(0,zn.jsx)(Ha.Z,{onRequestClose:nr.Z,style:Q5,className:"float search-partner-dialog",labelledBy:"sesd_0",children:(0,zn.jsxs)("form",{onSubmit:this.replaceSearchEngine,children:[(0,zn.jsxs)("div",{className:"dialog-header",children:[(0,zn.jsx)("h1",{id:"sesd_0",children:e}),(0,zn.jsx)("p",{className:"faded-text",children:t})]}),(0,zn.jsx)(To.Z,{name:"searchEnginePicker",className:"dialog-content",onChange:this.onSetId,value:i,children:a.map(((e,t)=>{const s=function(e){const t=e.split(".")[0].toLowerCase();switch(t){case"startpage":case"ecosia":case"duckduckgo":case"qwant":return`resources/search_${t}.svg`}return null}(e.name),n=function(e){switch(e.split(".")[0].toLowerCase()){case"startpage":return(0,W.Z)("Private Google results, made in Europe.");case"ecosia":return(0,W.Z)("Plant trees as you search, for free.");case"duckduckgo":return(0,W.Z)("Private. Fast. Fewer ads.");case"qwant":return(0,W.Z)("Search engine which protects your privacy.")}return null}(e.name),a=i===t;return s&&n?(0,zn.jsxs)("div",{className:"list-item"+(a?" selected":""),children:[(0,zn.jsx)("input",{type:"radio",value:t,autoFocus:0===t,"aria-labelledby":`sesd__${t}`}),(0,zn.jsx)("img",{src:s,width:"46",height:"46",alt:""}),(0,zn.jsxs)("div",{children:[(0,zn.jsx)("label",{id:`sesd__${t}`,children:e.name}),(0,zn.jsx)("p",{className:"info",children:n})]})]},t):null}))}),(0,zn.jsxs)("footer",{className:"dialog-footer plain",children:[s&&(0,zn.jsx)("p",{className:"faded-text",children:s}),(0,zn.jsx)("input",{type:"submit",value:(0,W.Z)("Use $1",[o.name])}),(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("No Thanks"),onClick:this.onClose})]})]})})};handleDonateClick=()=>{c.ZP.openURL(this.context.vivaldiWindowId,u.aC),this.onClose()};canShowDonateDialog=()=>{const{donateDismissed:e}=this.state,{accountInfo:t,isReady:s}=me.getState();return!e&&s&&0===Number(t.donationTier)};getDonateDialog=()=>(0,zn.jsxs)(Ha.Z,{onRequestClose:nr.Z,style:Q5,className:"float search-partner-dialog",labelledBy:"sesd_1",children:[(0,zn.jsxs)("div",{className:"dialog-header",children:[q5,(0,zn.jsx)("h1",{id:"sesd_1",children:(0,W.Z)("Stand with us for a better web")}),(0,zn.jsx)("p",{className:"faded-text",children:(0,W.Z)("Vivaldi is powered by our users, not Big Tech or investors. Every donation directly supports our mission for an open, private internet. Be part of the change.")})]}),(0,zn.jsxs)("footer",{className:"dialog-footer plain",children:[(0,zn.jsx)("input",{type:"submit",value:(0,W.Z)("Donate now"),onClick:this.handleDonateClick,autoFocus:!0}),(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("No Thanks"),onClick:()=>{this.setState({donateDismissed:!0})}}),J5]})]});render(){const{switchPromptData:e}=this.state;if(!e)return null;if(0===e.partnerSearchEngines.length&&this.canShowDonateDialog())return this.getDonateDialog();const t=e.promptType;return"MULTICHOICE_PROMPT"===t?this.getMultichoiceDialog((0,W.Z)("Break free from Big Tech"),(0,W.Z)("Step away from surveillance and choose a search engine that aligns with your values."),(0,W.Z)("By selecting one of these search engines, you support the development of Vivaldi.")):"DONATE_AND_MULTICHOICE_PROMPT"===t?this.canShowDonateDialog()?this.getDonateDialog():this.getMultichoiceDialog((0,W.Z)("An easier way to support us"),(0,W.Z)("You can still support Vivaldi simply by choosing a privacy-focused, independent search engine.")):null}}const t6=e6;class s6 extends Un.Component{handleClick=()=>{this.props.onClose()};render(){return(0,zn.jsx)(Ha.Z,{onRequestClose:nr.Z,className:"default-browser",asToolbar:!0,label:(0,W.Z)("toolbar label","Default browser prompt"),children:(0,zn.jsx)(k_,{onClose:this.handleClick})})}}const n6=s6;class i6 extends m.Z{getInitialState(){return[]}getStartupDialogs(){return this.getState()}reduce(e,t){switch(t.actionType){case"STARTUP_DIALOGS_INIT":return t.state;case"STARTUP_DIALOG_CLOSE":const s=e.filter((e=>e!==t.dialog));return s.length===e.length?e:s}return e}}const a6=new i6(S.Z);var o6=s(65810);function r6({page:e,tabIndex:t,animated:s,color:n,mediaState:i}){const a=Un.useContext(oi.Z);return i.has("playing")||i.has("muting")?(0,zn.jsx)("button",{className:"tooltip-audio-button",tabIndex:t,onClick:function(t){t&&t.stopPropagation(),c.ZP.toggleMuting(a.vivaldiWindowId,qe.aV.of(e))},children:(0,zn.jsx)(Jq.Z,{color:n,animated:s,mediaState:i,src:"tab"})}):null}const l6=Un.memo(r6);class d6 extends Vo.Z{dispatchAction(e){switch(e.actionType){case"TAB_SWITCH_BACK_SETTING":this.emitChange({action:"switchTabBackBySetting",winId:e.winId,event:e.event});break;case"TAB_SWITCH_FORWARD_SETTING":this.emitChange({action:"switchTabForwardBySetting",winId:e.winId,event:e.event});break;case"TAB_VIEW_PAGE_SOURCE":this.emitChange({action:"viewPageSource",winId:e.winId});break;case"TAB_STACK_CREATE":this.emitChange({action:"stackCreate",winId:e.winId});break;case"TAB_STACK_DISSOLVE":this.emitChange({action:"stackDissolve",winId:e.winId});break;case"TAB_STACK_REMOVE":this.emitChange({action:"stackRemove",winId:e.winId});break;case"DISBAND_TILE_GROUP":this.emitChange({action:"disbandTileGroup",winId:e.winId});break;case"TAB_STACK_TILE_GRID":this.emitChange({action:"stackTileGrid",winId:e.winId});break;case"TAB_STACK_TILE_HORIZONTAL":this.emitChange({action:"stackTileHorizontal",winId:e.winId});break;case"TAB_STACK_TILE_VERTICAL":this.emitChange({action:"stackTileVertical",winId:e.winId});break;case"TAB_TOGGLE_THUMBNAIL":this.emitChange({action:"tabThumbnail",winId:e.winId});break;case"UNLOAD_DIALOG_CLOSED":this.emitChange({action:"unloadDialogClosed",winId:e.windowId})}}}const c6=new d6(S.Z);const h6=function({isActive:e,orientation:t="right",onClick:s,style:n,title:i}){const a=["left","up"].includes(t)?"expanded":"closed";return(0,zn.jsx)("div",{className:Gn()("tab-position","accordion-toggle-arrow",a,{active:e}),style:n,onClick:s,title:i,children:(0,zn.jsx)(aa,{type:"folder-arrow",className:t})})};class u6 extends Un.PureComponent{_isHorizontal=()=>"top"===this.props.tabPosition||"bottom"===this.props.tabPosition;_handleKeyDown=e=>{switch(e.key){case"ArrowLeft":case"ArrowRight":case"ArrowDown":case"ArrowUp":if((this._isHorizontal()?"ArrowLeft"===e.key||"ArrowRight"===e.key:"ArrowUp"===e.key||"ArrowDown"===e.key)&&this.props.onMoveFocus){const t="ArrowLeft"===e.key||"ArrowUp"===e.key?"left":"right";this.props.onMoveFocus(this.props.id,t,!1)}break;case"Escape":this.props.onLeaveBar?.();break;default:return}e.preventDefault(),e.stopPropagation()};handleClick=e=>{this.props.onCreateTab()};render(){const e="newtab-main"===this.props.id,t=e?(0,W.Z)("Open a New Tab"):(0,W.Z)("Open a New Tab inside the Stack"),s=e?(0,W.Z)("button","New Tab"):(0,W.Z)("button","New Stacked Tab");return(0,zn.jsx)(oa.ZP,{style:this.props.style,className:"newtab",onKeyDown:this._handleKeyDown,onClick:this.handleClick,tooltip:t,label:s,image:Kn.Wjz.large,commandId:"COMMAND_NEW_TAB"})}}const p6=u6,g6="iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAAeElEQVR42u3PsQ2AMAxE0T9CRsooGYEN8GYehREywiFZSCAaiOki3q/cnGTmUXE6ep3TuFhRopVDi9MovFVYEKISHLEwyhBOEKIwqiD6OZAh9A/8A1MNdJQuOErmhIqSNQ6GEhkXbeiRjlN5YLfG5Ac29ND2fWA2O2BvJtL+Sqc0AAAAAElFTkSuQmCC",m6="iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAAeElEQVR42u3UMRGFMBBF0ZUQSUiJBByAs5WChEg4v2CYzK+A0DGcNNnmli9ewyQ116UancWIJXYqWJW4SDGDaT8Tc9xkRe5fKHGTgnYExAD4Al/gVYFmSA+kUXnM2ajax2HEGp0qXdek6XSy/l/cMh6wObM9D7zNDwwfZaGr1mq0AAAAAElFTkSuQmCC",f6="iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAAg0lEQVR42u2VsQ2FMAwFbwRGYJSMkhHYAG/mUf4IGeF9OlAAW0JCNLkrI52dyrxBwWnopFMhZ0WBKwkVIYyJnokFIQohjli4wxBOiNBh+sxvcz5sIVoa6CYK697zQL/Bw8DOCIzACIzAJ4GGUkMcJTohBSVWEgwFGuTUy480nPLCKf8DboLOlYXq8a8AAAAASUVORK5CYII=",v6="iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAAf0lEQVR42u3VMQ3EMAxAUUMohEIplEIog4ZZoBRCILwbK6W6WDqpuiVvtfTtzfECm6p5qvbIOY2cMWYHxRIdiwNsMaLiiC8U1BiBe7vV5bLeV6ClgW4jpZvngf6CHwO3GZiBGZiBvwSaRBaoMjV7a5k9xhQjJXJ21VNTbS/88g95rrHAQWGpyQAAAABJRU5ErkJggg==",b6="iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAAXElEQVR42u2VsRHAMAjENBqjsEm8GSMxAlnA+L5wmhxSrzsantsYQVKtgXPgoQQfGpwSNbaEHAi2lGz2AYWiJjCBCUzg94GkVD966yYHnIZFCS4O+PGQJLDLc/4CszsVOj41Gu4AAAAASUVORK5CYII=",C6="iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAAWUlEQVR42u3VQRHAQAgEQaQhBSc5Z0hCwsQAVO3j8knRAua5a5fhJMUsCZvxoHisR6By65Co0jroagyYAGADG9jABn4fKGQfzbqjCutxUBybESSzIvHLf/4C9P00KaLDfPkAAAAASUVORK5CYII=",w6="https://vivaldi.com/downloadapp/",y6={type:"separator",label:"",labelEnglish:""};class x6 extends Un.PureComponent{static contextType=oi.Z;state={popupVisible:!1,isLoggedIn:!1,qrImage:"",deviceTree:[],statusOverlay:"none",sharedLinks:fn.getState().elements};componentDidMount(){Nn.addListener(this._onSyncedTabsStoreChanged),fn.addListener(this._onSharedLinksStoreChanged),this._onSyncedTabsStoreChanged()}componentWillUnmount(){Nn.removeListener(this._onSyncedTabsStoreChanged),fn.removeListener(this._onSharedLinksStoreChanged)}_onSyncedTabsStoreChanged=()=>{const e=pe(me.getState()),t=hv.getState().engineData,s=hv.getState().cycleData;let n="none";"loggedOut"!==e&&(t.isFirstSetupComplete&&("credentialsMissing"===e||"loginFailed"===e||t.needsDecryptionPassword)||"failed"===t.engineState&&!t.disableReasons.includes("not_signed_in")||"disable_sync_on_client"===t.protocolErrorClientAction?n="failed":["started","stopped"].includes(t.engineState)&&0===parseInt(s.nextRetryTime)||(n="waiting")),this.setState({isLoggedIn:t.isFirstSetupComplete&&"stopped"!==t.engineState,deviceTree:Nn.getDeviceTree(),statusOverlay:n})};_onSharedLinksStoreChanged=()=>{const e=fn.getState().elements;this.setState({sharedLinks:e})};onSignin=()=>{ue.Z.showSettings(this.context.vivaldiWindowId,"sync"),this.hidePopup()};onRegister=()=>{ue.Z.showSettings(this.context.vivaldiWindowId,"sync",{view:"register"}),this.hidePopup()};trimTitle=e=>(e.length>70&&(e=e.substring(0,70)+"..."),e);getContextMenuItems=()=>{const e=this.state.sharedLinks.map((e=>{const t=(0,W.Z)("From $1: $2",[e.deviceName,e.title]);return{iconPNG:"chrome://favicon/"+e.url,iconPNGWhite:"chrome://favicon/"+e.url,label:t,labelEnglish:t,handler:()=>bn.onActivate(this.context.vivaldiWindowId,[e.guid])}}),[]);e.length>0&&(e.push(y6),e.push({handler:()=>bn.onDelete(this.state.sharedLinks.map((e=>e.guid))),label:(0,W.Z)("Clear Shared Tabs"),labelEnglish:(0,W.Z)("Clear Shared Tabs")}),e.push(y6));const t=this.state.deviceTree.map((e=>{const t=new J4(e,this.context.vivaldiWindowId).buildContextMenuTree();let s=g6,n=m6;switch(e.deviceType){case"tablet":s=b6,n=C6;break;case"phone":s=f6,n=v6}return{items:t,labelEnglish:e.name,label:e.name,iconPNG:s,iconPNGWhite:n}}));return Promise.resolve(e.concat(t))};togglePopup=()=>{this.setState((e=>({popupVisible:!e.popupVisible})))};hidePopup=()=>{this.setState({popupVisible:!1})};tabPosToPopupPos=()=>{const{tabPosition:e}=this.props;return"top"===e?"below":"bottom"===e?"above":"right"===e?"left":"right"};getQRCode=()=>{re.Z.utilities.generateQRCode(w6,"dataurl",(e=>{this.setState({qrImage:e})}))};renderNoTabSynced=()=>(this.getQRCode(),(0,zn.jsxs)("div",{className:"synced-tab-dialog",children:[(0,zn.jsx)("img",{className:"tab-sync-qr-code",src:this.state.qrImage}),(0,zn.jsx)("h3",{children:(0,W.Z)("Tabs from your other devices will show here.")}),(0,zn.jsx)("p",{children:(0,W.Z)("Scan the QR code to install Vivaldi on your smartphone.")}),(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Get Vivaldi for Mobile"),onClick:()=>{c.ZP.openURL(this.context.vivaldiWindowId,w6),this.hidePopup()}})]}));renderNotLoggedIn=()=>(0,zn.jsxs)("div",{className:"synced-tab-dialog",children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:s(71665)}}),(0,zn.jsx)("p",{children:(0,W.Z)("See your tabs from other devices by signing in to Sync.")}),(0,zn.jsxs)("div",{className:"toolbar toolbar-wrap toolbar-space toolbar-center",children:[(0,zn.jsx)("input",{type:"button",className:"primary",value:(0,W.Z)("Create Account"),onClick:this.onRegister}),(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Log In"),onClick:this.onSignin})]})]});render(){const{isLoggedIn:e}=this.state,t=this.state.sharedLinks?.length??0;let s=null;0===t&&(e&&0===this.state.deviceTree.length&&0===this.state.sharedLinks.length?s=this.renderNoTabSynced():e||(s=this.renderNotLoggedIn()));const n={"--syncStatusActive":e&&"none"===this.state.statusOverlay?1:0,"--syncStatusLoading":"waiting"===this.state.statusOverlay?1:0,"--syncStatusFailed":"failed"===this.state.statusOverlay?1:0},i=t>0?(0,W.Z)("$1 Shared Tab","$1 Shared Tabs",[t]):(0,W.Z)("Synced Tabs"),a=t>0?t.toString():void 0,o="synced-tabs-button"+(t>0?" receiving":"");return s?(0,zn.jsx)(oa.ZP,{name:"SyncStatus",className:o,tooltip:i,badgeText:a,image:Kn.ssx.large,onClick:this.togglePopup,hidePopup:this.hidePopup,isPopupVisible:this.state.popupVisible,popupWidth:260,popupPosition:this.tabPosToPopupPos(),popupClassName:"ToolbarButtonPopup-DefaultStyles",popupLabel:(0,W.Z)("dialog title","Synced Tabs"),style:n,children:s}):(0,zn.jsx)(oa.ZP,{name:"SyncStatus",className:o,tooltip:i,badgeText:a,image:Kn.ssx.large,menu:this.getContextMenuItems,menuOrigin:"bottomLeft",style:n})}}const I6=x6;class A6 extends Un.PureComponent{nodeRef=Un.createRef();render(){const{faviconUrl:e,isPrivate:t,isLoading:s,isFetching:n,progress:i,progressType:a}=this.props,o=Math.round(100*i),r=e.startsWith("<svg");if(s){if("spinner"===a)return(0,zn.jsx)("span",{ref:this.nodeRef,className:"favicon spinner",dangerouslySetInnerHTML:{__html:Kn.H0I}});if("progress_icon"===a)return(0,zn.jsx)("span",{ref:this.nodeRef,className:"favicon progress",style:{"--progressInPercent":o+"%"}})}else if(n){if("spinner"===a)return(0,zn.jsx)("span",{ref:this.nodeRef,className:"favicon spinner spinner-inactive",dangerouslySetInnerHTML:{__html:Kn.H0I}});if("progress_icon"===a)return(0,zn.jsx)("span",{ref:this.nodeRef,className:"favicon progress infinite-spin",style:{"--progressInPercent":o+"%"}})}return(0,zn.jsx)("span",{ref:this.nodeRef,className:"favicon jstest-favicon-image "+(r?"svg":""),children:(0,zn.jsx)(Vn.ZP,{refFavicon:this.props.refFavicon,url:e,loadType:t?"faviconSkipCache":"faviconFromCache"})})}}const S6=A6,Z6={getMenu:async(e,t,s)=>{try{const n=await re.Z.tabsPrivate.getSendTabToSelfTargets(e);let i=[];return n.valid&&(i=n.entries.map(((e,n)=>{let i="",a="";return"phone"===e.type?(i=f6,a=v6):"tablet"===e.type?(i=b6,a=C6):(i=g6,a=m6),{iconPNG:i,iconPNGWhite:a,handler:()=>{re.Z.tabsPrivate.sendSendTabToSelfTarget(t,s,e.guid)},...st.Z.makeNumberMnemonic(e.name,n)}}))),{valid:n.valid,items:i}}catch(e){return console.error("Failed to fetch targets",e),{valid:!1,items:[]}}}};var T6=(0,zn.jsx)("rect",{className:"inner",width:"100%",height:"100%"}),E6=(0,zn.jsx)("rect",{className:"outer",width:"100%",height:"100%"}),k6=(0,zn.jsx)("rect",{className:"stack-frame",width:"100%",height:"100%"});function N6({marked:e,isStack:t,isHorizontal:s,isAccordion:n,stackOrFirst:i,accordionFrameSize:a,isDragging:o,isHiddenForDrag:r}){let l,d,c;if(n&&i){if(a>0){const e=(0,Si.mM)()>0?(0,Si.mM)():1;s?l=a-e+"px":d=a-e+"px"}else{const e=o||r?0:16;s?l=`calc(var(--Width) + ${e}px)`:d=`calc(var(--Height) + ${e}px)`}c={width:l,height:d}}return(0,zn.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:t&&!s?"100%":null,height:t&&s?"100%":null,style:c,className:Gn()({"svg-tab-selection":e,"svg-tab-stack":i}),children:[e&&T6,e&&E6,i&&k6]})}function _6({onClick:e,onMouseDown:t}){const s=(0,W.Z)("Close Tab")+"\n"+(0,W.Z)("$1 click to close other tabs except this one",[(0,W.Z)("key","Alt")]);return(0,zn.jsx)("button",{className:"close",dangerouslySetInnerHTML:{__html:Kn.kze},onClick:e,onAuxClick:e,onMouseDown:t,title:s})}const P6=function(e,t,s,n){const i=()=>{e.removeEventListener("mousemove",l),e.removeEventListener("mouseup",d)},a=(e,s,i,o)=>{re.Z.tabsPrivate.onDragEnd.removeListener(a),re.Z.utilities.broadcastMessage({endDragging:!0}),!e&&s&&c.ZP.detachPage((0,qe.aV)(t),i,o),n&&n.onDragEnd()},o=s.pageX,r=s.pageY,l=e=>{if(Math.abs(e.pageX-o)>5||Math.abs(e.pageY-r)>5){i();const s=(n?n.element:e.target).getBoundingClientRect(),o=n?n.offsetLeft:0,r=n?n.offsetTop:0,l=n?n.offsetHeight:0,d=n?n.offsetWidth:0;re.Z.utilities.broadcastMessage({startDragging:!0}),re.Z.tabsPrivate.onDragEnd.addListener(a);const[c]=t;re.Z.tabsPrivate.startDrag({windowId:c.windowId,mimeType:u.Up,customData:JSON.stringify({ids:t.map((e=>e.id)),active:(t.find((e=>e.active))||c).id}),url:c.url,title:c.title,posX:s.left+o,posY:s.top+r,width:s.width+d,height:s.height+l,cursorX:10,cursorY:10}),n&&n.onDragStart(t)}},d=()=>{i()};e.addEventListener("mousemove",l),e.addEventListener("mouseup",d)},M6=(e,t,s=!0)=>Boolean(t&&e.ctrlKey),D6=(e,t,s=!0)=>Boolean(t&&e.shiftKey);var O6=(0,zn.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"100%",height:"4",className:"svg-tab-selection",children:[(0,zn.jsx)("line",{className:"inner",x1:"0",y1:"0",x2:"100%",y2:"0"}),(0,zn.jsx)("line",{className:"outer",x1:"0",y1:"0",x2:"100%",y2:"0"})]});function j6({groupId:e,stackSize:t,highlightId:s,isSelecting:n,checkSelected:i,isUnread:a,isHiddenForDrag:o,onContextMenu:r,onActivate:l,getDraggedPages:d,setPageIdsHiddenForDrag:h}){const u=Un.useContext(oi.Z),p=(0,Eo.Z)([Z.kTabsUnread,Z.kTabsSelectionEnabled,Z.kTabsStackingAllowDnd]),g=Un.useRef({}),m=Ze.ZP.getGroup(e,u.vivaldiWindowId);return(0,zn.jsx)("div",{className:"tab-group-indicator",children:m.map((e=>{const t=Gn()("tab-indicator",{active:s===e.id,marked:n&&i(e.id),unread:p[Z.kTabsUnread]&&a&&e.id!==s,"hidden-for-drag":o}),m=`stack-${e.id}`;return(0,zn.jsx)("div",{ref:e=>{e&&g.current&&(g.current[m]=e)},className:t,title:vs.jk.getDisplayTitle(e),onContextMenu:e=>r(e,!0),onClick:t=>function(e,t){if((0,wi.ZP)(e),e.button===ai.Z.kLeft){const s=!1,n=fe.ZP.isActive(u.vivaldiWindowId);M6(e,p[Z.kTabsSelectionEnabled],n)?c.ZP.setSelection(t,{multiSelect:!1,addGroup:!1}):D6(e,p[Z.kTabsSelectionEnabled],n)?c.ZP.setSelection(t,{multiSelect:!0,addGroup:!1}):(!(0,vi.Z)(e)||s&&!n&&e.metaKey)&&l(t)}else e.button,ai.Z.kCenter}(t,e),onMouseDown:t=>function(e,t,s){(0,wi.ZP)(e);const n=g.current;if(!p[Z.kTabsStackingAllowDnd]||!n)return;const i=d(t);P6(u,i,e,{offsetLeft:2,offsetTop:3,offsetHeight:-6,offsetWidth:-2,onDragStart:e=>h((0,qe.l4)(e.map((e=>e.id)))),onDragEnd:()=>h((0,qe.l4)()),element:n[s]})}(t,e,m),children:n&&i(e.id)&&O6},m)}))})}class L6 extends Un.Component{render(){const{progress:e=0,progressPrecision:t=.1,isFetching:s,visible:n}=this.props,i=Gn()({"page-progress-indicator":!0,"progress-done":1===e,"progress-visible":n});return(0,zn.jsx)("progress",{className:i,value:s?void 0:Math.ceil(100*e/t)*t,max:100})}}const R6=L6;function B6({pageId:e,isStack:t,groupId:s,fixedTitle:n,displayTitle:i,awaitingEdit:a,clearAwaitingEdit:o}){const r=Un.useContext(oi.Z),l=t?s:e,d=n??i,[h,u]=Un.useState(!1);function p(){u(!0)}const g=e=>{if("Enter"!==e.key||h)"Escape"===e.key&&((0,wi.ZP)(e),o());else{(0,wi.ZP)(e);const{HTMLInputElement:t}=r;e.target instanceof t&&v(e.target.value)}},m=e=>{const{document:t,HTMLInputElement:s}=r;e instanceof s&&t.activeElement!==e&&e.select()},f=e=>{v(e.target.value)},v=async n=>{t?await c.ZP.setFixedStackTitle(r.vivaldiWindowId,s,n):await c.ZP.setFixedTitle(e,n),o()};return l&&l===a?(0,zn.jsx)("input",{className:"tab-title-edit",defaultValue:d,placeholder:i,ref:m,onBlur:f,onKeyDown:g,onMouseDown:wi.UW,onDoubleClick:wi.UW,onCompositionStart:p,onCompositionUpdate:p,onCompositionEnd:function(){u(!1)}}):d}const F6=Un.memo(B6),W6=function(){let e,t,s,n,i;return function(a,o,r,l){const d=(new Date).getTime();a!==e||o!==t?(e=a,t=o,s=d):a===e&&o===t&&a!==n&&o!==i&&s&&d-s>r&&(l(),n=a,i=o,e=t=s=void 0)}};var U6=s(34155);const V6=W6(),H6=.15,G6=.85;function K6(e,t){return t?(0,W.Z)("Hibernated"):(0,W.Z)("Current RAM: $1",[(0,iu.Z)(e,0,!0,!0)])}class z6 extends Un.PureComponent{static contextType=oi.Z;#v=!1;refTab=Un.createRef();refFavicon=Un.createRef();constructor(e){super(e);let t=vs.jk.getDisplayTitleByUrl(e.url,e.title),s="";e.prefValues[Z.kTabsCounterDetection]&&({displayTitle:t,badgeText:s}=_m(t,e.url));const n=e.isStack&&!e.isSubstrip?(0,W.Z)("Tab stack with $1 tab","Tab stack with $1 tabs",[e.stackSize]):t;this.state={fadeDiscardedTabs:e.prefValues[Z.kTabsDimHibernated],loadingProgress:0,timeLeft:void 0,displayTitle:t,badgeText:s,tabTitle:n,isFetching:!1,isLoading:!1}}componentDidMount(){Hv.addListener(this._onProgressStateStoreChanged),this.props.doMonitorAlarms&&tt.Z.addListener(this._alarmsChanged),this.#v=!0,this.props.active&&U6.nextTick((()=>this._scrollIntoView()))}componentWillUnmount(){this.#v=!1,Hv.removeListener(this._onProgressStateStoreChanged),this.props.doMonitorAlarms&&tt.Z.removeListener(this._alarmsChanged)}componentDidUpdate(e){!e.active&&this.props.active&&this._scrollIntoView(),!0===e.active&&!1===this.props.active&&void 0!==this.props.awaitingEdit&&this.clearAwaitingEdit(),!1===e.discarded&&!0===this.props.discarded&&(this.discardedFadeInTimeId&&(clearTimeout(this.discardedFadeInTimeId),delete this.discardedFadeInTimeId),this.props.prefValues[Z.kTabsDimHibernated]||(this.discardedFadeInTimeId=setTimeout(this.clearFadedDiscardedTabs,2e3)),this.setState({fadeDiscardedTabs:!0}));const t=e.stackSize!==this.props.stackSize;if(e.url!==this.props.url||e.title!==this.props.title){let e,s=vs.jk.getDisplayTitleByUrl(this.props.url,this.props.title),n="";this.props.prefValues[Z.kTabsCounterDetection]&&({displayTitle:s,badgeText:n}=_m(s,this.props.url)),e=t&&this.props.isStack&&!this.props.isSubstrip?(0,W.Z)("Tab stack with $1 tab","Tab stack with $1 tabs",[this.props.stackSize]):s,this.setState({displayTitle:s,badgeText:n,tabTitle:e})}e.doMonitorAlarms!==this.props.doMonitorAlarms&&(this.props.doMonitorAlarms?tt.Z.addListener(this._alarmsChanged):tt.Z.removeListener(this._alarmsChanged))}_scrollIntoView=()=>{const e=this.refTab.current;if(e){const t=this.isHorizontal();setTimeout((()=>{t?e.scrollIntoView(!1):e.scrollIntoViewIfNeeded(!0)}),16)}};_alarmsChanged=e=>{if(!e)return;const t=e.find((e=>e?.id===this.props.extId));if(t)switch(t.type){case"RELOAD":if(this.props.extId===t.id){const e=Ze.ZP.getPageByReloadId(t.id);e&&c.ZP.reloadPage(e.id)}break;case"TIME_CHANGED":this.setState({timeLeft:t.remainingTime})}else this.state.timeLeft&&this.setState({timeLeft:null})};_onProgressStateStoreChanged=()=>{if(this.props.isInternalPage)return void this.setState({loadingProgress:1,isLoading:!1,isFetching:!1});const e=Hv.getProgressInfo(this.props.pageId);this.setState({loadingProgress:Math.min(Math.max(e.progress,0),1),isLoading:1!==e.progress&&!e.isFetching,isFetching:e.isFetching})};clearFadedDiscardedTabs=()=>{this.#v&&this.setState({fadeDiscardedTabs:!1})};discardPages=e=>{e.forEach(c.ZP.discardPage)};cloneTab=e=>{c.ZP.clonePages(qe.aV.of(e))};cloneTabs=e=>{c.ZP.clonePages(e)};async reloadTabStack(e,t){const s=Ze.ZP.getGroup(t,e);s.size>1&&(c.ZP.clearSelection(e),await c.ZP.reloadPage(s.map((e=>e.id))))}reloadTab=e=>{c.ZP.clearSelection(this.context.vivaldiWindowId),c.ZP.reloadPage(e)};#en=e=>{if((0,vi.Z)(e))return;const t=this.props.isStack?this.props.groupId:this.props.pageId;t&&this.props.setAwaitingEdit(t)};toggleMediaRemoting=()=>{const e=this.props.prefValues[Z.kMediaRouterMediaRemotingEnabled];I.Z.set(Z.kMediaRouterMediaRemotingEnabled,!e)};setPinned=(e,t)=>{c.ZP.clearSelection(this.context.vivaldiWindowId);const s=this.context.vivaldiWindowId,n=e.map(hg.av).toSet().flatMap((e=>Ze.ZP.isGroup(e,s)?Ze.ZP.getGroup(e,s):(0,qe.aV)())).union(e).toList();t?c.ZP.setPinned(n,t):c.ZP.setPinned(n.reverse(),t)};bookmarkAllOpenPages=()=>{const e=g.Z.getRootId();void 0!==e&&(c.ZP.clearSelection(this.context.vivaldiWindowId),ne.Z.bookmarkAllOpenPages(this.context.vivaldiWindowId,e))};bookmarkTab=(e,t)=>{const s=g.Z.getRootId();void 0!==s&&(c.ZP.clearSelection(this.context.vivaldiWindowId),ne.Z.bookmarkPages(e,t,s))};handleClose=e=>{const t=Ze.ZP.getPageById(this.props.pageId);t&&e.button===ai.Z.kLeft&&(e.altKey?this.closeAllButTab(t,this.props.isSubstrip||this.props.isInsideAccordion):e.shiftKey||e.ctrlKey||e.metaKey||this.props.closePage(t),e.preventDefault())};closeTabStack=()=>{c.ZP.closeTabStack(this.props.pageId)};handleMedia=()=>{if(this.props.mediaState.has("pip"))c.ZP.exitPictureInPicture(this.props.pageId);else{const e=Ze.ZP.getPageById(this.props.pageId);e&&this.togglePagesMuted(this.context.vivaldiWindowId,qe.aV.of(e))}};togglePagesMuted=(e,t)=>{c.ZP.toggleMuting(e,t)};closeAllButTab=(e,t)=>{const s=!t,n=Ze.ZP.getActiveWorkspace(this.context.vivaldiWindowId);c.ZP.closeOther(e,n,s)};customize=()=>{ue.Z.showSettings(this.context.vivaldiWindowId,"tabs")};isTabstackingEnabled=()=>"off"!==this.props.prefValues[Z.kTabsStackingMode];isTabStack=e=>{const t=(0,hg.av)(e);return!!t&&Ze.ZP.isGroup(t,this.context.vivaldiWindowId)};isPinned=e=>e.pinned;tileTabStack=()=>{c.ZP.tileTabStack(this.context.vivaldiWindowId,this.props.groupId),c.ZP.clearSelection(this.context.vivaldiWindowId)};isPageTiledWithType=e=>{const t=Ze.ZP.getPageById(this.props.pageId);return Boolean(t&&(0,qK.gO)(t)&&this.props.tilingType===e)};tileSelection=e=>{const t=e.count()<4?"row":"grid";c.ZP.tilePages(e.toList(),t),c.ZP.clearSelection(this.context.vivaldiWindowId)};untile=()=>{const e=Ze.ZP.getPageInWindow(this.context.vivaldiWindowId,this.props.pageId);e&&c.ZP.untilePages(qe.aV.of(e))};untileTabStack=e=>{const t=this.context.vivaldiWindowId,s=Ze.ZP.getGroup(e,t);c.ZP.untilePages(s)};untileSelection=async e=>{await c.ZP.untilePages(e);const t=this.context.vivaldiWindowId,s=this.props.tilingId;Ze.ZP.getTiles(s,t).size<2&&await c.ZP.untileTileGroup(this.context.vivaldiWindowId,s),c.ZP.clearSelection(this.context.vivaldiWindowId)};untileTileGroup=()=>{c.ZP.untileTileGroup(this.context.vivaldiWindowId,this.props.tilingId),c.ZP.clearSelection(this.context.vivaldiWindowId)};mouseEnterHandler=()=>{this.props.clearForceHover()};keyDown=e=>{if(void 0!==this.props.awaitingEdit)return;const{prefValues:t}=this.props,{ctrlKey:s,altKey:n,shiftKey:i,metaKey:a}=e,o={ctrlKey:s,altKey:n,shiftKey:i,metaKey:a},r=t[Z.kTabsSelectionEnabled];switch(e.key){case"Enter":case" ":const s=Ze.ZP.getPageById(this.props.pageId);s&&this.props.onActivate(s);break;case"ArrowLeft":case"ArrowRight":case"ArrowDown":case"ArrowUp":const n=this.isHorizontal();if((0,Zi.Mr)(o)&&r){const t=Ze.ZP.getPageById(this.props.pageId);t&&(("ArrowLeft"===e.key&&n||"ArrowUp"===e.key&&!n)&&c.ZP.expandSelectionPrevious(t),("ArrowRight"===e.key&&n||"ArrowDown"===e.key&&!n)&&c.ZP.expandSelectionNext(t))}if((0,Zi.S2)(o)){const s="dotted"===t[Z.kTabsStackingMode];if(n){if("ArrowLeft"===e.key||"ArrowRight"===e.key){const t=Ze.ZP.getPageById(this.props.pageId);t&&c.ZP.stepPage(t,"ArrowRight"===e.key,s,this.context.vivaldiWindowId).then((()=>{r&&(c.ZP.setSelection(t,{multiSelect:!1,addGroup:!1,excludeActive:!0}),this.props.onMoveFocus(this.props.id,"current",!0))}))}}else if("ArrowUp"===e.key||"ArrowDown"===e.key){const t=Ze.ZP.getPageById(this.props.pageId);t&&c.ZP.stepPage(t,"ArrowDown"===e.key,s,this.context.vivaldiWindowId).then((()=>{r&&(c.ZP.setSelection(t,{multiSelect:!1,addGroup:!1,excludeActive:!0}),this.props.onMoveFocus(this.props.id,"current",!0))}))}}if((0,Zi.VV)(o)){if(n?"ArrowLeft"===e.key||"ArrowRight"===e.key:"ArrowUp"===e.key||"ArrowDown"===e.key){const t="ArrowLeft"===e.key||"ArrowUp"===e.key?"left":"right";c.ZP.clearSelection(this.context.vivaldiWindowId),U6.nextTick((()=>this.props.onMoveFocus(this.props.id,t,!1)))}else if(!this.props.isSubstrip&&this.props.isStack){const e=this.refTab.current,{Element:t}=this.context;e instanceof t&&this.props.onStackMenu(this.props.pageId,e)}}break;case"Escape":c.ZP.clearSelection(this.context.vivaldiWindowId),this.props.onLeaveBar();break;default:return}(0,wi.ZP)(e)};createGroup=(e,t)=>{const s=e.sort(((e,t)=>e.index-t.index)),n=t.index-s.findIndex((e=>e===t));c.ZP.createTabStack(s,n,(0,hg.av)(t))};isHorizontal=()=>{const{tabPosition:e}=this.props;return"top"===e||"bottom"===e};onContextMenu=(e,t)=>(e.persist(),(0,wi.ZP)(e),this.getContextMenuItemsPromise("tab",t,e).then((t=>{(0,mi.Z)(this.context,t)(e)})),!1);getContextMenuItemsPromise=(e,t,s)=>{const i=this.context.vivaldiWindowId,a=Ze.ZP.getPageById(this.props.pageId);if(!a)return Promise.reject("Tab.jsx: Expected page not found");const o=Ze.ZP.getActiveWorkspace(i),{isStack:r,groupId:l,isSubstrip:d,isInsideAccordion:h}=this.props,u=this.props.isSelecting&&this.props.isSelected&&this.props.selectionCount>1,p=Ze.ZP.getSelectedPages(i),g=p.filter((e=>Ze.ZP.canClosePage(e))),m=Ze.ZP.getPages(i,{workspaceId:o}).filterNot(this.isPinned),f=m.filter((e=>!p.some((t=>t.id===e.id)))),v=fe.ZP.isGuest(),[b,C]=(0,r5.d)(a,Ze.ZP.getWorkspaceTabsInWindow(i,o,!this.isTabstackingEnabled())),w=!a.active&&!a.discarded&&!a.isInspected&&a.url!==Ze.ZP.getDefaultStartpage(i),y=r&&Ze.ZP.getGroup(l,i).some((e=>!e.active&&!e.discarded&&!e.isInspected&&e.url!==Ze.ZP.getDefaultStartpage(i))),x=Ze.ZP.getDiscardablePages(i),I=Ze.ZP.isGroup(l,i),A=t||!I?m.size>=2:m.size-Ze.ZP.getGroup(l,i).size>0;let S;S=u?p:!t&&r?Ze.ZP.getGroup(l,i):qe.aV.of(a);const T=p.filter(this.isPinned),E={isMultiSelect:u,count:p.size,closableCount:g.size,unSelectedCount:f.size,unpinned:p.size-T.size,pinned:T.size,playing:p.count((e=>mq.Z.hasMediaState(e.id,"playing")||mq.Z.hasMediaState(e.id,"muting"))),canHibernateCount:p.count((e=>!e.active&&!e.isInspected)),hostname:b,hostnameCount:C.size,horizontal:this.isHorizontal(),someIncognito:p.some((e=>a.incognito)),canCloneCount:p.count((e=>!(0,vs.m7)(e)))},k=ei.Z.getOptionFunction(e),N=this.props.extId,_=async()=>{const e=[],{document:t,vivaldiWindowId:o}=this.context,d=fe.ZP.getState().get(o);for(const[s,h]of fe.ZP.getState()){if(s===o||"normal"!==h.type||d?.incognito!==h.incognito)continue;const g=(await n.Z.windows.get(s,{populate:!0})).tabs||[],m=g.find((e=>e.active)),f=m&&m.url?vs.jk.getDisplayTitleByUrl(m.url,m.title||m.url):String(e.length+1);e.push({handler:()=>{const e=u?p:r?Ze.ZP.getGroup(l,i):qe.aV.of(a);e.count()===Ze.ZP.getPages(o).count()&&t.querySelectorAll("webview").forEach((e=>e.parentElement?.removeChild(e))),c.ZP.moveToWindow(e,s)},...(0,fi.Z)("Window with $1 Active Tab ($2)","Window with $1 Active Tabs ($2)",[g.length,f])})}return e.length>0&&e.unshift(st.Z.separatorItem),fe.ZP.isIncognitoOrGuest(o)||(e.push(st.Z.separatorItem),e.push({handler:()=>{S.count()===Ze.ZP.getPages(o).count()&&t.querySelectorAll("webview").forEach((e=>e.parentElement?.removeChild(e))),c.ZP.detachPage(S,s.screenX,s.screenY)},...(0,fi.Z)("To New Window")})),e},P=async e=>{const t=[],s=m_.Z.getState();if(s.length>0){const e=u?p:r?Ze.ZP.getGroup(l,i):qe.aV.of(a),n=()=>{const e=Ze.ZP.getActivePage(i);e&&(0,hg.cm)(e)===o||c.ZP.cycleByHistory(i)};t.push(st.Z.separatorItem),o&&t.push({handler:async()=>{await c.ZP.moveToWorkspace(e,void 0),n()},...(0,fi.Z)("To This Window")}),s.forEach((s=>{s.id!==o&&t.push({handler:async()=>{await c.ZP.moveToWorkspace(e,s.id),n()},label:s.name,labelEnglish:s.name})}))}return fe.ZP.isGuest()||(t.push(st.Z.separatorItem),t.push({handler:()=>{ue.Z.showWorkspaceDialog(i,{createInBackground:!1,withPages:S})},...(0,fi.Z)("Create Workspace With This Tab","Create Workspace With Selected Tabs",[S.size])})),t};return ei.Z.getNamedMenu(i,e,(async e=>{const s=this.isPageTiledWithType("selection"),n=this.isPageTiledWithType("group");switch(e.action){case"CONTEXT_NEW":return{handler:()=>this.props.onCreateTab(!u&&I&&l?l:void 0),...k(i,e,E)};case"CONTEXT_RELOAD":return{handler:u?this.reloadTab.bind(this,p.map((e=>e.id))):this.reloadTab.bind(this,a.id),...k(i,e,E)};case"CONTEXT_CLONE":return{isVisible:()=>u?!p.every(vs.m7):!(0,vs.m7)(a),handler:u?()=>c.ZP.clonePages(p):()=>c.ZP.clonePages(qe.aV.of(a)),...k(i,e,E)};case"CONTEXT_PIN":return{handler:()=>{const e=u?p:qe.aV.of(a);this.setPinned(e,!0)},isVisible:()=>!(d||h)&&(u?!p.some(this.isTabStack)&&p.every((e=>!this.isPinned(e))):!r&&!a.pinned),...k(i,e,E)};case"CONTEXT_PIN_STACK":return{handler:()=>c.ZP.pinTabStack(l,i),isVisible:()=>r&&!d&&!a.pinned&&!u,...k(i,e,E)};case"CONTEXT_UNPIN":return{handler:()=>{const e=u?p:qe.aV.of(a);this.setPinned(e,!1)},isVisible:()=>!r&&!d&&!h&&(u?!p.some(this.isTabStack)&&p.some(this.isPinned):a.pinned),...k(i,e,E)};case"CONTEXT_UNPIN_STACK":return{handler:()=>c.ZP.unpinTabStack(l,i),isVisible:()=>r&&!u&&a.pinned&&!d,...k(i,e,E)};case"CONTEXT_MUTE":return{handler:u?()=>this.togglePagesMuted(i,p):()=>this.togglePagesMuted(i,qe.aV.of(a)),isVisible:()=>!u||p.some((e=>mq.Z.hasMediaState(e.id,"playing")||mq.Z.hasMediaState(e.id,"muting"))),checked:u?p.every((e=>mq.Z.hasMediaState(e.id,"muting"))):a.vivExtData.vivaldi_tab_muted,...k(i,e,E)};case"CONTEXT_CONTAINER_PERIODIC_TIMER":const m=u?"select":r?"stack":"tab",S=u||"tab"===m?N:l;return{items:Tm.Z.getMenu(S,m,a.windowId),isVisible:()=>!this.props.isInternalPage,...k(i,e,E)};case"CONTEXT_MUTE_OTHER":return{handler:()=>c.ZP.muteAllExcept(i,[a]),isVisible:()=>!u&&Ze.ZP.getPages(i).some((e=>e.id!==a.id&&mq.Z.hasMediaState(e.id,"playing"))),...k(i,e,E)};case"CONTEXT_OPTIMIZE_FS_VIDEOS":return{handler:this.toggleMediaRemoting,type:"checkbox",checked:this.props.prefValues[Z.kMediaRouterMediaRemotingEnabled],isVisible:()=>this.props.mediaState.has("capturing"),...k(i,e,E)};case"CONTEXT_BOOKMARK":return{handler:u?this.bookmarkTab.bind(this,p,!1):this.bookmarkTab.bind(this,a,!1),isVisible:()=>!v,...k(i,e,E)};case"CONTEXT_BOOKMARK_STACK":return{handler:this.bookmarkTab.bind(this,Ze.ZP.getGroup(l,i),!0),isVisible:()=>r&&!v,...k(i,e,E)};case"CONTEXT_BOOKMARK_ALL":return{handler:this.bookmarkAllOpenPages,isVisible:()=>!v,...k(i,e,E)};case"CONTEXT_COPY_LINK":return{handler:()=>c.ZP.copyUrls(qe.aV.of(a)),isVisible:()=>!u,...k(i,e,E)};case"CONTEXT_COPY_LINKS":return{handler:()=>{const e=r?Ze.ZP.getGroup((0,hg.av)(a),i):p;c.ZP.copyUrls(e)},isVisible:()=>u||r,...k(i,e,E)};case"CONTEXT_SAVE_SESSION":return{handler:p.count()>0?()=>ue.Z.showSaveSessionDialog(i,{mode:"ids",ids:p.map((e=>e.id)).toArray()}):()=>ue.Z.showSaveSessionDialog(i,{mode:"all"}),isVisible:()=>!v,...k(i,e,E)};case"CONTEXT_TABSTACK_BY_SELECTION":{const t=E.pinned;return{handler:()=>this.createGroup(p,a),isVisible:()=>u&&this.isTabstackingEnabled()&&this.props.isSelecting&&(0===t||t===p.size)&&!p.some((e=>{const t=(0,hg.av)(e);return t&&Ze.ZP.isGroup(t,e.windowId)})),...k(i,e,E)}}case"CONTEXT_TABSTACK_BY_HOST":return{handler:()=>{c.ZP.createGroupByHost(i,o,b)},isVisible:()=>this.isTabstackingEnabled()&&!r&&C.size>1,...k(i,e,E)};case"CONTEXT_TABSTACK_BY_HOSTS":return{handler:()=>c.ZP.createGroupByHosts(i,o),isVisible:()=>this.isTabstackingEnabled(),...k(i,e,E)};case"CONTEXT_TABSTACK_RELOAD":return{handler:()=>this.reloadTabStack(i,l),isVisible:()=>r,...k(i,e,E)};case"CONTEXT_TABSTACK_RENAME":return{handler:()=>{const e=this.props.isStack?this.props.groupId:this.props.pageId;e&&this.props.setAwaitingEdit(e)},...k(i,e,{isStack:this.props.isStack})};case"CONTEXT_TABSTACK_REMOVE_FROM":return{handler:()=>this.props.removeFromTabStack(this.props.pageId),isVisible:()=>t,...k(i,e,E)};case"CONTEXT_TABSTACK_UNGROUP":return{handler:()=>{const e=u?p.map(hg.av).filter(Boolean).toArray():[this.props.groupId];this.props.dissolveTabStacks(e)},isVisible:()=>r,...k(i,e,E)};case"CONTEXT_TILE_TABSTACK":return{handler:this.tileTabStack,isVisible:()=>r&&!this.props.isSelecting&&!n&&!s,...k(i,e,E)};case"CONTEXT_UNTILE_TABSTACK":return{handler:()=>this.untileTabStack(l),isVisible:()=>r&&!this.props.isSelecting&&(n||s),...k(i,e,E)};case"CONTEXT_TILE_TABS":return{handler:this.tileSelection.bind(this,p),isVisible:()=>u&&!s&&this.props.isSelecting&&p.count()>1,...k(i,e,E)};case"CONTEXT_UNTILE_TAB":return{handler:this.untile,isVisible:()=>!this.props.isSelecting&&s&&!r,...k(i,e,E)};case"CONTEXT_UNTILE_TILE_GROUP":return{handler:this.untileTileGroup,isVisible:()=>!this.props.isSelecting&&s,...k(i,e,E)};case"CONTEXT_UNTILE_SELECTION":return{handler:()=>this.untileSelection(p),isVisible:()=>this.props.isSelecting&&s&&!r,...k(i,e,E)};case"CONTEXT_HIBERNATE_TAB":return{handler:this.discardPages.bind(this,qe.aV.of(a)),isVisible:()=>!u&&w&&(this.props.isSubstrip||!r),...k(i,e,E)};case"CONTEXT_HIBERNATE_SELECTED_BACKGROUND_TABS":return{handler:this.discardPages.bind(this,p.filter((e=>!e.active))),isVisible:()=>Boolean(p.filter((e=>x.find((t=>t.id===e.id)))).count()),...k(i,e,E)};case"CONTEXT_HIBERNATE_TABSTACK":return{handler:this.discardPages.bind(this,Ze.ZP.getGroup(l,i).filter((e=>!e.active))),isVisible:()=>y,...k(i,e,E)};case"CONTEXT_HIBERNATE_BACKGROUND":const T=x.filter((e=>!(0,qK.ZN)(e)));return{handler:this.discardPages.bind(this,T),isVisible:()=>!T.isEmpty(),...k(i,e,E)};case"CONTEXT_CLOSE":return{handler:u?()=>this.props.closePage(g):()=>this.props.closePage(a),isVisible:()=>Ze.ZP.canClosePage(a),...k(i,e,E)};case"CONTEXT_CLOSE_TABSTACK":const M=u?!E?.pinned:!this.props.pinned;return{handler:this.closeTabStack,isVisible:()=>r&&(M||"off"!==this.props.prefValues[Z.kTabsClosePinned]),...k(i,e,E)};case"CONTEXT_CLOSE_OTHER":return{handler:()=>{u&&!f.isEmpty()?this.closeAllButTab(p,t):this.closeAllButTab(a,t)},isVisible:()=>Ze.ZP.canClosePage(a)&&(u&&0===E?.pinned&&!f.isEmpty()||!u&&A),...k(i,e,E)};case"CONTEXT_CLOSE_LEFT":return{handler:()=>c.ZP.closeToLeft(a,t),isVisible:()=>!u&&!a.pinned&&A&&!c.ZP.getTabsToTheLeft(a,t).isEmpty(),...k(i,e,E)};case"CONTEXT_CLOSE_RIGHT":return{handler:()=>c.ZP.closeToRight(a,t),isVisible:()=>!u&&!a.pinned&&A&&!c.ZP.getTabsToTheRight(a,t).isEmpty(),...k(i,e,E)};case"CONTEXT_REOPEN":return{isVisible:()=>!e5.Z.isEmpty(),...k(i,e,E)};case"CONTEXT_CONTAINER_PWA":return{isVisible:()=>a.active&&!this.props.isInternalPage,container:{content:"pwa"},...k(i,e,E)};case"CONTEXT_CUSTOMIZE":return{handler:this.customize,isVisible:()=>!v,...k(i,e,E)};case"CONTEXT_MOVE":return{isVisible:()=>u&&!p.some((e=>a.incognito))||!u&&(t||!r),...k(i,e,E)};case"CONTEXT_TABSTACK_MOVE":return{isVisible:()=>!u&&!t&&r,...k(i,e,E)};case"CONTEXT_MOVE_LEFT":return{handler:()=>c.ZP.stepPage(a,!1,!1,i),isVisible:()=>!u,...k(i,e,E)};case"CONTEXT_MOVE_RIGHT":return{handler:()=>c.ZP.stepPage(a,!0,!1,i),isVisible:()=>!u,...k(i,e,E)};case"CONTEXT_MOVE_STACK_LEFT":return{handler:()=>c.ZP.stepPage(a,!1,!0,i),isVisible:()=>!u,...k(i,e,E)};case"CONTEXT_MOVE_STACK_RIGHT":return{handler:()=>c.ZP.stepPage(a,!0,!0,i),isVisible:()=>!u,...k(i,e,E)};case"CONTEXT_CONTAINER_MOVE_TO_WINDOW":return{items:await _(),...k(i,e,E)};case"CONTEXT_CONTAINER_MOVE_TO_WORKSPACE":return{items:await P(),isVisible:()=>this.props.prefValues[Z.kWorkspacesEnabled],...k(i,e,E)};case"CONTEXT_CONTAINER_SEND_TO_DEVICES":{const t=await Z6.getMenu(a.id,a.url,this.props.fixedTitle||this.state.displayTitle);return{items:t.valid?t.items:[],isVisible:()=>t.valid&&!u&&!r,...k(i,e,E)}}default:return{...k(i,e,E)}}}))};isKnownDropMimeType=e=>e.dataTransfer.types.some((e=>e===u.Up||Jn.ZP.isUriListType(e)||"text/plain"===e));onDragEnterHandler=e=>{const{groupId:t,prefValues:s,isInsideAccordion:n,handleExpandAccordion:i}=this.props;t&&"accordion"===s[Z.kTabsStackingMode]&&!n&&i&&(clearTimeout(this.accordionExpandTimeout),this.accordionExpandTimeout=setTimeout((()=>i(t)),1e3)),this.isKnownDropMimeType(e)&&(0,wi.ZP)(e)};onDragLeaveHandler=e=>{e.persist();this.props.groupId&&"accordion"===this.props.prefValues[Z.kTabsStackingMode]&&!this.props.isInsideAccordion&&clearTimeout(this.accordionExpandTimeout),this.props.onDragLeave(e)};onDragOverHandler=e=>{if(this.isKnownDropMimeType(e)&&(0,wi.ZP)(e),e.dataTransfer.types.includes("vivaldi/x-button-toolbar"))return;const t=this.props.handleTabPosition;if(t&&this.props.isExpectingDrop&&e.dataTransfer.types.some((e=>e===u.Up))){const{pageX:s,pageY:n}=e,i=this.getDropSide(s,n);t(this.props.pageId,i)}else{e.dataTransfer.types.some((e=>Jn.ZP.isUriListType(e)||q1.Z.isSessionType(e)||"text/plain"===e))&&(e.dataTransfer.dropEffect="copy");const t=Ze.ZP.getPageById(this.props.pageId);t&&V6(e.screenX,e.screenY,250,(()=>this.props.onActivate(t)))}};getDropSide=(e,t)=>{const{Element:s}=this.context;if(!(this.refTab.current instanceof s))return"before";const{prefValues:n,direction:i,isSubstrip:a,isInsideAccordion:o}=this.props,r=!(this.props.pinned&&!a)&&n[Z.kTabsStackingAllowDnd]&&"off"!==n[Z.kTabsStackingMode]&&!a&&!o,l=this.refTab.current.getBoundingClientRect(),[d,c]=[e-l.left,t-l.top];return"row"===i?r?d<l.width*H6?"before":d>l.width*G6?"after":"over":d<l.width/2?"before":"after":"column"===i?r?c<l.height*H6?"before":c>l.height*G6?"after":"over":c<l.height/2?"before":"after":"before"};onDropHandler=e=>{this.isKnownDropMimeType(e)&&(0,wi.ZP)(e);const t=e.dataTransfer.getData(u.Up);if(t)return void this.props.droppedTabHandler(t);const s=Jn.ZP.extractUriListFromEvent(e);if(s)return void s.split("\n").forEach(((e,t)=>c.ZP.openURL(this.context.vivaldiWindowId,e,{incognito:this.props.incognito,inCurrent:0===t,inSpecificPageId:0===t?this.props.pageId:void 0,inBackground:0!==t})));const n=q1.Z.getSessionData(e);if(n)return void gn.Z.open(this.context.vivaldiWindowId,n,!1);const i=e.dataTransfer.getData("text/plain");i&&(0,Ar.K2)(i)&&c.ZP.openURL(this.context.vivaldiWindowId,i,{inCurrent:!0,inSpecificPageId:this.props.pageId,incognito:this.props.incognito})};onFocusHandler=e=>{if(void 0!==this.props.awaitingEdit)return;const t=Ze.ZP.getPageById(this.props.pageId);t&&c.ZP.setSelection(t,{multiSelect:!1,addGroup:!1,excludeActive:!0})};clearAwaitingEdit=()=>{this.props.setAwaitingEdit(void 0)};render(){const{discarded:e,prefValues:t,faviconUrl:s,isInternalPage:n,isStack:i,isUnread:a,isHidden:o,shouldShowCloseButton:r,mediaState:l}=this.props,{loadingProgress:d,timeLeft:c=null,badgeText:h,tabTitle:p}=this.state,g=this.props.pinned&&!this.props.isSubstrip,m=this.props.active,f=this.props.smallTab,v=this.props.wideTab,b=0===l.size||e,C=Boolean(this.props.isSelecting&&(!this.props.isHidden&&this.props.isSelected||this.props.highlighted)),w=t[Z.kTabsStackingMode],y=i&&!this.props.isSubstrip&&("dotted"===w||"substrip"===w&&t[Z.kTabsStackingPreferDotted]),x=Gn()("tab",{"tab-acceptsdrop":this.props.acceptsDrop,marked:C,pinned:g,active:m,highlighted:this.props.highlighted&&!t[Z.kTabsSelectionEnabled],"tab-small":f&&!g,"tab-mini":this.props.miniTab&&!g,"tab-accordion":this.props.isStack&&"accordion"===w,"tab-in-accordion":this.props.isInsideAccordion,"tab-first-in-group":this.props.isFirstInGroup,"tab-last-in-group":this.props.isLastInGroup,"force-hover":this.props.forceHover,"tab-group":y,"audio-on":l.has("playing")||l.has("pip"),"audio-muted":l.has("muting"),"tab-captured":l.has("capturing"),"button-off":!r,unread:t[Z.kTabsUnread]&&a&&!m&&!i&&!n,isdiscarded:this.state.fadeDiscardedTabs&&t[Z.kTabsDimHibernated]&&e,insubstrip:this.props.isSubstrip,"periodic-reload":null!==c}),I="progress_bar"===t[Z.kTabsPageLoadInfo]&&!n&&(m&&!this.props.addressBarVisible||m&&!t[Z.kAddressBarShowProgress]||!m),A=c||I,S=c||d,T=m?t[Z.kKeyboardTabToAll]:"-1",E=t[Z.kHoverCardMemoryUsageEnabled]?K6(this.props.memoryUsage,this.props.discarded):void 0;return(0,zn.jsx)(zn.Fragment,{children:(0,zn.jsxs)("div",{id:this.props.id,className:Gn()("tab-wrapper",{active:m,uifocusstop:m&&!o,extended:!y&&!this.props.isSubstrip,group:y,accordion:this.props.isStack&&"accordion"===w}),ref:this.refTab,"data-id":this.props.id,title:t[Z.kTabsTooltip]?null:p+(!i&&E?u.YV+E:""),role:"tab","aria-label":p,"aria-hidden":o,"aria-selected":m,onContextMenu:e=>this.onContextMenu(e,this.props.isSubstrip||this.props.isInsideAccordion),onMouseEnter:this.mouseEnterHandler,onMouseDown:wi.PF,onDragEnter:this.onDragEnterHandler,onDragOver:this.onDragOverHandler,onDragLeave:this.onDragLeaveHandler,onDrop:this.onDropHandler,onKeyDown:this.keyDown,onFocus:t[Z.kTabsSelectionEnabled]?this.onFocusHandler:null,tabIndex:T,children:[(0,zn.jsxs)("div",{className:x,children:[(0,zn.jsxs)("div",{className:Gn()("tab-header",{"expecting-drop":this.props.isExpectingDrop}),children:[A&&(0,zn.jsx)(R6,{progress:S,progressPrecision:v?.1:f?1:.5,isFetching:this.state.isFetching,visible:!!c||this.state.isFetching||this.state.isLoading}),(0,zn.jsx)(S6,{isPrivate:fe.ZP.isIncognitoOrGuest(this.context.vivaldiWindowId),refFavicon:this.refFavicon,faviconUrl:s,progress:this.state.loadingProgress,isLoading:this.state.isLoading,isFetching:this.state.isFetching,progressType:"progress_icon"===t[Z.kTabsPageLoadInfo]||"spinner"===t[Z.kTabsPageLoadInfo]?t[Z.kTabsPageLoadInfo]:void 0}),(0,zn.jsx)("span",{className:Gn()("title",{editing:this.props.awaitingEdit}),onDoubleClick:t[Z.kTabsMinimize]||"rename"!==t[Z.kTabsDoubleClick]?null:this.#en,children:(0,zn.jsx)(F6,{pageId:this.props.pageId,isStack:this.props.isStack,groupId:this.props.groupId,fixedTitle:this.props.fixedTitle,displayTitle:this.state.displayTitle,awaitingEdit:this.props.awaitingEdit,clearAwaitingEdit:this.clearAwaitingEdit})}),this.props.shouldShowStackCounter&&(0,zn.jsx)("div",{className:"stack-counter",children:this.props.stackSize}),r&&(0,zn.jsx)(_6,{onClick:this.handleClose,onMouseDown:wi.ZP}),!b&&(0,zn.jsx)("span",{className:"tab-audio",onClick:this.handleMedia,onAuxClick:this.handleClose,onMouseDown:wi.ZP,children:(0,zn.jsx)(Jq.Z,{color:f||g?"#111":void 0,animated:t[Z.kThemeUseAnimation],mediaState:l,src:"tab"})}),t[Z.kTabsCounterDetection]&&h&&(0,zn.jsx)("span",{className:"button-badge",children:h})]}),t[Z.kTabsThumbnails]&&(0,zn.jsx)(_V,{src:this.props.thumbnail||"",pageId:this.props.pageId}),(C||(i||this.props.isInsideAccordion&&this.props.isFirstInGroup)&&!this.props.isSubstrip&&!y)&&(0,zn.jsx)(N6,{marked:C,isStack:i,isHorizontal:this.isHorizontal(),isAccordion:"accordion"===this.props.prefValues[Z.kTabsStackingMode],stackOrFirst:i||this.props.isInsideAccordion&&this.props.isFirstInGroup,accordionFrameSize:this.props.accordionFrameSize,isDragging:this.props.isDragging,isHiddenForDrag:this.props.isHiddenForDrag})]}),y&&(0,zn.jsx)(j6,{groupId:this.props.groupId,stackSize:this.props.stackSize,highlightId:this.props.highlightId,isSelecting:this.props.isSelecting,checkSelected:this.props.checkSelected,isUnread:this.props.isUnread,isHiddenForDrag:this.props.isHiddenForDrag,onContextMenu:this.onContextMenu,onActivate:this.props.onActivate,getDraggedPages:this.props.getDraggedPages,setPageIdsHiddenForDrag:this.props.setPageIdsHiddenForDrag})]})})}}const $6=z6;class Y6 extends m.Z{getInitialState(){return null}allHidden(){return null===this.getState()}getShowTooltip(e){return this.getState()===e}reduce(e,t){switch(t.actionType){case"WEBPAGEVIEW_ACTIONS":if(["focusSearchField","focusAddressField"].indexOf(t.subAction)>-1)return null;break;case"TOOLTIP_SET":if(!Io.Z.getState().isActive)return t.id}return e}}const X6=new Y6;var Q6=s(20745),q6=s(34155);const J6="vivaldi-tooltip";function e8(e){let t=e.getElementById(J6);if(!t){const s=e.getElementById("browser");t=e.createElement("div"),t.id=J6,s&&s.appendChild(t)}return t}let t8;X6.addListener((()=>{X6.allHidden()&&(t8?.unmount(),t8=void 0)}));class s8 extends Un.Component{static contextType=oi.Z;nodeRef=Un.createRef();state={show:X6.getShowTooltip(this.props.id)};#tn=!1;componentWillUnmount(){X6.removeListener(this._onStoreChange),q6.nextTick(o6.i)}componentDidMount(){X6.addListener(this._onStoreChange),this.props.disabled||this.renderToolTip()}componentDidUpdate(e,t){this.props.disabled||(!t.show&&this.state.show||e.memoryUsage!==this.props.memoryUsage||e.stackSize!==this.props.stackSize)&&this.renderToolTip()}_onStoreChange=()=>{this.setState({show:!this.props.disabled&&X6.getShowTooltip(this.props.id)})};onDragEnter=()=>{o6.i(0),this.#tn=!0};onDragLeave=()=>{this.#tn=!1};onMouseEnter=()=>{if(!this.props.disabled&&!this.#tn){const e=X6.allHidden()?this.props.appearDelay:64;o6.h(this.props.id,e)}};onMouseLeave=()=>{this.props.disabled||o6.i(this.props.disappearDelay)};onClick=()=>{o6.i(0)};tooltipIsOpen=()=>{const{document:e}=this.context,t=e8(e).firstChild,{Element:s}=this.context;return Boolean(t instanceof s&&t.classList.contains("tooltip"))};getPosition=(e,t)=>{const{Element:s}=this.context,n=this.nodeRef.current;let i,a;if(!(n&&n.firstChild instanceof s))return{left:i,top:a};const o=n.firstChild.getBoundingClientRect(),r=this.props.noPadding?2:4;if("above"===this.props.placement){i=o.left+o.width/2-e/2,a=o.top-t-r}else if("after"===this.props.placement)i=o.left+o.width+r,a=o.top;else if("before"===this.props.placement)i=o.left-e-r,a=o.top;else{i=o.left+o.width/2-e/2,a=o.top+o.height+r}return i<0&&(i=0),a<0&&(a=0),i+e>this.context.innerWidth&&(i-=i+e-this.context.innerWidth),a+t>this.context.innerHeight&&(a-=a+t-this.context.innerHeight),{left:i,top:a}};renderToolTip=()=>{this.context.requestAnimationFrame(this._renderToolTip)};_renderToolTip=()=>{if(!this.state.show)return;const{document:e}=this.context,{width:t,height:s,content:n}=this.props.content(),{left:i,top:a=0}=this.getPosition(t,s),o=a+s>=this.context.innerHeight,r=o?"flex-end":"flex-start",l=this.props.noPadding?2:4,d=0===a?l:0,c=o?l:0,h=this.props.pointerEvents,u=["after","before"].includes(this.props.placement)?`top ${this.props.transitionSpeed}ms`:`left ${this.props.transitionSpeed}ms`,p="before"===this.props.placement||"after"===this.props.placement;t8||(t8=(0,Q6.createRoot)(e8(e))),t8.render((0,zn.jsx)("div",{className:"tooltip",style:{top:a,left:i,pointerEvents:h,height:p?"auto":s,width:t,paddingTop:d,paddingBottom:c,alignItems:r,transition:u},onClick:this.onClick,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,children:n}))};render(){return(0,zn.jsx)("span",{ref:this.nodeRef,onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,children:this.props.children})}}const n8=s8;const i8=1e3/60;function a8(e,t,s){const n=t;return null==n?e.map(((e,t)=>({key:e.key,data:e.data,style:s[t]}))):e.map(((e,t)=>{for(let i=0;i<n.length;i++)if(n[i].key===e.key)return{key:n[i].key,data:n[i].data,style:s[t]};return{key:e.key,data:e.data,style:s[t]}}))}function o8(e,t,s,n,i,a,o,r,l){const d=function(e,t,s){const n={};for(let t=0;t<e.length;t++)n[e[t].key]=t;const i={};for(let e=0;e<t.length;e++)i[t[e].key]=e;const a=[];for(let e=0;e<t.length;e++)a[e]=t[e];for(let t=0;t<e.length;t++)if(!Object.prototype.hasOwnProperty.call(i,e[t].key)){const n=s(t,e[t]);null!=n&&a.push(n)}return a.sort(((e,s)=>{const a=i[e.key],o=i[s.key],r=n[e.key],l=n[s.key];if(null!=a&&null!=o)return i[e.key]-i[s.key];if(null!=r&&null!=l)return n[e.key]-n[s.key];if(null!=a){for(let e=0;e<t.length;e++){const s=t[e].key;if(Object.prototype.hasOwnProperty.call(n,s)){if(a<i[s]&&l>n[s])return-1;if(a>i[s]&&l<n[s])return 1}}return 1}for(let e=0;e<t.length;e++){const s=t[e].key;if(Object.prototype.hasOwnProperty.call(n,s)){if(o<i[s]&&r>n[s])return 1;if(o>i[s]&&r<n[s])return-1}}return-1}))}(n,i,((e,n)=>{const i=t(n);return null==i||nF(a[e],i,o[e])?(s({key:n.key,data:n.data}),null):{key:n.key,data:n.data,style:i}})),c=[],h=[],u=[],p=[];for(let t=0;t<d.length;t++){const s=d[t];let i=null;for(let e=0;e<n.length;e++)if(n[e].key===s.key){i=e;break}if(null==i){const n=e(s);c[t]=n,u[t]=n;const i=sF(s.style);h[t]=i,p[t]=i}else c[t]=a[i],u[t]=r[i],h[t]=o[i],p[t]=l[i]}return[d,c,h,u,p]}class r8 extends Un.Component{static contextType=oi.Z;context;static defaultProps={willEnter:e=>oF(e.style),willLeave:()=>null,didLeave:()=>{}};unmounting=!1;animationID=null;prevTime=0;accumulatedTime=0;unreadPropStyles=null;constructor(e){super(e),this.state=this.defaultState()}defaultState(){const{defaultStyles:e,styles:t,willEnter:s,willLeave:n,didLeave:i}=this.props,a="function"==typeof t?t(e):t;let o;o=null==e?a:e.map((e=>{for(let t=0;t<a.length;t++)if(a[t].key===e.key)return a[t];return e}));const r=null==e?a.map((e=>oF(e.style))):e.map((e=>oF(e.style))),l=null==e?a.map((e=>sF(e.style))):e.map((e=>sF(e.style))),[d,c,h,u,p]=o8(s,n,i,o,a,r,l,r,l);return{currentStyles:c,currentVelocities:h,lastIdealStyles:u,lastIdealVelocities:p,mergedPropsStyles:d}}clearUnreadPropStyle=e=>{const[t,s,n,i,a]=o8(this.props.willEnter,this.props.willLeave,this.props.didLeave,this.state.mergedPropsStyles,e,this.state.currentStyles,this.state.currentVelocities,this.state.lastIdealStyles,this.state.lastIdealVelocities);for(let o=0;o<e.length;o++){const r=e[o].style;let l=!1;for(const e in r){if(!Object.prototype.hasOwnProperty.call(r,e))continue;const d=r[e];"number"==typeof d&&(l||(l=!0,s[o]={...s[o]},n[o]={...n[o]},i[o]={...i[o]},a[o]={...a[o]},t[o]={key:t[o].key,data:t[o].data,style:{...t[o].style}}),s[o][e]=d,n[o][e]=0,i[o][e]=d,a[o][e]=0,t[o].style[e]=d)}}this.setState({currentStyles:s,currentVelocities:n,mergedPropsStyles:t,lastIdealStyles:i,lastIdealVelocities:a})};startAnimationIfNecessary=()=>{if(this.unmounting||null!=this.animationID)return;const{requestAnimationFrame:e}=this.context;this.animationID=e((e=>{if(this.unmounting)return;const t=this.props.styles,s="function"==typeof t?t(a8(this.state.mergedPropsStyles,this.unreadPropStyles,this.state.lastIdealStyles)):t;if(function(e,t,s,n){if(n.length!==t.length)return!1;for(let e=0;e<n.length;e++)if(n[e].key!==t[e].key)return!1;for(let i=0;i<n.length;i++)if(!nF(e[i],t[i].style,s[i]))return!1;return!0}(this.state.currentStyles,s,this.state.currentVelocities,this.state.mergedPropsStyles))return this.animationID=null,void(this.accumulatedTime=0);const n=e||performance.now(),i=n-this.prevTime;if(this.prevTime=n,this.accumulatedTime=this.accumulatedTime+i,this.accumulatedTime>166.66666666666669&&(this.accumulatedTime=0),0===this.accumulatedTime)return this.animationID=null,void this.startAnimationIfNecessary();const a=(this.accumulatedTime-Math.floor(this.accumulatedTime/i8)*i8)/i8,o=Math.floor(this.accumulatedTime/i8),[r,l,d,c,h]=o8(this.props.willEnter,this.props.willLeave,this.props.didLeave,this.state.mergedPropsStyles,s,this.state.currentStyles,this.state.currentVelocities,this.state.lastIdealStyles,this.state.lastIdealVelocities);for(let e=0;e<r.length;e++){const t=r[e].style,s={},n={},i={},u={};for(const r in t){if(!Object.prototype.hasOwnProperty.call(t,r))continue;const l=t[r];if("number"==typeof l)s[r]=l,n[r]=0,i[r]=l,u[r]=0;else{let t=c[e][r],d=h[e][r];for(let e=0;e<o;e++)[t,d]=aF(.016666666666666666,t,d,l.val,l.stiffness,l.damping,l.precision);const[p,g]=aF(.016666666666666666,t,d,l.val,l.stiffness,l.damping,l.precision);s[r]=t+(p-t)*a,n[r]=d+(g-d)*a,i[r]=t,u[r]=d}}c[e]=i,h[e]=u,l[e]=s,d[e]=n}this.animationID=null,this.accumulatedTime-=o*i8,this.setState({currentStyles:l,currentVelocities:d,lastIdealStyles:c,lastIdealVelocities:h,mergedPropsStyles:r}),this.unreadPropStyles=null,this.startAnimationIfNecessary()}))};componentDidMount(){this.prevTime=performance.now(),this.startAnimationIfNecessary()}UNSAFE_componentWillReceiveProps(e){this.unreadPropStyles&&this.clearUnreadPropStyle(this.unreadPropStyles);const t=e.styles;this.unreadPropStyles="function"==typeof t?t(a8(this.state.mergedPropsStyles,this.unreadPropStyles,this.state.lastIdealStyles)):t,null==this.animationID&&(this.prevTime=performance.now(),this.startAnimationIfNecessary())}componentWillUnmount(){this.unmounting=!0,null!=this.animationID&&(this.context.cancelAnimationFrame(this.animationID),this.animationID=null)}render(){const e=a8(this.state.mergedPropsStyles,this.unreadPropStyles,this.state.currentStyles),t=this.props.children(e);return t&&Un.Children.only(t)}}class l8 extends Un.PureComponent{static contextType=oi.Z;trashButton=Un.createRef();state={trash:e5.Z.getTrash()};componentDidMount(){e5.Z.addListener(this.onTrashStoreChange),go.Z.addListener("COMMAND_SHOW_CLOSED_TABS",this._onCommandSpy)}componentWillUnmount(){e5.Z.removeListener(this.onTrashStoreChange),go.Z.removeListener("COMMAND_SHOW_CLOSED_TABS",this._onCommandSpy)}onTrashStoreChange=()=>{this.setState({trash:e5.Z.getTrash()})};emptyTrash=()=>{Ln.Z.emptyTrash()};undeleteTab=e=>{Ln.Z.undeleteTab(e.sessionId)};undeleteWindow=e=>{Ln.Z.undeleteWindow(e.sessionId)};undo=()=>{if(this.state.trash.length>0){const e=this.state.trash[0];e.tab?this.undeleteTab(e.tab):e.window&&this.undeleteWindow(e.window)}};_onCommandSpy=e=>{e===this.context.vivaldiWindowId&&this.trashButton.current&&this.trashButton.current.showMenu()};_getContextMenuPromise=()=>{const e=this.context.vivaldiWindowId,t=ei.Z.getOptionFunction("closedtab");return ei.Z.getNamedMenu(e,"closedtab",(async s=>"CONTEXT_CONTAINER_CLOSED_TAB"===s.action?{items:Ye.Z.getClosedTabContainer(),...t(e,s,{})}:{...t(e,s,{})}))};onDrop=e=>{const t=e.dataTransfer.getData(u.Up);if(t){e.preventDefault(),e.stopPropagation();const s=JSON.parse(t).ids.map((e=>parseInt(e))).map((e=>Ze.ZP.getPages(this.context.vivaldiWindowId).find((t=>t.id===e)))).filter(Boolean);c.ZP.closePage((0,qe.aV)(s))}};handleContextMenuVisibilityChanged=e=>{e||this.props.onMenuClosed?.()};render(){return(0,zn.jsx)(oa.ZP,{ref:this.trashButton,name:"MailMsgTrash",className:Gn()("toggle-trash",{hidden:this.props.hidden}),onDrop:this.onDrop,onDragEnter:nr.Z,onContextMenuVisibilityChanged:this.handleContextMenuVisibilityChanged,image:Kn.nre.large,onMiddleClick:this.undo,menu:this._getContextMenuPromise,menuOrigin:"bottomLeft",mimeType:u.Up,edgeAmount:0,label:(0,W.Z)("Closed Tabs"),tooltip:(0,W.Z)("Show Closed Tabs"),tooltipExtra:(0,W.Z)("$1-click to reopen last closed tab",[(0,W.Z)("key","Shift")]),commandId:"COMMAND_SHOW_CLOSED_TABS"})}}const d8=l8;var c8=s(10695),h8=s.n(c8),u8=s(34155);function p8({accordionIsOpen:e,draggedActive:t,droppedTabs:s,isSubstrip:i,isTabStackingEnabled:a,maybeResetDragging:o,tabStackingMode:r,allTabs:l,substripTabs:d,yieldAfter:h,yieldBefore:u,yieldOver:p,windowId:g}){const m=JSON.parse(s),f=m.ids.map((e=>parseInt(e))).sort(((e,t)=>e-t)),v=(0,qe.aV)(l).filter((e=>f.some((t=>e.id===t)))).map(l5.OK),b=p?Ze.ZP.getPages(g).find((e=>e.id===p&&!e.pinned)):void 0;if(b){let e=(0,hg.av)(b);const s=a&&Ze.ZP.isGroup(e,g),n=b.windowId===v.first().windowId;let i,r,l;if(s){const t=Ze.ZP.getGroup(e,g);i=t.first().index,l=t.first().vivExtData.fixedGroupTitle,r=Ze.ZP.getGroup(e,g).concat(v)}else{i=b.index,r=qe.aV.of(b).concat(v),e=Ze.ZP.getNewGroupId();const s=t&&(0,hg.av)(t);s&&Ze.ZP.isGroup(s,g)&&(l=t?t.vivExtData.fixedGroupTitle??"":"")}const d=()=>c.ZP.createTabStack(r,i,e).then((()=>{e&&l&&c.ZP.setFixedStackTitle(g,e,l)}));if(n){const e=v.reduce(((e,t)=>t.index<i?e+1:e),0);i-=e,d()}else{const e=Ze.ZP.getActiveWorkspace(b.windowId);c.ZP.moveToWorkspace(v,e).then(d)}o()}else{const t=()=>u8.nextTick(o),s=m.active,n=function(e,t,s,n,i,a,o,r){const l=Ze.ZP.getPages(r);if("number"==typeof o){const e=l.find((e=>e.id===o));return e?e.index:-1}const d=l.find((e=>e.id===i||e.id===a));if(!d)return-1;const c=(0,hg.av)(d);let h;if(s&&Ze.ZP.isGroup(c,r))if("accordion"===n&&e(c))h=d.id;else{const e=Ze.ZP.getGroup(c,r);if(h="number"==typeof i?e.first().id:e.last().id,h===t)return l.findIndex((e=>e.id===h))}else h=d.id;return l.filter((e=>e.id!==t)).findIndex((e=>e.id===h))+("number"==typeof a?1:0)}(e,f[0],a,r,u,h,p,g);if(i)if(1===d.size)c.ZP.createTabStack(d.map((e=>e.page)).concat(v),n,Ze.ZP.getNewGroupId());else{const e=(0,hg.av)(d.first()?.page);e&&c.ZP.moveDroppedTabs(g,v,s,n,e).then(t)}else if("accordion"===r){const i=l.map(l5.OK).map((e=>(0,hg.av)(e)??"")),a=(0,qe.aV)(i).countBy((e=>e)),o=v.reduce(((e,t)=>e.add((0,hg.av)(t)??"")),new qe.l4),r=m.sourceWindow===g,d=i[n]??"",h=i[n+(n<m.activeIndex?-1:1)]??"";let u;u=r?d&&e(d)&&h===d?d:1===o.size&&a.get(o.first())===v.size?void 0:"":void 0,c.ZP.moveDroppedTabs(g,v,s,n,u).then(t)}else{const e="main"!==m.dragSource?"":void 0;c.ZP.moveDroppedTabs(g,v,s,n,e).then(t)}}n.Z.windows.update(g,{focused:!0})}var g8=s(74678),m8=s(42941),f8=s(37441);const v8=180,b8=150,C8=30,w8=32,y8={stiffness:400,damping:32,precision:.1},x8=W6();var I8=(0,zn.jsx)("hr",{}),A8=(0,zn.jsx)("span",{className:"dragspace"});class S8 extends Un.PureComponent{static contextType=oi.Z;currentHoveredId=0;#v;refTabStrip=Un.createRef();refTabs=new Map;#sn=!1;#nn;start=[0,0];delta=[0,0];isMouseOverScrollArrow=!1;enterSide="none";#in=!1;#an=!1;#on=null;#rn=null;#ln=null;state={isDragging:!1,draggedActive:null,draggedPages:(0,qe.aV)(),pageIdsHiddenForDrag:(0,qe.l4)(),freeze:null,animate:!1,highlightedId:"",isDraggingPinnedTab:!1,activeAlarms:new qe.l4,canScrollLeft:!1,canScrollRight:!1,mouse:[0,0],hoveredPageId:-1,awaitingEdit:void 0};componentDidMount(){this.setOverflowClass(),go.Z.addListener("COMMAND_FOCUS_TABBAR",this.onCommandSpy),go.Z.addListener("COMMAND_RENAME_TAB",this.onCommandSpy),go.Z.addListener("COMMAND_RENAME_TAB_STACK",this.onCommandSpy),go.Z.addListener("COMMAND_TAB_MOVE_FIRST",this.onCommandSpy),go.Z.addListener("COMMAND_TAB_MOVE_END",this.onCommandSpy),this.context.addEventListener("dragenter",this.windowDragEnterHandler),this.context.addEventListener("dragleave",this.windowDragLeaveHandler),this.context.addEventListener("dragover",this.windowDragOverHandler),this.context.addEventListener("drop",this.windowDropHandler),tt.Z.addListener(this._alarmsChanged),this.#v=!0}componentWillUnmount(){this.#v=!1,this.animateTimeoutId&&clearTimeout(this.animateTimeoutId),this.#nn&&URL.revokeObjectURL(this.#nn),go.Z.removeListener("COMMAND_FOCUS_TABBAR",this.onCommandSpy),go.Z.removeListener("COMMAND_RENAME_TAB",this.onCommandSpy),go.Z.removeListener("COMMAND_RENAME_TAB_STACK",this.onCommandSpy),go.Z.removeListener("COMMAND_TAB_MOVE_FIRST",this.onCommandSpy),go.Z.removeListener("COMMAND_TAB_MOVE_END",this.onCommandSpy),this.context.removeEventListener("dragenter",this.windowDragEnterHandler),this.context.removeEventListener("dragleave",this.windowDragLeaveHandler),this.context.removeEventListener("dragover",this.windowDragOverHandler),this.context.removeEventListener("drop",this.windowDropHandler),tt.Z.removeListener(this._alarmsChanged)}componentDidUpdate(e,t){this.props.tabs===e.tabs&&this.props.maxWidth===e.maxWidth&&this.props.maxHeight===e.maxHeight||this.context.requestAnimationFrame((()=>{this.setOverflowClass(),this.updateScrollStatus()})),this.props.pages!==e.pages&&(this.maybeResetDragging(),this.props.pages.size>e.pages.size&&this.state.freeze&&this.setState({freeze:null})),this.state.freeze&&this.props.openAccordions?.length!==e.openAccordions?.length&&this.cleanUpFreezeHandler(),this.props.maxWidth!==e.maxWidth&&(this.props.maxWidth<=0&&(clearTimeout(this.animateTimeoutId),this.setState({animate:!1})),e.maxWidth<=0&&this.props.maxWidth>0&&this.allowDelayedAnimation())}_alarmsChanged=e=>{e&&this.setState((t=>{const s=e.map((e=>e?.id||""));return{activeAlarms:t.activeAlarms.union(s)}}))};isTabStackingEnabled=()=>!this.props.isSubstrip&&"off"!==this.props.prefValues[Z.kTabsStackingMode];setOverflowClass=()=>{if("left"===this.props.tabPosition||"right"===this.props.tabPosition){const{Element:e}=this.context,t=this.refTabStrip.current;if(t instanceof e&&t.clientHeight<t.scrollHeight){if(this.props.setOverflowClass(!0,this.props.isSubstrip),this.props.switchByScroll){const e=t.querySelector(".tab.active");e&&e.scrollIntoViewIfNeeded()}}else this.props.setOverflowClass(!1,this.props.isSubstrip)}};maybeSpring=(e,t)=>this.state.animate&&this.props.prefValues[Z.kThemeUseAnimation]&&!this.props.isResizing&&this.fitsInView()?uF(e,t):e;fitsInView=()=>"row"===this.props.direction?this.props.tabs.size*C8<this.props.maxWidth:this.props.tabs.size*C8<this.props.maxHeight;allowDelayedAnimation(){this.state.animate||(this.animateTimeoutId=setTimeout((()=>{this.setState({animate:!0})}),1e3))}setAwaitingEdit=e=>{this.setState({awaitingEdit:e})};onCommandSpy=(e,t)=>{if(e===this.context.vivaldiWindowId)switch(t){case"COMMAND_FOCUS_TABBAR":(0,vo.sT)(this.context.document,this.refTabStrip.current)||this.moveFocus("","current",!0);break;case"COMMAND_RENAME_TAB":{const t=Ze.ZP.getActivePage(e);t&&this.setAwaitingEdit(t.id);break}case"COMMAND_RENAME_TAB_STACK":{const t=Ze.ZP.getActivePage(e);if(t){const e=(0,hg.av)(t);e&&this.setAwaitingEdit(e)}break}case"COMMAND_TAB_MOVE_FIRST":c.ZP.stepTabsToStart(e);break;case"COMMAND_TAB_MOVE_END":c.ZP.stepTabsToEnd(e)}};accordionIsOpen=e=>Boolean(e&&this.props.openAccordions?.some((t=>t.groupId===e)));getNewTabButtonId(){return"newtab-"+(this.props.isSubstrip?"sub":"main")}moveFocus=(e,t,s)=>{const{document:n,HTMLElement:i}=this.context;if(!0===s||(0,vo.sT)(n,this.refTabStrip.current)){let s=[];const n=this.refTabStrip.current;if(n instanceof i&&(s=Array.from(n.querySelectorAll(".tab-wrapper")).map((e=>e.dataset.id)).filter(Boolean)),0===s.length)return;if("current"===t){if(""===e&&n instanceof i){const t=n.querySelector(".tab-wrapper.active");t instanceof i&&(e=t.dataset.id)}const t=s.indexOf(e);if(-1===t)return;e=s[t]}else if("right"===t||"left"===t){if(1===s.length)return;let n=s.indexOf(e);if(-1===n)return;n="right"===t?n+1>=s.length?0:n+1:n<=0?s.length-1:n-1,e=s[n]}if(n instanceof i){const t=e===this.getNewTabButtonId()?n.querySelector("div.toolbar-tabbar button"):n.querySelector(`div.tab-wrapper[data-id="${e}"]`);t&&(t.focus(),this.setState({highlightedId:String(e)}))}}};openStackMenu=(e,t)=>{if(this.isTabStackingEnabled()){const s=Ze.ZP.getPageById(e);if(s){const e=(0,hg.av)(s);if(Ze.ZP.isGroup(e,this.context.vivaldiWindowId)){const s=Ze.ZP.getGroup(e,this.context.vivaldiWindowId).toArray().map(((e,t)=>({url:e.url,handler:()=>c.ZP.activateTab(e.id,this.context.vivaldiWindowId),...st.Z.makeNumberMnemonic(e.title,t)}))),n="top"===this.props.tabPosition||"bottom"===this.props.tabPosition?"bottomLeft":"left"===this.props.tabPosition?"topRight":"topLeft";(0,mi.Z)(this.context,s,void 0,n,t)()}}}};handleLeaveBar=()=>{this.setState({highlightedId:""});const e=this.context.vivaldiWindowId;ue.Z.setPaneFocus(e,!1),ae.Z.executeActions("event",this.context,"COMMAND_FOCUS_WEBVIEW")};closeAndFreeze=e=>{const t=this.props.prefValues[Z.kTabsClosePinnedInStack],s=(0,c.nq)(e)?e:qe.aV.of(e),n="on"===this.props.prefValues[Z.kTabsClosePinned]?s:s.filter((e=>!e.pinned||(0,hg.av)(e)&&t));if(0!==n.size){if(1===n.size){const e=n.first();!e.pinned&&this.props.prefValues[Z.kTabsAlignNext]&&this.freezeTabSize(e)}this.setState({animate:!1},(()=>{this.props.closePage(n).then((()=>{this.allowDelayedAnimation()}))}))}};getTabStripWidth=()=>{const e=this.props.prefValues[Z.kTabsShowSyncedTabsButton];if("row"===this.props.direction){const t=Number(e)+Number(this.props.showTrashCan);return t>0?this.props.maxWidth-w8*t:this.props.maxWidth-8}return this.props.maxWidth};freezeTabSize=e=>{const t=e=>{const t=this.createFlexBoxLayout(this.props.tabs,this.props.direction,this.getTabStripWidth(),this.props.maxHeight,{pageIdsHiddenForDrag:this.state.pageIdsHiddenForDrag,freeze:this.state.freeze,yieldBefore:this.#on,yieldAfter:this.#rn,tabStackingEnabled:this.isTabStackingEnabled(),isThumb:this.props.prefValues[Z.kTabsThumbnails]}).children.map((e=>"tab"===e.type?e:void 0)).filter(Boolean),s=t.findIndex((t=>t.page.id===e)),n=t[s];if(n){let e;e=n.page.active?t[s+1]:n;const i=e.page.id;i&&this.setState({freeze:{width:e.layout?.width||this.props.maxWidth,height:n.layout?.height||this.props.maxHeight,nextId:i}}),this.context.addEventListener("mousemove",this.detectFinishFreezeHandler)}},s=this.props.tabs.getIn([-1,"page","id"]);e.id!==s?t(e.id):this.cleanUpFreezeHandler()};cleanUpFreezeHandler=()=>{this.setState({freeze:null}),this.context.removeEventListener("mousemove",this.detectFinishFreezeHandler)};detectFinishFreezeHandler=e=>{const{Element:t}=this.context,s=this.refTabStrip.current;if(s instanceof t){const t=s.getBoundingClientRect();(t.left>e.clientX||t.left+t.width<e.clientX||t.top>e.clientY||t.top+t.height<e.clientY)&&this.cleanUpFreezeHandler()}};handleTouchMove=e=>{e.preventDefault(),this.maybeStartDragging(e.touches[0])};handleMouseMove=e=>{e.preventDefault(),e.button===ai.Z.kLeft?this.maybeStartDragging(e):this.endInternalDragging()};handleMouseUp=e=>{this.endInternalDragging()};handleAccordionToggle=(e,t)=>{e&&(t?this.setState({animate:!1},(()=>{this.props.handleCompressAccordion?.(e),this.allowDelayedAnimation()})):this.props.handleExpandAccordion?.(e))};handleClick=(e,t)=>{const{prefValues:s,isSubstrip:n}=this.props,i=fe.ZP.isActive(this.context.vivaldiWindowId);if(M6(t,s[Z.kTabsSelectionEnabled],i))c.ZP.setSelection(e,{multiSelect:!1,addGroup:!1});else if(D6(t,s[Z.kTabsSelectionEnabled],i)){let t=!1;if("accordion"===this.props.prefValues[Z.kTabsStackingMode]){const s=Ze.ZP.unsafeGetActivePage(this.context.vivaldiWindowId),n=s&&(0,hg.av)(s);if(n&&!this.props.openAccordions?.find((e=>e.groupId===n)))t=!0;else{const s=Ze.ZP.getSelectedPages(this.context.vivaldiWindowId),n=e?(0,hg.av)(e):null;n&&!this.props.openAccordions?.find((e=>e.groupId===n))&&s.some((e=>n!==(0,hg.av)(e)))&&(t=!0)}}else t=!n;c.ZP.setSelection(e,{multiSelect:!0,addGroup:t})}};handleMouseUpGuard=e=>{e.button===ai.Z.kCenter&&(e.preventDefault(),e.stopPropagation())};handleAuxClick=(e,t)=>{t.button===ai.Z.kCenter&&(this.closeAndFreeze(e),t.preventDefault(),t.stopPropagation())};handleMouseDown=(e,t,s,n)=>{const i=n.detail%2==0;if(n.button===ai.Z.kLeft&&!i){n.preventDefault();fe.ZP.isActive(this.context.vivaldiWindowId);(0,vi.Z)(n)||(this.props.onActivateTab(e),this.initDragging(n,e,t,s))}};handleDoubleClick=(e,t)=>{t.preventDefault(),t.stopPropagation();const{prefValues:s}=this.props,n=fe.ZP.isActive(this.context.vivaldiWindowId);M6(t,s[Z.kTabsSelectionEnabled],n)?c.ZP.toggleRelatedSelection(e):"close"===s[Z.kTabsDoubleClick]?c.ZP.closePage(e):"accordion"===s[Z.kTabsStackingMode]&&this.props.toggleAutoExpandAccordion?.((0,hg.av)(e))};handleTouchStart=(e,t,s,n)=>{this.initDragging(n.touches[0],e,t,s)};onDragEnterHandler=e=>{if(e.dataTransfer.types.some((e=>e===u.Up))&&this.props.isExpectingDrop)return e.preventDefault(),void e.stopPropagation();e.dataTransfer.types.some((e=>Jn.ZP.isUriListType(e)||q1.Z.isSessionType(e)||"text/plain"===e))&&(e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="copy")};onDragLeaveHandler=()=>{clearTimeout(this.removeYieldTimeoutId),this.removeYieldTimeoutId=setTimeout((()=>{this.#v&&(this.#rn=null,this.#on=null,this.#ln=null,this.setState({hoveredPageId:void 0}),clearTimeout(this.removeYieldAnimationTimeoutId),this.removeYieldAnimationTimeoutId=setTimeout((()=>{this.#on||this.#rn||!this.#v||(this.#an=!1)}),2e3))}),200)};onDragOverHandler=e=>{if(clearTimeout(this.removeYieldTimeoutId),e.dataTransfer.types.some((e=>e===u.Up))&&this.props.isExpectingDrop){e.preventDefault(),e.stopPropagation();const t=300;this.removeYieldTimeoutId=setTimeout((()=>{this.#v&&(this.#rn=null,this.#on=null)}),t)}else e.dataTransfer.types.some((e=>Jn.ZP.isUriListType(e)||"text/plain"===e))&&(e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="copy")};onDropHandler=e=>{e.preventDefault(),e.stopPropagation();const t=this.context.vivaldiWindowId,s=e.dataTransfer.getData(u.Up);if(this.props.isExpectingDrop&&s)return void this.droppedTabHandler(s);const n=Jn.ZP.extractUriListFromEvent(e);if(n){const e="directrightofcurrent"===this.props.prefValues[Z.kTabsNewPlacement];let s=0;const i=n.split("\n");return e&&(i.reverse(),s=i.length-1),void i.forEach(((e,n)=>c.ZP.openURL(t,e,{inCurrent:!1,inBackground:s!==n,groupId:this.props.isSubstrip?this.props.activeGroupId:void 0})))}const i=q1.Z.getSessionData(e);if(i.length>0)return void gn.Z.open(t,i,!1);const a=e.dataTransfer.getData("text/plain");a&&Fg.Z.go(t,a,{inCurrent:!1,enableSearch:this.props.prefValues[Z.kAddressBarInlineSearchEnabled],groupId:this.props.isSubstrip?this.props.activeGroupId:void 0})};droppedTabHandler=e=>{n.Z.tabs.query({},(t=>{this.setState({animate:!1},(()=>{p8({accordionIsOpen:this.accordionIsOpen,draggedActive:this.state.draggedActive,droppedTabs:e,isSubstrip:this.props.isSubstrip,isTabStackingEnabled:this.isTabStackingEnabled(),maybeResetDragging:this.maybeResetDragging,tabStackingMode:this.props.prefValues[Z.kTabsStackingMode],allTabs:t,substripTabs:this.props.tabs,yieldAfter:this.#rn,yieldBefore:this.#on,yieldOver:this.#ln,windowId:this.context.vivaldiWindowId}),this.allowDelayedAnimation()}))}))};showSubStack=(0,Te.Z)((e=>this.props.showSubStack?.(e)),100);handleTabPosition=(e,t)=>{clearTimeout(this.removeYieldTimeoutId);const s=this.#ln;"before"===t?(this.#an=!0,this.#on=e,this.#rn=null,this.#ln=null):"after"===t?(this.#an=!0,this.#on=null,this.#rn=e,this.#ln=null):"over"===t?(this.#an=!1,this.#ln=e,this.#on=null,this.#rn=null,this.props.isSubstrip||this.showSubStack(e)):"none"===t&&(this.#on=null,this.#rn=null,this.#ln=null,clearTimeout(this.expireYieldTimeoutId),this.expireYieldTimeoutId=setTimeout((()=>{this.#v&&(this.#on||this.#rn||this.#ln||(this.#an=!1))}),1e3)),this.#ln&&this.#ln!==s&&SX.click(),this.forceUpdate()};setPageIdsHiddenForDrag=e=>{this.setState({pageIdsHiddenForDrag:e})};windowDragEnterHandler=e=>{e.dataTransfer&&e.dataTransfer.types.some((e=>e===u.Up))&&(e.preventDefault(),e.stopPropagation(),this.windowDragOverHandler(e))};windowDragLeaveHandler=e=>{if(e.dataTransfer&&e.dataTransfer.types.some((e=>e===u.Up))){e.preventDefault(),e.stopPropagation();0===e.pageX&&0===e.pageY&&this.handleTabPosition(-1,"none")}};windowDragOverHandler=e=>{if(e.dataTransfer&&e.dataTransfer.types.some((e=>e===u.Up))&&(e.preventDefault(),e.stopPropagation(),this.delayedActivateWindow(e),!this.#ln&&!this.#on&&!this.#rn)){const e=this.state.pageIdsHiddenForDrag.first();if(e?!this.props.pages.some((t=>t.id===e)):this.props.isExpectingDrop){const e=this.props.pages.getIn([-1,"id"]);e&&this.handleTabPosition(e,"after")}}};windowDropHandler=e=>{const{dataTransfer:t}=e;if(t&&t.types.some((e=>e===u.Up))){e.preventDefault(),e.stopPropagation();const s=t.getData(u.Up),i=JSON.parse(s),a=i.ids.map((e=>parseInt(e))).sort(((e,t)=>e-t));n.Z.tabs.query({},(t=>{if(t.find((e=>a.includes(e.id)&&e.windowId!==this.context.vivaldiWindowId))){const e=(0,qe.aV)(t).filter((e=>a.some((t=>e.id===t)))).map(l5.OK);c.ZP.moveDroppedTabs(this.context.vivaldiWindowId,e,i.active,-1,void 0)}else{const t=Ze.ZP.getPages(this.context.vivaldiWindowId),s=a.map((e=>t.find((t=>t.id===parseInt(e))))).filter(Boolean);if(s.length===t.size)return void this.maybeResetDragging();s.length?c.ZP.detachPage((0,qe.aV)(s),e.screenX,e.screenY):(this.maybeResetDragging(),console.warn("Dropped Page(s) does not exist:",a))}}))}};delayedActivateWindow({screenX:e,screenY:t}){x8(e,t,250,(()=>n.Z.windows.update(this.context.vivaldiWindowId,{focused:!0})))}maybeResetDragging=()=>{if(!this.#v)return;const{pageIdsHiddenForDrag:e}=this.state;(!e.isEmpty()||this.#an||this.#ln)&&(this.#an=!1,this.#on=null,this.#rn=null,this.#ln=null,this.setState({pageIdsHiddenForDrag:(0,qe.l4)(),isDragging:!1,hoveredPageId:void 0}))};handleEscKey=()=>{this.abortAndRevertDragging()};abortAndRevertDragging=()=>{this.state.draggedPages.forEach((e=>c.ZP.moveToIndex(e.windowId,e,e.index))),setTimeout((()=>{this.cleanupDragging(),this.maybeResetDragging()}),500)};initDragging=({pageX:e,pageY:t},s,n,i)=>{let a;this.context.addEventListener("touchmove",this.handleTouchMove,!0),this.context.addEventListener("mousemove",this.handleMouseMove,!0),this.context.addEventListener("touchend",this.handleMouseUp,!0),this.context.addEventListener("mouseup",this.handleMouseUp,!0),ai.Z.setWebviewPointerEvents(!1,this.context.document),Qe.Z.bind("esc",this.handleEscKey);const{isSelecting:o,isSubstrip:r}=this.props,l=this.props.getSelectedPages(),d=(0,hg.av)(s),c=this.isTabStackingEnabled()&&Ze.ZP.isGroup(d,this.context.vivaldiWindowId),h=o&&l.some((e=>e.id===s.id)),u=this.props.prefValues[Z.kTabsStackingMode];a=h?l:c&&("dotted"===u||"substrip"===u&&!r||"accordion"===u&&!this.accordionIsOpen(d))?Ze.ZP.getGroup(d,this.context.vivaldiWindowId):qe.aV.of(s),this.start=[e,t],this.delta=[e-n,t-i],this.#on=null,this.#rn=null,this.setState({draggedActive:s,draggedPages:a,isDragging:!1,mouse:[n,i]})};maybeStartDragging=e=>{let{isDragging:t}=this.state;const{tabs:s,direction:n,maxHeight:i,prefValues:a}=this.props,{pageX:o,pageY:r}=e,[l,d]=this.start;if(!t){if(!(Math.abs(l-o)>5||Math.abs(d-r)>5))return;t=!0}const c=this.createFlexBoxLayout(s,n,this.getTabStripWidth(),i,{freeze:this.state.freeze,pageIdsHiddenForDrag:this.state.pageIdsHiddenForDrag,yieldBefore:this.#on,yieldAfter:this.#rn,tabStackingEnabled:this.isTabStackingEnabled(),isThumb:a[Z.kTabsThumbnails]}),h=this.props.tabs.find((e=>this.state.draggedActive?.id===e.page.id));if(!h)return;const u="group"===h.type?this.accordionIsOpen(h.id)?String(h.page.id):h.id:String(h.page.id),p={top:0,right:0,bottom:0,left:0,width:0,height:0},g=c.children?.find((e=>"tab"===e.type&&e.tabId===u))?.layout??p,[m,f]=this.delta;let[v,b]=[o-m,r-f];const C=c.children?.filter((e=>"tab"===e.type)),w=(0,g8.Z)(C).layout??p,y=(0,m8.Z)(C).layout??p;"column"===n&&(v+50<w.left||v-50>y.left)||"row"===n&&(b+50<w.top||b-50>y.top||this.isHorizontalScrollingEnabled()&&this.isMouseOverScrollArrow)?this.startDragging(h,0,0):(v="row"===n?v:g.left,b="column"===n?b:g.top,v=(0,kf.Z)(v,w.left-5,y.left+5),b=(0,kf.Z)(b,w.top-5,y.top+5),this.setState({mouse:[v,b],isDragging:t,isDraggingPinnedTab:h.page.pinned}),this.props.setIsInternalDragging?.(!0),this.detectInternalOverlap(h,g,c,n,v,b))};detectInternalOverlap=async(e,t,s,n,i,a)=>{if(this.#sn)return;const o="accordion"===this.props.prefValues[Z.kTabsStackingMode],r=o&&this.accordionIsOpen((0,hg.av)(e.page))?String(e.page.id):String(e.id),l=this.state.draggedPages.map((e=>String(e.id)));let d;for(let e=0;e<s.children?.length;e+=1){const o=s.children[e];if("tab"!==o.type)continue;const c=o.layout;if(o.tabId!==r&&c&&!l.find((e=>e===o.tabId))){let e;if("row"===n){const{width:s,left:n}=c,a=t.width-s,o=i+(t.left<n?s*H6:s*G6);e=o>n-a&&o<n+s}else{const{height:s,top:n}=c,i=a+(t.top<n?s*H6:s*G6);e=i>n&&i<n+s}if(e){d=o;break}}}if(d){const t=this.context.vivaldiWindowId,s=d.page;if(s){const n=this._getPagesFromDraggedSet(),i=(0,hg.av)(s);let a=s.index;if(!this.props.isSubstrip&&i&&!this.accordionIsOpen(i)&&Ze.ZP.isGroup(i,t)){const e=Ze.ZP.getGroup(i,t);a=a<n.first().index?e.first().index:e.last().index}const r=this.state.draggedPages.size>1;this.#sn=!0,!r&&o&&("string"==typeof i&&this.accordionIsOpen(i)?await(0,f8.V)(e.page.id,{group:i}):await(0,f8.V)(e.page.id,{group:void 0})),await c.ZP.moveToIndex(e.page.windowId,this.accordionIsOpen(i)?e.page:n,a),this.#sn=!1}}else{if(this.isTabStackingEnabled()&&this.props.prefValues[Z.kTabsStackingAllowDnd]){const e={...t,left:i,top:a},l=s.children??[];let d,c=0;for(let t=0;t<l.length;t+=1){const s=l[t],{type:n,layout:i}=s,a=o&&s.page&&this.accordionIsOpen((0,hg.av)(s.page));if(i&&"tab"===n&&s.tabId!==r&&!a){if(c=(h=i,u=e,Math.max(0,Math.min(h.left+h.width,u.left+u.width)-Math.max(h.left,u.left))*Math.max(0,Math.min(h.top+h.height,u.top+u.height)-Math.max(h.top,u.top)))/(i.width*i.height),c<G6&&c>H6){d=s;break}}}if(!d)return this.currentHoveredId=0,this.enterSide="none",this.setState({hoveredPageId:-1}),void(this.dragOverTimeoutId&&this.resetDragOver());if("tab"!==d.type&&"accordionToggle"!==d.type)return;const{layout:p,page:g}=d;if(!p||!g)return;const{left:m,width:f,top:v,height:b}=p;let C;C="row"===n?i<m+(t.left<m?f*H6:f*G6)?"before":"after":a<v+(t.top<v?b*H6:b*G6)?"before":"after";const w=this.enterSide,y=g.id;this.currentHoveredId!==y&&(this.enterSide=C),this.currentHoveredId=y??-1,"none"===w&&w!==C?this.startDragOverTimer(c):w!==C&&this.resetDragOver(),-1!==this.state.hoveredPageId&&this.state.hoveredPageId!==this.currentHoveredId&&(this.resetDragOver(),this.startDragOverTimer(c))}var h,u}};startDragOverTimer=e=>{const t=this.props.prefValues[Z.kTabsStackingDndDelay];clearTimeout(this.dragOverTimeoutId),this.dragOverTimeoutId=setTimeout((()=>{this.state.isDragging&&(SX.click(),this.setState({hoveredPageId:this.currentHoveredId}))}),t)};resetDragOver=()=>{clearTimeout(this.dragOverTimeoutId),delete this.dragOverTimeoutId,this.setState({hoveredPageId:-1})};_getPagesFromDraggedSet=()=>{const e=Ze.ZP.getPages(this.context.vivaldiWindowId);return this.state.draggedPages.reduce(((t,s)=>{const n=e.find((e=>e.id===s.id));return n?t.push(n):t}),(0,qe.aV)())};getDragImageData=(e,t,s)=>{this.#nn&&URL.revokeObjectURL(this.#nn);const{document:n,HTMLImageElement:i,HTMLSpanElement:a,devicePixelRatio:o}=this.context,r=lf.Z.getUIZoom(),l=n.createElement("canvas"),d=l.getContext("2d"),c=Math.floor((e?.width||180)*r),h=Math.floor(e?.height||27)*r;let u;return l.style.width=`${c}px`,l.style.height=`${h}px`,l.width=Math.floor(c),l.height=Math.floor(h),d.fillStyle=this.props.theme.colorBg,function(e,t,s,n){e.beginPath(),e.moveTo(n,0),e.lineTo(t-n,0),e.quadraticCurveTo(t,0,t,n),e.lineTo(t,s-n),e.quadraticCurveTo(t,s,t-n,s),e.lineTo(n,s),e.quadraticCurveTo(0,s,0,s-n),e.lineTo(0,n),e.quadraticCurveTo(0,0,n,0),e.closePath(),e.clip()}(d,c,h,this.props.theme.radius),d.fill(),d.fillStyle=this.props.theme.colorFg,d.font=12*r+"px system-ui",d.fillText(s,16*r+6*r+4*r,h/2+12*r/3),u=t instanceof i?new Promise(((e,s)=>{const n=new Image;n.crossOrigin="Anonymous",t.srcset?n.srcset=t.srcset:n.src=t.src,n.onload=()=>{const t=6*r/o,s=16*r/o;d.drawImage(n,t,t,s,s),e(d.getImageData(0,0,c,h))},n.onerror=t=>{console.warn(t),e()}})):t instanceof a?new Promise((e=>{this.#nn=URL.createObjectURL(new Blob([t.innerHTML],{type:"image/svg+xml"}));const s=new Image;s.onload=()=>{const t=6*r/o,n=16*r/o;d.drawImage(s,t,t,n,n),e(d.getImageData(0,0,c,h))},s.src=this.#nn})):Promise.resolve(),d.scale(o,o),{width:c,height:h,imageDataPromise:u}};messageDragging=e=>{fe.ZP.isIncognitoOrGuest(this.context.vivaldiWindowId)?this.props.setIsExpectingDrop(e):re.Z.utilities.broadcastMessage(e?{startDragging:!0}:{endDragging:!0})};createDropData=(e,t)=>JSON.stringify({ids:t.map((e=>e.id)).toJS(),active:e.id,activeIndex:e.index,dragSource:this.props.isSubstrip?"stack":"main",sourceWindow:this.context.vivaldiWindowId});startDragging=async(e,t,s)=>{const{Element:n,ClientRect:i}=this.context,{draggedPages:a}=this.state;this.cleanupDragging();const o=a.find((e=>e.active))||a.first();if(!(this.refTabStrip.current instanceof n))return;const r=this.refTabs.get(e.page.id)?.current;if(!r)return;const l=r.refTab.current,d=l instanceof n?l.getBoundingClientRect():void 0,c=(0,hg.av)(o),h=this.isTabStackingEnabled()&&Ze.ZP.isGroup(c,this.context.vivaldiWindowId)?4:0,p=r.refFavicon.current,g=vs.jk.getDisplayTitleByUrl(o.url,o.title),m=d?.left??0,f=(d?.top??0)-h,{width:v,height:b,imageDataPromise:C}=this.getDragImageData(d,p,g),w=await C;this.setState({isDragging:!0},(()=>{this.messageDragging(!0),this.setupDragEndHandler(a),re.Z.tabsPrivate.startDrag({windowId:this.context.vivaldiWindowId,mimeType:u.Up,customData:this.createDropData(o,a),imageData:w?.data.buffer,url:o.url,title:g,posX:m,posY:f,width:v,height:b,cursorX:t,cursorY:s}),this.setState({pageIdsHiddenForDrag:a.toSet().map((e=>e.id)),isDraggingPinnedTab:e.page.pinned})}))};endInternalDragging=()=>{const{vivaldiWindowId:e}=this.context,t=-1!==this.state.hoveredPageId&&Ze.ZP.getPages(e).find((e=>e.id===this.state.hoveredPageId));if(t){let s,n=this._getPagesFromDraggedSet();const i=(0,hg.av)(t);if(s=Ze.ZP.isGroup(i,e)?Ze.ZP.getGroup(i,e).sort(((e,t)=>e.index-t.index)):qe.aV.of(t),s.size>0&&n.size>0){const e=s.first().index,i=n.count((t=>t.index<e)),a=e-i;n=n.first().index<s.first().index?n.concat(s):s.concat(n),c.ZP.createTabStack(n,a,(0,hg.av)(t))}}this.cleanupDragging()};cleanupDragging=()=>{this.context.removeEventListener("touchmove",this.handleTouchMove,!0),this.context.removeEventListener("mousemove",this.handleMouseMove,!0),this.context.removeEventListener("touchend",this.handleMouseUp,!0),this.context.removeEventListener("mouseup",this.handleMouseUp,!0),ai.Z.setWebviewPointerEvents(!0,this.context.document),Qe.Z.unbind("esc",this.handleEscKey),!this.state.isDragging&&this.state.draggedActive?.active&&(this.state.draggedActive.pinned&&"bury"===this.props.prefValues[Z.kTabsClosePinned]||this.props.prefValues[Z.kTabsMinimize])&&c.ZP.minimizePage(this.context.vivaldiWindowId),this.props.setIsInternalDragging?.(!1),this.#v&&(this.start=[0,0],this.delta=[0,0],this.isMouseOverScrollArrow=!1,this.setState({isDragging:!1,isDraggingPinnedTab:!1,hoveredPageId:-1}))};setupDragEndHandler(e){const t=(s,n,i,a)=>{if(re.Z.tabsPrivate.onDragEnd.removeListener(t),this.messageDragging(!1),s)this.abortAndRevertDragging();else if(n){const t=this.context.vivaldiWindowId;if(e.size===Ze.ZP.getPages(t).size)return void this.maybeResetDragging();e.size&&c.ZP.detachPage(e,i,a)}else{const t=i-this.context.screenLeft,s=a-this.context.screenTop,{document:n}=this.context,o=n.elementFromPoint(t,s);o&&"WEBVIEW"===o.tagName&&e.size&&c.ZP.detachPage(e,i,a)}setTimeout((()=>this.maybeResetDragging()),100)};re.Z.tabsPrivate.onDragEnd.addListener(t)}clearForceHover=()=>{this.setState((e=>e.freeze?{freeze:{...e.freeze,nextId:-1}}:null))};getScrollTabWidth=e=>e/Math.round(e/v8);getTabStyle(e,t,s,n,i){const{prefValues:a,isSubstrip:o,maxHeight:r}=this.props,l=a[Z.kTabsStackingMode],d=(0,Si.mM)();if(e){let e;return e=s?C8+(d||1):a[Z.kTabsHorizontalScrolling]?this.scrollableAreaWidth?this.getScrollTabWidth(this.scrollableAreaWidth)-(n&&"accordion"===l?16:0):v8:t?parseInt(a[Z.kTabsActiveMinSize])||31:void 0,{flex:s?0:1,zIndex:0,maxWidth:s?31:v8,maxHeight:o?r-(d?2*d:2):r,minHeight:C8,minWidth:e}}{const e=this.props.overflow?(0,Si.np)():0;let t;return t=n&&("dotted"===l||"substrip"===l&&a[Z.kTabsStackingPreferDotted])?(i?90:37)+d:i&&!s?90+d:C8+(n&&"accordion"===l?0:d||1),{flex:s?0:1,zIndex:0,maxWidth:this.props.maxWidth-e-2*(d||1),maxHeight:i&&!s?b8:31,minHeight:t,minWidth:C8}}}createFlexBoxLayout=Ci()(((e,t,s,n,i)=>{const a=parseInt(this.props.prefValues[Z.kTabsActiveMinSize]),o="row"===t;let r=!this.props.isSubstrip&&e.first()?.page.pinned&&!o&&this.props.prefValues[Z.kTabsShowSeparator];const l=this.props.prefValues[Z.kTabsStackingMode],d="accordion"===l&&this.props.openAccordions&&this.props.openAccordions.length>0?e.flatMap((e=>{if("group"===e.type&&this.accordionIsOpen((0,hg.av)(e.page))){const t=e.pages.size,s=t-1;return e.pages.map(((e,n)=>({type:"accordionTab",page:e,id:e.id,isFirst:0===n,isLast:n===s,accordionSize:t})))}return[e]})):e,c={style:{flexDirection:t,width:s,height:n},children:[]};let h=0;for(let e=0;e<d.size;e++){const t=d.get(e);if(!t)continue;const u=(!this.props.isSubstrip||"substrip"!==l)&&t.page.pinned,p=t.page.active,g=i.tabStackingEnabled&&!this.props.isSubstrip&&"group"===t.type,m=this.getTabStyle(o,p,u,g,i.isThumb);if(i.freeze&&!u){const e=p&&i.freeze.width<a?a:i.freeze.width,t=i.freeze.height;m.width=m.maxWidth=m.minWidth=e,m.height=m.maxHeight=m.minHeight=t}const{isDragging:f,draggedPages:v,draggedActive:b}=this.state;f&&b&&b.id!==t.page.id&&v.some((e=>e.id===t.page.id))&&(m.width=m.maxWidth=m.minWidth=0,m.height=m.maxHeight=m.minHeight=0);const C=!g&&i.pageIdsHiddenForDrag.has(t.page.id),w=g&&"group"===t.type&&t.pages.every((e=>i.pageIdsHiddenForDrag.has(e.id)));(C||w)&&(o?m.width=m.maxWidth=m.minWidth=0:m.height=m.maxHeight=m.minHeight=0),r&&!u&&(h+=18,c.children.push({type:"separator",style:{...m,flex:0,maxHeight:18,minHeight:18,height:18}}),r=!1);if(i.yieldBefore===t.page.id){const e=this.getTabStyle(o,p,u,g,i.isThumb);h+=e.maxHeight||0,c.children.push({type:"blank",style:e})}const y="accordionTab"===t.type?t.accordionSize:0,x="accordionTab"===t.type&&t.isFirst,I="accordionTab"===t.type&&t.isLast,A="group"===t.type?t.pages:(0,qe.aV)();if(c.children.push({type:"tab",tabId:t.id.toString(),page:t.page,stackPages:A,style:m,isFirst:x,isLast:I,isStack:g,accordionSize:y}),h+=m.maxHeight||0,"accordion"===l&&!f&&(g||t.isLast)&&!C&&!w){const e=this.props.overflow?(0,Si.np)():0,i=(0,Si.mM)()>0?(0,Si.mM)():1,a=o?16+i:s-2*i-e,r=o?n+(1===i?1:0):16+i;h+=r,c.children.push({type:"accordionToggle",page:t.page,style:{width:a,height:r,alignSelf:o?"flex-end":"flex-start"}})}if(i.yieldAfter===t.page.id){const e=this.getTabStyle(o,p,u,g,i.isThumb);h+=e.maxHeight||0,c.children.push({type:"blank",style:e})}}const u=(o||h+C8<n)&&(!this.isHorizontalScrollingEnabled()||this.isHorizontalScrollingEnabled()&&!this.state.canScrollLeft&&!this.state.canScrollRight);return u&&(c.children=c.children.concat({type:"button",style:{width:C8,height:C8,alignSelf:o?"flex-end":"center"}})),this.#in=!u,h8()(c),c}));removeFromTabStack=e=>{if(this.props.isSelecting){const e=this.props.getSelectedPages();e.isEmpty()||c.ZP.removeFromTabStack(e)}else{const t=Ze.ZP.getPageById(e);t&&c.ZP.removeFromTabStack(t)}};getDraggedPages=e=>{const{isSelecting:t}=this.props,s=this.props.getSelectedPages();return t&&s.some((t=>t.id===e.id))?s.toArray():[e]};checkSelected=e=>this.props.getSelectedPages().some((t=>t.id===e));getStyles=()=>{const{direction:e,tabs:t}=this.props,s=this.props.prefValues[Z.kTabsThumbnails],n="row"===e,i=this.createFlexBoxLayout(t,e,this.getTabStripWidth(),this.props.maxHeight-(n?0:w8),{pageIdsHiddenForDrag:this.state.pageIdsHiddenForDrag,freeze:this.state.freeze,yieldBefore:this.#on,yieldAfter:this.#rn,tabStackingEnabled:this.isTabStackingEnabled(),isThumb:s}),a=[];for(let e=0;e<i.children.length;e++){const t=i.children[e],{layout:s}=t;if(s){if(isNaN(s.left)||isNaN(s.width)||isNaN(s.top)||isNaN(s.height)){0;const t=this.state.freeze?.width??v8;s.left=n?e*t:0,s.width=t,s.top=n?0:e*C8,s.height=C8}switch(t.type){case"tab":{const{tabId:e,page:i,isFirst:o,isLast:r,isStack:l,stackPages:d,accordionSize:c}=t;if(!e||!i)continue;a.push({key:e,data:{type:"tab",page:i,isFirst:o,isLast:r,isStack:l,stackPages:d,zIndex:o||i.active?2:1,accordionSize:c},style:{x:this.maybeSpring(s.left,y8),y:this.maybeSpring(s.top,y8),width:n?this.maybeSpring(s.width,y8):s.width,height:s.height}});break}case"blank":a.push({key:`space-${e}`,data:{type:"space"},style:{x:s.left,y:s.top,width:this.state.isDraggingPinnedTab&&n?31:s.width,height:s.height}});break;case"button":a.push({key:"button",data:{type:"button"},style:{x:s.left,y:n?0:s.top,width:s.width,height:s.height}});break;case"separator":a.push({key:"separator",data:{type:"separator"},style:{x:this.maybeSpring(s.left),y:this.maybeSpring(s.top),width:s.width,height:s.height}});break;case"accordionToggle":const i=n?1:0;a.push({key:`accordionToggle-${e}`,data:{type:"accordionToggle",page:t.page},style:{x:s.left-i,y:n?0:s.top,width:s.width+i,height:s.height}});break;default:console.warn("Unknown Element",t.type)}}}return a};getFavicon=Ci()(((e,t)=>vs.jk.getFaviconWithFallback(e,t)),{maxSize:50});getElementStyle=(e,t,s,n,i,a,o,r)=>{const l=r>0&&o?"fixed":void 0;return{"--PositionX":`${Math.floor(e)-r}px`,"--PositionY":`${Math.floor(t)}px`,"--Opacity":s,"--Height":`${Math.floor(n)}px`,"--Width":`${Math.floor(i)}px`,"--ZIndex":a,position:l}};setTabRef=(e,t)=>{if(t){const s=Un.createRef();s.current=t,this.refTabs.set(e,s)}else this.refTabs.delete(e)};getNewTabButtonStyle=Ci()(((e,t,s,n,i,a)=>({"--PositionX":`${e}px`,"--PositionY":`${t}px`,"--Opacity":s,"--Height":`${n}px`,"--Width":`${i}px`,"--ZIndex":a,left:`${e}px`,top:`${t}px`})));isHorizontalScrollingEnabled=()=>this.props.prefValues[Z.kTabsHorizontalScrolling]&&("top"===this.props.tabPosition||"bottom"===this.props.tabPosition);horizontalScroll=e=>{const t=(this.scrollableAreaWidth??this.props.maxWidth)*("left"===e?-1:1),s=this.refTabStrip.current,{HTMLElement:n}=this.context;s instanceof n&&s.scrollBy(t,0)};scrollRight=e=>{e.stopPropagation(),this.horizontalScroll("right")};scrollLeft=e=>{e.stopPropagation(),this.horizontalScroll("left")};updateScrollStatus=e=>{if(!this.isHorizontalScrollingEnabled())return;const{HTMLDivElement:t}=this.context,s=e??this.refTabStrip.current;if(s instanceof t){const{clientWidth:e,scrollWidth:t,scrollLeft:n}=s,i=s.getBoundingClientRect();this.scrollableAreaWidth=i.width,this.setState({canScrollLeft:n>0,canScrollRight:(n+e)/t<1})}};handleScroll=e=>{this.updateScrollStatus(e.currentTarget)};getOverflowMenu=()=>{const e=this.props.tabs.map((({page:e},t)=>{return{...st.Z.makeNumberMnemonic((s=vs.jk.getDisplayTitle(e),s.length>70?s.substring(0,70)+"...":s),t),url:e.url,handler:()=>this.props.onActivateTab(e)};var s})),t=ei.Z.getOptionFunction("taboverflow"),s=this.context.vivaldiWindowId;return ei.Z.getNamedMenu(s,"taboverflow",(async n=>"CONTEXT_CONTAINER_TAB_OVERFLOW"===n.action?{items:e.toArray(),...t(s,n,{})}:{...t(s,n,{})}))};handleWheel=e=>{if(e.deltaX||e.shiftKey||this.props.prefValues[Z.kMouseWheelTabSwitch]||!this.isHorizontalScrollingEnabled())return;const{Element:t}=this.context,s=(this.scrollableAreaWidth?this.getScrollTabWidth(this.scrollableAreaWidth):v8)*(e.deltaY<0?-2:2),n=this.refTabStrip.current;n instanceof t&&n.scrollBy({top:0,left:s,behavior:"smooth"})};setMouseIsOverScrollArrow=()=>{this.state.isDragging&&(this.isMouseOverScrollArrow=!0)};setMouseIsNotOverScrollArrow=()=>{this.state.isDragging&&(this.isMouseOverScrollArrow=!1)};toggleSubstripLock=()=>{I.Z.toggle(Z.kTabsStackingSubstripLocked,!0,!1)};render(){const e=this.props.prefValues[Z.kTabsShowSyncedTabsButton],t=this.props.prefValues[Z.kTabsStackingSubstripLocked],s=this.props.prefValues[Z.kTabsStackingMode],n=this.getStyles(),i=this.isHorizontalScrollingEnabled(),a=this.isTabStackingEnabled(),o={top:"below",bottom:"above",left:"after",right:"before"}[this.props.tabPosition];const r=this.props.prefValues[Z.kThemeUseAnimation]?150:0,l=Boolean(!this.props.prefValues[Z.kTabsTooltip]||!this.state.pageIdsHiddenForDrag.isEmpty()),d=(0,W.Z)("Hold to show open tabs"),c="row"===this.props.direction,{isDraggingPinnedTab:h}=this.state,p=i?this.props.pinnedWidth:0;return(0,zn.jsxs)(zn.Fragment,{children:[i&&(0,zn.jsx)("div",{className:"toolbar toolbar-tabbar",onMouseEnter:this.setMouseIsOverScrollArrow,onMouseOut:this.setMouseIsNotOverScrollArrow,children:(0,zn.jsx)(oa.ZP,{className:Gn()("horizontal-scroll-arrow",{disabled:!this.state.canScrollLeft}),style:{paddingRight:p},image:Kn.mgF.medium,onClick:this.scrollLeft,menu:this.getOverflowMenu,menuOrigin:"top"===this.props.tabPosition?"bottomLeft":"topLeft",mimeType:u.Up,edgeAmount:0,tooltip:(0,W.Z)("Scroll left"),tooltipExtra:d})}),(0,zn.jsx)(r8,{styles:n,children:e=>(0,zn.jsx)("div",{ref:this.refTabStrip,role:"tablist","aria-labelledby":this.props.isSubstrip?"tabbar-stack-label":"tabbar-toplevel-label","aria-orientation":"row"===this.props.direction?"horizontal":"vertical","aria-owns":this.props.tabs.map((e=>`tab-${e.id}`)).join(" "),className:Gn()("tab-strip",{"horizontal-scrolling":i,"horizontal-scrolling-smooth":i&&this.state.animate,overflow:this.props.overflow}),onDragEnter:this.onDragEnterHandler,onDragLeave:this.onDragLeaveHandler,onDragOver:this.onDragOverHandler,onDrop:this.onDropHandler,onDoubleClick:this.state.freeze?wi.UW:null,onContextMenu:e=>this.props.onContextMenu(e,this.props.isSubstrip),onWheel:this.handleWheel,onScroll:this.handleScroll,children:e.map(((t,n)=>{const i=t.data;if(i){if("tab"===i.type){const{page:d,stackPages:u=(0,qe.aV)(),isStack:g=!1,isFirst:m=!1,isLast:f=!1,accordionSize:v=0}=i,b=d.vivExtData.ext_id,C=d.url,w=this.props.prefValues[Z.kTabsShowCloseButton]&&Ze.ZP.canClosePage(d),y=(0,hg.av)(d)||"",x=this.state.pageIdsHiddenForDrag.has(d.id),I="accordion"===s&&v>1&&this.accordionIsOpen(y),A=!g&&x,S=g&&u.every((e=>this.state.pageIdsHiddenForDrag.has(e.id))),T=A||S||!fe.ZP.getVisibleUI(this.context.vivaldiWindowId).tabs,E=this.props.mediaState.get(d.id)||(0,qe.l4)(),k=Boolean(this.state.freeze?.nextId===d.id||this.props.prefValues[Z.kTabsCloseButtonPermanent]&&t.style.width>66),N=d.pinned&&!h||h&&!d.pinned?void 0:this.handleTabPosition,_=this.props.isSubstrip||I,P=d.active&&this.props.isSubstripVisible&&!this.props.isSubstrip?d.id+1e3:d.id;let M=0;if(I&&m){let t=0;for(let s=n;s<e.length;s++){const n=e[s],i=n.data;if(t===v)break;0===s&&"space"===i?.type||("tab"===i?.type&&(t+=1),M+=c?n.style.width:n.style.height)}if(M>0&&!this.state.isDragging){M+=16+(0,Si.mM)()}}const D=g&&a&&"substrip"===s&&!this.props.prefValues[Z.kTabsStackingPreferDotted]&&!this.props.isSubstrip,O=this.state.isDragging&&this.state.draggedActive?.id===d.id,[j,L]=this.state.mouse,R=O&&c&&!h?Math.max(j,this.props.pinnedWidth):t.style.x,B=!O||c||h?t.style.y:Math.max(L,this.props.pinnedWidth),F=this.getElementStyle(R,B,t.style.opacity,t.style.height,t.style.width,i.zIndex,!this.props.isSubstrip&&d.pinned,this.props.isSubstrip?0:p),W=g&&!this.props.isSubstrip&&!I&&!this.props.prefValues[Z.kTabsStackingPreferDotted]&&("substrip"===s||"accordion"===s);return(0,zn.jsx)(n8,{id:P,noPadding:this.props.isSubstripVisible&&!this.props.isSubstrip&&!this.props.prefValues[Z.kAppearanceDensity],disabled:l||O,pointerEvents:a&&g?"auto":"none",placement:o,appearDelay:200,transitionSpeed:r,disappearDelay:a?200:1,content:()=>this.props.getTooltipContent(P,_,d.discarded,d.memoryUsage),memoryUsage:d.memoryUsage,stackSize:u.size,children:(0,zn.jsx)("div",{className:Gn()("tab-position",{"is-substack":D,"is-pinned":d.pinned}),style:F,onMouseDown:this.handleMouseDown.bind(null,d,t.style.x,t.style.y),onMouseUp:this.handleMouseUpGuard,onAuxClick:this.handleAuxClick.bind(null,d),onClick:this.handleClick.bind(null,d),onDoubleClick:this.handleDoubleClick.bind(null,d),onTouchStart:this.handleTouchStart.bind(null,d,t.style.x,t.style.y),children:(0,zn.jsx)($6,{ref:e=>this.setTabRef(d.id,e),id:`tab-${t.key}`,pageId:d.id,url:C,active:d.active,acceptsDrop:d.id===this.#ln||d.id===this.state.hoveredPageId,discarded:d.discarded,incognito:d.incognito,pinned:d.pinned,isUnread:Ze.ZP.isUnread(d),groupId:y,tilingType:d.vivExtData.tiling?.type??"",tilingId:(0,hg.jA)(d)||"",extId:b,fixedTitle:g&&(0,hg.XN)(d)||d.vivExtData.fixedTitle,faviconUrl:this.getFavicon(C,d.favIconUrl),title:d.title,memoryUsage:d.memoryUsage,thumbnail:this.props.prefValues[Z.kTabsThumbnails]&&d.vivExtData.thumbnail,stackSize:u.size,isInsideAccordion:I,isFirstInGroup:m,isLastInGroup:f,isExpectingDrop:this.props.isExpectingDrop,isSelecting:this.props.isSelecting,selectionCount:this.props.getSelectedPages().size,isStack:g,isSubstrip:this.props.isSubstrip,isInternalPage:(0,Ar.to)(d.url),removeFromTabStack:this.removeFromTabStack,getDraggedPages:this.getDraggedPages,isSelected:this.checkSelected(d.id),checkSelected:this.checkSelected,isHiddenForDrag:x,isHidden:T,smallTab:t.style.width<=66,wideTab:t.style.width>=100,miniTab:t.style.width<=31,highlightId:a?d.id:void 0,direction:this.props.direction,prefValues:this.props.prefValues,tabPosition:this.props.tabPosition,addressBarVisible:this.props.addressBarVisible,highlighted:this.state.highlightedId===`tab-${t.key}`,forceHover:k,clearForceHover:this.clearForceHover,onMoveFocus:this.moveFocus,onStackMenu:this.openStackMenu,onLeaveBar:this.handleLeaveBar,setPageIdsHiddenForDrag:this.setPageIdsHiddenForDrag,closePage:this.closeAndFreeze,onActivate:this.props.onActivateTab,onDragLeave:this.onDragLeaveHandler,droppedTabHandler:this.droppedTabHandler,accordionFrameSize:M,handleTabPosition:N,shouldShowCloseButton:w,onCreateTab:this.props.onCreateTab,handleExpandAccordion:this.props.handleExpandAccordion,doMonitorAlarms:this.state.activeAlarms.has(b),shouldShowStackCounter:W,isDragging:this.state.isDragging,mediaState:E,dissolveTabStacks:this.props.dissolveTabStacks,awaitingEdit:this.state.awaitingEdit===d.id||this.state.awaitingEdit===y?this.state.awaitingEdit:void 0,setAwaitingEdit:this.setAwaitingEdit})})},t.key)}if("space"===i.type){const e=this.getElementStyle(t.style.x,t.style.y,t.style.opacity,t.style.height,t.style.width,0,!1,p);return(0,zn.jsx)("div",{className:Gn()({"tab-position":this.props.isSubstrip||!this.#ln,"tab-yield-space":this.props.isExpectingDrop&&(this.props.isSubstrip||!this.#ln)}),style:e,onDragEnter:this.onDragEnterHandler,onDragLeave:this.onDragLeaveHandler,onDragOver:this.onDragOverHandler,onDrop:this.onDropHandler},t.key)}if("separator"===i.type){const e=this.getElementStyle(t.style.x,t.style.y,t.style.opacity,t.style.height,t.style.width,0,!1,0);return(0,zn.jsx)("div",{className:"separator",style:e,children:I8},t.key)}if("accordionToggle"===i.type){const{page:e}=i,s=(0,hg.av)(e),n=this.accordionIsOpen(s),a=n?c?"left":"up":c?"right":"down",o=this.getElementStyle(t.style.x,t.style.y,t.style.opacity,t.style.height,t.style.width,0,e.pinned,p);return(0,zn.jsx)(h6,{orientation:a,isActive:e.active,style:o,onClick:()=>this.handleAccordionToggle(s,n),title:n?(0,W.Z)("Reduce Tab Stack"):(0,W.Z)("Expand Tab Stack")},t.key)}return"button"!==i.type||this.props.isSubstrip&&!this.props.isSubstripVisible?void 0:(0,zn.jsx)("div",{className:"toolbar toolbar-tabbar toolbar-large tab-position",children:(0,zn.jsx)(p6,{id:this.getNewTabButtonId(),style:this.getNewTabButtonStyle(t.style.x-p,this.props.isSubstrip&&"row"===this.props.direction?0:t.style.y,t.style.opacity,t.style.height,t.style.width,0),tabPosition:this.props.tabPosition,onCreateTab:this.props.onCreateTab,onMoveFocus:this.moveFocus,onLeaveBar:this.handleLeaveBar})},t.key)}}))})}),i&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("div",{onMouseEnter:this.setMouseIsOverScrollArrow,onMouseOut:this.setMouseIsNotOverScrollArrow,className:"toolbar toolbar-tabbar",children:(0,zn.jsx)(oa.ZP,{className:Gn()("horizontal-scroll-arrow",{disabled:!this.state.canScrollRight}),image:Kn.Zu.medium,onClick:this.scrollRight,menu:this.getOverflowMenu,menuOrigin:"top"===this.props.tabPosition?"bottomRight":"topRight",mimeType:u.Up,edgeAmount:0,tooltip:(0,W.Z)("Scroll right"),tooltipExtra:d})}),this.#in&&(0,zn.jsxs)("div",{className:"toolbar toolbar-tabbar",children:[(0,zn.jsx)(p6,{id:this.getNewTabButtonId(),tabPosition:this.props.tabPosition,onCreateTab:this.props.onCreateTab,onMoveFocus:this.moveFocus,onLeaveBar:this.handleLeaveBar}),A8]})]}),(0,zn.jsxs)("div",{className:Gn()("toolbar toolbar-tabbar",{"toolbar-large":this.props.isSubstrip,"subcontainer-lock":this.props.isSubstrip,"sync-and-trash-container":!this.props.isSubstrip,[this.props.tabPosition]:!0,narrow:!c&&!this.props.isSubstrip&&this.getTabStripWidth()<60}),children:[!c&&this.#in&&(0,zn.jsx)(p6,{id:this.props.isSubstrip?"newtab-sub":"newtab-main",tabPosition:this.props.tabPosition,onCreateTab:this.props.onCreateTab}),this.props.isSubstrip&&(0,zn.jsx)(oa.ZP,{onClick:this.toggleSubstripLock,menuOrigin:"bottomLeft",className:t?"tabs-locked":"tabs-unlocked",tooltip:t?(0,W.Z)("Unlock second tab level"):(0,W.Z)("Lock second tab level"),label:t?(0,W.Z)("Unlock Stack"):(0,W.Z)("Lock Stack"),image:t?Kn.zlZ.small:Kn.KuK.small}),!this.props.isSubstrip&&!fe.ZP.isIncognitoOrGuest(this.context.vivaldiWindowId)&&e&&(0,zn.jsx)(I6,{tabPosition:this.props.tabPosition}),!this.props.isSubstrip&&(0,zn.jsx)(d8,{hidden:!this.props.showTrashCan,onMenuClosed:this.props.handleTrashMenuClosed})]})]})}}const Z8=S8;function T8({page:e,discarded:t,memoryUsage:s,isMemoryUsageEnabled:n}){const i=vs.jk.getDisplayTitle(e);return(0,zn.jsxs)("span",{className:"thumbnail-text",children:[(0,zn.jsx)("strong",{className:"title",children:i.length>245?i.substring(0,240)+"...":i}),!vs.jk.isInternalUrl(e.url)&&(0,Ar.C3)(e.url)&&(0,zn.jsx)("span",{className:"url",children:(0,ve.Z)(e.url)?.hostname}),n&&(0,zn.jsxs)("span",{className:Gn()("info","size",{off:t}),children:[(0,zn.jsx)("span",{dangerouslySetInnerHTML:{__html:Kn.GqC}}),K6(s,t)]})]})}const E8=Un.memo(T8);var k8=s(5531),N8=s(34155);const _8=360,P8=340,M8=104,D8=[Z.kAddressBarInlineSearchEnabled,Z.kAddressBarShowProgress,Z.kAppearanceDensity,Z.kHoverCardMemoryUsageEnabled,Z.kKeyboardTabToAll,Z.kMediaRouterMediaRemotingEnabled,Z.kMouseWheelTabSwitch,Z.kPanelsPosition,Z.kTabsActiveMinSize,Z.kTabsAlignNext,Z.kTabsBarWidth,Z.kTabsCloseButtonPermanent,Z.kTabsClosePinned,Z.kTabsClosePinnedInStack,Z.kTabsCounterDetection,Z.kTabsCycleByRecentOrder,Z.kTabsDimHibernated,Z.kTabsDoubleClick,Z.kTabsBarHeight,Z.kTabsMinimize,Z.kTabsPageLoadInfo,Z.kTabsNeverCloseLast,Z.kTabsSelectionEnabled,Z.kTabsBarSliderXpos,Z.kTabsBarSliderYpos,Z.kTabsHorizontalScrolling,Z.kTabsShowCloseButton,Z.kTabsShowSeparator,Z.kTabsStackingAllowDnd,Z.kTabsStackingAllowRename,Z.kTabsStackingMode,Z.kTabsShowTrashCan,Z.kTabsShowSyncedTabsButton,Z.kTabsStackingOpenAccordions,Z.kTabsStackingSubstripLocked,Z.kTabsThumbnails,Z.kTabsTooltip,Z.kTabsUnread,Z.kTabsVisualSwitchEnable,Z.kTabsVisible,Z.kThemeUseAnimation,Z.kTabsStackingPreferDotted,Z.kTabsStackingAutoExpand,Z.kTabsStackingDndDelay,Z.kWorkspacesEnabled,Z.kWorkspacesButtonShowInTabbar,Z.kWorkspacesButtonShowName,Z.kTabsNewPlacement],O8=function(e,t,s,n){const i=(0,hg.av)(e)||"",a=i&&("substrip"===s||"accordion"===s)?Ze.ZP.getGroup(i,t).filter((e=>(0,hg.cm)(e)===n)).map(Ze.uU):(0,qe.aV)(),o="off"===s,r=Ze.ZP.getWorkspaceTabsInWindow(t,n,o);return{tabs:r,pages:Ze.ZP.getPages(t),activePageId:e.id,url:e.url,incognito:e.incognito,tilingId:(0,hg.jA)(e)??"",groupId:i,pinned:e.pinned,isSelecting:Ze.ZP.isSelecting(t),pageSelection:Ze.ZP.getSelection(t),stackTabs:a,pinnedWidth:j8(r),workspaceId:n,mediaState:mq.Z.getState()}};function j8(e){const t=e.findIndex((e=>!e.page.pinned)),s=A.Z.get(Z.kTabsStackingOpenAccordions),n="accordion"===A.Z.get(Z.kTabsStackingMode),i=(0,Si.mM)();let a=0;for(let o=0;o<t;o++){const t=e.get(o);if(!t)return a;a=a+("group"===t.type&&n&&s.includes(t.id)?t.pages.size:1)*(C8+(i||1))+("group"===t.type&&n?16:0)}return a}var L8=(0,zn.jsx)("div",{className:"separator separator-wsbutton",children:(0,zn.jsx)("hr",{})});class R8 extends Un.PureComponent{static contextType=oi.Z;#v;#dn=!1;visibleOnMount=this.props.visible;refMainBar=Un.createRef();refTabBarContainer=Un.createRef();#cn=!1;constructor(e,t){super(e);const s=t.vivaldiWindowId,n=Ze.ZP.unsafeGetActivePage(s),i=Ze.ZP.getActiveWorkspace(s),a=this.props.prefValues[Z.kTabsStackingOpenAccordions].map((e=>({groupId:e,auto:!1})));this.state={tabStripWidth:0,tabStripHeight:0,isResizing:!1,tabBarOverflow:!1,tabStripOverflow:!1,tabBarHeight:this.props.prefValues[Z.kTabsBarHeight],tabBarWidth:this.props.prefValues[Z.kTabsBarWidth],...O8(n,s,e.prefValues[Z.kTabsStackingMode],i),tabBarSliderYpos:this.props.prefValues[Z.kTabsBarSliderYpos],tabBarSliderXpos:this.props.prefValues[Z.kTabsBarSliderXpos],tabBarContainerWidth:0,isExpectingDrop:!1,openAccordions:a,isInternalDragging:!1,addressBarVisible:fe.ZP.getVisibleUI(s).addressBar,showTrashCan:e.prefValues[Z.kTabsShowTrashCan]}}componentDidUpdate(e,t){"top"!==this.props.tabPosition&&"bottom"!==this.props.tabPosition||!0!==this.props.prefValues[Z.kTabsThumbnails]||!1!==e.prefValues[Z.kTabsThumbnails]||this.setTabBarHeight(b8),t.openAccordions!==this.state.openAccordions&&I.Z.set(Z.kTabsStackingOpenAccordions,this.state.openAccordions.map((e=>e.groupId))),e.prefValues[Z.kTabsStackingMode]===this.props.prefValues[Z.kTabsStackingMode]&&e.prefValues[Z.kAppearanceDensity]===this.props.prefValues[Z.kAppearanceDensity]&&t.openAccordions===this.state.openAccordions||this._onPageStoreChange(),e.prefValues[Z.kTabsShowTrashCan]!==this.props.prefValues[Z.kTabsShowTrashCan]&&this.setState({showTrashCan:this.props.prefValues[Z.kTabsShowTrashCan]})}componentDidMount(){const{selectWindow:e}=this.context;re.Z.utilities.onBroadcastMessage.addListener(this.onBroadcastMessageReceived),Ze.ZP.addListener(this._onPageStoreChange,e),c6.addListener(this.onTabStoreChange),fe.ZP.addListener(this.onWindowStoreChanged,e),mq.Z.addListener(this._onMediaStateStoreChanged),go.Z.addListener("COMMAND_SAVE_SELECTED_SESSION",this._onCommandSpy),go.Z.addListener("COMMAND_BOOKMARK_SELECTED_TABS",this._onCommandSpy),go.Z.addListener("COMMAND_NEW_TAB",this._onCommandSpy),go.Z.addListener("COMMAND_SHOW_CLOSED_TABS",this._onCommandSpy),re.Z.tabsPrivate.onKeyboardChanged.addListener(this.handleKeyboardChange),this.updateDocumentTitleById(this.state.activePageId),this.#v=!0,this.context.addEventListener("resize",this.onWindowResize,!1),this.context.addEventListener("keydown",o6.i,!1),this.cleanUpOpenAccordions(),0===this.state.tabs.size&&N8.nextTick((()=>{this.createTab("keyboard")})),c.ZP.tryToUpdateTabResources(this.state.pages.map((e=>e.id)).toArray())}handleKeyboardChange=(e,t,s)=>{this.#dn=0!==s};componentWillUnmount(){re.Z.utilities.onBroadcastMessage.removeListener(this.onBroadcastMessageReceived),Ze.ZP.removeListener(this._onPageStoreChange),c6.removeListener(this.onTabStoreChange),fe.ZP.removeListener(this.onWindowStoreChanged),mq.Z.removeListener(this._onMediaStateStoreChanged),go.Z.removeListener("COMMAND_SAVE_SELECTED_SESSION",this._onCommandSpy),go.Z.removeListener("COMMAND_BOOKMARK_SELECTED_TABS",this._onCommandSpy),go.Z.removeListener("COMMAND_NEW_TAB",this._onCommandSpy),go.Z.removeListener("COMMAND_SHOW_CLOSED_TABS",this._onCommandSpy),re.Z.tabsPrivate.onKeyboardChanged.removeListener(this.handleKeyboardChange),this.#v=!1,this.context.removeEventListener("resize",this.onWindowResize,!1),this.context.removeEventListener("keydown",o6.i,!1),clearTimeout(this._resizingTimeout)}getMinimumTabSize=()=>C8+2*((0,Si.mM)()>0?(0,Si.mM)():1);updateDocumentTitleById=e=>{const t=Ze.ZP.getPageById(e);t&&this.updateDocumentTitle(t)};cleanUpOpenAccordions(){const e=this.state.pages.reduce(((e,t)=>{const s=(0,hg.av)(t);return s&&e.push(s),e}),[]),t=(0,k8.Z)(this.state.openAccordions,"groupId").filter((t=>e.includes(t.groupId)));t.length!==this.state.openAccordions.length&&this.setState((e=>({openAccordions:t})))}updateDocumentTitle=e=>{const t=vs.jk.getDisplayTitle(e);t!==this.context.document.title&&(this.context.document.title=t)};onWindowResize=()=>{clearTimeout(this._resizingTimeout),this.setState({isResizing:!0}),this._resizingTimeout=setTimeout((()=>{this.setState({isResizing:!1})}),1e3)};setIsExpectingDrop=(e,t)=>{this.setState({isExpectingDrop:e},t)};closePage=async e=>{this.#cn=!0,await c.ZP.closePage(e),this.#cn=!1,await this._onPageStoreChange(),this.handleClosePageAccordion(e)};handleClosePageAccordion=e=>{if(this.#cn||this.props.prefValues[Z.kTabsStackingAutoExpand]||"accordion"!==this.props.prefValues[Z.kTabsStackingMode])return;const t=(0,c.nq)(e)?e:qe.aV.of(e);0!==t.size&&t.some((e=>{if(e.active){const t=(0,hg.av)(e);return t&&1===this.state.pages.count((e=>(0,hg.av)(e)===t))&&this.handleCompressAccordion(t),!0}}))};onBroadcastMessageReceived=e=>{e.startDragging?this.setIsExpectingDrop(!0):e.endDragging&&this.setIsExpectingDrop(!1,(()=>{this._onPageStoreChange()}))};_onMediaStateStoreChanged=()=>{this.setState({mediaState:mq.Z.getState()})};setTabBarWidth=(e,t=!0)=>{this.setState({tabBarWidth:e},(()=>t&&I.Z.set(Z.kTabsBarWidth,Math.round(e))))};setTabBarHeight=(e,t=!0)=>{this.setState({tabBarHeight:e},(()=>t&&I.Z.set(Z.kTabsBarHeight,Math.round(e))))};setInnerTabBarWidth=(e,t=!0)=>{this.setState({tabBarSliderXpos:e},(()=>t&&I.Z.set(Z.kTabsBarSliderXpos,Math.round(e))))};setInnerTabBarHeight=(e,t=!0)=>{this.setState({tabBarSliderYpos:e},(()=>t&&I.Z.set(Z.kTabsBarSliderYpos,Math.round(e))))};_onPageStoreChange=()=>{if(this.#cn||this.state.isExpectingDrop)return;const e=this.context.vivaldiWindowId,t=Ze.ZP.unsafeGetActivePage(e),s=Ze.ZP.getActiveWorkspace(e);this.updateDocumentTitle(t),this.setState((n=>({...O8(t,e,this.props.prefValues[Z.kTabsStackingMode],s),openAccordions:this.updateAccordionStatus(n,t)})))};updateAccordionStatus=(e,t)=>{const s=t.id!==this.state.activePageId,n=(0,hg.av)(t);return!s&&n===this.state.groupId||!this.props.prefValues[Z.kTabsStackingAutoExpand]||"accordion"!==this.props.prefValues[Z.kTabsStackingMode]?e.openAccordions:(0,C.Uy)(e.openAccordions,(e=>{const t=e.findIndex((e=>e.auto));-1!==t&&e.splice(t,1),n&&!e.some((e=>e.groupId===n))&&e.push({groupId:n,auto:!0})}))};dissolveTabStacks=e=>{const t=this.context.vivaldiWindowId;(0,qe.l4)(e).forEach((e=>{c.ZP.expandTabStack(t,e),this.handleCompressAccordion(e)})),N8.nextTick((()=>c.ZP.clearSelection(t)))};isSelecting=()=>this.props.prefValues[Z.kTabsSelectionEnabled]&&this.state.isSelecting&&!this.state.pageSelection.isEmpty();getSelectedPages=()=>{if(!this.isSelecting())return(0,qe.aV)();const e=Ze.ZP.getPages(this.context.vivaldiWindowId,{workspaceId:this.state.workspaceId});return this.state.pageSelection.reduce(((t,s)=>{const n=e.find((e=>e.id===s));return n?t.push(n):t}),(0,qe.aV)()).sortBy((e=>e.index))};_onCommandSpy=(e,t)=>{if(e===this.context.vivaldiWindowId)switch(t){case"COMMAND_BOOKMARK_SELECTED_TABS":{const e=g.Z.getRootId();void 0!==e&&ne.Z.bookmarkPages(this.getSelectedPages(),!1,e);break}case"COMMAND_SAVE_SELECTED_SESSION":const t=this.getSelectedPages().map((e=>e.id)).toArray();t.length>0&&ue.Z.showSaveSessionDialog(e,{mode:"ids",ids:t});break;case"COMMAND_NEW_TAB":this.createTab("keyboard");break;case"COMMAND_SHOW_CLOSED_TABS":this.setState({showTrashCan:!0})}};onTabStoreChange=e=>{if(e.winId!==this.context.vivaldiWindowId)return;const t=this.context.vivaldiWindowId;switch(e.action){case"switchTabBackBySetting":this.switchBackBySetting(e.event);break;case"switchTabForwardBySetting":this.switchForwardBySetting(e.event);break;case"viewPageSource":this.state.url.startsWith("view-source:")||N8.nextTick((()=>c.ZP.openURL(e.winId,`view-source:${this.state.url}`,{incognito:this.state.incognito,addOpenerTabId:!0})));break;case"disbandTileGroup":N8.nextTick((()=>{this.isSelecting()?this.getSelectedPages().map((e=>e.vivExtData.tiling?.id)).filter(Boolean).toSet().forEach((e=>c.ZP.untileTileGroup(t,e))):N8.nextTick((()=>c.ZP.untileTileGroup(t,this.state.tilingId)))}));break;case"stackCreate":N8.nextTick((async()=>{await c.ZP.createStackFromActiveTab(t)}));break;case"stackDissolve":if(Ze.ZP.isSelecting(t)){const e=Ze.ZP.getSelectedPages(t).map(hg.av).filter(Boolean).toArray();this.dissolveTabStacks(e)}else this.dissolveTabStacks([this.state.groupId]);break;case"stackRemove":N8.nextTick((()=>this.removeFromTabStack(this.state.pageSelection)));break;case"stackTileGrid":case"stackTileHorizontal":case"stackTileVertical":const s="stackTileGrid"===e.action?"grid":"stackTileHorizontal"===e.action?"column":"row";N8.nextTick((()=>{this.isSelecting()?c.ZP.tilePages(this.getSelectedPages(),s):this.state.groupId?c.ZP.tileTabStack(t,this.state.groupId,s):c.ZP.tileLastActive(t,s)}));break;case"tabThumbnail":this.switchTabViewAndEnablePreview();break;case"unloadDialogClosed":this.#cn=!1,this._onPageStoreChange()}};onWindowStoreChanged=()=>{const e=this.context.vivaldiWindowId,t=fe.ZP.getVisibleUI(e).addressBar;this.setState({addressBarVisible:t})};onActivateTab=e=>{if(o6.i(),e.active)c.ZP.clearSelection(this.context.vivaldiWindowId);else{const t="dotted"===this.props.prefValues[Z.kTabsStackingMode];c.ZP.activateTab(e.id,this.context.vivaldiWindowId,t)}};createTab=async(e,t)=>{const s=this.context.vivaldiWindowId;if(t){const e=Ze.ZP.getGroup(t,s).first(),n=e&&(0,hg.XN)(e);return void c.ZP.openURL(s,"",{groupId:t,fixedGroupTitle:n})}const n=this.props.prefValues[Z.kTabsStackingMode],i=Ze.ZP.getPageById(this.state.activePageId),a=i&&(0,hg.av)(i),o=i&&(0,hg.XN)(i);if("dotted"!==n&&"accordion"!==n)if("substrip"!==n)c.ZP.openURL(s,"");else{const t=this.props.prefValues[Z.kTabsStackingSubstripLocked]||this.state.stackTabs.size>1;if("mainStrip"===e||!t)return void c.ZP.openURL(s,"");if(a)c.ZP.openURL(s,"",{groupId:a,fixedGroupTitle:o});else{const e=Ze.ZP.unsafeGetActivePage(s),t=await c.ZP.createTabStack((0,qe.aV)([e]),e.index);c.ZP.openURL(s,"",{groupId:t})}}else a&&"keyboard"===e&&Ze.ZP.isGroup(a,s)?c.ZP.openURL(s,"",{groupId:a,fixedGroupTitle:o}):c.ZP.openURL(s,"")};onCreateTab=e=>this.createTab("mainStrip",e);onCreateGroupTab=e=>this.createTab("subStrip",e);removeFromTabStack=e=>{if(this.isSelecting()){const e=this.getSelectedPages();e.isEmpty()||c.ZP.removeFromTabStack(e)}else{const e=Ze.ZP.getActivePage(this.context.vivaldiWindowId);e&&c.ZP.removeFromTabStack(e)}};muteTab=(e,t,s)=>{s&&s.stopPropagation(),c.ZP.toggleMuting(e,qe.aV.of(t))};closeSingleTab=(e,t)=>{t?.stopPropagation?.(),c.ZP.closePage(e)};switchBackBySetting=e=>{this.props.prefValues[Z.kTabsVisualSwitchEnable]?this.props.switchTabVisualTabSwitcher(e,!1,this.#dn):this.props.prefValues[Z.kTabsCycleByRecentOrder]?N8.nextTick((()=>c.ZP.cycleByHistory(this.context.vivaldiWindowId,e,{goBack:!0}))):N8.nextTick((()=>c.ZP.cycleByOrder(this.context.vivaldiWindowId,e,{goBack:!0})))};switchForwardBySetting=e=>{this.props.prefValues[Z.kTabsVisualSwitchEnable]?this.props.switchTabVisualTabSwitcher(e,!0,this.#dn):this.props.prefValues[Z.kTabsCycleByRecentOrder]?N8.nextTick((()=>c.ZP.cycleByHistory(this.context.vivaldiWindowId,e,{goBack:!1}))):N8.nextTick((()=>c.ZP.cycleByOrder(this.context.vivaldiWindowId,e,{goBack:!1})))};switchTabViewAndEnablePreview=()=>{const e=this.props.prefValues[Z.kTabsThumbnails],t=this.props.tabPosition,s="left"===t||"right"===t;if(e)s?I.Z.set(Z.kTabsThumbnails,!1):this.switchTabView();else{I.Z.set(Z.kTabsThumbnails,!0);const e=this.getMinimumTabSize();s&&this.state.tabBarWidth===e&&this.switchTabView()}};switchTabView=()=>{const e=this.props.tabPosition,t=this.getMinimumTabSize(),{tabBarWidth:s,tabBarHeight:n}=this.state;if("top"===e||"bottom"===e){const e=n<75?b8:C8;this.setTabBarHeight(e)}else{const e=s!==v8?v8:t;this.setTabBarWidth(e)}};onSlidebarPosition=(0,Wv.Z)(((e,t)=>{const s=this.refTabBarContainer.current,{Element:n}=this.context;if(!(s instanceof n))return;const i=s.getBoundingClientRect();switch(this.props.tabPosition){case"top":this.setTabBarHeight(Math.max(t-i.top,C8),!1);break;case"bottom":this.setTabBarHeight(Math.max(i.bottom-t,C8),!1);break;case"left":this.setTabBarWidth(Math.min(e-i.left,_8),!1);break;case"right":this.setTabBarWidth(Math.min(i.right-e,_8),!1);break;default:throw new Error("Unknown tabbar position")}}),64);handleSliderDown=()=>{this.setState({isResizing:!0})};handleSliderUp=()=>{this.setState({isResizing:!1}),"top"===this.props.tabPosition||"bottom"===this.props.tabPosition?this.snapToEdge():I.Z.set(Z.kTabsBarWidth,Math.round(this.state.tabBarWidth))};onInnerSlidebarPosition=(0,Wv.Z)(((e,t)=>{const{HTMLElement:s}=this.context,n=this.refMainBar.current?.querySelector(".resize");if(!(n instanceof s))return;const i=n.getBoundingClientRect(),a=this.getMinimumTabSize(),o=((0,Si.mM)()?0:1)+C8,{tabBarWidth:r,tabBarHeight:l}=this.state;let d=0,c=0;switch(this.props.tabPosition){case"top":c=t-i.top,c>l-a&&this.setTabBarHeight(c+a,!1),this.setInnerTabBarHeight((0,kf.Z)(c,o,b8-o),!1);break;case"bottom":c=i.bottom-t,c>l-a&&this.setTabBarHeight(c+a,!1),this.setInnerTabBarHeight((0,kf.Z)(c,o,b8-o),!1);break;case"left":d=e-i.left,d+a>r&&d+a<=_8&&this.setTabBarWidth(d+a,!1),this.setInnerTabBarWidth((0,kf.Z)(d,a,_8-a),!1);break;case"right":d=i.right-e,d+a>r&&d+a<=_8&&this.setTabBarWidth(d+a,!1),this.setInnerTabBarWidth((0,kf.Z)(d,a,_8-a),!1);break;default:throw new Error("Unknown tabbar position")}}),64);handleInnerSliderDown=()=>{this.setState({isResizing:!0})};handleInnerSliderUp=()=>{this.setState({isResizing:!1}),"top"===this.props.tabPosition||"bottom"===this.props.tabPosition?(I.Z.set(Z.kTabsBarSliderYpos,Math.round(this.state.tabBarSliderYpos)),this.snapToEdge()):this.setInnerTabBarWidth(this.state.tabBarSliderXpos)};switchInnerTabView=()=>{const{tabBarWidth:e,tabBarHeight:t,tabBarSliderXpos:s,tabBarSliderYpos:n}=this.state,i=this.props.tabPosition,a=this.getMinimumTabSize();if("top"===i||"bottom"===i)if(t<=2*a)this.setInnerTabBarHeight(b8),this.setTabBarHeight(b8+a);else{const e=75!==n?75:C8;this.setInnerTabBarHeight(e)}else if(e<=2*a)this.setInnerTabBarWidth(v8),this.setTabBarWidth(v8+a);else{const t=s!==e/2?e/2:a;this.setInnerTabBarWidth(t)}};snapToEdge=()=>{const e=this.refTabBarContainer.current,{HTMLElement:t}=this.context;if(!(e instanceof t))return;let s=parseInt(e.style.height);const n=this.getMinimumTabSize(),i=this.isSubstripVisible(),a=(0,Si.mM)(),o=i?2*n-2*a:C8;s>o&&s<o+20?s=o:s<b8&&s>130&&(s=b8),this.setTabBarHeight(s)};getTabStackThumbnailsContextMenu=(e,t)=>{const s=this.context.vivaldiWindowId,n=ei.Z.getOptionFunction(e);return ei.Z.getNamedMenu(s,e,(e=>{switch(e.action){case"CONTEXT_CLOSE":return Promise.resolve({handler:()=>this.closeSingleTab(t),...n(s,e,{})});case"CONTEXT_TABSTACK_REMOVE_FROM":return Promise.resolve({handler:()=>this.removeFromTabStack(this.state.pageSelection),...n(s,e,{})});default:return Promise.resolve({...n(s,e,{})})}}))};getTabBarContextMenu=(e,t)=>{const{prefValues:s}=this.props,n=fe.ZP.isGuest(),i=ei.Z.getOptionFunction(e),a=this.context.vivaldiWindowId;return ei.Z.getNamedMenu(a,e,(async e=>{switch(e.action){case"CONTEXT_NEW":return{handler:()=>this.createTab(t?"subStrip":"mainStrip"),...i(a,e,{})};case"CONTEXT_TOGGLE_SUBSTRIP_LOCK":{const t=s[Z.kTabsStackingSubstripLocked];return{handler:()=>I.Z.set(Z.kTabsStackingSubstripLocked,!t),isVisible:()=>"substrip"===s[Z.kTabsStackingMode],checked:t,...i(a,e,{})}}case"CONTEXT_BOOKMARK_ALL":return{handler:()=>{const e=g.Z.getRootId();void 0!==e&&ne.Z.bookmarkAllOpenPages(this.context.vivaldiWindowId,e)},isVisible:()=>!n,...i(a,e,{})};case"CONTEXT_SAVE_SESSION":return{isVisible:()=>!n,...i(a,e,{})};case"CONTEXT_REOPEN":return{isVisible:()=>!e5.Z.isEmpty(),...i(a,e,{})};default:return{...i(a,e,{})}}}))};onAuxClick=(e,t)=>{e.button===ai.Z.kCenter&&this.createTab(t?"subStrip":"mainStrip"),e.preventDefault()};onDoubleClick=(e,t)=>{e.button===ai.Z.kLeft&&"top"!==this.props.tabPosition&&this.createTab(t?"subStrip":"mainStrip")};getTooltipPlacement=()=>({top:"below",bottom:"above",left:"after",right:"before"}[this.props.tabPosition]);getTooltipMediaState=e=>this.state.mediaState.get(e)||(0,qe.l4)();getTooltipContent=(e,t,s,n)=>{const i=Ze.ZP.getPageById(e);if(!i)return{width:0,height:0,content:null};const{prefValues:a}=this.props;let o,r;const l=(0,qK.xz)(i)&&!t;if("off"!==a[Z.kTabsStackingMode]&&l){const e=(0,hg.av)(i);o=Ze.ZP.getGroup(e,this.context.vivaldiWindowId),r=e?Ze.ZP.getGroupHighlightId(e,this.context.vivaldiWindowId):null}else o=qe.aV.of(i),r=null;const d=(0,hg.cm)(i);o=o.filter((e=>(0,hg.cm)(e)===d));const c=!l&&(0,qK.ZN)(i),h=l?(0,zn.jsx)("div",{className:"tab-group",children:o.map((e=>(0,zn.jsxs)("div",{className:Gn()({"tooltip-item":!0,active:e.active,"last-active":r&&r===e.id}),onMouseDown:t=>P6(this.context,[e],t),onContextMenu:t=>this.onTabStackTooltipContextMenu(e,t),onClick:()=>this.onActivateTab(e),onAuxClick:t=>{t.button===ai.Z.kCenter&&(t.preventDefault(),t.stopPropagation(),this.closeSingleTab(e))},children:[(0,zn.jsx)(_V,{src:e.vivExtData.thumbnail??"",pageId:e.id}),(0,zn.jsxs)("div",{className:"thumbnail-caption",children:[(0,zn.jsx)(E8,{page:e,discarded:e.discarded,memoryUsage:e.memoryUsage,isMemoryUsageEnabled:a[Z.kHoverCardMemoryUsageEnabled]}),(0,zn.jsxs)("span",{className:"thumbnail-buttons",children:[(0,zn.jsx)(Vn.ZP,{className:"favicon",url:vs.jk.getFavicon(e.url)??e.url,loadType:vs.jk.getFavicon(e.url)?"faviconFromCache":"page"}),(0,zn.jsx)("button",{className:"close",dangerouslySetInnerHTML:{__html:Kn.kze},tabIndex:a[Z.kKeyboardTabToAll],onClick:t=>this.closeSingleTab(e,t)}),(0,zn.jsx)(l6,{page:e,color:this.props.theme.colorFg,tabIndex:this.props.prefValues[Z.kKeyboardTabToAll],animated:a[Z.kThemeUseAnimation],mediaState:this.getTooltipMediaState(e.id)})]})]})]},e.id)))}):(0,zn.jsx)("div",{className:"tab-solo",children:(0,zn.jsxs)("div",{className:Gn()({"tooltip-item":!0,active:i.active}),children:[!c&&(0,zn.jsx)(_V,{src:i.vivExtData.thumbnail??"",pageId:i.id}),(0,zn.jsxs)("div",{className:"thumbnail-caption",children:[(0,zn.jsx)(E8,{page:i,discarded:s,memoryUsage:n,isMemoryUsageEnabled:a[Z.kHoverCardMemoryUsageEnabled]}),(0,zn.jsx)("span",{className:"thumbnail-buttons",children:(0,zn.jsx)(l6,{page:i,color:this.props.theme.colorFg,tabIndex:this.props.prefValues[Z.kKeyboardTabToAll],animated:a[Z.kThemeUseAnimation],mediaState:this.getTooltipMediaState(i.id)})})]})]},"tabbar_tooltip")}),u=c?C8:282,p=this.context.innerWidth-("left"===this.props.tabPosition||"right"===this.props.tabPosition?this.getWidth():0),g=this.context.innerHeight-("top"===this.props.tabPosition||"bottom"===this.props.tabPosition?this.getHeight():0);if(!l)return{width:222,height:u,content:h};let m=P8,f=o.count()*M8;if(f>g){const e=Math.floor(g/M8),t=Math.ceil(o.count()/e);m=P8*t,f=Math.ceil(o.count()/t)*M8}return{width:Math.min(m,Math.floor(p/P8)*P8),height:Math.min(f,Math.floor(g/M8)*M8),content:h}};getTabDirection=()=>{const e=this.props.tabPosition;return"left"===e||"right"===e?"column":"row"};setOverflowClass=(e,t)=>{t?this.setState({tabStripOverflow:e}):this.setState({tabBarOverflow:e})};onResize=([e])=>{if(!this.#v)return;const t=e.target;this.setState((e=>({tabStripWidth:t.clientWidth,tabStripHeight:t.clientHeight,tabBarContainerWidth:t.parentElement?.clientWidth})))};isSubstripVisible(){const{prefValues:e,visible:t}=this.props;return t&&!this.state.isInternalDragging&&"substrip"===e[Z.kTabsStackingMode]&&(e[Z.kTabsStackingSubstripLocked]||this.state.stackTabs.size>1)}setIsInternalDragging=e=>{this.setState({isInternalDragging:e})};getWidth=()=>{if(!this.props.visible)return 0;const e=this.getMinimumTabSize(),t=(0,Si.np)(),{tabBarWidth:s}=this.state,n=e*(this.isSubstripVisible()?2:1)+(this.state.tabBarOverflow?t:0)+(this.state.tabStripOverflow?t:0),i=(0,kf.Z)(s,n,360);return Math.round(i)};getHeight=()=>{if(!this.props.visible)return 0;const{tabBarHeight:e}=this.state,t=(0,Si.mM)(),s=t?0:1,n=this.isSubstripVisible()?60+(t?3*t:3):C8+s;if(!this.props.prefValues[Z.kTabsThumbnails])return n;const i=b8+s,a=(0,kf.Z)(e,n,i);return Math.round(a)};showSubStack=e=>{const t=Ze.ZP.getPageById(e);if(!t)return;const s=(0,hg.av)(t);if(s){const e=Ze.ZP.getGroup(s,this.context.vivaldiWindowId).map(Ze.uU);this.setState({stackTabs:e})}else{if(1===this.state.stackTabs.size&&this.state.stackTabs.first().id===t.id)return;const e=qe.aV.of({type:"tab",page:t,id:t.id});this.setState({stackTabs:e})}};onContextMenu=(e,t)=>{e.persist(),e.preventDefault(),e.stopPropagation(),this.getTabBarContextMenu("tabbar",t).then((t=>{(0,mi.Z)(this.context,t)(e)}))};onTabStackTooltipContextMenu=(e,t)=>{t.persist(),t.preventDefault(),t.stopPropagation(),this.getTabStackThumbnailsContextMenu("tabstackthumbnails",e).then((e=>{(0,mi.Z)(this.context,e)(t)}))};handleExpandAccordion=e=>{this.setState((t=>({openAccordions:t.openAccordions.concat({groupId:e,auto:!1})})))};handleCompressAccordion=e=>{this.setState((t=>({openAccordions:t.openAccordions.filter((t=>t.groupId!==e&&!1===t.auto))})))};handleTrashMenuClosed=()=>{const e=this.props.prefValues[Z.kTabsShowTrashCan];e!==this.state.showTrashCan&&this.setState({showTrashCan:e})};toggleAutoExpandAccordion=e=>{e&&this.setState((t=>{const s=t.openAccordions.find((t=>t.groupId===e)),n=!!s&&!s.auto;return{openAccordions:t.openAccordions.filter((t=>t.groupId!==e)).concat({groupId:e,auto:n})}}))};render(){const e=this.props.prefValues,t=this.getTabDirection(),s=this.getMinimumTabSize(),n="row"===t,i="column"===t,a=this.state.tabStripHeight,o=i?Math.max(this.state.tabBarWidth-this.state.tabStripWidth,w8):this.state.tabBarContainerWidth-w8,r=(0,Si.np)(),l=i||n&&e[Z.kTabsThumbnails],d=this.props.prefValues[Z.kTabsStackingSubstripLocked],c=this.isSubstripVisible(),h=d&&this.state.stackTabs.isEmpty()?qe.aV.of({type:"tab",page:Ze.ZP.unsafeGetActivePage(this.context.vivaldiWindowId),id:this.state.activePageId}):this.state.stackTabs,u=this.state.tabBarOverflow?r:0,p=c?i?Math.max(this.getWidth()-this.state.tabBarSliderXpos-u,s):Math.max(this.getHeight()-this.state.tabBarSliderYpos-(0,Si.mM)(),s||1):0,g=e[Z.kWorkspacesEnabled]&&e[Z.kWorkspacesButtonShowInTabbar],m=n?{height:this.getHeight()}:{width:this.getWidth(),height:"100%"};return(0,zn.jsxs)("div",{className:"tabbar-wrapper",inert:this.props.inert?"inert":null,children:[g&&i&&this.props.visible&&(0,zn.jsx)(SJ,{name:"WorkspaceButton",size:"large",popupPosition:"below",inTabbar:!0,maxWidth:this.getWidth()}),(0,zn.jsxs)("div",{id:"tabs-tabbar-container",ref:this.refTabBarContainer,style:m,className:Gn()({[this.props.visible?this.props.tabPosition:"none"]:!0,resizing:this.state.isResizing,accordion:"accordion"===e[Z.kTabsStackingMode],dotted:"dotted"===e[Z.kTabsStackingMode]||e[Z.kTabsStackingPreferDotted]}),children:[g&&i&&L8,(0,zn.jsxs)("div",{id:"tabs-container",role:"toolbar","aria-labelledby":"tabbar-toplevel-label","aria-orientation":n?"horizontal":"vertical",ref:this.refMainBar,onAuxClick:e=>this.onAuxClick(e,!1),onDoubleClick:e=>this.onDoubleClick(e,!1),className:Gn()({[this.props.visible?this.props.tabPosition:"none"]:!0}),children:[(0,zn.jsx)("span",{hidden:!0,id:"tabbar-toplevel-label",children:(0,W.Z)("toolbar label","Tabs")}),g&&n&&(0,zn.jsx)(SJ,{name:"WorkspaceButton",size:"medium",popupPosition:"bottom"===this.props.tabPosition?"above":"below",inTabbar:!0}),(0,zn.jsx)(ti.Z,{className:"resize",onResize:this.onResize,children:(0,zn.jsx)(Z8,{overflow:this.state.tabBarOverflow,isSubstrip:!1,isSubstripVisible:c,maxWidth:this.state.tabStripWidth-(i?0:w8),maxHeight:i?a-64:a,direction:t,onActivateTab:this.onActivateTab,getTooltipContent:this.getTooltipContent,setOverflowClass:this.setOverflowClass,prefValues:e,tabPosition:this.props.tabPosition,isSelecting:this.isSelecting(),isResizing:this.state.isResizing,getSelectedPages:this.getSelectedPages,pages:this.state.pages,tabs:this.state.tabs,switchByScroll:e[Z.kMouseWheelTabSwitch],onCreateTab:this.onCreateTab,showSubStack:this.showSubStack,isExpectingDrop:this.state.isExpectingDrop,onContextMenu:this.onContextMenu,setIsExpectingDrop:this.setIsExpectingDrop,activeGroupId:this.state.groupId,openAccordions:this.state.openAccordions,handleExpandAccordion:this.handleExpandAccordion,handleCompressAccordion:this.handleCompressAccordion,toggleAutoExpandAccordion:this.toggleAutoExpandAccordion,closePage:this.closePage,theme:this.props.theme,pinnedWidth:this.state.pinnedWidth,setIsInternalDragging:this.setIsInternalDragging,addressBarVisible:this.state.addressBarVisible,mediaState:this.state.mediaState,dissolveTabStacks:this.dissolveTabStacks,showTrashCan:this.state.showTrashCan,handleTrashMenuClosed:this.handleTrashMenuClosed})}),l&&c&&(0,zn.jsx)(Mu.Z,{onSlidebarPosition:this.onInnerSlidebarPosition,onStart:this.handleInnerSliderDown,onStop:this.handleInnerSliderUp,onDoubleClick:this.switchInnerTabView,style:"top"===this.props.tabPosition?{top:a+4}:"bottom"===this.props.tabPosition?{bottom:a-4}:{},position:this.props.tabPosition})]}),c&&(0,zn.jsxs)("div",{id:"tabs-subcontainer",role:"toolbar","aria-labelledby":"tabbar-stack-label","aria-orientation":n?"horizontal":"vertical","aria-hidden":!c,onAuxClick:e=>this.onAuxClick(e,!0),onDoubleClick:e=>this.onDoubleClick(e,!0),className:Gn()({[this.props.visible?this.props.tabPosition:"none"]:!0,visible:c}),style:{flexGrow:0,flexShrink:0,flexBasis:p},children:[(0,zn.jsx)("span",{hidden:!0,id:"tabbar-stack-label",children:(0,W.Z)("toolbar label","Stacked Tabs")}),(0,zn.jsx)(Z8,{overflow:this.state.tabStripOverflow,isSubstrip:!0,isSubstripVisible:c,maxWidth:o,maxHeight:i?a-w8:p,direction:t,onActivateTab:this.onActivateTab,getTooltipContent:this.getTooltipContent,setOverflowClass:this.setOverflowClass,prefValues:e,tabPosition:this.props.tabPosition,isSelecting:this.isSelecting(),isResizing:this.state.isResizing,getSelectedPages:this.getSelectedPages,pages:this.state.pages,tabs:h,switchByScroll:e[Z.kMouseWheelTabSwitch],onCreateTab:this.onCreateGroupTab,isExpectingDrop:this.state.isExpectingDrop,onContextMenu:this.onContextMenu,setIsExpectingDrop:this.setIsExpectingDrop,activeGroupId:this.state.groupId,closePage:this.closePage,theme:this.props.theme,pinnedWidth:0,addressBarVisible:this.state.addressBarVisible,mediaState:this.state.mediaState,dissolveTabStacks:this.dissolveTabStacks,showTrashCan:!1,handleTrashMenuClosed:nr.Z})]}),l&&(0,zn.jsx)(Mu.Z,{onSlidebarPosition:this.onSlidebarPosition,onStart:this.handleSliderDown,onStop:this.handleSliderUp,onDoubleClick:this.switchTabView,offset:1,position:this.props.tabPosition})]})]})}}const B8=(0,zd.Z)(R8,D8);var F8=(0,zn.jsx)(sc,{});const W8=function(e){const t=Un.useContext(oi.Z),s=(0,Eo.Z)([Z.kMenuDisplay]),[n,i]=Un.useState(""),[a,o]=Un.useState("");Un.useEffect((()=>{function e(){const e=Ze.ZP.getActivePage(t.vivaldiWindowId);e&&e.windowId===t.vivaldiWindowId&&(n===e.title&&a===e.url||(i(e.title),o(e.url)))}return fe.ZP.isSettings(t.vivaldiWindowId)||Ze.ZP.addListener(e,t.selectWindow),()=>Ze.ZP.ensureRemovedListener(e)}),[n,a,t.selectWindow,t.vivaldiWindowId]);const r=!e.isPopupWindow&&"vivaldi"===s[Z.kMenuDisplay];if(e.isHidden)return r?(0,zn.jsx)(WJ,{keyAccess:e.keyAccess,isHidden:!0,inert:!0}):null;const l=vs.jk.getDisplayTitleByUrl(a,n)||"Vivaldi",d="top"!==e.tabPosition?"tabless":null;return(0,zn.jsxs)("div",{id:"titlebar",className:d,children:[r&&(0,zn.jsx)(WJ,{keyAccess:e.keyAccess,isHidden:!1,inert:e.inert}),!e.native&&F8,"top"!==e.tabPosition&&("vivaldi"===s[Z.kMenuDisplay]||e.isPopupWindow||!1)&&(0,zn.jsxs)("div",{id:"pagetitle",children:[e.isPopupWindow&&(0,zn.jsx)(Vn.ZP,{url:(0,Vn.rv)(a),loadType:"faviconSkipCache"}),(0,zn.jsx)("span",{children:l})]})]})};var U8=s(34155);const V8=()=>[],H8=["MailMsgArchiveRestore","MailMsgStatusUnread","MailMsgSpamRestore","MailMsgTrashRestore","MailRenderingMethodText","MailViewThreadingFlat","Stop","VersionInfo","ShareVivaldi"];class G8 extends Un.PureComponent{static contextType=oi.Z;state={open:!0,currentToolbar:this.props.toolbar,userCommands:A.Z.get(Z.kChainedCommandsCommandList),confirmReset:!1,panelExtensions:[]};componentDidMount(){A.Z.addListener(Z.kToolbarsPanel,this.onPrefChanged),U8.nextTick((()=>Pp.Z.refreshActiveMessage())),re.Z.extensionActionUtils.getToolbarExtensions((e=>{const t=e.filter((e=>e.enabled&&!!e.sidePanel));this.setState({panelExtensions:t})}))}componentWillUnmount(){A.Z.removeListener(Z.kToolbarsPanel,this.onPrefChanged),U8.nextTick((()=>Pp.Z.refreshActiveMessage()))}changeCurrent=e=>{const{value:t}=e.currentTarget;this.setState({currentToolbar:t})};onClose=()=>ic.Z.stopEditing();onDragStart=(e,t)=>{e.dataTransfer.setData(HJ,t),e.dataTransfer.setData(VJ,"toolbar-editor")};onConfirmReset=()=>this.setState({confirmReset:!0});onReset=e=>{if(e){const e=Rp.ww.find((e=>e.pref===this.state.currentToolbar));if(!e)return;(0,Rp.Np)(this.context.vivaldiWindowId,e.pref),I.Z.reset(e.pref)}this.setState({confirmReset:!1})};onPrefChanged=()=>{this.state.currentToolbar===Z.kToolbarsPanel&&this.forceUpdate()};onEditChains=()=>{ue.Z.showSettings(this.context.vivaldiWindowId,"qc"),this.onClose()};canRender=e=>e.filter((e=>!Rp.e3.includes(e.id)));appendDynamicContent=(e,t)=>{if("panel"===e){const e=A.Z.get(Z.kToolbarsPanel).filter((e=>nc.ZP.isWebPanel(e)&&!Ko.Z.isExtPanel(e))),s=this.state.panelExtensions.map((e=>({id:Ko.Z.getExtPanelIdFromExtensionId(e.id),label:e.name})),[]),n=e.map((e=>{const t=tn.ZP.getWebPanels(this.context.vivaldiWindowId).find((t=>t.id===e));if(t)return{id:e,label:t.url};{const t=A.Z.getDefault(Z.kPanelsWebElements).find((t=>t.id===e));if(t)return{id:e,label:t.url}}})).concat(s).filter(Boolean),i=t.findIndex((e=>"PanelWeb"===e.id));return-1!==i?t.slice(0,i).concat(n).concat(t.slice(i)):t.concat(n)}return t};render(){const e=!wt.Z.isFeedsOn()||!fe.ZP.isMail(this.context.vivaldiWindowId),t=Rp.ww.filter((t=>e?!t.category.includes("mail"):t)).map((e=>({category:e.category,label:e.label,pref:e.pref}))),s="chains"!==this.state.currentToolbar?Rp.ww.find((e=>e.pref===this.state.currentToolbar)):void 0;return(0,zn.jsxs)(Ha.Z,{ignoreClickOutside:!0,onRequestClose:this.onClose,className:"toolbar-editor",labelledBy:Ha.t,children:[(0,zn.jsxs)("header",{className:"dialog-header",children:[this.state.confirmReset&&(0,zn.jsx)($C,{title:(0,W.Z)("Reset $1",[s?.label??""]),prompt:[(0,W.Z)("$1 will be reset to default layout.",[s?.label??""])],positive:(0,W.Z)("Reset"),negative:(0,W.Z)("Cancel"),onClose:this.onReset,danger:!0}),(0,zn.jsxs)("h1",{children:[(0,zn.jsx)("span",{id:Ha.t,children:(0,W.Z)("Toolbar Editor")}),(0,zn.jsx)($x,{position:"bottom",label:(0,zn.jsxs)("div",{children:[(0,zn.jsx)("p",{children:(0,W.Z)("You can always rearrange toolbar components by dragging them while pressing the $1 key.",["Ctrl"])}),!1]})})]}),(0,zn.jsx)("p",{className:"balanced",children:(0,W.Z)("Choose a set of toolbar buttons, or your Command Chains. Drag buttons to toolbars, rearrange, or remove them from toolbar by dropping them on the background area.")}),(0,zn.jsxs)(Fa.Z,{defaultValue:this.state.currentToolbar,onChange:this.changeCurrent,children:[t.map((e=>{const{pref:t,label:s}=e;return(0,zn.jsx)("option",{value:t,children:s},t)})),(0,zn.jsx)("option",{value:"chains",children:(0,W.Z)("Command Chains")})]})]}),(0,zn.jsxs)("section",{className:"dialog-content toolbar-large",children:[s&&this.appendDynamicContent(s.category,this.canRender(s.buttons)).filter((e=>!H8.includes(e.id))).map(((e,t)=>(0,zn.jsxs)("div",{className:"draggable-button",children:[(0,zn.jsx)(ZJ,{index:t,name:e.id,label:e.label,menuOrigin:"pointer",popupPosition:"below",size:"large",onDragStart:e=>this.onDragStart(e,t),onDragEnd:nr.Z,onDrop:nr.Z,onDragEnter:nr.Z,customizeMenu:V8,mimeType:oa.f2,preview:!0,inEditor:!0,draggable:!0,isMailWindow:!0},t),(0,zn.jsx)("span",{children:e.label})]},t))),"chains"===this.state.currentToolbar&&this.state.userCommands.map(((e,t)=>(0,zn.jsxs)("div",{className:"draggable-button",children:[(0,zn.jsx)(ZJ,{index:t,name:e.name,label:e.label,size:"large",onDragStart:e=>this.onDragStart(e,t),onDragEnd:nr.Z,onDrop:nr.Z,onDragEnter:nr.Z,customizeMenu:V8,menuOrigin:"pointer",popupPosition:"below",mimeType:oa.f2,preview:!0,inEditor:!0,draggable:!0,isMailWindow:!0},e.key),e.label]},t)))]}),"chains"!==this.state.currentToolbar&&(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)("h3",{children:(0,W.Z)("Default Toolbar Preview")}),(0,zn.jsx)("section",{className:"dialog-preview",children:s?.pref&&(0,zn.jsx)("span",{className:"default-toolbar",children:(0,zn.jsx)(zJ,{name:s.pref,label:(0,W.Z)("toolbar label","Preview"),showDefaultSet:!0,menuOrigin:"pointer",popupPosition:"below",size:"large"},s.pref)})})]}),(0,zn.jsxs)("div",{className:"dialog-footer",children:["chains"===this.state.currentToolbar?(0,zn.jsx)("input",{type:"button",value:(0,W.Z)("Manage Command Chains"),onClick:this.onEditChains}):(0,zn.jsx)("input",{type:"button",className:"ignore-react-onclickoutside",value:(0,W.Z)("Reset $1 to Default",[s?.label??""]),onClick:this.onConfirmReset}),(0,zn.jsx)("input",{type:"button",className:"primary",value:(0,W.Z)("process","Done"),onClick:this.onClose})]})]})}}class K8 extends Un.PureComponent{componentDidMount(){this._handleShortcutChange(this.props.shortcut.shortcut,!0)}componentWillUnmount(){this._handleShortcutChange(this.props.shortcut.shortcut,!1)}componentDidUpdate(e){this.props.shortcut!==e.shortcut&&(this._handleShortcutChange(e.shortcut.shortcut,!1),this._handleShortcutChange(this.props.shortcut.shortcut,!0))}_handleShortcutChange=(e,t)=>{e&&(t?Qe.Z.bind(e,this._handleMenuShortcut):Qe.Z.unbind(e,this._handleMenuShortcut))};_getDisplayName=()=>{const e=st.Z.getMenuBarString(this.props.item,this.props.shortcut);if(this.props.underlineAccessKeys&&-1!==e.offset){const t=e.offset;return(0,zn.jsxs)("span",{children:[t>0?e.name.substring(0,t):"",(0,zn.jsx)("span",{className:"underlined",children:e.name.substring(t,t+1)}),e.name.substring(t+1)]})}return(0,zn.jsx)("span",{children:e.name})};_handleMenuShortcut=()=>{this.props.onItemActivated(this.props.id)};_handleKeyDown=e=>{const{ctrlKey:t,altKey:s,shiftKey:n,metaKey:i}=e,a={ctrlKey:t,altKey:s,shiftKey:n,metaKey:i};switch(e.key){case"ArrowUp":case"ArrowDown":case"Enter":case" ":this.props.onItemActivated(this.props.id);break;case"ArrowLeft":this.props.moveFocus(this.props.id,"left",!1);break;case"ArrowRight":this.props.moveFocus(this.props.id,"right",!1);break;case"Escape":if(-1!==this.props.openMenuId)return;this.props.onLeaveBar();break;default:if((0,Zi.VV)(a)&&this.props.onAccessKey(e.key))break;return}e.preventDefault(),e.stopPropagation()};_handleMouseDown=e=>{e.button===ai.Z.kLeft&&ai.Z.isNoModifierPressed(e)&&this.props.onItemActivated(this.props.id),e.preventDefault(),e.stopPropagation()};_handleMouseEnter=e=>{this.props.onItemEnter(this.props.id)};_handleMouseLeave=e=>{this.props.onItemLeave(this.props.id)};_handleBlur=()=>{this.props.onItemBlur(this.props.id)};_handleFocus=()=>{this.props.highlighted||this.props.onItemHighlightMissing(this.props.id)};render(){return(0,zn.jsx)("button",{"data-id":this.props.id,"data-offset":0,tabIndex:this.props.keyAccess,className:Gn()({menubarItem:!0,uifocusstop:0===this.props.id,highlighted:this.props.highlighted,menubar:!0}),onBlur:this._handleBlur,onFocus:this._handleFocus,onKeyDown:this._handleKeyDown,onMouseEnter:this._handleMouseEnter,onMouseLeave:this._handleMouseLeave,onMouseDown:this._handleMouseDown,role:"menuitem","aria-label":this.props.item.label,"aria-haspopup":"menu","aria-expanded":this.props.id===this.props.openMenuId,children:this._getDisplayName()})}}const z8=K8;var $8=s(34155);const Y8="menubar";class X8 extends Un.PureComponent{static contextType=oi.Z;nodeRef=Un.createRef();acceptEnterId=-1;timer=null;hasMenu=!1;#v=!1;constructor(e,t){super(e),this.hasMenu=Ye.Z.isNamedMenuAvailable(Y8);const s=this._getMenuItems(t.vivaldiWindowId,!1);this.state={items:s,shortcuts:st.Z.getShortcutsForSubMenus(s),openMenuId:-1,highlightedId:-1,underlineAccessKeys:!1}}componentDidMount(){A.Z.addListener([Z.kKeyboardShortcutsAltOpensMenu,Z.kFeaturesMail,Z.kFeaturesFeeds],this._onPrefsChange),Ye.Z.addListener(this._onCommandStoreChange),this._requestMenu(),this.#v=!0}componentWillUnmount(){this.timer&&clearTimeout(this.timer),A.Z.removeListener([Z.kKeyboardShortcutsAltOpensMenu,Z.kFeaturesMail,Z.kFeaturesFeeds],this._onPrefsChange),Ye.Z.removeListener(this._onCommandStoreChange),this.#v=!1}_requestMenu(){this.hasMenu||ae.Z.requestNamedMenu(Y8)}_getMenuItems=(e,t)=>Ye.Z.getNamedMenu(e,Y8,t).filter((t=>!t.isVisible||t.isVisible(e,!1)));_onPrefsChange=(e,t,s)=>{switch(s){case Z.kFeaturesMail:case Z.kFeaturesFeeds:this.setState({items:this._getMenuItems(this.context.vivaldiWindowId,!1)});break;case Z.kKeyboardShortcutsAltOpensMenu:this._setupShortcuts(this.state.items)}};_onCommandStoreChange=e=>{switch(e){case"init":this._requestMenu();break;case"menu":this.hasMenu=!0;const e=this._getMenuItems(this.context.vivaldiWindowId,!1);this.setState({items:e,shortcuts:st.Z.getShortcutsForSubMenus(e)});break;case"shortcut":this._setupShortcuts(this.state.items)}};_handleItemActivated=e=>{LJ.show(this.context,e,this._getSiblings(),"bottom",this._onMenuVisibilityChanged)};_handleItemEnter=e=>{-1!==this.acceptEnterId&&this.acceptEnterId!==e||((0,vo.sT)(this.context.document,this.nodeRef.current)&&this._moveFocus(e,"current",!0),this.setState({highlightedId:e}))};_handleItemLeave=e=>{-1===this.state.openMenuId&&this.setState({highlightedId:-1})};_handleItemBlur=e=>{$8.nextTick((()=>{(0,vo.sT)(this.context.document,this.nodeRef.current)||this.setState({highlightedId:-1})}))};_handleLeaveBar=()=>{this.setState({highlightedId:-1}),ae.Z.executeActions("event",this.context,"COMMAND_FOCUS_WEBVIEW")};_handleDoubleClick=e=>{e.preventDefault(),e.stopPropagation()};_changeFocus=()=>{(0,vo.sT)(this.context.document,this.nodeRef.current)?this._handleLeaveBar():this._moveFocus(this.state.highlightedId,"current",!0)};_moveFocus=(e,t,s)=>{const{document:n,HTMLButtonElement:i}=this.context;if(!0===s||(0,vo.sT)(n,this.nodeRef.current)){const s=this.state.items.map(((e,t)=>this.state.shortcuts[t]?t:-1)).filter((e=>-1!==e));if(0===s.length)return;if("current"===t){const t=e<0?0:s.indexOf(e);if(-1===t)return;e=s[t]}else if("right"===t||"left"===t){if(1===s.length)return;let n=s.indexOf(e);n="right"===t?n+1>=s.length?0:n+1:n<=0?s.length-1:n-1,e=s[n]}const a=n.querySelector(`button.menubarItem.menubar[data-id="${e}"]`);a&&a instanceof i&&this.setState({highlightedId:e},(()=>a.focus()))}};_handleItemHighlightMissing=e=>{this.setState({highlightedId:e})};_onMenuVisibilityChanged=e=>{this.#v&&(-1===e?(this.acceptEnterId=this.state.openMenuId,this.timer=setTimeout((()=>{this.acceptEnterId=-1,this.timer=null}),100),(0,vo.sT)(this.context.document,this.nodeRef.current)?this._moveFocus(this.state.openMenuId,"current",!0):this.setState({highlightedId:-1})):(this.setState({highlightedId:e}),this._moveFocus(e,"current",!1)),this.setState({openMenuId:e}),this._showAccessKeys(!1))};_showAccessKeys=e=>{this.setState({underlineAccessKeys:e})};_setupShortcuts=e=>{this.setState({shortcuts:st.Z.getShortcutsForSubMenus(e)})};_activateByAccessKey=e=>{for(let t=0;t<this.state.items.length;t++)if(this.state.shortcuts[t]&&this.state.shortcuts[t].key===e)return this._handleItemActivated(t),!0;return!1};_getSiblings=()=>{const e=this._getMenuItems(this.context.vivaldiWindowId,!0);return Array.from(this.context.document.querySelectorAll("button.menubarItem.menubar")).map(((t,s)=>{const n=t.getBoundingClientRect();return{id:parseInt(t.dataset.id),rect:{x:parseInt(n.left),y:parseInt(n.top),width:parseInt(n.width),height:parseInt(n.height)},menu:{items:e[s].items||[],expandId:"",preferred:[]}}}))};renderAll=()=>this.state.items.map(((e,t)=>{if(!this.state.shortcuts[t])return null;const s=0===t?this.props.keyAccess:-1,n=t.toString();return(0,zn.jsx)(z8,{id:t,keyAccess:s,item:e,shortcut:this.state.shortcuts[t],underlineAccessKeys:this.state.underlineAccessKeys,openMenuId:this.state.openMenuId,highlighted:this.state.highlightedId===t,moveFocus:this._moveFocus,onItemActivated:this._handleItemActivated,onItemEnter:this._handleItemEnter,onItemLeave:this._handleItemLeave,onItemBlur:this._handleItemBlur,onItemHighlightMissing:this._handleItemHighlightMissing,onAccessKey:this._activateByAccessKey,onLeaveBar:this._handleLeaveBar},n)}));render(){return(0,zn.jsxs)(Un.Fragment,{children:[(0,zn.jsx)(EJ,{changeFocus:this._changeFocus,showAccessKeys:this._showAccessKeys}),(0,zn.jsx)("div",{ref:this.nodeRef,className:Gn()({menubar:!0,horizontal:this.props.horizontal}),onDoubleClick:this._handleDoubleClick,tabIndex:"-1",role:"menu",children:this.renderAll()})]})}}const Q8=X8,q8=[Z.kKeyboardTabToAll,Z.kMenuIconType];class J8 extends Un.PureComponent{static contextType=oi.Z;state={activePage:Ze.ZP.unsafeGetActivePage(this.context.vivaldiWindowId)};componentDidMount(){const{selectWindow:e}=this.context;Ze.ZP.addListener(this._onPageStoreChange,e)}componentWillUnmount(){Ze.ZP.removeListener(this._onPageStoreChange)}_onPageStoreChange=()=>{this.setState({activePage:Ze.ZP.unsafeGetActivePage(this.context.vivaldiWindowId)})};close=e=>{e.stopPropagation(),Wn.Z.close(this.context.vivaldiWindowId)};render(){const{inert:e}=this.props;return(0,zn.jsxs)("div",{className:"topmenu",inert:e?"inert":null,children:["icon"===this.props.prefValues[Z.kMenuIconType]&&(0,zn.jsxs)("button",{className:"vivaldi-horizontal-icon",onDoubleClick:this.close,title:(0,W.Z)("Double Click to Close"),tabIndex:"-1",children:[(0,zn.jsx)("span",{className:"application-icon",dangerouslySetInnerHTML:{__html:Kn.Qa2}}),(0,zn.jsx)("span",{className:"vivaldi-v",dangerouslySetInnerHTML:{__html:s(3783)}})]}),"burger"===this.props.prefValues[Z.kMenuIconType]&&(0,zn.jsx)("button",{className:"vivaldi-horizontal-icon",onDoubleClick:this.close,title:(0,W.Z)("Double Click to Close"),tabIndex:"-1",children:(0,zn.jsx)("span",{className:"burger-icon",dangerouslySetInnerHTML:{__html:s(37609)}})}),(0,zn.jsx)(Q8,{horizontal:!0,keyAccess:this.props.prefValues[Z.kKeyboardTabToAll]}),(0,zn.jsx)("div",{className:"horizontal-menu-pagetitle",children:vs.jk.getDisplayTitle(this.state.activePage)})]})}}const e7=(0,zd.Z)(J8,q8);const t7=function(e){const t=s=>{const{direction:n,first:i,second:a,splitPercentage:o=50}=s,r=s===e.value,l={gridTemplateRows:"column"===n?`${o}% auto`:" unset",gridTemplateColumns:"row"===n?`${o}% auto`:" unset"};return r&&(l.visibility=e.visible?"inherit":"hidden",l.zIndex=e.visible?"initial":-1,l.opacity=e.visible?1:0),(0,zn.jsxs)("div",{className:Gn()("tiled",{visible:e.visible&&r}),style:l,children:[(0,zn.jsxs)("div",{className:"tile",children:["number"==typeof i?e.renderTile(i):t(i),(0,zn.jsx)(Mu.Z,{onSlidebarPosition:function(t,n,i){const a=i.target?.parentElement,o=a.parentElement?.getBoundingClientRect();if(o){switch(s.direction){case"row":const e=(t-o.left)/o.width*100;s.splitPercentage=(0,kf.Z)(e,10,90);break;case"column":const i=(n-o.top)/o.height*100;s.splitPercentage=(0,kf.Z)(i,10,90)}e.onChange(e.value,e.tilingId)}},position:"row"===n?"left":"top"})]}),(0,zn.jsx)("div",{className:"tile",children:"number"==typeof a?e.renderTile(a):t(a)})]})};return t(e.value)};var s7=s(69787),n7=s(34540);const i7=(0,Te.Z)(n7.Z,500);class a7 extends m.Z{getInitialState(){return{}}reduce(e,t){const s=e;switch(t.actionType){case"TILE_INITIALIZED":return{...e,...t.tilesState};case"TILE_SET_LAYOUT":{const{id:s,mosaicLayout:n}=t;e={...e,[s]:n};break}case"PAGE_TILE_PAGES":{const{pages:s,id:n}=t;e=r7(e,s),n||(e=d7(e,s));break}case"CHROME_TABS_CREATE":const s=Ze.ZP.getPageById(t.page.id);s&&(e=l7(e,qe.aV.of(s)));break;case"PAGE_TILE_REMOVE_PAGES":case"PAGE_TABSTACK_REMOVE_FROM":case"PAGE_CLOSE":{const{pages:s}=t;e=r7(e,s);break}case"PAGE_TABSTACK_CREATE":{const{pages:s}=t;e=l7(e,s);break}default:return e}return e!==s&&i7(t.windowId,{tiles:e}),e}}function o7(e,t){if("object"!=typeof e)return e;if(e.first===t)return"object"==typeof e.second?{...e.second}:e.second;if(e.second===t)return"object"==typeof e.first?{...e.first}:e.first;const s=o7(e.first,t),n=o7(e.second,t);return e.first!==s||e.second!==n?{...e,first:s,second:n}:e}function r7(e,t){return t.reduce(((t,s,n)=>{if(!s.vivExtData.tiling?.id||!e[s.vivExtData.tiling?.id])return t;const i=s.vivExtData.tiling.id,a=t[i],o=o7(a,Ze.ZP.getTiles(i,s.windowId).findIndex((e=>e.id===s.id)));if(a===o)return t;if("object"==typeof o)return function(e){(function e(t,s){"object"==typeof t.first?e(t.first,s):t.first=s.count++,"object"==typeof t.second?e(t.second,s):t.second=s.count++})(e,{count:0})}(o),{...t,[i]:o};const r={...t};return delete r[i],r}),e)}function l7(e,t){return d7(e,t)}function d7(e,t){return t.map((e=>(0,hg.jA)(e))).forEach((t=>{t&&e[t]&&delete(e={...e})[t]})),e}function c7(e,t){if(e<2)return;const s=t||(e<4?"row":"grid");if("grid"===s){const t=3===e?2:Math.floor(Math.sqrt(e));return h7((0,KN.Z)(e),t)}return u7((0,KN.Z)(e),s)}function h7(e,t){if(e.length<=t)return u7(e,"column");const s=e.slice(0,t),n=e.slice(t),i=s.length/e.length*100;return{direction:"row",first:u7(s,"column"),second:h7(n,t),...50===i?null:{splitPercentage:i}}}function u7(e,t){if(1===e.length)return e[0];const s=Math.floor(e.length/2),n=e.slice(0,s),i=e.slice(s),a=n.length/e.length*100;return{direction:t,first:u7(n,t),second:u7(i,t),...50===a?null:{splitPercentage:a}}}const p7=new a7;var g7=s(77398);function m7(e){const t=Ze.ZP.getActivePage(e)?.id??0,s=Ze.ZP.getPageInWindow(e,t);return{activePageId:t,activeWorkSpaceId:s?(0,hg.cm)(s):void 0,pages:Ze.ZP.getPages(e)}}class f7 extends Un.PureComponent{static contextType=oi.Z;constructor(e,t){super(e);const s=(0,g7.Z)(A.Z.get(Z.kPanelsState),["width"],0);this.state={...m7(t.vivaldiWindowId),contentWidth:t.innerWidth-s,contentHeight:t.innerHeight,tiles:p7.getState()}}async componentDidMount(){const{selectWindow:e}=this.context;Ze.ZP.addListener(this._onPageStoreChange,e),p7.addListener(this._onTilingStoreChange)}componentWillUnmount(){Ze.ZP.removeListener(this._onPageStoreChange),p7.removeListener(this._onTilingStoreChange)}_onPageStoreChange=()=>{const e=m7(this.context.vivaldiWindowId);this.setState(e)};_onTilingStoreChange=()=>{this.setState({tiles:p7.getState()})};onResize=e=>{const t=e[0].target;let s,n;if(t&&t.clientWidth&&t.clientHeight)s=t.clientWidth,n=t.clientHeight;else{const e=(0,g7.Z)(A.Z.get(Z.kPanelsState),["width"],0);s=this.context.innerWidth-e,n=this.context.innerHeight}this.setState({contentWidth:s,contentHeight:n})};handleFocus=e=>{if("WEBVIEW"===e.relatedTarget.tagName)sp.Z.doAction(this.context.vivaldiWindowId,this.state.activePageId,"focusWebView");else{const t=this.context.document.querySelector("#webpage-stack .webpageview.active .internal-page");if(t){const s=(0,vo.Ng)(t);if(s){const{classList:t}=e.target;t?.contains("focus_webview_enter")?s[s.length-1].focus():t?.contains("focus_webview_exit")&&s[0].focus()}}}};onMosaicLayoutChange=(e,t)=>{s7.Z.setTileLayout(this.context.vivaldiWindowId,e,t)};getLayoutSize(e){return"number"==typeof e.second?e.second+1:this.getLayoutSize(e.second)}renderTileSet=e=>{const t=this.context.vivaldiWindowId,{activePageId:s}=this.state,n=e.map(hg.jA).toSet(),i=Ze.ZP.getPageInWindow(t,s),a=i?(0,hg.jA)(i):void 0;return n.map((e=>{if(!e)return;const s=Ze.ZP.getTiles(e,t).filter((e=>(0,hg.cm)(e)===this.state.activeWorkSpaceId)).sortBy((e=>e.index)).map((e=>this.renderPage(e))),n=e===a;let o=this.state.tiles[e];if(i&&n&&(!o||this.getLayoutSize(o)!==s.size)){const n=i.vivExtData.tiling?.layout;o=c7(s.size,n),o&&s7.Z.setTileLayout(t,o,e)}return o?(0,zn.jsx)(t7,{tilingId:e,visible:n,renderTile:e=>s.get(e,null),value:o,onChange:this.onMosaicLayoutChange},e):null}))};renderPage=e=>{const t=(0,qK.ZN)(e),s=e.pinned&&A.Z.get(Z.kTabsAlwaysLoadPinnedAfterRestore);return t||!e.discarded||s?(0,zn.jsx)(Aq,{id:e.id,pageContext:e.context,url:e.url,target:e.target,vivExtData:e.vivExtData,showImageInspector:e.showImageInspector,discarded:e.discarded,contentWidth:this.state.contentWidth,contentHeight:this.state.contentHeight,isVisible:t,isActive:e.active,supportsReaderMode:e.supportsReaderMode,pinned:e.pinned},`page-component-${e.id}`):null};render(){const e=Un.Fragment,t=this.props.cycleFocus?"0":"-1",[s,n]=this.state.pages.partition((e=>{const t=(0,hg.jA)(e);return this.state.activeWorkSpaceId===(0,hg.cm)(e)&&t&&Ze.ZP.getTiles(t,this.context.vivaldiWindowId).size>1}));return(0,zn.jsxs)(e,{children:[(0,zn.jsx)("span",{tabIndex:t,onFocus:this.handleFocus,className:"focus_webview_enter"}),(0,zn.jsxs)(ti.Z,{id:"webpage-stack",onResize:this.onResize,children:[n.size>0&&this.renderTileSet(n),s.size>0&&s.sortBy((e=>e.id)).map(this.renderPage)]}),(0,zn.jsx)("span",{tabIndex:t,onFocus:this.handleFocus,className:"focus_webview_exit"})]},"webpage__collection")}}const v7=f7;var b7=s(19718),C7=s(40893),w7=s(30992);const y7=()=>[g6,m6,f6,v6,b6,C6],x7=e=>{let t=e;return t&&(t=t.replace(/^data\:([^\;]+)\;base64,/gim,"")),t};function I7(e,t,s){return{isVisible:()=>!e.isGuest&&s.selection.length>0,isEnabled:()=>s$.ZP.hasNotes(),handler:()=>{ue.Z.showNoteSelectionDialog(e.winId,{onSelected:e=>Js.Z.appendToNode(e,s.selection)})}}}const A7=(e,t,s,n=9,i)=>{const a=x7(s.faviconUrl);return{handler:()=>{w7.Z.setSearchEngine(e,s),C7.Z.withTextAndEngine(e,t,s.guid)},emphasized:s.guid===i?.guid,iconPNG:a,iconPNGWhite:a,...st.Z.makeNumberMnemonic(s.name,n)}},S7=(e,t)=>{if(0===t.length)return[];const s=w7.Z.getSearchEngine(e,!0);return pn.Z.get().map(((n,i)=>A7(e,t,n,i,s)))},Z7=e=>[{commandName:"DOCUMENT_DIRECTION_DEFAULT",type:"checkbox",...(0,fi.Z)("command","Default")},{commandName:"DOCUMENT_DIRECTION_LTR",type:"checkbox",...(0,fi.Z)("Left to Right")},{commandName:"DOCUMENT_DIRECTION_RTL",type:"checkbox",...(0,fi.Z)("Right to Left")}],T7=e=>[{commandName:"DOCUMENT_LOOP",type:"checkbox",...(0,fi.Z)("context","Loop")},{commandName:"DOCUMENT_SHOW_CONTROLS",type:"checkbox",...(0,fi.Z)("Show Controls")},st.Z.separatorItem,{commandName:"DOCUMENT_OPEN_AV_NEW_TAB",...e.support.audio?(0,fi.Z)("Open Audio in New Tab"):(0,fi.Z)("Open Video in New Tab")},{commandName:"DOCUMENT_SAVE_AV",ellipsis:!0,...e.support.audio?(0,fi.Z)("Save Audio As"):(0,fi.Z)("Save Video As")},{commandName:"DOCUMENT_COPY_AV_ADDRESS",ellipsis:!0,...e.support.audio?(0,fi.Z)("Copy Audio Address"):(0,fi.Z)("Copy Video Address")},{commandName:"DOCUMENT_CAST",ellipsis:!0,...(0,fi.Z)("Cast")},st.Z.separatorItem,{commandName:"DOCUMENT_PICTURE_IN_PICTURE",isVisible:()=>e.support.video&&e.support.pictureinpicture,...(0,fi.Z)("Picture in Picture")}],E7=async(e,t,s,n,i)=>{switch(n.action){case"DOCUMENT_CONTAINER_DEVELOPER_TOOLS":return{isVisible:()=>!s&&!t.isdevtools,items:await k7(e,t,s,i),...i(e.winId,n,t)};case"DOCUMENT_VALIDATE_URL":return{isVisible:()=>!(t.iswebpanel||t.isimage||t.isdevtools||t.ismailcontent),handler:()=>{const s=Rs.Z.getSync("VALIDATION_URL");c.ZP.openURL(e.winId,s.replace("%s",t.pageurl),{inCurrent:!1,addOpenerTabId:!0})},...i(e.winId,n,t)};case"DOCUMENT_VIEW_SOURCE":{const s=t.isimage&&t.pageurl===t.srcurl;return{isVisible:()=>!s&&!t.isdevtools&&!t.ismailcontent,commandName:"DOCUMENT_VIEW_SOURCE",...i(e.winId,n,t)}}case"DOCUMENT_VIEW_FRAME_SOURCE":return{isVisible:()=>t.isframe&&!t.isdevtools&&!t.ismailcontent,commandName:"DOCUMENT_VIEW_FRAME_SOURCE",...i(e.winId,n,t)};case"DOCUMENT_RELOAD_FRAME":return{isVisible:()=>t.isframe&&!t.isdevtools&&!t.ismailcontent,commandName:"DOCUMENT_RELOAD_FRAME",...i(e.winId,n,t)};case"DOCUMENT_INSPECT":return{commandName:"DOCUMENT_INSPECT",isVisible:()=>!t.isdevtools,...i(e.winId,n,t)};default:return Promise.resolve({...i(e.winId,n,t)})}},k7=async(e,t,s,n)=>Promise.all(["DOCUMENT_VALIDATE_URL","DOCUMENT_VIEW_SOURCE","DOCUMENT_VIEW_FRAME_SOURCE","DOCUMENT_RELOAD_FRAME","DOCUMENT_INSPECT"].map((i=>E7(e,t,s,{id:"",type:"command",action:i},n)))),N7=e=>[{commandName:"DOCUMENT_LANGUAGE_SETTINGS",...(0,fi.Z)("Language Settings")}],_7=async(e,t,s,n,i)=>{switch(n.action){case"DOCUMENT_LOOK_UP":return{isVisible:()=>e.isMac&&t.printableselection.length>0&&!s,...i(e.winId,n,t)};case"DOCUMENT_COPY":case"DOCUMENT_PRINT":return{...i(e.winId,n,t)};case"DOCUMENT_CONTAINER_LINK_TO_HIGHLIGHT":return{container:{content:"linktohighlight"},isVisible:()=>!t.ismailcontent,...i(e.winId,n,t)};case"DOCUMENT_GOTO_URL":return{handler:()=>{c.ZP.openURL(e.winId,t.selectionurl,{inCurrent:!1,inBackground:A.Z.get(Z.kTabsOpenNewInBackground),addOpenerTabId:!0})},isVisible:()=>t.selectionurl.length>0,...i(e.winId,n,t)};case"DOCUMENT_SEARCH":case"DOCUMENT_SEARCH_LAST_USED":{const s=w7.Z.getSearchEngine(e.winId,"DOCUMENT_SEARCH_LAST_USED"===n.action);return s?{...A7(e.winId,t.selection,s),mnemonic:!0,...i(e.winId,n,t)}:(console.warn("No default search engine"),{isEnabled:()=>!1,...i(e.winId,n,t)})}case"DOCUMENT_CONTAINER_SEARCH_WITH":return{items:S7(e.winId,t.selection),...i(e.winId,n,t)};case"DOCUMENT_CONTAINER_EXTENSIONS":return{isVisible:()=>!t.iswebpanel&&!t.iswebpagewidget&&t.support.extensions&&!s,container:{content:"extensions"},...i(e.winId,n,t)};case"DOCUMENT_SEND_BY_MAIL":return{handler:()=>{ns.Z.createDraft({subject:t.pagetitle||t.pageurl,body:`${t.selection} \n\n ${t.pageurl}`})},isVisible:()=>wt.Z.isMailOn(),...i(e.winId,n,t)};case"COMMAND_COPY_SELECTION_TO_NOTE":{const s={...i(e.winId,n,t)};if(t.iswebpanel||t.iswebpagewidget||t.ismailcontent){const n=t.ismailcontent?se.Z.getActiveMessageUrl():t.pageurl;s.handler=()=>{Js.Z.createNote(e.winId,{content:t.selection,url:n,type:"note"})}}return s}case"COMMAND_APPEND_SELECTION_TO_NOTE":return{...i(e.winId,n,t),...t.ismailcontent?I7(e,0,t):null};case"DOCUMENT_ADD_EVENT_TO_CALENDAR":return{handler:()=>{ie.ZP.showAddEvent({winId:e.winId,title:t.selection,url:t.pageurl})},isVisible:()=>!e.isGuest&&wt.Z.isCalendarOn(),...i(e.winId,n,t)};case"DOCUMENT_ADD_TASK_TO_CALENDAR":return{handler:()=>{ie.ZP.showAddTask({winId:e.winId,title:t.selection,url:t.pageurl})},isVisible:()=>!e.isGuest&&wt.Z.isCalendarOn(),...i(e.winId,n,t)};case"DOCUMENT_ADD_INVITE_TO_CALENDAR":return{handler:()=>{ie.ZP.showAddInvite({winId:e.winId,title:t.selection,url:t.pageurl})},isVisible:()=>!e.isGuest&&wt.Z.isCalendarOn(),...i(e.winId,n,t)};case"DOCUMENT_CONTAINER_SPEECH":return{isVisible:()=>e.isMac,container:{content:"speech"},...i(e.winId,n,t)};case"COMMAND_FULLSCREEN":return{...i(e.winId,n,t),isVisible:()=>!s&&!t.iswebpagewidget};case"COMMAND_TRANSLATE_SELECTION":{const{id:s,url:a}=Ze.ZP.unsafeGetActivePage(e.winId);return{isVisible:()=>Nb.Z.canTranslateText(t.selection,a,s)&&!t.iswebpanel&&!t.iswebpagewidget,...i(e.winId,n,t),handler:()=>{jn.Z.translateSelection(e.winId,s,t.selection)}}}default:return b7.Z.actions().includes(n.action)?E7(e,t,s,n,i):Promise.resolve({...i(e.winId,n,t)})}},P7=async(e,t,s,n,i)=>{switch(n.action){case"DOCUMENT_OPEN_IMAGE_IN_TAB":return{isVisible:()=>!t.ismailcontent,...i(e.winId,n,t)};case"DOCUMENT_OPEN_IMAGE_IN_NEW_TAB":return{isVisible:()=>!e.isPopup,...i(e.winId,n,t)};case"DOCUMENT_OPEN_IMAGE_IN_NEW_BACKGROUND_TAB":return{isVisible:()=>!e.isPopup&&!A.Z.get(Z.kTabsOpenNewInBackground),...i(e.winId,n,t)};case"DOCUMENT_OPEN_IMAGE_IN_NEW_WINDOW":return{isVisible:()=>!e.isIncognito||e.isGuest,...i(e.winId,n,t)};case"DOCUMENT_OPEN_IMAGE_IN_PRIVATE_WINDOW":return{isVisible:()=>!e.isGuest,...i(e.winId,n,t)};case"DOCUMENT_CONTAINER_OPEN_IMAGE_IN_PROFILE":return{container:{content:"imageinprofile"},...i(e.winId,n,t)};case"DOCUMENT_SEARCH_FOR IMAGE":{const s=pn.Z.getImageSearch(),a=s?x7(s.faviconUrl):"";return{isVisible:()=>Boolean(s?.imageUrl),iconPNG:a,iconPNGWhite:a,...i(e.winId,n,t)}}case"DOCUMENT_SHOW_IMAGE_PROPERTIES":return{handler:async()=>{const s=Ze.ZP.getActivePage(e.winId);if(s){const n=s.windowId;if(Ze.ZP.isDisplayingImage(s.id))c.ZP.setImageInspector(s.id,n,!0);else{await c.ZP.openURL(e.winId,t.srcurl,{inCurrent:!1,transition:re.Z.historyPrivate.TransitionType.AUTO_TOPLEVEL,addOpenerTabId:!0}),await new Promise((t=>{const s=()=>{Ze.ZP.removeListener(s),t()};Ze.ZP.addListener(s,(t=>t.get(e.winId)))}));const s=Ze.ZP.getPages(n).last();c.ZP.setImageInspector(s.id,n,!0)}}},isVisible:()=>!e.isPopup,isEnabled:()=>t.isimage,...i(e.winId,n,t)};case"DOCUMENT_USE_IMAGE_AS_STARTPAGE_BACKGROUND":return{handler:()=>{On.Z.setThemeBackgroundImageFromUrl(e.winId,t.srcurl)},...i(e.winId,n,t)};case"DOCUMENT_CONTAINER_SEND_TO_DEVICES":return{isVisible:()=>!s&&t.support.sendtodevices,container:{content:"sendimagetodevices",icons:y7()},...i(e.winId,n,t)};case"DOCUMENT_QR_CODE":return{isVisible:()=>t.support.qrcode&&!t.iswebpagewidget&&!e.isPopup,...i(e.winId,n,t)};case"DOCUMENT_CONTAINER_TEXT_SELECTION":return t.selection.length>0?{items:await j7(e,t,!0),...i(e.winId,n,t)}:{items:[],isVisible:()=>!1,...i(e.winId,n,t)};case"DOCUMENT_CONTAINER_EXTENSIONS":return{isVisible:()=>!t.iswebpanel&&!t.iswebpagewidget&&t.support.extensions&&!s,container:{content:"extensions"},...i(e.winId,n,t)};case"COMMAND_FULLSCREEN":return{...i(e.winId,n,t),isVisible:()=>!s&&!t.iswebpagewidget};default:return b7.Z.actions().includes(n.action)?E7(e,t,s,n,i):Promise.resolve({...i(e.winId,n,t)})}},M7=async(e,t,s,n,i)=>{switch(n.action){case"DOCUMENT_CONTAINER_AV":return{items:T7(t),...i(e.winId,n,t)};case"DOCUMENT_CONTAINER_EXTENSIONS":return{isVisible:()=>!t.iswebpanel&&t.support.extensions&&!s,container:{content:"extensions"},...i(e.winId,n,t)};default:return b7.Z.actions().includes(n.action)?E7(e,t,!1,n,i):Promise.resolve({...i(e.winId,n,t)})}},D7=(e,t,s)=>{const n="image",i=ei.Z.getOptionFunction(n);return ei.Z.getNamedMenu(e.winId,n,(async n=>P7(e,t,s,n,i)))},O7=({winId:e},{linkurl:t})=>{const s=[],n=Ze.ZP.getActiveWorkspace(e),i=m_.Z.getState().filter((e=>e.id!==n));n&&s.push({handler:async()=>{await c.ZP.newTab(e,t,{workspaceId:void 0})},...(0,fi.Z)("This Window")});for(let n=0;n<i.length;n++){const a=i[n];s.push({handler:async()=>{const s=m_.Z.getWindowId(a.id)??e;await c.ZP.setActiveWorkspace(e,a.id),await c.ZP.newTab(s,t,{workspaceId:a.id,ignoreLinkRouting:!0})},label:a.name,labelEnglish:a.name})}return s},j7=(e,t,s)=>{const n="selection",i=ei.Z.getOptionFunction(n);return ei.Z.getNamedMenu(e.winId,n,(async n=>_7(e,t,s,n,i)))},L7={show:(e,t,s)=>{const i=(e,t,s,n)=>{(0,mi.Z)(e,s,void 0,"pointer",void 0,t,n)()},a={winId:e.vivaldiWindowId,isGuest:fe.ZP.isGuest(),isIncognito:fe.ZP.isIncognito(e.vivaldiWindowId),isPopup:fe.ZP.isPopup(e.vivaldiWindowId),isMac:!1};s.iseditable?"regular"===s.textfield?((e,t)=>{const s="uiedit",n=ei.Z.getOptionFunction(s);return ei.Z.getNamedMenu(e.winId,s,(async s=>{switch(s.action){case"DOCUMENT_CONTAINER_SPELLCHECK":return{container:{content:"spellcheck"},...n(e.winId,s,t)};case"DOCUMENT_LOOK_UP":return{isVisible:()=>e.isMac&&t.printableselection.length>0,...n(e.winId,s,t)};case"DOCUMENT_EMOJI":return{isVisible:()=>t.support.emoji,...n(e.winId,s,t)};case"DOCUMENT_CONTAINER_NOTES":return{container:{content:"notes"},isVisible:()=>!e.isGuest,...n(e.winId,s,t)};case"DOCUMENT_CONTAINER_SPELLCHECK_OPTIONS":return e.isMac?{isVisible:()=>t.support.editoptions,items:N7(),...n(e.winId,s,t)}:{isVisible:()=>t.support.editoptions,container:{content:"spellcheckoptions"},...n(e.winId,s,t)};case"DOCUMENT_CONTAINER_WRITING_DIRECTION":return{isVisible:()=>t.support.editoptions,items:Z7(),...n(e.winId,s,t)};case"DOCUMENT_CONTAINER_SPEECH":return{isVisible:()=>e.isMac,container:{content:"speech"},...n(e.winId,s,t)};case"COMMAND_COPY_SELECTION_TO_NOTE":return{...n(e.winId,s,t),isVisible:()=>!e.isGuest&&t.selection.length>0,handler:()=>{Js.Z.createNote(e.winId,{content:t.selection,url:"",type:"note"})}};case"COMMAND_APPEND_SELECTION_TO_NOTE":return{...n(e.winId,s,t),...I7(e,0,t)};case"COMMAND_TRANSLATE_SELECTION":{const{id:i,url:a}=Ze.ZP.unsafeGetActivePage(e.winId);return{isVisible:()=>Nb.Z.canTranslateText(t.selection,a,i),...n(e.winId,s,t),handler:()=>{jn.Z.translateSelection(e.winId,i,t.selection)}}}default:return Promise.resolve({...n(e.winId,s,t)})}}))})(a,s).then((s=>{i(e,t,s)})):["addressfield","searchfield"].includes(s.textfield)?((e,t)=>{const s="urledit",n=ei.Z.getOptionFunction(s);return ei.Z.getNamedMenu(e.winId,s,(async s=>{switch(s.action){case"DOCUMENT_CONTAINER_SPELLCHECK":return{container:{content:"spellcheck"},...n(e.winId,s,t)};case"DOCUMENT_LOOK_UP":return{isVisible:()=>e.isMac&&t.printableselection.length>0,...n(e.winId,s,t)};case"DOCUMENT_EMOJI":return{isVisible:()=>t.support.emoji,...n(e.winId,s,t)};case"COMMAND_CLIPBOARD_PASTE_AS_PLAIN_TEXT_OR_PASTE_AND_GO":return{...n(e.winId,s,t),isEnabled:()=>t.support.paste};case"DOCUMENT_CONTAINER_NOTES":return{container:{content:"notes"},isVisible:()=>!e.isGuest,...n(e.winId,s,t)};case"DOCUMENT_CONTAINER_SPELLCHECK_OPTIONS":return e.isMac?{isVisible:()=>t.support.editoptions,items:N7(),...n(e.winId,s,t)}:{isVisible:()=>t.support.editoptions,container:{content:"spellcheckoptions"},...n(e.winId,s,t)};case"DOCUMENT_CONTAINER_WRITING_DIRECTION":return{isVisible:()=>t.support.editoptions,items:Z7(),...n(e.winId,s,t)};case"DOCUMENT_CUSTOMIZE":const i="addressfield"===t.textfield?"addressbar":"search";return{isVisible:()=>!e.isGuest,handler:()=>ue.Z.showSettings(e.winId,i),...n(e.winId,s,t)};case"DOCUMENT_SHOW_FULL_ADDRESS":const a=A.Z.get(Z.kAddressBarShowFullUrl);return{isEnabled:()=>!e.isGuest,checked:a,isVisible:()=>"addressfield"===t.textfield,handler:()=>{I.Z.set(Z.kAddressBarShowFullUrl,!a)},...n(e.winId,s,t)};case"DOCUMENT_CONTAINER_SPEECH":return{isVisible:()=>e.isMac,container:{content:"speech"},...n(e.winId,s,t)};case"COMMAND_COPY_SELECTION_TO_NOTE":return{isVisible:()=>!e.isGuest&&t.selection.length>0,...n(e.winId,s,t),handler:()=>{Js.Z.createNote(e.winId,{content:t.selection,url:"",type:"note"})}};case"COMMAND_APPEND_SELECTION_TO_NOTE":return{...n(e.winId,s,t),...I7(e,0,t)};case"COMMAND_TRANSLATE_SELECTION":{const{id:i,url:a}=Ze.ZP.unsafeGetActivePage(e.winId);return{isVisible:()=>Nb.Z.canTranslateText(t.selection,a,i),...n(e.winId,s,t),handler:()=>{jn.Z.translateSelection(e.winId,i,t.selection)}}}default:return Promise.resolve({...n(e.winId,s,t)})}}))})(a,s).then((s=>{i(e,t,s)})):((e,t)=>{const s="docedit",n=ei.Z.getOptionFunction(s);return ei.Z.getNamedMenu(e.winId,s,(async s=>{switch(s.action){case"DOCUMENT_SUGGEST_PASSWORD":return{isVisible:()=>t.support.passwordgeneration,...n(e.winId,s,t)};case"DOCUMENT_SHOW_PASSWORDS":return{isVisible:()=>t.support.passwordshowall,handler:()=>ue.Z.showSettings(e.winId,"privacy"),...n(e.winId,s,t)};case"DOCUMENT_CONTAINER_SPELLCHECK":return{container:{content:"spellcheck"},...n(e.winId,s,t)};case"DOCUMENT_LOOK_UP":return{isVisible:()=>e.isMac&&t.printableselection.length>0,...n(e.winId,s,t)};case"DOCUMENT_EMOJI":return{isVisible:()=>t.support.emoji,...n(e.winId,s,t)};case"DOCUMENT_PASTE_AS_PLAIN_TEXT":return{isVisible:()=>t.support.editoptions,...n(e.winId,s,t)};case"DOCUMENT_ADD_AS_SEARCH_ENGINE":return{isVisible:()=>!e.isGuest&&!t.iswebpagewidget&&t.keywordurl.length>0,...n(e.winId,s,t)};case"DOCUMENT_CONTAINER_NOTES":return{container:{content:"notes"},isVisible:()=>!e.isGuest,...n(e.winId,s,t)};case"DOCUMENT_CONTAINER_SPELLCHECK_OPTIONS":return e.isMac?{isVisible:()=>t.support.editoptions,items:N7(),...n(e.winId,s,t)}:{isVisible:()=>t.support.editoptions,container:{content:"spellcheckoptions"},...n(e.winId,s,t)};case"DOCUMENT_CONTAINER_WRITING_DIRECTION":return{isVisible:()=>t.support.editoptions,items:Z7(),...n(e.winId,s,t)};case"DOCUMENT_SEARCH":case"DOCUMENT_SEARCH_LAST_USED":{const i=w7.Z.getSearchEngine(e.winId,"DOCUMENT_SEARCH_LAST_USED"===s.action);return i?{...A7(e.winId,t.selection,i),mnemonic:!0,isVisible:()=>t.selection.length>0,...n(e.winId,s,t)}:(console.warn("No default search engine"),{isVisible:()=>t.selection.length>0,isEnabled:()=>!1,...n(e.winId,s,t)})}case"DOCUMENT_CONTAINER_SEARCH_WITH":return{items:S7(e.winId,t.selection),isVisible:()=>t.selection.length>0,...n(e.winId,s,t)};case"DOCUMENT_CONTAINER_EXTENSIONS":return{isVisible:()=>!t.iswebpanel&&!t.iswebpagewidget&&t.support.extensions,container:{content:"extensions"},...n(e.winId,s,t)};case"DOCUMENT_CONTAINER_SPEECH":return{isVisible:()=>e.isMac,container:{content:"speech"},...n(e.winId,s,t)};case"DOCUMENT_GOTO_URL":return{handler:()=>{c.ZP.openURL(e.winId,t.selectionurl,{inCurrent:!1,inBackground:A.Z.get(Z.kTabsOpenNewInBackground),addOpenerTabId:!0})},isVisible:()=>t.selectionurl.length>0,...n(e.winId,s,t)};case"COMMAND_COPY_SELECTION_TO_NOTE":return{...n(e.winId,s,t),isVisible:()=>!e.isGuest&&t.selection.length>0,handler:()=>{const s=Ze.ZP.getActivePage(e.winId);s&&Js.Z.createNote(e.winId,{content:t.selection,url:s.url,type:"note"})}};case"COMMAND_APPEND_SELECTION_TO_NOTE":return{...n(e.winId,s,t),...I7(e,0,t)};case"COMMAND_TRANSLATE_SELECTION":{const{id:i,url:a}=Ze.ZP.unsafeGetActivePage(e.winId);return{isVisible:()=>Nb.Z.canTranslateText(t.selection,a,i)&&!t.iswebpagewidget,...n(e.winId,s,t),handler:()=>{jn.Z.translateSelection(e.winId,i,t.selection)}}}case"COMMAND_FULLSCREEN":return{...n(e.winId,s,t),isVisible:()=>!t.iswebpagewidget};default:return b7.Z.actions().includes(s.action)?E7(e,t,!1,s,n):Promise.resolve({...n(e.winId,s,t)})}}))})(a,s).then((s=>{i(e,t,s)})):s.linkurl.length>0?((e,t)=>{const s="link",i=ei.Z.getOptionFunction(s),a=ei.Z.getActionList("image")(),o=ei.Z.getActionList("selection")(),r=ei.Z.getActionList("audiovideo")();return ei.Z.getNamedMenu(e.winId,s,(async s=>{switch(s.action){case"DOCUMENT_OPEN_IN_NEW_TAB":case"DOCUMENT_OPEN_IN_TAB":return{isVisible:()=>!t.ismailto&&!e.isPopup,...i(e.winId,s,t)};case"DOCUMENT_OPEN_IN_NEW_WINDOW":return{isVisible:()=>!t.ismailto&&(!e.isIncognito||e.isGuest),...i(e.winId,s,t)};case"DOCUMENT_OPEN_IN_NEW_BACKGROUND_TAB":return{isVisible:()=>!t.ismailto&&!e.isPopup&&!A.Z.get(Z.kTabsOpenNewInBackground),...i(e.winId,s,t)};case"DOCUMENT_OPEN_IN_PRIVATE_WINDOW":return{isVisible:()=>!t.ismailto&&!e.isGuest,...i(e.winId,s,t)};case"DOCUMENT_CONTAINER_OPEN_IN_PWA":return{isVisible:()=>!t.ismailto,container:{content:"linkinpwa"},...i(e.winId,s,t)};case"DOCUMENT_CONTAINER_OPEN_IN_PROFILE":return{isVisible:()=>!t.ismailto,container:{content:"linkinprofile"},...i(e.winId,s,t)};case"DOCUMENT_CONTAINER_OPEN_IN_WINDOW":{const n=await ro.getMenu(e.winId,!1,[t.linkurl]);return{isVisible:()=>n.length>0,items:n,...i(e.winId,s,t)}}case"DOCUMENT_CONTAINER_OPEN_IN_WORKSPACE":return{isVisible:()=>!t.ismailto&&m_.Z.getState().length>0,items:O7(e,t),...i(e.winId,s,t)};case"DOCUMENT_ADD_LINK_TO_BOOKMARKS":return{handler:()=>{n.Z.bookmarks.create({parentId:g.Z.getRootId(),title:t.linktitle,url:t.linkurl})},isVisible:()=>!(t.ismailto||t.iswebpanel||t.iswebpagewidget||e.isGuest),...i(e.winId,s,t)};case"DOCUMENT_ADD_LINK_TO_WEBPANEL":return{handler:()=>{Ko.Z.addByUrl(e.winId,t.linkurl,!0)},isVisible:()=>!t.ismailto&&!t.iswebpanel&&!e.isGuest,...i(e.winId,s,t)};case"DOCUMENT_ADD_LINK_TO_READING_LIST":return{handler:()=>{R.IH(e.winId,t.linkurl,t.linktitle)},isVisible:()=>!e.isGuest,...i(e.winId,s,t)};case"DOCUMENT_SEND_LINK_BY_MAIL":return{handler:()=>{ns.Z.createDraft({subject:t.linktitle||t.linkurl,body:t.linkurl})},isVisible:()=>wt.Z.isMailOn(),...i(e.winId,s,t)};case"DOCUMENT_SAVE_LINK":return{isVisible:()=>!t.ismailto,...i(e.winId,s,t)};case"DOCUMENT_COPY_LINK_TEXT":return{isVisible:()=>!t.isimage&&t.linktitle.length>0,...i(e.winId,s,t)};case"DOCUMENT_CONTAINER_SEND_TO_DEVICES":return{isVisible:()=>t.support.sendtodevices,container:{content:"sendlinktodevices",icons:y7()},...i(e.winId,s,t)};case"DOCUMENT_CONTAINER_EXTENSIONS":return{isVisible:()=>!t.iswebpanel&&!t.iswebpagewidget&&t.support.extensions,container:{content:"extensions"},...i(e.winId,s,t)};case"DOCUMENT_CONTAINER_LINK_SELECTION":return t.selection.length>0&&!t.isimage&&!t.support.canvas?{items:await j7(e,t,!0),...i(e.winId,s,t)}:{items:[],isVisible:()=>!1,...i(e.winId,s,t)};case"DOCUMENT_CONTAINER_LINKED_IMAGE":return t.isimage||t.support.canvas?{items:await D7(e,t,!0),...i(e.winId,s,t)}:{items:[],isVisible:()=>!1,...i(e.winId,s,t)};case"COMMAND_FULLSCREEN":return{...i(e.winId,s,t),isVisible:()=>!t.iswebpagewidget};default:return b7.Z.actions().includes(s.action)?E7(e,t,!1,s,i):o.includes(s.action)?t.selection.length>0&&!t.isimage&&!t.support.canvas?_7(e,t,!1,s,i):{isVisible:()=>!1,...i(e.winId,s,t)}:a.includes(s.action)?t.isimage||t.support.canvas?P7(e,t,!1,s,i):{isVisible:()=>!1,...i(e.winId,s,t)}:r.includes(s.action)?t.support.audio||t.support.video?M7(e,t,!1,s,i):{isVisible:()=>!1,...i(e.winId,s,t)}:Promise.resolve({...i(e.winId,s,t)})}}))})(a,s).then((n=>{i(e,t,n,s)})):s.isimage||s.support.canvas?D7(a,s,!1).then((n=>{i(e,t,n,s)})):s.support.audio||s.support.video?((e,t)=>{const s="audiovideo",n=ei.Z.getOptionFunction(s);return ei.Z.getNamedMenu(e.winId,s,(async s=>M7(e,t,!1,s,n)))})(a,s).then((s=>{i(e,t,s)})):s.selection.length>0?j7(a,s,!1).then((n=>{i(e,t,n,s)})):s.ismailcontent?s.iswebpagewidget||((e,t)=>{const s="mailcontent",n=ei.Z.getOptionFunction(s);return ei.Z.getNamedMenu(e.winId,s,(async s=>{switch(s.action){case"COMMAND_PAGE_BACK":return{...n(e.winId,s,t),isVisible:()=>Ct.Z.canGoBack()};case"COMMAND_PAGE_FORWARD":return{...n(e.winId,s,t),isVisible:()=>Ct.Z.canGoForward()};case"COMMAND_TAB_VIEW_PAGE_SOURCE":return{checked:Boolean(se.Z.getIsRawMode()),...n(e.winId,s,t)};default:return b7.Z.actions().includes(s.action)?E7(e,t,!1,s,n):Promise.resolve({...n(e.winId,s,t)})}}))})(a,s).then((s=>{i(e,t,s)})):((e,t)=>{const s="page",n=ei.Z.getOptionFunction(s);return ei.Z.getNamedMenu(e.winId,s,(async s=>{switch(s.action){case"COMMAND_ADD_BOOKMARK":return{...n(e.winId,s,t),isVisible:()=>!t.iswebpanel&&!t.iswebpagewidget&&!e.isGuest};case"DOCUMENT_ADD_TO_WEBPANEL":return{handler:()=>{Ko.Z.addByUrl(e.winId,t.pageurl,!0)},isVisible:()=>!t.iswebpanel&&!e.isGuest,...n(e.winId,s,t)};case"DOCUMENT_SEND_BY_MAIL":return{handler:()=>{ns.Z.createDraft({subject:t.pagetitle||t.pageurl,body:t.pageurl})},isVisible:()=>wt.Z.isMailOn(),...n(e.winId,s,t)};case"DOCUMENT_COPY_ADDRESS":return{handler:()=>{jc.Z.copyUrlToClipboard(t.pageurl)},...n(e.winId,s,t)};case"DOCUMENT_CONTAINER_LINK_TO_HIGHLIGHT":return{isVisible:()=>t.support.highlight,container:{content:"linktohighlight"},...n(e.winId,s,t)};case"DOCUMENT_SAVE":case"DOCUMENT_CAST":return{isVisible:()=>!t.iswebpanel&&!t.iswebpagewidget,...n(e.winId,s,t)};case"DOCUMENT_QR_CODE":return{isVisible:()=>t.support.qrcode&&!t.iswebpagewidget,...n(e.winId,s,t)};case"DOCUMENT_CONTAINER_SEND_TO_DEVICES":return{isVisible:()=>t.support.sendtodevices,container:{content:"sendpagetodevices",icons:y7()},...n(e.winId,s,t)};case"DOCUMENT_CONTAINER_EXTENSIONS":return{isVisible:()=>!t.iswebpagewidget&&t.support.extensions,container:{content:"extensions"},...n(e.winId,s,t)};case"DOCUMENT_CONTAINER_PLUGIN_ROTATION":{const i=!t.iswebpanel&&!t.iswebpagewidget&&t.support.plugin;return{isVisible:()=>i,items:i?[{commandName:"DOCUMENT_ROTATE_CLOCKWISE",...(0,fi.Z)("Rotate Clockwise")},{commandName:"DOCUMENT_ROTATE_COUNTERCLOCKWISE",...(0,fi.Z)("Rotate Counterclockwise")}]:[],...n(e.winId,s,t)}}case"CONTAINER_PERIODIC_RELOAD":if(t.iswebpanel){const i=tn.ZP.getSelected(e.winId);return i&&tn.ZP.getIsWebPanel(i)?{...n(e.winId,s,t),items:Tm.Z.getMenu(i,"panel",e.winId)}:{isVisible:()=>!1,...n(e.winId,s,t)}}return{isVisible:()=>!t.iswebpagewidget,...n(e.winId,s,t)};case"COMMAND_FULLSCREEN":return{...n(e.winId,s,t),isVisible:()=>!t.iswebpagewidget};default:return b7.Z.actions().includes(s.action)?E7(e,t,!1,s,n):Promise.resolve({...n(e.winId,s,t)})}}))})(a,s).then((n=>{i(e,t,n,s)}))}},R7=L7;var B7=s(43656);function F7(e,t){const{body:s}=e;if(!s)return;const n=getComputedStyle(t.srcElement).getPropertyValue("user-select");if(!t.srcElement.matches("a[href], area[href], input:not([disabled]), select:not([disabled]), option:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]")&&"text"!==n&&"all"!==n){let n=t.target;for(;n!==s&&null!==n;){if(n.draggable){const t=e.activeElement,i=function(n){this.removeEventListener("mouseup",i),this.removeEventListener("dragend",i),e.activeElement===s&&t.focus()};return n.addEventListener("mouseup",i),void n.addEventListener("dragend",i)}n=n.parentElement}t.preventDefault()}}function W7(e){const{body:t}=e;if(!t)return nr.Z;const s=F7.bind(null,e);return t.addEventListener("mousedown",s),function(){t.removeEventListener("mousedown",s)}}let U7="";re.Z.utilities.onScroll.addListener((e=>{1===e?U7="mouse":2===e?U7="trackpad":3===e&&(U7="inertial")}));let V7="";function H7(e){this.vivaldiWindowId===e&&function(e){V7="";const t=Kf.getEntry(e).status;if(t){const{urlValid:e,isBrowserUrl:s}=re.Z.utilities.isUrlValid(t);e&&s&&(V7=t)}}(e)}function G7(e,t,s,n){if(this.vivaldiWindowId!==e)return;const i=Ye.Z.getCommandsForGestures();let a;if(V7&&(a=i["e"+n]),!a){if(a=i[n],!a)return;const o=Q7(this,t,s);if(o){const[t]=o;t.active||c.ZP.activateTab(t.id,e)}}const o=a[0];o.function({...(0,mi.m)("gesture",this),param:V7}),V7="",h.Z.setStatus(e,(0,W.Z)("Gesture: $1",[o.label]),3e3)}function K7(e,t,s,n,i){if(this.vivaldiWindowId!==e)return;const a=this.document.elementFromPoint(Math.round(n),Math.round(i));if(a&&"WEBVIEW"===a.tagName){t&&a.focus();const e=new MouseEvent(t?"mousedown":"mouseup",{button:s,clientX:n,clientY:i,bubbles:!0});a.dispatchEvent(e)}}let z7=null;function $7(){z7=setTimeout((()=>{z7=null}),100)}function Y7(e,t,s,n){if(this.vivaldiWindowId!==e||null!==z7||"inertial"===U7)return;let i;const a=qK.kG(e);if(a.count()>=2){const t=Q7(this,s,n,a);if(!t)return;const[o,r]=t;if(o.active||c.ZP.activateTab(o.id,e),vs.jk.isInternalPage(o))return;if("WEBVIEW"!==r.tagName)return void console.error("An external page has "+r.tagName+" tag when WEBVIEW was expected");i=r}else{const t=af.Z.getActiveWebView(e);if(!t)return;i=t}$7();const o=.1*t;i.getZoom((t=>{let s=Math.round(10*t)/10+o;s=Math.min(Math.max(s,.2),5),i.setZoom(s),"overlay"!==A.Z.get(Z.kStatusBarDisplay)&&A.Z.get(Z.kToolbarsStatus).includes("Zoom")||h.Z.setStatus(e,(0,W.Z)("Page Zoom $1%",[Math.round(100*s)]),2e3)}))}function X7(e){const t=this.vivaldiWindowId,s=e.target;if(s.classList.contains("UrlBar-UrlField")&&s.scrollWidth>=s.clientWidth&&s!==this.document.activeElement)return void e.preventDefault();if(!A.Z.get(Z.kMouseWheelTabSwitch)||function(e){return!1===e.altKey&&!1===e.ctrlKey&&!0===e.shiftKey&&!1===e.metaKey}(e))return;let n=!1;if(s.closest("div#tabs-tabbar-container")&&(n=!0),2===e.buttons||function(e){return!0===e.altKey&&!1===e.ctrlKey&&!1===e.shiftKey&&!1===e.metaKey}(e)||n){if(e.preventDefault(),"inertial"===U7)return;const s=e.wheelDelta;let n;if(s>0)n=1;else{if(!(s<0))return;n=-1}const i=false,a=i?"COMMAND_TAB_SWITCH_BACK_SETTING":"COMMAND_TAB_SWITCH_FORWARD_SETTING",o=i?"COMMAND_TAB_SWITCH_BACK_ORDER":"COMMAND_TAB_SWITCH_FORWARD_ORDER",r=i?"COMMAND_TAB_SWITCH_FORWARD_SETTING":"COMMAND_TAB_SWITCH_BACK_SETTING",l=i?"COMMAND_TAB_SWITCH_FORWARD_ORDER":"COMMAND_TAB_SWITCH_BACK_ORDER";let d;if("trackpad"===U7){if(null!==z7)return;$7(),d=n<0?2===e.buttons||e.altKey?a:o:2===e.buttons||e.altKey?r:l}else d=n<0?2===e.buttons||e.altKey?a:o:2===e.buttons||e.altKey?r:l;for(const s of oP.CN)if(s.name===d){s.action({origin:"gesture",context:this,windowId:t,keyState:{shiftKey:e.shiftKey,ctrlKey:e.ctrlKey,altKey:e.altKey,metaKey:e.metaKey,key:""},param:e});break}}}function Q7(e,t,s,n){n=n||qK.kG(e.vivaldiWindowId);for(const i of n){const n=e.document.getElementById(String(i.id));if(!n)continue;const a=n.getBoundingClientRect();if(a.left<=t&&t<a.right&&a.top<=s&&s<a.bottom)return[i,n]}return null}function q7(){const e=Un.useContext(oi.Z);return Un.useEffect((()=>{function t(t,s,n){t===e.vivaldiWindowId&&R7.show(e,s,n)}function s(t,s,n,i,a){t===e.vivaldiWindowId&&Qe.Z.handleShortcut(e,s,n,i,a,e.document.activeElement)}function n(t,s){A.Z.get(Z.kBiscuitLogRockerGestures)&&console.log("onRockerGesture",t,e.vivaldiWindowId,s),t===e.vivaldiWindowId&&ae.Z.handleRockerGesture(e,s)}re.Z.contextMenu.onDocumentMenu.addListener(t),re.Z.tabsPrivate.onKeyboardShortcut.addListener(s),re.Z.tabsPrivate.onRockerGesture.addListener(n);const i=function(e){const t={onDetection:H7.bind(e),onGesture:G7.bind(e),onClick:K7.bind(e),onZoom:Y7.bind(e),onWheel:X7.bind(e)};return re.Z.tabsPrivate.onMouseGestureDetection.addListener(t.onDetection),re.Z.tabsPrivate.onMouseGesture.addListener(t.onGesture),re.Z.tabsPrivate.onWebviewClickCheck.addListener(t.onClick),re.Z.tabsPrivate.onPageZoom.addListener(t.onZoom),e.document.addEventListener("wheel",t.onWheel,{passive:!1}),t}(e),a=B7.Z.attachSpatnavListeners(e.vivaldiWindowId),o=W7(e.document);return()=>{re.Z.contextMenu.onDocumentMenu.removeListener(t),re.Z.tabsPrivate.onKeyboardShortcut.removeListener(s),re.Z.tabsPrivate.onRockerGesture.removeListener(n),function(e,t){re.Z.tabsPrivate.onMouseGestureDetection.removeListener(t.onDetection),re.Z.tabsPrivate.onMouseGesture.removeListener(t.onGesture),re.Z.tabsPrivate.onWebviewClickCheck.removeListener(t.onClick),re.Z.tabsPrivate.onPageZoom.removeListener(t.onZoom),e.document.removeEventListener("wheel",t.onWheel,{passive:!1})}(e,i),B7.Z.detachSpatnavListeners(a),o()}}),[e]),(0,zn.jsx)("svg",{version:"1.1",width:"0",height:"0","aria-hidden":"true",dangerouslySetInnerHTML:{__html:s(46639)}})}var J7=s(80921),e9=s(80419),t9=s(34155);const s9=[Z.kAddressBarPosition,Z.kAppearanceDensity,Z.kBookmarksBarDisplay,Z.kBookmarksBarPosition,Z.kKeyboardTabToAll,Z.kKeyboardTabToAllUsesSystemDefault,Z.kMenuDisplay,Z.kMenuIconType,Z.kPanelsPosition,Z.kStatusBarDisplay,Z.kTabsAtEdge,Z.kTabsBarPosition,Z.kTabsBarWidth,Z.kTabsCloseButtonLeft,Z.kTabsStackingMode,Z.kTabsTilingCollapseBorder,Z.kThemesPreview,Z.kThemeUseAnimation,Z.kThemeDimBlurred,Z.kThemeSimpleScrollbar,Z.kThemesUser,Z.kWelcomeReadPages,Z.kWindowsLinuxAltControls,Z.kAddressBarVisible],n9=An.Z.call(),i9=!1;const a9=(0,Te.Z)(((e,t)=>{t?c.ZP.cycleByHistory(e,void 0,{goBack:!1}):c.ZP.cycleByOrder(e,void 0,{goBack:!1})}),0),o9=(0,Te.Z)(((e,t)=>{t?c.ZP.cycleByHistory(e,void 0,{goBack:!0}):c.ZP.cycleByOrder(e,void 0,{goBack:!0})}),0);var r9=(0,zn.jsx)(q7,{});class l9 extends Un.PureComponent{static contextType=oi.Z;refBookmarkAddedPopup=Un.createRef();refBreakmode=Un.createRef();refWebpageView=Un.createRef();refMainDialog=Un.createRef();isFirstStart=In.isFirstStart();hasNotch=!1;vpnObserver=new aj;constructor(e,t){super(e);const s=fe.ZP.getWindowState(t.vivaldiWindowId),{theme:n}=Ue.Z.getState(),i=Ue.Z.getState().windowStyles.get(t.vivaldiWindowId)||Si.ZP.getFallbackStyle(),a=Si.ZP.createClassnames(n,i);if(!s)throw new Error("MainWindow constructor: Expected windowState");const o=a6.getStartupDialogs(),r=Ze.ZP.getActivePage(t.vivaldiWindowId)?.url;this.state={bookmarkDialogParent:!1,bookmarkDialogOptions:null,capturing:Uo.getCapturingState(t.vivaldiWindowId),clearBrowsingHistoryOptions:null,confirmOpenLinksOptions:null,confirmCloseOtherTabs:null,onAfterCloseDialog:null,dialogCustomData:null,extensionErrors:[],importData:!1,isBreakModeActive:Io.Z.getState().isActive,isDraggingButton:!1,panelWidth:tn.ZP.getWidth(t.vivaldiWindowId)+6,mainDialogOptions:null,mainDialogType:null,openSession:!1,paneSelection:!1,preventAppRegionDrag:!1,quickCommandValue:"",saveSession:!1,saveSessionOptions:null,windowClassNames:a,windowStyle:i,windowState:s,theme:n,showPrivacyStats:!1,showBookmarkAddedPopup:!1,bookmarkAddedPopupOptions:null,startupDialogs:o,editToolbar:"",canShowContextDialog:!1,contextDialogQueue:[],contextDialog:null,hiddenUI:this.isFirstStart&&!!r&&(0,vs.IG)(r)},this._updateKeyUIMode(),this.trackContextOnFocus=Zq("content",t)}async componentDidMount(){const{selectWindow:e,vivaldiWindowId:t,screen:s}=this.context;$q.addListener(this._onMainStoreChanged),tn.ZP.addListener(this._onPanelStoreChanged),Uo.addListener(this.#hn),Io.Z.addListener(this.onBreakModeStoreChanged),Ue.Z.addListener(this.onThemeStoreChanged),xt.Z.addListener(this._onToolbarStoreChanged),fe.ZP.addListener(this._onWindowStoreChanged,e),Ze.ZP.addListener(this._onPageStoreChanged),a6.addListener(this._onStartupDialogsStoreChange),re.Z.windowPrivate.onToastMessage.addListener(this.onToast),re.Z.extensionActionUtils.onAdded.addListener(this.onActionAdded),re.Z.extensionActionUtils.onRemoved.addListener(this.onActionRemoved),re.Z.extensionActionUtils.onSidePanelOptionChanged.addListener(this.onSidepanelChanged),re.Z.extensionActionUtils.onExtensionDisabledInstallErrorAdded.addListener(this.onExtensionInstallErrorAdded),re.Z.extensionActionUtils.onExtensionDisabledInstallErrorRemoved.addListener(this.onExtensionInstallErrorRemoved),re.Z.extensionActionUtils.onSidePanelActionRequested.addListener(this.onSidePanelActionRequested),re.Z.utilities.onBroadcastMessage.addListener(this.onBroadcastMessageReceived),re.Z.utilities.onShowQRCode.addListener(this.onShowQRCode),re.Z.windowPrivate.onActiveTabStatusText.addListener(this._onActiveTabStatusText),this.#un(),re.Z.utilities.browserWindowReady(t),n.Z.contextMenus.removeAll(),this.vpnObserver.start()}componentDidUpdate(e,t){if(e.prefValues[Z.kThemesPreview].length<this.props.prefValues[Z.kThemesPreview].length){const e=Si.ZP.getPreview();let t={};try{e&&(t=Si.ZP.createStyle(e))}catch(e){console.warn("Broken theme format:",e)}e&&Object.keys(t).length?fe.ZP.isActive(this.context.vivaldiWindowId)&&this.showDialog({dialogtype:"themePreview",themeName:e?.name||"",isUpdate:this.props.prefValues[Z.kThemesUser].findIndex((t=>t.id===e?.id))>-1},null):fe.ZP.isActive(this.context.vivaldiWindowId)&&this.showDialog({dialogtype:"themePreviewFailed"},null)}else e.prefValues[Z.kThemesPreview].length>this.props.prefValues[Z.kThemesPreview].length&&this.handleOnCloseDialog()}componentWillUnmount(){this.vpnObserver.stop(),$q.removeListener(this._onMainStoreChanged),tn.ZP.removeListener(this._onPanelStoreChanged),Uo.removeListener(this.#hn),Io.Z.removeListener(this.onBreakModeStoreChanged),xt.Z.removeListener(this._onToolbarStoreChanged),fe.ZP.removeListener(this._onWindowStoreChanged),Ue.Z.removeListener(this.onThemeStoreChanged),Ze.ZP.removeListener(this._onPageStoreChanged),a6.removeListener(this._onStartupDialogsStoreChange),re.Z.windowPrivate.onToastMessage.removeListener(this.onToast),re.Z.utilities.onBroadcastMessage.removeListener(this.onBroadcastMessageReceived),re.Z.utilities.onShowQRCode.removeListener(this.onShowQRCode),re.Z.windowPrivate.onActiveTabStatusText.removeListener(this._onActiveTabStatusText),re.Z.extensionActionUtils.onAdded.removeListener(this.onActionAdded),re.Z.extensionActionUtils.onRemoved.removeListener(this.onActionRemoved),re.Z.extensionActionUtils.onSidePanelOptionChanged.removeListener(this.onSidepanelChanged),re.Z.extensionActionUtils.onExtensionDisabledInstallErrorAdded.removeListener(this.onExtensionInstallErrorAdded),re.Z.extensionActionUtils.onExtensionDisabledInstallErrorRemoved.removeListener(this.onExtensionInstallErrorRemoved),re.Z.extensionActionUtils.onSidePanelActionRequested.removeListener(this.onSidePanelActionRequested)}#un(){re.Z.extensionActionUtils.triggerGlobalErrors((e=>{this.setState({extensionErrors:e})}))}onSidepanelChanged=(e,t)=>{Ko.Z.updateByExtension(e,t)};onActionAdded=e=>{Ko.Z.addByExtension(this.context.vivaldiWindowId,e)};onActionRemoved=e=>{const t=Ko.Z.getExtPanelId(e);t&&(en.Z.setRemovedButton(this.context.vivaldiWindowId,Z.kToolbarsPanel,t),Ko.Z.removeByExtension(this.context.vivaldiWindowId,e))};onSidePanelActionRequested=(e,t)=>{if(fe.ZP.isActive(this.context.vivaldiWindowId)&&"show"===t)Ko.Z.showSidePanel(e,this.context.vivaldiWindowId)};onToast=(e,t)=>{this.context.vivaldiWindowId===e&&this.showDialog({dialogtype:"toast",text:t.body},null)};onExtensionInstallErrorAdded=e=>{this.setState((t=>({extensionErrors:t.extensionErrors.concat(e)})),(()=>{this.isFirstStart||this.showDialog({dialogtype:"extensionError",errors:this.state.extensionErrors},null)}))};onExtensionInstallErrorRemoved=e=>{this.setState((t=>{const s=t.extensionErrors.findIndex((t=>t.id===e.id));if(-1===s)return void console.info("onExtensionInstallErrorRemoved: Error not found from id.");const n=t.extensionErrors.slice();return n.splice(s,1),{extensionErrors:n}}))};#hn=()=>{const e=Uo.getCapturingState(this.context.vivaldiWindowId);e?this.clearAppRegion():this.restoreAppRegion(),this.setState({capturing:e})};onBreakModeStoreChanged=()=>{const e=Io.Z.getState().isActive;this.setState({isBreakModeActive:e})};onThemeStoreChanged=()=>{const e=this.context.vivaldiWindowId,t=Ue.Z.getState().windowStyles.get(e)||Si.ZP.getFallbackStyle(),{theme:s}=Ue.Z.getState();if(t!==this.state.windowStyle||s!==this.state.theme){const e=Si.ZP.createClassnames(s,t);this.setState({windowClassNames:e,windowStyle:t,theme:s})}};_onToolbarStoreChanged=()=>{this.setState({editToolbar:xt.Z.getState()})};onDragStart=e=>{e.dataTransfer.getData("vivaldi/x-button-toolbar")&&this.setState({isDraggingButton:!0})};onDragEnd=e=>{this.state.isDraggingButton&&this.setState({isDraggingButton:!1})};storeQuickCommandSearch=e=>{this.setState({quickCommandValue:e})};closeStartupDialog=e=>{Sn.closeDialog(e)};shouldShowStartupDialog=e=>!this.isFirstStart&&!fe.ZP.isIncognitoOrGuest(this.context.vivaldiWindowId)&&this.state.startupDialogs.includes(e);canShowContextDialog=e=>{const t=Ze.ZP.getActivePage(this.context.vivaldiWindowId);return 0===this.state.startupDialogs.length&&!fe.ZP.isIncognitoOrGuest(this.context.vivaldiWindowId)&&(e||!!t&&(e=>e===Ze.ZP.getStartpage(this.context.vivaldiWindowId))(t.url))};_onActiveTabStatusText=(e,t)=>{e===this.context.vivaldiWindowId&&h.Z.setStatus(e,t)};_updateKeyUIMode=()=>{const e=this.props.prefValues;if(e[Z.kKeyboardTabToAllUsesSystemDefault]){const t=this.props.prefValues[Z.kSystemMacKeyboardUiMode];2===t&&0!==e[Z.kKeyboardTabToAll]?I.Z.set(Z.kKeyboardTabToAll,0):0===t&&-1!==e[Z.kKeyboardTabToAll]&&I.Z.set(Z.kKeyboardTabToAll,-1)}};_allowPanelAutoClose=()=>null===this.state.mainDialogType||"MAIN_SHOW_TAB_CYCLER"===this.state.mainDialogType;_onMainStoreChanged=e=>{if(e.winId===this.context.vivaldiWindowId)switch(e.type){case"MAIN_SHOW_CONFIRM_OPEN_LINKS_DIALOG":this.showConfirmOpenLinksDialog(e.options);break;case"MAIN_SHOW_CONFIRM_CLOSE_OTHER_TABS_DIALOG":this.setConfirmCloseOtherTabsDialog(e.options);break;case"MAIN_SHOW_CLEAR_BROWSING_HISTORY_DIALOG":this.showClearBrowsingHistoryDialog();break;case"MAIN_SHOW_BOOKMARK_DIALOG":this.showBookmarkDialog(e.options);break;case"MAIN_SHOW_SAVE_SESSION_DIALOG":this.showSaveSession(e.options);break;case"MAIN_SHOW_OPEN_SESSION_DIALOG":this.showOpenSession();break;case"MAIN_SHOW_IMPORT_DATA_DIALOG":this.showDialog({dialogtype:"import"},null);break;case"MAIN_SHOW_MAIL_INFO_DIALOG":this.showDialog({dialogtype:"mailInfo"},null);break;case"MAIN_SHOW_PAGE_ACCESS_KEYS":{const t=Ze.ZP.getActivePage(this.context.vivaldiWindowId);t&&!(0,Ar.xl)(t.url)&&this.toggleMainDialog(e.type);break}case"MAIN_SHOW_KEYBOARDS_SHORTCUTS":case"MAIN_SHOW_QUICKCOMMANDS":case"MAIN_SHOW_MAIL_ACCOUNT_DIALOG":case"MAIN_SHOW_CALENDAR_ACCOUNT_DIALOG":case"MAIN_SHOW_CREATE_CALENDAR_DIALOG":case"MAIN_SHOW_CREATE_LABEL":case"MAIN_SHOW_LABEL_FLAG_DIALOG":case"MAIN_SHOW_SHARE_VIVALDI_DIALOG":this.toggleMainDialog(e.type);break;case"MAIN_SHOW_CALENDAR_EDIT_EVENT":case"MAIN_SHOW_CALENDAR_EDIT_TEMPLATE":case"MAIN_SHOW_CALENDAR_IMPORT_EVENTS_DIALOG":case"MAIN_SHOW_ENABLE_SESSION_AUTOSAVE_DIALOG":case"MAIN_SHOW_MAIL_AUTHENTICATION_DIALOG":case"MAIN_SHOW_MAIL_DELETE_DIALOG_ACCOUNTS":case"MAIN_SHOW_MAIL_DELETE_DIALOG_CONFIRM_ALL":case"MAIN_SHOW_MAIL_DELETE_DIALOG_FOLDERS":case"MAIN_SHOW_MAIL_UNSUBSCRIBE_DIALOG":case"MAIN_SHOW_MAIL_UPLOAD_CONFIRMATION":case"MAIN_SHOW_MAIL_MESSAGE_MOVE_CONFIRMATION":case"MAIN_SHOW_MAIL_CREATE_ARCHIVE_FOLDER_CONFIRMATION":case"MAIN_SHOW_TOOLBAR_RESET":case"MAIN_SHOW_ACCOUNT_SHEET":case"MAIN_SHOW_MODAL_INFO":case"MAIN_SHOW_ENABLE_WORKSPACE_DIALOG":case"MAIN_SHOW_INCLUDE_WORKSPACE_DIALOG":case"MAIN_SHOW_WORKSPACE_DIALOG":case"MAIN_SHOW_NOTE_SELECTION_DIALOG":case"MAIN_SHOW_MAIL_DELETE_DIALOG_SETTING":this.toggleMainDialog(e.type,e.options);break;case"MAIN_SHOW_ADD_FEED":case"MAIN_SHOW_ADD_MAIL_FOLDER":case"MAIN_SHOW_ADD_FEED_FOLDER":case"MAIN_SHOW_DELETE_LABEL_CONFIRMATION":case"MAIN_SHOW_DELETE_FILTER_CONFIRMATION":case"MAIN_SHOW_DELETE_FEED_CONFIRMATION":case"MAIN_SHOW_MAIL_VIEW_FILTER_CONFIRMATION":case"MAIN_SHOW_DELETE_MAIL_FOLDER":case"MAIN_SHOW_DELETE_FEED_FOLDER":case"MAIN_SHOW_DELETE_WORKSPACE":fe.ZP.isActive(this.context.vivaldiWindowId)&&this.toggleMainDialog(e.type,e.options);break;case"MAIN_SHOW_MODAL_DIALOG":case"MAIN_SHOW_CALENDAR_ALARM":this.state.mainDialogType!==e.type?this.toggleMainDialog(e.type,e.options):this.state.mainDialogOptions?.windowToRestore||"number"!=typeof e.options.windowToRestore||this.setState({mainDialogOptions:e.options});break;case"MAIN_SHOW_CONTEXT_DIALOG":this.maybeShowContextDialog(e.options.force,e.options.id);break;case"MAIN_SELECTING_TOOLBAR":this.setPaneSelection(e.options.enable);break;case"MAIN_SHOW_DIALOG":this.showDialog(e.options,e.onAfterClose);break;case"MAIN_SHOW_BOOKMARK_ADDED_POPUP":this.props.prefValues[Z.kAddressBarVisible]&&!fe.ZP.isMinimalUI(this.context.vivaldiWindowId)||this.showBookmarkAddedPopup(e.options);break;case"MAIN_SHOW_PRIVACY_STATS":this.showPrivacyStats()}};_onPanelStoreChanged=()=>{this.setState({panelWidth:tn.ZP.getWidth(this.context.vivaldiWindowId)+6})};onCloseMainDialog=()=>new Promise((e=>{this.setState({mainDialogType:null,mainDialogOptions:null},e)}));setPaneSelection=e=>{this.setState({paneSelection:e})};toggleMainDialog=(e,t)=>{this.state.mainDialogType===e?this.onCloseMainDialog():this.setState({mainDialogType:e,mainDialogOptions:t||null})};handleTabSwitcherActivation=e=>{const t=this.refMainDialog.current?.refVisualTabSwitcher.current;if(!e&&t){const e=t.state.selected;c.ZP.activateTab(e.id,this.context.vivaldiWindowId)}this.onCloseMainDialog()};switchTabVisualTabSwitcher=(e,t,s)=>{if(!s&&"wheel"!==e?.type)return void((e,t)=>{const s=A.Z.get(Z.kTabsCycleByRecentOrder);t?a9(e,s):o9(e,s)})(this.context.vivaldiWindowId,t);if(Ze.ZP.getPages(this.context.vivaldiWindowId).size<2)return;const{mainDialogType:n}=this.state;if("MAIN_SHOW_TAB_CYCLER"===n){const e=this.refMainDialog.current?.refVisualTabSwitcher.current;t?e?.selectForward():e?.selectBack()}else this.toggleMainDialog("MAIN_SHOW_TAB_CYCLER",{forward:t}),(0,e9.g)(e,this.handleTabSwitcherActivation,this.context.document)};_onWindowStoreChanged=()=>{const e=this.context.vivaldiWindowId,t=fe.ZP.getWindowState(e);t&&this.setState({windowState:t})};maybeShowContextDialog=(e,t)=>{const s=this.canShowContextDialog(e);(s||t)&&this.setState((n=>{const i=[...n.contextDialogQueue];t&&!i.includes(t)&&(e?i.unshift(t):i.push(t));return{contextDialog:!n.contextDialog&&s&&i.length?i.shift():n.contextDialog,contextDialogQueue:i,canShowContextDialog:s}}))};_onPageStoreChanged=()=>{if(this.maybeShowContextDialog(!1),!this.state.hiddenUI)return;const e=Ze.ZP.getActivePage(this.context.vivaldiWindowId)?.url;(Ze.ZP.getPages(this.context.vivaldiWindowId).size>1||e&&!(0,vs.IG)(e))&&this.setState({hiddenUI:!1})};_onStartupDialogsStoreChange=()=>{const e=a6.getStartupDialogs();this.setState({startupDialogs:e})};onBroadcastMessageReceived=e=>{e.startDragging?this.clearAppRegion():e.endDragging&&this.restoreAppRegion()};_onMacMenuAction=(e,t,s)=>{e!==this.context.vivaldiWindowId||fe.ZP.isMinimized(e)||Ye.Z.executeLocalAction(e,t,s)||ae.Z.executeActions("menu",this.context,t)};_onMacWindowDidChangeScreens=(e,t)=>{e===this.context.vivaldiWindowId&&(this.hasNotch=t)};clearAppRegion=()=>{this.setState({preventAppRegionDrag:!0})};restoreAppRegion=()=>{this.setState({preventAppRegionDrag:!1})};handleDoubleClick=()=>{"top"===this.props.prefValues[Z.kTabsBarPosition]&&this.state.windowState.nativeDecorations?c.ZP.openURL(this.context.vivaldiWindowId,""):fe.ZP.isMaximized(this.context.vivaldiWindowId)||(fe.ZP.isFullscreen(this.context.vivaldiWindowId),0)?Wn.Z.restore(this.context.vivaldiWindowId):Wn.Z.maximize(this.context.vivaldiWindowId)};closeConfirmOpenLinksDialog=()=>{this.setState({confirmOpenLinksOptions:null})};showConfirmOpenLinksDialog=e=>{this.setState({confirmOpenLinksOptions:e})};setConfirmCloseOtherTabsDialog=e=>{this.setState({confirmCloseOtherTabs:e})};showClearBrowsingHistoryDialog=()=>{fe.ZP.isIncognitoOrGuest(this.context.vivaldiWindowId)||this.setState({clearBrowsingHistoryOptions:!0})};closeClearBrowsingHistoryDialog=()=>{this.setState({clearBrowsingHistoryOptions:null})};closeImportContacts=()=>{this.setState({importData:Boolean(this.refWebpageView.current)})};showBookmarkDialog=e=>{this.setState({bookmarkDialogParent:Boolean(this.refWebpageView.current),bookmarkDialogOptions:e})};showBookmarkAddedPopup=e=>{this.setState({showBookmarkAddedPopup:!0,bookmarkAddedPopupOptions:e})};closeBookmarkDialog=()=>{this.setState({bookmarkDialogParent:!1})};onShowQRCode=e=>{this.showDialog({dialogtype:"qrcode",url:e},null)};closeSaveSession=()=>{this.setState({saveSession:!1})};showSaveSession=e=>{this.setState({saveSession:Boolean(this.refWebpageView.current),saveSessionOptions:e})};closeOpenSession=()=>{this.setState({openSession:!1})};showOpenSession=()=>{this.setState({openSession:Boolean(this.refWebpageView.current)})};showDialog=(e,t)=>{this.setState({dialogCustomData:e,onAfterCloseDialog:t})};showPrivacyStats=()=>{this.setState({showPrivacyStats:!0})};handleOnCloseDialog=()=>{this.setState({dialogCustomData:null}),t9.nextTick((()=>{this.state.onAfterCloseDialog?.()}))};hasHorizontalMenu=()=>Boolean("top"===this.props.prefValues[Z.kMenuDisplay]&&!0);showTitleBar=e=>{const{html5FullScreen:t,state:s,type:n}=e;return(0,qJ.v)(e)||t||"fullscreen"!==s&&("popup"===n||"settings"===n)};getBrowserClasses=(e,t)=>{const{prefValues:s}=this.props,{visibleUI:n,type:i,active:a,state:o,nativeDecorations:r}=t,{addressBar:l,bookmarksBar:d,tabs:c}=n,{windowClassNames:h,isBreakModeActive:u,isDraggingButton:p,preventAppRegionDrag:g,paneSelection:m,editToolbar:f}=this.state,v=s[Z.kTabsBarPosition],b=(0,fe.WV)(t),C="settings"===i,w="normal"===i,y="popup"===i,x="substrip"===s[Z.kTabsStackingMode],I="accordion"===s[Z.kTabsStackingMode],A="bottom"===v||"top"===v,S="maximized"===o||"fullscreen"===o,T=s[Z.kAddressBarPosition],E=s[Z.kBookmarksBarPosition],k=c&&w?v:"off",N=s[Z.kTabsAtEdge]&&!s[Z.kAppearanceDensity]&&A&&S,_=this.hasHorizontalMenu();return Gn()(n9,b,{...h,"minimal-ui":fe.ZP.isMinimalUI(e),"disable-titlebar":!this.showTitleBar(t),hasfocus:a,isblurred:!a,native:r,popup:y,"is-settingspage":C,RTL:F.ZP.isRTL(),"simple-scrollbar":s[Z.kThemeSimpleScrollbar],"density-on":s[Z.kAppearanceDensity],"dim-blurred":s[Z.kThemeDimBlurred],"horizontal-menu":_,[`menu-${s[Z.kMenuIconType]}`]:!_&&!0,"tabs-at-edge":N,alt:s[Z.kWindowsLinuxAltControls]&&false,"alt-tabs":s[Z.kTabsCloseButtonLeft],"substrip-tabs-on":x,"accordion-tabs-on":I,"full-key-access":0===s[Z.kKeyboardTabToAll],"break-mode":u,[`stacks-${s[Z.kTabsStackingMode]}`]:!0,[`address-${T}`]:l,[`address-${T}-off`]:!l,[`bookmark-bar-${E}`]:d,[`bookmark-bar-${E}-off`]:!d,[`tabs-${k}`]:!0,"narrow-tiling":s[Z.kTabsTilingCollapseBorder],"is-dragging-button":p,"no-app-dragging":g,"active-pane-selection":m,"animation-off":!s[Z.kThemeUseAnimation],"toolbar-edit-mode":""!==f,"first-start":this.state.hiddenUI&&In.shouldHideUI(),"first-start-animate":this.state.hiddenUI&&In.shouldAnimateUI()})};onInnerOver=e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"};onInnerClick=()=>ic.Z.stopEditing();onInnerDrop=e=>{e.preventDefault();const t=e.dataTransfer.getData(HJ),s=e.dataTransfer.getData(VJ);if("toolbar-editor"!==s){const e=[...A.Z.get(s)],n=e[t];e.splice(parseInt(t),1),nc.ZP.isWebPanel(n)&&Ko.Z.removeById(n,s),I.Z.set(s,e)}};render(){const e=this.props.prefValues,{capturing:t}=this.state,s=""!==this.state.editToolbar,n=e[Z.kTabsBarPosition],{html5FullScreen:i,state:a,visibleUI:o,inert:r=!1}=this.state.windowState,l="left"===n||"right"===n?{[`padding${(0,J7.Z)(n)}`]:e[Z.kTabsBarWidth]}:void 0,d="fullscreen"===a&&!(o.tabs&&"top"===n);return(0,zn.jsx)("div",{id:"browser",lang:F.ZP.UI_LANGUAGE,className:this.getBrowserClasses(this.context.vivaldiWindowId,this.state.windowState),style:this.state.windowStyle,onDragStart:s?this.onDragStart:null,onDragEnd:s?this.onDragEnd:null,onDrop:s?this.onDragEnd:null,children:(0,zn.jsxs)(Kd,{level:"nothing",children:[r9,(0,zn.jsxs)("div",{id:"header",onDoubleClick:this.handleDoubleClick,children:[this.showTitleBar(this.state.windowState)&&(0,zn.jsx)(W8,{isHidden:d,native:this.state.windowState.nativeDecorations,isPopupWindow:!1,tabPosition:o.tabs?n:"none",keyAccess:e[Z.kKeyboardTabToAll],inert:r}),this.hasHorizontalMenu()&&(0,zn.jsx)(e7,{inert:r}),("top"===n||!o.tabs)&&(0,zn.jsx)(B8,{switchTabVisualTabSwitcher:this.switchTabVisualTabSwitcher,mainDialogType:this.state.mainDialogType,tabPosition:n,theme:this.state.theme,visible:o.tabs,inert:r},"tabbar")]}),(0,zn.jsxs)("div",{id:"main",className:e[Z.kPanelsPosition],children:[(0,zn.jsx)(i0,{native:this.state.windowState.nativeDecorations,fullScreenState:false,size:"large",windowState:this.state.windowState}),o.bookmarksBar&&(0,zn.jsx)(yo,{display:e[Z.kBookmarksBarDisplay],statusOff:"off"===o.statusBar,keyAccess:e[Z.kKeyboardTabToAll],inert:r}),this.shouldShowStartupDialog("DIALOG_DEFAULT_BROWSER")&&(0,zn.jsx)(n6,{onClose:()=>this.closeStartupDialog("DIALOG_DEFAULT_BROWSER")}),(0,zn.jsxs)("div",{className:"inner",onClick:s?this.onInnerClick:null,onDragEnter:s?e=>e.preventDefault():null,onDragOver:s?this.onInnerOver:null,onDrop:s?this.onInnerDrop:null,children:[this.state.dialogCustomData&&(0,zn.jsx)(Hd,{customData:this.state.dialogCustomData,closeDialog:this.handleOnCloseDialog}),this.state.confirmOpenLinksOptions&&(0,zn.jsx)(sr,{options:this.state.confirmOpenLinksOptions,onRequestClose:this.closeConfirmOpenLinksDialog}),this.state.confirmCloseOtherTabs&&(0,zn.jsx)(tr,{options:this.state.confirmCloseOtherTabs,onRequestClose:()=>this.setConfirmCloseOtherTabsDialog(null)}),this.state.clearBrowsingHistoryOptions&&(0,zn.jsx)(er,{onClose:this.closeClearBrowsingHistoryDialog}),this.state.bookmarkDialogParent&&this.state.bookmarkDialogOptions&&(0,zn.jsx)(za,{onClose:this.closeBookmarkDialog,options:this.state.bookmarkDialogOptions}),this.state.saveSession&&this.state.saveSessionOptions&&(0,zn.jsx)(X5,{onClose:this.closeSaveSession,options:this.state.saveSessionOptions}),this.shouldShowStartupDialog("DIALOG_RAZER_CHROMA_FOUND")&&(0,zn.jsx)(K5,{onClose:()=>this.closeStartupDialog("DIALOG_RAZER_CHROMA_FOUND")}),this.shouldShowStartupDialog("DIALOG_INFORM_MEDIA_WIN_N")&&(0,zn.jsx)(tc,{onClose:()=>this.closeStartupDialog("DIALOG_INFORM_MEDIA_WIN_N")}),this.shouldShowStartupDialog("DIALOG_INFORM_GIT_DIRECTORY_FOUND")&&(0,zn.jsx)(Qd,{onClose:()=>this.closeStartupDialog("DIALOG_INFORM_GIT_DIRECTORY_FOUND")}),this.shouldShowStartupDialog("DIALOG_SEARCH_ENGINE_SWITCH")&&(0,zn.jsx)(t6,{onClose:()=>this.closeStartupDialog("DIALOG_SEARCH_ENGINE_SWITCH")}),this.shouldShowStartupDialog("DIALOG_EXTENSION_INSTALL_ERROR")&&(0,zn.jsx)(Nr,{errors:this.state.extensionErrors,onClose:()=>this.closeStartupDialog("DIALOG_EXTENSION_INSTALL_ERROR")}),this.state.openSession&&(0,zn.jsx)(l3,{onClose:this.closeOpenSession}),this.state.showPrivacyStats&&(0,zn.jsx)(U5,{onClose:()=>this.setState({showPrivacyStats:!1})}),(0,zn.jsx)(P5,{position:e[Z.kPanelsPosition],outsideClickIgnoreClass:"panel-clickoutside-ignore",editToolbar:s,canAutoClose:this._allowPanelAutoClose,inert:!s&&r},"panel"),(0,zn.jsx)("div",{className:"tabbar-wrapper",children:"left"===n&&o.tabs&&(0,zn.jsx)(B8,{switchTabVisualTabSwitcher:this.switchTabVisualTabSwitcher,mainDialogType:this.state.mainDialogType,tabPosition:n,theme:this.state.theme,visible:o.tabs,inert:r},"tabbar")},"webview-anchor"),(0,zn.jsx)("div",{ref:this.refWebpageView,id:"webview-container",role:"document",inert:r||s?"true":null,onFocus:this.trackContextOnFocus,children:(0,zn.jsx)(v7,{cycleFocus:A.Z.get(Z.kWebpagesFocusTrap)})}),!(0,Rp.PK)("StatusInfo",this.context.vivaldiWindowId)&&"off"!==e[Z.kStatusBarDisplay]&&!i&&(0,zn.jsx)(Yf,{name:"StatusOverlay",draggable:!1,style:{[e[Z.kPanelsPosition]]:this.state.panelWidth,...l}}),"right"===n&&o.tabs&&(0,zn.jsx)(B8,{switchTabVisualTabSwitcher:this.switchTabVisualTabSwitcher,mainDialogType:this.state.mainDialogType,tabPosition:n,theme:this.state.theme,visible:o.tabs,inert:r},"tabbar")]})]}),(0,zn.jsxs)("footer",{id:"footer",inert:!s&&r?"inert":null,children:["bottom"===n&&o.tabs&&(0,zn.jsx)(B8,{switchTabVisualTabSwitcher:this.switchTabVisualTabSwitcher,mainDialogType:this.state.mainDialogType,tabPosition:n,theme:this.state.theme,visible:!0,inert:r},"tabbar"),"on"===o.statusBar&&(0,zn.jsx)(zJ,{name:Z.kToolbarsStatus,label:(0,W.Z)("toolbar label","Status"),menuOrigin:"bottomLeft",className:"toolbar-statusbar",popupPosition:"above",size:"medium"})]}),this.state.mainDialogType&&(0,zn.jsx)(X1,{ref:this.refMainDialog,onClose:this.onCloseMainDialog,dialog:this.state.mainDialogType,options:this.state.mainDialogOptions,quickCommandValue:this.state.quickCommandValue,storeQuickCommandSearch:this.storeQuickCommandSearch}),this.state.contextDialog&&(0,zn.jsx)(yr,{winId:this.context.vivaldiWindowId,onClose:()=>{this.setState({canShowContextDialog:!1,contextDialog:null})},dialogId:this.state.contextDialog}),s&&(0,zn.jsx)(G8,{toolbar:this.state.editToolbar}),(0,zn.jsx)(Jb.Z,{classNames:"HUD",in:this.state.isBreakModeActive,mountOnEnter:!0,unmountOnExit:!0,timeout:{enter:500,exit:100},nodeRef:this.refBreakmode,children:(0,zn.jsx)("button",{ref:this.refBreakmode,className:"HUD",onClick:xo.Z.toggleBreakMode,dangerouslySetInnerHTML:{__html:Kn._qK.large}})}),!this.state.windowState.visibleUI.addressBar&&(0,zn.jsx)(Jb.Z,{in:this.state.showBookmarkAddedPopup,classNames:"Bookmark-Added-Popup",mountOnEnter:!0,unmountOnExit:!0,onExited:()=>this.setState({bookmarkAddedPopupOptions:null}),timeout:{enter:300,exit:150},nodeRef:this.refBookmarkAddedPopup,children:(0,zn.jsx)("div",{ref:this.refBookmarkAddedPopup,className:"Bookmark-Added-Popup",children:this.state.bookmarkAddedPopupOptions&&(0,zn.jsx)(Ba,{options:this.state.bookmarkAddedPopupOptions,onClose:()=>this.setState({showBookmarkAddedPopup:!1})})})}),t&&(0,zn.jsx)(Bo,{capturing:t,winId:this.context.vivaldiWindowId})]})})}}const d9=(0,zd.Z)(l9,s9);class c9 extends Un.Component{render(){const e=this.props.page;return(0,zn.jsx)("div",{className:"inner",children:(0,zn.jsx)(Aq,{id:e.id,pageContext:e.context,url:e.url,target:e.target,vivExtData:e.vivExtData,showImageInspector:e.showImageInspector,discarded:e.discarded,isVisible:!0,contentWidth:0,contentHeight:0,isActive:this.props.active,supportsReaderMode:e.supportsReaderMode,pinned:!1},`page-component-${e.id}`)})}}const h9=c9,u9=[Z.kAddressBarPosition,Z.kAppearanceDensity,Z.kKeyboardTabToAll,Z.kThemeDimBlurred,Z.kThemeSimpleScrollbar,Z.kThemeUseAnimation,Z.kWindowsLinuxAltControls];function p9(e){const{html5FullScreen:t,state:s,type:n}=e;return(0,qJ.v)(e)||t||"fullscreen"!==s&&("popup"===n||"settings"===n)}function g9(e){const{vivaldiWindowId:t,selectWindow:s}=e,[n,i]=Un.useState(!1);const a=(0,dS.Z)(Ue.Z),o=(0,dS.Z)(fe.ZP,s),r=(0,Eo.Z)(u9),l=o.get(t),{theme:d,windowStyles:c}=a,h=c.get(t);if(!l||!h)return;const u=function(e,t,s,n,i){const{visibleUI:a,type:o,active:r,nativeDecorations:l}=t,d=n[Z.kAddressBarPosition],c=(0,fe.WV)(t);return Gn()(An.Z.call(),c,{...s,"minimal-ui":(0,fe.TF)(t),"disable-titlebar":!p9(t),hasfocus:r,isblurred:!r,native:l,normal:!1,popup:"popup"===o,"is-settingspage":"settings"===o,"simple-scrollbar":n[Z.kThemeSimpleScrollbar],"density-on":n[Z.kAppearanceDensity],"dim-blurred":n[Z.kThemeDimBlurred],"animation-off":!n[Z.kThemeUseAnimation],alt:n[Z.kWindowsLinuxAltControls]&&!1,[`address-${d}`]:a.addressBar,[`address-${d}-off`]:!a.addressBar,"tabs-off":!0})}(0,l,Si.ZP.createClassnames(d,h),r);return{windowStyle:h,titleBarEnabled:p9(l),className:u,keyAccess:r[Z.kKeyboardTabToAll],nativeDecorations:l.nativeDecorations}}var m9=(0,zn.jsx)(q7,{});function f9(e){const t=g9(Un.useContext(oi.Z));if(!t)return null;const{className:s,titleBarEnabled:n,windowStyle:i,keyAccess:a,nativeDecorations:o}=t;return(0,zn.jsxs)("div",{id:"browser",style:i,className:s,children:[m9,(0,zn.jsx)("div",{id:"header",children:n&&(0,zn.jsx)(W8,{isHidden:!1,tabPosition:"none",isPopupWindow:!0,keyAccess:a,native:o,inert:!1})}),(0,zn.jsx)("div",{id:"main",children:(0,zn.jsx)(Kd,{level:"title_bar",children:e.children})})]})}const v9=[Z.kAddressBarPosition];function b9(e){const t=Ze.ZP.unsafeGetActivePage(e);return{page:t,url:t.url,id:t.id,active:fe.ZP.isActive(e),favIconUrl:t.favIconUrl}}class C9 extends Un.PureComponent{static contextType=oi.Z;state=b9(this.context.vivaldiWindowId);componentDidMount(){const{selectWindow:e}=this.context;Ze.ZP.addListener(this.onPageStoreChanged,e),fe.ZP.addListener(this.onWindowStoreChanged,e),this.updateTitle()}componentWillUnmount(){Ze.ZP.removeListener(this.onPageStoreChanged),fe.ZP.removeListener(this.onWindowStoreChanged)}onWindowStoreChanged=()=>{this.setState({active:fe.ZP.isActive(this.context.vivaldiWindowId)})};onPageStoreChanged=()=>{this.setState(b9(this.context.vivaldiWindowId),(()=>{this.updateTitle()}))};updateTitle=()=>{const e=(0,vs.d6)(this.state.page.url,this.state.page.title);this.context.document.title!==e&&(this.context.document.title=e)};_onMacMenuAction=(e,t,s)=>{e!==this.context.vivaldiWindowId||fe.ZP.isMinimized(e)||Ye.Z.executeLocalAction(e,t,s)||ae.Z.executeActions("menu",this.context,t)};render(){const e="top"===this.props.prefValues[Z.kAddressBarPosition],t=e?"bottomLeft":"topLeft",s=e?"below":"above";return(0,zn.jsxs)(f9,{children:[(0,zn.jsx)("div",{className:"mainbar",children:(0,zn.jsxs)("div",{className:"toolbar toolbar-mainbar toolbar-large",children:[(0,zn.jsx)(Mq,{readonly:!0,url:this.state.url,id:this.state.id,pageContext:this.state.page.context,supportsReaderMode:this.state.page.supportsReaderMode,isReaderModeActive:Boolean(this.state.page.vivExtData.readerMode),active:this.state.active,favIconUrl:this.state.favIconUrl,popupPosition:s,menuOrigin:t}),(0,zn.jsx)(qu.C,{name:"Extensions",customizeMenu:()=>[],size:"large",popupPosition:s,menuOrigin:t})]})}),0!==this.state.id&&(0,zn.jsx)(h9,{page:this.state.page,active:this.state.active})]})}}const w9=(0,zd.Z)(C9,v9);function y9(e){const t=Un.useContext(oi.Z);return Un.useEffect((()=>{function e(e){I.Z.set(Z.kSettingsSizeWidth,Math.max(t.outerWidth,u.MK)),I.Z.set(Z.kSettingsSizeHeight,Math.max(t.outerHeight,u.mR)),I.Z.set(Z.kSettingsSizeLeft,t.screenLeft),I.Z.set(Z.kSettingsSizeTop,t.screenTop)}return re.Z.windowPrivate.onWindowClosed.addListener(e),()=>{re.Z.windowPrivate.onWindowClosed.removeListener(e)}}),[t]),(0,zn.jsx)(f9,{children:(0,zn.jsx)("div",{className:"webpageview",children:(0,zn.jsx)(SV,{url:fV+e.settingsCategory,isActive:!0})})})}class x9 extends Un.PureComponent{state={appElm:void 0,contentWindow:void 0};onAppWindowCreated=async(e,t)=>{const s=t.document;if(!s.body)return void console.error(`Application document creation failed: ${e}`);const n=s.body.appendChild(s.createElement("div"));n.id="app",this.setState({appElm:n,contentWindow:t})};onWebContentsHasWindow=async(e,t)=>{if(e===this.props.windowId){if(re.Z.windowPrivate.onWebContentsHasWindow.removeListener(this.onWebContentsHasWindow),t||(t=n.Z.extension.getViews().find((t=>t.vivaldiWindowId===e))),!t)throw new Error("BrowserWindow ContentWindow does not exist.");await this.onAppWindowCreated(e,t)}};componentDidMount(){const e=n.Z.extension.getViews().find((e=>e.vivaldiWindowId===this.props.windowId));e&&this.props.windowId?this.onWebContentsHasWindow(this.props.windowId,e):re.Z.windowPrivate.onWebContentsHasWindow.addListener(this.onWebContentsHasWindow)}componentWillUnmount(){const{contentWindow:e}=this.state;e?e.close():console.error("WindowPortal.componentWillUnmount: Expected to find contentWindow")}render(){const{appElm:e,contentWindow:t}=this.state;return e&&t?HZ.createPortal((0,zn.jsx)(oi.Z.Provider,{value:t,children:(0,zn.jsx)(Kd,{level:"nothing",children:this.props.children})}),e):null}}const I9=x9;var A9=(0,zn.jsx)(d9,{}),S9=(0,zn.jsx)(w9,{});class Z9 extends Un.PureComponent{state={windows:fe.ZP.getState()};componentDidMount(){fe.ZP.addListener(this._onWindowStoreChanged)}componentWillUnmount(){fe.ZP.removeListener(this._onWindowStoreChanged)}_onWindowStoreChanged=()=>{const e=fe.ZP.getState();e.size!==this.state.windows.size&&this.setState({windows:e})};renderWindows=()=>{const e=[];for(const[t,s]of this.state.windows){let n;"normal"===s.type?n=A9:"popup"===s.type?n=S9:"settings"===s.type&&(n=(0,zn.jsx)(y9,{settingsCategory:fe.ZP.settingsCategory})),n&&e.push((0,zn.jsx)(I9,{windowId:t,children:n},t))}return e};render(){return(0,zn.jsx)("div",{lang:F.ZP.UI_LANGUAGE,children:this.renderWindows()})}}const T9=Z9;var E9=s(11795),k9=s.n(E9);const N9=function(){const e=g.Z.getSpeeddialFolders();if(!e||0===e.length||!e[0].children)return;const t=e[0].children.map((e=>e.url?{title:e.title,url:e.url}:void 0)).filter(Boolean);re.Z.bookmarksPrivate.updateSpeedDialsForWindowsJumplist(t)};const _9={start:function(){N9(),g.Z.addListener(N9)}};s(34155);function P9(e,t){return e.displayName=t,k9().log(e)()}function M9(e,t){const s=Date.now(),n=e(),i=Date.now();return console.log(`Non-promise from ${t||"[anonymous]"} with time ${i-s} ms`),n}navigator.serviceWorker?.ready.then((()=>rs.Z.open()));async function D9(){const e=await re.Z.utilities.getSystemDateFormat();e.longDateFormat&&V().defineLocale(F.ZP.fixMomentLocale(n.Z.i18n.getUILanguage())+"-viv",F.ZP.getLocale(e))}console.time("JS init startup"),(0,C.MD)();try{if(!a)throw new Error("Expected portalWindow to be defined");const e=document.getElementById("portals");if(!e)throw"No root element.";!async function(e){S.Z.reorderRegistrations([se.Z,qt,Rt,Ze.ZP,tn.ZP]),window.isGuestSession=await re.Z.runtimePrivate.isGuestSession(),await Promise.all([P9(A.Z.loadPromise,"PrefsCache").then((()=>P9(Rs.Z.loadPromise,"vivaldiSettings"))).then((()=>Promise.all([en.Z.init(),P9(Wn.Z.loadPromise,"WindowActions").then((()=>P9(On.Z.loadPromise,"ThemeActions"))),P9(pn.Z.load,"SearchEngineCache")]))),P9(Fn.Z.loadPromise,"VivaldiFeatureFlags"),P9(Pe.loadPromise,"ExtensionActions"),D9()]),$e.Z.load(),c.ZP.load(),GB.Z.init();const t=(0,Q6.createRoot)(e);await new Promise((e=>t.render((0,zn.jsx)(T9,{ref:e})))),Me.Z.initFastForward(),hn.Z.init(),jn.Z.init();const s=window.isGuestSession?Promise.resolve():P9(ne.Z.loadPromise,"BookmarkActions");await Promise.all([P9((()=>he.loadPromise().then((()=>P9(ae.Z.loadPromise,"CommandActions")))),"ContentScriptActions"),P9(st.Z.loadPromise,"Menu"),P9(Js.Z.loadPromise,"NoteActions"),s,P9(Le.loadPromise,"HistoryActions"),P9(En.loadPromise,"SyncActions"),P9(Ln.Z.loadPromise,"TrashActions"),P9(Bn.loadPromise,"VivaldiAccountActions"),P9(dF.Z.loadPromise,"WorkspaceLinkRoutingActions"),M9(T,"DashboardActions"),M9(B,"StickyNoteActions"),M9(X,"TimerActions"),M9(ee,"WeatherActions"),M9(R.S1,"ReadingListActions"),P9(sn.Z.load,"PeriodicReloadActions"),P9(gn.Z.loadPromise,"SessionActions"),P9(ze.loadPromise,"HueActions")&&void 0,P9(_e.Z.load,"DownloadActions")&&void 0,P9((()=>qs.startPortalLoad()),"Mail")&&void 0,P9(Dn.loadPromise,"SyncedTabsActions"),P9(Ne.init,"ContextDialogActions"),P9(bn.loadPromise,"SharedLinksActions")]),M9(_9.start,"updateJumplist"),n.Z.extension.inIncognitoContext||(P9(Sn.init,"StartupDialogsActions"),ie.ZP.init(),un.initPortalDocument()),(0,Sg.i9)(),cn.init(),re.Z.utilities.cleanUnusedImages(0),console.timeEnd("JS init startup")}(e)}catch(e){console.log("Startup Process Failure: "+e)}},16682:(e,t,s)=>{"use strict";s.d(t,{Z:()=>p});var n=s(92292),i=s(89175),a=s(29087),o=s(44850);function r(){const e=["caption","emoji","hidden","invisible","sr-only","visually-hidden","visuallyhidden","wp-caption","wp-caption-text","wp-smiley"];function t(){return document&&document.documentElement&&document.documentElement.style}t()&&(document.documentElement.style.display="none");let s=5;function n(){!window.Readability&&s-- >-1&&setTimeout(n,500);try{if(!window.Readability)return;const{Readability:s}=window,n=new s(document.cloneNode(!0),{classesToPreserve:e,charThreshold:300,debug:false}),i=window.isProbablyReaderable(document);let a;if(i?a=n.parse():console.log("[readability] Probably not readable"),a){document.beforeunload=()=>{},document.unload=()=>{};const e=document.implementation.createHTMLDocument(document.title);e.documentElement.innerHTML=function(e){const t=window.DOMPurify.sanitize(e.content),s=e.textContent.split(" ").filter((e=>e.length&&!/\r?\n|\r/.test(e))),n=Math.round(s.length/225),i=(0,window.Translate)("Read time: $1 minute","Read time: $1 minutes",[n]),a=e.byline?`${e.byline} — `:"",o=e.dir??"auto";return`<!DOCTYPE html>\n<html><head>\n<title>${e.title}</title>\n<style>\nhtml {\n  margin: 0;\n  padding: 0;\n}\nbody {\n  color: #111111;\n  background-color: #f6f6f6;\n  font-family: sans-serif;\n  font-size: 1.3em;\n  font-style: normal;\n  font-weight: 400;\n  line-height: 1.5;\n  margin: 0 auto;\n  padding: 40px 10px 80px;\n  text-orientation: upright;\n  transition:\n    color 200ms cubic-bezier(0.4, 0, 1, 1),\n    background-color 200ms cubic-bezier(0.4, 0, 1, 1);\n}\nbody.vertical {\n  margin: 40px auto 0;\n  padding: 40px 60px 0;\n  max-height: calc(100vh - 120px);\n}\n.entry-content * {\n  max-width: 100%;\n  line-height: inherit;\n  vertical-align: baseline;\n  background: transparent;\n}\n.entry-content p {\n  margin: 1.5em 0;\n}\nbody.vertical .entry-content p {\n  margin: 0 1.5em;\n}\nh1 {\n  font-size: 1.8em;\n  line-height: 1.35;\n}\nh1, h2, h3, h4, h5, h6, b {\n  font-weight: 700;\n}\nhr {\n  border-style: solid;\n  border-width: 0 0 0.5px 0.5px;\n}\n.byline,\n.figcaption {\n  font-style: italic;\n}\n.entry-content img {\n  max-width: 100%;\n  height: auto;\n}\nbody.vertical .entry-content img {\n  max-height: 100%;\n  width: auto;\n}\n.entry-content code {\n  font-weight: 500;\n}\n.entry-content pre {\n  font-weight: 300;\n  background-color: rgba(128, 128, 128, 0.05);\n  border: 1px solid rgba(128, 128, 128, 0.1);\n  white-space: pre-wrap;\n  padding: 0.5em;\n  margin: 1.5em 0;\n}\n.entry-content code, .entry-content pre {\n  text-align: left;\n  max-width: 100%;\n  writing-mode: horizontal-tb;\n  overflow: auto;\n  white-space: pre-wrap;\n}\nbody.vertical .entry-content pre {\n  margin: 0 1.5em;\n  max-width: 80%;\n  max-height: 100%;\n}\nblockquote {\n  border-left: 2px solid currentColor;\n  padding-left: 1em;\n  margin-left: 0;\n}\nblockquote p {\n  font-style: italic;\n}\niframe, textarea, input {\n  display: none;\n}\n\n.entry-content img.wp-smiley,\n.entry-content img.emoji {\n  display: inline-block;\n  border-width: 0;\n  width: 1em;\n  margin: 0 .07em;\n  padding: 0;\n}\n\n.entry-content .visually-hidden,\n.entry-content .visuallyhidden,\n.entry-content .sr-only {\n  display: inline-block;\n  width: 1px;\n  height: 1px;\n  margin: -1px;\n  overflow: hidden;\n  padding: 0;\n  border-width: 0;\n}\n\n.entry-content .caption,\n.entry-content .wp-caption-text,\n.entry-content figcaption {\n  font-size: 0.9em;\n  line-height: 1.48em;\n  font-style: italic;\n}\n</style>\n</head><body>\n<h1>${e.title}</h1><p class="byline">${a} ${i}</p><hr />\n<article class="entry-content" dir="${o}">${t}</article>\n</body></html>`}(a),document.replaceChild(e.documentElement,document.documentElement),window.chrome&&window.chrome.runtime&&window.chrome.runtime.sendMessage?window.chrome.runtime.sendMessage({type:"READER_MODE_UPDATE_STYLE"}):console.log("Reader is unable to notify Vivaldi")}else console.log("[readability] Nothing to show")}finally{t()&&(document.documentElement.style.display="block")}}"undefined"!=typeof document&&["complete","loaded","interactive"].indexOf(document.readyState)>-1?n():window.addEventListener("DOMContentLoaded",n,!1)}function l(e,t){if(!t.url||(0,o.cw)(t.url))return;if(n.Z.scripting.executeScript({args:[a.Z.get(i.kRssDetectFeeds),a.Z.get(i.kWebpagesAllowSelectionInLinks),!!t.url&&!(0,o.pM)(t.url)],target:{tabId:e,allFrames:!0},func:(e,t,s)=>(window.__vivaldiDetectFeeds=e,window.__vivaldiUseBossSelect=t,window.__vivaldiUseTranslateSelection=s,[window.__vivaldiContentScriptsInitialized,window.__vivaldiRootFrameScriptsInitialize])}).then((t=>{if(!t)return;const s=t.filter((e=>!e.result[0])).map((e=>e.frameId)),i=t.find((e=>0===e.frameId));i&&!i.result[1]&&n.Z.scripting.executeScript({target:{tabId:e,allFrames:!1},files:["inject-root-bundle.js"]}).catch((e=>{})),s.length>0&&n.Z.scripting.executeScript({target:{tabId:e,frameIds:s},files:["inject-all-bundle.js"]}).catch((e=>{}))})).catch((e=>{})),!t.vivExtData)return;JSON.parse(t.vivExtData).readerMode&&n.Z.scripting.executeScript({target:{tabId:e,allFrames:!1},function:r}).catch((e=>{}))}const d=new Map;function c(e){return!!d.has(e)&&(clearTimeout(d.get(e)),d.delete(e),!0)}function h(e,t,s){"loading"===t.status&&(c(e),d.set(e,setTimeout((()=>{d.delete(e),l(e,s)}),3e3))),"complete"===t.status&&c(e)&&l(e,s)}function u(e,t){c(e)}const p={load:function(){n.Z.tabs.onUpdated.addListener(h),n.Z.tabs.onRemoved.addListener(u)},injectScripts:l}},63164:(e,t,s)=>{"use strict";s.d(t,{Tg:()=>o,VN:()=>a,eL:()=>r});var n=s(92292);const i=new Map;function a(e,t,s){return n.Z.tabs.sendMessage(e,t,s)}function o(e){const t=(t,s,i)=>{n.Z.runtime.id===s.id&&e(t,s,i)};return i.set(e,t),n.Z.runtime.onMessage.addListener(t)}function r(e){const t=i.get(e);t&&(n.Z.runtime.onMessage.removeListener(t),i.delete(e))}},58379:(e,t,s)=>{"use strict";s.d(t,{Z:()=>i});var n=s(92292);function i(){return n.Z.topSites.get().catch((()=>[]))}},27770:(e,t,s)=>{"use strict";s.d(t,{ZP:()=>w,yR:()=>b});var n=s(59486),i=s(46382),a=s(59322),o=s(96951),r=s(29087),l=s(63153),d=s(92292),c=s(98010),h=s(45454),u=s(7064),p=s(1407),g=s(30460),m=s(36436),f=s(44850),v=s(89175);const b="vivaldi/x-bookmarks";const C={openUrls:function(e,t,s,n){const i=t.map((e=>({...this.getEmptyNode(),url:e})));this.open(e,i,s,n)},open:function(e,t,s,d){const c=s?.transition??u.Z.historyPrivate.TransitionType.AUTO_BOOKMARK;if(d&&r.Z.get(v.kBookmarksConfirmOpening)&&t.length>=r.Z.get(v.kBookmarksConfirmOpeningThreshold))i.Z.showConfirmOpenLinksDialog(e,{urls:t.map((({url:e})=>e)).filter(Boolean),openOptions:{inCurrent:s.inCurrent,inNewWindow:s.inNewWindow,inBackground:s.inBackground,incognito:s.incognito,transition:s.transition}});else{let i=!1===s.inCurrent;const d=!0===s.inNewWindow;let h=!0===s.inBackground;const u=!0===s.incognito;if(!1===i&&!1===d&&!1===h&&(!0===r.Z.get(v.kBookmarksOpenInNewTab)&&(i=!0,!0===r.Z.get(v.kTabsOpenNewInBackground)&&(h=!0)),1===t.length&&(t[0].url||"").startsWith("javascript:")&&(i=!1)),!0===d){0;const s=t.map((e=>e.url)).filter(Boolean).filter((e=>n.Z.filterUrl(e).length>0));l.Z.openBrowserWindow(e,s,{incognito:u,transition:c})}else{let s=t.filter((e=>e.url&&n.Z.filterUrl(e.url).length>0));"directrightofcurrent"===r.Z.get(v.kTabsNewPlacement)&&(i?s.reverse():(s=[s[0],...s.toSpliced(0,1).toReversed()],h=!0));const l=s.length-1;s.forEach(((t,s)=>{i?function(e,t,s,n){const i={bookmarkId:t.id,inCurrent:!1,inBackground:s,transition:n};r.Z.get(v.kTabsStackingOpenInCurrent)&&(i.groupId=o.ZP.getActiveGroupId(e)),a.ZP.openURL(e,t.url,i)}(e,t,h||s!==l,c):(this.openInCurrentTab(e,t,c),i=!0)}))}}},openInCurrentTab:function(e,t,s){a.ZP.openURL(e,t.url,{bookmarkId:t.id,inCurrent:!0,transition:s})},getBookmarksByNode:function(e){let t=[];return e.children?t=t.concat(e.children.filter((e=>n.Z.isBookmark(e)))):n.Z.isBookmark(e)&&t.push(e),t},getUrlsByNodes:function(e){return e.map((e=>C.getBookmarksByNode(e))).flat().map((e=>e.url)).filter(Boolean).filter((e=>n.Z.filterUrl(e).length>0))},getOpenOptionsFromDisposition:function(e,t,s,n){const i={inCurrent:!1,inBackground:!1,inNewWindow:!1,incognito:!1,transition:u.Z.historyPrivate.TransitionType.AUTO_TOPLEVEL};switch(t){case"setting":return(0,h.ZP)(e,n);case"current":return{...i,inCurrent:!0};case"new-tab":return{...i,inBackground:s||r.Z.get(v.kTabsOpenNewInBackground)};case"new-window":return{...i,inNewWindow:!0};case"new-private-window":return{...i,inNewWindow:!0,incognito:!0};default:return i}},isCopyModifierPressed:function(e){return e.ctrlKey},makeEventFlagsFromApiResponse:function(e){const t={altKey:void 0,button:void 0,ctrlKey:void 0,metaKey:void 0,shiftKey:void 0};return e.left?t.button=0:e.right?t.button=2:e.center&&(t.button=1),e.ctrl&&(t.ctrlKey=!0),e.alt&&(t.altKey=!0),e.shift&&(t.shiftKey=!0),e.command&&(t.metaKey=!0),t},verifyForUpdate(e,t){const s={...e};if(s.url&&(s.url=s.url.trim()),s.title&&(s.title=s.title.trim()),s.nickname&&(s.nickname=s.nickname.trim()),s.description&&(s.description=s.description.trim()),t)s.url="";else{let e=s.url||g.p;const{schemeParsed:t}=u.Z.utilities.isUrlValid(e);""===t&&(e=(0,m.q9)(e)),s.url=e}return s},verifyForCreate(e,t){const s={...e};if(s.url&&(s.url=s.url.trim()),s.title&&(s.title=s.title.trim()),s.nickname&&(s.nickname=s.nickname.trim()),s.description&&(s.description=s.description.trim()),t)s.url="";else{let e=s.url||g.p;const{schemeParsed:t}=u.Z.utilities.isUrlValid(e);""===t&&(e=(0,m.q9)(e)),s.url=e}return s},convertToPrivateType(e){const t={id:e.id,title:e.title,nickname:e.nickname,description:e.description,thumbnail:e.thumbnail,partner:e.partner,speeddial:e.speeddial,themeColor:e.themeColor,bookmarkbar:e.bookmarkbar,trash:e.trash};return e.parentId&&(t.parentId=e.parentId),e.index&&(t.index=e.index),e.url&&(t.url=e.url),e.dateAdded&&(t.dateAdded=e.dateAdded),e.dateGroupModified&&(t.dateGroupModified=e.dateGroupModified),e.children&&(t.children=[]),t},getEmptyNode:()=>({id:"",title:"",nickname:"",description:"",thumbnail:"",partner:"",speeddial:!1,themeColor:"",bookmarkbar:!1,trash:!1}),extractTitleFromEvent:function(e){const{dataTransfer:t}=e.nativeEvent;if(!t)return"";let s=t.getData("vivaldi/x-title");if(""===s){const e=t.getData("text/html");if(""!==e){const t=document.createElement("div");t.innerHTML=e;const n=t.getElementsByTagName("a");if(n&&n[0]){const e=n[0].textContent;""!==e&&(s=e)}}}return s||(s=e.dataTransfer.getData("text/plain")??""),s},isUriListType:e=>"text/uri-list"===e||"vivaldi/x-uri-list"===e,extractUnsafeUriInTextFromEvent:function(e){const{dataTransfer:t}=e.nativeEvent;if(!t)return"";const s=t.getData("text");try{const e=new URL(s);if(["file:","http:","https:","javascript:"].includes(e.protocol))return s}catch{}return""},extractUriListFromEvent:function(e){const{dataTransfer:t}=e.nativeEvent;if(!t)return"";let s=t.getData("vivaldi/x-uri-list");return s||(s=t.getData("text/uri-list")),s??""},getUrlsFromEventPromise:(e,t)=>new Promise(((s,n)=>{const i=e.dataTransfer.getData(p.Up),a=C.extractUriListFromEvent(e);if(i){const e=JSON.parse(i).ids.map((e=>parseInt(e))).sort(((e,t)=>e-t));d.Z.tabs.query({},(t=>s(t.filter((t=>e.some((e=>t.id===e)))).filter((({url:e=""})=>e&&!(0,f.pM)(e))).map((({title:e,url:t=""},s)=>({title:e||(0,c.ZP)(t),url:t}))))))}else{if("about:blank#blocked"===a){const t=C.extractUnsafeUriInTextFromEvent(e),n=C.extractTitleFromEvent(e)||(0,c.ZP)(t);return s([{url:t,title:n}])}if(a.length>0){const t=C.extractTitleFromEvent(e);return s(a.split("\n").map(((e,s)=>({url:e,title:0===s&&""!==t?t:(0,c.ZP)(e)}))))}if(!0!==t)return n();{let t=e.dataTransfer.getData("text/plain");if(t.length>0){if((0,m.K2)(t))return s([{url:t,title:(0,c.ZP)(t)}]);if(t=t.trim(),t.length>0&&!/\s/.test(t)){const e=t.indexOf(".");if(e>0&&e<t.length-1&&(t=(0,m.q9)(t),(0,m.K2)(t)))return s([{url:t,title:(0,c.ZP)(t)}])}return n()}}}})),isBookmarkable:function(e){return!(0,f.$0)(e)}},w=C},30460:(e,t,s)=>{"use strict";s.d(t,{p:()=>n});const n="http://bookmark.placeholder.url/"},34929:(e,t,s)=>{"use strict";s.d(t,{Z:()=>o});var n=s(2711),i=s(25201);const a={getOAuthServiceProvider:e=>"vivaldi"===e?"vivaldi":"google"===e?"google":"fastmail"===e?"fastmail":"yahoo",getAuthentication:async(e,t)=>{const{interactive:s}=t;let{password:i}=t;const{url:o,account_type:r}=e;let{username:l}=e;if(!l||!o)throw new Error("Username or URL missing");if(i||(i=await a._getVivaldiPassword(l,o||"")),"google"===r||"fastmail"===r||"vivaldi"===r&&!i){const t=a.getOAuthServiceProvider(r),i=await n.Z.getOAuthAccessToken(l,t,s).catch((t=>({...e,username:l,accessToken:""}))),{accessToken:o,usernameFromIdToken:d}=i;return d&&(l=d),{...e,accessToken:o,username:l,password:""}}return{...e,password:i,accessToken:""}},_getVivaldiPassword:async(e,t)=>{const{password:s}=await(0,i.Ij)({url:t,username:e});return s}},o=a},9126:(e,t,s)=>{"use strict";s.d(t,{R:()=>d,l:()=>c});var n=s(15800),i=s(29087),a=s(30381),o=s.n(a),r=s(87852);const l={displayMode:"month",showCompletedTasks:!1};function d(e){if(!e)return l;const t=n.ZP.getCalendarFilterPrefsKey(e),s=e===r.Nw||e===r.G6?"day":"month",a=i.Z.get(t);return{displayMode:a.displayMode??s,showCompletedTasks:a.showCompletedTasks??!1}}function c(e){return{calendarIds:new Set,filterText:"",anchorDate:(new(o())).startOf("hour"),selectedDate:(new(o())).startOf("hour"),allDaySelected:!1,selectedEvent:"",editing:!1,showTasks:!0,...d(e)}}},87265:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});var n=s(45660),i=s(25372),a=s(7064);const o={constructUrl:e=>e.filter(Boolean).map((e=>("/"===e.charAt(0)&&(e=e.substring(1)),e.endsWith("/")&&(e=e.substring(0,e.length-1)),e))).join("/"),concatUrl(e,t){const s=(0,i.Z)(e);if(!s)return"";const{protocol:n,host:a}=s;return(n||"")+"//"+(a||"")+t},stripDoubleQuotes:e=>e.split('"').join(""),parseHttpStatusCode(e){try{return parseInt(e.split(" ")[1],10)}catch(e){n.Z.error("Calendar",["network"],"Error parsing http status",e)}return-1},httpStatusSuccess(e){const t=o.parseHttpStatusCode(e);return t>=200&&t<300},getCalDAVUrl(e,t){const s=(0,i.Z)(e);if(!s)return"";const{protocol:n,host:a}=s;return n&&a&&t?`${n}//${o.constructUrl([a,t])}`:""},urlForEvent(e,t,s){const{uid:n,href:r}=s;let l="",d="";const c=(0,i.Z)(e);if(c){const{protocol:e,host:s}=c;if(e&&s&&r){const{urlValid:t}=a.Z.utilities.isUrlValid(r);l=t?r:o.constructUrl([`${e}//${s}`,r]),d=r}else{if(!e||!s||!n)throw"Error. Missing protocol, host uid ";const{urlValid:r}=a.Z.utilities.isUrlValid(t);if(r){l=`${o.constructUrl([t,n])}.ics`;const e=(0,i.Z)(t);d=`/${o.constructUrl([e?.pathname??"",n])}.ics`}else{const i=e+"//"+s;d=`/${o.constructUrl([t,n])}.ics`,l=o.constructUrl([i,d])}}}return{eventServerUrl:l,eventHref:d}}},r=o},1712:(e,t,s)=>{"use strict";s.d(t,{Z:()=>c});var n=s(2934),i=s(50522),a=s(82649),o=s(15800),r=s(56371),l=s(25201);const d={getCalendarCreateParams:e=>({name:"",description:(0,r.Z)("noun","New Calendar"),accountId:e.id,color:o.ZP.getCalendarCreateColor(),timezone:"",active:"local"!==e.account_type,supportedCalendarComponent:{vevent:!0,vtodo:!0,vjournal:!1}}),getAccountCreateParams:()=>({name:(0,r.Z)("Local Account"),url:"",account_type:"local",username:""}),createLocalAccountAndCalendar:async(e,t)=>{const s=d.getLocalAccount();if(s){const e=i.Z.getCalendars().find((e=>e.accountId===s.id));if(e)return{calendar:e,result:{message:"",status:!0}};t={...d.getCalendarCreateParams(s),...t};return await n.ZP.createCalendar({...t,accountId:s.id},s)}{e={...d.getAccountCreateParams(),...e};const s=await n.ZP.createAccount(e);t={...d.getCalendarCreateParams(s),...t};return{...await n.ZP.createCalendar({...t,accountId:s.id},s),account:s}}},getLocalAccount:()=>i.Z.getAccounts().find((e=>"local"===e.account_type)),getEmptyLocalAccount:()=>{const e=d.getLocalAccount();if(!e)return;if(i.Z.getAccounts().length>1)return;const t=i.Z.getCalendars();if(t.length>=2)return;if(0===t.length)return e;const s=t[0].id;for(const e of i.Z.getEvents())if(s===e.calendarId)return;return e},startDeletingAccount:async e=>{const t=i.Z.getAccounts().find((t=>t.id===e));if(!t)return;const{username:s,url:o}=t;n.ZP.stopListeners();try{await n.ZP.deleteAccount(e),(0,l.QN)({username:s,url:o})}finally{n.ZP.startListeners(),a.Z.doneDeleteAccount(e)}}},c=d},15800:(e,t,s)=>{"use strict";s.d(t,{Fg:()=>R,NY:()=>_,ZP:()=>F});var n=s(50522),i=s(6320),a=s(65792),o=s.n(a),r=s(45502),l=s(46382),d=s(80008),c=s.n(d),h=s(96951),u=s(29087),p=s(2699),g=s(9304),m=s(56371),f=s(45660),v=s(42568),b=s.n(v),C=s(25372),w=s(24522),y=s(23542),x=s(25765),I=s(87852),A=s(74400),S=s(36436),Z=s(58821),T=s(65741),E=s(44850),k=s(89175),N=s(47543);const _=new Set(["id","uid","calendarId","alarmId","eventTypeId","allDay","task","etag","href","sequence","syncPending","deletePending","filteredOut"]),P=new Set([..._,"start","end","timezone","organizer"]),M=(0,y.extendMoment)(c()),D=b()((function(e){let t=o()(e);t.get("lab.l")<12.5?t=t.set("lab.l",12.5):t.get("lab.l")>77.5&&(t=t.set("lab.l",77.5));const s=t.set("lab.l",t.get("lab.l")<70?"+70":"-70");return{"--colorCalendarBg":t.css(),"--colorCalendarBgAlpha":t.alpha(.2).css(),"--colorCalendarFg":s.css(),"--colorCalendarFgAlpha":s.alpha(.5).css()}}),{maxSize:100});function O(e){const t=Math.abs(e);return`${e<=0?"+":"-"}${Math.floor(t/60).toString().padStart(2,"0")}${Math.floor(t%60).toString().padStart(2,"0")}${Number.isInteger(e)?"":Math.round(t%1*60).toString().padStart(2,"0")}`}function j(e,t,s){return`BEGIN:${t.toUpperCase()}\nDTSTART:${M.tz(e.dtStart,s).format("YYYYMMDDTHHmmss")}\nTZOFFSETFROM:${O(e.offsetFrom??0)}\nTZOFFSETTO:${O(e.offsetTo??0)}\nTZNAME:${e.name??""}\n${e.rDates.map((e=>`RDATE:${M.tz(e,s).format("YYYYMMDDTHHmmss")}\n`)).join("")}END:${t.toUpperCase()}\r\n`}function L(e,t,s){const n=M.tz.zone(e);if(!n)return"";const i=Math.min(s,Date.now()+3650*w.hd),a=`BEGIN:VTIMEZONE\r\nTZID:${e}`;let o="";const{untils:r=[],offsets:l=[],abbrs:d=[]}=n;if(1===r.length)o+=`BEGIN:STANDARD\nDTSTART:19700101T000000\nTZOFFSETFROM:${O(l[0])}\nTZOFFSETTO:${O(l[0])}\nTZNAME:${d[0]}\nEND:STANDARD\r\n`;else{let s=r.findIndex((e=>e>t));s=Math.max(s,1);const n={standard:null,daylight:null};do{const t=l[s]-l[s-1],i=t>=0||t%15!=0?"standard":"daylight";!n[i]||n[i].offsetFrom===l[s-1]&&n[i].offsetTo===l[s]||(o+=j(n[i],i.toUpperCase(),e),n[i]=null);const a=n[i];a?a.rDates.push(r[s-1]):n[i]={dtStart:r[s-1],offsetFrom:l[s-1],offsetTo:l[s],name:d[s],rDates:[]},s++}while(s<r.length&&r[s-1]<i);n.standard&&(o+=j(n.standard,"STANDARD",e)),n.daylight&&(o+=j(n.daylight,"DAYLIGHT",e))}return`${a}\r\n${o}END:VTIMEZONE\r\n`}function R(e){let t=e.replace(/^DTSTART.*\n/,"");return t.startsWith("RRULE:")||(t="RRULE:"+t),t}const B={validColor:function(e){return(e??"").match(/^#?([0-9a-f]{6})([0-9a-f]{2})?$/i)?.[1]??!1},getCalendarColor:e=>{const t=B.validColor(e?.color);return t?`#${t}`:g.ZP.getThemeWithFallback(p.Z.getCurrentId()).colorHighlightBg},getCalendarColorStyles:e=>D(B.getCalendarColor(e)),getEventColors:e=>{const t=n.Z.getCalendars().find((t=>t.id===e));return B.getCalendarColorStyles(t)},getCalendarColors:()=>{let e="";for(const t of n.Z.getCalendars()){e+=`.calendar${t.id} {`;const s=B.getCalendarColorStyles(t);for(const[t,n]of Object.entries(s))e+=`${t}: ${String(n)};`;e+="}"}return e},getEventSquircle:()=>'<svg\n      viewBox="0 0 8 8"\n      xmlns="http://www.w3.org/2000/svg"\n    >\n      <rect width="8" height="8" rx="3" />\n    </svg>',createCalendarIcon:(e,t,s=!1)=>{const n=B.getCalendarColor(e);let i="";if(s){i=`<path d="M 8 17 l 7 7 l 11 -11 l -3 -3 l -8 8 l -4 -4  z" fill="#${o()(n).luminance()>.9?"000":"FFF"}" />`}return`<svg viewBox="0 0 32 32">\n      <circle cx="16" cy="16" r="${t}" fill="${n}" />\n      ${i}\n    </svg>`},createCalendarIconPNG:e=>{const t=B.getCalendarColor(e),s=document.createElement("canvas");s.width=32,s.height=32;const n=s.getContext("2d");return n.beginPath(),n.arc(16,16,Math.floor(32/3),0,2*Math.PI,!1),n.fillStyle=t,n.fill(),s.toDataURL("image/png").replace("data:image/png;base64,","")},initializeEvent:(e,t)=>{const s=i.Z.getStateForPage(e),a=e===I.G6?"day"!==s.displayMode:!["day","week"].includes(s.displayMode),{start:o,end:r,task:l=!1,allDay:d=!a&&s.allDaySelected,title:c=""}=t||{};let h=0,p=0;if(o)h=o;else if(!l&&s.selectedDate){const e=s.selectedDate.valueOf();h=a&&0===(0,Z.oR)(e)?e+10*w.QI:e}p=l?r??0:r?d?M(r).startOf("day").add(1,"day").valueOf():r:d?M(h).add(1,"day").valueOf():h+u.Z.get(k.kCalendarDefaultDuration);let g,m=-1;d?u.Z.get(k.kCalendarDefaultAlldayNotification)&&(m=u.Z.get(k.kCalendarDefaultAlldayNotificationTime)):m=u.Z.get(k.kCalendarDefaultNotification),-1!==m&&(g=[{id:"",name:"",when:m*w.lb}]);let f=t?.calendarId||B.getDefaultCalendar(l)?.id;const v=n.Z.getCalendars().find((e=>e.id===f));if(l&&!v?.supportedCalendarComponent?.vtodo||!l&&!v?.supportedCalendarComponent?.vevent){const e=n.Z.getAccounts().find((e=>e.id===v?.accountId));if(v&&!e)throw new Error("Can not create event, no account found! Broken data.");const t=l?"vtodo":"vevent",s=n.Z.getCalendars().find((s=>s.accountId===e?.id&&s.supportedCalendarComponent?.[t]));s&&(f=s.id)}const{is_template:b,exceptionEvents:C,...y}=t;return{...y,title:c,calendarId:f||"",uid:crypto.randomUUID(),id:"",start:h,end:p,allDay:d,task:l,notifications:g,invites:(t.invites??[]).map((e=>({...e,event_id:"",id:""}))),attachment:[]}},shouldSaveEvent:(e,t)=>{const s=!e.id,n=Object.entries(e).every((([t,s])=>!s||P.has(t)||"notifications"===t&&function(e){return 1===e.notifications?.length&&(!e.allDay&&u.Z.get(k.kCalendarDefaultNotification)*w.lb===e.notifications?.[0].when||!!e.allDay&&u.Z.get(k.kCalendarDefaultAlldayNotification)&&u.Z.get(k.kCalendarDefaultAlldayNotificationTime)===e.notifications?.[0].when)}(e)||Array.isArray(s)&&0===s.length)),i=!!t&&(e.start!==t.start||e.end!==t.end);if(s)return n&&!i?"DELETE":"SAVE";{const{notifications:s,...a}=e,{notifications:o,...r}=t||{},l=(0,T.Z)(a,r)&&!i,d=(0,T.Z)(s,o);return l&&d?"IGNORE":l?"SAVE_INVITED":n&&!i?"DELETE":"SAVE"}},isOwnEvent(e){const{account:t}=B.getAccountAndCalendar(e.calendarId);if("ical"===t?.account_type)return!1;if(!e.organizer)return!0;return u.Z.get(k.kMailAccounts).some((t=>t.MAIL_EMAIL===e.organizer))},shouldIncrementSequence:(e,t)=>{const s=e=>[e.address,e.partstat];if(!t)return!1;const n=(t.invites||[]).map(s),i=(e.invites||[]).map(s);return t.start!==e.start||t.end!==e.end||t.allDay!==e.allDay||!(0,T.Z)(t.rrule,e.rrule)||!(0,T.Z)(n,i)||!(0,T.Z)(t.recurrenceExceptions||[],e.recurrenceExceptions||[])},getDisplayRange:(e,t)=>{let s,n;switch(t){case"agenda":s=M(e).startOf("day"),n=M(e).add(1,"month").endOf("day");break;case"month":s=M(e).startOf("month").weekday(0),n=M(e).endOf("month").weekday(6);break;case"multiweek":s=M(e).subtract(1,"week").startOf("week"),n=M(e).add(1,"week").endOf("week");break;default:s=e.clone().startOf(t),n=e.clone().endOf(t)}return M.range(s,n)},getEventRange:e=>{const t=e.task?e.start||e.end:e.start,s=e.end||e.start;if(t&&s)return M.range(t,s)},isMultiDayEvent:e=>{if(e.allDay&&e.end)return!0;if(e.task&&e.end&&!e.start)return!1;const t=M(e.start),s=M(e.end);return!t.isSame(e.end,"day")&&!(s.diff(t,"day",!0)<1&&s.isSame(s.clone().startOf("day")))},isRecurringEvent:e=>Boolean(e.rrule),isGeneratedRecurringEvent:e=>-1!==("string"==typeof e?e:e.id).indexOf(":"),getGeneratedSourceEvent:e=>{const[t]=e.id.split("-")[0].split(":"),s=n.Z.getEvents().find((e=>e.id===t));if(!s)throw new Error(`Source event not found for recurring event id: ${e.id}`);return s},getBaseEventIfException:e=>{const[t]=e.id.split("-")[0].split(":"),s=n.Z.getEvent(t);if(s?.recurrenceExceptions?.length&&!e.recurrenceExceptions?.length)return s},getExceptionEvents:function(e,t){return(e.recurrenceExceptions||[]).flatMap((s=>{const i=s.exception_event_id;if(i){const a=i===t?.id?t:n.Z.getEvent(i);if(a)return{...a,recurrenceId:s.date,sequence:e.sequence,uid:e.uid}}return[]}))},generateKey:(e,t)=>{const{calendarId:s,id:n,uid:i,sequence:a}=e;return`${s}-${n}-${i??""}-${a??""}-${t??""}`},eventHasText:(e,t)=>{const s=t.toLowerCase();return["title","description","location","url","invites","organizer"].some((t=>(Array.isArray(e[t])?function(t){return"invites"===t&&e.invites?e.invites.map((e=>e.address)).join(""):""}(t):e[t]||"").toLowerCase().indexOf(s)>=0&&!e.trash))},eventSearchPredicate:(e,t)=>""===e.id||B.eventHasText(e,t),searchEvents:(e,t)=>e.filter((e=>B.eventSearchPredicate(e,t))).sort(((e,t)=>t.start-e.start)),filterEventsByPeriod:(e,t,s,n=1)=>{const i=t.clone();let a,o;"allday"===s?(a=i.startOf("day").valueOf(),o=i.add(n-1,"day").endOf("day").valueOf()):(a=i.startOf(s).valueOf(),o=i.add(n-1,s).endOf(s).valueOf());const r=t.dayOfYear(),l=e.filter((e=>e.id.indexOf("-")>0)).map((e=>e.id.split("-"))).filter((([e,t])=>parseInt(t)<=r)).reduce(((e,[t,s])=>(e[t]=Math.max(e[t]||0,parseInt(s)),e)),{}),d=e.filter((e=>{if(e.task){let t=e.end;return t||(t=e.start),e.start&&t?e.start<=o&&t>a||e.start===t&&e.start>=a&&e.start<o:!!t&&(t>=a&&t<=o)}return e.start<o&&(e.end||e.start)>a||e.start<o&&e.start>=a})).filter((e=>{const[t,s]=e.id.split("-");return s?l[t]===parseInt(s):!(t in l)}));return"hour"===s?d.filter((e=>!B.isMultiDayEvent(e))):"allday"===s?d.filter((e=>B.isMultiDayEvent(e))):d},foldIcal:function(e){return e.split(/\r?\n/).map((e=>{if(e.length<=75)return e;let t="",s=0;for(;s<e.length;)s+75>=e.length?t+=e.substr(s):t+=e.substr(s,73)+"\r\n ",s+=73;return t})).join("\r\n")},notificationToVAlarm:function(e){const{name:t,when:s}=e;return`BEGIN:VALARM\nACTION:DISPLAY\nDESCRIPTION:${t}\nTRIGGER:${s>0?"-":""}${M.duration(Math.abs(s)).toString()}\nEND:VALARM`},eventsToICalendar:function(e,t={}){const{method:s,includeRecurrenceId:n=!0}=t,i=M.tz().format(w.FI),a=["BEGIN:VCALENDAR","PRODID:-Vivaldi Calendar V1.0//EN","VERSION:2.0","CALSCALE:GREGORIAN","DTSTAMP:"+i];s&&a.push(`METHOD:${s}`),a.push("");let o=a.join("\r\n");const r=(0,Z.EP)()||"utc",l=e.reduce(((e,t)=>{if((t.start||t.end)&&!t.allDay&&(t.rrule||t.timezone)){const s=t.timezone||r,n=t.start||1/0;let i=t.end||-1/0;if(t.rrule){const{rrule:e,start:s,timezone:n}=t,a=(0,N.Qj)(e,n,s);i=a?.options.until?a.options.until.valueOf():a?.options.count?a.all().pop()?.valueOf()??1/0:1/0}e[s]?e[s]={firstOccurrence:Math.min(n,e[s].firstOccurrence),lastOccurrence:Math.max(i,e[s].lastOccurrence)}:e[s]={firstOccurrence:n,lastOccurrence:i}}return e}),{});for(const e in l)e!==w.$T&&"utc"!==e.toLowerCase()&&(o+=L(e,l[e].firstOccurrence,l[e].lastOccurrence));return e.map((e=>{let t=[];e.organizer&&(t=[`ORGANIZER:mailto:${e.organizer}`]),e.invites&&e.invites.length&&(t=t.concat(e.invites.map((e=>`ATTENDEE;RSVP=TRUE${e.partstat?`;PARTSTAT=${e.partstat}`:""}${`;CN=${e.name||e.address}`}:mailto:${e.address}`))));const{uid:s,recurrenceId:a}=e,o=Boolean(a&&n);let r,l,d,c="",h="";e.allDay?(c=";VALUE=DATE",r=e.start?M(e.start).format(w.O5):"",l=e.end?M(e.end).format(w.O5):"",e.task&&(h=M().format(w.O5)),o&&(d=M(a).format(w.O5))):e.timezone===w.$T?(r=e.start?M(e.start).format(w.A):"",l=e.end?M(e.end).format(w.A):"",e.task&&(h=M().format(w.A)),o&&(d=M(a).format(w.A))):e.timezone&&"utc"!==e.timezone.toLowerCase()?(c=`;TZID=${String(e.timezone)}`,r=e.start?M.tz(e.start,e.timezone).format(w.A):"",l=e.end?M.tz(e.end,e.timezone).format(w.A):"",e.task&&(h=M.tz(M(),e.timezone).format(w.A)),o&&(d=M.tz(a,e.timezone).format(w.A))):(r=e.start?M.tz(e.start,"utc").format(w.FI):"",l=e.end?M.tz(e.end,"utc").format(w.FI):"",e.task&&(h=M.tz(M(),"utc").format(w.FI)),o&&(d=M.tz(a,e.timezone).format(w.A)));const u=e.notifications&&e.notifications.map(B.notificationToVAlarm).join("\n"),p=[],{rrule:g,recurrenceExceptions:m}=e;g&&p.push(R(g)),m&&m.forEach((t=>{const{date:s,cancelled:n}=t;if(n){let t="",n="";e.allDay?(t=";VALUE=DATE",n=`${M.tz(s,"utc").format(w.O5)}`):e.timezone===w.$T?n=M(s).format(w.A):e.timezone?(t=`;TZID=${e.timezone}`,n=M.tz(s,e.timezone).format(w.A)):n=M.tz(s,"utc").format(w.FI),p.push(`EXDATE${t}:${n}`)}}));const f=e.task?"DUE":"DTEND";return[e.task?"BEGIN:VTODO":"BEGIN:VEVENT","DTSTAMP;VALUE=DATE-TIME:"+i,e.description?`DESCRIPTION:${(0,A.ES)(e.description)}`:"",e.location?`LOCATION:${(0,A.ES)(e.location)}`:"",!(0,E.eD)(e.url||"")&&e.url?`URL:${e.url}`:"",l?`${f}${c}:${l}`:"",r?`DTSTART${c}:${r}`:"",d?`RECURRENCE-ID${c}:${d}`:"",Number.isInteger(e.sequence)?`SEQUENCE:${e.sequence||0}`:"",`SUMMARY:${(0,A.ES)(e.title)}`,s?`UID:${s}`:"",...t,...p,B.attachmentsToString(e.attachment),e.complete?"STATUS:COMPLETED":"",e.complete?`COMPLETED${c}:${h}`:"",u||"",e.task?"END:VTODO\r\n":"END:VEVENT\r\n"].filter(Boolean).join("\r\n")})).forEach((e=>{o+=e})),B.foldIcal(o+"END:VCALENDAR")},attachmentsToString:e=>(e||[]).map((e=>{const{filename:t,fmttype:s,url:n}=e;if(n){return`ATTACH${t?`;FILENAME=${(0,A.ES)(t)}`:""}${s?`;FMTTYPE=${s}`:""}:${n}`}})).filter(Boolean).join("\r\n"),stringToAttachments:(e="")=>e.split("\r\n").filter((e=>Boolean(e)&&-1!==e.indexOf("ATTACH")&&-1===e.indexOf("ENCODING")&&-1===e.indexOf("BINARY"))).map((e=>{const[t,s]=(0,A.Vl)(e,":",2),n=t.match(/FILENAME=([^;:]+)/),i=t.match(/FMTTYPE=([^;:]+)/);return{url:s,filename:n?n[1]:void 0,fmttype:i?i[1]:void 0}})),getDefaultCalendar:(e=!1)=>{const t=e?k.kCalendarDefaultTaskCalendarId:k.kCalendarDefaultCalendarId,s=u.Z.get(t),i=n.Z.getWritableCalendars();let a=i.find((e=>e.id===s));return a&&(e?a?.supportedCalendarComponent?.vtodo:a?.supportedCalendarComponent?.vevent)||!(i.length>0)||(a=e?i.find((e=>e.supportedCalendarComponent?.vtodo)):i.find((e=>e.supportedCalendarComponent?.vevent))),a},getAccountAndCalendar:e=>{const t=n.Z.getCalendars().find((t=>t.id===e));if(t){const e=n.Z.getAccounts();return{calendar:t,account:e.find((e=>e.id===t.accountId))}}return{account:void 0,calendar:void 0}},getDefaultAccount:()=>{const e=B.getDefaultCalendar(),t=n.Z.getAccounts(),s=t.find((t=>t.id===e?.accountId));return!s&&t.length>0?t[0]:s},isRemoteCalendar:e=>{const t=n.Z.getCalendars().find((t=>t.id===e));if(!t)return!1;const{accountId:s}=t;return!!n.Z.getAccounts().find((e=>e.id===s))?.url},isGoogleCalendar:e=>{const t=n.Z.getCalendars().find((t=>t.id===e));if(!t)return!1;const{accountId:s}=t,i=n.Z.getAccounts().find((e=>e.id===s));return!(!t||!i||"google"!==i.account_type)},isLocalCalendar:e=>{const t=n.Z.getAccounts(),s=n.Z.getCalendars().find((t=>t.id===e));if(!s)return!1;const{accountId:i}=s,a=t.find((e=>e.id===i));return!!a&&"local"===a.account_type},isCalendarValidToCreate:e=>{const{description:t,supportedCalendarComponent:s}=e,{vevent:n,vtodo:i}=s||{vevent:!1,vtodo:!1};return Boolean(t)&&(n||i)},isCalDAV:e=>"vivaldi"===e||"caldav"===e||"google"===e||"fastmail"===e,isOAuthProvider:e=>"vivaldi"===e||"google"===e||"fastmail"===e,ensureAccountType:e=>{const t=Object.keys(x.d3).find((t=>t===e))||"local";return"icloud"===t?"caldav":t},doesCalendarsExistsAndShowWarning:(e,t=!1)=>{if(0===n.Z.getCalendars().length)return l.Z.showCalendarAccountDialog(e),!1;const s=n.Z.getWritableCalendars();return 0!==(t?s.filter((e=>e.supportedCalendarComponent.vtodo)):s.filter((e=>e.supportedCalendarComponent.vevent))).length||(l.Z.showModal(e,{modal:{title:(0,m.Z)("No Writable Calendar Defined"),body:t?(0,m.Z)("At least one calendar that supports creating tasks is required to add a task."):(0,m.Z)("At least one calendar that supports creating events is required to add an event."),actions:[{title:(0,m.Z)("Open Calendar Settings"),action:"settings",default:!0}],cancelAction:{title:(0,m.Z)("Cancel"),action:"cancel"}}}).then((({action:t})=>{"settings"===t&&l.Z.showSettings(e,"calendar")})),!1)},getLocalGoogleTasksCalendars:e=>"google"!==e.account_type?[]:n.Z.getCalendars().filter((t=>t.accountId===e.id&&t.supportedCalendarComponent?.vtodo)),getPollResultText(e){const{calendars:t,error:s,message:n,didPoll:i}=e;if(s)return n||(0,m.Z)("Unknown error.");if(!i)return n||(0,m.Z)("Poll already in progress.");const a=t.reduce(((e,t)=>e+t.numberOfChangedCalendars),0);return 0===a?(0,m.Z)("Refresh complete. No change."):(0,m.Z)("Refresh complete. $1 calendar was updated.","Refresh complete. $1 calendars were updated.",[a])},getPageId:e=>"panel"===r.Z.getContext(e).area?I.G6:h.ZP.getActivePage(e)?.id,minimalCreateEvent:e=>({calendarId:"",is_template:!1,title:"",...e}),validateEventTypes:e=>(e.sequence||0)>2147483647?(f.Z.warn("Calendar",["Validating Event"],"Value in field: Sequence is to high. Sequence set to 0"),{...e,sequence:0}):e,ensureHttpsForWebcal(e){const t=(0,C.Z)(e);if(!t)throw new Error("Can not parse invalid URL for webcal");return"webcal:"===t.protocol&&(t.protocol="https:"),(0,S.q9)(t.href)},getCalendarCreateColor:()=>{const e=x.hx.map((e=>e.value.toLocaleLowerCase().replace("#",""))),t=[];n.Z.getCalendars().forEach((s=>{const n=s.color?.toLowerCase().replace("#","")||"";e.includes(n)&&t.push(n)}));let s=e.filter((e=>!t.includes(e)));return s.length||(s=e),`#${s[Math.floor(Math.random()*s.length)]}`},getCalendarDisplayName(e,t=!1){const s=e.description||e.name;if(!t)return s;const i=n.Z.getAccounts().find((t=>t.id===e.accountId));if(i){const e=i.name||i.url;return(0,m.Z)("$1 ($2)",[s,e])}return s},getCalendarFilterPrefsKey:e=>{let t="";return t=e===I.Nw?k.kCalendarTaskPanelFilter:e===I.G6?k.kCalendarPanelFilter:k.kCalendarManagerFilter,t},suggestNewCalendarDisplayName(e){const t=x.d3[e],s=n.Z.getAccounts().map((e=>e.name));if(!s.includes(t))return t;let i=1;for(;i<9999;){const e=(0,m.Z)("$1 ($2)",[t,i]);if(!s.includes(e))return e;i++}return""}},F=B},58821:(e,t,s)=>{"use strict";s.d(t,{EP:()=>m,FL:()=>v,FY:()=>h,KC:()=>A,PX:()=>p,Ro:()=>u,VV:()=>f,Xq:()=>c,Yu:()=>C,aE:()=>y,bn:()=>w,oJ:()=>x,oR:()=>S,sG:()=>b,zX:()=>I});var n=s(29087),i=s(88212),a=s(80008),o=s.n(a),r=s(24522),l=s(47543),d=s(89175);function c(e,t){const s=t?t.clone():e.clone(),n=s.startOf("month");return Math.floor((e.diff(s,"day")+1+n.weekday()-1)/7)}function h(e,t,s,n=!0){const i=s.clone();let a=7*e+1-i.startOf("month").weekday()+t;if(n){const e=i.endOf("month").date();a=Math.max(1,Math.min(a,e))}return i.date(a)}function u(e,t,s=!1){const n=t.clone(),i=n.endOf("month").weekday(),a=s?i-e:(i-e+7)%7;return n.subtract(a,"day")}function p(e,t,s=!1){const n=t.clone(),i=n.startOf("month").weekday(),a=s?e-i:(e-i+7)%7;return n.add(a,"day")}let g=null;function m(){return null===g&&(setTimeout((()=>g=null),1e4),g=Intl.DateTimeFormat().resolvedOptions().timeZone??""),g}function f(e,t){t&&t!==r.$T||(t=m());const s=o().tz(e,t);return new Date(Date.UTC(s.year(),s.month(),s.date(),s.hour(),s.minute(),s.second()))}function v(e,t){return t&&t!==r.$T||(t=m()),o().tz([e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds()],t).toDate()}function b(e){const{start:t=0,end:s=0,allDay:a}=e;if(e.task&&!t&&!s)return e;if(s&&s<t&&(e.end=t+(a?r.hd:n.Z.get(d.kCalendarDefaultDuration))),e.task||s||(e.end=e.allDay?t+r.hd:t),e.allDay){if(e.timezone=r.$T,e.start){const t=new Date(e.start),s=new Date(t.getFullYear(),t.getMonth(),t.getDate());e.start=s.valueOf()}if(e.task){const t=new Date(e.end||0),s=new Date(t.getFullYear(),t.getMonth(),t.getDate());e.end=s.valueOf()}else if(!e.task&&e.end){const t=new Date(e.end),s=new Date(t.getFullYear(),t.getMonth(),t.getDate());e.end=s.valueOf(),e.start===e.end&&(e.end=e.end+r.hd)}}const{start:o=0,end:c=0,timezone:h}=e;if(e.rrule&&o&&c-o>r.S){const t=(0,l.Qj)(e.rrule,h,o);if(t){const s=(0,l.xL)(t,new Date(o));s&&s.valueOf()<c&&(e.end=s.valueOf(),i.Z.warn("Calendar",`Event '${e.title}' '${e.uid||""}' truncated to prevent overlapping instances.`))}}return e}function C(e){return e.timezone&&e.timezone!==r.$T?e.timezone:m()||""}function w(e,t){const s=m(),n=e.timezone||s;if(t===r.$T)return e.timezone=t,e;if(t===r.ad)e.timezone=s,t=s||"UTC";else{if(!o().tz.zone(t))return e;e.timezone=t}if(e.start){const s=o().tz(e.start,n);e.start=o().tz(s.format(r.A),t).valueOf()}if(e.end){const s=o().tz(e.end,n);e.end=o().tz(s.format(r.A),t).valueOf()}return e}function y(e,t=!1){const s=t?m():C(e),n=o().tz(e.start,s),i=o().tz(e.end,s);return e.allDay&&e.start&&e.end&&i.subtract(1,"day"),{start:n,end:i}}function x(e){return e.task?e.start?e.start:e.end?e.end:NaN:e.start}function I(e){return Math.ceil(e/r.QI)*r.QI}function A(e,t){return Math.abs(e.valueOf()-t.valueOf())<r.hd&&e.getDate()===t.getDate()}function S(e){return(e-new Date(e).getTimezoneOffset()*r.lb)%r.hd}},34930:(e,t,s)=>{"use strict";s.d(t,{Z:()=>T});var n=s(12442),i=s(15800),a=s(72010),o=s(97698),r=s(46382),l=s(29087),d=s(67294),c=s(94283),h=s(15489),u=s(56371),p=s(88951),g=s(97823),m=s(80008),f=s.n(m),v=s(25765),b=s(22288),C=s(89175),w=s(48521),y=s(34155);function x(e){const t=g.Z.getAccountsAndAliases();let s=(0,b.o$)([e],t,!1,!1);return s&&(s=(0,b.SG)(s)),s}function I(e){const{document:t,HTMLTextAreaElement:s}=d.useContext(c.Z),[n,i]=d.useState("");d.useEffect((()=>{const e=t.querySelector('textarea[name="note"]');e instanceof s&&e.addEventListener("input",(e=>{i(e.target.value.replace(/(?:\r\n|\r|\n)/g,"<br />"))}))}),[t,s]);const a=d.useMemo((()=>x(e.from)),[e.from]),o=`${S(e.event,e.sendAction)}<br /><br />${n}${a}`;return(0,w.jsxs)("div",{children:[(0,u.Z)("Send email invitation to notify $1 participant about the event.","Send email invitations to notify $1 participants about the event.",[e.recipients.length]),(0,w.jsxs)("div",{className:"Invitation-Preview",children:[(0,w.jsx)("div",{className:"Invitation-Preview-Title",children:(0,u.Z)("Invitation Message Preview:")}),(0,w.jsx)("div",{className:"Invitation-Preview-Body",dangerouslySetInnerHTML:{__html:o}})]})]})}function A(e,t,s){const n=new Set(s.map((([e])=>e)));let i="create";i=n.has("create")?"create":n.has("update")?"update":"cancel";const a=[{title:(0,u.Z)("Send"),action:"send",default:!0}];return"cancel"!==i&&a.push({title:(0,u.Z)("Edit Event"),action:"edit",default:!1}),{title:e.task?(0,u.Z)("Invite Task Participants"):(0,u.Z)("Invite Event Participants"),body:(0,w.jsx)(I,{event:e,from:t,recipients:s,sendAction:i}),actions:a,cancelAction:{title:(0,u.Z)("Don’t Notify Participants"),action:"cancel",default:!1},inputs:[{name:"note",label:(0,u.Z)("Add a Custom Note to the Message (optional):")}]}}function S(e,t){const s=e.organizer;if(!s)throw new Error(`Event organizer not found for event uid ${String(e.uid)}`);const n=`<strong>${a.Z.getContactsWithAddress(s)?.name||s}</strong>`,i=`<strong>${e.title||v.gT}</strong>`,o=`<strong>${e.location??""}</strong>`,r=f().tz(e.start||e.end,e.timezone).toLocaleString();let l="";switch(t){case"create":l=(e.start||e.end)&&e.location?(0,u.Z)("$1 has invited you to an event “$2”, on $3, at “$4”.",[n,i,r,o]):e.start||e.end?(0,u.Z)("$1 has invited you to an event “$2”, on $3.",[n,i,r]):e.location?(0,u.Z)("$1 has invited you to an event “$2”, at “$3”.",[n,i,o]):(0,u.Z)("$1 has invited you to an event “$2”.",[n,i]);break;case"update":l=(e.start||e.end)&&e.location?(0,u.Z)("$1 has updated event “$2”, on $3, at “$4”.",[n,i,r,o]):e.start||e.end?(0,u.Z)("$1 has updated event “$2”, on $3.",[n,i,r]):e.location?(0,u.Z)("$1 has updated event “$2”, at “$3”.",[n,i,o]):(0,u.Z)("$1 has updated event “$2”.",[n,i]);break;case"cancel":l=(0,u.Z)("$1 has cancelled event “$2”.",[n,i])}return e.description&&(l+=`<br /><br />${e.description}`),l}async function Z(e,t,s,n){const i=[t],a={type:"html",content:n.body+x(t)},r={type:"attachment",filename:"invite.ics",content:(new TextEncoder).encode(n.iCal),mimeType:"application/ics",fileSize:n.iCal.length},l=n.iCal.match(/METHOD:\s*(\w+)/);l&&(r.method=l[1]);const d=Date.now();o.Z.sendExternalMessage(e,{bcc:[],bodyParts:[a,r],cc:[],flags:[],forwarded:void 0,from:i,inReplyTo:"",internal:!1,messageId:(0,p.Z)(i[0].address),replied:void 0,sentDate:d,subject:n.subject,threadKey:void 0,to:s})}const T={getOrganizerForEvent:function(e){const{account:t}=i.ZP.getAccountAndCalendar(e.calendarId);if(t)return"google"===t?.account_type?t.username:l.Z.get(C.kCalendarMailAccount)},getOrganizerAsAttendee:function(e){if(!e.organizer)return;const t=e.organizer;return{name:l.Z.get(C.kMailAccounts).find((e=>e.MAIL_EMAIL===t))?.displayName||"",address:t,partstat:"NEEDS-ACTION",id:"",event_id:e.id}},sendAttendeeMails:async function(e,t,s,a=!1){if(i.ZP.isGoogleCalendar(t.calendarId))return"cancelled";const o=h.ZP.getLastActiveBrowserWindowId(),l=t.organizer;if(!l)throw new Error(`Invites not sent. Organizer not found for event ${String(t.uid)}`);const d={address:l},c=await r.Z.showModal(o,{modal:A(t,d,s)});if(await new Promise((e=>y.nextTick(e))),"cancel"===c.action)return"cancelled";if("edit"===c.action)return e&&Number.isInteger(e)&&n.Z.selectEvent(e,{event:t,edit:!0}),"edit";let p="",g="",m="REQUEST";const f=t.title||v.gT,b=s.map((([e,s])=>{switch(e){case"create":p=(0,u.Z)("Event invitation: $1",[f]),m="REQUEST";break;case"update":p=(0,u.Z)("Event updated: $1",[f]),m="REQUEST";break;case"cancel":p=(0,u.Z)("Event cancelled: $1",[f]),m="CANCEL"}g=S(t,e);const{note:n}=c.inputs||{};n&&(g+="<br/><br/><strong>"+(0,u.Z)("Event organiser added the following note:")+"</strong><br/>"+n.replace(/(?:\r\n|\r|\n)/g,"<br />"));const r={method:m,includeRecurrenceId:a},l=i.ZP.eventsToICalendar([t],r),h=s.filter((e=>e.address!==t.organizer)).map((e=>({address:e.address,...e.name?{name:e.name}:null})));if(0===h.length)return;return Z(o,d,h,{subject:p,body:g,iCal:l})}));return await Promise.all(b),"sent"},sendReplyMails:async function(e,t,s,n,a){let o="",r="";const l=t.organizer;if(!l)throw new Error(`Event organizer not found for event uid ${String(t.uid)}`);const d={address:"DECLINECOUNTER"===a?l:n},c=`<strong>${s}</strong>`,h=t.title||v.gT,p=`<strong>${h}</strong>`;switch(a){case"ACCEPTED":o=(0,u.Z)("Accepted: $1",[h]),r=(0,u.Z)("$1 has accepted your invitation to “$2”",[c,p]);break;case"TENTATIVE":o=(0,u.Z)("Tentatively accepted: $1",[h]),r=(0,u.Z)("$1 has tentatively accepted your invitation to “$2”",[c,p]);break;case"DECLINED":o=(0,u.Z)("Declined: $1",[h]),r=(0,u.Z)("$1 has declined your invitation to “$2”",[c,p]);break;case"DECLINECOUNTER":o=(0,u.Z)("Event change proposal declined: $1",[h]),r=(0,u.Z)("$1 has declined your proposed changes to “$2”",[c,p])}const g={method:"DECLINECOUNTER"===a?"DECLINECOUNTER":"REPLY"};return Z(e,d,[{address:"DECLINECOUNTER"===a?c:l}],{subject:o,body:r,iCal:i.ZP.eventsToICalendar([t],g)})}}},25765:(e,t,s)=>{"use strict";s.d(t,{d3:()=>i,gT:()=>o,hx:()=>a});var n=s(56371);const i={local:(0,n.Z)("data storage","Local"),google:(0,n.Z)("Google Calendar"),vivaldi:(0,n.Z)("Vivaldi.net"),caldav:(0,n.Z)("CalDAV"),ical:(0,n.Z)("Web Calendar"),fastmail:(0,n.Z)("Fastmail"),icloud:(0,n.Z)("iCloud Calendar")},a=[{value:"#e73359",name:(0,n.Z)("calendar","Red")},{value:"#ee8835",name:(0,n.Z)("calendar","Orange")},{value:"#696969",name:(0,n.Z)("calendar","Gray")},{value:"#14a434",name:(0,n.Z)("calendar","Green")},{value:"#4facf2",name:(0,n.Z)("calendar","Blue")},{value:"#b260d3",name:(0,n.Z)("calendar","Purple")},{value:"#8b7251",name:(0,n.Z)("calendar","Brown")}],o=(0,n.Z)("No title")},8336:(e,t,s)=>{"use strict";s.d(t,{CP:()=>v,Km:()=>g,tV:()=>b});var n=s(50522),i=s(15800),a=s(80008),o=s.n(a),r=s(42568),l=s.n(r),d=s(23542),c=s(47543),h=s(90870);const u=(0,d.extendMoment)(o());function p(e,t){if(e.task){if(!e.start&&!e.end)return!1;if(e.start){const{start:s,end:n}=e;return(n&&n!==s?n:s+1)>t.start.valueOf()&&s<=t.end.valueOf()}return t.contains(e.end)}{const{start:s,end:n}=e;return(n&&n!==s?n:s+1)>t.start.valueOf()&&s<=t.end.valueOf()}}function g(e,t){const s={...t},i=(t.recurrenceExceptions||[]).filter((t=>e.valueOf()===t.date));if(!(i.length>0)){const{start:n,end:i}=function(e,t){const s={start:0,end:0};if(t.task)if(t.start&&t.end){const n=t.end-t.start;s.start=e.valueOf(),s.end=e.valueOf()+n}else s.end=e.valueOf();else{const n=(t.end||t.start)-t.start;s.start=e.valueOf(),s.end=e.valueOf()+n}return s}(e,t);return s.start=n,s.end=i,s.id=`${t.id}:${e.valueOf()}`,s.uid=t.uid,{event:s}}{const t=i[0],{cancelled:s,parent_event_id:a,exception_event_id:o}=t;if(!s&&a&&o){const t=n.Z.getEvent(a),s=n.Z.getEvent(o);if(t&&s){const n={...s},i=n.start||n.end;return n.id=`${t.id}:${i}`,n.rrule=t.rrule,n.recurrenceId=e.valueOf(),{event:n,exceptionId:o}}}}return{event:null}}const m=l()((function(e){return(0,h.Z)(e,i.ZP.isRecurringEvent)}));function f(e,t){let s=[];const[i,a]=m(e);let o=[];i.forEach((e=>{if(function(e){return Boolean(e.task&&!e.end)}(e))return;const{start:i,end:a,end_recurring:r,rrule:l,timezone:d}=e;if(r&&r<t.start.valueOf())return;const h=(0,c.Qj)(l,d,i||a),u=i&&a?a-i:0,m=(0,c.YE)(h?.toString()||"",{from:t.start.valueOf()-u,to:t.end.valueOf(),eventStart:i||a,timezone:e.timezone}),[f,v]=((e,t,s)=>{const n=[],i=[];return t.forEach((t=>{const{event:a,exceptionId:o}=g(t,e);a&&p(a,s)&&n.push(a),o&&i.push(o)})),[n,i]})(e,m,t);o=o.concat(f);for(const i of e.recurrenceExceptions??[]){const{cancelled:e,exception_event_id:a}=i;if(!e&&a&&!v.includes(a)){const e=n.Z.getEvent(a);let{start:i,end:r}=e??{};if(!e||!i&&!r)continue;i?r||(r=i):i=r,i<=t.end.valueOf()&&r>t.start.valueOf()&&(o.push(e),s.push(a))}}s=s.concat(v)}));return a.filter((e=>!s.includes(e.id)&&p(e,t))).concat(o)}const v={call:e=>f(e,u.range(u(),u().add(1,"week"))).filter((e=>!(e.task&&e.complete))).sort(((e,t)=>e.start!==t.start?e.start-t.start:e.allDay!==t.allDay?e.allDay?-1:1:e.end!==t.end?e.end-t.end:parseInt(e.id||0)-parseInt(t.id||0)))},b={call:l()(((e,t,s)=>f(e,i.ZP.getDisplayRange(t,s))),{maxSize:3})}},82649:(e,t,s)=>{"use strict";s.d(t,{t:()=>Ce,Z:()=>Xe});var n=s(2934),i=s(34929),a=s(50522),o=s(87265),r=s(15800),l=s(79706),d=s(60331),c=s(56371),h=s(64877),u=s(25372);var p=s(98035),g=s(28773);const{urlForEvent:m}=o.Z;function f(e){switch(e){case"get":return"GET";case"delete":return"DELETE";case"update":case"create":return"PUT"}}function v(e,t,s,n,i){const{etag:a}=t,{url:o,username:l,password:d,accessToken:c,account_type:h}=e,{eventHref:u,eventServerUrl:p}=m(o,s,t),v={};let b;"delete"!==i&&(!a||"update"!==i&&"get"!==i?"create"===i&&(v["If-None-Match"]="*"):v["If-Match"]=`"${a}"`,b="text/calendar; charset=utf-8",v.Accept="application/xml, text/calendar");const C=n.length?r.ZP.eventsToICalendar(n):null;return{username:l,password:d,accessToken:c,account_type:h,url:p,href:u,...(0,g.Z)(Object.keys(v).length?{headers:v}:null),...(0,g.Z)(b?{contentType:b}:null),...(0,g.Z)(C?{body:C}:null),method:f(i)}}function b(e){const{account_type:t}=e,s={Depth:"google"===t?"0":"1"};return{...e,headers:s,method:"PROPFIND",body:'<?xml version="1.0" encoding="UTF-8"?>\n    <D:propfind xmlns:D="DAV:"\n      xmlns:CS="http://calendarserver.org/ns/"\n      xmlns:C="urn:ietf:params:xml:ns:caldav">\n    <D:prop>\n    <D:displayname />\n    <CS:getctag />\n    <D:sync-token />\n    </D:prop>\n    </D:propfind>'}}var C=s(45660),w=s(23796),y=s(13095),x=s(29526);function I(e){const t={displayName:"",ctag:"",syncToken:""};try{const s=(0,y.Z)(e).responses.filter((e=>e?.getctag?.value));if(0===s.length)throw new Error("getctag response not found");s.length>1&&C.Z.info("Calendar",["caldav"],"Unexpected number of getctags");const n=s[0];t.displayName=(0,y.J)(n.displayname.value),t.ctag=(0,y.J)(n.getctag.value),t.syncToken=(0,x.Z)((0,y.J)(n.syncToken?.value??""))}catch(t){C.Z.error("Calendar",["caldav"],"cTag parser error",t),console.log("Error reading cTag.",e)}return t}function A(e,t){const s={createdUpdated:[],deletedHrefs:[],syncToken:"",serverThrottlesEvents:!1,error:!1,staleSyncToken:!1};try{const n=(0,y.Z)(e);if(s.syncToken=n.syncToken??"",0===n.responses.length&&n.error)return s.error=!0,s.staleSyncToken=!0,s;for(const e of n.responses)404===e.status?s.deletedHrefs.push(e.href):200===e.status&&e.getetag?s.createdUpdated.push({href:e.href,etag:(0,y.J)(e.getetag.value)}):507===e.status&&e.href===t&&(s.serverThrottlesEvents=!0);return s}catch(t){return C.Z.error("Calendar",["parser","syncCollection"],t),console.log("Error parsing CalDAV sync-collection",t,e),s.error=!0,s}}var S=s(8687),Z=s(15805),T=s(7064),E=s(24522),k=s(65741),N=s(34006);const{getExceptionEvents:_}=r.ZP;function P(e,t){const{recurrenceId:s,...n}=e;return{...(0,N.KU)(n,t),recurrenceId:s}}function M(e,t,s){let n=t[e],i=s[e];"rrule"===e&&(n="string"==typeof n&&(0,r.Fg)(n),i="string"==typeof i&&(0,r.Fg)(i));const a=!(!n||Array.isArray(n)&&0===n.length),o=!(!i||Array.isArray(i)&&0===i.length);return!(a||o)||(0,k.Z)(n,i)}function D(e,t,s){const n=new Set(e.recurrenceExceptions?.filter((e=>e.cancelled)).map((e=>e.date))),i=new Set(t.recurrenceExceptions?.filter((e=>e.cancelled)).map((e=>e.date)));if(n.size!==i.size||n.intersection(i).size!==n.size)return!1;const a=new Set(e.recurrenceExceptions?.filter((e=>!e.cancelled)).map((e=>e.date))),o=new Set(t.recurrenceExceptions?.filter((e=>!e.cancelled)).map((e=>e.date)));if(a.size||o.size){if(a.size!==o.size||a.intersection(o).size!==a.size)return!1;const n=_(e),i=s?s.map((e=>P(e,t))):_(t);for(const e of n){const t=i.find((t=>t.uid===e.uid));if(!t)return!1;if(0!==O(e,t).local.size)return!1}}return!0}function O(e,t,s){const n=s&&(0,N.KU)(s,e),i=new Map,a=new Map;for(const s of Object.keys(e))r.NY.has(s)||("recurrenceExceptions"!==s?(M(s,e,t)||a.set(s,t[s]),n&&!M(s,e,n)&&i.set(s,n[s])):(D(e,t)||a.set(s,t[s]),n&&!D(e,n)&&i.set(s,t[s])));return{incoming:i,local:a}}var j=s(1407),L=s(35391);function R(e,t,s){t||(t=r.ZP.getCalendarCreateColor());const{vevent:n,vtodo:i}=s||{vevent:!0,vtodo:!1};return`<?xml version="1.0" encoding="utf-8"?>\n    <C:mkcalendar xmlns:C="urn:ietf:params:xml:ns:caldav"><set xmlns="DAV:">\n      <prop><displayname>${e}</displayname>\n        <C:supported-calendar-component-set>\n        ${n?'<C:comp name="VEVENT" />':""}\n        ${i?'<C:comp name="VTODO" />':""}\n        </C:supported-calendar-component-set>\n        <calendar-color xmlns="http://apple.com/ns/ical/">${t}</calendar-color>\n      </prop></set>\n    </C:mkcalendar>`}var B=s(82164);const{constructUrl:F,stripDoubleQuotes:W}=o.Z;function U(e){let t="";return e.split("/").forEach((e=>{e.includes("@")&&(t=e)})),t}async function V(e,t){const s=await i.Z.getAuthentication(e,{interactive:!1}),{accessToken:n}=s,a=[(0,E.fP)(),"/v3/calendars",`?key=${await(0,B.w)()}`],o=F(a),r=await fetch(o,{method:"POST",headers:{Authorization:`Bearer ${n}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({summary:t})}),l={status:!1,message:"",description:"",name:""};if(r.ok){const e=function(e){const{id:t,summary:s,etag:n,timeZone:i}=e;return{name:t,description:s,ctag:W(n),timezone:i}}(await r.json());l.status=!0,l.description=e.description,l.name=`/caldav/v2/${e.name}/events/`,l.ctag=e.ctag}return l}var H=s(80008),G=s.n(H),K=s(81723),z=s(90870),$=s(58821);const{getLocalGoogleTasksCalendars:Y}=r.ZP,{constructUrl:X,stripDoubleQuotes:Q}=o.Z,q="YYYY-MM-DDTHH:mm:ss[Z]";function J(e){const{items:t=[],etag:s}=e;return{...e,etag:Q(s),items:t.map((e=>({...e,etag:Q(e.etag)})))}}function ee(e,t){const{title:s,notes:i,etag:a,due:o,id:r,completed:l}=e,d=o?G().tz(G()(o),"UTC").valueOf():void 0,c=l?G().tz(G()(l),"UTC").valueOf():void 0,h={id:t.id,calendarId:t.calendarId,title:s,task:!0,description:i??"",end:d,etag:Q(a),uid:r,complete:Boolean(l),completed:c,timezone:E.$T,allDay:!0},[u]=n.ZP.transformVivaldiEvents([h]);return u}async function te(e){const t=await i.Z.getAuthentication(e,{interactive:!1}),{parsed:s,status:o}=await se(t),r={numberOfCalendarsPolled:0,numberOfChangedCalendars:0};if(s.error){const t=new Date;return a.Z.getState().calendars.filter((t=>t.accountId===e.id)).forEach((async e=>await n.ZP.updateCalendar(e.id,{lastChecked:t.valueOf()},!1))),C.Z.log("Calendar",["google","tasks"],"Error fetching TaskList: ",o,s),r}const l=J(s),d=Y(e);r.numberOfCalendarsPolled=l.items.length;const c=(0,K.Z)(l.items,d,((e,t)=>{const{id:s}=e;return s===t.name})),h=await async function(e,t,s){return await Promise.all(e.map((async e=>{const i={accountId:t.id,name:e.id,description:e.title,active:s,supportedCalendarComponent:{vevent:!1,vtodo:!0,vjournal:!1}},a=await n.ZP.createCalendar(i,t);if(!a.calendar)throw Error("Calendar was not created");return a.calendar})))}(c,e,d.length>0),[u,p]=(0,z.Z)(d,(e=>l.items.some((t=>t.id===e.name))));await Promise.all(p.map((async e=>{await n.ZP.deleteCalendar(e)})));const g=h.concat(u),m=(0,K.Z)(g,l.items,((e,t)=>{const{name:s}=e;return s===t.id&&e.ctag===t.etag}));await Promise.all(m.map((async e=>{const s=function(e){const{items:t=[],etag:s}=e;return{...e,etag:Q(s),items:t.map((e=>({...e,etag:Q(e.etag)})))}}(await async function(e,t){const{accessToken:s}=e,n=["showCompleted=true","showHidden=true"],i=`${(0,E.fL)()}/tasks/v1/lists/${t}/tasks?${n.join("&")}&key=${await(0,B.w)()}`,a=await fetch(i,{method:"GET",headers:{Accept:"application/json",Authorization:`Bearer ${s}`}}),{status:o,ok:r,statusText:l}=a;if(!r)throw C.Z.log("Calendar",["google, tasks"],"Error getting tasks",o,l),Error(`Error getting tasks", ${o} ${l}`);return await a.json()}(t,e.name)),i=a.Z.getEventsPerCalendar(e.id),o=s.items.filter((e=>!i.some((t=>t.uid===e.id)))),d=i.filter((e=>-1===s.items.findIndex((t=>t.id===e.uid)))),c=i.map((e=>{const t=s.items.find((t=>t.id===e.uid&&Q(t.etag)!==e.etag));return t?{...ee(t,e)}:null})).filter(Boolean),h=o.map((t=>function(e,t){const{title:s,notes:n,due:i,etag:a,id:o,completed:r}=e,l=r?G()(r).valueOf():void 0;return{calendarId:t,title:s,is_template:!1,task:!0,description:n,end:i?G()(i).valueOf():void 0,etag:Q(a),uid:o,complete:Boolean(r),completed:l,timezone:E.$T,allDay:!0}}(t,e.id)));await Promise.all(h.map((e=>n.ZP.createEvent(e,!1)))),await Promise.all(d.map((e=>n.ZP.deleteEvent(e.id)))),await Promise.all(c.map((e=>{const t=e.rrule?"all":"single";return n.ZP.updateEvent(e,t)})));const u=l.items.find((t=>e.name===t.id));let p={ctag:s.etag};u?.title!==e.description&&(p={...p,description:u?.title}),(h.length||d.length||c.length)&&r.numberOfChangedCalendars++,await n.ZP.updateCalendar(e.id,p,!1)})));const f=new Date;return g.forEach((async e=>await n.ZP.updateCalendar(e.id,{lastChecked:f.valueOf()},!1))),r}async function se(e){const{accessToken:t}=e,s=`${(0,E.fL)()}/tasks/v1/users/@me/lists?maxResults=200&key=${await(0,B.w)()}`,n=await fetch(s,{method:"GET",headers:{Accept:"application/json",Authorization:`Bearer ${t}`}}),{status:i,ok:a,statusText:o}=n;if(!a)throw C.Z.log("Calendar",["google, tasks"],"Error fetching task lists ",i,o),Error(`Error fetching task lists, ${i} ${o}`);return{status:i,parsed:await n.json()}}var ne=s(36154);function ie(e,t){return{...e,method:"REPORT",headers:{depth:"1"},body:`<?xml version="1.0" encoding="UTF-8"?>\n    <D:sync-collection xmlns:D="DAV:" xmlns:CS="http://calendarserver.org/ns/" xmlns:C="urn:ietf:params:xml:ns:caldav">\n      <D:sync-token>${encodeURI(t??"")}</D:sync-token>\n      <D:sync-level>1</D:sync-level>\n      <D:prop>\n        <D:getetag />\n      </D:prop>\n    </D:sync-collection>`}}const{concatUrl:ae}=o.Z;function oe(e,t){const s=[];try{const n=(0,y.Z)(e);for(const i of n.responses){const n=i.status;if(!n){C.Z.info("Calendar",["sync","parser"],`Unexpected missing status getting event for ${t}.`,n);continue}if(n>=400){C.Z.error("Calendar",["sync","parser"],`Error getting event from server for calendar ${t}.`,n,i),console.log("Multiget error.",e);continue}if(n>200){C.Z.info("Calendar",["sync","parser"],`Unexpected response status getting event for ${t}.`,n),console.log("Multiget error.",e);continue}let a;const o=(0,y.J)(i.calendarData?.value);if(o)try{const e=(0,y.J)(i.getetag.value);a=(0,Z.Z)(o);const n=a.VEVENT?.[0]??a.VTODO?.[0];if(n)s.push({...(0,N.rP)(n,t,{href:i.href,etag:e}),task:!a.VEVENT?.[0]});else if(a.VJOURNAL?.[0])continue}catch(e){e instanceof Z.z?(C.Z.error("Calendar",["import","parser"],e),console.log("CalDAV Multi-Status iCalendar parse error.",o)):C.Z.error("Calendar",["iCal","creating"],a,e)}}}catch(t){C.Z.error("Calendar",["caldav","multiget"],"Parsing error"),console.log("parseMultiGet error.",e)}return s}var re=s(89873);async function le(e,t,s,n,i){let a=1e3,o=[];const r=s.length,l=[...s];return await async function d(){if(1===a)return C.Z.error("Calendar",["multiget"],"Error fetching events from server. Exhausted retries."),o;const h=(0,re.Z)(l,a);for(const u of h){const{status:h,ok:p,response:g}=await(0,S.ZP)(de(t,u),e);if(p){l.splice(0,u.length),o=o.concat(oe(g,n));const e=o.length,t=Math.round(e/r*100);i((0,c.Z)("Fetching events $1 of $2 ($3%)",[e,r,t]))}else{if(h>=500&&h<=599){a=Math.max(1,Math.min(a,s.length)/2),await d();break}C.Z.error("Calendar",["multiget"],"Error fetching events."),console.log("CalDAV Multi-get request error.",g)}}}(),o}function de(e,t){return{...e,method:"REPORT",body:`<?xml version="1.0" encoding="UTF-8"?>\n    <c:calendar-multiget xmlns:d="DAV:" xmlns:c="urn:ietf:params:xml:ns:caldav">\n    <d:prop>\n        <d:getetag />\n        <c:calendar-data />\n    </d:prop>\n      ${t.map((e=>`<d:href>${encodeURI(e)}</d:href>`)).join("\n")}\n    </c:calendar-multiget>`}}var ce=s(88545),he=s(25201),ue=s(9141);const{stripDoubleQuotes:pe,getCalDAVUrl:ge,concatUrl:me}=o.Z,{getLocalGoogleTasksCalendars:fe,getExceptionEvents:ve,isOAuthProvider:be}=r.ZP;class Ce extends Error{constructor(e,t,s){super("Error merging event data"),this.name="EventMergeError",this.diff=e,this.local=t,this.incoming=s}}const{VERIFYING:we,OK:ye,ERROR:xe}=E.LB,{isCalDAV:Ie}=r.ZP;let Ae,Se=!1;const Ze=new Map;let Te=!1,Ee=!1;const ke={},Ne=new Set,_e=new Set,Pe=new Set,Me=new Set;function De(e){const t=(0,u.Z)(e);if(!t)return;const{protocol:s,host:n}=t;return s&&n?s+"//"+n:void 0}async function Oe(){const e=a.Z.getEvents().filter((e=>e.syncPending));for(const t of e)if(r.ZP.isRemoteCalendar(t.calendarId))if(t.trash){const{deleteLocal:e,ok:s}=await Ye.deleteEvent(t.id);(e||s)&&await n.ZP.deleteEvent(t.id)}else await Ye.updateEvent(t);else await p.Z.updateEvent({id:t.id,syncPending:!1})}let je=navigator.onLine;function Le(){!je&&navigator.onLine&&Oe(),je=navigator.onLine}function Re(){a.Z.getAccounts().filter((e=>!!e.url)).forEach((e=>{a.Z.getCalendars().filter((t=>t.accountId===e.id)).forEach((t=>{t.active?_e.has(t.id)||(_e.add(t.id),Pe.add(e.id)):_e.has(t.id)&&_e.delete(t.id)})),Ne.has(e.id)||(Ne.add(e.id),Pe.add(e.id))})),Pe.size>0&&(Ae&&clearTimeout(Ae),Ae=setTimeout((()=>{Ye.pollCalDAV({accountIds:Array.from(Pe)}),Pe.clear()}),1e3))}async function Be(e,t,s){const{ok:i,response:r}=await(0,S.ZP)((l=t,{...l,method:"PROPFIND",headers:{Depth:"1"},body:'<?xml version="1.0" encoding="UTF-8"?>\n    <D:propfind xmlns:D="DAV:">\n      <D:prop>\n        <D:getcontenttype/>\n        <D:resourcetype/>\n        <D:getetag/>\n      </D:prop>\n    </D:propfind>'}),s);var l;if(!i)return void C.Z.warn("Calendar",(0,c.Z)("Error polling calendar. $1",[r]));const d=function(e){const t=[];try{const s=(0,y.Z)(e);for(const n of s.responses){const s=n.status;if(!s||s>=400){C.Z.error("Calendar",["sync","parser"],"Error getting event properties from server.",s,n),console.log("PropFind event list error.",e);continue}if(s>200){C.Z.info("Calendar",["sync","parser"],"Unexpected response status getting event properties.",s),console.log("PropFind event list unexpected status.",e);continue}const i=(0,x.Z)(n.href),a=o.Z.stripDoubleQuotes((0,y.J)(n.getetag?.value));i&&a&&t.push({href:i,etag:a})}}catch(t){C.Z.error("Calendar",["caldav","propfind"],"Parsing error",t),console.log("parsePropFindEvents error.",e)}return t}(r),h=a.Z.getEventsPerCalendar(e.id);let u=h.filter((e=>!d.some((t=>t.href===e.href))));const p=d.filter((e=>!h.some((t=>t.etag===e.etag)))).map((e=>e.href||""));if(0===p.length)return void u.forEach((e=>n.ZP.deleteEvent(e.id)));const g=await le(s,t,p,e.id,(e=>{Fe(e)}));u=u.filter((e=>g.some((t=>e.uid!==t.uid)))),await Promise.all(u.map((e=>n.ZP.deleteEvent(e.id)))),await(0,ue.Wy)(h,g);const m=g.filter((e=>!h.some((t=>t.uid===e.uid))));try{await(0,N.nj)(m,We)}catch(e){C.Z.error("Calendar",["caldav"],"Error creating events",e)}}function Fe(e){d.Z.setStatus(j.Ex,e,5e3)}const We=(e,t)=>{const s=Math.round(e/t*100);Fe((0,c.Z)("Imported $1 of $2 ($3%)",[e,t,s]))};async function Ue(e,t,s=!1){const n={calendarId:e.id,ctag:e.ctag,lastCalendarPoll:Date.now(),changed:!1},a=De(t.url);if(!a)return Promise.reject();const{urlValid:o}=T.Z.utilities.isUrlValid(e.name),r=o?e.name:me(a,e.name),l=await i.Z.getAuthentication(t,{interactive:!1});Fe((0,c.Z)('Checking calendar "$1".',[e.description??""]));const d=e.ctag,h=await(0,S.ZP)(b(l),r);if(!h.ok)return Ye.getStatusMessageAndLog(t,h),n;const{ctag:u,syncToken:p}=I(h.response);return n.ctag=s&&p?p:u,""!==u&&d===u||(n.changed=!0,await Be(e,l,r)),n}async function Ve(e,t){const s={calendarId:e.id,ctag:e.ctag,lastCalendarPoll:Date.now(),changed:!1},o=De(t.url);if(!o)throw new Error("Missing URL prefix");const r=e.id,l=o+e.name,d=await i.Z.getAuthentication(t,{interactive:!1}),h=a.Z.getEventsPerCalendar(r),u=new Map,p=new Set;h.forEach((e=>{e.href&&u.set(e.href,e.etag),e.uid&&p.add(e.uid)}));let g=[];const m=[],f=[];let v=!1,w=null;do{const n=e.ctag;if(w=await(0,S.ZP)(ie(d,n),l),!w.ok){if(403!==w.status){C.Z.warn("Calendar",["caldav"],"Error fetching sync-collection"),Ye.getStatusMessageAndLog(t,w);continue}{C.Z.info("Calendar",["caldav"],t.name,e.name,"403 while fetching sync-collection. Stale Sync-token. Re-fetching",w.response);const s=await(0,S.ZP)(b(d),l);if(!s.ok){Ye.getStatusMessageAndLog(t,s);continue}const{syncToken:i}=I(s.response);i!==n&&(w=await(0,S.ZP)(ie(d,i),l))}}const i=A(w.response,e.name),{staleSyncToken:a,createdUpdated:o,syncToken:r,error:c}=i;if(c&&C.Z.warn("Calendar",["caldav"],"Error parsing sync-collection"),v=i.serverThrottlesEvents,g=g.concat(i.deletedHrefs),e={...e,ctag:r},s.ctag=r,a)return await Ue(e,t,!0);if(n===r)return s;s.changed=!0;const h=new Set,y=o.filter((({etag:e,href:t})=>{const s=!u.has(t);s&&h.add(t);const n=u.has(t)&&u.get(t)!==e;return u.set(t,e),s||n})).map((({href:e})=>e||"")),x=(y.length?await le(l,d,y,e.id,Fe):[]).filter((e=>!Me.has(e.uid??""))),[Z,T]=(0,z.Z)(x,(e=>h.has(e.href)&&!p.has(e.uid)));m.push(...Z),f.push(...T)}while(v);await(0,ue.Wy)(h,f);const y=h.filter((e=>g.some((t=>t===e.href))));await Promise.all(y.map((e=>n.ZP.deleteEvent(e.id)))),m.length&&Fe((0,c.Z)("Importing $1 event","Importing $1 events",[m.length]));try{await(0,N.nj)(m,We)}catch(e){C.Z.error("Calendar",["caldav"],"Error creating events",e)}return s}async function He(e,t){const s={calendars:[],error:!1,message:""};t=t??await i.Z.getAuthentication(e,{interactive:!1});const n=await(0,S.ZP)((0,h.ZP)(t),e.url),{status:a,response:o,ok:r}=n;if(!(r&&a>=200&&a<300))return s.message=Ye.getStatusMessageAndLog(e,n),s.error=!0,s;if(s.calendars=(0,w.Z)(o),0===s.calendars.length&&C.Z.warn("Calendar",["caldav"],(0,c.Z)("No calendars found on the server for the account “$1”.",[e.name])),"google"===e.account_type){let e;try{e=await async function(e){const{parsed:t,status:s}=await se(e);if(t.error)return C.Z.error("Calendar",["google","tasks"],"Error fetching TaskList: ",s,t),[];const n=J(t);return n.items.map((e=>({ctag:n.etag,name:e.id,description:e.title,color:"",supportedCalendarComponent:{vevent:!1,vtodo:!0,vjournal:!1},supportsSyncCollection:!1,syncToken:""})))}(t)}catch(e){return s.error=!0,s.message=e.message,s}s.calendars.push(...e)}return s}function Ge(e,t){return Promise.all(e.map((async e=>{const{ctag:s,supportsSyncCollection:i,syncToken:a,...o}=e,r={...o,accountId:t.id,active:e.active??!0,hidden:e.hidden??!1},{calendar:l}=await n.ZP.createCalendar(r,t);if(!l)throw Error("Calendar was not created");return l})))}async function Ke(e,t){const s=a.Z.getCalendars().filter((t=>{if("google"===e.account_type){if(!t.supportedCalendarComponent)return;const{vevent:s}=t.supportedCalendarComponent;return t.accountId===e.id&&s}return t.accountId===e.id})),i=t.filter((e=>!s.some((t=>e.name===t.name)))),o=await Ge(i,e),[l,d]=(0,z.Z)(s,(e=>t.some((t=>t.name===e.name))));await Promise.all(d.map((async e=>await n.ZP.deleteCalendar(e))));const c=o.concat(l);t.forEach((async e=>{const t=c.find((t=>t.name===e.name));if(!t)return;const s={},i=r.ZP.validColor(e.color);i!==t.color&&i&&(s.color=i),e.description!==t.description&&(s.description=e.description),Object.keys(s).length&&await n.ZP.updateCalendar(t.id,s,!1)}));const h=c.filter((t=>t.active&&t.accountId===e.id)),u=[];for(const s of h){const n=t.find((e=>e.name===s.name));if(!n)break;n?.supportsSyncCollection?n.syncToken!==s.ctag&&u.push(await Ve(s,e)):u.push(await Ue(s,e))}await Promise.all(u.filter(Boolean).map((async e=>{const{calendarId:t,ctag:s}=e;await n.ZP.updateCalendar(t,{ctag:s},!1)})));const p=u.filter(Boolean).reduce(((e,t)=>(t.changed&&e++,e)),0);return{numberOfCalendarsPolled:h.length,numberOfChangedCalendars:p}}async function ze(e){const{accountIds:t,interactive:s}=e??{};navigator.onLine&&!Se&&(Se=!0,await Oe());const o={didPoll:!1,calendars:[],error:!1,message:""};if(!navigator.onLine)return o.error=!0,o.message=(0,c.Z)("No network connection."),Ae=setTimeout(ze,2e4),o;Te=!0;let r=a.Z.getAccounts().filter((e=>e.url.length));if(r=r.filter((e=>!Ze.has(e.id))),t?.length&&(r=t.map((e=>r.find((t=>t.id===e)))).filter(Boolean)),Ze.size&&!Ee){Ee=!0;try{await Promise.all(Array.from(Ze.values()).map((async e=>await e.onRemoval(e.accountId))))}catch(e){C.Z.error("Calendar","Error removing account",e)}finally{Ee=!1}}try{for(const e of r){const{url:r,account_type:d,name:u}=e;if(!(!!t&&t.includes(e.id))){const t=a.Z.getState().calendars.filter((t=>t.accountId===e.id)).map((e=>e.lastChecked)).filter(Boolean).reduce(((e,t)=>(t??0)>e?t:e),0),s=Date.now(),n=t?t+1e3*E.jC:s;if(!(n<=s))continue}try{if(n.ZP.stopAPIChangeListeners(),o.didPoll=!0,Ie(d)){const t=await i.Z.getAuthentication(e,{interactive:s||!1}),l=await(0,S.ZP)((0,h.ZP)(t),r),{status:p,response:g,ok:m}=l;let f=[];if(p>=200&&p<300?(f=(0,w.Z)(g),0===f.length&&C.Z.warn("Calendar",["caldav"],(0,c.Z)("No calendars found on the server for the account “$1”.",[u]))):(o.message=Ye.getStatusMessageAndLog(e,l),o.error=!0),m){if("google"===d){let t;try{t=await te(e)}catch(e){return o.error=!0,o.message=e.message,o}o.calendars.push(t)}const t=await Ke(e,f);o.calendars.push(t)}else{const t=a.Z.getState().calendars.filter((t=>t.accountId===e.id)).map((e=>e.id));await Promise.all(t.filter(Boolean).map((async e=>await n.ZP.updateCalendar(e,{lastChecked:Date.now()},!1))))}}else if("ical"===d){const t=await l.Z.fetchAndCreate(e);o.calendars.push(t)}}catch(t){o.message=Ye.getStatusMessageAndLog(e,t.toString()),o.error=!0}finally{const t=a.Z.getState().calendars.filter((t=>t.accountId===e.id)).map((e=>e.id));await Promise.all(t.filter(Boolean).map((async e=>await n.ZP.updateCalendar(e,{lastChecked:Date.now()},!1)))),n.ZP.startAPIChangeListeners()}}}finally{Te=!1,Me.clear();a.Z.getAccounts().some((e=>e.url))&&(Ae=setTimeout((()=>ze()),2e4))}return o}async function $e(e,t,s,n,i){let o,r=(0,x.Z)(e.href||""),l=e.etag,h=e.response;if(!l){const e=await(0,S.ZP)(v(n,{uid:t.uid},s.name,[],"get")),{ok:a,status:o}=e;if(!a){const s="create"===i?(0,c.Z)("Error getting newly created event from server. Retrying on next sync."):(0,c.Z)("Error getting newly updated event from server. Retrying on next sync.");d.Z.setStatus(j.Ex,s,5e3);const n=`${s} ${e.response}`;return void C.Z.error("Calendar",["caldav"],n,o,t)}l=e.etag||"",h=e.response,r=(0,x.Z)(e.href||"")}try{const{VEVENT:e,VTODO:n}=(0,Z.Z)(h);if((e?.length??0+n?.length??0)>0){const t={etag:l,href:r},i=(0,N.rP)(e?.length?e[0]:n[0],s.id,t);i.syncPending=!1;const d=a.Z.getEventsPerCalendar(s.id),c=(await(0,ue.Wy)(d,[i])).filter((e=>!e.recurrenceId));if(1!==c.length)throw console.log("Error saving synced event",h),new Error("Unexpected number of events after update");o=c[0]}else o=await p.Z.updateEvent({...t,syncPending:!1,etag:l,href:r})}catch(e){if(!(e instanceof Z.z))throw e;C.Z.error("Calendar",["caldav","parsing"],e),console.log("iCalendar parsing error, updateEvent",h)}return o}const Ye={calendarServiceStart(){a.Z.addListener(Re),navigator.connection.addEventListener("change",Le)},calendarServiceStop(){a.Z.removeListener(Re),navigator.connection.removeEventListener("change",Le),clearTimeout(Ae)},resetStatus(e){ke[e]&&(ke[e].authenticationErrorCount=0)},resetEventRemoteData:e=>(e.href=void 0,e.url=void 0,e.etag=void 0,e),pollCalDAV(e){const{accountIds:t,interactive:s}=e??{};return Ae&&clearTimeout(Ae),Te?Promise.resolve({didPoll:!1,calendars:[],message:"",error:!1}):ze({accountIds:t,interactive:s})},prepareForDeleteAccount:e=>(Ze.set(e.accountId,e),ze({accountIds:[e.accountId]})),doneDeleteAccount(e){Ze.delete(e)},async deleteEvent(e){const t={ok:!1,deleteLocal:!1},s=a.Z.getEvents().find((t=>t.id===e));if(!s||!navigator.onLine)return t;const n=a.Z.getCalendars().find((e=>e.id===s.calendarId));if(!n)return t;if(!n.active)return C.Z.info("Calendar",`Event ${s.title} not deleted on server. Sync disabled.`),t;const r=a.Z.getAccounts().find((e=>e.id===n.accountId));if(r?.url){const e=await i.Z.getAuthentication(r,{interactive:!0});if("google"!==r.account_type||!s.task){let{href:t}=s;if(!t){const{eventHref:i}=o.Z.urlForEvent(e.url,n.name,{etag:s.etag,uid:s.uid});t=i}const i=await(0,S.ZP)(v(e,{href:t},n.name,[],"delete"));return i.ok||Ye.getStatusMessageAndLog(r,i),{ok:i.ok,deleteLocal:[404,409,412].includes(i.status)}}if(!s.uid)return t;!async function(e,t){const{accessToken:s}=e,n=`${(0,E.fL)()}/tasks/v1/lists/@default/tasks/${t}?key=${await(0,B.w)()}`,i=await fetch(n,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}}),{status:a,ok:o,statusText:r}=i;if(!o)throw C.Z.log("Calendar",["google, tasks"],"Error deleting task",a,r),Error(`Error deleting task", ${a} ${r}`)}(e,s.uid)}return t},async updateEvent(e,t){if(!navigator.onLine)return void await p.Z.updateEvent({id:e.id,syncPending:!0});let s={...e};const n=a.Z.getCalendars().find((e=>e.id===s.calendarId)),r=a.Z.getAccounts();if(!n)return;if(!n.active)return void C.Z.info("Calendar",`Event ${s.title} not updated on server. Sync disabled.`);const{accountId:l}=n,h=r.find((e=>e.id===l));if(!h)return;const u=await i.Z.getAuthentication(h,{interactive:!0});if("google"===h.account_type&&s.task){const t=await async function(e,t,s){const{accessToken:n}=e,{etag:i="",title:a,uid:o="",end:r,description:l}=t,d=`${(0,E.fL)()}/tasks/v1/lists/${s}/tasks/${o}?key=${await(0,B.w)()}`;let c;r&&(c=G().tz(G()(r),"UTC").format(q));const h={status:t.complete?"completed":"needsAction",...(0,g.Z)(t.complete?{completed:G().tz(G()(),"UTC").format(q)}:null)},u={kind:"tasks#taskList",id:`${o}`,etag:`${i}`,title:`${a}`,...(0,g.Z)(c?{due:c}:null),...(0,g.Z)(l?{notes:l}:null),...h},p=await fetch(d,{method:"PUT",headers:{Accept:"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(u)}),{status:m,ok:f,statusText:v}=p;if(!f)throw C.Z.error("Calendar",["google, tasks"],"Error updating task",m,v),Error(`Error updating task", ${m} ${v}`);return await p.json()}(u,s,n.name),{etag:i}=t;return p.Z.updateEvent({id:e.id,syncPending:!1,etag:i})}if(s.href||s.etag){const{etag:e,href:i,uid:r}=s,l={etag:e,href:i,uid:r},h=[...ve(s,t?.exceptionEvent),s];let p=await(0,S.ZP)(v(u,l,n.name,h,"update"));const{ok:g,status:m}=p;if(!g){if(409!==m&&412!==m){const e=(0,c.Z)("Error synching updates to server. Changes not saved.");return d.Z.setStatus(j.Ex,e,5e3),void C.Z.warn("Calendar",["caldav"],e,p.response,m)}{s.href||(s.href=o.Z.urlForEvent(u.url,n.name,l).eventHref);const e=await async function(e,t,s){const{urlValid:n}=T.Z.utilities.isUrlValid(t),i=n?t:ae(e.url,t),a=await(0,S.ZP)({...e,method:"GET",url:i,headers:{"Content-Type":"text/calendar",Accept:"application/xml, text/calendar"}});if(!a.ok)return void C.Z.warn("Calendar",["caldav"],"Error getting event.",a.status,a.response);const{etag:o,response:r}=a;try{const{VEVENT:e,VTODO:n}=(0,Z.Z)(r),i=e?.[0]??n?.[0];return(0,N.rP)(i,s,{etag:o,href:t})}catch(e){if(e instanceof Z.z)return C.Z.warn("Calendar",["caldav"],e),void console.log("CalDAV iCalendar parsing error.",r);throw e}}(u,s.href,n.id);if(!e)return;const i=t?.originalEvent;if(i){const o=O(i,s,e),{etag:r,href:l,uid:d,sequence:c}=e,h=c?c+1:1;try{s=function(e,t,s){const n={...e};s&&(n.sequence=s);for(const[e,s]of t.incoming.entries()){if(t.local.has(e)&&t.local.get(e)!==s)throw new Error("Can not merge events. Inconsolable changes.");n[e]=s}for(const[e,s]of t.local.entries())n[e]=s;return n}(i,o,h)}catch{throw new Ce(o,{...s,sequence:h,etag:e.etag},(0,N.KU)({...e,sequence:h},i))}const g={etag:r,href:l,uid:d},m=o.incoming.has("recurrenceExceptions")?[...(e.exceptionEvents??[]).map((e=>P(e,s))),s]:[...ve(s,t?.exceptionEvent),s],f=v(u,g,n.name,m,"update");p=await(0,S.ZP)(f);const{ok:b,status:w}=p;if(!b)return C.Z.error("Calendar",["caldav"],"Error syncing to server, merging changes failed.",p.response,w),void console.log(f.body);const y=(0,Z.Z)(f.body??""),x=y.VEVENT.length?y.VEVENT:y.VTODO;x?.length&&await(0,ue.Wy)(a.Z.getEvents(),x.map((e=>(0,N.rP)(e,s.calendarId,{etag:r,href:l}))))}}}return $e(p,s,n,u,"update")}return s.sequence=0,Ye.createEvent(s)},async createEvent(e){if(!navigator.onLine)return;const t={...e,uid:e.uid||crypto.randomUUID()},s=a.Z.getAccounts();let o=a.Z.getCalendars().find((e=>e.id===t.calendarId));if(!o)return void C.Z.debug("Calendar not found for event",t);if(!o.active)return void C.Z.info("Calendar",`Event ${t.title} not created on server. Sync disabled.`);const{etag:r,href:l,uid:d}=t,{accountId:h}=o,u=s.find((e=>e.id===h));if(!u)return void C.Z.debug("Account not found for event",t);const m={etag:r,href:l,uid:d};let f;d&&Me.add(d);const b=await i.Z.getAuthentication(u,{interactive:!0}),w=o.id;if("google"===u.account_type&&t.task){const e=fe(u);if(!e.find((e=>e.id===w))){if(!(e.length>0))return void C.Z.log("Calendar",["google","tasks"],"Warning. No Google Task list found. Task not created.");o=e[0]}const s=await async function(e,t,s){const{accessToken:n}=e,{etag:i="",title:a,uid:o="",end:r,description:l}=s,d=[(0,E.fL)(),"/tasks/v1/lists/",t,`tasks?key=${await(0,B.w)()}`],c=X(d),h=r?G()((0,$.VV)(new Date(r))).format(q):void 0,u={kind:"tasks#taskList",id:`${o}`,etag:`${i}`,title:`${a}`,due:h?`${h}`:void 0,...(0,g.Z)(l?{notes:l}:null)},p=await fetch(c,{method:"POST",headers:{Accept:"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(u)}),{status:m,ok:f,statusText:v}=p;if(!f)throw C.Z.error("Calendar",["google, tasks"],"Error creating task",m,v),Error(`Error creating task", ${m} ${v}`);return await p.json()}(b,o.name,t);t.etag=pe(s.etag),t.uid=s.id,t.syncPending=!1,await p.Z.updateEvent(t)}else{const e=await(0,S.ZP)(v(b,m,o.name,[...ve(t),t],"create")),{ok:s,status:i}=e;if(!s){if(412===i||409===i){const{id:e,uid:s}=t;if(a.Z.getEvents().some((n=>n.uid===s&&n.id!==e&&!t.trash)))return n.ZP.deleteEvent(t.id)}const s=`${(0,c.Z)("Error creating event on server. Retrying on next sync.")} ${e.response}`;return void C.Z.error("Calendar",["caldav"],s,i,t)}f=await $e(e,t,o,b,"update")}return d&&Me.delete(d),f},updateCalendar:(e,t)=>new Promise(((s,n)=>{const l=a.Z.getAccounts(),d=a.Z.getCalendars().find((t=>t.id===e));if(!d)return void s();const{accountId:c}=d,h=l.find((e=>e.id===c));if(!h?.url)return void s();const p={};t.description!==d.description&&(p.description=t.description);const g=r.ZP.validColor(t.color);t.color===d.color||!g||"google"===h?.account_type&&d.supportedCalendarComponent?.vtodo||(p.color=g),0!==Object.keys(p).length?i.Z.getAuthentication(h,{interactive:!1}).then((e=>{(0,S.ZP)(function(e,t,s,n){let i="";const a=(0,u.Z)(t);if(a){const{protocol:e,host:t}=a;if(e&&t){const n=e+"//"+t;i=o.Z.constructUrl([n,s])}}const r=[];return n.description&&r.push(`<D:displayname>${n.description}</D:displayname>`),n.color&&r.push(`<calendar-color xmlns="http://apple.com/ns/ical/">${n.color}</calendar-color>`),{...e,url:i,method:"PROPPATCH",body:`<?xml version="1.0" encoding="UTF-8"?>\n<D:propertyupdate xmlns:D="DAV:"\nxmlns:CS="http://calendarserver.org/ns/"\nxmlns:C="urn:ietf:params:xml:ns:caldav">\n<D:set>\n<D:prop>\n${r.join("\n")}\n</D:prop>\n</D:set>\n</D:propertyupdate>`}}(e,h.url,d.name,p)).then((e=>{e.ok&&s()})).catch((e=>{n(e)}))})):s()})),async createCalendar(e,t){if("google"===e.account_type){const{name:s,description:n}=t,i=s||n||"";return await V(e,i)}return await async function(e,t){const s={message:"",status:!1,name:"",description:""},{name:n,color:a,description:o,supportedCalendarComponent:r}=t,l=n||o||"";let d;try{d=await i.Z.getAuthentication(e,{interactive:!0})}catch(e){return s.message=e,s}const{url:h}=d,u=`${h.endsWith("/")?h:h+"/"}${l}`,p={...d,url:u,method:"MKCALENDAR",contentType:"application/xml",body:R(l,a,r)},g=await(0,S.ZP)(p);if(g.ok){const e={...p,method:"PROPFIND",headers:{Brief:"t",Depth:"1"},body:'<?xml version="1.0" encoding="utf-8"?><D:propfind xmlns:D="DAV:">\n                  <D:prop><D:getetag /><D:getcontenttype /></D:prop></D:propfind>'},t=await(0,S.ZP)(e);if(t.ok){const e=await t.response,n=(0,L.Z)(e);if(n.d_error||n.parsererror||!n.d_multistatus)return s.message=(0,c.Z)("Error parsing calendar path response."),console.log("Create Calendar parse error",e),s;n.d_multistatus.d_response.forEach((e=>{s.name=(0,x.Z)(e.d_href.content),s.status=!0,s.message=(0,c.Z)("Success")}))}else s.message=`${(0,c.Z)("Error creating Calendar.")} ${t.status}}`,console.log("Create Calendar Error",t.response)}else 405===g.status?(s.message=(0,c.Z)("Error creating Calendar. It might already exist."),console.log("Create Calendar 405 error",g.response)):(s.message=(0,c.Z)("Error creating Calendar."),console.log("Create Calendar error",g.response));return s}(e,t)},async deleteCalendar(e,t){const{account_type:s,url:n}=e;if("google"===s){const s=a.Z.getCalendars().find((e=>e.name===t));if(!s?.supportedCalendarComponent)return{message:(0,c.Z)("Calendar not found"),status:!1};const{supportedCalendarComponent:n}=s,{vtodo:o}=n;if(o){return async function(e,t){const{accessToken:s}=e,n=`${(0,E.fL)()}/tasks/v1/users/@me/lists/${t}?key=${await(0,B.w)()}`,i=await fetch(n,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}}),{status:a,ok:o}=i;let r=i.statusText;return o||(r=`Error deleting task list. ${(await i.json())?.error?.message}`,C.Z.log("Calendar",["google","tasks"],r,a)),{status:o,message:r}}(await i.Z.getAuthentication(e,{interactive:!0}),t)}return async function(e,t){const s=await i.Z.getAuthentication(e,{interactive:!1}),{accessToken:n}=s,a=[(0,E.fP)(),"/v3/calendars",(o=U(t),o.endsWith("/")?o.slice(0,-1):o),`?key=${await(0,B.w)()}`];var o;const r=F(a),l=await fetch(r,{method:"DELETE",headers:{Authorization:`Bearer ${n}`,Accept:"application/json"}}),{status:d,ok:c}=l;let h=l.statusText;return c||(h=`Error deleting calendar. ${(await l.json())?.error?.message}`,C.Z.log("Calendar",["google"],h,d)),{status:c,message:h}}(e,t)}const o=await i.Z.getAuthentication(e,{interactive:!0}),{ok:r,status:l,response:d}=await(0,S.ZP)({...o,url:ge(n,t),method:"DELETE",headers:{Depth:"infinity"}});let h="";return r||(C.Z.warn("Calendar",["caldav"],l,d),h=`${(0,c.Z)("Error deleting calendar.")} ${d}`),{message:h,status:r}},getCalendarUrl(e,t){if("google"===e)return(0,E.A2)(t);if("vivaldi"===e)return(0,E.Mf)(t);if("fastmail"===e)return(0,E.L9)(t);throw Error("getCalendarUrl. Unsupported account type")},async getCalDAVAccountDetails(e,t){const{name:s,url:n,account_type:a,username:o,password:r}=e,l={id:"",name:s,url:n,account_type:a,username:o,interval:E.jC},d={account:l,password:r,calendars:[]};"vivaldi"===a?l.username=(0,ne.JI)(l.username):"fastmail"===a?o&&-1===o.indexOf("@")&&(l.username=`${o}@fastmail.com`):"google"===a&&(l.username=l.username.toLowerCase(),o&&-1===o.indexOf("@")&&(l.username=`${o}@gmail.com`)),t((0,c.Z)("Verifying..."),we,l);let h={statusMessage:"",foundService:!1};if("caldav"===a){if(h=await(0,ce.k)(l,r),!h.foundService){throw t(h.statusMessage||(0,c.Z)("Unknown connection error. Please check your account information."),xe),new Error(h.statusMessage)}l.url=h.calendarHomeSetURL,t((0,c.Z)("Connected to CalDAV, found $1 calendar.","Connected to CalDAV, found $1 calendars.",[h.calendars.length]),ye,l)}else if(be(a)){l.url=Ye.getCalendarUrl(a,l.username);try{const e=await i.Z.getAuthentication(l,{interactive:!1});e.username!==l.username&&(l.username=e.username,l.url=Ye.getCalendarUrl(a,l.username))}catch(e){throw t((0,c.Z)("Login aborted. Please try again."),xe),e}h=await(0,ce.P)(l,r)}if(!h?.foundService)return t(h.statusMessage,xe),d;const u=await i.Z.getAuthentication(l,{password:r,interactive:!1}),p=await He(l,u);return p.error?(t((0,c.Z)("Error getting calendars.")+p.message,xe),d):(d.calendars=p.calendars,d)},async saveCalendarAccount(e,t){let{account:s,password:i}=e;try{s.url=new URL(s.url).href;const{url:e,username:t,account_type:n}=s;(["caldav","vivaldi"].includes(n)||"ical"===n&&t)&&(0,he.vW)({url:e,username:t},i)}catch(e){throw t(e.message,xe),e}try{const{id:e,...i}=s;s=await n.ZP.createAccount(i),t((0,c.Z)("Account saved"),ye)}catch(e){return t((0,c.Z)("Error saving account:")+String(e?.message||e),xe),!1}try{await Ge(e.calendars,s)}catch(e){return t((0,c.Z)("Error saving calendars:")+String(e?.message||e),xe),!1}return!0},getStatusMessageAndLog(e,t){const s="string"==typeof t?-1:t.status,n="string"==typeof t?t:t.response,{account_type:i,name:a}=e;let o="";return ke[a]||(ke[a]={authenticationErrorCount:0}),401===s?(o=(0,c.Z)("Authentication for the account “$1” failed. Check your username and password in your calendar account settings, or contact your account provider.",[a]),C.Z.error("Calendar",[i,"polling"],o)):403===s?o=(0,c.Z)("Forbidden request for the account “$1”. Possible mismatch in state of client and server.",[a]):404===s?(o="ical"===i?(0,c.Z)("The remote calendar for the account “$1” is missing on the server. Verify your calendar account settings, or contact the calendar service provider. $2",[a,n]):(0,c.Z)("The user account or a calendar is missing on the account server “$1”. Verify your calendar account settings, or contact your calendar service provider. $2",[a,n]),C.Z.error("Calendar",[i,"polling"],o,t)):410===s?(o="ical"===i?(0,c.Z)("The remote calendar for the account “$1” has been removed from the server. Remove the calendar from your account settings, or contact your calendar service provider. $2",[a,n]):(0,c.Z)("The user account or calendar has been removed from the account server for “$1”. Remove the account or calendar from your account settings, or contact your calendar service provider. $2",[a,n]),C.Z.error("Calendar",[i,"polling"],o,t)):429===s?(o=(0,c.Z)("The account server is temporarily refusing more requests for account “$1”. $2",[a,n]),console.log("Calendar",[i,"polling"],o,t)):s>=400&&s<500?(o=(0,c.Z)("Unexpected client-side problem (HTTP $2) for account “$1”. $3",[a,s,n]),C.Z.warn("Calendar",[i,"polling"],o,t)):503===s?(o=(0,c.Z)("The account server is temporarily unavailable (HTTP 503) for account “$1”. $2",[a,n]),console.log("Calendar",[i,"polling"],o,t)):s>=500?(o=(0,c.Z)("Unexpected server-side problem (HTTP $2) for account “$1”.",[a,s]),C.Z.warn("Calendar",[i,"polling"],o,t)):-1===s&&navigator.onLine?(n.includes("abortOnLoadForNonInteractive")?(o=(0,c.Z)("oAuth authentication failed for account “$1”",[a]),C.Z.debug(n)):o=(0,c.Z)("Network problem for account “$1”. $2",[a,n]),C.Z.warn("Calendar",[i,"polling"],o,t)):(o=(0,c.Z)("Unexpected problem when retrying server data for account “$1”. $2",[a,n]),navigator.onLine&&C.Z.warn("Calendar",[i,"polling"],o,s,t)),o}},Xe=Ye},35391:(e,t,s)=>{"use strict";s.d(t,{Z:()=>l,h:()=>r});var n=s(84749);const i="DAV:",a="urn:ietf:params:xml:ns:caldav",o="http://calendarserver.org/ns/",r={prefixes:{":":"",[i]:"d",[a]:"c",[o]:"cs"},simplify:[{parentns:a,parent:"calendar-home-set",elementns:i,element:"href"},{parentns:a,parent:"calendar-multiget",elementns:i,element:"prop"},{parentns:a,parent:"calendar-query",elementns:a,element:"filter"},{parentns:a,parent:"calendar-query",elementns:i,element:"prop"},{parentns:a,parent:"comp-filter",elementns:a,element:"comp-filter"},{parentns:i,parent:"current-user-principal",elementns:i,element:"href"},{parentns:a,parent:"filter",elementns:a,element:"comp-filter"},{parentns:i,parent:"multistatus",elementns:i,element:"sync-token"},{parentns:i,parent:"prop",elementns:a,element:"calendar-data"},{parentns:i,parent:"prop",elementns:a,element:"calendar-home-set"},{parentns:i,parent:"prop",elementns:i,element:"current-user-principal"},{parentns:i,parent:"prop",elementns:i,element:"displayname"},{parentns:i,parent:"prop",elementns:o,element:"getctag"},{parentns:i,parent:"prop",elementns:i,element:"getetag"},{parentns:i,parent:"prop",elementns:i,element:"resourcetype"},{parentns:i,parent:"prop",elementns:a,element:"supported-calendar-component-set"},{parentns:i,parent:"prop",elementns:i,element:"sync-token"},{parentns:i,parent:"propfind",elementns:i,element:"prop"},{parentns:i,parent:"propstat",elementns:i,element:"prop"},{parentns:i,parent:"propstat",elementns:i,element:"status"},{parentns:i,parent:"propstat",elementns:i,element:"errordescription"},{parentns:i,parent:"response",elementns:i,element:"href"},{parentns:i,parent:"response",elementns:i,element:"status"},{parentns:i,parent:"response",elementns:i,element:"errordescription"},{parentns:a,parent:"sync-collection",elementns:i,element:"prop"},{parentns:i,parent:"sync-collection",elementns:o,element:"sync-level"},{parentns:i,parent:"sync-collection",elementns:o,element:"sync-token"}]};function l(e){const t=(0,n.Z)(e,r);return Array.isArray(t?.d_multistatus?.d_response)&&(t.d_multistatus.d_response=t.d_multistatus.d_response.map((e=>{if(!Array.isArray(e.d_propstat))return e;const t=e.d_propstat.filter((e=>{var t;return-1!==(t=e.d_status,Array.isArray(t)?t[0]:t).content.indexOf("200")})),s=t.reduce(((e,t)=>!e.d_prop||Array.isArray(e.d_prop)||Array.isArray(t.d_prop)?Object.assign(e,t):(e.d_prop=Object.assign(e.d_prop,t.d_prop),e)),{});return e.d_propstat=s,e}))),t}},64877:(e,t,s)=>{"use strict";function n(e){return{...e,headers:{Depth:"1"},method:"PROPFIND",body:'<?xml version="1.0" encoding="UTF-8"?>\n    <D:propfind xmlns:D="DAV:"\n      xmlns:CS="http://calendarserver.org/ns/">\n      <D:prop>\n        <D:getetag />\n        <D:displayname />\n        <CS:getctag />\n        <D:resourcetype />\n        <supported-calendar-component-set xmlns="urn:ietf:params:xml:ns:caldav" />\n        <calendar-color xmlns="http://apple.com/ns/ical/" />\n        <D:supported-report-set />\n        <D:sync-token />\n      </D:prop>\n    </D:propfind>'}}function i(){return'<?xml version="1.0" encoding="utf-8"?>\n    <D:propfind xmlns:D="DAV:">\n      <D:prop>\n        <D:current-user-principal />\n        <D:resourcetype xmlns:D="DAV:" />\n      </D:prop>\n    </D:propfind>'}function a(){return'<?xml version="1.0" encoding="utf-8"?>\n    <D:propfind xmlns:D="DAV:">\n      <D:prop>\n        <D:displayname />\n        <schedule-inbox-URL xmlns="urn:ietf:params:xml:ns:caldav" />\n        <schedule-outbox-URL xmlns="urn:ietf:params:xml:ns:caldav" />\n        <calendar-user-address-set xmlns="urn:ietf:params:xml:ns:caldav" />\n        <default-calendar-URL xmlns="http://icewarp.com/ns/" />\n        <default-tasks-URL xmlns="http://icewarp.com/ns/" />\n        <default-contacts-URL xmlns="http://icewarp.com/ns/" />\n        <default-notes-URL xmlns="http://icewarp.com/ns/" />\n        <calendar-home-set xmlns="urn:ietf:params:xml:ns:caldav" />\n        <addressbook-home-set xmlns="urn:ietf:params:xml:ns:carddav" />\n        <D:resourcetype xmlns:D="DAV:" />\n        <supported-calendar-component-set xmlns="urn:ietf:params:xml:ns:caldav" />\n      </D:prop>\n    </D:propfind>'}s.d(t,{P_:()=>i,ZP:()=>n,sp:()=>a})},13095:(e,t,s)=>{"use strict";s.d(t,{J:()=>g,Z:()=>m});var n=s(45660),i=s(29526),a=s(84749),o=s(8687),r=s(35391);function l(e,t){const s=e[t];if(!s)throw new Error(`Property '${t}' not found parsing caldav.`);if(Array.isArray(s)){if(n.Z.info("Calendar",["parser","caldav"],`Unexpected array value for '${t}' property.`),0===s.length)throw new Error(`No value for '${t}' property parsing caldav.`);return s[0]}return s}function d(e,t){const s=e?.[t];return s?Array.isArray(s)?s:[s]:[]}function c(e){const t=l(e,"d_status").content,s=t.match(/\d{3}/);if(!s)throw new Error(`HTTP Status value not found in string: '${t}'`);return parseInt(s[0])}function h(e){return new Set(Object.keys(e).flatMap((t=>"attributes"===t||"content"===t?[]:d(e,t).map((e=>[t,e])))))}function u(e,t){if(s=t,2===Object.keys(s).length&&!s.content&&0===Object.keys(s.attributes).filter((e=>!e.includes("xmlns"))).length)return[e];if(t.content)return[p(t.content)];{const e=Object.keys(t.attributes).find((e=>e.endsWith("name")));if(e)return[t.attributes[e]]}var s;return Array.from(h(t)).flatMap((([e,t])=>u(e,t)))}function p(e){return e.replace(/^"([\s\S]*)"$/m,"$1")}function g(e){return Array.isArray(e)?e[0]:e}function m(e){const t=(0,a.Z)(e,r.h);if(t.parsererror)throw new Error(`Error parsing multistatus XML. ${t.errormessage??""}`);if(!t?.d_multistatus&&!t?.d_error)throw new Error("Error parsing multistatus. Unexpected XML format.");let s="";try{s=l(t.d_multistatus,"d_syncToken").content}catch{}if(t.d_error){return{responses:[],syncToken:s,error:!0,errorMessage:(0,o.ti)(e,"text/xml")}}return{responses:d(t.d_multistatus,"d_response").map((e=>{const t={href:(0,i.Z)(l(e,"d_href").content)};let s;try{s=d(e,"d_propstat")}catch{}const n=e.d_status&&c(e);if(n&&(t.status=n),!s)return t;for(const e of s){const s=c(e),n=h(l(e,"d_prop"));s&&!t.status&&(t.status=s);for(const[e,i]of n.values()){let n="";if(i.content)n=p(i.content);else{const e=h(i),t=[];for(const[s,n]of e.values())t.push(...u(s,n));t.length&&(n=t)}t[e.indexOf("_")>=0?e.split("_")[1]:e.substring(e.lastIndexOf(":")+1)]={status:s,value:n}}}return t})),syncToken:s}}},23796:(e,t,s)=>{"use strict";s.d(t,{Z:()=>o});var n=s(45660),i=s(13095),a=s(29526);function o(e){const t=[];try{const s=(0,i.Z)(e);for(const e of s.responses){if(!e.resourcetype.value.includes("c_calendar"))continue;const s=(0,a.Z)((0,i.J)(e.syncToken?.value));t.push({name:(0,a.Z)(e.href),description:(0,i.J)(e?.displayname.value),color:(0,i.J)(e.calendarColor?.value),ctag:(0,a.Z)((0,i.J)(e.getctag?.value)),supportsSyncCollection:!(!e.supportedReportSet?.value.includes("d_syncCollection")||!s),syncToken:s,supportedCalendarComponent:{vevent:e.supportedCalendarComponentSet?.value.includes("VEVENT"),vtodo:e.supportedCalendarComponentSet?.value.includes("VTODO"),vjournal:!1}})}}catch(t){n.Z.error("Calendar",["caldav"],"CalendarPropfind parse error",t),console.log("Error reading calendarPropfind.",e)}return t}},8687:(e,t,s)=>{"use strict";s.d(t,{ZP:()=>u,ti:()=>c});var n=s(2711),i=s(34929),a=s(56371),o=s(71237),r=s(45660),l=s(84749);const d={prefixes:{":":"","DAV:":"d","http://sabredav.org/ns":"sabre"}};function c(e,t=""){if(t.includes("application/xml")||t.includes("text/xml")){const t=(0,l.Z)(e,d);if(t.parsererror)return r.Z.debug(e),"Error parsing error response.";if("d_error"===t.root){const e=t.d_error.sabre_message;if(Array.isArray(e))return e[0].content;if(t?.d_error?.d_validSyncToken)return"Invalid Sync Token"}}else if(t.includes("text/html")){const t=document.createElement("div");t.innerHTML=e;const s=(t.textContent||t.innerText)?.replace(/^\s+|\s+$/g,"").replace(/\s*\n[\s\n]*/g,"\n");return s||"Error parsing html error response."}return t.includes("text/plain")?e:""}const h={call:async function e(t,s,r){const{username:l,password:d,account_type:h,body:u,method:p,contentType:g,accessToken:m,headers:f={},href:v}=t;s||(s=t.url);const b=g?.includes("json")?"application/json, text/json":"application/xml, text/xml";try{const w={...f,Authorization:m?`Bearer ${m}`:(0,o.Z)(l,d),Accept:f.Accept||b,"Content-Type":g||"application/xml; charset=utf-8"},y=await fetch(s,{method:p,credentials:"omit",headers:w,body:u}),{status:x,ok:I}=y,A=y.headers.get("content-type")||void 0,S={href:v,response:await y.text(),etag:(C=y.headers.get("etag")||"",C.split('"').join("")),status:x,ok:I};if(I)return S;{if(401===x&&m&&!r){const{accessToken:a}=await n.Z.fetchAccessTokenAndRefreshToken(l,i.Z.getOAuthServiceProvider(h),!1);return t.accessToken=a,e(t,s,!0)}const o=c(S.response,A);return{etag:"",response:o?(0,a.Z)("Server response: $1",[o]):S.response,status:x,ok:!1}}}catch(e){return{etag:"",response:e.message,status:-1,ok:!1}}var C}};async function u(e,t){return h.call(e,t)}},88545:(e,t,s)=>{"use strict";s.d(t,{P:()=>S,k:()=>y});var n=s(2711),i=s(34929),a=s(87265),o=s(82649),r=s(15800),l=s(56371),d=s(71237),c=s(35391),h=s(64877),u=s(45660),p=s(13095);var g=s(23796);var m=s(8687),f=s(7064),v=s(24522),b=s(25372);const{concatUrl:C}=a.Z,{isOAuthProvider:w}=r.ZP;async function y(e,t){const s={contextPath:"",currentUserPrincipalURL:"",calendarHomeSetURL:"",foundService:!1,calendars:[],statusMessage:""},{url:n,username:i}=e;if(n)s.contextPath=n;else{const e=i.indexOf("@");if(!(e>0))return s.statusMessage=(0,l.Z)("Please provide valid server address."),s;{const t=i.substring(e+1,i.length);s.contextPath=`https://${t}`}}const a=await A(e,t,"");if(a.userPrincipal){const{urlValid:n}=f.Z.utilities.isUrlValid(a.userPrincipal);s.currentUserPrincipalURL=n?a.userPrincipal:C(s.contextPath,a.userPrincipal);const i=await I(e,t,s.currentUserPrincipalURL);f.Z.utilities.isUrlValid(i).urlValid?s.calendarHomeSetURL=i:s.calendarHomeSetURL=C(s.contextPath,i);const o=await x(e,t,s.calendarHomeSetURL);return s.calendars=o,s.foundService=!0,s.contextPath=e.url,s}const o=await async function(e,t,s){let n="";const i=(0,b.Z)(e);i&&({host:n}=i);const a=(0,v.II)(n);try{const n=await fetch(a,{method:"GET",headers:{Authorization:(0,d.Z)(t,s)}}),{status:i,ok:o}=n;if(o){if(404===i)return{redirectedUrl:"",message:(0,l.Z)("Service not found.")};if(401===i||403===i)return{redirectedUrl:"",message:(0,l.Z)("Authentication error. Check your credentials and try again.")}}const r=(0,b.Z)(n.url),c=(0,b.Z)(e);return!(r?.href===c?.href)&&r?{redirectedUrl:r.href,message:""}:{redirectedUrl:"",message:""}}catch(e){return{redirectedUrl:"",message:(0,l.Z)("Network error.")}}}(s.contextPath,i,t);o.redirectedUrl&&(s.contextPath=o.redirectedUrl);const r=await A(e,t,s.contextPath);if(!r.authenticated)return s.statusMessage=r.message,s;const{userPrincipal:c}=r;if(c){s.currentUserPrincipalURL=c;const{urlValid:n}=f.Z.utilities.isUrlValid(c);n||(s.currentUserPrincipalURL=C(s.contextPath,c));const i=await I(e,t,s.currentUserPrincipalURL);f.Z.utilities.isUrlValid(i).urlValid?s.calendarHomeSetURL=i:s.calendarHomeSetURL=C(s.contextPath,i);const a=await x(e,t,s.calendarHomeSetURL);s.foundService=!0,s.calendars=a}return s}async function x(e,t,s){const n={...e,accessToken:"",password:t},i=await(0,m.ZP)((0,h.ZP)(n),s||e.url);return(0,g.Z)(i.response)}async function I(e,t,s){const n={username:e.username,password:t,url:s||e.url,accessToken:"",method:"PROPFIND",headers:{Brief:"t",Depth:"0"},body:(0,h.sp)()},{ok:i,response:a,status:o}=await(0,m.ZP)(n);if(!i)return u.Z.warn("Calendar","Error fetching homeset.",o),console.log("Calendar service discovery request error.",a),"";const{calendarHomeSet:r,errorMsg:l}=function(e){try{const t=(0,p.Z)(e);for(const e of t.responses){const t=e.calendarHomeSet?.value;if(!t)continue;let s;return Array.isArray(t)?(1!==t.length&&u.Z.info("Calendar",["caldav","homeset"],"Unexpected multiple HomeSet values"),s=t[0]):s=t,{calendarHomeSet:s,errorMsg:""}}if(1===t.responses.length){const e=t.responses[0];if(200===e.status&&e.href)return{calendarHomeSet:e.href,errorMsg:""}}}catch(e){return{calendarHomeSet:"",errorMsg:`CalendarHomeSet error: ${e.message}`}}return{calendarHomeSet:"",errorMsg:"Unexpected multistatus. HomeSet not found"}}(a);return l&&(u.Z.warn("Calendar","Error parsing homeset.",l),console.log("CalDAV homeset parse error.",a)),r}async function A(e,t,s){const{username:n}=e,i={authenticated:!1,userPrincipal:"",message:"",isCalendarUrl:!1};try{const a=await fetch(function(e){return e+(e.endsWith("/")?"":"/")}(s||e.url),{method:"PROPFIND",credentials:"omit",headers:{Brief:"t",Depth:"0","Content-Type":"text/xml;charset=UTF-8",Authorization:(0,d.Z)(n,t)},body:(0,h.P_)()}),{status:o,ok:r}=a;if(r)o>=200&&o<=299&&(i.authenticated=!0);else{if(401===o)return i.message=(0,l.Z)("Authentication failed. Check your username and password."),i;if(403===o)return i.message=(0,l.Z)("Not authorized. Check your username and password or contact your server administrator for further assistance."),i;if(404===o)return i.message=(0,l.Z)("No CalDAV service found. Check your account info."),i;if(405===o)return i}const g=await a.text(),m=(0,c.Z)(g);if(m.d_error||!m.d_multistatus)return i.message=(0,l.Z)("Error parsing response data from server."),i;const f=function(e){let t="";try{const s=(0,p.Z)(e);for(const e of s.responses)e.currentUserPrincipal?t=(0,p.J)(e.currentUserPrincipal.value):e.href&&(t=e.href)}catch(t){u.Z.error("Calendar",["caldav"],"MultiStatus parse error",t),console.log("Error reading multiStatus.",e)}return t}(g);f&&(i.userPrincipal=f)}catch(t){i.message=(0,l.Z)("CalDAV service not found at ‘$1’. Please check if the URL is correctly typed. Error message ‘$2’.",[s||e.url,t.message])}return i}async function S(e,t){const{account_type:s,username:a,url:r}=e,{urlValid:d}=f.Z.utilities.isUrlValid(r),c={calendars:[],eventCount:0,foundService:!1,statusMessage:""};if(!d)return{statusMessage:(0,l.Z)("Invalid URL"),...c};let u;try{u=w(s)?await i.Z.getAuthentication(e,{interactive:!0}):{accessToken:"",id:"",name:"",url:r,username:a,password:t}}catch(e){return Promise.resolve(c)}try{const t=await(0,m.ZP)((0,h.ZP)(u),r);if(!t.ok){const s=o.Z.getStatusMessageAndLog(e,t);return{...c,statusMessage:s}}const s=(0,g.Z)(t.response);return{...c,foundService:!0,calendars:s}}catch(e){return e.status&&n.Z.fetchAccessTokenAndRefreshToken(u.username,i.Z.getOAuthServiceProvider(s),!0),{...c,statusMessage:e.statusText}}}},9141:(e,t,s)=>{"use strict";s.d(t,{$E:()=>m,Wy:()=>h,YQ:()=>u});var n=s(2934),i=s(50522),a=s(98035),o=s(45660),r=s(28773),l=s(7064),d=s(34006);async function c(e,t,s){function o(e,t){for(const n of s.values())if(n.parent_event_id===e&&n.date===t)return n}t.recurrenceExceptions&&n.ZP.trimExceptions(e,t);let r=0;e.start&&t.start?r=e.start-t.start:e.end&&t.end&&(r=e.end-t.end);for(const s of e.recurrenceExceptions??[]){const{date:d,cancelled:c}=s;if(!d)break;const h=o(t.id,d-r);if(c)h?(!r&&h.cancelled||l.Z.calendar.updateRecurrenceException(h.exception_id??"",{date:h.date+r,cancelled:c}),h.exception_event_id&&n.ZP.deleteEvent(h.exception_event_id)):a.Z.createException(t.id,c,d);else{const s=h?.exception_event_id&&i.Z.getEvent(h.exception_event_id),o=e.exceptionEvents?.find((e=>e.recurrenceId===d));if(s&&o){const{recurrenceId:t,recurrenceExceptions:n,invites:i,notifications:r,...l}=o;l.calendarId=e.calendarId,await a.Z.updateEventFromServer(s.id,l)}if(h)await l.Z.calendar.updateRecurrenceException(h.exception_id??"",{date:h.date+r});else{if(!o)return void a.Z.createException(t.id,!0,d);const{start:s,end:i,title:r,description:l}=o,{rrule:c,exceptionEvents:h,attachment:u,invites:p,notifications:g,recurrenceExceptions:m,...f}=e;if(!s||!i)return;f.start=s,f.end=i,f.title=r,f.description=l;const v=await n.ZP.createEvent({...f,is_template:!1},!1);a.Z.createException(t.id,!1,d,v.id),a.Z.updateEvent({id:t.id,sequence:e.sequence,etag:e.etag})}}}}async function h(e,t){return p(e,t,(function(e,t){return e.uid===t.uid&&e.etag!==t.etag}))}async function u(e,t){return p(e,t,(function(e,t){return e.uid===t.uid&&function(e,t){if(!g(e,t))return!0;const s=t.recurrenceExceptions||[],n=new Map(e.recurrenceExceptions?.map((e=>[e.date,e])));if(s.length!==n.size)return!0;return s.some((e=>{const s=n.get(e.date);if(!s||s.cancelled!==e.cancelled)return!0;if(e.cancelled||!s.exception_event_id)return!1;const a=i.Z.getEvent(s.exception_event_id),o=t.exceptionEvents?.find((t=>t.recurrenceId===e.date));if(!a||!o)throw new Error("Unexpected missing exception event!");const{recurrenceId:r,...l}=o;return!g(a,l)}))}(e,t)}))}async function p(e,t,s){if(!t.length)return[];const i=new Map(e.flatMap((e=>(e.recurrenceExceptions??[]).filter((e=>"string"==typeof e.exception_event_id)).map((e=>[String(e.exception_event_id),e]))))),a=[];for(const o of e){if(i.has(o.id))continue;const e=t.find((e=>s(o,e)));e&&!e.recurrenceExceptions?.length&&o.recurrenceExceptions?.length?n.ZP.deleteExceptions(o):e?.recurrenceExceptions?.length&&c(e,o,i),e&&a.push((0,d.KU)(e,o))}let r=[];try{const e=a.map((e=>{const t=e.rrule?"all":"single";return n.ZP.updateEvent(e,t)}));r=await Promise.all(e)}catch(e){o.Z.error("Calendar",["caldav"],"Error updating event",e)}return r}function g(e,t){return!!t&&((t.etag??"")===(e.etag??"")&&(t.sequence??0)===(e.sequence??0)&&t.title===e.title&&(t.description??"")===(e.description??"")&&(t.start??0)===e.start&&(t.end??t.start??0)===e.end&&!!t.complete==!!e.complete&&!!t.allDay==!!e.allDay&&(t.rrule??"")===(e.rrule??"")&&(t.organizer??"")===(e.organizer??"")&&(t.location??"")===(e.location??"")&&(t.url??"")===(e.url??""))}async function m(e){const{exceptionEvents:t,...s}=e,i=[];for(const e of t||[]){const{recurrenceId:t,recurrenceExceptions:s,...n}=e,o=await a.Z.createEvent(n),{id:r}=o;i.push({date:t,cancelled:!1,exception_event_id:r})}const o={...s,...(0,r.Z)(i.length>0?{recurrenceExceptions:i}:null)};await n.ZP.createEvent(o,!1)}},68172:(e,t,s)=>{"use strict";s.d(t,{$u:()=>h,VK:()=>p,Z1:()=>g,e$:()=>m,tE:()=>c,tL:()=>u});var n=s(15800),i=s(80008),a=s.n(i),o=s(15805),r=s(41851),l=s(24522),d=s(58821);async function c(e,t){const s=await r.Z.loadTemplate(e);return s?h(s,t):(console.error("Template not found.",s),t)}function h(e,t){const s={...t};if(void 0!==e.start&&(s.start=e.start+a()(s.start).startOf("day").valueOf()),void 0!==e.end&&(s.end=e.end+a()(s.end).startOf("day").valueOf(),s.end<s.start&&(s.end+=l.hd)),void 0!==e.duration){const{duration:t}=e;s.start?s.end=s.start+t:s.end?s.start=s.end-t:(s.start=(0,d.zX)(Date.now()),s.end=s.start+t)}return void 0!==e.calendarId&&(s.calendarId=e.calendarId),void 0!==e.title&&(s.title=e.title),void 0!==e.description&&(s.description=e.description),void 0!==e.location&&(s.location=e.location),void 0!==e.url&&(s.url=e.url),void 0!==e.rrule&&(s.rrule=e.rrule),void 0!==e.timezone&&(s.timezone=e.timezone),void 0!==e.allDay&&(s.allDay=e.allDay),void 0!==e.organizer&&(s.organizer=e.organizer),Array.isArray(e.invites)&&(s.invites=e.invites.map((e=>({...e,event_id:s.id})))),Array.isArray(e.notifications)&&(s.notifications=e.notifications.map((e=>({...e,event_id:s.id})))),s}function u(e,t){const s={name:""};if(t.time||t.duration){const{start:n,end:i}=(0,d.aE)(e);t.time&&(s.start=n.hours()*l.QI+n.minutes()*l.lb,s.end=i.hours()*l.QI+i.minutes()*l.lb),t.duration&&(s.duration=i.diff(n))}return t.calendar&&(s.calendarId=e.calendarId),t.title&&(s.title=e.title),t.description&&(s.description=e.description),t.allDay&&(s.allDay=e.allDay),t.timezone&&(s.timezone=e.timezone),t.task&&(s.task=e.task),t.location&&(s.location=e.location),t.url&&(s.url=e.url),t.recurrence&&(s.rrule=e.rrule),t.reminders&&(s.notifications=e.notifications||[]),t.participants&&(s.organizer=e.organizer,s.invites=e.invites||[]),s}function p(e){const t=[];return void 0!==e.start&&t.push(`DTSTART:${a().tz(e.start,"utc").format(l.A)}`),void 0!==e.end&&t.push(`DTEND:${a().tz(e.end,"utc").format(l.A)}`),void 0!==e.duration&&t.push(`DURATION:${a().duration(e.duration).toISOString()}`),void 0!==e.calendarId&&t.push(`X-VIV-CALID:${e.calendarId}`),void 0!==e.title&&t.push(`SUMMARY:${e.title}`),void 0!==e.description&&t.push(`DESCRIPTION:${e.description}`),void 0!==e.location&&t.push(`LOCATION:${e.location}`),void 0!==e.url&&t.push(`URL:${e.url}`),void 0!==e.rrule&&t.push(`RRULE:${e.rrule}`),void 0!==e.timezone&&t.push(`X-VIV-TZ:${e.timezone}`),void 0!==e.allDay&&t.push("X-VIV-ALLDAY:"+(e.allDay?"TRUE":"FALSE")),void 0!==e.organizer&&t.push(`ORGANIZER:mailto:${e.organizer}`),e.invites&&(0===e.invites.length&&t.push("X-VIV-NO-ATTENDEE:TRUE"),e.invites?.forEach((e=>{const s=e.name?`;CN=${e.name}`:"";t.push(`ATTENDEE${s}:mailto:${e.address}`)}))),e.notifications&&(0===e.notifications.length&&t.push("X-VIV-NO-REMINDER:TRUE"),e.notifications?.forEach((e=>{t.push(n.ZP.notificationToVAlarm(e))}))),`BEGIN:VCALENDAR\nBEGIN:${e.task?"VTODO":"VEVENT"}\n${t.join("\n")}\nEND:${e.task?"VTODO":"VEVENT"}\nEND:VCALENDAR\n`}function g(e,t){const s={name:e},n=(0,o.Z)(t),i=[...n.VEVENT||[],...n.VTODO||[]];if(!t||1!==i.length)throw new Error("Invalid template data");n.VTODO&&n.VTODO.length&&(s.task=!0);const r=i[0];if(void 0!==r.DTSTART&&(s.start=a().tz(r.DTSTART.value,"utc").valueOf()),void 0!==r.DTEND&&(s.end=a().tz(r.DTEND.value,"utc").valueOf()),void 0!==r.DURATION&&(s.duration=a().duration(r.DURATION).asMilliseconds()),void 0!==r.SUMMARY&&(s.title=r.SUMMARY),void 0!==r.DESCRIPTION&&(s.description=r.DESCRIPTION),void 0!==r.LOCATION&&(s.location=r.LOCATION),void 0!==r.URL&&(s.url=r.URL.value),void 0!==r.RRULE&&(s.rrule=r.RRULE),void 0!==r["X-VIV-CALID"]&&(s.calendarId=r["X-VIV-CALID"]),void 0!==r["X-VIV-ALLDAY"]&&(s.allDay="TRUE"===r["X-VIV-ALLDAY"]),void 0!==r["X-VIV-TZ"]&&(s.timezone=r["X-VIV-TZ"]),void 0!==r.ORGANIZER&&(s.organizer=r.ORGANIZER.value),void 0!==r["X-VIV-NO-ATTENDEE"]&&(s.invites=[]),Array.isArray(r.ATTENDEE)){const e=[];r.ATTENDEE.map((t=>{e.push({event_id:"",id:"",address:t.value,name:t?.params.CN})})),s.invites=e}if(void 0!==r["X-VIV-NO-REMINDER"]&&(s.notifications=[]),Array.isArray(r.VALARM)){const e=[];r.VALARM.map((t=>{t.TRIGGER&&e.push({name:"",id:"",when:-a().duration(t.TRIGGER).asMilliseconds()})})),s.notifications=e}return s}function m(e){return{title:void 0!==e.title,description:void 0!==e.description,time:void 0!==e.start,duration:void 0!==e.duration,allDay:void 0!==e.allDay,timezone:void 0!==e.timezone,task:void 0!==e.task,location:void 0!==e.location,recurrence:void 0!==e.rrule,url:void 0!==e.url,reminders:void 0!==e.notifications,participants:void 0!==e.invites,calendar:void 0!==e.calendarId}}},6142:(e,t,s)=>{"use strict";s.d(t,{Z:()=>I,p:()=>C});var n=s(67294),i=s(22529),a=s(33349),o=s(98102),r=s(94283),l=s(56371),d=s(49550),c=s(80008),h=s.n(c),u=s(82191),p=s(47543),g=s(58821);function m(e){switch(e){case u.Ci.DAILY:return"days";case u.Ci.WEEKLY:return"weeks";case u.Ci.MONTHLY:return"months";case u.Ci.YEARLY:return"years";default:return"none"}}var f=s(86088),v=s(48521);const b=new Map([["none",{name:(0,l.Z)("No repeat"),frequency:void 0}],["days",{name:(0,l.Z)("Daily"),frequency:u.Ci.DAILY}],["weeks",{name:(0,l.Z)("Weekly"),frequency:u.Ci.WEEKLY}],["months_dom",{name:(0,l.Z)("Monthly by date"),frequency:u.Ci.MONTHLY}],["months_dow",{name:(0,l.Z)("Monthly by week"),frequency:u.Ci.MONTHLY}],["years",{name:(0,l.Z)("Yearly"),frequency:u.Ci.YEARLY}]]),C=e=>{if(!e)return(0,l.Z)("No repeat");const{count:t,dtstart:s,until:n,interval:i=1}=e.origOptions,a=h()(s).format("LL");let o="",r="";if(i<=2)switch(e.origOptions.freq){case u.Ci.DAILY:o=(0,l.Z)("Repeats daily","Repeats every other day",[i]);break;case u.Ci.WEEKLY:o=(0,l.Z)("Repeats weekly","Repeats every other week",[i]);break;case u.Ci.MONTHLY:o=(0,l.Z)("Repeats monthly","Repeats every other month",[i]);break;case u.Ci.YEARLY:o=(0,l.Z)("Repeats yearly","Repeats every other year",[i])}else switch(e.origOptions.freq){case u.Ci.DAILY:o=(0,l.Z)("Repeats every $1 days","Repeats every $1 days",[i]);break;case u.Ci.WEEKLY:o=(0,l.Z)("Repeats every $1 weeks","Repeats every $1 weeks",[i]);break;case u.Ci.MONTHLY:o=(0,l.Z)("Repeats every $1 months","Repeats every $1 months",[i]);break;case u.Ci.YEARLY:o=(0,l.Z)("Repeats every $1 years","Repeats every $1 years",[i])}if(t&&t>0)r=(0,l.Z)("$1 time beginning $2","$1 times beginning $2",[t,a]);else if(n){const e=h()(n).format("LL");r=(0,l.Z)("from $1 to $2",[a,e])}else r=(0,l.Z)("beginning $1",[a]);return(0,l.Z)("$1, $2",[o,r])};var w=(0,v.jsx)("hr",{}),y=(0,v.jsx)("hr",{});class x extends n.Component{static contextType=r.Z;constructor(e){super(e);const t=h()().startOf("week");this.week=[...Array(7).keys()].map((()=>{const e={name:t.format("dddd"),shortName:t.format("dd"),number:(t.day()+6)%7};return t.add(1,"day"),e}));const s=e.event.rrule?.match(/BYMONTHDAY=([-\d,]+)/)?.[1].split(",");s&&(this.monthDates=s.join(", ")),this.state={showMonthPicker:!1}}domPickerRef=n.createRef();storedFocusElement=null;isTypingDate=!1;changeField=e=>{const t=this.recurrence;if(!t)return;let s=e.currentTarget.value;const n=e.currentTarget.name;"number"===e.currentTarget.type&&(s=parseInt(s),(isNaN(s)||s<1)&&(s=0),"count"===n&&s&&(s+=1)),this.recurrence=(0,p.yu)(t,{[n]:s}),this.props.updateEvent({...this.props.event,rrule:this.recurrence.toString()})};verifyValidValue=e=>{const{recurrence:t}=this;if(!t)return;const s=e.currentTarget.name;if("number"===e.currentTarget.type){let n=parseInt(e.currentTarget.value);(isNaN(n)||n<1)&&(n=1,"count"===s&&(n+=1),this.recurrence=(0,p.yu)(t,{[s]:n}),this.props.updateEvent({...this.props.event,rrule:this.recurrence.toString()}))}};changeRecurrence=e=>{this.props.updateEvent(function(e,t){const s=new Date((0,g.oJ)(t));let n;switch(e){case"days":n=(0,p.Ns)({dtstart:s,freq:u.Ci.DAILY,interval:1});break;case"weeks":n=(0,p.Ns)({dtstart:s,freq:u.Ci.WEEKLY,interval:1,byweekday:(s.getDay()+6)%7});break;case"months_dom":n=(0,p.Ns)({dtstart:s,freq:u.Ci.MONTHLY,interval:1,bymonthday:s.getDate()});break;case"months_dow":const e=Math.ceil(s.getDate()/7),t=(0,p._7)(s.getDay()).nth(e);n=(0,p.Ns)({dtstart:s,freq:u.Ci.MONTHLY,interval:1,byweekday:t});break;case"years":n=(0,p.Ns)({dtstart:s,freq:u.Ci.YEARLY,interval:1});break;default:n=""}return{...t,rrule:n}}(e.currentTarget.value,this.props.event))};changeDate=e=>{this.props.updateEvent(function(e,t){const{rrule:s,start:n,timezone:i}=t,a=(0,p.Qj)(s,i,n);if(!a)return t;const o=(0,p.yu)(a,{until:h()(e).endOf("day").toDate(),count:void 0});return{...t,rrule:o?.toString()}}(e.currentTarget.value,this.props.event))};changeEnds=e=>{this.props.updateEvent(function(e,t){const{rrule:s,start:n,timezone:i}=t,a=(0,p.Qj)(s,i,n);if(!a)return t;let o;switch(e){case"forever":o=(0,p.yu)(a,{until:void 0,count:void 0});break;case"endDate":const e=m(a.origOptions.freq);o=(0,p.yu)(a,{count:void 0,until:h()((0,g.oJ)(t)).add(1,e).toDate()});break;case"count":o=(0,p.yu)(a,{count:2,until:void 0})}return{...t,rrule:o?.toString()}}(e.target.value,this.props.event))};changeDayOfMonth=e=>{const{recurrence:t}=this;if(!t)return;this.monthDates=e.currentTarget.value;const s=this.monthDates.split(",").map((e=>parseInt(e))).filter((e=>e>=1&&e<=31));s.length&&(this.recurrence=(0,p.yu)(t,{bymonthday:s}),this.props.updateEvent({...this.props.event,rrule:this.recurrence.toString()}))};toggleDayOfMonthPicker=()=>{const{document:e}=this.context;this.setState((e=>({showMonthPicker:!e.showMonthPicker})),(()=>{if(this.state.showMonthPicker){this.storedFocusElement=e.activeElement;const t=e.querySelector("button[name='1-dayOfMonth']");t&&t.focus()}}))};hideDayOfMonthPicker=()=>{this.setState({showMonthPicker:!1},(()=>{this.storedFocusElement&&(this.storedFocusElement.focus(),this.storedFocusElement=null)}))};dayOfWeekPickerClick=e=>{e.target.focus();const{recurrence:t}=this;if(!t)return;const s=parseInt(e.target.name);if(isNaN(s))throw new Error("Can not select day, invalid day value");const n=new Set((0,p.IK)(t));n.has(s)&&n.size>1?n.delete(s):n.add(s),this.recurrence=(0,p.yu)(t,{byweekday:Array.from(n)}),this.props.updateEvent({...this.props.event,rrule:this.recurrence.toString()})};dayOfMonthPickerClick=e=>{e.target.focus();const t=parseInt(e.target.name);this.selectDayOfMonth(t)};selectDayOfMonth=e=>{const{recurrence:t}=this;if(!t)return;const s=new Set((0,p.v1)(t));s.has(e)&&s.size>1?s.delete(e):s.add(e);const n=Array.from(s).sort(((e,t)=>e-t));this.monthDates=n.join(", ")??"",this.recurrence=(0,p.yu)(t,{bymonthday:n}),this.props.updateEvent({...this.props.event,rrule:this.recurrence.toString()})};monthPickerBlur=e=>{const t=this.domPickerRef.current;t&&e.relatedTarget instanceof Node&&!t.contains(e.relatedTarget)&&this.setState({showMonthPicker:!1})};dayOfWeekPickerKeyDown=e=>{const{document:t}=this.context,s=t.activeElement;if(!s||!s.hasAttribute("name"))return;const n=h()().localeData().firstDayOfWeek(),i=(parseInt(s.name)-n+7)%7;let a=null;switch(d.Z[e.keyCode]){case"Left":i>0&&(a=i-1);break;case"Right":i<6&&(a=i+1);break;default:return}if(null!==a){a=(a+n)%7;const e=t.querySelector(`button[name='${a}-dayOfWeek']`);e&&(e.tabIndex=0,e.focus(),s.tabIndex=-1)}};dayOfMonthPickerKeyDown=e=>{if(!this.state.showMonthPicker&&"Down"===d.Z[e.keyCode])return void this.toggleDayOfMonthPicker();const{document:t}=this.context,s=t.activeElement;if(!s||!s.hasAttribute("name"))return;const n=parseInt(s.name);let i;switch(d.Z[e.keyCode]){case"Up":n>7&&(i=n-7);break;case"Down":n<25&&(i=n+7);break;case"Left":n%7!=1&&(i=n-1);break;case"Right":n%7!=0&&(i=n+1);break;case"Enter":return this.selectDayOfMonth(n),void e.stopPropagation();case"Escape":return e.stopPropagation(),void this.hideDayOfMonthPicker();default:return}if(i){const e=t.querySelector(`button[name='${i}-dayOfMonth']`);e&&e.focus()}};weekOfMonthChange=e=>{const{recurrence:t}=this;if(!t)return;const s=e.currentTarget.value,[n,i]=e.currentTarget.name.split("-");this.recurrence=function(e,t,s,n){const i=/^-?\d+$/.test(n)?parseInt(n):n,a=(0,p.QX)(e),o=a[s],{bysetpos:r}=e.origOptions;return"weekNumber"===t&&"number"==typeof i?r?(0,p.yu)(e,{bysetpos:i}):(a[s]=o.nth(i),(0,p.yu)(e,{byweekday:a})):"weekday"===t?"number"==typeof i?(r?(a.length=0,a.push(p.ng[i].nth(Array.isArray(r)?r[0]:r))):(a[s]=p.ng[i],void 0!==o.n&&(a[s]=a[s].nth(o.n))),(0,p.yu)(e,{byweekday:a,bysetpos:void 0})):(0,p.yu)(e,{bysetpos:o.n??1,byweekday:"day"===i?[...p.ng]:[...p.z3]}):new u.Ci(e.origOptions)}(t,i,parseInt(n),s),this.props.updateEvent({...this.props.event,rrule:this.recurrence.toString()})};addWeekOfMonth=()=>{const{event:e}=this.props,{recurrence:t}=this;t&&(this.recurrence=function(e,t){const{bysetpos:s}=t.origOptions;if(s&&(0,p.IK)(t).length>1)return new u.Ci(t.origOptions);const n=(0,p.QX)(t);s&&n.length>0&&(n[0]=n[0].nth(Array.isArray(s)?s[0]:s));const i=h()(e.start),a=Math.ceil(i.date()/7),o=(0,p._7)(i.day()).nth(a);return n.push(o),(0,p.yu)(t,{byweekday:n,bysetpos:void 0})}(e,t),this.props.updateEvent({...e,rrule:this.recurrence.toString()}))};deleteWeekOfMonth=e=>{const t=parseInt(e.currentTarget.name),{recurrence:s}=this;if(!s)return;const n=(0,p.QX)(s).splice(t,1);this.recurrence=(0,p.yu)(s,{byweekday:n}),this.props.updateEvent({...this.props.event,rrule:this.recurrence.toString()})};renderWeekSelection(){const{recurrence:e}=this;if(!e)return null;const t=(0,p.IK)(e),s=this.week.map(((e,s)=>{const i=t.includes(e.number),a=`${e.number}-dayOfWeek`;return(0,v.jsxs)(n.Fragment,{children:[(0,v.jsx)(o.ZP,{name:a,onClick:this.dayOfWeekPickerClick,onKeyDown:this.dayOfWeekPickerKeyDown,title:e.shortName.substr(0,1),tooltip:e.name,tabIndex:i?this.props.tabIndex:-1,isPressed:i}),s<this.week.length-1&&w]},a)}));return(0,v.jsx)("div",{className:"edit-group capped-width",children:(0,v.jsx)("div",{className:"toolbar toolbar-default calendar-week-picker",children:(0,v.jsx)("div",{className:"toolbar toolbar-group",children:s})})})}renderDayOfMonthSelection(){const{event:e}=this.props;if(!this.recurrence)return null;const t=(0,p.v1)(this.recurrence);return(0,v.jsx)("div",{className:"edit-group capped-width",children:(0,v.jsxs)("label",{children:[(0,v.jsx)("span",{children:(0,l.Z)("On days")}),(0,v.jsx)("input",{type:"text",id:"day_of_month",value:this.monthDates||h().tz(e.start,e.timezone).date(),onChange:this.changeDayOfMonth}),(0,v.jsx)(o.ZP,{className:"button-narrow",image:f.bcq.small,popupPosition:"below",isPopupVisible:this.state.showMonthPicker,popupWidth:240,onClick:this.toggleDayOfMonthPicker,onKeyDown:this.dayOfMonthPickerKeyDown,tabIndex:this.props.tabIndex,tooltip:(0,l.Z)("Show date picker"),hidePopup:this.hideDayOfMonthPicker,popupClassName:"ToolbarButtonPopup-DefaultStyles",children:(0,v.jsx)("div",{className:"dom-picker",ref:this.domPickerRef,onBlur:this.monthPickerBlur,children:(0,v.jsx)("div",{className:"toolbar toolbar-default",children:[...Array(31).keys()].map((e=>{const s=e+1;return(0,v.jsx)(o.ZP,{isPressed:t.includes(s),name:`${s}-dayOfMonth`,onKeyDown:this.dayOfMonthPickerKeyDown,onClick:this.dayOfMonthPickerClick,tabIndex:this.state.showMonthPicker?this.props.tabIndex:-1,title:s.toString(),tooltip:(0,l.Z)("Repeat monthly on day $1",[s])},s)}))})})})]})})}renderWeekOfMonthSelection(){const e=this.recurrence;if(!e)return null;const t=(0,p.QX)(e),{bysetpos:s}=e.origOptions,n=s&&t.length>1,i=7===t.length;return(n?[{number:s,day:i?"day":"weekday"}]:t.map((e=>({number:e.n,day:e.weekday})))).map(((e,s)=>(0,v.jsx)("div",{className:"edit-group",children:(0,v.jsxs)("label",{children:[(0,v.jsxs)(a.Z,{name:`${s}-weekNumber`,onChange:this.weekOfMonthChange,tabIndex:this.props.tabIndex,value:e.number,children:[(0,v.jsx)("option",{value:"1",children:(0,l.Z)("First")}),(0,v.jsx)("option",{value:"2",children:(0,l.Z)("ordering","Second")}),(0,v.jsx)("option",{value:"3",children:(0,l.Z)("Third")}),(0,v.jsx)("option",{value:"4",children:(0,l.Z)("Fourth")}),(0,v.jsx)("option",{value:"5",children:(0,l.Z)("Fifth")}),(0,v.jsx)("option",{value:"-1",children:(0,l.Z)("Last")}),(0,v.jsx)("option",{value:"-2",children:(0,l.Z)("Second last")})]}),(0,v.jsxs)(a.Z,{name:`${s}-weekday`,onChange:this.weekOfMonthChange,tabIndex:this.props.tabIndex,value:e.day,children:[this.week.map((e=>(0,v.jsx)("option",{value:e.number,children:e.name},e.number))),y,(0,v.jsx)("option",{value:"day",children:(0,l.Z)("Day")}),(0,v.jsx)("option",{value:"weekday",children:(0,l.Z)("Weekday")})]}),!n&&t.length>1&&(0,v.jsx)("input",{type:"button",className:"circular",name:`${s}`,onClick:this.deleteWeekOfMonth,onKeyDown:this.dayOfMonthPickerKeyDown,tabIndex:this.props.tabIndex,title:(0,l.Z)("Remove rule"),value:"–"}),!n&&t.length>=1&&(0,v.jsx)("input",{type:"button",className:"circular",onClick:this.addWeekOfMonth,onKeyDown:this.dayOfMonthPickerKeyDown,tabIndex:this.props.tabIndex,title:(0,l.Z)("Add rule"),value:"+"})]})},s)))}render(){const{event:e}=this.props,{rrule:t,start:s,timezone:n}=e;this.recurrence=(0,p.Qj)(t,n,s);const o=this.recurrence||{origOptions:{}},{freq:r,interval:d,count:c,until:f}=o.origOptions,C=r===u.Ci.MONTHLY?o.origOptions.byweekday?"months_dow":"months_dom":m(r??-1),w=void 0!==c?"count":f?"endDate":"forever",y=c&&"number"==typeof c?c-1:"";let x="";switch(r){case u.Ci.DAILY:x=(0,l.Z)("day","days",[d??""]);break;case u.Ci.WEEKLY:x=(0,l.Z)("week","weeks",[d??""]);break;case u.Ci.MONTHLY:x=(0,l.Z)("month","months",[d??""]);break;case u.Ci.YEARLY:x=(0,l.Z)("year","years",[d??""])}return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{className:"edit-group capped-width",children:(0,v.jsx)(a.Z,{name:"frequency",ref:this.props.focusRef,onChange:this.changeRecurrence,tabIndex:this.props.tabIndex,value:C,children:Array.from(b).map((([e,t])=>(0,v.jsx)("option",{value:e,children:t.name},e)))})}),"weeks"===C&&this.renderWeekSelection(),"months_dom"===C&&this.renderDayOfMonthSelection(),"months_dow"===C&&this.renderWeekOfMonthSelection(),"none"!==C&&(0,v.jsx)("div",{className:"edit-group capped-width",children:(0,v.jsxs)("label",{children:[(0,v.jsx)("span",{children:(0,l.Z)("every","every",[d??""])}),(0,v.jsx)("input",{type:"number",name:"interval",min:"1",disabled:!C,onChange:this.changeField,onBlur:this.verifyValidValue,tabIndex:this.props.tabIndex,value:d||""}),(0,v.jsx)("span",{children:x})]})}),"none"!==C&&(0,v.jsxs)("div",{className:"edit-group",children:[(0,v.jsxs)(a.Z,{name:"endsRepeating",ref:this.props.focusRef,onChange:this.changeEnds,tabIndex:this.props.tabIndex,value:w,children:[(0,v.jsx)("option",{value:"forever",children:(0,l.Z)("Forever")}),(0,v.jsx)("option",{value:"endDate",children:(0,l.Z)("Ending")}),(0,v.jsx)("option",{value:"count",children:(0,l.Z)("Repeating")})]}),(0,v.jsxs)(v.Fragment,{children:["endDate"===w&&f&&(0,v.jsx)(i.Z,{name:"endDate",onChange:this.changeDate,min:h()(e.start).format("YYYY-MM-DD"),tabIndex:this.props.tabIndex,value:h()((0,g.FL)(f)).format("YYYY-MM-DD")}),"count"===w&&(0,v.jsxs)("label",{children:[(0,v.jsx)("input",{size:"3",type:"number",name:"count",onChange:this.changeField,onBlur:this.verifyValidValue,min:"1",tabIndex:this.props.tabIndex,value:y}),(0,v.jsx)("span",{children:(0,l.Z)("time","times",[y])})]})]})]})]})}}const I=x},79706:(e,t,s)=>{"use strict";s.d(t,{Z:()=>I});var n=s(2934),i=s(34929),a=s(50522),o=s(15800),r=s(56371),l=s(71237),d=s(45660),c=s(11430),h=s(7064),u=s(24522),p=s(34006);function g(e,t){return e.filter((e=>e.UID&&!t.has(e.UID)))}function m(e,t){const s=new Set;t.forEach((e=>{e.recurrenceExceptions&&e.recurrenceExceptions.forEach((e=>{s.add(e.exception_event_id)}))}));const n=new Set(e.map((e=>e.UID)));return t.filter((e=>{const t=n.has(e.uid),i=s.has(e.id);return!(t||i&&!e.uid)}))}function f(e,t){return e.filter((e=>e.UID&&t.has(e.UID)))}var v=s(89555),b=s(9141);let C=null;async function w(e,t,s){return await fetch(e,{Authorization:t&&s?(0,l.Z)(t,s):void 0,Accept:"text/calendar"})}function y(e,t,s){let n="";return"ParserError"===e.name?(n=(0,r.Z)("Error parsing calendar data from ‘$1’. Error message ‘$2’.",[t,e.message]),console.log("iCalendar Parser Error",s)):n=(0,r.Z)("No Web Calendar found at ‘$1’. Error message ‘$2’.",[t,e.message]),d.Z.warn("Calendar",["webcal"],n),n}const x={probeWebCalendar:async(e,t)=>{const{url:s,username:n}=e;let i=0;const a={calendars:[],eventCount:0,foundService:!1,statusMessage:""},{urlValid:l}=h.Z.utilities.isUrlValid(s);if(!l)return{...a,statusMessage:(0,r.Z)("Invalid URL $1",[s])};try{const l=await w(s,n,t),{status:d,statusText:h}=l;if(d>=200&&d<300){const t=await l.text();if(!t)return{...a,statusMessage:(0,r.Z)("Empty response from server. No calendar data.")};let n;try{n=await c.Z.parseICalendar(t)}catch(e){const n=y(e,s,t);return{...a,statusMessage:n}}C={url:s,timestamp:Date.now(),calendarData:n};const d={name:e.name,description:(n["X-WR-CALNAME"]||"").trim(),color:o.ZP.getCalendarCreateColor(),ctag:"",supportedCalendarComponent:{vevent:!0,vtodo:!1,vjournal:!1},supportsSyncCollection:!1,syncToken:"",active:!0};return i=n.VEVENT.length,{...a,foundService:!0,calendars:[d],eventCount:i,statusMessage:(0,r.Z)("Success")}}if(401===d||403===d)return{...a,statusMessage:(0,r.Z)("Not authorized, check your username and password. ‘$1’",[h])};if(404===d)return{...a,statusMessage:(0,r.Z)("Calendar not found, check your URL. ‘$1’",[h])};if(d>=500)return{...a,statusMessage:(0,r.Z)("Server error, try again later. ‘$1’.",[h])};throw new Error(h)}catch(e){return{...a,statusMessage:(0,r.Z)("Network error, check your URL. ‘$1’.",[e.message])}}},fetchAndCreate:async(e,t)=>{const{url:s}=e;if(!s)throw"Url missing";const o={numberOfCalendarsPolled:1,numberOfChangedCalendars:0};let r;const l=C?.calendarData;if(l&&C&&C.url===s&&C.timestamp+5*u.lb>Date.now())r=l;else{let t="",n="";try{const s=await i.Z.getAuthentication(e,{interactive:!1});t=s.username,n=s.password}catch(e){}const a=await w(s,t,n);if(200!==a.status)throw a;const l=await a.text();try{r=await c.Z.parseICalendar(l)}catch(e){return y(e,s,l),o}}C=null,t||(t=(r["X-WR-CALNAME"]||e.name).trim());try{n.ZP.stopAPIChangeListeners();const s=await x.getCalendar(e,t),{id:i}=s,l=r.VEVENT,d=a.Z.getEventsPerCalendar(i),{create:c,deleteEvents:h,update:u}=function(e,t){const s=new Set(t.map((e=>e.uid)).filter(Boolean));return{create:g(e,s),deleteEvents:m(e,t),update:f(e,s)}}(l,d);(c.length||h.length)&&(o.numberOfChangedCalendars=1);for(const e of h)n.ZP.deleteEvent(e.id);const b=e=>(0,p.rP)(e,s.id);await(0,p.nj)(c.map(b),v.Z);await x.updateEvents(u,s.id)&&(o.numberOfChangedCalendars=1)}finally{n.ZP.startAPIChangeListeners()}return o},getCalendar:(e,t)=>new Promise(((s,i)=>{const r=a.Z.getCalendars().filter((t=>t.accountId===e.id)),l=r.find((t=>t.accountId===e.id));if(l)s(l);else{const i={name:t,description:t,accountId:e.id,active:!0,color:o.ZP.getCalendarCreateColor(),supportedCalendarComponent:{vevent:!0,vtodo:!0,vjournal:!1}};n.ZP.createCalendar(i,e,!1,!0).then((e=>{e.calendar&&s(e.calendar)}))}})),updateEvents:async(e,t)=>{const s=e.map((e=>(0,p.rP)(e,t))),n=a.Z.getEventsPerCalendar(t);return(await(0,b.YQ)(n,s)).length}},I=x},74400:(e,t,s)=>{"use strict";s.d(t,{ES:()=>i,RO:()=>n,Vl:()=>a});const n=e=>e.replace(/\\\\|\\;|\\,|\\[Nn]/g,(e=>{switch(e){case"\\\\":return"\\";case"\\;":return";";case"\\,":return",";case"\\n":case"\\N":return"\n";default:return e}})),i=e=>e.replace(/\\|;|,|\r\n|\n/g,(e=>{switch(e){case"\\":return"\\\\";case";":return"\\;";case",":return"\\,";case"\r\n":case"RN":case"\n":case"N":return"\\n";default:return e}}));function a(e,t,s){let n=!1;if(s&&s<2)return[e];s=s||1/0;const i=[0];for(let a=0;a<e.length;a++){const o=e[a];if('"'===o)0!==a&&"\\"===e[a-1]||(n=!n);else if(o===t&&!n&&(i.push(a+1),i.length>=s))break}return 1===i.length?[e]:i.map(((t,s)=>{const n=i[s+1];return e.slice(t,n?n-1:n)}))}},15805:(e,t,s)=>{"use strict";s.d(t,{Z:()=>d,z:()=>a});var n=s(24522),i=s(74400);class a extends Error{constructor(e){super(e),this.name="ParserError"}}function o(e){try{if(e.startsWith('"')&&e.endsWith('"'))return e.slice(1,-1)}catch(t){throw new a(`Calendar: Error parsing "${e}" in stripQuotes`)}return e}const r=(e,t)=>{const s={},d=[];for(t.line&&(d.push(t.line),delete t.line);e.length>1;){const c=e.shift();d.push(c),t.index++;try{const[d,h]=(0,i.Vl)(c,":",2);if(void 0===h)throw new a(`No Value parsing iCal line ${t.index}: "${c}"`);const[u,p]=d.split(/;(.*)/,2),g=p?(0,i.Vl)(p,";").reduce(((e,t)=>{const[s,n]=t.split("=");return e[s]=o(n),e}),{}):{};switch(u){case"BEGIN":const i=h;t.line=c;let a=r(e,t)??{};switch(s[i]&&(a=[].concat(s[i],a)),i){case"VEVENT":case"VTODO":case"VJOURNAL":case"VALARM":case"VTIMEZONE":case"STANDARD":case"DAYLIGHT":s[i]=Array.isArray(a)?a:[a];break;default:s[i]=a}break;case"END":return["VEVENT","VTODO","VJOURNAL","VFREEBUSY"].includes(h)&&!s.UID&&(s.UID=crypto.randomUUID()),s;case"RECURRENCE-ID":case"DTSTART":case"DTEND":case"DTSTAMP":case"DUE":if("DTSTART"===u&&s.DTSTART&&e[0]?.startsWith("RRUL"))continue;/^\d{8}$/.test(h)&&(g.VALUE="DATE"),/\d+T\d+Z/.test(h)?g.TZID="UTC":g.TZID||(g.TZID=n.$T),s[u]={value:h,params:g};break;case"ATTENDEE":s[u]=(s[u]||[]).concat([{value:l(h),params:g}]);break;case"EXDATE":h.indexOf(",")>=0?s[u]=h.split(",").map((e=>({value:e,params:g}))):s[u]=(s[u]||[]).concat([{value:h,params:g}]);break;case"ORGANIZER":s[u]={value:l(h),params:g};break;case"URL":s[u]={value:h,params:g};break;case"ATTACH":s[u]=s[u]?[s[u],c].join("\r\n"):c;break;case"UID":case"CLASS":case"CREATED":case"DESCRIPTION":case"GEO":case"LAST-MODIFIED":case"LOCATION":case"PRIORITY":case"RRULE":case"SEQUENCE":case"STATUS":case"SUMMARY":case"TRANSP":case"X-WR-CALNAME":case"X-WR-CALDESC":s[u]=h;break;default:s[u]?s[u]=[].concat(s[u]||[],h):s[u]=h}}catch(s){let n=1;for(;e.length>1;){const i=e.shift();if(d.push(i),t.index++,i.startsWith("BEGIN")?n++:i.startsWith("END")&&n--,0===n)return console.warn("Calendar",["iCalendar","parser"],s),void console.log(`Failing iCalendar component.\n${d.join("\n")}`)}}}return s},l=e=>e.toLowerCase().startsWith("mailto:")?e.substr(7):e,d=e=>{const t=(e=>{const t=e.replace(/\n\\n/g,"\\n").split(/\r\n|\n|\r/).filter((e=>""!==e.trim())),s=[];let n="";for(const e of t)" "===e[0]||"\t"===e[0]?n+=e.substr(1):(n&&s.push(n),n=e.trim());return n&&s.push(n),s})(e),s=r(t,{index:0});if(!s?.VCALENDAR)return{VEVENT:[],VTODO:[],VJOURNAL:[]};if(s.VCALENDAR.VEVENT){const e=s.VCALENDAR.VEVENT.reduce(((e,t)=>{if(0===Object.keys(t).length)return e;const s=e.findIndex((e=>e.UID===t.UID));return-1===s?e.push({UID:t.UID,VEVENT:[t]}):e[s].VEVENT.push(t),e}),[]).reduce(((e,t)=>{const s=t.VEVENT.reduce(((e,t)=>(t["RECURRENCE-ID"]?e.EXCEPTIONS?e.EXCEPTIONS.push(t):e.EXCEPTIONS=[t]:e={...e,...t},e)),{});return e.push(s),e}),[]);s.VCALENDAR.VEVENT=e}else s.VCALENDAR.VEVENT=[];return{...s.VCALENDAR}}},34006:(e,t,s)=>{"use strict";s.d(t,{rP:()=>K,nj:()=>$,BC:()=>Q,KU:()=>z,ig:()=>q,PU:()=>J,Uq:()=>G});var n=s(2934),i=s(34929),a=s(1712),o=s(82649),r=s(15800),l=s(22616),d=s(33499),c=s(56371),h=s(45660);var u=s(28773),p=s(42568),g=s.n(p),m=s(80008),f=s.n(m),v=s(8687),b=s(15805),C=s(87265),w=s(25372);const{constructUrl:y}=C.Z;function x(e,t,s){const n=e.url,i=crypto.randomUUID();let a="",o="";const{username:r,password:l,accessToken:d}=e,c=(0,w.Z)(n);if(c){const{protocol:e,host:s}=c;if(!e||!s||!i)return;const n=e+"//"+s;o="/"+y([t,i])+".ics",a=y([n,o])}return{username:r,password:l,accessToken:d,headers:{"If-None-Match":"*"},url:a,href:o,method:"PUT",contentType:"text/calendar; charset=utf-8",body:s}}var I=s(7064),A=s(24522),S=s(9141),Z=s(74400),T=s(39190),E=s(58821);const k=(0,s(23542).extendMoment)(f());function N(e){const t=["BEGIN:VCALENDAR","PRODID:-Vivaldi Calendar V1.0//EN","VERSION:2.0","CALSCALE:GREGORIAN","DTSTAMP:"+k.tz().format(A.FI)],s=e=>e.reduce(((e,{EXCEPTIONS:t,...n})=>(e.push(n),t&&e.push(...s(t)),e)),[]);let n=[];for(const t of["VEVENT","VTODO"]){const i=e[t];i&&(n=n.concat(s(i).map((e=>D(e,"VTODO"===t)))))}t.push("");let i=t.join("\r\n");return n.forEach((e=>{i+=e})),r.ZP.foldIcal(i+"END:VCALENDAR\r\n")}function _(e,t){if(!t)return"";const{params:s}=t;return"DATE"===s.VALUE?`${e};VALUE=DATE:${t.value}`:`${e}:${t.value}`}function P(e,t){if(!t)return"";const s=[],{value:n,params:i}=t;for(const e in i)s.push(`${e}=${i[e]}`);return`${e};${s.join("=")}:mailto:${n}`}function M(e,t){const s=[],n=[];return t?(t.forEach((t=>{const{value:i,params:a}=t;for(const e in a)s.push(`${e}=${a[e]}`);const o=`${s.join(";")}`,r=`mailto:${i}`;n.push(`${e};${o}:${r}`)})),n.join("\r\n")):""}function D(e,t){let s=t?["BEGIN:VTODO"]:["BEGIN:VEVENT"];for(const[t,i]of Object.entries(e))switch(t){case"VALARM":const a=(n=e[t])?n.map((e=>{const t=["BEGIN:VALARM"];for(const[s,n]of Object.entries(e))t.push(`${s}:${String(n)}`);return t.push("END:VALARM"),t})).flat():[""];s=[...s,...a];break;case"ATTENDEE":s.push(M(t,e[t]));break;case"ORGANIZER":s.push(P(t,e[t]));break;case"DTSTART":case"RECURRENCE-ID":case"DTSTAMP":case"DTEND":s.push(_(t,e[t]));break;default:s.push(`${t}:${String(i)}`)}var n;return s.push(t?"END:VTODO\r\n":"END:VEVENT\r\n"),s.join("\r\n")}var O=s(89555);const{ensureHttpsForWebcal:j}=r.ZP,{setImportProgress:L}=l.Z,{createLocalAccountAndCalendar:R,getLocalAccount:B}=a.Z,F=new Map([["SUMMARY","title"],["LOCATION","location"],["DESCRIPTION","description"]]);function W(e,t){return t&&t!==A.$T?f().tz(e,t):f()(e)}function U(e){if(n.z.has(e)||e===A.$T)return e;const t=(0,E.EP)(),s=(0,T.findIana)(e);return t&&s&&s.includes(t)?t:s&&s.length?s[0]:""}function V(e){return"DATE"===e.params.VALUE?A.GL:A.jS}function H(e,t){if(e)return!t&&e?.value?.match(/\d+T\d+Z/)?(0,E.EP)():U(e.params.TZID)}function G(e,t){const s=U(t??e?.params.TZID),n=V(e),{value:i}=e;if(s===A.$T){const e=f().tz(i,n,"UTC").toDate();return(0,E.FL)(e).valueOf()}return s?f().tz(i,n,s).valueOf():f()(i,n).valueOf()}const K=(e,t,s={})=>{const n=[];let i=[];const a={title:""};F.forEach(((t,s)=>{"string"==typeof e[s]&&(a[t]=(0,Z.RO)(e[s]))}));const o=(e.EXCEPTIONS??[]).map((e=>{const i=K(e,t,s),a=e["RECURRENCE-ID"];if(a?.value){const e=G(a);n.push({date:e,cancelled:!1});const{exceptionEvents:t,...s}=i;return{...s,recurrenceId:e}}})).filter(Boolean);e.ATTENDEE&&(i=e.ATTENDEE.map((e=>({name:e.params.CN||"",address:e.value,partstat:e.params.PARTSTAT||"NEEDS-ACTION"}))));const r=Boolean(e.RRULE);let l,d=!1,c=0;const h=H(e.DTSTART,r);e.DTSTART?.value&&("DATE"===e.DTSTART.params.VALUE&&(d=!0),c=G(e.DTSTART,h));const p=H(e.DTEND,r);if(e.DTEND?.value&&(l=G(e.DTEND,p)),e.DURATION){l=c+f().duration(e.DURATION).asMilliseconds()}let g=[];e.VALARM&&(g=e.VALARM.map((t=>{const{TRIGGER:s=""}=t;return{when:-f().duration(s).asMilliseconds(),name:e.SUMMARY||""}})));let m=e.LOCATION;"string"!=typeof m&&(m="");let v={};const b=H(e.DUE,r);e.DUE&&("DATE"===e.DUE.params.VALUE&&(d=!0),v={end:G(e.DUE,b)}),e.EXDATE&&e.EXDATE.forEach((e=>{const t=V(e),s=U(e.params.TZID),i=s?f().tz(e.value,t,s):f()(e.value,t);n.push({cancelled:!0,date:i.valueOf()})}));const C=e.URL?.value;if(c&&l){const e=W(c,h),t=W(l,p),s=e.startOf("day").valueOf()===c,n=t.startOf("day").valueOf()===l,i=1===t.diff(e,"d");s&&n&&i&&(d=!0)}let w=!1;return e.STATUS&&(w="COMPLETED"===e.STATUS),e.RRULE&&"DATE"===e.DTSTART?.params.VALUE&&(e.RRULE=e.RRULE.replace(/\d{8}T\d{6}Z/g,(e=>f()(e).add(12,"hour").format(A.O5)))),e.RRULE&&"DATE"!==e.DTSTART?.params.VALUE&&(e.RRULE=e.RRULE.replace(/\d{8}T\d{6}Z/g,(e=>f().tz(e,h||b).format(A.A)))),{...a,rrule:e.RRULE,url:C,start:c,end:l,...(0,u.Z)(v),timezone:h||b,allDay:d,is_recurring:!!e.RRULE,calendarId:t,href:s.href,etag:s.etag,uid:e.UID?e.UID:"",organizer:e.ORGANIZER&&e.ORGANIZER.value,notifications:g,sequence:parseInt(e.SEQUENCE)||0,...(0,u.Z)(o.length>0?{exceptionEvents:o}:null),...(0,u.Z)(n.length>0?{recurrenceExceptions:n}:null),...(0,u.Z)(i.length>0?{invites:i}:null),attachment:e.ATTACH,is_template:!1,complete:w}};function z(e,t){const{is_template:s,exceptionEvents:n,...i}=e,a=function(e,t){if(e.invites)return e.invites.map((e=>{const s=t.invites?.find((t=>t.address===e.address));return{...e,id:s?.id||"",event_id:s?.event_id||""}}))}(e,t),o=function(e,s){if(!e.notifications)return;return t.notifications?e.notifications.map((({when:e,name:t})=>{const n=s.notifications?.find((s=>s.when===e&&(s.name??"")===(t??"")));return{when:e,name:t,id:n?.id??""}})):e.notifications.map((e=>({...e,id:"",event_id:t.id})))}(e,t),l=!e.url&&t.url&&t.url.startsWith("vivaldi://mail/message/")?t.url:e.url;return{...i,attachment:r.ZP.stringToAttachments(e.attachment),...(0,u.Z)(a?{invites:a}:null),...(0,u.Z)(o?{notifications:o}:null),...(0,u.Z)(l?{url:l}:null),id:t.id,start:e.start||0,end:e.end||0}}const $=async(e,t)=>{if(0===e.length)return;let s=0;const i=[[]];let a=0;for(const n of e)100===i[a].length&&(i.push([]),a++),n.exceptionEvents?.length?(await(0,S.$E)(n),s++,t(s,e.length)):i[a].push(n);n.ZP.stopAPIChangeListeners();try{for(const a of i){s+=(await n.ZP.createEvents(a)).created_count,t(s,e.length),n.ZP.loadPromise()}}catch(e){throw h.Z.error("Calendar",["import"],e),e}finally{n.ZP.startAPIChangeListeners(),d.ZP.updateAllAlarms()}};async function Y(e,t,s){const n=s?(e,t)=>L("Calendar",s,e,t):O.Z;for(const i of["VEVENT","VTODO"])if(t[i])try{const s=t=>({...K(t,e),task:"VTODO"===i});$(t[i].map(s),n)}catch(e){l.Z.addImportError("Calendar",s,e),h.Z.error("Calendar",["import"],e)}}const X=g()((async function(e){let t;try{if("string"==typeof e)t=e.startsWith("http")||e.startsWith("webcal")?await async function(e){try{const t=await fetch(e,{method:"GET"});if(200!==t.status)throw`Fetch remote calendar. Status code: ${t.status}`;return t.text()}catch(e){throw h.Z.warn("Calendar",["network"],"Error fetching calendar",e),e}}(j(e)):await I.Z.mailPrivate.readFileToText(e);else{const s=await e.getFile();t=await s.text()}return(0,b.Z)(t)}catch(e){throw e instanceof b.z?(h.Z.error("Calendar",["import","parser"],e),console.log("iCalendar parser error",t)):h.Z.warn("Calendar",["import","load"],e),e}}),{isPromise:!0,maxSize:10,onCacheChange:e=>{const t=e.keys[0];setTimeout((()=>{const s=e.getKeyIndex(t);-1!==s&&(e.keys.splice(s,1),e.values.splice(s,1))}),5*A.lb)}}),Q=async(e,t)=>{const{file:s}=e,i=await X(s);if(i.VEVENT?.[0]){const e=K(i.VEVENT[0],r.ZP.getDefaultCalendar()?.id||"");n.ZP.addEventCommand(t,e)}else h.Z.warn("Calendar",["import"],"No event found in file")},q=async e=>{try{const{file:t}=e,s=await X(t);return s.VEVENT.length?{eventCount:s.VEVENT.length,message:"",error:!1,calendarName:s["X-WR-CALNAME"]||s["X-WR-CALDESC"]||""}:{eventCount:0,message:(0,c.Z)("No events found"),error:!0,calendarName:""}}catch(e){return{eventCount:0,message:e.message,error:!0,calendarName:""}}},J=async e=>{const{file:t}=e,s=await X(t);try{!async function(e,t){const{calendarId:s,createNew:a,newCalendarName:u}=t,{VEVENT:p=[],VTODO:g=[]}=e;if(L("Calendar",u,0,p.length+g.length),a){const t={name:"",description:u,accountId:"",supportedCalendarComponent:{vevent:!0,vtodo:!0,vjournal:!1}},s=B();let i;if(s?(t.accountId=s.id,i=(await n.ZP.createCalendar(t)).calendar):i=(await R(null,t)).calendar,!i)return l.Z.addImportError("Calendar",u,(0,c.Z)("Error creating calendar.")),void h.Z.error("Calendar",["import"],"Error creating calendar.");await Y(i.id,e,u)}else{const{account:t,calendar:n}=r.ZP.getAccountAndCalendar(s);if(!t||!n)return void h.Z.error("Calendar",["import"],"Import error. Calendar not found.");const{account_type:a}=t;if("caldav"===a||"vivaldi"===a||"google"===a){const s=[],{VEVENT:a,VTODO:r,...h}=e;for(const t of["VEVENT","VTODO"]){if(!e[t])continue;const n=e[t];for(const e of n){let n;n="VEVENT"===t?{...h,VTODO:[],VEVENT:[e]}:{...h,VEVENT:[],VTODO:[e]};const i=N(n);s.push(i)}}let p=0;for(const e of s){const a=await i.Z.getAuthentication(t,{interactive:!0}),o=x(a,n.name,e),r=o?await(0,v.ZP)(o):{ok:!1,response:(0,c.Z)("Could not create a request from url. '%s'",[a.url])};r.ok?L("Calendar",u,++p,s.length):l.Z.addImportError("Calendar",u,(0,c.Z)("Error uploading event to server. $1",[r.response]))}d.ZP.updateAllAlarms(),setTimeout((()=>{o.Z.pollCalDAV({accountIds:[t.id]})}),1e3)}else await Y(s,e,u)}}(s,e)}catch(e){throw h.Z.warn("Calendar",["import","parse"],e),e}}},87852:(e,t,s)=>{"use strict";s.d(t,{G6:()=>n,Nw:()=>a,Q9:()=>o,W$:()=>i});const n=-999,i=-997,a=-996,o=-995},47543:(e,t,s)=>{"use strict";s.d(t,{EE:()=>v,IK:()=>A,Ns:()=>g,QX:()=>Z,Qj:()=>p,YE:()=>b,Zm:()=>m,_7:()=>u,_v:()=>w,jw:()=>T,ng:()=>c,qh:()=>C,v1:()=>x,xL:()=>y,yu:()=>f,z3:()=>h});var n=s(45660),i=s(42568),a=s.n(i),o=s(30381),r=s.n(o),l=s(82191),d=s(58821);const c=[l.Ci.MO,l.Ci.TU,l.Ci.WE,l.Ci.TH,l.Ci.FR,l.Ci.SA,l.Ci.SU],h=[l.Ci.MO,l.Ci.TU,l.Ci.WE,l.Ci.TH,l.Ci.FR];function u(e){const t=c[(e+6)%7];if(!t)throw new Error("Invalid weekday number");return t}function p(e,t,s){if(e)try{const n=s?(0,d.VV)(new Date(s),t):void 0;return(0,l.SA)(e,{dtstart:n})}catch(t){n.Z.warn("Calendar",["parser"],"Error parsing rrule string",e,t)}}function g(e){return e.dtstart&&(e.dtstart=(0,d.VV)(e.dtstart)),e.until&&(e.until=(0,d.VV)(e.until)),l.Ci.optionsToString(e)}function m(e){let{dtstart:t,until:s}=e;return t=t&&(0,d.VV)(t),s=s&&(0,d.VV)(s),new l.Ci({...e,dtstart:t,until:s})}function f(e,t){let{dtstart:s,until:n}=t;return s=s?(0,d.VV)(s):e.origOptions.dtstart,t.hasOwnProperty("until")?n&&(n=(0,d.VV)(n)):n=e.origOptions.until&&(0,d.FL)(e.origOptions.until),new l.Ci({...e.origOptions,...t,dtstart:s,until:n})}function v(e,t,s){function n(e){return e.weeks()-e.clone().startOf("month").weeks()}function i(e,t,s){const n="number"==typeof s?s:s.weekday,i=c[((n+e)%7+7)%7];if(!i)throw new Error("Weekday not found. Should not happen.");return i&&s.hasOwnProperty("n")&&"number"==typeof s.n?i.nth(s.n+t):i}if(!e)throw new Error("Trying to change empty recurrence rule");const a=e.dtstart??new Date((0,d.oJ)(s)),o=(0,d.FL)(a,s.timezone),l=r()(o),h=r()(o).add(t,"millisecond"),u=h.diff(l,"day");if(!u)return e;const p=n(h)-n(l),{byweekday:g,bymonthday:m}=e;return g?Array.isArray(g)?e.byweekday=g.map((e=>i(u,p,e))):e.byweekday=i(u,p,g):m&&(Array.isArray(m)?e.bymonthday=m.map((e=>l.clone().date(e).add(u,"day").date())):"number"==typeof m&&(e.bymonthday=l.clone().date(m).add(u,"day").date())),e}const b=a()((function(e,t){const{from:s,to:n,eventStart:i,timezone:a}=t,o=p(e,a,i);return o?o.between((0,d.VV)(new Date(s),a),(0,d.VV)(new Date(n),a),!0).map((e=>(0,d.FL)(e,a))):[]}),{maxSize:250});function C(e,t,s,n,i){return e.between((0,d.VV)(t,i),(0,d.VV)(s,i),!0,((e,t)=>t<n)).map((e=>(0,d.FL)(e,i)))}function w(e,t,s,n){const i=e.before((0,d.VV)(t,s),n);return i instanceof Date?(0,d.FL)(i):null}function y(e,t,s,n){const i=e.after((0,d.VV)(t,s),n);return i instanceof Date?(0,d.FL)(i):null}function x(e){const{bymonthday:t}=e.origOptions;return t?Array.isArray(t)?t:[t]:[]}function I(e){return"number"==typeof e?e:e.weekday}function A(e){const{byweekday:t}=e.origOptions;return t?Array.isArray(t)?t.map(I):[I(t)]:[]}function S(e){return"number"==typeof e?new l.OG(e):e}function Z(e){const{byweekday:t}=e.origOptions;return t?Array.isArray(t)?t.map(S):[S(t)]:[]}function T(e,t){if(!e)return 0;if(["UNTIL","COUNT"].some((t=>e.indexOf(t)>0))){const s=p(e);if(s?.options.until)return(0,d.FL)(s.options.until,t).valueOf();if(s?.options.count){const e=s.all().pop();return e?(0,d.FL)(e,t).valueOf():0}}return 0}},98035:(e,t,s)=>{"use strict";s.d(t,{Z:()=>p});var n=s(2934),i=s(15800),a=s(45660),o=s(28773),r=s(7064),l=s(24522),d=s(58821);function c(e){if(e.timezone!==l.$T&&!e.allDay)return e;const t={...e},{start:s=0,end:n=0}=e;return s&&(t.start=(0,d.VV)(new Date(s)).valueOf()),n&&(t.end=(0,d.VV)(new Date(n)).valueOf()),t}function h(e,t){a.Z.error("Calendar",[e,"event"],t)}async function u(e,t){let s;try{s=await r.Z.calendar.updateEvent(e,c({...t}))}catch(e){throw h("update",e),e}return n.ZP.transformVivaldiEvents([s])[0]}const p={createEvent:async function(e){let t;try{t=await r.Z.calendar.eventCreate(c(e))}catch(e){throw h("create",e),e}return n.ZP.transformVivaldiEvents([t])[0]},createEvents:async function(e){let t;try{t=await r.Z.calendar.eventsCreate(e.map(c))}catch(e){throw h("create",e),e}return t},updateEvent:async function(e){const{filteredOut:t,id:s,invites:n,notifications:a,recurrenceId:r,recurrenceExceptions:l,trash_time:d,attachment:c,...h}=e;if(!s)throw new Error("id missing from event object.");return u(s,{...h,...(0,o.Z)(c?{attachment:i.ZP.attachmentsToString(c)}:null)})},updateEventFromServer:async function(e,t){const{invites:s,notifications:n,recurrenceExceptions:i,is_template:a,exceptionEvents:o,...r}=t;return u(e,r)},createException:async function(e,t,s,i){if(!t&&!i)throw new Error("Can not create exception, invalid parameters.");const a=await r.Z.calendar.createEventException(e,t?"0":i,t,s);return n.ZP.transformVivaldiEvents([a])[0]},updateExceptions:async function(e){let t;for(const s of e){const{exception_id:e,...n}=s;e&&(t=await r.Z.calendar.updateRecurrenceException(e,n))}return t&&n.ZP.transformVivaldiEvents([t])[0]}}},41851:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});var n=s(7064),i=s(68172);const a={saveTemplate:async function(e,t){const s=(0,i.VK)(t);if(e)return await n.Z.calendar.updateEventTemplate(e,{name:t.name,ical:s}),{id:e,name:t.name};return{id:(await n.Z.calendar.createEventTemplate(t.name,s)).id,name:t.name}},deleteTemplate:async function(e){return n.Z.calendar.deleteEventTemplate(e)},loadTemplate:async function(e){const t=(await n.Z.calendar.getAllEventTemplates()).find((t=>t.id===e));if(t)return(0,i.Z1)(t.name,t.ical)},loadTemplatesList:async function(){return(await n.Z.calendar.getAllEventTemplates()).map((({id:e,name:t})=>({name:t,id:e})))}}},22529:(e,t,s)=>{"use strict";s.d(t,{Z:()=>C});var n=s(67294),i=s(29087),a=s(94283),o=s(56371),r=s(30381),l=s.n(r),d=s(81814),c=s(19789),h=s(89175),u=s(86088),p=s(89555),g=s(48521),m=s(34155);const f=function(e,t){return"0"!==e&&e.length<t?e.padStart(t,"0"):e.length>t?e.slice(e.length-t):e};function v(e){function t(e,t){return t.findIndex((t=>t[0].toUpperCase()===e[0].toUpperCase()&&t.length<e.length))}function s(e){return["d","m","y"].includes(e?.[0].toLowerCase())}const n=e.match(/(d+|m+|y+)|([^dmy]*)/gi)?.slice(0,-1);if(!n)return console.log("Incompatible date format found: "+e),v("yyyy-mm-dd");const i=[],a=[];let o="",r=n.shift();for(;r&&o.length<3;){for(;r&&!s(r);)r=n.shift();if(!r)break;if(-1===t(r,n)&&!o.includes(r[0].toLowerCase()))if(i.push(r),o+=r[0].toLowerCase(),s(n[0]))a.push("");else{const e=n.shift();e&&a.push(e)}r=n.shift()}let l=i.map((e=>e[0].toLowerCase())).join("");if("dm"===l?l="dmy":"md"===l&&(l="ymd"),3!==l.length)return console.log("Incompatible date format found: ",e,l),v("yyyy-mm-dd");return{fields:l.split("").map((t=>{switch(t){case"d":return{type:"day",format:"dd"};case"m":return{type:"month",format:"mm"};case"y":return{type:"year",format:"yyyy"};default:throw new Error(`Unexpected date format group: ${t}, ${e}`)}})),separators:a}}class b extends n.PureComponent{static contextType=a.Z;_focused=!1;hidden=n.createRef();fieldRefs={day:this.props.dayInputRef||n.createRef(),month:n.createRef(),year:n.createRef()};inputPosition=-1;constructor(e){super(e),this._template=v(this.getFormat());const[t,s,n]=this.props.value.split("-");this.state={year:t,month:s,day:n,hasInput:!1}}componentDidUpdate(e){e.value!==this.props.value&&this.setCache()}setCache=()=>{const[e,t,s]=this.props.value.split("-");this.setState((n=>({year:e??"",month:t??"",day:s??"",hasInput:!!this.props.value&&n.hasInput})))};getFormat=()=>this.props.format||l().localeData().longDateFormat("L");processChange=e=>{""===e.currentTarget.value&&this.setState({hasInput:!1}),this.props.onChange(e)};select=e=>{this.inputPosition=-1,e.target instanceof this.context.HTMLInputElement&&(e.preventDefault(),e.target.select())};focus=()=>{this.fieldRefs[this._template.fields[0].type]?.current?.focus()};onKeyDown=e=>{this.props.onKeyDown&&this.props.onKeyDown(e);const{key:t,target:s}=e,n=s.dataset.type,i=this._template.fields.findIndex((e=>e.type===n));if(t&&("ArrowLeft"===t||"ArrowRight"===t||"ArrowDown"===t))switch(t){case"ArrowRight":e.preventDefault();return void this.fieldRefs[this._template.fields[i+1].type].current?.select();case"ArrowLeft":e.preventDefault();return void this.fieldRefs[this._template.fields[i-1].type].current?.select();case"ArrowDown":return void(e.altKey&&(e.preventDefault(),this.hidden.current?.showPicker()))}isNaN(Number(t))&&m.nextTick((()=>{const{document:e,HTMLInputElement:t}=this.context;e.activeElement instanceof t&&e.activeElement.select()}))};onClickPlaceholder=e=>{this.hidden.current?.showPicker()};onPlaceholderKeyDown=e=>{if(this.props.onKeyDown&&this.props.onKeyDown(e),"ArrowDown"===e.key&&e.altKey&&(e.preventDefault(),this.hidden.current?.showPicker()),!isNaN(e.key)){const t=this._template.fields[0].type,s=this.fieldRefs[t].current;if(s){const t=new Date;this.setState({day:f(t.getDate().toString(),2),month:f((t.getMonth()+1).toString(),2),year:t.getFullYear().toString(),hasInput:!0},(()=>{const t=(Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value")||{}).set;if(s&&t){t.call(s,e.key);const n=new InputEvent("change",{bubbles:!1});s.dispatchEvent(n)}m.nextTick((()=>{s.focus(),this.context.document.getSelection()?.collapseToEnd()}))}))}}};skipToNextField(e){const{document:t}=this.context,s=this._template.fields.length,n=this._template.fields.findIndex((t=>t.type===e))+1;n===s&&(this.props.autoFocusNextElement??i.Z.get(h.kCalendarAutoTabDatetime))?m.nextTick((()=>{(0,d.pf)(t)})):m.nextTick((()=>{const e=this._template.fields[Math.min(n,s-1)].type;this.fieldRefs[e].current?.select()}))}onChangeDate=e=>{const t=e.target,s=t.dataset.type,n=t.value;let i=parseInt(n);const a=[this.state.year,this.state.month,this.state.day],o=!e.nativeEvent.inputType&&e.nativeEvent.bubbles,r=o&&this.props.step?parseInt(this.props.step):1;let d=!1;if(o&&"day"===s){const e=parseInt(this.state.day);d=!0,i=i<e?e-r:e+r}const h="year"===s?4:2,u="year"===s?9999:"month"===s?12:l()(this.props.value).daysInMonth(),p=n===h||o?1:0;i>u?o?i%=u:i=u:i<p&&(i=o?u:p);let g=i.toString();o&&(g=f(g,h)),d&&t.setAttribute("value",g),!o&&(10*i>u||n.length>=h)&&(g=f(g,h),this.skipToNextField(s)),this.setState({[s]:g},(()=>{const e=["year","month","day"].indexOf(s);if(g.length<h)return;a[e]=g;const t=l()(a.join("-"));if(t.isValid()){if(this.props.min&&t.isBefore(l()(this.props.min))||this.props.max&&t.isAfter(l()(this.props.max)))return;const e=this.hidden.current,s=(Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value")||{}).set;e&&s&&(s.call(e,(0,c.SI)(t)),e.dispatchEvent(new Event("input",{bubbles:!0})))}}))};onFocus=e=>{if(e.persist(),e.preventDefault(),this._focused)return;const t=e.target.closest(".dateInput");m.nextTick((()=>{const{onFocus:s}=this.props,{document:n,HTMLElement:i}=this.context;s&&t instanceof i&&(0,d.sT)(n,t)&&(this._focused=!0,s(e))}))};onBlur=e=>{const t=this._template.fields.reduce(((e,t)=>{const s=this.state[t.type];return s&&s.length<t.format.length&&(e[t.type]=f(s,t.format.length)),e}),{});Object.keys(t).length>0&&this.setState(t),e.preventDefault(),e.persist();const s=e.target.closest(".dateInput");m.nextTick((()=>{const{onBlur:t}=this.props,{document:n,HTMLElement:i}=this.context;t&&s instanceof i&&!(0,d.sT)(n,s)&&(this._focused=!1,t(e))}))};keepFocusWithin=e=>{e.preventDefault(),(0,d.sT)(this.context.document,e.currentTarget.nextElementSibling)||this.focus()};renderFields=e=>{const t=[this._template.fields[0].type,this._template.separators[0]??"/",this._template.fields[1].type,this._template.separators[1]??this._template.separators[0]??"/",this._template.fields[2].type],s={onFocus:this.select,onMouseDown:this.select,onMouseUp:e=>e.preventDefault(),onKeyDown:this.onKeyDown,onChange:this.onChangeDate,disabled:this.props.disabled};return(0,g.jsx)("span",{className:"faux date",children:t.map(((t,i)=>{switch(t.toLowerCase()){case"day":return(0,n.createElement)("input",{...s,autoFocus:0===i&&this.props.autoFocus,key:"dd_"+i,className:"dateInputDay"+(e?" dateInputHiddenChild":""),type:"number",ref:this.fieldRefs.day,"data-type":"day",tabIndex:this.props.tabIndex,placeholder:(0,o.Z)("dd"),value:this.state.day??""});case"month":return(0,n.createElement)("input",{...s,autoFocus:0===i&&this.props.autoFocus,key:"mm_"+i,className:"dateInputMonth"+(e?" dateInputHiddenChild":""),type:"number",ref:this.fieldRefs.month,"data-type":"month",tabIndex:this.props.tabIndex,placeholder:(0,o.Z)("date","mm"),value:this.state.month??""});case"year":return(0,n.createElement)("input",{...s,autoFocus:0===i&&this.props.autoFocus,key:"yy_"+i,className:"dateInputYear"+(e?" dateInputHiddenChild":""),type:"number",ref:this.fieldRefs.year,"data-type":"year",tabIndex:this.props.tabIndex,placeholder:(0,o.Z)("yyyy"),value:this.state.year??""});default:return(0,g.jsx)("span",{className:"dateInputSeparator"+(e?" dateInputHiddenChild":""),children:t},"separator_"+i)}}))})};render(){const{format:e,onChange:t,tabIndex:s,onFocus:n,onBlur:i,dayInputRef:a,placeholder:o,autoFocus:r,...l}=this.props,d=!this.state.hasInput&&!this.props.value&&!!o;return(0,g.jsxs)("span",{className:"dateInput",title:this.props.title,onBlur:this.onBlur,onFocus:this.onFocus,children:[(0,g.jsx)("input",{...l,type:"date",ref:this.hidden,tabIndex:"-1",className:"dateInputHidden",onMouseDown:this.keepFocusWithin,onChange:this.processChange}),this.renderFields(d),d&&(0,g.jsx)("input",{className:"placeholder"+(d?"":" dateInputHiddenChild"),placeholder:o,onClick:this.onClickPlaceholder,onKeyDown:this.onPlaceholderKeyDown,onChange:p.Z,value:"",type:"number"}),(0,g.jsx)("span",{className:"arrowDown",dangerouslySetInnerHTML:{__html:u.yaZ.medium}})]})}}const C=b},97009:(e,t,s)=>{"use strict";s.d(t,{D0:()=>h,ZP:()=>g,rv:()=>u});var n=s(67294),i=s(24325),a=s.n(i),o=s(25372),r=s(36436),l=s(44850),d=s(48521);const c=["/resources","chrome://favicon","data:"];function h(e){return c.some((t=>e.startsWith(t)))}function u(e){if(h(e))return e;let t,s="";const n=(0,o.Z)((0,r.q9)(e));n&&({hostname:t,protocol:s}=n);return`${s||"https"}//${(t||"").split(".").slice(-2).join(".")}/favicon.ico`}class p extends n.PureComponent{state={loadFailed:!1};componentDidUpdate(e,t){t.loadFailed&&this.props.url!==e.url&&this.props.loadType!==e.loadType&&this.setState({loadFailed:!1})}handleImageLoadError=()=>{this.setState({loadFailed:!0})};getUrl=()=>{const e=this.props.fallbackUrl?(0,l.w$)(this.props.fallbackUrl):void 0,t=(0,l.w$)(this.props.url);return t.startsWith("<svg")?{type:"svg",url:t}:t.startsWith("data:")?{type:"data",url:t}:this.state.loadFailed?e&&h(e)?{type:"faviconSkipCache",url:e}:{type:"faviconSkipCache",url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABiUlEQVR42u2XK08DURBG6U/D80eQeMIjqGJAocCA6hqqUBASakCBAYUqSbvb92u3j6VZZjYcQ3q3hWlSRJucfF8yt3PPlbuxtb2zUtYC/1dAfge/ZHOlAkgsXSBJkn0B9ki6nvE87z5Twi7g5vtM4pCwC0yn0yPZn6KdBATcEnaBfBzHx4p0EvIIuCTMAnLhqXCiaCcBgSwJk8B4PD6Ti1K0k3QE5kn8WWA0Gl24mEwm5wjMk7AIXA6Hw6tZ6EzO7GZhFpCLChBFkUfSyVmEYVgwC8gF14PBoKhoJwGY/ThflB2HJoF+v38jL0mRTi5MLpezCchLbnu9HtyRdFLRsyTdLNDtdkvykgdFOgkl0oVZoNPpPMqip0Vot9tkiv7XLNBqtZ5l2YuinVTkAtLJMgTeMngl6STdLNBsNt+h0WiQdNI5NwvIonK9XnfxQToomwVkiV+r1YJZ6IwEYGYWCIKgbcEs4Pt+JIQOIpJO0s0ClUrls1qtQkwqOiM5R9JNAktk9QLrb0MXX53cKptKU4a6AAAAAElFTkSuQmCC"}:"page"===this.props.loadType?t.startsWith("javascript")?{type:"svg",url:a()}:{type:"page",url:t}:h(t)?{type:"faviconSkipCache",url:t}:{type:this.props.loadType,url:t}};render(){const{type:e,url:t}=this.getUrl();if("svg"===e||"emoji"===e)return(0,d.jsx)("span",{ref:this.props.refFavicon,className:this.props.className,style:this.props.style,dangerouslySetInnerHTML:{__html:t},title:this.props.title,"aria-hidden":"true"});const s=t.replace("vivaldi://","chrome://"),n="page"===e?"":"iconurl/",i=this.props.size||16,a=1.5*i,o=2*i,r="faviconSkipCache"===e||"data"===e,l=r?t:null,c=r?null:`chrome://favicon/size/${i}/${n}${s} ${i}w,chrome://favicon/size/${a}/${n}${s} ${a}w,chrome://favicon/size/${o}/${n}${s} ${o}w`;return(0,d.jsx)("img",{ref:this.props.refFavicon,className:this.props.className,width:i,height:i,src:l,srcSet:c,style:this.props.style,title:this.props.title,onError:this.handleImageLoadError,"aria-hidden":"true"})}}const g=p},69417:(e,t,s)=>{"use strict";s.d(t,{Z:()=>d});var n=s(67294),i=s(94184),a=s.n(i),o=s(86088),r=s(48521);class l extends n.PureComponent{inputRef=n.createRef();componentDidMount(){if(this.props.focusInput&&this.inputRef.current){const e=this.inputRef.current;e.focus(),e.setSelectionRange(0,e.value.length)}}componentDidUpdate(e){if(!e.focusInput&&this.props.focusInput&&this.inputRef.current){const e=this.inputRef.current;e.focus(),e.setSelectionRange(0,e.value.length)}}render(){const{placeholder:e="",label:t,labelImportant:s,className:n="",isVerified:i,hasError:l,focusInput:d,...c}=this.props,h=a()(n,{"floating-label":!0,verified:i&&!this.props.disabled});let u;return t&&(u=s?(0,r.jsx)("strong",{children:t}):(0,r.jsx)("span",{children:t})),(0,r.jsxs)("label",{className:h,children:[u,"textarea"!==c.type?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("input",{...c,ref:this.inputRef,className:"floating-input",type:this.props.type,placeholder:e}),l&&!this.props.disabled&&(0,r.jsx)("span",{className:"error",dangerouslySetInnerHTML:{__html:o.viW}})]}):(0,r.jsx)("textarea",{...c,ref:this.inputRef,className:"floating-input",placeholder:e})]})}}const d=l},63377:(e,t,s)=>{"use strict";s.d(t,{Z:()=>c});var n=s(67294),i=s(29087),a=s(94283),o=s(89175),r=s(48521);const l=[o.kWebpagesFocusTrap];class d extends n.PureComponent{static contextType=a.Z;focusRef=this.props.forwardRef??n.createRef();constructor(e,t){super(e),this._lastFocused=t.document.activeElement}componentDidMount(){this._getFocusable();const e=0===i.Z.get(o.kKeyboardTabToAll),{preventTrap:t,forceTrap:s,noInitialFocus:n}=this.props;!n&&(e&&!t||s)&&this.focus(),i.Z.addListener(l,this.onPrefsCacheChanged)}componentWillUnmount(){const{document:e}=this.context;!this.props.noInitialFocus&&this.focusRef?.current?.contains(e.activeElement)&&setTimeout((()=>{"BODY"===e.activeElement?.tagName&&this._lastFocused?.isConnected&&this._lastFocused.focus()}),1),delete this._focusable,i.Z.removeListener(l,this.onPrefsCacheChanged)}onPrefsCacheChanged=()=>this.forceUpdate();_getFocusable=()=>{const{HTMLElement:e}=this.context,t=this.focusRef.current;this._focusable=t instanceof e?t.querySelectorAll(`a[href]:not([tabindex='-1']),\n        button:not([disabled],[disabled=true],[tabindex='-1']),\n        input:not([disabled],[disabled=true],[tabindex='-1'],[hidden]),\n        select:not([disabled],[disabled=true],[tabindex='-1']),\n        textarea:not([disabled],[disabled=true],[tabindex='-1']),\n        p[contenteditable]:not([tabindex='-1']),\n        [tabindex]:not([tabindex='-1'],\n        .${this.props.focusName})`):void 0};focus=()=>{this.focusRef?.current?.contains(this.context.document.activeElement)||(this.props.forceTrap?this.focusRef?.current?.focus():this._focusable?.length&&this._focusable[0].focus())};isFocusOrigin=e=>Boolean(e.relatedTarget instanceof this.context.HTMLElement&&this.focusRef?.current?.contains(e.relatedTarget)&&this.focusRef?.current!==e.relatedTarget);handleTopFocus=e=>{if(this._getFocusable(),(!this.props.noInitialFocus||e.relatedTarget)&&this._focusable?.length){const t=this._focusable[0],s=this._focusable[this._focusable.length-1];if(!t||!s)return;this.isFocusOrigin(e)?s.focus():t.focus()}};handleBottomFocus=e=>{if((!this.props.noInitialFocus||e.relatedTarget)&&this._focusable?.length){const t=this._focusable[0],s=this._focusable[this._focusable.length-1];if(!t||!s)return;this.isFocusOrigin(e)?t.focus():s.focus()}};render(){const{children:e,focusName:t,forceTrap:s,preventTrap:n,noInitialFocus:a,forwardRef:l,...d}=this.props,c=s?0:null,h=!0===i.Z.get(o.kWebpagesFocusTrap);return s||h&&!n?(0,r.jsxs)("div",{...d,ref:this.focusRef,tabIndex:c,children:[(0,r.jsx)("span",{tabIndex:"0",className:"focus_anchor "+t,onFocus:this.handleTopFocus}),e,(0,r.jsx)("span",{tabIndex:"0",className:"focus_anchor "+t,onFocus:this.handleBottomFocus})]}):(0,r.jsx)("div",{...d,ref:this.focusRef,tabIndex:c,children:e})}}const c=d},90718:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});var n=s(67294),i=s(29087),a=s(89175),o=s(48521);class r extends n.PureComponent{onKeyDown=e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),e.stopPropagation(),this.props.onClick())};render(){return(0,o.jsx)("span",{title:this.props.title,className:"InlineText",tabIndex:i.Z.get(a.kKeyboardTabToAll),onMouseDown:e=>e.preventDefault(),onClick:this.props.onClick,onKeyDown:this.onKeyDown,children:this.props.children})}}},52250:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});var n=s(67294),i=s(94283),a=s(46884),o=s(48521);function r(e){return(0,n.forwardRef)((function(t,s){if("function"==typeof s)throw Error("Callback refs not supported");const{Element:r}=n.useContext(i.Z),[l,d]=(0,n.useState)(!1),c=(0,n.useCallback)((()=>d(!1)),[]),h=(0,n.useCallback)((()=>d(!0)),[]),u=(0,n.useRef)(null),p=(0,n.useCallback)((()=>{const e=u.current?.getNode();return e instanceof r?e:null}),[u,r]),g=(0,n.useCallback)((()=>u.current?u.current.handleClickOutside:null),[u]),{disableOnClickOutside:m,outsideClickIgnoreClass:f}=t;return(0,a.Z)(p,g,f,m?.()||l),(0,o.jsx)(e,{...t,ref:e=>{s&&(s.current=e),u.current=e},enableOnClickOutside:c,disableOnClickOutside:h})}))}},81009:(e,t,s)=>{"use strict";s.d(t,{Z:()=>o});var n=s(67294),i=s(14507),a=s(48521);const o=function(e,t){return n.forwardRef(((s,n)=>{const o=(0,i.Z)(t);return(0,a.jsx)(e,{...s,ref:n,prefValues:o})}))}},5298:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});const n=Object.freeze({KEY_CANCEL:3,KEY_HELP:6,KEY_BACK_SPACE:8,KEY_TAB:9,KEY_CLEAR:12,KEY_RETURN:13,KEY_ENTER:14,KEY_SHIFT:16,KEY_CONTROL:17,KEY_ALT:18,KEY_PAUSE:19,KEY_CAPS_LOCK:20,KEY_ESCAPE:27,KEY_SPACE:32,KEY_PAGE_UP:33,KEY_PAGE_DOWN:34,KEY_END:35,KEY_HOME:36,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_PRINTSCREEN:44,KEY_INSERT:45,KEY_DELETE:46,KEY_0:48,KEY_1:49,KEY_2:50,KEY_3:51,KEY_4:52,KEY_5:53,KEY_6:54,KEY_7:55,KEY_8:56,KEY_9:57,KEY_SEMICOLON:59,KEY_EQUALS:61,KEY_A:65,KEY_B:66,KEY_C:67,KEY_D:68,KEY_E:69,KEY_F:70,KEY_G:71,KEY_H:72,KEY_I:73,KEY_J:74,KEY_K:75,KEY_L:76,KEY_M:77,KEY_N:78,KEY_O:79,KEY_P:80,KEY_Q:81,KEY_R:82,KEY_S:83,KEY_T:84,KEY_U:85,KEY_V:86,KEY_W:87,KEY_X:88,KEY_Y:89,KEY_Z:90,KEY_META:91,KEY_CONTEXT_MENU:93,KEY_NUMPAD0:96,KEY_NUMPAD1:97,KEY_NUMPAD2:98,KEY_NUMPAD3:99,KEY_NUMPAD4:100,KEY_NUMPAD5:101,KEY_NUMPAD6:102,KEY_NUMPAD7:103,KEY_NUMPAD8:104,KEY_NUMPAD9:105,KEY_MULTIPLY:106,KEY_ADD:107,KEY_SEPARATOR:108,KEY_SUBTRACT:109,KEY_DECIMAL:110,KEY_DIVIDE:111,KEY_F1:112,KEY_F2:113,KEY_F3:114,KEY_F4:115,KEY_F5:116,KEY_F6:117,KEY_F7:118,KEY_F8:119,KEY_F9:120,KEY_F10:121,KEY_F11:122,KEY_F12:123,KEY_F13:124,KEY_F14:125,KEY_F15:126,KEY_F16:127,KEY_F17:128,KEY_F18:129,KEY_F19:130,KEY_F20:131,KEY_F21:132,KEY_F22:133,KEY_F23:134,KEY_F24:135,KEY_NUM_LOCK:144,KEY_SCROLL_LOCK:145,KEY_COMMA:188,KEY_PERIOD:190,KEY_SLASH:191,KEY_BACK_QUOTE:192,KEY_OPEN_BRACKET:219,KEY_BACK_SLASH:220,KEY_CLOSE_BRACKET:221,KEY_QUOTE:222})},76632:(e,t,s)=>{"use strict";s.d(t,{Z:()=>p});var n=s(67294),i=s(64473),a=s(56551),o=s(56371),r=s(94184),l=s.n(r),d=s(67074),c=s(48521);const h={width:450,minWidth:"unset"};class u extends n.Component{refSortable=n.createRef();constructor(e){super(e),this.state={selectedIndex:this.props.initialSelectedIndex||(this.props.items.length>0?0:-1),isCreating:!1,isDeleting:!1,showDeleteConfirmation:!1}}componentDidUpdate(e){this.props.items.length!==e.items.length&&this.cancelRemoval()}onSelectItem=e=>{this.setState({selectedIndex:e})};onDeleteInProgress=e=>{this.setState({isDeleting:e})};onCreateItem=e=>{this.setState({isCreating:!0}),"function"==typeof this.props.onCreateItem&&this.props.onCreateItem(e)};onCancelCreate=e=>{this.setState({isCreating:!1}),"function"==typeof this.props.onCancelCreateItem&&this.props.onCancelCreateItem()};considerRemovingItem=()=>{this.setState({showDeleteConfirmation:!0})};onRemove=e=>{"function"==typeof this.props.onRemove&&(this.props.onRemove(e),this.setState({showDeleteConfirmation:!1,isDeleting:!1}))};cancelRemoval=()=>{this.setState({showDeleteConfirmation:!1})};renderContentElement=(e,t,s,n)=>{if(!e||t)return n(s);const i=e&&s&&function(e,t){let s=!1;const n={...t};for(const i of Object.keys(t)){const a=t[i];a.toLowerCase().includes(e)&&(n[i]=(0,d.CH)(a,e),s=!0)}return s?n:null}(e,s);return e&&!i?null:n(i||s)};render(){const{items:e,masterLayout:t}=this.props,s=this.state.selectedIndex,n=null!=s&&e[s];let r;const u=this.props.title||this.props.subtitle||"",p=u.toLowerCase().includes(this.props.filter)?"":this.props.filter,g=!p||e.some((e=>"string"==typeof e.name&&e.name.toLowerCase().includes(p)));if((this.state.isCreating||this.props.isCreating)&&this.props.renderCreate?r=this.renderContentElement(p,g,this.props.createStrings?this.props.createStrings:this.props.contentStrings,this.props.renderCreate.bind(this)):n?r=this.renderContentElement(p,g,this.props.contentStrings,this.props.renderContent.bind(this,s)):this.props.renderEmpty&&(r=this.renderContentElement(p,g,this.props.emptyStrings?this.props.emptyStrings:this.props.contentStrings,this.props.renderEmpty.bind(this))),!r&&!g)return null;const{className:m=""}=this.props;return(0,c.jsxs)("div",{"data-anchor":this.props.dataAnchor,className:m+" master-detail-wrapper",children:[this.props.title&&(0,c.jsx)("h2",{children:(0,d.CH)(this.props.title,this.props.filter)}),this.props.subtitle&&(0,c.jsx)("h3",{children:(0,d.CH)(this.props.subtitle,this.props.filter)}),(0,c.jsxs)("div",{className:m+" master-detail",children:[this.state.showDeleteConfirmation&&n&&this.props.deleteDialog&&(0,c.jsx)(i.Z,{onRequestClose:this.cancelRemoval,className:"float",ignoreClickOutside:this.state.isDeleting,ignoreEscape:this.state.isDeleting,style:h,label:u,children:this.props.deleteDialog({item:n,onClose:this.cancelRemoval,onDeleteInProgress:this.onDeleteInProgress})}),this.state.showDeleteConfirmation&&n&&this.props.deleteTitle&&(0,c.jsxs)(i.Z,{onRequestClose:this.cancelRemoval,className:"float",title:this.props.deleteTitle,children:[(0,c.jsx)("div",{className:"dialog-content",children:(0,c.jsxs)("p",{className:"error",children:[this.props.deleteLabel," ",(0,o.Z)("Are you sure you would like to delete “$1”?",[n.label||n.name])]})}),(0,c.jsxs)("footer",{className:"dialog-footer",children:[(0,c.jsx)("input",{type:"button",className:"danger",value:(0,o.Z)("verb","Delete"),onClick:()=>this.onRemove(s)}),(0,c.jsx)("input",{type:"button",value:(0,o.Z)("Cancel"),autoFocus:!0,onClick:this.cancelRemoval})]})]}),(0,c.jsx)("div",{className:l()({master:!0,"master-layout-double":0===t,"master-layout-single":1===t}),children:(0,c.jsx)(a.Z,{ref:this.refSortable,items:e,emptyListGraphic:this.props.emptyListGraphic,emptyListString:this.props.emptyListString,renderListItem:this.props.renderListItem,onSelectItem:this.onSelectItem,onCreateItem:this.onCreateItem,isCreating:this.props.isCreating,moveItem:this.props.isCreating?void 0:this.props.moveItem,onRemove:this.props.onRemove,filter:this.props.filter,selectedIndex:this.state.selectedIndex,onContextMenu:this.props.onContextMenu,onActivate:this.props.onActivate,onCancelCreate:this.onCancelCreate,addTipString:this.props.addTipString,considerRemovingItem:this.considerRemovingItem,deleteTipString:this.props.deleteTipString,supportDragAndDrop:this.props.supportDragAndDrop,disableAutoFocus:this.props.disableAutoFocus,mimeType:this.props.mimeType?this.props.mimeType.toString():void 0,renderCreateListItem:this.props.renderCreateListItem})}),r]})]})}}const p=u},4949:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});var n=s(67294),i=s(94283),a=s(48521);class o extends n.Component{static contextType=i.Z;#pn(e){return n.Children.map(e,(e=>{if(n.isValidElement(e)){if("input"===e.type&&"radio"===e.props.type)return(0,a.jsx)("input",{...e.props,checked:e.props.value===this.props.value.toString(),disabled:Boolean(this.props.disabled),name:this.props.name,onChange:this.props.onChange});if(e.props.children)return n.cloneElement(e,null,this.#pn(e.props.children))}return e}))}render(){const e=this.#pn(this.props.children);return(0,a.jsx)("div",{className:this.props.className,children:e})}}const r=o},33349:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});var n=s(67294),i=s(48521);const a=(0,n.forwardRef)(((e,t)=>{const{children:s,...n}=e;return(0,i.jsx)("span",{className:"select-wrapper",children:(0,i.jsx)("select",{...n,ref:t,children:s})})}))},69697:(e,t,s)=>{"use strict";s.d(t,{Z:()=>c});var n=s(67294),i=s(94283),a=s(94184),o=s.n(a),r=s(4027),l=s(48521);class d extends n.Component{static contextType=i.Z;static defaultProps={offset:0};#gn=n.createRef();componentDidMount=()=>{const e=this.#gn.current;e&&(e.addEventListener("pointerdown",this.handlePointerDown,!0),e.addEventListener("pointerup",this.handlePointerUp,!0),e.addEventListener("pointercancel",this.handleStop,!0))};componentWillUnmount=()=>{const e=this.#gn.current;e&&(e.removeEventListener("pointerdown",this.handlePointerDown,!0),e.removeEventListener("pointerup",this.handlePointerUp,!0),e.removeEventListener("pointercancel",this.handleStop,!0))};handleDoubleClick=e=>{this.props.onDoubleClick&&(this.props.onDoubleClick(),e.stopPropagation())};handlePointerDown=e=>{e.preventDefault(),e.button===r.Z.kLeft&&(e.currentTarget.setPointerCapture(e.pointerId),r.Z.setWebviewPointerEvents(!1,this.context.document),e.currentTarget.addEventListener("pointermove",this.handlePointerMove,!0),this.props.onStart&&this.props.onStart())};handlePointerUp=e=>{e.button===r.Z.kCenter?this.handleDoubleClick(e):this.handleStop(e)};handlePointerMove=e=>{if(!e.buttons)return void this.handleStop(e);const t=this.props.returnOffset?e.movementX:e.pageX+(this.props.offset||0),s=this.props.returnOffset?e.movementY:e.pageY+(this.props.offset||0);this.context.requestAnimationFrame((()=>{this.props.onSlidebarPosition(t,s,e)}))};handleStop=({currentTarget:e,pointerId:t})=>{e.releasePointerCapture(t),r.Z.setWebviewPointerEvents(!0,this.context.document),e.removeEventListener("pointermove",this.handlePointerMove,!0),this.props.onStop&&this.props.onStop()};render(){const{position:e}=this.props,t="left"===e||"right"===e?"SlideBar--FullHeight":"SlideBar--FullWidth",s="right"===e||"bottom"===e;return(0,l.jsx)("button",{type:"button",tabIndex:"-1",ref:this.#gn,style:this.props.style,onClick:e=>e.stopPropagation(),onDoubleClick:this.handleDoubleClick,className:o()("SlideBar",this.props.className,t,{alternate:s})})}}const c=d},56551:(e,t,s)=>{"use strict";s.d(t,{Z:()=>f});var n=s(67294),i=s(84451),a=s(94283),o=s(56371),r=s(94184),l=s.n(r),d=s(1407),c=s(67074),h=s(13302),u=s(86088),p=s(48521),g=s(34155);class m extends n.Component{static contextType=a.Z;dropSupport=!1;moveUpCombo=(0,h.$)("alt+up");moveDownCombo=(0,h.$)("alt+down");refItems=n.createRef();constructor(e){super(e),this.state={selectedIndex:this.props.selectedIndex||(this.props.items.length>0?0:-1),isCreating:!1,dragIndex:-1,dropIndex:-1,dropPosition:""}}componentWillUnmount(){this.clearDndTimer()}componentDidUpdate(e){const t=this.props.selectedIndex;if(!this.props.renderCreateListItem&&e.selectedIndex!==t&&"number"==typeof t&&t>=0&&(this.setSelected(t,!1),this.focusItem(t)),e.items.length!==this.props.items.length){let t=-1;if(this.props.items.length>0)if(0===e.items.length)t=0;else if(this.props.items.length>e.items.length){const s=this.props.items.filter((({key:t})=>!e.items.some((({key:e})=>e===t))));t=this.props.items.indexOf(s[0])}else-1!==this.state.selectedIndex&&(t=Math.min(this.state.selectedIndex,this.props.items.length-1),this.props.disableAutoFocus||t!==this.props.items.length-1||this.focusItem(t));this.setSelected(t,!1)}e.isCreating!==this.props.isCreating&&this.props.isCreating&&this.setIsCreating()}setSelected=(e,t)=>{void 0!==t&&(this.setState({isCreating:this.props.onCancelCreate&&t}),t&&this.props.onCreateItem?this.props.onCreateItem():!t&&this.props.onCancelCreate&&this.props.onCancelCreate()),this.setState({selectedIndex:e}),"function"==typeof this.props.onSelectItem&&this.props.onSelectItem(e)};loadItemAt=e=>{this.setSelected(e),g.nextTick((()=>{const e=this.refItems.current;if(e){const t=e.querySelector(".item-selected");t&&!this.props.disableAutoFocus&&t.focus()}}))};setIsCreating=()=>{this.setSelected(this.props.items.length,!0),g.nextTick((()=>{const e=this.refItems.current;e&&(e.scrollTop=e.scrollHeight)}))};removeItem=e=>{e>=this.props.items.length?("function"==typeof this.props.onCancelCreate&&this.props.onCancelCreate(),this.setSelected(this.props.items.length-1,!1)):"function"==typeof this.props.considerRemovingItem?this.props.considerRemovingItem():"function"==typeof this.props.onRemove&&this.props.onRemove(this.state.selectedIndex)};moveDown=()=>{this.props.moveItem&&this.props.items&&this.props.items.length>1&&this.state.selectedIndex+1<this.props.items.length&&(this.props.moveItem(this.state.selectedIndex,this.state.selectedIndex+1),this.loadItemAt(this.state.selectedIndex+1))};moveUp=()=>{this.props.moveItem&&this.props.items&&this.props.items.length>1&&this.state.selectedIndex>0&&(this.props.moveItem(this.state.selectedIndex,this.state.selectedIndex-1),this.loadItemAt(this.state.selectedIndex-1))};focusItem=(e,t)=>{if(this.state.isCreating||this.props.isCreating)return;this.state.selectedIndex!==e&&this.loadItemAt(e);const s=this.refItems.current;s&&!this.props.disableAutoFocus&&s.focus(),t&&t.stopPropagation()};onDoubleClick=(e,t)=>{this.props.onActivate&&this.props.onActivate(e,t),t.stopPropagation()};clearDndTimer=()=>{this.dndTimerId&&(clearTimeout(this.dndTimerId),delete this.dndTimerId)};onDragStartButton=(e,t)=>{this.props.supportDragAndDrop&&this.props.mimeType&&(t.dataTransfer.effectAllowed="move",t.dataTransfer.setData(this.props.mimeType,e),this.setState({dragIndex:e}))};onDragEnter=e=>{this.props.supportDragAndDrop&&this.props.mimeType&&(e.preventDefault(),e.stopPropagation(),this.dropSupport=e.dataTransfer.types.some((e=>e===this.props.mimeType)),e.dataTransfer.dropEffect=this.dropSupport?"move":"none")};onDragLeave=e=>{this.props.supportDragAndDrop&&(e.preventDefault(),e.stopPropagation(),this.clearDndTimer(),this.dndTimerId=setTimeout((()=>{delete this.dndTimerId,this.setState({dropIndex:-1,dropPosition:""})}),d._p))};getDropPosition=e=>{let t=0;const s=e.currentTarget.getBoundingClientRect(),n=s.height;return t=(e.clientY-s.top)/n,t<=.5?"above":"below"};onDragOverButton=(e,t)=>{if(t.preventDefault(),t.stopPropagation(),this.dropSupport){t.dataTransfer.dropEffect="move",this.clearDndTimer();const s=this.getDropPosition(t);this.state.dropIndex===e&&this.state.dropPosition===s||this.setState({dropIndex:e,dropPosition:s})}};onDragOver=e=>{if(e.preventDefault(),e.stopPropagation(),this.dropSupport){e.dataTransfer.dropEffect="move",this.clearDndTimer();const t=this.props.items.length>0?this.props.items.length-1:0,s="below";this.state.dropIndex===t&&this.state.dropPosition===s||this.setState({dropIndex:t,dropPosition:s})}};onDropButton=(e,t)=>{if(t.preventDefault(),t.stopPropagation(),this.dropSupport&&this.props.mimeType){const s=Number(t.dataTransfer.getData(this.props.mimeType));if(void 0!==s){let n=e+("below"===this.getDropPosition(t)?1:0);s<n&&(n-=1),this.props.moveItem&&(this.props.moveItem(s,n),this.loadItemAt(n))}}this.onDragEnd()};onDrop=e=>{if(e.preventDefault(),e.stopPropagation(),this.dropSupport&&this.props.mimeType){const t=Number(e.dataTransfer.getData(this.props.mimeType));if(void 0!==t){let e=this.props.items.length;t<e&&(e-=1),this.props.moveItem&&(this.props.moveItem(t,e),this.loadItemAt(e))}}this.onDragEnd()};onDragEnd=()=>{this.setState({dragIndex:-1,dropIndex:-1,dropPosition:""})};onKeyDown=e=>{const t=i.Z.keyComboFromEvent(e.nativeEvent);if("tab"!==t&&this.props.items&&this.props.items.length>0){let s=!0;const n=this.props.items.length;switch(t){case"up":this.loadItemAt(this.state.selectedIndex<=0?n-1:this.state.selectedIndex-1);break;case"down":this.loadItemAt(this.state.selectedIndex+1>=n?0:this.state.selectedIndex+1);break;case"del":case"backspace":this.removeItem(this.state.selectedIndex);break;case"home":this.loadItemAt(0);break;case"end":this.loadItemAt(n-1);break;case"alt+up":this.moveUp();break;case"alt+down":this.moveDown();break;case"enter":case"space":this.props.onActivate&&(this.props.onActivate(this.state.selectedIndex,e),s=!1);break;default:s=!1}s&&e.preventDefault()}};getButtonClassByIndex=e=>l()({item:!0,"item-is-static":this.props.items[e].isStatic,"item-default":this.props.items[e].isDefault,"item-selected":e===this.state.selectedIndex&&!(this.state.isCreating||this.props.isCreating),"item-dragged":this.state.selectedIndex===e&&this.state.dragIndex===e,dragoverAbove:e===this.state.dropIndex&&"above"===this.state.dropPosition,dragoverBelow:e===this.state.dropIndex&&"below"===this.state.dropPosition});#mn(){const e=this.props.renderCreateListItem?.();return e?(0,p.jsx)("button",{className:"item item-selected",children:e}):null}render(){const{items:e,filter:t,emptyListGraphic:s,emptyListString:n}=this.props,{selectedIndex:i}=this.state,a=this.state.isCreating||this.props.isCreating,r=null!=i&&e[i],l=!!r&&e[i].isDefault,d=0===e.length&&!a,h=e[i]?.isStatic,g=0!==e.length&&e[i-1]?.isStatic,m=e.length<i+1&&e[i+1]?.isStatic;return(0,p.jsxs)("div",{className:"master-detail sortable-list",children:[(0,p.jsxs)("div",{ref:this.refItems,className:"master-items",onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave,onDragOver:this.onDragOver,onDrop:this.onDrop,onKeyDown:this.onKeyDown,tabIndex:d?-1:0,children:[d&&s&&n&&(0,p.jsx)("div",{className:"master-items-empty",dangerouslySetInnerHTML:{__html:`${s}<div>${n}</div>`}}),e.map(((e,s)=>(0,p.jsx)("button",{type:"button",title:e.label,className:this.getButtonClassByIndex(s),tabIndex:-1,draggable:this.props.supportDragAndDrop,onContextMenu:this.props.onContextMenu?this.props.onContextMenu.bind(this,s):null,onDragStart:this.onDragStartButton.bind(this,s),onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave,onDragOver:this.onDragOverButton.bind(this,s),onDrop:this.onDropButton.bind(this,s),onDragEnd:this.onDragEnd,onMouseDown:this.focusItem.bind(this,s),onDoubleClick:this.onDoubleClick.bind(this,s),children:this.props.renderListItem((0,c.CH)(e.name,t),e)},s))),a&&this.#mn()]}),(this.props.optionsList||this.props.onRemove||this.props.moveItem)&&(0,p.jsxs)("div",{className:"master-toolbar",children:[this.props.optionsList&&(0,p.jsx)("select",{className:"button-toolbar sortable-list-options",onChange:this.props.onCreateItem,title:this.props.addTipString,defaultValue:null,children:this.props.optionsList&&this.props.optionsList.map((e=>(0,p.jsxs)("option",{value:e.key,children:[e.value,""!==e.key&&` [${e.key}]`]},e.key)))}),this.props.onCreateItem&&(0,p.jsx)("button",{className:"button-toolbar",style:this.props.optionsList?{pointerEvents:"none"}:null,tabIndex:this.props.optionsList?-1:null,title:this.props.addTipString,onClick:this.setIsCreating,disabled:this.props.onCancelCreate&&a,dangerouslySetInnerHTML:{__html:u.md4.medium}}),this.props.onRemove&&(0,p.jsx)("button",{className:"button-toolbar",title:this.props.deleteTipString,onClick:this.removeItem.bind(this,i),disabled:!a&&e.length<1||l||h||r&&!1===e[i].isRemovable,dangerouslySetInnerHTML:{__html:u.M2k.medium}}),this.props.moveItem&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("button",{className:"button-toolbar button-move-up",title:(0,o.Z)("Move Up ($1)",[this.moveUpCombo]),onClick:this.moveUp,disabled:h||g,dangerouslySetInnerHTML:{__html:u.OCp.medium}}),(0,p.jsx)("button",{className:"button-toolbar button-move-down",title:(0,o.Z)("Move Down ($1)",[this.moveDownCombo]),onClick:this.moveDown,disabled:h||m,dangerouslySetInnerHTML:{__html:u.yaZ.medium}})]})]})]})}}const f=m},72882:(e,t,s)=>{"use strict";s.d(t,{Z:()=>he});var n=s(25795),i=s(19718),a=s(76747),o=s(56371),r=s(26036);const l={actions:function(){return["DOCUMENT_CONTAINER_AV","DOCUMENT_CONTAINER_EXTENSIONS"].concat(i.Z.actions())},options:function(e,t,s){const l=void 0===s,d={...a.Z.commandItem};switch(t.action){case"DOCUMENT_CONTAINER_AV":return d.settingsLabel=(0,o.Z)("[Media Controls]"),d.type="container",{...d,...(0,r.Z)("Media Controls")};case"DOCUMENT_CONTAINER_EXTENSIONS":return d.settingsLabel=(0,o.Z)("[Extensions]"),d.type="container",{...d,...(0,r.Z)("Extensions")};default:return i.Z.actions().includes(t.action)?i.Z.options(e,t,s):n.Z.getMenuItem(e,t,l)}}};const d={actions:function(){return["CONTEXT_OPEN_IN_NEW_TAB","CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB","CONTEXT_OPEN_IN_TAB","CONTEXT_OPEN_IN_NEW_WINDOW","CONTEXT_OPEN_IN_PRIVATE_WINDOW","CONTEXT_CONTAINER_OPEN_IN_WINDOW","CONTEXT_BOOKMARK","CONTEXT_NEW_BOOKMARK","CONTEXT_NEW_FOLDER","CONTEXT_NEW_SEPARATOR","CONTEXT_EDIT","CONTEXT_RENAME","CONTEXT_CUT","CONTEXT_COPY","CONTEXT_PASTE","CONTEXT_DELETE"]},options:function(e,t,s){const i=void 0===s,l={...a.Z.commandItem};switch(t.action){case"CONTEXT_OPEN_IN_NEW_TAB":return{...l,...(0,r.Z)("Open in New Tab")};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{...l,...(0,r.Z)("Open in Background Tab")};case"CONTEXT_OPEN_IN_TAB":return{...l,...(0,r.Z)("Open")};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{...l,...(0,r.Z)("Open in New Window")};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{...l,...(0,r.Z)("Open in Private Window")};case"CONTEXT_CONTAINER_OPEN_IN_WINDOW":return l.settingsLabel=(0,o.Z)("[Open in Another Window]"),l.type="container",{...l,...(0,r.Z)("Open in Another Window")};case"CONTEXT_BOOKMARK":return{...l,...(0,r.Z)("Add Active Tab")};case"CONTEXT_NEW_BOOKMARK":return{...l,...(0,r.Z)("New Bookmark")};case"CONTEXT_NEW_FOLDER":return{...l,...(0,r.Z)("command","New Folder")};case"CONTEXT_NEW_SEPARATOR":return{...l,...(0,r.Z)("New Separator")};case"CONTEXT_EDIT":return{...l,...(0,r.Z)("command","Edit")};case"CONTEXT_RENAME":return{...l,...(0,r.Z)("Rename")};case"CONTEXT_CUT":return{...l,...(0,r.Z)("win_linux","Cut")};case"CONTEXT_COPY":return{...l,...(0,r.Z)("win_linux","Copy")};case"CONTEXT_PASTE":return{...l,...(0,r.Z)("win_linux","Paste")};case"CONTEXT_DELETE":return{...l,...(0,r.Z)("other","Delete")};default:return n.Z.getMenuItem(e,t,i)}}};const c={actions:function(){return["CONTEXT_BOOKMARK","CONTEXT_NEW_BOOKMARK","CONTEXT_NEW_FOLDER","CONTEXT_NEW_SEPARATOR","CONTEXT_PASTE","CONTEXT_CONTAINER_SORT"]},options:function(e,t,s){const i=void 0===s,l={...a.Z.commandItem};switch(t.action){case"CONTEXT_BOOKMARK":return{...l,...(0,r.Z)("Add Active Tab")};case"CONTEXT_NEW_BOOKMARK":return{...l,...(0,r.Z)("New Bookmark")};case"CONTEXT_NEW_FOLDER":return{...l,...(0,r.Z)("command","New Folder")};case"CONTEXT_NEW_SEPARATOR":return{...l,...(0,r.Z)("New Separator")};case"CONTEXT_PASTE":return{...l,...(0,r.Z)("win_linux","Paste")};case"CONTEXT_CONTAINER_SORT":return l.settingsLabel=(0,o.Z)("[Sort Options]"),l.type="container",{...l,...(0,r.Z)("Sort")};default:return n.Z.getMenuItem(e,t,i)}}};const h={actions:function(){return["CONTEXT_OPEN_IN_NEW_TAB","CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB","CONTEXT_OPEN_IN_TAB","CONTEXT_OPEN_IN_NEW_WINDOW","CONTEXT_OPEN_IN_PRIVATE_WINDOW","CONTEXT_CONTAINER_OPEN_IN_WINDOW","CONTEXT_SET_SPEEDDIAL","CONTEXT_UNSET_SPEEDDIAL","CONTEXT_SET_BOOKMARK_BAR","CONTEXT_UNSET_BOOKMARK_BAR","CONTEXT_MOVE_TO_BOOKMARK_BAR","CONTEXT_BOOKMARK","CONTEXT_BOOKMARK_ALL","CONTEXT_NEW_ITEM","CONTEXT_NEW_FOLDER","CONTEXT_NEW_SEPARATOR","CONTEXT_RENAME","CONTEXT_CUT","CONTEXT_COPY","CONTEXT_PASTE","CONTEXT_DELETE","CONTEXT_EXPAND_ALL","CONTEXT_COLLAPSE_ALL","CONTEXT_IMPORT","CONTEXT_SETTINGS","CONTEXT_CONTAINER_SEARCH"]},options:function(e,t,s){const i=void 0===s,l={...a.Z.commandItem};switch(t.action){case"CONTEXT_OPEN_IN_NEW_TAB":return{...l,...(0,r.Z)("Open in New Tab")};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{...l,...(0,r.Z)("Open in Background Tab")};case"CONTEXT_OPEN_IN_TAB":return{...l,...(0,r.Z)("Open")};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{...l,...(0,r.Z)("Open in New Window")};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{...l,...(0,r.Z)("Open in Private Window")};case"CONTEXT_CONTAINER_OPEN_IN_WINDOW":return l.settingsLabel=(0,o.Z)("[Open in Another Window]"),l.type="container",{...l,...(0,r.Z)("Open in Another Window")};case"CONTEXT_SET_SPEEDDIAL":return{...l,...(0,r.Z)("Use as Speed Dial")};case"CONTEXT_UNSET_SPEEDDIAL":return{...l,...(0,r.Z)("Remove from Speed Dial")};case"CONTEXT_SET_BOOKMARK_BAR":return{...l,...(0,r.Z)("Set as Bookmark Bar Folder")};case"CONTEXT_UNSET_BOOKMARK_BAR":return{...l,...(0,r.Z)("Remove as Bookmark Bar Folder")};case"CONTEXT_MOVE_TO_BOOKMARK_BAR":return{...l,...(0,r.Z)("Move to Bookmark Bar Folder")};case"CONTEXT_BOOKMARK":return{...l,...(0,r.Z)("Bookmark Active Page")};case"CONTEXT_BOOKMARK_ALL":return{...l,...(0,r.Z)("Bookmark All Open Pages")};case"CONTEXT_NEW_ITEM":return{...l,...(0,r.Z)("New Bookmark")};case"CONTEXT_NEW_FOLDER":return{...l,...(0,r.Z)("command","New Folder")};case"CONTEXT_NEW_SEPARATOR":return{...l,...(0,r.Z)("New Separator")};case"CONTEXT_RENAME":return{...l,...(0,r.Z)("Rename")};case"CONTEXT_CUT":return{...l,...(0,r.Z)("verb","Cut")};case"CONTEXT_COPY":return{...l,...(0,r.Z)("verb","Copy")};case"CONTEXT_PASTE":return{...l,...(0,r.Z)("verb","Paste")};case"CONTEXT_DELETE":return{...l,...(0,r.Z)("verb","Delete")};case"CONTEXT_EMPTY_TRASH":return{...l,...(0,r.Z)("Empty Trash")};case"CONTEXT_EXPAND_ALL":return{...l,...(0,r.Z)("Expand All Folders")};case"CONTEXT_COLLAPSE_ALL":return{...l,...(0,r.Z)("Collapse All Folders")};case"CONTEXT_IMPORT":return l.ellipsis=!0,{...l,...(0,r.Z)("Import Bookmarks")};case"CONTEXT_SETTINGS":return l.type="folder",{...l,...(0,r.Z)("Settings")};case"CONTEXT_CONTAINER_SEARCH":return l.settingsLabel=(0,o.Z)("[Search Settings]"),l.type="container",{...l,...(0,r.Z)("command","Search")};default:return n.Z.getMenuItem(e,t,i)}}};const u={actions:function(){return["CONTEXT_CONTAINER_CLOSED_TAB"]},options:function(e,t,s){const i=void 0===s,l={...a.Z.commandItem};return"CONTEXT_CONTAINER_CLOSED_TAB"===t.action?(l.settingsLabel=(0,o.Z)("[All Closed Tabs]"),l.type="container",{...l,...(0,r.Z)("Closed Tabs")}):n.Z.getMenuItem(e,t,i)}};const p={actions:function(){return["CONTEXT_COMPOSE_MAIL","CONTEXT_VIEW_ALL_MESSAGES","CONTEXT_NEW_ITEM","CONTEXT_EDIT","CONTEXT_DELETE","CONTEXT_CONTAINER_DEFAULT_ACTION"]},options:function(e,t,s){const i=void 0===s,l={...a.Z.commandItem};switch(t.action){case"CONTEXT_COMPOSE_MAIL":return{...l,...(0,r.Z)("Compose Mail")};case"CONTEXT_VIEW_ALL_MESSAGES":return{...l,...(0,r.Z)("View All Messages")};case"CONTEXT_NEW_ITEM":return{...l,...(0,r.Z)("New Contact")};case"CONTEXT_EDIT":return{...l,...(0,r.Z)("command","Edit")};case"CONTEXT_DELETE":return{...l,...(0,r.Z)("verb","Delete")};case"CONTEXT_CONTAINER_DEFAULT_ACTION":return l.settingsLabel=(0,o.Z)("[Default Action]"),l.type="container",{...l,...(0,r.Z)("Default Action")};default:return n.Z.getMenuItem(e,t,i)}}};var g=s(30992);const m={actions:function(){return["DOCUMENT_SUGGEST_PASSWORD","DOCUMENT_SHOW_PASSWORDS","DOCUMENT_LOOK_UP","DOCUMENT_EMOJI","DOCUMENT_UNDO","DOCUMENT_REDO","DOCUMENT_CUT","DOCUMENT_COPY","DOCUMENT_PASTE","DOCUMENT_PASTE_AS_PLAIN_TEXT","DOCUMENT_SELECT_ALL","DOCUMENT_ADD_AS_SEARCH_ENGINE","COMMAND_COPY_SELECTION_TO_NOTE","COMMAND_APPEND_SELECTION_TO_NOTE","DOCUMENT_GOTO_URL","DOCUMENT_CONTAINER_NOTES","DOCUMENT_SEARCH","DOCUMENT_SEARCH_LAST_USED","DOCUMENT_CONTAINER_SEARCH_WITH","DOCUMENT_CONTAINER_EXTENSIONS","DOCUMENT_CONTAINER_SPELLCHECK","DOCUMENT_CONTAINER_SPELLCHECK_OPTIONS","DOCUMENT_CONTAINER_SPEECH"].concat(i.Z.actions())},options:function(e,t,s){const l=void 0===s,d=s||g.Z.settingsState,c={...a.Z.commandItem};switch(t.action){case"DOCUMENT_SUGGEST_PASSWORD":return c.ellipsis=!0,{...c,...(0,r.Z)("Suggest Password")};case"DOCUMENT_SHOW_PASSWORDS":return c.ellipsis=!0,{...c,...(0,r.Z)("Show all Saved Passwords")};case"DOCUMENT_LOOK_UP":case"DOCUMENT_SEARCH":case"DOCUMENT_SEARCH_LAST_USED":return{...c,...g.Z.getLabelWithParameter(e,t,d.printableselection,l)};case"DOCUMENT_EMOJI":return{...c,...(0,r.Z)("Emoji && Symbols")};case"DOCUMENT_UNDO":return{...c,shortcuts:["ctrl+z"],...(0,r.Z)("win_linux","Undo")};case"DOCUMENT_REDO":return{...c,shortcuts:["ctrl+y"],...(0,r.Z)("win_linux","Redo")};case"DOCUMENT_CUT":return{...c,shortcuts:["ctrl+x"],...(0,r.Z)("win_linux","Cut")};case"DOCUMENT_COPY":return{...c,shortcuts:["ctrl+c"],...(0,r.Z)("win_linux","Copy")};case"DOCUMENT_PASTE":return{...c,shortcuts:["ctrl+v"],...(0,r.Z)("win_linux","Paste")};case"DOCUMENT_PASTE_AS_PLAIN_TEXT":{const t=g.Z.getShortcuts(e,"COMMAND_CLIPBOARD_PASTE_AS_PLAIN_TEXT");return{...c,shortcuts:t,...(0,r.Z)("win_linux","Paste as Plain Text")}}case"DOCUMENT_SELECT_ALL":return{...c,shortcuts:["ctrl+a"],...(0,r.Z)("win_linux","Select All")};case"DOCUMENT_GOTO_URL":return{...c,...g.Z.getLabelWithParameter(e,t,d.selectionurl,l)};case"DOCUMENT_ADD_AS_SEARCH_ENGINE":return c.ellipsis=!0,{...c,...(0,r.Z)("Add as Search Engine")};case"COMMAND_COPY_SELECTION_TO_NOTE":return{...n.Z.getMenuItem(e,t,l),...(0,r.Z)("Copy to Note")};case"COMMAND_APPEND_SELECTION_TO_NOTE":return{...n.Z.getMenuItem(e,t,l),...(0,r.Z)("Append to Note")};case"DOCUMENT_CONTAINER_NOTES":return c.settingsLabel=(0,o.Z)("[All notes]"),c.type="container",{...c,...(0,r.Z)("Insert Note")};case"DOCUMENT_CONTAINER_SEARCH_WITH":return c.settingsLabel=(0,o.Z)("[All search engines]"),c.type="container",{...c,...(0,r.Z)("Search With")};case"DOCUMENT_CONTAINER_EXTENSIONS":return c.settingsLabel=(0,o.Z)("[Extensions]"),c.type="container",{...c,...(0,r.Z)("Extensions")};case"DOCUMENT_CONTAINER_SPELLCHECK":return c.settingsLabel=(0,o.Z)("[Spell Check]"),c.type="container",{...c,...(0,r.Z)("Spell Check")};case"DOCUMENT_CONTAINER_SPELLCHECK_OPTIONS":return c.settingsLabel=(0,o.Z)("[Spell Check Options]"),c.type="container",{...c,...(0,r.Z)("Spell Check Options")};case"DOCUMENT_CONTAINER_WRITING_DIRECTION":return c.settingsLabel=(0,o.Z)("[Writing Direction Options]"),c.type="container",{...c,...(0,r.Z)("Writing Direction")};case"DOCUMENT_CONTAINER_SPEECH":return c.settingsLabel=(0,o.Z)("[Speech Commands]"),c.type="container",{...c,...(0,r.Z)("Speech")};default:return i.Z.actions().includes(t.action)?i.Z.options(e,t,s):n.Z.getMenuItem(e,t,l)}}};const f={actions:function(){return["CONTEXT_OPEN_FILE","CONTEXT_OPEN_IN_NEW_TAB","CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB","CONTEXT_OPEN_IN_TAB","CONTEXT_OPEN_IN_NEW_WINDOW","CONTEXT_OPEN_IN_PRIVATE_WINDOW","CONTEXT_FILEMANAGER","CONTEXT_COPY_ADDRESS","CONTEXT_COPY_PATH","CONTEXT_RESTART","CONTEXT_STOP","CONTEXT_RESUME","CONTEXT_REMOVE","CONTEXT_REMOVE_ALL_FINISHED"]},options:function(e,t,s){const i=void 0===s,o=s||{numAddresses:1,numFiles:1,numImages:1,hasActive:!1,hasPaused:!1,hasCompleted:!1},l={...a.Z.commandItem};switch(t.action){case"CONTEXT_OPEN_FILE":return{...l,...i||o.numFiles<2?(0,r.Z)("the file","Open"):(0,r.Z)("Open Files")};case"CONTEXT_OPEN_IN":return l.type="folder",{...l,...i||o.numFiles<2?(0,r.Z)("Open Image in"):(0,r.Z)("Open Images in")};case"CONTEXT_OPEN_IN_NEW_TAB":return{...l,...(0,r.Z)("open in","New Tab")};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{...l,...(0,r.Z)("Background Tab")};case"CONTEXT_OPEN_IN_TAB":return{...l,...(0,r.Z)("Current Tab")};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{...l,...(0,r.Z)("open in","New Window")};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{...l,...(0,r.Z)("open in","Private Window")};case"CONTEXT_FILEMANAGER":return{...l,...(0,r.Z)("Show in File Manager")};case"CONTEXT_COPY_ADDRESS":return{...l,...i||o.numAddresses<2?(0,r.Z)("Copy Download Address"):(0,r.Z)("Copy Download Addresses")};case"CONTEXT_COPY_PATH":return{...l,...i||o.numFiles<2?(0,r.Z)("Copy Local Path"):(0,r.Z)("Copy Local Paths")};case"CONTEXT_RESTART":return{...l,...(0,r.Z)("command","Restart")};case"CONTEXT_STOP":return{...l,...(0,r.Z)("other","Stop")};case"CONTEXT_RESUME":return{...l,...(0,r.Z)("Resume Download")};case"CONTEXT_REMOVE":return{...l,...(0,r.Z)("verb","Remove")};case"CONTEXT_REMOVE_ALL_FINISHED":return{...l,...(0,r.Z)("Remove All Finished")};default:return n.Z.getMenuItem(e,t,i)}}};const v={actions:function(){return["CONTEXT_OPEN_IN_NEW_TAB","CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB","CONTEXT_OPEN_IN_TAB","CONTEXT_OPEN_IN_NEW_WINDOW","CONTEXT_OPEN_IN_PRIVATE_WINDOW","CONTEXT_CONTAINER_OPEN_IN_WINDOW","CONTEXT_FILTER_BY","CONTEXT_COPY","CONTEXT_SAVE","CONTEXT_DELETE","CONTEXT_EXPAND_ALL","CONTEXT_COLLAPSE_ALL"]},options:function(e,t,s){const i=s||{address:"",selectedCount:0},l=void 0===s,d={...a.Z.commandItem};switch(t.action){case"CONTEXT_OPEN_IN_NEW_TAB":return{...d,...(0,r.Z)("Open in New Tab")};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{...d,...(0,r.Z)("Open in Background Tab")};case"CONTEXT_OPEN_IN_TAB":return{...d,...(0,r.Z)("Open")};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{...d,...(0,r.Z)("Open in New Window")};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{...d,...(0,r.Z)("Open in Private Window")};case"CONTEXT_CONTAINER_OPEN_IN_WINDOW":return d.settingsLabel=(0,o.Z)("[Open in Another Window]"),d.type="container",{...d,...(0,r.Z)("Open in Another Window")};case"CONTEXT_FILTER_BY":return d.settingsLabel=(0,o.Z)("Filter by Address"),{...d,...l?(0,r.Z)("Filter by Address"):(0,r.Z)("Filter by “$1”",[i.address])};case"CONTEXT_COPY":return{...d,...(0,r.Z)("Copy Address")};case"CONTEXT_SAVE":return{...d,...(0,r.Z)("Save as Bookmark","Save as Bookmarks",[i.selectedCount])};case"CONTEXT_DELETE":return{...d,...(0,r.Z)("verb","Delete")};case"CONTEXT_EXPAND_ALL":return{...d,...(0,r.Z)("Expand All Folders")};case"CONTEXT_COLLAPSE_ALL":return{...d,...(0,r.Z)("Collapse All Folders")};default:return n.Z.getMenuItem(e,t,l)}}};const b={actions:function(){return["DOCUMENT_OPEN_IMAGE_IN_NEW_TAB","DOCUMENT_OPEN_IMAGE_IN_NEW_BACKGROUND_TAB","DOCUMENT_OPEN_IMAGE_IN_TAB","DOCUMENT_OPEN_IMAGE_IN_NEW_WINDOW","DOCUMENT_OPEN_IMAGE_IN_PRIVATE_WINDOW","DOCUMENT_SAVE_IMAGE","DOCUMENT_COPY_IMAGE","DOCUMENT_COPY_IMAGE_ADDRESS","DOCUMENT_SHOW_IMAGE_PROPERTIES","DOCUMENT_USE_IMAGE_AS_STARTPAGE_BACKGROUND","DOCUMENT_RELOAD_IMAGE","DOCUMENT_SEARCH_FOR IMAGE","DOCUMENT_CONTAINER_SEND_TO_DEVICES","DOCUMENT_CONTAINER_OPEN_IMAGE_IN_PROFILE","DOCUMENT_CONTAINER_TEXT_SELECTION","DOCUMENT_CONTAINER_EXTENSIONS"].concat(i.Z.actions())},options:function(e,t,s){const l=void 0===s,d={...a.Z.commandItem};switch(t.action){case"DOCUMENT_OPEN_IMAGE_IN_NEW_TAB":return{...d,...(0,r.Z)("Open Image in New Tab")};case"DOCUMENT_OPEN_IMAGE_IN_NEW_BACKGROUND_TAB":return{...d,...(0,r.Z)("Open Image in Background Tab")};case"DOCUMENT_OPEN_IMAGE_IN_TAB":return{...d,...(0,r.Z)("Open Image")};case"DOCUMENT_OPEN_IMAGE_IN_NEW_WINDOW":return{...d,...(0,r.Z)("Open Image in New Window")};case"DOCUMENT_OPEN_IMAGE_IN_PRIVATE_WINDOW":return{...d,...(0,r.Z)("Open Image in Private Window")};case"DOCUMENT_CONTAINER_OPEN_IMAGE_IN_PROFILE":return d.settingsLabel=(0,o.Z)("[Open Image in Another Profile]"),d.type="container",{...d,...(0,r.Z)("Open Image in Another Profile")};case"DOCUMENT_SAVE_IMAGE":return d.ellipsis=!0,{...d,...(0,r.Z)("Save Image As")};case"DOCUMENT_COPY_IMAGE":return{...d,...(0,r.Z)("Copy Image")};case"DOCUMENT_COPY_IMAGE_ADDRESS":return{...d,...(0,r.Z)("Copy Image Address")};case"DOCUMENT_SHOW_IMAGE_PROPERTIES":return d.ellipsis=!0,{...d,...(0,r.Z)("Image Properties")};case"DOCUMENT_USE_IMAGE_AS_STARTPAGE_BACKGROUND":return{...d,...(0,r.Z)("Use Image as Window Background")};case"DOCUMENT_RELOAD_IMAGE":return{...d,...(0,r.Z)("Reload Image")};case"DOCUMENT_QR_CODE":return{...d,...(0,r.Z)("command","Create QR Code for This Image")};case"DOCUMENT_SEARCH_FOR IMAGE":return{...d,...(0,r.Z)("Search for Image")};case"DOCUMENT_CONTAINER_SEND_TO_DEVICES":return d.settingsLabel=(0,o.Z)("[Send Image to Your Devices]"),d.type="container",{...d,...(0,r.Z)("Send Image to Your Devices")};case"DOCUMENT_CONTAINER_TEXT_SELECTION":return d.settingsLabel=(0,o.Z)("[Selected Text]"),d.type="container",{...d,...(0,r.Z)("Selected Text")};case"DOCUMENT_CONTAINER_EXTENSIONS":return d.settingsLabel=(0,o.Z)("[Extensions]"),d.type="container",{...d,...(0,r.Z)("Extensions")};default:return i.Z.actions().includes(t.action)?i.Z.options(e,t,s):n.Z.getMenuItem(e,t,l)}}};var C=s(15800),w=s(15489);const y={actions:function(){return["DOCUMENT_LOOK_UP","DOCUMENT_COPY","DOCUMENT_CONTAINER_LINK_TO_HIGHLIGHT","COMMAND_COPY_SELECTION_TO_NOTE","COMMAND_APPEND_SELECTION_TO_NOTE","COMMAND_TRANSLATE_SELECTION","DOCUMENT_PRINT","DOCUMENT_GOTO_URL","DOCUMENT_SEARCH","DOCUMENT_SEARCH_LAST_USED","DOCUMENT_CONTAINER_SEARCH_WITH","DOCUMENT_CONTAINER_EXTENSIONS","DOCUMENT_SEND_BY_MAIL","DOCUMENT_ADD_EVENT_TO_CALENDAR","DOCUMENT_ADD_INVITE_TO_CALENDAR","DOCUMENT_ADD_TASK_TO_CALENDAR","DOCUMENT_CONTAINER_SPEECH"].concat(i.Z.actions())},options:function(e,t,s){const l=void 0===s,d=s||g.Z.settingsState,c={...a.Z.commandItem},h=void 0!==C.ZP.getDefaultCalendar(),u=w.ZP.isIncognito(e);switch(t.action){case"DOCUMENT_LOOK_UP":case"DOCUMENT_SEARCH":case"DOCUMENT_SEARCH_LAST_USED":return{...c,...g.Z.getLabelWithParameter(e,t,d.printableselection,l)};case"DOCUMENT_COPY":return{...c,...(0,r.Z)("command","Copy")};case"DOCUMENT_CONTAINER_LINK_TO_HIGHLIGHT":return c.settingsLabel=(0,o.Z)("[Link to Highlight]"),c.type="container",{...c,...(0,r.Z)("Link to Highlight")};case"COMMAND_COPY_SELECTION_TO_NOTE":return{...n.Z.getMenuItem(e,t,l),...(0,r.Z)("Copy to Note")};case"COMMAND_APPEND_SELECTION_TO_NOTE":return{...n.Z.getMenuItem(e,t,l),...(0,r.Z)("Append to Note")};case"COMMAND_TRANSLATE_SELECTION":return{...n.Z.getMenuItem(e,t,l),...(0,r.Z)("Translate Selection")};case"DOCUMENT_PRINT":return c.ellipsis=!0,{...c,...(0,r.Z)("command","Print")};case"DOCUMENT_GOTO_URL":return{...c,...g.Z.getLabelWithParameter(e,t,d.selectionurl,l)};case"DOCUMENT_CONTAINER_SEARCH_WITH":return c.settingsLabel=(0,o.Z)("[All search engines]"),c.type="container",{...c,...(0,r.Z)("Search With")};case"DOCUMENT_CONTAINER_EXTENSIONS":return c.settingsLabel=(0,o.Z)("[Extensions]"),c.type="container",{...c,...(0,r.Z)("Extensions")};case"DOCUMENT_SEND_BY_MAIL":return{...c,...(0,r.Z)("Send by Mail")};case"DOCUMENT_ADD_TO_CALENDAR":return{isVisible:()=>h&&!u,...c,...(0,r.Z)("Add to Calendar")};case"DOCUMENT_ADD_EVENT_TO_CALENDAR":return c.ellipsis=!0,{isVisible:()=>h&&!u,...c,...(0,r.Z)("Event")};case"DOCUMENT_ADD_INVITE_TO_CALENDAR":return c.ellipsis=!0,{isVisible:()=>h&&!u,...c,...(0,r.Z)("Invite")};case"DOCUMENT_ADD_TASK_TO_CALENDAR":return c.ellipsis=!0,{isVisible:()=>h&&!u,...c,...(0,r.Z)("Task")};case"DOCUMENT_CONTAINER_SPEECH":return c.settingsLabel=(0,o.Z)("[Speech Commands]"),c.type="container",{...c,...(0,r.Z)("Speech")};default:return i.Z.actions().includes(t.action)?i.Z.options(e,t,s):n.Z.getMenuItem(e,t,l)}}};const x={actions:function(){const e=["DOCUMENT_CONTAINER_EXTENSIONS","DOCUMENT_CONTAINER_DEVELOPER_TOOLS"].concat(i.Z.actions());return["DOCUMENT_OPEN_IN_NEW_TAB","DOCUMENT_OPEN_IN_NEW_BACKGROUND_TAB","DOCUMENT_OPEN_IN_TAB","DOCUMENT_OPEN_IN_NEW_WINDOW","DOCUMENT_OPEN_IN_PRIVATE_WINDOW","DOCUMENT_ADD_LINK_TO_BOOKMARKS","DOCUMENT_ADD_LINK_TO_WEBPANEL","DOCUMENT_ADD_LINK_TO_READING_LIST","DOCUMENT_SAVE_LINK","DOCUMENT_SEND_LINK_BY_MAIL","DOCUMENT_COPY_LINK_ADDRESS","DOCUMENT_COPY_LINK_TEXT","DOCUMENT_CONTAINER_OPEN_IN_PWA","DOCUMENT_CONTAINER_OPEN_IN_PROFILE","DOCUMENT_CONTAINER_SEND_TO_DEVICES","DOCUMENT_CONTAINER_EXTENSIONS","DOCUMENT_CONTAINER_LINK_SELECTION","DOCUMENT_CONTAINER_LINKED_IMAGE","DOCUMENT_CONTAINER_OPEN_IN_WINDOW"].concat(y.actions().filter((t=>!e.includes(t)))).concat(b.actions().filter((t=>!e.includes(t)))).concat(l.actions().filter((t=>!e.includes(t)))).concat(i.Z.actions())},options:function(e,t,s){const d=void 0===s,c=s||g.Z.settingsState,h={...a.Z.commandItem};switch(t.action){case"DOCUMENT_OPEN_IN_NEW_TAB":return{...h,...(0,r.Z)("Open Link in New Tab")};case"DOCUMENT_OPEN_IN_NEW_BACKGROUND_TAB":return{...h,...(0,r.Z)("Open Link in Background Tab")};case"DOCUMENT_OPEN_IN_TAB":return{...h,...(0,r.Z)("Open Link")};case"DOCUMENT_OPEN_IN_NEW_WINDOW":return{...h,...(0,r.Z)("Open Link in New Window")};case"DOCUMENT_OPEN_IN_PRIVATE_WINDOW":return{...h,...(0,r.Z)("Open Link in Private Window")};case"DOCUMENT_CONTAINER_OPEN_IN_PWA":return h.settingsLabel=(0,o.Z)("[Open Link in Progressive Web Apps]"),h.type="container",{...h,...(0,r.Z)("Open Link in Progressive Web Apps")};case"DOCUMENT_CONTAINER_OPEN_IN_PROFILE":return h.settingsLabel=(0,o.Z)("[Open Link in Another Profile]"),h.type="container",{...h,...(0,r.Z)("Open Link in Another Profile")};case"DOCUMENT_CONTAINER_OPEN_IN_WINDOW":return h.settingsLabel=(0,o.Z)("[Open Link in Another Window]"),h.type="container",{...h,...(0,r.Z)("Open Link in Another Window")};case"DOCUMENT_CONTAINER_OPEN_IN_WORKSPACE":return h.settingsLabel=(0,o.Z)("[Open Link in Another Workspace]"),h.type="container",{...h,...(0,r.Z)("Open Link in Another Workspace")};case"DOCUMENT_ADD_LINK_TO_BOOKMARKS":return{...h,...(0,r.Z)("Bookmark Link")};case"DOCUMENT_ADD_LINK_TO_WEBPANEL":return{...h,...(0,r.Z)("Add Link to Web Panel")};case"DOCUMENT_ADD_LINK_TO_READING_LIST":return{...h,...(0,r.Z)("Add Link to Reading List")};case"DOCUMENT_SEND_LINK_BY_MAIL":return{...h,...(0,r.Z)("Send Link by Mail")};case"DOCUMENT_SAVE_LINK":return h.ellipsis=!0,{...h,...(0,r.Z)("Save Link As")};case"DOCUMENT_COPY_LINK_ADDRESS":return{...h,...!d&&c.ismailto?(0,r.Z)("Copy Email Address"):(0,r.Z)("Copy Link Address")};case"DOCUMENT_COPY_LINK_TEXT":return{...h,...(0,r.Z)("Copy Link Text")};case"DOCUMENT_CONTAINER_SEND_TO_DEVICES":return h.settingsLabel=(0,o.Z)("[Send Link to Your Devices]"),h.type="container",{...h,...(0,r.Z)("Send Link to Your Devices")};case"DOCUMENT_CONTAINER_EXTENSIONS":return h.settingsLabel=(0,o.Z)("[Extensions]"),h.type="container",{...h,...(0,r.Z)("Extensions")};case"DOCUMENT_CONTAINER_LINK_SELECTION":return h.settingsLabel=(0,o.Z)("[Selection menu]"),h.type="container",{...h,...(0,r.Z)("Text Selection")};case"DOCUMENT_CONTAINER_LINKED_IMAGE":return h.settingsLabel=(0,o.Z)("[Image menu]"),h.type="container",{...h,...(0,r.Z)("Image")};default:return i.Z.actions().includes(t.action)?i.Z.options(e,t,s):y.actions().includes(t.action)?y.options(e,t,s):b.actions().includes(t.action)?b.options(e,t,s):l.actions().includes(t.action)?l.options(e,t,s):n.Z.getMenuItem(e,t,d)}}};const I={actions:function(){return["CONTEXT_OPEN_IN_NEW_TAB","CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB","CONTEXT_MAIL_REPLY","CONTEXT_MAIL_REPLY_ALL","CONTEXT_MAIL_REPLY_LIST","CONTEXT_MAIL_FORWARD","CONTEXT_MAIL_MARK_READ","CONTEXT_MAIL_MARK_UNREAD","CONTEXT_MAIL_MARK_JUNK","CONTEXT_ADD_CALENDAR_ITEM","CONTEXT_ADD_CALENDAR_EVENT","CONTEXT_ADD_CALENDAR_TASK","CONTEXT_ADD_CALENDAR_EVENT_WITH_INVITE"]},options:function(e,t,s){const i=void 0===s,o={...a.Z.commandItem};switch(t.action){case"CONTEXT_OPEN_IN_NEW_TAB":return{...o,...(0,r.Z)("Open in New Tab")};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{...o,...(0,r.Z)("Open in Background Tab")};case"CONTEXT_MAIL_REPLY":return{...o,...(0,r.Z)("Reply to Message")};case"CONTEXT_MAIL_REPLY_ALL":return{...o,...(0,r.Z)("Reply All")};case"CONTEXT_MAIL_REPLY_LIST":return{...o,...(0,r.Z)("Reply List")};case"CONTEXT_MAIL_FORWARD":return{...o,...(0,r.Z)("Forward Message")};case"CONTEXT_MAIL_MARK_READ":return{...o,...(0,r.Z)("Mark Message as Read")};case"CONTEXT_MAIL_MARK_JUNK":return{...o,...(0,r.Z)("Mark Message as Spam")};case"CONTEXT_MAIL_MARK_UNREAD":return{...o,...(0,r.Z)("Mark Message as Unread")};case"CONTEXT_ADD_CALENDAR_ITEM":return{...o,...(0,r.Z)("Add to Calendar")};case"CONTEXT_ADD_CALENDAR_EVENT":return o.ellipsis=!0,{...o,...(0,r.Z)("Event")};case"CONTEXT_ADD_CALENDAR_EVENT_WITH_INVITE":return o.ellipsis=!0,{...o,...(0,r.Z)("Invite")};case"CONTEXT_ADD_CALENDAR_TASK":return o.ellipsis=!0,{...o,...(0,r.Z)("Task")};default:return n.Z.getMenuItem(e,t,i)}}};const A={actions:function(){return["DOCUMENT_MAIL_BACK","DOCUMENT_MAIL_FORWARD","COMMAND_SAVE_PAGE","COMMAND_ADD_CALENDAR_ITEM","COMMAND_ADD_CALENDAR_EVENT","COMMAND_ADD_CALENDAR_EVENT_WITH_INVITE","COMMAND_ADD_CALENDAR_TASK","DOCUMENT_PRINT","COMMAND_TAB_VIEW_PAGE_SOURCE","COMMAND_MAIL_SHOW_PLAINTEXT","DOCUMENT_CONTAINER_DEVELOPER_TOOLS","DOCUMENT_INSPECT"]},options:function(e,t,s){const o=void 0===s,l={...a.Z.commandItem};switch(t.action){case"COMMAND_PAGE_BACK":return{...n.Z.getMenuItem(e,t,o),...(0,r.Z)("navigation","Back")};case"COMMAND_PAGE_FORWARD":return{...n.Z.getMenuItem(e,t,o),...(0,r.Z)("navigation","Forward")};case"COMMAND_SAVE_PAGE":return l.ellipsis=!0,{...l,...n.Z.getMenuItem(e,t,o),...(0,r.Z)("command","Save As")};case"DOCUMENT_PRINT":{const t=g.Z.getShortcuts(e,"COMMAND_PRINT_PAGE");return l.ellipsis=!0,{...l,shortcuts:t,...(0,r.Z)("command","Print")}}case"COMMAND_ADD_CALENDAR_ITEM":return{...l,...n.Z.getMenuItem(e,t,o),...(0,r.Z)("Add to Calendar")};case"COMMAND_ADD_CALENDAR_EVENT":return l.ellipsis=!0,{...l,...n.Z.getMenuItem(e,t,o),...(0,r.Z)("Event")};case"COMMAND_ADD_CALENDAR_EVENT_WITH_INVITE":return l.ellipsis=!0,{...l,...n.Z.getMenuItem(e,t,o),...(0,r.Z)("Invite")};case"COMMAND_ADD_CALENDAR_TASK":return l.ellipsis=!0,{...l,...n.Z.getMenuItem(e,t,o),...(0,r.Z)("Task")};case"COMMAND_TAB_VIEW_PAGE_SOURCE":return l.type="checkbox",{...l,...n.Z.getMenuItem(e,t,o),...(0,r.Z)("Show Raw Message")};case"DOCUMENT_INSPECT":return{...l,shortcuts:[],...(0,r.Z)("Inspect")};default:return i.Z.actions().includes(t.action)?i.Z.options(e,t,s):n.Z.getMenuItem(e,t,o)}}};const S={actions:function(){return["CONTEXT_BACK","CONTEXT_FORWARD","CONTEXT_COPY","CONTEXT_SENDER_IS_MAILING_LIST","COMMAND_TAB_VIEW_PAGE_SOURCE","COMMAND_MAIL_SHOW_PLAINTEXT"]},options:function(e,t,s){const i=void 0===s,o={...a.Z.commandItem};switch(t.action){case"COMMAND_PAGE_BACK":return{...n.Z.getMenuItem(e,t,i),...(0,r.Z)("navigation","Back")};case"COMMAND_PAGE_FORWARD":return{...n.Z.getMenuItem(e,t,i),...(0,r.Z)("navigation","Forward")};case"CONTEXT_COPY":return{...o,...(0,r.Z)("win_linux","Copy")};case"CONTEXT_SENDER_IS_MAILING_LIST":return o.type="checkbox",{...o,...(0,r.Z)("Treat Sender as a Mailing List")};case"COMMAND_TAB_VIEW_PAGE_SOURCE":return{...o,...n.Z.getMenuItem(e,t,i),...(0,r.Z)("Show Raw Message")};default:return n.Z.getMenuItem(e,t,i)}}};const Z={actions:function(){return["CONTEXT_VIEW_ALL_MESSAGES","CONTEXT_RERUN_FILTER","CONTEXT_MARK_ALL_AS_READ","CONTEXT_MOVE_ALL_TO_TRASH","CONTEXT_EMPTY_TRASH","CONTEXT_CHECK_FOR_MAIL","CONTEXT_SEND","CONTEXT_RESCAN_UNREAD","CONTEXT_IMPORT_MAIL_FILES","CONTEXT_SUBSCRIBE","CONTEXT_UNSUBSCRIBE","CONTEXT_RERUN_THREADING","CONTEXT_MOVE_INTO_IMPORTANT","CONTEXT_MOVE_INTO_OTHER","CONTEXT_DELETE","CONTEXT_DELETE_ALL","CONTEXT_RENAME","CONTEXT_REGENERATE","CONTEXT_ADVANCED","CONTEXT_CREATE_LABEL","CONTEXT_ADD_NEW_ACCOUNT","CONTEXT_RESYNC_FOLDER","CONTEXT_RESYNC_ACCOUNT","CONTEXT_RECONNECT_ACCOUNT"]},options:function(e,t,s){const i=void 0===s,o={...a.Z.commandItem};switch(t.action){case"CONTEXT_VIEW_ALL_MESSAGES":return{...o,...(0,r.Z)("View All Messages")};case"CONTEXT_RERUN_FILTER":return{...o,...(0,r.Z)("Rerun Filter for Folder")};case"CONTEXT_MARK_ALL_AS_READ":return{...o,...(0,r.Z)("Mark All as Read")};case"CONTEXT_MOVE_ALL_TO_TRASH":return{...o,...(0,r.Z)("mail","Move All to Trash")};case"CONTEXT_EMPTY_TRASH":return{...o,...(0,r.Z)("mail","Empty Trash")};case"CONTEXT_CHECK_FOR_MAIL":return{...o,...(0,r.Z)("Check for Mail")};case"CONTEXT_CREATE_FOLDER":return{...o,...(0,r.Z)("Create Folder")};case"CONTEXT_DELETE_FOLDER":return{...o,...(0,r.Z)("Delete Folder")};case"CONTEXT_CREATE_FEED_FOLDER":return{...o,...(0,r.Z)("Feeds","New Folder")};case"CONTEXT_DELETE_FEED_FOLDER":return{...o,...(0,r.Z)("Delete Feed Folder")};case"CONTEXT_SEND":return{...o,...(0,r.Z)("Send")};case"CONTEXT_RESCAN_UNREAD":return{...o,...(0,r.Z)("Rescan Unread Flags")};case"CONTEXT_IMPORT_MAIL_FILES":return{...o,...(0,r.Z)("Import Mail Files...")};case"CONTEXT_SUBSCRIBE":return{...o,...(0,r.Z)("Subscribe")};case"CONTEXT_UNSUBSCRIBE":return{...o,...(0,r.Z)("Unsubscribe")};case"CONTEXT_RERUN_THREADING":return{...o,...(0,r.Z)("Rerun Threading")};case"CONTEXT_MOVE_INTO_IMPORTANT":return{...o,...(0,r.Z)("Move into Important")};case"CONTEXT_MOVE_INTO_OTHER":return{...o,...(0,r.Z)("Move into Other")};case"CONTEXT_DELETE_ALL":return{...o,...(0,r.Z)("Delete all")};case"CONTEXT_REGENERATE":return{...o,...(0,r.Z)("Regenerate")};case"CONTEXT_DELETE":return{...o,...(0,r.Z)("verb","Delete")};case"CONTEXT_RENAME":return{...o,...(0,r.Z)("Rename")};case"CONTEXT_FILTER_EDIT":return{...o,...(0,r.Z)("mail filters","Edit")};case"CONTEXT_CREATE_LABEL":return{...o,...(0,r.Z)("Create Label")};case"CONTEXT_ADD_NEW_ACCOUNT":return{...o,...(0,r.Z)("Add Account")};case"CONTEXT_ADVANCED":return o.type="folder",{...o,...(0,r.Z)("Advanced")};case"CONTEXT_TOGGLE_MAIL_VIEWS":return o.type="folder",{...o,...(0,r.Z)("mail","Views")};case"CONTEXT_MAIL_FOLDER":return o.type="container",{...o,...(0,r.Z)("Mail Folder")};case"CONTEXT_RESYNC_FOLDER":return{...o,...(0,r.Z)("Re-sync folder with server")};case"CONTEXT_RESYNC_ACCOUNT":return{...o,...(0,r.Z)("Re-sync account with server")};case"CONTEXT_RECONNECT_ACCOUNT":return{...o,...(0,r.Z)("Reconnect to server (forced)")};default:return n.Z.getMenuItem(e,t,i)}}};const T={actions:function(){return["COMMAND_MAIL_REPLY","COMMAND_MAIL_REPLY_ALL","COMMAND_MAIL_REPLY_LIST","COMMAND_MAIL_FORWARD","COMMAND_MAIL_MARK_READ","COMMAND_MAIL_MARK_UNREAD","COMMAND_MAIL_MARK_JUNK","COMMAND_MAIL_MARK_NOT_JUNK","COMMAND_MAIL_MOVE_TO_ARCHIVE","COMMAND_MAIL_RESTORE_FROM_ARCHIVE","COMMAND_MAIL_GOTO_NEXT_UNREAD","COMMAND_MAIL_GOTO_PREVIOUS_UNREAD","COMMAND_MAIL_MARK_READ_AND_GOTO_NEXT_UNREAD","CONTEXT_CONTAINER_MOVE","CONTEXT_ADD_FLAG","CONTEXT_REMOVE_FLAG","CONTEXT_CONTAINER_FLAGS","CONTEXT_CONTAINER_LABELS","COMMAND_MAIL_LABEL_FLAG","CONTEXT_EDIT","CONTEXT_SEND","CONTEXT_RECEIVER","CONTEXT_CONTAINER_TRASH","COMMAND_MAIL_ENABLE_THREADED_VIEW","COMMAND_MAIL_MARK_THREAD_READ","COMMAND_MAIL_MARK_THREAD_UNREAD","COMMAND_MAIL_ENABLE_SENDER_VIEW","COMMAND_ADD_CALENDAR_ITEM","COMMAND_ADD_CALENDAR_EVENT","COMMAND_ADD_CALENDAR_TASK","COMMAND_ADD_CALENDAR_EVENT_WITH_INVITE","CONTEXT_SENDER_IS_MAILING_LIST","CONTEXT_EXPAND_ALL","CONTEXT_COLLAPSE_ALL","COMMAND_MAIL_COMPOSE_NEW_MESSAGE"]},options:function(e,t,s){const i=void 0===s,l={...a.Z.commandItem};switch(t.action){case"CONTEXT_GOTO":return l.type="folder",{...l,...(0,r.Z)("Go to")};case"CONTEXT_CONTAINER_MOVE":return l.settingsLabel=(0,o.Z)("[Move to Folders]"),l.type="container",{...l,...(0,r.Z)("Move")};case"CONTEXT_ADD_FLAG":return{...l,...(0,r.Z)("Add Flag")};case"CONTEXT_REMOVE_FLAG":return{...l,...(0,r.Z)("Remove Flag")};case"CONTEXT_CONTAINER_FLAGS":return l.settingsLabel=(0,o.Z)("[All Flags]"),l.type="container",{...l,...(0,r.Z)("Flags")};case"CONTEXT_CONTAINER_LABELS":return l.settingsLabel=(0,o.Z)("[All Labels]"),l.type="container",{...l,...(0,r.Z)("Labels")};case"CONTEXT_EDIT":return{...l,...(0,r.Z)("mail","Edit")};case"COMMAND_MAIL_MOVE_TO_ARCHIVE":return{...l,...(0,r.Z)("mail","Move Message to Archive")};case"COMMAND_MAIL_RESTORE_FROM_ARCHIVE":return{...l,...(0,r.Z)("mail","Restore Message from Archive")};case"COMMAND_ADD_CALENDAR_ITEM":return{...l,...n.Z.getMenuItem(e,t,i),...(0,r.Z)("Add to Calendar")};case"COMMAND_ADD_CALENDAR_EVENT":return l.ellipsis=!0,{...l,...n.Z.getMenuItem(e,t,i),...(0,r.Z)("Event")};case"COMMAND_ADD_CALENDAR_EVENT_WITH_INVITE":return l.ellipsis=!0,{...l,...n.Z.getMenuItem(e,t,i),...(0,r.Z)("Invite")};case"COMMAND_ADD_CALENDAR_TASK":return l.ellipsis=!0,{...l,...n.Z.getMenuItem(e,t,i),...(0,r.Z)("Task")};case"CONTEXT_SEND":return{...l,...(0,r.Z)("Send")};case"CONTEXT_CONTAINER_TRASH":return l.settingsLabel=(0,o.Z)("[Trash elements]"),l.type="container",{...l,...(0,r.Z)("Trash")};case"CONTEXT_RECEIVER":return{...l,...(0,r.Z)("Show Messages for Receiver")};case"CONTEXT_THREAD":return l.type="folder",{...l,...(0,r.Z)("Thread")};case"CONTEXT_SENDER":return l.type="folder",{...l,...(0,r.Z)("Sender")};case"CONTEXT_SENDER_IS_MAILING_LIST":return l.type="checkbox",{...l,...(0,r.Z)("Treat Sender as a Mailing List")};case"CONTEXT_EXPAND_ALL":return{...l,...(0,r.Z)("Expand All Threads")};case"CONTEXT_COLLAPSE_ALL":return{...l,...(0,r.Z)("Collapse All Threads")};default:return n.Z.getMenuItem(e,t,i)}}};const E={actions:function(){return["CONTEXT_CONTAINER_CUSTOMIZE_TOOLBAR","CONTEXT_CONTAINER_BACKWARD_HISTORY","CONTEXT_CONTAINER_FORWARD_HISTORY"]},options:function(e,t,s){const i=void 0===s,l={...a.Z.commandItem};switch(t.action){case"CONTEXT_CONTAINER_CUSTOMIZE_TOOLBAR":return l.settingsLabel=(0,o.Z)("[Customize]"),l.type="container",{...l,...(0,r.Z)("Customize")};case"CONTEXT_CONTAINER_BACKWARD_HISTORY":return l.settingsLabel=(0,o.Z)("[Backward History]"),l.type="container",{...l,...(0,r.Z)("Backward History")};case"CONTEXT_CONTAINER_FORWARD_HISTORY":return l.settingsLabel=(0,o.Z)("[Forward History]"),l.type="container",{...l,...(0,r.Z)("Forward History")};default:return n.Z.getMenuItem(e,t,i)}}};const k={actions:function(){return["CONTEXT_CONTAINER_OPEN_IN_WINDOW","CONTEXT_OPEN_ADDRESS","CONTEXT_NEW_FROM_SELECTION","CONTEXT_NEW_ITEM","CONTEXT_NEW_FOLDER","CONTEXT_NEW_SEPARATOR","CONTEXT_EDIT","CONTEXT_RENAME","CONTEXT_CUT","CONTEXT_COPY","CONTEXT_PASTE","CONTEXT_DELETE","CONTEXT_EMPTY_TRASH","CONTEXT_EXPAND_ALL","CONTEXT_COLLAPSE_ALL","CONTEXT_SETTINGS","CONTEXT_CONTAINER_SEARCH"]},options:function(e,t,s){const i=s||{inManager:!1},l=void 0===s,d={...a.Z.commandItem};switch(t.action){case"CONTEXT_OPEN_IN_NEW_TAB":return{...d,...(0,r.Z)("Open in New Tab")};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{...d,...(0,r.Z)("Open in Background Tab")};case"CONTEXT_OPEN_IN_TAB":return{...d,...(0,r.Z)("Open")};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{...d,...(0,r.Z)("Open in New Window")};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{...d,...(0,r.Z)("Open in Private Window")};case"CONTEXT_CONTAINER_OPEN_IN_WINDOW":return d.settingsLabel=(0,o.Z)("[Open in Another Window]"),d.type="container",{...d,...(0,r.Z)("Open in Another Window")};case"CONTEXT_SET_SPEEDDIAL":return{...d,...(0,r.Z)("Use as Speed Dial")};case"CONTEXT_UNSET_SPEEDDIAL":return{...d,...(0,r.Z)("Remove from Speed Dial")};case"CONTEXT_SET_BOOKMARK_BAR":return{...d,...(0,r.Z)("Set as Bookmark Bar Folder")};case"CONTEXT_UNSET_BOOKMARK_BAR":return{...d,...(0,r.Z)("Remove as Bookmark Bar Folder")};case"CONTEXT_MOVE_TO_BOOKMARK_BAR":return{...d,...(0,r.Z)("Move to Bookmark Bar Folder")};case"CONTEXT_BOOKMARK":return{...d,...(0,r.Z)("Bookmark Active Page")};case"CONTEXT_BOOKMARK_ALL":return{...d,...(0,r.Z)("Bookmark All Open Pages")};case"CONTEXT_OPEN_ADDRESS":return{...d,...(0,r.Z)("Open Note Address")};case"CONTEXT_NEW_FROM_SELECTION":return{...d,...(0,r.Z)("Copy Selection to New Note")};case"CONTEXT_NEW_ITEM":return{...d,...(0,r.Z)("New Note")};case"CONTEXT_NEW_FOLDER":return{...d,...(0,r.Z)("command","New Folder")};case"CONTEXT_NEW_SEPARATOR":return{...d,...(0,r.Z)("New Separator")};case"CONTEXT_EDIT":return l?{...d,...(0,r.Z)("command","Edit")}:{...d,...i.inManager?(0,r.Z)("Edit in New Tab"):(0,r.Z)("Edit in Notes Manager")};case"CONTEXT_RENAME":return{...d,...(0,r.Z)("Rename")};case"CONTEXT_CUT":return{...d,...(0,r.Z)("verb","Cut")};case"CONTEXT_COPY":return{...d,...(0,r.Z)("verb","Copy")};case"CONTEXT_PASTE":return{...d,...(0,r.Z)("verb","Paste")};case"CONTEXT_DELETE":return{...d,...(0,r.Z)("verb","Delete")};case"CONTEXT_EMPTY_TRASH":return{...d,...(0,r.Z)("Empty Trash")};case"CONTEXT_EXPAND_ALL":return{...d,...(0,r.Z)("Expand All Folders")};case"CONTEXT_COLLAPSE_ALL":return{...d,...(0,r.Z)("Collapse All Folders")};case"CONTEXT_SETTINGS":return d.type="folder",{...d,...(0,r.Z)("Settings")};case"CONTEXT_CONTAINER_SEARCH":return d.settingsLabel=(0,o.Z)("[Search Settings]"),d.type="container",{...d,...(0,r.Z)("command","Search")};default:return n.Z.getMenuItem(e,t,l)}}};const N={actions:function(){return["DOCUMENT_BACK","DOCUMENT_FORWARD","DOCUMENT_RELOAD","COMMAND_ADD_BOOKMARK","DOCUMENT_ADD_TO_WEBPANEL","DOCUMENT_SEND_BY_MAIL","DOCUMENT_SAVE","DOCUMENT_PRINT","DOCUMENT_CAST","DOCUMENT_COPY_ADDRESS","DOCUMENT_CONTAINER_LINK_TO_HIGHLIGHT","DOCUMENT_CONTAINER_SEND_TO_DEVICES","DOCUMENT_CONTAINER_EXTENSIONS","DOCUMENT_QR_CODE","DOCUMENT_CONTAINER_PLUGIN_ROTATION"].concat(i.Z.actions())},options:function(e,t,s){const l=void 0===s,d=s||g.Z.settingsState,c={...a.Z.commandItem};switch(t.action){case"DOCUMENT_BACK":{const t=d.iswebpanel?[]:g.Z.getShortcuts(e,"COMMAND_PAGE_BACK");return{...c,shortcuts:t,...(0,r.Z)("navigation","Back")}}case"DOCUMENT_FORWARD":{const t=d.iswebpanel?[]:g.Z.getShortcuts(e,"COMMAND_PAGE_FORWARD");return{...c,shortcuts:t,...(0,r.Z)("navigation","Forward")}}case"DOCUMENT_RELOAD":{const t=d.iswebpanel?[]:g.Z.getShortcuts(e,"COMMAND_PAGE_REFRESH");return{...c,shortcuts:t,...(0,r.Z)("navigation","Reload")}}case"COMMAND_ADD_BOOKMARK":return{...n.Z.getMenuItem(e,t,l),...c,...(0,r.Z)("command","Bookmark Page")};case"DOCUMENT_ADD_TO_WEBPANEL":return{...c,...(0,r.Z)("Add Page to Web Panel")};case"DOCUMENT_SEND_BY_MAIL":return{...c,...(0,r.Z)("Send by Mail")};case"DOCUMENT_SAVE":{const t=d.iswebpanel?[]:g.Z.getShortcuts(e,"COMMAND_SAVE_PAGE");return c.ellipsis=!0,{...c,shortcuts:t,...(0,r.Z)("Save As")}}case"DOCUMENT_PRINT":{const t=d.iswebpanel?[]:g.Z.getShortcuts(e,"COMMAND_PRINT_PAGE");return c.ellipsis=!0,{...c,shortcuts:t,...(0,r.Z)("command","Print")}}case"DOCUMENT_CAST":return c.ellipsis=!0,{...c,...(0,r.Z)("Cast")};case"DOCUMENT_COPY_ADDRESS":return{...c,...d.iswebpanel?(0,r.Z)("Copy Panel Address"):(0,r.Z)("Copy Page Address")};case"DOCUMENT_CONTAINER_LINK_TO_HIGHLIGHT":return c.settingsLabel=(0,o.Z)("[Link to Highlight]"),c.type="container",{...c,...(0,r.Z)("Link to Highlight")};case"DOCUMENT_CONTAINER_SEND_TO_DEVICES":return c.settingsLabel=(0,o.Z)("[Send to Your Devices]"),c.type="container",{...c,...(0,r.Z)("Send to Your Devices")};case"DOCUMENT_QR_CODE":{const t=d.iswebpanel?[]:g.Z.getShortcuts(e,"COMMAND_PAGE_QR_CODE");return{...c,shortcuts:t,...(0,r.Z)("command","Create QR Code for This Page")}}case"DOCUMENT_CONTAINER_EXTENSIONS":return c.settingsLabel=(0,o.Z)("[Extensions]"),c.type="container",{...c,...(0,r.Z)("Extensions")};case"DOCUMENT_CONTAINER_PLUGIN_ROTATION":return c.settingsLabel=(0,o.Z)("[Plugin Rotation Commands]"),c.type="container",{...c,...(0,r.Z)("Plugin Rotation")};default:return i.Z.actions().includes(t.action)?i.Z.options(e,t,s):n.Z.getMenuItem(e,t,l)}}};const _={actions:function(){return["CONTEXT_OPEN_IN_NEW_TAB","CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB","CONTEXT_OPEN_IN_TAB","CONTEXT_OPEN_IN_NEW_WINDOW","CONTEXT_OPEN_IN_PRIVATE_WINDOW","CONTEXT_COPY_ADDRESS","CONTEXT_DESKTOP_VERSION","CONTEXT_MOBILE_VERSION","CONTEXT_SEPARATE_WIDTH","CONTEXT_CONTAINER_TOOLBAR","CONTEXT_CONTAINER_PERIODIC_TIMER","CONTEXT_CONTAINER_FLOATING","CONTEXT_MUTE_PANEL","CONTAINER_CLOSED_WEBPANEL"]},options:function(e,t,s){const i=void 0===s,l={...a.Z.commandItem};switch(t.action){case"CONTEXT_CONTAINER_PERIODIC_TIMER":return l.settingsLabel=(0,o.Z)("[Periodic Reload]"),l.type="container",{...l,...(0,r.Z)("Periodic Reload")};case"CONTEXT_MENU_OPEN":return l.type="folder",{...l,...(0,r.Z)("Open in")};case"CONTEXT_OPEN_IN_NEW_TAB":return{...l,...(0,r.Z)("open in","New Tab")};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{...l,...(0,r.Z)("Background Tab")};case"CONTEXT_OPEN_IN_TAB":return{...l,...(0,r.Z)("Current Tab")};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{...l,...(0,r.Z)("open in","New Window")};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{...l,...(0,r.Z)("open in","Private Window")};case"CONTEXT_COPY_ADDRESS":return{...l,...(0,r.Z)("Copy Panel Address")};case"CONTEXT_DESKTOP_VERSION":return{...l,...(0,r.Z)("Show Desktop Version")};case"CONTEXT_MOBILE_VERSION":return{...l,...(0,r.Z)("Show Mobile Version")};case"CONTEXT_CONTAINER_FLOATING":return l.settingsLabel=(0,o.Z)("[Separate Floating]"),l.type="container",{...l,...(0,r.Z)("Floating Panel")};case"CONTEXT_MUTE_PANEL":return{...l,...(0,r.Z)("Mute Panel")};case"CONTEXT_SEPARATE_WIDTH":return l.type="checkbox",{...l,...(0,r.Z)("Separate Width")};case"CONTEXT_CONTAINER_TOOLBAR":return l.settingsLabel=(0,o.Z)("[Toolbar]"),l.type="container",{...l,...(0,r.Z)("Navigation Controls")};default:return n.Z.getMenuItem(e,t,i)}}};const P={actions:function(){return["CONTAINER_CLOSED_WEBPANEL"]},options:function(e,t,s){const i=void 0===s;return t.action,n.Z.getMenuItem(e,t,i)}};const M={actions:function(){return["CONTEXT_OPEN","CONTEXT_MARK_READ","CONTEXT_MARK_UNREAD","CONTEXT_COPY","CONTEXT_DELETE"]},options:function(e,t,s){const i=void 0===s,o={...a.Z.commandItem};switch(t.action){case"CONTEXT_OPEN":return{...o,...(0,r.Z)("verb","Open")};case"CONTEXT_MARK_READ":return{...o,...(0,r.Z)("verb","Mark as Read")};case"CONTEXT_MARK_UNREAD":return{...o,...(0,r.Z)("Mark as Unread")};case"CONTEXT_COPY_URL":return{...o,...(0,r.Z)("verb","Copy Address")};case"CONTEXT_DELETE":return{...o,...(0,r.Z)("verb","Remove")};default:return n.Z.getMenuItem(e,t,i)}}};const D={actions:function(){return["CONTEXT_OPEN_SESSION_IN_NEW_WINDOW","CONTEXT_OPEN_SESSION","CONTEXT_OPEN_IN_NEW_TAB","CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB","CONTEXT_OPEN_IN_TAB","CONTEXT_OPEN_IN_NEW_WINDOW","CONTEXT_OPEN_IN_PRIVATE_WINDOW","CONTEXT_QUARANTINE","CONTEXT_PIN","CONTEXT_UNPIN","CONTEXT_NEW_STACK","CONTEXT_REMOVE_STACK","CONTEXT_NEW_WINDOW","CONTEXT_NEW_WORKSPACE","CONTEXT_COPY","CONTEXT_RENAME","CONTEXT_DELETE","CONTEXT_DELETE_WITHOUT_QUARANTINE","CONTEXT_EXPAND_ALL","CONTEXT_COLLAPSE_ALL"]},options:function(e,t,s){const i=void 0===s,o={...a.Z.commandItem};switch(t.action){case"CONTEXT_OPEN_SESSION_IN_NEW_WINDOW":return{...o,...(0,r.Z)("Open")};case"CONTEXT_OPEN_SESSION":return{...o,...(0,r.Z)("Open in Current Window")};case"CONTEXT_OPEN_LINK_MENU":return{...o,...(0,r.Z)("Open Link")};case"CONTEXT_OPEN_IN_NEW_TAB":return{...o,...(0,r.Z)("Open Link in New Tab")};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{...o,...(0,r.Z)("Open Link in Background Tab")};case"CONTEXT_OPEN_IN_TAB":return{...o,...(0,r.Z)("Open Link in Active Tab")};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{...o,...(0,r.Z)("Open Link in New Window")};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{...o,...(0,r.Z)("Open Link in Private Window")};case"CONTEXT_QUARANTINE":return o.type="checkbox",{...o,...(0,r.Z)("Excluded")};case"CONTEXT_DELETE_WITHOUT_QUARANTINE":return{...o,...(0,r.Z)("Delete Now")};case"CONTEXT_PIN":return{...o,...(0,r.Z)("Pin")};case"CONTEXT_UNPIN":return{...o,...(0,r.Z)("Unpin")};case"CONTEXT_NEW_STACK":return{...o,...(0,r.Z)("Stack Tabs")};case"CONTEXT_REMOVE_STACK":return{...o,...(0,r.Z)("Unstack Tabs")};case"CONTEXT_NEW_WINDOW":return{...o,...(0,r.Z)("command","New Window")};case"CONTEXT_NEW_WORKSPACE":return{...o,...(0,r.Z)("command","New Workspace")};case"CONTEXT_COPY":return{...o,...(0,r.Z)("Copy Link")};case"CONTEXT_RENAME":return{...o,...(0,r.Z)("Rename")};case"CONTEXT_DELETE":return{...o,...(0,r.Z)("verb","Delete")};case"CONTEXT_EXPAND_ALL":return{...o,...(0,r.Z)("Expand All Folders")};case"CONTEXT_COLLAPSE_ALL":return{...o,...(0,r.Z)("Collapse All Folders")};default:return n.Z.getMenuItem(e,t,i)}}};const O={actions:function(){return["CONTEXT_OPEN_IN_NEW_WINDOW","CONTEXT_OPEN","CONTEXT_NEW_ITEM","CONTEXT_RENAME","CONTEXT_EDIT","CONTEXT_UPDATE","CONTEXT_DELETE","CONTEXT_RESTORE","CONTEXT_EMPTY_TRASH","CONTEXT_MOVE_TO_TOP","CONTEXT_DUPLICATE","CONTEXT_AUTOMATIC_BACKUP","CONTEXT_HISTORY"]},options:function(e,t,s){const i=void 0===s,o={...a.Z.commandItem};switch(t.action){case"CONTEXT_OPEN_IN_NEW_WINDOW":return{...o,...(0,r.Z)("Open")};case"CONTEXT_OPEN":return{...o,...(0,r.Z)("Open in Current Window")};case"CONTEXT_RENAME":return{...o,...(0,r.Z)("Rename")};case"CONTEXT_NEW_ITEM":return o.ellipsis=!0,{...o,...(0,r.Z)("sessions","New")};case"CONTEXT_EDIT":return{...o,...(0,r.Z)("command","Edit / View Contents")};case"CONTEXT_UPDATE":return o.ellipsis=!0,{...o,...(0,r.Z)("Save New Version")};case"CONTEXT_DELETE":return{...o,...(0,r.Z)("verb","Delete")};case"CONTEXT_RESTORE":return{...o,...(0,r.Z)("Restore")};case"CONTEXT_EMPTY_TRASH":return{...o,...(0,r.Z)("Empty Trash")};case"CONTEXT_MOVE_TO_TOP":return{...o,...(0,r.Z)("Move to Top")};case"CONTEXT_DUPLICATE":return{...o,...(0,r.Z)("Duplicate as New Session")};case"CONTEXT_AUTOMATIC_BACKUP":return o.ellipsis=!0,o.type="checkbox",{...o,...(0,r.Z)("verb","Automatic Session Backup")};case"CONTEXT_AUTOSAVE_SIZE":return{...o,...a.Z.makeLabelPair("")};case"CONTEXT_HISTORY":return o.type="checkbox",{...o,...(0,r.Z)("Show History")};default:return n.Z.getMenuItem(e,t,i)}}};const j={actions:function(){return["CONTEXT_OPEN_ALL","CONTEXT_EDIT","CONTEXT_RENAME","CONTEXT_DELETE"]},options:function(e,t,s){const i=void 0===s,o={...a.Z.commandItem};switch(t.action){case"CONTEXT_OPEN_ALL":return{...o,...(0,r.Z)("Open All Bookmarks")};case"CONTEXT_EDIT":return{...o,...(0,r.Z)("verb","Edit")};case"CONTEXT_DELETE":return{...o,...(0,r.Z)("verb","Delete")};default:return n.Z.getMenuItem(e,t,i)}}};const L={actions:function(){return["CONTEXT_OPEN_IN_NEW_TAB","CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB","CONTEXT_OPEN_IN_TAB","CONTEXT_OPEN_IN_NEW_WINDOW","CONTEXT_OPEN_IN_PRIVATE_WINDOW","CONTEXT_CONTAINER_OPEN_IN_WINDOW","CONTEXT_COPY","CONTEXT_DELETE"]},options:function(e,t,s){const i=void 0===s,l={...a.Z.commandItem};switch(t.action){case"CONTEXT_OPEN_IN_NEW_TAB":return{...l,...(0,r.Z)("Open in New Tab")};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{...l,...(0,r.Z)("Open in Background Tab")};case"CONTEXT_OPEN_IN_TAB":return{...l,...(0,r.Z)("Open")};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{...l,...(0,r.Z)("Open in New Window")};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{...l,...(0,r.Z)("Open in Private Window")};case"CONTEXT_CONTAINER_OPEN_IN_WINDOW":return l.settingsLabel=(0,o.Z)("[Open in Another Window]"),l.type="container",{...l,...(0,r.Z)("Open in Another Window")};case"CONTEXT_COPY":return{...l,...(0,r.Z)("win_linux","Copy")};case"CONTEXT_DELETE":return{...l,...(0,r.Z)("verb","Delete")};default:return n.Z.getMenuItem(e,t,i)}}};const R={actions:function(){return["CONTEXT_OPEN_IN_NEW_TAB","CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB","CONTEXT_OPEN_IN_TAB","CONTEXT_OPEN_IN_NEW_WINDOW","CONTEXT_OPEN_IN_PRIVATE_WINDOW","CONTEXT_CONTAINER_OPEN_IN_WINDOW","CONTEXT_OPEN_ALL","CONTEXT_SET_THUMBNAIL","CONTEXT_CLEAR_THUMBNAIL","CONTEXT_RELOAD","CONTEXT_EDIT","CONTEXT_RENAME","CONTEXT_CUT","CONTEXT_COPY","CONTEXT_PASTE","CONTEXT_DELETE","COMMAND_TOGGLE_STARTPAGE_NAVIGATION"]},options:function(e,t,s){const i=void 0===s,l={...a.Z.commandItem};switch(t.action){case"CONTEXT_OPEN_IN_NEW_TAB":return{...l,...(0,r.Z)("Open in New Tab")};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{...l,...(0,r.Z)("Open in Background Tab")};case"CONTEXT_OPEN_IN_TAB":return{...l,...(0,r.Z)("Open")};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{...l,...(0,r.Z)("Open in New Window")};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{...l,...(0,r.Z)("Open in Private Window")};case"CONTEXT_CONTAINER_OPEN_IN_WINDOW":return l.settingsLabel=(0,o.Z)("[Open in Another Window]"),l.type="container",{...l,...(0,r.Z)("Open in Another Window")};case"CONTEXT_OPEN_ALL":return{...l,...(0,r.Z)("Open All Bookmarks")};case"CONTEXT_SET_THUMBNAIL":return l.ellipsis=!0,{...l,...(0,r.Z)("Select Custom Thumbnail")};case"CONTEXT_CLEAR_THUMBNAIL":return{...l,...(0,r.Z)("Clear Custom Thumbnail")};case"CONTEXT_RELOAD":return{...l,...(0,r.Z)("Reload")};case"CONTEXT_EDIT":return{...l,...(0,r.Z)("command","Edit")};case"CONTEXT_RENAME":return{...l,...(0,r.Z)("Rename")};case"CONTEXT_CUT":return{...l,...(0,r.Z)("win_linux","Cut")};case"CONTEXT_COPY":return{...l,...(0,r.Z)("win_linux","Copy")};case"CONTEXT_PASTE":return{...l,...(0,r.Z)("win_linux","Paste")};case"CONTEXT_DELETE":return{...l,...(0,r.Z)("other","Delete")};default:return n.Z.getMenuItem(e,t,i)}}};const B={actions:function(){return["CONTEXT_SET_AS_DEFAULT","CONTEXT_RENAME","CONTEXT_REMOVE","COMMAND_TOGGLE_STARTPAGE_NAVIGATION"]},options:function(e,t,s){const i=void 0===s,o={...a.Z.commandItem};switch(t.action){case"CONTEXT_SET_AS_DEFAULT":return{...o,...(0,r.Z)("Startpage","Set as Default")};case"CONTEXT_RENAME":return{...o,...(0,r.Z)("Rename")};case"CONTEXT_REMOVE":return{...o,...(0,r.Z)("Remove from Speed Dial")};default:return n.Z.getMenuItem(e,t,i)}}};const F={actions:function(){return["CONTEXT_ADD_BOOKMARK_TO_SPEEDDIAL","CONTEXT_ADD_FOLDER_TO_SPEEDDIAL","CONTEXT_PASTE","CONTEXT_CUSTOMIZE","COMMAND_TOGGLE_STARTPAGE_NAVIGATION","CONTEXT_UNDO","CONTEXT_REDO"]},options:function(e,t,s){const i=void 0===s,o={...a.Z.commandItem};switch(t.action){case"CONTEXT_ADD_BOOKMARK_TO_SPEEDDIAL":return{...o,...(0,r.Z)("command","Add Bookmark to Speed Dial")};case"CONTEXT_ADD_FOLDER_TO_SPEEDDIAL":return{...o,...(0,r.Z)("command","Add Speed Dial Group")};case"CONTEXT_PASTE":return{...o,...(0,r.Z)("win_linux","Paste")};case"CONTEXT_CUSTOMIZE":return o.ellipsis=!0,{...o,...(0,r.Z)("other","Customize")};case"CONTEXT_UNDO":return{...o,...(0,r.Z)("command","Undo")};case"CONTEXT_REDO":return{...o,...(0,r.Z)("command","Redo")};default:return n.Z.getMenuItem(e,t,i)}}};const W={actions:function(){return["CONTEXT_NEW","CONTEXT_TOGGLE_SUBSTRIP_LOCK","CONTEXT_BOOKMARK_ALL","CONTEXT_SAVE_SESSION","CONTEXT_REOPEN"]},options:function(e,t,s){const i=void 0===s,o={...a.Z.commandItem};switch(t.action){case"CONTEXT_LOCK_SUBSTRIP":case"CONTEXT_UNLOCK_SUBSTRIP":return{...o,isVisible:()=>!1};case"CONTEXT_NEW":return{...o,...(0,r.Z)("command","New Tab")};case"CONTEXT_TOGGLE_SUBSTRIP_LOCK":return{...o,...(0,r.Z)("Lock Second Tab Row")};case"CONTEXT_BOOKMARK_ALL":return{...o,...(0,r.Z)("Bookmark All Tabs")};case"CONTEXT_SAVE_SESSION":return n.Z.getMenuItem(e,{...t,action:"COMMAND_SAVE_SESSION"},i);case"CONTEXT_REOPEN":return n.Z.getMenuItem(e,{...t,action:"COMMAND_TAB_REOPEN_RECENTLY_CLOSED"},i);default:return n.Z.getMenuItem(e,t,i)}}};const U={actions:function(){return["CONTEXT_CONTAINER_TAB_OVERFLOW"]},options:function(e,t,s){const i=void 0===s,o={...a.Z.commandItem};return"CONTEXT_CONTAINER_TAB_OVERFLOW"===t.action?{...o,...(0,r.Z)("Open Tab")}:n.Z.getMenuItem(e,t,i)}};const V={actions:function(){return["CONTEXT_CLOSE","CONTEXT_TABSTACK_REMOVE_FROM"]},options:function(e,t,s){const i=void 0===s,o={...a.Z.commandItem};switch(t.action){case"CONTEXT_CLOSE":return{...o,...(0,r.Z)("Close Tab")};case"CONTEXT_TABSTACK_REMOVE_FROM":return{...o,...(0,r.Z)("Remove from Tab Stack")};default:return n.Z.getMenuItem(e,t,i)}}};const H={actions:function(){return["CONTEXT_NEW","CONTEXT_RELOAD","CONTEXT_CLONE","CONTEXT_PIN","CONTEXT_PIN_STACK","CONTEXT_UNPIN","CONTEXT_UNPIN_STACK","CONTEXT_MUTE","CONTEXT_MUTE_OTHER","CONTEXT_OPTIMIZE_FS_VIDEOS","CONTEXT_BOOKMARK","CONTEXT_BOOKMARK_STACK","CONTEXT_BOOKMARK_ALL","CONTEXT_COPY_LINK","CONTEXT_COPY_LINKS","CONTEXT_SAVE_SESSION","CONTEXT_TABSTACK_BY_SELECTION","CONTEXT_TABSTACK_BY_HOST","CONTEXT_TABSTACK_RENAME","CONTEXT_TABSTACK_RELOAD","CONTEXT_TABSTACK_REMOVE_FROM","CONTEXT_TABSTACK_UNGROUP","CONTEXT_TILE_TABSTACK","CONTEXT_UNTILE_TABSTACK","CONTEXT_TILE_TABS","CONTEXT_UNTILE_TAB","CONTEXT_UNTILE_TILE_GROUP","CONTEXT_UNTILE_SELECTION","CONTEXT_HIBERNATE_TAB","CONTEXT_HIBERNATE_SELECTED_BACKGROUND_TABS","CONTEXT_HIBERNATE_TABSTACK","CONTEXT_HIBERNATE_BACKGROUND","CONTEXT_CLOSE","CONTEXT_CLOSE_TABSTACK","CONTEXT_CLOSE_OTHER","CONTEXT_CLOSE_LEFT","CONTEXT_CLOSE_RIGHT","CONTEXT_REOPEN","CONTEXT_CUSTOMIZE","CONTEXT_CONTAINER_PWA","CONTEXT_CONTAINER_SEND_TO_DEVICES","CONTEXT_CONTAINER_MOVE_TO_WINDOW","CONTEXT_CONTAINER_MOVE_TO_WORKSPACE","CONTEXT_MOVE","CONTEXT_TABSTACK_MOVE","CONTEXT_MOVE_LEFT","CONTEXT_MOVE_RIGHT","CONTEXT_CONTAINER_PERIODIC_TIMER","CONTEXT_TABSTACK_BY_HOSTS","CONTEXT_MOVE_STACK_LEFT","CONTEXT_MOVE_STACK_RIGHT"]},options:function(e,t,s){const i=s||{isMultiSelect:!1,count:-1,closableCount:-1,unSelectedCount:0,unpinned:0,pinned:0,playing:0,hostname:"",hostnameCount:-1,canHibernateCount:-1,horizontal:!0,someIncognito:!1,canCloneCount:-1,isStack:!1},l=void 0===s,d={...a.Z.commandItem};switch(t.action){case"CONTEXT_NEW":return{...d,...(0,r.Z)("command","New Tab")};case"CONTEXT_RELOAD":return{...d,...i.isMultiSelect?(0,r.Z)("Reload $1 Tab","Reload $1 Tabs",[i.count]):(0,r.Z)("Reload Tab")};case"CONTEXT_CLONE":return{...d,...i.isMultiSelect?(0,r.Z)("Duplicate $1 Tab","Duplicate $1 Tabs",[i.canCloneCount]):(0,r.Z)("Duplicate Tab")};case"CONTEXT_PIN_STACK":return{...d,...(0,r.Z)("Pin Tab Stack")};case"CONTEXT_PIN":return{...d,...i.isMultiSelect?(0,r.Z)("Pin $1 Tab","Pin $1 Tabs",[i.unpinned]):(0,r.Z)("Pin Tab")};case"CONTEXT_UNPIN":return{...d,...i.isMultiSelect?(0,r.Z)("Unpin $1 Tab","Unpin $1 Tabs",[i.pinned]):(0,r.Z)("Unpin Tab")};case"CONTEXT_UNPIN_STACK":return{...d,...(0,r.Z)("Unpin Tab Stack")};case"CONTEXT_CONTAINER_PERIODIC_TIMER":return d.settingsLabel=(0,o.Z)("[Periodic Reload]"),d.type="container",{...d,...(0,r.Z)("Periodic Reload")};case"CONTEXT_MUTE":return d.type="checkbox",{...d,...i.isMultiSelect?(0,r.Z)("Mute $1 Tab","Mute $1 Tabs",[i.playing]):(0,r.Z)("Mute Tab")};case"CONTEXT_MUTE_OTHER":return{...d,...(0,r.Z)("Mute Other Tabs")};case"CONTEXT_OPTIMIZE_FS_VIDEOS":return{...d,...(0,r.Z)("Optimize fullscreen videos")};case"CONTEXT_BOOKMARK":return{...d,...i.isMultiSelect?(0,r.Z)("Bookmark $1 Tab","Bookmark $1 Tabs",[i.count]):(0,r.Z)("Bookmark Tab")};case"CONTEXT_BOOKMARK_STACK":return{...d,...(0,r.Z)("Bookmark Tab Stack")};case"CONTEXT_BOOKMARK_ALL":return{...d,...(0,r.Z)("Bookmark All Tabs")};case"CONTEXT_COPY_LINK":return{...d,...(0,r.Z)("Copy Link")};case"CONTEXT_COPY_LINKS":return{...d,...(0,r.Z)("Copy Links")};case"CONTEXT_SAVE_SESSION":return{...d,...i.count>0?(0,r.Z)("Save $1 Selected Tab as Session","Save $1 Selected Tabs as Session",[i.count]):(0,r.Z)("Save All Tabs as Session")};case"CONTEXT_TABSTACK_BY_SELECTION":return{...d,...l?(0,r.Z)("Stack Selected Tabs"):(0,r.Z)("Stack $1 Selected Tab","Stack $1 Selected Tabs",[i.count])};case"CONTEXT_TABSTACK_BY_HOST":return{...d,...l?(0,r.Z)("Stack Tabs by Host"):(0,r.Z)("Stack Tabs by Host ($1 of $2)",[i.hostnameCount,i.hostname])};case"CONTEXT_TABSTACK_BY_HOSTS":return{...d,...(0,r.Z)("Stack Tabs by Hosts")};case"CONTEXT_TABSTACK_RELOAD":return{...d,...(0,r.Z)("Reload Tab Stack")};case"CONTEXT_TABSTACK_RENAME":return{...d,...l?(0,r.Z)("Rename"):i.isStack?(0,r.Z)("Rename Tab Stack"):(0,r.Z)("Rename")};case"CONTEXT_TABSTACK_REMOVE_FROM":return{...d,...(0,r.Z)("Remove from Tab Stack")};case"CONTEXT_TABSTACK_UNGROUP":return{...d,...(0,r.Z)("Unstack Tabs")};case"CONTEXT_TILE_TABSTACK":return{...d,...(0,r.Z)("Tile Tab Stack")};case"CONTEXT_UNTILE_TABSTACK":return{...d,...(0,r.Z)("Untile Tab Stack")};case"CONTEXT_TILE_TABS":return{...d,...l?(0,r.Z)("Tile Tabs"):(0,r.Z)("Tile $1 Tab","Tile $1 Tabs",[i.count])};case"CONTEXT_UNTILE_TAB":return{...d,...(0,r.Z)("Untile Tab")};case"CONTEXT_UNTILE_TILE_GROUP":return{...d,...(0,r.Z)("Untile All Tabs in Set")};case"CONTEXT_UNTILE_SELECTION":return{...d,...(0,r.Z)("Untile Selection")};case"CONTEXT_HIBERNATE_TAB":return{...d,...(0,r.Z)("Hibernate Tab")};case"CONTEXT_HIBERNATE_SELECTED_BACKGROUND_TABS":return{...d,...l?(0,r.Z)("Hibernate Selected Background Tabs"):(0,r.Z)("Hibernate $1 Background Tab","Hibernate $1 Background Tabs",[i.canHibernateCount])};case"CONTEXT_HIBERNATE_TABSTACK":return{...d,...(0,r.Z)("Hibernate Tab Stack")};case"CONTEXT_HIBERNATE_BACKGROUND":return{...d,...(0,r.Z)("Hibernate Background Tabs")};case"CONTEXT_CLOSE":return{...d,...i.isMultiSelect?(0,r.Z)("Close $1 Tab","Close $1 Tabs",[i.closableCount]):(0,r.Z)("Close Tab")};case"CONTEXT_CLOSE_TABSTACK":return{...d,...(0,r.Z)("Close Tab Stack")};case"CONTEXT_CLOSE_OTHER":return{...d,...i.isMultiSelect&&i.unSelectedCount>0?(0,r.Z)("Close Other ($1 Unselected Tab)","Close Other ($1 Unselected Tabs)",[i.unSelectedCount]):(0,r.Z)("Close Other Tabs")};case"CONTEXT_CLOSE_LEFT":return{...d,...i.horizontal?(0,r.Z)("Close Tabs to the Left"):(0,r.Z)("Close the Tabs Above")};case"CONTEXT_CLOSE_RIGHT":return{...d,...i.horizontal?(0,r.Z)("Close Tabs to the Right"):(0,r.Z)("Close the Tabs Below")};case"CONTEXT_REOPEN":return n.Z.getMenuItem(e,{...t,action:"COMMAND_TAB_REOPEN_RECENTLY_CLOSED"},l);case"CONTEXT_CUSTOMIZE":return d.ellipsis=!0,{...d,...(0,r.Z)("panel","Customize")};case"CONTEXT_CONTAINER_PWA":return d.settingsLabel=(0,o.Z)("[All Progressive Web Apps]"),d.type="container",{...d,...(0,r.Z)("Progressive Web Apps")};case"CONTEXT_CONTAINER_SEND_TO_DEVICES":return d.settingsLabel=(0,o.Z)("[Send to Your Devices]"),d.type="container",{...d,...(0,r.Z)("Send to Your Devices")};case"CONTEXT_CONTAINER_MOVE_TO_WINDOW":return d.settingsLabel=(0,o.Z)("[All Window Destinations]"),d.type="container",{...d,...(0,r.Z)("Window Destinations")};case"CONTEXT_CONTAINER_MOVE_TO_WORKSPACE":return d.settingsLabel=(0,o.Z)("[All Workspace Destinations]"),d.type="container",{...d,...(0,r.Z)("context","Workspace")};case"CONTEXT_MOVE":return d.type="folder",{...d,...i.isMultiSelect&&!i.someIncognito?(0,r.Z)("Move $1 Tab","Move $1 Tabs",[i.count]):(0,r.Z)("Move Tab")};case"CONTEXT_TABSTACK_MOVE":return d.type="folder",{...d,...(0,r.Z)("Move Tab Stack")};case"CONTEXT_MOVE_LEFT":case"CONTEXT_MOVE_STACK_LEFT":return{...d,...i.horizontal?(0,r.Z)("navigation","Left"):(0,r.Z)("Up")};case"CONTEXT_MOVE_RIGHT":case"CONTEXT_MOVE_STACK_RIGHT":return{...d,...i.horizontal?(0,r.Z)("navigation","Right"):(0,r.Z)("Down")};default:return n.Z.getMenuItem(e,t,l)}}};const G={actions:function(){return["CONTEXT_OPEN_IN_NEW_TAB","CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB","CONTEXT_OPEN_IN_TAB","CONTEXT_OPEN_IN_NEW_WINDOW","CONTEXT_OPEN_IN_PRIVATE_WINDOW","CONTEXT_CONTAINER_OPEN_IN_WINDOW","CONTEXT_COPY"]},options:function(e,t,s){const i=void 0===s,l={...a.Z.commandItem};switch(t.action){case"CONTEXT_OPEN_IN_NEW_TAB":return{...l,...(0,r.Z)("Open in New Tab")};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{...l,...(0,r.Z)("Open in Background Tab")};case"CONTEXT_OPEN_IN_TAB":return{...l,...(0,r.Z)("Open")};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{...l,...(0,r.Z)("Open in New Window")};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{...l,...(0,r.Z)("Open in Private Window")};case"CONTEXT_CONTAINER_OPEN_IN_WINDOW":return l.settingsLabel=(0,o.Z)("[Open in Another Window]"),l.type="container",{...l,...(0,r.Z)("Open in Another Window")};case"CONTEXT_COPY":return{...l,...(0,r.Z)("win_linux","Copy URL")};default:return n.Z.getMenuItem(e,t,i)}}};const K={actions:function(){return["CONTEXT_OPEN_IN_NEW_TAB","CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB","CONTEXT_OPEN_IN_TAB","CONTEXT_OPEN_IN_NEW_WINDOW","CONTEXT_OPEN_IN_PRIVATE_WINDOW","CONTEXT_CONTAINER_OPEN_IN_WINDOW","CONTEXT_COPY","CONTEXT_DELETE","CONTEXT_HIDE_SUGGESTIONS"]},options:function(e,t,s){const i=void 0===s,l={...a.Z.commandItem};switch(t.action){case"CONTEXT_OPEN_IN_NEW_TAB":return{...l,...(0,r.Z)("Open in New Tab")};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{...l,...(0,r.Z)("Open in Background Tab")};case"CONTEXT_OPEN_IN_TAB":return{...l,...(0,r.Z)("Open")};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{...l,...(0,r.Z)("Open in New Window")};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{...l,...(0,r.Z)("Open in Private Window")};case"CONTEXT_CONTAINER_OPEN_IN_WINDOW":return l.settingsLabel=(0,o.Z)("[Open in Another Window]"),l.type="container",{...l,...(0,r.Z)("Open in Another Window")};case"CONTEXT_COPY":return{...l,...(0,r.Z)("win_linux","Copy")};case"CONTEXT_DELETE":return{...l,...(0,r.Z)("Delete from History")};case"CONTEXT_HIDE_SUGGESTIONS":return{...l,...(0,r.Z)("Hide Suggested Items")};default:return n.Z.getMenuItem(e,t,i)}}};const z={actions:function(){return["CONTEXT_COPY","CONTEXT_DELETE"]},options:function(e,t,s){const i=void 0===s,o={...a.Z.commandItem};switch(t.action){case"CONTEXT_COPY":return{...o,...(0,r.Z)("verb","Copy")};case"CONTEXT_COPY_ALL":return{...o,...(0,r.Z)("Copy Both")};case"CONTEXT_DELETE":return{...o,...(0,r.Z)("verb","Delete")};default:return n.Z.getMenuItem(e,t,i)}}};const $={actions:function(){return["DOCUMENT_LOOK_UP","DOCUMENT_EMOJI","DOCUMENT_UNDO","DOCUMENT_REDO","DOCUMENT_CUT","DOCUMENT_COPY","DOCUMENT_PASTE","DOCUMENT_PASTE_AS_PLAIN_TEXT","DOCUMENT_SELECT_ALL","DOCUMENT_CONTAINER_NOTES","DOCUMENT_CONTAINER_SPELLCHECK","DOCUMENT_CONTAINER_SPELLCHECK_OPTIONS","DOCUMENT_CONTAINER_SPEECH"]},options:function(e,t,s){const i=void 0===s,l={...a.Z.commandItem},d=s||g.Z.settingsState;switch(t.action){case"DOCUMENT_LOOK_UP":return{...l,...g.Z.getLabelWithParameter(e,t,d.printableselection,i)};case"DOCUMENT_EMOJI":return{...l,...(0,r.Z)("Emoji && Symbols")};case"DOCUMENT_UNDO":return{...l,shortcuts:["ctrl+z"],...(0,r.Z)("win_linux","Undo")};case"DOCUMENT_REDO":return{...l,shortcuts:["ctrl+y"],...(0,r.Z)("win_linux","Redo")};case"DOCUMENT_CUT":return{...l,shortcuts:["ctrl+x"],...(0,r.Z)("win_linux","Cut")};case"DOCUMENT_COPY":return{...l,shortcuts:["ctrl+c"],...(0,r.Z)("win_linux","Copy")};case"DOCUMENT_PASTE":return{...l,shortcuts:["ctrl+v"],...(0,r.Z)("win_linux","Paste")};case"DOCUMENT_PASTE_AS_PLAIN_TEXT":{const t=g.Z.getShortcuts(e,"COMMAND_CLIPBOARD_PASTE_AS_PLAIN_TEXT");return{...l,shortcuts:t,...(0,r.Z)("win_linux","Paste as Plain Text")}}case"DOCUMENT_SELECT_ALL":return{...l,shortcuts:["ctrl+a"],...(0,r.Z)("win_linux","Select All")};case"DOCUMENT_CONTAINER_NOTES":return l.settingsLabel=(0,o.Z)("[All notes]"),l.type="container",{...l,...(0,r.Z)("Insert Note")};case"DOCUMENT_CONTAINER_SPELLCHECK":return l.settingsLabel=(0,o.Z)("[Spell Check]"),l.type="container",{...l,...(0,r.Z)("Spell Check")};case"DOCUMENT_CONTAINER_SPELLCHECK_OPTIONS":return l.settingsLabel=(0,o.Z)("[Spell Check Options]"),l.type="container",{...l,...(0,r.Z)("Spell Check Options")};case"DOCUMENT_CONTAINER_WRITING_DIRECTION":return l.settingsLabel=(0,o.Z)("[Writing Direction Options]"),l.type="container",{...l,...(0,r.Z)("Writing Direction")};case"DOCUMENT_CONTAINER_SPEECH":return l.settingsLabel=(0,o.Z)("[Speech Commands]"),l.type="container",{...l,...(0,r.Z)("Speech")};default:return n.Z.getMenuItem(e,t,i)}}};var Y=s(21788);const X={actions:function(){return["DOCUMENT_LOOK_UP","DOCUMENT_EMOJI","DOCUMENT_UNDO","DOCUMENT_REDO","DOCUMENT_CUT","DOCUMENT_COPY","CONTEXT_COPY_FILTERED","DOCUMENT_PASTE","COMMAND_CLIPBOARD_PASTE_AS_PLAIN_TEXT_OR_PASTE_AND_GO","DOCUMENT_SELECT_ALL","DOCUMENT_CONTAINER_NOTES","DOCUMENT_CONTAINER_SPELLCHECK","DOCUMENT_CONTAINER_SPELLCHECK_OPTIONS","DOCUMENT_CUSTOMIZE","DOCUMENT_SHOW_FULL_ADDRESS","DOCUMENT_CONTAINER_SPEECH"]},options:function(e,t,s){const i=void 0===s,l={...a.Z.commandItem},d=s||g.Z.settingsState;switch(t.action){case"DOCUMENT_LOOK_UP":return{...l,...g.Z.getLabelWithParameter(e,t,d.printableselection,i)};case"DOCUMENT_EMOJI":return{...l,...(0,r.Z)("Emoji && Symbols")};case"DOCUMENT_UNDO":return{...l,shortcuts:["ctrl+z"],...(0,r.Z)("win_linux","Undo")};case"DOCUMENT_REDO":return{...l,shortcuts:["ctrl+y"],...(0,r.Z)("win_linux","Redo")};case"DOCUMENT_CUT":return{...l,shortcuts:["ctrl+x"],...(0,r.Z)("win_linux","Cut")};case"DOCUMENT_COPY":return{...l,shortcuts:["ctrl+c"],...(0,r.Z)("win_linux","Copy")};case"CONTEXT_COPY_FILTERED":case"COMMAND_CLIPBOARD_COPY_FILTERED":return{...l,isVisible:()=>i||Boolean(s?.selection.length),handler:()=>{s&&Y.Z.copyWithFilter(s.selection)},...(0,r.Z)("Copy without Parameters")};case"DOCUMENT_PASTE":return{...l,shortcuts:["ctrl+v"],...(0,r.Z)("win_linux","Paste")};case"DOCUMENT_SELECT_ALL":return{...l,shortcuts:["ctrl+a"],...(0,r.Z)("win_linux","Select All")};case"DOCUMENT_CONTAINER_NOTES":return l.settingsLabel=(0,o.Z)("[All notes]"),l.type="container",{...l,...(0,r.Z)("Insert Note")};case"DOCUMENT_CONTAINER_SPELLCHECK":return l.settingsLabel=(0,o.Z)("[Spell Check]"),l.type="container",{...l,...(0,r.Z)("Spell Check")};case"DOCUMENT_CONTAINER_SPELLCHECK_OPTIONS":return l.settingsLabel=(0,o.Z)("[Spell Check Options]"),l.type="container",{...l,...(0,r.Z)("Spell Check Options")};case"DOCUMENT_CONTAINER_WRITING_DIRECTION":return l.settingsLabel=(0,o.Z)("[Writing Direction Options]"),l.type="container",{...l,...(0,r.Z)("Writing Direction")};case"DOCUMENT_CUSTOMIZE":return l.ellipsis=!0,{...l,...(0,r.Z)("panel","Customize")};case"DOCUMENT_SHOW_FULL_ADDRESS":return l.type="checkbox",{...l,...(0,r.Z)("Show Full Address")};case"DOCUMENT_CONTAINER_SPEECH":return l.settingsLabel=(0,o.Z)("[Speech Commands]"),l.type="container",{...l,...(0,r.Z)("Speech")};default:return n.Z.getMenuItem(e,t,i)}}};const Q={actions:function(){return["CONTEXT_NEW","CONTEXT_NEW_WINDOW","CONTEXT_NEW_WORKSPACE","CONTEXT_ACTIVATE_WORKSPACE","CONTEXT_NEW_STACK","CONTEXT_NEW_STACK_FOR_HOST","CONTEXT_TABSTACK_UNGROUP","CONTEXT_CLONE","CONTEXT_ACTIVATE","CONTEXT_RELOAD","CONTEXT_HIBERNATE","CONTEXT_PIN","CONTEXT_PIN_STACK","CONTEXT_UNPIN","CONTEXT_UNPIN_STACK","CONTEXT_TILE_TABS","CONTEXT_UNTILE_TAB","CONTEXT_UNTILE_TILE_GROUP","CONTEXT_MUTE","CONTEXT_MUTE_OTHER","CONTEXT_UNMUTE","CONTEXT_RENAME","CONTEXT_COPY","CONTEXT_SAVE","CONTEXT_SAVE_ALL","CONTEXT_EXPORT","CONTEXT_EXPORT_ALL","CONTEXT_DELETE","CONTEXT_EMPTY_TRASH","CONTEXT_REOPEN","CONTEXT_EXPAND_ALL","CONTEXT_COLLAPSE_ALL","CONTEXT_OPEN_IN_NEW_WINDOW","CONTEXT_OPEN_SYNC_ITEMS","CONTEXT_REGISTER_SYNC","CONTEXT_SIGNIN_SYNC"]},options:function(e,t,s){const i=s||{hostname:"",selectedCount:0,selectedStackableCount:0,isInTrashFolder:!1},o=void 0===s,l={...a.Z.commandItem};switch(t.action){case"CONTEXT_NEW":return{...l,...(0,r.Z)("command","New Tab")};case"CONTEXT_NEW_WINDOW":return{...l,...(0,r.Z)("command","New Window")};case"CONTEXT_NEW_WORKSPACE":return{...l,...(0,r.Z)("command","New Workspace")};case"CONTEXT_ACTIVATE_WORKSPACE":return{...l,...(0,r.Z)("command","Open Workspace")};case"CONTEXT_NEW_STACK":return{...l,...(0,r.Z)("Stack $1 Selected Tab","Stack $1 Selected Tabs",[i.selectedStackableCount])};case"CONTEXT_NEW_STACK_FOR_HOST":return{...l,...o?(0,r.Z)("Stack Tabs by Host"):(0,r.Z)("Stack Tabs by Host ($1)",[i.hostname])};case"CONTEXT_TABSTACK_UNGROUP":return{...l,...(0,r.Z)("Unstack Tabs")};case"CONTEXT_CLONE":return{...l,...(0,r.Z)("Duplicate")};case"CONTEXT_ACTIVATE":return{...l,...(0,r.Z)("Activate")};case"CONTEXT_RELOAD":return{...l,...(0,r.Z)("Reload")};case"CONTEXT_HIBERNATE":return{...l,...(0,r.Z)("Hibernate")};case"CONTEXT_PIN":case"CONTEXT_PIN_STACK":return{...l,...(0,r.Z)("Pin")};case"CONTEXT_UNPIN":case"CONTEXT_UNPIN_STACK":return{...l,...(0,r.Z)("Unpin")};case"CONTEXT_TILE_TABS":return{...l,...(0,r.Z)("Tile")};case"CONTEXT_UNTILE_TAB":return{...l,...(0,r.Z)("Untile")};case"CONTEXT_UNTILE_TILE_GROUP":return{...l,...(0,r.Z)("Untile All Tabs in Set")};case"CONTEXT_MUTE":return{...l,...(0,r.Z)("Mute")};case"CONTEXT_MUTE_OTHER":return{...l,...(0,r.Z)("Mute Others")};case"CONTEXT_UNMUTE":return{...l,...(0,r.Z)("Unmute")};case"CONTEXT_RENAME":return{...l,...(0,r.Z)("Rename")};case"CONTEXT_COPY":return{...l,...i.selectedCount>1?(0,r.Z)("Copy Links"):(0,r.Z)("Copy Link")};case"CONTEXT_SAVE":return{...l,...(0,r.Z)("Save as Bookmarks")};case"CONTEXT_SAVE_ALL":return{...l,...(0,r.Z)("Save All as Bookmarks")};case"CONTEXT_EXPORT":return{...l,...(0,r.Z)("Save as Session")};case"CONTEXT_EXPORT_ALL":return{...l,...(0,r.Z)("Save All as Session")};case"CONTEXT_DELETE":return{...l,...i.isInTrashFolder?(0,r.Z)("verb","Delete"):(0,r.Z)("Close")};case"CONTEXT_EMPTY_TRASH":return{...l,...(0,r.Z)("command","Clear All")};case"CONTEXT_REOPEN":return{...l,...(0,r.Z)("Reopen")};case"CONTEXT_EXPAND_ALL":return{...l,...(0,r.Z)("Expand All Folders")};case"CONTEXT_COLLAPSE_ALL":return{...l,...(0,r.Z)("Collapse All Folders")};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{...l,...(0,r.Z)("Open in a New Window")};case"CONTEXT_OPEN_SYNC_ITEMS":return{...l,...(0,r.Z)("Open")};case"CONTEXT_REGISTER_SYNC":return{...l,...(0,r.Z)("Create Account")};case"CONTEXT_SIGNIN_SYNC":return{...l,...(0,r.Z)("Log In")};default:return n.Z.getMenuItem(e,t,o)}}};const q={actions:function(){return["CONTEXT_WORKSPACE_RENAME","CONTEXT_WORKSPACE_DELETE","CONTEXT_WORKSPACE_OPEN_IN_NEW_WINDOW","CONTEXT_WORKSPACE_HIBERNATE"]},options:function(e,t,s){const i={...a.Z.commandItem};switch(t.action){case"CONTEXT_WORKSPACE_RENAME":return{...i,...(0,r.Z)("Rename Workspace")};case"CONTEXT_WORKSPACE_DELETE":return{...i,...(0,r.Z)("Delete Workspace")};case"CONTEXT_WORKSPACE_OPEN_IN_NEW_WINDOW":return{...i,...(0,r.Z)("Open in a New Window")};case"CONTEXT_WORKSPACE_HIBERNATE":return{...i,...s?(0,r.Z)("Hibernate Workspace"):(0,r.Z)("Hibernate Tabs")};default:return n.Z.getMenuItem(e,t,!1)}}};var J=s(92292),ee=s(7064);const te=[{name:(0,o.Z)("Web Page"),group:"8",indent:0,sort:!0},{name:(0,o.Z)("Mail"),group:"6",indent:0,sort:!0},{name:(0,o.Z)("section","Start page"),group:"1",indent:0,sort:!0},{name:(0,o.Z)("Panels"),group:"4",indent:0,sort:!0},{name:(0,o.Z)("Tabs"),group:"2",indent:0,sort:!0},{name:(0,o.Z)("Bookmarks"),group:"5",indent:0,sort:!0},{name:(0,o.Z)("context","Address Bar"),group:"3",indent:0,sort:!1},{name:(0,o.Z)("Other"),group:"7",indent:0,sort:!0}],se={mailandfeeds:{name:(0,o.Z)("Mail and Feeds"),group:"1",...I},tab:{name:(0,o.Z)("context","Tab"),group:"2",...H},tabstackthumbnails:{name:(0,o.Z)("Tab Stack Thumbnails"),group:"2",...V},tabbar:{name:(0,o.Z)("context","Tab Bar"),group:"2",...W},closedtab:{name:(0,o.Z)("Tab Trash Can"),group:"2",...u},taboverflow:{name:(0,o.Z)("Tab Overflow"),group:"2",...U},windowlist:{name:(0,o.Z)("Window List"),group:"2",...Q},bookmarkbar:{name:(0,o.Z)("Bookmark Bar"),group:"5",...c},bookmarkbaritem:{name:(0,o.Z)("Bookmark Bar Button"),group:"5",...d},bookmarklist:{name:(0,o.Z)("Bookmark List"),group:"5",...h},panelbar:{name:(0,o.Z)("Panel Bar"),group:"4",...P},panelbaritem:{name:(0,o.Z)("Panel Bar Button"),group:"4",..._},backwardbutton:{name:(0,o.Z)("Back Button"),group:"3",...E},forwardbutton:{name:(0,o.Z)("Forward Button"),group:"3",...E},rewindbutton:{name:(0,o.Z)("Rewind Button"),group:"3",...E},fastforwardbutton:{name:(0,o.Z)("Fast Forward Button"),group:"3",...E},reloadbutton:{name:(0,o.Z)("Reload Button"),group:"3",...E},homebutton:{name:(0,o.Z)("Home Button"),group:"3",...E},urledit:{name:(0,o.Z)("Text Field"),group:"3",...X},speeddialitem:{name:(0,o.Z)("Speed Dial Button"),group:"1",...R},startpage:{name:(0,o.Z)("context","Start Page"),group:"1",...F},startpagebar:{name:(0,o.Z)("Start Page Bar"),group:"1",...B},topsite:{name:(0,o.Z)("Top Sites"),group:"1",...K},shortcut:{name:(0,o.Z)("Bookmarks"),group:"1",...L},shortcutfolder:{name:(0,o.Z)("Bookmarks Folder"),group:"1",...j},tip:{name:(0,o.Z)("Tip"),group:"1",...G},mailheader:{name:(0,o.Z)("Message Header"),group:"6",...S},mailpanellist:{name:(0,o.Z)("mail","Panel"),group:"6",...Z},mailsearchlist:{name:(0,o.Z)("Message List"),group:"6",...T},mailcontent:{name:(0,o.Z)("Message Content"),group:"6",...A},contactlist:{name:(0,o.Z)("Contacts"),group:"6",...p},noteslist:{name:(0,o.Z)("Notes List"),group:"7",...k},historylist:{name:(0,o.Z)("History List"),group:"7",...v},downloadlist:{name:(0,o.Z)("Download List"),group:"7",...f},translatehistory:{name:(0,o.Z)("Translate History"),group:"7",...z},readinglist:{name:(0,o.Z)("Reading List"),group:"7",...M},sessioncontentlist:{name:(0,o.Z)("Session Content List"),group:"7",...D},sessionlist:{name:(0,o.Z)("Session List"),group:"7",...O},uiedit:{name:(0,o.Z)("Text Field"),group:"7",...$},workspacelist:{name:(0,o.Z)("Workspace List"),group:"7",...q},link:{name:(0,o.Z)("Link"),group:"8",...x},image:{name:(0,o.Z)("Image"),group:"8",...b},page:{name:(0,o.Z)("Page"),group:"8",...N},selection:{name:(0,o.Z)("context","Selection"),group:"8",...y},docedit:{name:(0,o.Z)("Text Field"),group:"8",...m},audiovideo:{name:(0,o.Z)("Audio and Video"),group:"8",...l}},ne=()=>Object.keys(se),ie=e=>te.some((t=>t.group===e)),ae=e=>{if(ie(e)){const t=te.findIndex((t=>t.group===e));return te[t].name}return se[e].name},oe=e=>se[e].options,re=e=>se[e].actions;function le(e,t,s,n,i){const a=oe(t);if(a){const t=t=>Promise.resolve(a(e,t));return de(e,n,s||t,i)}return Promise.resolve([])}function de(e,t,s,n){return Promise.all(t.map((t=>s(t).then((i=>{let o=a.Z.commandItem;switch(t.type){case"folder":o={...i,type:t.type,id:t.id,items:[],commandName:t.action};break;case"command":case"checkbox":o={...i,type:t.type,id:t.id,commandName:t.action};break;case"radio":break;case"container":n.expandContainers?i.container?(i.container.cpp=!0,i.container.mode=t.containermode||"folder",i.container.edge=t.containeredge||"off",o={type:t.type,id:t.id,...i}):"inline"===t.containermode?(i.items||(i.items=[]),o={...i,type:"container",id:t.id}):"folder"===t.containermode&&(delete i.type,o={...i,type:"folder",id:t.id}):(i.container={content:t.action,mode:t.containermode,edge:t.containeredge,cpp:!1},o={...i,type:t.type,id:t.id,commandName:t.action});break;case"separator":o={...a.Z.separatorItem,id:t.id}}void 0!==t.title&&(o.label&&(o.label=t.title),o.labelEnglish&&(o.labelEnglish=t.title),o.settingsLabel&&delete o.settingsLabel,o.ellipsis=!1),void 0!==t.custom&&(o.custom=t.custom),o.showshortcut=t.showshortcut;const r=t.children;return"folder"!==t.type||!r||i.isVisible&&!i.isVisible(e,n.inSettings)?o:de(e,r,s,n).then((e=>(o.items?.push(...e),o)))}))))).then((t=>t.reduce(((t,s)=>s.isVisible&&!s.isVisible(e,n.inSettings)?[...t]:"container"===s.type&&s.items&&n.expandContainers?[...t,...s.items]:[...t,s]),[])))}const ce={isSection:ie,getKeys:ne,getSettingsList:()=>{const e={};Object.keys(se).forEach((t=>{const s=se[t];e[s.group]||(e[s.group]=[]),e[s.group].push(t)}));let t=[];return te.forEach((s=>{if(e[s.group]){const n={key:s.group,indent:s.indent,name:s.name},i=e[s.group].map((e=>({key:e,indent:s.indent+1,name:ae(e)}))).sort(((e,t)=>!1===s.sort?0:e.name<t.name?-1:e.name>t.name?1:0));i&&i.length>0&&(t=[...t,n,...i])}})),t},getNamedMenu:(e,t,s)=>new Promise((n=>{ee.Z.menuContent.get(t,((i,a,o)=>{J.Z.runtime.lastError?(console.warn("Failed to read menu spec. Attempting fallback for menu key:",t),ee.Z.menuContent.reset(t,!0,void 0,(()=>{ee.Z.menuContent.get(t,((i,a,o)=>{void 0===J.Z.runtime.lastError?n(le(e,t,s,o,{expandContainers:!0,inSettings:!1,updateCallbacks:!1})):(console.warn("fallback failed"),n([]))}))}))):n(le(e,t,s,o,{expandContainers:!0,inSettings:!1,updateCallbacks:!1}))}))})),makeMenuWithContent:(e,t,s,n)=>le(e,t,void 0,s,n),makeCommandList:(e,t)=>{if(void 0===se[t])return[];const s={id:"",type:"command",action:""},i=oe(t);return re(t)().map((t=>(s.type=n.Z.getIsContainer(t)?"container":"command",s.action=t,{commandName:t,...i(e,s),id:t})))},hasName:e=>ne().includes(e)||ie(e),getName:ae,getOptionFunction:oe,getActionList:re},he=ce},20676:(e,t,s)=>{"use strict";s.d(t,{Z:()=>u});var n=s(76747),i=s(96951),a=s(14481),o=s(32921),r=s(26036),l=s(35369),d=s(36436);const c=[1,2,5,10,30,60,90],h=(e,t,s)=>{const h=i.ZP.getPageByReloadId(e);if("tab"===t&&h&&(0,d.xl)(h.url))return[];const u=o.Z.getAlarmFromReloadId(e),p="stack"===t?i.ZP.getGroup(e,s).groupBy((e=>o.Z.getAlarmFromReloadId(e.vivExtData.ext_id)?.periodInMinutes??0)).toArray().sort((([,e],[,t])=>e.size-t.size)):[],g="stack"===t?p.findLast((([e,t])=>e>0))?.[0]:u?.periodInMinutes,m="number"==typeof g,f="panel"===t?"panel":"tab",v=c.map((n=>({type:"checkbox",checked:g===n,handler:()=>{let r;if("stack"===t)r=i.ZP.getGroup(e,s).filter((e=>!(0,d.xl)(e.url))),m&&p.length>1&&(r=r.filter((e=>o.Z.getAlarmFromReloadId(e.vivExtData.ext_id)?.periodInMinutes!==g)));else if("select"===t)r=i.ZP.getSelectedPages(s).filter((e=>!(0,d.xl)(e.url)));else{if("tab"!==t){const t={alarm:u,id:e,interval:n,from:f};return void a.Z.createOrDestroyAlarm(t)}r=h?l.aV.of(h):(0,l.aV)()}r.forEach((e=>{const t=e.vivExtData.ext_id;if(t){const e={alarm:o.Z.getAlarmFromReloadId(t),id:t,interval:n,from:f};a.Z.createOrDestroyAlarm(e)}}))},commandName:"PERIODIC_RELOAD",parameter:n.toString(),...(0,r.Z)("$1 Minute","$1 Minutes",[n])})));return[...v,...[n.Z.separatorItem,{isVisible:()=>Boolean(u?.id.includes(e)),handler:()=>{a.Z.destroyPeriodicAlarm({ids:[e],from:f})},commandName:"PERIODIC_RELOAD_DISABLE",parameter:"",...(0,r.Z)("timer","Disable")},{isVisible:()=>"stack"===t&&m,handler:()=>{const e=p.flatMap((([e,t])=>e?t.map((e=>e.vivExtData.ext_id)).toArray():[]));a.Z.destroyPeriodicAlarm({ids:e,from:f})},commandName:"PERIODIC_RELOAD_DISABLE",parameter:"all",...(0,r.Z)("timers","Disable All Inside Stack")},{isVisible:()=>o.Z.existingAlarms(),handler:()=>{"panel"===f?a.Z.destroyAllPanelPeriodicAlarms():a.Z.destroyTabPeriodicAlarms(s)},commandName:"PERIODIC_RELOAD_DISABLE",parameter:"all",...(0,r.Z)("timers","Disable All")}]]},u={getForActivePage:e=>{const t=i.ZP.getActivePage(e),s=t?t.vivExtData.ext_id:void 0;return s?h(s,"tab",e):[]},getMenu:h,getHandlerByAction:(e,t,s)=>{let n;switch(t){case"PERIODIC_RELOAD":const t=i.ZP.getActivePage(e),r=t?t.vivExtData.ext_id:"";if(r){const e=o.Z.getAlarmFromReloadId(r),t=parseInt(s);n=()=>a.Z.createOrDestroyAlarm({alarm:e,id:r,interval:t,from:"tab"})}break;case"PERIODIC_RELOAD_DISABLE":if("all"===s)n=()=>a.Z.destroyTabPeriodicAlarms(e);else{const t=i.ZP.getActivePage(e),s=t?t.vivExtData.ext_id:"";s&&(n=()=>a.Z.destroyPeriodicAlarm({ids:[s],from:"tab"}))}}return n}}},19718:(e,t,s)=>{"use strict";s.d(t,{Z:()=>l});var n=s(25795),i=s(76747),a=s(30992),o=s(56371),r=s(26036);const l={actions:function(){return["DOCUMENT_CONTAINER_DEVELOPER_TOOLS","DOCUMENT_VALIDATE_URL","DOCUMENT_VIEW_SOURCE","DOCUMENT_VIEW_FRAME_SOURCE","DOCUMENT_RELOAD_FRAME","DOCUMENT_INSPECT"]},options:function(e,t,s){const l=void 0===s,d=s||a.Z.settingsState,c={...i.Z.commandItem};switch(t.action){case"DOCUMENT_CONTAINER_DEVELOPER_TOOLS":return c.settingsLabel=(0,o.Z)("[Developer Tools]"),c.type="container",{...c,...(0,r.Z)("Developer Tools")};case"DOCUMENT_VALIDATE_URL":return{...c,...(0,r.Z)("Validate")};case"DOCUMENT_VIEW_SOURCE":{const t=a.Z.getShortcuts(e,"COMMAND_TAB_VIEW_PAGE_SOURCE");return{...c,shortcuts:d.iswebpanel?[]:t,...d.iswebpanel?(0,r.Z)("View Panel Source"):(0,r.Z)("View Page Source")}}case"DOCUMENT_VIEW_FRAME_SOURCE":return{...c,...(0,r.Z)("View Frame Source")};case"DOCUMENT_RELOAD_FRAME":return{...c,...(0,r.Z)("Reload Frame")};case"DOCUMENT_INSPECT":{const t=a.Z.getShortcuts(e,"COMMAND_DEVELOPER_TOOLS");return{...c,shortcuts:d.iswebpanel?[]:t,...(0,r.Z)("Inspect")}}default:return n.Z.getMenuItem(e,t,l)}}}},30992:(e,t,s)=>{"use strict";s.d(t,{Z:()=>c});var n=s(25795),i=s(76747),a=s(39206),o=s(15489),r=s(26036);const l=new Map;function d(e,t){const s=l.get(e),n=a.Z.getDefault(o.ZP.isIncognito(e));if(t&&s){return a.Z.getByGuid(s)||n}return n}const c={settingsState:{linkurl:"",linktitle:"",pageurl:"",pagetitle:"",srcurl:"",selection:"",printableselection:"",selectionurl:"",keywordurl:"",isdevtools:!1,iseditable:!1,isimage:!1,isframe:!1,ismailcontent:!1,iswebpanel:!1,iswebpagewidget:!1,ismailto:!1,support:{copy:!1,audio:!1,canvas:!1,editoptions:!1,emoji:!1,extensions:!1,highlight:!1,pictureinpicture:!1,password:!1,passwordgeneration:!1,passwordshowall:!1,paste:!1,plugin:!1,qrcode:!1,sendtodevices:!1,video:!1},textfield:"document"},getLabelWithParameter:function(e,t,s,n){switch(t.action){case"DOCUMENT_LOOK_UP":if(t.title){const e=t.title;return delete t.title,{...n?i.Z.makeLabelPair(e):i.Z.makeLabelPair(e.replace("$1",s))}}return{...n?(0,r.Z)("Look Up “$1”"):(0,r.Z)("Look Up “$1”",[s])};case"DOCUMENT_GOTO_URL":if(t.title){const e=t.title;return delete t.title,{...n?i.Z.makeLabelPair(e):i.Z.makeLabelPair(e.replace("$1",s))}}return{...n?(0,r.Z)("Go to “$1”"):(0,r.Z)("Go to “$1”",[s])};case"DOCUMENT_SEARCH":case"DOCUMENT_SEARCH_LAST_USED":{const a="DOCUMENT_SEARCH_LAST_USED"===t.action,o=d(e,a),l=o?o.name:"";if(t.title){const e=t.title;return delete t.title,{...n&&o?i.Z.makeLabelPair(e):i.Z.makeLabelPair(e.replace("$1",l).replace("$2",s))}}return n?a?{...(0,r.Z)("Search $1 for “$2” (With Last Used Engine)")}:{...(0,r.Z)("Search $1 for “$2”")}:{...(0,r.Z)("Search $1 for “$2”",[l,s])}}default:return i.Z.makeLabelPair("")}},setSearchEngine:function(e,t){l.set(e,t.guid)},getSearchEngine:d,getShortcuts:function(e,t){return n.Z.getMenuItem(e,{id:"",type:"command",action:t},!0).shortcuts||[]}}},1068:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});var n=s(67294),i=s(48521);const a=function(e,t=1e3){return class extends n.Component{state={disabled:!0};componentDidMount(){this.timeout=setTimeout(this.enable,t)}componentWillUnmount(){clearTimeout(this.timeout)}enable=()=>this.setState({disabled:this.props.disabled||!1});render(){const{disabled:t,...s}=this.props,n=e||"input";return(0,i.jsx)(n,{...s,disabled:this.state.disabled})}}}},73132:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a,g:()=>i});var n=s(78614);const i="/resources/contact-person.png";function a(e){const t={toString:function(){return(0,n.gU)(this)},isEmpty:function(){return!(this.name||0!==this.emailAddresses.length||this.birthday||this.note||0!==this.postalAddresses.length||0!==this.phoneNumbers.length||this.avatarUrl)},clearGenerated:function(){this.generatedFromSentMail&&(this.generatedFromSentMail=!1)}};return Object.assign(Object.create(t),e)}},57118:(e,t,s)=>{"use strict";s.d(t,{$c:()=>f,Au:()=>v,BO:()=>m,EE:()=>l,N4:()=>h,UQ:()=>b,V9:()=>d,Y3:()=>c,Zg:()=>a,bb:()=>g,bz:()=>C,cX:()=>r,h6:()=>u,qk:()=>o,sB:()=>p,sg:()=>w});var n=s(56371),i=s(86088);const a="DASHBOARD_WIDGET",o="DASHBOARD_NEW_BUTTON",r=24,l=204,d=394,c={stiffness:210,damping:20,precision:.1},h="-99",u={id:h,title:(0,n.Z)("Dashboard"),bookmarkbar:!1,children:[],description:"",nickname:"",partner:"",speeddial:!0,themeColor:"",thumbnail:"",trash:!1},p={calendar:{icon:i.Ase,defaultTitle:(0,n.Z)("Calendar Agenda"),requiresMailEnabled:!0,size:"double_height",singular:!1},email:{icon:i.ms3,defaultTitle:(0,n.Z)("Latest Emails"),requiresMailEnabled:!0,size:"double_height",singular:!1},"sticky-note":{icon:i.mdK,defaultTitle:(0,n.Z)("Sticky Note"),size:"regular",singular:!1},shortcuts:{icon:i.mX1,defaultTitle:(0,n.Z)("Bookmarks"),size:"regular",singular:!1},tasks:{icon:i.tDC,defaultTitle:(0,n.Z)("Tasks"),requiresMailEnabled:!0,size:"regular",singular:!1},tip:{icon:i.qe_,defaultTitle:(0,n.Z)("Tip of the Day"),size:"regular",singular:!0},feed:{icon:i.L_F,defaultTitle:(0,n.Z)("Feeds"),requiresFeedsEnabled:!0,size:"double_height",singular:!1},"top-sites":{icon:i.ObT,defaultTitle:(0,n.Z)("Top Sites"),size:"regular",singular:!0},"privacy-stats":{icon:i.jcS,defaultTitle:(0,n.Z)("Privacy Statistics"),size:"regular",singular:!0},webpage:{icon:i.LQS,defaultTitle:(0,n.Z)("Webpage"),size:"double_height",singular:!1},date:{icon:i.N6b,defaultTitle:(0,n.Z)("Date"),size:"regular",singular:!0},weather:{icon:i.pUr,defaultTitle:(0,n.Z)("Weather"),size:"double_height",singular:!1},currency:{icon:i.ZU0,defaultTitle:(0,n.Z)("Currency"),size:"regular",singular:!1}},g=10,m={...{sameDay:(0,n.Z)("[Today] $1",["LT"]),lastDay:(0,n.Z)("[Yesterday] $1",["LT"]),nextDay:(0,n.Z)("[Tomorrow]",["LT"]),nextWeek:(0,n.Z)("[Next] $1",["dddd"]),lastWeek:"dddd LT",sameElse:"LL LT"},lastWeek:"ddd LT",sameElse:"L LT"},f=void 0,v="transparent",b="semi-transparent",C="solid",w="custom"},64473:(e,t,s)=>{"use strict";s.d(t,{Z:()=>u,t:()=>d});var n=s(67294),i=s(63377),a=s(84451),o=s(94283),r=s(52250),l=s(48521);const d="modal-dialog-title";var c=(0,l.jsx)("div",{className:"modal-faded-background"});class h extends n.Component{static contextType=o.Z;focusTrapRef=n.createRef();modalRef=n.createRef();componentDidMount(){this.props.ignoreEscape||a.Z.bind("meta+.",this.closeModalHandler);const{label:e,labelledBy:t,title:s,a11yIgnored:n}=this.props}componentWillUnmount(){this.props.ignoreEscape||a.Z.unbind("meta+.",this.closeModalHandler)}getNode(){return this.modalRef.current}closeModalHandler=()=>{this.props.onRequestClose()};handleClickOutside=e=>{this.props.ignoreClickOutside&&!e.target.closest(".window-close")||this.props.onRequestClose(e)};keyDownModal=e=>{"Escape"!==e.key||this.props.ignoreEscape||(e.preventDefault(),e.stopPropagation(),this.props.onRequestClose(e.nativeEvent))};renderBackground=()=>c;render(){const{labelledBy:e,label:t,title:s,a11yIgnored:n,asToolbar:a,className:o}=this.props,r=o?o.split(" "):[],c=(r.includes("float")||r.includes("onboarding"))&&!r.includes("no-fade-background"),h={};return n||(h.role=a?"toolbar":"dialog",t||""===t?h["aria-label"]=t:(e||s)&&(h["aria-labelledby"]=e||d)),(0,l.jsxs)(l.Fragment,{children:[c&&this.renderBackground(),(0,l.jsx)(i.Z,{focusName:"focus_modal",forceTrap:!a,id:"modal-bg",ref:this.focusTrapRef,className:o||"slide",style:this.props.style,onKeyDown:this.keyDownModal,children:(0,l.jsxs)("div",{ref:this.modalRef,className:"modal-wrapper","aria-modal":a?"false":"true",...h,children:[s&&(0,l.jsx)("div",{className:"dialog-header",children:(0,l.jsx)("h1",{className:"dialog-title",id:d,children:s})}),this.props.children]})})]})}}const u=(0,r.Z)(h)},71193:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});var n=s(96951),i=s(29087),a=s(35369),o=s(89175);function r(e){const t=n.ZP.getActiveWorkspace(e),s=n.ZP.getPages(e,{workspaceId:t});if(i.Z.get(o.kTabsCycleByRecentOrder)){const t=n.ZP.getPageHistory(e);return(0,a.aV)(t.map((e=>s.find((t=>t.id===e)))).filter(Boolean).reverse())}return s}},80837:(e,t,s)=>{"use strict";s.d(t,{Z:()=>w});var n=s(67294),i=s(47995),a=s(64473),o=s(15285),r=s(68247),l=s(29087),d=s(86461),c=s(94283),h=s(56371),u=s(82313),p=s(25372),g=s(29526),m=s(1068),f=s(89175),v=s(48521);const b=(0,m.Z)("input");class C extends n.Component{static contextType=c.Z;refDefaultAction=n.createRef();state={askNextTime:!1};componentDidMount(){this.refDefaultAction.current?.focus()}maybeShowDownloads(){const e=this.context.vivaldiWindowId;!o.ZP.getIsVisible(e,"PanelDownloads")&&l.Z.get(f.kDownloadsOpenPanelOnNew)&&i.Z.executeActions("button",this.context,d.ZP.isComponentVisible("DownloadButton",e)?"COMMAND_SHOW_DOWNLOADS_POPOUT":"COMMAND_SHOW_DOWNLOADS_PANEL")}onOpen=()=>{this.props.customData.request.allow("open"),this.maybeShowDownloads(),this.close()};onSave=()=>{this.props.customData.request.allow(),this.maybeShowDownloads(),this.close()};onSaveAs=()=>{this.props.customData.request.allow("saveas"),this.maybeShowDownloads(),this.close()};onCancel=()=>{this.props.customData.request.deny(),this.close()};close=()=>{!0!==this.props.customData.mixedDownload&&r.Z.set(f.kDownloadsStartAutomatically,this.state.askNextTime),this.props.onClose()};onAskDownloadChanged=({target:e})=>{this.setState({askNextTime:e.checked})};getHostAndPathname=()=>{const e=(0,g.Z)(this.props.customData.url);let t="",s="";const n=(0,p.Z)(e);return n&&({hostname:t,pathname:s}=n),{hostname:t,pathname:s}};render(){const e=this.props.customData.url.startsWith("data:");let t="",s="";this.props.customData.suggestedFilename&&e||({hostname:t,pathname:s}=this.getHostAndPathname());const n=this.props.customData.suggestedFilename?this.props.customData.suggestedFilename:(s||"").split("/").pop(),i=e?(0,h.Z)("Data URL"):t,o=-1===this.props.customData.fileSize?(0,h.Z)("Unknown"):(0,u.Z)(this.props.customData.fileSize);return(0,v.jsxs)(a.Z,{ignoreClickOutside:!0,ignoreEscape:!1,onRequestClose:this.onCancel,className:"dialog-download slide",title:(0,h.Z)("Download “$1”?",[n]),children:[(0,v.jsxs)("div",{className:"dialog-content",children:[(0,v.jsxs)("p",{children:[(0,v.jsx)("span",{className:"label",title:n,children:(0,h.Z)("File Name:")}),(0,v.jsx)("span",{className:"selectable",children:n})]}),(0,v.jsxs)("p",{children:[(0,v.jsx)("span",{className:"label",children:(0,h.Z)("File Size:")}),(0,v.jsx)("span",{className:"selectable",children:o})]}),(0,v.jsxs)("p",{children:[(0,v.jsx)("span",{className:"label",children:(0,h.Z)("Host:")}),(0,v.jsx)("span",{className:"selectable",children:i})]}),(0,v.jsxs)("p",{children:[(0,v.jsx)("span",{className:"label",children:(0,h.Z)("Location:")}),(0,v.jsx)("span",{className:"selectable",children:l.Z.get(f.kDownloadDefaultDirectory)})]}),!0===this.props.customData.mixedDownload?(0,v.jsx)("p",{children:(0,v.jsx)("span",{className:"labelwarning",children:(0,h.Z)("The download is insecure, be careful with its content.")})}):(0,v.jsxs)("label",{className:"autosave",children:[(0,v.jsx)("input",{type:"checkbox",onChange:this.onAskDownloadChanged}),(0,v.jsx)("span",{children:(0,h.Z)("Always Save Files to Default Download Location")})]})]}),(0,v.jsxs)("footer",{className:"dialog-footer",children:[(0,v.jsx)("input",{type:"button",className:"primary",onClick:this.onSave,ref:this.refDefaultAction,value:(0,h.Z)("Save")}),(0,v.jsx)("input",{type:"button",onClick:this.onSaveAs,value:(0,h.Z)("Save As...")}),(0,v.jsx)(b,{type:"button",onClick:this.onOpen,value:(0,h.Z)("Open")}),(0,v.jsx)("input",{type:"button",onClick:this.onCancel,value:(0,h.Z)("Cancel")})]})]})}}const w=C},8874:(e,t,s)=>{"use strict";s.d(t,{U:()=>h,Z:()=>u});var n=s(56371),i=s(82313),a=s(30381),o=s.n(a),r=s(48521);const l="in_progress",d="complete",c="interrupted";function h(e){switch(e){case"FILE_NO_SPACE":return(0,n.Z)("Disk is full");case"FILE_TOO_LARGE":return(0,n.Z)("File too large");case"FILE_FAILED":return(0,n.Z)("Download error");case"FILE_ACCESS_DENIED":return(0,n.Z)("Insufficient permissions");case"FILE_NAME_TOO_LONG":return(0,n.Z)("Path too long");case"FILE_VIRUS_INFECTED":return(0,n.Z)("Virus detected");case"FILE_TRANSIENT_ERROR":return(0,n.Z)("System busy");case"FILE_BLOCKED":return(0,n.Z)("Blocked");case"FILE_SECURITY_CHECK_FAILED":return(0,n.Z)("Virus scan failed");case"FILE_TOO_SHORT":return(0,n.Z)("File truncated");case"FILE_SAME_AS_SOURCE":return(0,n.Z)("Already downloaded");case"FILE_HASH_MISMATCH":return(0,n.Z)("Hash mismatch");case"NETWORK_FAILED":return(0,n.Z)("Network");case"NETWORK_TIMEOUT":return(0,n.Z)("Timeout");case"NETWORK_DISCONNECTED":return(0,n.Z)("Disconnected");case"NETWORK_SERVER_DOWN":return(0,n.Z)("Server unavailable");case"NETWORK_INVALID_REQUEST":return(0,n.Z)("Invalid network request");case"SERVER_FAILED":return(0,n.Z)("Server failed");case"SERVER_NO_RANGE":return(0,n.Z)("Server does not support range");case"SERVER_BAD_CONTENT":return(0,n.Z)("The server could not find the file");case"SERVER_UNAUTHORIZED":return(0,n.Z)("Unauthorized");case"SERVER_CERT_PROBLEM":return(0,n.Z)("Certificate problem");case"SERVER_FORBIDDEN":return(0,n.Z)("Forbidden");case"SERVER_UNREACHABLE":return(0,n.Z)("Unreachable");case"SERVER_CONTENT_LENGTH_MISMATCH":return(0,n.Z)("Content length mismatch");case"SERVER_CROSS_ORIGIN_REDIRECT":return(0,n.Z)("Cross origin redirect");case"USER_CANCELED":return(0,n.Z)("Cancelled");case"USER_SHUTDOWN":return(0,n.Z)("Shutdown");case"CRASH":return(0,n.Z)("Crashed")}return e}function u({item:e}){const t=(new Date).getTime()+2e3,s=e.estimatedEndTime?new Date(e.estimatedEndTime).getTime():NaN,a=e.state===l,u=e.bytesReceived,{currentHumanized:p,endHumanized:g}=function(e,t){let s=(0,i.Z)(e);const n=(0,i.Z)(t||e);return s.split(" ")[1]===n.split(" ")[1]&&(s=s.split(" ")[0]),{currentHumanized:s,endHumanized:n}}(u,e.totalBytes),m=function(e,t,s){return e&&t>s?o()(t).fromNow():e&&t<=s?(0,n.Z)("about a second"):""}(a,s,t),f=(0,n.Z)("$1/s",[(0,i.Z)(e.currentSpeed)]),v=e.paused||e.state===c,b=e.error?h(e.error):"",C=v?(0,n.Z)("$1 of $2 - stopped",[p,g]):(0,n.Z)("$1 of $2 at $3",[p,g,f]);return(0,r.jsxs)("div",{className:"DownloadItem-FileSize",children:[e.state===d?g:e.error?b:C,m&&` (${m})`]})}},84782:(e,t,s)=>{"use strict";s.d(t,{Z:()=>g});var n=s(67294),i=s(83784),a=s(84451),o=s(46382),r=s(94283),l=s(94184),d=s.n(l),c=s(52250),h=s(7064),u=s(48521);class p extends n.Component{static contextType=r.Z;state={width:28,height:28,hasLoadedPopup:!1};constructor(e,t){super(e),this.portalContainer=t.document.getElementById("browser"),this.activateClickoutside=!0}popupContainer=n.createRef();webviewelm;componentWillUnmount(){this.detachListeners(),this.webviewelm=null}getNode(){return this.popupContainer.current}attachListeners=()=>{this.webviewelm?.addEventListener("sizechanged",this.onSizeChanged),this.webviewelm?.addEventListener("close",this.onClose),this.webviewelm?.addEventListener("newwindow",this.onNewWindow),this.webviewelm?.addEventListener("loadstop",this.onLoadStop),this.webviewelm?.addEventListener("dialog",this.onShowDialog),this.webviewelm?.addEventListener("permissionrequest",this.handleOnPermissionRequest),a.Z.bind("esc",this.onCloseWithKeyboard)};detachListeners=()=>{this.webviewelm?.removeEventListener("sizechanged",this.onSizeChanged),this.webviewelm?.removeEventListener("close",this.onClose),this.webviewelm?.removeEventListener("newwindow",this.onNewWindow),this.webviewelm?.removeEventListener("loadstop",this.onLoadStop),this.webviewelm?.removeEventListener("dialog",this.onShowDialog),this.webviewelm?.removeEventListener("permissionrequest",this.handleOnPermissionRequest),a.Z.unbind("esc",this.onCloseWithKeyboard)};focusPopup=()=>{const e=this.popupContainer.current?.parentElement?.parentElement?.parentElement?.querySelector(".focus-popup-area");e&&e.focus()};handleOnPermissionRequest=e=>{if(e.preventDefault(),"download"===e.permission)this.activateClickoutside=!1,this.props.disableOnClickOutside?.(),i.Z.doDownload(e,this.context,this.webviewelm)};handleClickOutside=e=>{this.props.popupWantsToClose()};removeWebView=()=>{this.detachListeners(),this.webviewelm&&(this.popupContainer.current?.removeChild(this.webviewelm),this.popupContainer.current?.remove(),this.webviewelm=null),this.setState({hasLoadedPopup:!1})};recreateWebView=()=>{const{document:e}=this.context;this.webviewelm&&this.removeWebView(),h.Z.zoom.getVivaldiUIZoom((t=>{const s=this.popupContainer.current;if(!s)return;this.portalContainer?.appendChild(s);let n=800,i=600;t>=1&&(n=Math.round(800*t),i=Math.round(600*t));const{extensionId:a,popupPage:o}=this.props;if(a&&o){const t=e.createElement("webview");t.setAttribute("windowId",String(this.context.vivaldiWindowId)),t.setAttribute("autosize","on"),t.setAttribute("minwidth",String(28)),t.setAttribute("minheight",String(28)),t.setAttribute("maxwidth",String(n)),t.setAttribute("maxheight",String(i)),t.setAttribute("partition","persist:"+a),t.setAttribute("class","ignore-react-onclickoutside"),t.setAttribute("vivaldi_view_type","extension_popup"),t.setAttribute("src",o),s?.appendChild(t),this.webviewelm=t,this.attachListeners()}}))};onSizeChanged=e=>{this.setState({width:e.newWidth,height:e.newHeight})};onLoadStop=e=>{this.activateClickoutside&&this.props.enableOnClickOutside(),this.setState({hasLoadedPopup:!0}),setTimeout((e=>{this.webviewelm&&this.webviewelm.focus()}),50)};onNewWindow=e=>{e.window.accept(this.context.vivaldiWindowId+";1"),this.props.popupWantsToClose()};onShowDialog=e=>{this.props.disableOnClickOutside?.(),e.webview=this.webviewelm,e.preventDefault(),e.dialogtype="javascript",o.Z.showDialog(this.context.vivaldiWindowId,e,this.onClose),this.onSizeChanged(e)};onCloseWithKeyboard=()=>{this.props.popupWantsToClose(),this.focusPopup()};onClose=()=>{this.props.popupWantsToClose()};render(){let e=0,t=0,s=0;const{popupPosition:n}=this.props;if(this.props.popupRect){const i=this.props.popupRect;"above"===n||"below"===n?(e="above"===n?i.top-this.state.height-3:i.bottom+6-3,t=i.left+i.width/2-this.state.width/2,t=Math.min(Math.max(t,6),this.context.innerWidth-this.state.width-6),s=i.left-t+i.width/2-6):"left"!==n&&"right"!==n||(t="left"===n?i.left-this.state.width-6:i.left+i.width+6,s=6,e=i.top,e+this.state.height>this.context.innerHeight&&(e=this.context.innerHeight-this.state.height-6,s=i.top-e+i.height/2-6))}const i=this.state.hasLoadedPopup&&this.props.popupVisible,a=0===t&&0===e;return(0,u.jsx)("div",{className:d()({"extension-popup":!0,bottom:!a&&"above"===n,top:!a&&"below"===n,left:!a&&"left"===n,right:!a&&"right"===n,hidden:!i}),style:{"--anchorPosition":s+"px",height:this.state.height,width:this.state.width,position:"fixed",left:a?"50%":t,top:a?"50%":e,transform:a?"translate(-50%, -50%)":"unset",display:i?"inherit":"none"},ref:this.popupContainer})}}const g=(0,c.Z)(p)},79227:(e,t,s)=>{"use strict";s.d(t,{C:()=>F,Z:()=>L});var n=s(67294),i=s(65792),a=s.n(i),o=s(84782),r=s(98109),l=s(60679),d=s(81009),c=s(84451),h=s(46382),u=s(76747),p=s(59322),g=s(96951),m=s(68247),f=s(98102),v=s(80822),b=s(70864),C=s(94283),w=s(15489),y=s(56371),x=s(92292),I=s(94184),A=s.n(I),S=s(47380),Z=s(26036),T=s(7064),E=s(93197),k=s(10334),N=s(1407),_=s(89175),P=s(86088),M=s(89555),D=s(44850),O=s(48521);const j=[_.kAddressBarExtensionsRenderInDropdown,_.kAddressBarExtensionsShowAllToggle,_.kAddressBarExtensionsHiddenExtensions],L="vivaldi/x-button-extension";var R=(0,O.jsx)("div",{className:"toolbar-extensions"});class B extends n.PureComponent{static contextType=C.Z;state={extensions:r.Z.getState(),extensionOrder:v.Z.getSync("EXTENSION_BUTTON_ORDER_BROWSER"),popupId:null,popupPage:null,popupVisible:!1,popupRect:void 0,extensionPopup:!1,showHiddenExtensions:!1,activeTabId:g.ZP.unsafeGetActivePage(this.context.vivaldiWindowId).id};_extensionActionShortcuts=new Map;_removedIdToIndex={};_shortcutCallbacks=new Map;_toolbarButtons=new Map;refWrapper=n.createRef();refToolbar=n.createRef();extensionActionPopupRef=n.createRef();async componentDidMount(){if(this.props.inEditor)return;r.Z.addListener(this._onExtensionStoreChange);const{selectWindow:e}=this.context;g.ZP.addListener(this._onPageStoreChange,e),T.Z.extensionActionUtils.onCommandAdded.addListener(this.onCommandAdded),T.Z.extensionActionUtils.onCommandRemoved.addListener(this.onCommandRemoved),k.g2.addListener(this.extensionSubscriber),v.Z.addListener("EXTENSION_BUTTON_ORDER_BROWSER",this._onButtonOrderPrefsChange);(await T.Z.extensionActionUtils.getToolbarExtensions()).filter((e=>e.enabled)).forEach((e=>{this.updateShortcut(e.id,e.keyboardShortcut)}))}componentDidUpdate(e,t){!t.extensionPopup&&this.state.extensionPopup&&this.refWrapper.current?.focus()}componentWillUnmount(){this.props.inEditor||(r.Z.removeListener(this._onExtensionStoreChange),g.ZP.removeListener(this._onPageStoreChange),T.Z.extensionActionUtils.onCommandAdded.removeListener(this.onCommandAdded),T.Z.extensionActionUtils.onCommandRemoved.removeListener(this.onCommandRemoved),k.g2.removeListener(this.extensionSubscriber),v.Z.removeListener("EXTENSION_BUTTON_ORDER_BROWSER",this._onButtonOrderPrefsChange),this._extensionActionShortcuts.forEach(((e,t)=>{this.removeShortcut(t,e)})),this.state.popupVisible&&this.popupWantsToClose())}extensionSubscriber=e=>{const t=this._toolbarButtons.get(e);this.state.popupId!==e&&this.setState({popupVisible:!1,popupPage:null,popupRect:void 0,popupId:null});const s=t?.getRect()??this.refToolbar.current?.getBoundingClientRect();this.onExtensionActionClicked(e,s)};_onButtonOrderPrefsChange=()=>{this.setState({extensionOrder:v.Z.getSync("EXTENSION_BUTTON_ORDER_BROWSER")})};_onPageStoreChange=()=>{const e=this.context.vivaldiWindowId,t=g.ZP.unsafeGetActivePage(e);this.setState({activeTabId:t.id})};_onExtensionStoreChange=()=>{this.setState({extensions:r.Z.getState()})};_getTabExtensionInfo=(e,t)=>{const s=this.state.extensions.get(e);if(!s)throw new Error("Extension not found - "+e);const n=s.get(t),i=s.get(-1);if(!i)throw new Error("Extension fallback not set! Something is wrong. "+e);return{...i,...n}};assignShortcut=(e,t)=>{if(!t)return;this._extensionActionShortcuts.set(e,t),this._shortcutCallbacks.set(e,(()=>{this.onExtensionActionClicked(e)}));const s=this._shortcutCallbacks.get(e);s&&c.Z.bind(t.toLowerCase(),s)};removeShortcut=(e,t)=>{t&&(c.Z.unbind(t.toLowerCase(),this._shortcutCallbacks.get(e)),this._extensionActionShortcuts.set(e,""),this._shortcutCallbacks.delete(e))};updateShortcut=(e,t)=>{(t||this._extensionActionShortcuts.has(e))&&(t&&!this._extensionActionShortcuts.has(e)?this.assignShortcut(e,t):!t&&this._extensionActionShortcuts.has(e)?this.removeShortcut(e,t):t!==this._extensionActionShortcuts.get(e)&&(this.removeShortcut(e,t),this.assignShortcut(e,t)))};onCommandAdded=(e,t)=>{this.assignShortcut(e,t)};onCommandRemoved=(e,t)=>{this.removeShortcut(e,t)};saveBrowserOrder=e=>{v.Z.set({EXTENSION_BUTTON_ORDER_BROWSER:e})};onExtensionActionClicked=(e,t,s)=>{const n=r.Z.getExtensionInfoForTab(e,this.state.activeTabId),i=this.context.vivaldiWindowId,a=g.ZP.unsafeGetActivePage(i);if(!n||n.badgeText||D.jk.isInternalPage(a)||T.Z.infobars.showInfobar(this.state.activeTabId),n&&!n.visible){let e;const{HTMLElement:t}=this.context;return s&&s.target instanceof t&&(e=s.target),void this.getContextMenu(n).then((t=>{(0,S.Z)(this.context,t,void 0,this.props.menuOrigin,e)()}))}T.Z.extensionActionUtils.executeExtensionAction(e,this.context.vivaldiWindowId,(s=>{if(s.popupUrl)this.setState((n=>({popupVisible:!n.popupVisible,popupPage:s.popupUrl,popupRect:t,popupId:e})),(()=>{this.state.popupVisible&&this.extensionActionPopupRef.current?.recreateWebView()}));else if(!0===s.openPanelOnActionClick){const e=this.context.vivaldiWindowId;return void(s.extensionId&&b.Z.showSidePanel(s.extensionId,e))}}))};popupWantsToClose=()=>{this.setState({popupVisible:!1}),this.extensionActionPopupRef.current?.removeWebView()};#fn=()=>Array.from(this.state.extensions.keys()).sort(((e,t)=>this.state.extensionOrder.indexOf(e)-this.state.extensionOrder.indexOf(t)));onDrop=(e,t,s)=>{if(!this._dragOverId)return;const n=this.#fn();let i=n.indexOf(this._dragOverId);this._dragOverId=null;const a=e.dataTransfer.getData(L);if(!a)return;const o=n.indexOf(a);if(-1===o||o===i)return;if("right"===t&&i++,o===i)return;e.stopPropagation();const r=n[o];n.splice(o,1),o<i&&i--,n.splice(i,0,r),this.saveBrowserOrder(n)};stopPropagation=e=>{e.stopPropagation()};onDragEnter=e=>{this._dragOverId=e};executeExtensionAction=(e,t)=>{if(this.state.popupVisible&&(this.popupWantsToClose(),this.state.popupId===e))return;const{HTMLElement:s}=this.context;if(t.target instanceof s){const s=t.target;Boolean(this.state.popupId)&&this.state.popupId!==e&&this.setState({popupVisible:!1,popupPage:null,popupRect:void 0,popupId:null}),this.onExtensionActionClicked(e,s.getBoundingClientRect(),t)}};removeExtension=e=>{this.state.popupVisible&&this.popupWantsToClose(),T.Z.extensionActionUtils.removeExtension(e,this.context.vivaldiWindowId)};showOptionsPage=e=>{T.Z.extensionActionUtils.showExtensionOptions(e,this.context.vivaldiWindowId)};toggleVisibility=e=>{this.state.extensionPopup&&this.hideHiddenExtensionsPopup(),this.state.popupVisible&&this.popupWantsToClose();const t=this.props.prefValues[_.kAddressBarExtensionsHiddenExtensions];if(-1===t.indexOf(e))m.Z.set(_.kAddressBarExtensionsHiddenExtensions,[...t,e]);else{const s=t.filter((t=>e!==t&&this.state.extensions.has(t)));m.Z.set(_.kAddressBarExtensionsHiddenExtensions,s)}};isExtensionAvailable=e=>!(w.ZP.isIncognito(this.context.vivaldiWindowId)&&!e.allowInIncognito);hasHiddenExtensions=()=>{for(const[e]of this.state.extensions)if(!this.isIgnoredProtonExtension(e)&&this.props.prefValues[_.kAddressBarExtensionsHiddenExtensions].includes(e))return!0;return!1};toggleHiddenExtensionsPopup=()=>{this.setState((e=>({extensionPopup:!e.extensionPopup})))};hideHiddenExtensionsPopup=()=>{this.setState({extensionPopup:!1})};onCustomMenuSelected=(e,t)=>{T.Z.extensionActionUtils.executeMenuAction(e,this.context.vivaldiWindowId,t,(e=>{x.Z.runtime.lastError&&x.Z.runtime.lastError.message&&console.warn("Error invoking menu item action: "+x.Z.runtime.lastError.message)}))};getContextMenu=e=>new Promise(((t,s)=>{const n=e.homepage||"https://chrome.google.com/webstore/detail/"+e.id,i=this.props.prefValues[_.kAddressBarExtensionsShowAllToggle];T.Z.extensionActionUtils.getExtensionMenu(e.id,(a=>{x.Z.runtime.lastError&&s(x.Z.runtime.lastError);const o=a.map((t=>{const s={handler:this.onCustomMenuSelected.bind(this,e.id,t.id),isVisible:()=>t.visible,mnemonic:!1,checked:t.checked,...u.Z.makeLabelPair(t.name)};return t.submenu&&(s.items=t.submenu.map((t=>({handler:this.onCustomMenuSelected.bind(this,e.id,t.id),isVisible:()=>t.visible,mnemonic:!1,checked:t.checked,...u.Z.makeLabelPair(t.name)})))),s})),r=this.props.prefValues[_.kAddressBarExtensionsHiddenExtensions].includes(e.id),l=[{handler:()=>p.ZP.openURL(this.context.vivaldiWindowId,n),...u.Z.makeLabelPair(e.name||"")},...o.length>0?[u.Z.separatorItem,...o,u.Z.separatorItem]:[],{handler:()=>this.showOptionsPage(e.id),isVisible:()=>void 0!==e.optionspage&&""!==e.optionspage,...(0,Z.Z)("Options")},{handler:()=>this.removeExtension(e.id),isVisible:()=>"componentAction"!==e.extensionType,ellipsis:!0,...(0,Z.Z)("Remove Extension")},{handler:()=>this.toggleVisibility(e.id),isVisible:()=>!i&&r,...(0,Z.Z)("Show Button")},{handler:()=>this.toggleVisibility(e.id),isVisible:()=>!i&&!r,...(0,Z.Z)("Hide Button")},u.Z.separatorItem,{handler:()=>h.Z.showExtensions(this.context.vivaldiWindowId),...(0,Z.Z)("Manage Extensions")}];return t(l)}))}));toggleHiddenExtensions=()=>{this.setState((e=>({showHiddenExtensions:!e.showHiddenExtensions}))),h.Z.updateToolbarSpacer(this.context.vivaldiWindowId)};renderExtensionToggleButton=()=>(0,O.jsx)(f.ZP,{tooltip:(0,y.Z)("Toggle extensions"),onClick:this.toggleHiddenExtensions,image:P.v9y[this.props.size||"large"],customizeMenu:this.props.customizeMenu,menuOrigin:this.props.menuOrigin,hidePopup:this.hideHiddenExtensionsPopup,draggable:this.props.draggable||!1,onDragStart:this.props.onDragStart??M.Z,onDragEnd:this.props.onDragEnd??M.Z,onDrop:this.props.onDrop??M.Z,onDragEnter:this.props.onDragEnter??M.Z,onDragLeave:this.props.onDragLeave??M.Z,onDragOver:this.props.onDragOver??M.Z,mimeType:this.props.mimeType,name:this.props.name,size:this.props.size,style:{"--extensionsExpanded":this.state.showHiddenExtensions?1:0},className:A()("ExtensionToggleIcon",{"ExtensionToggleIcon--Expanded":this.state.showHiddenExtensions})});_shouldRenderInMainToolbar=e=>{let t=!0;const s=this.props.prefValues[_.kAddressBarExtensionsRenderInDropdown],n=this.props.prefValues[_.kAddressBarExtensionsShowAllToggle],i=this.props.prefValues[_.kAddressBarExtensionsHiddenExtensions].includes(e.id);return(!n||this.state.showHiddenExtensions&&!s)&&(n||!i||this.state.showHiddenExtensions&&!s)||(t=!1),t};renderHiddenExtensionInPopup=()=>{const{size:e="large"}=this.props,t=[],s=this.props.prefValues[_.kAddressBarExtensionsShowAllToggle];for(const e of this.#fn()){const n=this._getTabExtensionInfo(e,this.state.activeTabId);if(!n)continue;(this.props.prefValues[_.kAddressBarExtensionsHiddenExtensions].includes(e)||s)&&this.isExtensionAvailable(n)&&t.push((0,O.jsx)(f.ZP,{className:"ExtensionDropdownIcon extensionId",badgeText:n.badgeText,tooltip:n.name,tabIndex:0,draggable:this.props.draggable||!1,imagePath:n.badgeIcon,ref:e=>{e&&n&&this._toolbarButtons.set(n.id,e)},onClick:this.executeExtensionAction.bind(this,n.id),menu:this.getContextMenu.bind(this,n),onDragEnter:()=>{n&&this.onDragEnter(n.id)},onDragStart:this.stopPropagation,onDragEnd:this.stopPropagation,mimeType:L,name:n.id,onDrop:this.onDrop},n.id))}return(0,O.jsx)(f.ZP,{image:P.v9y[e],tooltip:(0,y.Z)("Show hidden extensions"),onClick:this.toggleHiddenExtensionsPopup,customizeMenu:this.props.customizeMenu,menuOrigin:this.props.menuOrigin,popupPosition:this.props.popupPosition,isPopupVisible:this.state.extensionPopup,popupWidth:Math.min(34*t.length,442),popupClassName:"extensionIconPopupMenu ToolbarButtonPopup-DefaultStyles",hasLightArrow:!0,size:e,hidePopup:this.hideHiddenExtensionsPopup,draggable:this.props.draggable||!1,onDragStart:this.props.onDragStart??M.Z,onDragEnd:this.props.onDragEnd??M.Z,onDrop:this.props.onDrop??M.Z,onDragEnter:this.props.onDragEnter??M.Z,onDragLeave:this.props.onDragLeave??M.Z,onDragOver:this.props.onDragOver??M.Z,mimeType:this.props.mimeType,name:this.props.name,children:(0,O.jsx)("div",{ref:this.refWrapper,className:"toolbar toolbar-mainbar toolbar-wrap",tabIndex:"-1",children:t})})};isIgnoredProtonExtension=e=>e===N.Ug;renderExtensionButtons=()=>{const e=this.props.prefValues[_.kAddressBarExtensionsShowAllToggle],t=[];for(const s of this.#fn()){if(this.isIgnoredProtonExtension(s))continue;const n=this._getTabExtensionInfo(s,this.state.activeTabId);if(this._shouldRenderInMainToolbar(n)&&this.isExtensionAvailable(n)){const i=n.badgeIcon?n.badgeIcon:"data:image/svg+xml;utf8,"+P.N_W;let o,r=n.badgeBackgroundColor?a()(n.badgeBackgroundColor):void 0;r&&r?.alpha()<1&&(r=r.alpha(1));const l=r?r.luminance()>E.$J?E.E5:E.Cj:void 0;o=n.badgeIcon?n.badgeText:n.name?n.name.charAt(0).toUpperCase():"";const d=this.props.prefValues[_.kAddressBarExtensionsHiddenExtensions].includes(s);t.push((0,O.jsx)(f.ZP,{badgeColor:l,badgeBackgroundColor:r,badgeText:o,onClick:this.executeExtensionAction.bind(this,n.id),menu:this.getContextMenu.bind(this,n),tooltip:n.badgeTooltip||n.name||(0,y.Z)("Extension"),popupClassName:"extensionIconPopupMenu ToolbarButtonPopup-DefaultStyles",size:this.props.size,draggable:this.props.draggable||!1,className:A()(n.id,"ExtensionIcon","extensionId",{"ExtensionIcon--Hidden":!e&&d}),menuOrigin:this.props.menuOrigin,imagePath:i,popupPosition:this.props.popupPosition,ref:e=>{n&&e&&this._toolbarButtons.set(n.id,e)},onDragEnter:()=>{n&&this.onDragEnter(n.id)},onDragStart:this.stopPropagation,onDragEnd:this.stopPropagation,onDrop:this.onDrop,mimeType:L,name:n.id},n.id))}}return t};render(){if(!this.props.preview&&0===this.state.extensions.size)return R;const e=this.props.prefValues[_.kAddressBarExtensionsRenderInDropdown],t=this.props.prefValues[_.kAddressBarExtensionsShowAllToggle];return(0,O.jsx)(O.Fragment,{children:(0,O.jsxs)("div",{ref:this.refToolbar,className:"toolbar-extensions",children:[!this.props.preview&&this.renderExtensionButtons(),(this.props.preview||!e&&(t||!t&&this.hasHiddenExtensions()))&&this.renderExtensionToggleButton(),!this.props.preview&&e&&(t||this.hasHiddenExtensions()&&!t)&&this.renderHiddenExtensionInPopup(),this.state.popupId&&(0,O.jsx)("span",{children:(0,O.jsx)(o.Z,{ref:this.extensionActionPopupRef,extensionId:this.state.popupId,outsideClickIgnoreClass:"extensionId",popupVisible:this.state.popupVisible,popupPage:this.state.popupPage,popupPosition:this.props.popupPosition,popupWantsToClose:this.popupWantsToClose,popupRect:this.state.popupRect})})]})})}}const F=(0,d.Z)((0,l.ZP)(B),j)},46884:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});var n=s(94283),i=s(67294);function a(e,t,s="ignore-react-onclickoutside",a=!1){const{document:o,Element:r}=(0,i.useContext)(n.Z);(0,i.useEffect)((()=>{if(!a)return setTimeout((()=>{o.addEventListener("mousedown",n),o.addEventListener("pointerdown",n),o.addEventListener("touchstart",n)})),()=>{o.removeEventListener("mousedown",n),o.removeEventListener("pointerdown",n),o.removeEventListener("touchstart",n)};function n(n){const i=e(),a=t();if(!i||!a)return;let o=n.target;for(;o instanceof r;){const{classList:e}=o;if(Array.isArray(s)){if(s.some((t=>e.contains(t))))return}else if(e.contains(s))return;o=o.parentNode}n.target instanceof r&&!i.contains(n.target)&&a(n)}}),[r,a,o,t,e,s])}},74487:(e,t,s)=>{"use strict";s.d(t,{Z:()=>i});var n=s(67294);function i(e,t){const[s,i]=(0,n.useState)(e.getState());return(0,n.useEffect)((()=>{function s(){i(e.getState())}return e.addListener(s,t),()=>e.removeListener(s)}),[e,t]),s}},4668:(e,t,s)=>{"use strict";s.d(t,{BZ:()=>a,JX:()=>r,Ve:()=>o,up:()=>c});var n=s(83784),i=s(92292);function a(e){return e.replace(/["~*\/:<>?\\|\p{Cc}\p{Cf}]+/gu," ").replace(/^[ .]+|[ .]+$/g,"")}function o(e,t){d(l(e),a(e.filename),t)}function r(e){const t=l(e),s=a(e.filename);return{suggestedFilename:s,url:t,request:{deny:()=>URL.revokeObjectURL(t),allow:e=>d(t,s,e)}}}function l(e){const t=c(e);return URL.createObjectURL(t)}function d(e,t,s){i.Z.downloads.download({url:e,filename:t,saveAs:"saveas"===s},(t=>{URL.revokeObjectURL(e),"open"===s&&n.Z.addOpenAfterDownload(t)}))}function c(e){const t=e.content,s=e.mimeType;return new Blob([t],{type:s})}},88630:(e,t,s)=>{"use strict";s.d(t,{Z:()=>u});var n=s(62366),i=s(29087),a=s(10124),o=s(7064),r=s(70611),l=s(89175),d=s(78614);async function c(e,t){const s="string"==typeof t.content?await(0,a.Z)(t.content):t.content;return e.setContent(s)}function h(e){const t=e.method?`text/calendar; charset=utf-8; method=${e.method}`:"text/calendar; charset=utf-8";return c(new n.Z(t),e)}const u={build:async function(e,t,s){let a;const u=await(0,r.iT)(t),p=s.filter((e=>(e.mimeType.startsWith("multipart/")&&(e.mimeType="application/octet-stream"),"application/ics"===e.mimeType)));if("string"==typeof u){const e=new n.Z("text/plain; charset=utf-8");e.setContent(u),p.length?(a=new n.Z("multipart/alternative"),a.appendChild(e),a.appendChild(await h(p[0]))):a=e}else{const e=(0,r.yy)(t);a=new n.Z("multipart/alternative");const i=new n.Z("text/plain; charset=utf-8");i.setContent(e),a.appendChild(i);const o=s.filter((e=>e.id)),l=new n.Z("text/html; charset=utf-8");if(l.setContent(t),o.length>0){const e=new n.Z("multipart/related");e.appendChild(l);for(const t of o){const s=e.createChild(t.mimeType,{filename:t.filename});await c(s,t),s.setHeader("Content-Disposition","inline").setHeader("Content-Id",t.id)}a.appendChild(e)}else a.appendChild(l);p.length&&a.appendChild(await h(p[0]))}const g=s.filter((e=>!e.id));let m;if(g.length>0){m=new n.Z("multipart/mixed"),m.appendChild(a);for(const e of g){const t=m.createChild(e.mimeType,{filename:e.filename});t.setHeader("Content-Disposition","attachment"),await c(t,e)}}else m=a;return m.addHeader("message-id","<"+e.messageId+">"),m.addHeader("from",(0,d.Rz)(e.from)),m.addHeader("to",(0,d.Rz)(e.to)),m.addHeader("cc",(0,d.Rz)(e.cc)),m.addHeader("subject",e.subject),m.addHeader("date",new Date(e.sentDate).toUTCString().replace(/GMT/,"+0000")),e.inReplyTo&&e.inReplyTo.length>0&&m.addHeader("in-reply-to","<"+e.inReplyTo+">"),e.references&&e.references.length>0&&m.addHeader("references","<"+e.references.join("> <")+">"),e.listId&&m.addHeader("list-id",e.listId),e.listPost&&m.addHeader("list-post",e.listPost),i.Z.get(l.kMailIncludeIdentifyingHeaders)&&(m.addHeader("X-Mailer","Vivaldi Mail"),m.addHeader("User-Agent",`Vivaldi Mail/${o.Z.utilities.getVersion().vivaldiVersion}`)),m.build()}}},13933:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});const n=new class{#vn;set(e){this.#vn=e}getAndClear(){const e=this.#vn;return this.#vn=void 0,e}}},72494:(e,t,s)=>{"use strict";s.d(t,{Z:()=>Rt,K:()=>jt});var n=s(67294),i=s(36964),a=s(43630),o=s(59720),r=s(2711),l=s(65792),d=s.n(l),c=s(57082),h=s(4660),u=s(72010),p=s(3184),g=s(65093),m=s(99827),f=s(98611),v=s(54162),b=s(39005),C=s(94184),w=s.n(C),y=s(86088),x=s(48521);const I=function(e){const[t,s]=(0,n.useState)(!1);return t?null:(0,x.jsxs)("div",{className:w()("MailWarningMessage",e.type),children:[e.children,(0,x.jsx)("button",{className:"MailWarningMessage-Exit",onClick:()=>s(!0),children:(0,x.jsx)("span",{dangerouslySetInnerHTML:{__html:y.kze}})})]})};var A=s(60331),S=s(9304),Z=s(63153),T=s(94283),E=s(56371),k=s(98010),N=s(51540),_=s(30381),P=s.n(_),M=s(7064),D=s(78614),O=s(65741),j=s(97781),L=s(22288),R=s(29087),B=s(89175);const F={markup:"",style:"",prepend:!1};function W(e){const{markup:t,style:s,prepend:n}=e||F;return`{\n  let container = document.querySelector('.VIVcontainer');\n  if (!container) {\n    container = document.createElement('div');\n    container.className = 'VIVcontainer';\n  } else {\n    container.remove();\n  }\n  document.body.${n?"prepend":"append"}(container);\n  let style;\n  let content;\n  let shadowRoot;\n  if (!container.shadowRoot) {\n    style = document.createElement('style');\n    content = document.createElement('div');\n    content.className = 'shadowWrapper';\n    shadowRoot = container.attachShadow({ mode: 'open' });\n    shadowRoot.appendChild(style);\n    shadowRoot.appendChild(content);\n  } else {\n    shadowRoot = container.shadowRoot;\n    style = shadowRoot.querySelector('style');\n    content = shadowRoot.querySelector('div');\n  }\n  style.textContent = ${JSON.stringify(s)};\n  content.innerHTML = ${JSON.stringify(t)};\n  window.requestAnimationFrame(() => {\n    const styles = window.getComputedStyle(document.body);\n    const top = parseFloat(styles.marginTop) + parseFloat(styles.paddingTop);\n    const left = parseFloat(styles.marginLeft) + parseFloat(styles.paddingLeft);\n    const right = parseFloat(styles.marginRight) + parseFloat(styles.paddingRight);\n    container.style.marginTop = Math.floor(top * ${n?"-1":"0"}) + "px";\n    container.style.marginLeft = Math.floor(left * -1) + "px";\n    container.style.marginRight = Math.floor(top * -1) + "px";\n  })}`}class U extends n.PureComponent{static contextType=T.Z;refWebview=n.createRef();refContentBlockedToggle=n.createRef();state={leakPrevented:!1};componentDidUpdate(e){const{document:t}=this.context;if(!(0,O.Z)(e.style,this.props.style)){const e=S.ZP.createStyleRoot(this.props.style);this.refWebview.current?.executeScript({code:`\n        document.styleSheets[0].deleteRule(0);\n        document.styleSheets[0].insertRule("${e}", 0);\n        `})}const{textOrHtml:s,blockHTTPLeaks:n,bodyParts:i,isRss:a,renderingMethod:o,messageHeader:r}=this.props,{content:l,type:d}=s,c=this.refWebview.current,h=r.current?.props.listEntry.subject||"";let u=!1;if(e.textOrHtml!==s||!l&&e.inject!==this.props.inject||"html"===d&&e.blockHTTPLeaks!==n){let e,s=!1;if("raw"===o){const s=t.createTextNode(l),n=t.createElement("p");n.appendChild(s),e=`<html>${this.getDefaultStyle(!1)}<body>${n.innerHTML}</body></html>`}else if("html"===d){const t={};(i||[]).forEach((e=>{"attachment"===e.type&&e.id&&(t["cid:"+e.id]=e)}));const o=(0,j.Nw)(l,{attachments:t,blockHTTPLeaks:n});s=o.leakPrevented,e=a?this.getDefaultRssStyle()+o.sanitized:this.getDefaultStyle(!0)+this.getPrintHeaders()+o.sanitized}else e=`<html>${this.getDefaultStyle(!1)}<body>${this.getPrintHeaders()}${(0,N.Z)(l)}</body></html>`;this.setState({leakPrevented:s}),c?.executeScript&&(u=!0,c.executeScript({code:`document.open();\n          document.write(${JSON.stringify(e)});\n          document.title = ${JSON.stringify(h)};\n          document.close();`}))}(u||e.inject!==this.props.inject)&&c?.executeScript({code:W(this.props.inject)})}updateWebviewEventListeners=e=>{const t=this.refWebview.current,s=e;this.refWebview.current=s,t&&(t.removeEventListener("newwindow",this.handleNewWindow),t.removeEventListener("targeturlchanged",this.handleTargetURLChanged),t.removeEventListener("consolemessage",this.handleConsoleMessage),t.removeEventListener("fullscreen",this.handleOnFullscreen)),s&&(M.Z.zoom.getDefaultZoom((e=>s.setZoom(e))),s.addEventListener("newwindow",this.handleNewWindow),s.addEventListener("targeturlchanged",this.handleTargetURLChanged),s.addEventListener("consolemessage",this.handleConsoleMessage),s.addEventListener("fullscreen",this.handleOnFullscreen))};handleOnFullscreen=e=>{Z.Z.onHTML5FullScreen(e.enterFullscreen,this.context.vivaldiWindowId)};handleNewWindow=e=>{switch(e.preventDefault(),e.windowOpenDisposition){case"current_tab":case"new_foreground_tab":e.window.accept(this.context.vivaldiWindowId+";1");break;case"new_background_tab":e.window.accept(this.context.vivaldiWindowId+";0");break;case"new_window":Z.Z.openBrowserWindow(this.context.vivaldiWindowId,e.targetUrl);break;case"off_the_record":Z.Z.openBrowserWindow(this.context.vivaldiWindowId,e.targetUrl,{incognito:!0})}};handleTargetURLChanged=({newUrl:e})=>{const t=(0,k.ZP)(e);A.Z.setStatus(this.context.vivaldiWindowId,t)};handleConsoleMessage=e=>{const t=this.props.inject?.messageHandler;"function"==typeof t&&t(e)};getPrintHeaders=()=>{const e=this.props.messageHeader;if(!e.current)return"";const t=e.current.props.listEntry.subject||"",s=e.current.props.from,n=e.current.props.message?.to,i=e.current.props.message?.cc,a=e.current.props.message?.replyTo,o=e.current.props.message?.sentDate,r=e.current.state.attachments.map((e=>e.filename)).join(", ");return`<div class="print-only">\n      <table>\n        ${[[(0,E.Z)("Subject"),t],[(0,E.Z)("Date"),o?P()(o).format("LLLL (Z)"):""],[(0,E.Z)("Mail","From"),s&&(0,D.aD)(s)],[(0,E.Z)("To"),n&&(0,D.aD)(n)],[(0,E.Z)("Cc"),i&&(0,D.aD)(i)],[(0,E.Z)("Reply To"),a&&(0,L.$8)(a,s,this.props.fromAddress)&&(0,D.aD)(a)],[(0,E.Z)("Attachments"),r]].filter((e=>e)).map((([e,t])=>t?`<tr key=${e}>\n              <td>${e}</td>\n              <td>${t}</td>\n            </tr>`:"")).join("")}\n      </table>\n    </div>`};getDefaultStyle=e=>{const t=R.Z.get(B.kMailColorQuotedText);return`<style type="text/css">\n    ${S.ZP.createStyleRoot(this.props.style)}\n    html {\n      overflow-y: auto;\n    }\n    body {\n      ${e?"":"white-space: pre-wrap;"}\n      ${e?"":"overflow-wrap: break-word;"}\n      color: ${e?"black":"var(--colorFgIntense)"};\n      background-color: ${e?"white":"var(--colorBgIntense)"};\n      font-family: ${e?"sans-serif":"monospace"};\n      margin: 18px;\n      line-height: 1.3;\n      height: auto !important;\n      min-height: calc(100% - 48px);\n    }\n    .VIVcontainer {\n      all: initial;\n      display: block;\n    }\n    .blockquote {\n      border-left: 2px solid;\n      margin: 6px 0;\n      padding: 0 0 0 9px;\n      border-left-color: var(--quoteLvl1);\n      ${t?"color: var(--quoteLvl1);":""}\n    }\n    .blockquote .blockquote {\n      border-left-color: var(--quoteLvl2);\n      ${t?"color: var(--quoteLvl2);":""}\n    }\n    .blockquote .blockquote .blockquote {\n      border-left-color: var(--quoteLvl3);\n      ${t?"color: var(--quoteLvl3);":""}\n    }\n    ${e?"":"a { color: var(--colorHighlightBg); }"}\n    .print-only {display: none}\n    @media print {\n      .print-only {\n        display: block;\n        table {\n          margin-top: 6px;\n          display: flex;\n        }\n        tr {\n          td:first-child {\n            font-weight: 700;\n            white-space: nowrap;\n            display: flex;\n            align-items: flex-start;\n          }\n        }\n      }\n    }\n    </style>`};getDefaultRssStyle=()=>`<style type="text/css">\n    ${S.ZP.createStyleRoot(this.props.style)}\n    html {\n      background: var(--colorBgIntense);\n      color: var(--colorFgIntense);\n      font-family: sans-serif;\n      overflow-y: auto;\n    }\n    body {\n      margin: 24px;\n      height: auto !important;\n      min-height: calc(100% - 48px);\n    }\n    body > main {\n      font-size: initial;\n      /* feeds should not be using these variables */\n      /* prevent the feed from copying a custom theme for phishing */\n      --colorBg: white;\n      --colorFg: black;\n    }\n    body > main a {\n      color: var(--colorHighlightBg);\n    }\n    body > nav ul.mainbutton a {\n      display: inline-block;\n      padding: 0.3em 12px;\n      font-size: initial;\n      color: var(--colorHighlightFg);\n      background-color: var(--colorHighlightBg);\n      border-radius: 4px;\n    }\n    body > nav ul.mainbutton::after {\n      content: "";\n      display: block;\n      border-bottom: 1px solid var(--colorBorder);\n      height: 0.7em;\n      opacity: 0.3;\n    }\n    body > nav h2,\n    body > section h2 {\n      font-weight: normal;\n      font-size: larger;\n    }\n    body > nav h2::after,\n    body > section h2::after {\n      content: ":";\n    }\n    body > nav ul,\n    body > nav li {\n      display: block;\n      margin-left: 0;\n      padding-left: 0;\n    }\n    body > nav a {\n      color: var(--colorHighlightBg);\n      text-decoration: none;\n    }\n    body > section img,\n    body > section video,\n    main img,\n    main video,\n    main image,\n    main image,\n    main object,\n    main embed {\n      max-width: 100%;\n      /* allow default image ratio to work in cases where height has been set */\n      height: auto !important;\n    }\n    main iframe {\n      border: none;\n      max-width: 100%;\n    }\n    body > footer {\n      opacity: 0.5;\n    }\n\n    div.video-wrapper {\n      background: #111;\n      margin-left: -24px;\n      margin-top: -24px;\n      margin-right: -24px;\n      margin-bottom: 24px;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n    }\n\n    div.video-wrapper iframe {\n      --cinema-mode-height: 40vw;\n      height: var(--cinema-mode-height);\n      width: calc(var(--cinema-mode-height) / .5625);\n      min-height: 320px;\n      max-height: 100vh;\n    }\n\n    div.preformatted {\n      white-space: pre-wrap;\n    }\n\n    /* Overrides for specific feed issues */\n    main figure[style*="width"] {\n      /* WordPress hard codes a width which creates scrollbars.\n      Max-width does not fix it because of the default margin.\n      Fix it without breaking feeds that have floating figures. Assume that if\n      a figure has a style attribute with width, it is probably not well\n      styled, and width should be ignored. */\n      width: auto !important;\n    }\n    </style>`;handleLoadExternalContentClicked=()=>{const e=this.refContentBlockedToggle.current?.checked??!1;this.props.onUnblockExternalContent(e)};showOriginalHTML=()=>{b.Z.toggleRenderingMethod("prefer_html")};render(){const{fromAddress:e}=this.props,{leakPrevented:t}=this.state,{convertedFromHtml:s=!1}=this.props.textOrHtml,n=[];return this.props.shouldWarnUserFrom&&n.push((0,E.Z)('More than one "From" address detected.')),this.props.shouldWarnUserFromName&&n.push((0,E.Z)('"From" name looks like an email address.')),(0,x.jsxs)(x.Fragment,{children:[s&&(0,x.jsxs)("div",{className:"mail-content-blocked",children:[(0,x.jsx)("div",{className:"content-blocked-text",children:(0,E.Z)("This message was converted from HTML.")}),(0,x.jsx)("input",{className:"content-blocked-action",type:"button",onClick:this.showOriginalHTML,value:(0,E.Z)("Show original HTML version")})]}),n.length>0&&(0,x.jsx)(I,{type:"danger",children:(0,x.jsxs)("div",{className:"content-blocked-text",children:[n.length>1?(0,x.jsx)("ul",{children:n.map((e=>(0,x.jsx)("li",{children:e},e)))}):n[0]+" ",(0,E.Z)("Someone may be trying to hide their identity (spoofing) to phish for information. Be careful of links you click.")]})}),this.props.shouldWarnUserReplyTo&&(0,x.jsx)(I,{type:"warning",children:(0,x.jsx)("div",{className:"content-blocked-text",children:(0,E.Z)('"Reply To" does not match the "From" address. Make sure you trust the "Reply To" address before replying.')})}),t&&(0,x.jsxs)("div",{className:"mail-content-blocked",children:[(0,x.jsx)("div",{className:"content-blocked-text",children:(0,E.Z)("This message was prevented from loading external content.")}),(0,x.jsxs)("label",{title:(0,E.Z)("Always allow $1",[e]),className:"content-blocked-toggle-container",children:[(0,x.jsx)("input",{className:"content-blocked-toggle",ref:this.refContentBlockedToggle,type:"checkbox"}),(0,x.jsx)("span",{className:"content-blocked-toggle-text",children:(0,E.Z)("Always allow $1",[e])})]}),(0,x.jsx)("input",{className:"content-blocked-action",type:"button",title:(0,E.Z)("Load External Content"),onClick:this.handleLoadExternalContentClicked,value:(0,E.Z)("Load External Content")})]}),(0,x.jsx)("div",{className:"mail_body",children:(0,x.jsx)("section",{children:(0,x.jsx)("webview",{tabIndex:"0",name:"vivaldi-mail",ref:this.updateWebviewEventListeners,src:"data:text/html,<html/>"})})})]})}}const V=U;var H=s(88630),G=s(92292),K=s(11430),z=s(99895),$=s(82786),Y=s(76257),X=s(70611),Q=s(3664);async function q(e){const{mimeTree:t,raw:s}=await K.Z.getMimeTree(e);return new J(t,s)}class J{#bn;constructor(e,t){this.lock=(0,$.M)(),this.mimeTree=e,this.#bn=t}async getRaw(){let e;const t=await this.lock();try{e=this.#bn}finally{t()}return e}async getByteString(){let e="";const t=await this.lock();try{e=(0,Q.DA)(this.#bn)}finally{t()}return e}async parse(e){let t=[];const s=await this.lock();try{const n=await K.Z.parseMail(this.#bn,e);t=n.bodyParts,this.#bn=n.raw}finally{s()}return t}#Cn;async parseAttachments(){if(this.#Cn)return this.#Cn;const e=[],t=(0,Y.Dc)(this.mimeTree);for(const s of t){(await this.parse(s.mimeTree)).forEach((t=>{"attachment"===t.type&&e.push(t)}))}return this.#Cn=e,e}async getDeliveryHeaders(){let e={};const t=await this.lock();try{e=(0,Y.Ao)(this.#bn)}finally{t()}return e}async parseCalendar(){let e;const t=(0,Y.fN)(this.mimeTree);if(t){const s=await this.parse(t.mimeTree);s.length&&(e=s[0])}return e}#wn;#yn;async parseMainPart(e){if(this.#wn&&this.#yn===e)return this.#wn;let t=(0,Y.yQ)(this.mimeTree,e);0===t.length&&"plaintext"===e&&(t=(0,Y.yQ)(this.mimeTree,"prefer_html"));const s=[],n=[];for(const i of t){let[t]=await this.parse(i.mimeTree);if(t)if("html"===t.type){if("plaintext"===e)t={type:"text",content:(0,X.yy)(t.content),convertedFromHtml:!0};else{const e=(0,Y.Wh)(this.mimeTree);for(const t of e){(await this.parse(t.mimeTree)).forEach((e=>{"attachment"===e.type&&n.push(e)}))}}s.push(t)}else"text"===t.type&&s.push(t)}let i;return 1===s.length?i=s[0]:s.length>1&&(i=s.every((e=>"text"===e.type))?{type:"text",content:s.map((e=>e.content)).join("\n"),convertedFromHtml:s.some((e=>"text"===e.type&&e.convertedFromHtml))}:{type:"html",content:s.map((e=>"text"===e.type?`<pre>${e.content}</pre>`:e.content)).join("\n")}),this.#yn=e,this.#wn=n.concat(i??[]),this.#wn}async parseSearchPart(){const e=(0,Y.PW)(this.mimeTree);if(!e)return[];let t=[];const s=await this.lock();try{const n=await K.Z.parseMail(this.#bn,e.mimeTree);t=n.bodyParts,this.#bn=n.raw}finally{s()}return t}async saveAs(e){const t=await this.lock(),s=new Blob([this.#bn],{type:"message/rfc822"}),n=URL.createObjectURL(s);G.Z.downloads.download({url:n,filename:e,saveAs:!0},(()=>{URL.revokeObjectURL(n),t()}))}async writeBufferToDisk(e,t,s){const n=await this.lock();try{await z.Z.call(e,t,s,this.#bn)}finally{n()}}}var ee=s(50522),te=s(51525),se=s(15800),ne=s(46382),ie=s(45660),ae=s(15805),oe=s(74487),re=s(5863),le=s(25765),de=s(34006),ce=s(6142),he=s(8336),ue=s(21788),pe=s(47995),ge=s(72882),me=s(80837),fe=s(81009),ve=s(95032),be=s(59322),Ce=s(18350),we=s(47380),ye=s(26036),xe=s(73132),Ie=s(44850);class Ae extends n.Component{static contextType=T.Z;winId=this.context.vivaldiWindowId;state={activeItemIndex:-1,openDropdownMenu:!1,contact:this.props.mailAddress?u.Z.getContactsWithAddress(this.props.mailAddress.address):void 0,status:""};componentDidMount(){this.props.mailAddress&&u.Z.addListener(this.contactChanged)}componentDidUpdate(e){Boolean(this.props.mailAddress)!==Boolean(e.mailAddress)&&(this.props.mailAddress?u.Z.addListener(this.contactChanged):u.Z.removeListener(this.contactChanged))}componentWillUnmount(){this.props.mailAddress&&u.Z.removeListener(this.contactChanged)}contactChanged=()=>{if(this.props.mailAddress){const e=this.props.mailAddress.address.toLowerCase(),t=this.state.contact&&u.Z.getNodeById(this.state.contact.id);t?.emailAddresses.some((t=>t.emailAddress.toLowerCase()===e))?this.setState({contact:t}):this.setState({contact:u.Z.getContactsWithAddress(e)})}};onClickDropdown=()=>{this.setState((e=>({openDropdownMenu:!e.openDropdownMenu})))};closeMenu=()=>{this.setState({activeItemIndex:-1,openDropdownMenu:!1})};handleKeyDown=e=>{switch(e.key){case"Escape":case"Tab":this.closeMenu();break;case"Enter":case"Space":if(e.stopPropagation(),e.preventDefault(),this.state.activeItemIndex>-1){const e=this.getDropdownMenuItems()[this.state.activeItemIndex];e.onSuccessText?e.handler().then((()=>this.onMenuItemClicked(e.onSuccessText)),(()=>this.onMenuItemClicked(e.onErrorText))):(e.handler(),this.closeMenu())}else this.props.onClick();break;case"ArrowUp":this.setState((e=>{const t=e.activeItemIndex-1;if(t>-1)return{activeItemIndex:t}}));break;case"ArrowDown":this.setState((e=>{const t=e.activeItemIndex+1;if(t<this.getDropdownMenuItems().length)return{openDropdownMenu:!0,activeItemIndex:t}}))}};onMenuItemClicked=e=>{this.statusTimeout&&clearTimeout(this.statusTimeout);this.setState({status:e}),this.closeMenu(),this.statusTimeout=setTimeout((()=>this.setState({status:""})),1e3)};contactOrAddressString=()=>this.props.mailAddress&&this.state.contact&&!this.state.contact.generatedFromSentMail?this.state.contact.name?this.state.contact.name+" <"+this.props.mailAddress.address+">":this.props.mailAddress.address:this.props.buttonTitle;onEditContact=e=>{if(!e)return;const t=this.context.vivaldiWindowId;Ce.Z.showContent(t,"PanelContacts",{setFocus:!0,selectId:e.id,reason:"edit"}),m.Z.selectContactById(t,e.id),be.ZP.openURL(t,Ie.jk.internals.mailpage,{singleton:!0})};onAddContact=e=>{const t=this.context.vivaldiWindowId;Ce.Z.showContent(t,"PanelContacts"),h.Z.newContactFromMailAddress(e,!0),m.Z.selectContactByAddress(t,e.address),be.ZP.openURL(t,Ie.jk.internals.mailpage,{singleton:!0})};getDropdownMenuItems=()=>{if(this.props.mailAddress){const e=this.props.mailAddress;return this.state.contact?[...this.props.dropdownMenuItems,{...(0,ye.Z)("Edit contact"),handler:this.onEditContact.bind(this,this.state.contact)}]:[...this.props.dropdownMenuItems,{...(0,ye.Z)("Add to contacts"),handler:this.onAddContact.bind(this,e)}]}return this.props.dropdownMenuItems};onContextMenu=e=>{const t=this.getDropdownMenuItems().map((e=>({label:e.label,labelEnglish:e.labelEnglish,handler:e.handler})));(0,we.Z)(this.context,t)(e)};render(){return(0,x.jsx)("div",{className:"button-with-dropdown-wrapper",children:(0,x.jsxs)("div",{className:"button-with-dropdown-container",onMouseLeave:this.closeMenu,title:this.contactOrAddressString(),onContextMenu:this.onContextMenu,children:[(0,x.jsxs)("button",{onKeyDown:this.handleKeyDown,tabIndex:this.props.prefValues[B.kKeyboardTabToAll],onClick:this.props.onClick,children:[this.state.contact&&(0,x.jsx)("img",{src:this.state.contact.avatarUrl||xe.g}),(0,x.jsx)("span",{children:this.contactOrAddressString()})]}),(0,x.jsx)("button",{tabIndex:-1,onMouseDown:this.onClickDropdown,dangerouslySetInnerHTML:{__html:y.yaZ.medium}}),this.state.openDropdownMenu&&(0,x.jsx)("ul",{className:"dropdown-menu",children:this.getDropdownMenuItems().map(((e,t)=>(0,x.jsx)("li",{onMouseUp:e.onSuccessText?()=>e.handler().then((()=>this.onMenuItemClicked(e.onSuccessText)),(()=>this.onMenuItemClicked(e.onErrorText))):()=>{e.handler&&e.handler(),this.closeMenu()},className:this.state.activeItemIndex===t?"active":void 0,children:e.label},e.label)))}),this.state.status&&(0,x.jsx)("div",{className:"status",children:this.state.status})]})})}}const Se=Ae;class Ze extends n.PureComponent{static contextType=T.Z;nodeRef=n.createRef();state={maxShown:5};onClickAddress=e=>{e.address&&a.Z.enableCorrespondentView(this.context.vivaldiWindowId,e.address)};render(){const e=this.state.maxShown,t=this.props.mailAddresses;return(0,x.jsxs)("span",{ref:this.nodeRef,className:"detail",children:[t.slice(0,e).map(((e,t)=>{const s=(0,D.li)(e),n=[{...(0,ye.Z)("Copy address"),handler:()=>ue.Z.copyTextToClipboard(s),onSuccessText:(0,E.Z)("Copied to clipboard",[s]),onErrorText:(0,E.Z)("Failed to copy address")},{...(0,ye.Z)("See messages to and from address"),handler:this.onClickAddress.bind(this,e)}];return(0,x.jsx)(Se,{prefValues:this.props.prefValues,onClick:this.onClickAddress.bind(this,e),mailAddress:e,buttonTitle:s,dropdownMenuItems:n},s+String(t))})),t.length>this.state.maxShown&&(0,x.jsx)("a",{tabIndex:this.props.prefValues[B.kKeyboardTabToAll],onClick:()=>this.setState({maxShown:t.length}),children:(0,E.Z)("... $1 more","... $1 more",[t.length-this.state.maxShown,t.length-this.state.maxShown])},"more"),5!==this.state.maxShown&&(0,x.jsx)("a",{tabIndex:this.props.prefValues[B.kKeyboardTabToAll],onClick:()=>this.setState({maxShown:5}),children:(0,E.Z)("Show less")},"Show less")]},"detail"+t.toString())}}const Te=Ze;var Ee=s(15285),ke=s(78347),Ne=s(84283),_e=s(95752),Pe=s(54773),Me=s(10124),De=s(4668),Oe=s(49168),je=s(86461),Le=s(59275);const Re=[B.kDownloadsNotifyOnComplete,B.kDownloadsOpenPanelOnNew,B.kDownloadsStartAutomatically,B.kKeyboardTabToAll],Be=(0,E.Z)("Reply To"),Fe=(0,E.Z)("mail","From");function We(e){return e?P()(e).format("LLL"):""}var Ue=(0,x.jsx)("span",{children:"→"},"separator");function Ve(e){const t=new Map,s=new Map;return e.forEach(((e,s)=>{const n=f.Z.get(s);if(!n)return;const{accountId:i,name:a}=n;let o=t.get(i);if(o||(o={internal:[],external:[]},t.set(i,o)),e.deleted&&e.internal){const e=o.internal;e.length>0&&e.push((0,x.jsx)("span",{children:", "},s+"nbsp")),e.push((0,x.jsx)("span",{style:{textDecoration:"line-through"},children:(0,Le.e)(a)},s))}else{const e=o.external;e.length>0&&e.push((0,x.jsx)("span",{children:", "},s)),e.push((0,Le.e)(a))}})),t.forEach((({internal:e,external:t},n)=>{s.set(n,[...e,...e.length>0?[Ue]:[],...0===t.length?[(0,E.Z)("Local Copy")]:[],...t])})),s}var He=(0,x.jsx)("span",{className:"label",children:Fe}),Ge=(0,x.jsx)("span",{className:"label",children:Be}),Ke=(0,x.jsx)("span",{className:"spacer"});class ze extends n.PureComponent{static contextType=T.Z;refWebpagecontainer=n.createRef();refSubject=n.createRef();refFrom=n.createRef();refTo=n.createRef();refDate=n.createRef();constructor(e){let t;super(e);let s=[];b.Z.getActiveListEntry()===e.listEntry&&(s=b.Z.getAttachments(),t=b.Z.getRaw()),this.state={attachments:s,dialogParentElement:void 0,customData:null,maxShownAttachments:5,raw:t,deliveredTo:[]}}componentDidMount(){b.Z.addListener(this.activeMessageStoreChanged)}componentWillUnmount(){b.Z.removeListener(this.activeMessageStoreChanged)}activeMessageStoreChanged=()=>{if(b.Z.getActiveListEntry()===this.props.listEntry){const e=b.Z.getAttachments(),t=b.Z.getRaw();t&&(async()=>{const e=await(t?.getDeliveryHeaders())||{};let s=[];const n=e["delivered-to"]||e["x-delivered-to"]||e["x-resolved-to"];n&&(s=[...(0,D.D$)("string"==typeof n?n:n.join(","))]),b.Z.getActiveListEntry()===this.props.listEntry&&this.setState({deliveredTo:s})})(),this.setState({attachments:e,raw:t})}};async maybeParse(e){if("attachment"===e.type){const t=e.content;return"string"==typeof t?{...e,content:await(0,Me.Z)(t)}:{...e,content:t}}if(this.state.raw){const[t]=await this.state.raw.parse(e.mimeTree);if(t&&"attachment"===t.type)return t}}async onClickAttachment(e,t){const s=await this.maybeParse(t),n=e.detail%2==0;if(s&&!n)if(this.props.prefValues[B.kDownloadsStartAutomatically]){if((0,De.Ve)(s),this.props.prefValues[B.kDownloadsOpenPanelOnNew]){const e=this.context.vivaldiWindowId,t="PanelDownloads";(0,je.PK)("DownloadButton",e)?pe.Z.executeActions("event",this.context,"COMMAND_SHOW_DOWNLOADS_POPOUT"):Ee.ZP.canAutoOpen(e,t)&&Ce.Z.toggleContent(e,t)}}else this.showDialog((0,De.JX)(s))}async onClickAttachmentDropdown(e,t){const s=await this.maybeParse(e);if(!s)return;(0,De.Ve)(s,t);const n=this.context.vivaldiWindowId,i="PanelDownloads";this.props.prefValues[B.kDownloadsOpenPanelOnNew]&&Ee.ZP.canAutoOpen(n,i)&&Ce.Z.toggleContent(n,i)}onClickDownloadAll=async e=>{const t=e.detail%2==0;if(!this.state.raw||t)return;(await this.state.raw.parseAttachments()).forEach((e=>(0,De.Ve)(e)))};onClickSaveAll=e=>{const{raw:t}=this.state,s=e.detail%2==0;t&&!s&&this.context.chrome.fileSystem.chooseEntry({type:"openDirectory"},(e=>{const s=G.Z.runtime.lastError;s?"User cancelled"!==s.message&&ie.Z.error("Mail",["attachments"],"Error saving attachments",s.message||s):e?G.Z.fileSystem.getWritableEntry(e,(s=>{const n={create:!0};t.parseAttachments().then((t=>{for(const e of t){const t=(0,De.up)(e);s.getFile((0,De.BZ)(e.filename),n,(e=>{e.createWriter((e=>{e.write(t)}))}))}if(this.props.prefValues[B.kDownloadsNotifyOnComplete]){const t=new Notification(this.props.fromAddress,{body:(0,E.Z)("Attachments have been saved to $1",e.name),icon:"resources/mail_notification_icon.png"});setTimeout((()=>t.close()),re.QM)}}))})):ie.Z.error("Mail",["attachments"],"Error saving attachments, directory entry missing")}))};onClickSubject=()=>{a.Z.enableThreadedView(this.context.vivaldiWindowId)};_toggleSenderAsMailingList=()=>{this.props.fromAddress&&m.Z.toggleSenderAsMailingList(this.context.vivaldiWindowId,this.props.fromAddress)};_copyHeader=()=>{const{from:e,listEntry:t,message:s}=this.props,{sentDate:n,subject:i}=t,a=s?s.to:Pe.Z.get(t.toIds),{cc:o=[],bcc:r=[]}=s||{},l=[[(0,E.Z)("mail","From"),e],[(0,E.Z)("To"),a],[(0,E.Z)("Cc"),o],[(0,E.Z)("Bcc"),r]];let d=i+"\n"+We(n);for(const[e,t]of l)t.length>0&&(d+=`\n${e}: ${(0,D.Rz)(t)}`);d+="\n",ue.Z.copyTextToClipboard(d)};getContextMenuItemsPromise=(e,t)=>{const s=this.context.vivaldiWindowId,n=ge.Z.getOptionFunction(e);return ge.Z.getNamedMenu(s,e,(async e=>{switch(e.action){case"COMMAND_PAGE_BACK":return{isVisible:()=>v.Z.canGoBack(),...n(s,e,{})};case"COMMAND_PAGE_FORWARD":return{isVisible:()=>v.Z.canGoForward(),...n(s,e,{})};case"CONTEXT_COPY":return{handler:this._copyHeader,...n(s,e,{})};case"COMMAND_TAB_VIEW_PAGE_SOURCE":return{checked:"raw"===this.props.renderingMethod,...n(s,e,{})};case"CONTEXT_SENDER_IS_MAILING_LIST":return{handler:this._toggleSenderAsMailingList,checked:f.Z.isSenderMailingList(this.props.fromAddress),...n(s,e,{})};default:return{...n(s,e,{})}}}))};handleOnCloseDialog=()=>{this.setState({dialogParentElement:void 0})};showDialog=e=>{this.setState({dialogParentElement:this.refWebpagecontainer.current,customData:e})};onHeaderContextMenu=e=>(e.persist(),e.preventDefault(),e.stopPropagation(),this.getContextMenuItemsPromise("mailheader",e).then((t=>{(0,we.Z)(this.context,t)(e)})),!1);onAttachmentContextMenu=(e,t)=>{(0,we.Z)(this.context,e)(t)};renderAttachmentButtons=(e,t)=>e.slice(0,t).map(((e,t)=>{const s=[{...(0,ye.Z)("Save"),handler:()=>this.onClickAttachmentDropdown(e)},{...(0,ye.Z)("Save As"),handler:()=>this.onClickAttachmentDropdown(e,"saveas")}];return(0,x.jsx)("button",{className:"attachment-button",onClick:t=>this.onClickAttachment(t,e),title:e.filename,tabIndex:this.props.prefValues[B.kKeyboardTabToAll],onContextMenu:this.onAttachmentContextMenu.bind(this,s),children:e.filename},e.filename+String(t))}));renderSubjectButton=e=>(0,x.jsx)(Se,{prefValues:this.props.prefValues,onClick:this.onClickSubject,buttonTitle:e,dropdownMenuItems:[{...(0,ye.Z)("Copy subject"),handler:()=>ue.Z.copyTextToClipboard(e),onSuccessText:(0,E.Z)("Copied to clipboard"),onErrorText:(0,E.Z)("Failed to copy subject")},{...(0,ye.Z)("See message thread"),handler:this.onClickSubject}]});render(){const{listEntry:e,message:t}=this.props,{sentDate:n,sources:i,subject:a}=e,{cc:o=[],bcc:r=[],replyTo:l=[]}=t||{};let d=t?t.to:Pe.Z.get(e.toIds),c=!1;0===r.length&&(2===d.length&&d[0].address.startsWith("undisclosed-recipients@")||0===d.length&&0===o.length)&&(2===d.length&&(d=[]),c=!0);const h=(0,Oe.Zr)(e.flags).toLowerCase(),u=Ve(i);return(0,x.jsxs)("header",{onContextMenu:this.onHeaderContextMenu,className:w()({"mail-detail-header":!0,"is-unread":_e.Z.call(i)}),children:[this.state.dialogParentElement&&this.state.customData&&(0,x.jsx)(me.Z,{customData:this.state.customData,onClose:this.handleOnCloseDialog}),a&&(0,x.jsx)("h1",{className:"subject",ref:this.refSubject,children:this.renderSubjectButton(a)}),(0,x.jsxs)("div",{className:"mail-indicators",children:[Ne.Z.isMessageDeleted(i)&&(0,x.jsx)("span",{className:"mail-status-indicator read-status trash",style:{display:"flex"},dangerouslySetInnerHTML:{__html:y.nre.small}}),(0,Oe.XN)(this.props.listEntry)&&(0,x.jsx)("span",{className:"mail-status-indicator",dangerouslySetInnerHTML:{__html:y.upG.small}}),(0,Oe.B_)(this.props.listEntry)&&(0,x.jsx)("span",{className:"mail-status-indicator",dangerouslySetInnerHTML:{__html:y.hGk.small}}),h&&(0,x.jsx)("span",{className:`flag-color flag-${h}`,title:(0,E.Z)("Flagged"),dangerouslySetInnerHTML:{__html:y.nyn.small}})]}),(0,x.jsxs)("div",{className:"mail-details",children:[(0,x.jsxs)("div",{ref:this.refWebpagecontainer,className:"mail-detail-main",children:[He,(0,x.jsx)(Te,{ref:this.refFrom,prefValues:this.props.prefValues,mailAddresses:this.props.from}),(0,L.$8)(l,this.props.from,this.props.fromAddress)&&(0,x.jsxs)(x.Fragment,{children:[Ge,(0,x.jsx)(Te,{prefValues:this.props.prefValues,mailAddresses:l})]}),d.length>0&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("span",{className:"label",children:(0,E.Z)("To")}),(0,x.jsx)(Te,{ref:this.refTo,prefValues:this.props.prefValues,mailAddresses:d})]}),o.length>0&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("span",{className:"label",title:(0,E.Z)("Carbon copy"),children:(0,E.Z)("Cc")}),(0,x.jsx)(Te,{prefValues:this.props.prefValues,mailAddresses:o})]}),r.length>0&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("span",{className:"label",title:(0,E.Z)("Blind carbon copy"),children:(0,E.Z)("Bcc")}),(0,x.jsx)(Te,{prefValues:this.props.prefValues,mailAddresses:r})]}),c&&this.state.deliveredTo.length>0&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("span",{className:"label",title:(0,E.Z)("Delivered to likely means you were added as a bcc recipient"),children:(0,E.Z)("Delivered To")}),(0,x.jsx)(Te,{prefValues:this.props.prefValues,mailAddresses:this.state.deliveredTo})]}),(e.attachment>0||this.state.attachments.length>0)&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("span",{className:"label",title:(0,E.Z)("Attachment"),dangerouslySetInnerHTML:{__html:s(51843)}}),(0,x.jsxs)("span",{className:"detail attachments",children:[this.renderAttachmentButtons(this.state.attachments,this.state.maxShownAttachments),this.state.attachments.length>this.state.maxShownAttachments&&(0,x.jsx)("a",{tabIndex:this.props.prefValues[B.kKeyboardTabToAll],onClick:()=>this.setState((e=>({maxShownAttachments:e.attachments.length}))),children:(0,E.Z)("... $1 more","... $1 more",[this.state.attachments.length-this.state.maxShownAttachments,this.state.attachments.length-this.state.maxShownAttachments])}),this.state.attachments.length>1&&(0,x.jsx)("button",{className:"attachment-button",href:"#",onClick:this.onClickSaveAll,children:(0,E.Z)("attachments","Save All")}),this.state.attachments.length>1&&(0,x.jsx)("button",{className:"attachment-button",href:"#",onClick:this.onClickDownloadAll,children:(0,E.Z)("attachments","Download All")})]})]}),(0,Oe.OK)(e.flags)&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("span",{className:"label",children:(0,E.Z)("Label")}),(0,x.jsx)("div",{className:"adjustment-mail-labels",children:(0,x.jsx)(ve.Z,{flags:e.flags})})]}),Ke]}),(0,x.jsxs)("div",{className:"mail-detail-side",children:[!u.has(re.u4)&&[...u.entries()].map((([e,t])=>(0,x.jsxs)("div",{className:"mail-detail-item",children:[t,Object.keys(ke.Z.getAccounts()).length>1&&(0,x.jsx)("span",{className:"mail-detail-item-accountId",children:e})]},e))),(0,x.jsx)("div",{className:"mail-detail-item mail-detail-item-date",ref:this.refDate,children:We(n)})]})]})]})}}const $e=(0,fe.Z)(ze,Re);var Ye=s(47543);const Xe={title:"",calendarId:"",is_template:!1},Qe={markup:"",style:"",prepend:!1},qe=new TextDecoder("utf-8",{fatal:!0}),Je={ACCEPTED:{existing:(0,E.Z)("You have accepted the invite"),update:(0,E.Z)("You accepted the previous invite")},DECLINED:{existing:(0,E.Z)("You have declined the invite"),update:(0,E.Z)("You declined the previous invite")},TENTATIVE:{existing:(0,E.Z)("You have tentatively accepted the invite"),update:(0,E.Z)("You tentatively accepted the previous invite")},"NEEDS-ACTION":{existing:(0,E.Z)("You still have to reply to the invite"),update:(0,E.Z)("You did not reply to the previous invite")},DECLINECOUNTER:{existing:(0,E.Z)("You have declined the counter proposal"),update:""},DELEGATED:{existing:(0,E.Z)("You delegated invite to another person"),update:(0,E.Z)("You delegated previous invite to another person")}};function et(e){return(0,j.Nw)((0,N.Z)(e).replace(/\n/g,"<br />")).sanitized}function tt(e){return S.ZP.createStyleRoot(e)+"\n  .shadowWrapper {\n    padding: 18px;\n  }\n  .Event {\n    color: var(--colorFg);\n    background-color: var(--colorBgIntense);\n    font-family: system-ui, sans-serif;\n    font-size: 13px;\n    font-weight: 400;\n    border: 1px solid var(--colorBorder);\n    border-radius: var(--radius);\n  }\n  .Event-Message {\n    padding: 12px;\n    display: flex;\n    flex-direction: row;\n    justify-content: space-between;\n    border-bottom: 1px solid var(--colorBorder);\n    align-items: center;\n  }\n  .Event-Rsvp {\n    margin-bottom: 12px;\n    padding: 6px 12px;\n    display: flex;\n    flex-direction: row;\n    justify-content: space-between;\n    align-items: center;\n    background-color: var(--colorBg);\n    border-bottom: 1px solid var(--colorBorder);\n  }\n  .Event-Error {\n    margin: 0 6px;\n    padding: 12px;\n    display: flex;\n    flex-direction: row;\n    justify-content: space-between;\n    background-color: var(--colorErrorBg);\n    border-bottom: 1px solid var(--colorBorder);\n    align-items: start;\n    font-weight: 700;\n    color: var(--colorErrorFg);\n  }\n  .Event-Title {\n    font-size: 16px;\n    margin: 12px;\n    color: var(--colorFgIntense);\n  }\n  .Event-Title--Previous {\n    font-size: 16px;\n    margin: 0;\n    font-weight: normal;\n  }\n  .Event-Title--Changed {\n    text-decoration: line-through;\n  }\n  .Event-Props {\n    display: grid;\n    grid-template-columns: max-content 1fr;\n    gap: 6px 18px;\n    margin: 12px;\n  }\n  .Event-Props--Diff {\n    grid-template-columns: max-content 1fr 1fr;\n  }\n  .Event-Props--Diff .Event-Title {\n    margin: 0;\n  }\n  .Event-Prop--Previous p {\n    text-decoration: line-through;\n  }\n  .Event-Prop--Previous p.Event-Attendee--Exists {\n    text-decoration: none;\n  }\n  span {\n    flex: 1 1 auto;\n  }\n  input[type=button] {\n    padding: 6px 18px;\n    margin-left: 6px;\n    color: var(--colorFgIntense);\n    background-color: var(--colorBgIntense);\n    border: 1px solid var(--colorBorder);\n    border-radius: var(--radius);\n    font-size: 14px;\n  }\n  input[type=button]:enabled:hover {\n    background-image: linear-gradient(var(--colorBg), var(--colorBg))\n  }\n  dd, dt, p {\n    margin: 0 0 3px 0;\n    padding: 0;\n    word-break: break-word;\n  }\n  p:last-child {\n    margin: 0;\n  }\n  dt {\n    font-weight: 600;\n  }\n  "}function st(e,t=!1){const s=t?(0,E.Z)("Can not determine email address to reply from. Which one should be used to send your reply?"):(0,E.Z)("More than one of your email addresses are invited. Which one should be used to send your reply?");return{title:(0,E.Z)("Select Reply Mail"),body:s,actions:e.map(((e,t)=>({title:e,action:e,default:0===t}))),cancelAction:{title:(0,E.Z)("Cancel"),action:"cancel"}}}function nt(e,t,s){let n,i,a;try{const e=(0,ae.Z)(t);e.METHOD||(e.VEVENT[0]?.ORGANIZER&&e.VEVENT[0]?.ATTENDEE?e.METHOD="REQUEST":e.METHOD="PUBLISH"),i=e.METHOD;let s=e.VEVENT[0];const o=s?.EXCEPTIONS??[];if(1===o.length&&1===Object.keys(s).length&&(s=o[0]),!s)return ie.Z.error("Mail",["invite"],"No event in invite"),{inviteInfo:{type:"parsing_error",message:(0,E.Z)("No event in invite")},incomingEvent:Xe};a=s["RECURRENCE-ID"],n=(0,de.rP)(s,se.ZP.getDefaultCalendar()?.id||"")}catch(e){return ie.Z.error("Mail",["invite"],"Error parsing iCalendar"),console.log("Mail. Error parsing iCalendar attachment.",t),{inviteInfo:{type:"parsing_error",message:e.message},incomingEvent:Xe}}const o=n.invites||[];let r=s.find((e=>e.uid===n.uid&&!e.trash));if(r?.rrule&&a){const e=(0,de.Uq)(a),{event:t}=(0,he.Km)(new Date(e),r);t&&(r=t),n.calendarId=r.calendarId}const l={incomingEvent:n,existingEvent:r,method:i},d=e?.rsvpState||"NEEDS-ACTION";if(r&&"ical"===se.ZP.getAccountAndCalendar(r.calendarId)?.account?.account_type){const e="NEEDS-ACTION"===d?{type:"invite_existing_ical_unanswered"}:{type:"invite_existing_ical_answered",state:d};return{...l,inviteInfo:e}}const c=n.sequence??0,h=r?.sequence??0;if("PUBLISH"===i)return r?h<c?{...l,inviteInfo:{type:"publish_update"}}:{...l,inviteInfo:{type:"publish_existing"}}:{...l,inviteInfo:{type:"publish_not_existing"}};if("REQUEST"===i)return r?a?"NEEDS-ACTION"===d?{...l,inviteInfo:{type:"update_single_exception_unanswered",recurrenceId:a}}:{...l,inviteInfo:{type:"update_single_exception_answered",state:d,recurrenceId:a}}:r.organizer!==n.organizer?{...l,inviteInfo:{type:"update_fraudulent"}}:h<c?"NEEDS-ACTION"===d?{...l,inviteInfo:{type:"update_unanswered",prevState:d}}:{...l,inviteInfo:{type:"update_answered",state:d}}:h===c?"NEEDS-ACTION"===d?{...l,inviteInfo:{type:"invite_existing_unanswered"}}:{...l,inviteInfo:{type:"invite_existing_answered",state:d}}:{...l,inviteInfo:{type:"invite_outdated"}}:a?{...l,inviteInfo:{type:"update_single_exception_not_existing",recurrenceId:a}}:"NEEDS-ACTION"===d?{...l,inviteInfo:{type:"invite_unanswered"}}:{...l,inviteInfo:{type:"invite_answered",state:d}};if("CANCEL"===i)return a&&function(e,t){const s=e?.recurrenceExceptions;if(s?.length){const e=(0,de.Uq)(t);return Boolean(s.find((t=>t.cancelled&&t.date===e)))}return!1}(r,a)?{...l,inviteInfo:{type:"cancel_recurring_cancelled"}}:r?{...l,inviteInfo:{type:"cancel_existing",recurrenceId:a}}:{...l,inviteInfo:{type:"cancel_not_existing"}};if("REPLY"===i){if(1!==o.length||c>h)return{...l,inviteInfo:{type:"reply_invalid"}};const e=o[0];if(!r)return{...l,inviteInfo:{type:"reply_not_existing"}};const t=r.invites||[];if(!t.some((t=>t.address===e.address)))return{...l,inviteInfo:{type:"reply_fraudulent"}};if(c===h&&1===o.length){const{partstat:e,address:s}=o[0],n=t.find((e=>e.address===s));if(n&&n.partstat===e)return{...l,inviteInfo:{type:"reply_not_changed"}};if(n&&n.partstat!==e)return{...l,inviteInfo:{type:"reply_changed"}}}if(c<h)return{...l,inviteInfo:{type:"reply_outdated"}}}return"COUNTER"===i?c>h?{...l,inviteInfo:{type:"counter_invalid"}}:c<h?{...l,inviteInfo:{type:"counter_outdated"}}:r?d?{...l,inviteInfo:{type:"counter_existing_answered",state:d}}:{...l,inviteInfo:{type:"counter_existing_unanswered"}}:{...l,inviteInfo:{type:"counter_not_existing"}}:{...l,inviteInfo:{type:"invite_unsupported_method"}}}function it(e){return"string"==typeof e?e:e[0]}function at(e,t,s,n,i,a,o,r,l){if(!t||!s)return Qe;const{incomingEvent:d,existingEvent:c,method:h,inviteInfo:u}=nt(t,i,a),p=R.Z.get(B.kMailAccounts),g=v.Z.getSelectedFolder(),m=Array.from(Ve(s.sources).keys()),f=(d.invites||[]).map((e=>e.address));let b;n?.["delivered-to"]?b=it(n["delivered-to"]):1===t.to.length?b=t.to[0].address:n?.["x-delivered-to"]?b=it(n["x-delivered-to"]):n?.["x-resolved-to"]&&(b=it(n["x-resolved-to"]));const C=b&&f.includes(b)?b:null,w=`\n    <input type="button" value="${(0,E.Z)("Accept")}" onclick="console.log('Accept')" />\n    <input type="button" value="${(0,E.Z)("Maybe")}" onclick="console.log('Maybe')" />\n    <input type="button" value="${(0,E.Z)("Decline")}" onclick="console.log('Decline')" />\n  `,y=`\n    <input type="button" value="${(0,E.Z)("Accept")}" onclick="console.log('AcceptCounter')" />\n    <input type="button" value="${(0,E.Z)("Decline")}" onclick="console.log('DeclineCounter')" />\n  `,x=`<input type="button" value="${(0,E.Z)("Add To Calendar")}" onclick="console.log('Add')" />`,I=`<input type="button" value="${(0,E.Z)("Update in Calendar")}" onclick="console.log('Update')" />`;let A,S="",Z="",T="";switch(u.type){case"invite_existing_ical_unanswered":S=(0,E.Z)("This message contains changes for an event that you have in a read only web calendar. You can reply to it here but your status will not be updated in the Calendar."),T+=w;break;case"invite_existing_ical_answered":S=(0,E.Z)("This message contains changes for an event that you have in a read only web calendar."),T+=Je[u.state].existing;break;case"publish_not_existing":S=(0,E.Z)("This message contains event data published for your information."),Z=x;break;case"publish_existing":S=(0,E.Z)("This message contains event data that you already have in your calendar.");break;case"publish_update":S=(0,E.Z)("This message contains event update published for your information."),Z=I;break;case"invite_unanswered":C?(S=(0,E.Z)("This message contains a calendar event invite."),T+=w):S=(0,E.Z)("This message contains a calendar event invite. You are not invited but you can still add it to your calendar."),Z=x;break;case"invite_answered":S=(0,E.Z)("This message contains a calendar event invite you have responded to but you don't have the event in your calendar."),Z=x,T+=Je[u.state].existing;break;case"invite_outdated":S=(0,E.Z)("This message contains a calendar event invite. You have a more recent version of the event in your calendar.");break;case"invite_existing_unanswered":S=(0,E.Z)("This message contains an invitation to an event you have in your calendar. You have not responded to the invitation."),T+=w;break;case"invite_existing_answered":S=(0,E.Z)("This message contains an existing event you have in your calendar."),T+=Je[u.state].existing;break;case"update_unanswered":S=(0,E.Z)("This message contains an update to a calendar event.")+Je[u.prevState].update,Z=I,T+=w;break;case"update_answered":S=(0,E.Z)("This message contains an update to a calendar event.")+Je[u.state].update,Z=I,T+=Je[u.state].existing;break;case"update_single_exception_answered":S=(0,E.Z)("This message contains an invite to make an exception to a recurring calendar event."),T+=Je[u.state].existing,A=u.recurrenceId;break;case"update_single_exception_unanswered":S=(0,E.Z)("This message contains an invite to make an exception to a recurring calendar event."),Z=x,T+=w,A=u.recurrenceId;break;case"update_single_exception_not_existing":S=(0,E.Z)("This message contains an invite to make an exception to a recurring calendar event that you do not have in your calendar. You can still accept this as a stand alone event."),Z=x,T+=w,A=u.recurrenceId;break;case"update_fraudulent":S=(0,E.Z)("This message contains an update to a calendar event. It does not match the event you have in your calendar. Check the event details below and if it looks correct you have to delete the existing event in your calendar before you can accept this one.");break;case"cancel_existing":S=(0,E.Z)("This message contains an event cancellation."),Z=`<input type="button" value="${(0,E.Z)("Remove from Calendar")}" onclick="console.log('Delete')" />`,A=u.recurrenceId;break;case"cancel_not_existing":S=(0,E.Z)("This message contains cancellation of an event you don’t have in your calendar.");break;case"cancel_recurring_cancelled":S=(0,E.Z)("This message contains cancellation of an event already cancelled in your calendar.");break;case"reply_not_existing":S=(0,E.Z)("This message contains an invite reply for an event you do not have in your calendar.");break;case"reply_invalid":S=(0,E.Z)("Invalid event invite reply found.");break;case"reply_fraudulent":S=(0,E.Z)("Fraudulent event invite reply found.");break;case"reply_not_changed":S=(0,E.Z)("This message contains an event invite reply which is already processed.");break;case"reply_changed":S=(0,E.Z)("This message contains an event invite reply."),Z=`<input type="button" value="${(0,E.Z)("Update Event in Calendar")}" onclick="console.log('Partstat')" />`;break;case"reply_outdated":S=(0,E.Z)("This message contains an event invite reply for an older version of the event.");break;case"counter_not_existing":S=(0,E.Z)("This message contains a counter proposal for an event which was not found. It will be ignored.");break;case"counter_existing_unanswered":S=(0,E.Z)("This message contains a counter proposal for the following event."),Z=y;break;case"counter_existing_answered":S=(0,E.Z)("This message contains a counter proposal for the following event."),S+=Je[u.state].existing;break;case"counter_outdated":S=(0,E.Z)("This message contains an outdated counter proposal. It will be ignored.");break;case"counter_invalid":S=(0,E.Z)("This message contains an invalid counter proposal. It will be ignored.");break;case"invite_unsupported_method":S=(0,E.Z)("Unsupported method parameter “$1”.",[h??""]);break;case"parsing_error":S=(0,E.Z)("Error parsing calendar data. For details see logs located in Calendar button on status bar.")}T&&(T=`<span>${(0,E.Z)("RSVP")}</span>`+T);const k="parsing_error"===u.type?"":function(e,t,s,n){const i=[],{url:a,location:o,organizer:r,invites:l,rrule:d}=t,c=P()(t.start),h=P()(t.end);t.allDay?c.isSame(h,"day")?(i.push([(0,E.Z)("Date"),c.format("LL"),""]),i.push(["","",""])):(i.push([(0,E.Z)("Starts"),c.format("LL"),""]),i.push([(0,E.Z)("Ends"),h.format("LL"),""])):(i.push([(0,E.Z)("Starts"),c.format("LLLL"),""]),i.push([(0,E.Z)("Ends"),h.format("LLLL"),""])),i.push([" ",n?(0,E.Z)("Single event exception"):d?(0,ce.p)((0,Ye.Qj)(d,t.timezone,t.start)):"",""]),i.push([(0,E.Z)("Organizer"),r||"",""]),i.push([(0,E.Z)("Attendees"),l&&l.map((e=>`<p>${e.address}</p>`)).join("\r\n"),""]),i.push([(0,E.Z)("other","Location"),o,""]),i.push([(0,E.Z)("URL"),a?`<a href="${a}">${a}</a>`:"",""]),i.push([(0,E.Z)("Description"),et(t.description||""),""]);const u=parseInt(s?.sequence)||0,p=parseInt(t.sequence)||0,g=s&&("REQUEST"===e&&u<p||"COUNTER"===e&&u===p);if(g&&s){const e=P()(s.start),n=P()(s.end);if(s.allDay!==t.allDay)s.allDay?(i[0][2]=`<p>${e.format("LL")}</p>`,e.isSame(n,"day")||(i[1][2]=`<p>${n.format("LL")}</p>`)):(i[0][2]=`<p>${e.format("LLLL")}</p>`,i[1][2]=`<p>${n.format("LLLL")}</p>`);else{const a=t.allDay?"LL":"LLLL";s.start!==t.start&&(i[0][2]=`<p>${e.format(a)}</p>`),s.end!==t.end&&(i[1][2]=`<p>${n.format(a)}</p>`)}if(s.rrule!==d&&(i[2][2]=`<p>${(0,ce.p)((0,Ye.Qj)(s.rrule,s.timezone,s.start))}</p>`),s.organizer!==r&&(i[3][2]=`<p>${s.organizer||"&nbsp"}</p>`),(0,O.Z)((s.invites||[]).map((e=>e.address)),(l||[]).map((e=>e.address)))||(i[4][2]=s.invites&&s.invites.map((e=>`<p ${t.invites?.some((t=>t.address===e.address))?'class=" Event-Attendee--Exists"':""}>${e.address}</p>`)).join("\r\n")||"&nbsp"),o&&s.location!==o&&(i[5][2]=`<p>${s.location||"&nbsp"}</p>`),a&&s.url!==a){const e=s.url;i[6][2]=e?`<p><a href="${e}">${e}</a></p>`:"&nbsp"}t.description&&s.description!==t.description&&(i[7][2]=`<p>${et(s.description||"")}</p>`||"&nbsp")}const m=i.filter((e=>e[1]||e[2])),f=`<h1 class="Event-Title">${t.title||le.gT}</h1>`;if(g&&s){const e=s.title||le.gT;return`\n      <dl class="Event-Props Event-Props--Diff">\n        <dt />\n        <dd>${f}</dd>\n        <dd><h2 class="${t.title===s.title?"Event-Title--Previous":"Event-Title--Previous Event-Title--Changed"}">${e}</h2></dd>\n      ${m.map((([e,t,s])=>{let i="Event-Prop--Previous";return" "===e&&n&&(i=""),`\n              <dt>${e}</dt>\n              <dd>${t||""}</dd>\n              <dd class="${i}">${s||""}</dd>`})).join("\r\n")}\n      </dl>\n    `}return`\n    ${f}\n    <dl class="Event-Props">\n    ${m.map((([e,t])=>`\n      <dt>${e}</dt>\n      <dd>${t||""}</dd>`)).join("\r\n")}\n    </dl>\n  `}(h,d,c,A);return{markup:`\n    <div class="Event">\n      <div class="Event-Message"><span>${S}</span>${Z}</div>\n      ${T?`<div class="Event-Rsvp">${T}</div>`:""}\n      ${r&&`<div class="Event-Error">${r}</div>`}\n      ${k}\n    </div>\n      `,style:tt(o),prepend:!0,messageHandler:async s=>{const{message:n}=s;let i="";if("DeclineCounter"===n)i=t?.from[0].address||"";else if(["Accept","Maybe","Decline","AcceptCounter"].includes(n)||"DeclineCounter"===n&&!i){if(1===m.length)i=m[0];else if(0===m.length){if(1===p.length)i=p[0].MAIL_EMAIL;else if(g){const{accountId:e,path:t}=g;p.some((t=>t.MAIL_EMAIL===e))?i=e:t&&e===re.Ry&&(i=t.split("/")[0])}if(!i){const{action:t}=await ne.Z.showModal(e,{modal:st(p.map((e=>e.MAIL_EMAIL)),!0)});i=t}}else{const{action:t}=await ne.Z.showModal(e,{modal:st(m)});i=t}if("cancel"===i)return}try{switch(n){case"Accept":if(!C)throw new Error("Can not accept invite. No attendee found.");await te.Z.replyToInvite(e,d,C,i,"ACCEPTED",A);break;case"Maybe":if(!C)throw new Error("Can not accept invite. No attendee found.");await te.Z.replyToInvite(e,d,C,i,"TENTATIVE",A);break;case"Decline":if(!C)throw new Error("Can not decline invite. No attendee found.");await te.Z.replyToInvite(e,d,C,i,"DECLINED",A);break;case"Add":await te.Z.addEventToCalendar(d,A);break;case"Update":case"AcceptCounter":c&&await te.Z.updateEventInCalendar(d,c);break;case"DeclineCounter":if(!C)throw new Error("Can not decline counter. No attendee found.");te.Z.declineCounter(e,d,C,i);break;case"Delete":te.Z.handleCancellation(d,A);break;case"Partstat":te.Z.handleReply(d)}r&&l("")}catch(e){ie.Z.error("Calendar",["invite"],"Error handling invite.",e),l(`Error handling invite. ${e.message}`)}}}}const ot={type:"text",content:""};const rt=n.forwardRef((function(e,t){const{windowId:s,style:i,fromAddress:a,isRss:o,isSenderTrusted:r,listEntry:l,message:d,onUnblockExternalContent:c,raw:h,renderingMethod:u,shouldWarnUserFrom:p,shouldWarnUserFromName:g,shouldWarnUserReplyTo:m}=e,f=function(e,t,s){const[i,a]=n.useState([]);return n.useMemo((()=>{if(e)if("raw"===s)if(t)t.getByteString().then((e=>a([{type:"text",content:e}])));else if(e.bodyParts&&"string"==typeof e.bodyParts[0].content){const t=e.bodyParts[0].content,s=(0,L.yN)(e.bodyParts);H.Z.build(e,t,s).then((e=>a([{type:"text",content:e}])))}else a([]);else e.bodyParts?a(e.bodyParts):t&&t.parseMainPart(s).then(a);else a([])}),[e,t,s]),i}(d,h,u),v=function(e,t){const[s,i]=n.useState(),a=n.useRef();return a.current=e,n.useEffect((()=>{const s=[];return e&&"raw"!==t?((async()=>{const t=(0,Y.Dc)(e.mimeTree).filter((e=>e.mimeType&&e.mimeType.startsWith("image/")));for(const n of t){const t=await e.parse(n.mimeTree);if(1===t.length&&"attachment"===t[0].type){const{content:e,mimeType:n}=t[0],i=new Blob([e],{type:"string"==typeof n?n:""}),a=URL.createObjectURL(i);s.push(a)}}if(s.length>0&&e===a.current){const e={markup:s.map((e=>`<img src="${e}" />`)).join(""),style:"img {\n            margin-top: 12px;\n            display: inline-block;\n            vertical-align: top;\n            max-width: 100%;\n            height: auto;\n          }",prepend:!1};i(e)}else i()})(),()=>{s.forEach((e=>URL.revokeObjectURL(e)))}):i()}),[e,t]),s}(h,u),b=function(e,t,s,i,a,o){const{events:r}=(0,oe.Z)(ee.Z),[l,d]=n.useState(),[c,h]=n.useState(""),u=n.useRef();return u.current=t,n.useEffect((()=>{if(!i||"raw"===a)return h(""),d();(async()=>{let n,a={};const l=await i.parseCalendar();l&&t?.id===u.current?.id&&(a=await i.getDeliveryHeaders(),n="string"==typeof l.content?l.content:qe.decode(l.content)),n?d(at(e,t,s,a,n,r,o,c,h)):d()})()}),[c,r,s,t,i,a,o,e]),l}(s,d,l,h,u,i);let C,w;if(h&&d&&(C=b||v),d&&(w=f.find((e=>"html"===e.type)),w||(w=f.find((e=>"text"===e.type)))),w||(w=ot),"html"===w.type||"text"===w.type){const s=!!d&&!d.trusted&&!r;return(0,x.jsx)(V,{style:i,blockHTTPLeaks:s,bodyParts:"html"===w.type?f:void 0,fromAddress:a,shouldWarnUserReplyTo:m,shouldWarnUserFrom:p,shouldWarnUserFromName:g,inject:C,messageHeader:e.messageHeader,isRss:o,onUnblockExternalContent:c,ref:t,textOrHtml:w,renderingMethod:u},"mainBody")}return null}));var lt=s(75459),dt=s(97698),ct=s(2431),ht=s(96951),ut=s(68247),pt=s(69697),gt=s(98102),mt=s(36246);function ft(e){return!!e.message&&e.message.cc.length+e.message.to.length>1}class vt extends n.PureComponent{static contextType=T.Z;state={content:"",replyAll:ft(this.props),editorHeight:R.Z.get(B.kMailQuickReplyHeight)??150,showQuickReply:R.Z.get(B.kMailShowQuickReply),shouldQuote:R.Z.get(B.kMailQuickReplyQuote)};refContent=n.createRef();componentDidMount(){c.Z.addListener("COMMAND_MAIL_SEND_MESSAGE",this.onCommandSpy)}componentWillUnmount(){c.Z.removeListener("COMMAND_MAIL_SEND_MESSAGE",this.onCommandSpy)}componentDidUpdate(e){this.props.message?.id!==e.message?.id&&this.setState({content:"",replyAll:ft(this.props),shouldQuote:R.Z.get(B.kMailQuickReplyQuote)})}onCommandSpy=(e,t)=>{ht.ZP.getPageById(this.props.pageId)?.active&&e===this.context.vivaldiWindowId&&"COMMAND_MAIL_SEND_MESSAGE"===t&&this.quickReply()};getContent=()=>this.state.content;clear=()=>{this.setState({content:""})};onChange=({currentTarget:e})=>{this.setState({content:e.value})};toggleReplyAll=()=>{this.setState((e=>({replyAll:!e.replyAll})))};toggleShouldQuote=()=>{this.setState((e=>({shouldQuote:!e.shouldQuote})))};quickReply=async()=>{if(!this.props.message)return;const e={...this.props.message};if(this.state.shouldQuote){const t=e.bodyParts?[...e.bodyParts]:[];this.props.refBody.current&&t.push(this.props.refBody.current.props.textOrHtml),e.bodyParts=t}const t=function(e){const{attachments:t,body:s,cidAttachments:n,focusOnBody:i,fromDraft:a,plaintext:o,selectedAccount:r,replyScope:l,...d}=e;return{...d,flags:[],internal:!0,bcc:[],bodyParts:[{type:"text",content:o?s:(0,j.Nw)(s).sanitized}]}}(ct.Z.createQuickReply(e,this.state.content,this.state.replyAll)),s=await dt.Z.storeMessage(t,!0);dt.Z.sendSelected(this.context.vivaldiWindowId,[s]),this.clear()};onSlidebarPosition=(e,t)=>{this.setState((e=>{const s=(0,mt.Z)(("minimize"===e.showQuickReply?0:e.editorHeight)-t,0,350);return{editorHeight:s,showQuickReply:s?"show":"minimize"}}))};onSlideBarDoubleClick=()=>{this.setState((e=>{const t="minimize"===R.Z.get(B.kMailShowQuickReply)?"show":"minimize",s=e.editorHeight<10?150:e.editorHeight;return ut.Z.set(B.kMailShowQuickReply,t),ut.Z.set(B.kMailQuickReplyHeight,s),{showQuickReply:t,editorHeight:s}}))};onSlideBarStop=()=>{let{editorHeight:e}=this.state;e<45?e=0:e<90&&(e=90),this.setState({editorHeight:e,showQuickReply:e?"show":"minimize"}),ut.Z.set(B.kMailShowQuickReply,"minimize"===this.state.showQuickReply||0===e?"minimize":"show"),ut.Z.set(B.kMailQuickReplyHeight,e)};render(){return(0,x.jsx)("div",{id:"quick_reply",style:"minimize"===this.state.showQuickReply?{}:{height:`${this.state.editorHeight}px`},children:(0,x.jsxs)("section",{className:"minimize"===this.state.showQuickReply?"minimize":"",children:[(0,x.jsx)(pt.Z,{onStop:this.onSlideBarStop,onSlidebarPosition:this.onSlidebarPosition,onDoubleClick:this.onSlideBarDoubleClick,returnOffset:!0,position:"bottom"}),(0,x.jsx)("textarea",{rows:"1",style:"minimize"===this.state.showQuickReply?{display:"none"}:{},ref:this.refContent,placeholder:(0,E.Z)("Write a quick reply here"),title:(0,E.Z)("Write a Quick Reply"),value:this.state.content,onChange:this.onChange}),(0,x.jsxs)("div",{className:"toolbar toolbar-default",style:"minimize"===this.state.showQuickReply?{display:"none"}:{},children:[(0,x.jsx)("div",{className:"toolbar toolbar-group",children:(0,x.jsx)(gt.ZP,{tabIndex:0,title:(0,E.Z)("Send"),tooltip:this.state.replyAll?(0,E.Z)("Reply to all"):(0,E.Z)("Reply to sender"),onClick:this.quickReply,image:y.zLp.small,className:"button-mail-compose",disabled:!this.state.content})}),(0,x.jsxs)("div",{children:[ft(this.props)&&(0,x.jsxs)("label",{children:[(0,x.jsx)("input",{type:"checkbox",checked:this.state.replyAll,onChange:this.toggleReplyAll}),(0,x.jsx)("span",{children:(0,E.Z)("Reply All")})]}),(0,x.jsxs)("label",{children:[(0,x.jsx)("input",{type:"checkbox",checked:this.state.shouldQuote,onChange:this.toggleShouldQuote}),(0,x.jsx)("span",{title:(0,E.Z)("Append message being replied to as quotation in reply"),children:(0,E.Z)("Include Quoted Text")})]})]})]})]})})}}var bt=s(37330),Ct=s(89378),wt=s(97823),yt=s(28918),xt=s(55346),It=s(48868);const At={call:function(e){return It.Z.pop.where("searchListId").equals(e).toArray()}};var St=s(35489);var Zt=s(57357),Tt=s(24651),Et=s(83507),kt=s(51877),Nt=s(13519),_t=s(11472),Pt=s(34155);const Mt=["colorHighlightFg","colorHighlightBg","colorFg","colorBg","colorBgDark","colorFgIntense","colorBgIntense","colorBorder","radius","colorErrorFg","colorErrorBg"];function Dt(e){const t=String(e["--colorBg"]),s=String(e["--colorHighlightBg"]),n=d()(t).luminance(),i=n<.2?.7:n>.8?.3:.5,a=String(d()(s).set("hsl.h",d()(s).get("hsl.h")+80).luminance(i)),o=String(d()(s).set("hsl.h",d()(s).get("hsl.h")+160).luminance(i)),r=String(d()(s).set("hsl.h",d()(s).get("hsl.h")+240).luminance(i));return{...e,"--quoteLvl1":a,"--quoteLvl2":o,"--quoteLvl3":r}}async function Ot(e,t,s){const{id:n,sentDate:i}=t,{accountId:a}=s;await e.writeBufferToDisk(a,i,n),await Tt.Z.setHasRaw(a,n)}async function jt(e,t,s){async function n(e){for(const n of e){const e=await Et.Z.call(n.accountId,t,s);if(e){if(0!==e.byteLength)return e;ie.Z.warn("Mail",["detail-view","fetch-message"],"Ignoring empty message on disk")}}}return await n(e.samePathFilters)||await n(e.sameAccountFilters)||await n(e.otherFilters)}class Lt extends n.Component{static contextType=T.Z;messageBody=n.createRef();messageHeader=n.createRef();isRssFeedMessage=!1;constructor(e,t){super(e),this.state={style:Dt(bt.Z.getBaseStylesByWindowId(t.vivaldiWindowId,Mt)),message:void 0,renderingMethod:R.Z.get(B.kMailPreferredRendering),isSenderTrusted:!1,accountOfflineNoMessage:!1,netOfflineNoMessage:!1,rssNoMessage:!1,showQuickReply:R.Z.get(B.kMailShowQuickReply)}}_setIfActive=e=>{Pt.nextTick((()=>{const t=this.messageBody.current?.refWebview.current,s=this.context.vivaldiWindowId;e.pageIsActive?(a.Z.setActiveMailDetail(this),t&&o.Z.setActiveWebView(s,t)):(a.Z.clearIfActive(this),t&&o.Z.clearIfActive(s,t))}))};_markSeenReadIfHasBody=()=>{m.Z.markSeenReadDebounced.cancel();const{listEntry:e}=this.props,{message:t,raw:s}=this.state;if(e&&t){const{bodyParts:n}=t;e&&(s||n)&&m.Z.markSeenReadDebounced(e)}};componentDidMount(){c.Z.addListener("COMMAND_TAB_VIEW_PAGE_SOURCE",this.onCommandSpy),c.Z.addListener("COMMAND_MAIL_SHOW_PLAINTEXT",this.onCommandSpy),c.Z.addListener("COMMAND_MAIL_SHOW_HTML",this.onCommandSpy),R.Z.addListener([B.kMailAccounts,B.kMailPreferredRendering,B.kMailColorQuotedText,B.kMailShowQuickReply],this.onPrefsChanged),bt.Z.addListener(this.onThemeStoreChanged),g.Z.addListener(this.onConnectionChanged),this.context.addEventListener("online",this._onOnline),f.Z.getIndex().length>0?this.fetchMessage(this.props):f.Z.addListener(this.checkIfReadyToReadFromDisk),this._setIfActive(this.props)}_onOnline=()=>{this.state.netOfflineNoMessage&&this.setState({netOfflineNoMessage:!1},(()=>this.fetchMessage(this.props)))};onConnectionChanged=e=>{!1!==e.isDisconnected||this.state.raw||this.setState({netOfflineNoMessage:!1},(()=>{this.props.listEntry&&(ie.Z.log("Mail",["detail-view","connnection status",e.accountId],"connection established - fetch message body"),this.fetchMessage(this.props))}))};onPrefsChanged=(e,t,s)=>{switch(s){case B.kMailAccounts:this.state.accountOfflineNoMessage&&this.setState({accountOfflineNoMessage:!1},(()=>{this.props.listEntry&&this.fetchMessage(this.props)}));break;case B.kMailPreferredRendering:this.setState({renderingMethod:t});break;case B.kMailColorQuotedText:this.fetchMessage(this.props);break;case B.kMailShowQuickReply:this.setState({showQuickReply:t})}};checkIfReadyToReadFromDisk=e=>{"finishIndexProgress"===e.target&&(f.Z.ensureRemovedListener(this.checkIfReadyToReadFromDisk),this.fetchMessage(this.props))};_isBeingActivated(e){return!this.props.pageIsActive&&e.pageIsActive}UNSAFE_componentWillReceiveProps(e){const t=e.listEntry?e.listEntry.id:void 0;(this.props.listEntry?this.props.listEntry.id:void 0)!==t?this.fetchMessage(e):this._isBeingActivated(e)&&(void 0!==t&&t===i.Z.composerSearchListId&&this.fetchMessage(e),i.Z.composerSearchListId=void 0),e.pageIsActive!==this.props.pageIsActive&&this._setIfActive(e)}shouldComponentUpdate(e,t){return e.hasNoListEntries!==this.props.hasNoListEntries||(!(0,kt.Z)(this.state,t)||!!this.props.prefValues&&!!e.prefValues&&this.props.prefValues[B.kMailViewLayout]!==e.prefValues[B.kMailViewLayout])}componentDidUpdate(){this._markSeenReadIfHasBody()}componentWillUnmount(){c.Z.removeListener("COMMAND_TAB_VIEW_PAGE_SOURCE",this.onCommandSpy),c.Z.removeListener("COMMAND_MAIL_SHOW_PLAINTEXT",this.onCommandSpy),c.Z.removeListener("COMMAND_MAIL_SHOW_HTML",this.onCommandSpy),R.Z.removeListener([B.kMailAccounts,B.kMailPreferredRendering,B.kMailColorQuotedText,B.kMailShowQuickReply],this.onPrefsChanged),f.Z.ensureRemovedListener(this.checkIfReadyToReadFromDisk),g.Z.removeListener(this.onConnectionChanged),this.context.removeEventListener("online",this._onOnline),bt.Z.removeListener(this.onThemeStoreChanged),this._currentId=-1,Pt.nextTick((()=>{a.Z.clearIfActive(this);const e=this.messageBody.current?.refWebview.current;e&&o.Z.clearIfActive(this.context.vivaldiWindowId,e)}))}onCommandSpy=(e,t)=>{if(this.props.pageIsActive&&e===this.context.vivaldiWindowId)switch(t){case"COMMAND_TAB_VIEW_PAGE_SOURCE":this.toggleRenderingMethod("raw");break;case"COMMAND_MAIL_SHOW_PLAINTEXT":this.toggleRenderingMethod("plaintext");break;case"COMMAND_MAIL_SHOW_HTML":this.toggleRenderingMethod("prefer_html")}};onThemeStoreChanged=()=>{const e=Dt(bt.Z.getBaseStylesByWindowId(this.context.vivaldiWindowId,Mt));(0,O.Z)(this.state.style,e)||this.setState({style:e})};async updateMessage(e,t,s){const n={searchListId:e,subject:t.subject,body:s,to:(0,Ct.Z)(t.to),cc:(0,Ct.Z)(t.cc),from:(0,Ct.Z)(t.from),replyTo:(0,Ct.Z)(t.replyTo)};if(!await M.Z.mailPrivate.updateMessage(n))throw new Error(`Failed to add body to FTS db for id ${e}`)}async updatePreview(e,t){const s=(0,Nt.Gc)(t);m.Z.updateIndex({sleUpdates:[{id:e,updates:{preview:s}}]}),await(0,Zt.Z)(e,s)}fetchMessage=async e=>{const{listEntry:t}=e,s=R.Z.get(B.kMailPreferredRendering);if(this.setState({message:void 0,raw:void 0,renderingMethod:s,accountOfflineNoMessage:!1,netOfflineNoMessage:!1,rssNoMessage:!1},(()=>{Pt.nextTick(a.Z.refreshActiveMessage)})),!t)return void ie.Z.log("Mail",["detail-view","fetch-message"],"no listEntry");const{id:n,sentDate:i,sourceFilterIds:o,fromIds:l}=t;this._currentId=n;const d=await xt.Z.call(n);if(!d)return void ie.Z.log("Mail",["detail-view","fetch-message"],"no message");const c=d.id,h=()=>{const e=this._currentId!==d.id;return e&&ie.Z.log("Mail",["detail-view","fetch-message"],"selection changed"),e};if(h())return;this.setState({message:d},a.Z.refreshActiveMessage);const g=R.Z.get(B.kMailAccounts),b=v.Z.getSelectedFolder(),C=f.Z.getByIds(o);function w(e){const t=[],s=[],n=[];for(const i of e)i.accountId!==b?.accountId||b?.path!==re.ym&&i.path!==b?.path?i.accountId===b?.accountId?s.push(i):n.push(i):t.push(i);return{samePathFilters:t,sameAccountFilters:s,otherFilters:n}}const y=w(C);let x,I=await jt(y,n,i);if(h())return;async function A(e){const t=g.filter((e=>e.accountType===re.s9.IMAP&&!e.offline)),s=e.filter((e=>t.find((t=>t.MAIL_EMAIL===e.accountId))));for(const e of s){const{accountId:t}=e;try{if(I=await p.Z.fetchRawOfMessage(t,c),I)return x={accountId:t,type:"imap"},I}catch(e){ie.Z.info(e)}}if(!I){const t={},s=g.filter((e=>e.accountType===re.s9.POP));if(s.length>0){const n=await wt.Z.loadAllAccounts(),i=e.filter((e=>s.find((t=>t.MAIL_EMAIL===e.accountId))));for(const e of i){const s=n.find((t=>t.MAIL_EMAIL===e.accountId));s&&(t[e.accountId]=s)}}if(Object.keys(t).length>0){const e=await At.call(n);for(const s of e){const{accountId:e,uidl:n}=s,i=t[e];try{return I=await lt.Z.getPopMessage(i,n,c),x={accountId:e,type:"pop",uidl:n},I}catch(e){ie.Z.info(e)}}}}}this.isRssFeedMessage=C.some((e=>e.accountId===re.u4));const S=C.filter((e=>{const s=t.sources.get(e.id);return s&&!s.internal}));if(!I){const e=await St.Z.getBySearchListId(n);if(h())return;if(!(e.length>0&&e.every((e=>!e.hasRaw)))){const e=864e5;I=await jt(y,n,i+e)||await jt(y,n,i-e),I&&ie.Z.log("Mail",["detail-view","fetch-message"],"Message was found under wrong day folder")}}if(!I){if(S.length>0&&!navigator.onLine)return this.setState({netOfflineNoMessage:!0}),void ie.Z.log("Mail",["detail-view","fetch-message"],"no network connection");const e=S.some((e=>g.find((t=>t.MAIL_EMAIL===e.accountId&&!t.offline))));if(S.length>0&&!e)return this.setState({accountOfflineNoMessage:!0}),void ie.Z.log("Mail",["detail-view","fetch-message"],"account is offline");if(this.isRssFeedMessage)return this.setState({rssNoMessage:!0}),void ie.Z.warn("Mail",["detail-view","fetch-message"],"Unexpected - feed messages without a raw");if(0===S.length)return void ie.Z.log("Mail",["detail-view","fetch-message"],"no external source filter");const t=w(S);if(I=await A(t.samePathFilters)||await A(t.sameAccountFilters)||await A(t.otherFilters),h()){if(I&&x){const e=await q(I),t=await e.parseSearchPart(),s=(0,Nt.Hg)(t);await this.updateMessage(n,d,s),await Ot(e,d,x),await this.updatePreview(n,s),m.Z.runStoredFiltersForMessages([n]),S.length>1&&(0,yt.Z)({operation:"BUFFER_OPERATION_FETCH_RAW_FOR_ALL_SOURCES",searchListId:n}).then((()=>r.Z.flushBuffer()))}return}if(!I)return void ie.Z.log("Mail",["detail-view","fetch-message"],"Failed to fetch message")}const Z=I;let T;if(this.isRssFeedMessage){const e=new TextDecoder("utf-8").decode(Z);T=(0,_t.K)(e)}this.setState({isSenderTrusted:this.isRssFeedMessage||Pe.Z.get(l).every((e=>u.Z.isTrustedEmailAddress(e.address))),message:this.isRssFeedMessage?{...d,bodyParts:T}:d,raw:this.isRssFeedMessage?new J({contentType:{value:"application/rss+xml",params:{}},contentID:void 0,disposition:void 0,transferEncoding:"7bit",bodyStart:0,bodyIsEmptyOrWhitespaceStub:!1,byteLength:Z.byteLength,byteOffset:Z.byteOffset},Z):await q(Z)},(async()=>{a.Z.refreshActiveMessage(),S.length>1&&(0,yt.Z)({operation:"BUFFER_OPERATION_FETCH_RAW_FOR_ALL_SOURCES",searchListId:n}).then((()=>r.Z.flushBuffer()));const e=this.state.raw;if(!e||!x){if(e){if(!t.preview){const t=await e.parseSearchPart(),s=(0,Nt.Hg)(t);await this.updatePreview(n,s)}}else ie.Z.log("Mail",["detail-view","fetch-message"],"no rawWrapper");return}const i=await e.parseMainPart(s),o=(0,Nt.Hg)(i);await this.updateMessage(n,d,o),await Ot(e,d,x),await this.updatePreview(n,o),m.Z.runStoredFiltersForMessages([n])}))};toggleRenderingMethod=e=>{this.setState((t=>({renderingMethod:t.renderingMethod===e?R.Z.get(B.kMailPreferredRendering):e})))};onUnblockExternalContent=e=>{const t=this.state.message;var s;if(t)if(e){const e=t.from;e[0]&&(h.Z.putTrustedEmailAddress(e[0]),this.setState({isSenderTrusted:!0}))}else s=t.id,It.Z.messages.update(s,{trusted:!0}),this.setState((e=>e.message?{message:{...e.message,trusted:!0}}:null))};shouldWarnUser=()=>{if(this.isRssFeedMessage)return!1;const e=this.state.message;if(e&&e.replyTo[0]&&e.from[0]){const t=e.from[0].address.split("@").pop(),s=e.replyTo[0].address.split("@").pop(),n=[/(^|\.)gmail\./,/(^|\.)yahoo\./,/(^|\.)hotmail\./,/(^|\.)aol.com/,/(^|\.)msn\./,/(^|\.)live\./,/(^|\.)office365\./,/(^|\.)outlook\./,/(^|\.)dmx.de/,/(^|\.)free.fr/,/(^|\.)icloud\./];if(e.replyTo.length>1||t!==s||n.some((e=>t.match(e)))&&e.from[0].address!==e.replyTo[0].address)return!0}return!1};shouldWarnUserFromName=()=>{const e=this.state.message;return!!e&&e.from.some((({name:e,address:t})=>e&&e!==t&&(0,D.v9)(e)&&!u.Z.hasContact(e,t)))};render(){let e=[],t="";const{listEntry:s,hasNoListEntries:n}=this.props;if(s){const{fromIds:n}=s;e=Pe.Z.get(n),t=e.length>0?e[0].address:""}const i=!this.state.accountOfflineNoMessage&&!this.state.netOfflineNoMessage&&!this.state.rssNoMessage;return(0,x.jsxs)("div",{id:"mail_detail",children:[s&&(0,x.jsx)($e,{ref:this.messageHeader,message:this.state.message,listEntry:s,renderingMethod:this.state.renderingMethod,from:e,fromAddress:t},this.state.message?.id||""),i&&(0,x.jsx)("div",{...!this.props.listEntry&&{style:{display:"none"}},className:"message-body-part",children:(0,x.jsx)(rt,{ref:this.messageBody,windowId:this.context.vivaldiWindowId,isRss:this.isRssFeedMessage,style:this.state.style,message:this.state.message,listEntry:s,messageHeader:this.messageHeader,raw:this.state.raw,renderingMethod:this.state.renderingMethod,isSenderTrusted:this.state.isSenderTrusted,fromAddress:t,shouldWarnUserFrom:e.length>1,shouldWarnUserFromName:this.shouldWarnUserFromName(),shouldWarnUserReplyTo:this.shouldWarnUser(),onUnblockExternalContent:this.onUnblockExternalContent})}),i&&!s&&!n&&(0,x.jsxs)("section",{className:"no-message-selected",children:[(0,x.jsx)("div",{dangerouslySetInnerHTML:{__html:y.Fii}}),(0,x.jsx)("div",{children:(0,E.Z)("No message selected")})]}),this.state.netOfflineNoMessage&&(0,x.jsxs)("section",{className:"no-message-selected",children:[(0,x.jsx)("div",{dangerouslySetInnerHTML:{__html:y.Fii}}),(0,x.jsx)("div",{children:(0,E.Z)("No network connection. Unable to fetch message")})]}),this.state.accountOfflineNoMessage&&(0,x.jsxs)("section",{className:"no-message-selected",children:[(0,x.jsx)("div",{dangerouslySetInnerHTML:{__html:y.Fii}}),(0,x.jsx)("div",{children:(0,E.Z)("Account is offline. Unable to fetch message")})]}),this.state.rssNoMessage&&(0,x.jsxs)("section",{className:"no-message-selected",children:[(0,x.jsx)("div",{dangerouslySetInnerHTML:{__html:y.Fii}}),(0,x.jsx)("div",{children:(0,E.Z)("Missing feed message")})]}),"hide"!==this.state.showQuickReply&&s&&!this.isRssFeedMessage&&(0,x.jsx)(vt,{pageId:this.props.pageId,message:this.state.message,refBody:this.messageBody})]})}}const Rt=Lt},95032:(e,t,s)=>{"use strict";s.d(t,{Z:()=>d});var n=s(67294),i=s(26395),a=s(49168),o=s(81744),r=s(48521);class l extends n.Component{mailLabelRef=n.createRef();_isMounted=!1;state={breakpoint:!1,componentMaxWidth:32,shouldDetachObserver:!1,numberOfVisibleLabelsAllowed:0,numberOfCheckedLabels:(0,a.Q3)(this.props.flags).length};componentDidMount(){this._isMounted=!0,this.state.numberOfCheckedLabels>0&&(this.setComponentMaxWidth(this.getComponentMaxWidth()),this.observerHandler())}componentWillUnmount(){this._isMounted=!1}componentDidUpdate(e,t){const s=this.mailLabelRef.current&&this.mailLabelRef.current.clientWidth;this.props.flags!==e.flags&&(this.setComponentMaxWidth(this.getComponentMaxWidth()),this.setNumberOfCheckedLabels((0,a.Q3)(this.props.flags).length),this.observerHandler(),s&&(s>this.state.componentMaxWidth&&this.setBreakpoint(!1),s<this.state.componentMaxWidth&&this.setBreakpoint(!0)))}observerHandler=()=>{0===this.state.numberOfCheckedLabels?this.setState({shouldDetachObserver:!0}):this.setState({shouldDetachObserver:!1})};observeTargetHandler=e=>{if(!this._isMounted)return;const t=e[0].target;this.setNumberOfVisibleLabelsAllowed(t.clientWidth),t.clientWidth>this.state.componentMaxWidth&&this.setBreakpoint(!1),t.clientWidth<this.state.componentMaxWidth&&this.setBreakpoint(!0)};setNumberOfVisibleLabelsAllowed=e=>{const t=e/(32+(3+3*(e/32)));this.setState({numberOfVisibleLabelsAllowed:t})};setNumberOfCheckedLabels=e=>{this.setState({numberOfCheckedLabels:e})};setBreakpoint=e=>{this.setState({breakpoint:e})};setComponentMaxWidth=e=>{this.setState({componentMaxWidth:e})};getComponentMaxWidth=()=>{const e=(0,a.Q3)(this.props.flags);return(32+3*this.state.numberOfVisibleLabelsAllowed)*e.length};render(){if(0===this.state.numberOfCheckedLabels)return null;let e,t=[];this.state.breakpoint?(t=(0,a.Q3)(this.props.flags).slice(this.state.numberOfVisibleLabelsAllowed).map((e=>(0,o.X)(e))),e=(0,a.Q3)(this.props.flags).slice(0,this.state.numberOfVisibleLabelsAllowed).map((e=>[(0,o.X)(e),(0,o.X)(e,!1)]))):e=(0,a.Q3)(this.props.flags).map((e=>[(0,o.X)(e),(0,o.X)(e,!1)]));const s=t.join("\n");return(0,r.jsx)("div",{className:this.props.className,ref:this.mailLabelRef,children:(0,r.jsx)(i.Z,{className:"MailLabels-Observer",onResize:this.observeTargetHandler,attached:this.state.shouldDetachObserver,children:(0,r.jsxs)("ul",{className:"MailLabels-Container",children:[e.map((([e,t])=>(0,r.jsx)("li",{title:e,"data-label":t,className:"MailLabels-Label",children:e},t))),t.length>0&&(0,r.jsx)("li",{title:s,className:"MailLabels-Label MailLabels-Tooltip",children:`+${t.length}`})]})})})}}const d=l},36943:(e,t,s)=>{"use strict";s.d(t,{Z:()=>_});var n=s(2711),i=s(3184),a=s(99827),o=s(98611),r=s(46382),l=s(29087),d=s(15489),c=s(56371),h=s(78347),u=s(48868),p=s(51501),g=s(45709),m=s(10671),f=s(95752),v=s(45660),b=s(68906),C=s(20570),w=s(35458),y=s(5204),x=s(5863),I=s(13248),A=s(89175),S=s(8684);class Z{updatedSources=new Map;imapAddCustomFlags=new Map;imapDelete=[];imapCopy=[];addSourceUpdate(e,t,s){const n=this.updatedSources.get(t);n?n.set(e,s):this.updatedSources.set(t,new Map([[e,s]]))}addSource(e,t,s=!0){const{id:n,accountId:i,path:a}=e,o={read:s,deleted:!1,internal:!m.Z.isOnline(i,a)};this.addSourceUpdate(n,t,o)}removeSource(e,t){this.addSourceUpdate(e,t,void 0)}deleteSource(e,t){const{id:s,accountId:n,path:i}=e,a=m.Z.isOnline(n,i)?{read:true,deleted:true,internal:!0}:{read:true,deleted:true};this.addSourceUpdate(s,t,a)}undeleteSource(e,t){const{id:s,accountId:n,path:i}=e,a=m.Z.isOnline(n,i)?{deleted:false,internal:!1}:{deleted:false};this.addSourceUpdate(s,t,a)}addImapDelete(e,t,s){this.imapDelete.push({accountId:e,path:t,searchListId:s})}addImapCopy(e,t,s){const n=t.find((t=>{const s=e.sources.get(t);return s&&!s.internal}));if(n){const t=o.Z.get(n);if(!t)throw new Error("Filter not found "+n);const{accountId:i,path:a}=t;this.imapCopy.push({accountId:i,path:a,destinationPath:s,searchListId:e.id});const r=e.sources.get(n);r&&!r.read&&this.imapAddCustomFlags.set(e.id,new Map([[n,{read:!0}]]))}}}function T(e){const t=new Map;return[...e.keys()].forEach((e=>{const s=o.Z.get(e);if(!s)throw new Error("Filter not found "+e);const{accountId:n}=s,i=t.get(n);i?i.push(e):t.set(n,[e])})),t}async function E(e,t){const{updatedSources:s,imapAddCustomFlags:i,imapCopy:o,imapDelete:r}=e,l=new Set;if(s.size>0&&(l.add(u.Z.searchList),l.add(u.Z.filteringQueue),l.add(u.Z.filters),l.add(u.Z.hasRaw)),(r.length>0||o.length>0||i.size>0)&&(l.add(u.Z.imap),l.add(u.Z.buffer)),l.size>0){let e=[];await u.Z.transaction("rw",[...l],(async()=>{if(s.size>0){e=await w.Z.call(s);const n=[];s.forEach(((e,t)=>{const s=[...e.keys()],i=n.find((({filterIds:e})=>e.length===s.length&&e.every((e=>s.includes(e)))));i?i.searchListIds.push(t):n.push({filterIds:s,searchListIds:[t]})}));for(const{filterIds:e,searchListIds:s}of n)b.Z.call({type:"RE_RUN_SLES",priority:x.Un.HIGH,searchListIds:s,filterIds:e,folderIds:[[x.of,t]]})}i.size>0&&await C.Z.addSourceFlags(i),o.length>0&&await C.Z.addCopy(o),r.length>0&&await C.Z.addDelete(r)})),y.Z.filter(),n.Z.flushBuffer(),e.length>0&&a.Z.updateIndex({sleUpdates:e})}}async function k(e,t,s){const n=new Z;for(const u of e){const{id:e,sources:g}=u,m=T(g);for(const g of m){const m=g[0],f=g[1];if(!(0,I.ZA)(m)){v.Z.warn("Mail",`Can not move message to ${s} on ${m} as it is not an IMAP account`);continue}let b=h.Z.getSubscribedFoldersOfType(m,t);if((!b||0===b.length)&&t===x.hn){if(l.Z.get(A.kMailAddArchiveFolder)||await new Promise((e=>{r.Z.showCreateArchiveFolderConfirmation(d.ZP.getMailWindowId(),(t=>e(t)),(0,c.Z)("Create missing archive folder?"),(0,c.Z)("No archive folder was detected for $1. In order to archive mail an archive folder must be present. Should a new archive folder be created?",[m]))}))){if(!navigator.onLine){(0,S.c)({title:(0,c.Z)("Can not create Archive folder without a network connection"),timeout:3e4,tag:"VIVALDI_MAIL_CREATE_ARCHIVE_FOLDER"}),v.Z.log("Mail",`Can not create Archive folder without a network connection - ${m}`);continue}(0,S.c)({title:(0,c.Z)(`Creating Archive folder for ${m}`),timeout:3e4,tag:"VIVALDI_MAIL_CREATE_ARCHIVE_FOLDER"});const e=h.Z.getFoldersOfType(m,x.e9);if(0===e.length)throw new Error(`No inbox folder found on imap account ${m}`);const t=e[0];await i.Z.createMailbox(m,x.ym,x.$T),b=[{path:x.$T,name:x.$T,type:x.hn,subscribed:!0,delimiter:t.delimiter}];const s=p.ZP.getDefaultFilterForPath(m,x.$T,x.hn);await a.Z.addFilter(s,!1)}else v.Z.warn("Mail",["Move to Archive"],"No archive folder and hence nothing moved")}if(b&&b.length>0){b.length>1&&b.sort(((e,t)=>e.path.split(e.delimiter).length-t.path.split(t.delimiter).length));const t=b[0],{path:s}=t,i=o.Z.getByFolder(m,s);if(!i)throw new Error("Filter not found "+m+" "+s);const{id:a}=i,r=u.sources.get(a);r?r.internal&&n.addImapCopy(u,f,s):(n.addSource(i,e),n.addImapCopy(u,f,s)),f.forEach((t=>{if(a===t)return;const s=u.sources.get(t);if(!s)throw new Error("Source not found "+t+" on listEntry "+u.id);if(s.read||n.addSourceUpdate(t,u.id,{read:!0}),!s.internal){const s=o.Z.get(t);if(!s)throw new Error("Filter not found "+t);n.addImapDelete(m,s.path,e),n.deleteSource(s,e)}}))}}}await E(n,s)}async function N(e,t,s){const n=new Z;e.forEach((e=>{const{id:s,sources:i}=e;T(i).forEach(((a,r)=>{const l=o.Z.getByIds(a),d=l.some((({accountId:e,path:t})=>m.Z.getFolderType(e,t)===x.uT));if(d)l.forEach((({id:e,accountId:i,path:a})=>{m.Z.getFolderType(i,a)===t&&(n.removeSource(e,s),n.addImapDelete(i,a,s))}));else{let d=!1;if(l.forEach((o=>{const{id:r,accountId:l,path:c}=o;if(m.Z.getFolderType(l,c)===t)n.removeSource(r,s),n.addImapDelete(l,c,s);else{d=!0;const t=i.get(r);if(!t)throw new Error("Source not found");t.deleted&&(n.undeleteSource(o,s),n.addImapCopy(e,a,c))}})),!d){const t=h.Z.getFoldersOfType(r,x.e9);if(0===t.length)throw new Error("No inbox found on account "+r);const l=t[0].path,d=o.Z.getByFolder(r,l);if(!d)throw new Error("Inbox filter not found "+r+" "+l);const c=f.Z.call(i);n.addSource(d,s,c),n.addImapCopy(e,a,l)}}}))})),await E(n,s)}const _={moveToJunk:async function(e){g.Z.setJunk(e,!0),await k(e,x.Hd,x.rp)},restoreFromJunk:async function(e){g.Z.setJunk(e,!1),await N(e,x.Hd,x.rp)},moveToArchive:async function(e){await k(e,x.hn,x.$T)},restoreFromArchive:async function(e){await N(e,x.hn,x.$T)}}},75995:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a,o:()=>i});var n=s(95752);function i(e){delete e.isParent,delete e.parentId,delete e.isChild,delete e.children,delete e.unreadInThread}const a={getThreadsAsTree:function(e,t=!0){if(0===e.length)return[];let s;t||e.reverse();let a=[];const o=[e[0]];i(e[0]);for(let t=1;t<e.length;t++){const r=e[t-1],l=e[t];if(i(l),l.threadKey[0]===r.threadKey[0]&&l.threadKey[1]===r.threadKey[1]){if((!s||l.threadKey.length>r.threadKey.length)&&(s?a.push(s):a.push(r),s=r,r.isParent=!0),a.length>0&&l.threadKey.length<r.threadKey.length){const e=l.threadKey.length-1;a=a.slice(0,e),s=a[a.length-1]}l.parentId=s.id,l.isChild=!0,s.children=s.children||[],s.children.push(l),n.Z.call(l.sources)||s.unreadInThread||(s.unreadInThread=!0,a.forEach((e=>e.unreadInThread=!0)))}else o.push(l),s=void 0,a=[]}return t?o:o.reverse()}}},91834:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});const n={updateCounterFolders:function(e,t,s,n){n.forEach((({viewIntersections:n,counter:i})=>{let a=!1,o=!1,r=!1;for(const s of t){if(!a){n.total.get(s)?.every((t=>e.has(t)))&&(a=!0)}if(!o){n.unseen.get(s)?.every((t=>e.has(t)))&&(o=!0)}if(!r){n.unread.get(s)?.every((t=>e.has(t)))&&(r=!0)}}a&&(i.total+=s),o&&(i.unseen+=s),r&&(i.unread+=s)}))}}},77312:(e,t,s)=>{"use strict";s.d(t,{MT:()=>o,TP:()=>r,fN:()=>l});var n=s(45660),i=s(9112),a=s(7064);async function o(e){const t=["attached-pending"];try{await a.Z.mailPrivate.deleteMessageFile(t,e)}catch(t){n.Z.warn("Mail",["attachment"],`Failed to delete pending attachment file ${e} - error: ${t}`)}}async function r(e){const t=[],s=await(0,i.Z)(e);for(const e of s)if(e.bodyParts)for(const s of e.bodyParts)"attachment"===s.type&&"string"==typeof s.content&&t.push(s.content);return t}async function l(e){const t=await r([e]);for(const e of t)await o(e)}},45709:(e,t,s)=>{"use strict";s.d(t,{Z:()=>g,a:()=>p});var n=s(2711),i=s(71320),a=s(10671),o=s(45660),r=(s(20244),s(48868));const l={call:async function(e){0!==e.searchListIds.length?await r.Z.flaggingQueue.add(e):o.Z.debug("Not queueing flag update request with no searchListIds",e)}};var d=s(5863),c=s(49168);function h(e,t,s,n){return u(e,{[t]:s},void 0,n)}function u(e,t,s=new Map,i){const a=e.map((e=>e.id)),r=new Map,d=[];e.forEach((e=>{const n={},i=(0,c.hY)(e.flags,t);e.flags=n.flags=i;const a=s.get(e.id);if(a&&a.size>0){const t=new Map,s=new Map;a.forEach(((i,a)=>{t.set(a,i),!0===i.read&&(e.unseen=n.unseen=!1);const o=e.sources.get(a);if(o){const e={};for(const t of Object.keys(i))i[t]!==o[t]&&(e[t]=o[t]);Object.keys(e).length>0&&s.set(a,e)}})),n.sources=t,r.set(e.id,s)}const{id:o}=e;d.push({id:o,updates:n})}));const h={searchListIds:a,sourcesPerSle:s,flagUpdates:t};if(o.Z.log("Mail",["add to flagging queue"],h),l.call(h),n.Z.updateFlags(),i){const e={};for(const s of Object.keys(t))e[s]=!t[s];const s={operation:"setFlags",searchListIds:new Set(a),updates:e,sourcesPerSle:r};return{sleUpdates:d,undoItem:s}}return{sleUpdates:d}}function p(){return[d.T4.RED,d.T4.ORANGE,d.T4.YELLOW,d.T4.GREEN,d.T4.BLUE,d.T4.PURPLE,d.T4.GRAY,d.T4.CLEAR_FLAGS]}const g={setRead:function(e,t,s=!0){const n=[],o=new Map;return e.forEach((e=>{const{id:s,sources:r}=e,l=new Map;r.forEach(((e,s)=>{const n=i.Z.get(s);if(!n)throw new Error(`filter for sourceFilterId ${s} not found!`);const o=a.Z.getFolderType(n.accountId,n.path)===d.Nz&&!t;e.read===t||o||l.set(s,{read:t})})),l.size>0&&(n.push(e),o.set(s,l))})),n.length>0?u(n,{},o,s):{sleUpdates:[]}},setFlagged:function(e,t){return h(e,d.T4.FLAGGED,t,!1)},setForwarded:function(e,t){return h(e,d.T4.FORWARDED,t,!1)},setReplied:function(e,t){return h(e,d.T4.ANSWERED,t,!1)},setCustomFlags:function(e,t,s=new Map,n=!1){return u(e,t,s,n)},getStandardFlagList:p,setJunk:function(e,t){let s={[d.T4.JUNK]:t,[d.T4.NOT_JUNK]:!t};return t&&(s={...s,NonJunk:!1,NotJunk:!1}),u(e,s,void 0,!1)}}},56887:(e,t,s)=>{"use strict";s.d(t,{O:()=>c,U:()=>d});var n=s(68247),i=s(29087),a=s(10671),o=s(5863),r=s(89175);function l(e){let t=i.Z.get(r.kMailSearchSortField);if(!e)return t;const{accountId:s,path:n}=e;return a.Z.getFolderType(s,n)===o.Nz&&(t=i.Z.get(r.kMailSearchSortFieldSent)),t}function d(e){const t=l(e);if(!e)return t;const s=i.Z.get(r.kMailSearchSortFieldPerFolder),{accountId:n,path:a}=e;if(s[n]&&s[n][a]){const i=s[n][a];return i===t&&c(e,i),i}return t}function c(e,t){const s=i.Z.get(r.kMailSearchSortFieldPerFolder),a={...s},{accountId:o,path:d}=e;s[o]?(a[o]={...s[o]},a[o][d]=t):a[o]={[d]:t},a[o][d]===l(e)&&delete a[o][d],0===Object.keys(a[o]).length&&delete a[o],n.Z.set(r.kMailSearchSortFieldPerFolder,a)}},55603:(e,t,s)=>{"use strict";s.d(t,{F7:()=>p,ME:()=>u,Ro:()=>g});var n=s(98611),i=s(54162),a=s(68131),o=s(45660),r=s(35489),l=s(24522),d=s(5863),c=s(76085),h=s(72494);async function u(e){const t=await m(e);if(t&&"string"!=typeof t){const{feeditems:e}=t,{links:s}=e[0],n=s.alternate.filter((e=>!e.url.match(/^\s*data:/i)));return(0,a.Z)(navigator.languages,n)?.url}}async function p(e){const t=await m(e);if(t&&"string"!=typeof t){const{feeditems:e}=t,{bodyimages:s}=e[0];return s}return[]}function g(e){const{sourceFilterIds:t}=e;return n.Z.getByIds(t).some((e=>e.accountId===d.u4))}async function m(e){const{id:t,sentDate:s,sourceFilterIds:a}=e,u=n.Z.getByIds(a);if(!g(e))return;const p=function(e){const t=i.Z.getSelectedFolder(),s=[],n=[],a=[];for(const i of e)i.accountId!==t?.accountId||t?.path!==d.ym&&i.path!==t?.path?i.accountId===t?.accountId?n.push(i):a.push(i):s.push(i);return{samePathFilters:s,sameAccountFilters:n,otherFilters:a}}(u);let m=await(0,h.K)(p,t,s);if(!m){const e=await r.Z.getBySearchListId(t);e.length>0&&e.every((e=>!e.hasRaw))||(m=await(0,h.K)(p,t,s+l.hd)||await(0,h.K)(p,t,s-l.hd),m&&o.Z.log("Mail",["getBestLinkFromFeed"],"Message was found under wrong day folder"))}if(!m)return void o.Z.info("Feeds","Feed messages without a raw");const f=m,v=new TextDecoder("utf-8").decode(f);return(0,c.ho)(v)}},32593:(e,t,s)=>{"use strict";s.d(t,{C7:()=>S,Gb:()=>T,KJ:()=>A,NQ:()=>Z,m6:()=>E,oN:()=>I,tP:()=>k});var n=s(39045),i=s(2711),a=s(82227),o=s(99827),r=s(29087),l=s(78347),d=s(60308),c=s(9982),h=s(92292),u=s(71320),p=s(51501),g=s(10671),m=s(45660),f=s(24651),v=s(5204),b=s(7064),C=s(99895),w=s(5863),y=s(83065),x=s(89175);async function I(e,t){const s=g.Z.getFolders();if(!("inbox"===t.toLowerCase()&&s[e]&&Object.keys(s[e]).some((e=>"inbox"===e.toLowerCase()))||s[e]&&s[e][t])){const s=S(t),i=l.Z.getAccounts(),a=i[e]?i[e].folders:{},o="/",r=t.split(o),d={name:(0,y.kF)(r[r.length-1]),path:t,delimiter:o,type:s};a[s]=a[s]||[],a[s].push(d),await n.Z.addFolders(e,a),v.Z.addFolders(e,a)}}async function A(e,t){if(!u.Z.getByFolderId([e,t])&&!await a.Z.get(e,t)){const s=S(t),n=p.ZP.getDefaultFilterForPath(e,t,s);await o.Z.addFilter(n,!1)}}function S(e){let t=w.Oi,s=e.toLowerCase();switch(s.startsWith("[gmail]/")&&(s=s.split("/")[1]),s){case"archive":t=w.hn;break;case"drafts":t=w.kY;break;case"inbox":t=w.e9;break;case"junk":case"spam":t=w.Hd;break;case"sent":case"sent mail":t=w.Nz;break;case"trash":t=w.uT}return t}function Z(e,...t){return""!==e&&"/"!==e[e.length-1]&&(e+="/"),e+t.join("/")}async function T(){return new Promise((e=>{l.Z.addListener((function t(){l.Z.removeListener(t),e()}))}))}async function E(e,t,s){r.Z.get(x.kMailAutoGenerateContacts)&&await(0,c.Z)(e,t,s);const{indexUpdates:n,slesToDisk:a}=await d.Z.call(e,t,S(t),s);o.Z.updateIndex(n);const l=[];for(const t of a){const n=s.find((e=>e.messageId===t.messageId&&(!e.sentDate&&!t.sentDate||e.sentDate===t.sentDate)&&e.subject===t.subject));if(!n)throw new Error(`Added sle not found in incoming batch, ${t.messageId}, ${t.sentDate}, ${t.subject}`);l.push(t.id),await C.Z.call(e,t.sentDate,t.id,n.raw)}l.length>0&&await f.Z.setHasRaws(e,l),v.Z.filter(),i.Z.updateThreads()}async function k(){return new Promise(((e,t)=>{try{b.Z.importData.readMessageFromThunderbirdMailbox(((t,s)=>h.Z.runtime.lastError?(m.Z.error("Mail",["import","thunderbird"],"Error reading message",h.Z.runtime.lastError),e()):t?e({message:t,seekPosition:Number(s)}):e()))}catch(t){return m.Z.error("Mail",["import","thunderbird"],"Error reading message",h.Z.runtime.lastError),e()}}))}},19842:(e,t,s)=>{"use strict";s.d(t,{Ds:()=>r,Rr:()=>l,Wm:()=>d,vE:()=>o});var n=s(39005),i=s(96951),a=s(44850);function o(e){return!!a.jk.matchUrl(a.jk.internalUrl("mailpage","composer"),e)}function r(e){return!!a.jk.matchUrl(a.jk.internalUrl("mailpage","message"),e)}function l(e){const t=i.ZP.getActivePage(e);return!!t&&r(t.url)}function d(e){return Boolean(i.ZP.getActivePage(e)?.isMailPage)&&Boolean(n.Z.getActiveMessage())}},88951:(e,t,s)=>{"use strict";function n(e){const t=e?e.substring(e.indexOf("@")+1):"vivaldi.com",s=new Uint32Array(2);return crypto.getRandomValues(s),Date.now()+"."+s.join(".")+"@"+t}s.d(t,{Z:()=>n})},59552:(e,t,s)=>{"use strict";s.d(t,{Z:()=>S});var n=s(43630),i=s(2711),a=s(3184),o=s(99827),r=s(46382),l=s(56371),d=s(48868),c=s(83204),h=s(71320),u=s(10671),p=s(45660),g=s(68906),m=s(20570),f=s(35489),v=s(24651),b=s(35458),C=s(5204),w=s(83507),y=s(99895),x=s(5863),I=s(13248);async function A(e,t){return(await f.Z.getBySearchListId(t)).sort(((t,s)=>t.accountId===e&&t.hasRaw?-1:s.hasRaw-t.hasRaw))}const S=async function(e,t,s,f,S){const{accountId:Z,path:T}=s.find((e=>e.accountId===f))||s.slice(-1)[0];p.Z.log("Mail",["move"],`${Z}/${T}->${f}${S}`);const E=Z===f;let k=Z;for(const s of t){const{id:t}=s,n=await A(Z,t);if(n[0].hasRaw)continue;let i=!1;for(const e of n)if((0,I.mq)(e.accountId)){p.Z.log("Mail",["move"],`Need to fetch source on ${e.accountId}`);if(await a.Z.fetchRawOfMessage(e.accountId,e.searchListId)){await v.Z.setHasRaw(e.accountId,e.searchListId),i=!0,E||(k=e.accountId);break}}if(!i){const t=(0,l.Z)("Aborting the move action because of failure to locate or fetch body for message with subject: $1",[s.subject]);return p.Z.warn("Mail",["move"],t),void r.Z.showModalInfo(e,{title:(0,l.Z)("No messages moved between accounts"),body:t})}}const N=h.Z.getByFolderIds(s.map((e=>[e.accountId,e.path]))),_=h.Z.getByFolderId([f,S]);if(!_)throw new Error(`Could not move messages.\n      No filter found for ${Z}/${T}\n      or ${f}/${S}\n      when trying to move ${t.length} messages`);const P=new Map;t.forEach((e=>{const t=N.filter((t=>e.sources.has(t.id))),s=(n=t).find((e=>e.accountId===f))||n.slice(-1)[0];var n;if(!s)throw new Error(`Can not move message to ${f}/${S}\n        No origin filter found for entry:\n        ${e.subject}\n        with origin filters: ${t.map((e=>`${e.accountId}/${e.path}`)).join(", ")}`);const i=e.sources.get(s.id);if(!i)throw new Error(`Can not move message from ${Z}/${T}\n        No source found for entry:\n        ${e.subject}\n        in filter: ${s.name}`);const a={...i};s.accountId===f||(0,I.mq)(f)||i.internal||(a.internal=!0);const o=new Map;N.forEach((e=>{o.set(e.id,void 0)})),o.set(_.id,a),P.set(e.id,o)}));let M=[];const D=[],O=[],j=[];t.forEach((e=>{if((0,I.mq)(f)){let t=!1;if([...e.sources].some((([s,n])=>{const i=h.Z.get(s);i&&!n.internal&&N.some((e=>e.id===i?.id))&&(i.accountId===f?(t=!0,D.push({accountId:i.accountId,path:i.path,destinationPath:S,searchListId:e.id})):j.push({accountId:i.accountId,path:i.path,searchListId:e.id}))})),!t){const t=[...e.flags].filter((e=>e!==x.T4.DELETED&&e!==x.T4.JUNK));N.some((t=>e.sources.get(t.id)?.read))&&(t.includes(x.T4.SEEN)||t.push(x.T4.SEEN)),O.push({accountId:f,path:S,searchListId:e.id,flags:t})}}}));const L=[d.Z.searchList,d.Z.filteringQueue,d.Z.filters,d.Z.hasRaw];if(D.length>0||j.length>0?L.push(d.Z.buffer,d.Z.imap,d.Z.flaggingQueue):O.length>0&&L.push(d.Z.buffer,d.Z.flaggingQueue),await d.Z.transaction("rw",L,(async()=>{if(D.length>0&&(p.Z.log("Mail",["move"],"Issuing a server side move action"),await n.Z.clearJunkFlags(e,t),await n.Z.clearDeletedFlags(e,t),await m.Z.addMove(D)),O.length>0&&(p.Z.log("Mail",["move"],"Issuing an upload to destination server",f),await m.Z.addUpload(O)),j.length>0)for(const e of N)e.accountId!==f&&(p.Z.log("Mail",["move"],"Issuing a deletion from source server",Z),await m.Z.addDelete(j));p.Z.log("Mail",["move"],"Update source data"),M=await b.Z.call(P);const s=h.Z.getByFolderIds([...N.map((e=>[x.Ry,`${e.accountId}/${e.path}`])),[x.Ry,`${f}/${S}`]]).map((e=>e.id)),i=[...N.map((e=>[e.accountId,e.path])),[f,S]],a=t.map((e=>e.id));1===N.length&&u.Z.getFolderType(Z,T)===u.Z.getFolderType(f,S)?(p.Z.log("Mail",["move"],"Requesting filtering (FILTERS_SLES)"),await g.Z.call({type:"FILTERS_SLES",priority:x.Un.HIGH,folderIds:i,filterIds:s,searchListIds:a})):(p.Z.log("Mail",["move"],"Requesting filtering (RE_RUN_SLES)"),await g.Z.call({type:"RE_RUN_SLES",priority:x.Un.HIGH,folderIds:i,filterIds:s,searchListIds:a}))})),E){p.Z.log("Mail",["move"],"Set hasRaw to true for all in-account source updates");for(const e of t)v.Z.setHasRaw(Z,e.id)}else{p.Z.log("Mail",["move"],"Writing raw files to destination account");for(const e of t){const t=await w.Z.call(k,e.id,e.sentDate);t?(await y.Z.call(f,e.sentDate,e.id,t),await v.Z.setHasRaw(f,e.id)):p.Z.error("Mail",["move"],`Failed to write raw for message ${e.id} to destination account ${f}`)}p.Z.log("Mail",["move"],"Deleting raw files from source account");for(const e of t)await c.Z.call(Z,e.id,e.sentDate)}i.Z.flushBuffer(),C.Z.filter(),M.length>0&&o.Z.updateIndex({sleUpdates:M})}},307:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});var n=s(59322),i=s(44850);function a(e,t,s){var a="message/"+t.id,o=t.subject,r=i.jk.internalUrl("mailpage",a,o);s?n.ZP.openURL(e,r,s):n.ZP.openURL(e,r)}},70611:(e,t,s)=>{"use strict";s.d(t,{yy:()=>r,iT:()=>a});s(20244);var n=s(56371);var i=s(97781);async function a(e){let t;if(function(e){const t=(new DOMParser).parseFromString(e,"text/html");return Boolean(t.body&&Array.from(t.body.getElementsByTagName("*")).every((e=>e instanceof HTMLDivElement||e instanceof HTMLSpanElement||e instanceof HTMLBRElement)))}(e)){const s=document.createElement("iframe");s.setAttribute("style","position:fixed; z-index:-1"),document.body&&document.body.appendChild(s);const n=s.contentDocument.body;n?(n.innerHTML=e,t=await function(e){let t="";const s=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT);let n,i=s.nextNode();for(;i;)"BR"===i.nodeName?("DIV"!==i.parentNode?.nodeName||i.parentNode?.firstChild!==i&&i.parentNode?.lastChild!==i)&&(t+="\n"):i.nodeType===Node.TEXT_NODE?("DIV"!==n?.parentNode?.nodeName||i.parentNode===n||"BR"===n?.nodeName&&n.parentNode===i.parentNode||(t+="\n"),t+=i.nodeValue):"DIV"===i.nodeName&&n&&(t+="\n"),n=i,i=s.nextNode();return t}(n)):console.warn("Could not get plain text because iframe could not be made"),s.remove()}return t?o(t):void 0}function o(e){return e.replace(/\u00A0/g," ")}function r(e){const t=document.createElement("iframe");t.setAttribute("style","position:fixed; z-index:-1"),document.body&&document.body.appendChild(t);const s=t.contentDocument.body;let a="";if(s){const{sanitized:t}=(0,i.Nw)(e,{blockHTTPLeaks:!0});s.innerHTML=t,s.innerText&&(s.querySelectorAll("a").forEach((e=>{""===e.href.trim()||((e.parentElement||e).innerText||"").includes(e.href)||e.after(document.createTextNode(` <${e.href}> `))})),s.querySelectorAll("img").forEach((e=>{e.height&&e.height<=1&&e.width&&e.width<=1||(e.hasAttribute("alt")?""!==e.alt&&e.alt.trim().length>=1&&!(s.innerText||"").includes(e.alt)&&e.after(document.createTextNode(` [${e.alt.trim()}] `)):e.after(document.createTextNode(" ["+(0,n.Z)("Unlabeled Image")+"]")))}))),a=s.innerText||""}else console.warn("Could not get innerText because iframe could not be made");return t.remove(),o(a.trim())}},10124:(e,t,s)=>{"use strict";s.d(t,{Z:()=>i});var n=s(7064);async function i(e){const t=["attached-pending"];try{const s=await n.Z.mailPrivate.readMessageFileToBuffer(t,e);return new Uint8Array(s)}catch(t){throw new Error(`Failed to read attachment buffer (${e}) from disk: ${t}`)}}},67103:(e,t,s)=>{"use strict";s.d(t,{Z:()=>x});var n=s(2711),i=s(99827),a=s(98611),o=s(78347),r=s(71320),l=s(45709),d=s(10671),c=s(97823),h=s(48868),u=s(42228);const p=async function(e){const t=await(0,u.Z)(e),s=[];return await h.Z.searchList.where("id").anyOf([...e.keys()]).modify((n=>{const{id:i,sourceFilterIds:a,sources:o}=n,r=e.get(i),l={sourceFilterIds:[],sources:new Map};r&&r.forEach(((e,n)=>{if(!t.has(n))throw new Error("Can not add a source for a non-existing filter ID "+n);a.includes(n)||(a.push(n),l.sourceFilterIds.push(n)),o.has(n)||(o.set(n,{...e}),l.sources.set(n,{...e})),(l.sourceFilterIds.length>0||l.sources.size>0)&&s.push({id:i,updates:l})}))})),s};var g=s(68906),m=s(20570),f=s(35489),v=s(57488),b=s(93789),C=s(5204),w=s(5863),y=s(51501);const x=async function(e,t){const s=[],h=[],u=[],x=[],I=[],A=new Map,S=[];for(const t of e){const{sources:e}=t;e.forEach(((e,n)=>{const{accountId:i,path:o}=a.Z.get(n),r=d.Z.getFolderType(i,o);i===w.u4?I.push({sourceFilterId:n,listEntry:t}):r===w.uT?e.internal?s.push({sourceFilterId:n,listEntry:t}):h.push({sourceFilterId:n,listEntry:t}):e.internal?u.push({sourceFilterId:n,listEntry:t}):e.deleted&&x.push({sourceFilterId:n,listEntry:t})}))}const Z=new Map;if(u.length>0){const e=await c.Z.loadAllAccounts(),s=[],n=[],i=new Map;for(const a of u){const{sourceFilterId:o,listEntry:l}=a,{id:c,unseen:h,flags:u,sources:p}=l,g=r.Z.get(o),{accountId:m,path:v}=g,b=e.find((e=>e.MAIL_EMAIL===m));if(!b){console.warn("Account not found for accountId "+m);continue}if(b.accountType===w.s9.IMAP){let e=!1;for(const[s,a]of p){if(a.internal||s===o)continue;const l=r.Z.get(s);if(!l||l.accountId!==m)continue;const{path:d}=l;t?.has(c)&&i.set(c,new Map([[l.id,{read:!1}]])),n.push({accountId:m,path:d,destinationPath:v,searchListId:c}),e=!0;break}if(!e){(await f.Z.getBySearchListId(c)).some((e=>e.hasRaw))&&s.push({accountId:m,path:v,searchListId:c,flags:u})}}let C=Z.get(c);C||(C={id:c,unseen:h,flags:u,sources:p},Z.set(c,C));const y=!d.Z.isOnline(m,v),x={read:!t?.has(c)&&!!p.get(o)?.read,internal:y,deleted:!1};let I=A.get(c);I?I.set(o,x):(I=new Map([[o,x]]),A.set(c,I))}i.size>0&&await m.Z.addSourceFlags(i),n.length>0&&await m.Z.addCopy(n),s.length>0&&await m.Z.addUpload(s)}function T(e){const{sourceFilterId:s,listEntry:n}=e,{id:i,unseen:a,flags:o,sources:r}=n;let l=Z.get(i);l||(l={id:i,unseen:a,flags:o,sources:r},Z.set(i,l));const d={read:!t?.has(i)&&!!r.get(s)?.read,deleted:!1};let c=A.get(i);c?c.set(s,d):(c=new Map([[s,d]]),A.set(i,c))}if(x.length>0){const e=new Map;for(const t of x){T(t);const{sourceFilterId:s,listEntry:n}=t,{id:i}=n,a=e.get(s);a?a.push(i):e.set(s,[i])}for(const[t,s]of e){const e=a.Z.get(t);if(!e)throw new Error("Filter not found, id "+t);const{accountId:n,path:i}=e;await v.Z.deleteImapEntries(n,i,s)}}for(const e of I)T(e);const E=new Map;function k(e,t,s){const n=E.get(e);n?n.set(t,s):E.set(e,new Map([[t,s]]))}const N=new Map;function _(e,t){const s=N.get(e);s?s.push(t):N.set(e,[t])}if(h.length>0){const e=[],s=[],i=new Map;for(const n of h){const{sourceFilterId:a,listEntry:l}=n,{id:d,sourceFilterIds:c,sources:h}=l,u=r.Z.getByIds(c),p=u.find((e=>e.id===a)),g=u.filter((e=>e.accountId===p.accountId)),{accountId:m,path:f}=p;if(1===g.length){const s=o.Z.getFoldersOfType(m,w.e9)[0];if(!s)throw new Error("Can not undelete, an inbox folder was not found for "+m);const{path:n}=s,l=r.Z.getByFolderId([m,n]);if(!l)throw new Error(`Filter not found for ${m} ${n}`);t?.has(d)&&i.set(d,new Map([[l.id,{read:!1}]])),e.push({accountId:m,path:f,destinationPath:n,searchListId:d});const c=!t?.has(d)&&!!h.get(a)?.read;k(d,l.id,{read:c,deleted:!1,internal:!0})}else s.push({accountId:m,path:f,searchListId:d});_(d,a)}const a=await p(E);S.push(...a);const l=new y.RW;for(const{id:e,updates:t}of a){const{sourceFilterIds:s}=t;s&&l.add(s,e)}for(const{filterIds:e,searchListIds:t}of l.batches)g.Z.call({type:"FILTERS_SLES",priority:w.Un.NORMAL,filterIds:[...e],searchListIds:t});i.size>0&&await m.Z.addSourceFlags(i),e.length>0&&await m.Z.addMove(e),s.length>0&&await m.Z.addDelete(s),n.Z.flushBuffer()}if(s.length>0){const e=new Map;for(const t of s){const{listEntry:s,sourceFilterId:n}=t,{id:i}=s;_(i,n);const a=e.get(n);a?a.push(i):e.set(n,[i])}for(const[t,s]of e){const e=a.Z.get(t);if(!e)throw new Error("Filter not found, id "+t);const{accountId:n,path:i}=e;await v.Z.uploadEntries(n,i,new Set(s)),await v.Z.copyAndMoveEntries(n,i,s)}}if(N.size>0){const e=[];N.forEach(((t,s)=>{const n=e.find((e=>e.filterIds.size===t.length&&t.every((t=>e.filterIds.has(t)))));n?n.searchListIds.push(s):e.push({filterIds:new Set(t),searchListIds:[s]})}));for(const{searchListIds:t,filterIds:s}of e){const e=[...s],{sleUpdates:n}=await b.Z.call(t,e);S.push(...n);const i=new Map(e.map((e=>[e,void 0])));g.Z.call({type:"UPDATE_SLE",priority:w.Un.HIGH,searchListIds:t,sources:i})}}if(Z.size>0){const{sleUpdates:e}=l.Z.setCustomFlags([...Z.values()],{[w.T4.SEEN]:!1},A,!1);S.push(...e)}S.length>0&&i.Z.updateIndex({sleUpdates:S}),C.Z.filter()}},40382:(e,t,s)=>{"use strict";s.d(t,{Z:()=>o});var n=s(26067),i=s(92292),a=s(7064);function o(e,t,s,o){return r=o,l=(0,n.ZP)(e,t,s),new Promise(((e,t)=>{const{pathArray:s,fileName:n}=l;a.Z.mailPrivate.writeTextToMessageFile(s,n,r,!1,(()=>{i.Z.runtime.lastError&&t({lastError:i.Z.runtime.lastError,pathArray:s,fileName:n}),e()}))})).catch((e=>{console.warn("writeToDisk %o",e)}));var r,l}},94283:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});const n=(0,s(67294).createContext)(window)},80225:(e,t,s)=>{"use strict";s.d(t,{T$:()=>A,aT:()=>C});var n=s(22616),i=s(62882),a=s(56371),o=s(2497),r=s(7064),l=s(8684);const d="---",c=new RegExp("^(\ufeff)?---$"),h=new RegExp(`.(${["md","markdown","txt"].join("|")})$`,"i"),u="title",p="url",g="date",m="lastmod",f=(e,t,s="")=>{const i=""===s?t:`${t}: ${s}`;"import"===e&&n.Z.addImportError("Notes Folder","Notes",i),console.error(`Notes ${e}: ${i}`)},v=(e,t,s)=>{const{title:n="",content:i="",url:a="",dateAdded:o=0,dateModified:r=0,id:l}=s,d=[];if(""!==n&&d.push(u+`: ${n}`),""!==a&&d.push(p+`: ${a}`),o>0){const e=new Date(o).toISOString();d.push(g+`: ${e}`)}if(r>0){const e=new Date(r).toISOString();d.push(m+`: ${e}`)}const c=d.length>0?`---\n${d.join("\n")}\n---\n\n${i}\n`:`${i}\n`,h=new Blob([c]),v=`${(n||i).split("\n")[0].replace(/[/\\?%*:|"<>]/g,"_").trim().substring(0,24)}_${s.id}.md`;e.chrome.fileSystem.getWritableEntry(t,(e=>{e.getFile(v,{create:!0},(e=>{e.createWriter((e=>{let t=!1;e.onwriteend=function(e){if(!t)return t=!0,void this.truncate(h.size)},e.onerror=function(e){f("export",`Failed to export note ID "${l}"`,e.stack)},e.write(h)}))}))}))},b=(e,t,s,n)=>{n>=100?f("export","Exceeded folder recursion depth limit (100)."):s.forEach((s=>{if("folder"===s.type&&s.children&&s.children.length>0){const{title:i,id:a,children:o}=s,r=`${(i||a).split("\n")[0].replace(/[/\\?%*:|"<>]/g,"_").trim().substring(0,24)}`;e.chrome.fileSystem.getWritableEntry(t,(t=>{t.getDirectory(r,{create:!0},(t=>{b(e,t,o,n+1)}))}))}else"note"===s.type&&v(e,t,s)}))},C=async e=>{const t=(0,o.Z)(e),s=i.ZP.getFilteredTree("",{inTrash:!1}).nodes;try{const e=await w(t);if(e){const n=[{title:(0,a.Z)("Vivaldi Notes"),type:"folder",id:"-1",children:s}];b(t,e,n,0),(0,l.c)({title:(0,a.Z)("Finished Exporting Notes"),tag:"VIVALDI_NOTES_EXPORT_DONE"})}}catch(e){f("export","Folder selector problem",e)}},w=e=>new Promise(((t,s)=>{e.chrome.fileSystem.chooseEntry({type:"openDirectory"},(n=>{e.chrome.runtime.lastError?"User cancelled"===e.chrome.runtime.lastError.message?t(void 0):s(e.chrome.runtime.lastError.message):t(n||void 0)}))}));function y(e){switch(e){case"created":return g;case"modified":case"updated":return m;default:return e}}const x=(e,t)=>{t.file((s=>{const n=new FileReader;n.onerror=e=>{const s=e.currentTarget.error.message;f("import",`Failed to read file "${t.name}"`,s)},n.onload=i=>{const a=n.result;if(!a)return;const{headers:o,body:l}=(e=>{const t=e.split("\n"),s={};let n=0;for(let e=0;e<t.length&&!(e>=200);e++){const i=t[e];if(0===e){if(c.test(i))continue;break}if(/^(\w|-)+:\s*.+/i.test(i)){const e=i.match(/^(?<headerKey>(\w|-)+):\s*(?<headerValue>.+)/i);if(e&&e.groups){const{headerKey:t,headerValue:n}=e.groups,i=y(t),a=n;[u,p,g,m].includes(i)&&(s[i]=a)}}else{if(i===d){n=e+1,""===t[n+1]&&n++;break}if(""!==i)break}}return{headers:s,body:t.slice(n).join("\n").trim()}})(a);if(l){const n={parentId:e.toString(),type:"note",title:o.title||t.name.replace(/\.[^.]+$/,"")||"",url:o.url||"",content:l,date:s.lastModified,lastmod:s.lastModified};if(o.date){const e=Date.parse(o.date);!isNaN(e)&&e>0&&(n.date=e)}if(o.lastmod){const e=Date.parse(o.lastmod);!isNaN(e)&&e>0&&(n.lastmod=e)}r.Z.notes.create(n)}},n.readAsText(s)}),(e=>{f("import",`Failed to read file "${t.name}"`,e.stack)}))},I=(e,t,s)=>{if(!e)return void f("import","Could not read from the selected folder.");if(s>=100)return void f("import","Exceeded folder recursion depth limit (100).");e.createReader().readEntries((function(e){e.filter((e=>!e.name.startsWith(".")&&(e.isDirectory||e.isFile&&h.test(e.name)))).forEach((e=>{e.isDirectory?r.Z.notes.create({parentId:t.toString(),type:"folder",title:e.name}).then((t=>I(e,Number(t.id),s+1))):e.isFile&&x(t,e)}))}))},A=async e=>{const t=(0,o.Z)(e);try{const e=await w(t);if(e)try{r.Z.notes.beginImport(),n.Z.setImportProgress("Notes Folder","Notes",0,1),I(e,Number(i.R0),0)}finally{n.Z.setImportProgress("Notes Folder","Notes",1,1),r.Z.notes.endImport()}}catch(e){f("import","Folder selector problem",e)}}},37461:(e,t,s)=>{"use strict";s.d(t,{T:()=>a});var n=s(2497),i=s(7064);async function a(e){try{const t=(0,n.Z)(e);i.Z.savedpasswords.createDelegate(),t.chrome.passwordsPrivate.exportPasswords().catch((e=>{throw new Error(e)}))}catch(e){console.error("Password Export Failed.",e.message)}}},10334:(e,t,s)=>{"use strict";s.d(t,{UL:()=>Q,g2:()=>Fe,v$:()=>J,a5:()=>q,te:()=>X,Ff:()=>ee,hT:()=>ae,Xz:()=>Ae,hm:()=>ge,oE:()=>Ze,CD:()=>fe,$J:()=>oe,S4:()=>Oe,IZ:()=>Ne,sh:()=>De,Dj:()=>ke,JC:()=>Ee,nX:()=>xe,pN:()=>ye,jn:()=>pe,s1:()=>Ie,xh:()=>Te,Kk:()=>_e,JQ:()=>ve,Lm:()=>me,ue:()=>le,Jg:()=>ue,bj:()=>we,fJ:()=>Ce,a$:()=>be,Gr:()=>Pe,vD:()=>ne,fX:()=>je,de:()=>Se,Xf:()=>Re,lp:()=>he,Fm:()=>ce,hV:()=>Me,AE:()=>ie});var n=s(27770),i=s(59486),a=s(56284),o=s(25795),r=s(62819),l=s(62882),d=s(59322),c=s(96951),h=s(29087),u=s(80342),p=s(39206),g=s(63365),m=s(53454),f=s(56371),v=s(92292),b=s(12165),C=s.n(b),w=s(36980),y=s.n(w),x=s(11746),I=s.n(x),A=s(45454),S=s(26036),Z=s(36246);const T=(0,S.Z)("keyword zoom","reset"),E=(e,t,s)=>t.every((t=>{const n=e.label.toLowerCase(),i=e.labelEnglish.toLowerCase();return s?n.includes(t)||i.includes(t):n.includes(t)}));function k(e,t,s){const n=e.trim().toLowerCase().split(" ").filter(Boolean),i=t.filter((e=>function(e,t,s){return((e,t,s)=>{const{keyword:n}=e;if(!n)return;const{validity:i}=n;let a=!1,o=!1,r=t.find((e=>{let t=!1;return a=s&&e===T.labelEnglish||e===T.label,i&&(t=i.test(e)),isNaN(e)||(o=!0),a||o||t}));const l=t.filter((e=>!e.includes(String(r))));if(l.length&&E(e,l,s)){const{min:t,max:s,type:i,defaultValue:l}=n;return a?Object.assign(e,{foundKeyword:!0},{paramValue:l}):("number"==typeof r||o?r=(0,Z.Z)(r,t,s):"mixed"===i&&(r="string"==typeof r?{keyword:n,param:r}:void 0),Object.assign(e,{paramValue:r},{foundKeyword:Boolean(r)}))}})(e,t,s)||E(e,t,s)}(e,n,s)));return i}var N=s(7064),_=s(5422),P=s(75968),M=s(36436),D=s(29489),O=s(93196),j=s(47380),L=s(721),R=s(60339),B=s(89175),F=s(86088),W=s(13302),U=s(44850);const V={"⁰":"0","¹":"1","²":"2","³":"3","⁴":"4","⁵":"5","⁶":"6","⁷":"7","⁸":"8","⁹":"9"},H=(0,f.Z)("textselection","selection"),G=(0,f.Z)("pageurl","page url"),K=(0,f.Z)("websitelink","link url"),z=(0,f.Z)("webpagetitle","page title"),$=(0,f.Z)("elementsource","src url"),Y=e=>(e=`{${e=e.replace(/\s+/g,"_")}}`,{regex:new RegExp(e,"gi"),description:e}),X=Y(H),Q=Y(K),q=Y(G),J=Y(z),ee=Y($),te=20,se=new P._b,ne=(e,t)=>{const s=(0,L.Ek)(t),n=(0,L.Mr)(t),i=(0,A.ZP)(e,t),a=h.Z.get(B.kQuickCommandsOpenUrlInNewTab);return s?(i.inCurrent=!1,i.inBackground=!0):n&&a?i.inCurrent=!0:a&&(i.inCurrent=!1,i.inBackground=!1),i},ie=e=>{if("number"==typeof e||!isNaN(e)){const{min:t,max:s}=(0,O.xU)("COMMAND_TAB_PERIODIC_RELOAD");return(0,Z.Z)(Number(e),t,s)}const{param:t}=e,{min:s,max:n,validity:i}=e.keyword,a=i.exec(t).groups,o=a.min||0,r=a.sec1||a.sec2||0,l=60*parseInt(o)+parseInt(r);return(0,Z.Z)(l,s,n)};async function ae(e,t){const s=(await o.Z.getVivDefinedCommands()).map((e=>{const t=(0,O.xU)(e.name);return{...e,...t&&{keyword:t}}})).concat(_.Y),n=await re(e.windowId,e.origin,e.menuData);for(const i of t){const{key:t,param:a}=i,o=s.find((e=>e.guid.includes(t)));if(!o){console.error(`chainedCommandExecution: Command ${t} not found`);break}const{action:r,keyword:l}=o;let d;if(l){const t=l.defaultValue;switch(d=void 0!==a?a:t,typeof d!==l.type&&"mixed"!==l.type&&"3a8efd62-4c8a-4545-8a6c-9cb65518f507"!==o.guid&&(d=l.defaultValue),typeof d){case"string":d=d.length?d.replace(X.regex,n?.selection?n.selection:"").replace(Q.regex,e.menuData?e.menuData.linkurl:"").replace(q.regex,n?.pageurl?n.pageurl:"").replace(J.regex,n?.pagetitle?n.pagetitle:"").replace(ee.regex,e.menuData?e.menuData.srcurl:""):l.defaultValue;break;case"number":d=(0,Z.Z)(d,l.min,l.max)}}delete e.param,d&&(e.param=d),await r(e)}}const oe=(e,t)=>{const{searchText:s,chains:n,shortcuts:i}=t,a=s.toLowerCase().split(" "),o=h.Z.get(B.kQuickCommandsLimitResults),r=h.Z.get(B.kQuickCommandsSearchPriority),l=(0,j.m)("qc",e);let d=n.filter((e=>a.every((t=>e.label.toLowerCase().includes(t)&&e.chain.length)))).map((e=>{const{chain:t,key:s,label:n,name:a}=e,o=i.find((e=>e.name===a));return{name:n,id:s,meta:o&&o.shortcuts?.length?o.shortcuts[0]:"",type:"commandChain",selectPriority:r.indexOf("COMMAND_CHAIN"),action:()=>ae(l,t)}}));return o&&(d=d.slice(0,te)),de({title:(0,f.Z)("Command Chains"),array:d})},re=async(e,t,s)=>{const n=c.ZP.getActivePage(e);if(!n)return;if("menu"===t||"event"===t)return s;return{selection:await N.Z.utilities.getSelectedText(n.id)??"",pageurl:n.url,pagetitle:n.title}};function le(e,t){const s=e.toLowerCase(),n=t.toLowerCase();return s.indexOf(n)}function de(e){const{title:t,array:s,subtitle:n}=e;return s.length?(s.unshift({name:t,type:"title",subtitle:n??null,count:s.length}),s):[]}function ce(e,t){return h.Z.get(B.kQuickCommandsSearchEnglish)?!0===(t.regex.test(e)||t.regexSearchEnglish.test(e)):t.regex.test(e)}function he(e){const{label:t,initialPart:s="",endingPart:n=""}=e;return`${s}${`${t.substring(0,2)}?`}${`${t.split("").slice(2).join("?")}?`}${n}`}function ue(e,t){const s=h.Z.get(B.kQuickCommandsSearchPriority).length,{selectPriority:n=s}=e;return{priority:n,selectIndex:t}}function pe(e){const{initialPart:t,endingPart:s}=e,{label:n,labelEnglish:i}=e.labelPair,a=he({label:n,initialPart:t,endingPart:s}),o=he({label:i,initialPart:t,endingPart:s});return{regex:new RegExp(a,"i"),regexSearchEnglish:new RegExp(o,"i")}}function ge(e){const t=i.Z.getNicknamed(e,!1).map((e=>{const{url:t=""}=e;return{folderId:e.children?e.id:void 0,type:"bookmarkNick",name:e.title,url:e.children?void 0:t,selectPriority:-1,nickname:e.nickname,faviconUrl:e.children?F._TQ.small:U.jk.getFavicon(t)}}));return de({title:(0,f.Z)("Nickname Match"),array:t})}function me(e){const t=e?u.Z.getFilter(e):[],s=h.Z.get(B.kQuickCommandsSearchPriority),n=t.map((e=>({type:"readingList",name:e.title,selectPriority:s.indexOf("READING_LIST"),url:e.url,faviconUrl:U.jk.getFavicon(e.url),read:e.read})));return de({title:(0,f.Z)("Reading List"),array:n})}function fe(e){const t=e.replace(/,/g,".").replace(/x/gi,"*").replace(/×/g,"*").replace(/÷/g,"/").replace(/−/g,"-").replace(/√/g,"sqrt").replace(/([^\s])([⁰¹²³⁴⁵⁶⁷⁸⁹]+)/gu,"$1 ^ $2 ").replace(/[⁰¹²³⁴⁵⁶⁷⁸⁹]/gu,(e=>V[e]));if(!t)return[];let s;try{s=se.evaluate(t)}catch(e){}if(void 0===s||"function"==typeof s)return[];let n=s;const i=`${String.fromCharCode(8722)}0`,a=`${String.fromCharCode(45)}0`,o=h.Z.get(B.kQuickCommandsSearchPriority);n!==i&&n!==a||(n="0");return[{name:n.toString(),searchString:e,selectPriority:o.indexOf("CALCULATOR"),type:"calculator"}]}function ve(e){const t=e.toLowerCase().split(" "),s=h.Z.get(B.kQuickCommandsSearchPriority).indexOf("OPEN_TABS"),n=h.Z.get(B.kWorkspacesEnabled),i=c.ZP.filterPagesInAllWindows((e=>Le(e.title,e.url,t))).toArray().map((e=>{const{url:t,id:i}=e;return{name:U.jk.getDisplayTitle(e),url:(0,M.xl)(t)?"":t,type:"openTab",selectPriority:s,pageId:i,windowId:e.windowId,pageUrlForFavicon:t,faviconUrl:U.jk.getFavicon(t),workspaceId:n?e.vivExtData.workspaceId:void 0}}));return de({title:(0,f.Z)("Tabs"),array:i})}async function be(e){const t=await N.Z.tabsPrivate.getSendTabToSelfTargets(e);return t.valid?t.entries:[]}function Ce(e,t,s){let n=[];const i=c.ZP.getActivePage(e);if(i){const e=h.Z.get(B.kQuickCommandsSearchPriority),a=t.toLowerCase();n=s.map((t=>({guid:t.guid,deviceType:t.type,pageUrl:i.url,title:i.title,name:(0,f.Z)("Send to $1",[t.name]),type:"sendtabtoself",selectPriority:e.indexOf("SEND_TAB_TO_SELF")}))).filter((e=>-1!==e.name.toLowerCase().indexOf(a)))}return de({title:(0,f.Z)("Send Tab to Your Devices"),array:n})}function we(e){return"phone"===e?y():"tablet"===e?I():C()}async function ye(){return N.Z.extensionActionUtils.getToolbarExtensions()}function xe(e,t){const s=h.Z.get(B.kQuickCommandsSearchPriority),n=h.Z.get(B.kQuickCommandsLimitResults),i=e.toLowerCase().split(" ");let a=t.filter((e=>{const t=e.name?.toLowerCase();return i.every((e=>t?.includes(e)))})).map((e=>{const t=e.enabled?e.badgeIcon:F.N_W;return{name:e.name,faviconUrl:t,id:e.id,type:"extension",enabled:e.enabled,optionsUrl:e.optionspage,selectPriority:s.indexOf("EXTENSIONS")}}));n&&(a=a.slice(0,te));const o=(0,W.$)("ctrl");return de({title:(0,f.Z)("Extensions"),array:a,subtitle:(0,f.Z)("Open Options Page with $1",[o])})}function Ie(e){const t=h.Z.get(B.kQuickCommandsSearchPriority),s=h.Z.get(B.kQuickCommandsLimitResults),{searchText:n,today:i}=e;let a=r.Z.getFilteredHistory(n,i).map((e=>{const{url:s,title:n,visitCount:i,visitTime:a}=e;return{type:"history",faviconUrl:U.jk.getFavicon(s),selectPriority:t.indexOf("HISTORY"),url:s,name:n,visitTime:a,visitCount:i}}));return s&&(a=a.slice(0,te)),de({title:(0,f.Z)("History"),array:a})}function Ae(e){const t=h.Z.get(B.kQuickCommandsSearchPriority),s=h.Z.get(B.kQuickCommandsLimitResults),n=e.toLowerCase();let a=i.Z.getFilteredFlat(n,{bookmarks:!1,folders:!0,inTrash:!1}).filter((e=>e.nickname.toLowerCase()!==n)).map((e=>({folderId:e.id,type:"bookmarkFolder",name:e.title,selectPriority:t.indexOf("BOOKMARK_ITEM_OR_FOLDER"),nickname:e.nickname,faviconUrl:F._TQ.small})));return s&&(a=a.slice(0,te)),de({title:(0,f.Z)("Open All Bookmarks in Folder"),array:a})}async function Se(e,t){const{id:s,enabled:n,optionsPage:i,optionsUrl:a}=t;n||await v.Z.management.setEnabled(s,!0),i&&a.length?d.ZP.openURL(e,a,{inCurrent:!i}):Fe.emitChange(s)}function Ze(e){const t=h.Z.get(B.kQuickCommandsSearchPriority),s=h.Z.get(B.kQuickCommandsLimitResults),n=e.toLowerCase();let a=i.Z.getFilteredFlat(n,{bookmarks:!0,folders:!1,inTrash:!1}).filter((e=>e.nickname.toLowerCase()!==n&&i.Z.isBookmark(e))).map((e=>{const{url:s="",nickname:n,title:i}=e;return{type:"bookmark",name:i,url:s,selectPriority:t.indexOf("BOOKMARK_ITEM_OR_FOLDER"),nickname:n,faviconUrl:U.jk.getFavicon(s)}}));return s&&(a=a.slice(0,te)),de({title:(0,f.Z)("Bookmarks"),array:a})}function Te(e){const t=e.split(" ")[0],s=p.Z.getByKeyword(t);if(!s)return[];const n=e.substring(t.length).trim();return[{name:(0,f.Z)("Keyword Search “$1” on $2",[n,s.name]),nickname:s.keyword,type:"keywordSearch",faviconUrl:s.faviconUrl,selectPriority:-1,searchQuery:e}]}function Ee(e,t){const s=h.Z.get(B.kQuickCommandsSearchPriority);return{name:(0,f.Z)("Search “$1” on $2",[e,t?.name??""]),type:"search",faviconUrl:t?t.faviconUrl:"",selectPriority:s.indexOf("KEYWORD_SEARCH"),searchQuery:e}}function ke(e){return e.length<4?[]:[{name:(0,f.Z)("Create Note “$1”",[e]),type:"noteAdd",value:e}]}function Ne(e,t){const s=o.Z.getQuickCommands(e).map((e=>{const t=(0,O.xU)(e.name);return{...e,foundKeyword:!1,...t&&{keyword:t}}})),n=h.Z.get(B.kQuickCommandsSearchEnglish),i=k(t,s,n).map((e=>{const t=o.Z.getCommandConfiguration(e.name),{label:s,foundKeyword:i,keyword:a,paramValue:r,labelEnglish:l}=e;let d=s;const c=r&&i?r:void 0;a&&(d=i?(0,f.Z)("Run $1",[s]):s+" #");const u=h.Z.get(B.kQuickCommandsSearchPriority);return{name:d,type:a?"commandKeyword":"command",meta:t?.shortcuts?t.shortcuts[0]:"",commandName:e.name,searchString:s,selectPriority:i?-1:u.indexOf("NORMAL_COMMAND"),value:c,...n&&{labelEnglish:l}}}));return de({title:(0,f.Z)("Commands"),array:i})}function _e(e){const t=h.Z.get(B.kQuickCommandsSearchPriority),s=h.Z.get(B.kQuickCommandsLimitResults);let n=l.ZP.getFilteredFlat(e,{inTrash:!1}).map((e=>{const{id:s,title:n,children:i,content:a,url:o,type:r}=e,l="note"===r&&i&&i.length>0;return{type:"note",id:s,url:o||"",name:n||a||"",isFolder:void 0!==i?.length&&"note"!==r,selectPriority:t.indexOf("NOTES_SEARCH"),nickname:n&&a?a:"",hasAttachment:l}}));return s&&(n=n.slice(0,te)),de({title:(0,f.Z)("Notes"),array:n})}function Pe(e){const t=(0,M.q9)(e);if(!(0,M.C3)(e)&&!(0,M.xl)(e)||!t.length)return[];const s=h.Z.get(B.kQuickCommandsSearchPriority),n={name:t,type:"url",selectPriority:(0,M.Zj)(e)?s.indexOf("KEYWORD_SEARCH")-1:-1,pageUrlForFavicon:t,faviconUrl:U.jk.getFavicon(t)};return de({title:t.toLowerCase().startsWith("javascript:")?(0,f.Z)("Execute"):(0,f.Z)("Go to Address"),array:[n]})}async function Me(e,t){const s=i.Z.getItemById(t);if(s&&i.Z.isFolder(s)){const t=n.ZP.getBookmarksByNode(s),i={inCurrent:!h.Z.get(B.kBookmarksOpenInNewTab),inBackground:!1,inNewWindow:!1,incognito:!1,transition:N.Z.historyPrivate.TransitionType.AUTO_BOOKMARK};n.ZP.open(e,t,i,!0)}}function De(e,t){const s=e.toLowerCase().split(" "),n=h.Z.get(B.kQuickCommandsSearchPriority),i=t.filter((e=>s.every((t=>(0,D.gD)(e).toLowerCase().includes(t))))).map((e=>({type:"contentScript",selectPriority:n.indexOf("PAGE_ACTIONS"),script:e,name:(0,D.gD)(e)})));return de({title:(0,f.Z)("Page Actions"),array:i})}function Oe(e){const t=h.Z.get(B.kQuickCommandsSearchPriority),s=h.Z.get(B.kQuickCommandsLimitResults),n=e.toLowerCase().split(" ");let i=g.Z.getTrash().flatMap((e=>e.window?.tabs?e.window.tabs.flatMap((t=>({lastModified:e.lastModified,...t}))):{lastModified:e.lastModified,...e.tab})).filter((e=>Le(e.title||"",e.url||"",n))).map((e=>{const s=e.url||"";return{name:e.title||"",url:(0,M.xl)(s)?"":s,type:"closedTab",selectPriority:t.indexOf("CLOSED_TABS"),pageUrlForFavicon:s,faviconUrl:U.jk.getFavicon(s),command:e}}));return s&&(i=i.slice(0,te)),de({title:(0,f.Z)("Closed Tabs"),array:i})}function je(e){const t=h.Z.get(B.kQuickCommandsSearchPriority),s=e.toLowerCase().split(" "),n=m.Z.getState().flatMap((e=>s.some((t=>e.name.toLowerCase().includes(t)))?{name:e.name,type:"workspace",selectPriority:t.indexOf("WORKSPACES"),workspaceId:e.id}:[]));let i;return i=s.some((e=>(0,f.Z)("This Window").toLowerCase().includes(e)))?[{name:(0,f.Z)("This Window"),type:"workspace",selectPriority:t.indexOf("WORKSPACES"),workspaceId:void 0}].concat(n):n,de({title:(0,f.Z)("Workspaces"),array:i})}function Le(e,t,s){const n=(0,M.xl)(t)?e:`${e} ${t}`;return s.every((e=>n.toLowerCase().includes(e)))}function Re(e){c.ZP.getDiscardablePages(e).filter((e=>!(0,R.ZN)(e))).forEach(d.ZP.discardPage)}class Be extends a.Z{}const Fe=new Be},21343:(e,t,s)=>{"use strict";s.d(t,{M8:()=>u,l_:()=>p});var n=s(22616),i=s(56371),a=s(2497),o=s(7064);function r(e){if(!/(^\s|[\n,"]|\s$)/.test(e))return e;return`"${e.replace(/"/g,'""')}"`}var l=s(8684);const d="URL,Title,Selection,Folder,Timestamp",c="Unread",h=(e,t,s,i="")=>{const a=""===i?s:`${s}: ${i}`;"import"===e&&n.Z.addImportError("Reading List",t,a),console.error(`Reading List ${e}: ${a}`)};async function u(e){const t=(0,a.Z)(e),s=await async function({showSaveFilePicker:e}){try{return await e({suggestedName:"Vivaldi Reading List.csv",types:[{accept:{"text/csv":[".csv"]},description:(0,i.Z)(".csv files")}]})}catch(e){return"AbortError"!==e.name&&console.warn("Failed to select file",e),Promise.resolve(void 0)}}(t);if(!s)return;const n=await async function(){let e=`${d}\r\n`;return await o.Z.readingListPrivate.getAll().then((t=>(t.sort(((e,t)=>e.lastUpdate-t.lastUpdate)).forEach((t=>{const s=r(t.url),n=r(t.title||""),i=t.read?"Archive":c,a=Math.round((t.lastUpdate||Date.now())/1e3);e+=`${s},${n},,${i},${a}\r\n`})),e)))}();try{const e=await s.createWritable();await e.write(n),await e.close(),(0,l.c)({title:(0,i.Z)("Finished Exporting Reading List"),tag:"VIVALDI_READINGLIST_EXPORT_DONE"})}catch(e){h("export","Exporting Reading List failed: ",e)}}async function p(e){const t=(0,a.Z)(e),s=await async function({showOpenFilePicker:e}){const[t]=await e({types:[{accept:{"text/csv":[".csv"]},description:(0,i.Z)(".csv files")}]});return t}(t);if(!s)return void h("import","unknown","Failed to read file.");const r=await async function(e){const t=await e.getFile();return new Promise(((e,s)=>{const n=new FileReader;n.onloadend=()=>{n.result instanceof ArrayBuffer?e(n.result):s()},n.readAsArrayBuffer(t),n.onerror=e=>{h("import","unknown","Failed to read a file.",(n.error||"").toString()),s()}}))}(s),u=new Uint8Array(r),p=new TextDecoder("utf-8").decode(u);let g;n.Z.setImportProgress("Reading List",s.name,0,1);try{g=function(e){if(""===e.trim())return null;const t=Array.from(e.trimEnd().replace(/\r\n/g,"\n"));let s=!1,n=!1,i=!1,a=!1,o="",r=[];const l=[];if(t.forEach(((e,d)=>{if(d===t.length-1){if(","===e)r.push(o),r.push("");else if(s&&'"'===e)s=!1,r.push(o);else if("\n"===e)r.push(i?o:o.trim());else{if(a)throw new Error("CSV parsing encountered an unexpected character outside an escape sequence in a cell.");o+=e,r.push(o)}l.push(r)}else switch(e){case'"':if(n&&s){o+='"',n=!1;break}if(n&&!s){s=!0,i=!0,n=!0,o="";break}n=!0;break;case",":if(!s&&n){n=!1,s=!0,i=!0,o=",";break}if(s&&!n){o+=",";break}s&&n&&(s=!1,n=!1),r.push(i?o:o.trim()),o="",i=!1,a=!1;break;case"\n":if(n&&s)s=!1,n=!1,a=!1;else{if(n&&!s){s=!0,i=!0,n=!1,o+="\n";break}if(!n&&s){o+="\n";break}}if(0===o.length&&0===r.length)break;r.push(i?o:o.trim()),l.push(r),o="",r=[],i=!1;break;default:if(n){if(!s){s=!0,i=!0,n=!1,o=e;break}if(a=!0,/ |\t/.test(e))break;throw new Error("CSV parsing encountered an unexpected character outside an escape sequence in a cell.")}a||(o+=e)}})),s)throw new Error("CSV parsing ended with an unterminated escape sequence.");return 0===l.length?null:l}(p)}catch(e){return void h("import",s.name,"Failed to parse CSV file.",e)}if(null===g||!g.shift()?.join(",").startsWith(d))return void h("import",s.name,`File not in the expected CSV file format. (Headers: ${d}).`);let m=0;g.forEach((async e=>{if(e.length<5)return void h("import",s.name,"Fewer than the expected minimum number of columns (5).");let t;try{t=new URL(e[0]).toString()}catch(e){return void h("import",s.name,"Invalid or missing URL.",e)}const n=e[1],i=e[3]!==c;o.Z.readingListPrivate.add(t,n).then((()=>{m++,o.Z.readingListPrivate.setReadStatus(t,i)})).catch((e=>{h("import",s.name,`Failed to import “${t}”.`,e)}))})),n.Z.setImportProgress("Reading List",s.name,m,m),(0,l.c)({title:(0,i.Z)("Finished Importing Reading List"),tag:"VIVALDI_READINGLIST_IMPORT_DONE"})}},68131:(e,t,s)=>{"use strict";function n(e,t){if(!t.length)return null;if(1===t.length)return t[0];const s=t.filter((e=>e.hreflang)).map((e=>({lang:e.hreflang?.replace(/_/g,"-").toLowerCase()??"",val:e}))),n=t.filter((e=>!e.hreflang));if(!s.length)return n[0];e=e.map((e=>e.replace(/_/g,"-").toLowerCase()));let i=!1;do{for(let t=0;t<e.length;t++){const n=s.find((s=>s.lang===e[t]));if(n)return n.val}i=!1,s.forEach((e=>{const t=e.lang.lastIndexOf("-");-1!==t&&(i=!0,e.lang=e.lang.substring(0,t))}))}while(i);e=e.map((e=>e.replace(/-[\w\W]*$/g,"").toLowerCase()));for(let t=0;t<e.length;t++){const n=s.find((s=>s.lang===e[t]));if(n)return n.val}return n.length?n[0]:s[0].val}s.d(t,{Z:()=>n})},11472:(e,t,s)=>{"use strict";s.d(t,{K:()=>p,O:()=>g});var n=s(29087),i=s(56371),a=s(68131);var o=s(85834),r=s(87422),l=s(79113),d=s(89175),c=s(76085);const h=/^\s*data:/i,u="x-vivaldi/feed-embeddable-media/youtube";function p(e){if(""===e)return[];const t=(0,c.ho)(e);if("string"==typeof t)return[{type:"html",content:`<html><body><p>${(0,i.Z)("Error: $1",[t])}</p></body></html>`}];const{feeditems:s}=t;return s.length?g(s[0]):[{type:"html",content:`<html><body><p>${(0,i.Z)("Error: $1",["NO_FEED_ITEM"])}</p></body></html>`}]}function g(e){const{htmlbody:t,htmlrights:s,links:n}=e,i=[{type:"html",content:`<main>\n      ${t}\n    </main>\n    ${C(n,t)}\n    ${m(s)}`}];return[["alternate",n.alternate],["enclosure",n.enclosure],["related",n.related],["via",n.via],["comments",n.comments],["serviceedit",n.serviceedit]].forEach((([e,t])=>{let s=1;t.filter((e=>e.url.match(h))).forEach((t=>{const n=function(e,t){let s="us-ascii",n="text/plain";if(t){const e=t.match(/;\s*charset\s*=\s*("\s*)?([^\s;"]+)/i);e&&(s=e[2]),n=t.replace(/;[\w\W]*$|\s+/g,"")||n}const i={valid:!1,protocol:"",mimeType:n,charset:s,base64:!1,data:""},a=e.match(/^\s*data:([^,]*),([\w\W]*)$/i);if(a){i.valid=!0,i.protocol="data:",i.data=a[2];const e=a[1].split(";");e.forEach(((t,s)=>{if(!s&&/^\s*[a-z]*\/[\w!#$&\-^\.\+]+\s*$/.test(t))i.mimeType=t.replace(/\s+/g,"").toLowerCase();else{let n,a;const o=t.indexOf("=");-1===o?n=t:(n=t.substring(0,o),a=t.substring(o+1).replace(/^\s+|"|\s+$/g,"")),n=n.toLowerCase().replace(/^\s+|\s+$/g,""),"charset"===n&&a?i.charset=a.toLowerCase():"base64"===n&&-1===o&&s===e.length-1&&(i.base64=!0,i.data=i.data.replace(/\s+/g,""))}}))}return i}(t.url,t.mimetype),{valid:a,mimeType:l,charset:d,base64:c}=n;let h=c?(0,o.tV)(n.data):n.data;if(a&&h){let n=t.title.replace(/[\\\/?%*:|"<>\s]/g,"")||`${e}${s++}`;const a=n.replace(/^([^\.]*$|[\w\W]*\.)/,"").toLowerCase(),o=(0,r.nv)(l,a);if(o!==a&&(n=`${n}.${o}`),!c)if("utf-8"===d)try{h=decodeURIComponent(h)}catch(e){h=unescape(h)}else if("us-ascii"===d||"iso-8859-1"===d)h=unescape(h);else{const e=h.length;let t=0;const s=[];for(;t<e;){const n=h.substring(t,t+1);if("%"===n&&e-t>=3){const e=h.substring(t+1,t+2),i=h.substring(t+2,t+3);isNaN(parseInt(e,16))||isNaN(parseInt(i,16))?s.push(n.charCodeAt(0)):(s.push(parseInt(`${e}${i}`,16)),t+=2)}else{const e=n.charCodeAt(0);if(e>255){(new TextEncoder).encode(n).forEach((e=>s.push(e)))}else s.push(e)}t++}try{h=new TextDecoder(d).decode(new Uint8Array(s))}catch(e){try{h=decodeURIComponent(h)}catch(e){h=unescape(h)}}}const u={type:"attachment",mimeType:l,filename:n,content:(new TextEncoder).encode(h),fileSize:h.length};i.push(u)}}))})),i}const m=e=>e?`<footer>${e}</footer>`:"";function f(e=""){const t=document.createElement("div");return t.textContent=e,t.innerHTML}const v=(e,t)=>{const s=e.hreflang&&"string"==typeof e.hreflang?` hreflang="${f(e.hreflang)}`:"";return`<li>\n    <a href="${f(e.url)}"${s}>\n    ${f("string"==typeof e.title&&""!==e.title?e.title:t.length?t:e.url)}\n    </a>\n    </li>`},b=(e,t)=>`<figure>\n    ${e}\n    ${t?`<figcaption>${f(t)}</figcaption>`:""}\n    </figure>`;const C=(e,t)=>{const s=[],o=e=>!e.url.match(h),r=document.createElement("video"),c=/^(image|img)\/(jpe?g|gif|a?png|svg+xml|bmp|x-icon|webp)(\b|$)/i,p=/^[^\?#]*\.(jpe?g|gif|a?png|svg|bmp|ico|cur|webp)(\?|#|$)/i,g=e.enclosure.filter(o);let m=[];/<(img|image)\s/i.test(t)||(m=g.filter((e=>e.mimetype?e.mimetype?.match(c):e.url.match(p))));const C=g.filter((e=>{const t=e.mimetype;if(t&&/^video\//i.test(t))return r.canPlayType(t);if(n.Z.get(d.kRssEmbedYoutubeAttachments)){const t=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/gi.exec(e.url);if(t&&t[1])return e.mimetype=u,e.url=t[1],!0}return!1})),w=g.filter((e=>{const t=e.mimetype;return!(!t||!/^audio\//i.test(t))&&r.canPlayType(t)})),y=g.filter((e=>!(m.includes(e)||C.includes(e)||w.includes(e))));s.push("<nav>");const x=e.alternate.filter(o),I=(0,a.Z)(navigator.languages,x);s.push('<ul class="mainbutton">'),I&&s.push(v(I,(0,i.Z)("Open article"))),s.push("</ul>"),x.length>1&&(s.push(`<h2>${(0,i.Z)("Main article")}</h2><ul>`),x.forEach((e=>{e!==I&&s.push(v(e,(0,i.Z)("Open article")))})),s.push("</ul>")),y.length&&(s.push(`<h2>${(0,i.Z)("Attachments")}</h2><ul>`),y.forEach((e=>{s.push(v(e,""))})),s.push("</ul>"));const A=e.related.filter(o);A.length&&(s.push(`<h2>${(0,i.Z)("Related content")}</h2><ul>`),A.forEach((e=>{s.push(v(e,""))})),s.push("</ul>"));const S=e.via.filter(o);S.length&&(s.push(`<h2>${(0,i.Z)("Sources")}</h2><ul>`),S.forEach((e=>{s.push(v(e,""))})),s.push("</ul>"));const Z=e.comments.filter(o);Z.length&&(s.push(`<h2>${(0,i.Z)("Comments")}</h2><ul>`),Z.forEach((e=>{s.push(v(e,""))})),s.push("</ul>"));const T=e.serviceedit.filter(o);return T.length&&(s.push(`<h2>${(0,i.Z)("Edit blog post")}</h2><ul>`),T.forEach((e=>{s.push(v(e,""))})),s.push("</ul>")),s.push("</nav>"),(m.length||C.length||w.length)&&(C.length&&(s.push(`<section><h2>${(0,i.Z)("Linked videos")}</h2>`),C.forEach((e=>{e.mimetype===u?s.push(function({url:e}){return b((0,l.w)(e))}(e)):s.push((e=>b(`<video controls src="${f(e.url)}"></video>`,e.title))(e))})),s.push("</section>")),w.length&&(s.push(`<section><h2>${(0,i.Z)("Linked audio")}</h2>`),w.forEach((e=>{s.push((e=>b(`<audio controls src="${f(e.url)}"></audio>`,e.title))(e))})),s.push("</section>")),m.length&&(s.push(`<section><h2>${(0,i.Z)("Linked images")}</h2>`),m.forEach((e=>{s.push((e=>{const t=e.title?` alt="${f(e.title)}"`:"";return b(`<img src="${f(e.url)}"${t}>`,e.title)})(e))})),s.push("</section>"))),s.join("")}},79113:(e,t,s)=>{"use strict";function n(e){const t=function(e){return`https://www.youtube-nocookie.com/embed/${e}?rel=0`}(e);return`<iframe src="${t}" frameborder="0" allowfullscreen></iframe>`}s.d(t,{w:()=>n})},18806:(e,t,s)=>{"use strict";function n(e,t){const s=e[t];return"string"==typeof s?s:""}function i(e,t){if(/^\s*#/.test(e))return e;try{return new URL(e,t).href}catch(t){return e}}function a(e){try{return new URL(e),!0}catch(e){return!1}}function o(e,t){const s=[...e.attributes].find((e=>e.nodeName.toLowerCase()===t));return s?s.nodeName:""}s.d(t,{A:()=>l,n:()=>d});const r=/^\s*(https?|ftp|file):/i;function l(e,t){if(!(t&&r.test(t)&&a(t)&&/<[a-z][\w\-:]*[\s\/][^>]*=|<style\b/i.test(e)))return e;const s=(new DOMParser).parseFromString(e,"text/html"),n=s.documentElement,i=s.head,o=s.body;if(!(s&&n instanceof Element&&i instanceof Element&&o instanceof Element))return e;const l=/<html\b/i.test(e),c=/<head\b/i.test(e),h=/<(body|frameset)\b/i.test(e),u=n.attributes.length,p=i.attributes.length,g=o.attributes.length,m=i.childNodes.length,f=o.childNodes.length;let v;if(c||p||m||!i.parentNode||i.parentNode.removeChild(i),h||g||f||!o.parentNode||o.parentNode.removeChild(o),l||u)v=s.createElement("div"),v.appendChild(n);else{if(!n.children.length)return e;v=h||g||c||p||m&&f?n:m?i:o}return d(v,t).innerHTML}function d(e,t){if(!t||!r.test(t)||!a(t))return e;const s=document.implementation.createDocument("http://www.w3.org/1999/xhtml","html",null),l=[...e.getElementsByTagName("base")].filter((e=>o(e,"href")));if(l.length){const e=l[0].getAttribute(o(l[0],"href"));if(e&&r.test(e)&&a(e))t=e;else if(e&&!/^\s*[a-z0-9\-\+\.]+:/i.test(e)){const s=i(e,t);!r.test(s)&&a(s)||(t=s)}l.forEach((e=>{e.parentNode&&e.parentNode.removeChild(e)}))}const d=s.documentElement;if(!d)return e;const c=s.createElement("base");c instanceof HTMLBaseElement&&(c.href=t,d.appendChild(c));const h=s.importNode(e,!0);d&&d.appendChild(h);const u=[{attr:"action",prop:"action",check:"",pattern:null,replacer:null},{attr:"archive",prop:"",check:"archive",pattern:/([^\s]+)/g,replacer:function(e,s){return i(s,t)}},{attr:"background",prop:"",check:"background",pattern:null,replacer:null},{attr:"cite",prop:"cite",check:"",pattern:null,replacer:null},{attr:"data",prop:"data",check:"",pattern:null,replacer:null},{attr:"formaction",prop:"formAction",check:"",pattern:null,replacer:null},{attr:"longdesc",prop:"longDesc",check:"",pattern:null,replacer:null},{attr:"href",prop:"href",check:"",pattern:null,replacer:null},{attr:"poster",prop:"poster",check:"",pattern:null,replacer:null},{attr:"src",prop:"src",check:"",pattern:null,replacer:null},{attr:"srcset",prop:"",check:"srcset",pattern:/([^,\s]+)(\s+[^,\s]+)/g,replacer:function(e,s,n){return i(s,t)+n}},{attr:"xml:link",prop:"",check:"",pattern:null,replacer:null}],p=h.getElementsByTagName("*");for(let e=0;e<p.length;e++){const a=p[e];let r;try{r=s.createElement(a.localName.toLowerCase())}catch(e){r=s.createElement(a.localName.toLowerCase().replace(/[^\w:\-].*$/,""))}d.appendChild(r);for(const{attr:e,prop:s,check:l,pattern:d,replacer:c}of u){const h=o(a,e);if(h){const o=a.getAttribute(h)||"";if(r.setAttribute(e,o),d&&c){if(l&&n(r,l)||!l){const e=o.replace(d,c);o!==e&&a.setAttribute(h,e)}}else if(s){const e=n(r,s);e&&(o===e||/^\s*#/.test(o)||a.setAttribute(h,e))}else if(l&&n(r,l)||!l){const e=i(o,t);o!==e&&a.setAttribute(h,e)}}}const l=function(e,s){return'url("'+i(s,t)+'")'},c=/\burl\("([^"]+)"\)/g,h=o(a,"style");if(h){r.setAttribute("style",a.getAttribute(h)||"");const e=r.style.cssText;if(e){const t=e.replace(c,l);e!==t&&a.setAttribute(h,t)}}if(r instanceof HTMLStyleElement&&a.textContent.length&&r.sheet instanceof CSSStyleSheet){r.textContent=a.textContent;const e=[...r.sheet.cssRules].map((e=>e.cssText)).join("\n"),t=e.replace(c,l);e!==t&&(a.textContent=t)}d.removeChild(r)}return e.ownerDocument.adoptNode(h)}},76085:(e,t,s)=>{"use strict";s.d(t,{X7:()=>L,ho:()=>O,t5:()=>j});var n=s(51540),i=s(79113),a=s(78614),o=s(18806);class r{category=[];cloud=[];people=new p;feeditems=[];generator=null;haserrors=!1;htmlrights="";htmldescription="";htmltitle="";icon=null;id="";image=null;language="";lastbuilddate="";links=new c;plaintitle="";pubdate="";publishdate="";rating="";skipdays=new b;skiphours={};textinput=[];ttl="";updated="";updatedate="";updatefrequency="";updateperiod=""}class l{category=[];people=new p;htmlbody="";htmlcontent="";htmldescription="";htmlrights="";htmlsummary="";htmltitle="";id="";links=new c;plaintitle="";pubdate="";publishdate="";published="";source=null;updated="";updatedate="";xmloriginal="";bodyimages=[]}class d{description="";height="";link="";title="";url="";width=""}class c{alternate=[];comments=[];docs=[];enclosure=[];next=[];prev=[];related=[];self=[];serviceedit=[];servicepost=[];via=[]}class h{hreflang="";bytelength="";mimetype="";title="";url=""}class u{label="";scheme="";term=""}class p{author=[];contributor=[];managingeditor=[];webmaster=[]}class g{email="";name="";url=""}class m{name="";url="";version=""}class f{domain="";path="";port="";protocol="";registerprocedure=""}class v{htmldescription="";link="";name="";title=""}class b{sunday=!1;monday=!1;tuesday=!1;wednesday=!1;thursday=!1;friday=!1;saturday=!1}class C{htmltitle="";items=[];ownername="";owneremail="";ownerurl="";plaintitle="";publishdate="";updatedate=""}class w{category="";created="";feedurl="";htmldescription="";htmltitle="";items=[];language="";pageurl="";plaintitle="";supported=!0}const y="http://www.w3.org/1999/xhtml";function x(e){return(e||"").replace(/^\s+|\s+$/g,"")}function I(e){return(e||"").replace(/^\s*[\r\n]|\s+$/g,"")}function A(e){return document.createElementNS(y,"div").appendChild(document.createTextNode(e)).parentElement?.innerHTML??""}function S(e){const t=document.implementation.createHTMLDocument().createElementNS(y,"div");return t.innerHTML=e,x(t.textContent)}function Z(e,t,s){return/&(#\d+|#x[0-9a-e]+|[a-z][0-9a-z]*);|<[a-z][a-z0-9\-]*\b[^>]*>/i.test(e)?(0,o.A)(x(e),M("",t,s)):(0,n.Z)(A(I(e)))}function T(e){return e.toLowerCase()}function E(e,t){return x(e||t).toLowerCase()}function k(e){let t="";for(let s=0;s<e.childNodes.length;s++)e.childNodes[s].nodeType!==Node.TEXT_NODE&&e.childNodes[s].nodeType!==Node.CDATA_SECTION_NODE||(t+=e.childNodes[s].nodeValue);return t}function N(e,t,s){for(let n=t.length-1;n>=0;n--)if(t[n]){if(e.hasAttributeNS(t[n],s))return e.getAttributeNS(t[n],s);if(e.namespaceURI===t[n]&&(!n||e.hasAttributeNS("",s)))return e.getAttributeNS("",s);if(!n)return null}else{if(!n&&e.namespaceURI)return null;if(!n||!e.namespaceURI&&e.hasAttributeNS("",s))return e.getAttributeNS("",s)}}function _(e,t,s){for(let n=t.length-1;n>=0;n--)if(t[n]){if(e.hasAttributeNS(t[n],s))return!0;if(e.namespaceURI===t[n]&&(!n||e.hasAttributeNS("",s)))return!!n||e.hasAttributeNS("",s);if(!n)return!1}else{if(!n&&e.namespaceURI)return!1;if(!n||!e.namespaceURI&&e.hasAttributeNS("",s))return Boolean(n||e.getAttributeNS("",s))}return!1}function P(e){try{return new URL(e),!0}catch(e){return!1}}function M(e,t,s){let n=s;const i=/^[a-z0-9\-\+\.]+:/i;if(i.test(e))return e;const a=/^(https?|ftp|file):/i,o=[e];let r=!1;for(;!r&&t?.nodeType===Node.ELEMENT_NODE;){if(t?.hasAttribute("xml:base")){const e=x(t?.getAttribute("xml:base"));if(e.length){const t=e.match(i);r=a.test(e)&&P(e),t&&!r||(o[o.length]=e)}}t=t?.parentElement}if(!r&&"string"==typeof n){if(!a.test(n)||!P(n))return e;o[o.length]=n}n=o.pop();for(const t of o.toReversed())try{n=new URL(t,n).href}catch(t){return e}return n||(n=e),n}const D=new RegExp("^[\\p{Ps}\\p{Pi}\"'<]+|[\\p{Pe}\\p{Pf}\"'>]+$","ug");function O(e){return j((new DOMParser).parseFromString(e,"application/xml"),e,"")}function j(e,t,s){let c=e,p=e?.documentElement;const b="http://www.w3.org/2005/Atom",C="http://www.w3.org/1999/02/22-rdf-syntax-ns#",w="http://purl.org/rss/1.0/",P="http://channel.netscape.com/rdf/simple/0.9/",O="http://purl.org/dc/elements/1.1/";function j(e,t=!1){let s="";const n=new XMLSerializer;e=e.cloneNode(!0);const i=document.createTreeWalker(e,NodeFilter.SHOW_CDATA_SECTION);for(;i.nextNode();)i.currentNode.parentNode?.replaceChild(i.currentNode.ownerDocument.createTextNode(i.currentNode.nodeValue),i.currentNode);if(t)for(let t=0;t<e.childNodes.length;t++)s+=n.serializeToString(e.childNodes[t]);else s=n.serializeToString(e).replace(/^<[^>]+>|<[^>]+>$/g,"");return s}function L(e,t,s){if(1===t.length)return e.getElementsByTagNameNS(t[0],s);const n=e.getElementsByTagName("*"),i=[];for(let e=0;e<n.length;e++)n[e].localName===s&&-1!==t.indexOf(n[e].namespaceURI)&&(i[i.length]=n[e]);return i}function R(e,t){const i=E(N(e,se,"type"),"");if(e.children.length){if(e.children.length>1||e.children[0]!==(e.getElementsByTagNameNS(y,"div")[0]||e.getElementsByTagNameNS(e.namespaceURI??null,"div")[0])||function(e){for(let t=0;t<e.childNodes.length;t++)if(e.childNodes[t].nodeType===Node.TEXT_NODE&&e.childNodes[t].nodeValue.replace(/^\s+|\s+$/g,"")||e.childNodes[t].nodeType===Node.CDATA_SECTION_NODE)return!0;return!1}(e)){return j((0,o.n)(e,M("",e,s)))}return j((0,o.n)(e.children[0],M("",e.children[0],s)),e.children[0].namespaceURI===y)}if("html"===i||"text/html"===i||"xhtml"===i||/^application\/.*\+xml$/.test(i))return(0,o.A)(x(k(e)),M("",e,s));if(i&&"text"!==i&&!/^text\/plain$/.test(i)&&/^[\-\w]+\/[\-\w\+]+$/.test(i)){if(t){const s=new h;s.url="data:"+i+";base64,"+x(k(e)).replace(/\s+/g,""),s.mimetype=i,U(s,t)}return""}return(0,n.Z)(A(I(k(e))))}function B(e){if(e.children.length){return j((0,o.n)(e,M("",e,s)))}return Z(k(e),e,s)}function F(e){const t=new d;if(e.children.length){for(let n,i,a=0;a<e.children.length;a++)if(n=e.children[a],i=T(n.localName),-1!==se.indexOf(n.namespaceURI))switch(i){case"url":{const e=x(k(n));e&&(t.url=M(e,n,s))}break;case"link":case"feedlink":{const e=x(k(n));e&&(t.link=M(e,n,s))}break;case"title":case"feedtitle":t.title=x(k(n));break;case"description":t.description=x(k(n));break;case"width":t.width=x(k(n));break;case"height":t.height=x(k(n))}}else{const n=x(k(e));n&&(t.url=M(n,e,s))}return t}function W(e){const t=[];if(e.links.enclosure.forEach((e=>{e instanceof h&&e.url&&(e.mimetype&&e.mimetype.match(/^image\//i)||!e.mimetype&&e.url.match(/\.(jpg|jpeg|jfif|gif|png|webp|bmp|svg|avif)($|\?)/i))&&t.push(e.url)})),!e.htmlbody)return t;return[...(new DOMParser).parseFromString(e.htmlbody,"text/html").getElementsByTagName("img")].forEach((e=>{if(e.hasAttribute("src")){const s=e.getAttribute("width");if(s&&s.match(/^\s*\d/)&&e.width<20)return;const n=e.getAttribute("height");if(n&&n.match(/^\s*\d/)&&e.height<20)return;t.push(e.src)}})),t}function U(e,t){const s=t.find((t=>t.url===e.url&&t.title===e.title&&t.hreflang===e.hreflang));s?(!s.mimetype&&e.mimetype&&(s.mimetype=e.mimetype),!s.bytelength&&e.bytelength&&(s.bytelength=e.bytelength)):t[t.length]=e}function V(e,t){let n,i;if("enclosure"===e.localName||"comments"===e.localName||"docs"===e.localName?n=e.localName:"source"===e.localName||"feedsource"===e.localName?n="via":"relation"===e.localName?n="related":(n=E(N(e,se,"rel"),"alternate"),n=n.replace(/\W/g,"")),"source"!==e.localName&&"feedsource"!==e.localName&&e.childNodes.length?i=x(k(e)):_(e,se,"href")?i=x(N(e,se,"href")):_(e,se,"url")?i=x(N(e,se,"url")):e.namespaceURI===O&&(i=x(k(e))),i&&n&&t.links.hasOwnProperty(n)){const a=new h;switch(a.url=M(i,e,s),"source"===e.localName||"feedsource"===e.localName?a.title=x(k(e)):a.title=x(N(e,se,"title")),a.mimetype=x(N(e,se,"type")),a.hreflang=x(N(e,se,"hreflang")),a.bytelength=x(N(e,se,"length")),n){case"alternate":U(a,t.links.alternate);break;case"comments":U(a,t.links.comments);break;case"docs":U(a,t.links.docs);break;case"enclosure":U(a,t.links.enclosure);break;case"next":U(a,t.links.next);break;case"prev":U(a,t.links.prev);break;case"related":U(a,t.links.related);break;case"self":U(a,t.links.self);break;case"serviceedit":U(a,t.links.serviceedit);break;case"servicepost":U(a,t.links.servicepost);break;case"via":U(a,t.links.via)}}}function H(e){const t=new u,s=x(k(e));return s.length?(t.label=t.term=s,t.scheme=x(N(e,se,"domain"))):(t.term=x(N(e,se,"term")),t.label=x(N(e,se,"label")||t.term),t.scheme=x(N(e,se,"scheme"))),t}function G(e){const t=new m;t.name=x(k(e));const n=x(N(e,se,"uri"));return n&&(t.url=M(n,e,s)),t.version=x(N(e,se,"version")),t}function K(e){let t;if(e.children.length){t=new g;for(let n,i,a=0;a<e.children.length;a++)if(n=e.children[a],i=T(n.localName),-1!==se.indexOf(n.namespaceURI)){if("name"===i)t.name=x(k(n));else if("email"===i)t.email=x(k(n));else if("uri"===i){const e=x(k(n));e&&(t.url=M(e,n,s))}}else if("http://xmlns.com/foaf/0.1"===n.namespaceURI)if("name"===i)t.name=x(k(n));else if("homepage"===i){const e=x(n.getAttributeNS(C,"resource"));e&&(t.url=M(e,n,s))}else"mbox"===i&&(t.email=x(n.getAttributeNS(C,"resource")).replace(/^[a-z]+:/i,""))}else{const s=x(k(e));(0,a.HZ)(s)?(t=new g,t.email=s):t=z(null,s)}return t}function z(e,t=""){const s=new g,n=e?k(e):t;s.name=x(n.replace(/[\s<(]*(mailto\s*:\s*)?[^\s<>():,@]+@[^\s<>():,@]+[\s>)]*/i," ")).replace(D,"");const i=n.match(/[^\s<>():,@]+@[^\s<>():,@]+/);return i&&(s.email=i[0].replace(/^"([^\"]*)"$/,"$1")),s}function $(e){const t=new f;return t.domain=x(N(e,se,"domain")),t.port=x(N(e,se,"port")),t.path=x(N(e,se,"path")),t.registerprocedure=x(N(e,se,"registerProcedure"))||x(N(e,se,"registerprocedure")),t.protocol=x(N(e,se,"protocol")),t}function Y(e){const t=new v;for(let n,i,a=0;a<e.children.length;a++)if(n=e.children[a],i=T(n.localName),-1!==se.indexOf(n.namespaceURI))if("description"===i)t.htmldescription=B(n);else if("title"===i||"feedtitle"===i)t.title=x(k(n));else if("name"===i)t.name=x(k(n));else if("link"===i||"feedlink"===i){const e=x(k(n));e&&(t.link=M(e,n,s))}return t}function X(e,t){for(let s=0;s<e.children.length;s++){const n=e.children[s];if(-1!==se.indexOf(n.namespaceURI)&&"day"===T(n.localName)){const e=x(k(n)).toLowerCase();if(t.hasOwnProperty(e))switch(e){case"sunday":t.sunday=!0;break;case"monday":t.monday=!0;break;case"tuesday":t.tuesday=!0;break;case"wednesday":t.wednesday=!0;break;case"thursday":t.thursday=!0;break;case"friday":t.friday=!0;break;case"saturday":t.saturday=!0}}}}function Q(e,t){for(let s=0;s<e.children.length;s++){const n=e.children[s];if(-1!==se.indexOf(n.namespaceURI)&&"hour"===T(n.localName)){const e=x(k(n)).toLowerCase();/^\d+$/.test(e)&&1*Number(e).valueOf()<24&&1*Number(e).valueOf()>=0&&(t[e]=!0)}}}function q(e){const t=new XMLSerializer;let n=t.serializeToString(e);const i=/^([^>]+)\sxmlns="http:\/\/www.w3.org\/1999\/xhtml"/;if(ee&&(n=n.replace(/<(\/?)feed(source|link|image|title)\b/g,"<$1$2"),n=n.replace(i,"$1")),!ne.contains(e)){let e=t.serializeToString(ne.cloneNode(!1));ee&&(e=e.replace(i,"$1")),n=`${e}${n}`}for(;e&&e.parentElement&&e.parentNode!==c;){const a=(e=e.parentElement)?.cloneNode(!1),o=M("",e,s);a.setAttribute("xml:base",o),ee&&e!==ne&&e!==p&&e.hasAttribute("xmlns")&&a.removeAttribute("xmlns");let r=t.serializeToString(a);r=r.replace(/^<([\w\-:]+)\b([^>]*)\/>$/,"<$1$2></$1>"),ee&&(r=r.replace(i,"$1"));const[l,d]=r.split("></");n=l+">"+n+"</"+d}return n}function J(e){const t=new r;for(let s,n,i=0;i<e.children.length;i++)if(s=e.children[i],n=T(s.localName),-1!==se.indexOf(s.namespaceURI))"id"===n?t.id=x(k(s)):"image"===n||"feedimage"===n?s.children.length&&(t.image=F(s)):"logo"===n?t.image=F(s):"icon"===n?t.icon=F(s):"generator"===n?t.generator=G(s):"title"===n||"feedtitle"===n?("channel"===e.localName?t.htmltitle=B(s):t.htmltitle=R(s),t.plaintitle=S(t.htmltitle)):"rights"===n?t.htmlrights=R(s):"subtitle"===n?t.htmldescription=R(s):"copyright"===n?t.htmlrights=B(s):"description"===n?t.htmldescription=B(s):"updated"===n?t.updated=x(k(s)):"lastbuilddate"===n?t.lastbuilddate=x(k(s)):"pubdate"===n?t.pubdate=x(k(s)):"rating"===n?t.rating=x(k(s)):"language"===n?t.language=x(k(s)):"ttl"===n?t.ttl=x(k(s)):"category"===n?t.category[t.category.length]=H(s):"link"===n||"feedlink"===n||"docs"===n?V(s,t):"cloud"===n?t.cloud[t.cloud.length]=$(s):"author"===n?t.people.author[t.people.author.length]=K(s):"contributor"===n?t.people.contributor[t.people.contributor.length]=K(s):"managingeditor"===n?t.people.managingeditor[t.people.managingeditor.length]=K(s):"webmaster"===n?t.people.webmaster[t.people.webmaster.length]=K(s):"textinput"===n?s.children.length&&(t.textinput[t.textinput.length]=Y(s)):"skipdays"===n?X(s,t.skipdays):"skiphours"===n&&Q(s,t.skiphours);else if("http://purl.org/rss/1.0/modules/syndication/"===s.namespaceURI)if("updateperiod"===n){const e=x(k(s)).toLowerCase();t.updateperiod=e}else"updatefrequency"===n&&(t.updatefrequency=x(k(s)).toLowerCase());else s.namespaceURI===O&&("title"===n?(t.htmltitle=B(s),t.plaintitle=S(t.htmltitle)):"description"===n?t.htmldescription=B(s):"date"===n?t.pubdate=x(k(s)):"language"===n?t.language=x(k(s)):"rights"===n?t.htmlrights=B(s):"subject"===n?t.category[t.category.length]=H(s):"source"===n||"relation"===n?V(s,t):"publisher"===n?t.people.managingeditor[t.people.managingeditor.length]=z(s):"creator"===n?t.people.author[t.people.author.length]=z(s):"contributor"===n&&(t.people.contributor[t.people.contributor.length]=z(s)));if(!t.language){const s=T(e.localName);"source"===s||"feedsource"===s?e.hasAttribute("xml:lang")&&(t.language=x(e.getAttribute("xml:lang"))):p?.hasAttribute("xml:lang")&&(t.language=x(p?.getAttribute("xml:lang")))}if(t.publishdate=t.pubdate||t.updated||t.lastbuilddate,t.updatedate=t.lastbuilddate||t.updated||t.pubdate,"number"==typeof t.ttl||"string"==typeof t.ttl&&/^\d+$/.test(t.ttl))t.ttl=parseInt(t.ttl)||"";else if(t.updateperiod||t.updatefrequency){let e;e=/^\d+$/.test(t.updatefrequency)&&parseInt(t.updatefrequency)||1;const s={hourly:60,daily:1440,weekly:10080,monthly:306600,yearly:3679200};if(s.hasOwnProperty(t.updateperiod)){let n;switch(t.updateperiod){case"hourly":n=s.hourly;break;case"daily":n=s.daily;break;case"weekly":n=s.weekly;break;case"monthly":n=s.monthly;break;case"yearly":n=s.yearly;break;default:n=0}t.ttl=Math.round(n/e)}else t.ttl=Math.round(s.daily/e)}else t.ttl="";return t}let ee=!1,te="";if(!c||c.getElementsByTagNameNS(y,"parsererror").length){if(t&&/^\w*</.test(t)&&(t.match(/<[\w\-:]+[^>]*>/g)||[]).length>3&&(t.match(/<\/[\w\-:]+>/g)||[]).length>3){for(;/<(source|link|image|title)\b(([^\/>]|\/[^>])*>[^<]*((?!<\1\b([^\/>]|\/[^>])*>)<[^<]*)*?)<\/\1>/i.test(t);)t=t.replace(/<(source|link|image|title)\b(([^\/>]|\/[^>])*>[^<]*((?!<\1\b([^\/>]|\/[^>])*>)<[^<]*)*?)<\/\1>/gi,"<feed$1$2</feed$1>");const e=(t=t.replace(/<(\w+:link|\w+:category|category|\w+:cloud|cloud|\w+:enclosure|enclosure|\w+:thumbnail|thumbnail)\b([^>]*)\/>/gi,"<$1$2></$1>")).substring(0,1024).match(/\bxmlns:(\w+)\s*=\s*['"]http:\/\/purl\.org\/rss\/1.0\/modules\/content\/['"]/);e&&(te=e[1]+":encoded"),t="<!doctype html><html><head><title></title></head><body>"+(t=t.replace(/<!\[CDATA\[([\w\W]*?)\]\]>/gi,((e,t)=>A(t))))+"</body></html>",c=(new DOMParser).parseFromString(t,"text/html"),ee=!0}if(!c||c.getElementsByTagNameNS(y,"parsererror").length)return"NoDocumentNode";c.body instanceof HTMLBodyElement&&(c=c.body,p=c.children[0])}if(!p)return"NoDocumentElement";const se=void 0!==p?.namespaceURI?[p.namespaceURI]:[];let ne;if(se[0]||"feed"!==p.localName?se[0]===C&&(se[1]=w,se[2]=P):se[1]=b,ne="feed"===p.localName?p:L(p,se,"channel")[0],!ne)return"NoChannelElement";-1===se.indexOf(b)&&se.unshift(b),-1===se.indexOf(w)&&se.unshift(w),-1===se.indexOf(P)&&se.unshift(P);const ie=J(ne);if(ie.haserrors=ee,p!==ne&&p.children.length>1)for(let e,t,s=0;s<p.children.length;s++)e=p.children[s],t=T(e.localName),-1!==se.indexOf(e.namespaceURI)&&("image"===t||"feedimage"===t?ie.image=F(e):"textinput"===t&&(ie.textinput[ie.textinput.length]=Y(e)));let ae;ae="feed"===ne.localName?L(c,se,"entry"):L(c,se,"item");for(let e=0;e<ae.length;e++){let t=!1;ie.feeditems[e]=new l;for(let s=0;s<ae[e].children.length;s++){const a=ae[e].children[s],o=T(a.localName);if(-1!==se.indexOf(a.namespaceURI))if("link"===o||"feedlink"===o||"enclosure"===o||"comments"===o)V(a,ie.feeditems[e]);else if("title"===o||"feedtitle"===o)"item"===a.parentElement?.localName?ie.feeditems[e].htmltitle=B(a):ie.feeditems[e].htmltitle=R(a),ie.feeditems[e].plaintitle=S(ie.feeditems[e].htmltitle);else if("summary"===o)ie.feeditems[e].htmlsummary=R(a);else if("rights"===o)ie.feeditems[e].htmlrights=R(a);else if("content"===o)ie.feeditems[e].htmlcontent=R(a,ie.feeditems[e].links.enclosure);else if("description"===o)t?ie.feeditems[e].htmlsummary=B(a):ie.feeditems[e].htmldescription=B(a);else if("author"===o)ie.feeditems[e].people.author[ie.feeditems[e].people.author.length]=K(a);else if("contributor"===o)ie.feeditems[e].people.contributor[ie.feeditems[e].people.contributor.length]=K(a);else if("category"===o)ie.feeditems[e].category[ie.feeditems[e].category.length]=H(a);else if("id"===o||"published"===o||"created"===o||"issued"===o||"updated"===o||"modified"===o||"pubdate"===o)switch(o){case"id":ie.feeditems[e].id=x(k(a));break;case"published":case"created":case"issued":ie.feeditems[e].published=x(k(a));break;case"updated":case"modified":ie.feeditems[e].updated=x(k(a));break;case"pubdate":ie.feeditems[e].pubdate=x(k(a))}else"guid"===o?(ie.feeditems[e].id=x(k(a)),"false"!==E(N(a,se,"isPermaLink"),"")&&"false"!==E(N(a,se,"ispermalink"),"")&&V(a,ie.feeditems[e])):"source"===o||"feedsource"===o?"item"===a.parentElement?.localName?V(a,ie.feeditems[e]):ie.feeditems[e].source=J(a):o===te&&(t||ie.feeditems[e].htmlsummary||(ie.feeditems[e].htmlsummary=ie.feeditems[e].htmldescription),t=!0,ie.feeditems[e].htmldescription=k(a));else if(a.namespaceURI===O)"title"===o?(ie.feeditems[e].htmltitle=B(a),ie.feeditems[e].plaintitle=S(ie.feeditems[e].htmltitle)):"description"===o?ie.feeditems[e].htmldescription=B(a):"date"===o?ie.feeditems[e].pubdate=x(k(a)):"rights"===o?ie.feeditems[e].htmlrights=B(a):"subject"===o?ie.feeditems[e].category[ie.feeditems[e].category.length]=H(a):"identifier"===o?(ie.feeditems[e].id||(ie.feeditems[e].id=x(k(a))),V(a,ie.feeditems[e])):"source"===o||"relation"===o?V(a,ie.feeditems[e]):"publisher"===o||"creator"===o?ie.feeditems[e].people.author[ie.feeditems[e].people.author.length]=z(a):"contributor"===o&&(ie.feeditems[e].people.contributor[ie.feeditems[e].people.contributor.length]=z(a));else if("http://purl.org/rss/1.0/modules/content/"===a.namespaceURI)"encoded"===o&&(t||ie.feeditems[e].htmlsummary||(ie.feeditems[e].htmlsummary=ie.feeditems[e].htmldescription),t=!0,ie.feeditems[e].htmldescription=k(a));else if("http://search.yahoo.com/mrss/"===a.namespaceURI)switch(o){case"group":{const t=a.getElementsByTagName("media:description")[0]?.innerHTML;if(t){const s=(0,n.Z)(t);ie.feeditems[e].htmldescription+=`<div class="preformatted">${s}</div>`}const s=a.getElementsByTagName("media:thumbnail")[0];if(s){const t=new d;t.url=s.getAttribute("url")??"",t.width=s.getAttribute("width")??"",t.height=s.getAttribute("height")??"",ie.feeditems[e].links.enclosure.push(t)}break}}else if("http://www.youtube.com/xml/schemas/2015"===a.namespaceURI){if("videoid"===o)ie.feeditems[e].htmldescription+=(oe=a.innerHTML,`<div class="video-wrapper">${(0,i.w)(oe)}</div>`)}else if("http://www.itunes.com/dtds/podcast-1.0.dtd"===a.namespaceURI)switch(o){case"author":case"block":case"category":case"duration":case"email":case"explicit":case"keywords":case"name":case"new":case"owner":case"pubDate":case"subtitle":case"summary":case"episodetype":case"season":case"episode":case"title":break;case"image":{const t=new d;t.url=a.getAttribute("href")??"",ie.feeditems[e].links.enclosure.push(t);break}}}ie.feeditems[e].publishdate=ie.feeditems[e].published||ie.feeditems[e].pubdate||ie.feeditems[e].updated,ie.feeditems[e].updatedate=ie.feeditems[e].updated||ie.feeditems[e].pubdate||ie.feeditems[e].published,ie.feeditems[e].htmlbody=ie.feeditems[e].htmlcontent||ie.feeditems[e].htmldescription||ie.feeditems[e].htmlsummary,ie.feeditems[e].bodyimages=W(ie.feeditems[e]),s&&(ie.feeditems[e].xmloriginal=q(ae[e]))}var oe;return ie}function L(e,t){function s(e,i){for(let a=0;a<e.children.length;a++){const o=e.children[a],r=T(o.localName);if(-1!==n.indexOf(o.namespaceURI)&&"outline"===r&&"true"!==E(N(o,n,"isComment"),"")){const e=new w;if(-1!==["rss","atom"].indexOf(E(N(o,n,"type"),""))&&(e.feedurl=x(N(o,n,"xmlUrl")),e.feedurl)){e.feedurl=M(e.feedurl,o,t),e.created=x(N(o,n,"created")),e.htmldescription=Z(N(o,n,"description")||"",o,t),e.language=x(N(o,n,"language")),e.pageurl=x(N(o,n,"htmlUrl"))||x(N(o,n,"url")),e.pageurl&&(e.pageurl=M(e.pageurl,o,t));const s=E(N(o,n,"version"),"");e.supported=!s||/^(rss\d*|atom\s*[\d\.]*)$/i.test(s)}if(_(o,n,"category")?e.category=x(N(o,n,"category")):e.category=i?.category??"",o.children.length&&s(o,e),e.feedurl||e.items.length){i.items[i.items.length]=e;const s=x(N(o,n,"text")),a=x(N(o,n,"title"));s&&a&&s!==a?(e.htmltitle=Z(s.length<=a.length?s:a,o,t),e.htmldescription||(e.htmldescription=Z(s.length<=a.length?a:s,o,t))):e.htmltitle=Z(s||a,o,t)||A(e.feedurl),e.plaintitle=S(e.htmltitle)}}}}const n=[null,"","http://opml.org/spec2"];if("string"!=typeof t)return"FeedURLNotString";if(!e||e.getElementsByTagNameNS(y,"parsererror").length)return"NoDocumentNode";if(!e.documentElement)return"NoDocumentElement";const{children:i}=e.documentElement,a=e.documentElement.namespaceURI;if("opml"!==e.documentElement.localName&&"outlineDocument"!==e.documentElement.localName||-1===n.indexOf(a))return"WrongDocumentElement";const o=new C;for(let e,r,l=0;l<i.length;l++)if(e=i[l],-1!==n.indexOf(a))if(r=T(e.localName),"head"===r){for(let s,i,a=0;a<e.children.length;a++)if(s=e.children[a],-1!==n.indexOf(s.namespaceURI))if(i=T(s.localName),"title"===i)o.htmltitle=Z(k(s),s,t),o.plaintitle=S(o.htmltitle);else if("ownername"===i)o.ownername=x(k(s));else if("owneremail"===i)o.owneremail=x(k(s));else if("datecreated"===i)o.publishdate=x(k(s));else if("datemodified"===i)o.updatedate=x(k(s));else if("ownerid"===i){const e=x(k(s));e&&(o.ownerurl=M(e,s,t))}}else"body"===r&&s(e,o);return o}},14022:(e,t,s)=>{"use strict";s.d(t,{Z:()=>m});var n=s(19789),i=s(29087),a=s(18237),o=s(56371),r=s(30381),l=s.n(r),d=s(1407),c=s(89175);const h=n.ZP.getWeekdayFormat("LL")+" LT",u={lastWeek:h,sameElse:h},p=/^\d{4}(?:-\d{2}){2}(?:_\d{2}){3}$/;function g(e){return e===a.m8||e===a.iq}const m={getLoadingWorkspaceName:function(e){const t=a.ZP.getWorkspace(e);return t?(0,o.Z)("$1 (session)",[t.name]):(0,o.Z)("Session workspace")},getTooltipString:function(e){if(a.ZP.isTrashFolder(e.id))return(0,o.Z)("Trash");let t=e.name;return e.workspaces.length>0&&(t+="\n"+(0,o.Z)("with Workspaces:")),e.workspaces.forEach((e=>{t+=d.YV+e.name})),t},getNameString:function(e){if(a.ZP.isTrashFolder(e.id))return(0,o.Z)("Trash");if(p.test(e.name)){const t=e.name.substring(0,10)+" "+e.name.substring(11,19).split("_").join(":");return l()(t).format("LLL")}return e.name},getContentString:function(e){if(a.ZP.isTrashFolder(e.id))return"";if(e.tabs-e.quarantined>0){const t=0===e.quarantined?(0,o.Z)("$1 tab","$1 tabs",[e.tabs-e.quarantined]):(0,o.Z)("$1 tab (of $2)","$1 tabs (of $2)",[e.tabs-e.quarantined,e.tabs]),s=(0,o.Z)("$1 window","$1 windows",[e.windows]);if(0===e.workspaces.length)return(0,o.Z)("$1 in $2",[t,s]);{const n=(0,o.Z)("$1 workspace","$1 workspaces",[e.workspaces.length]);return(0,o.Z)("$1, $2 in $3",[t,n,s])}}return(0,o.Z)("All tabs are quarantined")},getDateCreateString:function(e){return a.ZP.isTrashFolder(e.id)?"":i.Z.get(c.kCalendarRelativeDates)?l()(e.createDateJS).calendar(null,u):l()(e.createDateJS).format(h)},getDateModifyString:function(e){return a.ZP.isTrashFolder(e.id)?"":i.Z.get(c.kCalendarRelativeDates)?l()(e.modifyDateJS).calendar(null,u):l()(e.modifyDateJS).format(h)},getSessionData:function(e){for(const t of e.dataTransfer.types)if(g(t))return JSON.parse(e.dataTransfer.getData(t));return[]},isSessionType:g}},66777:(e,t,s)=>{"use strict";s.d(t,{C:()=>r,j:()=>l});s(67294);var n=s(60203),i=s(94184),a=s.n(i),o=s(48521);function r({children:e,text:t,className:s,label:n,leadingText:i,highlight:r}){const l=r?t.split(r.regExp).reduce(((e,t,s)=>s?e.concat([(0,o.jsx)("mark",{children:r.matches[s-1]},s)]).concat([t]):e.concat([t])),[]):t;return(0,o.jsx)("div",{className:a()("setting-single",s,{"setting-single--LeadingText":i}),children:(0,o.jsxs)("label",{title:n,children:[e,(0,o.jsx)("span",{children:l})]})})}function l({children:e,heading:t,className:s,filter:i}){return(0,o.jsx)(n.Z,{filter:i,children:(0,o.jsxs)("div",{className:a()("setting-group",s),children:[t&&(0,o.jsx)("h3",{children:t}),e]})})}},72046:(e,t,s)=>{"use strict";s.d(t,{Z:()=>g});var n=s(67294),i=s(90718),a=s(59322),o=s(94283),r=s(56371),l=s(67074),d=s(95617),c=s(48521);const h="https://vivaldi.com/privacy/";function u(e){return Boolean(e&&"object"==typeof e&&"string"!=typeof e.type)}class p extends n.Component{static contextType=o.Z;static defaultProps={displayPrivacyLink:!1};constructor(e){super(e),this.state={children:this.searchChildren(this.props)}}hiddenWhenFilter="";componentDidMount(){this.hideCategoryIfEmpty()}componentDidUpdate(e){this.props.filter!==e.filter?this.hiddenWhenFilter?this.shouldSearchHiddenComponent(this.hiddenWhenFilter,this.props.filter)&&this.setState({children:this.searchChildren(this.props)}):this.setState({children:this.searchChildren(this.props)}):this.props.children!==e.children&&this.setState({children:this.searchChildren(this.props)}),this.hideCategoryIfEmpty()}unfilteredChildren=e=>n.Children.map(e.children,(e=>u(e)?n.cloneElement(e,{filter:""}):e));filteredChildren=e=>n.Children.map(e.children,(t=>!t||u(t)?t:(0,l.ZP)(t,e.filter)));searchChildren=e=>{if(!e.filter)return n.Children.map(e.children,(e=>e));if(!e.excludeFromSearch){return(0,l.zR)(e.categoryTitle,e.filter)?this.unfilteredChildren(e):this.filteredChildren(e)}};shouldSearchHiddenComponent=(e,t)=>!t||e.length>=t.length||e!==t.slice(0,e.length);hideCategoryIfEmpty=()=>{this.root&&(1===this.root.children.length||!0===this.props.displayPrivacyLink&&2===this.root.children.length?(this.root.style.display="none",this.hiddenWhenFilter=this.props.filter):(this.root.style.removeProperty("display"),this.hiddenWhenFilter=""))};openPrivacyPage=()=>{a.ZP.openURL(this.context.vivaldiWindowId,h)};render(){const e=this.props.categoryTitle&&(0,c.jsx)("h2",{children:this.props.categoryTitle}),t=(0,l.ZP)(e,this.props.filter)||e,s=(0,d.Z)(this.props,["filter","categoryTitle","displayPrivacyLink","excludeFromSearch"]);return(0,c.jsxs)("div",{ref:e=>e?this.root=e:null,...s,children:[t,e&&!0===this.props.displayPrivacyLink&&(0,c.jsx)("div",{className:"privacy-link",children:(0,c.jsx)(i.Z,{title:h,onClick:this.openPrivacyPage,children:(0,r.Z)("Learn more about Privacy in Vivaldi")})}),this.state.children]})}}const g=p},60203:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});var n=s(67294),i=s(67074),a=s(48521);class o extends n.PureComponent{render(){const{children:e,filter:t}=this.props;return t?Array.isArray(e)?e.map(((e,s)=>(0,a.jsx)(n.Fragment,{children:(0,i.ZP)(e,t)},s))):(0,i.ZP)(e,t):e}}const r=o},37182:(e,t,s)=>{"use strict";s.d(t,{TP:()=>j,ZP:()=>X,FI:()=>D});var n=s(67294),i=s(56371),a=s(94184),o=s.n(a),r=s(95617),l=s(48521);const d={auto:(0,i.Z)("theme","Auto"),light:(0,i.Z)("theme","Light"),dark:(0,i.Z)("theme","Dark")};var c=(0,l.jsxs)("svg",{width:"97",height:"76",viewBox:"0 0 97 76",xmlns:"http://www.w3.org/2000/svg",className:"tab-preview",children:[(0,l.jsx)("rect",{width:"48",height:"76",className:"website-appearance-preview background-color"}),(0,l.jsx)("rect",{x:"48",width:"49",height:"76",className:"website-appearance-preview foreground-color"}),(0,l.jsx)("path",{d:"M48 9H77C77.5523 9 78 9.44772 78 10V16C78 16.5523 77.5523 17 77 17H48V9Z",className:"website-appearance-preview background-color"}),(0,l.jsx)("path",{d:"M8 10C8 9.44772 8.44772 9 9 9H48V17H9C8.44771 17 8 16.5523 8 16V10Z",className:"website-appearance-preview foreground-color"}),(0,l.jsxs)("g",{opacity:"0.3",children:[(0,l.jsx)("path",{d:"M48 25H9C8.44772 25 8 25.4477 8 26V27C8 27.5523 8.44771 28 9 28H48V25Z",className:"website-appearance-preview foreground-color"}),(0,l.jsx)("path",{d:"M48 31H9C8.44772 31 8 31.4477 8 32V33C8 33.5523 8.44771 34 9 34H48V31Z",className:"website-appearance-preview foreground-color"}),(0,l.jsx)("path",{d:"M48 37H9C8.44772 37 8 37.4477 8 38V39C8 39.5523 8.44771 40 9 40H48V37Z",className:"website-appearance-preview foreground-color"}),(0,l.jsx)("path",{d:"M48 43H9C8.44772 43 8 43.4477 8 44V45C8 45.5523 8.44771 46 9 46H48V43Z",className:"website-appearance-preview foreground-color"}),(0,l.jsx)("path",{d:"M48 55H9C8.44772 55 8 55.4477 8 56V57C8 57.5523 8.44771 58 9 58H48V55Z",className:"website-appearance-preview foreground-color"}),(0,l.jsx)("path",{d:"M8 62C8 61.4477 8.44772 61 9 61H29C29.5523 61 30 61.4477 30 62V63C30 63.5523 29.5523 64 29 64H9C8.44772 64 8 63.5523 8 63V62Z",className:"website-appearance-preview foreground-color"})]}),(0,l.jsxs)("g",{opacity:"0.3",children:[(0,l.jsx)("path",{d:"M48 58H74C74.5523 58 75 57.5523 75 57V56C75 55.4477 74.5523 55 74 55H48V58Z",className:"website-appearance-preview background-color"}),(0,l.jsx)("path",{d:"M48 46H60C60.5523 46 61 45.5523 61 45V44C61 43.4477 60.5523 43 60 43H48V46Z",className:"website-appearance-preview background-color"}),(0,l.jsx)("path",{d:"M48 40H60C60.5523 40 61 39.5523 61 39V38C61 37.4477 60.5523 37 60 37H48V40Z",className:"website-appearance-preview background-color"}),(0,l.jsx)("path",{d:"M48 34H60C60.5523 34 61 33.5523 61 33V32C61 31.4477 60.5523 31 60 31H48V34Z",className:"website-appearance-preview background-color"}),(0,l.jsx)("path",{d:"M48 28H74C74.5523 28 75 27.5523 75 27V26C75 25.4477 74.5523 25 74 25H48V28Z",className:"website-appearance-preview background-color"})]})]}),h=(0,l.jsxs)("svg",{width:"97",height:"76",viewBox:"0 0 97 76",xmlns:"http://www.w3.org/2000/svg",className:"tab-preview",children:[(0,l.jsx)("rect",{width:"97",height:"76",className:"website-appearance-preview foreground-color"}),(0,l.jsxs)("g",{opacity:"0.3",children:[(0,l.jsx)("path",{d:"M9 25C8.44772 25 8 25.4477 8 26V27C8 27.5523 8.44771 28 9 28H74C74.5523 28 75 27.5523 75 27V26C75 25.4477 74.5523 25 74 25H9Z",className:"website-appearance-preview background-color"}),(0,l.jsx)("path",{d:"M9 55C8.44772 55 8 55.4477 8 56V57C8 57.5523 8.44771 58 9 58H74C74.5523 58 75 57.5523 75 57V56C75 55.4477 74.5523 55 74 55H9Z",className:"website-appearance-preview background-color"}),(0,l.jsx)("path",{d:"M8 32C8 31.4477 8.44772 31 9 31H60C60.5523 31 61 31.4477 61 32V33C61 33.5523 60.5523 34 60 34H9C8.44771 34 8 33.5523 8 33V32Z",className:"website-appearance-preview background-color"}),(0,l.jsx)("path",{d:"M9 61C8.44772 61 8 61.4477 8 62V63C8 63.5523 8.44772 64 9 64H41C41.5523 64 42 63.5523 42 63V62C42 61.4477 41.5523 61 41 61H9Z",className:"website-appearance-preview background-color"}),(0,l.jsx)("path",{d:"M8 44C8 43.4477 8.44772 43 9 43H60C60.5523 43 61 43.4477 61 44V45C61 45.5523 60.5523 46 60 46H9C8.44771 46 8 45.5523 8 45V44Z",className:"website-appearance-preview background-color"}),(0,l.jsx)("path",{d:"M9 37C8.44772 37 8 37.4477 8 38V39C8 39.5523 8.44771 40 9 40H60C60.5523 40 61 39.5523 61 39V38C61 37.4477 60.5523 37 60 37H9Z",className:"website-appearance-preview background-color"})]}),(0,l.jsx)("rect",{x:"8",y:"9",width:"70",height:"8",rx:"1",className:"website-appearance-preview background-color"})]}),u=(0,l.jsxs)("svg",{width:"97",height:"76",viewBox:"0 0 97 76",xmlns:"http://www.w3.org/2000/svg",className:"tab-preview",children:[(0,l.jsx)("rect",{width:"97",height:"76",className:"website-appearance-preview background-color"}),(0,l.jsxs)("g",{opacity:"0.3",children:[(0,l.jsx)("path",{d:"M9 25C8.44772 25 8 25.4477 8 26V27C8 27.5523 8.44771 28 9 28H74C74.5523 28 75 27.5523 75 27V26C75 25.4477 74.5523 25 74 25H9Z",className:"website-appearance-preview foreground-color"}),(0,l.jsx)("path",{d:"M9 55C8.44772 55 8 55.4477 8 56V57C8 57.5523 8.44771 58 9 58H74C74.5523 58 75 57.5523 75 57V56C75 55.4477 74.5523 55 74 55H9Z",className:"website-appearance-preview foreground-color"}),(0,l.jsx)("path",{d:"M8 32C8 31.4477 8.44772 31 9 31H60C60.5523 31 61 31.4477 61 32V33C61 33.5523 60.5523 34 60 34H9C8.44771 34 8 33.5523 8 33V32Z",className:"website-appearance-preview foreground-color"}),(0,l.jsx)("path",{d:"M9 61C8.44772 61 8 61.4477 8 62V63C8 63.5523 8.44772 64 9 64H41C41.5523 64 42 63.5523 42 63V62C42 61.4477 41.5523 61 41 61H9Z",className:"website-appearance-preview foreground-color"}),(0,l.jsx)("path",{d:"M8 44C8 43.4477 8.44772 43 9 43H60C60.5523 43 61 43.4477 61 44V45C61 45.5523 60.5523 46 60 46H9C8.44771 46 8 45.5523 8 45V44Z",className:"website-appearance-preview foreground-color"}),(0,l.jsx)("path",{d:"M9 37C8.44772 37 8 37.4477 8 38V39C8 39.5523 8.44771 40 9 40H60C60.5523 40 61 39.5523 61 39V38C61 37.4477 60.5523 37 60 37H9Z",className:"website-appearance-preview foreground-color"})]}),(0,l.jsx)("rect",{x:"8",y:"9",width:"70",height:"8",rx:"1",className:"website-appearance-preview foreground-color"})]}),p=(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"selectbox-checkmark",viewBox:"0 0 15 16",children:(0,l.jsx)("path",{d:"M5.3 13.3L1.5 9.5 3 8l2.3 2.5L13 2.7 14.6 4l-8 8z"})});class g extends n.Component{render(){if(!this.props.preference)return null;const e=this.props.preference,t=d[this.props.preference],s=o()({selectbox:!0,"selectbox-selected":this.props.selected}),n=(0,r.Z)(this.props,["preference","vivaldiSettings"]);return(0,l.jsxs)("button",{className:s,title:t,...n,children:[(0,l.jsxs)("div",{className:"selectbox-image",children:["auto"===e&&c,"light"===e&&h,"dark"===e&&u,p]}),(0,l.jsx)("div",{className:"selectbox-title",children:t})]})}}const m=g;var f=s(64473),v=s(68247),b=s(4949),C=s(72046),w=s(60331),y=s(22303),x=s(37646),I=s(47825),A=s(71828),S=s(34155);class Z extends n.PureComponent{state={zoom:I.Z.getUIZoom()};componentDidMount(){I.Z.addListener(this._onZoomStoreChanged)}componentWillUnmount(){I.Z.removeListener(this._onZoomStoreChanged)}_onZoomStoreChanged=()=>{this.setState({zoom:I.Z.getUIZoom()})};setZoomLevel=(e,t)=>{t?this.setState({zoom:e}):y.Z.setUIZoom(e),S.nextTick((()=>{this.props.onUIZoomUpdate()}))};render(){const{zoom:e}=this.state;return(0,l.jsx)(x.Z,{inFooter:!1,zoom:e,defaultZoomLevel:A.an,scrolling:!1,maxLevel:A.OK,minLevel:A.bI,step:A.Wp,delay:!0,onZoomUpdated:this.setZoomLevel},"zoomslider")}}const T=Z;var E=s(16716),k=s(94283),N=s(14507),_=s(7064),P=s(89175);const M={width:400,minWidth:"unset"},D=[P.kAppearanceCssUiModsDirectory,P.kAppearanceDensity,P.kAppearanceDisableTitleBar,P.kAppearanceForceDarkModeTheme,P.kAppearanceRangeButtons,P.kMenuCompact,P.kPopupsShowInTab,P.kTabsBarPosition,P.kSettingsInTab,P.kSettingsMonoIcons,P.kStatusBarDisplay,P.kStatusBarMinimized,P.kThemeDimBlurred,P.kThemeSimpleScrollbar,P.kThemeUseAnimation,P.kVivaldiPreferredColorScheme,P.kWindowsLinuxAltControls,P.kWindowsUseNativeDecoration],O=v.Z.getEventHandler,j={auto:0,light:1,dark:2};function L(){v.Z.set(P.kVivaldiPreferredColorScheme,j.auto)}function R(){v.Z.set(P.kVivaldiPreferredColorScheme,j.light)}function B(){v.Z.set(P.kVivaldiPreferredColorScheme,j.dark)}var F=(0,l.jsx)("br",{}),W=(0,l.jsx)("input",{type:"radio",value:"on"}),U=(0,l.jsx)("input",{type:"radio",value:"overlay"}),V=(0,l.jsx)("input",{type:"radio",value:"off"}),H=(0,l.jsx)("input",{type:"radio",value:"true"}),G=(0,l.jsx)("input",{type:"radio",value:"false"}),K=(0,l.jsx)("br",{}),z=(0,l.jsx)("br",{}),$=(0,l.jsx)("br",{});function Y(e){const t=n.useContext(k.Z),s=(0,N.Z)(D),a=n.createRef(),[o,r]=n.useState(s[P.kAppearanceCssUiModsDirectory]),[d,c]=n.useState(!1),h=e=>{const{value:s}=e.target;v.Z.set(P.kStatusBarDisplay,s),"on"!==s&&(v.Z.set(P.kStatusBarMinimized,s),"overlay"===s&&w.Z.setStatus(t.vivaldiWindowId,(0,i.Z)("Status Info set to Overlay"),2e3))},u=()=>{c(!0)},p=()=>{c(!1)},g=()=>{c(!1),v.Z.reset(P.kToolbarsNavigation),v.Z.reset(P.kToolbarsPanel),v.Z.reset(P.kToolbarsStatus),v.Z.reset(P.kToolbarsMail),v.Z.reset(P.kToolbarsMailComposer),v.Z.reset(P.kToolbarsMailMessage)};var y=(0,l.jsx)("div",{className:"toolbar toolbar-default",children:(0,l.jsx)(T,{onUIZoomUpdate:()=>{const e=a.current,{Element:s}=t;e instanceof s&&e.scrollIntoViewIfNeeded()}})});const x=()=>{_.Z.utilities.selectFile({windowId:t.vivaldiWindowId,title:(0,i.Z)("Select Folder for CSS UI Mods"),type:"folder"}).then((e=>{e&&(r(e),v.Z.set(P.kAppearanceCssUiModsDirectory,e))}))},I=e=>{r(e.target.value),v.Z.set(P.kAppearanceCssUiModsDirectory,e.target.value)};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(C.Z,{categoryTitle:(0,i.Z)("Website Appearance"),filter:e.filter,children:function(){const e=s[P.kVivaldiPreferredColorScheme];return(0,l.jsxs)("div",{className:"setting-group unlimited",children:[(0,l.jsx)("p",{className:"info",children:(0,i.Z)("Some websites customize their color scheme according to user preferences. Choose which color scheme you would like these sites to use.")}),(0,l.jsx)("div",{className:"setting-single pad-top",children:(0,l.jsxs)("div",{className:"selectbox-container",children:[(0,l.jsx)(m,{preference:"light",selected:e===j.light,onClick:R}),(0,l.jsx)(m,{preference:"dark",selected:e===j.dark,onClick:B}),(0,l.jsx)(m,{preference:"auto",selected:e===j.auto,onClick:L})]})}),(0,l.jsxs)("div",{className:"setting-single pad-top",children:[(0,l.jsxs)("label",{children:[(0,l.jsx)("input",{type:"checkbox",checked:s[P.kAppearanceForceDarkModeTheme],onChange:O(P.kAppearanceForceDarkModeTheme),disabled:e===j.light}),(0,l.jsx)("span",{children:(0,i.Z)("Force a dark theme on all websites")})]}),(0,l.jsxs)("p",{className:"info",disabled:e===j.light,children:[(0,i.Z)("Enabling this setting may break some websites and/or images."),F,(0,i.Z)("This setting requires a restart to take full effect.")]})]})]})}()}),(0,l.jsxs)(C.Z,{categoryTitle:(0,i.Z)("Window Appearance"),filter:e.filter,children:[function(){const e=t.window.matchMedia("(prefers-reduced-motion: reduce)").matches;return(0,l.jsxs)("div",{className:"setting-group",children:[(0,l.jsx)("div",{className:"setting-single",children:(0,l.jsxs)("label",{children:[(0,l.jsx)("input",{type:"checkbox",checked:s[P.kSettingsInTab],onChange:O(P.kSettingsInTab)}),(0,l.jsx)("span",{children:(0,i.Z)("Open Settings in a Tab")})]})}),(0,l.jsx)("div",{className:"setting-single",children:(0,l.jsxs)("label",{children:[(0,l.jsx)("input",{type:"checkbox",checked:s[P.kPopupsShowInTab],onChange:O(P.kPopupsShowInTab)}),(0,l.jsx)("span",{children:(0,i.Z)("Open Popups in Tabs")})]})}),(0,l.jsxs)("div",{className:"setting-single pad-top",children:[(0,l.jsxs)("label",{children:[(0,l.jsx)("input",{type:"checkbox",checked:s[P.kThemeUseAnimation]&&!e,onChange:O(P.kThemeUseAnimation),disabled:e}),(0,l.jsx)("span",{children:(0,i.Z)("Use Animation")})]}),e&&(0,l.jsx)("p",{className:"info",children:(0,i.Z)("Animations are disabled due to OS “Reduce Motion” accessibility setting.")})]}),(0,l.jsx)("div",{className:"setting-single",children:(0,l.jsxs)("label",{children:[(0,l.jsx)("input",{type:"checkbox",checked:s[P.kAppearanceRangeButtons],onChange:O(P.kAppearanceRangeButtons)}),(0,l.jsx)("span",{children:(0,i.Z)("Use Buttons in Range Controls")})]})})]})}(),(0,l.jsxs)("div",{className:"setting-group",children:[(0,l.jsxs)("div",{className:"setting-single",children:[(0,l.jsxs)("label",{children:[(0,l.jsx)("input",{type:"checkbox",checked:s[P.kWindowsUseNativeDecoration],onChange:O(P.kWindowsUseNativeDecoration)}),(0,l.jsx)("span",{children:(0,i.Z)("Use Native Window")})]}),(0,l.jsx)("p",{className:"info",children:(0,i.Z)("This setting requires a restart to take full effect.")})]}),(0,l.jsxs)("div",{className:"setting-single",children:[(0,l.jsxs)("label",{children:[(0,l.jsx)("input",{type:"checkbox",checked:!s[P.kAppearanceDisableTitleBar],onChange:O(P.kAppearanceDisableTitleBar,"inverse")}),(0,l.jsx)("span",{children:(0,i.Z)("Show Title Bar")})]}),(0,l.jsx)("p",{className:"info",children:(0,i.Z)("This setting has no effect with Tab Bar visible on top.")})]}),(0,l.jsx)("div",{className:"setting-single",children:(0,l.jsxs)("label",{children:[(0,l.jsx)("input",{type:"checkbox",checked:s[P.kThemeDimBlurred],onChange:O(P.kThemeDimBlurred)}),(0,l.jsx)("span",{children:(0,i.Z)("Fade Colors in Background Windows")})]})}),(0,l.jsx)("div",{className:"setting-single",children:(0,l.jsxs)("label",{children:[(0,l.jsx)("input",{type:"checkbox",checked:s[P.kThemeSimpleScrollbar],onChange:O(P.kThemeSimpleScrollbar)}),(0,l.jsx)("span",{children:(0,i.Z)("Use Simple Scrollbars")})]})}),(0,l.jsx)("div",{className:"setting-single",children:(0,l.jsxs)("label",{children:[(0,l.jsx)("input",{type:"checkbox",checked:s[P.kSettingsMonoIcons],onChange:O(P.kSettingsMonoIcons)}),(0,l.jsx)("span",{children:(0,i.Z)("Use Monochrome Settings Icons")})]})})]}),!1,(0,l.jsxs)("div",{className:"setting-group",children:[(0,l.jsxs)("div",{className:"setting-single",children:[(0,l.jsx)("h3",{children:(0,i.Z)("User Interface Density")}),(0,l.jsxs)(b.Z,{name:"ui_density",value:s[P.kAppearanceDensity],onChange:O(P.kAppearanceDensity,"convert"),children:[(0,l.jsx)("div",{className:"setting-single",children:(0,l.jsxs)("label",{children:[H,(0,l.jsx)("span",{children:(0,i.Z)("ui_density","Regular")})]})}),(0,l.jsx)("div",{className:"setting-single",children:(0,l.jsxs)("label",{children:[G,(0,l.jsx)("span",{children:(0,i.Z)("ui_density","Compact")})]})})]})]}),(0,l.jsxs)("div",{className:"setting-single pad-top",children:[(0,l.jsxs)("label",{children:[(0,l.jsx)("input",{type:"checkbox",checked:s[P.kMenuCompact],onChange:O(P.kMenuCompact)}),(0,l.jsx)("span",{children:(0,i.Z)("Compact Menu Layout")})]}),(0,l.jsx)("p",{className:"info",children:(0,i.Z)("This setting requires a restart to take full effect.")})]})]}),(0,l.jsx)("div",{className:"setting-group",ref:a,children:(0,l.jsxs)("div",{className:"setting-single",children:[(0,l.jsx)("h3",{children:(0,i.Z)("User Interface Zoom")}),y]})}),(0,l.jsxs)("div",{className:"setting-group",children:[(0,l.jsx)("h3",{children:(0,i.Z)("title","Status Bar")}),(0,l.jsx)("div",{className:"setting-single",children:(0,l.jsxs)(b.Z,{name:"StatusBar",className:"group",value:s[P.kStatusBarDisplay],onChange:h,children:[(0,l.jsx)("div",{className:"setting-single",children:(0,l.jsxs)("label",{children:[W,(0,l.jsx)("span",{children:(0,i.Z)("verb","Show Status Bar")})]})}),(0,l.jsx)("div",{className:"setting-single",children:(0,l.jsxs)("label",{children:[U,(0,l.jsx)("span",{children:(0,i.Z)("Status Info Overlay")})]})}),(0,l.jsx)("div",{className:"setting-single",children:(0,l.jsxs)("label",{children:[V,(0,l.jsx)("span",{children:(0,i.Z)("verb","Hide Status Bar")})]})})]})})]}),(0,l.jsxs)("div",{className:"setting-group",children:[d&&(0,l.jsx)(f.Z,{style:M,onRequestClose:p,title:(0,i.Z)("Reset All Toolbars?"),children:(0,l.jsxs)("div",{className:"dialog-restore-shortcuts",children:[(0,l.jsx)("div",{className:"dialog-content",children:(0,l.jsx)("p",{children:(0,i.Z)("All toolbars will be restored to their default layout.")})}),(0,l.jsxs)("footer",{className:"dialog-footer",children:[(0,l.jsx)("input",{type:"button",className:"danger",onClick:g,value:(0,i.Z)("Reset")}),(0,l.jsx)("input",{type:"button",onClick:p,value:(0,i.Z)("Cancel"),autoFocus:!0})]})]})}),(0,l.jsxs)("div",{className:"setting-single",children:[(0,l.jsx)("h3",{children:(0,i.Z)("Toolbar Customization")}),(0,l.jsx)("p",{className:"info",children:(0,i.Z)("Individual toolbars may be reset or edited using the context menu.")}),(0,l.jsx)("input",{type:"button",onClick:u,value:(0,i.Z)("Reset All Toolbars")})]})]})]}),(0,l.jsx)(C.Z,{categoryTitle:(0,i.Z)("Custom UI Modifications"),filter:e.filter,className:"setting-group unlimited",children:E.Z.isEnabled("css_mods")?(0,l.jsx)("div",{className:"setting-subgroup",children:(0,l.jsxs)("div",{className:"setting-single",children:[(0,l.jsxs)("div",{className:"setting-single folder-selection",children:[(0,l.jsx)("input",{type:"text",value:o,title:(0,i.Z)("Enter Custom UI Modifications Path"),onChange:I}),(0,l.jsx)("input",{type:"button",value:(0,i.Z)("Select Folder..."),onClick:x})]}),(0,l.jsxs)("p",{className:"info",children:[(0,i.Z)("Directory for custom CSS UI modification files."),K,(0,i.Z)("They must have a .css extension to be included."),z,(0,i.Z)("No guarantees are made that these will work in new versions of Vivaldi."),$,(0,i.Z)("This requires a restart to apply.")]})]})}):null})]})}const X=n.memo(Y)},67074:(e,t,s)=>{"use strict";s.d(t,{CH:()=>g,ZP:()=>m,zR:()=>h});var n=s(67294),i=s(33349),a=s(74117),o=s(66777),r=s(48521);const l=new RegExp(/[‘’]/gi),d="'";function c(e,t){if(!e)return[!1,e];if("string"==typeof e){const s=h(e,t);return[s,s?g(e,t):e]}const{type:s,props:a={}}=e;if(s===o.C){const s=h(String(a.text),t);return[s,s?p(e,t):e]}if(!("input"!==s&&"textarea"!==s||"string"!=typeof a.value&&"string"!=typeof a.defaultValue||"radio"===a.type||"checkbox"===a.type||"password"===a.type)){const s=h("string"==typeof a.value?a.value:String(a.defaultValue),t);return[s,s?u(e,t):e]}if("select"===s||s===i.Z){let s=!1;return n.Children.forEach(a.children,(e=>{const n=e?.props?.children;n&&"string"==typeof n&&h(n,t)&&(s=!0)})),[s,s?u(e,t):e]}const r=a?.children;if(l=r,Boolean(l?.forEach||Symbol.iterator in Object(l)||Object.keys(Object(l)).length)){let s=!1;const i=n.Children.map(r,(e=>{const[n,i]=c(e,t);return s=s||n,i}));if(s){return[!0,n.cloneElement(e,a,i)]}}var l;return[!1,e]}function h(e,t){return e.toLowerCase().replace(l,d).includes(t.toLowerCase().replace(l,d))}const u=(e,t)=>(0,r.jsxs)("div",{className:"settings-text-bubble-highlight-wrapper",children:[e,(0,r.jsx)("mark",{className:"settings-text-bubble-highlight",children:t})]});function p(e,t){const s=new RegExp((0,a.Z)(t),"gi"),{props:n}=e,i=n.text.replace(l,d).match(s)||[];return(0,r.jsx)(o.C,{...n,highlight:{matches:i,regExp:s}})}function g(e,t){if(!t||!e)return e;if("string"!=typeof e)return e;const s=new RegExp((0,a.Z)(t),"gi"),n=e.replace(l,d),i=n.match(s)||[],o=n.split(s).reduce(((e,t,s)=>{let n=e;return s&&(n=n.concat([(0,r.jsx)("mark",{children:i[s-1]},s)])),n=n.concat([t]),n}),[]);return(0,r.jsx)("span",{children:o})}function m(e,t){if(!t)return e;const[s,n]=c(e,t);return s?n:null}},5422:(e,t,s)=>{"use strict";s.d(t,{Y:()=>V,Z:()=>ee});var n=s(67294),i=s(25795),a=s(69417),o=s(29087),r=s(39206),l=s(33349),d=s(56371),c=s(89175),h=s(48521);const u=e=>{const t=t=>e.changeParameter(t.target.value,e.index);return(0,h.jsx)("div",{className:"ChainedCommand-Item--Parameter",title:(e=>{const{keyword:t}=e;if(!t)return null;const{max:s,min:n,defaultValue:i,type:a,unit:o}=t;return("number"===a||"mixed"===a?(0,d.Z)("Min: $1",[n??""])+"\n"+(0,d.Z)("Max: $1",[s??""])+"\n":"")+(0,d.Z)("Default: $1",[i])+"\n"+(0,d.Z)("Parameter Unit: $1",[o])})(e.originalCommand),children:(()=>{const{command:s}=e;switch(s.name){case"COMMAND_SEARCH_SELECTION_WITH_CUSTOM_ENGINE":{const e=r.Z.get();return(0,h.jsxs)("label",{className:"floating-label",children:[(0,h.jsx)("span",{children:w.parameter}),(0,h.jsx)(l.Z,{onChange:t,value:s.param,children:e.map((e=>{const{name:t,guid:s}=e;return(0,h.jsx)("option",{value:s,children:t},t)}))})]})}case"COMMAND_TOGGLE_INTERFACE_COLOR_BY_NAME":{const e=o.Z.get(c.kThemesSystem).concat(o.Z.get(c.kThemesUser));return(0,h.jsxs)("label",{className:"floating-label",children:[(0,h.jsx)("span",{children:w.parameter}),(0,h.jsx)(l.Z,{onChange:t,value:s.param,children:e.map((e=>{const{name:t}=e;return(0,h.jsx)("option",{children:t},t)}))})]})}default:return(0,h.jsx)(a.Z,{label:w.parameter,type:(n=e.command.defaultValue,"string"==typeof n?"text":"number"),placeholder:String(e.command.defaultValue),value:e.command.param,onChange:e=>t(e),draggable:"true",onDragStart:e=>e.preventDefault()})}var n})()})};var p=s(92571),g=s(94283),m=s(81157),f=s(10334),v=s(47380);const b=()=>{const[e,t]=(0,n.useState)(!1);return(0,n.useEffect)((()=>(t(!0),()=>{t(!1)})),[e]),e},C=["COMMAND_OPEN_LINK_DEFAULT","COMMAND_OPEN_LINK_CURRENT","COMMAND_OPEN_LINK_BACKGROUND"],w={name:(0,d.Z)("title","Chain Name"),emptyTitle:(0,d.Z)("Add your First Command Chain"),emptyDescription:(0,d.Z)("Press the “Add” button to the left to add a new Chain."),parameter:(0,d.Z)("chainedcommand","Command Parameter")},y="ChainedCommand-Item--Over",x="vivaldi/x-oldIndex";let I=-1;const A=({windowId:e,chain:t,commands:s,removeFrom:i,chainOptions:o,changeParameter:r,addToChain:l,nameChange:c,name:C,shouldFocusSelector:w,moveItem:A,searchableStrings:S})=>{const Z=b(),T=n.useContext(g.Z),E=e=>{(0,m.ZP)(e);const{classList:t}=e.currentTarget;t?.contains("ChainedCommand-Item")&&t.add(y)},k=e=>{(0,m.ZP)(e);const{classList:t}=e.currentTarget;t?.contains(y)&&t.remove(y)};return(0,h.jsx)("div",{className:"detail",children:(0,h.jsxs)("div",{className:"detail-content",children:[(0,h.jsx)("div",{className:"setting-group",children:(0,h.jsx)("div",{className:"setting-single",children:(0,h.jsx)(a.Z,{label:S.name,type:"text",value:C||"",onChange:e=>c(e.target.value)})})}),(0,h.jsx)("div",{className:"ChainedCommand setting-group-unlimited",onDragOver:e=>{(0,m.ZP)(e),e.dataTransfer.dropEffect="move"},children:t.map(((e,n)=>{const a=o.findIndex((t=>t.key===e.key)),c=o[a],g=s[a],f=g?{key:e.key,label:g.label,name:g.name}:void 0,v={val:c?.key,position:n+1,shouldDelete:!1},b={position:n,shouldDelete:!0},C=Z&&w&&n===I,y=`ChainedCommand-Item--${t.length}--${n}`;return(0,h.jsxs)("div",{className:"ChainedCommand-Item",draggable:t.length>1,onClick:e=>e.preventDefault(),onDrop:e=>((e,t)=>{(0,m.ZP)(e);const s=e.dataTransfer.getData(x),n=parseInt(s);isNaN(n)||A(n,t),k(e)})(e,n),onDragStart:e=>((e,t)=>{e.dataTransfer.setData(x,t)})(e,n),onDragEnter:E,onDragLeave:k,children:[(0,h.jsxs)("div",{className:"ChainedCommand-Item--Title floating-label",children:[(0,h.jsx)("span",{className:"ChainedCommand-Item--Name",children:`Command ${n+1}`}),(0,h.jsx)(p.Z,{placeholder:(0,d.Z)("Filter Commands"),isClearable:!0,selectedCommand:f,autoFocus:C,openMenuOnFocus:!1,isMulti:!1,commands:o,setSelectedItem:e=>{I=n+1,l({val:e.key,...b})}})]}),g&&void 0!==e.param&&(0,h.jsx)(u,{originalCommand:g,command:e,index:n,changeParameter:r}),(0,h.jsxs)("div",{className:"ChainedCommand-Item--Controls",children:[(0,h.jsx)("input",{type:"button",className:"circular remove",title:(0,d.Z)("Remove Command"),disabled:1===t.length,onClick:()=>{I=-1,i(n)}}),(0,h.jsx)("input",{type:"button",className:"circular add",title:(0,d.Z)("Add Command"),onClick:()=>{I=n+1,l(v)}})]})]},y)}))}),(0,h.jsx)("input",{type:"button",value:(0,d.Z)("Test Chain"),onClick:()=>{(0,f.hT)((0,v.m)("qc",T),t)}})]})})};var S=s(76632),Z=s(59322),T=s(68247),E=s(40893),k=s(60203),N=s(2699),_=s(15489),P=s(26036),M=s(14507),D=s(93196),O=s(21191),j=s(86088),L=s(93513),R=s(44850);const B=[c.kChainedCommandsCommandList,c.kChainedCommandsDeletedCommandList],F=R.jk.settingCategories,W="https://vivaldi.com",U=(0,d.Z)("Valid URL"),V=[{name:"COMMAND_CHAINED_SLEEP",action:e=>"number"==typeof e.param?new Promise((t=>setTimeout(t,e.param))):(console.error("Parameter to action is not a number",e.param),Promise.resolve()),category:"CATEGORY_COMMAND_APPLICATION",showInQC:!1,isEnabled:()=>!0,isVisible:()=>!0,keyword:{type:"number",defaultValue:1e3,unit:(0,d.Z)("Milliseconds"),min:1,max:3e4},guid:"2eb81004-6703-46db-9933-6afcfde924e4",...(0,P.Z)("command","Delay")},{name:C[0],action:async e=>{const t="string"==typeof e.param?e.param:"";return await Z.ZP.openURL(e.windowId,t,{inCurrent:!1,inBackground:!1})},category:"CATEGORY_COMMAND_APPLICATION",showInQC:!1,isEnabled:()=>!0,isVisible:()=>!0,keyword:{type:"string",defaultValue:W,unit:U},guid:"f57b8092-9426-4bc8-8e39-fcf3e315b065",...(0,P.Z)("command","Open Link in New Tab")},{name:C[1],action:async e=>{const t="string"==typeof e.param?e.param:"";return await Z.ZP.openURL(e.windowId,t,{inCurrent:!0})},category:"CATEGORY_COMMAND_APPLICATION",showInQC:!1,isEnabled:()=>!0,isVisible:()=>!0,keyword:{type:"string",defaultValue:W,unit:U},guid:"0b01337b-4c13-4197-90c8-179c5c91cfff",...(0,P.Z)("command","Open Link in Current Tab")},{name:C[2],action:async e=>{const t="string"==typeof e.param?e.param:"";return await Z.ZP.openURL(e.windowId,t,{inBackground:!0})},category:"CATEGORY_COMMAND_APPLICATION",showInQC:!1,isEnabled:()=>!0,isVisible:()=>!0,keyword:{type:"string",defaultValue:W,unit:U},guid:"00e0e4ad-de61-4e36-8d7e-6aead10cf1c5",...(0,P.Z)("command","Open Link in Background Tab")},{name:"COMMAND_TOGGLE_INTERFACE_COLOR_BY_NAME",action:async e=>{const t="string"==typeof e.param?e.param:"";N.Z.setThemeByNameWithFallback(t)},showInQC:!1,category:"CATEGORY_COMMAND_APPEARANCE",guid:"e12a5194-0153-439b-98f6-9dcd99ca0d7e",isEnabled:()=>!0,isVisible:()=>!0,keyword:{type:"string",unit:(0,d.Z)("Theme Name"),defaultValue:"Vivaldi"},...(0,P.Z)("Switch to Theme...")},{name:"COMMAND_SEARCH_SELECTION_WITH_CUSTOM_ENGINE",action:async e=>{const t=String(e.param),s=r.Z.getByGuid(t)??r.Z.getDefault(_.ZP.isIncognitoOrGuest(e.windowId));s&&E.Z.withPageSelection(e.windowId,s)},showInQC:!1,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"3a8efd62-4c8a-4545-8a6c-9cb65518f507",isEnabled:()=>!0,isVisible:()=>!0,keyword:{type:"string",unit:(0,d.Z)("Search Engine"),defaultValue:""},...(0,P.Z)("Search Selection with Engine...")}],H=["b6ddaabf-d87f-4c2c-affa-ce81bb30bfca","176ff9a8-a516-4015-9b0a-14434746ce9b","1453aae1-130d-465f-98eb-cbda5061445d","172583c9-c8d5-45f7-9e4d-65cff9333679","d03d4bc8-26c4-49f6-b3ce-23980637ae76","855ad23f-900b-42bf-af4d-4ce6b419ce09","9f6124ef-e8ed-4143-b9ca-5a4beb646e3d"],G=e=>{const{keyword:t}=e;let s,n;if("COMMAND_SEARCH_SELECTION_WITH_CUSTOM_ENGINE"===e.name){const e=r.Z.getDefault(!1);s=e?.guid,n=e?.guid}return{...t&&{param:s||t.defaultValue,defaultValue:n||t.defaultValue}}},K=e=>({name:e.name,label:e.label,key:e.guid,...G(e)});var z=(0,h.jsx)("br",{}),$=(0,h.jsx)("br",{}),Y=(0,h.jsx)("br",{}),X=(0,h.jsx)("br",{}),Q=(0,h.jsx)("br",{}),q=(0,h.jsx)("br",{}),J=(0,h.jsx)("br",{});function ee({filter:e,category:t}){const s=(0,M.Z)(B),a=b(),o=(0,n.useContext)(g.Z),[r,l]=(0,n.useState)([]),[u,p]=(0,n.useState)(s[c.kChainedCommandsCommandList]),m=(0,n.useRef)(0),C=t!==F.all,y=r.map((e=>K(e)));(0,n.useEffect)((()=>{x().then((e=>{const t=e.filter((e=>!(0,O.jD)(e.name)&&!(0,O.Ed)(e.name)&&!H.includes(e.guid)&&e.isVisible(o.vivaldiWindowId))).map((e=>{const t=(0,D.xU)(e.name);return{...e,...t&&{keyword:t}}})).concat(V);l(t)}))}),[o.vivaldiWindowId]);const x=async()=>await i.Z.getVivDefinedCommands();(0,n.useEffect)((()=>{T.Z.set(c.kChainedCommandsCommandList,u)}),[u]);const I=e=>{const{val:t,position:s,shouldDelete:n}=e,i=r.find((e=>e.guid===t));if(!i||!a)return;const o=K(i),l=(0,L.Uy)(u,(e=>{const t={...e[m.current]},i=[...t.chain];i.splice(s,Number(n),o),t.chain=i,e[m.current]=t}));p(l)},Z=(e,t)=>{const s=(0,L.Uy)(u,(s=>{const n={...s[m.current]},i=[...n.chain],a=i.splice(e,1)[0];i.splice(t,0,a),n.chain=i,s[m.current]=n}));p(s)},E=(e,t)=>{const s=!isNaN(e)&&e.length?Number(e):e,n=(0,L.Uy)(u,(e=>{const n={...e[m.current]},i=[...n.chain],a={...i[t]};a.param=s,i[t]=a,n.chain=i,e[m.current]=n}));p(n)},N=e=>{const t=(0,L.Uy)(u,(t=>{const s={...t[m.current]},n=[...s.chain];n.splice(e,1),s.chain=n,t[m.current]=s}));p(t)},_=e=>{const t=(0,L.Uy)(u,(t=>{const s={...t[m.current]};s.label=e,t[m.current]=s}));p(t)},R=()=>{const e=(0,L.Uy)(u,(e=>{const t=e[m.current],s=crypto.randomUUID(),n={...t,chain:t.chain.slice(),key:s,name:`COMMAND_${s}`,label:(0,d.Z)("$1 copy",[t.label])};e.splice(m.current+1,0,n)}));p(e)},W=u.map((e=>({key:e.key,name:e.name,isDefault:!1,label:e.label})));return(0,h.jsxs)(k.Z,{filter:e,children:[(0,h.jsxs)("p",{className:"info",children:[(0,d.Z)("A Command Chain is a group of commands executed in a sequence. You can trigger a Chain from Quick Commands, or assign it a custom Keyboard Shortcut or Mouse Gesture."),z,$,(0,d.Z)("Some commands support parameters and placeholders. Placeholders can be used through Context Menus on websites, images and videos:"),Y,(0,d.Z)("Selected Text: $1",[f.te.description]),X,(0,d.Z)("Clicked Link: $1",[f.UL.description]),Q,(0,d.Z)("Active Page URL: $1",[f.a5.description]),q,(0,d.Z)("Active Page Title: $1",[f.v$.description]),J,(0,d.Z)("Source Element URL: $1",[f.Ff.description])]}),(0,h.jsx)(S.Z,{className:"Setting--ChainedCommand",masterLayout:1,contentStrings:w,items:W,filter:e,deleteTitle:(0,d.Z)("title","Delete Command Chain"),deleteTipString:(0,d.Z)("tooltip","Delete Command Chain"),addTipString:(0,d.Z)("Add Command Chain"),onRemove:e=>{const t=(0,L.Uy)(u,(t=>{const n=t.splice(e,1)[0],{key:i}=n,a=s[c.kChainedCommandsDeletedCommandList];T.Z.set(c.kChainedCommandsDeletedCommandList,[i,...a])}));p(t)},onContextMenu:(e,t)=>{const s=[{handler:R,...(0,P.Z)("Duplicate Command Chain")}];(0,v.Z)(o,s)(t)},renderEmpty:e=>(0,h.jsx)("div",{className:"detail",children:(0,h.jsxs)("div",{className:"detail-content",children:[(0,h.jsx)("h3",{children:e.emptyTitle}),(0,h.jsx)("p",{children:e.emptyDescription})]})}),moveItem:(e,t)=>{const s=(0,L.Uy)(u,(s=>{const n=s.splice(e,1)[0];s.splice(t,0,n)}));p(s)},emptyListString:(0,d.Z)("Add a Chain to Start"),emptyListGraphic:j.Yaj,onCreateItem:()=>{const e=(0,d.Z)("create","New Chain"),t=crypto.randomUUID(),s={label:e,name:`COMMAND_${t}`,chain:[K(V[0])],key:t,category:"CATEGORY_COMMAND_CHAIN"};p((e=>[...e,s]))},renderCreate:e=>{const t=u.length-1,{chain:s,label:n}=u[t];return m.current=t,(0,h.jsx)(A,{chainOptions:y,changeParameter:E,removeFrom:N,commands:r,shouldFocusSelector:C,cloneChain:R,addToChain:I,searchableStrings:e,moveItem:Z,nameChange:_,windowId:o.vivaldiWindowId,name:n,chain:s})},mimeType:"vivaldi/x-settings-chained-command-type",supportDragAndDrop:!0,renderListItem:(e,t)=>(0,h.jsx)("div",{className:"item-title",children:t.label}),renderContent:(e,t)=>{const{chain:s,label:n}=u[e];return m.current=e,(0,h.jsx)(A,{chainOptions:y,changeParameter:E,removeFrom:N,commands:r,shouldFocusSelector:C,cloneChain:R,addToChain:I,searchableStrings:t,moveItem:Z,nameChange:_,windowId:o.vivaldiWindowId,name:n,chain:s})}})]})}},88901:(e,t,s)=>{"use strict";s.d(t,{Z:()=>h});var n=s(67294),i=s(65792),a=s.n(i),o=s(94283),r=s(56371),l=s(48521);const d=32;class c extends n.PureComponent{static contextType=o.Z;refCanvas=n.createRef();componentDidMount(){this._isMounted=!0,this.offscreen=this.refCanvas.current.transferControlToOffscreen(),this.renderIcon(this.props.mediaState)}componentDidUpdate(e){const{mediaState:t,color:s,animated:n,active:i}=this.props;!this._isMounted||e.mediaState===t&&e.color===s&&e.animated===n&&e.active===i||this.renderIcon(this.props.mediaState)}componentWillUnmount(){this._isMounted=!1}shouldAnimate=()=>this._isMounted&&this.props.animated&&this.props.mediaState.has("playing")&&!this.props.mediaState.has("muting")&&!this.props.mediaState.has("capturing")&&!this.props.mediaState.has("pip");getInheritedColor=()=>{if(!this._isMounted)return;let e="#111111";this.props.color?e=this.props.color:this.refCanvas.current&&(e=getComputedStyle(this.refCanvas.current).getPropertyValue("color")),this._color!==e&&(this._color=e)};renderIcon=e=>{if(!this.offscreen)return;const t=this.offscreen.getContext("2d");this.getInheritedColor();let s=0;function n(e,t){return e+s*(t-e)}const i=()=>{t.beginPath(),t.moveTo(4,12),t.lineTo(10,12),t.lineTo(18,4),t.lineTo(18,28),t.lineTo(10,20),t.lineTo(4,20),t.closePath(),t.lineWidth=0,t.fillStyle=this._color,t.fill()},o=()=>{t.beginPath(),t.moveTo(2,27),t.lineTo(5,30),t.lineTo(28,7),t.lineTo(25,4),t.moveTo(4,12),t.lineTo(10,12),t.lineTo(18,4),t.lineTo(18,8),t.lineTo(6,20),t.lineTo(4,20),t.moveTo(14,24),t.lineTo(18,20),t.lineTo(18,28),t.closePath(),t.lineWidth=0,t.fillStyle=this._color,t.fill()},r=()=>{t.beginPath(),t.moveTo(6,25),t.lineTo(4,23),t.lineTo(4,8),t.lineTo(6,6),t.lineTo(26,6),t.lineTo(28,8),t.lineTo(28,23),t.lineTo(26,25),t.moveTo(26,23),t.lineTo(26,14),t.lineTo(14,14),t.lineTo(14,23),t.closePath(),t.lineWidth=0,t.fillStyle=this._color,t.fill()},l=e=>{if(!t||!this.shouldAnimate())return;this._lastTime||(this._lastTime=e);const i=e-this._lastTime;if(i<62.5)return void this.context.requestAnimationFrame(l);t.clearRect(18,0,d,d),s=s>1?0:Math.ceil(100*(s+.05))/100,t.beginPath(),t.moveTo(4,12),t.lineTo(10,12),t.lineTo(18,4),t.lineTo(18,28),t.lineTo(10,20),t.lineTo(4,20),t.moveTo(n(14,22),n(12,4)),t.quadraticCurveTo(n(18,32),16,n(14,22),n(20,28)),t.lineTo(n(16,24),n(22,30)),t.quadraticCurveTo(n(20,34),16,n(16,24),n(10,2)),t.closePath(),t.lineWidth=0;const o=s<.7?1:parseFloat((1-s)/.3);t.fillStyle=a()(this._color).alpha(o).css(),t.fill(),this.shouldAnimate()?(this.getInheritedColor(),this.context.requestAnimationFrame(l)):c(this.props.mediaState),this._lastTime=e-i%62.5},c=e=>{t.globalCompositeOperation&&(t.clearRect(0,0,d,d),e.has("pip")?r():e.has("capturing")?(t.beginPath(),t.arc(3,26,4,1.5*Math.PI,2*Math.PI,!1),t.lineWidth=2,t.stroke(),t.closePath(),t.beginPath(),t.arc(3,26,8,1.5*Math.PI,2*Math.PI,!1),t.lineWidth=2,t.stroke(),t.closePath(),t.beginPath(),t.arc(3,26,12,1.5*Math.PI,2*Math.PI,!1),t.lineWidth=2,t.stroke(),t.closePath(),t.beginPath(),t.moveTo(4,10),t.lineTo(4,8),t.lineTo(6,6),t.lineTo(26,6),t.lineTo(28,8),t.lineTo(28,23),t.lineTo(26,25),t.lineTo(20,25),t.lineWidth=2,t.stroke()):e.has("muting")?o():e.has("playing")&&this.shouldAnimate()?l(this.context.performance.now()):i())};c(e)};render(){let e="";return this.props.mediaState.has("pip")?e=(0,r.Z)("Exit Picture in Picture"):this.props.mediaState.has("muting")?e="tab"===this.props.src?(0,r.Z)("Unmute tab audio"):(0,r.Z)("Unmute panel audio"):this.props.mediaState.has("playing")&&(e="tab"===this.props.src?(0,r.Z)("Mute tab audio"):(0,r.Z)("Mute panel audio")),(0,l.jsx)("canvas",{ref:this.refCanvas,className:"audioicon",width:d,height:d,title:e})}}const h=c},93197:(e,t,s)=>{"use strict";s.d(t,{$J:()=>r,Cj:()=>l,E5:()=>d,ZP:()=>y});var n=s(65792),i=s.n(n),a=s(42568),o=s.n(a);const r=.4,l=i()("#fff"),d=i()("#000"),c=i()("#06a700"),h=i()("#FFCC00"),u=i()("#c64539");function p(e,t,s){return i().deltaE(e,t)>=s}function g(e,t,s,n=!1){return p(e,t,s)?e:e.luminance()>t.luminance()?function(e,t,s,n=!1){do{if((e=e.brighten(.1)).num()===l.num()){if(!n)return l;do{if((e=e.darken(.1)).num()===d.num())return d}while(!p(e,t,s))}}while(!p(e,t,s));return e}(e,t,s,n):function(e,t,s,n=!1){let a=i()(e.hex());do{if(a=a.darken(.1),a.num()===d.num()){if(!n)return d;let a=i()(e.hex());do{if(a=a.brighten(.1),a.num()===l.num())return l}while(!p(a,t,s));return a}}while(!p(a,t,s));return a}(e,t,s,n)}function m(e,t,s){const n=e.luminance()>r?e.brighten(.75):e.darken(.75),a=i().mix(e,t,.1),o=i().mix(e,t,.2),l=i().mix(e,t,.4);return{colorFg:e,colorFgAlpha:e.alpha(.1),colorFgIntense:g(n,t,s),colorFgFaded:g(a,t,s),colorFgFadedMore:g(o,t,s),colorFgFadedMost:g(l,t,s)}}function f(e,t,s,n,a){const o=e.luminance()>r,d=e.darken(.15),c=e.darken(.3),h=e.brighten(.1),u=e.brighten(.5),p=e.brighten(.2),m=o?e.brighten(.3):e.darken(.5),f=o?e.brighten(.5):e.darken(.7),v=o?e.darken(.1):e.brighten(.1),b=o?e.darken(.4):e.brighten(.4),C=o?e.darken(.3):e.brighten(.3),w=o?i().mix(l,e,.4).alpha(.95):f.darken(.1).alpha(.92);return{colorBg:e,colorBgAlpha:e.alpha(.9),colorBgAlphaHeavy:e.alpha(.65),colorBgAlphaHeavier:e.alpha(.25),colorBgAlphaBlur:e.alpha(n),colorBgDark:g(d,t,s),colorBgDarker:g(c,t,s),colorBgLight:g(h,t,s),colorBgLighter:g(u,t,s),colorBgLightIntense:g(p,t,s),colorBgIntense:g(m,t,s),colorBgIntenser:g(f,t,s),colorBgIntserAlpha:w,colorBgInverse:g(v,t,s),colorBgInverser:g(b,t,s),colorBgFaded:g(C,t,s),backgroundBlur:a?`blur(${a}px)`:""}}function v(e,t,s){const n=e.brighten(1),i=e.darken(.5),a=e.luminance()>r?d:l;return{colorHighlightBg:e,colorHighlightBgFaded:n,colorHighlightBgAlpha:e.alpha(.1),colorHighlightBgDark:g(i,t,s),colorHighlightFg:a,colorHighlightFgAlpha:a.alpha(.5),colorHighlightFgAlphaHeavy:a.alpha(.25)}}function b(e,t,s,n){n&&e.luminance()>.8&&(e=e.darken(.55));const a=e.luminance()>r,o=a?d:l,c=i().mix(o,e,.4),h=e.darken(.4),u=e.darken(1),p=a?e.brighten(.3).desaturate(.5):e.darken(.3).desaturate(.5),m=e.brighten(.5),f=e.brighten(1.2),v=f.luminance()>r,b=g(e,t,s,!0),C=b.darken(.25);return{colorAccentBg:e,colorAccentBgAlpha:f.alpha(v?.45:.55),colorAccentBgAlphaHeavy:f.alpha(v?.25:.35),colorAccentBgDark:h,colorAccentBgDarker:u,colorAccentBgFaded:p,colorAccentBgFadedMore:m,colorAccentBgFadedMost:f,colorAccentBorder:b,colorAccentBorderDark:C,colorAccentFg:o,colorAccentFgFaded:c,colorAccentFgAlpha:o.alpha(.15),colorAccentFgAlphaHeavy:o.alpha(.05)}}function C(e,t){const s=.003*t,n=e.luminance()<s?e.brighten(1):e.darken(.5),a=g(n,e,t),o=a.luminance()>e.luminance(),l=e.luminance()<=r?i().mix(a,e,.35):i().mix(a,e,.7),d=o?a.brighten(.4):a.darken(.4),c=g(n,e,t/2);return{colorBorder:a,colorBorderDisabled:g(l,e,t/2),colorBorderSubtle:i().mix(c,e,.25),colorBorderIntense:g(d,e,1.25*t)}}function w(e,t){const s=g(c,e,t),n=s.alpha(.1),i=s.luminance()>r?d:l,a=g(h,e,t),o=a.alpha(.1),p=a.luminance()>r?d:l,m=g(u,e,t),f=m.alpha(.1),v=m.luminance()>r?d:l;return{colorSuccessBg:s,colorSuccessBgAlpha:n,colorSuccessFg:i,colorWarningBg:a,colorWarningBgAlpha:o,colorWarningFg:p,colorErrorBg:m,colorErrorBgAlpha:f,colorErrorFg:v}}const y={forTheme:o()((e=>{const t=6*e.contrast,s=2*e.contrast,n=1.5*e.contrast,a=3*e.contrast,o=3*e.contrast,c=6*e.contrast,h=g(i()(e.colorFg),i()(e.colorBg),t),u=g(i()(e.colorBg),i()(e.colorFg),s),p=g(i()(e.colorHighlightBg),i()(e.colorBg),n),y=g(i()(e.colorAccentBg),i()(e.colorBg),a,!0),x=e.colorWindowBg?i()(e.colorWindowBg):u,I=x.luminance()>r?d:l;return{...m(h,u,t),...f(u,h,s,e.alpha,e.blur),...v(p,u,n),...b(y,u,a,!1),...C(u,o),...w(u,c),colorWindowBg:x,colorWindowFg:I}}),{maxSize:5}),accentOnly:function(e,t,s,n,i){const a=2*n,o=3*n;return t=g(t,s,6*n),s=g(s,t,a),b(e=g(e,s,o),s,o,i)},fgBgHighlight:function(e,t,s){return e=g(e,t,6),t=g(t,e,2),s=g(s,t,1.5),{...m(e,t,6),...f(t,e,2,.75,10),...v(s,t,1.5)}}}},38768:(e,t,s)=>{"use strict";s.d(t,{H:()=>o,v:()=>r});var n=s(29087),i=s(15489),a=s(89175);function o(e){return r(i.ZP.getWindowState(e))}function r(e){const t=e?.visibleUI.tabs??n.Z.get(a.kTabsVisible),s=e?.visibleUI.addressBar??n.Z.get(a.kAddressBarVisible),i="top"===n.Z.get(a.kTabsBarPosition),o="top"===n.Z.get(a.kAddressBarPosition);if(e&&e.minimalUI&&(s&&o||t&&i))return!1;const r=n.Z.get(a.kAppearanceDisableTitleBar),l="top"===n.Z.get(a.kMenuDisplay)&&!0;return!(r&&s&&o&&(!t||!i)&&!l)}},60679:(e,t,s)=>{"use strict";s.d(t,{W$:()=>d,ZP:()=>h,uu:()=>l});var n=s(94184),i=s.n(n),a=s(67294),o=s(721),r=s(48521);const l=e=>{const{draggable:t}=e;return t?{draggable:e.draggable,onDragStart:e.onDragStart,onDragLeave:e.onDragLeave,onDragEnter:e.onDragEnter,onDragOver:e.onDragOver,onDragEnd:e.onDragEnd,onDrop:e.onDrop}:{}},d=e=>{const{ctrlKey:t,altKey:s,shiftKey:n,metaKey:i}=e,a={ctrlKey:t,altKey:s,shiftKey:n,metaKey:i};return(0,o.Ek)(a)};function c(e,t,s){const n=e.clientX-t.left,i=e.clientY-t.top;let a=.5;void 0!==s&&s>=0&&s<=.5&&(a=s);const o=n<t.width*a,r=n>t.width*(1-a),l=i<t.height*a,d=i>t.height*(1-a);return{horizontal:o?"left":r?"right":"center",vertical:l?"top":d?"bottom":"center"}}function h(e){return(0,a.forwardRef)(((t,s)=>{const n=(0,a.useRef)(null),o=s||n,[{buttonClasses:l,draggable:d,dragging:h,setVerticalPosition:u,setHorizontalPosition:p,dragOver:g,verticalPosition:m,horizontalPosition:f},{onDragStart:v,onDragEnd:b,onDragEnter:C,limitToDrag:w,onDrop:y,onDragLeave:x,onDragOver:I}]=function(e){const[t,s]=(0,a.useState)(!1),[n,o]=(0,a.useState)(!1),[r,l]=(0,a.useState)(null),[d,h]=(0,a.useState)(null),{draggable:u,onDragStart:p,onDragEnd:g,onDragEnter:m,onDrop:f,mimeType:v,image:b,imagePath:C,faviconPath:w,isOn:y,isPressed:x,isPopupVisible:I,name:A,edgeAmount:S}=e,Z=(0,a.useCallback)((e=>{p&&p(e),e.persist(),u?(e.dataTransfer.dropEffect="move",v&&A&&(e.dataTransfer.setData(v,A),e.dataTransfer.setData("text/plain","")),s(!0)):e.preventDefault()}),[u,p,v,A]),T=(0,a.useCallback)((e=>{e.persist(),g?.(e),s(!1),o(!1),h(null),l(null)}),[g]),E=(0,a.useCallback)((e=>{o(!0),m&&m(e)}),[m]),k=(0,a.useCallback)((e=>{if(e.dataTransfer.types.includes(v)){const t=e.currentTarget.getBoundingClientRect();e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="move";const{horizontal:s,vertical:n}=c(e,t,S);l(n),h(s)}}),[v,S]),N=(0,a.useCallback)((e=>{const t=e.currentTarget.getBoundingClientRect(),{horizontal:n,vertical:i}=c(e,t,S);if(s(!1),o(!1),h(null),l(null),e.persist(),!e.dataTransfer.types.includes(v))return e.preventDefault(),void e.stopPropagation();f?.(e,n,i)}),[f,v,S]),_=(0,a.useCallback)((e=>{u||e.preventDefault()}),[u]),P=(0,a.useCallback)((e=>{o(!1),h(null),l(null)}),[]);return[{buttonClasses:(e=>{const s="center"===r&&"center"===d;return i()(e,{"button-on":y,"button-textonly":!b&&!C&&!w,"button-pressed":x||I,"button-dragged":t,"button-dragover":n,"button-dragover-top":"top"===r,"button-dragover-bottom":"bottom"===r,"button-dragover-center":s,"button-dragover-left":"left"===d,"button-dragover-right":"right"===d})})(e.buttonClasses),draggable:u&&Boolean(Z&&e.mimeType),dragging:t,dragOver:n,setVerticalPosition:l,setHorizontalPosition:h,verticalPosition:r,horizontalPosition:d},{onDragStart:Z,onDragEnd:T,limitToDrag:_,onDragEnter:E,onDrop:N,onDragLeave:P,onDragOver:k}]}(t);return(0,r.jsx)(e,{...t,ref:o,dragging:h,draggable:d,onDragStart:v,onDragEnd:b,onDragEnter:C,dragOver:g,limitToDrag:w,onDragLeave:x,onDragOver:I,onDrop:y,buttonClasses:l,setVerticalPosition:u,setHorizontalPosition:p,verticalPosition:m,horizontalPosition:f})}))}},98102:(e,t,s)=>{"use strict";s.d(t,{f2:()=>_,ZP:()=>O});var n=s(67294),i=s(88901),a=s(25795),o=s(97009),r=s(60679),l=s(81009),d=s(5298),c=s(68247),h=s(48521);const u={};function p(e){const[t,s]=(0,n.useState)(u[e.url]);return(0,n.useEffect)((()=>{(async e=>{if(u[e])return void s(u[e]);const t=new XMLHttpRequest;t.addEventListener("load",(n=>{const{response:i}=t;u[e]=i,s(i)})),t.addEventListener("error",(e=>{console.error(e)})),t.open("GET",e),t.send()})(e.url)}),[e.url]),t?(0,h.jsx)("span",{className:e.className,dangerouslySetInnerHTML:{__html:t},"aria-hidden":"true"}):(0,h.jsx)("span",{className:e.className})}var g=s(37330),m=s(98528),f=s(97297),v=s(94283),b=s(15489),C=s(56371),w=s(94184),y=s.n(w),x=s(47380),I=s(4027),A=s(81157),S=s(51877),Z=s(79227),T=s(89175),E=s(86088),k=s(13302),N=s(34155);const _="vivaldi/x-button-toolbar",P=[T.kKeyboardTabToAll,T.kMailCountersPanelUnseenEnabled,T.kThemesPreferCustomButtons,T.kThemesCurrentButtons,T.kToolbarButtonPopupSizes,T.kThemeUseAnimation];function M(e,t,s){switch(e){case"children":return!t.isPopupVisible&&!s.isPopupVisible||t.children===s.children;case"buttonStyle":case"style":if(t[e]&&s[e])return(0,S.Z)(t[e],s[e])}return t[e]===s[e]}class D extends n.Component{static contextType=v.Z;nodeRef=n.createRef();uuid=crypto.randomUUID();setButtonRef=e=>{this.buttonRef=e,this.buttonRef&&this.props.isPopupVisible&&this.forceUpdate()};state={isMenuVisible:!1,customButton:this.props.name?g.Z.getToolbarButtonImage(this.props.name):void 0,keyShortcut:""};componentDidMount(){this.props.name&&(g.Z.addListener(this.onThemeStoreChanged,(e=>e.theme.buttons)),a.Z.addListener(this.onCommandStoreChanged),this.setKeyshortcut())}componentDidUpdate(e,t){this.props.commandId!==e.commandId&&this.setKeyshortcut(),Boolean(this.props.name)!==Boolean(e.name)&&(this.props.name?(g.Z.addListener(this.onThemeStoreChanged,(e=>e.theme.buttons)),a.Z.addListener(this.onCommandStoreChanged)):(g.Z.removeListener(this.onThemeStoreChanged),a.Z.removeListener(this.onCommandStoreChanged)))}shouldComponentUpdate(e,t){return!(0,S.Z)(this.props,e,M)||!(0,S.Z)(this.state,t)}componentWillUnmount(){this.props.name&&(g.Z.removeListener(this.onThemeStoreChanged),a.Z.removeListener(this.onCommandStoreChanged)),this.context.removeEventListener("pointerup",this.pointerUp,!0)}onThemeStoreChanged=()=>{this.props.name&&this.setState({customButton:g.Z.getToolbarButtonImage(this.props.name)})};setKeyshortcut(){this.props.commandId&&this.setState({keyShortcut:a.Z.getShortcut(this.props.commandId,!1)})}onCommandStoreChanged=e=>{["init","shortcut"].includes(e)&&this.setKeyshortcut()};hasMenu=()=>Boolean(this.props.menu);getContextMenuHandler=e=>this.hasMenu()||Boolean(this.props.customizeMenu)?this.showCustomizeMenu(e,e.target):null;showMenu=async e=>{if(this.props.dragging)return;if(!this.props.menuOrigin)return void console.warn("ToolbarButton: showMenu called without menuOrigin");let t;const s=e||this.buttonRef;if(this.props.menu){const e=this.props.menu();t=Array.isArray(e)?e:await e}else t=[];0!==t.length?(this.context.removeEventListener("pointerup",this.pointerUp,!0),(0,x.Z)(this.context,t,this.menuVisibilityChanged,this.props.menuOrigin,s||void 0)()):console.warn("ToolbarButton: showMenu called without a menu")};showCustomizeMenu=async(e,t)=>{if(this.props.disabled&&!this.props.alwaysMenu)return;let s;if(e.persist(),(0,A.ZP)(e),this.props.menu){const e=this.props.menu();s=Array.isArray(e)?e:await e}else s=[];this.props.customizeMenu&&(s=s.concat(this.props.customizeMenu(this.props.name))),(0,x.Z)(this.context,s,this.menuVisibilityChanged)(e)};getRect=()=>this.buttonRef?.getBoundingClientRect();hidePopup=()=>{this.props.hidePopup?.()};onBlur=e=>{this.props.onBlur?.(e)};onFocus=e=>{e.persist(),this.props.onFocus?.(e)};onDragStart=e=>{this.props.onDragStart?.(e),clearTimeout(this.menuTimer)};pointerLeave=e=>{clearTimeout(this.menuTimer),this.props.onPointerLeave&&this.props.onPointerLeave(e)};menuVisibilityChanged=e=>{e?(this.setState({isMenuVisible:!0}),this.props.onContextMenuVisibilityChanged?.(!0)):N.nextTick((()=>{this.setState({isMenuVisible:!1}),this.props.onContextMenuVisibilityChanged?.(!1)}))};onMenuIndicator=e=>{const{parentElement:t}=e.target;""===f.Z.getState()&&!(0,r.W$)(e)&&t instanceof this.context.HTMLElement&&(0,A.ZP)(e),this.state.isMenuVisible||setTimeout((()=>this.showMenu(t)),90)};pointerDown=e=>{const t=Date.now(),s=""===f.Z.getState();if(this.pointerTimestamp&&t-this.pointerTimestamp<150)e.preventDefault();else if(e.persist(),!s||(0,r.W$)(e)&&b.ZP.isActive(this.context.vivaldiWindowId)||e.button!==I.Z.kLeft||"function"!=typeof this.props.onPointerDown){if(s){const s=e.currentTarget;let n=!0;!(0,r.W$)(e)&&e.preventDefault(),e.button===I.Z.kLeft&&this.hasMenu()?this.props.openMenuOnClick?this.showMenu(s):this.props.onClick?this.menuTimer=setTimeout((()=>this.showMenu(s)),650):this.state.isMenuVisible&&(n=!1):e.button===I.Z.kRight&&(this.hasMenu()||this.props.customizeMenu)&&(e.stopPropagation(),n=!1),n&&(this.pointerTimestamp=t,this.context.addEventListener("pointerup",this.pointerUp,!0))}}else this.props.onPointerDown(e)};pointerUp=e=>{this.context.removeEventListener("pointerup",this.pointerUp,!0),clearTimeout(this.menuTimer);const t=this.buttonRef;if(t&&(e.target===t||e.target===t.parentElement)){const t="ctrlCmd"===this.props.modifier?e.ctrlKey:e.shiftKey;if(e.button===I.Z.kCenter||t)(0,A.ZP)(e),this.props.onMiddleClick&&this.props.onMiddleClick(e);else if(e.button===I.Z.kLeft){const t=Date.now()-this.pointerTimestamp;this.props.onClick&&("mouse"===e.pointerType||t<650)?this.props.onClick(e):this.hasMenu()&&((0,A.ZP)(e),e.target instanceof this.context.HTMLElement&&this.showMenu(e.target))}}};onAuxClick=e=>{e.button===I.Z.kCenter&&(0,A.ZP)(e)};keyDown=e=>{clearTimeout(this.menuTimer);const t=e.keyCode;this.props.onKeyDown?this.props.onKeyDown(e):this.hasMenu()&&e.shiftKey&&t===d.Z.KEY_DOWN?(this.showMenu(e.currentTarget),(0,A.ZP)(e)):t!==d.Z.KEY_SPACE&&t!==d.Z.KEY_ENTER&&t!==d.Z.KEY_RETURN||(this.props.onClick?this.props.onClick(e):this.hasMenu()&&((0,A.ZP)(e),this.showMenu(e.currentTarget)))};handleResize=e=>{if(!this.props.id)return;const t=this.props.id,s=this.props.prefValues[T.kToolbarButtonPopupSizes]??{};c.Z.set(T.kToolbarButtonPopupSizes,{...s,[t]:Math.round(e)})};renderPanelAudioIcon=()=>{const{mediaState:e,mediaStateType:t,name:s,toggleMuted:n}=this.props;return t&&"panel"===t&&void 0!==e?(0,h.jsx)("span",{className:"panel-audio",onClick:s&&n?()=>n(s):null,children:(0,h.jsx)(i.Z,{color:"#111",animated:!1,mediaState:new Set([e?"muting":"playing"]),src:"panel"})}):null};renderWorkspaceAudioIcon=()=>{const{prefValues:e}=this.props;return(0,h.jsx)("span",{className:"button-icon audio",children:(0,h.jsx)(i.Z,{animated:e[T.kThemeUseAnimation],mediaState:new Set(["playing"]),src:"tab"})})};renderBadge=()=>{const{badgeText:e,badgeColor:t,badgeBackgroundColor:s}=this.props;if(!e)return null;if("supporter"===e||"patron"===e||"advocate"===e)return(0,h.jsx)("img",{className:"Supporter-Badge",src:`/resources/badge-${e}-12@2x.png`,alt:""});const n=t?{color:t,backgroundColor:s}:void 0;return(0,h.jsx)("span",{className:"button-badge",style:n,children:e})};_onDragEnter=e=>{const t=e.dataTransfer.types.some((e=>e===_||e===Z.Z));if(t){const{onDrop:t,onDragEnter:s}=this.props;Boolean(t&&s)&&s?.(e)}else{const{onPanelButtonDragEnter:s}=this.props;s?.(e,t)}};_onDragLeave=e=>{if(e.dataTransfer.types.some((e=>e===_||e===Z.Z))){const{onDrop:t,onDragLeave:s}=this.props;Boolean(t&&s)&&s?.(e)}else{const{onPanelButtonDragLeave:e}=this.props;e?.()}};#xn(){return this.props.titleIsStatus?{role:"status"}:{}}#In(e){const{isPopupVisible:t=!1,hasPopup:s=!!this.props.children,roles:n,ariaControls:i}=this.props,a=this.props.ariaHaspopup?this.props.ariaHaspopup:this.props.openMenuOnClick?"menu":!!s&&"dialog",o={};return n&&(o.role=`button ${n}`),o["aria-label"]=e,a&&(o["aria-haspopup"]=a,o["aria-expanded"]=this.props.ariaExpanded||t||this.state.isMenuVisible),i&&(o["aria-controls"]=i),this.state.keyShortcut&&(o["aria-keyshortcuts"]=(0,k.$)(this.state.keyShortcut)),o}render(){const{children:e=null}=this.props,{ariaControls:t,ariaHidden:s=!1,disabled:n,buttonClasses:i,faviconPath:a,image:l,imagePath:d,fallbackImagePath:c,imageOverride:u,title:f,style:v,buttonStyle:b,tabIndex:w,isMenuIndicatorVisible:x=!1,isMenuIndicatorDisabled:I=!1,isPopupVisible:S=!1,hidePopup:Z,popupPosition:N,popupLabel:_,popupLabelledBy:P,draggable:M,label:D,tooltip:O,tooltipExtra:j="",limitToDrag:L,onDragEnd:R,onDragEnter:B,onDragOver:F,onDrop:W,onPointerEnter:U,prefValues:V,name:H,autoFocus:G,mediaState:K,mediaStateType:z,faviconLoadType:$}=this.props;if(!f&&!O)return null;const Y="workspace"===z&&K,X="number"==typeof w?w:V[T.kKeyboardTabToAll],Q=Boolean(W&&B),q=100*(this.props.progress??0),J=V[T.kToolbarButtonPopupSizes]??{},ee=this.props.isPopupResizable&&this.props.id?J[this.props.id]:void 0,te=[this.uuid,this.props.outsideClickIgnoreClass||""],se=V[T.kThemesPreferCustomButtons]?u||H:void 0,ne=se&&"none"!==se?g.Z.getToolbarButtonImage(se):null,ie=ne?.toLowerCase().endsWith(".svg"),ae=`${this.uuid}__${V[T.kThemesCurrentButtons]}`;let oe;if(l&&ne&&ie?oe=(0,h.jsx)(p,{url:ne,className:"button-icon override"},ae):l&&ne&&!ie?oe=(0,h.jsx)("img",{src:ne,className:"button-icon override","aria-hidden":"true"},ae):ne||d||a||!l?!d&&a?oe=(0,h.jsx)(o.ZP,{url:a,className:"button-icon favicon",loadType:$??(0,o.D0)(a)?"faviconFromCache":"page"}):d&&(oe=(0,h.jsx)("img",{src:d,className:"button-icon","aria-hidden":"true",onError:e=>{e.target.src=c||"/resources/ToolbarIconFallback.svg"}})):oe=l.startsWith("data:")?(0,h.jsx)("img",{src:l,className:"button-icon favicon","aria-hidden":"true"},ae):(0,h.jsx)("span",{className:"button-icon",dangerouslySetInnerHTML:{__html:l},"aria-hidden":"true"}),this.props.imageOnly&&oe)return(0,h.jsx)("div",{className:y()("button-toolbar",this.props.className),children:oe});const re=this.props.name?{...(0,r.uu)({draggable:M,onDragStart:n&&M?this.onDragStart:null,onDragEnd:M?R:null,onDragOver:Q?F:null,onDrop:Q?W:null}),onDragEnter:Q?this._onDragEnter:null,onDragLeave:Q?this._onDragLeave:null}:void 0,le=D?.trim()||O?.trim()||f,de=O?.trim()||le||f||"";let ce=null;return!n&&le&&(ce=this.state.keyShortcut?(0,C.Z)("$1 ($2)",[le,(0,k.$)(this.state.keyShortcut)]):de,j&&(ce+="\n"+j)),(0,h.jsxs)("div",{ref:this.nodeRef,id:this.props.id,className:y()("button-toolbar",this.props.className,{[this.uuid]:e,"button-menu":x,"button-disabled-preview":n&&M}),onContextMenu:n?this.getContextMenuHandler:null,onPointerEnter:n?U:null,style:v,onPointerDown:n&&M?L:null,title:n?le:null,...re,"aria-hidden":s??null,children:[(0,h.jsxs)("button",{name:H,ref:this.setButtonRef,disabled:n&&!M,draggable:M,onDragStart:!n&&M?this.onDragStart:null,tabIndex:0!==X?X:null,onKeyDown:this.keyDown,onPointerDown:this.pointerDown,onClick:A.ZP,onAuxClick:this.onAuxClick,autoFocus:G,onPointerEnter:U,onPointerLeave:this.pointerLeave,onDoubleClick:A.ZP,onContextMenu:this.getContextMenuHandler,onBlur:this.onBlur,onFocus:this.onFocus,onWheel:this.props.onWheel,style:b||null,title:ce,type:"button",id:t?t+"_button":void 0,...this.#In(le),className:y()("ToolbarButton-Button",i),children:[oe,f&&(0,h.jsx)("span",{className:"button-title",...this.#xn(),children:f}),Y&&this.renderWorkspaceAudioIcon(),!Y&&x&&(0,h.jsx)("span",{className:y()("button-toolbar-menu-indicator",{disabled:this.state.isMenuVisible||I}),role:I?void 0:"button","aria-haspopup":I?void 0:"menu","aria-expanded":I?void 0:this.state.isMenuVisible,"aria-label":I?void 0:(0,C.Z)("Open menu"),"aria-hidden":I,onPointerDown:I?void 0:this.onMenuIndicator,dangerouslySetInnerHTML:{__html:E.uIM}}),this.renderBadge(),this.renderPanelAudioIcon()]}),q>0&&q<100&&(0,h.jsx)("div",{className:"progress",role:"progressbar","aria-valuenow":q,children:(0,h.jsx)("div",{className:"loaded",style:{width:`${q}%`}})}),S&&e&&Z&&N&&this.buttonRef&&(0,h.jsx)(m.Z,{outsideClickIgnoreClass:te,hasLightArrow:this.props.hasLightArrow,hidePopup:this.hidePopup,className:this.props.className,buttonRef:this.buttonRef,width:this.props.popupWidth,popupClassName:this.props.popupClassName,popupPosition:N,isResizable:Boolean(this.props.isPopupResizable),height:ee,onResize:this.handleResize,labelledBy:P,label:_,forceFocus:this.props.forceFocus,children:e})]},this.uuid)}}const O=(0,l.Z)((0,r.ZP)(D),P)},98528:(e,t,s)=>{"use strict";s.d(t,{Z:()=>b});var n=s(67294),i=s(63377),a=s(5298),o=s(48521);function r({verticalPosition:e,onResize:t}){const s=(0,n.useRef)();return(0,n.useEffect)((()=>{const e=s.current;return e?.addEventListener("pointerdown",t,!0),()=>{e?.removeEventListener("pointerdown",t,!0)}}),[t]),(0,o.jsx)("div",{ref:s,className:`resize resize-${e}`})}var l=s(73935),d=s(94283),c=s(15489),h=s(94184),u=s.n(h),p=s(4027),g=s(52250),m=s(29697);function f(e,t,s,n,i){if(!i)return{};const a={};if(n){const e=s.top-i.top-3,o=i.bottom-s.bottom-3;"above"===t?e>=n.height?a.bottom=Math.round(i.height-s.top-i.top+3)+"px":o>=n.height?a.top=Math.round(s.bottom-i.top+3)+"px":a.top="3px":"below"===t?o>=n.height?a.top=Math.round(s.bottom-i.top+3)+"px":e>=n.height?a.bottom=Math.round(i.height-s.top-i.top+3)+"px":a.bottom="3px":o>=n.height/2&&e>=n.height/2?(a["--anchorPos"]="50%",a.top=Math.round(s.top-i.top-n.height/2+12)+"px"):o>=n.height?(a["--anchorPos"]="12px",a.top=Math.round(s.top-i.top)+"px"):e>=n.height?(a["--anchorPos"]=n.height-18+"px",a.bottom=Math.round(i.height-s.bottom+3)+"px"):(a["--anchorPos"]="12px",a.bottom="3px")}else"above"===t?a.bottom=Math.round(i.height-s.top-i.top+3)+"px":"below"===t?a.top=Math.round(s.bottom-i.top+3)+"px":(a.position||(a["--anchorPos"]="12px"),a.top=Math.round(s.top)+"px");return"string"==typeof a.top?a.bottom="unset":a.top="unset","left"===e?a.right="left"===t?Math.round(Math.max(i.right-s.left+3,3))+"px":Math.round(Math.max(i.right-s.right,3))+"px":a.left="right"===e?"right"===t?Math.round(s.right+3)+"px":Math.round(Math.max(s.left,3))+"px":Math.round(s.left+s.width/2)+"px","string"==typeof a.left?a.right="unset":a.left="unset",a}class v extends n.PureComponent{static contextType=d.Z;nodeRef=n.createRef();renderInPortal=!0;horizontalPosition="center";state={height:this.props.height??400,originalHeight:this.props.height??400,originalY:0,originalMouseY:0};constructor(e,t){super(e),this.portalContainer=t.document.getElementById("browser")}componentDidMount(){this.context.addEventListener("resize",this.onWindowResize,!1),this.intersectionObserver=new IntersectionObserver(this.onIntersect,{root:this.portalContainer}),this.intersectionObserver.observe(this.props.buttonRef),this.recalculatePosition(),this.props.isResizable&&(this.context.addEventListener("pointerup",this.stopResize,!0),this.context.addEventListener("pointercancel",this.stopResize,!0))}onIntersect=e=>{e[0].intersectionRatio<=0&&this.props.hidePopup()};componentDidUpdate(e){this.props.buttonRef!==e.buttonRef&&(this.intersectionObserver.disconnect(),this.intersectionObserver.observe(this.props.buttonRef)),this.recalculatePosition()}componentWillUnmount(){this.context.removeEventListener("resize",this.onWindowResize,!1),this.context.removeEventListener("pointerup",this.stopResize,!0),this.context.removeEventListener("pointercancel",this.stopResize,!0),this.intersectionObserver.disconnect()}recalculatePosition=()=>{const e=this.getNode();if(this.renderInPortal&&e){const t=f(this.horizontalPosition,this.props.popupPosition,this.props.buttonRef.getBoundingClientRect(),e.getBoundingClientRect(),this.context.document.body?.getBoundingClientRect());for(const s in t)e.style[s]!==t[s]&&e.style.setProperty(s,t[s])}};getNode(){return this.nodeRef.current}onWindowResize=()=>{this.forceUpdate()};getEdgeMargin=e=>{let t=Number.MAX_SAFE_INTEGER;const s=this.props.buttonRef.getBoundingClientRect();return"right"===e?t=s.left:"left"===e&&(t=this.context.innerWidth-s.right),t<=3?3-t:0};handleClickOutside=()=>{this.props.hidePopup()};keyDown=e=>{e.keyCode===a.Z.KEY_ESCAPE&&(this.props.hidePopup(),e.preventDefault(),e.stopPropagation())};resize=e=>{const{originalHeight:t,originalMouseY:s}=this.state,n="above"===this.props.popupPosition?t-(e.pageY-s):t+(e.pageY-s);e.buttons?n>=100&&this.context.requestAnimationFrame((()=>{this.setState({height:n})})):this.stopResize(e)};stopResize=e=>{e.target.releasePointerCapture(e.pointerId),p.Z.setWebviewPointerEvents(!0,this.context.document),e.target.removeEventListener("pointermove",this.resize,!0),this.props.height!==this.state.height&&this.props.onResize?.(this.state.height)};startResize=e=>{const t=this.getNode();t&&e.button===p.Z.kLeft&&(e.preventDefault(),this.setState({originalHeight:parseFloat(getComputedStyle(t).getPropertyValue("height").replace("px","")),originalY:t.getBoundingClientRect().top,originalMouseY:e.pageY}),e.target.setPointerCapture(event.pointerId),p.Z.setWebviewPointerEvents(!1,this.context.document),e.target.addEventListener("pointermove",this.resize,!0))};render(){const e=c.ZP.getVisibleUI(this.context.vivaldiWindowId).addressBar,t=Boolean(this.props.buttonRef.closest(".toolbar-mainbar"));this.renderInPortal=e||!t;const{popupClassName:s,hasLightArrow:n,popupPosition:a}=this.props,d=this.props.buttonRef.getBoundingClientRect(),h=this.props.width||200,p=this.context.document.body?.getBoundingClientRect();this.horizontalPosition=function(e,t,s,n){if(!s)return"center";const i=t.left-s.left,a=s.right-t.right,o=e/2<i+t.width/2-3,r=e/2<a+t.width/2-3,l=e-t.width<a,d=e-t.width<i;if(o&&r){if("left"===n&&l)return"right";if("right"===n&&d)return"left"}else{if(d)return"left";if(l)return"right"}return"center"}(h,d,p,this.props.popupPosition);let g={"--popupWidth":Math.round(h)+"px","--buttonWidth":Math.round(d.width)+"px","--buttonHeight":Math.round(d.height)+"px","--edgeMargin":Math.round(this.getEdgeMargin(this.horizontalPosition))+"px"};if(this.props.isResizable&&(g["--popupHeight"]=Math.round(this.state.height)+"px"),this.renderInPortal){const e=this.getNode()?.getBoundingClientRect();g={...g,...f(this.horizontalPosition,a,d,e,p)}}const v=this.props.labelledBy?{"aria-labelledby":this.props.labelledBy}:{"aria-label":this.props.label},b=(0,o.jsx)(m.Z,{classNames:"button-popup",role:"dialog",...v,in:!0,onEnter:this.recalculatePosition,appear:!0,mountOnEnter:!0,unmountOnExit:!0,timeout:{enter:300,exit:150},nodeRef:this.nodeRef,children:(0,o.jsxs)(i.Z,{forwardRef:this.nodeRef,focusName:"focus-popup-area",forceTrap:this.props.forceFocus??!0,onKeyDown:this.keyDown,style:g,className:u()(s,"button-popup",`button-popup-${this.horizontalPosition}`,`button-popup-pos-${a}`,"button-popup-arrow-"+(n?"light":"dark")),children:[this.props.children,this.props.isResizable&&(0,o.jsx)(r,{verticalPosition:a,onResize:this.startResize})]})});return this.portalContainer&&this.renderInPortal?l.createPortal(b,this.portalContainer):b}}const b=(0,g.Z)(v)},86461:(e,t,s)=>{"use strict";s.d(t,{Gt:()=>E,LM:()=>P,Np:()=>M,PK:()=>_,VJ:()=>N,ZP:()=>j,_h:()=>D,aX:()=>S,e3:()=>g,qS:()=>T,wY:()=>Z,ww:()=>A,yp:()=>O});var n=s(96951),i=s(15285),a=s(34197),o=s(68247),r=s(29087),l=s(70864),d=s(15489),c=s(56371),h=s(89175);const u=[h.kToolbarsMail,h.kToolbarsMailComposer,h.kToolbarsMailMessage,h.kToolbarsNavigation,h.kToolbarsPanel,h.kToolbarsStatus],p=["PanelWeb","Settings"],g=["PanelChat"],m=[{id:"Spacer",label:(0,c.Z)("Space")},{id:"FlexibleSpacer",label:(0,c.Z)("Flexible Space")},{id:"PanelWidthSpacer",label:(0,c.Z)("Panel Width Space")},{id:"Divider",label:(0,c.Z)("Separator")}],f={category:"navigation",label:(0,c.Z)("title","Address Bar"),pref:h.kToolbarsNavigation,buttons:[{id:"PanelToggle",label:(0,c.Z)("Panel Toggle")},{id:"Back",label:(0,c.Z)("navigation","Back")},{id:"Forward",label:(0,c.Z)("navigation","Forward")},{id:"Rewind",label:(0,c.Z)("Rewind")},{id:"FastForward",label:(0,c.Z)("Fast Forward")},{id:"Reload",label:(0,c.Z)("Reload")},{id:"Stop",label:(0,c.Z)("verb","Stop")},{id:"Home",label:(0,c.Z)("Home")},{id:"AddressField",label:(0,c.Z)("Address Field")},{id:"SearchField",label:(0,c.Z)("Search Field")},{id:"DownloadButton",label:(0,c.Z)("Downloads")},{id:"ReadingList",label:(0,c.Z)("Reading List")},{id:"AccountButton",label:(0,c.Z)("Account")},{id:"UpdateButton",label:(0,c.Z)("Update Status")},{id:"Extensions",label:(0,c.Z)("Extensions")},{id:"WorkspaceButton",label:(0,c.Z)("Workspaces")},{id:"VPNButton",label:(0,c.Z)("VPN")},...m]},v={category:"status",label:(0,c.Z)("title","Status Bar"),pref:h.kToolbarsStatus,buttons:[{id:"BreakMode",label:(0,c.Z)("Break Mode")},{id:"MailStatus",label:(0,c.Z)("Mail Status")},{id:"CalendarStatus",label:(0,c.Z)("Calendar Status")},{id:"SyncStatus",label:(0,c.Z)("Sync Status")},{id:"StatusInfo",label:(0,c.Z)("Status Info")},{id:"VersionInfo",label:(0,c.Z)("Version Info")},{id:"CaptureImages",label:(0,c.Z)("Capture Images")},{id:"TilingToggle",label:(0,c.Z)("Page Tiling")},{id:"ImagesToggle",label:(0,c.Z)("Toggle Images")},{id:"PageActions",label:(0,c.Z)("Page Actions")},{id:"Zoom",label:(0,c.Z)("Page Zoom")},{id:"Clock",label:(0,c.Z)("Clock")},{id:"Settings",label:(0,c.Z)("Settings")},{id:"ShareVivaldi",label:(0,c.Z)("Share Vivaldi")},...m]},b={category:"panel",label:(0,c.Z)("toolbar","Panel"),pref:h.kToolbarsPanel,buttons:[{id:"PanelToggle",label:(0,c.Z)("Panel Toggle")},{id:"PanelBookmarks",label:(0,c.Z)("Bookmarks")},{id:"PanelReadingList",label:(0,c.Z)("Reading List")},{id:"PanelDownloads",label:(0,c.Z)("Downloads")},{id:"PanelHistory",label:(0,c.Z)("History")},{id:"PanelNotes",label:(0,c.Z)("Notes")},{id:"PanelWindow",label:(0,c.Z)("panel","Windows and Tabs")},{id:"PanelTranslate",label:(0,c.Z)("panel","Translate")},{id:"PanelMail",label:(0,c.Z)("Mail")},{id:"PanelCalendar",label:(0,c.Z)("Calendar")},{id:"PanelTasks",label:(0,c.Z)("Tasks")},{id:"PanelFeeds",label:(0,c.Z)("Feeds")},{id:"PanelContacts",label:(0,c.Z)("Contacts")},{id:"PanelChat",label:(0,c.Z)("Chat")},{id:"PanelSession",label:(0,c.Z)("Sessions")},{id:"PanelWeb",label:(0,c.Z)("Add Web Panel")},...m]},C=[{id:"MailBack",label:(0,c.Z)("navigation","Back")},{id:"MailForward",label:(0,c.Z)("navigation","Forward")},{id:"MailReload",label:(0,c.Z)("Reload")}],w=[{id:"MailMsgReply",label:(0,c.Z)("Reply")},{id:"MailMsgReplyToAll",label:(0,c.Z)("Reply to All")},{id:"MailMsgForward",label:(0,c.Z)("mail","Forward")}],y={id:"MailMsgStatusRead",label:(0,c.Z)("Mark Unread")},x={id:"MailMsgStatusUnread",label:(0,c.Z)("Mark Read")},I=[y,x,{id:"MailMsgFlag",label:(0,c.Z)("Flag")},{id:"MailMsgLabel",label:(0,c.Z)("Label")},{id:"MailMsgMove",label:(0,c.Z)("Move to Folder")},{id:"MailMsgSpam",label:(0,c.Z)("Mark Message as Spam")},{id:"MailMsgSpamRestore",label:(0,c.Z)("Not Spam")},{id:"MailMsgArchive",label:(0,c.Z)("Move to Archive")},{id:"MailMsgArchiveRestore",label:(0,c.Z)("Restore from Archive")},{id:"MailMsgTrash",label:(0,c.Z)("Move to Trash")},{id:"MailMsgTrashRestore",label:(0,c.Z)("Undelete")},{id:"MailViewQuickResponse",label:(0,c.Z)("Toggle Quick Response")},{id:"MailRenderingMethod",label:(0,c.Z)("Rendering Method")},{id:"MailRenderingMethodText",label:(0,c.Z)("Rendering Method (Plain Text)")},{id:"MailViewThreading",label:(0,c.Z)("Threads")},{id:"MailViewThreadingFlat",label:(0,c.Z)("Threads (Disabled)")},{id:"MailViewLayout",label:(0,c.Z)("Toggle Layout")}],A=[{...f},{...v},{...b},{...{category:"mail",label:(0,c.Z)("Mail Bar"),pref:h.kToolbarsMail,buttons:[...C,{id:"MailSearch",label:(0,c.Z)("Mail Search")},{id:"MailCompose",label:(0,c.Z)("Compose New Mail")},{id:"MailUndo",label:(0,c.Z)("Undo The Latest Mail Actions")},{id:"MailMsgEdit",label:(0,c.Z)("mail","Edit")},...w,...I,...m]}},{...{category:"mail_composer",label:(0,c.Z)("Mail Composer Bar"),pref:h.kToolbarsMailComposer,buttons:[...C,{id:"MailMsgSend",label:(0,c.Z)("Send")},{id:"MailMsgAttach",label:(0,c.Z)("Add Attachment")},{id:"MailMsgShowHeaders",label:(0,c.Z)("Show Headers")},{id:"MailMsgDiscard",label:(0,c.Z)("Discard Draft")},y,x,...m]}},{...{category:"mail_message",label:(0,c.Z)("Mail Message Bar"),pref:h.kToolbarsMailMessage,buttons:[...C,...w,...I,...m]}}],S=["Spacer","FlexibleSpacer","PanelWidthSpacer","Divider"];function Z(e){let t="";for(const s of A){const n=s.buttons.find((t=>t.id===e));if(n){t=n.label;break}}return t}function T(e){let t="";for(const s of A)if(s.pref===e){t=s.label;break}return t}function E(e,t,s){const n=s.filter((e=>!g.includes(e)));return t?n:d.ZP.isGuest()?n.filter((e=>!p.includes(e))):n}function k(){const e=r.Z.get(h.kToolbarsNavigation),t=r.Z.get(h.kToolbarsPanel),s=r.Z.get(h.kToolbarsStatus),n=r.Z.get(h.kToolbarsMail).concat(r.Z.get(h.kToolbarsMailComposer)).concat(r.Z.get(h.kToolbarsMailMessage)),i=e.concat(t).concat(s).concat(n);return{navigationComponents:e,panelComponents:t,statusComponents:s,mailComponents:n,allToolbars:i}}function N(e){const{allToolbars:t}=k();return t.includes(e)}function _(e,t){const{navigationComponents:s,panelComponents:a,statusComponents:o,mailComponents:r,allToolbars:l}=k();if(!l.includes(e))return!1;const{visibleUI:c}=d.ZP.getWindowState(t)||{visibleUI:{}},{isMailPage:h}=n.ZP.getActivePage(t)||{isMailPage:!1},u=Boolean(c.addressBar),p="on"===c.statusBar,g=i.ZP.getIsBarVisible(t);return s.includes(e)&&u&&!h||a.includes(e)&&g||o.includes(e)&&p||r.includes(e)&&u&&h}function P(e,t){return[h.kToolbarsNavigation,h.kToolbarsStatus,h.kToolbarsPanel,h.kToolbarsMail].some((s=>t!==s&&r.Z.get(s).includes(e)))}function M(e,t){const s=[...r.Z.get(t)].filter((e=>a.ZP.isWebPanel(e))),n=[...r.Z.getDefault(t)].filter((e=>a.ZP.isWebPanel(e)));n.forEach((t=>{if(!s.find((e=>e===t))){const s=i.ZP.getWebPanels(e).find((e=>t.endsWith(e.id)));s||l.Z.restoreById(e,t,!1)}})),s.forEach((e=>{n.find((t=>t===e))||l.Z.removeById(e,t)}))}const D=(()=>{const e=new Set,t=(t,s,n)=>{e.forEach((e=>e(t,s,n)))};return{addListener(s){0===e.size&&r.Z.addListener(u,t),e.add(s)},removeListener(s){e.delete(s),0===e.size&&r.Z.removeListener(u,t)}}})();function O(e){let t=0;return u.forEach((s=>{const n=r.Z.get(s).slice();n.includes(e)&&(o.Z.set(s,n.filter((t=>t!==e))),t+=1)})),t}const j={isComponentInToolbar:N,isComponentVisible:_,isComponentPresentElsewhere:P}},58228:(e,t,s)=>{"use strict";s.d(t,{l:()=>r});var n=s(50522),i=s(68247),a=s(29087),o=s(89175);function r(e,t){if(!a.Z.get(o.kOauthRefreshTokens)[e])return;if("calendar"===t&&a.Z.get(o.kMailAccounts).some((t=>t.MAIL_EMAIL===e)))return;if("mail"===t&&n.Z.getAccounts().some((t=>t.username===e)))return;const s={...a.Z.get(o.kOauthRefreshTokens)};delete s[e.toLowerCase()],i.Z.set(o.kOauthRefreshTokens,s)}},10373:(e,t,s)=>{"use strict";function n(e,t,s,n){return e.substring(0,s)+t+e.substring(n)}s.d(t,{C:()=>o,i:()=>n});const i=/^(.*?:\/\/\/*)(.*)$/,a=/(.*?)\/*([#?].*)/;function o(e){if(e.startsWith("data:"))return{schema:"data:",host:"",postfix:"",path:e.substring("data:".length)};let t;try{t=new URL(e)}catch(e){return{schema:"",host:"",path:"",postfix:""}}const s=e.match(i),n=s&&s[1]||"",o=e.match(a),r=o&&o[2]||"",l=t.hostname+(t.port?`:${t.port}`:"");let d;try{d=decodeURI(t.pathname)}catch(e){d=t.pathname}return"vivaldi://"===n?{schema:n,host:l,path:d.startsWith("//")?d.substring(2,d.length-1):d,postfix:r}:{schema:n,host:l,path:d,postfix:r}}},55432:(e,t,s)=>{"use strict";s.d(t,{D7:()=>y,Ht:()=>g,K5:()=>v,PH:()=>p,b1:()=>w,dC:()=>b,eE:()=>m,i9:()=>c,in:()=>C,q:()=>u,rx:()=>f});var n=s(56371),i=s(7064),a=s(44850);let o,r=!1,l="",d=-1;function c(){i.Z.omniboxPrivate.onOmniboxResultChanged.addListener(h)}function h(e){e.inputText===l&&(o?.(e),e.done&&(o=void 0))}function u(){r=!0,o=void 0}function p({query:e,preventInlineAutocomplete:t,fromSearchField:s,searchEngineGUID:n,focusType:a,pageClassification:c,windowId:h},u){const p=e.trimStart();l=p;const g=r||h!==d;r=!1,d=h,o=u,i.Z.omniboxPrivate.startOmnibox({query:p,preventInlineAutocomplete:t,clearStateBeforeSearching:g,fromSearchField:s,searchEngineGUID:n,focusType:a,pageClassification:c})}function g(e){switch(e.category){case"search":return(0,n.Z)("verb","Search");case"history":return(0,n.Z)("History");case"search-suggestion":return(0,n.Z)("Search Suggestion");case"direct-match":return(0,n.Z)("Direct Match");case"bookmark":return(0,n.Z)("Bookmark");case"nickname":return(0,n.Z)("Nickname");case"open-tab":return(0,n.Z)("Open Tab");case"top-sites":return(0,n.Z)("Top Sites");case"clipboard":return(0,n.Z)("Clipboard");case"calculator":return(0,n.Z)("Calculator");default:return""}}function m(e){return"direct-match"===e.category}function f(e){return"history"===e.category}function v(e){return"search"===e.category}function b(e){return"search-suggestion"===e.category}function C(e){return"calculator"===e.category}function w(e){return"recent-typed-history"===e.category}function y(e){return(0,a.$0)(e)?"NTP":(0,a.pD)(e)?"BLANK":"OTHER"}},92571:(e,t,s)=>{"use strict";s.d(t,{Z:()=>d});var n=s(23157),i=s(56371),a=s(46884),o=s(67294),r=s(48521);const l={clearIndicator:()=>({}),container:()=>({}),control:()=>({}),dropdownIndicator:()=>({}),group:()=>({}),groupHeading:()=>({}),indicatorsContainer:()=>({}),indicatorSeparator:()=>({}),input:()=>({}),loadingIndicator:()=>({}),loadingMessage:()=>({}),menu:()=>({}),menuList:()=>({}),menuPortal:()=>({}),multiValue:()=>({}),multiValueLabel:()=>({}),multiValueRemove:()=>({}),noOptionsMessage:()=>({}),option:()=>({}),placeholder:()=>({}),singleValue:()=>({}),valueContainer:()=>({})};const d=function(e){const{disabled:t,tabIndex:s,commands:d,blurInputOnSelect:c,customStyles:h,selectedCommand:u,...p}=e,g=h?{...l,...h}:l,m=()=>{f.current?.blur()},f=(0,o.useRef)(null),v=(0,o.useRef)(null),b=(0,o.useCallback)((()=>v.current),[]),C=(0,o.useCallback)((()=>m),[]);return(0,a.Z)(b,C),(0,r.jsx)("div",{ref:v,children:(0,r.jsx)(n.ZP,{ref:f,className:"VivaldiSelector",classNamePrefix:"Inner",isDisabled:t??!1,tabIndex:s?.toString(),value:u,onChange:t=>{return s=t,void e.setSelectedItem(s);var s},styles:g,blurInputOnSelect:c??!0,options:d,loadingMessage:()=>(0,i.Z)("Loading..."),noOptionsMessage:()=>(0,i.Z)("No options"),"aria-labelledby":"arialabel",...p})})}},17434:(e,t,s)=>{"use strict";s.d(t,{Z:()=>l});var n=s(92292),i=s(34197),a=s(37441);let o=[];const r={isPanel:function(e){try{if(!e.vivExtData)return!1;if(JSON.parse(e.vivExtData).panelId)return!0}catch(e){}return!1},offerUpdatedTab:function(e){return!!r.isPanel(e)},offerNewTab:function(e){try{if(!e.vivExtData)return!1;const t=JSON.parse(e.vivExtData);if(!t.panelId)return!1;const s=parseInt(e.id);return(0,a.V)(s,{panelId:t.panelId},!0),r.put(t.panelId,s),!0}catch(e){}return!1},find:function(e,t){return o.find((s=>s.panelId===(t?e+"_"+String(t):e)))},findTabId:function(e){return o.find((t=>t.tabId===e))},resolve:function(e){const t=r.find(e);if(t&&-1!==t.tabId)return t.tabId},resolveWebWidget:function(e,t){const s=function(e,t){return i.zs+String(e)+"_"+t}(e,t),n=r.resolve(s);return n||s},put:function(e,t=-1){let s=r.find(e);return s?(s.tabId=t,s):(s={tabId:t,panelId:e},o.push(s),s)},has:function(e){return Boolean(r.find(e))},_erase:function(e){const t=o.length;return o=o.filter((t=>t.panelId!==e)),t!==o.length},eraseTabId:function(e,t){if(void 0!==t){const t=r.findTabId(e);return t?(r._erase(t.panelId),!0):(console.error("Erase unregistered panel: ",e),!0)}return!!o.find((t=>t.tabId===e))},findAssociatedWebWidgets:e=>o.filter((t=>function(e){const[t,s]=e.split("_");return t===i.dB?Number(s):void 0}(t.panelId)===e)),closeAssociatedTabsByWidget(e){const t=o.filter((t=>function(e){const[t,,s]=e.split("_");return t===i.dB?s:void 0}(t.panelId)===e));r._closePanelTabs(t.map((e=>e.tabId)))},closeAssociatedTabs(e){const t=r.findAssociatedWebWidgets(e).map((e=>e.tabId));r._closePanelTabs(t)},_closePanelTabs(e){0!==e.length&&n.Z.tabs.remove(e)}},l=r},70864:(e,t,s)=>{"use strict";s.d(t,{Z:()=>y});var n=s(21788),i=s(59322),a=s(18350),o=s(17434),r=s(34197),l=s(14481),d=s(68247),c=s(29087),h=s(63153),u=s(15489),p=s(26591),g=s(7064),m=s(86461),f=s(36436),v=s(89175);const b="webpanel",C="about:blank",w={_createWebPanelItem:function(e){let t=e.id;return t&&0!==t.length||(t=w.getWebPanelId()),{activeUrl:e.activeUrl,faviconUrl:p.Z,faviconUrlValid:!0,id:t,mobileMode:!0,origin:"user",resizable:!1,title:e.title??"",url:e.url,width:-1,zoom:1,tabId:void 0}},findPanelByTabId:function(e){const t=o.Z.findTabId(e);if(t)return t.panelId},replaceTabId:function(e,t){const s=this.findPanelByTabId(t);s?o.Z.put(s,e):console.log("No panel found for tabId:",t)},makePanelId:(e,t)=>e+"_"+t,restoreById:function(e,t,s){const n=c.Z.get(v.kPanelsWebRemovedElements).findIndex((e=>e.id===t));if(-1!==n)this.recoverWebPanel(e,n,s);else{const e=c.Z.getDefault(v.kPanelsWebElements).find((e=>e.id===t));e&&w.addPanels(-1,[e],-1,s)}},isExtPanel:e=>!!e&&e.startsWith(r.j9),getWebPanelId:()=>r.J$+crypto.randomUUID(),getExtPanelIdFromExtensionId:e=>r.j9+e,getExtPanelId:function(e){if(e.sidePanel)return w.getExtPanelIdFromExtensionId(e.id)},getExtIdFromPanel:function(e){return e.replace(r.j9,"")},removeByExtension:function(e,t){const s=w.getExtPanelId(t);if(!s)return;w.removeById(s,v.kToolbarsPanel);const n=c.Z.get(v.kToolbarsPanel).slice();d.Z.set(v.kToolbarsPanel,n.filter((e=>e!==s)))},hasPanelUrl:function(e){if(!e)return!1;return c.Z.get(v.kPanelsWebElements).find((t=>{const s=new URL(t.url),n=new URL(e);return(0,f.uu)(s.toString(),n.toString())}))},hasPanelId:function(e){return o.Z.has(e)},installExtensionById:async function(e,t){const s=(await g.Z.extensionActionUtils.getToolbarExtensions()).find((e=>e.id===t.replace(r.j9,"")));s&&this.addByExtension(e,s)},addByExtension:function(e,t){const s=w.getExtPanelId(t);if(!s)return;if(this.hasPanelId(s))return;const n=t.sidePanel;if(!n)return;const i={id:s,url:n.url??"",activeUrl:n.activeUrl??C,title:t.badgeTooltip};w.addBySpec(e,i)},updateByExtension:function(e,t){const s=w.getExtPanelIdFromExtensionId(e);t.enabled?t.resourceUrl&&w.setActiveUrl(s,t.resourceUrl,0):w.setNoContent(s,0)},addBySpec:function(e,t){const s=this._createWebPanelItem(t);w.addPanels(e,[s],t.index??-1,t.showButton??!0)},addByUrl:function(e,t,s){w.addByUrls(e,[t],-1,s)},addByUrls:function(e,t,s,n){const i=t.map((e=>this._createWebPanelItem({url:e,activeUrl:e})));w.addPanels(e,i,s,n)},addPanels:function(e,t,s,n){const i=c.Z.get(v.kPanelsWebElements).slice();if(t.forEach((e=>{i.find((t=>t.id===e.id))?console.warn("Panel data already installed",e.id):i.push(e)})),d.Z.set(v.kPanelsWebElements,i),n){s<0&&(s=r.ZP.getNewIndex());const n=c.Z.get(v.kToolbarsPanel).slice();let i=null;t.forEach((e=>{n.find((t=>t===e.id))||(s>=n.length?n.push(e.id):n.splice(s,0,e.id)),i||(i=e.id)})),d.Z.set(v.kToolbarsPanel,n),i&&(h.Z.setPanelHasBeenVisible(e,i,!0),a.Z.setAddedButton(e,v.kToolbarsPanel,i,!0))}},removeById:function(e,t){if((0,m.LM)(e,t))return;const s=c.Z.get(v.kPanelsWebElements);if(0===s.length)return;const n=s.filter((t=>t.id===e))[0];if(!n)return;l.Z.destroyPeriodicAlarm({ids:[e],from:"panel"});const i=s.filter((t=>t.id!==e));d.Z.set(v.kPanelsWebElements,i);const a=c.Z.get(v.kPanelsWebRemovedElements).slice();if(a.push(n),d.Z.set(v.kPanelsWebRemovedElements,a),"bundle"===n.origin){const t=c.Z.get(v.kPanelsWebModifiedElements).slice();t.includes(e)||(t.push(e),d.Z.set(v.kPanelsWebModifiedElements,t))}},updatePanelData:function(e,t,s){const n=[...c.Z.get(v.kPanelsWebElements)],i=n?.findIndex((t=>t.id===e));-1!==i&&(s&&u.ZP.isIncognito(s)||0!==s&&(n[i]={...n[i],...t},d.Z.set(v.kPanelsWebElements,n)))},setZoom:(e,t)=>w.updatePanelData(e,{zoom:t}),setPeriodicReload:(e,t)=>w.updatePanelData(e,{interval:t}),setTitle:(e,t,s)=>{w.updatePanelData(e,{title:t},s)},setUrl:(e,t)=>{w.updatePanelData(e,{url:t})},setMobileMode:(e,t,s)=>{w.updatePanelData(e,{mobileMode:t},s)},setActiveUrl:(e,t,s)=>{w.updatePanelData(e,{activeUrl:t},s)},setNoContent:(e,t)=>{w.setActiveUrl(e,C,t)},setFaviconUrl:(e,t,s)=>{w.updatePanelData(e,{faviconUrl:t,faviconUrlValid:!0},s)},recoverWebPanel:function(e,t,s){const n=c.Z.get(v.kPanelsWebRemovedElements);if(n.length>0&&t<n.length){const i=n[t];if("bundle"===i.origin){const e=c.Z.get(v.kPanelsWebModifiedElements).slice(),t=e.findIndex((e=>e===i.id));-1!==t&&(e.splice(t,1),d.Z.set(v.kPanelsWebModifiedElements,e))}w.addPanels(e,[i],-1,s);const a=n.slice();a.splice(t,1),d.Z.set(v.kPanelsWebRemovedElements,a)}},emptyTrash:function(){d.Z.set(v.kPanelsWebRemovedList,[]),d.Z.set(v.kPanelsWebRemovedItems,[]),d.Z.set(v.kPanelsWebRemovedElements,[])},copyWebPanelAdress:function(e){const t=this.getUrlById(e);t.length>0&&n.Z.copyUrlToClipboard(t)},getUrlById:function(e){const t=c.Z.get(v.kPanelsWebElements).filter((t=>t.id===e)).map((e=>e.activeUrl||e.url));return t.length>0?t[0]:""},isIncognitoPanelSafeUrl(e){try{const t=new URL(e).protocol.replace(":","");if("http"===t||"https"===t)return!0}catch(e){return!0}return!1},isSafeInIncognitoWindow:function(e){let t=!0;return c.Z.get(v.kPanelsWebElements).filter((t=>t.id===e)).forEach((e=>{w.isIncognitoPanelSafeUrl(e.url)||(t=!1)})),t},openInTab:function(e,t,s,n){const a=this.getUrlById(t);a.length>0&&i.ZP.openURL(e,a,{inCurrent:s,inBackground:n})},openInNewWindow:function(e,t,s){const n=this.getUrlById(t);n.length>0&&i.ZP.openURL(e,n,{inNewWindow:!0,incognito:s})},getIndexByShortcut:function(e){const t=b.length,s=e.substr(0,t),n=e.substr(t).trim();return s===b&&n>="1"&&n<="9"?parseInt(n):-1},setUIContent:function(e){const t={...c.Z.get(v.kPanelsWebToolbar)};t.showToolbar=e.showToolbar,t.allControls=e.allControls??t.allControls,t.zoomControls=e.zoomControls??t.zoomControls,t.deviceControl=e.deviceControl??t.deviceControl,d.Z.set(v.kPanelsWebToolbar,t)},showSidePanel(e,t){const s=w.getExtPanelIdFromExtensionId(e);(0,m.VJ)(s)?a.Z.toggleContent(t,s):w.installExtensionById(t,e)}},y=w},37646:(e,t,s)=>{"use strict";s.d(t,{Z:()=>w});var n=s(67294),i=s(30626),a=s(81009),o=s(5298),r=s(98102),l=s(94283),d=s(56371),c=s(94184),h=s.n(c),u=s(47380),p=s(89175),g=s(60679),m=s(86088),f=s(22303),v=s(48521);const b=[p.kAppearanceRangeButtons,p.kKeyboardTabToAll];class C extends n.PureComponent{static contextType=l.Z;refEditZoom=n.createRef();state={editing:!1};static defaultProps={disabled:!1};setZoomLevel=(e,t,s)=>{this.props.onZoomUpdated(e,s);const n=this.refEditZoom.current,i=Math.round(100*e);n&&!isNaN(e)&&(n.value=i.toString())};resetZoom=()=>{this.setZoomLevel(this.props.defaultZoomLevel),f.Z.dispatchZoomUI(this.props.defaultZoomLevel)};updateZoomLevel=()=>{const e=parseFloat(this.props.zoom);this.setZoomLevel(e,this.props.delay)};zoomInStep=()=>{this.setZoomLevel(parseFloat((this.props.zoom+this.props.step).toFixed(2)))};zoomOutStep=()=>{this.setZoomLevel(parseFloat((this.props.zoom-this.props.step).toFixed(2)))};zoomHalf=()=>{this.setZoomLevel(parseFloat((this.props.zoom/2).toFixed(2)))};zoomDouble=()=>{this.setZoomLevel(parseFloat((2*this.props.zoom).toFixed(2)))};handleKeyDown=e=>{e.keyCode===o.Z.KEY_LEFT?(this.zoomOutStep(),e.preventDefault()):e.keyCode===o.Z.KEY_RIGHT&&(this.zoomInStep(),e.preventDefault())};rangeChanged=e=>{const{value:t}=e.target;this.setZoomLevel(parseFloat(t),this.state.editing,this.props.delay)};_onEditKeyDown=e=>{const{step:t,zoom:s}=this.props;if(e.keyCode===o.Z.KEY_ESCAPE)this._onEditZoomBlur();else if(e.keyCode===o.Z.KEY_SUBTRACT)this.setZoomLevel(s-t,!0),e.preventDefault();else if(e.keyCode===o.Z.KEY_ADD)this.setZoomLevel(s+t,!0),e.preventDefault();else if(e.keyCode===o.Z.KEY_RETURN){let e=parseFloat(this.refEditZoom.current?.value)/100;0!==e&&e===parseFloat(e)||(e=1),this.setZoomLevel(e)}};toggleEditZoom=()=>{this.props.disabled||this.setState((e=>({editing:!e.editing})),(()=>this.refEditZoom.current?.select()))};_onEditZoomBlur=()=>{this._activeElement&&(this._activeElement.focus(),delete this._activeElement),this.setState({editing:!1})};onMouseEnter=()=>{!1!==this.props.scrolling&&this.context.document.addEventListener("wheel",this.onMouseWheel,!0)};onMouseLeave=()=>{!1!==this.props.scrolling&&this.context.document.removeEventListener("wheel",this.onMouseWheel,!0)};onMouseDown=e=>{(0,g.W$)(e)?e.preventDefault():this._activeElement=this.context.document.activeElement};onMouseUp=()=>{this.props.delay&&this.updateZoomLevel(),this._activeElement&&(this._activeElement.focus(),delete this._activeElement)};onMouseWheel=e=>{e.deltaX<0?this.zoomOutStep():e.deltaX>0?this.zoomInStep():e.deltaY>0?this.zoomOutStep():e.deltaY<0&&this.zoomInStep()};incrementCount=()=>{this.setZoomLevel(this.props.zoom+this.props.step)};decrementCount=()=>{this.setZoomLevel(this.props.zoom-this.props.step)};onPageZoomUpdated=e=>{const t=i.Z.getActiveWebView(this.context.vivaldiWindowId);t&&t.setZoom(e)};showCustomizeMenu=(e,t)=>{const s=this.props.customizeMenu?.("Zoom");s&&(e.persist(),e.preventDefault(),e.stopPropagation(),(0,u.Z)(this.context,s)(e))};renderSubmit=()=>{const e=this.props.disabled||(this.props.defaultZoomLevel?this.props.defaultZoomLevel===this.props.zoom:1===this.props.zoom);return(0,v.jsx)(r.ZP,{onClick:this.resetZoom,tooltip:(0,d.Z)("Reset Zoom"),disabled:e,title:(0,d.Z)("Reset"),tabIndex:this.props.inFooter?this.props.prefValues[p.kKeyboardTabToAll]:0})};render(){const{customizeMenu:e,zoom:t}=this.props,s=this.props.prefValues[p.kAppearanceRangeButtons],n=this.state.editing?(0,v.jsx)("input",{className:"zoom-percent",type:"number",ref:this.refEditZoom,defaultValue:Math.round(100*t),onKeyDown:this._onEditKeyDown,onBlur:this._onEditZoomBlur,step:"1",disabled:this.props.disabled}):(0,v.jsx)("span",{className:h()({"zoom-percent":!0,disabled:this.props.disabled}),onMouseDown:this.onMouseDown,onClick:this.toggleEditZoom,children:`${Math.round(100*t)} %`}),i=this.props.inFooter?this.props.prefValues[p.kKeyboardTabToAll]:0;return(0,v.jsxs)("div",{onContextMenu:e?this.showCustomizeMenu:null,className:"page-zoom-controls",children:[this.props.inFooter&&this.renderSubmit(),!s&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("input",{type:"range",className:"page-zoom-slider",min:this.props.minLevel,max:this.props.maxLevel,step:this.props.step,onChange:this.rangeChanged,onKeyDown:this.handleKeyDown,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onMouseDown:-1===i?this.onMouseDown:null,onMouseUp:this.onMouseUp,onTouchEnd:this.onMouseUp,value:t,disabled:this.props.disabled,tabIndex:i}),n]}),s&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(r.ZP,{onClick:this.decrementCount,tooltip:(0,d.Z)("Zoom Out"),disabled:this.props.disabled,image:m.M2k.medium,tabIndex:i}),n,(0,v.jsx)(r.ZP,{onClick:this.incrementCount,tooltip:(0,d.Z)("Zoom In"),disabled:this.props.disabled,image:m.md4.medium,tabIndex:i})]}),!this.props.inFooter&&this.renderSubmit()]})}}const w=(0,a.Z)(C,b)},71828:(e,t,s)=>{"use strict";s.d(t,{OK:()=>a,VH:()=>u,Wp:()=>o,XF:()=>l,XZ:()=>h,Zh:()=>c,an:()=>n,bI:()=>i,m6:()=>m,oJ:()=>p,qt:()=>d,rM:()=>r,s5:()=>g});const n=1,i=.5,a=2,o=.05,r=1,l=.2,d=5,c=.05,h=1,u=.5,p=2,g=.05,m=1},93196:(e,t,s)=>{"use strict";s.d(t,{FD:()=>Ae,CN:()=>De,xU:()=>Se,os:()=>Te});var n=s(54614),i=s(43630),a=s(39005),o=s(30626),r=s(15590),l=s(2934),d=s(12442),c=s(15800),h=s(84675),u=s(21788),p=s(57082),g=s(87210),m=s(5198),f=s(99827),v=s(2431),b=s(46382),C=s(21838),w=s(62882),y=s(59322),x=s(96951),I=s(18350),A=s(15285),S=s(14481),Z=s(24367),T=s(68247),E=s(29087),k=s(92413),N=s(40893),_=s(43656),P=s(33638);const M=new class{switchTabBackBySetting(e,t){P.Z.dispatch({actionType:"TAB_SWITCH_BACK_SETTING",winId:e,event:t})}switchTabForwardBySetting(e,t){P.Z.dispatch({actionType:"TAB_SWITCH_FORWARD_SETTING",winId:e,event:t})}disbandTileGroup(e){P.Z.dispatch({actionType:"DISBAND_TILE_GROUP",winId:e})}stackCreate(e){P.Z.dispatch({actionType:"TAB_STACK_CREATE",winId:e})}stackDissolve(e){P.Z.dispatch({actionType:"TAB_STACK_DISSOLVE",winId:e})}stackRemove(e){P.Z.dispatch({actionType:"TAB_STACK_REMOVE",winId:e})}stackTileGrid(e){P.Z.dispatch({actionType:"TAB_STACK_TILE_GRID",winId:e})}stackTileHorizontal(e){P.Z.dispatch({actionType:"TAB_STACK_TILE_HORIZONTAL",winId:e})}stackTileVertical(e){P.Z.dispatch({actionType:"TAB_STACK_TILE_VERTICAL",winId:e})}viewPageSource(e){P.Z.dispatch({actionType:"TAB_VIEW_PAGE_SOURCE",winId:e})}toggleTabThumbnail(e){P.Z.dispatch({actionType:"TAB_TOGGLE_THUMBNAIL",winId:e})}};var D=s(2699),O=s(32773),j=s(54058),L=s(76501),R=s(70864),B=s(83526),F=s(57904),W=s(63153),U=s(15489),V=s(29104),H=s(22303),G=s(56371),K=s(78347),z=s(92292),$=s(26036),Y=s(7064),X=s(71828),Q=s(35369),q=s(37182),J=s(1407),ee=s(19626),te=s(80225),se=s(71320),ne=s(2497),ie=s(5863),ae=s(89175),oe=s(8684);function re(e,t,s){for(const n in e){const i=t.createElement("outline");if(ie.pG.test(n)){const e=E.Z.get(ae.kRssSettings).find((e=>e.feedId===n));i.setAttribute("type","rss"),i.setAttribute("text",e.title),i.setAttribute("title",e.title),i.setAttribute("xmlUrl",e.url),s.appendChild(i)}else{const a=se.Z.getByAccountId(ie.u4).find((e=>e.name===n));i.setAttribute("text",a?.name),i.setAttribute("title",a?.name),re(e[n],t,i),s.appendChild(i)}}}function le(){const e=se.Z.getByAccountId(ie.u4),t=E.Z.get(ae.kRssSettings),s=document.implementation.createDocument(null,"opml"),n=s.createProcessingInstruction("xml",'version="1.0" encoding="utf-8"'),i=s.documentElement;s.insertBefore(n,s.firstChild),i.setAttribute("version","1.0");const a=s.createElement("head");i.appendChild(a);const o=s.createElement("title");o.appendChild(s.createTextNode("Vivaldi Feed Reader Export")),a.appendChild(o);const r=s.createElement("dateCreated"),l=(new Date).toUTCString();r.appendChild(s.createTextNode(l)),a.appendChild(r);const d=s.createElement("body");if(t.length>0){re(function(e){const t={};return e.forEach((e=>{e.path.split("/").reduce(((e,t)=>e[t]=e[t]||{}),t)})),t}(e),s,d)}else{const e=s.createElement("outline");e.setAttribute("type","comment"),e.setAttribute("text","No feed subscriptions to export."),d.appendChild(e)}i.appendChild(d);return(new XMLSerializer).serializeToString(s).replace(/></g,">\n<")}async function de(e){const t=(0,ne.Z)(e),s=await async function({showSaveFilePicker:e}){try{return await e({suggestedName:"Vivaldi Feeds.opml",types:[{accept:{"text/opml+xml":[".opml",".xml"]},description:(0,G.Z)(".opml files")}]})}catch(e){return"AbortError"!==e.name&&console.warn("Failed to select file",e),Promise.resolve(void 0)}}(t);if(s)try{const e=await s.createWritable();await e.write(le()),await e.close(),(0,oe.c)({title:(0,G.Z)("Finished Exporting Feeds"),tag:"VIVALDI_FEEDS_EXPORT_DONE"})}catch(e){console.error("Exporting Feeds failed: ",e)}}var ce=s(21343),he=s(37461),ue=s(69046),pe=s(10334),ge=s(86461),me=s(36436),fe=s(19842),ve=s(55603),be=s(21191),Ce=s(92521),we=s(6826),ye=s(44850);const xe=!1,Ie=e=>"object"==typeof e&&"wheel"===e.type,Ae={COMMAND_OPEN_LINK:"https://www.vivaldi.com"},Se=e=>Me[e],Ze=["COMMAND_CLIPBOARD_UNDO","COMMAND_CLIPBOARD_REDO","COMMAND_CLIPBOARD_CUT","COMMAND_CLIPBOARD_COPY","COMMAND_CLIPBOARD_PASTE","COMMAND_CLIPBOARD_SELECT_ALL","COMMAND_HIDE_OTHERS","COMMAND_HIDE_VIVALDI","COMMAND_SHOW_ALL"],Te=e=>Ze.includes(e);function Ee(){return!U.ZP.isGuest()&&Z.Z.isMailOn()}function ke(){return!U.ZP.isGuest()&&Z.Z.isFeedsOn()}function Ne(){const e=a.Z.getActiveListEntry();return!!e&&(0,ve.Ro)(e)}function _e(e){const t=x.ZP.getActivePage(e)?.url??"";return(0,me.xl)(t)&&t.includes("mail.html?path=composer")}function Pe(e){return!!o.Z.getActiveWebView(e)}const Me={COMMAND_TAB_PERIODIC_RELOAD:{type:"mixed",defaultValue:60,unit:(0,G.Z)("time","Seconds"),min:60,max:31556926,validity:/^((?<min>\d+)['′m]\s*((?<sec1>\d+)["″s])?|((?<sec2>\d+)["″s])$)/i},COMMAND_MAIN_ZOOM:{type:"number",unit:(0,G.Z)("Percentage"),defaultValue:100*X.m6,min:100*X.XF,max:100*X.qt},COMMAND_MAIN_UI_ZOOM:{type:"number",unit:(0,G.Z)("Percentage"),defaultValue:100*X.m6,min:100*X.bI,max:100*X.OK},COMMAND_DEFAULT_MAIN_ZOOM:{type:"number",unit:(0,G.Z)("Percentage"),defaultValue:100*X.m6,min:100*X.bI,max:100*X.OK}},De=[{name:"COMMAND_NEW_WINDOW",action:e=>{if(U.ZP.isIncognito(e.windowId))Y.Z.sessionsPrivate.restoreLastClosed((t=>{if(!t)if(U.ZP.isGuest())b.Z.openGuestWindow();else{const t={focused:!0,incognito:!1};W.Z.openWindow(e.windowId,"window.html","normal",t)}}));else if(U.ZP.isGuest())b.Z.openGuestWindow();else{const t={focused:!0,incognito:!1};W.Z.openWindow(e.windowId,"window.html","normal",t)}},isEnabled:Ce.Z,isVisible:Ce.Z,withNoWindow:!0,showInQC:!0,category:"CATEGORY_COMMAND_APPLICATION",guid:"b6ddaabf-d87f-4c2c-affa-ce81bb30bfca",...(0,$.Z)("command","New Window")},{name:"COMMAND_NEW_PRIVATE_WINDOW",action:e=>W.Z.openIncognitoWindow(e.windowId),isEnabled:Ce.Z,isVisible:e=>!U.ZP.isGuest(),withNoWindow:!0,showInQC:!0,category:"CATEGORY_COMMAND_APPLICATION",guid:"176ff9a8-a516-4015-9b0a-14434746ce9b",...(0,$.Z)("New Private Window")},{name:"COMMAND_NEW_GUEST_WINDOW",action:()=>b.Z.openGuestWindow(),isEnabled:Ce.Z,isVisible:e=>!U.ZP.isIncognito(e),category:"CATEGORY_COMMAND_APPLICATION",showInQC:!0,guid:"1453aae1-130d-465f-98eb-cbda5061445d",...(0,$.Z)("New Guest Window")},{name:"COMMAND_MANAGE_PEOPLE",action:()=>b.Z.managePeople(),category:"CATEGORY_COMMAND_APPLICATION",isEnabled:Ce.Z,isVisible:Ce.Z,showInQC:!0,guid:"49023738-dc53-4fce-8fd8-68bcdc89be34",...(0,$.Z)("Manage Profiles")},{name:"COMMAND_CLOSE_WINDOW",action:e=>W.Z.close(e.windowId),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"172583c9-c8d5-45f7-9e4d-65cff9333679",...(0,$.Z)("command","Close Window")},{name:"COMMAND_SHOW_QUICK_COMMANDS",action:e=>b.Z.showQuickCommand(e.windowId),showInQC:!1,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"f8d653f3-1371-4cf2-ab83-b8c62ad98add",...(0,$.Z)("Quick Commands")},{name:"COMMAND_CUSTOMIZE_TOOLBAR",action:e=>O.Z.edit(ae.kToolbarsNavigation),showInQC:!0,isEnabled:Ce.Z,isVisible:e=>!U.ZP.isGuest(),category:"CATEGORY_COMMAND_APPEARANCE",guid:"fd9a4bd8-25a8-4006-8e63-251f166aa862",...(0,$.Z)("Customize Toolbar")},{name:"COMMAND_FULLSCREEN",action:e=>W.Z.toggleFullscreen(e.windowId),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"7420368f-565e-409f-8eec-5b5c578429af",...(0,$.Z)("Fullscreen Mode")},{name:"COMMAND_TASK_MANAGER",action:e=>Y.Z.utilities.openTaskManager(e.windowId),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"3aed82ac-e497-4f75-9f13-c5a7df0ac448",...(0,$.Z)("Task Manager")},{name:"COMMAND_SHOW_SETTINGS",action:e=>b.Z.showSettings(e.windowId),isEnabled:Ce.Z,isVisible:e=>!U.ZP.isGuest(),withNoWindow:xe,showInQC:!0,category:"CATEGORY_COMMAND_APPLICATION",guid:"1e05a540-7261-427f-a902-8a75f5e81cdd",...(0,$.Z)("Settings")},{name:"COMMAND_SHOW_EXTENSIONS",action:e=>b.Z.showExtensions(e.windowId),withNoWindow:!0,showInQC:!0,isEnabled:Ce.Z,isVisible:e=>!U.ZP.isGuest(),category:"CATEGORY_COMMAND_APPLICATION",guid:"ef8d7f53-627c-4286-a03e-7affc92b5ff3",...(0,$.Z)("Extensions")},{name:"COMMAND_SHOW_HISTORY",action:e=>b.Z.showHistory(e.windowId),withNoWindow:!0,isEnabled:Ce.Z,isVisible:e=>!U.ZP.isGuest(),showInQC:!0,category:"CATEGORY_COMMAND_APPLICATION",guid:"dd8723f0-b05a-4d22-b55b-b1c1a6e282e2",...(0,$.Z)("History")},{name:"COMMAND_SHOW_NOTES",action:e=>b.Z.showNotes(e.windowId),withNoWindow:!0,showInQC:!0,isEnabled:Ce.Z,isVisible:e=>!U.ZP.isGuest(),category:"CATEGORY_COMMAND_APPLICATION",guid:"97006589-839d-4c3e-aa37-311a864618b5",...(0,$.Z)("Notes")},{name:"COMMAND_SHOW_BOOKMARKS",action:e=>b.Z.showBookmarks(e.windowId),withNoWindow:!0,isEnabled:Ce.Z,isVisible:e=>!U.ZP.isGuest(),showInQC:!0,category:"CATEGORY_COMMAND_APPLICATION",guid:"9cde01a4-9df7-4a2e-84a1-27997c6df705",...(0,$.Z)("Bookmarks")},{name:"COMMAND_SHOW_WELCOME",action:e=>b.Z.showWelcome(e.windowId),isEnabled:Ce.Z,isVisible:e=>!U.ZP.isGuest(),withNoWindow:!0,showInQC:!0,category:"CATEGORY_COMMAND_APPLICATION",guid:"3e27424f-656a-48bf-85e4-01364ec27b57",...(0,$.Z)("Vivaldi Welcome Tour")},{name:"COMMAND_SHOW_CLEAR_PRIVATE_DATA",action:e=>b.Z.showClearBrowsingHistoryDialog(e.windowId),isEnabled:Ce.Z,isVisible:e=>!U.ZP.isIncognitoOrGuest(e),showInQC:!0,category:"CATEGORY_COMMAND_APPLICATION",guid:"10a45d9e-c539-4c67-92fd-c2332fb41127",...(0,$.Z)("command","Delete Browsing Data")},{name:"COMMAND_SHOW_BOOKMARK_BAR",action:e=>W.Z.toggleBookmarksBar(e.windowId),behavior:"checkbox",showInQC:!0,isEnabled:Ce.Z,isVisible:e=>!U.ZP.isGuest(),category:"CATEGORY_COMMAND_APPEARANCE",guid:"42b84fc2-a9c1-425d-a08f-f349dbb6e8a6",...(0,$.Z)("Bookmarks Bar")},{name:"COMMAND_TOGGLE_APPLE_EVENTS",action:()=>T.Z.toggle(ae.kAllowJavascriptAppleEvents,!0,!1),inMenu:()=>xe,showInQC:xe,isEnabled:Ce.Z,isVisible:()=>xe,platforms:["mac"],category:"CATEGORY_COMMAND_APPLICATION",guid:"c8908d2a-9b77-4eb3-bdcf-327f5d78fe60",...(0,$.Z)("Apple Events")},{name:"COMMAND_EMAIL_LINK_OVERRIDE",action:()=>{},inMenu:()=>xe,showInQC:we.Z,isEnabled:Ce.Z,isVisible:()=>xe,platforms:["mac"],category:"CATEGORY_COMMAND_APPLICATION",guid:"b3c7f4ec-cd99-496a-91c3-cb0b4e4c50be",withNoWindow:!0,...(0,$.Z)("Email Link")},{name:"COMMAND_TOGGLE_MENU_POSITION",action:()=>T.Z.toggle(ae.kMenuDisplay,"vivaldi","top"),inMenu:()=>!0,showInQC:!0,isEnabled:Ce.Z,isVisible:()=>!0,platforms:["linux","windows"],behavior:"checkbox",category:"CATEGORY_COMMAND_APPEARANCE",guid:"6c186895-cfb1-4ce5-8d9b-21484a438ef6",...(0,$.Z)("command","Menu Position")},{name:"COMMAND_TOGGLE_FOOTER",action:e=>W.Z.toggleStatusBar(e.windowId),behavior:"checkbox",showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"ea570117-f29e-4fd2-b4de-649a4660a4f2",...(0,$.Z)("other","Status Bar")},{name:"COMMAND_TOGGLE_STARTPAGE_NAVIGATION",action:()=>T.Z.toggle(ae.kStartpageNavigation,"off","on"),behavior:"checkbox",showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"a1563471-d01b-4e7f-8a40-552120443cd5",...(0,$.Z)("other","Start Page Navigation")},{name:"COMMAND_TOGGLE_PRIVACY_STATS",action:()=>T.Z.toggle(ae.kStartpageSpeedDialPrivacyStatsShow,!1,!0),behavior:"checkbox",showInQC:!1,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"dad8a820-629c-4146-b105-9ad0b3755b25",...(0,$.Z)("other","Show Privacy Statistics")},{name:"COMMAND_SHOW_PRIVACY_STATS",action:e=>b.Z.showPrivacyStatsDialog(e.windowId),behavior:"checkbox",showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"bbe93145-cdcd-4897-880f-4c2e3f4f3029",...(0,$.Z)("other","Show Privacy Statistics")},{name:"COMMAND_TOGGLE_INTERFACE_COLOR",action:()=>D.Z.setNextTheme(),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"0a9303d7-c8b0-4b0d-b6e0-02a5ba457360",...(0,$.Z)("Next Theme")},{name:"COMMAND_EXIT",action:e=>{Y.Z.runtimePrivate.exit("menu"!==e.origin&&E.Z.get(ae.kSystemShowExitConfirmationDialog))},inMenu:()=>!0,showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"842121fd-5e5a-48f3-95ad-947d37aebedb",...(0,$.Z)("verb","Exit")},{name:"COMMAND_QUIT_MAC_MAYBE_WARN",action:()=>{},inMenu:()=>xe,showInQC:!1,isEnabled:Ce.Z,isVisible:()=>xe,platforms:["mac"],category:"CATEGORY_COMMAND_APPLICATION",withNoWindow:!0,guid:"ff0ac033-0fcf-4c77-b664-7f7c3e4a2044",...(0,$.Z)("Quit $1",["Vivaldi"])},{name:"COMMAND_TOGGLE_WARN_ON_QUIT",action:()=>{T.Z.toggle(ae.kSystemShowExitConfirmationDialog,!0,!1)},behavior:"checkbox",showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"16b932e4-0a18-4c50-bcdf-089fd60fb1d8",...(0,$.Z)("Show Exit Confirmation Dialog")},{name:"COMMAND_SHOW_HELP",action:e=>y.ZP.openURL(e.windowId,"https://help.vivaldi.com/?pk_campaign=v-menu"),withNoWindow:!0,showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"643fde7b-ac28-4241-b0d0-bc221ee88785",...(0,$.Z)("browser","Vivaldi Help")},{name:"COMMAND_SHOW_KEYBOARDSHORTCUTS",action:e=>b.Z.showKeyboardShortcuts(e.windowId),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"12ab9d03-8327-4e5d-a905-609af0ab5528",...(0,$.Z)("Keyboard Cheat Sheet")},{name:"COMMAND_REPORT_BUG",action:e=>y.ZP.openURL(e.windowId,"https://help.vivaldi.com/desktop/troubleshoot/reporting-a-bug-in-vivaldi/?pk_campaign=v-menu"),withNoWindow:!0,showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"f9f6da04-7ebc-4fb4-8633-f122ca145217",...(0,$.Z)("Report a Problem")},{name:"COMMAND_SHOW_PAGE_ACCESS_KEYS",action:e=>b.Z.showPageAccessKeys(e.windowId),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"7838709a-7042-4913-b541-25ff2268f774",...(0,$.Z)("Show Webpage Access Key Shortcuts")},{name:"COMMAND_BREAKMODE_TOGGLE",action:e=>r.Z.toggleBreakMode(e.windowId),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"a3596917-8095-42e9-8efb-31ad8ad0cbaa",...(0,$.Z)("command","Break Mode")},{name:"COMMAND_START_CHROMECAST",action:e=>b.Z.startCasting(e.windowId),showInQC:!0,isEnabled:e=>Pe(e),isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"8b650af8-6342-48f5-a45b-2d56933fb389",...(0,$.Z)("Cast")},{name:"COMMAND_MAIN_TOGGLE_TAB_BAR",action:e=>W.Z.toggleTabs(e.windowId),behavior:"checkbox",showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"c4bfbdc9-1e24-4b60-bbfe-a706be090f7b",...(0,$.Z)("command","Tab Bar")},{name:"COMMAND_MAIN_TOGGLE_PANEL_TOGGLE",action:e=>W.Z.togglePanelToggle(e.windowId),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"1ad09f05-6a12-41e9-9bf3-ddf58f24bea4",...(0,$.Z)("Panel Toggle")},{name:"COMMAND_MAIN_TOGGLE_ADDRESS_BAR",action:e=>W.Z.toggleAddressBar(e.windowId),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"14fc610b-d5dc-49fc-973d-4d666394948b",...(0,$.Z)("other","Address Bar")},{name:"COMMAND_MAIN_TOGGLE_UI",action:e=>W.Z.toggleMinimalUI(e.windowId),behavior:"checkbox",showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"3b773be0-6af6-47f4-807c-19ad590693a2",...(0,$.Z)("Toggle UI")},{name:"COMMAND_CAPTURE_AREA_TO_DISK",action:e=>h.Z.captureArea(e.windowId,"file"),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"6ae02ffe-8039-4689-9e73-a7cd5ae792b3",...(0,$.Z)("Capture Area to File")},{name:"COMMAND_CAPTURE_AREA_TO_CLIPBOARD",action:e=>h.Z.captureArea(e.windowId,"clipboard"),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"2c2057eb-ec79-4d9e-a8de-5bbb0c2a6249",...(0,$.Z)("Capture Area to Clipboard")},{name:"COMMAND_FOCUS_NEXT",action:e=>b.Z.stepFocus(e.context,!0),repeat:!0,showInQC:!1,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"8202e8f1-c0d1-4a85-bbab-f66a52656a30",...(0,$.Z)("Focus Next Pane")},{name:"COMMAND_FOCUS_PREVIOUS",action:e=>b.Z.stepFocus(e.context,!1),repeat:!0,showInQC:!1,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"0dc4e130-6728-46e0-a632-3a2e7d817f2a",...(0,$.Z)("Focus Previous Pane")},{name:"COMMAND_NEW_TAB",action:e=>{const t="COMMAND_NEW_TAB";if(!p.Z.hasListener(t))return y.ZP.openURL(e.windowId,"");p.Z.onCommand(e.windowId,t)},withNoWindow:!0,showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"b3515e1b-9cf2-4ba0-ba34-fac6ce308b08",...(0,$.Z)("command","New Tab")},{name:"COMMAND_NEW_TAB_OUTSIDE_GROUP",action:e=>y.ZP.openURL(e.windowId,""),withNoWindow:!0,showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"4b4d97fa-f94d-4bc1-80b6-2849a56dbe42",...(0,$.Z)("command","New Top Level Tab")},{name:"COMMAND_NEW_BACKGROUND_TAB",action:e=>y.ZP.openURL(e.windowId,"",{inBackground:!0}),withNoWindow:!0,showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"5c2631d5-69cd-4bd5-b6e2-93b8a6ca0281",...(0,$.Z)("New Background Tab")},{name:"COMMAND_CLONE_TAB",action:e=>x.ZP.isSelecting(e.windowId)?y.ZP.clonePages(x.ZP.getSelectedPages(e.windowId)):y.ZP.clonePages(Q.aV.of(x.ZP.getActivePage(e.windowId)).filter(Boolean)),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"74393bfb-4c31-4b25-afc4-471cb9d621ca",...(0,$.Z)("Duplicate Selected Tabs")},{name:"COMMAND_MOVE_TAB_TO_NEW_WINDOW",action:e=>{const t=x.ZP.getActivePage(e.windowId);t&&y.ZP.detachPage(t)},showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"d03d4bc8-26c4-49f6-b3ce-23980637ae76",...(0,$.Z)("Move Tab to New Window")},{name:"COMMAND_PIN_TAB",action:e=>y.ZP.toggleSelectedPagesPinned(e.windowId),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"8b413c0e-9024-4fbe-8813-68c76096c87b",...(0,$.Z)("Pin / Unpin Tab")},{name:"COMMAND_CLOSE_TAB",action:e=>y.ZP.close(e.windowId),showInQC:!0,isEnabled:Ce.Z,isVisible:e=>{const t=U.ZP.isSettings(e);if(t||"off"!==E.Z.get(ae.kTabsClosePinned))return!0;{const t=E.Z.get(ae.kTabsClosePinnedInStack),s=x.ZP.getActivePage(e);return Boolean(s&&(!s.pinned||(0,ue.av)(s)&&t))}},category:"CATEGORY_COMMAND_TAB_ACTION",guid:"f0a3a628-6977-4812-ab11-96a1d1fbc08d",...(0,$.Z)("Close Tab")},{name:"COMMAND_POSITION_TAB_TOP",action:()=>T.Z.set(ae.kTabsBarPosition,"top"),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"7be0e09e-a13a-4438-ad6b-2d43734e2a7d",...(0,$.Z)("Tabs on Top")},{name:"COMMAND_POSITION_TAB_BOTTOM",action:()=>T.Z.set(ae.kTabsBarPosition,"bottom"),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"1585fbcb-db49-4b0c-afd0-e3abc19456fd",...(0,$.Z)("Tabs on Bottom")},{name:"COMMAND_POSITION_TAB_LEFT",action:()=>T.Z.set(ae.kTabsBarPosition,"left"),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"35cac9b1-4c5e-433a-abbb-b69f123b26b9",...(0,$.Z)("Tabs on Left")},{name:"COMMAND_POSITION_TAB_RIGHT",action:()=>T.Z.set(ae.kTabsBarPosition,"right"),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"f3016405-4ac9-45a2-91d4-ddc8127cd9de",...(0,$.Z)("Tabs on Right")},{name:"COMMAND_CLOSE_TAB_TO_LEFT",action:e=>{const t=x.ZP.getActivePage(e.windowId);if(t){const s=x.ZP.isGroup((0,ue.av)(t),e.windowId);y.ZP.closeToLeft(t,s)}},showInQC:!0,isVisible:e=>U.ZP.isSettings(e)||U.ZP.isTabbedBrowser(e)&&!x.ZP.getActivePage(e)?.pinned,isEnabled:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"cd97956b-c939-4271-9037-1676c70e4fa4",...(0,$.Z)("Close Tabs to the Left")},{name:"COMMAND_CLOSE_TAB_TO_RIGHT",action:e=>{const t=x.ZP.getActivePage(e.windowId);if(t){const s=x.ZP.isGroup((0,ue.av)(t),e.windowId);y.ZP.closeToRight(t,s)}},showInQC:!0,isVisible:e=>U.ZP.isSettings(e)||U.ZP.isTabbedBrowser(e)&&!x.ZP.getActivePage(e)?.pinned,isEnabled:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"cfb3068d-5e79-4dac-a741-50879d4e81db",...(0,$.Z)("Close Tabs to the Right")},{name:"COMMAND_CLOSE_ALL_BUT_ACTIVE_TAB",action:e=>{const t=x.ZP.getActivePage(e.windowId);if(t){const s=x.ZP.getActiveWorkspace(e.windowId);y.ZP.closeOther(t,s,!1)}},showInQC:!0,isEnabled:Ce.Z,isVisible:e=>!x.ZP.getActivePage(e)?.pinned,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"275ca3f7-ecfb-4445-bf87-686cd473536e",...(0,$.Z)("Close Other Tabs")},{name:"COMMAND_TAB_THUMBNAIL",action:e=>M.toggleTabThumbnail(e.windowId),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"c46c994e-81a8-4b4b-ae15-4e64a643af7b",...(0,$.Z)("Tab Thumbnails")},{name:"COMMAND_SHOW_ABOUT",action:e=>y.ZP.openURL(e.windowId,ye.jk.internals.about),category:"CATEGORY_COMMAND_APPLICATION",withNoWindow:!0,isEnabled:Ce.Z,isVisible:Ce.Z,showInQC:!0,guid:"b5396606-e86b-4cca-bd74-029f3c538423",...(0,$.Z)("About")},{name:"COMMAND_CHECK_FOR_UPDATES",action:()=>Y.Z.autoUpdate.checkForUpdates(!0),showInQC:e=>!U.ZP.isGuest()&&!0,isEnabled:Ce.Z,isVisible:e=>!U.ZP.isGuest()&&!0,platforms:["windows","mac"],withNoWindow:!0,category:"CATEGORY_COMMAND_APPLICATION",guid:"b4ef4439-df4a-4634-95f7-509c95e42b69",...(0,$.Z)("Check for Updates")},{name:"COMMAND_SHOW_COMMUNITY",action:e=>y.ZP.openURL(e.windowId,"https://vivaldi.net/?pk_campaign=v-menu"),withNoWindow:!0,showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"cb626c77-47cd-46e3-9cf7-d976f50aadbd",...(0,$.Z)("Community Blogs")},{name:"COMMAND_SHOW_CONTRIBUTE",action:e=>y.ZP.openURL(e.windowId,"https://vivaldi.com/contribute"),withNoWindow:!0,showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"36ad2648-9c17-4061-8f7e-4db8b9742869",...(0,$.Z)("Help us Grow")},{name:"COMMAND_SHOW_DONATE",action:e=>{const t=`${J._L}#mtm_campaign=Desktop-Donate-Command`;y.ZP.openURL(e.windowId,t)},withNoWindow:!0,showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"ba38db4d-4a69-4cf2-9dc1-b87fcff57623",...(0,$.Z)("Donate")},{name:"COMMAND_SHARE_VIVALDI",action:e=>b.Z.showShareVivaldiDialog(e.windowId),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"cec7ecf3-41ec-4e7a-b59e-30630e3623c4",...(0,$.Z)("Share Vivaldi")},{name:"COMMAND_TAB_SWITCH_BACK_SETTING",action:e=>M.switchTabBackBySetting(e.windowId,Ie(e.param)?e.param:e.keyState),inMenu:we.Z,isEnabled:Ce.Z,isVisible:Ce.Z,repeat:!0,showInQC:!1,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"ee5eec5e-9ebf-4faf-b2ec-4fdba8b328d0",...(0,$.Z)("Tab Cycler Back")},{name:"COMMAND_TAB_SWITCH_FORWARD_SETTING",action:e=>M.switchTabForwardBySetting(e.windowId,Ie(e.param)?e.param:e.keyState),inMenu:we.Z,repeat:!0,isEnabled:Ce.Z,isVisible:Ce.Z,showInQC:!1,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"7c2836f2-93e5-445f-9674-46a29759ff34",...(0,$.Z)("Tab Cycler Forward")},{name:"COMMAND_TAB_SWITCH_BACK_ORDER",action:e=>{const t=Ie(e.param)?e.param:e.keyState;y.ZP.cycleByOrder(e.windowId,t,{goBack:!0})},repeat:!0,showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"9693c49b-29e0-442e-925d-d34d95f977a4",...(0,$.Z)("Previous Tab (by Order)")},{name:"COMMAND_TAB_SWITCH_FORWARD_ORDER",action:e=>{const t=Ie(e.param)?e.param:e.keyState;y.ZP.cycleByOrder(e.windowId,t,{goBack:!1})},repeat:!0,showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"037d899d-b191-49c7-a932-87d8881d7037",...(0,$.Z)("Next Tab (by Order)")},{name:"COMMAND_TAB_SWITCH_FORWARD_HISTORY",action:e=>{const t=Ie(e.param)?e.param:e.keyState;y.ZP.cycleByHistory(e.windowId,t,{goBack:!1})},repeat:!0,showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"a645ffdf-6235-425a-896e-3dfd8d4eebb1",...(0,$.Z)("Previous Tab (Recent)")},{name:"COMMAND_TAB_SWITCH_BACK_HISTORY",action:e=>{const t=Ie(e.param)?e.param:e.keyState;y.ZP.cycleByHistory(e.windowId,t,{goBack:!0})},repeat:!0,showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"0c39ac37-1deb-4dc8-bea4-54672978af06",...(0,$.Z)("Next Tab (Recent)")},{name:"COMMAND_TAB_MOVE_FIRST",action:e=>p.Z.onCommand(e.windowId,"COMMAND_TAB_MOVE_FIRST"),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"d15338f7-43e6-4e36-b813-aaab299554df",...(0,$.Z)("Move Tabs to Beginning")},{name:"COMMAND_TAB_MOVE_END",action:e=>p.Z.onCommand(e.windowId,"COMMAND_TAB_MOVE_END"),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"478e7f24-51b6-499e-be8d-eda14148f4a7",...(0,$.Z)("Move Tabs to End")},{name:"COMMAND_TAB_MOVE_BACKWARD",action:e=>{const t=x.ZP.getActivePage(e.windowId);t&&y.ZP.stepPage(t,!1,"dotted"===E.Z.get(ae.kTabsStackingMode),e.windowId)},showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"bb5e2bde-67dd-40ff-9d87-43032f048b7a",...(0,$.Z)("Move Active Tab Backward")},{name:"COMMAND_TAB_MOVE_FORWARD",action:e=>{const t=x.ZP.getActivePage(e.windowId);t&&y.ZP.stepPage(t,!0,"dotted"===E.Z.get(ae.kTabsStackingMode),e.windowId)},showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"8338b153-b32d-4a29-962e-cb3bbc5861d0",...(0,$.Z)("Move Active Tab Forward")},{name:"COMMAND_TAB_DISABLE_ALL_RELOADS",action:e=>{"button"===e.origin?S.Z.destroyAllPanelPeriodicAlarms():S.Z.destroyTabPeriodicAlarms(e.windowId)},showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"7d40d732-b025-4722-bc23-b66ada752339",...(0,$.Z)("Disable Periodic Timers")},{name:"COMMAND_TAB_PERIODIC_RELOAD",action:async e=>{if(e.param){const t=(0,pe.AE)(e.param),s=x.ZP.getActivePage(e.windowId);if(s){const e=s.vivExtData.ext_id;if(e){const s=t/60;await S.Z.createPeriodicReloadAlarm({id:e,interval:s,from:"tab"})}}}},showInQC:!0,inMenu:we.Z,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"bf7a3a4a-565a-46c7-835c-fa2a6d4b7fdf",...(0,$.Z)("tab","Periodic Reload")},{name:"COMMAND_PAGE_COPY_ALL_URLS",action:e=>y.ZP.copyAllUrls(e.windowId,x.ZP.getActiveWorkspace(e.windowId)),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"259f485f-3892-43e3-b29e-e8f4ccb29a5e",...(0,$.Z)("other","Copy All Links")},{name:"COMMAND_PAGE_SELECTION_CURRENT",action:e=>{const t=x.ZP.getActivePage(e.windowId);t&&y.ZP.setSelection(t)},showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"2cd718aa-76d4-4bd4-9c55-6117822d402e",...(0,$.Z)("other","Select Current Tab")},{name:"COMMAND_PAGE_SELECTION_EXPAND_PREVIOUS",action:e=>{const t=x.ZP.getActivePage(e.windowId);t&&y.ZP.expandSelectionPrevious(t)},showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"e245bce5-20a7-481f-910e-23bf1de86748",...(0,$.Z)("other","Select Previous Tab")},{name:"COMMAND_PAGE_SELECTION_EXPAND_NEXT",action:e=>{const t=x.ZP.getActivePage(e.windowId);t&&y.ZP.expandSelectionNext(t)},showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"23e27390-f1bf-4ec3-92b5-7634daeabc5b",...(0,$.Z)("other","Select Next Tab")},{name:"COMMAND_PAGE_SELECTION_TOGGLE_RELATED",action:e=>{const t=x.ZP.getActivePage(e.windowId);t&&y.ZP.toggleRelatedSelection(t)},showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"7ef25cfa-632f-4872-832c-ca6c9dfb5769",...(0,$.Z)("other","Select Related Tabs")},{name:"COMMAND_PAGE_SELECTION_CLEAR",action:e=>y.ZP.clearSelection(e.windowId),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"cf44c36e-ab42-4700-a80e-93f5f504c72b",...(0,$.Z)("other","Deselect Tabs")},{name:"COMMAND_RENAME_TAB",action:e=>p.Z.onCommand(e.windowId,"COMMAND_RENAME_TAB"),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"80a8d5e6-b2df-4bac-b068-4b92aef93d57",...(0,$.Z)("Rename Tab")},{name:"COMMAND_RENAME_TAB_STACK",action:e=>p.Z.onCommand(e.windowId,"COMMAND_RENAME_TAB_STACK"),showInQC:!0,isEnabled:Ce.Z,isVisible:e=>{if(U.ZP.isSettings(e))return!0;{const t=x.ZP.getActivePage(e);return!!t&&x.ZP.isGroup((0,ue.av)(t),e)}},category:"CATEGORY_COMMAND_TAB_ACTION",guid:"a453b19c-8c8e-48e4-8e5b-f9d494086b0d",...(0,$.Z)("Rename Tab Stack")},{name:"COMMAND_TAB_SWITCH_1",action:e=>y.ZP.activateTabByIndex(e.windowId,0),showInQC:!1,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"a4d46cc3-e258-4c20-ab39-3174ec9acbb9",...(0,$.Z)("Switch to Tab 1")},{name:"COMMAND_TAB_SWITCH_2",action:e=>y.ZP.activateTabByIndex(e.windowId,1),showInQC:!1,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"3a792281-c3a3-4501-b64c-b5173206195d",...(0,$.Z)("Switch to Tab 2")},{name:"COMMAND_TAB_SWITCH_3",action:e=>y.ZP.activateTabByIndex(e.windowId,2),showInQC:!1,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"5e570a93-4779-4266-aebe-f2abe0e081ae",...(0,$.Z)("Switch to Tab 3")},{name:"COMMAND_TAB_SWITCH_4",action:e=>y.ZP.activateTabByIndex(e.windowId,3),showInQC:!1,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"34281a36-77c7-4f3c-99e1-73529174cfb6",...(0,$.Z)("Switch to Tab 4")},{name:"COMMAND_TAB_SWITCH_5",action:e=>y.ZP.activateTabByIndex(e.windowId,4),showInQC:!1,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"71cd67b0-77bb-4cf3-a7ee-8e26462eb42e",...(0,$.Z)("Switch to Tab 5")},{name:"COMMAND_TAB_SWITCH_6",action:e=>y.ZP.activateTabByIndex(e.windowId,5),showInQC:!1,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"d8b8a23c-f47b-4341-8adc-844cc52562b1",...(0,$.Z)("Switch to Tab 6")},{name:"COMMAND_TAB_SWITCH_7",action:e=>y.ZP.activateTabByIndex(e.windowId,6),showInQC:!1,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"c537cc07-a3ff-4151-997c-40e25056e65d",...(0,$.Z)("Switch to Tab 7")},{name:"COMMAND_TAB_SWITCH_8",action:e=>y.ZP.activateTabByIndex(e.windowId,7),showInQC:!1,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"710bb550-7dea-4436-9d0c-fea152299507",...(0,$.Z)("Switch to Tab 8")},{name:"COMMAND_TAB_SWITCH_9",action:e=>y.ZP.activateTabByIndex(e.windowId,8),showInQC:!1,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"91f469f5-f527-433c-a1fa-2e3f399c7820",...(0,$.Z)("Switch to Tab 9")},{name:"COMMAND_TAB_SWITCH_LAST",action:e=>y.ZP.openLastPage(e.windowId),showInQC:!1,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"750d7779-97ec-493d-afa8-a62c179d6d82",...(0,$.Z)("Switch to the Last Tab")},{name:"COMMAND_HIBERNATE_OTHER_TABS",action:e=>(0,pe.Xf)(e.windowId),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"62655c2c-509d-40f9-aec9-d4428af56884",...(0,$.Z)("Hibernate Background Tabs")},{name:"COMMAND_SHOW_CLOSED_TABS",action:e=>p.Z.onCommand(e.windowId,"COMMAND_SHOW_CLOSED_TABS"),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"ba89f260-0036-4f93-95aa-11b65790621d",...(0,$.Z)("Show Closed Tabs")},{name:"COMMAND_TAB_REOPEN_RECENTLY_CLOSED",action:()=>L.Z.undeletePreviousTab(),tweakedShortcut:"ctrl+z",withNoWindow:!0,showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"7e925f03-11a3-47b4-b092-e1c355661796",...(0,$.Z)("Reopen Closed Tab")},{name:"COMMAND_TAB_STACK_TILE_VERTICAL",action:e=>M.stackTileVertical(e.windowId),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"854f8a44-50bd-41bc-8277-acd51e719d1b",...(0,$.Z)("command","Tile Vertically")},{name:"COMMAND_TAB_STACK_TILE_HORIZONTAL",action:e=>M.stackTileHorizontal(e.windowId),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"2991fb16-2df8-42b5-898a-25a0d028ac41",...(0,$.Z)("command","Tile Horizontally")},{name:"COMMAND_TAB_STACK_TILE_GRID",action:e=>M.stackTileGrid(e.windowId),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"83c2d2d0-a53b-4521-82b5-4c2e61ed024b",...(0,$.Z)("command","Tile to Grid")},{name:"COMMAND_DISBAND_TILE_GROUP",action:e=>M.disbandTileGroup(e.windowId),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"a0294e45-6204-406e-b456-2664e4d23b24",...(0,$.Z)("Untile All Tabs in Set")},{name:"COMMAND_TAB_STACK_CREATE",action:e=>M.stackCreate(e.windowId),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"cdd99010-5477-4508-aa28-d671de35dcb2",...(0,$.Z)("Stack Tabs")},{name:"COMMAND_TAB_STACK_DISSOLVE",action:e=>M.stackDissolve(e.windowId),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"61ab7d82-7602-4f72-9f00-07a426ff47c1",...(0,$.Z)("Unstack Tabs")},{name:"COMMAND_TAB_STACK_REMOVE",action:e=>M.stackRemove(e.windowId),showInQC:!0,category:"CATEGORY_COMMAND_TAB_ACTION",isEnabled:Ce.Z,isVisible:Ce.Z,guid:"56cf9bd1-63b1-4ebf-92b0-c909e5d479c6",...(0,$.Z)("Remove from Tab Stack")},{name:"COMMAND_TAB_STACK_CLOSE",action:e=>{const t=x.ZP.getActivePage(e.windowId);t&&y.ZP.closeTabStack(t.id)},showInQC:!0,category:"CATEGORY_COMMAND_TAB_ACTION",isEnabled:Ce.Z,isVisible:e=>{if(U.ZP.isSettings(e))return!0;{const t=x.ZP.getActivePage(e),s="off"!==E.Z.get(ae.kTabsClosePinned);return!!t&&((!t.pinned||s)&&x.ZP.isGroup((0,ue.av)(t),e))}},guid:"44fabfe1-fd65-4e7e-a540-5e4d6c742ab8",...(0,$.Z)("Close Tab Stack")},{name:"COMMAND_TAB_STACK_RELOAD",action:e=>{const t=x.ZP.getActivePage(e.windowId);if(t){const s=x.ZP.getGroup((0,ue.av)(t),e.windowId);if(s.size>1)return y.ZP.reloadPage(s.map((e=>e.id)))}},showInQC:!0,category:"CATEGORY_COMMAND_TAB_ACTION",isEnabled:Ce.Z,isVisible:e=>{if(U.ZP.isSettings(e))return!0;{const t=x.ZP.getActivePage(e);return!!t&&x.ZP.isGroup((0,ue.av)(t),e)}},guid:"7eef8423-ea56-4df8-bad4-e3eccd57c8b6",...(0,$.Z)("Reload Tab Stack")},{name:"COMMAND_TOGGLE_MOUSE_GESTURES",action:()=>T.Z.toggle(ae.kMouseGesturesEnabled,!0,!1),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"01f9d07d-5ec6-41a4-927c-129cef008d65",...(0,$.Z)("Toggle Mouse Gestures")},{name:"COMMAND_TOGGLE_IMAGES",action:e=>{const t=x.ZP.getActivePage(e.windowId);t&&y.ZP.toggleImageLoading(t)},showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"6777b0a7-25d2-4e5e-a4e1-b5fcc0fcdef8",...(0,$.Z)("other","Load Images")},{name:"COMMAND_SET_LOAD_IMAGES_ALWAYS",action:e=>{const t=x.ZP.getActivePage(e.windowId);t&&y.ZP.setImageLoading(t,"always")},behavior:"radio",showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"8d1f63a0-6e3c-42dd-a1b8-9a740f65bafe",...(0,$.Z)("other","Images On")},{name:"COMMAND_SET_LOAD_IMAGES_NEVER",action:e=>{const t=x.ZP.getActivePage(e.windowId);t&&y.ZP.setImageLoading(t,"never")},behavior:"radio",showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"e346b0a7-74c6-4e69-952e-420d33e54a8e",...(0,$.Z)("other","Images Off")},{name:"COMMAND_SET_LOAD_IMAGES_CACHE",action:e=>{const t=x.ZP.getActivePage(e.windowId);t&&y.ZP.setImageLoading(t,"cache")},behavior:"radio",showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"f016e79c-a799-465f-9d01-2869a751774c",...(0,$.Z)("other","Load Images From Cache")},{name:"COMMAND_SET_ANIMATIONS_LOOP",action:()=>z.Z.accessibilityFeatures.animationPolicy.set({value:"allowed"},(()=>{})),behavior:"radio",category:"CATEGORY_COMMAND_TAB_ACTION",isEnabled:Ce.Z,isVisible:Ce.Z,showInQC:!0,guid:"080beb50-b815-4416-8a69-246907b2805a",...(0,$.Z)("other","Loop Animations")},{name:"COMMAND_SET_ANIMATIONS_NEVER",action:()=>z.Z.accessibilityFeatures.animationPolicy.set({value:"none"},(()=>{})),behavior:"radio",showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"1d4df136-9d8e-4541-b0b9-1a66a5b23444",...(0,$.Z)("other","No Animations")},{name:"COMMAND_SET_ANIMATIONS_ONCE",action:()=>z.Z.accessibilityFeatures.animationPolicy.set({value:"once"},(()=>{})),behavior:"radio",showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"8159b932-9a12-4cef-bf84-f046ab3a2030",...(0,$.Z)("other","Play Animations Once")},{name:"COMMAND_PAGE_TOGGLE_MUTE",action:e=>{const t=x.ZP.getActivePage(e.windowId);t&&y.ZP.toggleMuting(e.windowId,Q.aV.of(t))},showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"a6f425df-46e7-48f9-8be2-3b03329fa8d0",...(0,$.Z)("Mute / Unmute Tab")},{name:"COMMAND_PAGE_MUTE_OTHER",action:e=>y.ZP.setMuting(e.windowId,"other","mute"),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"4cb148ba-cb83-4e4a-be3e-43b60a3f3982",...(0,$.Z)("Mute Other Tabs")},{name:"COMMAND_PAGE_MUTE_ALL",action:e=>y.ZP.setMuting(e.windowId,"all","mute"),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"431a57f8-a637-41e5-a4de-1b1c3be081db",...(0,$.Z)("Mute All Tabs")},{name:"COMMAND_PAGE_UNMUTE_OTHER",action:e=>y.ZP.setMuting(e.windowId,"other","unmute"),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"4dc07cbf-4c8b-42ed-8117-c123834a76c5",...(0,$.Z)("Unmute Other Tabs")},{name:"COMMAND_PAGE_UNMUTE_ALL",action:e=>y.ZP.setMuting(e.windowId,"all","unmute"),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"9badb24d-1a7b-46fd-8e95-d50f93812911",...(0,$.Z)("Unmute All Tabs")},{name:"COMMAND_CAPTURE_PAGE_TO_DISK",action:e=>h.Z.captureActivePage(e.windowId,"file"),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"2fe0abe5-421c-4d9d-83ef-16e9f9deb9bb",...(0,$.Z)("Capture Page to File")},{name:"COMMAND_CAPTURE_PAGE_TO_CLIPBOARD",action:e=>h.Z.captureActivePage(e.windowId,"clipboard"),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"2a8349df-be2b-44e8-8db9-4f349a470790",...(0,$.Z)("Capture Page to Clipboard")},{name:"COMMAND_TAB_TRANSLATE_PAGE",action:e=>{const t=x.ZP.getActivePage(e.windowId);if(t&&m.Z.canTranslatePage(t.id))return j.Z.translatePage(t.id)},isEnabled:Ce.Z,isVisible:e=>{if(U.ZP.isSettings(e))return!0;{const t=x.ZP.getActivePage(e);return!!t&&m.Z.canTranslatePage(t.id)}},showInQC:!0,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"8d7a4844-f2d5-4cfe-abcd-e2fd99005a41",...(0,$.Z)("tab","Translate Page")},{name:"COMMAND_IMPORT_DATA",action:e=>b.Z.showImportDataDialog(e.windowId),isEnabled:Ce.Z,isVisible:e=>!U.ZP.isGuest(),showInQC:!0,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"6c851825-1e73-4ec5-ad5e-2ec9c826524c",...(0,$.Z)("command","Import from Applications or Files")},{name:"COMMAND_EXPORT_DATA",action:e=>Y.Z.bookmarksPrivate.export(e.windowId),isEnabled:Ce.Z,isVisible:e=>!U.ZP.isGuest(),showInQC:!0,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"fba8ba2b-f317-463a-b685-6d3fb7040845",...(0,$.Z)("Export Bookmarks")},{name:"COMMAND_EXPORT_PASSWORDS",action:e=>(0,he.T)(e.windowId),showInQC:!0,isEnabled:Ce.Z,isVisible:e=>!U.ZP.isGuest(),category:"CATEGORY_COMMAND_APPLICATION",guid:"5cb22644-38b0-4cf1-af79-e9b7ee60b26a",...(0,$.Z)("Export Passwords")},{name:"COMMAND_EXPORT_READINGLIST",action:e=>(0,ce.M8)(e.windowId),showInQC:!0,isEnabled:Ce.Z,isVisible:e=>!U.ZP.isGuest(),category:"CATEGORY_COMMAND_APPLICATION",guid:"cf5461e8-938d-484c-b461-6eb9f90bdd6f",...(0,$.Z)("Export Reading List")},{name:"COMMAND_IMPORT_READINGLIST",action:e=>(0,ce.l_)(e.windowId),showInQC:!0,isEnabled:Ce.Z,isVisible:e=>!U.ZP.isGuest(),category:"CATEGORY_COMMAND_APPLICATION",guid:"1652b912-2733-4b37-806a-ca935e509c8f",...(0,$.Z)("Import Reading List")},{name:"COMMAND_EXPORT_NOTES",action:e=>(0,te.aT)(e.windowId),showInQC:!0,isEnabled:Ce.Z,isVisible:e=>!U.ZP.isGuest(),category:"CATEGORY_COMMAND_APPLICATION",guid:"fe0e224c-a903-4952-ae3d-d69d8777c24a",...(0,$.Z)("Export Notes")},{name:"COMMAND_IMPORT_NOTES",action:e=>(0,te.T$)(e.windowId),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"db20661f-37e9-4376-94c8-9aebc7a27628",...(0,$.Z)("Import Notes")},{name:"COMMAND_EXPORT_FEEDS",action:e=>de(e.windowId),showInQC:()=>ke(),isEnabled:Ce.Z,isVisible:()=>ke(),category:"CATEGORY_COMMAND_APPLICATION",guid:"69f50b42-e844-43c4-a9b5-7feed981d431",...(0,$.Z)("Export Feeds")},{name:"COMMAND_NEW_TAB_LINK",action:e=>{"string"==typeof e.param&&y.ZP.openURL(e.windowId,e.param,{addOpenerTabId:!0})},inMenu:we.Z,isEnabled:Ce.Z,isVisible:Ce.Z,showInQC:!1,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"62966533-b4f6-4f86-a02c-9753948c6277",...(0,$.Z)("Open Link in New Tab (Over a Link)")},{name:"COMMAND_NEW_BACKGROUND_TAB_LINK",action:e=>{"string"==typeof e.param&&y.ZP.openURL(e.windowId,e.param,{inBackground:!0,addOpenerTabId:!0})},inMenu:we.Z,isEnabled:Ce.Z,isVisible:Ce.Z,showInQC:!1,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"db3df40a-0d5f-4f87-a57a-cf9640e401c3",...(0,$.Z)("Open Link in Background Tab (Over a Link)")},{name:"COMMAND_READERVIEW_TOGGLE",action:e=>{const t=x.ZP.getActivePage(e.windowId);t&&k.Z.toggleReaderMode(t)},showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"8dd47fc9-4c1f-4487-a475-f55bfa61aaf2",...(0,$.Z)("Toggle Reader View")},{name:"COMMAND_BOOKMARK_SELECTED_TABS",action:e=>p.Z.onCommand(e.windowId,"COMMAND_BOOKMARK_SELECTED_TABS"),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"12bef254-49e1-4205-b14e-acd4d3b4238b",...(0,$.Z)("Bookmark Selected Tabs")},{name:"COMMAND_SAVE_SESSION",action:e=>b.Z.showSaveSessionDialog(e.windowId,{mode:"all"}),isEnabled:Ce.Z,isVisible:e=>!U.ZP.isGuest(),showInQC:!0,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"ec8eb1b8-53ef-48f8-bbdc-d0c44af2d5cd",...(0,$.Z)("command","Save All Tabs as Session")},{name:"COMMAND_SAVE_SELECTED_SESSION",action:e=>p.Z.onCommand(e.windowId,"COMMAND_SAVE_SELECTED_SESSION"),isEnabled:Ce.Z,isVisible:e=>!U.ZP.isGuest(),showInQC:!0,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"0fe4c500-31cf-4d73-8dc1-281eb4259fe7",...(0,$.Z)("command","Save Selected Tabs as Session")},{name:"COMMAND_OPEN_SESSION",action:e=>b.Z.showOpenSessionDialog(e.windowId),isEnabled:Ce.Z,isVisible:e=>!U.ZP.isGuest(),showInQC:!0,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"4a65bd2a-ec3c-42ca-ac7a-67040fe8cebc",...(0,$.Z)("Open Saved Session")},{name:"COMMAND_ADD_BOOKMARK",action:e=>{const t=x.ZP.getActivePage(e.windowId);t&&B.Z.doAction(e.windowId,t.id,"addBookmark")},isEnabled:Ce.Z,isVisible:e=>!U.ZP.isGuest(),showInQC:!0,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"844219eb-ed35-4b17-a9f4-7789466c233c",...(0,$.Z)("Create Bookmark")},{name:"COMMAND_ADD_TO_READING_LIST",action:e=>n.Ey(e.windowId,x.ZP.getSelectedPages(e.windowId)),isEnabled:Ce.Z,isVisible:e=>!U.ZP.isGuest(),showInQC:!0,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"a73687bc-ddc6-4011-9255-d2ff6a742279",...(0,$.Z)("Add Page to Reading List")},{name:"COMMAND_ADD_TO_WEB_PANEL",action:e=>{const t=x.ZP.getActivePage(e.windowId);t&&R.Z.addByUrl(e.windowId,t.url,!0)},isEnabled:Ce.Z,isVisible:e=>!U.ZP.isGuest(),showInQC:!0,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"bd696db9-8c4d-47cb-9899-1f3ac3797c4c",...(0,$.Z)("Add Page to Web Panel")},{name:"COMMAND_BLOCK_TRACKING",action:e=>{const t=x.ZP.getActivePage(e.windowId);t&&(0,ee.Fe)(t.id,t.url,"tracking")},isEnabled:Ce.Z,isVisible:e=>!U.ZP.isGuest(),showInQC:!0,category:"CATEGORY_COMMAND_APPLICATION",guid:"9afb77f2-d3d3-4596-8a04-58ab48a345fa",...(0,$.Z)("Block / Unblock Tracking")},{name:"COMMAND_BLOCK_TRACKING_AND_ADS",action:e=>{const t=x.ZP.getActivePage(e.windowId);t&&(0,ee.Fe)(t.id,t.url,"ad_blocking")},isEnabled:Ce.Z,isVisible:e=>!U.ZP.isGuest(),showInQC:!0,category:"CATEGORY_COMMAND_APPLICATION",guid:"da2af162-2140-4aae-8366-3add4793ac17",...(0,$.Z)("Block / Unblock Ads and Tracking")},{name:"COMMAND_FOCUS_ADDRESSFIELD",action:e=>{const t=x.ZP.getActivePage(e.windowId);t&&B.Z.doAction(e.windowId,t.id,"focusAddressField")},showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"96a396d8-d485-4f61-926b-bdab1eddaf94",...(0,$.Z)("Focus Address Field")},{name:"COMMAND_SHOW_DOWNLOADS_POPOUT",action:e=>p.Z.onCommand(e.windowId,"COMMAND_SHOW_DOWNLOADS_POPOUT"),showInQC:!0,category:"CATEGORY_COMMAND_APPLICATION",guid:"a1244975-7c9b-465d-90cf-da919d4598bf",isEnabled:Ce.Z,isVisible:e=>(0,ge.PK)("DownloadButton",e),...(0,$.Z)("Open Downloads Popup")},{name:"COMMAND_PAGE_REFRESH",action:e=>{const t=x.ZP.getActivePage(e.windowId);t&&B.Z.reload(e.windowId,t.id,!1)},showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"bc31a027-870d-40ba-b3f1-20adcff8fff2",...(0,$.Z)("Reload Page")},{name:"COMMAND_PAGE_RELOAD_NOCACHE",action:e=>{const t=x.ZP.getActivePage(e.windowId);t&&B.Z.reload(e.windowId,t.id,!0)},showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"d92c060c-a9f7-490c-a4a0-8c5cccfa09dd",...(0,$.Z)("Force Page Reload")},{name:"COMMAND_PAGE_SCROLL_UP",action:e=>{const t=x.ZP.getActivePage(e.windowId);t&&B.Z.doAction(e.windowId,t.id,"pageScrollUp")},repeat:!0,showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"078f10b2-1901-4f9e-97b3-1018f7633099",...(0,$.Z)("Page Up")},{name:"COMMAND_PAGE_SCROLL_DOWN",action:e=>{const t=x.ZP.getActivePage(e.windowId);t&&B.Z.doAction(e.windowId,t.id,"pageScrollDown")},repeat:!0,showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"eae41430-4ed9-48e5-9e91-90aeefdb4b4e",...(0,$.Z)("Page Down")},{name:"COMMAND_PAGE_SCROLL_TOP",action:e=>{const t=x.ZP.getActivePage(e.windowId);t&&B.Z.doAction(e.windowId,t.id,"pageScrollTop")},showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"f74cd1f0-c90c-4a2e-8b7b-f06d88cad75a",...(0,$.Z)("Scroll Page to Top")},{name:"COMMAND_PAGE_SCROLL_BOTTOM",action:e=>{const t=x.ZP.getActivePage(e.windowId);t&&B.Z.doAction(e.windowId,t.id,"pageScrollBottom")},showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"29bbb63b-b356-4dfe-aa45-9cf39d94d279",...(0,$.Z)("Scroll Page to Bottom")},{name:"COMMAND_FOCUS_WEBVIEW",action:e=>{const t=x.ZP.getActivePage(e.windowId);t&&B.Z.doAction(e.windowId,t.id,"focusWebView")},showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"f71373d5-f966-4603-b7c5-a4a1722b3989",...(0,$.Z)("Focus Page")},{name:"COMMAND_PAGE_DISABLE_KEYBOARD_SHORTCUTS",action:()=>T.Z.toggle(ae.kKeyboardShortcutsEnable,!0,!1),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"88d6a31d-9d50-4c8f-a9a2-207ac2b600c3",...(0,$.Z)("Toggle Keyboard Shortcuts")},{name:"COMMAND_FOCUS_SEARCHFIELD",action:e=>{const t=x.ZP.getActivePage(e.windowId);t&&B.Z.doAction(e.windowId,t.id,"focusSearchField")},showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"eead069f-a0b5-4f2c-add7-051003353311",...(0,$.Z)("Focus Search Field")},{name:"COMMAND_FIND_IN_PAGE",action:e=>{const t=x.ZP.getActivePage(e.windowId);t&&(E.Z.get(ae.kWebpagesFindShortcutIsAToggle)&&F.Z.isFindInPageOpen(t.id)?B.Z.closeFindInPageToolbar(e.windowId,t.id):B.Z.doAction(e.windowId,t.id,"findInPage"))},showInQC:!0,isEnabled:e=>Pe(e),isVisible:Ce.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"3686e24b-c64b-4402-9b79-d58dc92c29a8",...(0,$.Z)("Find in Page")},{name:"COMMAND_FIND_NEXT_IN_PAGE",action:e=>{const t=x.ZP.getActivePage(e.windowId);t&&B.Z.doAction(e.windowId,t.id,"findNextInPage")},repeat:!0,showInQC:!0,isEnabled:e=>Pe(e),isVisible:Ce.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"055c6e9c-2b9c-4170-aeb0-43f3caf35c3e",...(0,$.Z)("Find Next in Page")},{name:"COMMAND_FIND_PREVIOUS_IN_PAGE",action:e=>{const t=x.ZP.getActivePage(e.windowId);t&&B.Z.doAction(e.windowId,t.id,"findPreviousInPage")},repeat:!0,showInQC:!0,isEnabled:e=>Pe(e),isVisible:Ce.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"ef2ad516-3e00-4e9f-9dc3-b1bccd1cc317",...(0,$.Z)("Find Previous in Page")},{name:"COMMAND_PAGE_BACK",action:e=>{const t=x.ZP.getActivePage(e.windowId);t&&B.Z.back(e.windowId,t.id)},showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"f8f93b48-b1ed-43c3-bd65-e7240fd76d3f",...(0,$.Z)("History Back")},{name:"COMMAND_PAGE_FORWARD",action:e=>{const t=x.ZP.getActivePage(e.windowId);t&&B.Z.forward(e.windowId,t.id)},showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"b00e2d3c-a9ba-49b8-bce7-1faf1894a5f3",...(0,$.Z)("History Forward")},{name:"COMMAND_PAGE_REWIND",action:e=>g.Z.navigateRewind(e.windowId),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"67c60e96-fab2-433b-a012-107daa3856ef",...(0,$.Z)("History Rewind")},{name:"COMMAND_PAGE_FAST_FORWARD",action:e=>g.Z.navigateFastforward(e.windowId),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"964655e4-0274-4e26-82a7-b15161958009",...(0,$.Z)("Fast Forward")},{name:"COMMAND_GO_TO_PARENT_DIRECTORY",action:e=>{const t=x.ZP.getActivePage(e.windowId);t&&y.ZP.gotoParentDirectory(e.windowId,t)},showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"c74300b6-635c-4471-b930-8707f29aa94c",...(0,$.Z)("Go to Parent Directory")},{name:"COMMAND_PRINT_PAGE",action:e=>{const t=x.ZP.getActivePage(e.windowId);t&&B.Z.doAction(e.windowId,t.id,"print")},showInQC:!0,isEnabled:e=>Pe(e),isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"9fbbe402-d11b-479d-ab97-e7e6deb10d36",...(0,$.Z)("Print")},{name:"COMMAND_STOP_PAGE",action:e=>{const t=x.ZP.getActivePage(e.windowId);t&&B.Z.stop(e.windowId,t.id)},showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"77dfb30f-d825-4089-a042-c3f664c656b5",...(0,$.Z)("Stop Loading")},{name:"COMMAND_OPEN_PAGE",action:e=>{Y.Z.utilities.openPage(e.windowId)},withNoWindow:!0,showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"e513ed70-7241-4722-83cb-4e8d10da8f02",...(0,$.Z)("a file","Open File")},{name:"COMMAND_SAVE_PAGE",action:e=>{const t=x.ZP.getActivePage(e.windowId);t&&(0,be.Jq)(e.windowId,t.id)},showInQC:!0,isEnabled:e=>Pe(e),isVisible:Ce.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"a60f2f63-dd5a-46a6-b425-40e423e88fc0",...(0,$.Z)("Save Page As")},{name:"COMMAND_SEARCH_WITH_SELECTION",action:e=>N.Z.withPageSelection(e.windowId),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"1599c08b-51f2-413b-a572-dcacb43560b2",...(0,$.Z)("Search with Selection")},{name:"COMMAND_DEFAULT_MAIN_ZOOM",action:e=>{"number"==typeof e.param&&H.Z.setDefaultWebPageZoom(e.param)},category:"CATEGORY_COMMAND_APPEARANCE",isEnabled:e=>Pe(e),isVisible:Ce.Z,showInQC:!0,guid:"e918fdc6-64f0-47a1-aa29-d0f057dedb60",...(0,$.Z)("Default Page Zoom")},{name:"COMMAND_MAIN_ZOOM",action:e=>{"number"==typeof e.param&&H.Z.setPageZoomPercentage(e.windowId,e.param)},category:"CATEGORY_COMMAND_APPEARANCE",isEnabled:e=>Pe(e),isVisible:Ce.Z,showInQC:!0,guid:"9a6682a0-9a28-4e44-b9f9-fc554f02c363",...(0,$.Z)("Page Zoom")},{name:"COMMAND_MAIN_ZOOM_IN",action:e=>H.Z.pageZoomIn(e.windowId),isEnabled:e=>Pe(e),isVisible:Ce.Z,showInQC:!0,category:"CATEGORY_COMMAND_APPEARANCE",guid:"9f04836a-e0cb-4220-93dd-57d0a606ee11",...(0,$.Z)("Page Zoom In")},{name:"COMMAND_MAIN_ZOOM_OUT",action:e=>H.Z.pageZoomOut(e.windowId),isEnabled:e=>Pe(e),isVisible:Ce.Z,showInQC:e=>Pe(e),category:"CATEGORY_COMMAND_APPEARANCE",guid:"f68b5e96-3c0c-49cb-a8f9-d23b43182bc0",...(0,$.Z)("Page Zoom Out")},{name:"COMMAND_MAIN_ZOOM_HALF",action:e=>H.Z.pageZoomHalf(e.windowId),showInQC:!0,isEnabled:e=>Pe(e),isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"d5959c06-f090-4f5e-8470-7871986393ab",...(0,$.Z)("Page Zoom Out Half")},{name:"COMMAND_MAIN_ZOOM_DOUBLE",action:e=>H.Z.pageZoomDouble(e.windowId),showInQC:!0,isEnabled:e=>Pe(e),isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"dd72265d-01e1-483e-a50f-5b018ca20151",...(0,$.Z)("Page Zoom In Double")},{name:"COMMAND_MAIN_ZOOM_RESET",action:e=>H.Z.pageZoomReset(e.windowId),showInQC:!0,isEnabled:e=>Pe(e),isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"483984bb-e647-4ed5-aae8-f82ef947b450",...(0,$.Z)("Page Zoom Reset")},{name:"COMMAND_MAIN_UI_ZOOM",action:e=>{"number"==typeof e.param&&H.Z.setUIZoomPercentage(e.param)},category:"CATEGORY_COMMAND_APPEARANCE",showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,guid:"6884b1a9-0cfc-4456-8d1b-9cb73c99703f",...(0,$.Z)("UI Zoom")},{name:"COMMAND_MAIN_UI_ZOOM_IN",action:()=>H.Z.uiZoomIn(),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"b56f4b61-eff8-4d57-af15-a19fba06c587",...(0,$.Z)("UI Zoom In")},{name:"COMMAND_MAIN_UI_ZOOM_OUT",action:()=>H.Z.uiZoomOut(),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"d62013de-e829-4454-ab03-71a864341009",...(0,$.Z)("UI Zoom Out")},{name:"COMMAND_MAIN_UI_ZOOM_RESET",action:()=>H.Z.setUIZoomPercentage(100),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"a62aaffc-305b-4892-90c3-5839c0650260",...(0,$.Z)("UI Zoom Reset")},{name:"COMMAND_TAB_VIEW_PAGE_SOURCE",action:e=>{x.ZP.getActivePage(e.windowId)?.isMailPage?p.Z.onCommand(e.windowId,"COMMAND_TAB_VIEW_PAGE_SOURCE"):M.viewPageSource(e.windowId)},showInQC:!0,isEnabled:e=>Pe(e),isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"7c42ad51-fab5-46c5-acff-663947a13c96",...(0,$.Z)("View Page Source")},{name:"COMMAND_DEVELOPER_TOOLS",action:e=>Y.Z.devtoolsPrivate.toggleDevtools(e.windowId,"default"),showInQC:!0,isEnabled:Ce.Z,isVisible:e=>!x.ZP.isActiveInternal(e),category:"CATEGORY_COMMAND_APPLICATION",guid:"cdc3b594-d57f-417d-89ee-69be8facd3aa",...(0,$.Z)("Toggle Developer Tools")},{name:"COMMAND_DEVTOOLS_INSPECTOR",action:e=>Y.Z.devtoolsPrivate.toggleDevtools(e.windowId,"inspect"),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"e6a1c7d5-21ad-4195-bc9e-95ebcb6ee2eb",...(0,$.Z)("Developer Tools Elements")},{name:"COMMAND_DEVTOOLS_CONSOLE",action:e=>Y.Z.devtoolsPrivate.toggleDevtools(e.windowId,"console"),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"1e335c06-1036-4b76-be45-20fea16ab840",...(0,$.Z)("Developer Tools Console")},{name:"COMMAND_SHOW_HOMEPAGE",action:e=>y.ZP.showHomepage(e.windowId,{inCurrent:!0}),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"51eac690-a178-4a3e-99dd-32c73f923559",...(0,$.Z)("title","Homepage")},{name:"COMMAND_TOGGLE_PANEL",action:e=>I.Z.togglePanel(e.windowId),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"5cbd037c-973a-4c3d-aa43-5454bc0ec0e4",...(0,$.Z)("command","Panel")},{name:"COMMAND_FOCUS_PANEL",action:e=>I.Z.setFocus(e.windowId),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"efaed294-3e8e-42fa-9a47-d121e6a11e5f",...(0,$.Z)("Focus Panel")},{name:"COMMAND_FOCUS_PANELBAR",action:e=>p.Z.onCommand(e.windowId,"COMMAND_FOCUS_PANELBAR"),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"454b1c03-0570-4977-99e8-337a1aafdb70",...(0,$.Z)("Focus Panel Controls")},{name:"COMMAND_FOCUS_MAINMENU",action:e=>p.Z.onCommand(e.windowId,"COMMAND_FOCUS_MAINMENU"),inMenu:()=>!0,showInQC:!0,isEnabled:Ce.Z,isVisible:()=>!0,platforms:["linux","windows"],category:"CATEGORY_COMMAND_APPEARANCE",guid:"bb1fc5ee-68bd-4e4f-ae16-43269ada0f69",...(0,$.Z)("Focus Main Menu")},{name:"COMMAND_FOCUS_BOOKMARKBAR",action:e=>p.Z.onCommand(e.windowId,"COMMAND_FOCUS_BOOKMARKBAR"),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"d2c3cb39-c495-4aca-bac5-23f2db06ccca",...(0,$.Z)("Focus Bookmarks Bar")},{name:"COMMAND_FOCUS_TABBAR",action:e=>p.Z.onCommand(e.windowId,"COMMAND_FOCUS_TABBAR"),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"ab5fd96a-effc-448f-afdf-2bef8cba6527",...(0,$.Z)("Focus Tab Bar")},{name:"COMMAND_TOGGLE_FLOATING_PANEL",action:()=>I.Z.toggleFloating(),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"b70131d8-1022-411e-89aa-096a8528ab45",...(0,$.Z)("Toggle Floating Panel")},{name:"COMMAND_SHOW_NEXT_PANEL",action:e=>I.Z.showNextPanel(e.windowId,"next"),showInQC:!0,isEnabled:Ce.Z,isVisible:e=>U.ZP.isSettings(e)||Boolean(A.ZP.getNextPanel(e,"next")),category:"CATEGORY_COMMAND_APPEARANCE",guid:"302fdcd3-d914-418f-895d-c4ede9b6c02e",...(0,$.Z)("Open Next Panel")},{name:"COMMAND_SHOW_PREVIOUS_PANEL",action:e=>I.Z.showNextPanel(e.windowId,"previous"),showInQC:!0,isEnabled:Ce.Z,isVisible:e=>U.ZP.isSettings(e)||Boolean(A.ZP.getNextPanel(e,"previous")),category:"CATEGORY_COMMAND_APPEARANCE",guid:"4569302b-1f24-440c-965c-da7f9bfca097",...(0,$.Z)("Open Previous Panel")},{name:"COMMAND_TOGGLE_CURRENT_PANEL",action:e=>I.Z.toggleCurrentPanel(e.windowId),showInQC:!0,isEnabled:Ce.Z,isVisible:e=>U.ZP.isSettings(e)||Boolean(A.ZP.getSelected(e)),category:"CATEGORY_COMMAND_APPEARANCE",guid:"4128d533-256b-41f1-ba47-3c435ca3f2b4",...(0,$.Z)("Toggle Current Panel")},{name:"COMMAND_SHOW_BOOKMARK_PANEL",action:e=>I.Z.toggleContent(e.windowId,"PanelBookmarks"),isEnabled:Ce.Z,isVisible:e=>A.ZP.hasPanel(e,"PanelBookmarks"),showInQC:!0,category:"CATEGORY_COMMAND_APPEARANCE",guid:"48ee057a-93c3-4be5-903b-6d2e701ecb96",...(0,$.Z)("title","Bookmarks Panel")},{name:"COMMAND_SHOW_READING_LIST_PANEL",action:e=>I.Z.toggleContent(e.windowId,"PanelReadingList"),showInQC:!0,isEnabled:Ce.Z,isVisible:e=>A.ZP.hasPanel(e,"PanelReadingList"),category:"CATEGORY_COMMAND_APPEARANCE",guid:"9e7b130e-f0af-40db-896d-1a29668bf694",...(0,$.Z)("title","Reading List Panel")},{name:"COMMAND_SHOW_DOWNLOADS_PANEL",action:e=>I.Z.toggleContent(e.windowId,"PanelDownloads"),showInQC:!0,isEnabled:Ce.Z,isVisible:e=>A.ZP.hasPanel(e,"PanelDownloads"),category:"CATEGORY_COMMAND_APPEARANCE",guid:"4fcaed1c-c5db-42a8-b47d-7e6674ecd252",...(0,$.Z)("title","Downloads Panel")},{name:"COMMAND_SHOW_HISTORY_PANEL",action:e=>I.Z.toggleContent(e.windowId,"PanelHistory"),isEnabled:Ce.Z,isVisible:e=>A.ZP.hasPanel(e,"PanelHistory"),showInQC:!0,category:"CATEGORY_COMMAND_APPEARANCE",guid:"d26038ee-d140-42c5-98b0-27f14b9a8645",...(0,$.Z)("title","History Panel")},{name:"COMMAND_SHOW_NOTES_PANEL",action:e=>I.Z.toggleContent(e.windowId,"PanelNotes"),isEnabled:Ce.Z,isVisible:e=>A.ZP.hasPanel(e,"PanelNotes"),showInQC:!0,category:"CATEGORY_COMMAND_APPEARANCE",guid:"96dc03a2-7c99-49ff-9055-f03ac6eb90fe",...(0,$.Z)("title","Notes Panel")},{name:"COMMAND_SHOW_TRANSLATE_PANEL",action:e=>I.Z.toggleContent(e.windowId,"PanelTranslate"),showInQC:!0,isEnabled:Ce.Z,isVisible:e=>A.ZP.hasPanel(e,"PanelTranslate"),category:"CATEGORY_COMMAND_APPEARANCE",guid:"ccba139c-9b00-42aa-88cf-6a04a8a15fa5",...(0,$.Z)("title","Translate Panel")},{name:"COMMAND_SHOW_WINDOW_PANEL",action:e=>I.Z.toggleContent(e.windowId,"PanelWindow"),showInQC:!0,isEnabled:Ce.Z,isVisible:e=>A.ZP.hasPanel(e,"PanelWindow"),category:"CATEGORY_COMMAND_APPEARANCE",guid:"7dc09b96-d5f1-4999-b2da-d8dd1f1e1651",...(0,$.Z)("title","Windows Panel")},{name:"COMMAND_SHOW_SESSION_PANEL",action:e=>I.Z.toggleContent(e.windowId,"PanelSession"),showInQC:!0,isEnabled:Ce.Z,isVisible:e=>A.ZP.hasPanel(e,"PanelSession"),category:"CATEGORY_COMMAND_APPEARANCE",guid:"7cc70878-1af1-4df6-af17-bf843efead3e",...(0,$.Z)("title","Session Panel")},{name:"COMMAND_SHOW_MAIL_PANEL",action:e=>I.Z.toggleContent(e.windowId,"PanelMail"),showInQC:e=>U.ZP.isMail(e),isEnabled:Ce.Z,isVisible:e=>A.ZP.hasPanel(e,"PanelMail"),category:"CATEGORY_COMMAND_APPEARANCE",guid:"66a51de3-2c98-468a-ac92-0728cd798ca5",...(0,$.Z)("title","Mail Panel")},{name:"COMMAND_SHOW_CALENDAR_PANEL",action:e=>I.Z.toggleContent(e.windowId,"PanelCalendar"),isEnabled:Ce.Z,isVisible:e=>A.ZP.hasPanel(e,"PanelCalendar"),showInQC:!0,category:"CATEGORY_COMMAND_APPEARANCE",guid:"a01cf36b-2f32-4919-924b-80e4e14a41b2",...(0,$.Z)("title","Calendar Panel")},{name:"COMMAND_SHOW_TASKS_PANEL",action:e=>I.Z.toggleContent(e.windowId,"PanelTasks"),isEnabled:Ce.Z,isVisible:e=>A.ZP.hasPanel(e,"PanelTasks"),showInQC:!0,category:"CATEGORY_COMMAND_APPEARANCE",guid:"2a76f559-b679-40cc-b3cc-a308d65fa853",...(0,$.Z)("title","Tasks Panel")},{name:"COMMAND_SHOW_FEEDS_PANEL",action:e=>I.Z.toggleContent(e.windowId,"PanelFeeds"),showInQC:e=>U.ZP.isMail(e),isEnabled:Ce.Z,isVisible:e=>A.ZP.hasPanel(e,"PanelFeeds"),category:"CATEGORY_COMMAND_APPEARANCE",guid:"9e682c56-34e8-48b8-88d4-b1f716e0bc9c",...(0,$.Z)("title","Feeds Panel")},{name:"COMMAND_SHOW_CONTACTS_PANEL",action:e=>I.Z.toggleContent(e.windowId,"PanelContacts"),showInQC:e=>U.ZP.isMail(e),isEnabled:Ce.Z,isVisible:e=>A.ZP.hasPanel(e,"PanelContacts"),category:"CATEGORY_COMMAND_APPEARANCE",guid:"9492e500-30da-44fc-a28b-88c22a06c304",...(0,$.Z)("title","Contacts Panel")},{name:"COMMAND_SHOW_WEB_PANEL_1",action:e=>I.Z.toggleContent(e.windowId,"webpanel 1"),showInQC:!0,isEnabled:Ce.Z,isVisible:e=>U.ZP.isSettings(e)||A.ZP.hasWebPanel(e,1),category:"CATEGORY_COMMAND_APPEARANCE",guid:"9a724d62-6b4f-4bec-affe-31a05966ccf9",...(0,$.Z)("Web Panel 1")},{name:"COMMAND_SHOW_WEB_PANEL_2",action:e=>I.Z.toggleContent(e.windowId,"webpanel 2"),showInQC:!0,isEnabled:Ce.Z,isVisible:e=>U.ZP.isSettings(e)||A.ZP.hasWebPanel(e,2),category:"CATEGORY_COMMAND_APPEARANCE",guid:"a0ed3813-af8f-42af-8466-bbaf197bb5a6",...(0,$.Z)("Web Panel 2")},{name:"COMMAND_SHOW_WEB_PANEL_3",action:e=>I.Z.toggleContent(e.windowId,"webpanel 3"),showInQC:!0,isEnabled:Ce.Z,isVisible:e=>U.ZP.isSettings(e)||A.ZP.hasWebPanel(e,3),category:"CATEGORY_COMMAND_APPEARANCE",guid:"a28d673c-5242-4330-aff1-b5df09dfad7c",...(0,$.Z)("Web Panel 3")},{name:"COMMAND_SHOW_WEB_PANEL_4",action:e=>I.Z.toggleContent(e.windowId,"webpanel 4"),showInQC:!0,isEnabled:Ce.Z,isVisible:e=>U.ZP.isSettings(e)||A.ZP.hasWebPanel(e,4),category:"CATEGORY_COMMAND_APPEARANCE",guid:"a13f216c-d341-4057-a573-0b954dcde28f",...(0,$.Z)("Web Panel 4")},{name:"COMMAND_SHOW_WEB_PANEL_5",action:e=>I.Z.toggleContent(e.windowId,"webpanel 5"),showInQC:!0,isEnabled:Ce.Z,isVisible:e=>U.ZP.isSettings(e)||A.ZP.hasWebPanel(e,5),category:"CATEGORY_COMMAND_APPEARANCE",guid:"e859c95a-52fc-4c30-87cc-768fd35cd5b9",...(0,$.Z)("Web Panel 5")},{name:"COMMAND_SHOW_WEB_PANEL_6",action:e=>I.Z.toggleContent(e.windowId,"webpanel 6"),showInQC:!0,isEnabled:Ce.Z,isVisible:e=>U.ZP.isSettings(e)||A.ZP.hasWebPanel(e,6),category:"CATEGORY_COMMAND_APPEARANCE",guid:"61c088f8-a1b3-4a73-a359-08796372e33a",...(0,$.Z)("Web Panel 6")},{name:"COMMAND_SHOW_WEB_PANEL_7",action:e=>I.Z.toggleContent(e.windowId,"webpanel 7"),showInQC:!0,isEnabled:Ce.Z,isVisible:e=>U.ZP.isSettings(e)||A.ZP.hasWebPanel(e,7),category:"CATEGORY_COMMAND_APPEARANCE",guid:"6fff7b4d-a154-4945-aacf-e57bc67afde8",...(0,$.Z)("Web Panel 7")},{name:"COMMAND_SHOW_WEB_PANEL_8",action:e=>I.Z.toggleContent(e.windowId,"webpanel 8"),showInQC:!0,isEnabled:Ce.Z,isVisible:e=>U.ZP.isSettings(e)||A.ZP.hasWebPanel(e,9),category:"CATEGORY_COMMAND_APPEARANCE",guid:"26e5191f-7c81-4d3b-a499-e8945a9a6ec3",...(0,$.Z)("Web Panel 8")},{name:"COMMAND_SHOW_WEB_PANEL_9",action:e=>I.Z.toggleContent(e.windowId,"webpanel 9"),showInQC:!0,isEnabled:Ce.Z,isVisible:e=>U.ZP.isSettings(e)||A.ZP.hasWebPanel(e,9),category:"CATEGORY_COMMAND_APPEARANCE",guid:"b0732781-fdf6-4ba8-8fcf-6d94f24edc37",...(0,$.Z)("Web Panel 9")},{name:"COMMAND_COPY_SELECTION_TO_NOTE",action:async e=>{const t=x.ZP.getActivePage(e.windowId);if(t){const s=await Y.Z.utilities.getSelectedText(t.id);await C.Z.createNote(e.windowId,{content:s,url:t.url,type:"note"})}},isEnabled:Ce.Z,isVisible:e=>!U.ZP.isGuest(),showInQC:!0,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"fa2d0620-4233-4d59-ab5d-e868fb52ad03",...(0,$.Z)("Copy Selected Text to Note")},{name:"COMMAND_APPEND_SELECTION_TO_NOTE",action:async e=>{const t=x.ZP.getActivePage(e.windowId);if(t){const s=await Y.Z.utilities.getSelectedText(t.id);b.Z.showNoteSelectionDialog(e.windowId,{onSelected:e=>C.Z.appendToNode(e,s)})}},isEnabled:()=>w.ZP.hasNotes(),isVisible:e=>!U.ZP.isGuest(),showInQC:!0,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"1fe5dfa8-c044-4b3c-a36d-24a8d00de8be",...(0,$.Z)("Append Selected Text to Note")},{name:"COMMAND_TRANSLATE_SELECTION",action:async e=>{const t=x.ZP.getActivePage(e.windowId);if(t){const s=t.id,n=await Y.Z.utilities.getSelectedText(s);n&&m.Z.canTranslateText(n,t.url,s)&&j.Z.translateSelection(e.windowId,s,n)}},isEnabled:Ce.Z,isVisible:Ce.Z,showInQC:!0,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"25326646-7412-4be5-b478-6e74f1190a56",...(0,$.Z)("Translate Selected Text")},{name:"COMMAND_PAGE_QR_CODE",action:e=>{const t=x.ZP.getActivePage(e.windowId);t&&Y.Z.utilities.createQRCode(t.id)},showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"fef3ca9a-341e-4814-9709-d9a070263882",...(0,$.Z)("Create QR Code for Active Page")},{name:"COMMAND_SPATNAV_LEFT",action:e=>_.Z.left(e.windowId),repeat:!0,inMenu:we.Z,showInQC:!1,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"466272ae-7b00-4113-bdb3-159ae29e848c",...(0,$.Z)("Spatial Navigation Left")},{name:"COMMAND_SPATNAV_UP",action:e=>_.Z.up(e.windowId),repeat:!0,inMenu:we.Z,showInQC:!1,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"527416b5-8d0f-4d05-b251-9a1c70cbbb11",...(0,$.Z)("Spatial Navigation Up")},{name:"COMMAND_SPATNAV_RIGHT",action:e=>_.Z.right(e.windowId),repeat:!0,inMenu:we.Z,showInQC:!1,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"0a095dee-caba-457d-b119-6a9cc12c9496",...(0,$.Z)("Spatial Navigation Right")},{name:"COMMAND_SPATNAV_DOWN",action:e=>_.Z.down(e.windowId),repeat:!0,inMenu:we.Z,showInQC:!1,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"b554b968-c3b1-4522-a927-07d3d5bf74a3",...(0,$.Z)("Spatial Navigation Down")},{name:"COMMAND_CLIPBOARD_UNDO",action:e=>u.Z.undo(e.windowId),showInQC:!1,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"fb89c51c-3fe7-4bab-b9f6-27174e89b76d",...(0,$.Z)("win_linux","Undo")},{name:"COMMAND_CLIPBOARD_REDO",action:e=>u.Z.redo(e.windowId),showInQC:!1,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"cfd7113d-8501-4fee-b8e3-c776297620d5",...(0,$.Z)("win_linux","Redo")},{name:"COMMAND_CLIPBOARD_CUT",action:e=>u.Z.cut(e.windowId),showInQC:!1,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"ef5d4a31-9ca0-424e-a3af-ec9770084dca",...(0,$.Z)("win_linux","Cut")},{name:"COMMAND_CLIPBOARD_COPY",action:e=>u.Z.copy(e.windowId),showInQC:!1,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"6dae1e1a-695b-41c5-9ca9-deb1fabe9cc9",...(0,$.Z)("win_linux","Copy")},{name:"COMMAND_CLIPBOARD_PASTE",action:e=>u.Z.paste(e.windowId),showInQC:!1,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"aa12b05a-94cf-4660-8272-37da19294192",...(0,$.Z)("win_linux","Paste")},{name:"COMMAND_CLIPBOARD_SELECT_ALL",action:e=>u.Z.selectAll(e.windowId),showInQC:!1,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"ce41214f-6878-42ef-b120-3deb06cfcf2e",...(0,$.Z)("win_linux","Select All")},{name:"COMMAND_CLIPBOARD_PASTE_AS_PLAIN_TEXT",action:e=>{x.ZP.getActivePage(e.windowId)&&u.Z.pasteAsPlainText(e.windowId)},showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"bac47f7e-084f-4255-b27e-24f767aa300b",...(0,$.Z)("Paste as Plain Text")},{name:"COMMAND_CLIPBOARD_PASTE_AS_PLAIN_TEXT_OR_PASTE_AND_GO",action:e=>{const t=x.ZP.getActivePage(e.windowId);t&&u.Z.pasteAsPlainTextOrPasteAndGo(e.windowId,t.id)},category:"CATEGORY_COMMAND_APPLICATION",showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,guid:"1ca0b67d-f911-4141-949b-09c728430f2f",...(0,$.Z)("Paste and Go")},{name:"COMMAND_CLIPBOARD_PASTE_AS_NOTE",action:e=>u.Z.createNoteFromSelection(e.windowId),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"eb19c8a1-019b-4eea-a159-4e7efaa7737a",...(0,$.Z)("Paste to New Note")},{name:"COMMAND_WINDOW_MINIMIZE",action:e=>W.Z.minimize(e.windowId),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"855ad23f-900b-42bf-af4d-4ce6b419ce09",...(0,$.Z)("Minimize")},{name:"COMMAND_WINDOW_MINIMIZE_ALL",action:()=>W.Z.minimizeAll(),showInQC:!0,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"9f6124ef-e8ed-4143-b9ca-5a4beb646e3d",...(0,$.Z)("Minimize All")},{name:"COMMAND_HIDE_OTHERS",action:()=>{},showInQC:!1,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"f1a77d87-7c3c-45be-9402-91d111381491",...(0,$.Z)("Hide Others")},{name:"COMMAND_HIDE_VIVALDI",action:()=>{},showInQC:!1,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"75e245b8-1cce-44e3-87f5-2cade5e26f6a",...(0,$.Z)("Hide $1",["Vivaldi"])},{name:"COMMAND_SHOW_ALL",action:()=>{},showInQC:!1,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"776628a4-a989-4373-922b-b16477bbb811",...(0,$.Z)("mac","Show All")},{name:"COMMAND_OPEN_LINK",action:()=>{},withNoWindow:!0,inMenu:we.Z,showInQC:!1,isEnabled:Ce.Z,isVisible:Ce.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"e1ecbf58-47e1-4eb1-92f5-3ff610aadd53",...(0,$.Z)("Open Link")},{name:"COMMAND_SHOW_CALENDAR",action:e=>b.Z.showCalendar(e.windowId),withNoWindow:!0,isEnabled:Ce.Z,isVisible:()=>Ee(),showInQC:!0,category:"CATEGORY_COMMAND_APPLICATION",guid:"67287254-750b-4dbd-b290-cdc1b4906c2c",...(0,$.Z)("Calendar")},{name:"COMMAND_ADD_CALENDAR_EVENT",action:e=>l.ZP.showAddEvent({winId:e.windowId}),isEnabled:Ce.Z,isVisible:()=>Ee(),showInQC:!0,category:"CATEGORY_COMMAND_APPLICATION",guid:"594afe15-9134-49e6-9aa8-1f50b0925ef8",...(0,$.Z)("Add Calendar Event (Dialog)")},{name:"COMMAND_ADD_CALENDAR_EVENT_WITH_INVITE",action:e=>l.ZP.showAddInvite({winId:e.windowId}),isEnabled:Ce.Z,isVisible:()=>Ee(),showInQC:!0,category:"CATEGORY_COMMAND_APPLICATION",guid:"2103c92b-0f94-40b0-a671-e7ec28aa039c",...(0,$.Z)("Add Calendar Invite (Dialog)")},{name:"COMMAND_ADD_CALENDAR_TASK",action:e=>l.ZP.showAddTask({winId:e.windowId}),isEnabled:Ce.Z,isVisible:()=>Ee(),showInQC:!0,category:"CATEGORY_COMMAND_APPLICATION",guid:"af824936-b966-4d61-8114-380973e87dd2",...(0,$.Z)("Add Calendar Task (Dialog)")},{name:"COMMAND_ADD_NEW_CALENDAR_ACCOUNT",action:e=>b.Z.showCalendarAccountDialog(e.windowId),isEnabled:Ce.Z,isVisible:()=>Ee(),showInQC:!0,category:"CATEGORY_COMMAND_APPLICATION",guid:"a379c8cf-024b-49b5-94ac-9a8ac279e048",...(0,$.Z)("Add New Calendar Account")},{name:"COMMAND_CALENDAR_VIEWMODE_DAY",action:e=>{const t=c.ZP.getPageId(e.windowId);"number"==typeof t&&d.Z.setViewMode(t,"day")},isEnabled:Ce.Z,isVisible:()=>Ee(),feature:"calendar",showInQC:!0,category:"CATEGORY_COMMAND_CALENDAR",guid:"34b14e6c-de7d-4b66-819f-7ab80b1bb255",...(0,$.Z)("Day View")},{name:"COMMAND_CALENDAR_VIEWMODE_WEEK",action:e=>{const t=c.ZP.getPageId(e.windowId);"number"==typeof t&&d.Z.setViewMode(t,"week")},isEnabled:Ce.Z,isVisible:()=>Ee(),feature:"calendar",showInQC:!0,category:"CATEGORY_COMMAND_CALENDAR",guid:"4c6371b0-0217-4c6d-b4f7-7a5f100375c3",...(0,$.Z)("Week View")},{name:"COMMAND_CALENDAR_VIEWMODE_MULTIWEEK",action:e=>{const t=c.ZP.getPageId(e.windowId);"number"==typeof t&&d.Z.setViewMode(t,"multiweek")},isEnabled:Ce.Z,isVisible:()=>Ee(),feature:"calendar",showInQC:!0,category:"CATEGORY_COMMAND_CALENDAR",guid:"0f2eaffe-fbad-452e-858e-1edcfd8a746e",...(0,$.Z)("Multi Week View")},{name:"COMMAND_CALENDAR_VIEWMODE_MONTH",action:e=>{const t=c.ZP.getPageId(e.windowId);"number"==typeof t&&d.Z.setViewMode(t,"month")},isEnabled:Ce.Z,isVisible:()=>Ee(),feature:"calendar",showInQC:!0,category:"CATEGORY_COMMAND_CALENDAR",guid:"2a5db361-313a-43b6-a0e9-f51d304aec7c",...(0,$.Z)("Month View")},{name:"COMMAND_CALENDAR_VIEWMODE_YEAR",action:e=>{const t=c.ZP.getPageId(e.windowId);"number"==typeof t&&d.Z.setViewMode(t,"year")},isEnabled:Ce.Z,isVisible:()=>Ee(),feature:"calendar",showInQC:!0,category:"CATEGORY_COMMAND_CALENDAR",guid:"1f261447-d1b1-473f-bb07-6139fd878ea2",...(0,$.Z)("Year View")},{name:"COMMAND_CALENDAR_VIEWMODE_AGENDA",action:e=>{const t=c.ZP.getPageId(e.windowId);"number"==typeof t&&d.Z.setViewMode(t,"agenda")},isEnabled:Ce.Z,isVisible:()=>Ee(),feature:"calendar",showInQC:!0,category:"CATEGORY_COMMAND_CALENDAR",guid:"925c843d-4813-4ea5-8837-211412707dbf",...(0,$.Z)("Agenda View")},{name:"COMMAND_CALENDAR_VIEW_NEXT_PERIOD",action:e=>{const t=c.ZP.getPageId(e.windowId);"number"==typeof t&&d.Z.viewNextPeriod(t)},isEnabled:Ce.Z,isVisible:()=>Ee(),feature:"calendar",showInQC:!0,category:"CATEGORY_COMMAND_CALENDAR",guid:"0f8df2a2-343b-43db-a16c-16418dc9f241",...(0,$.Z)("View Next Period")},{name:"COMMAND_CALENDAR_VIEW_PREVIOUS_PERIOD",action:e=>{const t=c.ZP.getPageId(e.windowId);"number"==typeof t&&d.Z.viewPreviousPeriod(t)},isEnabled:Ce.Z,isVisible:()=>Ee(),feature:"calendar",showInQC:!0,category:"CATEGORY_COMMAND_CALENDAR",guid:"4601bd8c-4229-442c-8dec-df8171c4da1d",...(0,$.Z)("View Previous Period")},{name:"COMMAND_CALENDAR_VIEW_TODAY",action:e=>{const t=c.ZP.getPageId(e.windowId);"number"==typeof t&&d.Z.selectToday(t)},isEnabled:Ce.Z,isVisible:()=>Ee(),feature:"calendar",showInQC:!0,category:"CATEGORY_COMMAND_CALENDAR",guid:"44e98ded-fa2d-4ee4-a7f6-e705ac809503",...(0,$.Z)("View Today")},{name:"COMMAND_CALENDAR_VIEW_ZOOM_IN",action:e=>{const t=c.ZP.getPageId(e.windowId);"number"==typeof t&&d.Z.zoomViewMode(t,-1)},isEnabled:Ce.Z,isVisible:()=>Ee(),feature:"calendar",showInQC:!0,category:"CATEGORY_COMMAND_CALENDAR",guid:"940d0a90-6337-4d42-b317-13630fa38697",...(0,$.Z)("Zoom View In")},{name:"COMMAND_CALENDAR_VIEW_ZOOM_OUT",action:e=>{const t=c.ZP.getPageId(e.windowId);"number"==typeof t&&d.Z.zoomViewMode(t,1)},isEnabled:Ce.Z,isVisible:()=>Ee(),feature:"calendar",showInQC:!0,category:"CATEGORY_COMMAND_CALENDAR",guid:"8c03403a-77fd-4920-aad9-c47ecee1a115",...(0,$.Z)("Zoom View Out")},{name:"COMMAND_CALENDAR_CREATE_EVENT",action:e=>p.Z.onCommand(e.windowId,"COMMAND_CALENDAR_CREATE_EVENT"),isEnabled:Ce.Z,isVisible:()=>Ee(),showInQC:!0,feature:"calendar",category:"CATEGORY_COMMAND_CALENDAR",guid:"1559362f-6274-4590-a260-a660b71dfcd5",...(0,$.Z)("Create Event")},{name:"COMMAND_CALENDAR_GOTO_DATE",action:e=>p.Z.onCommand(e.windowId,"COMMAND_CALENDAR_GOTO_DATE"),isEnabled:Ce.Z,isVisible:()=>Ee(),showInQC:!0,feature:"calendar",category:"CATEGORY_COMMAND_CALENDAR",guid:"6c6537e4-75a3-43f0-93e1-9f3765d0c686",...(0,$.Z)("Go to Date")},{name:"COMMAND_CALENDAR_SEARCH",action:e=>p.Z.onCommand(e.windowId,"COMMAND_CALENDAR_SEARCH"),isEnabled:Ce.Z,isVisible:()=>Ee(),showInQC:!0,feature:"calendar",category:"CATEGORY_COMMAND_CALENDAR",guid:"55a8cf5d-e711-4ce4-a02f-55cf31ffcda8",...(0,$.Z)("Search in Calendar")},{name:"COMMAND_CALENDAR_REFRESH",action:e=>l.ZP.pollAllCalDAVAccountsWithStatus(),isVisible:()=>Ee(),isEnabled:Ce.Z,showInQC:!0,feature:"calendar",category:"CATEGORY_COMMAND_CALENDAR",guid:"1d59f64f-9e47-491c-93eb-fe66fc099279",...(0,$.Z)("Refresh Calendar")},{name:"COMMAND_MAIL_COMPOSE_NEW_MESSAGE",action:()=>v.Z.createDraft(),showInQC:!0,isEnabled:()=>Object.keys(K.Z.getAccounts()).length>0,isVisible:()=>Ee(),feature:"mail",guid:"1c54b411-5b73-4eba-b5bf-6787d1f377fe",category:"CATEGORY_COMMAND_MAIL",...(0,$.Z)("command","Compose New Message")},{name:"COMMAND_SHOW_MAIL",action:e=>b.Z.showMail(e.windowId),withNoWindow:!0,showInQC:!0,isEnabled:Ce.Z,isVisible:()=>Ee(),guid:"670dbed7-f692-4fa4-a926-fe46183b82bb",category:"CATEGORY_COMMAND_APPLICATION",...(0,$.Z)("Mail")},{name:"COMMAND_MAIL_REPLY",action:()=>i.Z.reply(),isEnabled:e=>(0,fe.Wm)(e),isVisible:()=>Ee(),feature:"mail",showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"fa9e273b-11fd-4be9-b77e-461a1e9fcc4e",...(0,$.Z)("Reply to Message")},{name:"COMMAND_MAIL_REPLY_ALL",action:()=>i.Z.replyAll(),showInQC:!0,isEnabled:e=>(0,fe.Wm)(e),isVisible:()=>Ee(),feature:"mail",category:"CATEGORY_COMMAND_MAIL",guid:"cc59e4b7-c907-48b7-9057-f4dc2ae9c552",...(0,$.Z)("Reply All")},{name:"COMMAND_MAIL_REPLY_LIST",action:()=>i.Z.replyList(),showInQC:!0,isEnabled:e=>a.Z.isListPost(),isVisible:()=>Ee(),feature:"mail",category:"CATEGORY_COMMAND_MAIL",guid:"aa09df31-0dbc-41c9-be62-265cd2906b88",...(0,$.Z)("Reply List")},{name:"COMMAND_MAIL_FORWARD",action:()=>i.Z.forward(),isEnabled:e=>(0,fe.Wm)(e),isVisible:()=>Ee(),feature:"mail",showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"f45c60df-9ca1-444e-8108-656b0a15c68e",...(0,$.Z)("mail","Forward Message")},{name:"COMMAND_MAIL_DELETE_PERMANENTLY",action:e=>i.Z.prepareDelete(e.windowId,!0),isEnabled:e=>(0,fe.Wm)(e),isVisible:()=>ke(),feature:"mail",showInQC:!1,category:"CATEGORY_COMMAND_MAIL",guid:"7b0de3f1-2173-4bde-96bf-f9fa1063abe7",...(0,$.Z)("Delete Permanently")},{name:"COMMAND_MAIL_MARK_READ",action:e=>i.Z.markRead(e.windowId),isEnabled:e=>(0,fe.Wm)(e),isVisible:()=>ke(),feature:"mail",showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"02a17cf8-4e45-4d32-b06c-38edf99544da",...(0,$.Z)("mail","Mark Message as Read")},{name:"COMMAND_MAIL_MARK_JUNK",action:e=>i.Z.markAsJunk(e.windowId),isEnabled:e=>(0,fe.Wm)(e)&&!Ne(),isVisible:()=>Ee(),feature:"mail",showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"4266577c-0e3b-4237-aadd-868b122976f6",...(0,$.Z)("mail","Mark Message as Spam")},{name:"COMMAND_MAIL_MARK_NOT_JUNK",action:e=>i.Z.markAsNotJunk(e.windowId),isEnabled:e=>(0,fe.Wm)(e)&&!Ne(),isVisible:()=>Ee(),feature:"mail",showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"b0546fb8-3dbf-47d7-9265-01d5c90e53cc",...(0,$.Z)("mail","Not Spam")},{name:"COMMAND_MAIL_MOVE_TO_ARCHIVE",action:e=>i.Z.moveToArchive(e.windowId),isEnabled:e=>(0,fe.Wm)(e),isVisible:()=>Ee(),feature:"mail",showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"88b88583-3976-4f56-a906-067928fd809f",...(0,$.Z)("mail","Move Message to Archive")},{name:"COMMAND_MAIL_SHOW_QUICK_REPLY",action:()=>{const e="show";T.Z.set(ae.kMailShowQuickReply,E.Z.get(ae.kMailShowQuickReply)===e?"hide":e)},isEnabled:e=>(0,fe.Wm)(e),isVisible:()=>Ee(),feature:"mail",showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"95168098-07a7-4662-b9cd-5409b67fdd6a",...(0,$.Z)("Quick Reply On/Off")},{name:"COMMAND_MAIL_RESTORE_FROM_ARCHIVE",action:e=>i.Z.restoreFromArchive(e.windowId),isEnabled:e=>(0,fe.Wm)(e),isVisible:()=>Ee(),feature:"mail",showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"7ff15fcb-6812-404c-8d27-f2100f585476",...(0,$.Z)("mail","Restore Message from Archive")},{name:"COMMAND_MAIL_GOTO_NEXT_UNREAD",action:e=>i.Z.goToNextUnread(e.windowId),isEnabled:e=>(0,fe.Wm)(e),isVisible:()=>Ee(),feature:"mail",showInQC:!1,category:"CATEGORY_COMMAND_MAIL",guid:"75f673af-21e8-43f2-8aa8-b96b8dbd0245",...(0,$.Z)("mail","Next Unread")},{name:"COMMAND_MAIL_GOTO_PREVIOUS_UNREAD",action:e=>i.Z.goToPreviousUnread(e.windowId),isEnabled:e=>(0,fe.Wm)(e),isVisible:()=>Ee(),feature:"mail",showInQC:!1,category:"CATEGORY_COMMAND_MAIL",guid:"24aab8e7-7bd0-470d-88f8-5ecdb1f19224",...(0,$.Z)("mail","Previous Unread")},{name:"COMMAND_MAIL_MARK_ALL_READ",action:()=>f.Z.markAllReadCmd(),isEnabled:e=>(0,fe.Wm)(e),isVisible:()=>Ee(),feature:"mail",showInQC:!1,category:"CATEGORY_COMMAND_MAIL",guid:"c929109f-99fa-45a5-80ca-9a3fdd17bd63",...(0,$.Z)("mail","Mark All as Read")},{name:"COMMAND_MAIL_MARK_THREAD_READ",action:e=>i.Z.markThreadRead(e.windowId),isEnabled:e=>(0,fe.Wm)(e),isVisible:()=>Ee(),feature:"mail",showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"3110cb8a-11eb-4643-b834-f88ee1bf0155",...(0,$.Z)("mail","Mark Message Thread as Read")},{name:"COMMAND_MAIL_MARK_THREAD_UNREAD",action:e=>i.Z.markThreadUnread(e.windowId),isEnabled:e=>(0,fe.Wm)(e),isVisible:()=>Ee(),feature:"mail",showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"655c64c3-8e8f-44ff-a7bf-a05f2c9a6115",...(0,$.Z)("mail","Mark Message Thread as Unread")},{name:"COMMAND_MAIL_MARK_UNREAD",action:e=>i.Z.markUnread(e.windowId),isEnabled:e=>(0,fe.Wm)(e),isVisible:()=>ke(),feature:"mail",showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"6b193cc2-62ca-41a8-9a17-d311541aef54",...(0,$.Z)("mail","Mark Message as Unread")},{name:"COMMAND_MAIL_ENABLE_SENDER_VIEW",action:e=>i.Z.enableCorrespondentView(e.windowId),isEnabled:e=>(0,fe.Wm)(e),isVisible:()=>Ee(),feature:"mail",showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"61ab202a-46ad-45ce-92b9-85c3295ef801",...(0,$.Z)("mail","Show Messages for Sender")},{name:"COMMAND_MAIL_LABEL_FLAG",action:e=>b.Z.showCustomLabelDialog(e.windowId),isEnabled:e=>(0,fe.Wm)(e),isVisible:()=>ke(),feature:"mail",showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"c17b88dc-80b2-4b8f-9887-7d184eaaeac5",...(0,$.Z)("mail","Add Labels and Flags")},{name:"COMMAND_MAIL_ENABLE_THREADED_VIEW",action:e=>i.Z.enableThreadedView(e.windowId),isEnabled:e=>(0,fe.Wm)(e),isVisible:()=>Ee(),feature:"mail",showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"5c21bfa1-f0b2-4804-a395-71243d99dad8",...(0,$.Z)("mail","Show Message Thread")},{name:"COMMAND_MAIL_MARK_READ_AND_GOTO_NEXT_UNREAD",action:e=>i.Z.markAsReadAndGoToNextUnread(e.windowId),isEnabled:e=>(0,fe.Wm)(e),isVisible:()=>ke(),feature:"mail",showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"92f285b0-90dc-4051-940e-eefee7b4692f",...(0,$.Z)("mail","Mark Message as Read and Go to Next Unread")},{name:"COMMAND_MAIL_ADD_NEW_MAIL_ACCOUNT",action:e=>b.Z.showMailAccountDialog(e.windowId),isEnabled:Ce.Z,isVisible:()=>Ee(),showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"2b65911f-8bfc-4e9b-bf43-b78bfc7c4587",...(0,$.Z)("mail","Add New Mail Account")},{name:"COMMAND_MAIL_SHOW_PLAINTEXT",action:e=>p.Z.onCommand(e.windowId,"COMMAND_MAIL_SHOW_PLAINTEXT"),isEnabled:()=>"plaintext"!==a.Z.getRenderingMethod(),isVisible:()=>Ee(),showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"ca91db92-59ae-40b6-9c69-10f7d4da2041",...(0,$.Z)("Show Message as Text")},{name:"COMMAND_MAIL_SHOW_HTML",action:e=>p.Z.onCommand(e.windowId,"COMMAND_MAIL_SHOW_HTML"),isEnabled:()=>"prefer_html"!==a.Z.getRenderingMethod(),isVisible:()=>Ee(),showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"6c080636-1fd2-41d2-826a-9652ae4de5d8",...(0,$.Z)("Show Message as HTML")},{name:"COMMAND_MAIL_SHOW_SETTINGS",action:e=>b.Z.showSettings(e.windowId,"mail"),isEnabled:Ce.Z,isVisible:()=>Ee(),showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"68FEE23D-B0DB-41D1-996B-C62BA4FD5F7A",...(0,$.Z)("Mail Settings")},{name:"COMMAND_MAIL_SEND_MESSAGE",action:e=>p.Z.onCommand(e.windowId,"COMMAND_MAIL_SEND_MESSAGE"),isEnabled:()=>Z.Z.isMailOn(),isVisible:()=>Ee(),feature:"mail",showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"c604b094-c4a6-4825-a626-ac02dcb4f9f2",...(0,$.Z)("mail","Send Mail From Mail Composer")},{name:"COMMAND_MAIL_QUEUE_MESSAGE",action:e=>p.Z.onCommand(e.windowId,"COMMAND_MAIL_QUEUE_MESSAGE"),isEnabled:()=>Z.Z.isMailOn(),isVisible:e=>_e(e),feature:"mail",showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"401ded53-2b1e-4138-9730-64a3b9cb852a",...(0,$.Z)("mail","Queue Mail From Mail Composer")},{name:"COMMAND_MAIL_COMPOSER_CHOOSE_ATTACHMENTS",action:e=>p.Z.onCommand(e.windowId,"COMMAND_MAIL_COMPOSER_CHOOSE_ATTACHMENTS"),isEnabled:()=>Z.Z.isMailOn(),isVisible:e=>_e(e),feature:"mail",showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"83f08b2a-e622-46f2-b40a-30901428ff4a",...(0,$.Z)("mail","Add Attachment")},{name:"COMMAND_MAIL_COMPOSER_DELETE_DRAFT",action:e=>p.Z.onCommand(e.windowId,"COMMAND_MAIL_COMPOSER_DELETE_DRAFT"),isEnabled:()=>Z.Z.isMailOn(),isVisible:e=>_e(e),feature:"mail",showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"eb237677-b81c-453e-ab92-791f0d3db3db",...(0,$.Z)("mail","Discard Draft")},{name:"COMMAND_MAIL_SHOW_MAIL_INFO",action:e=>b.Z.showMailInfoDialog(e.windowId),isEnabled:()=>Z.Z.isMailOn(),isVisible:e=>!U.ZP.isGuest(),showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"aa72eb02-7be0-4fbb-b5fa-6cb11e850ea5",...(0,$.Z)("command","Show Advanced Mail Info")},{name:"COMMAND_WORKSPACE_SWITCH_FORWARD_ORDER",action:e=>V.Z.activateNextByOrder(e.windowId),showInQC:!0,isEnabled:()=>E.Z.get(ae.kWorkspacesEnabled),isVisible:()=>E.Z.get(ae.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"629d1445-7c11-4047-a419-e50f948d1eb6",...(0,$.Z)("Next Workspace")},{name:"COMMAND_WORKSPACE_SWITCH_BACK_ORDER",action:e=>V.Z.activatePreviousByOrder(e.windowId),showInQC:!0,isEnabled:()=>E.Z.get(ae.kWorkspacesEnabled),isVisible:()=>E.Z.get(ae.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"d0ee5c21-ba2d-4435-8f69-b6cf8a2911d2",...(0,$.Z)("Previous Workspace")},{name:"COMMAND_WORKSPACE_CREATE_NEW",action:({windowId:e})=>{b.Z.showWorkspaceDialog(e,{createInBackground:!1,withPages:x.ZP.isSelecting(e)?x.ZP.getSelectedPages(e):void 0})},isEnabled:Ce.Z,isVisible:()=>E.Z.get(ae.kWorkspacesEnabled),showInQC:!0,category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"eee152db-570a-4d6c-94d0-3ce684b623cb",...(0,$.Z)("workspaces","Create New Workspace")},{name:"COMMAND_WORKSPACE_SWITCH_1",action:e=>V.Z.activateWorkspaceByIndex(e.windowId,void 0),showInQC:!1,isEnabled:Ce.Z,isVisible:()=>E.Z.get(ae.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"84839d33-4378-426f-ab95-a013bda152c0",...(0,$.Z)("Switch to Window")},{name:"COMMAND_WORKSPACE_SWITCH_2",action:e=>V.Z.activateWorkspaceByIndex(e.windowId,0),showInQC:!1,isEnabled:Ce.Z,isVisible:()=>E.Z.get(ae.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"0bc9d92d-05f7-4e49-8a87-c6e4f85565aa",...(0,$.Z)("Switch to Workspace 1")},{name:"COMMAND_WORKSPACE_SWITCH_3",action:e=>V.Z.activateWorkspaceByIndex(e.windowId,1),showInQC:!1,isEnabled:Ce.Z,isVisible:()=>E.Z.get(ae.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"1bbf445e-1787-4af4-ac01-e0ef0fb4054d",...(0,$.Z)("Switch to Workspace 2")},{name:"COMMAND_WORKSPACE_SWITCH_4",action:e=>V.Z.activateWorkspaceByIndex(e.windowId,2),showInQC:!1,isEnabled:Ce.Z,isVisible:()=>E.Z.get(ae.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"f3ba55d2-e1c1-48d2-9bf2-0464b3444499",...(0,$.Z)("Switch to Workspace 3")},{name:"COMMAND_WORKSPACE_SWITCH_5",action:e=>V.Z.activateWorkspaceByIndex(e.windowId,3),showInQC:!1,isEnabled:Ce.Z,isVisible:()=>E.Z.get(ae.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"cafeffc8-984a-4c0f-a9f2-4ccf1dd5577a",...(0,$.Z)("Switch to Workspace 4")},{name:"COMMAND_WORKSPACE_SWITCH_6",action:e=>V.Z.activateWorkspaceByIndex(e.windowId,4),showInQC:!1,isEnabled:Ce.Z,isVisible:()=>E.Z.get(ae.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"5ccdd631-2dcd-46b2-9b39-7720e98fa376",...(0,$.Z)("Switch to Workspace 5")},{name:"COMMAND_WORKSPACE_SWITCH_7",action:e=>V.Z.activateWorkspaceByIndex(e.windowId,5),showInQC:!1,isEnabled:Ce.Z,isVisible:()=>E.Z.get(ae.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"fe8c273a-9a21-4547-8d6e-6befed835a84",...(0,$.Z)("Switch to Workspace 6")},{name:"COMMAND_WORKSPACE_SWITCH_8",action:e=>V.Z.activateWorkspaceByIndex(e.windowId,6),showInQC:!1,isEnabled:Ce.Z,isVisible:()=>E.Z.get(ae.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"0be9f4ad-da3f-47aa-b03d-2b6b2aa16084",...(0,$.Z)("Switch to Workspace 7")},{name:"COMMAND_WORKSPACE_SWITCH_9",action:e=>V.Z.activateWorkspaceByIndex(e.windowId,7),showInQC:!1,isEnabled:Ce.Z,isVisible:()=>E.Z.get(ae.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"cb808c2b-9b79-4914-a25c-861818dd86be",...(0,$.Z)("Switch to Workspace 8")},{name:"COMMAND_WORKSPACE_SWITCH_10",action:e=>V.Z.activateWorkspaceByIndex(e.windowId,8),showInQC:!1,isEnabled:Ce.Z,isVisible:()=>E.Z.get(ae.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"e32ce875-6d68-4d49-8fdf-5586908275b4",...(0,$.Z)("Switch to Workspace 9")},{name:"COMMAND_WORKSPACE_MOVE_TABS_TO_0",action:e=>y.ZP.moveSelectionToWorkspace(e.windowId,0),showInQC:!0,isEnabled:Ce.Z,isVisible:()=>E.Z.get(ae.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"174bcaf6-a722-4101-9717-5baed519a880",...(0,$.Z)("Move Selected Tabs to This Window")},{name:"COMMAND_WORKSPACE_MOVE_TABS_TO_1",action:e=>y.ZP.moveSelectionToWorkspace(e.windowId,1),showInQC:!0,isEnabled:Ce.Z,isVisible:()=>E.Z.get(ae.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"69cb1752-3ce7-4d23-ac8d-f252dcb61d85",...(0,$.Z)("Move Selected Tabs to Workspace 1")},{name:"COMMAND_WORKSPACE_MOVE_TABS_TO_2",action:e=>y.ZP.moveSelectionToWorkspace(e.windowId,2),showInQC:!0,isEnabled:Ce.Z,isVisible:()=>E.Z.get(ae.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"f19f65b7-5506-4e8e-84c3-fdc19a2eec07",...(0,$.Z)("Move Selected Tabs to Workspace 2")},{name:"COMMAND_WORKSPACE_MOVE_TABS_TO_3",action:e=>y.ZP.moveSelectionToWorkspace(e.windowId,3),showInQC:!0,isEnabled:Ce.Z,isVisible:()=>E.Z.get(ae.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"e09eaa02-adc0-4210-b807-19208d4f11b4",...(0,$.Z)("Move Selected Tabs to Workspace 3")},{name:"COMMAND_WORKSPACE_MOVE_TABS_TO_4",action:e=>y.ZP.moveSelectionToWorkspace(e.windowId,4),showInQC:!0,isEnabled:Ce.Z,isVisible:()=>E.Z.get(ae.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"8c76e51d-56c3-4781-969d-927ccfe3ea35",...(0,$.Z)("Move Selected Tabs to Workspace 4")},{name:"COMMAND_WORKSPACE_MOVE_TABS_TO_5",action:e=>y.ZP.moveSelectionToWorkspace(e.windowId,5),showInQC:!0,isEnabled:Ce.Z,isVisible:()=>E.Z.get(ae.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"47659c77-702b-4fc2-be31-271b2740e129",...(0,$.Z)("Move Selected Tabs to Workspace 5")},{name:"COMMAND_WORKSPACE_MOVE_TABS_TO_6",action:e=>y.ZP.moveSelectionToWorkspace(e.windowId,6),showInQC:!0,isEnabled:Ce.Z,isVisible:()=>E.Z.get(ae.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"e822d9a1-c293-4da6-a7f5-ebe7c09ce9c3",...(0,$.Z)("Move Selected Tabs to Workspace 6")},{name:"COMMAND_WORKSPACE_MOVE_TABS_TO_7",action:e=>y.ZP.moveSelectionToWorkspace(e.windowId,7),showInQC:!0,isEnabled:Ce.Z,isVisible:()=>E.Z.get(ae.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"0402aaa7-7f28-47e7-a4bf-e307c6c56866",...(0,$.Z)("Move Selected Tabs to Workspace 7")},{name:"COMMAND_WORKSPACE_MOVE_TABS_TO_8",action:e=>y.ZP.moveSelectionToWorkspace(e.windowId,8),showInQC:!0,isEnabled:Ce.Z,isVisible:()=>E.Z.get(ae.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"1f59c161-4d4e-4fd9-91bc-dc3bc90efd15",...(0,$.Z)("Move Selected Tabs to Workspace 8")},{name:"COMMAND_WORKSPACE_MOVE_TABS_TO_9",action:e=>y.ZP.moveSelectionToWorkspace(e.windowId,9),showInQC:!0,isEnabled:Ce.Z,isVisible:()=>E.Z.get(ae.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"57626fad-3323-49e1-b461-47026639029b",...(0,$.Z)("Move Selected Tabs to Workspace 9")},{name:"COMMAND_HIBERNATE_INACTIVE_WORKSPACES",action:e=>V.Z.hibernateInactive(),showInQC:!0,isEnabled:Ce.Z,isVisible:()=>E.Z.get(ae.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"d06e09c2-b95f-47fb-a3f1-c67872fdb8c4",...(0,$.Z)("workspaces","Hibernate Inactive Workspaces")},{name:"COMMAND_SHOW_WORKSPACE_MENU",action:e=>p.Z.onCommand(e.windowId,"COMMAND_SHOW_WORKSPACE_MENU"),showInQC:!0,isEnabled:Ce.Z,isVisible:()=>E.Z.get(ae.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"d8df3703-4bef-43a8-aebe-cf53222c9927",...(0,$.Z)("workspaces","Show Workspace Menu")},{name:"COMMAND_TOGGLE_FORCE_DARK_MODE",action:()=>T.Z.toggle(ae.kAppearanceForceDarkModeTheme,!0,!1),showInQC:!0,isEnabled:Ce.Z,isVisible:()=>function(){const e=E.Z.get(ae.kVivaldiPreferredColorScheme);return e===q.TP.dark||e===q.TP.auto&&"dark"===E.Z.get(ae.kSystemDesktopThemeColor)}(),category:"CATEGORY_COMMAND_APPEARANCE",guid:"eb1ba46f-ac7d-4112-86ed-fb0637dc675e",...(0,$.Z)("Toggle Force a dark theme on all websites")}]},9761:(e,t,s)=>{"use strict";s.d(t,{YI:()=>l,jq:()=>r,lE:()=>a,sK:()=>o});var n=s(70253),i=s(56371);const a=n.M.pb.map((([e,t,s])=>({key:e,value:(0,i.Z)(t),local:s}))),o=[{key:"am",value:(0,i.Z)("Amharic"),local:"amarəñña"},{key:"ar",value:(0,i.Z)("Arabic"),local:"اَلْعَرَبِيَّةُ"},{key:"bn",value:(0,i.Z)("Bengali"),local:"baɛṅlā"},{key:"bs",value:(0,i.Z)("Bosnian"),local:"bosanski"},{key:"ceb",value:(0,i.Z)("Cebuano"),local:"Sinugboanon"},{key:"co",value:(0,i.Z)("Corsican"),local:"corsu"},{key:"cy",value:(0,i.Z)("Welsh"),local:"Cymraeg"},{key:"eo",value:(0,i.Z)("Esperanto"),local:"Esperanto"},{key:"eu",value:(0,i.Z)("Basque"),local:"euskara"},{key:"ga",value:(0,i.Z)("Irish Gaelic"),local:"Gaeilge"},{key:"gu",value:(0,i.Z)("Gujarati"),local:"gujarātī"},{key:"ha",value:(0,i.Z)("Hausa"),local:"ḥawsa"},{key:"haw",value:(0,i.Z)("Hawaiian"),local:"ʻōlelo Hawaiʻi"},{key:"he",value:(0,i.Z)("Hebrew"),local:"עברית / עִבְרִית"},{key:"hi",value:(0,i.Z)("Hindi"),local:"हिन्दी"},{key:"hmn",value:(0,i.Z)("Hmong, Mong"),local:"Hmong"},{key:"ht",value:(0,i.Z)("Haitian Creole"),local:"Kreyòl ayisyen"},{key:"ig",value:(0,i.Z)("Igbo"),local:"igbo"},{key:"jv",value:(0,i.Z)("Javanese"),local:"basa Jawa"},{key:"ka",value:(0,i.Z)("Georgian"),local:"ქართული"},{key:"kk",value:(0,i.Z)("Kazakh"),local:"Қазақ тілі"},{key:"km",value:(0,i.Z)("Khmer"),local:"ភាសាខ្មែរ"},{key:"kn",value:(0,i.Z)("Kannada"),local:"ಕನ್ನಡ (kannaḍa)"},{key:"ky",value:(0,i.Z)("Kyrgyz"),local:"قىرعىز تىلى"},{key:"la",value:(0,i.Z)("Latin"),local:"Lingua Latina"},{key:"lb",value:(0,i.Z)("Luxembourgish"),local:"Lëtzebuergesch"},{key:"lo",value:(0,i.Z)("Lao"),local:"ພາສາລາວ"},{key:"lv",value:(0,i.Z)("Latvian"),local:"latviešu valoda"},{key:"mg",value:(0,i.Z)("Malagasy"),local:"Fiteny Malagasy"},{key:"mi",value:(0,i.Z)("Maori"),local:"te Reo Māori"},{key:"mk",value:(0,i.Z)("Macedonian"),local:"македонски"},{key:"ml",value:(0,i.Z)("Malayalam"),local:"മലയാളം"},{key:"mn",value:(0,i.Z)("Mongolian"),local:"монгол"},{key:"mr",value:(0,i.Z)("Marathi"),local:"मराठी"},{key:"ms",value:(0,i.Z)("Malay"),local:"Bahasa melayu"},{key:"mt",value:(0,i.Z)("Maltese"),local:"Malti"},{key:"my",value:(0,i.Z)("Burmese"),local:"ဗမာစကား"},{key:"ne",value:(0,i.Z)("Nepali"),local:"नेपाली"},{key:"ny",value:(0,i.Z)("Chichewa"),local:"Chicheŵa"},{key:"or",value:(0,i.Z)("Oriya"),local:"ଓଡ଼ିଆ"},{key:"ps",value:(0,i.Z)("Pashto"),local:"پښتو"},{key:"rw",value:(0,i.Z)("Kinyarwanda"),local:"Ikinyarwanda"},{key:"sd",value:(0,i.Z)("Sindhi"),local:"سنڌي"},{key:"si",value:(0,i.Z)("Sinhala"),local:"සිංහල"},{key:"sm",value:(0,i.Z)("Samoan"),local:"Gagana Samoa"},{key:"sn",value:(0,i.Z)("Shona"),local:"chiShona"},{key:"so",value:(0,i.Z)("Somali"),local:"af Soomaali"},{key:"st",value:(0,i.Z)("Southern Sotho"),local:"seSotho"},{key:"su",value:(0,i.Z)("Sundanese"),local:"Basa Sunda"},{key:"sw",value:(0,i.Z)("Swahili"),local:"Kiswahili"},{key:"ta",value:(0,i.Z)("Tamil"),local:"தமிழ்"},{key:"te",value:(0,i.Z)("Telugu"),local:"తెలుగు"},{key:"tg",value:(0,i.Z)("Tajik"),local:"тоҷики / toçikī / تاجيكي"},{key:"th",value:(0,i.Z)("Thai"),local:"ภาษาไทย"},{key:"tk",value:(0,i.Z)("Turkmen"),local:"түркmенче"},{key:"tl",value:(0,i.Z)("Tagalog"),local:"Tagalog"},{key:"tt",value:(0,i.Z)("Tatar"),local:"татарча / tatar tele / تاتارچا"},{key:"ug",value:(0,i.Z)("Uyghur"),local:"Уйғур /ئۇيغۇر"},{key:"ur",value:(0,i.Z)("Urdu"),local:"اُردُو"},{key:"uz",value:(0,i.Z)("Uzbek"),local:"o’zbek tili ўзбек тили"},{key:"xh",value:(0,i.Z)("Xhosa"),local:"isiXhosa"},{key:"yi",value:(0,i.Z)("Yiddish"),local:"ײִדיש"},{key:"yo",value:(0,i.Z)("Yoruba"),local:"Yorùbá"},{key:"zu",value:(0,i.Z)("Zulu"),local:"isiZulu"}],r={en:"en-US",es:"es-ES",ku:"kmr",no:"nb",pt:"pt-PT","sr-Cyrl":"sr","zh-Hans":"zh-CN","zh-Hant":"zh-TW"},l=Object.entries(r).reduce(((e,[t,s])=>(e[s]=t,e)),{"de-CH":"de","en-GB":"en","ja-KS":"ja","sr-Latn":"sr",nn:"no","pt-BR":"pt",iw:"he",me:"hr"})},33638:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});s(20244);const n=new class{_stores=new Set;register(e){const t=this._stores.size;if(this._stores.add(e),t===this._stores.size)throw new Error(`register() in ${this.constructor.name} was called with store ${e.constructor?.name} that was already registered.`)}reorderRegistrations(e){const t=this._stores.size;e.forEach((e=>{if(this._stores.delete(e),this._stores.add(e),t!==this._stores.size)throw new Error(`reorderRegistrations() in ${this.constructor.name} was called with store ${e.constructor?.name} that was not already registered.`)}))}isDispatching(){return Boolean(this._dispatching)}setLogCallback(e){this._logCallback=e}dispatch(e){if(this._dispatching){let t=`VivaldiAppDispatcher.dispatch(...): Cannot dispatch action ${e.actionType} the middle of a ${this._dispatching.actionType} dispatch.`;throw new Error(t)}this._dispatching=e;try{for(const t of this._stores)t.dispatchAction(e)}finally{this._dispatching=void 0,this._logCallback&&this._logCallback(e)}}}},30628:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});var n=s(48868),i=s(5863);class a{static m3GetAll(){return n.Z.transaction("rw",[n.Z.searchList,n.Z.filters],(()=>n.Z.filters.where("[accountId+path]").equals([i.of,i.J8]).first().then((e=>{if(!e)throw new Error("Outbox filter not found");return n.Z.searchList.where("sourceFilterIds").equals(e.id).toArray()}))))}}},55346:(e,t,s)=>{"use strict";s.d(t,{Z:()=>i});var n=s(48868);const i={call:function(e){return n.Z.messages.get(e)}}},93789:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});var n=s(48868),i=s(71320);const a={call:async function(e,t){const s=[],a=[],o=[];return await n.Z.transaction("rw",[n.Z.searchList,n.Z.hasRaw],(async()=>{await n.Z.searchList.where("id").anyOf(e).modify((e=>{e.sourceFilterIds=e.sourceFilterIds.filter((e=>!t.includes(e))),t.forEach((t=>{e.sources.delete(t)}));const n=new Set(i.Z.getByIds([...e.sources.keys()]).map((({accountId:e})=>e))),r=new Set(i.Z.getByIds(t).map((({accountId:e})=>e)).filter((e=>!n.has(e))));for(const t of r)s.push([e.id,t]),a.push({accountId:t,searchListId:e.id,sentDate:e.sentDate});o.push({id:e.id,updates:{sourceFilterIds:e.sourceFilterIds,sources:new Map(t.map((e=>[e,void 0])))}})})),s.length>0&&n.Z.hasRaw.bulkDelete(s)})),{fileKeys:a,sleUpdates:o}}}},44850:(e,t,s)=>{"use strict";s.d(t,{$0:()=>D,CS:()=>N,D1:()=>X,Gp:()=>K,Gr:()=>z,IG:()=>M,LA:()=>A,NC:()=>G,QB:()=>W,Rf:()=>q,YC:()=>k,Z7:()=>L,cw:()=>U,d6:()=>Y,eD:()=>H,i8:()=>J,jk:()=>ee,m7:()=>V,mh:()=>v,pD:()=>Q,pM:()=>F,rl:()=>O,w$:()=>w,xy:()=>S,yl:()=>P});var n=s(96951),i=s(29087),a=s(16716),o=s(15489),r=s(56371),l=s(7064),d=s(1407),c=s(98010),h=s(36436),u=s(89175),p=s(86088);let g=[];function m(e,t){let s=e;if(t.displayUrl){const n=(0,h.DP)(e);s=t.displayUrl+(t.copyParams&&n.path?"/"+n.path+"/":"/")}else s="";return s}function f(e,t){const s=(t.url||"").includes("?")?"&":"?",[n,i]=e.slice(t.displayUrl.length).split("?"),a=new URLSearchParams(i);n&&"/"!==n&&a.append("path",(0,h.Iw)(n));const o=t.copyParams&&e.length>t.displayUrl.length?a.toString():"";return(t.url||"")+(o?s+o:"")}const v={general:{title:(0,r.Z)("General"),icon:p.Wt6,group:1},sync:{title:(0,r.Z)("Sync"),icon:p.FWJ,group:1},appearance:{title:(0,r.Z)("Appearance"),icon:p.Eo7,group:2},themes:{title:(0,r.Z)("Themes"),icon:p.U9f,group:2},startpage:{title:(0,r.Z)("title","Start Page"),icon:p.bMS,group:2},tabs:{title:(0,r.Z)("Tabs"),icon:p.Xt4,group:3},panel:{title:(0,r.Z)("title","Panel"),icon:p.bu$,group:3},addressbar:{title:(0,r.Z)("title","Address Bar"),icon:p.gO6,group:3},bookmarks:{title:(0,r.Z)("Bookmarks"),icon:p.Dvg,group:3},search:{title:(0,r.Z)("noun","Search"),icon:p.Hsf,group:3},qc:{title:(0,r.Z)("Quick Commands"),icon:p.f$U,group:4},keyboard:{title:(0,r.Z)("Keyboard"),icon:p.EkX,group:4},mouse:{title:(0,r.Z)("Mouse"),icon:p.j7Q,group:4},privacy:{title:(0,r.Z)("Privacy and Security"),icon:p.xGh,group:5},downloads:{title:(0,r.Z)("Downloads"),icon:p.GEU,group:5},webpages:{title:(0,r.Z)("Webpages"),icon:p.AWt,group:5},network:{title:(0,r.Z)("Network"),icon:p.f2R,group:5},mail:{title:(0,r.Z)("Mail"),icon:p.FbK,group:6},calendar:{title:(0,r.Z)("Calendar"),icon:p.a1L,group:6},feeds:{title:(0,r.Z)("Feeds"),icon:p.eGc,group:6},chat:{title:(0,r.Z)("Chat"),icon:p.PyL,group:6},all:{title:(0,r.Z)("Display All"),icon:p.ih3,group:7},reset:{title:(0,r.Z)("Reset All Settings"),icon:p.NQk,group:7}},b={"vivaldi://settings/":"settings","vivaldi://startpage/":"startpage","vivaldi://bookmarks/":"bookmarks","vivaldi://history/":"history","vivaldi://calendar/":"calendar","vivaldi://chat/":"chat","vivaldi://dashboard/":"dashboard","vivaldi://mailpage/":"mailpage","vivaldi://saga/":"saga","chrome://saga/":"saga","vivaldi://guest-intro/":"guest-intro","vivaldi://private-intro/":"private-intro","vivaldi://welcome/":"welcome","vivaldi://themecolors/":"themecolors","vivaldi://experiments/":"experiments","vivaldi://actionlog/":"actionlog","vivaldi://notes/":"notes","vivaldi://session-recovery/":"session-recovery"},C={"vivaldi://settings/":p.bqs.medium,"vivaldi:settings":p.bqs.medium,"vivaldi://startpage/":p.VPD,"vivaldi:startpage":p.VPD,"vivaldi://bookmarks/":p.CLf.medium,"vivaldi:bookmarks":p.CLf.medium,"vivaldi://history/":p.hcy.medium,"vivaldi:history":p.hcy.medium,"vivaldi://calendar/":p.bcq.medium,"vivaldi:calendar":p.bcq.medium,"vivaldi://chat/":p.yt5.medium,"vivaldi:chat":p.yt5.medium,"vivaldi://dashboard/":p.cyI.medium,"vivaldi:dashboard":p.cyI.medium,"vivaldi://mailpage/":p.lvj.medium,"vivaldi:mailpage":p.lvj.medium,"vivaldi://themecolors/":p.jL_,"vivaldi:themecolors":p.jL_,"vivaldi://notes/":p.cyI.medium,"vivaldi:notes":p.cyI.medium,"vivaldi://welcome/":p.UQS,"vivaldi:welcome":p.UQS,"vivaldi://game/":"chrome://game/","vivaldi:game":"chrome://game/","vivaldi://saga/":"chrome://saga/","vivaldi:saga":"chrome://saga/"};function w(e){return e.startsWith("vivaldi:")||e.startsWith(d.u7)?Object.hasOwn(C,e)?C[e]:p.ZuY:e}const y=["settings","startpage","bookmarks","history","calendar","chat","notes","mailpage","dashboard","private-intro","experiments","vivaldi://flags/","chrome://flags/","session-recovery"],x=["chrome://settings/","chrome://apps/","chrome://password-manager/","chrome://password-manager-internals/","vivaldi://apps/","vivaldi://password-manager/","vivaldi://password-manager-internals/","chrome://extensions/","chrome://help/","vivaldi://extensions/"],I={settings:`${d.oP}/components/settings/settings.html`,startpage:`${d.u7}/startpage`,bookmarks:`${d.u7}/startpage?section=bookmarks`,history:`${d.u7}/startpage?section=history`,notes:`${d.u7}/startpage?section=notes`,calendar:`${d.u7}/startpage?section=calendar`,dashboard:`${d.u7}/startpage?section=dashboard`,speeddial:`${d.u7}/startpage?section=Speed-dials`,mailpage:`${d.oP}/components/mail/mail.html`,chat:`${d.oP}/components/mail/chat.html`,saga:`${d.oP}/saga/saga.html`,"guest-intro":`${d.oP}/components/guest-intro/guest-intro.html`,"private-intro":`${d.oP}/components/private-intro/private-intro.html`,welcome:`${d.oP}/components/welcome/welcome.html`,themecolors:`${d.oP}/components/themecolors/themecolors.html`,experiments:`${d.oP}/components/experiments/experiments.html`,actionlog:`${d.oP}/components/actionlog/actionlog.html`,"session-recovery":`${d.oP}/components/session-recovery/session-recovery.html`},A="https://vivaldi.com/bookmark/go",S={...I,about:"chrome://version","vivaldi-urls":"chrome://chrome-urls",blankpage:"about:blank",extensions:"chrome://extensions",game:"chrome://game",saga:"chrome://saga"},Z=[S.settings,S.bookmarks,S.history,S.notes,S.calendar,S.mailpage,S.chat,S.themecolors,S.experiments,S.actionlog,S.game,S.dashboard,S.speeddial,S["session-recovery"]],T=[{displayUrl:"vivaldi://history",url:S.history,copyParams:!0},{displayUrl:"vivaldi://calendar",url:S.calendar,copyParams:!0},{displayUrl:"vivaldi://dashboard",url:S.dashboard,copyParams:!0},{displayUrl:"vivaldi://notes",url:S.notes,copyParams:!0},{displayUrl:"vivaldi://bookmarks",url:S.bookmarks,copyParams:!0},{displayUrl:"vivaldi://settings",url:S.settings,copyParams:!0},{displayUrl:"",url:S.startpage,copyParams:!1},{displayUrl:"vivaldi://startpage",url:S.startpage,copyParams:!1,mapDisplayUrlToUrl:(e,t)=>n.ZP.getStartpage(o.ZP.getLastActiveBrowserWindowId())},{displayUrl:"",url:"chrome://newtab",copyParams:!1},{displayUrl:"",url:S.blankpage,copyParams:!1},{displayUrl:"vivaldi://mail",url:S.mailpage,copyParams:!0},{displayUrl:"vivaldi://saga",url:S.saga,copyParams:!0},{displayUrl:"vivaldi://chat",url:S.chat,copyParams:!0},{displayUrl:"vivaldi://about",url:S.about,copyParams:!0},{displayUrl:"vivaldi://help",url:"https://vivaldi.com/help",copyParams:!0},{displayUrl:"vivaldi://vivaldi-urls",url:S["vivaldi-urls"],copyParams:!0},{displayUrl:"vivaldi://extensions",url:"chrome://extensions",copyParams:!0},{displayUrl:"vivaldi://guest-intro",url:S["guest-intro"],copyParams:!0},{displayUrl:"",url:S["private-intro"],copyParams:!0},{displayUrl:"vivaldi://welcome",url:S.welcome,copyParams:!0},{displayUrl:"vivaldi://themecolors",url:S.themecolors,copyParams:!0},{displayUrl:"vivaldi://experiments",url:S.experiments,copyParams:!0},{displayUrl:"vivaldi://actionlog",url:S.actionlog,copyParams:!0},{displayUrl:"vivaldi://game",url:S.game,copyParams:!1},{displayUrl:"vivaldi://session-recovery",url:S["session-recovery"],copyParams:!0},{displayUrl:d.f4,url:d.f4,copyParams:!1,mapUrlToDisplayUrl:e=>e},{displayUrl:"about:about",url:S.about,copyParams:!1},{displayUrl:"chrome://history",url:S.history,copyParams:!0},{displayUrl:"chrome://bookmarks",url:S.bookmarks,copyParams:!0},{displayUrl:"chrome://newtab",mapDisplayUrlToUrl:e=>D(e)?n.ZP.getStartpage(o.ZP.getLastActiveBrowserWindowId()):e,copyParams:!1},{displayUrl:"vivaldi://",url:"chrome://",copyParams:!0,mapDisplayUrlToUrl:(e,t)=>"vivaldi://"===e?S.about:function(e,t){const s=t.copyParams&&e.length>t.displayUrl.length?(0,h.Iw)(e.slice(t.displayUrl.length)):"";return(t.url||"")+s}(e,t),mapUrlToDisplayUrl:(e,t)=>function(e,t){const s=t.copyParams&&e.length>(t.url||"").length?(0,h.Iw)(e.slice((t.url||"").length)):"";return t.displayUrl+s}(e,t)},{displayUrl:"vivaldi:",copyParams:!1,mapDisplayUrlToUrl:e=>{const t=e.indexOf("/"),s=-1===t?e.length:t,n=e.substring(8,s);if(Object.hasOwn(S,n)){const t=S[n];return f(e,{displayUrl:e.substring(0,s),url:t,copyParams:!0})}return e}}];function E(e){let t=e;if(-1===t.indexOf("://")){const e=t.indexOf(":");e>-1&&(t=t.slice(0,e)+"://"+t.slice(e+1))}return"/"!==t[t.length-1]&&(t+="/"),t}function k(e){const t=E(e);if(!Object.hasOwn(b,t))return y.includes(t);const s=b[t];return y.includes(s)}function N(e){const t=E(e);for(let e=0;e<x.length;e++){const s=x[e];if((0,h.uu)(s,t)||t.startsWith(s))return!0}return!1}function _(e){return L(e)?p.bqs.small:e===S.history?p.hcy.small:e===S.bookmarks?p.CLf.small:e===S.calendar?p.bcq.small:e.startsWith(S.dashboard)||e.startsWith(S.notes)?p.cyI.small:e===S.welcome?p.UQS:D(e)?p.VPD:H(e)?p.lvj.small:function(e){return"string"==typeof e&&0===e.indexOf(S.chat)}(e)?"/resources/vivaldi_chat_default.png":e.startsWith(S.game)?"chrome://favicon/chrome://game/":e.startsWith(S.extensions)?"chrome://favicon/chrome://extensions/":e===S["private-intro"]?p.d7l:e===S["guest-intro"]?p.CtH.small:e===S["session-recovery"]?p.VPD:void 0}function P(e,t){if(t)return{favIconUrl:t,favIconLoadType:"faviconFromCache"};const s=e?_(e):"";return e&&U(e)&&s?{favIconUrl:s,favIconLoadType:"faviconFromCache"}:{favIconUrl:e??"",favIconLoadType:"page"}}function M(e){return e.startsWith(S.welcome)}function D(e){const t=i.Z.get(u.kExtensionURLOverrides)?.newtab?.find((e=>e.active)),s=i.Z.get(u.kTabsNewPageLink)===d.Fp.EXTENSION;return t&&s?e===t.entry:e.startsWith("chrome://newtab")||e.startsWith(S.startpage)||e.startsWith("vivaldi://startpage")}function O(e){return e.startsWith("vivaldi://startpage?section=")||e.startsWith(S.bookmarks)||e.startsWith(S.history)||e.startsWith(S.notes)||e.startsWith(S.calendar)||e.startsWith(S.mailpage)||e.startsWith(S.chat)||e.startsWith(S.dashboard)}function j(e,t){return t.length>0&&t.startsWith(e)}function L(e){return j(S.settings,e)}const R=Object.keys(S).map((e=>S[e])),B=[...Object.keys(I).map((e=>I[e])),...Object.keys(b)];function F(e){return R.some((t=>e.startsWith(t)))}function W(e){return e.startsWith(S.game)||e.startsWith(S.extensions)}function U(e){return B.some((t=>e.startsWith(t)))}function V(e){return Z.some((t=>e.url.startsWith(t)))}function H(e){return"string"==typeof e&&0===e.indexOf(S.mailpage)}function G(e){return e===S.mailpage}function K(e){return 0===e.indexOf(S.notes)}function z(e){const t=e=e.trim();if(e=e?e.toLowerCase():e,a.Z.isEnabled("chrome_pages")&&!e.startsWith("vivaldi:"))return t;const s=T.find((t=>t.displayUrl&&j(t.displayUrl,e)));if(!s)return t;return s.mapDisplayUrlToUrl?s.mapDisplayUrlToUrl(e,s):f(e,s)}function $(e){if(""===e||e.startsWith(d.f4))return d.f4;if(Q(e))return"";if(a.Z.isEnabled("chrome_pages")&&!e.startsWith("chrome-extension:"))return e;for(let t=0;t<T.length;t++){const s=T[t];if(s.url&&j(s.url,e)){e=s.mapUrlToDisplayUrl?s.mapUrlToDisplayUrl(e,s):m(e,s);break}}return e}function Y(e,t){if(e){if(t||!e.startsWith("https:")&&!e.startsWith("http:"))if(e===S.blankpage)t=(0,r.Z)("title","Blank Page");else if(e.startsWith(S.bookmarks))t=(0,r.Z)("Bookmarks");else if(e.startsWith(S.history))t=(0,r.Z)("History");else if(e.startsWith(S.calendar))t=(0,r.Z)("Calendar");else if(e.startsWith(S.dashboard))t=(0,r.Z)("Dashboard");else if(e.startsWith(S.chat)){const s=(0,h.DP)(e).path;t=s?(0,r.Z)(`Chat: ${s}`):(0,r.Z)("Chat")}else if(e.startsWith(S.mailpage)){const s=(0,h.DP)(e).title;s?t=s:t&&"Mail"!==t||(t=(0,r.Z)("Mail"))}else if(e.startsWith(S.notes))t.startsWith(S.notes)&&(t=(0,r.Z)("Notes"));else if(D(e)||D(t))t=(0,r.Z)("browser","Start Page");else if(e===S.experiments)t=(0,r.Z)("Experimental Features");else if(e===S.actionlog)t=(0,r.Z)("Action Log");else if(e===S["guest-intro"])t=(0,r.Z)("Guest Profile Introduction");else if(e===S["private-intro"])t=(0,r.Z)("Private Window Introduction");else if(t||e!==S.welcome)if(e.startsWith(S.settings)){const s=(0,h.DP)(e).path,n=s?s.split("/")[0]:"general";t=(0,r.Z)("$1 Settings",v[n]?[v[n].title]:[n])}else e===S["session-recovery"]&&(t=(0,r.Z)("Session Recovery"));else t=(0,r.Z)("Welcome");else t=(0,c.x0)(e);t===e&&(t=(0,h.Dy)($(e)))}return t}function X(e){let{title:t="",url:s=""}=e;if("string"!=typeof e.vivExtData){const s=e.vivExtData;s?.fixedTitle&&(t=s?.fixedTitle)}return Y(s,t)}function Q(e){return e.startsWith(d.P1)||e.startsWith(d.wU)||e.startsWith(d.aI)||e.startsWith(d.Cd)||e.startsWith(d.gy)||i.Z.get(u.kExtensionURLOverrides)?.newtab?.some((t=>t.active&&t.entry===e))}function q(e){return e.startsWith(d.P1)||e.startsWith(d.wU)||e.startsWith(d.aI)||e.startsWith(d.Cd)||e.startsWith(d.gy)||e===d.f4||function(e){return i.Z.get(u.kTabsNewPageLink)===d.Fp.CUSTOM&&i.Z.get(u.kTabsNewPageCustomUrl)===e}(e)||function(e){return i.Z.get(u.kTabsNewPageLink)===d.Fp.HOMEPAGE&&i.Z.get(u.kHomepageCache)===e}(e)||Boolean(i.Z.get(u.kExtensionURLOverrides)?.newtab?.some((t=>t.active&&t.entry===e)))}function J(e){return g.some((t=>t.redirect_url===e))}const ee={internals:S,settingCategories:v,isNewTabPage:q,isBannedFromGuestMode:k,isBannedFromPrivateProfileWindows:N,getExtensionUrlFromInternalProtocolUrl:function(e){return e in b?I[b[e]]:e},getFavicon:function(e){if(e.startsWith(A)){return g.find((t=>t.redirect_url===e))?.image_url}if(U(e)||W(e)){const t=_(e);if(t)return t}},getFaviconWithFallback:function(e,t){if(U(e)||W(e)){const s=_(e);if(s)return s;if(""===t)return"/resources/favicon@2x.png"}else if(""===t)return"/resources/default_favicon_64.png";return t},getBookmarkFavicon:P,getDisplayUrlFromMapping:$,getHoverUrl:function(e){let t=$(e);return""===t&&D(e)&&(t="vivaldi://startpage/"),t},getDisplayTitleByUrl:Y,getDisplayTitle:X,hasCustomFavicon:W,removeTrailingSlashWhenNoPath:h.Dy,getUrl:z,isMailPage:H,isNotesManager:K,isStartPage:D,isWelcomePage:M,isInternalUrl:F,isVivaldiComponent:U,isExtensionProtocol:function(e){return e.startsWith(d.Fv)},isOurExtension:function(e){return e.startsWith(d.oP)},isInternalPage:function(e){return F(e.url||"")},isSettingsUrl:L,matchInternal:function(e,t){return j(S[e],t)},matchUrl:j,equalUrl:function(e,t,s){return s?e&&t&&(0,h.OI)(e)===(0,h.OI)(t):e&&t&&(0,h.Iw)(e)===(0,h.Iw)(t)},internalUrl:function(e,t,s,n){const i=S[e],a=i.includes("?")?"&":"?";return i+a+"path="+encodeURIComponent((0,h.Iw)(t))+(s?"&title="+encodeURIComponent(s):"")+(n?"&query="+encodeURIComponent(n):"")},getDirectMatchPopularSites:async function(){return g.length||(g=await l.Z.directMatch.getPopularSites()),g},isBlankUrl:Q}},14507:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});var n=s(67294),i=s(29087);const a=function(e){const[t,s]=n.useState((()=>i.Z.getList(e)));return n.useEffect((()=>{function t(e,t,n){s((e=>({...e,[n]:t})))}return i.Z.addListener(e,t),()=>{i.Z.removeListener(e,t)}}),[e]),t}},39005:(e,t,s)=>{"use strict";s.d(t,{Z:()=>p});var n=s(65398),i=s(29087),a=s(33638),o=s(75401),r=s(84283),l=s(89165),d=s(89175),c=s(22288),h=s(76257);class u extends n.Z{#An;getActiveMessage(){return this.#An&&this.#An.state.message}getActiveMessageUrl(){const e=this.getActiveMessage()?.id;return e?this.getMessageUrl(e):void 0}getMessageUrl(e){return`vivaldi://mail/message/${e}`}getActiveListEntry(){return this.#An&&this.#An.props.listEntry}getAttachments(){return this.#An&&this.#An.state.message?this.#An.state.message.bodyParts?(0,c.yN)(this.#An.state.message.bodyParts).filter((e=>!e.inUse)):this.#An.state.raw?(0,h.Dc)(this.#An.state.raw.mimeTree):[]:[]}getRaw(){return this.#An&&this.#An.state.raw}getRenderingMethod(){return this.#An?.state.renderingMethod??i.Z.get(d.kMailPreferredRendering)}getIsRawMode(){return Boolean("raw"===this.#An?.state.renderingMethod)}isTrash(){return!(!this.#An||!this.#An.props.listEntry)&&r.Z.isMessageDeleted(this.#An.props.listEntry.sources)}isJunk(){if(this.#An&&this.#An.props.listEntry){const{sources:e,flags:t}=this.#An.props.listEntry;return(0,l.Z)(e,t)}return!1}isArchived(){return!(!this.#An||!this.#An.props.listEntry)&&(0,o.Z)(this.#An.props.listEntry.sources)}isListPost(){return!!this.#An?.state.message?.listPost}toggleRenderingMethod(e){this.#An&&this.#An.toggleRenderingMethod(e)}dispatchAction(e){switch(e.actionType){case"MAIL_SET_ACTIVE_COMPONENT":this.#An!==e.mailDetail&&(this.#An=e.mailDetail,this.emitChange());break;case"MAIL_SET_ACTIVE_MESSAGE":this.#An&&(this.#An.setState({message:e.message}),this.emitChange());break;case"MAIL_CLEAR_IF_ACTIVE":this.#An===e.mailDetail&&(this.#An=void 0,this.emitChange());break;case"MAIL_INDEX_UPDATE":{const{updates:t}=e;if(!this.#An||!this.#An.props.listEntry||!t.sleUpdates)return;const{id:s}=this.#An.props.listEntry;t.sleUpdates.some((e=>e.id===s))&&this.emitChange();break}case"MAIL_REFRESH_ACTIVE_MESSAGE":this.emitChange()}}}const p=new u(a.Z)},30626:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});var n=s(65398),i=s(33638);const a=new Map;class o extends n.Z{getActiveWebView(e){return a.get(e)}dispatchAction(e){switch(e.actionType){case"WEBVIEW_CLEAR_IF_ACTIVE":this.getActiveWebView(e.windowId)===e.component&&(a.delete(e.windowId),this.emitChange());break;case"WEBVIEW_SET_ACTIVE":a.set(e.windowId,e.component),this.emitChange()}}}const r=new o(i.Z)},59486:(e,t,s)=>{"use strict";s.d(t,{E:()=>f,Z:()=>Y});var n=s(65398),i=s(68247),a=s(29087),o=s(93974),r=s(33638),l=s(56371),d=s(92292),c=s(57118),h=s(30460),u=s(65741),p=s(20511),g=s(89175),m=s(44850);const f=(0,l.Z)("Bookmarks"),v="topsite-",b=new Map,C=new Map;let w,y,x,I,A,S,Z=[],T=[],E=[],k=!1,N=!1,_=!1,P=[],M=!1;const D=new Map;function O(e,t){const{url:s,title:n,description:i,nickname:a}=e;return t.toLowerCase().split(" ").every((e=>s!==h.p&&s?.toLowerCase().includes(e)||n.toLowerCase().includes(e)||i.toLowerCase().includes(e)||a.toLowerCase().includes(e)))}function j(e){A?.children&&A.children.forEach((e=>{b.delete(e.id)}));const t=e.map(((e,t)=>{const s={id:v+t,title:e.title,url:e.url,nickname:"",description:"",thumbnail:"",partner:e.partner,speeddial:!0,themeColor:"",bookmarkbar:!1,trash:!1,faviconUrl:e.faviconUrl};return b.set(s.id,s),s}));A={id:"topsite-folder",title:(0,l.Z)("Top Sites"),nickname:"",description:"",thumbnail:"",partner:"",speeddial:!0,themeColor:"",bookmarkbar:!1,trash:!1,children:t}}class L extends n.Z{isInitialized(){return M}getRootId(){return w?.id}getTopNodes(){return w?.children||[]}getLastTopNode(){const e=$.getTopNodes();if(e.length>1)return e[e.length-2]}getBookmarkBarFolderId(){return y?.id}getBookmarksBarNodes(){return Z}getSpeeddialFolders(){return T}getTopSiteFolder(){return A}getActiveGroup(e){return D.get(e)??a.Z.get(g.kStartpageSpeedDialRestorePageId)}isFailedUpgrade(){return _}getItemById(e){return b.get(e)}getItemByUrl(e){for(const t of $.iterateTree())if(t.url===e)return t}getUrlByNode(e){return e.url&&$.filterUrl(e.url)||""}filterUrl(e){return e===h.p?"":e}getDragData=(e,t)=>{const s=t.map((e=>$.getItemById(e))).filter(Boolean);if("text/plain"===e){const e=[];return s.forEach((t=>{const s=$.isFolder(t)?t.title:m.jk.getHoverUrl($.getUrlByNode(t));e.push(s)})),e.join("\r\n")}if("text/html"===e){const e=s&&1===s.length?s[0]:void 0;if(e){const t=m.jk.getHoverUrl($.getUrlByNode(e));if(t&&e.title)return"<a href="+t+">"+e.title+"</a>"}return""}if("vivaldi/x-title"===e)return s[0]&&s[0].title||"";if("text/uri-list"===e||"vivaldi/x-uri-list"===e){const e=[];return s.forEach((t=>{$.isFolder(t)||e.push(m.jk.getHoverUrl($.getUrlByNode(t)))})),e.join("\r\n")}return""};getCutIds(){return E}getFilteredTree(e,t){e=e.toLowerCase();const s=[];function n(i){const a=[];for(const o of i)if(t.inTrash||!o.trash){if(o.children?.length){const e=n(o.children);if(e.length&&t.folders){a.push({...o,children:e});continue}}if(O(o,e)){const e={...o};o.children&&t.folders&&s.push(o.id),e.children&&t.folders&&a.push({...e,children:n(e.children)}),!e.children&&t.bookmarks&&a.push(e)}}return a}return{nodes:t.root?n(w?[w]:[]):n($.getTopNodes()),collapsed:s}}getFilteredFlat(e,t){e=e.toLowerCase();const s=[],n=$.iterateTrees($.getTopNodes(),t.inTrash);for(const i of n)(i.children&&t.folders||!i.children&&t.bookmarks)&&O(i,e)&&(i.children?s.push({...i,children:[]}):s.push({...i}));return s}treeSortComparator(e,t,s){if(e.trash)return 1;if(t.trash)return-1;if($.isFolder(e)&&!$.isFolder(t))return-1;if($.isFolder(t)&&!$.isFolder(e))return 1;const{sortOrder:n}=s;let{sortField:i}=s;Object.hasOwn(e,i)||Object.hasOwn(t,i)||(i="title",e[i]||t[i]||(i="dateAdded"));return o.Z.getDefaultComparator(n,i)(e,t)}getFoldersWithin(e,t){return e.filter((e=>!e.trash&&e.children&&!e.url)).reduce(((e,{id:s,title:n,children:i})=>(e.push({id:s,title:n,level:t}),i?e.concat($.getFoldersWithin(i,t+1)):e)),[])}hasNickname(e){if(""===e.trim())return!1;e=e.toLowerCase();for(const t of $.iterateTree(!0))if(e===t.nickname.toLowerCase())return!0;return!1}getNicknamed(e,t){if("string"!=typeof e||e.length<1)return[];e=e.toLowerCase();const s=[];for(const n of $.iterateTree())e===n.nickname.toLowerCase()&&(n.children?t?n.children.forEach((e=>$.isBookmark(e)&&s.push(e))):s.push(n):$.isBookmark(n)&&s.push(n));return s}getDefaultFolderName(){return(0,l.Z)("title","New Folder")}isTrashed(e){return void 0!==x&&$.isDescendantOf(e,x)}isDescendantOf(e,t){for(;;){if(e.id===t)return!0;if(!e.parentId)break;const s=e.parentId?b.get(e.parentId):void 0;if(!s)break;e=s}return!1}isFolder(e){return e.children&&e.children.length>0||void 0===e.url}isPartner(e){return Boolean(e.partner)}isSeparator=e=>"---"===e.title&&"separator"===e.description;isBookmark(e){return!$.isFolder(e)&&!$.isSeparator(e)&&Boolean(e.url?.length)&&e.url!==h.p}isMobileFolder(e){return Boolean(e.id===I)}isTopSite(e){return e.startsWith(v)}validateAsBookmarkBarFolder(e){const t=$.getItemById(e);if(t&&t.children&&!$.isTrashed(t))return t}validateForClipboard=e=>e.filter((e=>e!==x&&e!==I));validateForDrag=e=>e.filter((e=>e!==x&&e!==I));validateForDeletion=e=>e.filter((e=>e!==x&&e!==I));validateForEdit=e=>{if(-1!==P.indexOf(e))return!1;const t=$.getItemById(e);return!(!t||$.isSeparator(t))};getTitle=e=>$.getItemById(e)?.title??"";*iterateTree(e=!1){yield*$.iterateTrees(w?.children||[],e)}*iterateTrees(e,t=!1){for(const s of e)s.trash&&!t||(yield s,s.children&&(yield*$.iterateTrees(s.children,t)))}findByUrl(e){for(const t of $.iterateTree())if(t.url===e)return t}emitChange(){k?N=!0:super.emitChange()}__reset(e){w=e}dispatchAction(e){switch(e.actionType){case"BOOKMARKS_INIT":!function(e,t,s,n,i){P=[],P.push(e[0].id),e[0].children.forEach((e=>{P.push(e.id)}));const a=e[0],o=a.children.find((e=>e.id===t.bookmarks));if(!o)return void console.error("Root bookmark id missing");if(t.mobile){const e=a.children.find((e=>e.id===t.mobile));e&&(I=e.id,e.parentId=o.id,e.index=o.children.length,o.children.push(e))}if(t.trash){const e=a.children.find((e=>e.id===t.trash));e&&(x=e.id,e.parentId=o.id,e.index=o.children.length,o.children.push(e))}void 0===x&&console.error("Trash folder missing");if(C.clear(),Array.isArray(i.folders))for(const e of i.folders)C.set(e.guid,e.title);b.clear(),W(o),w=o,w.parentId=void 0,j(s),V(),_=n}(e.bookmarks,e.folderIds,e.topSites,e.failedUpgrade,e.partnerDB),M=!0,this.emitChange();break;case"BOOKMARKS_SET_BATCH_MODE":e.edit?k=!0:(k=!1,N&&(this.emitChange(),N=!1));break;case"BOOKMARKS_ADD_ITEM":H(e.changes);break;case"BOOKMARKS_CHANGE_ITEM":!function(e,t){let s=b.get(e);if(!s)return;let n=!1;for(const e of Object.keys(t))if(t[e]!==s[e]){n=!0;break}if(!n)return;const i=s.bookmarkbar||t.bookmarkbar!==s.bookmarkbar,a=s.speeddial||t.speeddial!==s.speeddial;s={...s,...t},b.set(s.id,s);let o=null;s.parentId?(o=b.get(s.parentId),o&&o.children&&(void 0!==s.index?o.children[s.index]=s:(o.children[0]=s,console.error("Bookmark node not properly changed. index is missing")))):w&&(w.children=s.children||[]);o&&z(o,i,a);$.emitChange()}(e.id,e.changes);break;case"BOOKMARKS_INSTALL_TOPSITES":void 0!==S&&(j(S),S=void 0,this.emitChange());break;case"BOOKMARKS_MOVE_ITEM":!function(e,t){const s=$.getItemById(e);if(!s)return;G(e,!1),s.parentId=t.parentId,s.index=t.index,H(s)}(e.id,e.changes);break;case"BOOKMARKS_REMOVE_ITEM":G(e.id,!0);break;case"BOOKMARKS_SET_ACTIVE_GROUP":D.set(e.windowId,e.id),i.Z.set(g.kStartpageSpeedDialRestorePageId,e.id);break;case"BOOKMARKS_SET_CUT_IDS":B(e.ids),this.emitChange();break;case"BOOKMARKS_SET_TOPSITES":A?.children&&(A?.children.length>e.topSites.length||A?.children.some((t=>void 0!==e.topSites.find((e=>t.url===e.url)))))?(j(e.topSites),S=void 0,this.emitChange()):S=e.topSites;break;case"WINDOW_CLOSED":D.delete(e.windowId);break;case"WINDOW_READY":E.length>0&&F(!0)}}}function R(e){"Escape"===e.key&&B([])}function B(e){E=e,F(e.length>0),$.emitChange()}function F(e){e?d.Z.extension.getViews().forEach((e=>{e.addEventListener("keydown",R,!0)})):d.Z.extension.getViews().forEach((e=>e.removeEventListener("keydown",R,!0)))}function W(e){if(e.partner){const t=C.get(e.partner);if(t)switch(t){case"Bookmarks":e.title=f;break;case"Speed Dial":e.title=(0,l.Z)("Speed Dial");break;case"Vivaldi":e.title=(0,l.Z)("Vivaldi")}}if(b.set(e.id,e),e.children)for(const t of e.children)W(t)}function U(e){if(b.delete(e.id),e.children)for(const t of e.children)U(t)}function V(){const e=[];let t;const s=function(n){n.url||n.trash||(n.speeddial&&e.push(n),n.bookmarkbar&&(t=n),n.children&&n.children.forEach(s))};w?.children&&w.children.forEach(s),T=function(e){if(e.length<2)return e;let t=[...a.Z.get(g.kStartpageSpeedDialOrder)];if(t.length){const s=e.map((e=>e.id),[]);a.Z.get(g.kDashboardEnabled)&&s.push(c.N4),s.length&&t.length&&!(0,u.Z)([...s].sort(),[...t].sort())&&(t=t.filter((e=>s.includes(e))),t=(0,p.Z)(s,t),i.Z.set(g.kStartpageSpeedDialOrder,t))}return e}(e),y=t||w,Z=(y?.children||[]).filter((e=>!e.trash))}function H(e){const t=e.parentId?b.get(e.parentId):void 0;if(t){const s=t;void 0===e.url&&(e.children||(e.children=[])),W(e),s.children?.splice(e.index||0,0,e),K(s);z(s,!1,Boolean(e.speeddial))}$.emitChange()}function G(e,t){const s=b.get(e);if(!s)return;U(s);const n=s.parentId?b.get(s.parentId):void 0;if(n){const t=n;void 0!==s.index?t.children?.splice(s.index,1):console.error("Bookmark node not removed. index is missing"),K(t);z(t,$.getBookmarkBarFolderId()===e,Boolean(s.speeddial))}t&&$.emitChange()}function K(e){e.children&&e.children.forEach(((e,t)=>{e.index=t}))}function z(e,t,s){for(;e;){e.children=e.children?.slice(),$.getBookmarkBarFolderId()===e.id&&(t=!0),e.speeddial&&(s=!0);const n=e.parentId?b.get(e.parentId):void 0;if(!n)break;e=n}(t||s)&&V()}const $=new L(r.Z),Y=$},27508:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});var n=s(24602);class i extends n.Z{getInitialState(){return{isActive:!1}}reduce(e,t){return"BREAKMODE"===t.actionType?{isActive:!e.isActive}:e}}const a=new i},50522:(e,t,s)=>{"use strict";s.d(t,{Z:()=>C});var n=s(2934),i=s(24602),a=s(42568),o=s.n(a),r=s(30381),l=s.n(r),d=s(58821),c=s(8336),h=s(93513);let u=(0,d.EP)(),p=!1;const g=new Map,m=o()((function(e,t){const s=new Map(e.map((e=>[e.id,e.account_type])));return t.filter((e=>!e.hidden&&s.has(e.accountId)&&"ical"!==s.get(e.accountId)))})),f=o()((function(e){return e.filter((e=>!e.hidden))})),v=o()((function(e,t){const s=new Set(e.map((e=>e.id)));return t.filter((e=>s.has(e.calendarId))).filter((e=>!(e.trash||e.deletePending)))}));class b extends i.Z{getInitialState(){return{accounts:[],calendars:[],events:[],tasks:[],templates:[],currentEdit:{windowId:0,pageId:0,eventId:null}}}isInitialized(){return p}reduce(e,t){switch(t.actionType){case"CALENDAR_INIT":return g.clear(),p=!0,(0,h.Uy)(e,(e=>{const{accounts:s,calendars:n,events:i}=t,a=i.filter((e=>e.task));e.accounts=s,e.calendars=n,e.events=i,e.tasks=a}));case"CALENDAR_INIT_TEMPLATES":return(0,h.Uy)(e,(e=>{const{templates:s}=t;e.templates=s}));case"CALENDAR_SET_EVENTS":return g.clear(),(0,h.Uy)(e,(s=>{const{events:n}=t;for(const t of n){const n=e.events.findIndex((e=>e.id===t.id));if(-1===n)s.events=[...s.events,t],t.task&&(s.tasks=[...s.tasks,t]);else{s.events.splice(n,1,t);const i=e.tasks.findIndex((e=>e.id===t.id));t.task&&-1!==i&&s.tasks.splice(i,1,t)}}}));case"CALENDAR_EVENT_EDIT":return(0,h.Uy)(e,(e=>{e.currentEdit=t.edit}));case"CALENDAR_ADD_TEMPLATE":return(0,h.Uy)(e,(e=>{const{template:s}=t;e.templates.push(s)}));case"CALENDAR_UPDATE_TEMPLATE":return(0,h.Uy)(e,(e=>{const{templateId:s,template:n}=t,i=e.templates.findIndex((e=>e.id===s));-1!==i&&e.templates.splice(i,1,n)}));case"CALENDAR_REMOVE_TEMPLATE":return(0,h.Uy)(e,(e=>{const{templateId:s}=t,n=e.templates.findIndex((e=>e.id===s));-1!==n&&e.templates.splice(n,1)}));default:return e}}getState(){const e=(0,d.EP)();return e!==u&&(n.ZP.loadPromise(),u=e),super.getState()}getAccounts(){return this.getState().accounts}getCalendars(){return this.getState().calendars}getEvents(){return this.getState().events}getTasks(){return this.getState().tasks}getTemplates(){return this.getState().templates}getEvent(e){const[t,s]=e.split("-")[0].split(":"),n=this.getEvents().find((e=>e.id===t));return s&&n?c.tV.call([n],l()(parseInt(s)),"day")[0]:n}getEventsPerCalendar(e){const t=g.get(e);if(t)return t;const s=(0,h.Uy)([],(t=>this.getEvents().filter((t=>t.calendarId===e&&!t.trash))));return g.set(e,s),s}getWritableCalendars(){return m(this.getAccounts(),this.getCalendars())}getVisibleCalendars(){return f(this.getCalendars())}getVisibleEvents(){return v(this.getVisibleCalendars(),this.getEvents())}}const C=new b},6320:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});var n=s(24602),i=s(9126),a=s(48588);class o extends n.Z{getInitialState(){return new Map}reduce(e,t){if("CALENDAR_UPDATE_UI"===t.actionType){const{pageId:s,filter:n}=t;return(0,a.J3)(e,s,n)}return e}getStateForPage(e){return this.getState().get(e)??(0,i.l)(e)}}const r=new o},65398:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});var n=s(56284);class i extends n.Z{constructor(e){super(),e.register(this)}dispatchAction(e){throw new TypeError(`dispatchAction() is not overwritten in ${this.constructor.name}`)}}const a=i},25795:(e,t,s)=>{"use strict";s.d(t,{Z:()=>Ge});var n=s(27770),i=s(48603),a=s(59486),o=s(65398),r=s(27033),l=s(45502),d=s(84451),c=s(76747),h=s(59322),u=s(96951),p=s(18350),g=s(15285),m=s(20676),f=s(24367),v=s(29087),b=s(66971),C=s(18237),w=s(76501),y=s(63365),x=s(93974),I=s(33638),A=s(70864),S=s(63153),Z=s(15489),T=s(53454),E=s(56371);var k=s(92292);const N=function(e){if(null===e||"object"!=typeof e)return e;const t=e.constructor();for(const s in e)e.hasOwnProperty(s)&&(t[s]=N(e[s]));return t},_=function(e){const t=[];for(let s=0;s<e.length;s++)t.push(N(e[s]));return t};var P=s(26036);var M=s(94420),D=s(1810);const O="iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABFUlEQVR4AWJwL/ChCOOUsLKy2m9tbf0fhIHs9SQbACidvK0yCGIgHGISTEj0d4D3tgPoADrgOoAOoIMt6UrQ2XhLAH3vSTzhzwRr5WZGuxpYHh4e7hwfHy80gfyXgIDn09PTpM47FxcXr7pm7q+vr9dBgU3v73SfTk5OipgAp4U5PeoqGvxCIDa3690TSW0Vt3v1xBgqHL4gigluqAyNIOKDVeT+PlLlTmlcf9IAfigfHKXv+1URWSZRFNeDPUFEUQYEua7rraZpNqkY26vj9icRBYEiBbvLkYKLSHs/EqC6izJkgML9Y5vEBMqsXsHfgr0NodX4uD1qUIAEftbWNwIZBJhtBxs0Bj9lCyqn/IU06zMNHe/UfCL6J8KbGwAAAABJRU5ErkJggg==",j="iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAVFBMVEX////ExMTFxcXExMS/v7/FxcXExMTDw8PExMTFxcXHx8e/v7/ExMTExMTFxcXFxcXDw8PGxsbKysrFxcXCwsLDw8PFxcXExMTGxsbGxsbExMTExMQtledLAAAAG3RSTlMA79+fEJ/PgN9/ICCPvzBgkG8wr1BAT18/cHDxOv8OAAAAdUlEQVR4AQXBhQHDIAAAsOBQnRv//7kEAABgn/MOAOptiQBaOS5BnuWRvrDOa98y6wgjZqQEQCp49sYZ4psWP/DY6QTqBzwrgcj+grUPzh7ejLhgKwDsBWtsoS3kS7yGBX7bK82cw3akAaDejgoA0px3AADAH03KBE7hRjloAAAAAElFTkSuQmCC";var L=s(50012),R=s(32782);var B=s(7064);var F=s(54189),W=s(70025),U=s(69046),V=s(10334),H=s(93196),G=s(29489),K=s(21191),z=s(89175),$=s(44850);let Y=!1;const X={windowId:void 0,name:"",items:[],installed:!1,radioCounter:1,radioGroup:{},hasBookmarkContainer:!1,bookmarkExtrasEdge:"below"},Q=!1,q="CONTAINER_WEBPANEL",J="CONTAINER_CLOSED_WEBPANEL",ee="CONTAINER_TAB",te="CONTAINER_PINNED_TAB",se="CONTAINER_CLOSED_TAB",ne="CONTAINER_ALL_WINDOW",ie="CONTAINER_ALL_WINDOW_LIST",ae="CONTAINER_OTHER_WINDOW",oe="CONTAINER_OTHER_WINDOW_LIST",re="CONTAINER_OTHER_WORKSPACE",le="CONTAINER_OTHER_WORKSPACE_LIST",de="CONTAINER_SESSIONS",ce="CONTAINER_BOOKMARK",he="CONTAINER_PERIODIC_RELOAD",ue="CONTAINER_MAC_SERVICES",pe="CONTAINER_SHARE_MENU",ge=["COMMAND_OPEN_LINK","COMMAND_OPEN_LINK_BACKGROUND","COMMAND_OPEN_LINK_CURRENT","COMMAND_OPEN_LINK_DEFAULT","COMMAND_HIDE_OTHERS","COMMAND_HIDE_VIVALDI","COMMAND_SHOW_ALL"],me=[{name:q,hideInSettings:!1},{name:J,hideInSettings:!1},{name:ee,hideInSettings:!1},{name:te,hideInSettings:!1},{name:se,hideInSettings:!1},{name:ne,hideInSettings:!1},{name:ie,hideInSettings:!1},{name:ae,hideInSettings:!1},{name:oe,hideInSettings:!1},{name:re,hideInSettings:!1},{name:le,hideInSettings:!1},{name:de,hideInSettings:!1},{name:he,hideInSettings:!1},{name:ce,hideInSettings:Q},{name:ue,hideInSettings:!0},{name:pe,hideInSettings:!0}];let fe=[];const ve={},be=new Map(H.CN.map((e=>[e.name,e.feature]))),Ce=["COMMAND_CLOSE_TAB","COMMAND_CLOSE_WINDOW","COMMAND_EXIT","COMMAND_QUIT_MAC_MAYBE_WARN","COMMAND_NEW_WINDOW","COMMAND_NEW_PRIVATE_WINDOW","COMMAND_SHOW_HELP","COMMAND_WINDOW_MINIMIZE"],we=H.CN;let ye;function xe(e){const t=ye||(ye={MENU_FILE:{...(0,P.Z)("win_linux","File")},MENU_EDIT:{...(0,P.Z)("win_linux","Edit")},MENU_VIEW:{...(0,P.Z)("win_linux","View")},MENU_BOOKMARKS:{isVisible:()=>!Z.ZP.isGuest(),...(0,P.Z)("win_linux","Bookmarks")},MENU_PANELS:{...(0,P.Z)("win_linux","Panels")},MENU_TOOLS:{...(0,P.Z)("win_linux","Tools")},MENU_MAIL:{isVisible:()=>f.Z.isFeedsOn(),...(0,P.Z)("win_linux","Mail")},MENU_WINDOW:{...(0,P.Z)("win_linux","Window")},MENU_HELP:{...(0,P.Z)("win_linux","Help")},MENU_IMAGES_AND_ANIMATION:{...(0,P.Z)("win_linux","Images and Animations")},MENU_CAPTURE:{iconPNG:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAADCSURBVHgB1ZHBEcIgEEXB5JBjSsASvDFwoRMtQSvQDqwhlXiCqyXEDsydYfDvIRlEUK/5h7Cz87O8zzK2evFSU2s94hBpL8b4cM5t2S8ZY4RSaiwMfUopRd5v6YMfDpzzK8reez+hPuZGEJyaprlhkCAaeC7W2mFBLk3/RklEKV7MTURFJoqDc88+I8UlQklAPIcQdl3XMcS6ozWUfBtWVz8XyDzVTFWC+dFwe1961DfVVlRTuuo2vY1W9M+A2qpXqhfDA07BmbR5ZAAAAABJRU5ErkJggg==",iconPNGWhite:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAAXNSR0IArs4c6QAAAGRJREFUeNq9j8EVwCAIQx2FzeqmvcTnGBmBEegBq/hKjy3ckk+Mpfw5IMy3MbFPWTK0S7BahcKgOIJCWONQwI0PmVAHLGbNu+UsAOwy71JAu2xl7fkEY9kb0LeSI8s/lWzI+nQuBXxjN95EoeQAAAAASUVORK5CYII=",...(0,P.Z)("win_linux","Capture")},MENU_EXPORT:{...(0,P.Z)("win_linux","Export")},COMMAND_OPEN_PAGE:{ellipsis:!0},COMMAND_FOCUS_ADDRESSFIELD:{ellipsis:!0,...(0,P.Z)("Open Location")},COMMAND_SAVE_PAGE:{ellipsis:!0},COMMAND_PRINT_PAGE:{ellipsis:!0},COMMAND_START_CHROMECAST:{ellipsis:!0},COMMAND_IMPORT_DATA:{ellipsis:!0},COMMAND_EXPORT_DATA:{ellipsis:!0},COMMAND_EXPORT_FEEDS:{ellipsis:!0},COMMAND_EXPORT_PASSWORDS:{ellipsis:!0},COMMAND_EXPORT_READINGLIST:{ellipsis:!0},COMMAND_EXPORT_NOTES:{ellipsis:!0},COMMAND_OPEN_SESSION:{ellipsis:!0},COMMAND_SAVE_SESSION:{ellipsis:!0},COMMAND_TOGGLE_WARN_ON_QUIT:{prefs:{pref:z.kSystemShowExitConfirmationDialog,isChecked:()=>!0===v.Z.get(z.kSystemShowExitConfirmationDialog)}},COMMAND_FIND_IN_PAGE:{ellipsis:!0},COMMAND_TOGGLE_MENU_POSITION:{prefs:{pref:z.kMenuDisplay,isChecked:()=>{const e=v.Z.get(z.kMenuDisplay);return!0===e||"top"===e||"on"===e}},...(0,P.Z)("Horizontal Main Menu")},COMMAND_MAIN_TOGGLE_TAB_BAR:{prefs:{windowState:"tabs",isChecked:e=>Z.ZP.getVisibleUI(e).tabs},...(0,P.Z)("command","Show Tab Bar")},COMMAND_MAIN_TOGGLE_ADDRESS_BAR:{prefs:{windowState:"addressBar",isChecked:e=>Z.ZP.getVisibleUI(e).addressBar},...(0,P.Z)("command","Show Address Bar")},COMMAND_SHOW_BOOKMARK_BAR:{prefs:{windowState:"bookmarksBar",isChecked:e=>Z.ZP.getVisibleUI(e).bookmarksBar},...(0,P.Z)("command","Show Bookmarks Bar")},COMMAND_TOGGLE_FOOTER:{prefs:{windowState:"statusBar",isChecked:e=>"on"===Z.ZP.getVisibleUI(e).statusBar},...(0,P.Z)("command","Show Status Bar")},COMMAND_TOGGLE_STARTPAGE_NAVIGATION:{prefs:{pref:z.kStartpageNavigation,isChecked:()=>{const e=v.Z.get(z.kStartpageNavigation);return"on"===e||"speed_dial_only"===e}},...(0,P.Z)("command","Show Start Page Navigation")},COMMAND_TOGGLE_PRIVACY_STATS:{prefs:{pref:z.kStartpageSpeedDialPrivacyStatsShow,isChecked:()=>{const e=v.Z.get(z.kStartpageSpeedDialPrivacyStatsShow);return!0===e||"speed_dial_only"===e}},...(0,P.Z)("command","Show Privacy Statistics")},COMMAND_TOGGLE_PANEL:{prefs:{panelState:"SHOW_PANEL",isChecked:e=>g.ZP.getIsBarVisible(e)},...(0,P.Z)("command","Show Panel")},COMMAND_SHOW_BOOKMARK_PANEL:{iconPNG:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAACJSURBVHgB7ZKxCoAgEIavaG3wBcJGt2ZdnHurXiR6itY2X6Pew8HOUAgREaWtH0Tvzv87Dg6gUk2YEEKceNHYZ2PMpZQaISUEmCDV+xOpQQuV+gFfA6SUlDE2FAGsWWt9EEL2FKRLmXHzNhs7yJwN8GZc28XGnPMHArkjvM1W7r1CjrDbVFIr1g1wAzRdx1+LFgAAAABJRU5ErkJggg==",iconPNGWhite:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAAXNSR0IArs4c6QAAAE9JREFUeNpjYCAWHLl/5D8CHr2PqeA/hP7PC4Iw3jBVsF/hmjYeBfsVjtw/+hCkBKsCsHT90XqQEqwKQNIgFkgJVgUQaYgSLAqOGuDm4QUAABBqP/s39jMAAAAASUVORK5CYII=",persistent:!0},COMMAND_SHOW_MAIL_PANEL:{iconPNG:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAACFSURBVHgB7ZHRDYAgDETBMAhuoL8wBZOyBb+6gWyCVyOmQSAMwCWkTem7tKkQUzIn1toLQY9AKaUYQlgpV6yu8bEjejyHhpNDxphNSunR4xCPXF940ws5MiGgBpfGqhyPGgBkE/fs2YB/E9Qm6cFNA27Sg6srVEy64gYRp0xiQHRGMfXpBmxdTd/71HkZAAAAAElFTkSuQmCC",iconPNGWhite:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAATklEQVR42s3PsQ3AMAgEwB+J/ev/ORiFFAhjKxTuEqiAkwDgJ0FnvFPeIGRyWdUyuoyxAaBJjrO7gSI1HkASrlUDAGR9yQiO3+L+zY/jAaekW1uCzRxFAAAAAElFTkSuQmCC"},COMMAND_SHOW_CONTACTS_PANEL:{iconPNG:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAF0SURBVHgBtVM7boNAEOVnic72BSwiX8DpIn8UcgIfIeEEzg1QTuA6nW8Q5wZE4lcmXTrb0KTcBgnxzRuLtQhQIEUeabXLm3lvZ98IQfhniH2KFovFnSiK93TO89z3PO+D56Q+AmVZakVRqLQgpCNGPKfUCymRZdkzCJsK2g0Ggxfse+AbEiAwjmMSYK0O0jTdgjwE6QbrFtAYmGlZVozWv7q6E+u3o/jgOM64iZFgFEUa9jUu+IEHry0PqC0kWV0dN9M3S5JkKMvyOYddrXvQy0QKPOFMgg/k0yMXuQj4vn+Ew8JyudQ5Np/PZ+hKcF33pCiKxnESQcdrOv+ZAgQMEN5WqxXtjM6SJBlV6wzEeu2oJYDQiQjjPlVVpamQyAz43rZti2xp1Atyrd0nmj9ueaDnINh0On3H27eTyYSFYdg5RpmTsZmczJNcBPhO07RTEATfTQGpek+LzAOjJHMN5M2uDi4ewKQDfpquGvoXaB2Fa8QvffXhZBpebQgAAAAASUVORK5CYII=",iconPNGWhite:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAvklEQVR42pWQMQ7CMAxFMzLmBvgIjGx0ZOzIVjbGjh3bG/QIcBNL2EkkFo7gI+QIILeiTSMqgS1FSfzy429j/g/eU0ONP6wC7uRaTbTJJVrqOHLkHi1uqFEgQCp7HUrAN+6N8ccMQMtx3qF97FzrL8n7AE4mLXHbAK6lOukhB1QhQ1ioGBzsFPXl6CNUE0AFx3s5rnoaAV/PQOckAAILdd9Gc9by4AJYuFotfxD9Jh2SLGam/TwzgF/LnE3/EG8smIVnSsnf6AAAAABJRU5ErkJggg=="},COMMAND_SHOW_DOWNLOADS_PANEL:{iconPNG:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAADPSURBVHgBxZLBDYIwFIZblTtMAIYpBA51BKfwzAS6gUePzuAGvUC4OoFNF5B7k9a/Rkw1QCQQ/ZKmf1/7+t5rHyEjoV0baZpeMUVWG2NEWZZLMgRcYNr0JzMykv9fsGgEY8xXSt26Drrv4HlewDmv3zKwBkrpGlJorfOiKF4/9NQ5Ro091jhb5m4UKaWI4/iMbzuGYRhgza09y7I9bFs4r6qqurg+rX2AciKUc4LTIxIy85H2xo38FUmS7FD7gfyEvm7rOztdHwA+IAtOpuIO/nhVS2EDB78AAAAASUVORK5CYII=",iconPNGWhite:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAb0lEQVR42mNgIAUcuX/k/5H/R+/jVvAfQdJbwX4BkONAEKIAAvcLICk57HDk/rECuEkFR94fs0c3ReHI/cMNYMUNR+8fV8Digv0KR/YfXX90/ZH9KIajgqP1R/oZyADYfY4kSljBfpjfUeB+oqwHAI1/WdoNOXPUAAAAAElFTkSuQmCC"},COMMAND_SHOW_NOTES_PANEL:{iconPNG:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAACgSURBVHgB7VLBDYQgENw1FnAlWAeEGrSEK+GugrsOtAU70CKgDkuwAnBMNFHCRhM/PpwPsDPsLuwQXQRvD0qpNzPX2L5S4hDCAP5vrW3XWLbLxvyTLi98gaXZxvJIU6BK5ZzrUwmMMaX3viMJWutAB4g1GV1EfqbKCnwen0qQEj4dyIjHOMLOpSSGkarZzmIHIL+wa4MnJN0GF47gP3QrTBi9PG385uw1AAAAAElFTkSuQmCC",iconPNGWhite:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAASklEQVR42mNgIA4cTTjy/sh/BDx6/0g8ioIj95GlwfA9qoL/R/2R+Yf8j/xHU4BuKTkKkF0wRE14jxZQAUfvo8cFamC/R4sLCgAAKuF43sJZFFMAAAAASUVORK5CYII="},COMMAND_SHOW_HISTORY_PANEL:{iconPNG:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAD8SURBVHgB3VJLDoIwEG1BYMsR8Aa647fgKHAC4gn0BsQTKCfwCOCChB3eQI9QtxDAmYQmTW2NOxMnadKZad983iPk10blQJIk3jAMJ7hu4LhCis3zXE/TtGvb9sGDhuJzhw8ty1o3TUP5QZ9SejVNs/N93yMqC8PwEgRBLsXukr+PoqhSdgAVEsdxSinmib5t28dlvHcAnLmua0Y+2JJ3dQBK0878JUBpGEalA5EBGDAhUkeAgRS3DyAF+kue6QBufd/nchUEgeVleAeaU6SZ51biQ+A6Qx0AlU9g4ywvNI7jA3zOQUxbHlMqEbookFIiKRE7HMcxE5X4B/YCuLpojZ4/JTwAAAAASUVORK5CYII=",iconPNGWhite:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAf0lEQVR42rWQ3RWAIAiFHcER2jA3sFHawBF46GJjNAIj2Kn879RT4QMIH4hXqc+MBhAE4TzCbh36srAlHW8aBtIg7PwYoy16C6oASOpGyFOkBsJb1KXT20/AzNuFtEDe4UTcfQdiW31aKwVzYI0O3hQdlqnT4UDYFSVBXflP2wFyclxBF22/4AAAAABJRU5ErkJggg=="},COMMAND_SHOW_WINDOW_PANEL:{iconPNG:F.Z,iconPNGWhite:W.Z},COMMAND_SHOW_CALENDAR_PANEL:{iconPNG:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAACISURBVHgB1ZLBDYAgDEVr4wCOwBgEhnEGN3AEV3AST8whI7ABloQmmCgQ5aAvIfxC+wsEgNYopXat9Z7TKR0L2hxpWmgMhR6WxmyMWUOAvOq9nyuKAyI2OkMn8FBJmovwErxy5w53OmvwmGZv8O8rOCmlKBXHHMtxz4J+4oSIG7mLgocLufAZDrWyPsrbeWhUAAAAAElFTkSuQmCC",iconPNGWhite:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAACSSURBVHgB1ZLBDYAgDEVLwwCOwBps4wg6gW6gKziJFwhj6AgOAMFyICFR0agHfQnJb9r+hqYAb6O1nsLL6RSWNJbe+45kkRvAGJsRsZVSDiHGJNecNQdoiHDO9ZuEUsrDRdJahIfgnnuccKSzBrd5bQf//sJijBFnzaGGjmmOMY+CTrS21o7kLnIGVLNwziv4DCvpcHNLdZSTOwAAAABJRU5ErkJggg=="},COMMAND_SHOW_TASKS_PANEL:{iconPNG:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAERSURBVHgBzVLLjcIwFLQ3Th9sB3DMT5vtYLcEOoAKklRACdABdAAoykfKATqAOhIlYR6ykSXicISRLP9m5o2fzNg74LruVK25WoRhOGmaZk1Lndz3/TXP82+19zxvgWlV1/WsqqqzUBcQb0HegfxrqiyLrMDbkJjOhHY/hXjGRgDxnhJ1XZeosy/24o0Kvu/HmCaWZS3LsrwaDUjMOT9JwR1BEPyhcoQRp2m60/mPJqI5fZZlXJpEMIkxEiHERkZnejONCQggJlSNqqLbe4qOdw82d9BAN0EKEi/0dyPh5UlATxgychznZ4xrTKBQFMVx7F43OOidN0Fyzmr/+Ei2bc/pNyJeNGaAvhzatv1nH4Mbqq2RljjZ0ywAAAAASUVORK5CYII=",iconPNGWhite:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAEKSURBVHgBzVLLrcIwELQjp4+8DuCa3yMdQAl0ABWEVEAJ0AF0ACi/I3QAfeTHrJRFlojDEUaysl7vzO6sIsQ3kOf5hGPJQVmWTtM0O4QzvbjrukcQBH98z7Jshc9WSjn1PO+m+AHkA5JHJCNT577JFuGeyJRT2vsEyakYQdu2J5qoruuEc5b44JGRpukGZAdnHUXRwyhAZBRdicC5oijmsBfjbMIwPOr1ryViOZ3v+7IXiSFCHROl1J5GxxH6Mo0TELCLhLpR1963A9+Dyx0U0EWIbFnWSveNCe9vBLIwJAT//2O1xgkYrutext51gbO+eRP6mhvfXz9SVVVL27YPGC/+oHFG7UL8DJ7QEZCpKicQ5QAAAABJRU5ErkJggg=="},COMMAND_SHOW_READING_LIST_PANEL:{iconPNG:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAADUSURBVHgB3VI9DoIwFC5EAiOOMNUbOANDb+B13AgnMd6EiXALewMZbZq2vhJryrPKYmLiG6B8fd8PyUfIryeyj7quL/Ci+NIYw6NoXgneDcOw2zy+aZIk277vJ38JhE9KqW4cR+7jjLFcSnm1ZydALLmqqha7WDLGYbcD8YWTIYHBRJTOLBJ8ImAc/r0Lqq0R/z0BpTRbI7qBHmQvCYqiaMuyvPmL0ELWNM2ktc59HEr0NHMCPI7jY8gNyrQHoTyA89mEvBmISYUQB3tO0/SMa/61uQN54WmwgBUnOAAAAABJRU5ErkJggg==",iconPNGWhite:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAADGSURBVHgB3VJBDsIgEISEJh7rD+oPvPdiX+B3vDV9ifElvRS+IT+wRxMIOHvAINDUg4lJ98CSYWdnEoaxfxenQ0p599432SPnmvrSW9u2BxEGjDH7ruvmeGiapivwAbiO8XEc66qqHnQXASQynPSJkCZyikN5wPIPJc8KVViYccQ3hJKD4rY14tYd4G93a8RQNJs5QDB6EJ7xIAJ2UkrN6HWCv8VCEjWieUHP1JxzR7Q6xYlDnbOFgs1GCHGmu7X2lsb8Z/UCQg+R4phOstoAAAAASUVORK5CYII="},COMMAND_SHOW_TRANSLATE_PANEL:{iconPNG:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAE5SURBVHgB3VI7UoRAEB0QqggnNKAo9gaYAsFwAr0BG5pZnkD3BLqZmXoDPYEkfIyWGzgBB5gUKMDXyFqL5a6x21Wvunv697qBsX8hvu/fEH6LafuKgiC4G4aBj0ma5pGGX06+StP0mmx9XwMkJ1AcyS70PWFqxKfYYQYkQgi3bdtN13VnlmUx2B+wF0VRyG3OyW4B9lw6jrOxbVtVVfUupVTwT3Vdv+z7fonJD3mev+7WzFYAxfFQKLjYvpmmuSIygIcmzz9Zfq8QhqHAhDfgFo0IkWEYZdM0j1QMXyLmwk6AdZZl5YwBgjEgEaCJCvY59hUo5Jgc4eoR3ld0VCCeMcCxOB0IRYomIEFAc9BfJEmi2AEZGYAm7Uzf/AmQwAv5dV3H7A8x2NfxrqDKif4o+JG86ZhrdtzyCZCjjl4nqbGPAAAAAElFTkSuQmCC",iconPNGWhite:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAEiSURBVHgB3VDLbYNQEHxAgAsHSiAdkCtw8Ksg6YB0kKSCxBXEVGC7A3eAJeBsOjAlICFx4edZtEi25c/ZXmned2d3doR4iMiy7Jdw6U+5RkrT9F9RFJuvLu85LcMwlEEQ/NBZvVYA5G3f9zaSHWDBcOmN/u4qoIjj2NF1fadp2hvdu67bN03zKqUsLhbAnJ/oslRV9dvzvGgahUbgcTa+78+POecjjEZB5sf0gI5EmJF8FF6L81GnQ5IkM3SJgT8kE6RlWXld10sUJAUF4CB1C0RQkp8oQPUQpIIllkh+r6qKOttt20q4LuHBnE0NTxTALBtm7UEqucNIZMNKcSNGBYZh0Mxk0gooQN7Q3TTNUNyJF1pA+MKWHzsM9102MxLPHQec65fa3EMkXwAAAABJRU5ErkJggg=="},COMMAND_SHOW_SESSION_PANEL:{iconPNG:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABhmlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw1AUhU9TpSoVh3YQcchQnSyKigguWoUiVCi1QqsOJi/9gyYNSYqLo+BacPBnserg4qyrg6sgCP6AODs4KbpIifclhRYxXni8j/PuObx3HyDUy0w1O8YAVbOMVDwmZrKrYuAVPoTQjRmMSszU55LJBDzr6566qe6iPMu778/qVXImA3wi8SzTDYt4g3hq09I57xOHWVFSiM+JRwy6IPEj12WX3zgXHBZ4ZthIp+aJw8RioY3lNmZFQyWeJI4oqkb5QsZlhfMWZ7VcZc178hcGc9rKMtdpDSKORSwhCREyqiihDAtR2jVSTKToPObhH3D8SXLJ5CqBkWMBFaiQHD/4H/yerZmfGHeTgjGg88W2P4aAwC7QqNn297FtN04A/zNwpbX8lTow/Ul6raVFjoC+beDiuqXJe8DlDtD/pEuG5Eh+WkI+D7yf0TdlgdAt0LPmzq15jtMHIE2zStwAB4fAcIGy1z3e3dU+t397mvP7AcU6cshc5dfNAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH6AETCgAkeJuDiQAAAQdJREFUOMul0r1KA1EQBeAvWSFFSKkIgqLYWtgYFYtF8OcZ8jRpfQHRF/AptNfKwtpCEkXdUhCEDbGZwGXd/IAHBu6ePWfmztnlLzZxjQFKjKPK4K5CA5oV8xnuMUSOFhpRreDeQnNaN/kD++bjILQbWUJe4BY3FfEyVrGE7+CGaOO8kQgHccXnhNvFWvL8isc4b+MubVDGnqNkcrfm+g8okOEnDTFLzNCZsv+EHyFrzgjqaw6fYZQ26FWEReyskkER5y0MGzUTupH2U5JFJyYXia6Plao5x+eU8FIc4h3rdeZ8iimLT9ePn+gkfdkO83hGlXjBZXXyBEfR+dg/sGgGM7GHnUXFvzNAPn779Pc/AAAAAElFTkSuQmCC",iconPNGWhite:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAC6HpUWHRSYXcgcHJvZmlsZSB0eXBlIGV4aWYAAHja7ZdbktwgDEX/WUWWgCSExHIwmKrsIMvPBT+me2byquQnVW3KgAUW8j2Cngn7t68jfMFFJXNIap5LzhFXKqlwRcfjcZVVU0yrPh/i1Xmyh3uAYRK0cjxaPedX2PXthWsN2p7twc8R9tPR5fl0KHNlRqc/Bgk7H3ZKp6OyH51c3B5D3fho2zlxhXLe4wrLjmY+h0dDMqjUFQsJ8y4kcdV+RCDzTlLREmqSwrM3+yweVpPPSCDI0+fdAsZHgZ5Evnrhvfp37534XE+7vNMynxqh8+kA6efiL4kfFpY7In4eMLlcfSLy6D7GfnxdTRmK5jOjlth0ucHEDZLLei2jGG5F31YpKB5rbEDeY4sbSqNCDCojUKJOlQbtq23UEGLinQ0tc2NZNhfjwm0RS7PQYJMiXRywGu9BBGa+Y6G1blnrNXKs3AlTmeCM8MoPS/jZ4J+UMEabElH0WyvExTOvEcYkN2vMAhAaJzddAl/lxB8f8gepCoK6ZHZ8YI3b4WJTesstWZwF8xTtsYUoWD8dQCKsrQgGaZ8oZhKlTNGYjQg6OgBVRI59whsIkCp3BMlJBOeRsfNcG+8YrbmsnHmacTYBhEoWA5siFbBSUuSPJUcOVRVNqprV1IMWrVlyyppztjwPuWpiydSymbkVqy6eXD27uXvxWrgIzkAtuVjxUkqtHCoWqvBVMb/CsvEmW9p0y5ttvpWtNqRPS01bbta8lVY7d+k4Jnru1r2XXncKO06KPe26591238teB3JtyEhDRx42fJRRb2on1Q/lD6jRSY0XqTnPbmqwBrPLBc3jRCczEONEIG6TABKaJ7PolBJPcpNZLIxNoYwgdbIJnSYxIEw7sQ662b2R+y1uQf23uPGvyIWJ7l+QC0D3kdsn1Pr8nWuL2LELp6ZRsPswp7IH3DGi+tv25ejl6OXo5ejl6OXo5ej/dyQDfzzgn9jwHXUtnbaAnZZ1AAAAZnpUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHjaPUwxEoAwCNt5hU8oJFfb53jUwc3B/5+RwXAQSHLYdT9pW4HdMBicXI2qHxGeLbBrPRBoasYSu6ZjlptyT10OZfToI/QKlIRhL/aAF2jrZm+xAAABhmlDQ1BJQ0MgcHJvZmlsZQAAeJx9kT1Iw1AUhU9TpSoVh3YQcchQnSyKigguWoUiVCi1QqsOJi/9gyYNSYqLo+BacPBnserg4qyrg6sgCP6AODs4KbpIifclhRYxXni8j/PuObx3HyDUy0w1O8YAVbOMVDwmZrKrYuAVPoTQjRmMSszU55LJBDzr6566qe6iPMu778/qVXImA3wi8SzTDYt4g3hq09I57xOHWVFSiM+JRwy6IPEj12WX3zgXHBZ4ZthIp+aJw8RioY3lNmZFQyWeJI4oqkb5QsZlhfMWZ7VcZc178hcGc9rKMtdpDSKORSwhCREyqiihDAtR2jVSTKToPObhH3D8SXLJ5CqBkWMBFaiQHD/4H/yerZmfGHeTgjGg88W2P4aAwC7QqNn297FtN04A/zNwpbX8lTow/Ul6raVFjoC+beDiuqXJe8DlDtD/pEuG5Eh+WkI+D7yf0TdlgdAt0LPmzq15jtMHIE2zStwAB4fAcIGy1z3e3dU+t397mvP7AcU6cshZ7VMUAAAPRGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNC40LjAtRXhpdjIiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6aXB0Y0V4dD0iaHR0cDovL2lwdGMub3JnL3N0ZC9JcHRjNHhtcEV4dC8yMDA4LTAyLTI5LyIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgIHhtbG5zOnBsdXM9Imh0dHA6Ly9ucy51c2VwbHVzLm9yZy9sZGYveG1wLzEuMC8iCiAgICB4bWxuczpHSU1QPSJodHRwOi8vd3d3LmdpbXAub3JnL3htcC8iCiAgICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgICB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iCiAgIHhtcE1NOkRvY3VtZW50SUQ9ImdpbXA6ZG9jaWQ6Z2ltcDpiYjJkZWQ3Yy1lZjU2LTQwNTUtODEzNC1iNjdiMTUxNDY5ZWEiCiAgIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6Y2NkOTQ1M2EtMzZmMy00ZDYyLTgwNGMtYzkzM2E2NGVjMWE5IgogICB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6OTliOTYwYmQtYWIwYi00ZTY0LWFhZTMtY2JmZWU4YzllMDU3IgogICBHSU1QOkFQST0iMi4wIgogICBHSU1QOlBsYXRmb3JtPSJMaW51eCIKICAgR0lNUDpUaW1lU3RhbXA9IjE3MDU2NjAxMDgwMjM0MTkiCiAgIEdJTVA6VmVyc2lvbj0iMi4xMC4xOCIKICAgZGM6Rm9ybWF0PSJpbWFnZS9wbmciCiAgIHhtcDpDcmVhdG9yVG9vbD0iR0lNUCAyLjEwIj4KICAgPGlwdGNFeHQ6TG9jYXRpb25DcmVhdGVkPgogICAgPHJkZjpCYWcvPgogICA8L2lwdGNFeHQ6TG9jYXRpb25DcmVhdGVkPgogICA8aXB0Y0V4dDpMb2NhdGlvblNob3duPgogICAgPHJkZjpCYWcvPgogICA8L2lwdGNFeHQ6TG9jYXRpb25TaG93bj4KICAgPGlwdGNFeHQ6QXJ0d29ya09yT2JqZWN0PgogICAgPHJkZjpCYWcvPgogICA8L2lwdGNFeHQ6QXJ0d29ya09yT2JqZWN0PgogICA8aXB0Y0V4dDpSZWdpc3RyeUlkPgogICAgPHJkZjpCYWcvPgogICA8L2lwdGNFeHQ6UmVnaXN0cnlJZD4KICAgPHhtcE1NOkhpc3Rvcnk+CiAgICA8cmRmOlNlcT4KICAgICA8cmRmOmxpCiAgICAgIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiCiAgICAgIHN0RXZ0OmNoYW5nZWQ9Ii8iCiAgICAgIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6NzYzMWJlMDUtYTNiNy00YWJkLThjZmUtMjJmNTU1NWVmYWY5IgogICAgICBzdEV2dDpzb2Z0d2FyZUFnZW50PSJHaW1wIDIuMTAgKExpbnV4KSIKICAgICAgc3RFdnQ6d2hlbj0iKzAxOjAwIi8+CiAgICA8L3JkZjpTZXE+CiAgIDwveG1wTU06SGlzdG9yeT4KICAgPHBsdXM6SW1hZ2VTdXBwbGllcj4KICAgIDxyZGY6U2VxLz4KICAgPC9wbHVzOkltYWdlU3VwcGxpZXI+CiAgIDxwbHVzOkltYWdlQ3JlYXRvcj4KICAgIDxyZGY6U2VxLz4KICAgPC9wbHVzOkltYWdlQ3JlYXRvcj4KICAgPHBsdXM6Q29weXJpZ2h0T3duZXI+CiAgICA8cmRmOlNlcS8+CiAgIDwvcGx1czpDb3B5cmlnaHRPd25lcj4KICAgPHBsdXM6TGljZW5zb3I+CiAgICA8cmRmOlNlcS8+CiAgIDwvcGx1czpMaWNlbnNvcj4KICA8L3JkZjpEZXNjcmlwdGlvbj4KIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAKPD94cGFja2V0IGVuZD0idyI/PueZfIMAAAAGYktHRAD/AP8A/6C9p5MAAAAJcEhZcwAADdcAAA3XAUIom3gAAAAHdElNRQfoARMKHBy27mZKAAABF0lEQVQ4y5WSvUoDURCFv2SLFGKpCEJEyQvYGBWLIKjv4MsY8B3EPIy9VhbWFpIo/pQBRdjw2czG63WT6IGB3cPMOXNnBpUsNtWBOlRLv1EGdxk5qDT5iRPgGhgBPaAFNCJawT1FzjFA7vyi7tZ0lcde5G401Mp9EM7nWVcrwDIwBt4S/gxYSwWG0eJ9krQNrCf/j8BtfHeAq1SgjHdOEucuv3ETnRTAZzrEIikm2q5DxU+AoslsjBfwBTBJBU6zxLd4M9kMqkFuAaN0BhW6wDtwt2ALfWA1329PfVW7C+5gX31W23XFvRlFhdpR+3FER+r0EpeieB5K9UG9UNuVcOpwEMqHfzhl6gT+M4Np1G1hB/hItjAXX/ppnhihX/8aAAAAAElFTkSuQmCC"},COMMAND_SHOW_FEEDS_PANEL:{iconPNG:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAD5SURBVHgB7VA7DoJQEHxIoLYnIXoEOwIkPo9gZ6c30BvoDdQTSGsnN3iGTw0nwAR6KQUCOBhsUFFLEyfZ7L7Pzs4sIT8PrnmhadoZ6VSWpcfzvGlZ1qGNoNO8EAShXxTFguM4grxWVTVQFKVHPlXQBAiWIFtA0ch1Xa/5zpMnFmRZniAuYRj6iCPqBCQ7SZL2URTF7ywMMG2LcnWX7zjOBmcDO9l9ZQFqDJANRVEcVOcsywIoGdu2zV4q0HWdonFKKe1i8gwNcZqmc8ZYDLINFjtttYBPlUwjSZLbRzQYIKFVDQs+Em0lABgizvOc1YQmoldb8MgfD7gCpH9zwi7KjVoAAAAASUVORK5CYII=",iconPNGWhite:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAD1SURBVHgB7VHLDYJAFNyFAFdL0BI4Ej5CCVaAHUgH2oFYgdiBVgDhE65YgXQgZ74OBhKDEbyaOJfdN7s7b+YtIT8POiTCMLxjSSmlSVVVF03TzmMCzJAoimLBMIzVNA2ByD6Kolscx3PyrYMhILCFmAUxQ5blZFKgj8CyrC1J0qnjLCxbcCK4lExEEOu6PpRluevtK4pi48jBTI6TDl7h+76Drss8z8W25jjuhjgrVVW9jw6CINDR1XRdd4YfWONBxvP8xjCMDHOwMWBzNAIuHGHVEQTB7GoHInq7B39FPH1UAPDarrDuPTNSekE97yIk5I83PADL5XR/KpV1NwAAAABJRU5ErkJggg=="},CONTAINER_WEBPANEL:{...(0,P.Z)("Web Panels"),settingsLabel:(0,E.Z)("[All Web Panels]")},CONTAINER_CLOSED_WEBPANEL:{...(0,P.Z)("Closed Web Panels"),settingsLabel:(0,E.Z)("[All Closed Web Panels]")},COMMAND_SET_LOAD_IMAGES_ALWAYS:{prefs:{pref:z.kPageImageLoading,isChecked:e=>"always"===v.Z.get(z.kPageImageLoading)}},COMMAND_SET_LOAD_IMAGES_NEVER:{prefs:{pref:z.kPageImageLoading,isChecked:e=>"never"===v.Z.get(z.kPageImageLoading)}},COMMAND_SET_LOAD_IMAGES_CACHE:{prefs:{pref:z.kPageImageLoading,isChecked:e=>"cache"===v.Z.get(z.kPageImageLoading)},...(0,P.Z)("Load Images from Cache")},COMMAND_SET_ANIMATIONS_LOOP:{prefs:{animationPref:"allowed"}},COMMAND_SET_ANIMATIONS_NEVER:{prefs:{animationPref:"none"}},COMMAND_SET_ANIMATIONS_ONCE:{prefs:{animationPref:"once"}},COMMAND_MAIN_ZOOM_IN:{persistent:!0},COMMAND_MAIN_ZOOM_OUT:{persistent:!0},CONTAINER_BOOKMARK:{settingsLabel:(0,E.Z)("[All Bookmarks]"),settingsRename:!1,isVisible:()=>!Z.ZP.isGuest()},COMMAND_MAIL_SHOW_SETTINGS:{iconPNG:O,iconPNGWhite:j,ellipsis:!0},COMMAND_SHOW_SETTINGS:{iconPNG:O,iconPNGWhite:j,ellipsis:!0},COMMAND_SHOW_QUICK_COMMANDS:{ellipsis:!0},COMMAND_CAPTURE_PAGE_TO_DISK:{...(0,P.Z)("Page to File")},COMMAND_CAPTURE_PAGE_TO_CLIPBOARD:{...(0,P.Z)("Page to Clipboard")},COMMAND_TAB_TRANSLATE_PAGE:{...(0,P.Z)("command","Translate Page")},COMMAND_CAPTURE_AREA_TO_DISK:{...(0,P.Z)("Area to File")},COMMAND_CAPTURE_AREA_TO_CLIPBOARD:{...(0,P.Z)("Area to Clipboard")},COMMAND_SHOW_CLEAR_PRIVATE_DATA:{ellipsis:!0},COMMAND_FULLSCREEN:{...(0,P.Z)("Fullscreen")},COMMAND_MAIN_TOGGLE_UI:{prefs:{windowState:"minimalUI",isChecked:e=>!Z.ZP.isMinimalUI(e)},...(0,P.Z)("Show UI")},CONTAINER_PINNED_TAB:{...(0,P.Z)("title","Pinned Tabs"),settingsLabel:(0,E.Z)("[All Pinned Tabs in Window]")},CONTAINER_CLOSED_TAB:{...(0,P.Z)("title","Closed Tabs"),settingsLabel:(0,E.Z)("[All Closed Tabs]")},CONTAINER_ALL_WINDOW:{...(0,P.Z)("title","All Windows and Tabs"),settingsLabel:(0,E.Z)("[All Windows and Tabs]")},CONTAINER_ALL_WINDOW_LIST:{...(0,P.Z)("title","All Windows"),settingsLabel:(0,E.Z)("[All Windows]")},CONTAINER_OTHER_WINDOW:{...(0,P.Z)("title","Other Windows and Tabs"),settingsLabel:(0,E.Z)("[Other Windows and Tabs]")},CONTAINER_OTHER_WINDOW_LIST:{...(0,P.Z)("title","Other Windows"),settingsLabel:(0,E.Z)("[Other Windows]")},CONTAINER_OTHER_WORKSPACE:{isVisible:()=>v.Z.get(z.kWorkspacesEnabled),...(0,P.Z)("title","Other Workspaces and Tabs"),settingsLabel:(0,E.Z)("[Other Workspaces and Tabs]")},CONTAINER_OTHER_WORKSPACE_LIST:{isVisible:()=>v.Z.get(z.kWorkspacesEnabled),...(0,P.Z)("title","Other Workspaces"),settingsLabel:(0,E.Z)("[Other Workspaces]")},CONTAINER_TAB:{...(0,P.Z)("title","Tabs"),settingsLabel:(0,E.Z)("[All Tabs in Window]")},CONTAINER_PERIODIC_RELOAD:{...(0,P.Z)("title","Periodic Reload"),settingsLabel:(0,E.Z)("[Periodic Reload]")},CONTAINER_SESSIONS:{...(0,P.Z)("Sessions"),settingsLabel:(0,E.Z)("[All Sessions]")},COMMAND_CHECK_FOR_UPDATES:{ellipsis:!0},COMMAND_SHOW_ABOUT:{iconPNG:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAEySURBVHgBzVLLTcQwEHU+yjkN5EMHHPM75MgROqADditIOHKDClg6gAowUn43tgQraYAjRErCG5FFjjd7hifZ4xm9eTNjm7G/hkFbkiS54zivruv6Xde9nCLHcUycned5Wtu2nGI6bdM0ZTPnOgzDzVoyiqQwqcL/EQD4b0DXszRNbVXANM09zMfs7hcCmqbdSly77/sbVYBzTsmCzsMwXC0EiqLgaOv5EITgJggCnx3DBm/XNI1YCBAsy9pKLdqGYTzKo9BFw/jjOMrdMk12oijKUD0/+KgmaF7EfNhz+HlVVQsBXXbQxYPUBY3iY13OyQLVn5gCQ3aEEJ945y8cL1Qi3Utd129HcbYCfJh3qiqPgtbP1rj6WhDVtoqfsxMw1oL4pgKj0AsEWPdlWd6xf4tvaZVsnjSI7BsAAAAASUVORK5CYII=",iconPNGWhite:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAjUlEQVR42q1QSRGAMAysBCQgBSdYwAE4qAQkICEPtvBEAhIqYZm2FAIDvEhe2dlrYswPM3Yg+isGAccuHww7NUpSJUyxQXgpMkEKeBDLje9aFbGAc3mcbkgeJ4TV6VZSRktCUkyorfTRo91jVjcEex2nazHTbvqY2pwE1I8PC9ZJ//bR6lMfPSwIa36eDUlAgXmKiZFsAAAAAElFTkSuQmCC"}},ye);const s=t[e.action],i=s?.label??"",a=s?.labelEnglish??"",o=function(e){const t=e.parameter;if(void 0===t)return;if("COMMAND_OPEN_LINK"===e.action)return{handler:e=>{const s=n.ZP.getOpenOptionsFromDisposition(e.windowId,"setting",!1,e.keyState);h.ZP.openURL(e.windowId,t,{...s})},url:t};return}(e);return o?{...s,...o,label:i,labelEnglish:a}:{...s,label:i,labelEnglish:a}}function Ie(e,t){e.forEach((e=>{const{name:s,function:n,feature:i}=e,a={autoRepeat:e.onAutoRepeat||!1,isEnabled:e.isEnabled,isFeatureShortcut:"browser"!==e.feature,tweakedShortcut:e.tweakedShortcut,feature:e.feature};d.Z.bind(t,n,a),fe.push({name:s,key:t,func:n,feature:i})}))}function Ae(e,t,s){for(let n=s.length-1;n>=0;n--)if(s[n].items)Ae(e,t,s[n].items);else if(s[n].commandName===e){t.shortcuts?s[n].shortcuts=t.shortcuts:delete s[n].shortcuts;break}}function Se(e){const t=r.Z.getState(),s=v.Z.get(z.kActions)[0];[...t.map((e=>{const t=(0,G.IN)(e),n=s[t.name];if(n)return{key:t.name,value:{...n,feature:"browser"}}})).filter(Boolean),...e].forEach((e=>Ze(e))),function(){fe.forEach((e=>{d.Z.unbind(e.key,e.func)})),fe=[];const e=He.getCommandsForShortcuts();Object.keys(e).forEach((t=>{Ie(e[t],t)}))}(),Y=!0}function Ze(e){ve[e.key]=e.value,X.installed&&Ae(e.key,e.value,X.items)}function Te(e){if(ve[e]){const{shortcuts:t}=ve[e];delete ve[e],t?.length&&d.Z.unbind(t)}B.Z.menuContent.removeAction([e])}function Ee(e){return t=>{const s=v.Z.get(z.kChainedCommandsCommandList);for(let n=s.length-1;n>=0;n--)if(s[n].key===e)return void(0,V.hT)(t,s[n].chain);console.warn("No chain match for: ",e)}}function ke(e,t){const s={},n=r.Z.getScripts().map((e=>(0,G.IN)(e))),i=we.concat(v.Z.get(z.kChainedCommandsCommandList)).concat(n);for(const n in ve){const a=ve[n];if(!a)continue;const o=a[e];o&&i.filter((e=>e.name===n&&(!0===t||!(0,H.os)(e.name)))).forEach((e=>{o.forEach((t=>{s[t]=(s[t]||[]).concat({function:e.chain?Ee(e.key):e.action,label:e.label,name:e.name,onAutoRepeat:e.repeat,isEnabled:t=>"CATEGORY_COMMAND_CHAIN"===e.category||e.isVisible(t)&&e.isEnabled(t),tweakedShortcut:e.tweakedShortcut,feature:e.feature||"browser"})}))}))}return s}function Ne(e,t){let s=c.Z.commandItem;const n=xe(e),i=e.type;if("folder"===i)s={id:e.id,commandName:e.action,items:[],type:i,...n,withNoWindow:!0},e.children&&e.children.forEach((e=>{const n=Ne(e,t);n&&s.items&&s.items.push(n)}));else if("command"===i)s={id:e.id,commandName:e.action,type:i,...n};else if("checkbox"===i)s={id:e.id,commandName:e.action,type:i,...n};else if("radio"===i){if(!e.radiogroup)return;{let t=X.radioGroup[e.radiogroup];void 0===t&&(X.radioGroup[e.radiogroup]=X.radioCounter++,t=X.radioGroup[e.radiogroup]),s={id:e.id,commandName:e.action,type:i,radiogroup:t,...n}}}else if("container"===i){if(-1!==me.findIndex((t=>t.name===e.action))){const a={content:e.action,mode:e.containermode,edge:e.containeredge,cpp:e.action===ce||e.action===pe||e.action===ue};s={id:e.id,type:i,...n,container:a,withNoWindow:!0},t&&e.action===ce&&(X.hasBookmarkContainer=!0,e.containeredge&&(X.bookmarkExtrasEdge=e.containeredge))}}else"separator"===e.type&&(s={...c.Z.separatorItem,id:e.id});void 0!==e.title&&(s.label=e.title,s.settingsLabel&&delete s.settingsLabel,s.ellipsis=!1),void 0!==e.custom&&(s.custom=e.custom),s.showshortcut=e.showshortcut,s.feature=be.get(e.action)||"browser";const a=ve[e.action];return s.shortcuts=a?.shortcuts,s}function _e(e){for(const t of e){if(t.items){_e(t.items);continue}const e=t.prefs;if(!e)continue;const{callback:s}=e;s&&(e.pref?v.Z.removeListener(e.pref,s):e.animationPref?k.Z.accessibilityFeatures.animationPolicy.onChange.removeListener(s):e.panelState?g.ZP.removeListener(s):e.windowState&&Z.ZP.removeListener(s),e.callback=void 0)}}function Pe(e,t,s){const n=(e,t)=>{e.statestrings&&(e.label=e.statestrings[t?1:0].label,e.labelEnglish=e.statestrings[t?1:0].labelEnglish),e.checked=t},i=(e,t)=>{const s=()=>{if("function"==typeof t.isChecked){const s=void 0!==t.windowId&&t.isChecked(t.windowId);e.checked!==s&&(n(e,s),He.emitChange("menuState"))}};return t.callback=s,s};for(const a of t){if(a.items){Pe(e,a.items,s);continue}const t=a.prefs;if(!t)continue;t.windowId=e;const o=t.pref;if(o){if("function"==typeof t.isChecked){const e=void 0!==t.windowId&&t.isChecked(t.windowId);n(a,e),s&&v.Z.addListener(o,i(a,t))}}else if(t.animationPref){if(s){const e=function(){k.Z.accessibilityFeatures.animationPolicy.get({},(({value:e})=>{const s=e===t.animationPref;this.checked!==s&&(n(this,s),He.emitChange("menuState"))}))}.bind(a);t.callback=e,e(),k.Z.accessibilityFeatures.animationPolicy.onChange.addListener(e)}}else if(t.panelState)switch(t.panelState){case"SHOW_PANEL":case"SHOW_CONTENT":if("function"==typeof t.isChecked){const e=void 0!==t.windowId&&t.isChecked(t.windowId);n(a,e),s&&g.ZP.addListener(i(a,t))}}else if(t.windowState&&"function"==typeof t.isChecked){const e=void 0!==t.windowId&&t.isChecked(t.windowId);n(a,e),s&&Z.ZP.addListener(i(a,t))}}}function Me(e,t,s){const n=v.Z.get(z.kChainedCommandsCommandList),i=t=>{for(let o=0;o<t.length;o++){const r=t[o];let d=!1;if(r.commandName){for(let e=n.length-1;e>=0;e--){const t=n[e];if(t.name===r.commandName){r.handler||(r.handler=Ee(t.key)),r.label||(r.label=t.label||""),r.labelEnglish||(r.labelEnglish=t.labelEnglish||t.label||""),d=!0;break}}if(!d)for(let e=0;e<we.length;e++){const t=we[e];if(t.name===r.commandName){r.isEnabled||(r.isEnabled=t.isEnabled),r.isVisible||(r.isVisible=t.isVisible),r.handler||(r.handler=t.action),r.checkedHandler||(r.checkedHandler=t.checkedAction),r.withNoWindow=t.withNoWindow,r.label||(r.label=t.label||""),r.labelEnglish||(r.labelEnglish=t.labelEnglish||""),d=!0;break}}}if(d||"command"!==r.type||(console.warn("No match for menu item",r,r.commandName),void 0===r.label&&(r.label=r.commandName||""),void 0===r.labelEnglish&&(r.labelEnglish=r.commandName||""),r.isVisible=()=>!1,r.handler=()=>{}),Pe(e,[r],s.updateCallbacks),r.commandName){const t=ve[r.commandName]?.shortcuts;if(t){const s=l.Z.getContext(e)?.feature||"browser",n=r.feature||"browser";r.shortcuts=t.filter((e=>n===s||("browser"===n?!fe.some((t=>t.key===e&&(0,K._5)(t.feature,s))):void 0)))}}if(r.items)i(r.items);else if(r.container&&s.expandContainers)if(!0===r.container.cpp)if(r.container.content===ce){const e=r.container.edge||X.bookmarkExtrasEdge,t=v.Z.get(z.kBookmarksManagerSorting),s=x.Z.toMenuSorting(t.sortOrder,t.sortField),n={id:a.Z.getRootId()??"-1",type:B.Z.menubarMenu.ContainerType.BOOKMARKS,offset:0,edge:e,groupFolders:t.sortOrder!==x.Z.NO_SORTING,sortField:s.field,sortOrder:s.order};r.container&&(r.container.details=n)}else r.container.content===ue||r.container.content;else{let s,n,i=[];if(r.container.content===q)i=De(e);else if(r.container.content===J)i=Oe(e);else if(r.container.content===te){const t=u.ZP.getActiveWorkspace(e);i=We(e,!0,t,e),s=M.Z,n=D.Z}else if(r.container.content===se)i=je();else if(r.container.content===ne)i=Re(Z.Ex);else if(r.container.content===ie)i=Le(Z.Ex);else if(r.container.content===ae)i=Re(e);else if(r.container.content===oe)i=Le(e);else if(r.container.content===re)i=Fe(e);else if(r.container.content===le)i=Be(e);else if(r.container.content===ee){const t=u.ZP.getActiveWorkspace(e);i=We(e,!1,t,e)}else r.container.content===he?i=m.Z.getForActivePage(e):r.container.content===de&&(i=Ue(e));"folder"===r.container?.mode?(delete r.container,r.type="folder",r.items=i,r.iconPNG=s,r.iconPNGWhite=n):(t.splice(o,1,...i),o+=i.length-1)}}},o=_(t);return i(o),o}function De(e){return g.ZP.getOrderedWebPanels(e).map(((t,s)=>{const n=ve["COMMAND_SHOW_WEB_PANEL_"+(s+1)],i="JS_LOCAL_TOGGLE_WEBPANEL",a=t.id;return{...c.Z.makeNumberMnemonic(t.title||t.url||(0,E.Z)("Unknown Web Panel"),s),isList:!0,commandName:i,parameter:a,url:t.activeUrl,shortcuts:n?.shortcuts??[],handler:()=>He.executeLocalAction(e,i,a)}}))}function Oe(e){const t=v.Z.get(z.kPanelsWebRemovedElements).map(((t,s)=>{const n="JS_LOCAL_RESTORE_WEBPANEL",i=t.id;return{...c.Z.makeLabelPair(t.title||t.url||(0,E.Z)("Unknown Web Panel")),isList:!0,mnemonic:!1,commandName:n,parameter:i,handler:()=>He.executeLocalAction(e,n,i)}}));if(t.length){const s="JS_LOCAL_CLEAR_CLOSED_WEBPANELS",n="";t.push(c.Z.separatorItem),t.push({...(0,P.Z)("panel","Clear All"),commandName:s,parameter:n,handler:()=>He.executeLocalAction(e,s,n)})}return t}function je(){function e(e,t){const s=(e=>e.length>70?e.substring(0,70)+"...":e)($.jk.getDisplayTitle(e)),n="JS_LOCAL_REOPEN_CLOSED_TAB",i=e.sessionId,a=e.url;return{...c.Z.makeNumberMnemonic(s,t),isList:!0,commandName:n,parameter:i,url:a,handler:()=>He.executeLocalAction(Z.Ex,n,i)}}const t=y.Z.getTrash().map(((t,s)=>t.tab?e(t.tab,s):t.window&&t.window.tabs?function(t,s){const n="JS_LOCAL_REOPEN_CLOSED_WINDOW",i=t.sessionId;return{...(0,P.Z)("Window with $1 Tab","Window with $1 Tabs",[s.length]),items:s.map(((t,s)=>e(t,s))).concat([c.Z.separatorItem,{...(0,P.Z)("Restore All"),isList:!0,commandName:n,parameter:i,handler:()=>He.executeLocalAction(Z.Ex,n,i)}])}}(t.window,t.window.tabs):void 0)).filter(Boolean);if(t.length){t.push(c.Z.separatorItem);const e="JS_LOCAL_CLEAR_CLOSED_TABS",s="";t.push({...(0,P.Z)("panel","Clear All"),commandName:e,parameter:s,handler:()=>He.executeLocalAction(Z.Ex,e,s)})}return t}function Le(e){return Z.ZP.getIds("normal").filter((t=>t!==e)).map(((t,s)=>{const n=u.ZP.getActivePage(t),i=(0,E.Z)("title","Window")+" - "+(n?$.jk.getDisplayTitle(n):""),a="JS_LOCAL_ACTIVATE_WINDOW",o=t.toString();return{...c.Z.makeNumberMnemonic(i,s++),isList:!0,commandName:a,parameter:o,handler:()=>He.executeLocalAction(e,a,o)}}))}function Re(e){return Z.ZP.getIds("normal").filter((t=>t!==e)).map(((t,s)=>{const n="JS_LOCAL_ACTIVATE_WINDOW",i=t.toString(),a=[{...c.Z.makeLabelPair((0,E.Z)("Activate")),commandName:n,parameter:i,handler:()=>He.executeLocalAction(e,n,i)},{...c.Z.separatorItem},{...c.Z.makeLabelPair((0,E.Z)("Pinned Tabs")),type:"folder",items:We(t,!0,void 0,t)},...We(t,!1,void 0,t)],o=u.ZP.getActivePage(t),r=(0,E.Z)("title","Window")+" - "+(o?$.jk.getDisplayTitle(o):"");return{...c.Z.makeNumberMnemonic(r,s),type:"folder",items:a}}))}function Be(e){const t=u.ZP.getActiveWorkspace(e);return T.Z.getState().filter((e=>e.id!==t)).map(((t,s)=>{const n="JS_LOCAL_ACTIVATE_WORKSPACE",i=t.id.toString();return{...c.Z.makeNumberMnemonic(t.name,s),commandName:n,parameter:i,handler:()=>He.executeLocalAction(e,n,i)}}))}function Fe(e){const t=[],s=u.ZP.getActiveWorkspace(e),n=T.Z.getState().filter((e=>e.id!==s)),i=u.ZP.getActiveWorkspaces();for(let s=0;s<n.length;s++){const a=n[s],o="JS_LOCAL_ACTIVATE_WORKSPACE",r=a.id.toString(),l=[{...c.Z.makeLabelPair((0,E.Z)("Activate")),commandName:o,parameter:r,handler:()=>He.executeLocalAction(e,o,r)},{...c.Z.separatorItem},...We(i.get(a.id)??e,!1,a.id,void 0)];t.push({...c.Z.makeNumberMnemonic(a.name,s),type:"folder",items:l})}return void 0!==s?[...t,{...c.Z.separatorItem},...We(e,!1,void 0,e)]:t}function We(e,t,s,n){return(void 0===n?u.ZP.getWorkspaceTabs(s,"off"===v.Z.get(z.kTabsStackingMode)):u.ZP.getWorkspaceTabsInWindow(n,s,"off"===v.Z.get(z.kTabsStackingMode))).filter((e=>e.page.pinned===t)).map(((t,s)=>{if("tab"===t.type){const n=t.page,i="JS_LOCAL_ACTIVATE_TAB",a=n.id.toString(),o=n.vivExtData.fixedTitle??$.jk.getDisplayTitle(n);return{...c.Z.makeNumberMnemonic(o,s),isList:!0,commandName:i,parameter:a,url:n.url,emphasized:n.active,handler:()=>He.executeLocalAction(e,i,a)}}if("group"===t.type)return{...c.Z.makeNumberMnemonic((0,U.XN)(t.page)??$.jk.getDisplayTitle(t.page),s),type:"folder",isList:!0,iconPNG:L.Z,iconPNGWhite:R.Z,items:t.pages.toArray().map(((t,s)=>{const n="JS_LOCAL_ACTIVATE_TAB",i=t.id.toString(),a=t.vivExtData.fixedTitle??$.jk.getDisplayTitle(t);return{...c.Z.makeNumberMnemonic(a,s),isList:!0,commandName:n,parameter:i,url:t.url,emphasized:t.active,handler:()=>He.executeLocalAction(e,n,i)}}))}})).filter(Boolean).toArray()}function Ue(e){return C.ZP.getAll().map(((t,s)=>{const n="JS_LOCAL_OPEN_SESSION",i=t.id.toString();return{...c.Z.makeNumberMnemonic(t.name,s),isList:!0,commandName:n,parameter:i,handler:()=>He.executeLocalAction(e,n,i)}}))}class Ve extends o.Z{getIsInitialized(){return Y}getClosedTabContainer(){return je()}getCommandsForShortcuts(){return ke("shortcuts",!1)}getCommandsForGestures(){return ke("gestures",!0)}getCommands(){return we}getShortcut(e,t=!0){const s=ve[e];if(s?.shortcuts){const n=c.Z.formatShortcut(e,s.shortcuts);return t?n?(0,E.Z)("($1)",[n]):"":n}return""}getQuickCommands(e){return this.getCommands().filter((t=>{const s=ve[t.name];s?.shortcuts&&(t.shortcuts=s.shortcuts);const n=t.isVisible(e)&&t.isEnabled(e),i=l.Z.getContext(e),a=t.feature||"browser",o="browser"===a||(0,K._5)(a,i.feature);let r;return r="function"==typeof t.showInQC?t.showInQC(e):t.showInQC,n&&o&&r}))}getCommandConfiguration(e){return ve[e]}getAllCommands(e){const t=v.Z.get(z.kChainedCommandsCommandList).map((e=>{const{shortcuts:t,gestures:s,feature:n}=ve[e.name]||{};return{...e,shortcuts:t,gestures:s,feature:n}}));return we.reduce(((t,s)=>{if(e!==Z.Ex&&!s.isEnabled(e))return t;if(s.platforms&&!s.platforms.some((e=>"windows"===e)))return t;const{shortcuts:n,gestures:i,feature:a}=ve[s.name]||{};return t.push({...s,shortcuts:n,gestures:i,feature:a}),t}),[]).concat(t)}getVivDefinedCommands(){const e=this.getUserEditableCommands(),t=r.Z.getState().map((e=>({...(0,G.IN)(e),gestures:[],shortcuts:[],feature:"browser"})));return e.filter((e=>"CATEGORY_COMMAND_CHAIN"!==e.category)).concat(t)}getChainCommandsShortcuts(){return this.getUserEditableCommands().filter((e=>"CATEGORY_COMMAND_CHAIN"===e.category)).map((e=>{const t=this.getCommandConfiguration(e.name);return{name:e.name,...t&&{shortcuts:t.shortcuts}}}))}getSettingsList(e){const t=He.getUserEditableCommands(),s=r.Z.getState().map((e=>{const t=(0,G.IN)(e),s=He.getCommandConfiguration(t.name);return{...t,...s&&{shortcuts:s.shortcuts,gestures:s.gestures},feature:"browser"}}));return e?t.filter((e=>!(0,H.xU)(e.name)&&!(0,K.Ed)(e.name))).concat(s):t.filter((e=>!(0,H.xU)(e.name)&&!(0,K.jD)(e.name)&&!(0,K.Ed)(e.name))).concat(s)}isShortcutAccepted(e,t){if(Z.ZP.isSettings(e)){for(const e in ve)if(void 0!==ve[e]){const s=ve[e];if(s.shortcuts&&s.shortcuts.includes(t))return Ce.includes(e)}return!1}return!0}isActionAcceptedForSettings(e){return Ce.includes(e)}isNamedMenuAvailable(e){return X.name===e}getMenuContentName(){return X.name}getNamedMenu(e,t,s){if(this.isNamedMenuAvailable(t)){const t=X.windowId!==e;return t&&_e(X.items),X.windowId=e,Me(e,X.items,{expandContainers:s,inSettings:!1,updateCallbacks:t})}return[]}getBookmarkExtrasEdge(){return X.bookmarkExtrasEdge}makeMenuWithContent(e,t,s){const n=[];return t.forEach((e=>{const t=Ne(e,!1);t&&n.push(t)})),Me(e,n,s)}getMenuItem(e,t,s){let n=t;if("folder"===n.type)return{label:t.action,labelEnglish:t.action};"container"!==n.type||s||(n={...t,containermode:"folder"});const i=this.makeMenuWithContent(e,[n],{expandContainers:!s,inSettings:s,updateCallbacks:!1});return 1!==i.length||"separator"!==i[0].type&&void 0===i[0].label?{label:t.action,labelEnglish:t.action}:(Pe(e,i,!1),i[0])}executeLocalAction(e,t,s){const n=He.getHandlerByLocalAction(e,t,s);return n&&n(),Boolean(n)}getHandlerByLocalAction(e,t,s){let a;switch(t){case"JS_LOCAL_ACTIVATE_TAB":{const t=parseInt(s),n=u.ZP.getPageById(t);n&&(a=async()=>{const t=(0,U.cm)(n),s=void 0!==t?e:n.windowId;await h.ZP.setActiveWorkspace(s,t),await h.ZP.activateTab(n.id,s)});break}case"JS_LOCAL_ACTIVATE_WINDOW":a=()=>S.Z.focus(parseInt(s));break;case"JS_LOCAL_ACTIVATE_WORKSPACE":{const t=parseInt(s);a=()=>h.ZP.setActiveWorkspace(e,t);break}case"JS_LOCAL_ADD_ACTIVE_TAB_TO_BOOKMARKS":{const t=s,n=u.ZP.getActivePage(e);n&&t&&(a=()=>i.Z.bookmarkPageInFolder(n,t));break}case"JS_LOCAL_TOGGLE_WEBPANEL":{const t=s;t&&(a=()=>p.Z.toggleContent(e,t));break}case"JS_LOCAL_RESTORE_WEBPANEL":{const t=s;t&&(a=()=>A.Z.restoreById(e,t,!0));break}case"JS_LOCAL_CLEAR_CLOSED_WEBPANELS":a=()=>A.Z.emptyTrash();break;case"COMMAND_OPEN_LINK":s&&(a=()=>{const t=n.ZP.getOpenOptionsFromDisposition(e,"setting",!1,{});h.ZP.openURL(e,s,{...t})});break;case"JS_LOCAL_OPEN_SESSION":s&&(a=()=>b.Z.open(e,[Number(s)],!0));break;case"JS_LOCAL_REOPEN_CLOSED_TAB":s&&w.Z.undeleteTab(s);break;case"JS_LOCAL_REOPEN_CLOSED_WINDOW":if(s){const e=y.Z.getTrash().find((e=>e.window?.sessionId===s));e?.window&&w.Z.undeleteWindow(e.window.sessionId)}break;case"JS_LOCAL_CLEAR_CLOSED_TABS":a=()=>w.Z.emptyTrash();break;default:void 0!==s&&(a=m.Z.getHandlerByAction(e,t,s))}return a}getUserEditableCommands(){return this.getAllCommands(Z.Ex).filter((e=>!ge.includes(e.name)))}makeCommandList(e,t){const s=we.filter((s=>t?t===s.name:!(s.inMenu&&!s.inMenu(e,!0))));return void 0===t&&s.push(...me.filter((e=>!(e=>!!(e.hideInSettings||e.name===ce&&X.hasBookmarkContainer))(e))).map((e=>({name:e.name,behavior:"container"})))),this.makeMenuWithContent(e,s.map((e=>{switch(e.behavior){case"checkbox":return{id:e.name,action:e.name,type:"checkbox"};case"radio":return{id:e.name,action:e.name,type:"radio"};case"container":return{id:e.name,action:e.name,containermode:"folder",type:"container"};default:return{id:e.name,action:e.name,type:"command"}}})),{expandContainers:!1,inSettings:!0,updateCallbacks:!1})}getCommandParameter(e){if(1===we.filter((t=>t.name===e)).length)return H.FD[e]}getCommandLabel(e){const t=we.filter((t=>t.name===e));if(1===t.length)return t[0].label}getOpenLinkName(){return"COMMAND_OPEN_LINK"}getCommandByGuid(e){return this.getAllCommands(Z.Ex).find((t=>t.guid===e))}getIsContainer(e){return me.some((t=>t.name===e))}dispatchAction(e){switch(e.actionType){case"COMMAND_INITIALIZE":Se(e.items),this.emitChange("init");break;case"COMMAND_RESET":n=e.items,Object.keys(ve).forEach((e=>{delete ve[e]})),Se(n),this.emitChange("init");break;case"COMMAND_SET_NAMED_MENU":t=e.name,s=e.content,X.installed&&_e(X.items),X.windowId=void 0,X.name=t,X.radioCounter=1,X.radioGroup={},X.items=[],X.hasBookmarkContainer=!1,X.bookmarkExtrasEdge="below",s?s.forEach((e=>{const t=Ne(e,!0);t&&X.items.push(t)})):console.error("No entries in menu:",t),Pe(X.windowId,X.items,!0),X.installed=!0,this.emitChange("menu");break;case"COMMAND_UPDATE_COMMAND":Ze(e.item),function(e){const t=He.getCommandsForShortcuts();fe.map(((e,t)=>({...e,index:t}))).filter((t=>t.name===e.key)).forEach((e=>{d.Z.unbind(e.key,e.func),fe.splice(e.index,1)})),e.value.shortcuts?.forEach((e=>{Ie(t[e],e)}))}(e.item),this.emitChange("shortcut");break;case"COMMAND_REMOVE_COMMAND":Te(e.key),this.emitChange("shortcut");break;case"CONTENT_SCRIPTS_UPDATED":e.updated.forEach((e=>Te(e))),this.emitChange("shortcut")}var t,s,n}}const He=new Ve(I.Z),Ge=He},72010:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r,s:()=>a});var n=s(65398),i=s(33638);const a=-1;class o extends n.Z{_contacts=new Map;_selectedContact;getAsArray(){return[...this._contacts.values()]}getAsTree(e){const t=e?e.toLowerCase():e;return t?this.getAsArray().filter((e=>this._hasFilter(e,t))):this.getAsArray()}getSelected(){return this._selectedContact}getNodeById(e){return this._contacts.get(e)}getAddressesById(e){return this._contacts.get(e)?.emailAddresses.map((e=>e.emailAddress))}getContactsWithAddress(e){const t=this.getAsArray().filter((t=>{if(t.emailAddresses&&t.emailAddresses.length>0)return t.emailAddresses.some((t=>t.emailAddress.toLowerCase()===e.toLowerCase()))}));if(t.length>0)return t[0]}hasContact(e,t){return this.getAsArray().some((s=>!!(s.emailAddresses&&s.emailAddresses.length>0)&&(s.emailAddresses.some((e=>e.emailAddress.toLowerCase()===t.toLowerCase()))&&s.name===e)))}isTrustedEmailAddress(e){for(const t of this.getAsArray())for(const s of t.emailAddresses)if(s.emailAddress.toLowerCase()===e.toLowerCase()&&t.trusted)return!0;return!1}getMailAddresses(){const e=new Map;for(const t of this._contacts.values())t.emailAddresses.forEach((s=>{const n=s.emailAddress.toLowerCase(),i=e.get(n);i?i.add(t.name):e.set(n,new Set([t.name]))}));return e}dispatchAction(e){switch(e.actionType){case"CONTACT_ADD_CONTACT":this._addContact(e.contact);break;case"CONTACT_ADD_CONTACTS":this._addContacts(e.contacts);break;case"CONTACT_DELETE_CONTACTS":this._delete(e.ids);break;case"CONTACT_INITIALIZE":this._initialize(e.contacts,e.newContact);break;case"CONTACT_SELECT_CONTACT":this._select(e.contact,e.focusContactView);break;case"CONTACT_UPDATE_CONTACT":this._update(e.contact)}}_update(e){this._contacts.set(e.id,e),this._selectedContact?.id===e.id&&(this._selectedContact=e),this.emitChange({reason:"updatedContact"})}_initialize(e,t){e.forEach((e=>{this._contacts.set(e.id,e)})),t?(this._selectedContact=t,this.emitChange({reason:"newContact",contact:t,focusContactView:!0})):this.emitChange({reason:"startup"})}_addContact(e){this._contacts.set(e.id,e),this.emitChange({reason:"addContacts"})}_addContacts(e){e.forEach((e=>{this._contacts.set(e.id,e)})),this.emitChange({reason:"addContacts"})}_delete(e){e.forEach((e=>{this._contacts.delete(e),this._selectedContact?.id===e&&(this._selectedContact=void 0)})),this.emitChange({reason:"deleteContact"})}_select(e,t){this._selectedContact=e,this.emitChange({reason:"selectedContact",contact:e,focusContactView:t})}_hasFilter(e,t){if(!t||0===t.length)return!0;if(e.name&&e.name.toLowerCase().indexOf(t)>-1)return!0;if(e.emailAddresses){let s=!1;if(e.emailAddresses.forEach((e=>{e.emailAddress.toLowerCase().indexOf(t)>-1&&(s=!0)})),s)return!0}return!1}}const r=new o(i.Z)},27033:(e,t,s)=>{"use strict";s.d(t,{Z:()=>o});var n=s(24602),i=s(33638);class a extends n.Z{getInitialState(){return[]}getScripts(){return this.getState()}reduce(e,t){switch(t.actionType){case"CONTENT_SCRIPTS_UPDATED":case"CONTENT_SCRIPTS_INITIALIZE":return t.scripts}return e}}const o=new a(i.Z)},45502:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});var n=s(24602),i=s(48588);const a={area:"content",feature:"browser"};class o extends n.Z{getInitialState(){return new Map}isBrowserFeature(e){return"browser"===(e||"browser")}getContext(e){const t=this.getState().get(e);return t||a}reduce(e,t){return"SWITCH_CONTEXT"===t.actionType?(0,i.cR)(e,t.windowId,(e=>{e.area=t.context.area,e.feature=t.context.feature}),a):e}}const r=new o},49777:(e,t,s)=>{"use strict";s.d(t,{ZP:()=>r,mb:()=>a});var n=s(65398);var i=s(33638);const a=new class{#Ft;constructor(){this.#Ft=new Map}get(e){return this.#Ft.get(e)??[]}append(e,t){const s=this.#Ft.get(e);s?s.push(t):this.#Ft.set(e,[t])}clear(e){this.#Ft.delete(e)}};class o extends n.Z{ready=new Promise((e=>this.resolveReady=e));openAfterDownload=new Set;_downloadItems=[];_totalNumberOfDownloads=0;_totalProgress=0;_filter="";dispatchAction(e){switch(e.actionType){case"DOWNLOAD_PANEL_UPDATED":return this._downloadItems=e.downloadItems,void this.emitChange({reason:"download_panel_updated"});case"DOWNLOAD_COMPLETED":return a.clear(e.downloadItem.id),void this.emitChange({reason:"download_completed",downloadItem:e.downloadItem});case"DOWNLOAD_STARTED":return void this.emitChange({reason:"download_started",downloadItem:e.downloadItem});case"DOWNLOAD_STOPPED":return a.clear(e.downloadItem.id),void this.emitChange({reason:"download_stopped",downloadItem:e.downloadItem});case"DOWNLOAD_SET_TOTAL_PROGRESS":return this._totalProgress=e.totalProgress,this._totalNumberOfDownloads=e.totalNumberOfDownloads,void this.emitChange({reason:"download_total_progress_changed"});case"DOWNLOAD_SET_FILTER":return this._filter=e.filter,this._downloadItems=e.downloadItems,void this.emitChange({reason:"download_panel_updated"});case"DOWNLOAD_SET_ORDER_BY":return this._orderBy=e.orderBy,this._downloadItems=e.downloadItems,void this.emitChange({reason:"download_panel_updated"})}}getTotalNumberOfDownloads(){return this._totalNumberOfDownloads}hasDownloads(e){return this.getItems(e).length>0}getTotalProgress(){return this._totalProgress}getFilter(){return this._filter}getOrderBy(){return this._orderBy}getItems(e){return this._downloadItems.filter((t=>!(!e.isIncognitoWindow&&t.incognito))).filter((e=>!("interrupted"===e.state&&""===e.filename)))}}const r=new o(i.Z)},98109:(e,t,s)=>{"use strict";s.d(t,{Z:()=>o});var n=s(24602),i=s(48588);class a extends n.Z{getInitialState(){return new Map}getExtensionInfoForTab(e,t){return this.getState().get(e)?.get(t)}reduce(e,t){switch(t.actionType){case"EXTENSION_ACTION_UPDATED":{const{info:s}=t,n=e.get(s.id);let a;return n?n.has(s.tabId)?a=(0,i.cR)(n,s.tabId,(e=>{Object.assign(e,s)})):(a=new Map(n),a.set(s.tabId,s)):a=new Map([[s.tabId,s]]),n!==a&&(e=new Map(e)).set(s.id,a),e}case"EXTENSION_ACTION_CLEAR_FOR_TAB":{const{extensionId:s,tabId:n}=t,i=e.get(s);if(!i)return e;if(i.has(n)){const t=new Map(i);t.delete(n),(e=new Map(e)).set(s,t)}return e}case"EXTENSION_ACTION_REMOVED":return(0,i.u4)(e,t.info.id);default:return e}}}const o=new a},16875:(e,t,s)=>{"use strict";s.d(t,{Z:()=>c});var n=s(24602),i=s(25372),a=s(48588);const o=Object.freeze({rewindHistory:[],rewindIndexes:[],forwardUrl:""});function r(e,t){const s=(0,i.Z)(e),n=(0,i.Z)(t);return s?.hostname===n?.hostname}function l(e,t,s,n){e.rewindHistory||(e.rewindHistory=[],e.rewindIndexes=[]);const i=e.prev,a=i&&i.url&&r(i.url,t.url);return s!==n.length-1&&(i&&!a&&s<n.length-1?(n.length-1-s>1&&(e.rewindHistory.length>0&&r(e.rewindHistory[e.rewindHistory.length-1].url,i.url)&&e.rewindHistory[e.rewindHistory.length-1].url!==i.url||r(n[n.length-1].url,i.url)&&n[n.length-1].url!==i.url)&&(e.rewindHistory.push(i),e.rewindIndexes.push(n.length-s-2)),e.rewindHistory.push(t),e.rewindIndexes.push(n.length-s-1)):0===s&&n.length>0&&(e.rewindHistory.push(t),e.rewindIndexes.push(n.length-s-1))),e.prev=t,e}class d extends n.Z{getInitialState(){return new Map}getStateById(e){return this.getState().get(e)||o}getFastForwardUrl(e){return this.getStateById(e).forwardUrl}getRewindRelativeIndex(e){const t=this.getState().get(e);if(t){const{rewindIndexes:e}=t;if(e.length>0)return e[0]}return 0}getRewindHistory(e){return this.getStateById(e.id).rewindHistory}getRewindIndexes(e){return this.getStateById(e.id).rewindIndexes}reduce(e,t){switch(t.actionType){case"FAST_FORWARD_SET_FORWARD_URL":const{forwardUrl:s,pageId:n}=t;return(0,a.cR)(e,n,(e=>{e.forwardUrl=s}),o);case"CHROME_TABS_UPDATED":{const{tabId:s,changeInfo:n}=t;return"loading"!==n.status?e:(0,a.cR)(e,s,(e=>{e.forwardUrl=""}),o)}case"FAST_FORWARD_SET_REWIND_INFO":{const{currentIndex:s,history:n,pageId:i}=t;return(0,a.cR)(e,i,(e=>{const{rewindHistory:t,rewindIndexes:i}=(a=s,n.slice(0,a+1).reduceRight(l,{rewindHistory:[],rewindIndexes:[]}));var a;0===e.rewindHistory.length&&0===t.length||(e.rewindHistory=t),0===e.rewindIndexes.length&&0===i.length||(e.rewindIndexes=i)}),o)}case"PAGE_CLOSE":{const{pages:s}=t;return s.some((t=>e.has(t.id)))&&(e=new Map(e),s.forEach((t=>e.delete(t.id)))),e}default:return e}}}const c=new d},62819:(e,t,s)=>{"use strict";s.d(t,{Z:()=>p,E:()=>d});var n=s(30381),i=s.n(n),a=s(24602),o=s(93974);function r(e){const{items:t,filterText:s,titleFilter:n,urlFilter:i,shouldSearchUrl:a}=e,o=(i||n||s).toLowerCase().split(" ");let r;if(i)if(1===o.length){const e=o[0];r=({url:t})=>t.toLowerCase().includes(e)}else r=({url:e})=>(e=e.toLowerCase(),o.every((t=>e.includes(t))));else if(n||!a)if(1===o.length){const e=o[0];r=({title:t})=>t.toLowerCase().includes(e)}else r=({title:e})=>(e=e.toLowerCase(),o.every((t=>e.includes(t))));else if(1===o.length){const e=o[0];r=({title:t,url:s})=>s.toLowerCase().includes(e)||t.toLowerCase().includes(e)}else r=({title:e,url:t})=>(e=e.toLowerCase(),t=t.toLowerCase(),o.every((s=>t.includes(s)||e.includes(s))));return t.map((e=>{const t=e.children.filter(r);return{...e,children:t,visitCount:t.reduce(((e,t)=>e+t.visitCount),0)}}))}const l=(0,s(23542).extendMoment)(i());function d(e){const t=new Date(e);return`${String(t.getFullYear())}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}class c extends a.Z{getInitialState(){return{currentSortOrder:o.Z.DESCENDING_SORT,currentSortField:"visitTime",items:[],itemsAreSorted:!0,oldestHistoryDate:void 0}}getTreeNodes(e){this.#Sn(e);const t=e.startTime.valueOf(),s=e.endTime.valueOf();let n=this.getState().items.filter((e=>e.visitTime>=t&&e.visitTime<=s));if(e.parsedFilter.query||e.parsedFilter.title||e.parsedFilter.url){n=r({items:n,filterText:e.parsedFilter.query.toLowerCase(),titleFilter:e.parsedFilter.title.toLowerCase(),urlFilter:e.parsedFilter.url.toLowerCase(),shouldSearchUrl:e.searchURL})}return n}getNumerOfItems(){return this.getState().items.length}getFilteredHistory(e,t){const s=r({items:t?this.getState().items.slice(0,10):this.getState().items,filterText:e,shouldSearchUrl:!0}),n=new Map;for(let e=s.length;e--;){const t=s[e].children;for(let e=t.length;e--;){const s=t[e],i=n.get(s.url);n.set(s.url,{...s,visitCount:i?i.visitCount+s.visitCount:s.visitCount,visitTime:i?Math.max(i.visitTime,s.visitTime):s.visitTime})}}return[...n.values()]}#Sn(e){const t=this.getState(),{currentSortOrder:s,currentSortField:n,itemsAreSorted:i}=t;if(i&&e.sortOrder===s&&e.sortField===n)return;const{sortOrder:a,sortField:r}=e;let l;switch("visitTime"===r&&a===o.Z.ASCENDING_SORT?t.items.sort(((e,t)=>e.visitTime-t.visitTime)):t.items.sort(((e,t)=>t.visitTime-e.visitTime)),r){case"visitTime":case"visitCount":l=a===o.Z.ASCENDING_SORT?(e,t)=>e[r]-t[r]:(e,t)=>t[r]-e[r];break;case"title":case"address":l=a===o.Z.ASCENDING_SORT?(e,t)=>e[r].localeCompare(t[r]):(e,t)=>t[r].localeCompare(e[r])}if(l){const e=l;t.items.forEach((t=>t.children.sort(e)))}t.itemsAreSorted=!0,t.currentSortOrder=e.sortOrder,t.currentSortField=e.sortField}getTimeByRange(e,t){return isNaN(parseInt(e.rangePicker))?"today"===e.rangePicker?(e.startTime=l().startOf("day"),e.endTime=l().endOf("day")):"yesterday"===e.rangePicker?(e.startTime=l().subtract(1,"day").startOf("day"),e.endTime=l().subtract(1,"day").endOf("day")):"last_month"===e.rangePicker?(e.startTime=l().subtract(1,"month").startOf("month"),e.endTime=l().subtract(1,"month").endOf("month")):"all"===e.rangePicker?(t&&(e.startTime=t.startOf("day")),e.endTime=l().endOf("day")):"date_range"===e.rangePicker||console.warn("Unknown date range",e.rangePicker):(e.startTime=l().subtract(parseInt(e.rangePicker),"day").startOf("day"),e.endTime=l().endOf("day")),e}getOldestDate(){return this.getState().oldestHistoryDate??l()}reduce(e,t){switch(t.actionType){case"HISTORY_LOAD":return function(e,t,s,n){s&&h(e);const i=function(e){const t=[],s=Object.groupBy(e,(e=>e.dateKey));for(const e in s){const n=Object.groupBy(s[e],(e=>e.url)),i=Object.keys(n).map((e=>{const t=n[e],s=t[0],i=t.reduce(((e,t)=>e.visitTime>t.visitTime?e:t)).visitTime,a=t.length;return{address:s.address,title:s.title,transitionType:s.transitionType,url:e,id:s.id+"_"+i,visitCount:a,visitTime:i}}));t.push({children:i,id:e,visitCount:i.reduce(((e,t)=>e+t.visitCount),0),visitTime:l(e).valueOf()})}return t}(t);if(n){0;const t=i[0];if(t){const s=e.items.findIndex((e=>e.id===t.id));-1===s?e.items.unshift(t):e.items[s]=t,e.itemsAreSorted=u(e)}}else e.items=e.items.concat(i),e.itemsAreSorted=u(e);return e.oldestHistoryDate=l(t.reduce(((e,t)=>e<t.visitTime?e:t.visitTime),(e.oldestHistoryDate??l()).valueOf())),e}({...e},t.items,t.resetCache,t.isToday);case"HISTORY_REMOVE_AFTER":return function(e,t){if(0===t)h(e);else{let s=!1;const n=[];e.items.forEach((e=>{const i=e.children.filter((e=>e.visitTime<=t));s=s||i.length!==e.children.length,i.length>0&&(i.length!==e.children.length?n.push({...e,children:i,visitCount:i.reduce(((e,t)=>e+t.visitCount),0)}):n.push(e))})),s&&(e.items=n)}return e}({...e},t.since);case"HISTORY_REMOVE_VISITS":return function(e,t){return t.forEach((t=>{t.isFolder?function(e,t){const s=d(t.visitTime),n=e.items.findIndex((e=>e.id===s));-1!==n&&e.items.splice(n,1)}(e,t):void 0===t.url?console.error("Can not remove history element. Url missing"):function(e,t){const s=d(t.visitTime),n=[];e.items.forEach((e=>{if(e.id===s){const s=e.children.filter((e=>e.url!==t.url));if(s.length>0)if(s.length!==e.children.length){const t={...e,children:s,visitCount:s.reduce(((e,t)=>e+t.visitCount),0)};n.push(t)}else n.push(e)}else n.push(e)})),e.items=n}(e,t)})),e}({...e},t.visits)}return e}}function h(e){e.items=[],e.itemsAreSorted=!0}function u(e){const{itemsAreSorted:t,currentSortField:s,currentSortOrder:n}=e;return t&&"visitTime"===s&&n===o.Z.DESCENDING_SORT}const p=new c},65093:(e,t,s)=>{"use strict";s.d(t,{Z:()=>u});var n=s(65398),i=s(33638);const a=new Set,o=new Set,r=new Set,l=new Set,d=new Set,c=new Set;class h extends n.Z{isDisconnected(e){return!o.has(e)}isConnecting(e){return a.has(e)}isConnected(e){return!this.isConnecting(e)&&!this.isDisconnected(e)}isSyncing(e){return r.has(e)}isSyncingAny(){return r.size>0}isPreFetching(e){return l.has(e)}isPreFetchingAny(){return l.size>0}isPrefetchPaused(){return c.size>0}canResumePrefetch(e){return 1===c.size&&c.has(e)}isSyncingFlags(e){return d.has(e)}isSyncingFlagsAny(){return d.size>0}getStatus(e){return{isDisconnected:this.isDisconnected(e),isConnecting:this.isConnecting(e),isSyncing:this.isSyncing(e),isPreFetching:this.isPreFetching(e),isSyncingFlags:this.isSyncingFlags(e),isPrefetchPaused:this.isPrefetchPaused()}}dispatchAction(e){switch(e.actionType){case"MAIL_IS_DISCONNECTED":{const{accountId:t,isDisconnected:s}=e;let n=!1;s?(n=o.has(t),o.delete(t)):(n=!o.has(t),o.add(t)),n&&this.emitChange({accountId:t,isDisconnected:s});break}case"MAIL_IS_CONNECTING":{const{accountId:t,isConnecting:s}=e;let n=!1;s?(n=!a.has(t),a.add(t)):(n=a.has(t),a.delete(t)),n&&this.emitChange({accountId:t,isConnecting:s});break}case"MAIL_IS_SYNCING":{const{accountId:t,isSyncing:s}=e;let n=!1;s?(n=!r.has(t),r.add(t)):(n=r.has(t),r.delete(t)),n&&this.emitChange({accountId:t,isSyncing:s});break}case"MAIL_IS_PRE_FETCHING":{const{accountId:t,isPreFetching:s}=e;let n=!1;s?(n=!l.has(t),l.add(t)):(n=l.has(t),l.delete(t)),n&&this.emitChange({accountId:t,isPreFetching:s});break}case"MAIL_PAUSE_PRE_FETCHING":{const{requester:t,pause:s}=e;s?c.add(t):c.delete(t),this.emitChange({accountId:"",isPrefetchPaused:c.size>0});break}case"MAIL_IS_SYNCING_FLAGS":{const{accountId:t,isSyncingFlags:s}=e;let n=!1;s?(n=!d.has(t),d.add(t)):(n=d.has(t),d.delete(t)),n&&this.emitChange({accountId:t,isSyncingFlags:s});break}}}}const u=new h(i.Z)},98611:(e,t,s)=>{"use strict";s.d(t,{Z:()=>Y});var n=s(65398),i=s(99827),a=s(54162),o=s(29087),r=s(33638),l=s(47513),d=s.n(l),c=s(91834),h=s(71320),u=s(51501),p=s(10671),g=s(75401),m=s(84283),f=s(89165),v=s(95752),b=s(45660),C=s(54773),w=s(5863),y=s(51733),x=s(75995),I=s(56887),A=s(89175),S=s(34155);let Z,T,E,k,N,_,P=[],M=[],D=[],O={},j=!1,L=!1,R=[],B=[];function F(e,t){e.forEach((e=>{const{accountId:s,path:n,counter:i}=e;if(O[s]||(O[s]={}),t&&O[s][n]){const e=O[s][n];e.total+=i.total,e.unseen+=i.unseen,e.unread+=i.unread}else O[s][n]=i}))}function W(){const e=a.Z.getSelectedFolder();"threads"!==(0,I.U)(e)&&M.forEach(x.o)}function U(){W();const e=$.getListEntryComparator();D.sort(e),H(),$.emitChange({target:"listEntries",updateSelection:!0})}function V(e){const{addedSles:t,removedSles:s}=e,{sleUpdates:n}=e,i=$.getListEntryComparator();let a=!1;const o=new Set,r=[],l=[];function h(e){const t=$.createListEntry(e,[]),s=d()(M,t,y.PN);s<0&&M.splice(-s-1,0,t);const n=d()(D,t,i);n<0&&D.splice(-n-1,0,t),function(e){R.length>0&&(R=R.filter((t=>t.id!==e.id||(p(t),b.Z.log("Mail",`Doing postponed index update for ${e.id}`),!1)))),B.length>0&&(B=B.filter((({id:t,newThreadKey:s})=>t!==e.id||(G(new Map([[t,s]])),b.Z.log("Mail",`Doing postponed thread key update for ${e.id}`),!1))))}(e)}function p(e){const t=$.getListEntry(e.id);if(!t)return R.push(e),void b.Z.log("Mail","Entry not found in index. Index update postponed until entry arrives.");const s=new Set([...t.viewIds]),n=new Set([...t.totalViewIds]),{updates:c}=e;void 0!==c.sentDate&&(t.sentDate=c.sentDate),Object.keys(c).includes("queued")&&(void 0===c.queued?delete t.queued:t.queued=c.queued),void 0!==c.attachment&&(t.attachment=c.attachment),void 0!==c.flags&&(t.flags=c.flags),void 0!==c.from&&(t.fromIds=c.from.map(C.Z.add)),void 0!==c.sourceFilterIds&&(t.sourceFilterIds=c.sourceFilterIds),void 0!==c.subject&&(t.subject=c.subject),void 0!==c.to&&(t.toIds=c.to.map(C.Z.add)),void 0!==c.preview&&(t.preview=c.preview);const h=c.removedViewIds||[],p=c.addedViewIds||[];if(void 0!==c.unseen)if(t.unseen=c.unseen,c.unseen)c.unseen&&b.Z.warn("Mail",["filter","store"],"updateIndex is trying to mark a message unseen",c);else{const e=[...s].filter((e=>e%w.XN===w.ZC));h.push(...e)}if(void 0!==c.sources){let e=!1,n=!1;if(c.sources.forEach(((s,i)=>{if(s){const a=t.sources.get(i);if(a){if(void 0!==s.read&&a.read!==s.read){const t=i*w.XN+w.aD;s.read?h.push(t):p.push(t),e=!0}if(void 0!==s.deleted&&a.deleted!==s.deleted&&!(0,f.Z)(t.sources,t.flags)&&!(0,g.Z)(t.sources)){const e=i*w.XN+w.IK;s.deleted?h.push(e):p.push(e),n=!0}t.sources.set(i,{...a,...s})}else{const{read:e,deleted:n,internal:a}=s;if(void 0===e||void 0===n||void 0===a)throw new Error("Cannot add invalid source "+JSON.stringify(s));t.sources.set(i,{read:e,deleted:n,internal:a})}}else t.sources.delete(i)})),e||n){const i=new Set;s.forEach((e=>{const t=Math.floor(e/w.XN);i.add(t)}));const a=[...i].filter((e=>!t.sources.has(e)));if(a.length>0){if(e){const e=a.map((e=>e*w.XN+w.aD));v.Z.call(t.sources)?h.push(...e):p.push(...e)}if(n){const e=a.map((e=>e*w.XN+w.IK));m.Z.isMessageDeleted(t.sources)?h.push(...e):p.push(...e)}}}}s.forEach((e=>o.add(e)));const y=new Set([...s]);if(h.length>0)for(const e of h)t.viewIds.delete(e),y.delete(e),o.add(e),u.ZP.isViewIdOfType(e,w.xE)&&t.totalViewIds.delete(e);if(p.length>0)for(const e of p)t.viewIds.add(e),y.add(e),o.add(e),u.ZP.isViewIdOfType(e,w.xE)&&t.totalViewIds.add(e);l.push(s),r.push(y);const x=$.isVisible({...t,viewIds:s,totalViewIds:n}),I=$.isVisible(t);if(x||I){if(!x&&I){const e=d()(P,t,i);P.splice(-e-1,0,t),a=!0}else if(x){let s=d()(P,t,i),n=!1;if(s<0&&(s=P.findIndex((e=>e===t)),n=!0),s>=0)if(I){if(n){P.splice(s,1);const e=d()(P,t,i);P.splice(-e-1,0,t),a=!0}}else P.splice(s,1),a=!0;else b.Z.warn("Mail",["MailFiltersStore"],"Message not found in _listEntries",{sleUpdate:e})}a||$.emitChange({target:"listEntries",replaceList:!1});let s=d()(D,t,i);if(s<0)if(s=D.findIndex((e=>e===t)),s>=0){D.splice(s,1);const e=d()(D,t,i);D.splice(-e-1,0,t)}else b.Z.warn("Mail",["MailFiltersStore"],"Message not found in _sortedIndex",{sleUpdate:e})}}if(s&&s.forEach((e=>{!function(e){const t=d()(M,{id:e},y.PN);if(t>=0){const[e]=M.splice(t,1),s=d()(D,e,i);s>=0&&D.splice(s,1),e.viewIds.forEach((e=>o.add(e))),l.push(e.viewIds);const n=d()(P,e,i);n>=0&&(P.splice(n,1),a=!0)}}(e)})),t&&t.forEach((e=>{h(e)})),n&&n.forEach((e=>{p(e)})),a&&(P=P.slice(),$.emitChange({target:"listEntries",updateSelection:!0,stabilizeScrollTop:!0})),o.size>0){const e=$.getCounterFolders([...o]);e.length>0&&(l.forEach((t=>{const s=[...t].filter((e=>e%w.XN===w.xE));c.Z.updateCounterFolders(t,s,-1,e)})),r.forEach((t=>{const s=[...t].filter((e=>e%w.XN===w.xE));c.Z.updateCounterFolders(t,s,1,e)})),F(e,!0),$.emitChange({target:"counters"}))}}function H(){const e=Date.now();P=D.filter((e=>$.isVisible(e))),b.Z.log("Mail",["filter","store"],`initListEntries took ${Date.now()-e}ms.`),j=!1}function G(e){const t=a.Z.getSelectedFolder(),s=(0,I.U)(t),n=$.getListEntryComparator();let o,r=!1;if(e.forEach(((e,t)=>{const i=d()(M,{id:t},y.PN);if(i<0)return B.push({id:t,newThreadKey:e}),void b.Z.log("Mail","Entry not found in index. Thread key update postponed until entry arrives.");const l=M[i],c=l.threadKey;if("threads"===s){const t=d()(D,l,n),s=d()(P,l,n);l.threadKey=e,t>=0&&D.splice(t,1);const i=d()(D,l,n);D.splice(-i-1,0,l);if($.isVisible(l)){s>=0&&P.splice(s,1);const e=d()(P,l,n);P.splice(-e-1,0,l),r=!0}}else l.threadKey=e;const h=a.Z.getSelectedThreadPrefix();if(h){const e=c.splice(0,2);h.every(((t,s)=>e[s]===t))&&(o=M[i])}})),o){const e=o;S.nextTick((()=>i.Z.selectThread(e)))}r&&$.emitChange({target:"listEntries",stabilizeScrollTop:!0})}function K(){Z=void 0;(()=>{const e=a.Z.getSelectedFolder();if(e){const{accountId:t,path:s}=e;if(t!==w.tQ){const e=$.getByFolder(t,s);e&&(T=u.ZP.getViewIntersections(e))}}})(),H(),$.emitChange({target:"listEntries"})}class z extends n.Z{getByAccountId(e){return h.Z.getByAccountId(e)}getByFolder(e,t=w.ym){if(e)return h.Z.getByFolderId([e,t])}get(e){return h.Z.get(e)}getByIds(e){return h.Z.getByIds(e)}getByFolderId(e){return h.Z.getByFolderId(e)}getSourceFilters(e){const t=d()(M,{id:e},y.PN);if(t>=0){const{sourceFilterIds:e}=M[t];return h.Z.getByIds(e)}return[]}isLoading(){return j}isInitialized(){return L}getKnownFlags(){const e=this.getByAccountId(w.ut).map((e=>e.path)),t=Object.keys(w.T4).map((e=>w.T4[e]));return e.concat(t)}isSenderMailingList(e){const t=w.cs+"/"+e,s=w.W4+"/"+e;return void 0!==h.Z.getAll().find((e=>e.accountId===w.wC&&(e.path===t||e.path===s)))}isCounterFolder(e){return e?.accountId!==w.tQ}getCounters(e,t=w.ym){return O[e]&&O[e][t]}isCounterViewId(e,t){const s=e%w.XN,{showRead:n,showMailingLists:i,showFeeds:a,showJunk:o,showCustomFolder:r,showArchived:l}=u.ZP.getFilterOptions(t);switch(s){case w.xE:return!!n&&!!i&&!!a;case w.ZC:return!0;case w.aD:return!n;case w.EO:return!i;case w.Fz:return!a;case w.Jq:return!o;case w.js:return!r;case w.pF:return!l;default:return!1}}getCounterFolders(e){const t=new Set;for(const s of e){const e=Math.floor(s/w.XN);if(t.has(e))continue;const n=$.get(e);n&&($.isCounterFolder(n)&&$.isCounterViewId(s,n)&&t.add(e))}if(0===t.size)return[];const s=new Map;for(const e of t){const t=$.get(e);if(!t)continue;const{id:n,accountId:i,path:a}=t,o=h.Z.getByFolderId([i,w.ym]),r=o?[o]:[];if(p.Z.getFolderType(i,a)===w.Oi){const e=h.Z.getByFolderId([w.Ry,w.ym]);e&&r.push(e)}let l=a.substring(0,a.lastIndexOf("/"));for(;l.length>0;){const e=h.Z.getByFolderId([i,l]);e&&r.push(e),l=l.substring(0,l.lastIndexOf("/"))}for(const e of r){const{id:t,filterValue:n}=e;if(n.showSubFolders&&!s.has(t)){const n=$.createCounterFolder(e);s.set(t,n)}}if(!s.has(n)){const e=$.createCounterFolder(t);s.set(n,e)}}return[...s.values()]}createCounterFolder(e){const{accountId:t,path:s}=e;return{accountId:t,path:s,viewIntersections:$.getViewIntersections(e),counter:{total:0,unseen:0,unread:0}}}getViewIntersections(e){const{showDeleted:t,showMailingLists:s,showFeeds:n,showJunk:i,showCustomFolder:a,showSubFolders:o,showArchived:r}=u.ZP.getFilterOptions(e),l=[e];if(o){const t=u.ZP.getSubFilters(e);l.push(...t)}const d={total:new Map,unseen:new Map,unread:new Map};for(const e of l){const{id:o}=e,l=o*w.XN+w.xE,c=o*w.XN+w.ZC,h=o*w.XN+w.aD,u=s?0:o*w.XN+w.EO,p=t?0:o*w.XN+w.IK,g=n?0:o*w.XN+w.Fz,m=i?0:o*w.XN+w.Jq,f=a?0:o*w.XN+w.js,v=r?0:o*w.XN+w.pF;if(u||p||g||m||f||v){const e=[];u&&e.push(u),p&&e.push(p),g&&e.push(g),m&&e.push(m),f&&e.push(f),v&&e.push(v),d.total.set(l,e),d.unseen.set(l,[c,...e]),d.unread.set(l,[h,...e])}else d.total.set(l,[l]),d.unseen.set(l,[c]),d.unread.set(l,[h])}return d}getIndex(){return M}getIndexSearchListIds(){return M.map((e=>e.id))}getListEntry(e){const t=d()(M,{id:e},y.PN);if(t>=0)return M[t]}matchesViewIntersection(e,t,s){for(const n of s||e){if(t.get(n)?.every((t=>e.has(t))))return!0}return!1}getListEntryComparator(){const e=a.Z.getSelectedFolder(),t=(0,I.U)(e);let s;switch(t){case"attachment":s=y.Qy;break;case"flag":s=y.lx;break;case"label":s=y.ye;break;case"sender":const t=!!e&&[w.Nz,w.kY,w.fZ].includes(p.Z.getFolderType(e.accountId,e.path));s=(0,y.S5)(t,C.Z.get);break;case"sentDate":s=y.rQ;break;case"size":s=y.YI;break;case"subject":s=y.Ji;break;case"threads":s=y.HT;break;case"unread":s=y.qA}if(!s)throw new Error("Comparator not found for sort field "+t);return"ascending"===o.Z.get(A.kMailSearchSortOrder)?s:(0,y.g4)(s)}isVisible(e){if(void 0!==E);else{if(!T)return!1;if(!$.matchesViewIntersection(e.viewIds,T,e.totalViewIds))return!1}if(null!=_){if(0===_&&e.attachment>0)return!1;if(_>0&&0===e.attachment)return!1}return!(k&&k>e.sentDate)&&(!(N&&N<e.sentDate)&&((!E||!E.some(((t,s)=>t!==e.threadKey[s])))&&!(Z&&d()(Z,e,y.dc)<0)))}hasNoListEntries(){return 0===P.length}createListEntry(e,t){const{id:s,messageId:n,attachment:i,flags:a,replied:o,sentDate:r,subject:l,preview:d,threadKey:c,unseen:h,queued:u,sourceFilterIds:p,sources:g,size:m}=e,f=e.to.map((e=>C.Z.add(e))),v=e.from.map((e=>C.Z.add(e))),b=new Set,y=new Set;for(const e of t)b.add(e),e%w.XN===w.xE&&y.add(e);return{id:s,messageId:n,attachment:i,flags:a,replied:o,sentDate:r,subject:l,preview:d,threadKey:c,unseen:h,queued:u,viewIds:b,totalViewIds:y,sourceFilterIds:p,sources:g,toIds:f,fromIds:v,size:m}}getListEntries(){return P}getQueryNumFound(){return Z?.length}getListEntriesByFolder(e,t){const s=this.getByFolder(e,t);if(!s)throw new Error("Filter not found "+[e,t].join());const n=u.ZP.getViewIntersections(s);return D.filter((e=>this.matchesViewIntersection(e.viewIds,n,e.totalViewIds)))}getListEntryIdsByViewIds(e){return M.filter((t=>e.some((e=>t.viewIds.has(e))))).map((e=>e.id))}getListEntriesByIds(e){const t=[];for(const s of e){const e=$.getListEntry(s);e&&t.push(e)}return t}dispatchAction(e){switch(e.actionType){case"MAIL_INIT_INDEX_FINISHED":!function(){M.sort(y.PN);const e=$.getListEntryComparator();D.sort(e),H(),L=!0,$.emitChange({target:"finishIndexProgress"}),$.emitChange({target:"listEntries",updateSelection:!0})}();break;case"MAIL_INIT_INDEX_BATCH":!function(e,t,s){const n=new Set;for(const e of t)for(const t of e.viewIds)n.add(t);const i=$.getCounterFolders([...n]);for(let s=0;s<e.length;s++){const n=e[s],{searchListId:a,viewIds:o}=t[s];if(n.id>a)throw new Error(`Database inconsistency: extra viewIds entry ${a}.`);if(n.id<a)throw new Error(`Database inconsistency: viewIds entry for SLE ${n.id} not found.`);const r=$.createListEntry(n,o);if(M.push(r),D.push(r),i.length>0){const{viewIds:e,totalViewIds:t}=r;c.Z.updateCounterFolders(e,t,1,i)}}F(i,!0),$.emitChange({target:"updateIndexProgress",indexCount:M.length,total:s})}(e.sleBatch,e.viewIdsBatch,e.total);break;case"MAIL_UPDATE_QUERY_RESULTS":{const{queryResults:t,folder:s,filterOptions:n,threadPrefix:i,attachments:a,sentDate:o,sentDateEnd:r,updateScrollPosition:l}=e;!function(e,t,s,n,i,a,o,r){if(E=n,Z=e,_=i,k=a,N=o,t){const e=$.getByFolder(t.accountId,t.path);e&&(T=u.ZP.getViewIntersections({...e,filterValue:{...e.filterValue,...s}}))}H(),$.emitChange({target:"listEntries",updateScrollPosition:r})}(t,s,n,i,a,o,r,l);break}case"MAIL_CLEAR_SEARCH":_=void 0,k=void 0,N=void 0,E=void 0,K();break;case"MAIL_INDEX_UPDATE":V(e.updates);break;case"MAIL_SORT_LIST_ENTRIES":U();break;case"MAIL_FILTERS_CHANGED":{const{filterIds:t}=e;!function(e){const t=a.Z.getSelectedFolder();if(t){const{accountId:s,path:n}=t;if(s!==w.tQ){const t=$.getByFolder(s,n);t&&e.includes(t.id)&&(T=u.ZP.getViewIntersections(t),H(),$.emitChange({target:"listEntries",updateSelection:!0}))}}$.emitChange({target:"filters",filterIds:e,updateSelection:!0,updateScrollPosition:!0})}(t);break}case"MAILING_LIST_GROUP_CHANGED":$.emitChange({target:"mailingLists"});break;case"MAIL_UPDATE_COUNTERS":{const{countedFolders:t,deltaValues:s}=e;F(t,s),$.emitChange({target:"counters"});break}case"MAIL_INIT_MESSAGES":e.folderIntersections?(t=e.folderIntersections,Z=void 0,E=void 0,_=void 0,k=void 0,N=void 0,T=t,U(),$.emitChange({target:"listEntries",updateSelection:!0})):function(){P=[],Z=void 0,T=void 0,E=void 0,_=void 0,k=void 0,N=void 0;const e=o.Z.get(A.kMailAccounts);j=!!e&&e.length>0,$.emitChange({target:"listEntries",isLoading:j})}();break;case"MAIL_UPDATE_THREAD_KEYS":{const{updates:t}=e;G(t);break}case"MAIL_SELECT_THREAD":const{threadPrefix:s}=e;K(),function(e){E=e,H(),$.emitChange({target:"listEntries",updateSelection:!0,updateScrollPosition:!0})}(s);break;case"MAIL_GOTO_UNREAD":$.emitChange({target:"gotoUnread"});break;case"MAIL_GOTO_NEXT_UNREAD":$.emitChange({target:"gotoNextUnread"});break;case"MAIL_GOTO_PREVIOUS_UNREAD":$.emitChange({target:"gotoPreviousUnread"});break;case"MAIL_STOP":P=[],Z=void 0,M=[],D=[],O={},j=!1,T=void 0,E=void 0,L=!1,_=void 0,k=void 0,N=void 0,$.emitChange({target:"counters"}),$.emitChange({target:"listEntries"});break;case"MAIL_SELECT_FOLDER":W()}var t}isInDraftOrOutbox(e){const t=this.getListEntry(e);if(t){const e=h.Z.getByIds(t.sourceFilterIds);return 1===e.length&&e[0].accountId===w.of&&[w.Wb,w.J8].includes(e[0].path)}return!1}}const $=new z(r.Z),Y=$},54162:(e,t,s)=>{"use strict";s.d(t,{Z:()=>p});var n=s(43630),i=s(65398),a=s(33638),o=s(80822),r=s(51501),l=s(10671),d=s(26036),c=s(5863),h=s(65741);class u extends i.Z{_selectionHistory=[];_historyIndex=-1;_optionsHistory=[];clear(){this._selectedFolder=void 0,this._selectionHistory=[],this._historyIndex=-1,this._optionsHistory=[],this.emitChange("clear")}getSelectedFolder(){return this._selectedFolder}getSelectionHistory(){return this._selectionHistory}getHistoryIndex(){return this._historyIndex}getOptions(){return this._optionsHistory[this._historyIndex]||{}}getQuery(){return this._optionsHistory[this._historyIndex]?.query||""}clearSearchOptions(){const e=this.getOptions();this.canGoBack()&&(r.ZP.isMailSearching(e)||r.ZP.isContactView(e)||r.ZP.isThreadedView(e))?(this._historyIndex=this._historyIndex-1,this._selectedFolder=this._selectionHistory[this._historyIndex],this._storeSelectedFolder(),this.emitChange("selectFolder")):this.emitChange("selectFolder")}toggleMailSearchOptions(){this.emitChange("toggleShowMailSearchOptions")}setOptions(e){this._optionsHistory[this._historyIndex]={...e},this.emitChange("setOptions")}getSelectedThreadPrefix(){return this.getOptions().threadPrefix}getOptionsFromHistory(e){return this._optionsHistory[e]}getFolderFromHistory(e){return this._selectionHistory[e]}isFolderAnEditMailFolder(){const e=this.getSelectedFolder(),t=e&&l.Z.getFolderType(e.accountId,e.path);return[c.kY,c.fZ,c.Nz].includes(t)}isTrashFolderSelected(){if(!this._selectedFolder)return!1;const{accountId:e,path:t,type:s=""}=this._selectedFolder;return s===c.uT||e===c.of&&t===c.cm}canGoBack(){return this.getSelectionHistory().length>1&&this.getHistoryIndex()>0}canGoForward(){const e=this.getSelectionHistory();return e.length>1&&this.getHistoryIndex()<e.length-1}getGoToMenuItems=(e,t)=>[{handler:()=>n.Z.goToNextUnread(e),..."list"===t?(0,d.Z)("command","Next Unread"):(0,d.Z)("Go to Next Unread")},{handler:()=>n.Z.goToPreviousUnread(e),..."list"===t?(0,d.Z)("command","Previous Unread"):(0,d.Z)("Go to Previous Unread")},{handler:()=>n.Z.markAsReadAndGoToNextUnread(e),...(0,d.Z)("Mark Read and Go to Next Unread")}];dispatchAction(e){switch(e.actionType){case"MAIL_SELECT_FOLDER":this._addToHistory(e.folder,e.options),this.emitChange("selectFolder");break;case"MAIL_FOLDER_SELECT_HISTORY_INDEX":const{historyIndex:t}=e;void 0!==t&&(this._selectFromHistory(t),this.emitChange("selectFolder"));break;case"MAIL_SEARCH_SET_OPTIONS":this.setOptions(e.options);break;case"MAIL_STOP":this.clear();break;case"MAIL_CLEAR_SEARCH":this.clearSearchOptions();break;case"SHOW_MAIL_SEARCH_OPTION":this.toggleMailSearchOptions()}}_storeSelectedFolder(){o.Z.set({FOLDER_SELECTION:this._selectedFolder},(e=>{e&&console.error("Failed to store selected folder",this._selectedFolder,e)}))}_selectFromHistory(e){e>=0&&e<this._selectionHistory.length&&(this._historyIndex=e,this._selectedFolder=this._selectionHistory[this._historyIndex],this._storeSelectedFolder())}_addToHistory(e,t){if(this._historyIndex>-1){const e=this._historyIndex+1;this._selectionHistory=this._selectionHistory.slice(0,e),this._optionsHistory=this._optionsHistory.slice(0,e)}var s,n;((s=this._selectionHistory[this._selectionHistory.length-1])===(n=e)||s&&n&&s.accountId===n.accountId&&s.path===n.path)&&(0,h.Z)(this._optionsHistory[this._optionsHistory.length-1],t)||(this._historyIndex=this._selectionHistory.length,this._selectionHistory.push(e),this._optionsHistory.push(t)),this._selectedFolder=e,this._storeSelectedFolder()}}const p=new u(a.Z)},98484:(e,t,s)=>{"use strict";s.d(t,{Z:()=>o});var n=s(24602),i=s(93513);class a extends n.Z{getInitialState(){return{undoActions:new Set,maxSize:200}}reduce(e,t){switch(t.actionType){case"MAIL_UNDO_ADD_ITEM":return this.isValidItem(t.undoItem)?(0,i.Uy)(e,(e=>{const{undoActions:s}=e;if(s.add({undoItem:t.undoItem,folder:t.folder,created:Date.now()}),s.size>e.maxSize){const e=[...s][0];s.delete(e)}})):e;case"MAIL_UNDO_DELETE_ITEM":return(0,i.Uy)(e,(e=>{e.undoActions.delete(t.undoAction)}));case"MAIL_INDEX_UPDATE":const{removedSles:s}=t.updates;return s?(0,i.Uy)(e,(e=>{for(const{undoItem:t}of e.undoActions)switch(t.operation){case"setFlags":case"delete":for(const e of s)t.searchListIds.delete(e)}})):e;default:return e}}getLatestUndoAction(){const{undoActions:e}=this.getState();return[...e][e.size-1]}getUndoActions(){return this.getState().undoActions}isValidItem(e){if(0===e.searchListIds.size)return!1;if("setFlags"===e.operation){const{sourcesPerSle:t,updates:s}=e;if(0===Object.keys(s).length&&0===t.size)return!1}return!0}}const o=new a},7168:(e,t,s)=>{"use strict";s.d(t,{Z:()=>o});var n=s(24602),i=s(35369);class a extends n.Z{getInitialState(){return new i.D5}reduce(e,t){switch(t.actionType){case"PAGE_SET_MEDIASTATE":const{tabId:s,mediastate:n}=t;return function(e,t,s){const n=e.get(s);if(n){const i=n.intersect(t).union(t);return e.set(s,i)}return t.length>0?e.set(s,(0,i.l4)(t)):e}(e,n,s);case"PAGE_CLOSE":return function(e,t){let s=e;return t.forEach((e=>{s.has(e.id)&&(s=s.remove(e.id))})),s}(e,t.pages);default:return e}}hasMediaState(e,t){const s=this.getState().get(e);return!!s&&s.has(t)}}const o=new a},62882:(e,t,s)=>{"use strict";s.d(t,{R0:()=>d,ZP:()=>Z,d0:()=>r,mS:()=>l});var n=s(65398),i=s(33638),a=s(92292),o=s(89555);const r="vivaldi/x-notes",l=500,d="1",c={children:[],content:"",dateAdded:0,dateModified:0,id:d,index:0,parentId:"0",title:"Notes",type:"folder"};let h=c,u={id:-1},p=[];class g extends n.Z{_resolveReady=o.Z;ready=(()=>new Promise((e=>{this._resolveReady=e})))();getRootNode(){return h}getLastTopNode(){const e=this.getRootNode(),t=e&&e.children?e.children:[];if(t.length>1)return t[t.length-2]}hasNotes(){const e=this.getRootNode();if(e&&e.children){if(e.children.length>1)return!0;const t=e.children[0];if(t&&"trash"===t.type)return Boolean(t.children&&t.children.length>0)}return!1}isFolder=e=>Boolean(e.children)&&"note"!==e.type;isSeparator=e=>"separator"===e.type;isAttachment(e){return"attachment"===e.type}isNodeEmpty(e){const t=S.getNodeById(e);return Boolean(t&&!t.title&&!t.content&&(!t.children||0===t.children.length))}hasChildren(e){return Boolean(e.children&&e.children.length>0)}getNodeById(e){const t=function(s){if(s)for(let n=0;n<s.length;n++){const i=s[n];if(i.id===e)return i;if(i.children){const e=t(i.children);if(e)return e}}};return t(h.children)}getDragData=(e,t)=>{const s=t.map((e=>S.getNodeById(e))).filter(Boolean);switch(e){case"text/plain":case"vivaldi/x-title":{const e=[];return s.forEach((t=>{e.push(S.isFolder(t)?t.title:t.content)})),e.join("\r\n")}case"text/html":{const e=s&&1===s.length?s[0]:void 0;return e&&e.url&&e.title?"<a href="+e.url+">"+e.title+"</a>":""}case"text/uri-list":case"vivaldi/x-uri-list":return s.filter((e=>!!e.url)).join("\r\n");default:return""}};getFilteredTree(e,t){const s=function(e,t,n,i,a){if(!e)return!1;let o=!1;return e.forEach((e=>{let r=!1;if(e.children&&"note"!==e.type){const l={...e,children:[]};s(e.children,l.children,n,i,a)&&(t.push(l),o=!0,r=!0)}if(!r&&"separator"!==e.type&&S._matchNode(e,i,a)){const s={...e};t.push(s),e.children&&"note"!==e.type&&n.push(e.id),o=!0}})),o},n=this.getRootNode().children,i=[],a=[];return s(n,i,a,e,t),{nodes:i,collapsed:a}}getFilteredFlat(e,t){const s=(e,t,n,i)=>{e&&e.forEach((e=>{!i.inTrash&&"trash"===e.type||"attachment"===e.type||"separator"===e.type||(S._matchNode(e,n,i)&&(e.children&&"note"!==e.type?t.push({...e,children:[]}):t.push({...e})),e.children&&"note"!==e.type&&s(e.children,t,n,i))}))},n=this.getRootNode().children,i=[];return s(n,i,e.toLowerCase(),t),i}_matchNode(e,t,s){let n=!1;const i=t.toLowerCase().split(" "),a=e.title?e.title.toLowerCase():"",o=e.content?e.content.toLowerCase():"",r=e.url?e.url.toLowerCase():"";return a.length&&(n=i.every((e=>a.includes(e)))),!n&&o&&!1!==s.content&&(n=i.every((e=>o.includes(e)))),!n&&r&&!1!==s.url&&(n=i.every((e=>r.includes(e)))),n}validateForDrag=e=>e.filter((e=>e!==u.id));validateForDeletion=e=>e.filter((e=>e!==u.id));validateForEdit=e=>e!==u.id;getTitle=e=>{const t=S.getNodeById(e);return t&&(t.title||t.content)||""};getCutIds(){return p}init=e=>{const t={...e[0],children:e[0].children??[]};h=e[0]?t:c,u=b(h)||{id:-1},S.emitChange({reason:"init",id:""}),this._resolveReady()};dispatchAction(e){switch(e.actionType){case"NOTES_INIT":this.init(e.notes);break;case"NOTES_ADD_ITEM":C(e.item,"added");break;case"NOTES_CHANGE_ITEM":!function(e,t){const s=h.children;if(h!==c&&s){!0===I(h,e,t)&&(h.children=[...s],S.emitChange({reason:"changed",id:e}))}}(e.id,e.changes);break;case"NOTES_MOVE_ITEM":!function(e,t,s){if(h!==c&&h.children){const n=S.getNodeById(e);void 0!==n&&(w(e,!0),n.parentId=t,n.index=s,C(n,"moved"))}}(e.id,e.targetFolder,e.targetIndex);break;case"NOTES_REMOVE_ITEM":w(e.id,!1);break;case"NOTES_SET_CUT_IDS":f(e.ids);break;case"WINDOW_READY":p.length>0&&v(!0)}}}function m(e){"Escape"===e.key&&f([])}function f(e){p=e,v(e.length>0),S.emitChange({reason:"cutids",id:""})}function v(e){e?a.Z.extension.getViews().forEach((e=>{e.addEventListener("keydown",m,!0)})):a.Z.extension.getViews().forEach((e=>e.removeEventListener("keydown",m,!0)))}function b(e){if(e.children)for(let t=0;t<e.children.length;t++){const s=e.children[t];if("trash"===s.type)return s;if(s.children){const e=b(s);if(void 0!==e)return e}}}function C(e,t){const s=h.children;if(h!==c&&s){!0===x(h,e)&&(h.children=[...s],S.emitChange({reason:t,id:e.id}))}}function w(e,t){const s=h.children;if(h!==c&&s){!0===A(h,e)&&(h.children=[...s],t||S.emitChange({reason:"removed",id:e}))}}function y(e){if(e.children)for(let t=0;t<e.children.length;t++){e.children[t].index=t}}function x(e,t){if(e.id===t.parentId)return e.children&&e.children.splice(t.index||0,0,t),y(e),!0;if(e.children)for(let s=0;s<e.children.length;s++){const n=e.children[s],i=n.children;if(i){if(x(n,t))return n.children=[...i],!0}}return!1}function I(e,t,s){if(!e.children)return!1;for(let n=0;n<e.children.length;n++){const i=e.children[n];if(i.id===t&&(i.title!==s.title||void 0!==s.content&&i.content!==s.content||void 0!==s.url&&i.url!==s.url||void 0!==s.dateModified&&i.dateModified!==s.dateModified)){const t={...e.children[n],...s};return e.children.splice(n,1,t),!0}if(i.children){const e=i.children;if(!0===I(i,t,s))return i.children=[...e],!0}}return!1}function A(e,t){if(!e.children)return!1;for(let s=0;s<e.children.length;s++){const n=e.children[s];if(n.id===t)return e.children.splice(s,1),y(e),!0;if(n.children){const e=n.children;if(!0===A(n,t))return n.children=[...e],!0}}return!1}const S=new g(i.Z),Z=S},17673:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});var n=s(24602);function i(e){return t=>t.id!==e}function a(e,t){return e.when-t.when}class o extends n.Z{getInitialState(){return{notifications:[],activeNotifications:[]}}reduce(e,t){switch(t.actionType){case"NOTIFICATIONS_INIT":return{...e,notifications:t.notifications};case"NOTIFICATIONS_FOR_EVENT":const s=e.notifications.filter((e=>e.event_id!==t.event.id));return s.push(...t.event.notifications??[]),{...e,notifications:s};case"MAIN_SHOW_CALENDAR_ALARM":return{...e,activeNotifications:e.activeNotifications.filter(i(t.options.reminder.id)).concat(t.options.reminder).sort(a)};case"MAIN_HIDE_CALENDAR_ALARM":return{...e,activeNotifications:e.activeNotifications.filter(i(t.notificationId))}}return e}}const r=new o},96951:(e,t,s)=>{"use strict";s.d(t,{NK:()=>M,ZP:()=>le,uU:()=>Z,yz:()=>Q});var n=s(59486),i=s(7065),a=s(16682),o=s(29087),r=s(24602),l=s(37330),d=s(9304),c=s(15489),h=s(92292),u=s(42568),p=s.n(u),g=s(25372),m=s(7064),f=s(1407),v=s(35369),b=s(69046),C=s(16152),w=s(42578),y=s(36436),x=s(44850),I=s(89175),A=s(48588),S=s(14789);function Z(e){return{type:"tab",id:e.id,page:e}}function T(e){const t=new Map;return t.set(void 0,[]),Object.freeze({windowId:e,list:(0,v.aV)(),history:[],minimizeHistory:null,lastHistory:null,isSelecting:!1,selection:(0,v.l4)(),selectionAnchor:null,selectionLead:null,cycleByHistory:t,cycledByHistoryPageId:null})}class E extends r.Z{getInitialState(){return new Map}getPages(e,t){const s=N(e).list;return t?s.filter((e=>(0,b.cm)(e)===t.workspaceId)):s}getWorkspacePages(e){if(!e)return(0,v.aV)();const t=[];for(const[,s]of this.getState())t.push(s.list.filter((t=>(0,b.cm)(t)===e)));return(0,v.aV)(t).flatten()}getPinnedCount(e){return N(e).list.count((e=>e.pinned))}findPageInAllWindows(e){let t;const s=s=>{!t&&e(s)&&(t=s)};return this.getState().forEach((e=>{e.list.forEach(s)})),t}getPageToSwitch(e){let t,s;const n=(0,g.Z)(e);return n&&(n.hostname=n.hostname.replace("www.","")),this.getState().forEach((i=>{for(let a=i.history.length-1;a>=0;a--){if(t)continue;const o=i.history[a],r=i.list.find((e=>e.id===o));if(r&&(r.url===e&&(t=r),!s&&n)){const e=(0,g.Z)(r.url);e&&n.hostname===e.hostname.replace("www.","")&&(s={...r})}}})),t??s}findRecentPageInAllWindows(e){let t;const s=s=>{!t&&e(s)&&(t=s)};return this.getState().forEach((e=>{for(let t=e.history.length-1;t>=0;t--){const n=e.history[t],i=e.list.find((e=>e.id===n));i&&s(i)}})),t}filterPagesInAllWindows(e){const t=[],s=s=>{e(s)&&t.push(s)};return this.getState().forEach((e=>{e.list.forEach(s)})),(0,v.aV)(t)}getTabs(e){const t=N(e);return P(t.list,t.history)}getWorkspaceTabsInWindow(e,t,s){if(s)return this.getPages(e,{workspaceId:t}).map(Z);return this.getTabs(e).filter((e=>(0,b.cm)(e.page)===t))}getWorkspaceTabs(e,t){for(const s of c.ZP.getIds("normal")){const n=this.getWorkspaceTabsInWindow(s,e,t);if(n.size>0)return n}return(0,v.aV)()}getPageById(e){return this.findPageInAllWindows((t=>t.id===e))}getPagesByUrl(e,t){return this.getPages(e).filter((e=>e.url===t))}getPageInWindow(e,t){return N(e).list.find((e=>e.id===t))}getPageByReloadId(e){return this.findPageInAllWindows((t=>t.vivExtData.ext_id===e))}getPageHistory(e){return N(e).history}getActiveWorkspace(e){const t=this.getActivePage(e);return t?(0,b.cm)(t):void 0}getActiveWorkspaces(){const e=new Map;for(const[t,{list:s}]of this.getState()){const n=D(s);if(n){const s=(0,b.cm)(n);s&&e.set(s,t)}}return e}unsafeGetActivePage(e){return D(N(e).list)??(0,b.SJ)()}getActivePage(e){return D(N(e).list)}getActiveGroupId(e){const t=this.getActivePage(e);return t?(0,b.av)(t):void 0}getLastVisited(e){const t=N(e),s=t.history[t.history.length-2];return t.list.find((e=>e.id===s))}isActivePage(e,t){return this.getActivePage(e)?.id===t}isUnread(e){return e.unread&&!e.discarded}getGroup(e,t){const s=N(t);return e?O(s.list,e):(0,v.aV)()}getExistingHostGroups(e,t){return re.getPages(e,{workspaceId:t}).filter((e=>!e.pinned)).groupBy(b.av).reduce(((e,t,s)=>{const n=(0,w.q)(t.first());return s&&t.size>1&&t.rest().every((e=>(0,w.q)(e)===n))&&e.set(s,{hostname:n,pages:t}),e}),new Map)}getGroupsForHosts(e,t){const s=[],n=new Map;for(const[,{hostname:i,pages:a}]of re.getExistingHostGroups(e,t)){const e=n.get(i);e?(n.set(i,e.concat(a)),s.push(i)):n.set(i,a)}const i=re.getPages(e,{workspaceId:t}).filter((t=>{const s=(0,b.av)(t);return!(t.pinned||s&&re.isGroup(s,e))})).groupBy(w.q).reduce(((e,t,s)=>{const i=n.get(s);return i?e.set(s,i.concat(t)):t.size>1&&e.set(s,t),e}),new Map);return s.forEach((e=>{i.has(e)||i.set(e,n.get(e))})),i}isDisplayingImage(e){const t=this.getPageById(e);return!!t&&["image/avif","image/jpeg","image/pjpeg","image/jpg","image/webp","image/png","image/gif","image/bmp","image/vnd.microsoft.icon","image/x-icon","image/x-xbitmap","image/x-png"].includes(t.mimeType)}isGroup(e,t){if(!e)return!1;if("off"===o.Z.get(I.kTabsStackingMode))return!1;const s=N(t);return!!e&&j(s.list,e)>1}isPinnedGroup(e,t){return this.isGroup(e,t)&&this.getGroup(e,t).some((e=>e.pinned))}getGroupHighlightId(e,t){const s=N(t);return L(s.list,s.history,e)?.id}getTiles(e,t){const s=N(t);return R(s.list,e)}isSelecting(e){return N(e).isSelecting}getSelection(e){return N(e).selection}getSelectedPages(e){const t=re.getActiveWorkspace(e),s=N(e),n=s.selection.reduce(((e,n)=>{const i=s.list.find((e=>e.id===n));return i&&(0,b.cm)(i)===t?[...e,i]:e}),[]);return(0,v.aV)(n).sortBy((e=>e.index))}getSelectionOrActivePage(e){if(re.isSelecting(e)){const t=re.getSelectedPages(e);if(!t.isEmpty())return t}const t=re.getActivePage(e);return t?v.aV.of(t):(0,v.aV)()}getReloadingPages(){return this.filterPagesInAllWindows((e=>Number(e.vivExtData.interval)>0))}getDiscardablePages(e){const t=N(e);return this._getDiscardablePages(e,t.list)}getNewGroupId(){return crypto.randomUUID()}getUnreadCount(e){let t=0;return N(e).list.forEach((e=>{this.isUnread(e)&&t++})),t}getHistoryManagerState(e){return this.getPageById(e)?.vivExtData.historyManagerState}canClosePage(e){if(e.pinned&&(!(0,b.av)(e)||!o.Z.get(I.kTabsClosePinnedInStack))&&"on"!==o.Z.get(I.kTabsClosePinned))return!1;return!(o.Z.get(I.kTabsNeverCloseLast)&&(0,x.Rf)(e.url)&&re.isLastPage(e))}isLastPage(e){const t=(0,b.cm)(e);return this.getPages(e.windowId,{workspaceId:t}).size<2}getStepInfo(e,t,s,n){const i=(0,b.cm)(e),a=this.getPages(n,{workspaceId:i}),o=(0,b.av)(e);if(o&&!s){const s=a.flatMap(((e,t)=>(0,b.av)(e)===o?[t]:[])),n=s.first()??0,i=s.last()??0;let r;return r=t?e.index+1>i?i:e.index+1:e.index-1<n?n:e.index-1,{pages:v.aV.of(e),index:r}}{const i=o&&s?this.getGroup(o,n):v.aV.of(e);if(t){const t=o&&s?i.last().index:e.index,r=a.last().index;if(t===r)return;const l=a.indexOf(a.find((e=>e.index===t))),d=a.get(l+1);if(!d)return;const c=(0,b.av)(d);let h;if(c){h=this.getGroup(c,n).last().index}else h=d.index;return{pages:i,index:h}}{const t=o&&s?i.first().index:e.index,r=a.find((e=>!e?.pinned))?.index||0;if(t===r)return;const l=a.indexOf(a.find((e=>e.index===t))),d=a.get(l-1);if(!d)return;const c=(0,b.av)(d);let h;if(c){h=this.getGroup(c,n).first().index}else h=d.index;return{pages:i,index:h}}}}isActiveInternal(e){const t=this.getActivePage(e)?.url??"";return x.jk.isInternalUrl(t)}isActiveExternal(e){const t=this.getActivePage(e)?.url??"";return!x.jk.isInternalUrl(t)}getStartpage(e){const t=c.ZP.isIncognito(e),s=0===re.getPages(e).size,n=t&&o.Z.get(I.kIncognitoShowIntro)&&s?x.jk.internals["private-intro"]:`${x.jk.internals.startpage}?section=Speed-dials`,i=d.ZP.getWindowBackgroundColor(l.Z.getBaseStylesByWindowId(e,["colorBg"]));return i&&!t?n+"&background-color="+i.toString():n}getDefaultStartpage(e){if(c.ZP.isGuest())return x.jk.internals["guest-intro"];let t=o.Z.get(I.kTabsNewPageLink);if(t===f.Fp.EXTENSION){const e=o.Z.get(I.kExtensionURLOverrides).newtab?.some((e=>e.active));e||(t=f.Fp.STARTPAGE)}switch(t){case f.Fp.EXTENSION:return f.P1;case f.Fp.BLANKPAGE:return x.jk.internals.blankpage;case f.Fp.HOMEPAGE:const t=o.Z.get(I.kHomepage);return t===f.QG?this.getStartpage(e):t;case f.Fp.CUSTOM:const s=o.Z.get(I.kTabsNewPageCustomUrl);return(0,y.C3)(s)||(0,y.xl)(s)?x.jk.getUrl(s):x.jk.internals.blankpage;case f.Fp.STARTPAGE:default:return this.getStartpage(e)}}canUseForMenu(e,t){const s=N(e).list;return s.size===t.size&&!t.some(((e,t)=>{const n=s.get(t);return e!==n&&(e.title!==n?.title||e.url!==n?.url)}))}getCyclePageByOrder(e,t,s){const n=re.getPages(e,{workspaceId:t}),i=((n.findIndex((e=>e.active))+(s?-1:1))%n.size+n.size)%n.size;return n.get(i)?.id??-1}reduce(e,t){switch(t.actionType){case"PAGE_CLEAR":return re.getInitialState();case"CHROME_TABS_INIT":return _(k,e,t.windowId,t.tabs);case"WINDOW_CLOSED":return(0,A.u4)(e,t.windowId);case"CHROME_TABS_CREATE":return _(V,e,t.page.windowId,t.page,t.tabActivationHistory,t.deactivatePageId,t.openerMissingGroupId);case"NAVIGATION_SET_STATE":return _(W,e,t.windowId,t.pageId,t.navigationState);case"CHROME_TABS_REMOVED":return _(H,e,t.removeInfo.windowId,t.tabId);case"CHROME_TABS_REPLACED":{const s=re.getPageById(t.removedTabId);return s?_(K,e,s.windowId,t):e}case"CHROME_TABS_UPDATED":return _(G,e,t.windowId,t.tabId,t.changeInfo);case"CHROME_TABS_MOVED":return _(z,e,t.windowId,t.tabId,t.index);case"PAGE_OPEN_URL":return _(q,e,t.windowId,t.pageId,t.url,t.postParams,t.headers,t.transition,t.fromUrlField,t.bookmarkId);case"PAGE_OPEN":return _(Y,e,t.windowId,t.pageId,t.activatedByChrome??!1,t.selectGroup);case"PAGE_MINIMIZE":return _(X,e,t.windowId,t.workspaceId);case"PAGE_SET_IS_INSPECTED":return _(F,e,t.windowId,t.pageId,"isInspected",t.inspected);case"PAGE_TABSTACK_CREATE":return _(te,e,t.pages.first().windowId);case"PAGE_SET_TITLE":return _(F,e,t.windowId,t.pageId,"title",t.title);case"PAGE_SET_IMAGE_INSPECTOR":return _(F,e,t.windowId,t.pageId,"showImageInspector",t.showImageInspector);case"READERMODE":return _(F,e,t.windowId,t.pageId,"supportsReaderMode",t.supportsReaderMode);case"VIVALDI_TABS_UPDATED":return _($,e,t.windowId,t.pageId,t.tabInfo);case"VIVALDI_TABRESOURCE_INFO_UPDATED":{const s=re.getPageById(t.memoryInfo.tabId);return s?_(F,e,s.windowId,t.memoryInfo.tabId,"memoryUsage",t.memoryInfo.memoryUsage):e}case"PAGE_SELECTION_SET":return _(ie,e,t.page.windowId,t.page,t.multiSelect,t.addGroup,t.excludeActive);case"PAGE_SELECTION_TOGGLE_RELATED":return _(se,e,t.page.windowId,t.page);case"PAGE_SELECTION_EXPAND_PREVIOUS":return _(ne,e,t.page.windowId,t.page,"previous");case"PAGE_SELECTION_EXPAND_NEXT":return _(ne,e,t.page.windowId,t.page,"next");case"PAGE_SELECTION_CLEAR":return _(te,e,t.windowId);case"PAGE_CYCLE_HISTORY_MODIFIER_UP":return _(oe,e,t.windowId,t.workspaceId);case"PAGE_SET_CYCLE_BY_HISTORY":return _(ae,e,t.windowId,t.goBack,t.activateEventModifierUp,t.workspaceId);default:return e}}_getDiscardablePages(e,t){return t.filter((t=>!t.discarded&&!t.active&&!t.isInspected&&t.url!==this.getDefaultStartpage(e)))}}function k(e,t){const s=(0,v.aV)(t.map((e=>(e.favIconUrl||(e.favIconUrl=function(e){if(!e.favIconUrl||e.favIconUrl.startsWith("file://"))return"chrome://favicon/size/16@2x/"+(e.url||"");return e.favIconUrl}(e)),i.ZP.tabToPage(e)))));B(e.windowId),e.list=s,e.history=function(e){e.sort(((e,t)=>e.lastAccessed-t.lastAccessed));const t=e.findIndex((e=>e.active));if(-1!==t&&t!==e.length-1){const[s]=e.splice(t,1);e.push(s)}return e.map((e=>e.id)).filter(Boolean)}(t),te(e)}function N(e){return re.getState().get(e)??T(e)}function _(e,t,s,n,i,a,o,r,l,d){if("number"!=typeof s)return t;const c=t.get(s)??T(s),h={...c};if(e(h,n,i,a,o,r,l,d),!function(e,t){let s=!1;for(const n of Object.keys(t)){const i=t[n];i!==e[n]&&(Array.isArray(i)&&Object.freeze(i),s=!0)}return!!s&&(Object.freeze(t),!0)}(c,h))return t;const u=new Map(t);return u.set(s,h),u}const P=p()(((e,t)=>e.groupBy((e=>(0,b.av)(e)||e.id)).map(((s,n,i)=>s.size>1?{type:"group",id:String(n),pages:s,page:L(e,t,`${n}`)??s.first()}:{type:"tab",page:s.first(),id:s.first().id})).toList()));function M(e){const t=N(e.first().windowId);return P(e,t.history)}const D=p()((e=>e.find((e=>e.active))));const O=p()((function(e,t){return t?e.filter((e=>(0,b.av)(e)===t)):(0,v.aV)()}),{maxSize:10}),j=p()(((e,t)=>e.count((e=>(0,b.av)(e)===t))),{maxSize:10}),L=p()(((e,t,s)=>{const n=O(e,s);if(!n.isEmpty()){for(let e=t.length-1;e>=0;e--){const s=t[e],i=n.find((e=>e.id===s));if(i)return i}return n.first()}console.warn(`No pages in stack ${s}.`)}),{maxSize:10});const R=p()((function(e,t){return t?e.filter((e=>(0,b.jA)(e)===t)):(0,v.aV)()}),{maxSize:10});const B=(0,C.Z)((e=>h.Z.tabs.query({windowId:e},(e=>e.forEach((e=>{const t=re.getPageById(e.id?e.id:-1);if(t){let s;try{s=JSON.parse(e.vivExtData||"{}")}catch(e){s={}}const n=(0,v.D5)(s);(0,v.is)(n,t.vivExtData)||h.Z.tabs.update(t.id,{vivExtData:JSON.stringify(s)},(()=>{var s,n;h.Z.runtime.lastError||t.active&&e.id&&(s=e.id,n=()=>{e.id&&a.Z.injectScripts(e.id,e)},h.Z.tabs.get(s,(e=>{if(h.Z.runtime.lastError)return;if("complete"===e.status)return void n();let t;function i(e,i){e===s&&("complete"!==i&&"_timeout"!==i||(t&&(clearTimeout(t),t=void 0),h.Z.tabs.onUpdated.removeListener(a),n()))}function a(e,t){t.status&&i(e,t.status)}t=setTimeout((()=>{t=void 0,i(s,"_timeout")}),2e3),h.Z.tabs.onUpdated.addListener(a)})))}))}}))))),160);function F(e,t,s,n){const i=e.list.findIndex((e=>e.id===t));-1!==i&&(e.list=e.list.setIn([i,s],n))}function W(e,t,s){if("stop"!==s.trigger&&"abort"!==s.trigger)return;const n=e.list.findIndex((e=>e.id===t));if(-1===n)return;const i=e.list.get(n);if(!i||!i.target)return;const{target:a}=i;e.list=e.list.set(n,{...i,url:a.committedUrl,target:void 0})}function U(e,t){return e.index!==t?{...e,index:t}:e}function V(e,t,s,n,i){e.list=e.list.splice(t.index,0,t).map(((e,s)=>(e.id===n&&(e={...e,active:!1}),e.id===i&&(e={...e,vivExtData:{...e.vivExtData,group:t.vivExtData.group}}),U(e,s)))),e.history=s,te(e)}function H(e,t){const[s,n]=e.list.partition((e=>e.id===t));e.list=s.map(U);const i=n.first()?.id,a=i?e.history.indexOf(i):-1;if(-1!==a){const t=[...e.history];t.splice(a,1),e.history=t}te(e)}function G(e,t,s){e.list=i.ZP.updatePage(e.list,t,s)}function K(e,t){const{removedTabId:s,addedTabId:n}=t;F(e,s,"id",n),e.history=e.history.map((e=>e===s?n:e))}function z(e,t,s){const n=e.list.find((e=>e.id===t));n&&(te(e),function(e,t,s){const n=e.list.findIndex((e=>e.id===t.id));s===n&&t.index===s||(e.list=e.list.delete(n).splice(s,0,t).map(U))}(e,n,s))}function $(e,t,s){s.hasOwnProperty("mimeType")&&F(e,t,"mimeType",s.mimeType)}function Y(e,t,s=!1,n=!0){const i=e.list;if(function(e,t){const s=e.list.findIndex((e=>e.id===t));if(-1===s)return void console.warn("PageStore.activatePage: page to activate not found");const n=e.list.findIndex((e=>e.active));-1!==n&&n!==s&&(e.list=e.list.setIn([n,"active"],!1)),e.list=e.list.mergeIn([s],{unread:!1,active:!0})}(e,t),e.list===i)return;te(e,n),s||h.Z.tabs.update(t,{active:!0},(()=>{h.Z.runtime.lastError}));const a=[...e.history];(0,S.AL)(a,t),e.history=a}function X(e,t){let s=e.minimizeHistory?.get(t);s&&(0,v.is)(e.lastHistory,e.history)||(s=e.history.filter((s=>{const n=e.list.find((e=>e.id===s));return n&&(0,b.cm)(n)===t}))),s=(0,S.JA)(s,!0);const n=e.minimizeHistory??new Map;n.set(t,s),e.minimizeHistory=n;const i=s[s.length-1],a=e.list.find((e=>e.id===i))?.id;a?Y(e,a):console.warn(`Page with id ${i} not found.`),e.lastHistory=e.history}function Q(e){const t=e instanceof v.aV?e:v.aV.of(e),s=t.first().windowId;let n;if(o.Z.get(I.kTabsActivationPreferRelated)){if(n=function(e,t){const s=(0,b.cm)(e),n=re.getPages(e.windowId),i=t.map((e=>e.id));let a;if(e.openerTabId){const t=o.Z.get(I.kTabsActivationOnClose);if("activation_order"===t){const t=n.filter((t=>t.id!==e.id&&(t.openerTabId===e.openerTabId||t.id===e.openerTabId)&&(0,b.cm)(t)===s&&!i.includes(t.id))).map((e=>e.id)),o=N(e.windowId).history.findLast((e=>t.includes(e)));a=o?n.find((e=>e.id===o)):void 0}else{const o=()=>n.takeUntil((t=>t.id===e.id)).filter((t=>(t.openerTabId===e.openerTabId||t.id===e.openerTabId)&&(0,b.cm)(t)===s&&!i.includes(t.id))).reverse(),r=()=>n.slice(e.index+1).filter((t=>(t.openerTabId===e.openerTabId||t.id===e.openerTabId)&&(0,b.cm)(t)===s&&!i.includes(t.id)));a="right"===t?r().first()||o().first():o().first()||r().first()}}return a||(a=n.skipUntil((t=>t.id===e.id)).filter((e=>!i.includes(e.id))).find((t=>t.openerTabId===e.id&&(0,b.cm)(t)===s))),a}(t.find((e=>e.active))??t.first(),t),n)return n}const i=o.Z.get(I.kTabsActivationOnClose),a=(0,b.cm)(t.first()),r=t.map((e=>e.id)),l=re.getPages(s,{workspaceId:a});switch(i){case"left":{const e=l.findIndex((e=>r.includes(e.id)))-1;n=e<0?l.find((e=>!r.includes(e.id))):l.get(e);break}case"right":{const e=l.findLastIndex((e=>r.includes(e.id)))+1;n=e<l.size?l.get(e):l.findLast((e=>!r.includes(e.id)));break}case"activation_order":n=void 0;break;default:0,n=void 0}if(!n){const e=N(s).history,i=1===t.size?t.first()?.vivExtData?.group:null;for(let s=e.length-1;s>=0;s--){const a=e[s],o=l.find((e=>e.id===a));if(o){if(!n&&!t.includes(o)&&(n=o,!i))break;if(!(i&&o.vivExtData?.group!==i||t.includes(o))){n=o;break}}}n||(n=l.findLast((e=>!r.includes(e.id))))}return n}function q(e,t,s,i,a="",o=m.Z.historyPrivate.TransitionType.LINK,r=!1,l){const d=e.list.findIndex((e=>e.id===t));if(-1===d)return;const c=e.list.get(d);if(!c)return;const h={committedUrl:c.url,postParams:i,headers:a,transition:o,fromUrlField:r};l&&!n.Z.isTopSite(l)&&(c.context.bookmarkThumbnailQueue={bookmarkId:l,url:s}),e.list=e.list.set(d,{...c,target:h,url:s,mimeType:"text/html"})}function J(e,t,s){if(s){const s=e.windowId,n=(0,b.av)(t);let i=(0,v.aV)();re.isGroup(n,s)?i=re.getGroup(n,s):e.selection=e.selection.add(t.id);const a=re.getActivePage(e.windowId),o=a?(0,b.av)(a):void 0;if(o!==n&&re.isGroup(o,s)&&(i=i.concat(re.getGroup(o,s))),i.size>1)return void(e.selection=e.selection.union(i.map((e=>e.id))))}else e.selection=e.selection.add(t.id)}function ee(e,t){const s=e.toList().filter((e=>e!==t.id)).map((e=>{const t=re.getPageById(e);return t?t.index:-1}));if(!s.isEmpty()){const e=s.insert(0,t.index).toArray();h.Z.tabs.highlight({tabs:e,windowId:t.windowId})}}function te(e,t=!0){e.isSelecting=!1;const s=D(e.list);e.selectionAnchor=s??null,e.selectionLead=s??null,0!==e.selection.size&&(e.selection=(0,v.l4)());o.Z.get(I.kTabsSelectionIncludeActive)&&s&&J(e,s,t)}function se(e,t){e.isSelecting||te(e),e.selectionLead=t;if(re.isGroup((0,b.av)(t),e.windowId)){J(e,t,!0)}else{const s=re.getTabs(e.windowId),[,n]=(0,w.d)(t,s);e.selection=n.reduce(((e,t)=>e.add(t.id)),e.selection),e.isSelecting=!0}}function ne(e,t,s){const n=t=>{const n="next"===s?t.index+1:t.index-1;return e.list.get(n)},i=e.windowId,a=o.Z.get(I.kTabsStackingMode),r=(0,b.av)(t),l=re.isGroup(r,i),d=l&&"accordion"===a&&o.Z.get(I.kTabsStackingOpenAccordions).includes(r);if(e.isSelecting){const t=e.selection.map((t=>{const s=e.list.find((e=>e.id===t));return s&&"number"==typeof s.index?s.index:-1})).filter((e=>e>-1)).sort(),o="next"===s,l=o?t.last():t.first(),c=o?l+1:l-1,h=e.selectionLead,u=re.getActivePage(i);if(h&&u){const s=e.selection.size>1&&!(u.index<=h.index&&h.index<=c&&o||u.index>=h.index&&h.index>=c&&!o);if(!s&&(c<0||c>e.list.size))return;if(s){const s=e.list.get(o?t.first():t.last());if(!s)return;if(s!==u){const t=!(("substrip"===a||d)&&r===(0,b.av)(s));ie(e,s,!1,t)}else{const s=e.list.get(o?t.last():t.first()),i=s&&n(s);if(i){const t=!(("substrip"===a||d)&&r===(0,b.av)(i));ie(e,i,!1,t)}}}else{const t=e.list.get(c);if(t){const s=r!==(0,b.av)(t)||"substrip"!==a&&"accordion"!==a;ie(e,t,!1,s)}}}}else if(l&&!d&&"substrip"!==a&&o.Z.get(I.kTabsSelectionIncludeActive))ie(e,t,!1,!0);else{const s=n(t);if(s){const t=!l||r!==(0,b.av)(s)&&("substrip"===a||"accordion"===a);return void ie(e,s,!1,t)}}}function ie(e,t,s,n,i=!1){e.isSelecting||(i?(e.selectionAnchor=re.unsafeGetActivePage(e.windowId),e.selectionLead=e.selectionAnchor,e.selection=(0,v.l4)()):te(e,n)),s?function(e,t,s){const n=e.selectionAnchor,i=e.selectionLead;if(!n||!i)return;const a=i.index,r=n.index,l=e.windowId,d=e.list.filter((e=>e.index>=Math.min(r,a)&&e.index<=Math.max(r,a))).flatMap((e=>{const t=(0,b.av)(e);return re.isGroup(t,l)?re.getGroup(t,l):[e]})).map((e=>e.id)),c=t.index,h=!o.Z.get(I.kTabsSelectionIncludeActive),u=e.list.filter((e=>e.index>=Math.min(r,c)&&e.index<=Math.max(r,c)&&!(h&&e.active))).flatMap((e=>{const t=(0,b.av)(e);return s&&re.isGroup(t,l)?re.getGroup(t,l):[e]})).map((e=>e.id)),p=e.selection.subtract(d).union(u);e.selection=p,e.selectionLead=t,ee(e.selection,re.unsafeGetActivePage(l)),e.isSelecting=!0}(e,t,n):function(e,t,s){e.selectionLead=t,e.isSelecting||(e.selectionAnchor=t);!e.isSelecting&&t.active||!e.selection.contains(t.id)?J(e,t,s):function(e,t,s){if(s&&re.isGroup((0,b.av)(t),e.windowId)){const s=re.getGroup((0,b.av)(t),e.windowId).map((e=>e.id));e.selection=e.selection.subtract(s)}else e.selection=e.selection.remove(t.id)}(e,t,s);ee(e.selection,re.unsafeGetActivePage(e.windowId)),e.isSelecting=!0}(e,t,n)}function ae(e,t,s,n){const i=e.history.filter((t=>{const s=e.list.find((e=>e.id===t));return s&&(0,b.cm)(s)===n}));let a;if(s){let s=e.cycleByHistory?.get(n);s?s=function(e,t){if(e===t)return t;const s=new Set(e),n=new Set;for(let e=0;e<t.length;++e)s.has(t[e])&&n.add(t[e]);if(n.size===s.size&&n.size===t.length)return t;for(const t of e)n.add(t);return Array.from(n)}(i,s):(s=i,e.cycledByHistoryPageId=s[s.length-1]),s=(0,S.JA)(s,!1===t),e.cycleByHistory||(e.cycleByHistory=new Map,e.cycleByHistory.set(void 0,[])),e.cycleByHistory?.set(n,s),a=s[s.length-1]}else{const s=i.length>0;do{e.history=(0,S.JA)(e.history,!1===t),a=e.history[e.history.length-1]}while(s&&!i.includes(a))}a?Y(e,a,!1,!0):console.warn(`Page with extId ${a} not found.`)}function oe(e,t){const s=e.cycleByHistory?.get(t),n=e.cycledByHistoryPageId,i=s&&s[s.length-1];if(n&&i){const t=e.history.filter((e=>e!==n&&e!==i));t.push(n),n!==i&&t.push(i),e.history=t}e.cycleByHistory?.set(t,null),e.cycledByHistoryPageId=null}const re=new E,le=re},15285:(e,t,s)=>{"use strict";s.d(t,{Pv:()=>v,QZ:()=>y,ZP:()=>O,fG:()=>b,jM:()=>w,ut:()=>x});var n=s(96951),i=s(34197),a=s(24367),o=s(68247),r=s(29087),l=s(24602),d=s(16716),c=s(15489),h=s(34540),u=s(86461),p=s(16152),g=s(9304),m=s(89175),f=s(93513);const v=35,b=10,C=["PanelDownloads","PanelWindow"],w=["PanelMail","PanelContacts"],y=["PanelFeeds"],x=["PanelCalendar","PanelTasks"],I=u.e3,A=(0,p.Z)(h.Z,500);function S(e){const{draft:t,winId:s,visible:n}=e,i=t.windowData.get(s);i&&(n?(i.barVisible=!0,i.contentVisible=!0,i.selectedPanel=i.selectedPanel||M.getFirstAvailablePanel(s)):(t.previousPanelBarVisible=i.barVisible,i.contentVisible=!1),t.changeReason="")}function Z(e,t){const s=e.windowData.get(t);if(!s)return;const{contentVisible:n}=s;n?e.changeReason="setFocus":(s.barVisible=!0,s.contentVisible=!0,s.selectedPanel=s.selectedPanel||M.getFirstAvailablePanel(t),e.changeReason="")}function T(e){const{setFocus:t,selectId:s,panelId:n,draft:i,reason:a,winId:o}=e,r=i.windowData.get(o);if(!r)return;const{contentVisible:l,selectedPanel:d,expandedWidth:c}=r,h=r.transitionMap.get(n);l&&d===n&&h?.selectId===s||M.canRender({windowData:r,winId:r.winId,panelId:n})&&(r.transitionMap.set(n,{...h,setFocus:t,selectId:s,reason:a}),r.barVisible=!0,r.contentVisible=!0,r.expandedWidth=0===c?400:c,r.focusContent=t,r.selectedPanel=n,i.changeReason="display",D(i,o))}function E(e,t){const s=e.windowData.get(t);if(!s)return;const{contentVisible:n,lastFocused:i,expandedWidth:a,barVisible:o}=s;n?(i?.focus(),s.barVisible=!1,s.contentVisible=!1,s.lastFocused=null,s.expandedWidth=0===a?400:a):o?(s.barVisible=!1,s.selectedPanel=void 0):(s.barVisible=!0,s.selectedPanel&&_({draft:e,winId:t,panelId:s.selectedPanel})),s.contentVisible||(e.previousPanelBarVisible=s.barVisible??!1),e.changeReason=""}function k(e){const{draft:t,windowId:s,leavePage:n,enterPage:i}=e,a=n?.isMailPage,o=i?.isMailPage,r=t.windowData.get(s)?.selectedPanel;!a&&o&&"PanelFeeds"!==r&&"PanelContacts"!==r?function(e,t){const s=e.windowData.get(t);if(!s)return e;e.previousMailPanel={selectedPanel:s.selectedPanel??"PanelMail",barVisible:s.barVisible??!1,contentVisible:s.contentVisible??!1},T({draft:e,winId:t,setFocus:!1,panelId:"PanelMail",selectId:"",reason:""}),e.changeReason="layout"}(t,s):M.shouldRestorePrevPanelState({draft:t,winId:s,isEnterPageMail:o,isLeavePageMail:a})&&(!function(e,t){const s=e.previousMailPanel;s&&(s.selectedPanel&&T({draft:e,winId:t,setFocus:!1,panelId:s.selectedPanel,selectId:"",reason:""}),S({draft:e,winId:t,visible:s.contentVisible}),s.barVisible||(E(e,t),D(e,t)),e.changeReason="")}(t,s),t.changeReason="layout")}function N(e){const{draft:t,winId:s,minimal:n}=e,i=t.windowData?.get(s);if(!i)return;const a=M.getIsBarVisible(s);(n?a:a!==i.visibilityBeforeMinimalUI)&&(E(t,s),t.changeReason=""),n&&(i.visibilityBeforeMinimalUI=a)}function _(e){const{draft:t,winId:s,panelId:n}=e,i=t.windowData?.get(s);if(!M.canRender({windowData:i,winId:s,panelId:n})||!i)return;const a=!i?.contentVisible,{contentVisible:o,selectedPanel:r,lastFocused:l}=i,d=!o;n===r?(d||l?.focus(),i.barVisible=!0,i.contentVisible=d,i.focusContent=d,i.lastFocused=d?document.activeElement:null):(i.barVisible=!0,i.contentVisible=!0,i.selectedPanel=n,i.lastFocused=d?document.activeElement:null,i.focusContent=!0),a||(t.previousPanelBarVisible=i?.barVisible??!1),t.changeReason=""}class P extends l.Z{getInitialState(){return{windowData:new Map,webPanelList:[],regPanelList:[],webPanelMap:new Map,previousPanelBarVisible:!1,previousMailPanel:void 0,changeReason:""}}reduce(e,t){switch(t.actionType){case"PANEL_INIT_COMMON":return(0,f.Uy)(e,(e=>{!function(e,t){const{regPanels:s,webPanels:n,barVisible:i}=t,a=n.map((e=>({...e}))),o=new Map(a.map((e=>[e.id,!0])));e.regPanelList=s.map((e=>({...e}))),e.webPanelList=a,e.webPanelMap=o,e.previousPanelBarVisible=i,e.changeReason=""}(e,t.state)}));case"PANEL_ADDED":if(t.showContent&&i.ZP.isWebPanel(t.panelId)){const s=(0,f.Uy)(e,(e=>{!function(e,t,s){e.windowData.get(t)&&(_({draft:e,winId:t,panelId:s}),e.changeReason="")}(e,t.winId,t.panelId)}));return D(s,t.winId),s}break;case"PANEL_TAB_REPLACED":return(0,f.Uy)(e,(e=>{const s=e.webPanelList.findIndex((e=>e.id===t.panelId));if(-1===s)return;const n=e.webPanelList[s];n.tabId=t.addedTabId,e.webPanelList[s]=n,e.changeReason="tabIdReplaced"}));case"PANEL_REMOVED":{const s=(0,f.Uy)(e,(e=>{!function(e,t,s){e.windowData.forEach((n=>{if(n.selectedPanel===s){const a=i.ZP.getPanelList().filter((e=>{M.canRender({winId:t,panelId:e})}));let o;if(a.length>1){const e=a.findIndex((e=>e===s));-1!==e&&(o=a[e+(e===a.length-1?-1:1)])}o?n.contentVisible?_({draft:e,winId:t,panelId:s}):n.selectedPanel=o:(n.selectedPanel=void 0,n.contentVisible=!1,e.previousPanelBarVisible=n.barVisible)}e.changeReason=""}))}(e,t.winId,t.panelId)}));return D(s,t.winId),s}case"PANEL_SET_CONTENT_VISIBLE":{const{winId:s,visible:n}=t,i=(0,f.Uy)(e,(e=>{S({draft:e,winId:s,visible:n})}));return D(i,s),i}case"PANEL_SET_FOCUS":return(0,f.Uy)(e,(e=>{Z(e,t.winId)}));case"PANEL_TOGGLE_CURRENT":{const s=(0,f.Uy)(e,(e=>{!function(e,t){const s=e.windowData.get(t)?.selectedPanel||M.getFirstAvailablePanel(t);s&&(_({draft:e,winId:t,panelId:s}),e.changeReason="")}(e,t.winId)}));return D(s,t.winId),s}case"PANEL_TOGGLE_FLOATING":o.Z.toggle(m.kPanelsAsOverlayEnabled,!0,!1);break;case"PANEL_SET_MUTED":return(0,f.Uy)(e,(e=>{!function(e){const{draft:t,winId:s,panelId:n,muted:i}=e,a=t.windowData.get(s);a&&(a.mutedMap.set(n,i),t.changeReason="")}({draft:e,winId:t.winId,panelId:t.panelId,muted:t.muted})}));case"PANEL_SET_RESIZABLE":{const{panelId:s,resizable:n}=t,i=(0,f.Uy)(e,(e=>{!function(e){const{draft:t,panelId:s,resizable:n}=e;if(M.getIsWebPanel(s)){const e=t.webPanelList.findIndex((e=>e.id===s));if(-1!==e){const s=t.webPanelList[e];s.resizable=n,s.resizable||(s.width=-1),t.webPanelList[e]=s}}else{const e=t.regPanelList.findIndex((e=>e.id===s));if(-1!==e){const s=t.regPanelList[e];s.resizable=n,s.resizable||(s.width=-1),t.regPanelList[e]=s}}t.changeReason=""}({draft:e,panelId:s,resizable:n})}));return this.getIsWebPanel(s)?o.Z.set(m.kPanelsWebElements,i.webPanelList):o.Z.set(m.kPanelsElements,i.regPanelList),i}case"PANEL_SET_REG_PANELS":return function(e,t){let s=e.previousPanelBarVisible;const n=new Map(Array.from(e.windowData).map((([e,t])=>(t.selectedPanel&&!M.canRender({winId:e,windowData:t,panelId:t.selectedPanel})&&(t.selectedPanel=void 0,t.contentVisible=!1,s=t.barVisible),[e,t]))));return{...e,regPanelList:t,windowData:n,changeReason:"",previousPanelBarVisible:s}}(e,t.list);case"PANEL_SET_WEB_PANELS":return function(e,t){const s=new Map(t.map((e=>[e.id,!0])));let n=e.previousPanelBarVisible;const i=new Map(Array.from(e.windowData).map((([e,t])=>(t.selectedPanel&&!M.canRender({windowData:t,panelId:t.selectedPanel,winId:e})&&(t.selectedPanel=void 0,t.contentVisible=!1,n=t.barVisible),[e,t]))));return{...e,changeReason:"",webPanelList:t,webPanelMap:s,previousPanelBarVisible:n,windowData:i}}(e,t.list);case"PANEL_SET_WIDTH":{const{winId:s,panelId:n,width:i}=t,a=(0,f.Uy)(e,(e=>{!function(e){const{winId:t,panelId:s,width:n,draft:i}=e;if(M.getIsWebPanel(s)){const e=i.webPanelList.find((e=>e.id===s));e&&e?.width!==n&&(e.width=n)}else{const e=i.regPanelList.find((e=>e.id===s));e&&e?.width!==n&&(e.width=n)}if(!M.getResizableByPanel(s)){const e=i.windowData.get(t);if(!e)return;e.expandedWidth=n}i.changeReason=""}({draft:e,winId:s,panelId:n,width:i})}));return D(a,s),M.getIsWebPanel(n)?o.Z.set(m.kPanelsWebElements,a.webPanelList):o.Z.set(m.kPanelsElements,a.regPanelList),a}case"PANEL_REMOVE_FOCUS":return(0,f.Uy)(e,(e=>{const s=e.windowData.get(t.winId);s&&(s.focusContent=!1,e.changeReason="")}));case"PANEL_SHOW_NEXT":{const{winId:s,direction:n}=t,i=(0,f.Uy)(e,(e=>{!function(e){const{draft:t,winId:s,direction:n}=e,i=t.windowData?.get(s);if(!i)return;if(!i.contentVisible)return void Z(t,i.winId);const a=M.getNextPanel(s,n);a&&(_({draft:t,winId:s,panelId:a}),t.changeReason="")}({draft:e,winId:s,direction:n})}));return D(i,s),i}case"PANEL_SHOW_CONTENT":{const{setFocus:s,selectId:n,panelId:i,winId:a,reason:o}=t;return(0,f.Uy)(e,(e=>{T({draft:e,setFocus:s,selectId:n,panelId:i,winId:a,reason:o})}))}case"PANEL_TOGGLE_CONTENT":{const{winId:s,panelId:n}=t,i=(0,f.Uy)(e,(e=>{_({draft:e,winId:s,panelId:n})}));return D(i,s),i}case"PANEL_CLEAR_TRANSITION_STATE":{const{winId:s,panelId:n}=t;return(0,f.Uy)(e,(e=>{!function(e){const{draft:t,winId:s,panelId:n}=e,i=t.windowData.get(s);i&&(i.transitionMap.has(n)&&i.transitionMap.delete(n),t.changeReason="")}({draft:e,winId:s,panelId:n})}))}case"PANEL_TOGGLE_PANEL":{const s=(0,f.Uy)(e,(e=>{E(e,t.winId)}));return D(s,t.winId),s}case"WINDOW_STATE_CHANGED":{const{oldState:s,change:n,windowId:i}=t;if("fullscreen"===s.state||"fullscreen"===n){const t=(0,c.TF)(s),a=(0,c.TF)({...s,state:n});if(t!==a){const t=(0,f.Uy)(e,(e=>{N({draft:e,winId:i,minimal:a})}));return r.Z.get(m.kStartupRememberFullScreen)&&D(t,i),t}}return e}case"WINDOW_MINIMAL_UI":{const s=(0,f.Uy)(e,(e=>{N({draft:e,winId:t.windowId,minimal:t.minimalUI})}));return D(s,t.windowId),s}case"WINDOW_SET_STATE":return e.windowData.has(t.windowId)?e:(0,f.Uy)(e,(e=>{let s=!1,n=r.Z.get(m.kPanelsWindowDefaults).selectedPanel;const a=c.ZP.getLastActiveBrowserWindowId();if(a){const e=M.getWindowData(a);e&&(s=e.contentVisible,n=e.selectedPanel)}!function(e,t){t.forEach((t=>{const s=i.ZP.panelInitWindow(t);s.selectedPanel&&!M.canRender({windowData:s,winId:s.winId,panelId:s.selectedPanel})&&(s.selectedPanel=M.getFirstAvailablePanel(s.winId,s)),e.windowData.set(s.winId,s)})),e.changeReason=""}(e,[i.ZP.getNewWindowSettings(t.windowId,t.windowExtData,s,n)]),e.changeReason=""}));case"WINDOW_CLOSED":return(0,f.Uy)(e,(e=>{e.windowData.delete(t.windowId),e.changeReason=""}));case"PAGE_OPEN":{const s=t.windowId;if(!t.activatedByChrome)return e;const i=n.ZP.getLastVisited(s),a=n.ZP.getActivePage(s);if(s&&i&&a&&function(e,t){const{windowData:s}=e,n=Boolean(s.get(t)?.contentVisible)||!s.get(t)?.contentVisible&&r.Z.get(m.kMailOpenPanelAutomaticallyViewingMail),i=r.Z.get(m.kPanelsAsOverlayEnabled)&&(!r.Z.get(m.kPanelsAsOverlayAutoClose)||!1===M.getSeparateFloating("PanelMail",t));return r.Z.get(m.kMailDisplayMailPanelViewingMail)&&(i&&n||!r.Z.get(m.kPanelsAsOverlayEnabled)&&n)}(e,s)){const t=(0,f.Uy)(e,(e=>{k({draft:e,windowId:s,leavePage:i,enterPage:a})}));return D(t,s),t}return e}case"PANEL_CLOSE":{const{panelId:s,winId:n}=t;if(e.previousPanelBarVisible){const t=(0,f.Uy)(e,(e=>{_({draft:e,winId:n,panelId:s})}));return D(t,n),t}{const t=(0,f.Uy)(e,(e=>{E(e,n)}));return D(t,n),t}}}return e}getIsMuted(e,t){return Boolean(this.getWindowData(e)?.mutedMap?.get(t))}shouldRestorePrevPanelState(e){const{draft:t=this.getState(),winId:s,isEnterPageMail:n,isLeavePageMail:i}=e,a=t.windowData.get(s);return i&&!n&&Boolean("PanelMail"===a?.selectedPanel&&a?.contentVisible&&a?.barVisible)}getWidth(e){const t=v+2*(0,g.mM)(),s=this.getWindowData(e);if(!s)return t+b;const n=c.ZP.getVisibleUI(e).panelToggle;if(!n||s.barVisible||s.contentVisible){if(n&&s.barVisible&&!s.contentVisible)return t+b;if(s.barVisible&&!s.contentVisible)return t;if(s.barVisible&&s.contentVisible){let e=s.expandedWidth;const t=s.selectedPanel;if(t&&this.getResizableByPanel(t)){const s=this.getWidthByPanel(t);s>0&&(e=s)}return e<=0?400:e}return 0}return b}getWidthByPanel(e){const{regPanelList:t,webPanelList:s}=this.getState();return[...t,...s].find((t=>t.id===e))?.width??-1}getFocusContent(e){return Boolean(this.getWindowData(e)?.focusContent)}getIsVisible(e,t){return Boolean(this.getWindowData(e)?.contentVisible)&&this.getWindowData(e)?.selectedPanel===t}getIsBarVisible(e){return Boolean(this.getWindowData(e)?.barVisible)}getFirstAvailablePanel(e,t=M.getWindowData(e)){const s=i.ZP.getPanelList();for(let n=0;n<s.length;n++){const i=s[n];if(M.canRender({windowData:t,winId:e,panelId:i}))return i}}getIsContentVisible(e){return Boolean(this.getWindowData(e)?.contentVisible)}getSelected(e){return this.getWindowData(e)?.selectedPanel}getSeparateFloating(e,t){return[...this.getWebPanels(t),...this.getRegPanels(t)].find((t=>t.id===e))?.floating??void 0}getOrderedWebPanels(e){const t=r.Z.get(m.kToolbarsPanel).filter((e=>i.ZP.isWebPanel(e))),s=M.getWebPanels(e),n=t.map((e=>s.find((t=>t.id===e)))).filter(Boolean);return s.forEach((e=>{n.some((t=>t.id===e.id))||(0,u.LM)(e.id,m.kToolbarsPanel)&&n.push(e)})),n}getNextPanel(e,t){const s=this.getWindowData(e);if(s){if(s.selectedPanel){const n=i.ZP.getPanelList().filter((t=>M.canRender({winId:e,panelId:t})));let a=n.indexOf(s.selectedPanel);if(-1!==a)return a+="next"===t?1:-1,n[(a+n.length)%n.length]}return M.getFirstAvailablePanel(e)}}getRegPanels(e){return this.getState().regPanelList.filter((t=>M.canRender({winId:e,panelId:t.id})))}getWebPanels(e){return this.getState().webPanelList.filter((t=>M.canRender({winId:e,panelId:t.id})))}getWebPanel(e,t){return M.getWebPanels(e).find((e=>e.id===t))}getIsWebPanel(e){return this.getState().webPanelMap.has(e)}hasWebPanel(e,t){return Boolean(M.getOrderedWebPanels(e)[t-1])}canRender(e){const{winId:t,windowData:s,panelId:n}=e;if(c.ZP.isGuest()&&!C.includes(n))return!1;if(i.ZP.isWebPanel(n))return(0,u.VJ)(n);if(w.includes(n)){if(!c.ZP.isMail(t)||!a.Z.isMailOn())return!1}else if(y.includes(n)){if(!c.ZP.isMail(t)||!a.Z.isFeedsOn())return!1}else if(x.includes(n)){if(!a.Z.isMailOn())return!1}else if(I.includes(n)){"PanelChat"===n&&d.Z.isEnabled("chat");return!1}return Boolean(s||this.getWindowData(t)||c.ZP.isSettings(t))}hasPanel(e,t){return!!M.canRender({winId:e,panelId:t})&&Boolean(r.Z.get(m.kToolbarsPanel).find((e=>e===t))||r.Z.get(m.kToolbarsNavigation).find((e=>e===t))||r.Z.get(m.kToolbarsStatus).find((e=>e===t))||r.Z.get(m.kToolbarsMail).find((e=>e===t)))}getChangeReason(){return this.getState().changeReason}getWindowData(e){return this.getState().windowData.get(e)}getMutedMap(e){return this.getWindowData(e)?.mutedMap}getResizableByPanel(e){const{regPanelList:t,webPanelList:s}=this.getState();for(let s=0;s<t.length;s++)if(t[s].id===e)return t[s].resizable;for(let t=0;t<s.length;t++)if(s[t].id===e)return s[t].resizable;return!1}canAutoOpen(e,t){return!(this.getSelected(e)===t&&this.getWidth(e)>50)}getTransitionState(e,t){return this.getWindowData(e)?.transitionMap.get(t)}}const M=new P;function D(e,t){const s=e.windowData.get(t);s&&(o.Z.set(m.kPanelsWindowDefaults,{barVisible:s.barVisible,selectedPanel:s.selectedPanel?s.selectedPanel:void 0,width:s.expandedWidth,contentVisible:s.contentVisible}),A(s.winId,{SHOW_PANEL:s.barVisible,SELECTED_PANEL:s.selectedPanel?s.selectedPanel:void 0,PANEL_WIDTH:s.expandedWidth,SHOW_PANEL_CONTENT:s.contentVisible}))}const O=M},32921:(e,t,s)=>{"use strict";s.d(t,{Z:()=>v,d:()=>r});var n=s(65398),i=s(14481),a=s(33638),o=s(93513);const r=e=>{const{lastAlarmTime:t,periodInMinutes:s,currentTime:n=Date.now()}=e,i=6e4*s;if(t){return t+i*Math.ceil((n-t)/i)}return n+i};let l,d=new Map;class c extends n.Z{getAlarmFromReloadId(e){return d.get(e)}existingAlarms(){return Boolean(d.size)}getPanelAlarms(){const e=[];for(const[t,s]of d)"panel"===s.from&&e.push([t,s]);return new Map(e)}dispatchAction(e){switch(e.actionType){case"PERIODIC_RELOAD_ALL":h(e.alarms);break;case"PERIODIC_RELOAD_CREATE":u(e.alarm);break;case"PAGE_CLOSE":e.pages.forEach((e=>{const t=e.vivExtData.ext_id;t&&p([t])}));break;case"PERIODIC_RELOAD_DESTROY":p(e.alarmIds);break;case"PERIODIC_RELOAD_UPDATE":d=(0,o.Uy)(d,(t=>{t.set(e.alarm.alarmId,e.alarm.alarm)}))}}}const h=e=>{d=(0,o.Uy)(d,(t=>{e.forEach(((e,s)=>{t.set(s,e)}))})),!l&&d.size&&(g(),m())},u=e=>{d=(0,o.Uy)(d,(t=>{t.set(e.alarmId,e.alarm)})),l||(g(),m())},p=e=>{d=(0,o.Uy)(d,(t=>{e.forEach((e=>t.delete(e)))}))},g=()=>{const e=Date.now(),t=[];d.forEach(((s,n)=>{const{scheduledTime:a,periodInMinutes:o,id:l,from:d}=s,c=(a-e)/6e4/o;if(c<=0){const s={id:l,scheduledTime:r({periodInMinutes:o,lastAlarmTime:a,currentTime:e}),periodInMinutes:o,from:d};t.push({type:"RELOAD",periodInMinutes:o,id:n}),i.Z.updateRunningAlarm(n,s)}else t.push({type:"TIME_CHANGED",periodInMinutes:o,remainingTime:c,id:n,from:d})})),f.emitChange(t)},m=()=>l=setInterval((()=>{if(0===d.size)return clearInterval(l),l=void 0,void f.emitChange([]);g()}),1e3),f=new c(a.Z),v=f},80342:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});var n=s(24602);class i extends n.Z{getInitialState(){return[]}getList(){return this.getState()}getUnreadCount(){return this.getState().filter((e=>!e.read)).length}getFilter(e){return this.getState().filter((t=>{const s=e.split(" "),{title:n,url:i}=t;return i.toLowerCase().includes(e.toLowerCase())||s.every((e=>n.toLowerCase().includes(e.toLowerCase())))}))}reduce(e,t){return"READING_LIST_UPDATE"===t.actionType?t.entries:e}}const a=new i},24602:(e,t,s)=>{"use strict";s.d(t,{Z:()=>o});var n=s(65398),i=s(33638);class a extends n.Z{constructor(e){super(e??i.Z),this._state=this.getInitialState(),this._wrappedListeners=new Map}getState(){return this._state}getInitialState(){throw new TypeError(`getInitialState() is not overwritten in ${this.constructor.name}`)}addListener(e,t){if(t){if(this._wrappedListeners.has(e))throw new Error(`addListener() in ${this.constructor.name} was called with a listener that was already added as a callback. Use ensureAddedListener() if this was intentional.`);let s;const n=()=>{const n=t(this.getState());n!==s&&e(),s=n};this._wrappedListeners.set(e,n),super.addListener(n)}else super.addListener(e)}removeListener(e){const t=this._wrappedListeners.get(e);t?(this._wrappedListeners.delete(e),super.removeListener(t)):super.removeListener(e)}ensureRemovedListener(e){const t=this._wrappedListeners.get(e);t?(this._wrappedListeners.delete(e),super.ensureRemovedListener(t)):super.ensureRemovedListener(e)}reduce(e,t){throw new TypeError(`reduce() is not overwritten in ${this.constructor.name}`)}dispatchAction(e){const t=this._state,s=this.reduce(t,e);if(void 0===s)throw new Error(`reduce() in ${this.constructor.name} returned undefined, did you forget to return the state in the default case?`);s!==t&&(this._state=s,this.emitChange())}}const o=a},81538:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});const n=new Map},18237:(e,t,s)=>{"use strict";s.d(t,{AP:()=>l,ZP:()=>g,iq:()=>r,m8:()=>o});var n=s(65398),i=s(33638),a=s(93513);const o="vivaldi/x-session",r="vivaldi/x-session-history",l="vivaldi/x-session-content",d=3e5;let c={items:[],rootId:0,autosaveId:0,trashId:0},h={opening:!1,workspaceAsTabs:!1,persistentTabs:!1,workspaceMap:new Map,groupIdMap:new Map,groupNameMap:new Map};class u extends n.Z{backupId=null;backupSumTick=0;sessionRecovery=!1;getAll(){return c.items}hasSessions(){const e=p.getAll();return e.length>1||Boolean(e[0]?.children?.length)}getFiltered(e){const t=e.toLowerCase().trim();if(!t)return p.getAll();const s=t.toLowerCase().split(" "),n=[];return p.getAll().forEach((e=>{let t=!1;if(e.name){const n=e.name.toLowerCase();t=s.every((e=>n.includes(e)))}t&&n.push(e)})),n}getById(e){const t=function(s){for(let n=0;n<s.length;n++){const i=s[n];if(i.id===e)return{index:n,item:i};if(i.children){const e=t(i.children);if(e)return e}}};return t(c.items)}isTrash(e,t){if(e===c.trashId)return t;let s=p.getById(e);for(;s;){if(s.item.id===c.trashId)return!0;s=p.getById(s.item.parentId)}return!1}isTrashFolder(e){return e===c.trashId}isAutoSaveNode(e){return e===c.autosaveId}isHistoryParent(e){const t=p.getById(e);return"node"===t?.item.type&&Boolean(t?.item.children)}isHistoryChild(e){return"history"===p.getById(e)?.item.type}inSessionRecovery(){return this.sessionRecovery}getRootId(){return c.rootId}getAutoSaveId(){return c.autosaveId}getTrashId(){return c.trashId}getTitle=e=>p.getById(e)?.item.name??"";getWorkspace(e){const t=function(s){for(let n=0;n<s.length;n++){const i=s[n],a=i.workspaces.find((t=>t.id===e));if(a)return a;if(i.children){const e=t(i.children);if(e)return e}}};return t(c.items)}getIsLoading(){return h.opening}getLoadWorkspaceId(e){return h.workspaceMap.get(e)}getLoadGroup(e,t){if(h.opening){let s="";if(h.groupIdMap.has(t)?s=h.groupIdMap.get(t)??"":(s=crypto.randomUUID(),h.groupIdMap.set(t,s)),h.groupNameMap.has(t)){const n=h.groupNameMap.get(t)?.name??"";h.groupNameMap.set(s,{windowId:e,name:n}),h.groupNameMap.delete(t)}return s}return""}getLoadGroupNameMap(){return h.groupNameMap}getLoadWorkspaceAsTabs(){return h.workspaceAsTabs}getLoadPersistentTabs(){return h.persistentTabs}dispatchAction(e){function t(e,t,s){const n=(e,t,s)=>{for(let i=0;i<e.length;i++)if(e[i].children){if(e[i].id===t)return s>e[i].children.length?void 0:{items:e[i].children,index:s,id:t};const a=n(e[i].children,t,s);if(a)return a}};return t===c.rootId?s>e.length?void 0:{items:e,index:s,id:t}:n(e,t,s)}const s=(e,t,s)=>{const n=(e,t,s)=>{for(let i=0;i<e.length;i++){if(e[i].id===t&&"node"===e[i].type)return s&&void 0===e[i].children?e[i].children=[]:s||void 0===e[i].children||delete e[i].children,!0;if(e[i].children){const a=n(e[i].children,t,s);if(a)return a}}return!1};return t===c.rootId?void 0:n(e,t,s)},n=e=>{e&&null===this.backupId?(this.backupSumTick=0,this.backupId=setTimeout(o,d)):null!==this.backupId&&(clearTimeout(this.backupId),this.backupSumTick=0,this.backupId=null)},i=e=>{this.sessionRecovery=e},o=()=>{this.backupSumTick+=d,this.backupSumTick>=36e5?(this.backupSumTick=0,p.emitChange({reason:"autosave"})):p.emitChange({reason:"backup"}),this.backupId=setTimeout(o,d)};switch(e.actionType){case"SESSION_INIT":c=(0,a.Uy)(c,(t=>{t.rootId=e.model.rootId,t.autosaveId=e.model.autosaveId,t.trashId=e.model.trashId,e.model.items.forEach((e=>{t.items.push(e)}))})),e.backup&&n(!0),p.emitChange({reason:"init"});break;case"SESSION_ADDED":{let n;c=(0,a.Uy)(c,(i=>{s(i.items,e.parentId,!0);const a=t(i.items,e.parentId,e.index);a&&(a.items.splice(a.index,0,e.item),n={index:a.index,item:a.items[a.index]})})),n&&p.emitChange({reason:"added",info:n,owner:e.owner});break}case"SESSION_CHANGED":{const s=p.getById(e.id);if(s){let n;c=(0,a.Uy)(c,(i=>{const a=t(i.items,s.item.parentId,s.index);if(a){const t={...e.item,content:a.items[a.index].content};a.items.splice(a.index,1,t),n={index:a.index,item:a.items[a.index]}}})),n&&p.emitChange({reason:"changed",info:n})}break}case"SESSION_CONTENT":const o=p.getById(e.id);if(o){let s;c=(0,a.Uy)(c,(n=>{const i=t(n.items,o.item.parentId,o.index);if(i){const t={...i.items[i.index],content:e.content};i.items.splice(i.index,1,t),s={index:i.index,item:i.items[i.index]}}})),s&&p.emitChange({reason:"content",info:s,owner:e.owner})}break;case"SESSION_DELETED":{const s=p.getById(e.id);if(s){let e;c=(0,a.Uy)(c,(n=>{const i=t(n.items,s.item.parentId,s.index);i&&(e={index:i.index,item:{...i.items[i.index]}},i.items.splice(i.index,1))})),e&&p.emitChange({reason:"deleted",info:e})}break}case"SESSION_MOVED":{const n=p.getById(e.id);if(n){let i;c=(0,a.Uy)(c,(a=>{s(a.items,e.parentId,!0);const o=t(a.items,n.item.parentId,n.index),r=t(a.items,e.parentId,e.index);r&&o&&(i={index:r.index,item:e.item},o.items.splice(o.index,1),r.items.splice(r.index,0,i.item),0===o.items.length&&s(a.items,n.item.parentId,!1))})),i&&p.emitChange({reason:"moved",info:i})}break}case"SESSION_SET_TIMED_BACKUP":n(e.backup);break;case"SESSION_SET_LOADING_PARAMETERS":h={opening:e.opening,workspaceAsTabs:e.workspaceAsTabs,persistentTabs:e.persistentTabs,workspaceMap:new Map(e.workspaceMap),groupIdMap:new Map,groupNameMap:new Map(e.groupNameMap)};break;case"SESSION_RECOVERY_DONE":i(!1);break;case"SESSION_RECOVERY_START":i(!0)}}}const p=new u(i.Z),g=p},37330:(e,t,s)=>{"use strict";s.d(t,{Z:()=>S});var n=s(65792),i=s.n(n),a=s(93197),o=s(96951),r=s(29087),l=s(24602),d=s(2699),c=s(9304),h=s(15489),u=s(25372),p=s(25356),g=s(89175),m=s(93513),f=s(44850);const v=new Map,b=[],C=new Set,w=["colorFg","colorBg","colorHighlightBg","colorAccentBg"];function y(e){if(e.preferSystemAccent&&i().valid(r.Z.get(g.kSystemAccentColor))){const t={...e};return t.colorHighlightBg=r.Z.get(g.kSystemAccentColor),c.ZP.createStyle(t)}return c.ZP.createStyle(e)}function x(e,t,s){const n=i().contrast(e,t)>s?50:0,a=e.get("lch.l")>5&&e.get("lch.l")<95?50:0;let o=e.get("lch.c")>10?50:0;return(e.get("lch.l")<20||e.get("lch.l")>75)&&(o=e.get("lch.c")>50?o:0),n+a+o}function I(e,t,s,n,r=!1){const l=i()(s.colorFg),d=i()(s.colorBg),c=function(e,t,s){let n;if(t.accentFromPage&&e){n=function(e,t){const s=t?.favIconUrl||"",n=t?.url||"";if(!t||C.has(n)||f.jk.isInternalPage(t)||s.startsWith("chrome://favicon/"))return i()(e.colorAccentBg);const a=e.accentSaturationLimit,o=new Map,r=b.find((e=>e.favIconUrl===s))||b.find((e=>n.includes(e.hostname))),l=v.get(t.id);l&&o.set(l,3),r?.colors.forEach(((e,t)=>{switch(t){case 0:o.set(e,2.25);break;case 1:o.set(e,1.5);break;case 2:o.set(e,1.25);break;default:o.set(e,1)}}));const d=[...o.keys()];o.size>2&&d[0].get("lch.c")<1&&d.forEach((e=>{e.get("lch.c")>1&&o.set(e,2)}));const c=i()(e.colorBg),h=[...o].sort(((t,s)=>x(s[0],c,e.contrast)*s[1]-x(t[0],c,e.contrast)*t[1]));return h.length>0&&a<1&&h[0][0].get("hsl.s")>a&&(h[0][0]=h[0][0].set("hsl.s",a)),h[0]&&h[0][0]||i()(e.colorAccentBg)}(t,s||o.ZP.getActivePage(e))}else n=i()(t.colorAccentBg);if(t.accentSaturationLimit<1){const e=n.get("hsl.s");n=n.set("hsl.s",e*t.accentSaturationLimit)}return n}(t,s,n),h=r&&c!==s.colorAccentBg,u={...a.ZP.accentOnly(c,l,d,s.contrast,h)};Object.keys(u).forEach((t=>{e[`--${t}`]=u[t].toString()}))}class A extends l.Z{#Zn=void 0;getInitialState(){return{windowStyles:new Map,theme:{engineVersion:1,version:1,id:"Vivaldi1",url:"",name:"Vivaldi",accentFromPage:!0,accentOnWindow:!0,accentSaturationLimit:1,backgroundImage:"",backgroundPosition:"stretch",radius:4,colorAccentBg:"#ef3939",colorBg:"#f6f6f6",colorFg:"#222222",colorHighlightBg:"#4c70f0",colorWindowBg:"#EDEEF2",contrast:0,preferSystemAccent:!1,alpha:.92,blur:5,transparencyTabs:!1,transparencyTabBar:!1}}}getBaseStylesByWindowId=(e,t)=>{const s=this.getState().windowStyles.get(e)||c.ZP.getFallbackStyle();return s?this.getBaseStylesByStyle(s,t):{}};getReaderThemeColor(e){let t;switch(r.Z.get(g.kWebpagesReaderStyle).themeStyle){case"light":t="Vivaldi1";break;case"dark":t="Vivaldi2";break;default:t=void 0}return t?this.getBaseStylesByThemeId(t):this.getBaseStylesByWindowId(e)}getBaseStylesByThemeId=(e,t)=>{const s=c.ZP.getTheme(e),n=s?c.ZP.createStyle(s):null;return n?this.getBaseStylesByStyle(n,t):{}};getBaseStylesByStyle=(e,t)=>{const s=t&&t.length>0?t:w,n={};for(const[t,i]of Object.entries(e))s.includes(t.replace("--",""))&&i&&(n[t]=i);return t?.includes("backgroundBlur")&&void 0===n["--backgroundBlur"]&&(n["--backgroundBlur"]="none"),n};getThemeImageSet=e=>{if(e){const t=c.ZP.getTheme(e)?.buttons;if(t)return t}return this.getState().theme.buttons};getToolbarButtonImage=e=>{if(!r.Z.get(g.kThemesPreferCustomButtons))return null;const t=r.Z.get(g.kThemesPreview)[0]?"":r.Z.get(g.kThemesCurrentButtons),s=this.getThemeImageSet(t);return s&&s[e]?"string"==typeof s[e]?s[e]:s[e].large:null};hasDarkBackground=e=>{const t=this.getBaseStylesByWindowId(e,["colorBg"]);return c.ZP.isThemeDark(t)};reduce(e,t){if("THEME_WINDOW_CREATED"===t.actionType)return(0,m.Uy)(e,(s=>{const{windowId:n}=t,{theme:i}=e,a=y(i);Object.assign(a,t.style),I(a,n,i),s.windowStyles.set(n,a)}));if("WINDOW_CLOSED"===t.actionType)return(0,m.Uy)(e,(e=>{e.windowStyles.delete(t.windowId)}));if("THEME_SET"===t.actionType)return(0,m.Uy)(e,(e=>{const{theme:s,init:n}=t;e.theme=s,n&&(e.windowStyles=new Map(Array.from(h.ZP.getState()).map((([e])=>[e,{}]))));const i=y(s);e.windowStyles.forEach(((e,n)=>{Object.assign(e,i),Object.keys(e).forEach((t=>{i.hasOwnProperty(t)||delete e[t]})),Object.assign(e,t.style),I(e,n,s)}))}));if("PAGE_OPEN"===t.actionType||"PAGE_OPEN_URL"===t.actionType||"NAVIGATION_SET_STATE"===t.actionType){const{windowId:s,pageId:n}=t,i=o.ZP.getPageById(n);if(s===this.#Zn)this.#Zn=void 0;else if(!i?.active)return e;return(0,m.Uy)(e,(t=>{const{theme:n}=e,a=t.windowStyles.get(s);if(a&&i){const e=n.accentFromPage&&n.accentOnWindow;I(a,s,n,i,e)}}))}if("THEME_SET_META"===t.actionType)return v.get(t.tabId)?.hex()!==t.color.hex()&&v.set(t.tabId,t.color),(0,m.Uy)(e,(t=>{t.windowStyles.forEach(((t,s)=>{const{theme:n}=e;I(t,s,n,null,!0)}))}));if("THEME_SET_FAILED_FAVICON_URL"===t.actionType)return C.has(t.url)||C.add(t.url),(0,m.Uy)(e,(t=>{t.windowStyles.forEach(((t,s)=>{const{theme:n}=e;I(t,s,n)}))}));if("THEME_SET_PAGE_PALETTE"===t.actionType){const{windowId:s,favIconUrl:n,hostname:i,colors:a}=t;return b.push({favIconUrl:n,hostname:i,colors:a}),(0,m.Uy)(e,(t=>{const n=t.windowStyles.get(s),{theme:i}=e;n&&I(n,s,i,null,!0)}))}if("CHROME_TABS_CREATE"===t.actionType||"CHROME_TABS_UPDATED"===t.actionType){const s="CHROME_TABS_CREATE"===t.actionType?t.page:o.ZP.getPageById(t.tabId),n=t.windowId,i=s?.favIconUrl,a=s?.url,r=Boolean(i&&!i.startsWith("chrome://favicon/")&&b.find((e=>e.favIconUrl===i)));if(!Boolean(!s||!a||C.has(a)||f.jk.isInternalPage(s)||r||s.incognito)&&s&&a){const t=(0,u.Z)((0,p.Z)(a))?.hostname;if(t&&n&&i){if(b.find((e=>e.hostname===t)))return d.Z.loadFavicon(s,t),(0,m.Uy)(e,(t=>{const s=t.windowStyles.get(n),{theme:i}=e;s&&I(s,n,i)}));d.Z.loadFavicon(s,t)}}}return"CHROME_TABS_REMOVED"===t.actionType&&(this.#Zn=t.removeInfo.windowId),"ZOOM_SET_UI"===t.actionType?(0,m.Uy)(e,(e=>{e.windowStyles.forEach(((s,n)=>{s["--uiZoomLevel"]=t.zoomData,e.windowStyles.set(n,s)}))})):e}}const S=new A},97297:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});var n=s(24602);class i extends n.Z{getInitialState(){return""}reduce(e,t){switch(t.actionType){case"TOOLBAR_EDIT_MODE":return t.toolbar;case"TOOLBAR_STOP_EDIT_MODE":return"";default:return e}}}const a=new i},85374:(e,t,s)=>{"use strict";s.d(t,{ZP:()=>l});var n=s(24602),i=s(48588);const a=Object.freeze({pageLanguage:"",translateStep:"idle"});class o extends n.Z{getInitialState(){return new Map}getPageState(e){return this.getState().get(e)??a}reduce(e,t){switch(t.actionType){case"VIVALDI_TABS_LANGUAGE_DETERMINED":{const{tabId:s,pageLanguage:n}=t;return r(e,s,{pageLanguage:n})}case"VIVALDI_TABS_PAGE_TRANSLATED":{const{tabId:s}=t;let{isTranslated:n,originalLang:i,translatedLang:a,error:o}=t.message;return n&&"no_error"!==o&&(n=!1),r(e,s,{isTranslated:n,originalLang:i,translatedLang:a,error:o})}case"PAGE_CLOSE":{const s=t.pages;return s.some((t=>e.has(t.id)))&&(e=new Map(e),s.forEach((t=>e.delete(t.id)))),e}case"PAGE_RESET_TRANSLATION_PARAMETERS":return(0,i.u4)(e,t.tabId);case"VIVALDI_TABS_PAGE_TRANSLATED_REVERT":{const{tabId:s}=t;return r(e,s,{isTranslated:!1})}case"VIVALDI_TABS_TRANSLATION_PROGRESS":{const{tabId:s,translateStep:n,error:i,autoTranslate:a}=t;return r(e,s,{translateStep:n,error:i,autoTranslate:a})}default:return e}}}function r(e,t,s){return(0,i.cR)(e,t,(e=>{Object.assign(e,s)}),a)}const l=new o},63365:(e,t,s)=>{"use strict";s.d(t,{Z:()=>o});var n=s(65398),i=s(33638);class a extends n.Z{_trash=[];getTrash(){return this._trash}isEmpty(){return 0===this._trash.length}dispatchAction(e){if("CHROME_SET_SESSION"===e.actionType)this._trash=e.session,this.emitChange()}}const o=new a(i.Z)},57904:(e,t,s)=>{"use strict";s.d(t,{Z:()=>l});var n=s(65398),i=s(33638);const a={},o={};class r extends n.Z{isFindInPageOpen(e){return!0===a[e]}getFindResultsForPage(e){let t=o[e];return void 0===t&&(t={activeMatchOrdinal:0,numberOfMatches:0,searchText:"",canceled:!1,matchCase:!1,isFindInPageToolbarOpen:!1,selectionRect:{left:0,top:0,width:0,height:0}}),t.isFindInPageToolbarOpen=!0===a[e],t}dispatchAction(e){switch(e.actionType){case"WEBPAGEVIEW_ACTIONS":switch(e.subAction){case"findInPage":a[e.pageId]=!0,this.emitChange({type:"WEBPAGEVIEW_ACTIONS",action:"findInPage",winId:e.windowId,pageId:e.pageId});break;case"findNextInPage":case"findPreviousInPage":{const{subAction:t}=e;!0!==a[e.pageId]&&(a[e.pageId]=!0,this.emitChange({type:"WEBPAGEVIEW_ACTIONS",action:"findInPage",winId:e.windowId,pageId:e.pageId})),this.emitChange({type:"WEBPAGEVIEW_ACTIONS",action:t,winId:e.windowId,pageId:e.pageId});break}case"addBookmark":case"focusAddressField":case"pageScrollBottom":case"pageScrollDown":case"pageScrollTop":case"pageScrollUp":case"print":this.emitChange({type:"WEBPAGEVIEW_ACTIONS",action:e.subAction,winId:e.windowId,pageId:e.pageId});break;case"focusSearchField":this.emitChange({type:"WEBPAGEVIEW_URLFIELD_BLUR",winId:e.windowId}),this.emitChange({type:"WEBPAGEVIEW_ACTIONS",action:"focusSearchField",winId:e.windowId,pageId:e.pageId});break;case"focusWebView":this.emitChange({type:"WEBPAGEVIEW_URLFIELD_BLUR",winId:e.windowId}),this.emitChange({type:"WEBPAGEVIEW_ACTIONS",action:"focusWebView",winId:e.windowId,pageId:e.pageId});break;case"searchPasteAndGo":case"urlPasteAndGo":case"qcPasteAndGo":e.payload&&this.emitChange({type:"WEBPAGEVIEW_ACTIONS",action:e.subAction,winId:e.windowId,pageId:e.pageId,payload:e.payload})}break;case"WEBPAGEVIEW_BACK":case"WEBPAGEVIEW_FORWARD":case"WEBPAGEVIEW_STOP":this.emitChange({type:e.actionType,winId:e.windowId,pageId:e.pageId});break;case"WEBPAGEVIEW_CLOSE_FIND_IN_PAGE":a[e.pageId]&&(a[e.pageId]=!1,this.emitChange({type:"WEBPAGEVIEW_CLOSE_FIND_IN_PAGE",winId:e.windowId,pageId:e.pageId}));break;case"WEBPAGEVIEW_GET_HISTORY":this.emitChange({type:"WEBPAGEVIEW_GET_HISTORY",winId:e.windowId,pageId:e.pageId,callback:e.callback});break;case"WEBPAGEVIEW_GO":this.emitChange({type:"WEBPAGEVIEW_GO",winId:e.windowId,pageId:e.pageId,index:e.index});break;case"WEBPAGEVIEW_RELOAD":this.emitChange({type:e.actionType,winId:e.windowId,pageId:e.pageId,bypassCache:e.bypassCache});break;case"WEBPAGEVIEW_RESULTS_FROM_FIND_IN_PAGE":a[e.pageId]&&(o[e.pageId]={...e.results,matchCase:e.matchCase,searchText:e.searchText,isFindInPageToolbarOpen:!1},this.emitChange({type:"WEBPAGEVIEW_RESULTS_FROM_FIND_IN_PAGE",winId:e.windowId,pageId:e.pageId}));break;case"MAIN_SHOW_QUICKCOMMANDS":case"PANEL_SET_FOCUS":this.emitChange({type:"WEBPAGEVIEW_URLFIELD_BLUR",winId:e.winId})}}}const l=new r(i.Z)},15489:(e,t,s)=>{"use strict";s.d(t,{Ex:()=>c,TF:()=>u,WV:()=>v,ZP:()=>f});var n=s(29087),i=s(24602),a=s(33638),o=s(34540),r=(s(7064),s(89175)),l=s(48588),d=s(93513);s(38768);const c=-1,h=[];function u(e){if(!e)return!1;const{state:t,minimalUI:s}=e;return s||"fullscreen"===t}class p extends i.Z{settingsCategory="general&";getInitialState(){return new Map}_updateUIState(e,t){const s=u(this.getState().get(e)),i=u(t);s&&!i?t.visibleUI=this.getUIFromPrefs():!s&&i&&(t.visibleUI={bookmarksBar:!1,addressBar:!1,panelToggle:!1,tabs:!1,statusBar:n.Z.get(r.kStatusBarMinimized)}),this.ensureControlButtonsInProperPosition(e,t)}reduce(e,t){switch(t.actionType){case"WINDOW_SET_STATE":return(0,d.Uy)(e,(e=>{const{windowId:s,windowState:n}=t;e.set(s,n),this.ensureControlButtonsInProperPosition(s,n)}));case"WINDOW_CLOSED":return(0,l.u4)(e,t.windowId);case"WINDOW_UPDATE_FROM_PREFS":{const{windowId:s}=t,n=e.get(t.windowId);return u(n)?(n&&this.ensureControlButtonsInProperPosition(s,n),e):(0,l.cR)(e,s,(e=>{e.visibleUI=this.getUIFromPrefs(),this.ensureControlButtonsInProperPosition(s,e)}))}case"WINDOW_ACTIVATED":{const{windowId:s,activated:n}=t;n&&this.initializingWindowId&&(this.initializingWindowId=void 0);const i=e.get(s);return i&&i.active!==n?new Map(e).set(s,{...i,active:n}):e}case"WINDOW_STATE_CHANGED":return(0,l.cR)(e,t.windowId,(e=>{const{windowId:s,change:n}=t;"fullscreen"===e.state&&"fullscreen"!==n&&(e.html5FullScreen=!1),e.state&&"fullscreen"!==e.state&&"fullscreen"===n&&(e.restoreStateFullscreen=e.state),e.state=n,this._updateUIState(s,e)}));case"WINDOW_HTML5_FULL_SCREEN":return(0,l.cR)(e,t.windowId,(e=>{const{windowId:s,html5FullScreen:n}=t;n?(e.restoreStateHtml5Fullscreen=e.state?e.state:"normal",e.state="fullscreen"):e.state=e.restoreStateHtml5Fullscreen,e.html5FullScreen=n,this._updateUIState(s,e)}));case"WINDOW_MINIMAL_UI":return(0,l.cR)(e,t.windowId,(e=>{e.minimalUI=t.minimalUI,this._updateUIState(t.windowId,e)}));case"WINDOW_TOGGLE_BOOKMARKS_BAR":return u(e.get(t.windowId))?(0,l.cR)(e,t.windowId,(e=>{e.visibleUI.bookmarksBar=!e.visibleUI.bookmarksBar,this.ensureControlButtonsInProperPosition(t.windowId,e)})):(console.warn("Attempting to toggle toolbars for a window without minimal UI"),e);case"WINDOW_TOGGLE_ADDRESS_BAR":return u(e.get(t.windowId))?(0,l.cR)(e,t.windowId,(e=>{e.visibleUI.addressBar=!e.visibleUI.addressBar,this.ensureControlButtonsInProperPosition(t.windowId,e)})):(console.warn("Attempting to toggle toolbars for a window without minimal UI"),e);case"WINDOW_TOGGLE_TABS":return u(e.get(t.windowId))?(0,l.cR)(e,t.windowId,(e=>{e.visibleUI.tabs=!e.visibleUI.tabs,this.ensureControlButtonsInProperPosition(t.windowId,e)})):(console.warn("Attempting to toggle toolbars for a window without minimal UI"),e);case"WINDOW_TOGGLE_PANEL_TOGGLE":return u(e.get(t.windowId))?(0,l.cR)(e,t.windowId,(e=>{e.visibleUI.panelToggle=!e.visibleUI.panelToggle})):(console.warn("Attempting to toggle toolbars for a window without minimal UI"),e);case"WINDOW_TOGGLE_STATUS_BAR":return u(e.get(t.windowId))?(0,l.cR)(e,t.windowId,(e=>{e.visibleUI.statusBar="on"===e.visibleUI.statusBar?n.Z.get(r.kStatusBarMinimized):"on"})):(console.warn("Attempting to toggle toolbars for a window without minimal UI"),e);case"WINDOW_SET_INERT":const s=t.inert||!1;return(0,l.cR)(e,t.windowId,(e=>{e.inert=s}));case"WINDOW_PANEL_HAS_BEEN_VISIBLE":return(0,l.cR)(e,t.windowId,(e=>{e.hasPanelBeenVisible||(e.hasPanelBeenVisible=new Set),t.visible?e.hasPanelBeenVisible.add(t.panelId):e.hasPanelBeenVisible.delete(t.panelId)}))}return e}getWindowState(e){return this.getState().get(e)}getActiveWindowId(){for(const[e,t]of this.getState())if(t.active)return e;return c}getIds(e){const t=[];for(const[s,n]of this.getState())n.type===e&&t.push(s);return t}getLastActiveBrowserWindowId(){return 0===h.length?c:h[0]}isFullscreen(e){return"fullscreen"===this.getState().get(e)?.state}isHTML5Fullscreen(e){return this.getState().get(e)?.html5FullScreen||!1}isIncognito(e){return this.getState().get(e)?.incognito||!1}isMaximized(e){return"maximized"===this.getState().get(e)?.state}isMinimized(e){return"minimized"===this.getState().get(e)?.state}isActive(e){return this.getState().get(e)?.active||!1}isInert(e){return this.getState().get(e)?.inert||!1}isPopup(e){return"popup"===this.getState().get(e)?.type}isSettings(e){return"settings"===this.getState().get(e)?.type}isTabbedBrowser(e){return"normal"===this.getState().get(e)?.type}isMinimalUI(e){return u(this.getState().get(e))}getMailWindowId(){let e=c;for(const[t]of this.getState())(e===c||t<e)&&this.isTabbedBrowser(t)&&!this.isIncognitoOrGuest(t)&&(e=t);return e}isMail(e){return this.getMailWindowId()===e}isGuest(){if(void 0===window.isGuestSession)throw new Error("WindowStore.isGuest() called before guest information has been set up");return window.isGuestSession}getVisibleUI(e){const t=this.getState().get(e);return t?t.visibleUI:this.getUIFromPrefs()}isIncognitoOrGuest(e){return this.isIncognito(e)||this.isGuest()}getRestoreStateFullscreen(e){const t=this.getState().get(e);if(!t)throw new Error("WindowStore.getRestoreStateFullscreen: Expected a valid windowId");return t.restoreStateFullscreen}getRestoreStateHtml5Fullscreen(e){const t=this.getState().get(e);if(!t)throw new Error("WindowStore.getRestoreStateHtml5Fullscreen: Expected a valid windowId");return t.restoreStateHtml5Fullscreen}getUIFromPrefs(){return{bookmarksBar:n.Z.get(r.kBookmarksBarVisible),addressBar:n.Z.get(r.kAddressBarVisible),panelToggle:n.Z.get(r.kPanelsShowToggle),tabs:n.Z.get(r.kTabsVisible),statusBar:n.Z.get(r.kStatusBarDisplay)}}ensureControlButtonsInProperPosition(e,t){}}const g=new p(a.Z),m={_oldState:g.getState(),updateLastActiveBrowserWindowStack(e){m.removeFromLastActiveBrowserWindowStack(e),g.isTabbedBrowser(e)&&h.unshift(e)},removeFromLastActiveBrowserWindowStack(e){const t=h.indexOf(e);-1!==t&&h.splice(t,1)},recordState(){const e=m._oldState,t=g.getState();m._oldState=t;for(const[s]of e)t.has(s)||m.removeFromLastActiveBrowserWindowStack(s);for(const[s,n]of t){const t=e.get(s);(n.active&&!t?.active||0===h.length)&&m.updateLastActiveBrowserWindowStack(s),n.html5FullScreen||t&&n!==t&&(u(t)===u(n)&&("fullscreen"===t.state&&"fullscreen"===n.state||"fullscreen"!==t.state&&"fullscreen"!==n.state)&&t.visibleUI===n.visibleUI||(0,o.Z)(s,{minimalUI:n.minimalUI,fullScreen:"fullscreen"===n.state,visibleUI:n.visibleUI}))}}};g.addListener(m.recordState.bind(m));const f=g;function v(e){return e.html5FullScreen?"fullscreen inner":"fullscreen"===e.state?"fullscreen":"maximized"===e.state?"maximized":"normal"}},92:(e,t,s)=>{"use strict";s.d(t,{Z:()=>d});var n=s(68247),i=s(29087),a=s(24602),o=s(89175),r=s(93513);class l extends a.Z{getInitialState(){return[]}getRules(){return this.getState()}getRuleById(e){return this.getState().find((t=>t.id===e))}getWorkspaceRules(e){return this.getState().filter((t=>t.workspaceId===e))}reduce(e,t){switch(t.actionType){case"WORKSPACE_LINK_ROUTES_INIT":return t.rules;case"CREATE_WORKSPACE_LINK_ROUTE":{const s=(0,r.Uy)(e,(e=>{e.push({id:t.id,type:t.type,expression:t.expression,workspaceId:t.workspaceId})}));return n.Z.set(o.kWorkspacesLinkRoutes,s),s}case"REMOVE_WORKSPACE_LINK_ROUTES":{const{ids:s}=t,i=e.filter((e=>!s.includes(e.id)));return n.Z.set(o.kWorkspacesLinkRoutes,i),i}case"UPDATE_WORKSPACE_LINK_ROUTE":{const s=(0,r.Uy)(e,(e=>{const s=e.findIndex((e=>e.id===t.id));s>-1&&e.splice(s,1,{id:t.id,type:t.type,expression:t.expression,workspaceId:t.workspaceId})}));return n.Z.set(o.kWorkspacesLinkRoutes,s),s}case"CREATE_WORKSPACE":{const s=(0,r.Uy)(e,(e=>{for(let s=0;s<e.length;s++)void 0===e[s].workspaceId&&(e[s].workspaceId=t.id)}));return n.Z.set(o.kWorkspacesLinkRoutes,s),s}case"REORDER_WORKSPACE_LINK_ROUTES":{const s=t.ids.map((t=>e.find((e=>e.id===t)))).filter(Boolean);return s.length===e.length?(n.Z.set(o.kWorkspacesLinkRoutes,s),s):(console.error("Sanity check failed after reordering workspace rules."),e)}case"UPDATE_LINK_ROUTES_FROM_PREFS":return i.Z.get(o.kWorkspacesLinkRoutes)}return e}}const d=new l},53454:(e,t,s)=>{"use strict";s.d(t,{S:()=>l,Z:()=>c});var n=s(96951),i=s(24602),a=s(69046),o=s(86088),r=s(93513);const l=[o.xwB,o.T6H,o.Gyd,o.eTI,o.Bi0,o.S0Y,o.efb,o.XyR,o.gYX,o.b_H,o.$6R,o.o_8,o.V3h,o.LXK,o.rR8,o.onV,o.XkM,o.IrQ,o.mhq,o.BmN];class d extends i.Z{getInitialState(){return[]}getWorkspaceById(e){return this.getState().find((t=>t.id===e))}getWindowId(e){return n.ZP.getWorkspacePages(e).first()?.windowId}getWorkspacePageCounts(){const e=this.getState(),t=new Map(e.map((e=>[e.id,0])));for(const[,e]of n.ZP.getState())e.list.groupBy(a.cm).forEach(((e,s)=>{s&&t.set(s,e.size)}));return t}getDefaultIcon(){return o.BmN}reduce(e,t){switch(t.actionType){case"WORKSPACES_INIT":return t.workspaces;case"CREATE_WORKSPACE":return(0,r.Uy)(e,(e=>{e.push({id:t.id,name:t.name,icon:t.icon,emoji:t.emoji})}));case"SET_WORKSPACE_NAME":return(0,r.Uy)(e,(e=>{const s=e.findIndex((e=>e.id===t.id));s>-1&&(e[s]={...e[s],name:t.name})}));case"REMOVE_WORKSPACE":return(0,r.Uy)(e,(e=>{const s=e.findIndex((e=>e.id===t.id));s>-1&&e.splice(s,1)}));case"SET_WORKSPACE_ICON":return(0,r.Uy)(e,(e=>{const s=e.findIndex((e=>e.id===t.id));s>-1&&(e[s]={...e[s],icon:l[t.icon],iconId:t.icon,emoji:void 0})}));case"SET_WORKSPACE_EMOJI":return(0,r.Uy)(e,(e=>{const s=e.findIndex((e=>e.id===t.id));s>-1&&(e[s]={...e[s],emoji:t.emoji})}));case"REORDER_WORKSPACES":{const s=t.ids.map((t=>e.find((e=>e.id===t)))).filter(Boolean);return s.length===e.length?s:e}}return e}}const c=new d},47825:(e,t,s)=>{"use strict";s.d(t,{Z:()=>o});var n=s(24602),i=s(71828);class a extends n.Z{getInitialState(){return{zoom:i.rM,defaultPageZoom:i.rM,uiZoom:i.an,notesZoom:i.rM}}getZoom(){return this.getState().zoom}getDefaultPageZoom(){return this.getState().defaultPageZoom}getUIZoom(){return this.getState().uiZoom}getNotesZoom(){return this.getState().notesZoom}reduce(e,t){switch(t.actionType){case"ZOOM_PAGE":return{...e,zoom:t.zoomData};case"ZOOM_NOTES":return{...e,notesZoom:t.zoomData};case"ZOOM_SET_UI":return{...e,uiZoom:t.zoomData};case"ZOOM_PAGE_DEFAULT":return{...e,defaultPageZoom:t.zoomData}}return e}}const o=new a},44147:(e,t,s)=>{"use strict";s.d(t,{Z:()=>c});var n=s(27770),i=s(48603),a=s(59486),o=s(46382),r=s(96951),l=s(60331),d=s(44850);const c={onAction:function(e,t){const s=function(e,t){i.Z.copy(t,[e])},n=function(e,t){i.Z.cut(t,[e])},l=function(e,t){i.Z.paste(t,e,!0)},d=a.Z.getItemById(t.id);if(d){const c=void 0!==d.index?d.index+1:-1;switch(t.command){case"addactivetab":{const t=r.ZP.getActivePage(e);t&&(a.Z.isFolder(d)?i.Z.bookmarkPageInFolder(t,d.id):i.Z.bookmarkPageInFolder(t,d.parentId||"",c));break}case"edit":o.Z.showBookmarkDialog(e,{mode:t.command,id:t.id,index:-1});break;case"addfolder":case"addbookmark":o.Z.showBookmarkDialog(e,{mode:t.command,id:t.id,index:c});break;case"addseparator":a.Z.isFolder(d)?i.Z.createSeparator(t.id,d.children?d.children.length:0):d.parentId&&i.Z.createSeparator(d.parentId,c);break;case"cut":const h=n.bind(null,t.id);document.addEventListener("cut",h),document.execCommand("cut"),document.removeEventListener("cut",h);break;case"copy":const u=s.bind(null,t.id);document.addEventListener("copy",u),document.execCommand("copy"),document.removeEventListener("copy",u);break;case"paste":const p=l.bind(null,t.id);document.addEventListener("paste",p),document.execCommand("paste"),document.removeEventListener("paste",p)}}},onHover:function(e,t){l.Z.setStatus(e,0===t.length?"":d.jk.getHoverUrl(a.Z.filterUrl(t)))},onOpen:function(e,t){const s=a.Z.getItemById(t.id);if(s){const i=n.ZP.getOpenOptionsFromDisposition(e,t.disposition,t.background,n.ZP.makeEventFlagsFromApiResponse(t.state));n.ZP.open(e,n.ZP.getBookmarksByNode(s),i,!0)}}}},57082:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});var n=s(34155);const i=Array();function a(e,t){-1===i.findIndex((s=>s.name===e&&s.callback===t))&&i.push({name:e,callback:t})}function o(e,t){const s=i.findIndex((s=>s.name===e&&s.callback===t));-1!==s&&i.splice(s,1)}const r={onCommand:function(e,t){n.nextTick((()=>{i.forEach((s=>{s.name===t&&s.callback(e,t)}))}))},hasListener:function(e){return i.filter((t=>t.name===e)).length>0},addListener:a,addListeners:function(e,t){for(const s of e)a(s,t)},removeListener:o,removeListeners:function(e,t){for(const s of e)o(s,t)}}},84451:(e,t,s)=>{"use strict";s.d(t,{Z:()=>Z});var n=s(45502),i=s(96951),a=s(29087),o=s(15489),r=s(49550),l=s(7064),d=s(21191),c=s(89175);const h=!1;let u="off";let p=[];var g=["f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11","f12","f13","f14","f15","f16","f17","f18","f19"],m={delete:"del",option:"alt",command:"meta",return:"enter",escape:"esc",comma:",",period:".",del:"del",mod:"ctrl"},f=["left","right","shift+left","shift+right","shift+up","shift+down","enter","shift+enter"];f=f.concat(["ctrl+a","ctrl+z","ctrl+y","ctrl+u","ctrl+left","ctrl+right","ctrl+backspace","ctrl+delete","ctrl+home","ctrl+end","ctrl+shift+left","ctrl+shift+right","shift+home","shift+end"]);const v={};function b(e){var t=e.split("+");t=t.map((e=>m[e]||e));var s="";function n(e){t.indexOf(e)>-1&&(s+=e+"+",t.splice(t.indexOf(e),1))}return n("ctrl"),n("alt"),n("shift"),n("meta"),t.sort(),t.forEach(((e,n)=>{s+=e,n+1<t.length&&(s+="+")})),s.toLowerCase()}function C(e){return{ctrlKey:-1!==e.indexOf("ctrl"),altKey:-1!==e.indexOf("alt"),metaKey:-1!==e.indexOf("meta"),shiftKey:-1!==e.indexOf("shift"),key:e.split("+").pop()}}function w(e,t,s,n){n({origin:"shortcut",context:e,windowId:t,keyState:s})}function y(e){return 1===e.length||e.startsWith("numpad")}function x(e){var t=C(e),s=e.split("+").pop();if(-1!==f.indexOf(e))return!1;if("esc"===s||"down"===s||"up"===s||"home"===s||"end"===s||"pagedown"===s||"pageup"===s)return!0;if(g.indexOf(s)>-1)return!0;if(t.ctrlKey||t.altKey||t.shiftKey||t.metaKey){if("backspace"===s||"del"===s)return!0;if(t.ctrlKey||t.metaKey||t.altKey)return!0}return!1}const I=["INPUT","FRAME","IFRAME","SELECT","TEXTAREA"],A=["submit","button","reset","radio","checkbox"],S=["chrome://game/","docs.google.com"];const Z={bind:function(e,t,s){const{autoRepeat:n,isFeatureShortcut:i,isEnabled:a,feature:o,tweakedShortcut:r}=s??{};return[].concat(e).filter(Boolean).map((e=>e.trim())).forEach((e=>function(e,t,s,n,i,a,o){const r=b(e),l=v[r]||[];l.push({callback:n,onAutoRepeat:Boolean(t),isFeatureShortcut:Boolean(s),isEnabled:i||(e=>!0),feature:a||"browser",tweakedShortcut:o}),v[r]=l}(e,n,i,t,a,o,r))),this},unbind:function(e,t){return[].concat(e).forEach((e=>function(e,t){if(e){const s=b(e);v[s]&&(t?v[s]=v[s].filter((e=>e.callback!==t)):delete v[s])}}(e,t))),this},keyComboFromEvent:function(e){if(!e.code||!e.key)return"";if(!(["Alt","Shift","Control","Meta","CapsLock","NumLock","AltGraph"].indexOf(e.key)>-1)&&"keydown"===e.type){const t=function(e){if(e.code.startsWith("Numpad")){var t=r.Z[e.keyCode].substr(6);if(t>="0"&&t<="9")return e.code}return r.Z[e.keyCode]}(e);if("None"===t)return"";{let s=function(e){var t="";return e.metaKey&&(t+="meta+"),e.altKey&&(t+="alt+"),e.ctrlKey&&(t+="ctrl+"),e.shiftKey&&(t+="shift+"),t}(e);return s+=t,b(s.toLowerCase())}}return""},shortcutAllowedInText:x,isSingleKeyShortcut:y,setDevToolsDockingState:function(e){u=e},handleShortcut:function(e,t,r,u,p,g){const m=e.vivaldiWindowId;let f=t.toLowerCase().replace(" ","");f.endsWith("arrow")&&(f=f.substring(0,f.length-5)),f=b(f);const Z=n.Z.getContext(m).feature,T=function(e,t){const s=v[e];if(s?.length)return s.reduce(((e,s)=>e||"browser"!==s.feature?(0,d._5)(s.feature,t)?s:e:s),null)}(f,Z);if(T){if(!T.isEnabled(m))return;if(!0===r&&!1===T.onAutoRepeat)return;h,async function(e,t,r,d,h,u){const p=e.vivaldiWindowId;if(y(r)){if(d){if(!a.Z.get(c.kKeyboardShortcutsEnableSingleKeyForMail))return;if("browser"===n.Z.getContext(p).feature)return}else if(!a.Z.get(c.kKeyboardShortcutsEnableSingleKey))return;const e=i.ZP.getActivePage(p);if(e)for(const t of S)if(e.url.includes(t))return}if(o.ZP.isSettings(p)&&!s(25795).Z.isShortcutAccepted(p,r))return;if(!a.Z.get(c.kKeyboardShortcutsEnable)){const e=(await s(25795).Z.getAllCommands(p)).find((e=>"COMMAND_PAGE_DISABLE_KEYBOARD_SHORTCUTS"===e.name));if(!e)return;const t=s(25795).Z.getCommandConfiguration(e.name);if(!Array.isArray(t.shortcuts)||!t.shortcuts.some((e=>e===r)))return}const g=h?h.tagName:"",m=h instanceof e.HTMLInputElement?h.type:"",f=!!h&&h.isContentEditable;I.includes(g)&&!A.includes(m)||f?x(r)&&w(e,p,C(r),t):"WEBVIEW"===g?l.Z.windowPrivate.getFocusedElementInfo(p).then((({tagName:s,editable:n,role:i})=>{if(!n||x(r)){const n="SELECT"===s,a="SPAN"===s&&"spinbutton"===i;(!n&&!a||n&&x(r))&&w(e,p,C(r),t)}})):w(e,p,C(r),t)}(e,T.callback,f,T.isFeatureShortcut,g)}},setBlockedShortcuts:function(e){p=e}}},5198:(e,t,s)=>{"use strict";s.d(t,{Z:()=>m,k:()=>u});var n=s(9761),i=s(19789),a=s(68247),o=s(29087),r=s(85374),l=s(56371),d=s(7064),c=s(36436),h=s(89175);const u=2e3;let p=[];const g={canTranslateText:(e,t="",s=-1)=>!(s>=0&&!o.Z.get(h.kPanelsTranslateRedirect)&&!g.canTranslatePage(s,!0))&&(e.length>0&&!(0,c.xl)(t)),canTranslatePage(e,t=!1){const s=r.ZP.getPageState(e);return t?Boolean(s.pageLanguage):Boolean(s.pageLanguage)&&!s.isTranslated},getTranslationCode:(e=i.ZP.UI_LANGUAGE)=>n.YI[e]||e,getTargetTranslationCode:()=>o.Z.get(h.kTranslateTargetLanguage)||g.getTranslationCode(),setTargetTranslationCode(e){a.Z.set(h.kTranslateTargetLanguage,e)},getTranslationLocales(){if(!p.length){const e=o.Z.get(h.kVivaldiTranslateLanguageList);p=e.map((e=>{"es-ES"===(e=n.jq[e]??e)&&(e="es");let t=n.lE.find((t=>t.key===e));return t||(t=n.sK.find((t=>t.key===e))),t})).filter(Boolean).sort(((e,t)=>e.value.localeCompare(t.value)))}return p},getHumanReadableLanguageFromCode(e){const t=g.getTranslationLocales().find((t=>{const s=g.getTranslationCode(t.key);return t.key===e||s===e}));return t?t.value:(0,l.Z)("Unknown ($1)",[e])},async detectTextLanguage(e,t){let s=await d.Z.tabsPrivate.determineTextLanguage(e,t);return"und"===s&&(s=""),s}},m=g},76747:(e,t,s)=>{"use strict";s.d(t,{Z:()=>S});var n=s(25795),i=s(45502),a=s(84451),o=s(29087),r=s(56371),l=s(7064),d=s(13302),c=s(89175);let h,u="";function p(){return(0,r.Z)("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefhiklmnorstuvwxz")}function g(){return void 0===h&&(h=["zh-CN","zh-TW","ja","ko"].indexOf(u)>-1),h}function m(e){const t=e.indexOf("&");if(-1===t||" "===e[t+1])return-1===t?-1:-2;if("&"!==e[t+1])return t;let s=1;for(let n=t+1;n<e.length&&"&"===e[n];n++)s++;return s%2==0?-1:t}function f(e,t,s,n,i){let a=0;for(;-1!==a;){const i=t.charAt(a),o=i.toUpperCase();if(-1!==n.indexOf(i)&&-1===e.indexOf(o)&&(0!==a&&!0!==s||i===o))return a;a=t.indexOf(" ",a+1),-1!==a&&a++}for(let s=0;s<t.length;s++){const i=t.charAt(s);if(-1!==n.indexOf(i)&&-1===e.indexOf(i.toUpperCase()))return s}return i?-1:f("",t,s,n,!0)}function v(e){return!!i.Z.isBrowserFeature(e.feature)||!e.commandName}function b(){return{enabled:o.Z.get(c.kKeyboardShortcutsEnable),singleKey:o.Z.get(c.kKeyboardShortcutsEnableSingleKey),mailSingleKey:o.Z.get(c.kKeyboardShortcutsEnableSingleKeyForMail)}}function C(e,t){const{shortcuts:s}=e;if(t.enabled&&s&&!1!==e.showshortcut)for(let n=0;n<s.length;n++){const i=s[n];let o=!1;if(a.Z.isSingleKeyShortcut(i)){if(v(e)){if(!1===t.singleKey)continue}else if(!1===t.mailSingleKey)continue;o=!0}if(0!==i.length)return{value:(0,d.G)(i),singleKey:o}}return{value:"",singleKey:!1}}function w(e){return"separator"===e.type}function y(e){return"folder"===e.type}function x(e){return{label:e,labelEnglish:e}}function I(){return(0,r.Z)("...")}const A={commandItem:{type:"command",label:"",labelEnglish:""},ellipsisString:I,hasBrowserFeature:v,formatShortcut:function(e,t){return C({commandName:e,shortcuts:t,...x("")},b()).value},getDisplayName:function(e){if(w(e))return"";let t=e.labelWithMnemonic||e.label||"";return e.emphasized&&(t=`• ${t}`),e.ellipsis?t+I():t},getMenuBarString:function(e,t){if(!e.label)return{name:"",offset:-1};let s=e.label;const n=void 0===t.offset?-1:t.offset,i=m(s);if(i>=0&&(s=s.substring(0,i)+s.substring(i+1)),g()&&-1!==n){let t=e.labelEnglish;const i=m(t);i>=0&&(t=t.substring(0,i)+t.substring(i+1)),s=s+" ("+t.charAt(n).toUpperCase()+")"}return{name:s,offset:n}},getShortcut:C,getShortcutSettings:b,getShortcutsForSubMenus:function(e){const t=Object.keys(n.Z.getCommandsForShortcuts()).filter((e=>e.includes("alt+")&&5===e.length)),s=p(),i=o.Z.get(c.kKeyboardShortcutsAltOpensMenu),a=[],r=[];e.forEach((e=>{if(!1!==e.mnemonic&&e.label&&!w(e)){const t=e.label.indexOf("&");if(-1!==t&&t+1<e.label.length){const s=e.label.toUpperCase().charCodeAt(t+1);-1===a.indexOf(s)&&a.push(s)}}}));for(let n=0;n<e.length;n++){const o=e[n];if(!o.label||!y(o)||!1===i||!1===o.mnemonic){r.push({index:n});continue}const l=g()?o.labelEnglish:o.label;if(void 0===l){r.push({index:n});continue}if(a.length>0){const e=l.indexOf("&");if(-1!==e&&e+1<l.length){const s=l.toUpperCase().charCodeAt(e+1),i=String.fromCharCode(s).toLowerCase(),a="alt+"+i;t.includes(a)?r.push({index:n,key:i,offset:e}):(r.push({index:n,shortcut:a,key:i,offset:e}),t.push(a));continue}}let d=!1;for(let e=0;e+1<l.length&&!d;e++){const i=l.toUpperCase().charCodeAt(e);if(-1!==a.indexOf(i))continue;const o=String.fromCharCode(i).toLowerCase();if(-1===s.indexOf(o))continue;const c="alt+"+o;t.includes(c)||(r.push({index:n,shortcut:c,key:o,offset:e}),t.push(c),d=!0)}d||r.push({index:n})}return r},installMnemonics:function e(t,s){const n=p(),i=0===u.indexOf("en"),a=g();let o="";for(let e=0;e<t.length;e++){const n=t[e];if(n.label)if(w(n)||!1===n.mnemonic){if(!1===n.mnemonic){const e=m(n.label);(e>=0||-2===e)&&(n.labelWithMnemonic=n.label.replace(/\&/g,"&&"))}}else if(s.length>e){const t=a?n.labelEnglish:n.label;let i=s[e].offset;void 0!==i&&i+1<=n.label.length?("&"===n.label[i]?n.labelWithMnemonic=n.label:n.labelWithMnemonic=a?n.label+" (&"+t.charAt(i).toUpperCase()+")":n.label.slice(0,i)+"&"+n.label.slice(i),o+=n.label.charAt(i+1).toUpperCase()):(i=n.label.indexOf("&"),n.labelWithMnemonic=-1!==i?n.label:void 0)}else{const e=m(n.label);e>=0&&e+1<n.label.length?(n.labelWithMnemonic=n.label,o+=n.label.charAt(e+1).toUpperCase()):n.labelWithMnemonic=-2===e?n.label.replace(/\&/g,"&&"):void 0}}for(let s=0;s<t.length;s++){const r=t[s];if(!r.label)continue;const l=a?r.labelEnglish:r.label;if(void 0!==l&&!w(r)&&!1!==r.mnemonic&&void 0===r.labelWithMnemonic){const e=f(o,l,i,n,!1);e>=0&&(o+=l.charAt(e).toUpperCase(),r.labelWithMnemonic=a?r.label+" (&"+l.charAt(e).toUpperCase()+")":r.label.slice(0,e)+"&"+r.label.slice(e))}r.items&&e(r.items,[])}},isSeparator:w,loadPromise:function(){return new Promise((e=>{l.Z.utilities.getLanguage((t=>{u=t,e()}))}))},makeLabelPair:x,makeNumberMnemonic:function(e,t){const s=t<9&&!0;if(s){return{...x("&"+(t+1)+" "+e.replace(/\&/g,"&&")),mnemonic:s}}return{...x(e),mnemonic:s}},separatorItem:{type:"separator",label:"",labelEnglish:""}},S=A},40893:(e,t,s)=>{"use strict";s.d(t,{Z:()=>h});var n=s(96951),i=s(29087),a=s(39206),o=s(2004),r=s(15489),l=s(7064),d=s(89175);const c={withPageSelection:async function(e,t){const s=n.ZP.unsafeGetActivePage(e).id,i=await l.Z.utilities.getSelectedText(s),o=t?t.guid:a.Z.getDefault(r.ZP.isIncognito(e))?.guid;o&&await c.withTextAndEngine(e,i,o)},withTextAndEngine:async function(e,t,s){const n=a.Z.getByGuid(s);if(t&&n){const s=i.Z.get(d.kPageSearchInBackground);await o.Z.goSearchUrl(e,t,{inCurrent:r.ZP.isPopup(e),inBackground:s,useSearchEngine:n,addOpenerTabId:!0})}}},h=c},9304:(e,t,s)=>{"use strict";s.d(t,{ZP:()=>I,mM:()=>b,np:()=>v,tc:()=>C});var n=s(65792),i=s.n(n),a=s(93197);const o=(e,t,s)=>({densityGap:`${s}px`,radiusRound:e>-1?"100px":0,radiusRounded:e>-1?"2px":0,radiusRoundedLess:e>0?e-1+"px":0,radius:`${e}px`,radiusHalf:`${Math.round(e/2)}px`,radiusCap:`${Math.min(e,8)}px`,scrollbarWidth:`${t}px`});var r=s(27856),l=s.n(r),d=s(29087),c=s(47825),h=s(42568),u=s.n(h),p=s(65741),g=s(89175),m=s(93513);const f=["center","top","right","bottom","left"];function v(){return d.Z.get(g.kThemeSimpleScrollbar)?12:16}function b(){return d.Z.get(g.kAppearanceDensity)?3:0}function C(e){const t=(new TextDecoder).decode(e),s=l().sanitize(t,{USE_PROFILES:{svg:!0,svgFilters:!0},FORBID_TAGS:["style"],ADD_TAGS:["feDropShadow"],ADD_ATTR:["from","to"]});if(!s.startsWith("<svg "))throw new Error("ThemeUtils: Malformed SVG file");return(new TextEncoder).encode(s)}function w(e,t,s,n,i){let a;for(let o=0;o<e[t].length;o++){const r=e[t][o];if(s===r[0]&&n===r[1]&&i===r[2]){a=o;break}}"number"!=typeof a?e[t].push([s,n,i,1]):e[t][a][3]++}function y(e){return 60*e.hours+e.minutes}const x={getDefaultTheme:()=>d.Z.getDefault(g.kThemesSystem)[0],getFallbackStyle:()=>x.createStyle(x.getDefaultTheme()),getTheme:e=>{const t=d.Z.get(g.kThemesPreview),s=x.getSystemThemes(),n=d.Z.get(g.kThemesUser);return t.concat(s.concat(n)).find((t=>t?.id===e))},getThemeWithFallback:e=>e&&x.getTheme(e)||x.getDefaultTheme(),getPreview:()=>d.Z.get(g.kThemesPreview)&&d.Z.get(g.kThemesPreview)[0],getSystemThemes:()=>(0,m.Uy)(d.Z.get(g.kThemesSystem),(e=>{const t=d.Z.get(g.kThemesSystem);e.forEach(((s,n)=>{const i=t.find((e=>e.id===s.id));i&&(e[n]=i)}))})),getThemesWithButtons:()=>x.getSystemThemes().concat(d.Z.get(g.kThemesUser)).filter((e=>e.buttons)),getWindowBackgroundColor:e=>{const t=String(e["--colorBg"]);if(i().valid(t))return i()(t);console.warn(`getWindowBackgroundColor: Unable to find style for ${t}`)},getImageVars:u()((async(e,t)=>{const s={backgroundImage:"unset"};if(e)try{const n=await async function(e){const t=document.createElement("img"),s=new Promise(((e,s)=>{t.addEventListener("load",e,{once:!0}),t.addEventListener("error",s,{once:!0})}));return t.src=e,await s,t}(e),o=n.naturalHeight,r=n.naturalWidth,l=function(e){const t=document.createElement("canvas"),s=t.getContext("2d"),n=16,a=[15,31,47,63,79,95,111,127,143,159,175,191,207,223,239,255],o={center:[],top:[],right:[],bottom:[],left:[]};t.width=n,t.height=n,s.imageSmoothingEnabled=!1,s.drawImage(e,0,0,n,n);const r=s.getImageData(0,0,n,n).data;for(let e=0;e<r.length/4;e++){const t=4*e,s=r[t],i=r[t+1],l=r[t+2],d=a.includes(e),c=e>240,h=!d&&e%n==0;w(o,!c&&e<n?"top":c?"bottom":d?"right":h?"left":"center",s,i,l)}return f.reduce(((e,t)=>{o[t].sort(((e,t)=>t[3]-e[3]));const s=o[t][0];return e[t]=i()(s[0],s[1],s[2]),e}),{})}(n);switch(Object.assign(s,function(e){return Object.entries(e).reduce(((e,[t,s])=>{const n=t[0].toUpperCase()+t.slice(1),o=s.luminance()>a.$J,r=i().mix(s,o?a.Cj:a.E5),l=o?a.E5:a.Cj;return e[`--colorImage${n}Fg`]=l.css(),e[`--colorImage${n}FgAlpha`]=l.alpha(.6).css(),e[`--colorImage${n}FgAlphaHeavy`]=l.alpha(.05).css(),e[`--colorImage${n}Bg`]=r.css(),e[`--colorImage${n}BgAlpha`]=o?r.alpha(.55).css():r.alpha(.55).brighten(1).css(),e[`--colorImage${n}BgAlphaHeavy`]=o?r.alpha(.35).css():r.alpha(.35).brighten(1).css(),e}),{})}(l)),s.backgroundImage=`url("${e}")`,t){case"stretch":s.backgroundSize="cover";break;case"center":s.backgroundSize=`${r}px ${o}px`,s.backgroundRepeat="no-repeat";break;case"repeat":s.backgroundSize=`${r}px ${o}px`,s.backgroundPosition="50% 0"}}catch(t){console.error("Error loading background image",e)}return s}),{maxSize:40}),createStyleRoot:e=>":root {"+Object.entries(e).filter((([e,t])=>e.startsWith("--"))).map((([e,t])=>`${e}:${String(t)}`)).join(";")+";}",getPalette:(e,t)=>{const s=document.createElement("canvas"),n=t||16,i=s.getContext("2d"),a=[],o=[];s.width=n,s.height=n,i.imageSmoothingEnabled=!1,i.drawImage(e,0,0,n,n);const r=i.getImageData(0,0,n,n).data;for(let e=0;e<r.length/4;e++){const t=4*e,s=r[t],n=r[t+1],i=r[t+2];let o;if(!(0===r[t+3]||s>240&&i>240&&n>240)){for(let e=0;e<a.length;e++)if(s===a[e][0]&&n===a[e][1]&&i===a[e][2]){o=e;break}void 0===o?a.push([s,n,i,1]):a[o][3]++}}a.sort(((e,t)=>t[3]-e[3]));for(let e=0;e<Math.min(10,a.length);e++)o.push([a[e][0],a[e][1],a[e][2]]);return o},getTimerByDate:(e,t)=>{const s=60*e.getHours()+e.getMinutes(),n=d.Z.get(g.kThemeScheduleTimeline),i="next"===t?n.reduce(((e,t)=>[...e,t,{...t,hours:t.hours+24}]),[]).sort(((e,t)=>y(e)-y(t))).find((({hours:e,minutes:t})=>60*e+t>s)):n.reduce(((e,t)=>[...e,t,{...t,hours:t.hours-24}]),[]).sort(((e,t)=>y(t)-y(e))).find((({hours:e,minutes:t})=>60*e+t<=s));if(!i)throw new Error("ThemeUtilities: Error getting theme schedule.");return i},convertColorsToVariables:e=>{const t={};return Object.keys(e).forEach((s=>{t[`--${s}`]=e[s]})),t},createStyle:e=>{const t={...a.ZP.forTheme(e),...o(e.radius,v(),b())},s={};return e.transparencyTabBar?s["--colorTabBar"]="transparent":e.accentOnWindow?s["--colorTabBar"]="var(--colorAccentBg)":e.accentOnWindow||(s["--colorTabBar"]="var(--colorBg)"),Object.keys(t).forEach((e=>{s[`--${e}`]=t[e].toString()})),s["--uiZoomLevel"]=c.Z.getUIZoom(),s},isThemeDark:e=>{const t=e["--colorBg"];return"string"==typeof t?i()(t).luminance()<=a.$J:(console.warn("Unable to determine if theme is dark",{style:e}),!1)},isThemeHighlightDark:e=>{const t=e["--colorHighlightBg"];return"string"==typeof t?i()(t).luminance()<=a.$J:(console.warn("Unable to determine if theme highlight is dark",{style:e}),!0)},isThemeAccentDark:(e,t,s)=>{const n=e["--colorAccentBg"],o=e["--colorImageTopBg"]||e["--colorWindowBg"];return"string"==typeof o&&"string"==typeof n&&(s&&t&&(i().blend(o,n,"multiply").luminance(),a.$J),i()(n).luminance()<=a.$J)},isThemeBackgroundImageDark:(e,t,s)=>{const n=e["--colorImageTopBg"]||e["--colorWindowBg"],o=e["--colorAccentBg"];return"string"==typeof n&&"string"==typeof o&&(s&&t?i().blend(n,o,"multiply").luminance()<=a.$J:i()(n).luminance()<=a.$J)},isSystemThemeModified:e=>{const t=d.Z.getDefault(g.kThemesSystem).find((t=>t.id===e.id));return t||console.warn(e.id,"is not a valid system theme"),(0,p.Z)(e,t)},createClassnames:(e,t)=>{let s,n,i;return t?(s=x.isThemeDark(t),n=x.isThemeAccentDark(t,e.accentFromPage,e.transparencyTabBar),i=x.isThemeBackgroundImageDark(t,e.accentFromPage,e.transparencyTabBar)):(s=!1,n=!1,i=!1),{"theme-light":!s,"theme-dark":s,"acc-light":!n,"acc-dark":n,"bg-light":!i,"bg-dark":i,"color-behind-tabs-on":e.accentOnWindow,"color-behind-tabs-off":!e.accentOnWindow,"color-accent-from-page":e.accentFromPage,"ui-transparent-tabs":e.transparencyTabs,"transparent-tabbar":e.transparencyTabBar,[`theme-id-${e.id}`]:!0}}},I=x},93974:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});var n=s(7064),i=s(77398);const a=(e=2,t)=>(s,n)=>{if(e<=1)return 0;if(t&&(s=(0,i.Z)(s,t),n=(0,i.Z)(n,t)),!s&&!n)return 0;if(!s&&0!==s)return 2===e?1:-1;if(!n&&0!==n)return 2===e?-1:1;if("number"==typeof s&&"number"==typeof n)return 2===e?s-n:n-s;const a=s.toString().localeCompare(n.toString());return a>0?2===e?1:-1:a<0?2===e?-1:1:0},o={treeSort:function(e,t=a(),s="children"){const n=e=>{for(const t of e){const e=t[s];Array.isArray(e)&&n(e)}e.sort(t)};n(e)},getDefaultComparator:a,toMenuSorting:function(e,t){let s,i;if(e===o.ASCENDING_SORT?s=n.Z.menubarMenu.SortOrder.ASCENDING:e===o.DESCENDING_SORT&&(s=n.Z.menubarMenu.SortOrder.DESCENDING),void 0!==s)switch(t){case"title":i=n.Z.menubarMenu.SortField.TITLE;break;case"url":i=n.Z.menubarMenu.SortField.URL;break;case"nickname":i=n.Z.menubarMenu.SortField.NICKNAME;break;case"description":i=n.Z.menubarMenu.SortField.DESCRIPTION;break;case"dateAdded":i=n.Z.menubarMenu.SortField.DATE_ADDED}return{order:s,field:i}},NO_SORTING:1,ASCENDING_SORT:2,DESCENDING_SORT:3},r=o},19626:(e,t,s)=>{"use strict";s.d(t,{Fe:()=>l,fs:()=>r,pg:()=>d});var n=s(59322),i=s(7064),a=s(36436);const o=["ad_blocking","tracking"],r=(e,t,s,i)=>{const a={tracking:{process:!1,exempt:!1},ad_blocking:{process:!1,exempt:!1}};if(parseInt(t)!==i)switch(t){case"0":a.tracking.exempt=!0,a.ad_blocking.exempt=!0;break;case"1":a.tracking.process=!0,a.ad_blocking.exempt=!0;break;case"2":a.tracking.process=!0,a.ad_blocking.process=!0}Object.keys(a).forEach((t=>{a[t].process?c(e,t,"process_list"):h(e,t,"process_list"),a[t].exempt?c(e,t,"exempt_list"):h(e,t,"exempt_list")})),"number"==typeof s&&n.ZP.reloadPage(s)},l=(e,t,s)=>{if((0,a.xl)(t))return;const{hostname:n}=new URL(t);i.Z.contentBlocking.getAllExceptionLists((t=>{let i=0;o.forEach((e=>{t[e].process_list.find((e=>{n.includes(e)&&i++}))}));let a="0";switch(s){case"ad_blocking":a=0===i||1===i?"2":"0";break;case"tracking":a=2===i||0===i?"1":"0";break;default:return}r(n,a,e)}))},d=(e,t)=>{i.Z.contentBlocking.getActiveExceptionsList(e,(s=>{t({["tracking"===e?"trackerBlockingEnabled":"adBlockingEnabled"]:"exempt_list"===s})}))},c=(e,t,s)=>{i.Z.contentBlocking.addExceptionForDomain(t,s,e)},h=(e,t,s)=>{i.Z.contentBlocking.removeExceptionForDomain(t,s,e)}},84675:(e,t,s)=>{"use strict";s.d(t,{Z:()=>v});var n=s(29717),i=s(21838),a=s(96951),o=s(68247),r=s(29087),l=s(56371),d=s(7064),c=s(16152),h=s(89175),u=s(89555),p=s(8684);const g="VIVALDI_CAPTURE_IMAGE_TO_CLIPBOARD";let m;const f={captureActivePage:async(e,t)=>{const s=a.ZP.getActivePage(e);if(s){const e=r.Z.get(h.kWebpagesCaptureCompressionFormat),{success:n}=await f.captureFullpage(s.id,e,t);n&&"clipboard"===t&&(0,p.c)({title:(0,l.Z)("Page Captured"),body:(0,l.Z)("Image stored in the clipboard."),tag:g})}},captureArea:async(e,t)=>{n.Z.enableCapture(e);try{return o.Z.set(h.kWebpagesCaptureSaveLocation,t),await f.beginCaptureArea()}catch(e){return""}},captureFullpage:(e,t,s)=>{const n={encodeFormat:t,encodeQuality:85,fullPage:!0,height:3e4,saveToDisk:"file"===s,showFileInPath:"file"===s,copyToClipboard:"clipboard"===s,saveFilePattern:r.Z.get(h.kWebpagesCaptureSaveFilePattern)};return new Promise((t=>{d.Z.thumbnails.captureTab(e,n,((e,s)=>{t({success:e,image:s})}))}))},beginCaptureArea:()=>new Promise(((e,t)=>{m?t("Capture in Progress"):m=(s,n)=>{s&&t("Capture Cancelled"),e(n)}})),performCapture:(0,c.Z)((e=>{const{windowId:t,mode:s,opts:i,noteId:a}=e;f.beginCaptureArea().then((e=>{f.handleCaptureLocation({windowId:t,mode:s,base64:e,noteId:a})})).catch(u.Z),n.Z.disableCapture(t),f.doCapture(t,i)}),25),doCapture:(e,t)=>{const{x:s,y:n,width:i,height:a}=t,o=r.Z.get(h.kWebpagesCaptureSaveLocation),l=r.Z.get(h.kWebpagesCaptureCompressionFormat),c=r.Z.get(h.kWebpagesCaptureSaveFilePattern),u="note"===o,p="clipboard"===o;d.Z.thumbnails.captureUI({windowId:e,posX:s,posY:n,width:i,height:a,encodeFormat:l,encodeQuality:85,saveToDisk:!0!==u,showFileInPath:!0!==u,copyToClipboard:p,saveFilePattern:c},((e,t)=>{m&&(m(!e,t),m=void 0)}))},handleCaptureLocation:async e=>{const{windowId:t,mode:s,base64:n,noteId:a}=e,o=r.Z.get(h.kWebpagesCaptureSaveLocation);if("clipboard"===o){const e="area"===s?(0,l.Z)("Area Captured"):(0,l.Z)("Page Captured");(0,p.c)({title:e,body:(0,l.Z)("Image Stored in the Clipboard"),tag:g})}else"note"===o&&n&&(a?(i.Z.addScreenshotToNote(t,a,n),f.cancelCallback(t)):await i.Z.createNoteFromCapture(t,n))},cancelCallback:e=>{n.Z.disableCapture(e),m&&(m(!0,""),m=void 0)},captureFromNote:async(e,t)=>{n.Z.enableCapture(e,t),o.Z.set(h.kWebpagesCaptureSaveLocation,"note")}},v=f},21191:(e,t,s)=>{"use strict";s.d(t,{Ed:()=>c,Jq:()=>r,_5:()=>h,jD:()=>d});var n=s(39005),i=s(30626),a=s(7064),o=s(4668);function r(e,t){const s=n.Z.getRaw();if(s){const e=n.Z.getActiveListEntry(),t=e?(0,o.BZ)(e.subject):"message";s.saveAs(t+".eml")}else i.Z.getActiveWebView(e)&&a.Z.utilities.savePage(t)}const l=["COMMAND_NEW_BACKGROUND_TAB_LINK","COMMAND_NEW_TAB_LINK"];function d(e){return l.includes(e)}function c(e){return false}function h(e,t){return!e||"feeds"===t&&["mail","feeds"].includes(e)||t===e}},47380:(e,t,s)=>{"use strict";s.d(t,{Z:()=>x,m:()=>f});var n=s(65810),i=s(44147),a=s(76747),o=s(60331),r=s(62077),l=s(72536),d=s(92292),c=s(26591),h=s(86635),u=s(68551),p=s(13253),g=s(89661),m=s(7064);const f=(e,t)=>({origin:e,context:t,windowId:t.vivaldiWindowId,keyState:{ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,key:""}});let v={x:0,y:0,width:0,height:0},b="topLeft",C=!1,w="none",y=null;const x=function(e,t,s,f="pointer",x,I=-1,A){const S=a.Z.getShortcutSettings(),Z=e.vivaldiWindowId;let T,E=0;const k=new Map,N=new Map,_=async function(t){const s={origin:"menu",context:e,windowId:Z,keyState:{shiftKey:t.state.shift,ctrlKey:t.state.ctrl,altKey:t.state.alt,metaKey:t.state.command,key:""},menuData:A};if(t.state.left?s.button=0:t.state.right?s.button=2:t.state.center&&(s.button=1),t.persistent){let e=N.get(t.id);if(e){const n=[];let i=await e.handler(s,!0);const a={id:t.id,checked:i};e.statestrings&&(a.name=e.statestrings[i?1:0].label),n.push(a);const o=Array.from(N.keys());for(let a=0;a<o.length;a++){const r=o[a];if(r!==t.id&&(e=N.get(r),e)){i=await e.handler(s,!1);const t={id:r,checked:i};e.statestrings&&(t.name=e.statestrings[i?1:0].label),n.push(t)}}m.Z.contextMenu.update(n)}}else{const e=k.get(t.id);e&&e(s)}},P=function(e){w="none",o.Z.setStatus(Z,""),m.Z.menubarMenu.onOpen.removeListener(M),m.Z.menubarMenu.onClose.removeListener(D),m.Z.menubarMenu.onHover.removeListener(i.Z.onHover),m.Z.menubarMenu.onAction.removeListener(_),clearInterval(T);const t=y;t&&(y=null,e||t())},M=function(){w="shown",T=setInterval((()=>{m.Z.utilities.emulateUserInput(Z)}),2e3),"function"==typeof s&&s(!0)},D=function(){"function"==typeof s&&s(!1),P(!1)},O=function(e){return e.filter((e=>!e.isVisible||e.isVisible(Z,!1))).map((e=>{const t={};if(a.Z.isSeparator(e))t.separator={};else if("container"===e.type){if(e.container)switch(e.container.content){case"extensions":case"imageinprofile":case"linkinprofile":case"linktohighlight":case"notes":case"pwa":case"linkinpwa":case"sendpagetodevices":case"sendlinktodevices":case"sendimagetodevices":case"speech":case"spellcheck":case"spellcheckoptions":const s=E++;t.container={id:s,content:e.container.content,icons:e.container.icons??[],mode:e.container.mode||"folder",name:a.Z.getDisplayName(e)};break;default:console.warn("Unknown container content",e.container.content)}}else{const s=E++,n=a.Z.getDisplayName(e);let i,o,r=e.persistent;if(e.handler&&(n||e.url)&&k.set(s,e.handler),e.checkedHandler&&(n||e.url)){r=!0;const t={handler:e.checkedHandler,statestrings:e.statestrings};N.set(s,t)}switch(e.commandName&&0===e.commandName.indexOf("DOCUMENT_")&&(i=e.commandName),(e.iconPNG||e.iconPNGWhite)&&(o=[e.iconPNG||"",e.iconPNGWhite||""]),r&&(C=!0),e.type){case"checkbox":case"radio":t.item={id:s,action:i,name:n,type:e.type,radiogroup:e.radiogroup?e.radiogroup:-1,checked:!(!e.checked||e.statestrings)&&e.checked,shortcut:a.Z.getShortcut(e,S).value,showshortcut:e.showshortcut,url:e.url,enabled:!e.isEnabled||e.isEnabled(Z),persistent:r,icons:o};break;default:t.item={id:s,action:i,name:n,type:e.items?"folder":"command",shortcut:a.Z.getShortcut(e,S).value,showshortcut:e.showshortcut,url:e.url,enabled:!e.isEnabled||e.isEnabled(Z),persistent:r,icons:o},e.items&&(t.children=O(e.items))}}return t}))},j=function(e){if("none"!==w)return void("shown"===w?y=j.bind(null,e):console.error("Attempt to show another context menu while one is initializing"));const s="function"==typeof t?t():t;if(0!==s.length){w="initializing",a.Z.installMnemonics(s,[]),m.Z.menubarMenu.onOpen.addListener(M),m.Z.menubarMenu.onClose.addListener(D),m.Z.menubarMenu.onHover.addListener(i.Z.onHover),m.Z.menubarMenu.onAction.addListener(_);try{C="pointer"!==f;const e=O(s);m.Z.contextMenu.show({windowId:Z,documentId:I,forceViews:C,rect:v,origin:b,icons:[c.Z,h.Z,u.Z,p.Z,g.Z,r.Z,l.Z],children:e},(()=>{const e=d.Z.runtime.lastError;e&&(console.error(e.message),P(!0))}))}catch(e){console.error(e)}}};return function(e){e&&e?.nativeEvent?.path?.find((e=>"vivaldi-tooltip"===e.id))||n.i(),e&&(e.persist(),e.preventDefault(),e.stopPropagation());if(v={x:0,y:0,width:0,height:0},b=f,"pointer"===f)v.x=e?e.clientX:0,v.y=e?e.clientY:0;else{let t=x?x.getBoundingClientRect():null;!t&&e&&(t=e.nativeEvent.srcElement.getBoundingClientRect()),t&&(v.x=t.left+1,v.y=t.top,v.width=t.width,v.height=t.height)}j(e)}}},82313:(e,t,s)=>{"use strict";s.d(t,{Z:()=>o});var n=s(56371);const i=[(0,n.Z)("B"),(0,n.Z)("kB"),(0,n.Z)("MB"),(0,n.Z)("GB"),(0,n.Z)("TB"),(0,n.Z)("PB"),(0,n.Z)("EB"),(0,n.Z)("ZB"),(0,n.Z)("YB")],a=(0,n.Z)("bytes");function o(e,t,s=!0,n=!1){if(isNaN(e))return e?e.toString():"";if(e<=0)return"0 "+(s?a:i[0]);const o=n?1024:1e3,r=t??(e<o?0:2);let l=i.length-1;for(var d=0;d<i.length;d++)if(e<Math.pow(o,d+1)){l=d;break}let c=(e/Math.pow(o,l)).toLocaleString(void 0,{maximumFractionDigits:r});if(r>0){const e="."+"0".repeat(r);c.endsWith(e)&&(c=c.substring(0,c.length-e.length))}const h=0===l&&s?a:i[l];return c+(h?" "+h:"")}},81814:(e,t,s)=>{"use strict";function n(e,t){return!!t&&t.contains(e.activeElement)}function i(e){return e.querySelectorAll("a[href]:not([tabindex='-1']),\n    button:not([disabled]):not([tabindex='-1']),\n    input:not([disabled]):not([tabindex='-1']),\n    select:not([disabled]):not([tabindex='-1']),\n    textarea:not([disabled]):not([tabindex='-1']),\n    [contenteditable]:not([tabindex='-1']),\n    [tabindex]:not([disabled]):not([tabindex='-1'])")}function a(e,t){const s=[...i(t||e)],n=s.findIndex((t=>t===e.activeElement));s[(n+1)%s.length].focus()}s.d(t,{Ng:()=>i,pf:()=>a,sT:()=>n})},2497:(e,t,s)=>{"use strict";s.d(t,{Z:()=>i});var n=s(92292);function i(e){const t=n.Z.extension.getViews({windowId:e});if(!t||0===t.length)throw new Error(`chrome.extension.getViews ( ${e} ) returned no views. `);return t[0]}},26036:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});var n=s(56371);const i="Ð";function a(e,t,s){const a=Array.from(arguments);a[0]=i+a[0];let o=(0,n.Z)(...a);return o.startsWith(i)&&(o=o.substr(1)),{label:(0,n.Z)(...arguments),labelEnglish:o}}},97781:(e,t,s)=>{"use strict";s.d(t,{Gx:()=>d,Nw:()=>b,ZR:()=>l,o6:()=>I});var n=s(27856),i=s.n(n);const a="https://240.0.0.0/?url=",o=/(url\("?)(?!data:)/gim,r="lang",l="type",d="name";function c(e,t){for(let s=t.length-1;s>=0;s--){if(t[t[s]]){const e=t[t[s]].replace(o,"$1"+a);t[t[s]]=e}t[t[s]]&&e.push(t[s]+":"+t[t[s]]+";")}}function h(e,t){for(let s=t.length-1;s>=0;s--){const n=t[s];if(1===n.type&&n.selectorText)e.push(n.selectorText+"{"),n.style&&c(e,n.style),e.push("}");else if(n.type===n.MEDIA_RULE)e.push("@media "+n.media.mediaText+"{"),h(e,n.cssRules),e.push("}");else if(n.type===n.FONT_FACE_RULE)e.push("@font-face {"),n.style&&c(e,n.style),e.push("}");else if(n.type===n.KEYFRAMES_RULE){e.push("@keyframes "+n.name+"{");for(let t=n.cssRules.length-1;t>=0;t--){const s=n.cssRules[t];8===s.type&&s.keyText&&(e.push(s.keyText+"{"),s.style&&c(e,s.style),e.push("}"))}e.push("}")}}}const u=function(e,t){if("style"===t.tagName){const t=[];e.sheet&&h(t,e.sheet.cssRules),e.textContent=t.join("\n")}},p=["action","background","href","poster","src","srcset","xlink:href"];let g=!1;const m=function(e){if(p.forEach((t=>{!e.hasAttribute(t)||"href"===t&&"A"===e.tagName||/^(data|blob):(?!image\/svg)/i.test(e.getAttribute(t))||(g=!0,e.removeAttribute(t))})),e.hasAttribute("style")){const t=e.style,s=[];for(let n=t.length-1;n>=0;n--){if(e.style[t[n]]&&o.test(e.style[t[n]])){const s=e.style[t[n]].replace(o,"$1"+a);e.style[t[n]]=s}s.push(t[n]+":"+e.style[t[n]]+";")}s.length?e.setAttribute("style",s.join("")):e.removeAttribute("style")}},f=function(e){"target"in e&&e.setAttribute("target","_blank"),e.hasAttribute("target")||!e.hasAttribute("xlink:href")&&!e.hasAttribute("href")||e.setAttribute("xlink:show","new")},v=function(e,t){const s=e[t.src];if(s){const e=new Blob([s.content],{type:s.mimeType});t.setAttribute(r,t.src),t.setAttribute("src",URL.createObjectURL(e)),s.inUse=!0}};function b(e,t){const s=t?.attachments??{},n=t?.blockHTTPLeaks??!0;i().addHook("afterSanitizeAttributes",f),i().addHook("afterSanitizeAttributes",v.bind(void 0,s)),n&&(i().addHook("afterSanitizeAttributes",m),i().addHook("uponSanitizeElement",u)),g=!1;const a=i().sanitize(e,{ADD_TAGS:n?[]:["iframe"],ADD_ATTR:n?[]:["allowfullscreen"],ALLOW_UNKNOWN_PROTOCOLS:!0,FORBID_TAGS:n?["svg"]:[],WHOLE_DOCUMENT:t?.wholeDocument??!0});return i().removeHooks("afterSanitizeAttributes"),i().removeHooks("uponSanitizeElement"),{sanitized:a,leakPrevented:g}}function C(){return Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString()}let w=[],y=[];function x(e){if("string"==typeof e.src)if(e.src.startsWith("blob:")){const t=e.getAttribute(r);if(t)w.push(t),e.removeAttribute(r),e.setAttribute("src",t);else{const t=C();y.push({dataOrBlobUrl:e.src,cid:t,mimeType:e.getAttribute(l),filename:e.getAttribute(d)}),e.setAttribute("src","cid:"+t),e.removeAttribute(l),e.removeAttribute(d)}}else if(e.src.startsWith("data:image/")){const t=C(),s=e.src.match(/^data:([^,;]+)/)[1];y.push({dataOrBlobUrl:e.src,cid:t,mimeType:s,filename:""}),e.setAttribute("src","cid:"+t)}}function I(e){i().addHook("afterSanitizeAttributes",x);const t={blobFreeHTML:i().sanitize(e,{ALLOW_UNKNOWN_PROTOCOLS:!0,WHOLE_DOCUMENT:!0}),cidsInUse:w,newImages:y};return i().removeHooks("afterSanitizeAttributes"),w=[],y=[],t}},48588:(e,t,s)=>{"use strict";s.d(t,{J3:()=>r,cR:()=>o,kz:()=>d,u4:()=>l});var n=s(68247),i=s(29087),a=s(93513);function o(e,t,s,n){const i=e.get(t)??n;if(void 0===i)return e;const o=(0,a.Uy)(i,s);if(i===o)return e;const r=new Map(e);return r.set(t,o),(0,a.vV)(r)}function r(e,t,s){return e.get(t)===s?e:(0,a.vV)(new Map(e).set(t,s))}function l(e,t){if(e.has(t)){const s=new Map(e);return s.delete(t),(0,a.vV)(s)}return e}function d(e,t){const s=i.Z.get(e),o=(0,a.Uy)(s,t);return s!==o&&(n.Z.set(e,o),!0)}},721:(e,t,s)=>{"use strict";s.d(t,{Ek:()=>d,Kz:()=>c,Mr:()=>r,Np:()=>l,S2:()=>o,VV:()=>a});var n=s(84847),i=s(7064);function a(e){return!(e.altKey||e.shiftKey||e.ctrlKey||e.metaKey)}function o(e){return e.altKey&&!e.shiftKey&&!e.ctrlKey&&!e.metaKey}function r(e){return!e.altKey&&e.shiftKey&&!e.ctrlKey&&!e.metaKey}function l(e){return!e.altKey&&!e.shiftKey&&e.ctrlKey&&!e.metaKey}function d(e){const{altKey:t,shiftKey:s,ctrlKey:n,metaKey:i}=e;return!t&&!s&&n&&!i}const c=function(){let e=!1;return function(t,s){(0,n.Z)(t)?!0!==e&&(e=!0,i.Z.tabsPrivate.onKeyboardChanged.addListener((function n(a,o,r,l){!o&&function(e,t){const s={ctrlKey:[17],altKey:[18],metaKey:[91,93]};return Object.keys(s).filter((t=>e)).filter((e=>-1!==s[e].indexOf(t))).some(Boolean)}(t,l)&&(e=!1,s(),i.Z.tabsPrivate.onKeyboardChanged.removeListener(n))}))):s()}}()},49550:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});const n=Object.freeze({3:"Break",8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"Capslock",27:"Escape",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",41:"Select",42:"Print",43:"Execute",44:"PrintScreen",45:"Insert",46:"Del",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",58:":",59:"None",60:"<",61:"=",63:"ß",64:"@",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",91:"Meta",92:"None",93:"Meta",96:"Numpad0",97:"Numpad1",98:"Numpad2",99:"Numpad3",100:"Numpad4",101:"Numpad5",102:"Numpad6",103:"Numpad7",104:"Numpad8",105:"Numpad9",106:"*",107:"+",108:",",109:"-",110:".",111:"/",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",124:"F13",125:"F14",126:"F15",127:"F16",128:"F17",129:"F18",130:"F19",131:"F20",132:"F21",133:"F22",134:"F23",135:"F24",144:"NumLock",145:"Scrolllock",160:"^",161:"!",163:"#",164:"$",165:"None",166:"BrowserBack",167:"BrowserForward",169:")",170:"*",171:"+",173:"None",174:"None",175:"None",176:"Next",177:"Previous",178:"Stop",179:"None",180:"None",181:"None",182:"None",183:"None",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"None",193:"None",194:".",219:"[",220:"\\",221:"]",222:"'",223:"`",224:"Meta",225:"AltGraph",226:"None",230:"None",233:"None",234:"None",255:"None"})},13302:(e,t,s)=>{"use strict";function n(e){return Array.isArray(e)&&(e=e.join(", ")),e&&(e=e.replace(/left/gi,"←").replace(/right/gi,"→").replace(/up/gi,"↑").replace(/down/gi,"↓").replace(/(^|\+)(\w)/g,(e=>e.toUpperCase()))),e}function i(e){return Array.isArray(e)&&(e=e.join(", ")),e&&(e=e.replace(/(^|\+ ?)(\w)/g,(e=>e.toUpperCase()))),e}s.d(t,{$:()=>n,G:()=>i})},51540:(e,t,s)=>{"use strict";s.d(t,{Z:()=>c});const n=/\b(?:https?:\/\/|ftp:\/\/|www\.|vivaldi:\/\/)\S+/gi;function i(e,t,s){let n="";for(;e.endsWith(".")||e.endsWith(":");)n=e[e.length-1]+n,e=e.substr(0,e.length-1);"&lt;"===s.substr(t-4,4)&&e.endsWith("&gt;")?(n="&gt;"+n,e=e.substr(0,e.length-4)):[["(",")"],["[","]"]].forEach((([i,a])=>{s[t-1]===i&&e.endsWith(a)&&(n=a+n,e=e.substr(0,e.length-1))}));return`<a href="${e.startsWith("www.")?"http://"+e:e}" target="_blank">${e}</a>${n}`}let a=0,o=0;const r=/\n((?:&gt;\ ?)*)([^\n]*)/g;function l(e,t,s,n,i){let r=0,l=0;for(;;){const e=t.indexOf(";",l);if(-1===e)break;l=e+1,r++}const d=Math.min(r,a+1);let c=`\n${s}`;if(d>a)o++,c=`\n<blockquote class="indent-${d} blockquote">${s}`;else if(d<a){const e=a-d;o-=e;c=`\n${"</blockquote>".repeat(e)}${s}`}return a=d,c}function d(e,t,s){return":"===s[t-1]||"?"===s[t-1]||"/"===s[t-1]||"&"===s[t-1]||"="===s[t-1]?e:`<a href="mailto:${e}">${e}</a>`}function c(e){let t=e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/[A-Z0-9\-\_\.]+@(?:[A-Z\_-]+\.)+[A-Z]+/gi,d).replace(n,i).replace(r,l);return a=0,o>0&&(t+="</blockquote>".repeat(o),o=0),t}},45660:(e,t,s)=>{"use strict";s.d(t,{Z:()=>i});s(20244);var n=s(17751);const i=new(s(52821).Y)(n.Z)},60007:e=>{let t=!0;const s=(e,t)=>{const s=e[t].level-1;for(let n=t-1;n>=0;n--)if(e[n].level===s)return n;return-1};e.exports=(e,n)=>{n&&(t=!0===n.enabled),e.block.ruler.after("list","todo",((e,t,s)=>{const n=((e,t)=>{const s=e.bMarks[t]+e.blkIndent,n=e.eMarks[t];return e.src.substr(s,n-s)})(e,t);return"list"===e.parentType&&("[ ]"===n.substring(0,3)||"[x]"===n.substring(0,3).toLowerCase())&&(e.tokens.push({type:"todo",content:n,block:!0,lines:[t],level:e.level}),e.line=t+1,!0)}),{}),e.renderer.rules.todo=(e,n,i)=>((e,n,i)=>{const a=e[n],o=e[n-1],r=e[s(e,n-1)];let l=a.content;if(o&&"list_item_open"===o.type&&r&&"bullet_list_open"===r.type){const e=1===l.toLowerCase().indexOf("x");return l=l.slice(3).trim(),'<input type="checkbox"'+(e?" checked":"")+(t?"":" disabled")+" />"+l}return l})(e,n);const i=e.renderer.rules.list_item_open;e.renderer.rules.list_item_open=(e,t,n,a)=>{const o=e[t+1],r=e[s(e,t)];return r&&"bullet_list_open"===r.type&&o&&"todo"===o.type?'<li class="todo">':i(e,t,n,a)}}},4027:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});const n={kNone:-1,kLeft:0,kCenter:1,kRight:2,kBack:3,kForward:4,isContextMenuButton:e=>2===e,isNavigationButton:e=>3===e||4===e,isNoModifierPressed:e=>!(e.altKey||e.shiftKey||e.ctrlKey||e.metaKey),setWebviewPointerEvents:(e,t)=>{const s=e?"":"none";for(const e of t.getElementsByTagName("WEBVIEW"))e.style.pointerEvents=s}}},81157:(e,t,s)=>{"use strict";function n(e){e.preventDefault(),e.stopPropagation()}function i(e){e.stopPropagation()}function a(e){e.preventDefault()}s.d(t,{PF:()=>a,UW:()=>i,ZP:()=>n})},8684:(e,t,s)=>{"use strict";s.d(t,{c:()=>n});function n(e){const t=new Notification(e.title,{body:e.body,icon:e.icon?e.icon:"/resources/icon_notifications.png",silent:Boolean(e.silent),tag:e.tag,renotify:!0});t.onclick=()=>{e.onClick&&e.onClick(),t.close()},setTimeout((()=>t.close()),e.timeout||18e4)}},26219:(e,t,s)=>{"use strict";s.d(t,{Z:()=>i});var n=s(56371);async function i(e,t){const{chrome:s}=e;return new Promise(((e,i)=>{s.fileSystem.chooseEntry({type:"openFile",acceptsMultiple:!0,accepts:[{mimeTypes:["text/*"],extensions:t,description:(0,n.Z)("files of type $1",[t.join(", ")])}]},(t=>{s.runtime.lastError||!t?i(s.runtime.lastError||"Cancelled opening files"):e(t)}))}))}},51370:(e,t,s)=>{"use strict";s.d(t,{Z:()=>o});var n=s(85834),i=s(78614);function a(e){try{return decodeURIComponent(e)}catch(e){return""}}function o(e){const[,t]=e.split(":",2),[s,o=""]=t.split("?",2),r={to:(0,i.D$)((0,n.Mf)(a(s)))};return o.split("&").forEach((e=>{const t=["cc","bcc","body","subject"].find((t=>e.startsWith(t+"=")));if(t){const s=a(e.substr(t.length+1));switch(t){case"cc":case"bcc":r[t]=(0,i.D$)((0,n.Mf)(s));break;case"subject":r[t]=(0,n.Mf)(s);break;case"body":r[t]=s}}})),r}},94595:(e,t,s)=>{"use strict";s.d(t,{M:()=>l,Z:()=>r});var n=s(29087),i=s(89175),a=s(10373);const o=/^(\s*javascript:)+/i;function r(e){const{textToStrip:t,caretPosition:s,selectionEnd:o,currentValue:r=""}=e,d=n.Z.get(i.kAddressBarStripJavascriptOnPaste),c=(0,a.i)(r,t,s,o);return d&&l(c)?c.replace(/javascript:/gi,""):c}function l(e){return o.test(e)}},80419:(e,t,s)=>{"use strict";s.d(t,{g:()=>a});var n=s(7064);let i=!1;function a(e,t,s){function a(e){i=!1,s.removeEventListener("mouseup",l),s.removeEventListener("mousedown",l),n.Z.tabsPrivate.onKeyboardChanged.removeListener(o),n.Z.tabsPrivate.onTabSwitchEnd.removeListener(r),t(e)}function o(e,t,s,n){!0===t?27===n&&a(!0):!1===t&&(17!==n&&18!==n&&13!==n||a(!1))}function r(){a(!1)}function l(e){if(e.target){const t=e.target.classList;if("mousedown"===e.type&&0===e.button&&t&&["visual-tab","visual-list","visual-list-preview"].includes(t)||"audioicon"===e.target.className)return}(2===e.button||e.button<=1&&e.buttons<=2)&&(e.preventDefault(),e.stopPropagation(),a(!1))}!0!==i&&(i=!0,s.addEventListener("mouseup",l),s.addEventListener("mousedown",l),n.Z.tabsPrivate.onKeyboardChanged.addListener(o),n.Z.tabsPrivate.onTabSwitchEnd.addListener(r))}},751:(e,t,s)=>{"use strict";s.d(t,{IY:()=>n,RT:()=>o,gR:()=>a,i6:()=>r,x0:()=>i});s(94283);const n="urlFieldInput";function i(e,t){const s=e.document.getElementById(t??n);s&&s.focus()}function a(e,t){const s=e.document.getElementById(t??n);s&&s.blur()}function o(e,t){return e.document.activeElement?.id===(t??n)}function r(e,t){const s=e.document.getElementById(t??n);s instanceof e.HTMLInputElement&&s.select()}},84749:(e,t,s)=>{"use strict";s.d(t,{Z:()=>o});const n=":";function i(e){return(e=e.replace(/[^0-9a-z]+([a-z]|$)/gi,((e,t)=>t.toUpperCase())))||(e=n),e}function a(e,t,s,o){let r="",l="";for(let d=0;d<e.childNodes.length;d++){const c=e.childNodes[d];if(c instanceof Element){let l=i(c.localName);const d=e.nodeType===Node.DOCUMENT_NODE||s.simplify.some((e=>c.parentNode instanceof Element&&(e.parentns===(c.parentNode.namespaceURI||"")&&e.parent===c.parentNode.localName&&e.elementns===(c.namespaceURI||"")&&e.element===c.localName))),h=c.namespaceURI||n,u=c.namespaceURI||"";l=s.prefixes&&s.prefixes.hasOwnProperty(h)?s.prefixes[h]+"_"+l:u+":"+l,r=l;const p={attributes:{}};for(let e=0;e<c.attributes.length;e++){const t=c.attributes[e];let a=i(t.localName);const o=t.namespaceURI||n,r=t.namespaceURI||"";a=s.prefixes&&s.prefixes.hasOwnProperty(o)?s.prefixes[o]+"_"+a:r+":"+a,p.attributes[a]=t.nodeValue}a(c,p,s,o),d?t[l]?(o.simplifyerror=!0,t.simplifyerror||(t.simplifyerror={}),t.simplifyerror[l]instanceof Array||(t.simplifyerror[l]=[]),t.simplifyerror[l].push(p)):t[l]=p:(t[l]instanceof Array||(t[l]=[]),t[l].push(p))}else c.nodeType!==Node.TEXT_NODE&&c.nodeType!==Node.CDATA_SECTION_NODE||(l+=c.nodeValue)}return e.nodeType===Node.ELEMENT_NODE&&(t.content=l.replace(/^\s+$/,"")),r}function o(e,t){const s=(new DOMParser).parseFromString(e,"text/xml"),i=s.getElementsByTagNameNS("http://www.w3.org/1999/xhtml","parsererror");if(!s||i.length){return{parsererror:!0,errormessage:Array.from(i).map((e=>e.innerText)).join(" "),root:"",simplifyerror:!1}}const o={prefixes:(t||{}).prefixes||{[n]:""},simplify:(t||{}).simplify||[]},r={parsererror:!1,root:"",simplifyerror:!1};return r.root=a(s,r,o,r),r.root||(r.parsererror=!0),r}},7065:(e,t,s)=>{"use strict";s.d(t,{OK:()=>d,ZP:()=>h});var n=s(29087),i=s(44850),a=s(35369),o=s(69046),r=s(65741),l=s(89175);function d(e){const t=e.id;if(void 0===t)throw new Error("Chrome.tabToPage: tab ID missing");let s=(0,o.SJ)({id:t});var r;return s=c(a.aV.of(s),t,e).first(),s.context.isUrlFieldFocused=(r=s.url,!n.Z.get(l.kTabsFocusWebview)&&((0,i.Rf)(r)||r===i.xy["private-intro"])),s}function c(e,t,s){const n=e.findIndex((e=>e.id===t));if(-1===n)return e;for(const[t,o]of Object.entries(s))switch(t){case"vivExtData":if("string"!=typeof o)continue;try{const t=e.getIn([n,"vivExtData"]);if(!t)throw new Error("updatePage: Expected existing extData");const s=JSON.parse(o);"string"==typeof s.tiling&&delete s.tiling,(0,r.Z)(t,s)||(e=e.setIn([n,"vivExtData"],s))}catch(e){}break;case"active":if("boolean"!=typeof o)continue;e=e.setIn([n,"active"],o),o&&(e=e.setIn([n,"unread"],!1));break;case"pendingUrl":case"url":if("string"!=typeof o)continue;if("url"===t&&s.pendingUrl)continue;e=(e=(e=e.setIn([n,"isMailPage"],i.jk.isMailPage(o))).setIn([n,"url"],(a=o).startsWith("vivaldi://")?i.jk.getUrl(a):a)).setIn([n,"target"],void 0);break;case"favIconUrl":if("string"!=typeof o)continue;e=e.setIn([n,"favIconUrl"],o);break;case"index":case"windowId":case"openerTabId":case"pinned":case"audible":case"title":case"incognito":case"sessionId":case"discarded":e=e.setIn([n,t],o)}var a;return e}const h={tabToPage:d,updatePage:c}},26395:(e,t,s)=>{"use strict";s.d(t,{Z:()=>l});var n=s(67294),i=s(94283),a=s(95617),o=s(48521);class r extends n.PureComponent{static contextType=i.Z;nodeRef=n.createRef();componentDidMount=()=>{this._attachObserver()};componentWillUnmount=()=>{this._detachObserver()};componentDidUpdate(e){this.props.attached&&!e.attached&&this._detachObserver(),!this.props.attached&&e.attached&&this._attachObserver()}_attachObserver=()=>{const{Element:e,ResizeObserver:t}=this.context,s=this.nodeRef.current;if(s instanceof e)try{this._observer=new t(this.props.onResize),this._observer.observe(s)}catch(e){console.warn(e)}};_detachObserver=()=>{const{Element:e}=this.context,t=this.nodeRef.current;t instanceof e&&this._observer.unobserve(t)};render(){const e=(0,a.Z)(this.props,["ref","onResize","component","children","attached"]);return(0,o.jsx)("div",{ref:this.nodeRef,...e,children:this.props.children})}}const l=r},69046:(e,t,s)=>{"use strict";function n(e){return e.vivExtData.ext_id}function i(e){return e.vivExtData.fixedGroupTitle}function a(e){return e.vivExtData.group}function o(e){return e.vivExtData.tiling?.id}function r(e){return e.vivExtData.workspaceId}function l(e){return{id:0,index:-1,windowId:-1,openerTabId:void 0,active:!1,pinned:!1,audible:!1,discarded:!1,url:"",title:"",favIconUrl:"",incognito:!1,sessionId:"",vivExtData:{ext_id:""},context:{},target:void 0,favIcon:"",showImageInspector:!1,mimeType:"text/html",unread:!0,isInspected:!1,isMailPage:!1,supportsReaderMode:!1,memoryUsage:0,...e}}s.d(t,{SJ:()=>l,XN:()=>i,_o:()=>n,av:()=>a,cm:()=>r,jA:()=>o})},39206:(e,t,s)=>{"use strict";s.d(t,{A:()=>d,Z:()=>p});var n=s(68247),i=s(29087),a=s(80822),o=s(25372),r=s(7064),l=s(89175);const d=1,c=new Set;let h={templateUrls:[],defaultSearch:"",defaultPrivate:"",defaultSearchField:"",defaultSearchFieldPrivate:"",defaultSpeeddials:"",defaultSpeeddialsPrivate:"",defaultImage:"",systemDefaultSearchChanged:!1};const u={load:async()=>{r.Z.searchEngines.onTemplateUrlsChanged.addListener(u._onTemplateUrlsChanged),await u._onTemplateUrlsChanged(),await u._migrateOldSearches()},_onTemplateUrlsChanged:async()=>{try{h=await r.Z.searchEngines.getTemplateUrls()}catch(e){console.log("Failed loading template URLs:"+e)}c.forEach((e=>e()))},systemDefaultEngineChanged:()=>h.systemDefaultSearchChanged,get:()=>h.templateUrls,getByKeyword:e=>h.templateUrls.find((t=>t.keyword===e)),getByQuery:e=>h.templateUrls.find((t=>e.toLowerCase().startsWith(t.keyword+" "))),isDefault:(e,t)=>t?h.defaultPrivate===e:h.defaultSearch===e,isRemovable:e=>h.defaultSearch!==e&&h.defaultPrivate!==e&&h.defaultImage!==e,getDefault:e=>u.getByGuid(e?h.defaultPrivate:h.defaultSearch),getSearchField:e=>u.getByGuid(e?h.defaultSearchFieldPrivate:h.defaultSearchField),getSpeeddialsSearch:e=>u.getByGuid(e?h.defaultSpeeddialsPrivate:h.defaultSpeeddials),getImageSearch:()=>u.getByGuid(h.defaultImage),getByGuid:e=>h.templateUrls.find((t=>t.guid===e)),getByPrepopulateId:e=>h.templateUrls.find((t=>t.prepopulateId===e)),addListener:e=>{c.add(e)},removeListener:e=>{c.delete(e)},_migrateOldSearches:async()=>{const e={Google:1,"Yahoo!":2,Bing:3,Ecosia:4,"Startpage.com":5,Wikipedia:6,DuckDuckGo:7,Яндекс:8,Neeva:9,"Wolfram|Alpha":10,OZON:11,Amazon:12,eBay:13,"Поиск Mail.ru":14,Qwant:15};async function t(e){const[t,s]=e.post?function(e){const t=(0,o.Z)(e);if(!t)return["",""];const s=t.href.replace(t.search||"",""),n=t.search?.startsWith("?")?t.search.replace("?",""):t.search;return[s||"",n?n.replace("&",","):""]}(e.url):[e.url,""];if(""===t)return"";const n={guid:"",extensionId:"",readOnly:!1,name:e.name,keyword:e.keyword?e.keyword:await r.Z.searchEngines.getKeywordForUrl(t),faviconUrl:e.faviconUrl,url:t,postParams:s,suggestUrl:e.suggestUrl??"",suggestPostParams:"",imageUrl:"",imagePostParams:"",prepopulateId:0},i=u.getByKeyword(e.keyword);if(i){if(n.url===i.url&&n.postParams===i.postParams&&n.suggestUrl===i.suggestUrl)return i.guid;let t=1;const s=e.keyword;let a="";do{a=`${s}${t}`,t++}while(u.getByKeyword(a));0!==i.prepopulateId?(i.keyword=a,r.Z.searchEngines.updateTemplateUrl(i)):n.keyword=a}return await r.Z.searchEngines.addTemplateUrl(n)}let s=[...i.Z.get(l.kChainedCommandsCommandList)];function d(e,t,n){var i,a;i=t,a=n,s=s.map((e=>{const t=e.chain.map((e=>{const{key:t,param:s}=e;return"3a8efd62-4c8a-4545-8a6c-9cb65518f507"===t&&s===i?{...e,param:a}:{...e}}));return{...e,chain:[...t]}}));const o=e.default===t,l=e.defaultPrivate===t;o&&r.Z.searchEngines.setDefault("defaultSearch",n),l&&(r.Z.searchEngines.setDefault("defaultPrivate",n),r.Z.searchEngines.setDefault("defaultSpeeddialsPrivate",n)),(!e.current&&o||e.current===t)&&r.Z.searchEngines.setDefault("defaultSearchField",n),(!e.currentSD&&o||e.currentSD===t)&&r.Z.searchEngines.setDefault("defaultSpeeddials",n),(!e.currentPrivate&&l||e.currentPrivate===t)&&r.Z.searchEngines.setDefault("defaultSearchFieldPrivate",n)}const c=a.Z.getSync("SEARCH_ENGINE_COLLECTION"),h=a.Z.getDefaultSearchEngines();if(void 0===c)return;for await(const s of h.engines){const n=c.engines.find((e=>e.id===s.id));if(!n)continue;const i=e[n.name],a=u.getByPrepopulateId(i);if(!0===n.removed)a&&r.Z.searchEngines.removeTemplateUrl(a.guid);else{if(n.custom&&a){if(n.url!==(s.url||"")||n.suggestUrl!==(s.suggestUrl||"")||n.name!==(s.name||"")||n.post!==Boolean(s.post)){const e=await t(n);""!==e&&d(c,n.id,e);continue}a.keyword=n.keyword,r.Z.searchEngines.updateTemplateUrl(a)}c.defaultChanged&&a&&d(c,n.id,a.guid)}}const p=c.engines.map((e=>(-1!==h.engines.findIndex((t=>t.id===e.id))||!1!==Boolean(e.custom)||c.default!==e.id&&c.defaultPrivate!==e.id||(e.custom=!0),e))).filter((e=>-1===h.engines.findIndex((t=>t.id===e.id))&&!1!==Boolean(e.custom)&&!0!==Boolean(e.removed)));for await(const e of p){const s=await t(e);""!==s&&d(c,e.id,s)}await new Promise((e=>{a.Z.remove("SEARCH_ENGINE_COLLECTION",(()=>{n.Z.set(l.kChainedCommandsCommandList,s),e()}))}))}},p=u},20244:(e,t,s)=>{"use strict";s(89907)},98010:(e,t,s)=>{"use strict";s.d(t,{ZP:()=>p,gC:()=>u,x0:()=>g});var n=s(29087),i=s(25372),a=s(99498);const o=function(e){try{return decodeURI((0,a.Z)(e))}catch(t){return e}};var r=s(1407),l=s(50503),d=s(89175),c=s(36436),h=s(44850);function u(e){const t=(0,l.ME)(e,["scheme","host","tld","port","path","query","ref"]);return(0,l.Aq)(t).substring(0,r.RL)}function p(e){if(!e)return"";const t=(0,i.Z)(e);t&&"view-source:"!==t.protocol&&"mailto:"!==t.protocol&&(t.username="",t.password="",e=t.href);const s=n.Z.get(d.kAddressBarShowFullUrl)?h.jk.getDisplayUrlFromMapping(e):(0,c.Dy)(h.jk.getDisplayUrlFromMapping(e));return o(s)}function g(e){const t=(0,i.Z)(e);return t&&t.hostname?t.hostname.replace(/^(www\.)/,""):""}},42578:(e,t,s)=>{"use strict";s.d(t,{d:()=>r,q:()=>o});var n=s(25356),i=s(44850),a=s(25372);function o(e){if(i.jk.isInternalUrl(e.url)){if(Object.keys(i.jk.internals).find((t=>e.url.startsWith(i.jk.internals[t]))))return i.jk.getDisplayTitle(e)}return(0,a.Z)((0,n.Z)(e.url))?.hostname||""}function r(e,t){const s=o(e),n=t.filter((e=>"tab"===e.type&&!e.page.pinned&&o(e.page)===s)).map((e=>e.page));return[s,n]}},45454:(e,t,s)=>{"use strict";s.d(t,{ZP:()=>r,ke:()=>o,wJ:()=>l});var n=s(15489),i=s(4027),a=s(7064);const o={openInBackgroundTab:{inCurrent:!1,inBackground:!0,inNewWindow:!1,incognito:!1}};function r(e,t,s){const o={ctrl:Boolean(t.ctrlKey),alt:Boolean(t.altKey),shift:Boolean(t.shiftKey),command:!1},r=o.ctrl,l=!o.shift&&!r&&!o.alt,d={inCurrent:!0,inBackground:!1,inNewWindow:!1,incognito:!1,transition:s??a.Z.historyPrivate.TransitionType.AUTO_TOPLEVEL};return o.shift&&r&&o.alt?(d.inNewWindow=!0,d.incognito=!0):o.shift&&r&&!o.alt?(d.inNewWindow=!0,d.incognito=n.ZP.isIncognito(e)):!o.shift||r||o.alt?o.shift||!r||o.alt?l&&t.button===i.Z.kCenter?(d.inCurrent=!1,d.inBackground=!0):l&&t.button===i.Z.kRight&&(d.inCurrent=!1):(d.inCurrent=!1,d.inBackground=!0):d.inCurrent=!1,d}function l(e,t){const s="number"==typeof t.button?t.button:i.Z.kNone;if(!i.Z.isContextMenuButton(s)&&!i.Z.isNavigationButton(s))return r(e,{ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,button:"number"==typeof t.button?t.button:i.Z.kNone})}},84847:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});const n=e=>Boolean(e&&(e.ctrlKey||e.altKey||e.metaKey||e.shiftKey))},60339:(e,t,s)=>{"use strict";s.d(t,{Qz:()=>o,ZN:()=>l,gO:()=>r,kG:()=>d,xz:()=>h});var n=s(96951),i=s(35369),a=s(69046);function o(e){const t=n.ZP.getPageById(e);return!!t&&r(t)}function r(e){const t=(0,a.jA)(e);if(!t)return!1;return n.ZP.getPages(e.windowId).count((e=>e.vivExtData.tiling?.id===t))>1}function l(e){if(e.active)return!0;const t=c(e);return!!t&&t.some((e=>e.active))}function d(e){if(!n.ZP.getPages(e))return(0,i.aV)();const t=n.ZP.getActivePage(e);return t?c(t)||i.aV.of(t):(0,i.aV)()}function c(e){const t=(0,a.jA)(e);return r(e)&&t?n.ZP.getTiles(t,e.windowId):null}function h(e){return!!e&&n.ZP.isGroup(e.vivExtData.group,e.windowId)}},29489:(e,t,s)=>{"use strict";s.d(t,{IN:()=>l,gD:()=>r});var n=s(96951),i=s(26036),a=s(7064);const o=[(0,i.Z)("Transitions Forced"),(0,i.Z)("Filter Obscure"),(0,i.Z)("Filter Grayscale"),(0,i.Z)("Filter Black and White"),(0,i.Z)("Fonts Monospace"),(0,i.Z)("Transform 3D"),(0,i.Z)("Highlight Hover"),(0,i.Z)("CSS Debugger"),(0,i.Z)("Filter Sepia"),(0,i.Z)("Filter Intensify"),(0,i.Z)("Skewed Images"),(0,i.Z)("Highlight Focus"),(0,i.Z)("Transitions Removed"),(0,i.Z)("Filter Invert"),(0,i.Z)("Inline Access Keys"),(0,i.Z)("Page Minimap")];function r(e){const t=e.lastIndexOf("\\"),s=-1===t?e:e.substr(t+1),n=s.lastIndexOf("."),i=s.substr(0,n).replace(/_/g," "),a=o.findIndex((e=>e.labelEnglish===i));return-1===a?i:o[a].label}function l(e){const t=r(e),s=`COMMAND_${t}`.toUpperCase().replace(/\s+/,"_");return{name:s,action:t=>async function(e,t){const s=n.ZP.getActivePage(e);if(s){const e="enabled"===(await a.Z.pageActions.getScriptOverridesForTab(s.id)).find((e=>e.script===t))?.override?"no_override":"enabled";await a.Z.pageActions.setScriptOverrideForTab(t,s.id,e)}}(t.windowId,e),guid:s,showInQC:!1,isEnabled:()=>!0,isVisible:()=>!0,category:"CATEGORY_COMMAND_TAB_ACTION",...(0,i.Z)(t)}}},25356:(e,t,s)=>{"use strict";s.d(t,{Z:()=>i});var n=s(60910);const i=function(e,t){try{return(0,n.Z)(e,t)}catch(t){return e}}},51877:(e,t,s)=>{"use strict";s.d(t,{Z:()=>i});var n=s(52373);function i(e,t,s=((e,t,s)=>(0,n.Z)(t[e],s[e]))){if(e===t)return!0;const i=Object.keys(e),a=Object.keys(t);if(i.length!==a.length)return!1;for(let n=0;n<i.length;n++)if(!t.hasOwnProperty(i[n])||!s(i[n],e,t))return!1;return!0}},14789:(e,t,s)=>{"use strict";function n(e,t){const s=e.indexOf(t);if(s<0)return void e.push(t);const n=e[s];e.copyWithin(s,s+1),e[e.length-1]=n}function i(e,t){const s=e.indexOf(t);if(s<0)return void e.unshift(t);const n=e[s];e.copyWithin(1,0,s),e[0]=n}function a(e,t=!1){if(e.length<=1)return e;const s=[...e];if(!0===t){const e=s[s.length-1];s.copyWithin(1,0,s.length-1),s[0]=e}else{const e=s[0];s.copyWithin(0,1),s[s.length-1]=e}return s}s.d(t,{AL:()=>n,EQ:()=>i,JA:()=>a})},50503:(e,t,s)=>{"use strict";s.d(t,{Aq:()=>u,ME:()=>g,dO:()=>f,gC:()=>v,gG:()=>p,kG:()=>h});var n=s(29087),i=s(29526),a=s(7064),o=s(36436),r=s(88778),l=s(42941),d=s(89175),c=s(44850);function h(){return{scheme:null,username:null,password:null,host:null,path:null,ref:null,query:null,port:null,tld:null}}function u(e){const t=e.scheme&&!o.kO.includes(`${e.scheme}:`)&&"vivaldi"!==e.scheme,s=e.path&&"/"!==e.path||e.query||e.ref?e.path:"",n=null!==e.query?`?${e.query}`:"",i=null!==e.ref?`#${e.ref}`:"";return(e.scheme?`${e.scheme}:${t?"//":""}`:"")+(e.username?e.username:"")+(e.password?`:${e.password}`:"")+(e.username||e.password?"@":"")+(e.host?e.host:"")+(e.port?`:${e.port}`:"")+(s||"")+(n||"")+(i||"")}function p(e){const t=n.Z.get(d.kAddressBarShowFullUrl),s=g(e,["tld","host","port","path",...t?["scheme"]:[],...t?["ref"]:[],...t?["query"]:[]]),i=s.path&&"/"!==s.path||s.query?s.path:"";return{...s,path:i}}function g(e,t){const s=t.includes("username"),n=t.includes("password"),i=t.includes("tld"),a=t.includes("host"),o=t.includes("port"),r=t.includes("path"),l=t.includes("scheme"),d=t.includes("ref"),c=t.includes("query");return{scheme:l?e.scheme:"",username:s?e.username:"",password:n?e.password:"",host:a?e.host:"",path:r?e.path:"",ref:d?e.ref:"",query:c?e.query:"",port:o?e.port:"",tld:i?e.tld:""}}function m(e){return void 0===e?null:e}function f(e){const t=c.jk.getDisplayUrlFromMapping(e);if(!t)return{scheme:null,username:null,password:null,host:null,path:null,ref:null,query:null,port:null,tld:null};const s=a.Z.utilities.getUrlFragments(t),n=s.hostForSecurityDisplay?.length?s.hostForSecurityDisplay:s.host,o=s.tldForSecurityDisplay?.length?s.tldForSecurityDisplay:s.tld,r=s.pathForSecurityDisplay??(0,i.Z)(s.path??""),l=s.queryForSecurityDisplay??s.query,d=s.refForSecurityDisplay??(0,i.Z)(s.ref??"");return{scheme:m(s.scheme),username:m(s.username),password:m(s.password),host:m(n),path:m(r),ref:d?m(d):null,query:l?m(l):null,port:m(s.port),tld:m(o)}}function v(e,t){if(!e)return null;if(!t){if(s=(s=e).replace(/\[|\]/g,""),/(?:^(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}$)|(?:^(?:(?:[a-fA-F\d]{1,4}:){7}(?:[a-fA-F\d]{1,4}|:)|(?:[a-fA-F\d]{1,4}:){6}(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|:[a-fA-F\d]{1,4}|:)|(?:[a-fA-F\d]{1,4}:){5}(?::(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,2}|:)|(?:[a-fA-F\d]{1,4}:){4}(?:(?::[a-fA-F\d]{1,4}){0,1}:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,3}|:)|(?:[a-fA-F\d]{1,4}:){3}(?:(?::[a-fA-F\d]{1,4}){0,2}:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,4}|:)|(?:[a-fA-F\d]{1,4}:){2}(?:(?::[a-fA-F\d]{1,4}){0,3}:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,5}|:)|(?:[a-fA-F\d]{1,4}:){1}(?:(?::[a-fA-F\d]{1,4}){0,4}:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,6}|:)|(?::(?:(?::[a-fA-F\d]{1,4}){0,5}:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,7}|:)))(?:%[0-9a-zA-Z]{1,})?$)/gm.test(s)||/(^|\.)localhost(\.localdomain)?\.?$/.test(e))return{basedomain:e,subdomain:"",hostTld:""};if(-1===e.indexOf("."))return null;const t=e.split("."),n=t.splice(-1).join();return{basedomain:t.splice(-1).join(),subdomain:t.join("."),hostTld:n}}var s;const n=e.substring(0,e.length-t.length).split(".").filter(Boolean),i=(0,r.Z)(n).join(".");return{basedomain:(0,l.Z)(n),subdomain:i,hostTld:t}}},2711:(e,t,s)=>{"use strict";s.d(t,{Z:()=>l});s(20244);var n=s(1407);const i=new Map;let a=0;function o(e,t){return new Promise(((s,n)=>{const o=a++;i.set(o,{resolve:s,reject:n});const r={promiseId:o,func:e,args:t};navigator.serviceWorker?.ready.then((e=>e.active?.postMessage({background:r})))}))}function r(e){if(e.origin!==n.oP)return;const{background:t}=e.data;if(!t)return;const{promiseId:s,results:a,error:o}=t,r=i.get(s);if(!r)return void console.error("BackgroundActions: Missing promise ",s);const{resolve:l,reject:d}=r;i.delete(s),o?d(o):l(a)}const l=new class{updateThreads(){return o("updateThreads",[])}stop(){return o("stop",[])}start(){return o("start",[])}addAccount(e){return o("addAccount",[e])}flushBuffer(){return o("flushBuffer",[])}updateFlags(){return o("updateFlags",[])}runSystemTasks(){return o("runSystemTasks",[])}getOAuthAccessToken(e,t,s){return o("getOAuthAccessToken",[e,t,s])}fetchAccessTokenAndRefreshToken(e,t,s){return o("fetchAccessTokenAndRefreshToken",[e,t,s])}verify(e){return o("verify",[e])}autofill(e){return o("autofill",[e])}signIn(e){return o("signIn",[e])}startBackgroundActions(){navigator.serviceWorker?.addEventListener("message",r,!1)}}},3184:(e,t,s)=>{"use strict";s.d(t,{Z:()=>l});s(20244);var n=s(45660),i=s(1407);const a=new Map;let o=0;function r(e,t){return new Promise(((s,n)=>{const i=o++;a.set(i,{resolve:s,reject:n});const r={promiseId:i,func:e,args:t};navigator.serviceWorker?.ready.then((e=>e.active?.postMessage({imap:r})))}))}navigator.serviceWorker?.addEventListener("message",(function(e){if(e.origin!==i.oP)return;const{imap:t}=e.data;if(!t)return;const{promiseId:s,results:o,error:r}=t,l=a.get(s);if(!l)return void n.Z.error("Mail",["ImapActions"],"Missing promise ",s);const{resolve:d,reject:c}=l;a.delete(s),r?c(r):d(o)}),!1);const l={fetchRawOfMessage:function(e,t){return r("fetchRawOfMessage",[e,t])},connectIMAPClient:function(e){return r("connectIMAPClient",[e])},connectIMAPClients:function(){return r("connectIMAPClients",[])},disconnectIMAPClient:function(e){return r("disconnectIMAPClient",[e])},reconnectIMAPClient:function(e){return r("reconnectIMAPClient",[e])},reconnectIMAPClients:function(){return r("reconnectIMAPClients",[])},disconnectIMAPClients:function(){return r("disconnectIMAPClients",[])},checkNewDeletedModified:function(e,t){return r("checkNewDeletedModified",[e,t])},rescanUnreadFlags:function(e,t){return r("rescanUnreadFlags",[e,t])},checkForMail:function(e){return r("checkForMail",[e])},setCheckInterval:function(e,t){return r("setCheckInterval",[e,t])},preFetch:function(e){return r("preFetch",[e])},subscribeMailbox:function(e){return r("subscribeMailbox",[e])},unsubscribeMailbox:function(e,t){return r("unsubscribeMailbox",[e,t])},createMailbox:function(e,t,s){return r("createMailbox",[e,t,s])},deleteMailbox:function(e,t){return r("deleteMailbox",[e,t])},reSyncFolder:function(e,t){return r("reSyncFolder",[e,t])},reSyncAccount:function(e){return r("reSyncAccount",[e])},pausePrefetching:function(e){return r("pausePrefetching",[e])},startAddtoSearchDb:function(){return r("startAddtoSearchDb",[])},getSelectedMailboxes:function(){return r("getSelectedMailboxes",[])}}},75459:(e,t,s)=>{"use strict";s.d(t,{Z:()=>d});s(20244);var n=s(45660),i=s(1407);const a=new Map;let o=0;function r(e,t){return new Promise(((s,n)=>{const i=o++;a.set(i,{resolve:s,reject:n});const r={promiseId:i,func:e,args:t};navigator.serviceWorker?.ready.then((e=>e.active?.postMessage({pop:r})))}))}function l(e){if(e.origin!==i.oP)return;const{pop:t}=e.data;if(!t)return;const{promiseId:s,results:o,error:r}=t,l=a.get(s);if(!l)return void n.Z.error("Mail",["PopActions"],"Missing promise ",s);const{resolve:d,reject:c}=l;a.delete(s),r?c(new Error(r)):d(o)}const d=new class{constructor(){navigator.serviceWorker?.addEventListener("message",l,!1)}checkForMail(e){return r("checkForMail",[e])}deletePopMail(e,t){return r("deletePopMail",[e,t])}getPopMessage(e,t,s){return r("getPopMessage",[e,t,s])}setCheckInterval(e,t){return r("setCheckInterval",[e,t])}}},24325:e=>{e.exports='<svg class="bookmarklet" width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">\n    <path fill-rule="evenodd" clip-rule="evenodd" d="M3 13V2C3 1.44772 3.44772 1 4 1H8.79289C8.9255 1 9.05268 1.05268 9.14645 1.14645L12.8536 4.85355C12.9473 4.94732 13 5.0745 13 5.20711V13C13 13.5523 12.5523 14 12 14H4C3.44772 14 3 13.5523 3 13ZM7.53033 4.96967C7.23744 4.67678 6.76256 4.67678 6.46967 4.96967C6.17678 5.26256 6.17678 5.73744 6.46967 6.03033L8.43934 8L6.46967 9.96967C6.17678 10.2626 6.17678 10.7374 6.46967 11.0303C6.76256 11.3232 7.23744 11.3232 7.53033 11.0303L10.0303 8.53033L10.5607 8L10.0303 7.46967L7.53033 4.96967Z"/>\n</svg>\n'},87922:e=>{e.exports='<svg class="onboarding-illustration" fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 220 164">\n  <g clip-path="url(#clip-0-calendar-density)">\n    <rect class="bg-fill" width="220" height="164" rx="3"/>\n    <g clip-path="url(#clip-1-calendar-density)" class="highlight-fill">\n      <path opacity=".32" fill-rule="evenodd" clip-rule="evenodd" d="M52 0v164h1V0h-1zm113 0v164h1V0h-1z" fill-opacity=".25"/>\n      <path opacity=".3" fill-rule="evenodd" clip-rule="evenodd" d="M-50 19a3 3 0 00-3 3v62a3 3 0 003 3h93a3 3 0 003-3V22a3 3 0 00-3-3h-93zm223 3a3 3 0 013-3h93a3 3 0 013 3v6a3 3 0 01-3 3h-93a3 3 0 01-3-3v-6zM60 78a3 3 0 013-3h93a3 3 0 013 3v62a3 3 0 01-3 3H63a3 3 0 01-3-3V78zm113-28a3 3 0 013-3h93a3 3 0 013 3v34a3 3 0 01-3 3h-93a3 3 0 01-3-3V50zm3 53a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3h-93zm-229 3a3 3 0 013-3h93a3 3 0 013 3v6a3 3 0 01-3 3h-93a3 3 0 01-3-3v-6zm229 25a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3h-93z"/>\n      <rect x="60" y="19" width="99" height="40" rx="3"/>\n    </g>\n  </g>\n  <defs>\n    <clipPath id="clip-0-calendar-density">\n      <rect class="bg-fill" width="220" height="164" rx="3"/>\n    </clipPath>\n    <clipPath id="clip-1-calendar-density">\n      <path class="bg-fill" d="M0 0h220v164H0z" rx="3"/>\n    </clipPath>\n  </defs>\n</svg>\n'},18767:e=>{e.exports='<svg class="onboarding-illustration" fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 220 164">\n  <rect width="220" height="164" rx="3" class="bg-fill"/>\n  <g clip-path="url(#clip-0-calendar-density)" class="highlight-fill">\n    <path opacity=".32" fill-rule="evenodd" clip-rule="evenodd" d="M52 0v164h1V0h-1zm113 0v164h1V0h-1z" fill-opacity=".25"/>\n    <path opacity=".3" fill-rule="evenodd" clip-rule="evenodd" d="M-50 19a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3h-93zm110 3a3 3 0 013-3h93a3 3 0 013 3v6a3 3 0 01-3 3H63a3 3 0 01-3-3v-6zm0 84a3 3 0 013-3h93a3 3 0 013 3v6a3 3 0 01-3 3H63a3 3 0 01-3-3v-6zm3 25a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3H63zM173 22a3 3 0 013-3h93a3 3 0 013 3v6a3 3 0 01-3 3h-93a3 3 0 01-3-3v-6zm0 28a3 3 0 013-3h93a3 3 0 013 3v6a3 3 0 01-3 3h-93a3 3 0 01-3-3v-6zm-223-3a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3h-93zm-3 31a3 3 0 013-3h93a3 3 0 013 3v6a3 3 0 01-3 3h-93a3 3 0 01-3-3v-6zm229 25a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3h-93zm-229 3a3 3 0 013-3h93a3 3 0 013 3v6a3 3 0 01-3 3h-93a3 3 0 01-3-3v-6zm229 25a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3h-93z"/>\n    <rect x="60" y="75" width="99" height="12" rx="3"/>\n  </g>\n  <defs>\n    <clipPath id="clip-0-calendar-density">\n      <path class="bg-fill" d="M0 0h220v164H0z" rx="3"/>\n    </clipPath>\n  </defs>\n</svg>\n'},36502:e=>{e.exports='<svg class="onboarding-illustration" fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 220 164">\n  <g clip-path="url(#clip-calendar-inline-editor)">\n    <rect class="bg-fill" width="220" height="164" rx="3"/>\n    <rect class="highlight-stroke" x="62" y="40" width="97" height="83" rx="3" stroke-width="2"/>\n    <path class="highlight-stroke" opacity=".32" stroke-opacity=".25" d="M53.5 0v164"/>\n    <path class="highlight-stroke" opacity=".32" stroke-opacity=".25" d="M166.5 0v164"/>\n    <path class="highlight-fill" opacity=".1" fill-rule="evenodd" clip-rule="evenodd" d="M-49 19a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3h-93zm113 0a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3H64zm0 112a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3H64zM174 22a3 3 0 013-3h93a3 3 0 013 3v6a3 3 0 01-3 3h-93a3 3 0 01-3-3v-6zm0 28a3 3 0 013-3h93a3 3 0 013 3v6a3 3 0 01-3 3h-93a3 3 0 01-3-3v-6zm-223-3a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3h-93zm223 31a3 3 0 013-3h93a3 3 0 013 3v6a3 3 0 01-3 3h-93a3 3 0 01-3-3v-6zm-223-3a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3h-93zm223 31a3 3 0 013-3h93a3 3 0 013 3v6a3 3 0 01-3 3h-93a3 3 0 01-3-3v-6zm-223-3a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3h-93zm223 31a3 3 0 013-3h93a3 3 0 013 3v6a3 3 0 01-3 3h-93a3 3 0 01-3-3v-6zm-223-3a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3h-93z"/>\n    <path class="highlight-stroke" stroke-opacity=".25" d="M69 54.5h83"/>\n    <path class="highlight-stroke" stroke-opacity=".25" d="M69 67.5h83"/>\n    <path class="highlight-stroke" stroke-opacity=".25" d="M69 80.5h83"/>\n    <path class="highlight-stroke" stroke-opacity=".25" d="M69 93.5h83"/>\n    <rect class="highlight-fill" x="69" y="102" width="41" height="14" rx="2"/>\n    <rect class="highlight-stroke" opacity=".5" x="117" y="103" width="34" height="12" rx="1" stroke-width="2"/>\n  </g>\n  <defs>\n    <clipPath id="clip-calendar-inline-editor">\n      <path class="bg-fill" d="M0 0h220v164H0z"/>\n    </clipPath>\n  </defs>\n</svg>\n'},46647:e=>{e.exports='<svg class="onboarding-illustration" fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 220 164">\n  <rect class="bg-fill" width="220" height="164" rx="3"/>\n  <g clip-path="url(#clip-calendar-popup-editor)">\n    <path class="highlight-stroke" opacity=".32" stroke-opacity=".25" d="M52.5 0v164"/>\n    <path class="highlight-stroke" opacity=".32" stroke-opacity=".25" d="M165.5 0v164"/>\n    <path class="highlight-fill" opacity=".1" fill-rule="evenodd" clip-rule="evenodd" d="M-50 19a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3h-93zm113 0a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3H63zm0 112a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3H63zM173 22a3 3 0 013-3h93a3 3 0 013 3v6a3 3 0 01-3 3h-93a3 3 0 01-3-3v-6zm0 28a3 3 0 013-3h93a3 3 0 013 3v6a3 3 0 01-3 3h-93a3 3 0 01-3-3v-6zm-223-3a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3h-93zm223 31a3 3 0 013-3h93a3 3 0 013 3v6a3 3 0 01-3 3h-93a3 3 0 01-3-3v-6zm-223-3a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3h-93zm223 31a3 3 0 013-3h93a3 3 0 013 3v6a3 3 0 01-3 3h-93a3 3 0 01-3-3v-6zm-223-3a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3h-93zm223 31a3 3 0 013-3h93a3 3 0 013 3v6a3 3 0 01-3 3h-93a3 3 0 01-3-3v-6zm-223-3a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3h-93z"/>\n  </g>\n  <path class="bg-fill" fill-rule="evenodd" clip-rule="evenodd" d="M32 25a3 3 0 00-3 3v102a3 3 0 003 3h74l4.5 4.5 4.5-4.5h74a3 3 0 003-3V28a3 3 0 00-3-3H32z"/>\n  <path class="highlight-fill" d="M106 133l.7-.7-.29-.3H106v1zm4.5 4.5l-.7.7.7.71.7-.7-.7-.71zm4.5-4.5v-1h-.41l-.3.3.71.7zM30 28c0-1.1.9-2 2-2v-2a4 4 0 00-4 4h2zm0 102V28h-2v102h2zm2 2a2 2 0 01-2-2h-2a4 4 0 004 4v-2zm74 0H32v2h74v-2zm5.2 4.8l-4.5-4.5-1.4 1.4 4.5 4.5 1.4-1.4zm3.1-4.5l-4.5 4.5 1.4 1.4 4.5-4.5-1.4-1.4zm74.7-.3h-74v2h74v-2zm2-2a2 2 0 01-2 2v2a4 4 0 004-4h-2zm0-102v102h2V28h-2zm-2-2a2 2 0 012 2h2a4 4 0 00-4-4v2zM32 26h157v-2H32v2z"/>\n  <rect class="highlight-fill" x="41" y="108" width="46" height="14" rx="2"/>\n  <rect class="highlight-stroke" opacity=".5" x="94" y="109" width="44" height="12" rx="1" stroke-width="2"/>\n  <path class="highlight-fill" fill-rule="evenodd" clip-rule="evenodd" d="M41 46h134v-1H41v1zm0 14h134v-1H41v1zm134 14H41v-1h134v1zM41 88h134v-1H41v1z" fill-opacity=".25"/>\n  <defs>\n    <clipPath id="clip-calendar-popup-editor">\n      <path class="bg-fill" d="M0 0h220v164H0z"/>\n    </clipPath>\n  </defs>\n</svg>\n'},9371:e=>{e.exports='<svg width="140" height="96" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <rect x=".5" y=".5" width="139" height="95" rx="1.5" class="border" opacity=".5"/>\n  <g opacity=".3">\n    <path d="M35 0v96h1V0h-1ZM104 0v96h1V0h-1ZM109 9a3 3 0 0 1 3-3h28v12h-28a3 3 0 0 1-3-3V9ZM0 6v12h28a3 3 0 0 0 3-3V9a3 3 0 0 0-3-3H0ZM40 9a3 3 0 0 1 3-3h54a3 3 0 0 1 3 3v6a3 3 0 0 1-3 3H43a3 3 0 0 1-3-3V9ZM112 24a3 3 0 0 0-3 3v6a3 3 0 0 0 3 3h28V24h-28ZM0 24h28a3 3 0 0 1 3 3v6a3 3 0 0 1-3 3H0V24ZM112 42a3 3 0 0 0-3 3v6a3 3 0 0 0 3 3h28V42h-28ZM0 42h28a3 3 0 0 1 3 3v6a3 3 0 0 1-3 3H0V42ZM112 60a3 3 0 0 0-3 3v6a3 3 0 0 0 3 3h28V60h-28ZM0 60h28a3 3 0 0 1 3 3v6a3 3 0 0 1-3 3H0V60ZM112 78a3 3 0 0 0-3 3v6a3 3 0 0 0 3 3h28V78h-28ZM0 78h28a3 3 0 0 1 3 3v6a3 3 0 0 1-3 3H0V78ZM42 78a3 3 0 0 0-3 3v6a3 3 0 0 0 3 3h54a3 3 0 0 0 3-3v-6a3 3 0 0 0-3-3H42Z"/>\n  </g>\n  <rect class="background-intenser" x="40" y="24" width="60" height="48" rx="3"/>\n  <path class="highlight" fill-rule="evenodd" clip-rule="evenodd" d="M43 24a3 3 0 0 0-3 3v42a3 3 0 0 0 3 3h54a3 3 0 0 0 3-3V27a3 3 0 0 0-3-3H43Zm54 1H43a2 2 0 0 0-2 2v42a2 2 0 0 0 2 2h54a2 2 0 0 0 2-2V27a2 2 0 0 0-2-2Z"/>\n  <g class="highlight" opacity=".2">\n    <path d="M49 35h42v-1H49v1ZM49 43h42v-1H49v1ZM91 51H49v-1h42v1Z"/>\n    <path fill-rule="evenodd" clip-rule="evenodd" d="M72 59a1 1 0 0 1 1-1h17a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H73a1 1 0 0 1-1-1v-6Zm1 0h17v6H73v-6Z"/>\n  </g>\n  <rect class="highlight" x="49" y="58" width="21" height="8" rx="1"/>\n</svg>\n'},97487:e=>{e.exports='<svg width="140" height="96" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <rect x=".5" y=".5" width="139" height="95" rx="1.5" class="border" opacity=".5"/>\n  <g opacity=".3">\n    <path d="M35 0v96h1V0h-1ZM104 0v96h1V0h-1ZM109 9a3 3 0 0 1 3-3h28v12h-28a3 3 0 0 1-3-3V9ZM0 6v12h28a3 3 0 0 0 3-3V9a3 3 0 0 0-3-3H0ZM40 9a3 3 0 0 1 3-3h54a3 3 0 0 1 3 3v6a3 3 0 0 1-3 3H43a3 3 0 0 1-3-3V9ZM112 24a3 3 0 0 0-3 3v6a3 3 0 0 0 3 3h28V24h-28ZM0 24h28a3 3 0 0 1 3 3v6a3 3 0 0 1-3 3H0V24ZM112 42a3 3 0 0 0-3 3v6a3 3 0 0 0 3 3h28V42h-28ZM0 42h28a3 3 0 0 1 3 3v6a3 3 0 0 1-3 3H0V42ZM112 60a3 3 0 0 0-3 3v6a3 3 0 0 0 3 3h28V60h-28ZM0 60h28a3 3 0 0 1 3 3v6a3 3 0 0 1-3 3H0V60ZM112 78a3 3 0 0 0-3 3v6a3 3 0 0 0 3 3h28V78h-28ZM0 78h28a3 3 0 0 1 3 3v6a3 3 0 0 1-3 3H0V78ZM42 78a3 3 0 0 0-3 3v6a3 3 0 0 0 3 3h54a3 3 0 0 0 3-3v-6a3 3 0 0 0-3-3H42Z"/>\n  </g>\n  <path class="background-intenser" d="M27 13a3 3 0 0 0-3 3v62a3 3 0 0 0 3 3h40l2.75 2.75L72.5 81H113a3 3 0 0 0 3-3V16a3 3 0 0 0-3-3H27Z"/>\n  <path class="highlight" fill-rule="evenodd" clip-rule="evenodd" d="M23.5 16a3.5 3.5 0 0 1 3.5-3.5h86a3.5 3.5 0 0 1 3.5 3.5v62a3.5 3.5 0 0 1-3.5 3.5H72.707l-2.957 2.957-2.957-2.957H27a3.5 3.5 0 0 1-3.5-3.5V16Zm3.5-2.5a2.5 2.5 0 0 0-2.5 2.5v62a2.5 2.5 0 0 0 2.5 2.5h40.207l2.543 2.543 2.543-2.543H113a2.5 2.5 0 0 0 2.5-2.5V16a2.5 2.5 0 0 0-2.5-2.5H27Z"/>\n  <g class="highlight" opacity=".2">\n    <path d="M105 25H35v-1h70v1ZM105 34H35v-1h70v1ZM35 43h70v-1H35v1ZM105 52H35v-1h70v1Z"/>\n    <path fill-rule="evenodd" clip-rule="evenodd" d="M58 65a1 1 0 0 1 1-1h18a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H59a1 1 0 0 1-1-1v-6Zm1 0h18v6H59v-6Z"/>\n  </g>\n  <rect class="highlight" x="35" y="64" width="21" height="8" rx="1"/>\n</svg>\n'},28888:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 72">\n  <path fill-rule="evenodd" d="M66.27 66.27C60.55 72 51.77 72 36 72c-15.78 0-24.55 0-30.27-5.73C0 60.54 0 51.77 0 36S0 11.46 5.73 5.73C11.45 0 20.23 0 36 0c15.78 0 24.55 0 30.27 5.73C72 11.46 72 20.23 72 36s0 24.54-5.73 30.27zM51.16 20.21c2.79 0 5.05 2.26 5.05 5.05v25.27c0 2.79-2.26 5.05-5.05 5.05H20.84a5.05 5.05 0 01-5.05-5.05V25.26c0-2.79 2.26-5.05 5.05-5.05h2.53v-2.53a2.53 2.53 0 015.05 0v2.53h5.05v-2.53a2.53 2.53 0 015.06 0v2.53h5.05v-2.53a2.53 2.53 0 015.05 0v2.53h2.53zm-2.53 30.32c1.4 0 2.53-1.13 2.53-2.53V30.32c0-1.4-1.13-2.53-2.53-2.53H23.37a2.53 2.53 0 00-2.53 2.53V48c0 1.4 1.13 2.53 2.53 2.53h25.26zM30.95 32.84h-5.06v5.05h5.06v-5.05zm7.58 5.05v-5.05h-5.06v5.05h5.06zm-7.58 2.53h-5.06v5.05h5.06v-5.05zm7.58 5.05v-5.05h-5.06v5.05h5.06zm7.58-12.63h-5.06v5.05h5.06v-5.05zm0 7.58h-5.06v5.05h5.06v-5.05z" opacity=".3"/>\n  <path fill-rule="evenodd" d="M24.9 31.84h7.05v7.05h-7.06v-7.05zm14.63 0v7.05h-7.06v-7.05h7.06zm-14.64 7.58h7.06v7.05h-7.06v-7.05zm14.64 0v7.05h-7.06v-7.05h7.06zm.52-7.58h7.06v7.05h-7.06v-7.05zm0 7.58h7.06v7.05h-7.06v-7.05zM54.76 70.3c4.76-.7 8.15-2.07 10.8-4.73 2.66-2.65 4.04-6.04 4.73-10.8.7-4.8.71-10.84.71-18.76 0-7.92 0-13.97-.7-18.76-.7-4.76-2.08-8.15-4.73-10.8C62.9 3.78 59.52 2.4 54.76 1.7 49.96 1 43.92 1 36 1c-7.92 0-13.97 0-18.76.7-4.76.7-8.15 2.08-10.8 4.74-2.66 2.65-4.04 6.04-4.73 10.8C1 22.04 1 28.08 1 36c0 7.92 0 13.97.7 18.76.7 4.76 2.08 8.15 4.73 10.8 2.66 2.66 6.05 4.04 10.81 4.73 4.8.7 10.84.71 18.76.71 7.92 0 13.97 0 18.76-.7zm-3.6-51.08a6.05 6.05 0 016.05 6.05v25.27a6.05 6.05 0 01-6.05 6.05H20.84a6.05 6.05 0 01-6.05-6.05V25.26a6.05 6.05 0 016.05-6.05h1.53v-1.53a3.53 3.53 0 017.05 0v1.53h3.05v-1.53a3.53 3.53 0 017.06 0v1.53h3.05v-1.53a3.53 3.53 0 017.05 0v1.53h1.53zm-2.53 30.32c.84 0 1.53-.69 1.53-1.53V30.32c0-.85-.69-1.53-1.53-1.53H23.37c-.84 0-1.53.68-1.53 1.53V48c0 .84.69 1.53 1.53 1.53h25.26zM36 72c15.78 0 24.55 0 30.27-5.73C72 60.54 72 51.77 72 36s0-24.54-5.73-30.27C60.55 0 51.77 0 36 0 20.22 0 11.45 0 5.73 5.73 0 11.46 0 20.23 0 36s0 24.54 5.73 30.27C11.45 72 20.23 72 36 72zm20.21-46.74a5.05 5.05 0 00-5.05-5.05h-2.53v-2.53a2.53 2.53 0 00-5.05 0v2.53h-5.05v-2.53a2.53 2.53 0 00-5.06 0v2.53h-5.05v-2.53a2.53 2.53 0 00-5.05 0v2.53h-2.53a5.05 5.05 0 00-5.05 5.05v25.27c0 2.79 2.26 5.05 5.05 5.05h30.32c2.79 0 5.05-2.26 5.05-5.05V25.26zM51.16 48c0 1.4-1.13 2.53-2.53 2.53H23.37A2.53 2.53 0 0120.84 48V30.32c0-1.4 1.13-2.53 2.53-2.53h25.26c1.4 0 2.53 1.13 2.53 2.53V48zM30.95 32.84v5.05h-5.06v-5.05h5.06zm7.58 5.05h-5.06v-5.05h5.06v5.05zm-7.58 2.53v5.05h-5.06v-5.05h5.06zm7.58 5.05h-5.06v-5.05h5.06v5.05zm7.58-12.63v5.05h-5.06v-5.05h5.06zm0 7.58v5.05h-5.06v-5.05h5.06z"/>\n</svg>\n'},46639:e=>{e.exports='\x3c!--  Mask definitions for SVG icons --\x3e\n<defs>\n  \x3c!-- shared paths --\x3e\n  <path id="sync-cloud"\n    d="M13.996 7.172C15.164 7.585 16 8.697 16 10c0 1.657-1.337 3-3.01 3H3.01C1.346 13 0 11.653 0 10c0-1.314.84-2.43 2.022-2.836C2.187 5.942 3.232 5 4.5 5c.667 0 1.272.26 1.72.686C6.765 4.123 8.25 3 10 3c2.21 0 4 1.79 4 4 0 .058 0 .115-.004.172z"/>\n\n  \x3c!-- content blocker --\x3e\n  <path id="shield-shadow" d="M8 14.5c2.432-1.085 4.601-3.009 5.5-5v-7L8 1.5v13z" fill-opacity=".1"/>\n  <path id="shield-outline" d="m8 1.5-5.5 1v7C4 12 5 13 8 14.5c3-1.5 4-2.5 5.5-5v-7L8 1.5z" stroke="currentColor" fill="none"/>\n  <mask id="shield-mask">\n    <path d="M2 11 12 1H2v10zm12-6L4 15h10V5z" fill="#fff"/>\n  </mask>\n\n  \x3c!-- gradients --\x3e\n  <linearGradient id="border-gradient" x1="0" y1="0" x2="0" y2="1">\n    <stop stop-color="#fff" stop-opacity="0.3" offset="0"/>\n    <stop stop-color="#fff" stop-opacity="0.6" offset="1"/>\n  </linearGradient>\n\n  <linearGradient x1="0.15" y1="0.3" x2="0.3" y2="0.5" id="guest-intro-bg-gradient">\n    <stop offset="0" stop-color="var(--colorFg)" stop-opacity="0.03" />\n    <stop offset="1" stop-color="var(--colorFg)" stop-opacity="0.003" />\n  </linearGradient>\n\n  <linearGradient id="private-ghost-gradient" x1="35" y1="0" x2="35" y2="80" gradientUnits="userSpaceOnUse">\n    <stop stop-color="var(--colorFg)" stop-opacity=".8"/>\n    <stop stop-color="var(--colorFg)" offset="1" stop-opacity=".2"/>\n  </linearGradient>\n\n\n  \x3c!-- masks --\x3e\n  <mask id="icon-mask">\n    <path d="M4 14v-12h7v12l-3.5-2.8-3.5 2.8z"\n      stroke="url(#border-gradient)"\n      stroke-width="2"\n      stroke-opacity="1"/>\n  </mask>\n\n  \x3c!-- patterns --\x3e\n  <pattern id="diagonalLinePattern" x="4" y="4" width="8" height="8" patternUnits="userSpaceOnUse" patternTransform="rotate(45)">\n    <rect x="0" y="0" width="4" height="8" style="stroke: none; fill: var(--colorHighlightBg)" />\n  </pattern>\n\n</defs>\n'},12165:e=>{e.exports='<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M13 12C14.1046 12 15 11.1046 15 10V4C15 2.89543 14.1046 2 13 2H3C1.89543 2 1 2.89543 1 4V10C1 11.1046 1.89543 12 3 12H13Z" stroke="currentColor"/>\n<path d="M4 14L12 14" stroke="currentColor" stroke-linecap="round"/>\n<rect opacity="0.5" x="6" y="12" width="4" height="2" fill="currentColor"/>\n<path d="M1 10H15C15 11.1046 14.1046 12 13 12H3C1.89543 12 1 11.1046 1 10Z" fill="currentColor"/>\n</svg>'},36980:e=>{e.exports='<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M10 15C11.1046 15 12 14.1046 12 13V3C12 1.89543 11.1046 1 10 1H6C4.89543 1 4 1.89543 4 3V13C4 14.1046 4.89543 15 6 15H10Z" stroke="currentColor"/>\n<path d="M4 13H12C12 14.1046 11.1046 15 10 15H6C4.89543 15 4 14.1046 4 13Z" fill="currentColor"/>\n<circle cx="8" cy="3.25" r="0.75" fill="currentColor"/>\n</svg>'},11746:e=>{e.exports='<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M11 15C12.1046 15 13 14.1046 13 13V3C13 1.89543 12.1046 1 11 1H5C3.89543 1 3 1.89543 3 3V13C3 14.1046 3.89543 15 5 15H11Z" stroke="currentColor"/>\n<path d="M3 2C3 1.44772 3.44772 1 4 1H12C12.5523 1 13 1.44772 13 2V3H3V2Z" fill="currentColor"/>\n<path d="M3 14C3 14.5523 3.44772 15 4 15H12C12.5523 15 13 14.5523 13 14V13H3V14Z" fill="currentColor"/>\n</svg>\n'},70942:e=>{e.exports='<svg width="12" height="12" xmlns="http://www.w3.org/2000/svg">\n  <path fill-rule="evenodd" clip-rule="evenodd" d="M10.146 5.146 8.854 3.854l-3 3a.5.5 0 1 1-.708-.708l3-3-1.292-1.292A.5.5 0 0 1 7.207 1H11v3.793a.5.5 0 0 1-.854.353ZM1.5 2A1.5 1.5 0 0 0 0 3.5v7A1.5 1.5 0 0 0 1.5 12h7a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0v2a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1-.5-.5v-7a.5.5 0 0 1 .5-.5h3a.5.5 0 0 0 0-1h-3Z"/>\n</svg>\n'},89182:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 72">\n  <path fill-opacity=".3" fill-rule="evenodd" d="M66.27 66.27C60.55 72 51.77 72 36 72c-15.78 0-24.55 0-30.27-5.73C0 60.54 0 51.77 0 36S0 11.46 5.73 5.73C11.45 0 20.23 0 36 0c15.78 0 24.55 0 30.27 5.73C72 11.46 72 20.23 72 36s0 24.54-5.73 30.27zm-7.6-13.73H13.19a3.8 3.8 0 01-3.79-3.79V27.57l26.22 14.9 26.84-15.41v21.7a3.8 3.8 0 01-3.8 3.78zM13.19 19.07a3.8 3.8 0 00-3.66 2.82L35.61 36.7l26.57-15.26a3.8 3.8 0 00-3.51-2.38H13.19z"/>\n  <path fill-rule="evenodd" d="M8.4 25.85l27.22 15.47 27.84-16v23.43a4.8 4.8 0 01-4.8 4.8H13.2a4.8 4.8 0 01-4.79-4.8v-22.9zm27.22 16.62L9.4 27.57v21.18a3.8 3.8 0 003.8 3.8h45.47a3.8 3.8 0 003.79-3.8v-21.7L35.62 42.48zM8.37 22.37l.2-.74a4.8 4.8 0 014.62-3.56h45.48a4.8 4.8 0 014.44 3l.33.81L35.6 37.87 8.37 22.37zM54.76 70.3c4.76-.7 8.15-2.07 10.8-4.73 2.66-2.65 4.04-6.04 4.73-10.8.7-4.8.71-10.84.71-18.76 0-7.92 0-13.97-.7-18.76-.7-4.76-2.08-8.15-4.73-10.8C62.9 3.78 59.52 2.4 54.76 1.7 49.96 1 43.92 1 36 1c-7.92 0-13.97 0-18.76.7-4.76.7-8.15 2.08-10.8 4.74-2.66 2.65-4.04 6.04-4.73 10.8C1 22.04 1 28.08 1 36c0 7.92 0 13.97.7 18.76.7 4.76 2.08 8.15 4.73 10.8 2.66 2.66 6.05 4.04 10.81 4.73 4.8.7 10.84.71 18.76.71 7.92 0 13.97 0 18.76-.7zM35.61 36.71L9.53 21.9a3.8 3.8 0 013.66-2.82h45.48a3.8 3.8 0 013.51 2.38L35.61 36.7zM36 72c15.78 0 24.55 0 30.27-5.73C72 60.54 72 51.77 72 36s0-24.54-5.73-30.27C60.55 0 51.77 0 36 0 20.22 0 11.45 0 5.73 5.73 0 11.46 0 20.23 0 36s0 24.54 5.73 30.27C11.45 72 20.23 72 36 72z"/>\n</svg>\n'},51491:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 70 80">\n  <path d="M35.002 0c-.772 0-1.549.028-2.33.083-8.999.87-17.366 5.457-23.425 12.843C3.188 20.312-.113 29.951.003 39.91v33.27c-.001.482.084.96.252 1.406.167.446.414.851.724 1.192.31.34.679.61 1.084.792a3.045 3.045 0 002.535-.01 3.25 3.25 0 001.061-.797c.82-.905 1.933-1.413 3.093-1.413s2.273.508 3.094 1.413l2.563 2.825c.82.905 1.933 1.413 3.093 1.413s2.273-.508 3.094-1.413l2.562-2.825c.82-.905 1.933-1.413 3.094-1.413 1.16 0 2.273.508 3.093 1.413l2.563 2.825C32.728 79.492 33.84 80 35 80s2.273-.508 3.094-1.413l2.563-2.825c.82-.905 1.933-1.413 3.093-1.413s2.273.508 3.093 1.413l2.563 2.825c.82.905 1.933 1.413 3.094 1.413 1.16 0 2.273-.508 3.093-1.413l2.563-2.825c.82-.905 1.933-1.413 3.093-1.413s2.273.508 3.094 1.413c.302.34.662.611 1.06.796a3.042 3.042 0 002.535.01 3.305 3.305 0 001.085-.791c.31-.34.557-.746.724-1.192.168-.445.253-.924.252-1.406V38.587c0-10.234-3.688-20.048-10.251-27.285C53.185 4.066 44.284 0 35 0zm-8.75 36.176c0 1.43-.385 2.83-1.106 4.02-.721 1.189-1.746 2.116-2.945 2.664-1.2.547-2.519.69-3.792.412-1.272-.28-2.442-.969-3.36-1.98-.917-1.012-1.542-2.302-1.795-3.705a7.927 7.927 0 01.373-4.18c.497-1.322 1.338-2.452 2.417-3.247a6.137 6.137 0 013.646-1.22c1.74 0 3.41.763 4.64 2.12 1.23 1.356 1.922 3.197 1.922 5.116zm30.624 0c0 1.43-.385 2.83-1.106 4.02-.722 1.189-1.746 2.116-2.945 2.664-1.2.547-2.519.69-3.792.412-1.273-.28-2.442-.969-3.36-1.98-.918-1.012-1.543-2.302-1.796-3.705a7.928 7.928 0 01.374-4.18c.496-1.322 1.337-2.452 2.417-3.247a6.137 6.137 0 013.645-1.22c1.74 0 3.41.763 4.64 2.12 1.231 1.356 1.923 3.197 1.923 5.116z" fill="url(#private-ghost-gradient)"/>\n</svg>\n'},48783:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12">\n  <path d="M10 0H2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zM5 9H3V3h2zm4 0H7V3h2z"/>\n</svg>'},55592:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 72">\n  <path fill-rule="evenodd" d="M66.27 66.27C60.55 72 51.77 72 36 72c-15.78 0-24.55 0-30.27-5.73C0 60.54 0 51.77 0 36S0 11.46 5.73 5.73C11.45 0 20.23 0 36 0c15.78 0 24.55 0 30.27 5.73C72 11.46 72 20.23 72 36s0 24.54-5.73 30.27zM52.71 54.32a2.8 2.8 0 002.86-2.97A38.63 38.63 0 0020.02 15.8a2.8 2.8 0 00-2.97 2.86v.3a3.2 3.2 0 002.97 3.1A32.38 32.38 0 0149.3 51.36a3.2 3.2 0 003.1 2.97h.31zm-23.77-5.95a5.94 5.94 0 11-11.89 0 5.94 5.94 0 0111.89 0zm14.7 2.98c.18 1.63-1.17 2.97-2.81 2.97h-.25c-1.64 0-2.95-1.34-3.19-2.97a20.55 20.55 0 00-17.38-17.37c-1.62-.24-2.96-1.55-2.96-3.19v-.25c0-1.64 1.34-2.99 2.97-2.8a26.74 26.74 0 0123.61 23.61z" opacity=".3"/>\n  <path fill-rule="evenodd" d="M54.76 70.3c4.76-.7 8.15-2.08 10.8-4.73 2.66-2.66 4.04-6.05 4.73-10.81.7-4.8.71-10.84.71-18.76 0-7.92 0-13.97-.7-18.76-.7-4.76-2.08-8.15-4.73-10.8C62.9 3.78 59.52 2.4 54.76 1.7 49.96 1 43.92 1 36 1c-7.92 0-13.97 0-18.76.7-4.76.7-8.15 2.08-10.8 4.74-2.66 2.65-4.04 6.04-4.73 10.8C1 22.04 1 28.08 1 36c0 7.92 0 13.97.7 18.76.7 4.76 2.08 8.15 4.73 10.8 2.66 2.66 6.05 4.04 10.81 4.73 4.8.7 10.84.71 18.76.71 7.92 0 13.97 0 18.76-.7zm1.8-19.03a3.8 3.8 0 01-3.85 4.05h-.3a4.2 4.2 0 01-4.1-3.88 31.38 31.38 0 00-28.38-28.38 4.2 4.2 0 01-3.88-4.1v-.3a3.8 3.8 0 014.05-3.86 39.63 39.63 0 0136.47 36.47zm-26.62-2.9a6.94 6.94 0 11-13.89 0 6.94 6.94 0 0113.89 0zm14.69 2.87c.25 2.3-1.64 4.08-3.8 4.08h-.25c-2.22 0-3.88-1.8-4.18-3.82a19.55 19.55 0 00-16.53-16.53c-2.03-.3-3.82-1.96-3.82-4.18v-.25c0-2.16 1.78-4.05 4.08-3.8a27.75 27.75 0 0124.5 24.5zM36 72c15.78 0 24.55 0 30.27-5.73C72 60.54 72 51.77 72 36s0-24.54-5.73-30.27C60.55 0 51.77 0 36 0 20.22 0 11.45 0 5.73 5.73 0 11.46 0 20.23 0 36s0 24.54 5.73 30.27C11.45 72 20.23 72 36 72zm19.57-20.65a2.8 2.8 0 01-2.86 2.97h-.3a3.2 3.2 0 01-3.1-2.97 32.38 32.38 0 00-29.29-29.28 3.2 3.2 0 01-2.97-3.11v-.3a2.8 2.8 0 012.97-2.86 38.63 38.63 0 0135.55 35.55zM23 54.32a5.94 5.94 0 100-11.9 5.94 5.94 0 000 11.9zm17.83 0c1.64 0 2.99-1.34 2.8-2.97a26.75 26.75 0 00-23.61-23.61c-1.63-.19-2.97 1.16-2.97 2.8v.25c0 1.64 1.34 2.95 2.96 3.19A20.55 20.55 0 0137.4 51.35c.24 1.63 1.55 2.97 3.19 2.97h.25z"/>\n</svg>\n'},71665:e=>{e.exports='<svg opacity=".7" fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 140 126" width="140" height="126">\n  <circle opacity=".2" cx="67" cy="63" r="55" fill="var(--colorFgFadedMost)"/>\n  <circle opacity=".2" cx="67" cy="63" r="59" stroke="var(--colorFgFadedMost)" stroke-width="2" stroke-dasharray="6 6"/>\n  <rect x="12" y="21" width="111" height="77" rx="4" fill="var(--colorBg)" stroke="var(--colorFgFadedMost)" stroke-width="2"/>\n  <path d="M4 98h128v1a6 6 0 0 1-6 6H10a6 6 0 0 1-6-6v-1Z" fill="var(--colorBgDark)" stroke="var(--colorFgFadedMost)" stroke-width="2"/>\n  <rect x="100" y="42" width="36" height="70" rx="4" fill="var(--colorBgDarker)" stroke="var(--colorFgFadedMost)" stroke-width="2"/>\n  <rect x="111" y="45" width="15" height="3" rx="1.5" fill="var(--colorFgFadedMost)"/>\n  <path d="M31.25 79.005V68.25a2 2 0 0 1 2-2h5.5a2 2 0 0 1 2 2v10.755a.25.25 0 0 1-.398.202L36 76l-4.352 3.207a.25.25 0 0 1-.398-.202Z" stroke="var(--colorFgFadedMore)" stroke-width="1.5"/>\n  <path d="M67.75 66.25h-6.5a2 2 0 0 0-2 2v9.5a2 2 0 0 0 2 2h5.5a2 2 0 0 0 2-2v-.25" stroke="var(--colorFgFadedMore)" stroke-width="1.5" stroke-linecap="round"/>\n  <path d="M63.75 76.25v-2l5.74-5.74a1.427 1.427 0 0 1 2.038 2L66 76.25h-2.25Z" stroke="var(--colorFgFadedMore)" stroke-width="1.5"/>\n  <path stroke="var(--colorFgFadedMore)" d="m68.354 70.646 2 2"/>\n  <path d="M29.75 38.75h4.75a1.5 1.5 0 0 1 1.5 1.5v9a1 1 0 0 1-1 1h-5.25a1 1 0 0 1-1-1v-9.5a1 1 0 0 1 1-1ZM37.5 38.752h4.75a1 1 0 0 1 1 1v9.498a1 1 0 0 1-1 1H37a1 1 0 0 1-1-1v-8.998a1.5 1.5 0 0 1 1.5-1.5ZM35 50.25c.333.566 1.2 1.358 2 0" stroke="var(--colorFgFadedMore)" stroke-width="1.5"/>\n  <path opacity=".35" stroke="var(--colorFgFadedMore)" stroke-linecap="round" d="M31 41.5h3M38 41.5h3M31 43.5h3M38 43.5h3M31 45.5h3M38 45.5h3M31 47.5h3M38 47.5h3"/>\n  <path d="M64.5 39.25h-4.25a2 2 0 0 0-2 2v7.5a2 2 0 0 0 2 2h7.5a2 2 0 0 0 2-2V46.5" stroke="var(--colorFgFadedMore)" stroke-width="1.5" stroke-linecap="round"/>\n  <path d="m61.5 43.5 3 3 6-8" stroke="var(--colorFgFadedMore)" stroke-width="1.5" stroke-linecap="round"/>\n  <path d="M123.996 72.172A2.998 2.998 0 0 1 122.99 78h-9.98a3.006 3.006 0 0 1-3.01-3c0-1.314.84-2.43 2.022-2.836a2.5 2.5 0 0 1 4.198-1.478A4.004 4.004 0 0 1 120 68c2.21 0 4 1.79 4 4l-.004.172Z" fill="var(--colorFg)"/>\n</svg>\n'},86484:e=>{e.exports='<svg width="196" height="32" xmlns="http://www.w3.org/2000/svg">\n  <rect class="border" x=".5" y=".5" width="195" height="31" rx="1.5" />\n  <path class="highlight" fill-rule="evenodd" d="M109 13h-8v8h8v-8zm-9-1v10h10V12h-10z"/>\n  <path fill-rule="evenodd" d="M9 9H1v16h8V9zM0 8v18h10V8H0z" class="border"/>\n  <path class="highlight" d="M12 25V6h1v19z"/>\n  <path class="highlight" fill-rule="evenodd" d="M177 25V7H12V6h173v19h10v1H93V9H15v17H1v-1h13V8h80v17h2V8h80v17h1zM97 9h78v16H97V9zm-79 4h8v8h-8v-8zm-1 9V12h10v10H17zm165-8.598L179 16l3 2.598v-5.196z"/>\n</svg>\n'},18998:e=>{e.exports='<svg width="196" height="32" xmlns="http://www.w3.org/2000/svg">\n  <rect x=".5" y=".5" width="195" height="31" rx="1.5" class="border"/>\n  <path fill-rule="evenodd" clip-rule="evenodd" d="M1 9h8v16H1V9zM0 26V8h10v18H0zM177 9H97v16h80V9zM96 8v18h82V8H96zm13 5h-8v8h8v-8zm-9-1v10h10V12h-10z"/>\n  <path class="highlight" fill-rule="evenodd" clip-rule="evenodd" d="M25 13h-8v8h8v-8zm-9-1v10h10V12H16z"/>\n  <path class="highlight" fill-rule="evenodd" clip-rule="evenodd" d="M13 9h80v17h1V8H12v18h1V9z"/>\n  <path class="highlight" d="M94 25h101v1H94zM1 25h11v1H1zM13 5h26v3H13zM40 5h26v2H40zM67 5h26v2H67z"/>\n</svg>\n'},86681:e=>{e.exports='<svg width="196" height="48" xmlns="http://www.w3.org/2000/svg">\n  <path class="border" d="M2 .5h192a1.5 1.5 0 011.5 1.5v44a1.5 1.5 0 01-1.5 1.5H2A1.5 1.5 0 01.5 46V2A1.5 1.5 0 012 .5z"/>\n  <path fill-rule="evenodd" clip-rule="evenodd" d="M4 28h80v16H4V28zM3 45V27h82v18H3zm5-13h8v8H8v-8zm-1 9V31h10v10H7zm161-13H88v16h80V28zm-81-1v18h82V27H87zm5 5h8v8h-8v-8zm-1 9V31h10v10H91zm93-9h-8v8h8v-8zm-9-1v10h10V31h-10zm-4-4h24v1h-23v16h23v1h-24V27z" class="highlight"/>\n  <path fill-rule="evenodd" clip-rule="evenodd" d="M9 8H1v16h8V8zM0 7v18h10V7H0z"/>\n  <path fill-rule="evenodd" clip-rule="evenodd" d="M25 12h-8v8h8v-8zm-9-1v10h10V11H16z" class="highlight"/>\n  <path fill-rule="evenodd" clip-rule="evenodd" d="M97 8h80v16H97V8zm-1 17V7h82v18H96zm5-13h8v8h-8v-8zm-1 9V11h10v10h-10z"/>\n  <path class="highlight" d="M93 24h103v1H93z"/>\n  <path class="highlight" d="M1 24h12v1H1z"/>\n  <g class="default-style">\n    <path fill-rule="evenodd" clip-rule="evenodd" class="highlight" d="M92 9H14v14h78V9zM14 7a2 2 0 00-2 2v14a2 2 0 002 2h78a2 2 0 002-2V9a2 2 0 00-2-2H14z"/>\n    <path opacity=".25" d="M90 11H80v10h10V11z" class="highlight"/>\n  </g>\n  <g class="dotted-style">\n    <path d="M39 4H13V7H12V25H13V8H93V25H94V7H39V4Z" class="highlight"/>\n    <path d="M66 4H40V6H66V4Z" class="highlight"/>\n    <path d="M67 4H93V6H67V4Z" class="highlight"/>\n  </g>\n</svg>\n'},85382:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">\n  <path fill-rule="evenodd" clip-rule="evenodd" d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8Zm2.5-4a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0Z"/>\n</svg>'},33271:e=>{e.exports='<svg width="196" height="32" xmlns="http://www.w3.org/2000/svg">\n  <path class="border" d="M2 .5h192a1.5 1.5 0 011.5 1.5v28a1.5 1.5 0 01-1.5 1.5H2A1.5 1.5 0 01.5 30V2A1.5 1.5 0 012 .5z"/>\n  <path d="M1 24h12v1H1z"/>\n  <path fill-rule="evenodd" clip-rule="evenodd" d="M0 25V7h10v18H0zM1 8h8v16H1V8zM100 11v10h10V11h-10zm9 1h-8v8h8v-8z"/>\n  <path fill-rule="evenodd" clip-rule="evenodd" d="M13 8h80v17h102v-1h-17V7H96v17h-2V7H12v18h1V8zm84 16h80V8H97v16z"/>\n  <path fill-rule="evenodd" clip-rule="evenodd" d="M16 11v10h10V11H16zm9 1h-8v8h8v-8z"/>\n  <path fill="var(--colorBg)" d="M166 6a2 2 0 012-2h11a2 2 0 012 2v11a2 2 0 01-2 2h-11a2 2 0 01-2-2V6z"/>\n  <path class="highlight" fill-rule="evenodd" clip-rule="evenodd" d="M179 5h-11a1 1 0 00-1 1v11a1 1 0 001 1h11a1 1 0 001-1V6a1 1 0 00-1-1zm-11-1a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2V6a2 2 0 00-2-2h-11z"/>\n  <path class="highlight" d="M170 7h8v8l-8-8z"/>\n</svg>\n'},38151:e=>{e.exports='<svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">\n  <path d="M16 32c7.011 0 10.91 0 13.454-2.546C32 26.91 32 23.011 32 16c0-7.011 0-10.909-2.546-13.454C26.91 0 23.011 0 16 0 8.989 0 5.091 0 2.546 2.546 0 5.09 0 8.989 0 16c0 7.01 0 10.909 2.546 13.454C5.09 32 8.989 32 16 32" fill="#4c70f0"/>\n  <path d="M23.547 12.942c-1.957 3.406-3.917 6.81-5.87 10.217-.364.633-.892 1.016-1.616 1.068-.811.06-1.448-.283-1.857-.987-1.239-2.135-2.463-4.278-3.693-6.417-.748-1.302-1.499-2.602-2.243-3.905-.752-1.315.096-2.913 1.603-2.99.796-.042 1.41.325 1.814 1.018.552.947 1.094 1.9 1.64 2.85.395.684.78 1.374 1.186 2.05.586.984 1.449 1.538 2.597 1.607a3.163 3.163 0 0 0 3.328-2.812c.015-.13.024-.259.03-.325-.009-.56-.113-1.033-.335-1.478-.607-1.217.04-2.581 1.358-2.874 1.074-.238 2.186.553 2.328 1.645.062.48-.032.92-.27 1.333m.71-5.463c-4.634-4.639-12.147-4.639-16.781 0-4.635 4.638-4.635 12.158 0 16.795 4.634 4.638 12.147 4.638 16.782 0 4.634-4.637 4.634-12.157 0-16.795" fill="#fff"/>\n</svg>\n'},34511:e=>{e.exports='<svg width="220" height="140" viewBox="0 0 220 140" xmlns="http://www.w3.org/2000/svg">\n  <path fill="var(--colorBg)" d="M0 0H220V140H0V0Z"/>\n  <path class="active-tab-preview" d="M0 114H220V140H0V114Z"/>\n  <path fill="var(--colorAccentFg)" d="M6 120H75V134H6V120Z"/>\n  <path fill="var(--colorAccentFgAlpha)" d="M76 120H144V134H76V120ZM145 120H214V134H145V120Z"/>\n</svg>\n'},31614:e=>{e.exports='<svg width="220" height="140" viewBox="0 0 220 140" xmlns="http://www.w3.org/2000/svg">\n  <path fill="var(--colorBg)" d="M3 0H217C217.796 0 218.559 0.283653 219.121 0.788559C219.684 1.29346 220 1.97826 220 2.69231V140H0V2.69231C0 1.97826 0.31607 1.29346 0.87868 0.788559C1.44129 0.283653 2.20435 0 3 0V0Z"/>\n  <path class="active-tab-preview" d="M0 0H81V140H0V0Z" rx="10px" ry="10px"/>\n  <path fill="var(--colorAccentFg)" d="M6 6H75V20H6V6Z"/>\n  <path fill="var(--colorAccentFgAlpha)" d="M6 21H75V35H6V21ZM6 36H75V50H6V36Z"/>\n</svg>\n'},76201:e=>{e.exports='<svg width="220" height="140" viewBox="0 0 220 140" xmlns="http://www.w3.org/2000/svg">\n  <path fill="var(--colorBg)" d="M3 0H217C217.796 0 218.559 0.283653 219.121 0.788559C219.684 1.29346 220 1.97826 220 2.69231V140H0V2.69231C0 1.97826 0.31607 1.29346 0.87868 0.788559C1.44129 0.283653 2.20435 0 3 0V0Z"/>\n  <path class="active-tab-preview" d="M139 0H220V140H139V0Z"/>\n  <path fill="var(--colorAccentFg)" d="M145 6H214V20H145V6Z"/>\n  <path fill="var(--colorAccentFgAlpha)" d="M145 21H214V35H145V21ZM145 36H214V50H145V36Z"/>\n</svg>\n'},48753:e=>{e.exports='<svg width="220" height="140" viewBox="0 0 220 140" xmlns="http://www.w3.org/2000/svg">\n  <path fill="var(--colorBg)" d="M3 0h214a3.18 3.18 0 0 1 2.121.789c.563.504.879 1.19.879 1.903V140H0V2.692C0 1.978.316 1.293.879.79A3.183 3.183 0 0 1 3 0Z"/>\n  <path class="active-tab-preview" d="M0 0h220v26H0V0Z"/>\n  <path fill="var(--colorAccentFg)" d="M6 6h69v14H6V6Z"/>\n  <path fill="var(--colorAccentFgAlpha)" d="M76 6h68v14H76V6Zm69 0h69v14h-69V6Z"/>\n</svg>\n'},76259:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 116 116">\n  <path fill="#ef3939" d="M58 115c25 0 38.9 0 47.9-9.1C115 96.9 115 83 115 58s0-38.9-9.1-47.9C96.9 1 83 1 58 1s-38.9 0-47.9 9.1C1 19.1 1 33 1 58s0 38.9 9.1 47.9C19.1 115 33 115 58 115z"/>\n  <linearGradient id="a" x1="36.55" x2="91.02" y1="21.06" y2="115.39" gradientUnits="userSpaceOnUse">\n    <stop offset="0" stop-opacity=".2"/>\n    <stop offset=".79" stop-opacity=".05"/>\n  </linearGradient>\n  <path fill="url(#a)" d="M95.1 36.9A42.7 42.7 0 1 0 21.2 80l20.1 34.8 10.8.1h5.7c11.1 0 20 0 27.3-.8 9.1-1 15.6-3.2 20.7-8.3 7.3-7.3 8.7-17.9 9-34.9a3101.9 3101.9 0 0 1-19.7-34z"/>\n  <path fill="#fff" d="M88 27.8a42.7 42.7 0 1 0-60.3 60.5A42.7 42.7 0 1 0 88 27.8zm-2.5 19.7L64.4 84.2c-1.3 2.3-3.2 3.7-5.8 3.8-2.9.2-5.2-1-6.7-3.6L38.6 61.3l-8.1-14a7.1 7.1 0 0 1 5.8-10.8 6.8 6.8 0 0 1 6.5 3.7l5.9 10.3 4.3 7.4c2.1 3.5 5.2 5.5 9.3 5.8 5.8.3 11.3-3.9 12-10.1l.1-1.2c0-2-.4-3.7-1.2-5.3a7 7 0 0 1 4.9-10.3 7 7 0 0 1 8.4 5.9 8 8 0 0 1-1 4.8z"/>\n</svg>\n'},51759:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 10 10">\n  <path d="M10.2.5l-.7-.7L5 4.3.5-.2l-.7.7L4.3 5-.2 9.5l.7.7L5 5.7l4.5 4.5.7-.7L5.7 5"/>\n</svg>\n'},9592:e=>{e.exports='<svg class="window-maximize" xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 10 10">\n\n  <g class="window-maximize-glyph">\n    <path fill-rule="evenodd" d="M8.5 1h-7a.5.5 0 0 0-.5.5v7a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.5-.5zm-7-1A1.5 1.5 0 0 0 0 1.5v7A1.5 1.5 0 0 0 1.5 10h7A1.5 1.5 0 0 0 10 8.5v-7A1.5 1.5 0 0 0 8.5 0h-7z"/>\n  </g>\n\n  <g class="window-restore-glyph">\n    <path d="M3.618 0C2.933 0 2.306.387 2 1h5a2 2 0 0 1 2 2v5c.613-.306 1-.933 1-1.618V3a3 3 0 0 0-3-3H3.618z"/>\n    <path fill-rule="evenodd" d="M6.5 10A1.5 1.5 0 0 0 8 8.5v-5A1.5 1.5 0 0 0 6.5 2h-5A1.5 1.5 0 0 0 0 3.5v5A1.5 1.5 0 0 0 1.5 10h5zM7 8.5a.5.5 0 0 1-.5.5h-5a.5.5 0 0 1-.5-.5v-5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 .5.5v5z"/>\n  </g>\n</svg>\n'},96375:e=>{e.exports='<svg width="10" height="10" viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg">\n  <path d="M0 5H10V6H0V5Z"/>\n</svg>\n'},62077:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});const n="iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAACfSURBVHgBvZIxCgMhEEXHkEZPscex1s7LZHMWwU5bvU1yCW3NuoEQwoy6BPY1Mvh9OirAn7Dvwhjz2IYFya3OuTsmuPzUC+Csm/w2I+iBSo4IUAkpkFKC1hqVTAkaSilK8uFKTaSUQAixC0opEGNEc90TMPZ+Zc45mSEFbefWgvceQgikgGwh5wzW2r2VHt07mOHoPxgKnqMFtdZh5lxeJo4r4FiF0c8AAAAASUVORK5CYII="},72536:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});const n="iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAACfSURBVHgBvZIxCgMhEEXHkEZPscex1s7LZHMWwU5bvU1yCW3NuoEQwoy6BPY1Mvh9OirAn7Dvwhjz2IYFya3OuTsmuPzUC+Csm/w2I+iBSo4IUAkpkFKC1hqVTAkaSilK8uFKTaSUQAixC0opEGNEc90TMPZ+Zc45mSEFbefWgvceQgikgGwh5wzW2r2VHt07mOHoPxgKnqMFtdZh5lxeJo4r4FiF0c8AAAAASUVORK5CYII="},26591:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});const n="iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAyUlEQVR42q3TvQrCMBDAcV+ro7vvURx9AXVyaUGwuzinfsw66OYD+AJ2K21DUlooDaXEXOGki7mCDfy4G5L/lslsvvjLuAFz1j9MBwe01queped5F8dxthAZGti0bfvFGHsIISRGyEDTNDsjAEqpAALanH7EGqjr+tDnuu4+DMM78H3/DHesgaqqjhYnMlCW5bUoihuAHSciA+bBM8/zDuw4cScDUsqXDRngnL9RlmURTtzJQJIkPE3TDuw4ERmI41jZkIEhRv2NH2DDzUU+EiSYAAAAAElFTkSuQmCC"},86635:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});const n="iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAqUlEQVR4AWP4z4gfElbAYMNQw9AAhSkMzBgKgNIiDOxQGMXgg6mgQYVdBSgJwgx8DLkMtUiwgsEXqKCBBwGTeKP5ENBbkKEBpEAAAftBGEKC+WAFlaK4IVhBjhQCFkiCMAKCFYTKIWCELAhHyMbJgXCcHFiBk7KTsicYI6CLEgi7KIEV6KnrqauDMAJARIAQpKCWz1RQBzvkMgWGBYMjkGjADoEyjpTHJgCRpZrxxM2tswAAAABJRU5ErkJggg=="},68551:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});const n="iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAZElEQVR42mNgoBj8if/9/vd/MHz/ux6Lgl/3//j+NwbBP76/n/2u/y+ApuD3f4g0VMlmqGlg+Of+n3gUBejwj+/v93gV/Df+/X+IKHgPCyhs3vxzn+FXwq/7yIGDAt//SqA8MgF9hfa1XsQ+LgAAAABJRU5ErkJggg=="},13253:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});const n="iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfiAxMIBBzsKlp7AAAA6klEQVQoz42RP04CURDGf8MObmyk8QSElhtQYGdBYSgJhhvABTCEI+AFJJGaUEDiRewojKEBJWGzBXlRGQoWeKsJOJN5k5l8b/59YsJJyXBGhBJlNIlmPNnmN6TNNWGiNSomaVW0EMOUAlMY05C29/mLV4V69pDYvPedN/QqmLQUDhMARSJyQESOCGyCgjtWYJHY/gWF2AOofYuav4PC3GsR2I+MeoDcNUePQF5hmYUQR5iALAMQXexurPCp4AhxKcCb7rzwcPUSrP2uR3bc5fpWuKFEkLptFYAhVYwP+cumDAA6993nf7G5BYxPRUIY3xtuAAAAAElFTkSuQmCC"},89661:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});const n="iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAbElEQVR42mNgoBj8if/9/vd/MHz/ux6Lgl/3//j+NwbBP76/n/2u/y+ApuD3f4g0VMlmqGlg+Of+n3gUBejwj+/v93gV/Df+/Z90BRi+wFQAcSCcpoKC97CAwuGGXwm/7iMHDoYJDFicTZICAK40+w1CznHyAAAAAElFTkSuQmCC"},94420:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});const n="iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAD5SURBVHgBtVHBDYJAEOTQvz59WoJvIPFKwA6kEqES7UCtAPwQflqCDwrgSUIAZ8iRXIAE0DjJZfcuO3O7s4bxIxZziqWU6w2QpmnWvpkzyNuiKJ6maYaWZe1mC4B8ruv6gvSAc2U3kwUcx/EZ4zgO0IHLPM/zRkAMFMuqqvbtXQixxs8uiB7iiW9lWXpJkryZL7sCJIMkURzxjkjDAsRmBHah1/cEgDsKj4wofvEBpvHnW5dM9DxQpMYo3W3ViTEqQA9U2hMZFeCuOSs8CHURejJJgLtGoEiGs2rHoaHYwmNIQGit+2pNkb6mSWDrtm3Xyu3vMGbW3/ABNRKFPPHD6XUAAAAASUVORK5CYII="},1810:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});const n="iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAMFBMVEX///+/v7/Hx8e/v7/ExMTFxcXFxcXExMTFxcXDw8PDw8PExMTFxcXExMTExMTGxsbQpf+eAAAAEHRSTlMAECAg398wv3+AQI9g7/8/FKJcHQAAAFFJREFUeAFjQAWMClCGSRiUUZEqAKY5C6aC5FZ0bF1eBOK3d/R4gCVSEzg2gBlsYRwNYMay1Awwg9k3LRzMYH/6IWMBiDEPqBUs8wJmYQKaAwANFhLITP6v6wAAAABJRU5ErkJggg=="},50012:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});const n="iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAABtSURBVHgBvZJLCsAgDERj8SD2Gnp+vYbeJDXQRQlNiB98C7NweAwkAIs4elJKtY8ghRCxlVJu0dIFCAra/wVGSBJjrNOCnLPrhGmB1GRYwJsMCzjLAv/Opq2K7gAsWO/hm/Msc7bJX4O9TY7wAFQ4MpFfIoDNAAAAAElFTkSuQmCC"},32782:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});const n="iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAPElEQVR42mNgIAyO3D/yHxkevY+u4D9+PhYFaKZgMwFFDLsCJFNwmQAXp4ICLOFApEMJhCYRAUZqnJAJALGlehnFYWcIAAAAAElFTkSuQmCC"},54189:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});const n="iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAABYSURBVHgB7ZLdCcAgDIQvpYO0c2T+ZI26SWofCgriDwqC+L3kOMiFkACzoV8w8+PLVdNkZk5V78j0AVbSKe9AJ5SblENEKDJaAoausAOAM9Cu9hLfJ2IdXuDHHKAeH9NrAAAAAElFTkSuQmCC"},70025:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});const n="iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAALElEQVR42mNgoAo4cv/If0x49D5CwX90EpVFjALskAGLWmSXDTUFhEKStgAAWEdiK3NU7WoAAAAASUVORK5CYII="},57049:e=>{"use strict";e.exports=JSON.parse('{"t":[{"title":"Vivaldi Browser Help Center","url":"https://help.vivaldi.com/","faviconUrl":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAKQ2lDQ1BJQ0MgcHJvZmlsZQAAeNqdU3dYk/cWPt/3ZQ9WQtjwsZdsgQAiI6wIyBBZohCSAGGEEBJAxYWIClYUFRGcSFXEgtUKSJ2I4qAouGdBiohai1VcOO4f3Ke1fXrv7e371/u855zn/M55zw+AERImkeaiagA5UoU8Otgfj09IxMm9gAIVSOAEIBDmy8JnBcUAAPADeXh+dLA//AGvbwACAHDVLiQSx+H/g7pQJlcAIJEA4CIS5wsBkFIAyC5UyBQAyBgAsFOzZAoAlAAAbHl8QiIAqg0A7PRJPgUA2KmT3BcA2KIcqQgAjQEAmShHJAJAuwBgVYFSLALAwgCgrEAiLgTArgGAWbYyRwKAvQUAdo5YkA9AYACAmUIszAAgOAIAQx4TzQMgTAOgMNK/4KlfcIW4SAEAwMuVzZdL0jMUuJXQGnfy8ODiIeLCbLFCYRcpEGYJ5CKcl5sjE0jnA0zODAAAGvnRwf44P5Dn5uTh5mbnbO/0xaL+a/BvIj4h8d/+vIwCBAAQTs/v2l/l5dYDcMcBsHW/a6lbANpWAGjf+V0z2wmgWgrQevmLeTj8QB6eoVDIPB0cCgsL7SViob0w44s+/zPhb+CLfvb8QB7+23rwAHGaQJmtwKOD/XFhbnauUo7nywRCMW735yP+x4V//Y4p0eI0sVwsFYrxWIm4UCJNx3m5UpFEIcmV4hLpfzLxH5b9CZN3DQCshk/ATrYHtctswH7uAQKLDljSdgBAfvMtjBoLkQAQZzQyefcAAJO/+Y9AKwEAzZek4wAAvOgYXKiUF0zGCAAARKCBKrBBBwzBFKzADpzBHbzAFwJhBkRADCTAPBBCBuSAHAqhGJZBGVTAOtgEtbADGqARmuEQtMExOA3n4BJcgetwFwZgGJ7CGLyGCQRByAgTYSE6iBFijtgizggXmY4EImFINJKApCDpiBRRIsXIcqQCqUJqkV1II/ItchQ5jVxA+pDbyCAyivyKvEcxlIGyUQPUAnVAuagfGorGoHPRdDQPXYCWomvRGrQePYC2oqfRS+h1dAB9io5jgNExDmaM2WFcjIdFYIlYGibHFmPlWDVWjzVjHVg3dhUbwJ5h7wgkAouAE+wIXoQQwmyCkJBHWExYQ6gl7CO0EroIVwmDhDHCJyKTqE+0JXoS+cR4YjqxkFhGrCbuIR4hniVeJw4TX5NIJA7JkuROCiElkDJJC0lrSNtILaRTpD7SEGmcTCbrkG3J3uQIsoCsIJeRt5APkE+S+8nD5LcUOsWI4kwJoiRSpJQSSjVlP+UEpZ8yQpmgqlHNqZ7UCKqIOp9aSW2gdlAvU4epEzR1miXNmxZDy6Qto9XQmmlnafdoL+l0ugndgx5Fl9CX0mvoB+nn6YP0dwwNhg2Dx0hiKBlrGXsZpxi3GS+ZTKYF05eZyFQw1zIbmWeYD5hvVVgq9ip8FZHKEpU6lVaVfpXnqlRVc1U/1XmqC1SrVQ+rXlZ9pkZVs1DjqQnUFqvVqR1Vu6k2rs5Sd1KPUM9RX6O+X/2C+mMNsoaFRqCGSKNUY7fGGY0hFsYyZfFYQtZyVgPrLGuYTWJbsvnsTHYF+xt2L3tMU0NzqmasZpFmneZxzQEOxrHg8DnZnErOIc4NznstAy0/LbHWaq1mrX6tN9p62r7aYu1y7Rbt69rvdXCdQJ0snfU6bTr3dQm6NrpRuoW623XP6j7TY+t56Qn1yvUO6d3RR/Vt9KP1F+rv1u/RHzcwNAg2kBlsMThj8MyQY+hrmGm40fCE4agRy2i6kcRoo9FJoye4Ju6HZ+M1eBc+ZqxvHGKsNN5l3Gs8YWJpMtukxKTF5L4pzZRrmma60bTTdMzMyCzcrNisyeyOOdWca55hvtm82/yNhaVFnMVKizaLx5balnzLBZZNlvesmFY+VnlW9VbXrEnWXOss623WV2xQG1ebDJs6m8u2qK2brcR2m23fFOIUjynSKfVTbtox7PzsCuya7AbtOfZh9iX2bfbPHcwcEh3WO3Q7fHJ0dcx2bHC866ThNMOpxKnD6VdnG2ehc53zNRemS5DLEpd2lxdTbaeKp26fesuV5RruutK10/Wjm7ub3K3ZbdTdzD3Ffav7TS6bG8ldwz3vQfTw91jicczjnaebp8LzkOcvXnZeWV77vR5Ps5wmntYwbcjbxFvgvct7YDo+PWX6zukDPsY+Ap96n4e+pr4i3z2+I37Wfpl+B/ye+zv6y/2P+L/hefIW8U4FYAHBAeUBvYEagbMDawMfBJkEpQc1BY0FuwYvDD4VQgwJDVkfcpNvwBfyG/ljM9xnLJrRFcoInRVaG/owzCZMHtYRjobPCN8Qfm+m+UzpzLYIiOBHbIi4H2kZmRf5fRQpKjKqLupRtFN0cXT3LNas5Fn7Z72O8Y+pjLk722q2cnZnrGpsUmxj7Ju4gLiquIF4h/hF8ZcSdBMkCe2J5MTYxD2J43MC52yaM5zkmlSWdGOu5dyiuRfm6c7Lnnc8WTVZkHw4hZgSl7I/5YMgQlAvGE/lp25NHRPyhJuFT0W+oo2iUbG3uEo8kuadVpX2ON07fUP6aIZPRnXGMwlPUit5kRmSuSPzTVZE1t6sz9lx2S05lJyUnKNSDWmWtCvXMLcot09mKyuTDeR55m3KG5OHyvfkI/lz89sVbIVM0aO0Uq5QDhZML6greFsYW3i4SL1IWtQz32b+6vkjC4IWfL2QsFC4sLPYuHhZ8eAiv0W7FiOLUxd3LjFdUrpkeGnw0n3LaMuylv1Q4lhSVfJqedzyjlKD0qWlQyuCVzSVqZTJy26u9Fq5YxVhlWRV72qX1VtWfyoXlV+scKyorviwRrjm4ldOX9V89Xlt2treSrfK7etI66Trbqz3Wb+vSr1qQdXQhvANrRvxjeUbX21K3nShemr1js20zcrNAzVhNe1bzLas2/KhNqP2ep1/XctW/a2rt77ZJtrWv913e/MOgx0VO97vlOy8tSt4V2u9RX31btLugt2PGmIbur/mft24R3dPxZ6Pe6V7B/ZF7+tqdG9s3K+/v7IJbVI2jR5IOnDlm4Bv2pvtmne1cFoqDsJB5cEn36Z8e+NQ6KHOw9zDzd+Zf7f1COtIeSvSOr91rC2jbaA9ob3v6IyjnR1eHUe+t/9+7zHjY3XHNY9XnqCdKD3x+eSCk+OnZKeenU4/PdSZ3Hn3TPyZa11RXb1nQ8+ePxd07ky3X/fJ897nj13wvHD0Ivdi2yW3S609rj1HfnD94UivW2/rZffL7Vc8rnT0Tes70e/Tf/pqwNVz1/jXLl2feb3vxuwbt24m3Ry4Jbr1+Hb27Rd3Cu5M3F16j3iv/L7a/eoH+g/qf7T+sWXAbeD4YMBgz8NZD+8OCYee/pT/04fh0kfMR9UjRiONj50fHxsNGr3yZM6T4aeypxPPyn5W/3nrc6vn3/3i+0vPWPzY8Av5i8+/rnmp83Lvq6mvOscjxx+8znk98ab8rc7bfe+477rfx70fmSj8QP5Q89H6Y8en0E/3Pud8/vwv94Tz+4A5JREAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAADKGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDAgNzkuMTYwNDUxLCAyMDE3LzA1LzA2LTAxOjA4OjIxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOCAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozNjMzMzk4REEzQ0UxMUU4OEQxNUUwM0EyM0ZDRkY5NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozNjMzMzk4RUEzQ0UxMUU4OEQxNUUwM0EyM0ZDRkY5NyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjM2MzMzOThCQTNDRTExRTg4RDE1RTAzQTIzRkNGRjk3IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjM2MzMzOThDQTNDRTExRTg4RDE1RTAzQTIzRkNGRjk3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+CzB6ggAABmJJREFUeNrEV1loVGcU/u4yk0xWs5hJE2PERNCKcX9QhBZR1Iii9UERRNFaRdu+iBL3uiDigj5UQaQPFeuCiMQNKxTy4Ip7K6iYxKhxS2LWyTYz995+/507mTszd9rSFjxwQubOnf98/znn+/7zS4Zh4FOaKv60TpwY+zyJXk6fRB9Cz6f3o6fQ3XSFLjmsp9ED9B56O72B/oJ+l/4r/ZX95X43boQAxNh39Ap6wf+40W8scEfp31sgIxmw2U/0pQmXkbhplszo7obR1cV99oSeu92QUlIgeTzMjWK+42AiayvpX9DH0btiAXydMLgsE3MA+ps3MDQNckEB1KFDIeXmmqCMtjbo9fWmG3xPKSxksVgtTXNabRi9kj7VDsBF/9Fxx9yR/vKluZhr6lS4Z86EOm4clIEDQ8As09+/R/DRI/ivXIH/8mUYBKuUlITW0PXYladY/XUtDKDcary4dGuPH5sBPevWwT1lSsLqyPn5cAufNg3BpUvRtXcv/BcuQB08OFE2RMavhbcw2TH4kydIWrAAmdzRXwWPo9aIEcg4dgwpmzZBq6sDOjujsmXZBBO49aEktuba06dIWrgQaYcPc0X1X7V+ypo18OzYgWBtrVMGiuwAvJFeDdVcHT0aaYcO/Wf+paxahaRFi6A9fx5iSMR0O4DMvsd+Pwx66oEDfY/a791D9fr18LEf/s6C7e2o37kTTSdP9j1L3b0bsmBGS0scgHBuPeHaa69eIWnuXKhlZeYj38OHeDR9OnqamtDw8zGMvXsHSQXOGiUoWMMGbDh71iS9RjDeFSsgp6bCtXw5erdsgZKZGaUTso2GIbrQ3QQQNt/vfyDI4LmTJiHY0oyX235IuHudwtTNLGUMHw7V5YLv+vVIZefMQdDrhdzbG91uNpUyFU4ZNAjq+PF9L+SUz0DG2LHwv36NtM+Ho/GXk2i/dcsRgJKejqzycgSpASp3nbdkSeRwGTAAwZFl0JqbHQGYB4vh80EmADkrq+8FF9WumPUPvHsHxaXCRU6/3ro1YRbSJ0xAT2srcubPR/rkyVGB9JJS+BhDlaQ4ACFjCmUhrzGWO28esikwPdXVSC4tQXtVFZpOnHAE0HX7tnlcFmzeHPedKzsbvmAQOntAcgQQ1n0HKyafTS4TpIcyXM8A3dQKu3WSLW/370fR9u1wia6PFSiuHWDwTvaZYmUhOhpPNSOaKhEqjRwJ7+LF6Hn2zJRccTjVUCU/HDyIljNn8H7PHlRTLVOp//kbNzo3KVnhYuBuAghYTAjT0PwksXF00tCgdIr/Y62wogIt586ZrEgqKoL28SPecbeSlTWdtS86fjxhFgMvXkBNTjZLIEBk2TKghwFolE1xqjmZizsvoLwGamogsRyi65O5Y8/gEpNGWbNnI4OnpZNpzGzvgwdQ2QcuqxT2EgTCMmyQp/6LFxN2uXf1aqSOGYMAqSZzIbGA4e81+8O7bVvC3/kuXUKQGVDS0szfyDFNGBptiEphantPn4b+9q3zSgRZQBrqjY2QmEaJB5WfOp9NzntGjUoIoO3oUZPSssX5WBa0R7ot1dSDjoqKhItlzJiBzFmz0H3/PgIsmYvy6t2wIeH7Lfv2IUCGiBLaZFiyA2iMFIu1LS1F4Px5tNoOpLiG5KJpVEyFTVV45AiU/v2ddeHqVbTs2gW3mI6iJyPVzoK62IFE/MDHDu+mcHy2dm18QxYXo4SSrHd0QGYzOgavrETDypVQc3LMA8mwZgKRA+rAB3sGrkcTVodOyc3gONVJELU84fxiLnQaxRyC66RxMxvyw7Jl5vdKXl5f8DDlGPiOuVdxM+LFRMwDrfGiKMMgmHqOZgqPYFPfWftk0WxS/L0kwGYUKfedOoVeUtnFDUgO86DQgVRFmZNz82ZlGIB4Tq3FpqjzXaSagbrozRQfcPIV6XQPG4Yk9onKrhYiJARIUMxPoJqgJ98RuzZrHnNH0EJrPkuT5aEZvBnZAQirsi4OsLeqTACt7AVxkiuclnTeA8xBU9BQHCykpsxLiUw2mJcTi9JO9zYKVkeaopSxBHUZDlezL637wWp7FszZTqiXuJTwvBAdLwl3HIuiAxu2NdySVOWR5WUiuJ7gaibsW7qYRr+yRuchmmHkuWVZETfTHnGS/bN51CDANmavlgEfcAa4SAC/9el+OMOf+nr+pwADAAZ5culxNH/mAAAAAElFTkSuQmCC"},{"title":"Wikipedia","url":"https://wikipedia.org/","faviconUrl":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QAAKqNIzIAAAAJcEhZcwAACxIAAAsSAdLdfvwAAAAHdElNRQfhBAwKMAfiL115AAACxklEQVRIx6WVX2jVZRjHP7/T8c9pg2nhv2yDXWg4gqGsQGci68J/FRhq4IUohISpiQpeRoi48DJML0yCukpEiV0oIuaIqTSmUtREFCdhjTTFnTPP9Jz308X57efZ2aJ19vyu3ud9ns/zfX/P+ycKANN4mxZ2MH77gm7O8wgIhEzoClbxdYVMgDA3XKwq3WC4GOamaGHZ/5A+0pbRkmJx1ekAi6PghACkyUU11aebS0OWIhleAOAZQ2QYJEMagCcEppBnKmngCTKJPLVEQI4UNaQjTnGYQWYSUeAeb/Iph7jCS6R4Ro4NtPEZfzCNPJNZSyu7GaSOAaayk/chZPP2+KGIuNc7Fu33c1Piy54ya8FeV4jLvWzWor+6VFxjjwVDlpBVzbtWrPWaw7ZVnGlvPNrpfG8lc3t81b9US4BgUM9YJx4qudVuZ4j7VP3TBR5TS5EDtnkwjisD5HxXbPBxDNBPxDpvqvtsNZcATjrPO/EoAQT1WxGPJoE91op77LPe7xNvcIXbLA5v5nLAY5vFRQ4kGraI9ba5wacJ4Lr1/jRcvxwQ1HYx8rskuMuM+KJXE49ud/Xw+kcDbtsovmUh0bBRnG5vAvjdVzz3PN2QTZVtSxpZBXTxQzyGVuAhXwIRAF8zv/LwPlcQ1J+dJG52KO7MEueIc/xF1Uc2eby8/kgFAK/zDtDBb0TAV8gxaujnGwBOIB9UnqdyBUHtdIq4S+23yQ51vTjLG+pCj4ysP/InlgBDrhIb/NuDvmdBvWBaPOBZm73/X4CgnhbxIxf5o6Vzsk58zTfcX5k+NuCBzSJ+bDFu52kz4mzvjg+gh8V6byXdH3SluLd8A/1bF0rdX0MDm2jE2JNhI9NZH89WdmHUba8FO+wrq6b3PWF+dH2DhPaxEJViHUu+wdCe5tIYd+04PLFdStFNZ9W3eifdE35co4k+7/8AeaKDkPxRJzsAAAAASUVORK5CYII="}]}')},70253:e=>{"use strict";e.exports=JSON.parse('{"M":{"pb":[["af","Afrikaans","Afrikaans"],["az","Azerbaijani","Azərbaycanca"],["be","Belarusian","Беларуская"],["bg","Bulgarian","български"],["ca","Catalan","Català"],["ca-valencia","Valencian","Valencià"],["cs","Czech","Čeština"],["da","Danish","Dansk"],["de","German","Deutsch"],["de-CH","German (Switzerland)","Deutsch (Schweiz)"],["el","Greek","Ελληνικά"],["en-US","English (US)","English (US)"],["en-GB","English (UK)","English (UK)"],["es","Spanish","Español"],["et","Estonian","Eesti keel"],["fa","Persian","فارسی"],["fi","Finnish","Suomi"],["fr","French","Français"],["fy","Frisian","Frysk"],["gd","Scots Gaelic","Gàidhlig"],["gl","Galician","Galego"],["hu","Hungarian","Magyar"],["hr","Croatian","Hrvatski"],["hy","Armenian","Հայերեն"],["id","Indonesian","Bahasa Indonesia"],["is","Icelandic","Íslenska"],["it","Italian","Italiano"],["ja-KS","Japanese (Kansai)","関西弁"],["ja","Japanese","日本語"],["ka","Georgian","ქართული"],["kab","Kabyle","Taqbaylit"],["ko","Korean","한국어"],["kmr","Kurdish (Kurmanji)","Kurdî"],["lt","Lithuanian","Lietuvių"],["nb","Norwegian (Bokmål)","Norsk (bokmål)"],["nn","Norwegian (Nynorsk)","Norsk (nynorsk)"],["nl","Dutch","Nederlands"],["pa","Punjabi","ਪੰਜਾਬੀ"],["pl","Polish","Polski"],["pt-BR","Portuguese (Brazil)","Português (Brasil)"],["pt-PT","Portuguese (Portugal)","Português (Europeu)"],["ro","Romanian","Română"],["ru","Russian","Русский"],["si","Sinhala","සිංහල"],["sk","Slovak","Slovenčina"],["sl","Slovenian","Slovenščina"],["sq","Albanian","Shqip"],["sr","Serbian","Српски"],["sr-Latn","Serbian (Latin)","Srpski"],["sv","Swedish","Svenska"],["tr","Turkish","Türkçe"],["uk","Ukrainian","Українська"],["vi","Vietnamese","Tiếng Việt"],["zh-CN","Chinese (Simplified)","简体中文"],["zh-TW","Chinese (Traditional)","正體中文"]]}}')}},i={};function a(e){var t=i[e];if(void 0!==t)return t.exports;var s=i[e]={id:e,loaded:!1,exports:{}};return n[e].call(s.exports,s,s.exports,a),s.loaded=!0,s.exports}a.m=n,e=[],a.O=(t,s,n,i)=>{if(!s){var o=1/0;for(c=0;c<e.length;c++){for(var[s,n,i]=e[c],r=!0,l=0;l<s.length;l++)(!1&i||o>=i)&&Object.keys(a.O).every((e=>a.O[e](s[l])))?s.splice(l--,1):(r=!1,i<o&&(o=i));if(r){e.splice(c--,1);var d=n();void 0!==d&&(t=d)}}return t}i=i||0;for(var c=e.length;c>0&&e[c-1][2]>i;c--)e[c]=e[c-1];e[c]=[s,n,i]},a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},s=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,a.t=function(e,n){if(1&n&&(e=this(e)),8&n)return e;if("object"==typeof e&&e){if(4&n&&e.__esModule)return e;if(16&n&&"function"==typeof e.then)return e}var i=Object.create(null);a.r(i);var o={};t=t||[null,s({}),s([]),s(s)];for(var r=2&n&&e;"object"==typeof r&&!~t.indexOf(r);r=s(r))Object.getOwnPropertyNames(r).forEach((t=>o[t]=()=>e[t]));return o.default=()=>e,a.d(i,o),i},a.d=(e,t)=>{for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),a.j=296,(()=>{var e={296:0};a.O.j=t=>0===e[t];var t=(t,s)=>{var n,i,[o,r,l]=s,d=0;if(o.some((t=>0!==e[t]))){for(n in r)a.o(r,n)&&(a.m[n]=r[n]);if(l)var c=l(a)}for(t&&t(s);d<o.length;d++)i=o[d],a.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return a.O(c)},s=self.webpackChunkgapp_browser_react=self.webpackChunkgapp_browser_react||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var o=a.O(void 0,[739,277],(()=>a(89049)));o=a.O(o)})();