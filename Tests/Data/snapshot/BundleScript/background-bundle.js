(()=>{var e,t={338:(e,t,n)=>{"use strict";var i=n(29087),a=n(16716),s=n(17411);n(89907);self.jasmine;var r=n(39045),o=n(82227),c=n(90864),l=n(82786);var d=n(56371),u=n(78347),h=n(84321),f=n(47513),p=n.n(f),g=n(48868),m=n(21285),w=n(10048),_=n(71320),b=n(10671),y=n(68906),v=n(95095),I=n(97823),k=n(88212);const E={byIds:async function(e){await g.Z.buffer.bulkDelete(e)},byUids:async function(e,t,n){await g.Z.buffer.where("[accountId+path]").equals([e,t]).filter((e=>void 0!==e.uids)).modify((function(e){const t=new Set(e.uids);n.forEach((e=>{t.delete(e)})),0===t.size?delete this.value:e.uids=[...t]}))}};var x=n(55346),A=n(35489),S=n(24651),M=n(68247),N=n(7064),O=n(87155),T=n(89175);function Z(e,t){const n=i.Z.get(T.kMailAccounts).slice(),a=n.findIndex((t=>t.MAIL_EMAIL===e));if(-1===a)throw new Error(`Account to be removed, ${e}, was not found in settings`);const s=n.splice(a,1);M.Z.set(T.kMailAccounts,n);const r=s[0];t&&(N.Z.savedpasswords.delete(!0,(0,O.B)(r)),N.Z.savedpasswords.delete(!0,(0,O.Y)(r)))}var L=n(16888),R=n(99895),P=n(5863),C=n(1407),U=n(25051),F=n(16152),D=n(16504),z=n(61839);const B={call:async function(e,t){let n=[];const i=Date.now(),a=await g.Z.transaction("rw",m.E.concat([g.Z.pop,g.Z.filters]),(async()=>{const a=await h.Z.findMatchingSles(t),{newMessageGroups:s,duplicates:r}=h.Z.findDuplicates(a),o=[];for(const t of r){const{message:n,searchListEntry:a}=t,s={accountId:e,uidl:n.uidl||"",createdTimestamp:i,searchListId:a.id};o.push(s)}const c=s.map((e=>e[0])),l=await(0,m.Z)(e,P.Gf,P.e9,c),d=l.addedSles;return n=l.forSearchDb,d.forEach(((t,n)=>{s[n].forEach((n=>{o.push({accountId:e,uidl:n.uidl,createdTimestamp:i,searchListId:t.id})}))})),g.Z.pop.bulkPut(o),r.length>0&&await h.Z.addSourceFilters(e,P.Gf,P.e9,r,!1),d}));return(0,z.Z)(n),a}};var $=n(51501),j=n(75401),V=n(84283),q=n(89165),Q=n(95752),H=n(49168),K=n(34198);function W(e,t,n,i){return n.some((n=>0!==n.length&&n.every((n=>function(e,t,n,i){if(n.accountId||n.path||n.hasOwnProperty("folder")){const t=_.Z.getByIds(e.sourceFilterIds);let a;if(n.accountId?a=t.some((e=>e.accountId===n.accountId)):n.path&&(a=t.some((e=>e.path===n.path))),n.hasOwnProperty("folder"))if(n.folder===P.uT){const t=!1;a=V.Z.isMessageDeleted(e.sources,i,t)}else a=n.folder===P.Hd?(0,q.Z)(e.sources,e.flags):n.folder===P.hn?(0,j.Z)(e.sources):n.folder===P.Z3?!t.some((t=>{if(b.Z.getFolderType(t.accountId,t.path)===P.Nz){return e.sources.get(t.id)?.internal}return!1})):t.some((e=>{const t=b.Z.getFolderType(e.accountId,e.path);return n.folder&&n.folder===t}));if(!a)return!1}if(n.listId&&n.listId!==(0,K.P)(t.listId))return!1;if(n.flag){let t;if((0,H.R7)(n.flag))if(n.flag===P.T4.DELETED)t=V.Z.isMessageDeleted(e.sources,i);else{if(n.flag!==P.T4.SEEN)throw new Error("Unhandled source flag "+n.flag);t=Q.Z.call(e.sources,i)}else t=e.flags.includes(n.flag);if(!t)return!1}if(n.senderIsMailingList&&(!e.from[0]||n.senderIsMailingList!==e.from[0].address))return!1;return!0}(e,t,n,i)))))}const G={searchAddresses:function(e,t){const n=t.map((e=>e.address)),i=e.address;return n.some((e=>e.toLowerCase()===i))},filterMessage:function(e,t,n){let i=!1;const{filterValue:a}=e,{include:s,exclude:r,attachments:o,sentDate:c,sentDateEnd:l}=a;if("number"==typeof o){if(0===o&&t.attachment>0)return!1;if(o>0&&0===t.attachment)return!1}if(c&&c>t.sentDate)return!1;if(l&&l<t.sentDate)return!1;if(r||s)if(r&&s){const a=W(t,n,r,e),o=W(t,n,s,e);!a&&o&&(i=!0)}else s?i=W(t,n,s,e):r&&(i=!W(t,n,r,e));else i=!0;return i}},Y={mergeFilteringQueueItems:function(e){const t=new Map,n=new Set;if(e.length<=1)return{updatedItems:t,deletedItemIds:n};let i,a,s=0;for(;s<e.length;){let r=1;if(i){const a=e[s],r=i.id;i=Y.mergeItems(i,a),i&&(i.id===r?n.add(a.id):(n.add(r),t.delete(r)),t.set(i.id,i))}if(!i&&s<e.length-1){if(a){const i=[e[s],e[s+1]],o=a.map((({id:e})=>e));if(a=Y.mergeItemPairs(a,i),a){for(let e=0;e<2;e++){const s=a[e],r=o[e],c=i[e];s.id===r?n.add(c.id):(n.add(r),t.delete(r)),t.set(s.id,s)}r=2}}if(!a){const o=e[s],c=e[s+1];if(i=Y.mergeItems(o,c),i){const e=i.id===o.id?c.id:o.id;n.add(e),t.set(i.id,i),r=2}else if(s<e.length-3){const i=[o,c],l=[e[s+2],e[s+3]];if(a=Y.mergeItemPairs(i,l),a){for(let e=0;e<2;e++){const s=a[e],r=i[e],o=l[e];n.add(s.id===r.id?o.id:r.id),t.set(s.id,s)}r=4}}}}s+=r}return{updatedItems:t,deletedItemIds:n}},mergeItems:function(e,t){if(e.priority!==t.priority)return;if("FILTERS_SLES"===e.type&&"FILTERS_SLES"===t.type)return Y.mergeFiltersSles(e,t);if("UPDATE_SLE"===e.type&&"UPDATE_SLE"===t.type)return Y.mergeUpdateSle(e,t)},mergeItemPairs:function(e,t){if(Y.numberArraysMatch(t[0].searchListIds||void 0,t[1].searchListIds||void 0)){const n=Y.mergeItems(e[0],t[0]);if(n){const i=Y.mergeItems(e[1],t[1]);if(i)return[n,i]}}},mergeFiltersSles:function(e,t){if(!Y.numberArraysMatch(e.filterIds,t.filterIds))return;if(!Y.folderIdsMatch(e.folderIds,t.folderIds))return;if(e.runAllMessages!==t.runAllMessages)return;if(e.runMailingLists!==t.runMailingLists)return;if(e.runCustomFolders!==t.runCustomFolders)return;if(e.runFlagFolders!==t.runFlagFolders)return;if(e.runLabels!==t.runLabels)return;if(e.runQueries!==t.runQueries)return;if(e.runSingleThread!==t.runSingleThread)return;const n=new Set([...e.searchListIds,...t.searchListIds]);return{...e,searchListIds:[...n]}},mergeUpdateSle:function(e,t){if(void 0!==e.currentSearchListId||void 0!==t.currentSearchListId)return;if(e.unread!==t.unread)return;if(e.unseen!==t.unseen)return;if(!Y.viewIdSetsMatch(e.removeViewIds,t.removeViewIds))return;if(!Y.sourcesMatch(e.sources,t.sources))return;if(e.reRunUpdated!==t.reRunUpdated)return;if(e.searchListIds&&t.searchListIds){const n=new Set([...e.searchListIds,...t.searchListIds]);return{...e,searchListIds:[...n]}}return t.searchListIds?{...e}:e.searchListIds?{...t}:{...e}},numberArraysMatch:function(e,t){return Y.arraysMatch(e,t,(function(e,t){const n=new Set(t);return!e.some((e=>!n.has(e)))}))},folderIdsMatch:function(e,t){return Y.arraysMatch(e,t,(function(e,t){return!e.some((e=>!t.find((t=>e[0]===t[0]&&e[1]===t[1]))))}))},viewIdSetsMatch:function(e,t){if(!e&&!t)return!0;if(!e||!t)return!1;if(e.size!==t.size)return!1;return![...e].some((e=>!t.has(e)))},sourcesMatch:function(e,t){if(!e&&!t)return!0;if(!e||!t)return!1;if(e.size!==t.size)return!1;return![...e.keys()].some((n=>{const i=e.get(n),a=t.get(n);if(!i&&!a)return!1;if(!i||!a)return!0;const s=Object.keys(i),r=Object.keys(a);if(s.length!==r.length)return!0;for(const e of s)if(i[e]!==a[e])return!0;return!1}))},arraysMatch:function(e,t,n){if(void 0===e&&void 0===t)return!0;if(void 0===e||void 0===t)return!1;if(e.length!==t.length)return!1;return n(e,t)}};const X=Y;var J=n(5204),ee=n(95538),te=n(81830),ne=n(51733);const ie=function(e,t){return[...e.entries()].some((([e,n])=>{if(n.deleted)return!1;const i=_.Z.get(e);if(!i)throw new Error("Source filter not found "+e);const{accountId:a,path:s}=i;return b.Z.getFolderType(a,s)===t}))},ae={filter:le,filterUpdateSle:async function(e){const{priority:t,searchListIds:n,currentSearchListId:i=0,unread:a,unseen:s,sources:r,removeViewIds:o=new Set,batchSize:c=oe,reRunUpdated:l}=e,d=[],u=Date.now();let h,f;if(n){const e=n.splice(0,c);[h,f]=await g.Z.transaction("rw",[g.Z.searchList,g.Z.viewIds],(()=>Promise.all([g.Z.searchList.where("id").anyOf(e).toArray(),g.Z.viewIds.where("searchListId").anyOf(e).toArray()])))}else{if([h,f]=await g.Z.transaction("rw",[g.Z.searchList,g.Z.viewIds],(()=>Promise.all([g.Z.searchList.where("id").above(i).limit(c).toArray(),g.Z.viewIds.where("searchListId").above(i).limit(c).toArray()]))),0===h.length)return!0;e.currentSearchListId=h[h.length-1].id}const p=new Map(f.map((({searchListId:e,viewIds:t})=>[e,t])));for(const e of h){const t=new Set,n=new Set([...o]),{id:i}=e,c=p.get(i);if(!c)throw new Error("viewIds not found "+i);const l=new Set;if(c.forEach((e=>{const t=Math.floor(e/P.XN);l.add(t)})),l.forEach((i=>{if(void 0!==a){const e=i*P.XN+P.aD;a?t.add(e):n.add(e)}if(void 0!==s){const e=i*P.XN+P.ZC;s?t.add(e):n.add(e)}if(void 0!==r){const a=i*P.XN+P.IK,s=i*P.XN+P.aD;r.forEach(((r,o)=>{i===o?r?(void 0!==r.deleted&&(r.deleted?(0,q.Z)(e.sources,e.flags)||n.add(a):t.add(a)),void 0!==r.read&&(r.read?n.add(s):t.add(s))):$.Z.getAllViewTypes().forEach((e=>{n.add(i*P.XN+e)})):e.sources.has(i)||(V.Z.isMessageDeleted(e.sources)?n.add(a):t.add(a),Q.Z.call(e.sources)?n.add(s):t.add(s))}))}})),c.forEach((e=>{t.delete(e)})),[...n].forEach((e=>{c.includes(e)||n.delete(e)})),t.size>0||n.size>0){const e={id:i,updates:{}};t.size>0&&(e.updates.addedViewIds=[...t],t.forEach((e=>{c.push(e)}))),n.size>0&&(e.updates.removedViewIds=[...n],n.forEach((e=>{const t=c.indexOf(e);t>=0&&c.splice(t,1)}))),d.push(e)}else p.delete(i)}if(p.size>0&&(await g.Z.viewIds.where("searchListId").anyOf([...p.keys()]).modify((e=>{const t=p.get(e.searchListId);t&&(e.viewIds=t)})),l)){const e=[...p.keys()];await y.Z.call({type:"RE_RUN_SLES",priority:t,searchListIds:e})}d.length>0&&U.QO.updateIndex({sleUpdates:d});if(n&&0===n.length)return!0;{const t=Date.now();return e.batchSize=ce(c,t-u),!1}},filterSles:async function(e,t,n,i,a){const s=[],r=[],o=[],c=[],l=[],d=new Set,h=new Map,f=new Map,p=new Map,m=function(e){const t=new Set,n=[];for(const{accountId:i,path:a}of e)u.Z.isMailAccount(i)&&(a===P.ym?n.push(i):t.add(i));for(const e of n)t.delete(e);if(0===t.size)return[];const i=[...t].map((e=>[e,P.ym]));return _.Z.getByFolderIds(i)}(i),w=[...i,...m];for(let i=0;i<e.length;i++){const s=e[i],r=t[i],o=new Map;for(const e of w){if(G.filterMessage(e,s,r)){const{query:t}=e.filterValue;if(!n.get(s.id))throw new Error("viewIds not found in viewIdsBySleId for "+s.id);if(t&&!a?.skipQueries){const t=p.get(e);t?t.push(s):p.set(e,[s])}else o.set(e,!0)}else o.set(e,!1)}f.set(s,o)}if(p.size>0)for(const[e,t]of p){const{query:n}=e.filterValue;if(n){const i=await(0,te.Z)(n),a=new Set(i);for(const n of t){let t=f.get(n);t||(t=new Map,f.set(n,t)),a.has(n.id)?t.set(e,!0):t.set(e,!1)}}}for(const e of w){const t=$.Z.getViewIdsByFilterId(e.id);for(const e of t)d.add(e)}for(let i=0;i<e.length;i++){const u=e[i],p=t[i],g=f.get(u);if(!g)continue;const m=ae.getMatchResults(u,p,g,a?.triggerFilterIdCandidates),{id:w}=u,{addedViewIds:_,removedViewIds:b,runTriggerFilterIds:y,isOnMailingList:v}=m,I=n.get(w);if(!I)throw new Error("viewIds not found in viewIdsBySleId for "+w);if(v){[...I,..._].filter((e=>(e-P.EO)%P.XN==0)).forEach((e=>{_.delete(e),b.add(e)}))}const k=I.filter((e=>d.has(e))),E=k.filter((e=>!b.has(e))).concat([..._]);let x;if(!(E.length===k.length&&E.every((e=>k.includes(e))))){const e=I.filter((e=>!b.has(e))).concat([..._]);h.set(w,e),x={addedViewIds:[..._].filter((e=>!I.includes(e))),removedViewIds:I.filter((e=>b.has(e)&&!_.has(e)))},n.set(w,e)}y.size>0&&(x={...x||{},runTriggerFilterIds:[...y]}),x&&s.push({id:w,updates:x}),(0,K.P)(p.listId)&&(r.push(u),o.push(p)),(0,H.OK)(u.flags)&&(c.push(u),l.push(p))}h.size>0&&await g.Z.viewIds.where("searchListId").anyOf([...h.keys()]).modify((e=>{const t=h.get(e.searchListId);t&&(e.viewIds=t)}));return{sleUpdates:s,mailingListCandidateSles:r,mailingListCandidateMessages:o,labelsCandidateSles:c,labelsCandidateMessages:l}},getMatchResults:function(e,t,n,i){const a=new Set,s=new Set,r=new Set,o=_.Z.getByIds(e.sourceFilterIds);let c=!1;for(const[l,d]of n){const n=$.Z.getViewIdsByFilterId(l.id);for(const e of n)s.add(e);d&&(i?.includes(l.id)&&r.add(l.id),n.forEach((n=>{switch($.Z.getViewType(n)){case P.xE:a.add(n);break;case P.ZC:e.unseen&&a.add(n);break;case P.aD:Q.Z.call(e.sources,l)||a.add(n);break;case P.EO:const i=(0,K.P)(t.listId);if(i){const e=ee.Z.getMailingListGroup(i);e&&e.isIgnored?a.add(n):c=!0}else ge(e.from)?c=!0:a.add(n);break;case P.IK:const s=b.Z.getFolderType(l.accountId,l.path)===P.Nz;V.Z.isMessageDeleted(e.sources,l,s)||a.add(n);break;case P.Fz:o.some((e=>e.accountId!==P.u4))&&a.add(n);break;case P.Jq:(0,q.Z)(e.sources,e.flags)||a.add(n);break;case P.js:const r=ie(e.sources,P.Oi),d=ie(e.sources,P.e9);r&&!d||a.add(n);break;case P.pF:(0,j.Z)(e.sources)||a.add(n)}})))}return{addedViewIds:a,removedViewIds:s,runTriggerFilterIds:r,isOnMailingList:c}},updateFilteringQueue:async function(){return g.Z.transaction("rw",[g.Z.filteringQueue],(async()=>{const e=de.reduce(((e,{id:t})=>Math.max(e,t)),0),t=await g.Z.filteringQueue.where("id").above(e).toArray();de.push(...t),de.sort(ne.Hc);const{updatedItems:n,deletedItemIds:i}=X.mergeFilteringQueueItems(de);if(0===n.size&&0===i.size)return de;const a=[];for(const e of de){const t=n.get(e.id);t?a.push(t):i.has(e.id)||a.push(e)}return de=a,g.Z.filteringQueue.bulkPut([...n.values()]),g.Z.filteringQueue.bulkDelete([...i]),a}))},clearQueue:function(){de=[]},deleteFilteringItem:async function(e){await g.Z.filteringQueue.delete(e.id);const t=de.indexOf(e);t>=0&&de.splice(t,1)}};let se=!1;const re=100,oe=2e3,ce=v.Z.adjustBatchSize.bind(void 0,re,2e4,1e3);async function le(){if(se)return k.Z.log("Mail",["filtering"],"Already filtering."),Promise.resolve();se=!0;try{U.U.setPersistentStatus(C.A4,"MAIL_FILTERING",(0,d.Z)("Running mail filters..."));let e=await ae.updateFilteringQueue();for(;e.length>0;){const t=e[0];let n=!0;try{switch(t.type){case"FILTERS_SLES":n=await ue(t);break;case"UPDATE_SLE":n=await ae.filterUpdateSle(t);break;case"MOVE_SLE":await he(t);break;case"RUN_FILTERS":n=await fe(t);break;case"RE_RUN_SLES":n=await pe(t);break;default:k.Z.warn("Mail",["filtering"],"Invalid filtering queue item type",t.type)}n&&await ae.deleteFilteringItem(t)}catch(e){k.Z.error("Mail",["filtering"],"Filtering failed",JSON.stringify(t),e),await ae.deleteFilteringItem(t)}e=await ae.updateFilteringQueue()}}catch(e){k.Z.error("Mail",["filtering"],e)}finally{se=!1,U.U.clearPersistentStatus(C.A4,"MAIL_FILTERING")}}let de=[];async function ue(e){const{filterIds:t,folderIds:n=[],searchListIds:i,runAllMessages:a=!1,runMailingLists:s=!1,runCustomFolders:r=!1,runLabels:o=!1,runFlagFolders:c=!1,runQueries:l=!1,runSingleThread:d=!1,batchSize:u=oe}=e,h=_.Z.getAll().filter((e=>{const{id:i,accountId:u,path:h}=e;if(!!n.find((e=>{const[t,n]=e;return t===u&&n===h})))return!0;if(t&&t.includes(i))return!0;switch(u){case P.of:return a&&[P.ym,P.tB,P.ik,P.rp,P.N1,P.cm,P.$T].includes(h);case P.wC:return s;case P.MN:return c;case P.Ry:return r;case P.ut:return o;case P.Kz:return l;case P.tQ:return d}}));if(0===h.length)return!0;const f=Date.now(),p=i.splice(0,u),[m,w,b]=await g.Z.transaction("rw",[g.Z.searchList,g.Z.messages,g.Z.viewIds],(()=>Promise.all([g.Z.searchList.where("id").anyOf(p).toArray(),g.Z.messages.where("id").anyOf(p).toArray(),g.Z.viewIds.where("searchListId").anyOf(p).toArray()])));if(0===m.length)return!0;const y=new Map(b.map((e=>[e.searchListId,e.viewIds]))),v=await ae.filterSles(m,w,y,h),{sleUpdates:I,mailingListCandidateSles:k,mailingListCandidateMessages:E,labelsCandidateSles:x,labelsCandidateMessages:A}=v;if(I.length>0&&U.QO.updateIndex({sleUpdates:I}),k.length>0){const e=await K.Z.createMailingListFilters(E);if(e.length>0){await _.Z.updateFilters(e.map((({id:e})=>e)));const t=await ae.filterSles(k,E,y,e),{sleUpdates:n}=t;n.length>0&&U.QO.updateIndex({sleUpdates:n})}}if(x.length>0){const e=await(0,H.uR)(x);await _.Z.updateFilters(e);const t=_.Z.getByIds(e),n=await ae.filterSles(x,A,y,t),{sleUpdates:i}=n;i.length>0&&U.QO.updateIndex({sleUpdates:i})}if(i.length>0){const t=Date.now();e.batchSize=ce(u,t-f)}return 0===i.length}async function he(e){const{searchListIds:t,fromFolderId:n,toFolderId:i}=e,a=_.Z.getByFolderId(n),s=_.Z.getByFolderId(i);if(!a||!s)throw new Error("Either from- or to-filter not found");const r=[],[o,c]=await g.Z.transaction("rw",[g.Z.searchList,g.Z.viewIds],(()=>Promise.all([g.Z.searchList.where("id").anyOf(t).toArray(),g.Z.viewIds.where("searchListId").anyOf(t).toArray()]))),l=new Map(c.map((e=>[e.searchListId,e.viewIds]))),d=new Set,u=new Set;for(const e of o){const{id:t}=e,n=l.get(t);if(!n)throw new Error("viewIds not found "+t);const i={id:t,updates:{}};for(const e of $.Z.getAllViewTypes()){const t=a.id*P.XN+e;if(n.includes(t)){const n=s.id*P.XN+e;u.add(t),d.add(n)}}i.updates.addedViewIds=[...d],i.updates.removedViewIds=[...u],r.push(i),u.forEach((e=>{const t=n.indexOf(e);t>=0&&n.splice(t,1)})),d.forEach((e=>{n.push(e)}))}await g.Z.viewIds.where("searchListId").anyOf([...l.keys()]).modify((e=>{const t=l.get(e.searchListId);t&&(e.viewIds=t)})),U.QO.updateIndex({sleUpdates:r})}async function fe(e){const t=[],{filterIds:n,folderIds:i,currentSearchListId:a=0,batchSize:s=oe,triggerFilterIdCandidates:r}=e;if(n){const e=_.Z.getByIds(n);t.push(...e)}if(i){const e=_.Z.getByFolderIds(i);t.push(...e)}if(0===t.length)throw new Error("No valid filters in filtering request");const o=Date.now(),[c,l,d]=await g.Z.transaction("rw",[g.Z.searchList,g.Z.messages,g.Z.viewIds],(()=>Promise.all([g.Z.searchList.where("id").above(a).limit(s).toArray(),g.Z.viewIds.where("searchListId").above(a).limit(s).toArray(),g.Z.messages.where("id").above(a).limit(s).toArray()])));if(0===c.length)return!0;const u=new Map(l.map((e=>[e.searchListId,e.viewIds])));e.currentSearchListId=c[c.length-1].id;const h=await ae.filterSles(c,d,u,t,{triggerFilterIdCandidates:r}),{sleUpdates:f}=h;f.length>0&&U.QO.updateIndex({sleUpdates:f});const p=Date.now();return e.batchSize=ce(s,p-o),!1}async function pe(e){const{filterIds:t,folderIds:n,batchSize:i=re,currentSearchListId:a=0,runMailingLists:s=!1}=e,r=[];if(t&&r.push(...t),n){const e=_.Z.getByFolderIds(n);r.push(...e.map((e=>e.id)))}const o=Date.now(),c=[],l=[],[d,u,h]=e.searchListIds?await async function(e,t){const n=e.splice(0,t);return await g.Z.transaction("rw",[g.Z.searchList,g.Z.messages,g.Z.viewIds],(()=>Promise.all([g.Z.searchList.where("id").anyOf(n).toArray(),g.Z.messages.where("id").anyOf(n).toArray(),g.Z.viewIds.where("searchListId").anyOf(n).toArray()])))}(e.searchListIds,i):await async function(e,t){return g.Z.transaction("rw",[g.Z.searchList,g.Z.messages,g.Z.viewIds],(()=>Promise.all([g.Z.searchList.where("id").above(e).limit(t).toArray(),g.Z.messages.where("id").above(e).limit(t).toArray(),g.Z.viewIds.where("searchListId").above(e).limit(t).toArray()])))}(a,i);if(0===d.length)return!0;void 0===e.searchListIds&&(e.currentSearchListId=d[d.length-1].id);const f=_.Z.getAll(),p=new Map(h.map((e=>[e.searchListId,e.viewIds]))),m=[];for(let e=0;e<d.length;e++){const t=d[e],n=p.get(t.id),i=m.find((e=>{const[t]=e;if(n.length!==t.length)return!1;for(let e=0;e<t.length;e++)if(n[e]!==t[e])return!1;return!0})),a=u[e];if(i){const[,[e,n]]=i;e.push(t),n.push(a)}else m.push([n,[[t],[a]]])}const w=[];for(const t of m){const[n,[i,a]]=t,o=new Set([...r,...w]);n.forEach((e=>{const t=Math.floor(e/P.XN);o.add(t)}));const d=f.filter((e=>o.has(e.id)));if(0===d.length)continue;const{skipQueries:u}=e,h=await ae.filterSles(i,a,p,d,{skipQueries:u}),{mailingListCandidateSles:g,mailingListCandidateMessages:m}=h;if(c.push(...h.sleUpdates),s&&g.length>0){const t=await K.Z.createMailingListFilters(m);if(t.length>0){const n=t.map((({id:e})=>e));await _.Z.updateFilters(n);const{filterIds:i=[]}=e;e.filterIds=[...i,...n],w.push(...n);const a=await ae.filterSles(g,m,p,t,{skipQueries:u}),{sleUpdates:s}=a;l.push(...s)}}}c.length>0&&U.QO.updateIndex({sleUpdates:c}),l.length>0&&U.QO.updateIndex({sleUpdates:l});const b=Date.now();return e.batchSize=ce(i,b-o),!1}function ge(e){const t=e[0]?.address;return!!t&&!!_.Z.getByAddress(t)}J.Z.addListener((async function(e){if("filter"===e.func)await le()}));const me=ae;var we=n(77150),_e=n.n(we),be=n(16445);let ye={level:0,children:new Map};const ve={data:new Map,add:e=>{void 0!==e.id&&ve.data.set(e.id,e)},async get(e){const t=ve.data.get(e);if(t)return t;{const t=await g.Z.threading.get(e);if(!t)return;const n={id:t.id,messageId:t.messageId};return ve.add(n),n}},clear:()=>{ve.data.clear()}};function Ie(){ve.clear()}function ke(e){e.forEach((e=>{const{id:t,messageId:n}=e,i={id:t,messageId:n};ve.add(i)}))}async function Ee(){const e=await g.Z.threading.toArray();for(const t of e){const{id:e,messageId:n}=t,i={id:e,messageId:n};ve.add(i),await xe(t)}Ie()}function xe(e){const{inReplyTo:t,references:n}=e,i=[...n];return t&&!i.includes(t)&&i.push(t),i.reduce(((e,t)=>e.then((e=>Me(t).then((n=>{if(n)return n;{const n={messageId:t},i=Se(void 0,e);return Ae(n,i).then((()=>i))}}))))),Promise.resolve()).then((t=>{const{id:n,sentDate:i,messageId:a,outbound:s}=e,r={id:n,messageId:a};return Me(a).then((e=>{if(e)return e.sentDateById.has(n)?(e.sentDateById.set(n,i),e):(e.sentDateById.set(n,i),Ae(r,e).then((()=>e)));{const e=Se({id:n,sentDate:i,outbound:s},t);return Ae(r,e).then((()=>e))}}))}))}function Ae(e,t,n=ye){if(n.threadNode)return Promise.resolve().then((()=>{if(void 0!==n.id)return ve.get(n.id).then((t=>{if(t&&t.messageId!==e.messageId)return{id:t.id,messageId:t.messageId}}));if(void 0!==n.messageId){if(n.messageId!==e.messageId)return{messageId:n.messageId};void 0!==e.id&&(n.id=e.id,delete n.messageId)}})).then((a=>{if(!a)return;const s=n.parent,r={children:new Map,level:s.level+1},o=e.messageId.substr(2*s.level,2);s.children.set(o,r);const c=n.threadNode,l=a.messageId.substr(2*r.level,2),d=e.messageId.substr(2*r.level,2);if(l!==d)return i(a,r,c),i(e,r,t),Promise.resolve();{const n={level:r.level+1,children:new Map};return r.children.set(d,n),Promise.all([Ae(a,c,n),Ae(e,t,n)])}}));{const a=e.messageId.substr(2*n.level,2),s=n.children.get(a);return s?Ae(e,t,s):(i(e,n,t),Promise.resolve())}function i(e,t,n){const i={parent:t,threadNode:n},{id:a,messageId:s}=e;void 0!==a?i.id=a:i.messageId=s;const r=e.messageId.substr(2*t.level,2);t.children.set(r,i)}}function Se(e,t){const n={sentDateById:new Map,children:[],outbound:!1};if(e){const{id:t,sentDate:i}=e;n.sentDateById.set(t,i),n.outbound=e.outbound}return t&&(t.children.push(n),n.parent=t),n}function Me(e,t=ye){if(!e)return Promise.resolve();if(t.threadNode){if(void 0!==t.messageId)return t.messageId===e?Promise.resolve(t.threadNode):Promise.resolve();if(void 0!==t.id)return ve.get(t.id).then((n=>n&&n.messageId===e?t.threadNode:Promise.resolve()));throw new Error("Missing messageId and id: "+JSON.stringify(t))}{const n=e.substr(2*t.level,2),i=t.children.get(n);return i?Me(e,i):Promise.resolve()}}function Ne(e){const t=new Map,n=[...e.keys()];return g.Z.searchList.where("id").anyOf(n).modify((n=>{const{id:i}=n,a=e.get(i);a&&(t.set(i,a),n.threadKey=a)})).then((()=>t))}var Oe=n(13617);let Te=!1;function Ze(e){return xe(e).then((e=>{if(!e.parent&&0===e.children.length)return[];let n=e;for(;n.parent;)n=n.parent;return t(n)}));function t(e,a){const{sentDateById:s,children:r}=e;let o,c=[];if(void 0===a){let t=n(e);t||(t=n(e,!1));let a=e.sentDateById.keys().next().value;a||(a=i(e,[0,Number.MAX_SAFE_INTEGER])[0]),o=(0,Oe._)(t,a),s.forEach(((e,t)=>{c.push({id:t,newThreadKey:o})}))}else s.size>0?s.forEach(((e,t)=>{o=[...a,e],c.push({id:t,newThreadKey:o})})):o=a;return r.forEach((e=>{const n=t(e,o);c=[...c,...n]})),c}function n(e,t=!0){const i=t&&e.outbound;let a=[...e.sentDateById.values()].reduce(((e,t)=>Math.max(e,i?0:t)),0);return e.children.forEach((e=>{a=Math.max(a,n(e,t))})),a}function i(e,t){return t=[...e.sentDateById.entries()].reduce(((e,t)=>e[1]<t[1]?e:t),t),e.children.forEach((e=>{t=i(e,t)})),t}}const Le={updateThreads:async function(){if(!Te)for(Te=!0;Te;)try{const e=await g.Z.threadingQueue.toCollection().first();if(!e)return Ie(),void(Te=!1);const{threadingIds:t}=e;let n=2e3;const i=new v.Z.BatchSizeOptimizer(n,2e3);for(;t.length>0;){const a=t.splice(0,n);await g.Z.transaction("rw",[g.Z.threadingQueue,g.Z.threading,g.Z.searchList],(async()=>{const s=Date.now(),r=await g.Z.threading.where("id").anyOf(a).toArray(),o=new Map;ke(r);for(const e of r){(await Ze(e)).forEach((e=>{const{id:t,newThreadKey:n}=e;o.set(t,n)}))}if(o.size>0){const e=await Ne(o);U.QO.updateThreadKeys(e)}if(t.length>0){await g.Z.threadingQueue.put(e);const t=Date.now();n=i.optimize(n,t-s)}else await g.Z.threadingQueue.delete(e.id)}))}}catch(e){throw Te=!1,k.Z.error("Mail",["Threading"],e),U.U.setStatus(C.A4,(0,d.Z)("Error during threading"),5e3),e}}};var Re=n(3664),Pe=n(76257),Ce=n(27950);const Ue=1048576;class Fe extends Error{constructor(e,t,n){super(t),this.code=e,this.socket=n}}function De(e){return(0,Re.vi)(e,[43,79,75])}function ze(e){return 0===e.indexOf("PASS")?"PASS":0===e.indexOf("APOP")?e.replace(/\w+\s*$/,"the_md5_hash"):e}async function Be(e,t,n){const i=[];return new Promise(((a,s)=>{let r=setTimeout((function(){s(new Fe("SOCKET_TIMEOUT",(0,d.Z)("Failed to connect to POP server after $1 ms",[n]),o))}),n);const o=D.default.open(e,t,{useSecureTransport:110!==t});if("connecting"!==o.readyState)return clearTimeout(r),void s(new Fe("NO_SOCKET",(0,d.Z)('POP socket did not switch to "connecting" when trying to connect to $1:$2',[e,t]),o));o.onerror=e=>{clearTimeout(r),s(new Fe("NO_SOCKET",(0,d.Z)("POP socket generated unknown error when connecting. Response message: $1",[e.data?.message||e.message||""]),o))},o.ondata=e=>{clearTimeout(r);const t=new Uint8Array(e.data);i.push(...t),(0,Re.MF)(i,[13,10])?a({socket:o,response:new Uint8Array(i)}):r=setTimeout((function(){s(new Fe("SOCKET_TIMEOUT",(0,d.Z)("POP server failed to send connection chunk after $1 ms",[n]),o))}),n)}}))}async function $e(e,t,n=!1,i=3e4){if(!e)throw new Fe("NO_SOCKET",(0,d.Z)('No POP socket when sending "$1"',[ze(t)]),e);if(await!Ve(e))throw new Fe("SOCKET_CLOSED",(0,d.Z)('POP socket unexpectedly closed before "$1" command could be sent',[ze(t)]),e);const a=[];return new Promise(((s,r)=>{let o=setTimeout((function(){clearTimeout(o),r(new Fe("SOCKET_TIMEOUT",(0,d.Z)('POP server did not reply to command "$1" after $2 ms',[ze(t),i]),e))}),i);e.onerror=n=>{clearTimeout(o),r(new Fe("SEND_ERROR",(0,d.Z)('POP socket generated unknown error when sending command "$1"',[ze(t)]),e))};let c=Date.now();e.ondata=l=>{clearTimeout(o);const u=new Uint8Array(l.data);if(a.push(...u),Date.now()-c>1e3){const e=Math.round(a.length/Ue*10)/10;U.U.setStatus(C.A4,(0,d.Z)("Fetching message: $1 MB",[e])),c=Date.now()}(0,Re.MF)(a,[13,10,46,13,10])||!n&&(0,Re.MF)(a,[13,10])?(n?a.splice(-5):a.splice(-2),(0,Re.Xh)(a,[13,10,46],[13,10]),s(new Uint8Array(a))):o=setTimeout((function(){r(new Fe("SOCKET_TIMEOUT",(0,d.Z)('POP server failed to send additional chunk for command "$1" after $2 ms',[ze(t),i]),e))}),i)};const l=`${t}\r\n`,u=(0,Re.sy)(l);e.send(u)}))}async function je(e,t,n){const i=await $e(e,`USER ${t}`);if(!De(i))throw new Fe("AUTH_FAIL",(0,d.Z)("Invalid username for POP, server responded with: $1",[(0,Re.DA)(i)]),e);const a=(0,Re.DA)((new TextEncoder).encode(n)),s=await $e(e,`PASS ${a}`);if(!De(s))throw new Fe("AUTH_FAIL",(0,d.Z)("Login to POP server failed, server responded with: $1",[(0,Re.DA)(s)]),e)}function Ve(e){return new Promise((t=>{setTimeout((()=>{t("open"===e.readyState)}),0)}))}async function qe(e,t,n,i,a=6e4,s=!1){const{socket:r,response:o}=await Be(e,t,a);if(!De(o))throw new Fe("CONNECT_ERROR",(0,d.Z)("POP server $1:$2 responded with an error after connection",[e,t]),r);const c=Qe(o);if(!c||s)return await je(r,n,i),r;try{return await async function(e,t,n,i){const a=(0,Re.DA)((new TextEncoder).encode(n)),s=_e()(`${i}${a}`),r=await $e(e,`APOP ${t} ${s}`);if(!De(r))throw new Fe("AUTH_FAIL",(0,d.Z)("APOP authentication failed: $1",[(0,Re.DA)(r)]),e)}(r,n,i,c),r}catch(s){if("AUTH_FAIL"===s.message){return await Ve(r)?(await je(r,n,i),r):qe(e,t,n,i,a,!0)}throw s}}function Qe(e){const t=e.lastIndexOf(60);if(-1!==t){const n=e.indexOf(62,t);if(-1!==n){const i=e.subarray(t,n+1);return(0,Re.DA)(i)}}}async function He(e,t){const n=await $e(e,`TOP ${t.index} 0`,!0);if(De(n))return{...t,headersOnly:!0,message:Ye(n)};throw new Fe("TOP_ERROR",(0,d.Z)("POP server did not respond correctly to TOP command. Response: $1",[(0,Re.DA)(n)]))}async function Ke(e,t){const n=await $e(e,`RETR ${t.index}`,!0);if(De(n))return{...t,headersOnly:!1,message:Ye(n)};throw new Fe("RETR_ERROR",(0,d.Z)("POP server did not respond correctly to RETR command. Response: $1",[(0,Re.DA)(n)]),e)}function We(e){const t=[...e],n=new Map;let i=(0,Re.L2)(t,[13,10]);for(;-1!==i;){const e=(0,Re.L2)(t,[13,10],i+1),a=-1!==e?t.slice(i+2,e):t.slice(i+2),s=a.indexOf(32);if(-1===s){i=e;continue}const r=a.slice(0,s),o=a.slice(s+1),c=Number(String.fromCharCode(...r)),l=String.fromCharCode(...o);n.set(l,c),i=e}return n}function Ge(e){const t=[...e],n=new Map;let i=(0,Re.L2)(t,[13,10]);for(;-1!==i;){const e=(0,Re.L2)(t,[13,10],i+1),a=-1!==e?t.slice(i+2,e):t.slice(i+2),s=a.indexOf(32);if(-1===s){i=e;continue}const r=a.slice(0,s),o=a.slice(s+1),c=Number(String.fromCharCode(...r)),l=parseInt(String.fromCharCode(...o));n.set(c,l),i=e}return n}function Ye(e){const t=(0,Re.L2)(e,[13,10]);if(-1===t)throw new Error("parseRetrResponse: Expected end of line");return e.subarray(t+2)}async function Xe(e,t,n){const i=[];for(const e of n){const t=be.Z.call(e.message),n=(0,Pe.Zp)(e.message),a=(0,Pe.Dc)(n),s={to:t.to,from:t.from,cc:t.cc,inReplyTo:t.inReplyTo,replyTo:t.replyTo,subject:t.subject,sentDate:t.sentDate,messageId:t.messageId,listId:t.listId,listPost:t.listPost,references:t.references,flags:[],uidl:e.uidl||"",attachment:a.length,size:e.size};s.messageId||(s.messageId=""),i.push(s)}const a=await B.call(t,i).catch((n=>{throw new Fe("STORE_ERROR",(0,d.Z)("Unable to store POP message in mail store.",[t]),e)}));if(a.length>0){const s=[];for(const r of a){const a=i.findIndex((e=>h.Z.messageEqualsSle(e,r))),o=i[a],c=n[a];if(!c.headersOnly){c.message=await(0,L.Z)(r.id,o,c.message);const{sentDate:n,id:i}=r;await Je(e,t,c,n,i),s.push(i)}}s.length>0&&await S.Z.setHasRaws(t,s)}return a}async function Je(e,t,n,i,a){try{await R.Z.call(t,i,a,n.message)}catch(n){throw new Fe("STORE_ERROR",(0,d.Z)("Unable to store POP message as writing to disk failed.",[t]),e)}}async function et(e,t){switch(e.message){case"SOCKET_TIMEOUT":case"SEND_ERROR":case"CONNECT_ERROR":case"DELETE_ERROR":case"NO_UIDL":case"NO_SOCKET":e.socket&&e.socket.close();break;case"MISCONFIGURED_ACCOUNT":case"SOCKET_CLOSED":break;default:if(e.socket){const{socket:t}=e;tt(t,!1)}}throw e.socket&&(e.socket.onerror=null),U.KU.set(t,"POP",e,e.code),e}async function tt(e,t=!0){try{await $e(e,"QUIT"),e.close()}catch(e){if(t)throw e;k.Z.error("Mail",["pop-client"],e)}}async function nt(e,t){const n=await $e(e,"UIDL",!0);if(!De(n))throw new Fe("NO_UIDL",(0,d.Z)("POP server $1 does not support UIDL",[t]),e);const i=We(n);U.U.setStatus(C.A4,(0,d.Z)("$1 message exists on POP account $2","$1 messages exist on POP account $2",[i.size,t]));const a=await $e(e,"LIST",!0);if(!De(a))throw new Fe("NO_LIST",(0,d.Z)("POP server $1 does not support LIST",[t]),e);return{uidlMap:i,sizeMap:Ge(a)}}async function it(e){try{const t=e.MAIL_USER,n=e.MAIL_PASSWORD,i=e.MAIL_SERVER,a=e.MAIL_PORT;if(!(t&&n&&i&&a))throw new Fe("MISCONFIGURED_ACCOUNT",(0,d.Z)("Incoming POP server attributes missing for $1",[e.MAIL_EMAIL]));const s=await qe(i,a,t,n);return U.KU.delete(e.MAIL_EMAIL,"POP"),s}catch(t){throw U.KU.set(e.MAIL_EMAIL,"POP",t,t.code),t}}function at(e){return e.popDeletion||{when:P.qd,howManyDays:0}}async function st(e){const t=(await I.Z.loadPopAccounts()).find((({MAIL_EMAIL:t})=>t===e));if(t)return t;throw new Error("Account not found "+e)}async function rt(e,t,n){const i=[],a=[];let s=!0;const r=at(e),o=function(e){const t=e.popMaxSize||{limited:!1,limit:0};return t.limited?t.limit*Ue:0}(e);for(const e of t){const{index:t,size:c}=e;let l;if(s&&o&&void 0!==c&&c>o)try{l=await He(n,e)}catch(e){s=!1,k.Z.warn("Mail",["pop-client"],"Error using TOP to fetch mail, using RETR instead.",e)}l||(l=await Ke(n,e),r.when===P.eQ&&a.push(t)),i.push(l)}return{popMails:i,safeToDelete:a}}async function ot(e,t){for(const n of t){if(!De(await $e(e,`DELE ${n}`)))throw new Fe("DELETE_ERROR",(0,d.Z)("Failed to delete mail with index $1",[n]),e)}}const ct={verifyLogin:async function(e){const{MAIL_SERVER:t,MAIL_PORT:n,MAIL_USER:i,MAIL_PASSWORD:a,MAIL_EMAIL:s}=e;if(!(t&&n&&(i&&a||e.useOAuth)))throw new Fe("MISCONFIGURED_ACCOUNT",(0,d.Z)("Incoming server attributes missing for $1",[s]));try{const e=await qe(t,n,i,a,1e4);await tt(e)}catch(e){await et(e,s)}},deleteMail:async function(e,t){if(!e.popDeletion||e.popDeletion.when!==P.Qp)return;const n=e.MAIL_EMAIL;try{const i=await it(e),a=await $e(i,"UIDL",!0);if(!De(a))throw new Fe("NO_UIDL",(0,d.Z)("POP server $1 does not support UIDL",[n]),i);const s=(await g.Z.pop.where("searchListId").anyOf(t).toArray()).filter((e=>e.accountId===n)).map((e=>e.uidl)),r=We(a),o=[];for(const e of s)r.has(e)&&o.push(e);await ot(i,o),await $e(i,"QUIT"),await i.close()}catch(e){await et(e,n)}},getMail:async function(e){const t=await it(e),n=e.MAIL_EMAIL;U.U.setStatus(C.A4,(0,d.Z)("Checking for new mail on POP account $1",[n]));try{const{uidlMap:i,sizeMap:a}=await nt(t,n),s=await async function(e,t,n){const i=e.MAIL_EMAIL,a=[...t.keys()],s=await async function(e,t){const n=t.map((t=>[e,t]));return await g.Z.pop.where("[accountId+uidl]").anyOf(n).toArray()}(i,a),r=new Map,o=new Set;for(const e of s){const{uidl:t,searchListId:n}=e,i=r.get(t);i?i.push(e):r.set(t,[e]),o.add(n)}const c=await A.Z.getBySearchListIdsAccountId([...o],i),l=new Map;for(const e of c)if(e){const{searchListId:t,hasRaw:n}=e;l.set(t,1===n)}const d=[],u=new Set,h=at(e);for(const[e,a]of t){if(!e){k.Z.warn("Mail",["pop-client"],"POP message does not have UIDL: "+i+" index: "+a);continue}const t=r.get(e);if(t&&0!==t.length){const[{searchListId:e,createdTimestamp:n}]=t;!1!==l.get(e)&&(h.when===P.eQ||h.when===P.kA&&n+24*h.howManyDays*60*60*1e3<Date.now())&&u.add(a)}else{const t={index:a,uidl:e,size:n.get(a)||0};d.push(t)}}return{toFetch:d,safeToDelete:u}}(e,i,a),{toFetch:r}=s,o=r.length;let c=0;U.U.setStatus(C.A4,(0,d.Z)("Need to fetch $1 message - $2","Need to fetch $1 messages - $2",[o,n]));let l=123;const u=new v.Z.BatchSizeOptimizer(123,5e3);for(;r.length>0;){const i=Date.now(),a=r.splice(0,l),h=await st(n);if((0,Ce.OM)(e,h))break;const f=await rt(h,a,t),{popMails:p,safeToDelete:g}=f;if(p.length>0){const e=await Xe(t,n,p);e.length>0&&U.QO.updateIndex({addedSles:e}),me.filter(),Le.updateThreads()}if(g.length>0){await ot(t,g);for(const e of g)s.safeToDelete.delete(e)}const m=Date.now();c+=l,l=u.optimize(l,m-i),U.U.setStatus(C.A4,(0,d.Z)("Indexing mail $1 $2/$3",[n,c,o]))}s.safeToDelete.size>0&&await ot(t,[...s.safeToDelete]),await tt(t)}catch(e){await et(e,n)}},getMessage:async function(e,t,n){const i=e.MAIL_EMAIL,a=await it(e),{uidlMap:s,sizeMap:r}=await nt(a,i),o=s.get(t);if(void 0===o)throw new Error("Message not listed on POP server "+t);const c={index:o,uidl:t,size:r.get(o)||0},{message:l}=await Ke(a,c);U.QO.runStoredQueryFilters([n]);const d=(0,Pe.Zp)(l),u=(0,Pe.Dc)(d).length;return u>0&&(await g.Z.searchList.update(n,{attachment:u}),U.QO.updateIndex({sleUpdates:[{id:n,updates:{attachment:u}}]})),l},repliedOK:De,openPOP:Be,sendAndReceive:$e,parseUidlResponse:We,parseListResponse:Ge,parseRetrResponse:Ye,arrayEndsWith:Re.MF,getNonce:Qe};let lt=!1;const dt={};async function ut(e){if(e.isDeleted)return;const t=e.MAIL_EMAIL;if(navigator.onLine)if(e.offline)U.U.setStatus(C.A4,(0,d.Z)("Account $1 has been set as an offline account. Check settings.",[t]));else{if(!e.MAIL_PORT||e.MAIL_PORT<=0)throw new Error(`Port missing or invalid: ${e.MAIL_PORT||""}`);if(!dt[t]){dt[t]=!0,U.U.setStatus(C.A4,(0,d.Z)("Indexing - $1 $2",[t,P.Gf]));try{await ct.getMail(e),U.U.setStatus(C.A4,(0,d.Z)("Finished indexing - $1",[t]),P.QM)}catch(t){!function(e,t){k.Z.error("Mail",["pop"],t);const n=`${e.MAIL_SERVER||""} / ${e.MAIL_USER||""}: ${t.name} `;t.message=n+t.message,U.U.setStatus(C.A4,t.message)}(e,t)}finally{dt[t]=!1,U.QO.removePathIndicator(t,P.Gf)}}}else U.U.setStatus(C.A4,(0,d.Z)("No network connection"))}async function ht(e){let t=await I.Z.loadPopAccounts();if(t=t.filter((e=>!e.offline)),!t)return;if((await g.Z.systemTasks.toArray()).some((e=>"restore_mail_db"===e.taskName)))k.Z.warn("Mail",["pop"],"Not connecting while restoration in progress");else if(e){const n=t.find((t=>t.MAIL_EMAIL===e));n&&await ut(n)}else for(let e=0;e<t.length;e++)await ut(t[e])}function ft(e,t){return ct.deleteMail(e,t)}function pt(e,t,n){return ct.getMessage(e,t,n)}const gt={checkForMail:ht,deletePopMail:ft,getPopMessage:pt,setCheckInterval:function(e,t){lt&&clearInterval(lt),lt=!!e&&setInterval(ht,6e4*t)}};self.addEventListener("message",(async function({origin:e,data:t,source:n}){if(e!==C.oP||!t||!t.pop)return;const{promiseId:i,func:a,args:s=[]}=t.pop;if(a)try{const e=await gt[a](...s),t=e&&"getPopMessage"===a?[e.buffer]:void 0;n.postMessage({pop:{promiseId:i,results:e}},{transfer:t})}catch(e){n.postMessage({pop:{promiseId:i,error:e.message||e}})}}),!1);var mt=n(83204),wt=n(92292),_t=n(26067);function bt(e,t,n){const{pathArray:i,fileName:a}=(0,_t.ZP)(e,t,n);return new Promise((e=>{N.Z.mailPrivate.messageFileExists(i,a,(t=>{wt.Z.runtime.lastError?e(!1):e(t)}))}))}const yt={runSystemTask:async function(e){const{fileKeys:t}=e,n=t.length;let i=0,a=111;const s=new v.Z.BatchSizeOptimizer(a,2e3);for(;t.length>0;){U.U.setStatus(C.A4,(0,d.Z)("Checking raw email files $1/$2",[i,n]));const r=Date.now(),o=t.splice(0,a),c=[];for(const e of o){const{accountId:t,searchListId:n,sentDate:i}=e,a=await bt(t,i,n)?1:0;c.push({accountId:t,searchListId:n,hasRaw:a})}await g.Z.transaction("rw",[g.Z.hasRaw,g.Z.systemTasks],(()=>{g.Z.hasRaw.bulkPut(c),g.Z.systemTasks.update(e.id,{fileKeys:t})})),i+=a;const l=Date.now();a=s.optimize(a,l-r)}await g.Z.systemTasks.delete(e.id),U.U.setStatus(C.A4,(0,d.Z)("Done checking $1 raw email files",[n]))},isRawOnDisk:bt};var vt=n(5267),It=n(89378),kt=n(11430),Et=n(83507),xt=n(57654),At=n(19789),St=n(13519);var Mt=n(60308),Nt=n(9982),Ot=n(25100),Tt=n(40348);async function Zt(e,t,n,i,a){const s={added:0,failed:0,dups:0,renamed:0};if(e.from.length+e.to.length+e.cc.length===0&&!e.subject){k.Z.warn("Mail",["restoreMailDb",t,n,i],"Selected file does not seem to be a mail file");const e=(0,d.Z)("Selected file does not seem to be a mail file: $1",[i]);return U.U.setStatus(C.A4,e,P.QM),s}const r=b.Z.getFolderType(t,n),{indexUpdates:o}=await Mt.Z.call(t,n,r,[e]),{addedSles:c=[],sleUpdates:l=[]}=o,u=c[0];if(!(u||l&&0!==l.length))return k.Z.info("Mail",["restoreMailDb",t,n,i],"Message already exists."),s.dups+=1,s;if(u&&a){const n=b.Z.getFolderType(t,P.N1),i=await h.Z.addSourceFilters(t,P.N1,n,[{message:e,searchListEntry:u}],!0);l.push(...i)}U.QO.updateIndex(o),s.added+=c.length;const{id:f}=u||l[0],{relativePathParts:p,fileName:g}=(0,_t.xh)(i);try{await N.Z.mailPrivate.renameMessageFile(p,g,`_${f}.eml`),wt.Z.runtime.lastError&&k.Z.error("Mail",["restoreMailDb","renameMessageFile",g],wt.Z.runtime.lastError)}catch(e){return k.Z.error("Mail",["restoreMailDb",p,g,f],e),s.failed+=1,s}return s.renamed+=1,await S.Z.setHasRaw(t,f),await(0,Nt.Z)(t,n,[e]),J.Z.filter(),Le.updateThreads(),s}async function Lt(e){try{const t=(0,_t.sz)(e),n=await N.Z.mailPrivate.getFilePaths(t);wt.Z.runtime.lastError&&k.Z.error("Mail",["restoreMailDb","getFilePaths",t],wt.Z.runtime.lastError);for(const e of n){const{fileName:t,relativePathParts:n}=(0,_t.xh)(e);if("_"===t[0]){const e=t.slice(1);await N.Z.mailPrivate.renameMessageFile(n,t,e),wt.Z.runtime.lastError&&k.Z.error("Mail",["restoreMailDb","renameMessageFile",t,e],wt.Z.runtime.lastError)}}}catch(e){k.Z.error("Mail",["restoreMailDb"],e)}}async function Rt(e,t,n){if(!n.includes(e)){if(t.find((t=>t.MAIL_EMAIL===e))){k.Z.warn("Mail",["restoreMailDb"],`Account ${e} missing and being added`);const t=c.Z.getDefaultFolders(),n=await r.Z.add(e,t);await u.Z.addAccounts({[e]:n});const i=await o.Z.foldersToFilters(e,t);_.Z.updateFilters(i)}}}async function Pt(e){"restore_mail_db"===e.taskName?await async function(e){let t=0,n=0,i=0,a=0,s=0,o=0,c=0,l=0,u=0;try{const h=await N.Z.mailPrivate.getMailFilePaths();wt.Z.runtime.lastError&&k.Z.error("Mail",["restoreMailDb","getMailFilePaths"],wt.Z.runtime.lastError),h.sort();const f=await I.Z.loadAllAccounts(),p=f.map((e=>e.MAIL_EMAIL)),m={};for(const e of p)m[(0,_t.BB)(e)]=e;const w=(0,_t.BB)(P.u4);let _=[],b=0;if(e.currentFilePath)for(;b<h.length;b++){const t=h[b];if(t.slice(0,t.lastIndexOf("/"))===e.currentFilePath.slice(0,e.currentFilePath.lastIndexOf("/")))break}for(let p=b;p<h.length;p++){p%20==0&&U.U.setStatus(C.A4,(0,d.Z)("Rebuilding database: $1/$2",[p,h.length]));const b=h[p];try{const{relativePathParts:d,fullPathParts:u}=(0,_t.xh)(b),[h]=d;if(h===w)continue;_.length>0&&u.slice(0,u.length-1).some(((e,t)=>_[t]!==e))&&(await Lt(_),await g.Z.systemTasks.update(e.id,{currentFilePath:b})),_=u;const p=u[u.length-1];let[y,v]=p.split(".");if("_"===y[0]&&(y=y.slice(1)),!v||"eml"!==v.toLowerCase()){k.Z.warn("Mail",["restoreMailDb"],"file name does not have an eml extension",b);continue}if(!Number(y)){k.Z.warn("Mail",["restoreMailDb"],"file does not have a numeric file name",b);continue}if(h===w){k.Z.warn("Mail",["restoreMailDb"],"Not able to restore Feed items yet!");continue}const I=await(0,Tt.Z)(b);if(0===I.length){k.Z.warn("Mail",["restoreMailDb"],"file is empty",b);continue}t+=1;const E=be.Z.call(I),x=await(0,Ot.Z)(E,[],I),A=m[h],S=x.to.find((e=>e.address===A)),M=x.from.find((e=>e.address===A));let N=S?.address;const O=M?.address;let T;N||O||(N=A);const Z=N===O,L=(await r.Z.getAll()).map((e=>e.accountId));if(N){await Rt(N,f,L);const{added:e,failed:t,dups:a,renamed:r}=await Zt(x,N,P.Gf,b,Z);Z?s+=e:i+=e,o+=t,l+=a,n+=r,n>0&&(T=b.replace(/([0-9]+\.eml)$/,"_$1"))}if(O&&!Z){await Rt(O,f,L);const e=T||b,{added:t,failed:i,dups:s,renamed:r}=await Zt(x,O,P.N1,e,!1);a+=t,c+=i,l+=s,n+=r}}catch(e){u+=1,k.Z.error("Mail",["restoreMailDb"],e)}}_.length>0&&await Lt(_),await g.Z.systemTasks.delete(e.id)}catch(e){u+=1,k.Z.error("Mail",["restoreMailDb"],e)}k.Z.warn("Mail",["restoreMailDb"],"Message files read",t),k.Z.warn("Mail",["restoreMailDb"],"Message files renamed",n),k.Z.warn("Mail",["restoreMailDb"],"Duplicates",l),k.Z.warn("Mail",["restoreMailDb"],"Added to Inbox",i),k.Z.warn("Mail",["restoreMailDb"],"Added to Inbox and Sent",s),k.Z.warn("Mail",["restoreMailDb"],"Added to Sent",a),k.Z.warn("Mail",["restoreMailDb"],"Failed adding to Inbox",o),k.Z.warn("Mail",["restoreMailDb"],"Failed adding to Sent",c),k.Z.warn("Mail",["restoreMailDb"],"Errors",u)}(e):"restore_full_text_search_db"===e.taskName?await async function(e){const t=await g.Z.searchList.toCollection().last();if(t){Oi.pausePrefetching(!0);try{let{currentPosition:n}=e;for(;n<=t.id;){if(i.Z.get(T.kMailIsTurnedOff)){U.U.setStatus(C.A4,(0,d.Z)("Mail client turned off - Stopped building text-search database"),3e3);break}U.U.setStatus(C.A4,(0,d.Z)("Building text-search database: $1/$2",[(0,At.uf)(n),(0,At.uf)(t.id)]));const a=await g.Z.messages.where("id").between(n,t.id+1).limit(20).toArray();if(0===a.length)break;const s=await g.Z.searchList.where("id").between(n,a[a.length-1].id+1).toArray(),r=[];for(let e=0;e<a.length;e++){const t=a[e],n=s[e],{subject:i,to:o,cc:c,from:l,replyTo:d}=t;let u=(0,St.H)(t.bodyParts);if(!u)for(const e of new Set(n.sourceFilterIds.map((e=>_.Z.get(e))).filter(Boolean).map((e=>e.accountId)))){const t=await Et.Z.call(e,n.id,n.sentDate);if(t){if(e===P.u4){const e=new TextDecoder("utf-8").decode(t);u=(0,xt.Z)(e)}else{const e=(0,Pe.PW)((0,Pe.Zp)(t));if(!e)break;const n=await kt.Z.parseMail(t,e.mimeTree);u=(0,St.H)(n.bodyParts)}break}}r.push({searchListId:n.id,subject:i,body:u,to:(0,It.Z)(o),cc:(0,It.Z)(c),from:(0,It.Z)(l),replyTo:(0,It.Z)(d)})}await(0,z.Z)(r),n=a[a.length-1].id+1,await g.Z.systemTasks.update(e.id,{currentPosition:n})}i.Z.get(T.kMailIsTurnedOff)||(await g.Z.systemTasks.delete(e.id),U.U.setStatus(C.A4,(0,d.Z)("Building text-search database finished"),P.QM))}finally{Oi.pausePrefetching(!1)}}else await g.Z.systemTasks.delete(e.id)}(e):"delete_full_text_search_entries"===e.taskName?await vt.Z.systemTaskDelete(e):"check_disk_for_raw"===e.taskName?await yt.runSystemTask(e):console.error("task not supported",e)}async function Ct(e,t,n){U.U.setStatus(C.A4,(0,d.Z)("Removing data from $1 in $2",[t,e]));const i=[e,t,0],a=[e,t,Number.MAX_VALUE];await g.Z.imap.where("[accountId+path+uid]").between(i,a).delete(),await g.Z.mailboxCache.where("[accountId+path]").equals([e,t]).delete();const s=await g.Z.filters.where("[accountId+path]").equals([e,t]).first(),r=await g.Z.filters.toCollection().filter((n=>n.accountId===e&&n.path===t||n.selectedAccountId===e&&n.selectedName===s.name)).primaryKeys(),o=await Dt(e,r);e===P.u4&&await g.Z.deletedFeedItems.where("path").equals(t).delete(),n&&await Ft(e,o),await g.Z.buffer.where("[accountId+path]").equals([e,t]).delete(),U.U.setStatus(C.A4,(0,d.Z)("Finshed removing data from $1 in $2",[t,e]))}async function Ut(e,t){U.U.setStatus(C.A4,(0,d.Z)("Removing data for $1",[e]));const n=[e,""],i=[e,"￿"];await g.Z.imap.where("accountId").equals(e).delete(),await g.Z.hasRaw.where("accountId").equals(e).delete(),await g.Z.pop.where("accountId").equals(e).delete(),await g.Z.mailboxCache.where("accountId").equals(e).delete();const a=(await g.Z.filters.where("[accountId+path]").between(n,i).toArray()).map((e=>e.id)),s=await Dt(e,a);t&&await Ft(e,s),await g.Z.buffer.where("accountId").equals(e).delete()}async function Ft(e,t){U.U.setStatus(C.A4,(0,d.Z)("Removing raw message files for $1",[e])),await Promise.all(t.map((t=>{mt.Z.call(e,t.id,t.sentDate).catch((n=>console.warn(`Error deleting file for ${e}/${t.id}. May not exist! ${n}`)))})))}async function Dt(e,t){const n=[],i=[],a=new Set;let s,r;t.forEach((e=>{for(let t=0;t<P.XN;t++)a.add(e*P.XN+t)}));const o=[];await g.Z.transaction("rw",[g.Z.messages,g.Z.searchList,g.Z.threading,g.Z.filters,g.Z.viewIds,g.Z.systemTasks,g.Z.hasRaw],(async()=>{U.U.setStatus(C.A4,(0,d.Z)("Updating database...")),await g.Z.searchList.where("sourceFilterIds").anyOf(t).distinct().modify(((e,a)=>{if(t.forEach((t=>{e.sources.delete(t)})),e.sources.size>0){const i=new Set(t);e.sourceFilterIds=e.sourceFilterIds.filter((e=>!i.has(e))),n.push(e);const a=new Set(_.Z.getByIds([...e.sources.keys()]).map((({accountId:e})=>e))),s=new Set(_.Z.getByIds(t).map((({accountId:e})=>e)).filter((e=>!a.has(e))));for(const t of s)o.push([e.id,t])}else i.push(e),delete a.value})),r=i.map((e=>e.id)),U.U.setStatus(C.A4,(0,d.Z)("Removing messages...")),await Promise.all([g.Z.messages.where("id").anyOf(r).delete().then((()=>U.U.setStatus(C.A4,(0,d.Z)("Removing threading info...")))),g.Z.threading.where("id").anyOf(r).delete().then((()=>U.U.setStatus(C.A4,(0,d.Z)("Removing header info...")))),g.Z.viewIds.where("searchListId").anyOf(r).delete().then((()=>U.U.setStatus(C.A4,(0,d.Z)("Updating view indices...")))),g.Z.viewIds.where("searchListId").anyOf(n.map((e=>e.id))).modify((e=>{e.viewIds=e.viewIds.filter((e=>!a.has(e)))})).then((()=>U.U.setStatus(C.A4,(0,d.Z)("Removing raw indicators...")))),g.Z.hasRaw.where("searchListId").anyOf(r).delete().then((()=>U.U.setStatus(C.A4,(0,d.Z)("Removing raw indicators...")))),g.Z.hasRaw.bulkDelete(o).then((()=>U.U.setStatus(C.A4,(0,d.Z)("Removing message filters...")))),g.Z.filters.where("id").anyOf(t).delete().then((()=>U.U.setStatus(C.A4,(0,d.Z)("Finished updating database"))))]);const e={taskName:"delete_full_text_search_entries",currentPosition:0,searchListIds:r},c=await g.Z.systemTasks.add(e);s={id:c,...e}})),s?Pt(s):console.warn("removeBySourceFilterIds: Expected task to be added"),_.Z.updateFilters(t);const c=n.map((e=>{const n=new Map([...t.map((e=>[e,void 0]))]);for(const[t,i]of e.sources)n.set(t,{...i});return{id:e.id,updates:{sources:n,sourceFilterIds:e.sourceFilterIds,removedViewIds:[...a]}}})),l={removedSles:r,sleUpdates:c};return U.QO.updateIndex(l),i}class zt extends Error{}const Bt=new Map;function $t(e,t,n){switch(U.QO.setAccountIndicator(e.MAIL_EMAIL,"INDICATOR_TYPE_FLUSHING",n.current,n.total),t.operation){case"BUFFER_OPERATION_CUSTOM_FLAG":return Oi.updateFlags(e.MAIL_EMAIL,t.path,t.uids,t.flagUpdates);case"BUFFER_OPERATION_DELETE_IMAP":return Oi.deleteMessages(e.MAIL_EMAIL,t.path,t.uids);case"BUFFER_OPERATION_DELETE_POP":return ft(e,t.searchListIds);case"BUFFER_OPERATION_MOVE":return Oi.moveMessages(t.accountId,t.path,t.uids,t.destinationPath);case"BUFFER_OPERATION_COPY":return Oi.copyMessages(e.MAIL_EMAIL,t.path,t.uids,t.destinationPath);case"BUFFER_OPERATION_UPLOAD_MESSAGE":return Oi.uploadMessage(e.MAIL_EMAIL,t.path,t.searchListId,t.flags);default:return Promise.reject("Unknown batch operation '"+t.operation+"'")}}async function jt(e,t){if(e.accountType===P.s9.IMAP&&!e.offline){for(const n of t)if("Inbox"!==n)try{await Oi.selectMailbox(e.MAIL_EMAIL,n)}catch(t){k.Z.error("Mail",["syncAndPark",e.MAIL_EMAIL,n],t)}Oi.park(e.MAIL_EMAIL)}}async function Vt(e){const t=await x.Z.call(e);if(!t)return;const n=await A.Z.getBySearchListIdHasRaw(e,!1);if(0===n.length)return;const a=new Map(n.map((({accountId:e})=>[e,!1]))),s=await g.Z.imap.where("searchListId").equals(e).toArray();if(s.length>0){const n=i.Z.get(T.kMailAccounts),r=new Set(n.filter((({accountType:e,offline:t})=>e===P.s9.IMAP&&!t)).map((({accountId:e})=>e)));for(const{accountId:n}of s){if(!a.has(n)||a.get(n))continue;if(!r.has(n))continue;U.U.setStatus(C.A4,(0,d.Z)("Fetching message with subject $1 on mail server $2",[t.subject,n]),3e3);let i=await Oi.fetchRawOfMessage(n,e);i&&(i=await(0,L.Z)(e,t,i),await R.Z.call(n,t.sentDate,e,i),await S.Z.setHasRaw(n,e),a.set(n,!0))}}const r=await g.Z.pop.where("searchListId").equals(e).toArray();for(const{accountId:n,uidl:i}of r){if(!a.has(n)||a.get(n))continue;const s=await I.Z.loadAccount(n);let r=await pt(s,i,e);r=await(0,L.Z)(e,t,r),await R.Z.call(n,t.sentDate,e,r),await S.Z.setHasRaw(n,e),a.set(n,!0)}}const qt=new Map;function Qt(e,t){return v.Z.adjustBatchSize(100,1e3,500,e,t)}const Ht=(0,F.Z)((async()=>{await async function(){const e=await g.Z.buffer.where("operation").equals("BUFFER_OPERATION_REMOVE_ACCOUNT").toArray();for(const t of e){const{accountId:e,deleteFiles:n,deletePasswords:i}=t;await Ut(e,n),Z(e,i)}}(),await async function(){const e=await g.Z.buffer.where("operation").equals("BUFFER_OPERATION_REMOVE_ACCOUNT_PATH").toArray();for(const t of e){const{accountId:e,path:n,deleteFiles:i}=t;await Ct(e,n,i)}}();(await I.Z.loadAllAccounts()).forEach((e=>{const{MAIL_EMAIL:t}=e;void 0===Bt.get(t)&&Kt(e)})),await async function(){const e=await g.Z.buffer.where("operation").equals("BUFFER_OPERATION_FETCH_RAW_FOR_ALL_SOURCES").toArray();for(const t of e)await Vt(t.searchListId);if(e.length>0){const t=e.map((e=>e._id));E.byIds(t);const n=e.map((e=>e.searchListId));U.QO.runStoredQueryFilters(n)}}()}),1e3);async function Kt(e,t=[]){const{MAIL_EMAIL:n}=e,i=Bt.get(n)||0;Bt.set(n,i);try{let a;if(await g.Z.buffer.where("accountId").equals(n).offset(i).limit(1).modify((e=>{e.isFlushing=!0,a=e})),!a)return Bt.set(n,void 0),U.QO.removeAccountIndicator(n,"INDICATOR_TYPE_FLUSHING"),jt(e,t),void qt.delete(n);if(e.offline)return await g.Z.buffer.where("_id").equals(a._id).delete(),void await Promise.resolve().then((()=>Kt(e,t)));const s="BUFFER_OPERATION_DELETE_POP"===a.operation?P.Gf:a.path,o=await r.Z.getFolderByPath(n,s);if(!o||e.accountType===P.s9.IMAP&&!o.subscribed)return k.Z.info("Mail",["flushBuffer",n,s],"Removing batch for a path that no longer exist or is not subscribed"),await g.Z.buffer.where("_id").equals(a._id).delete(),void await Promise.resolve().then((()=>Kt(e,t)));t.push(s),a.destinationPath&&t.push(a.destinationPath);const c=qt.get(n)||Qt(100,500);if(void 0!==a.uids&&a.uids.length>c){const{uids:t}=a,{current:r=0,total:o=t.length}=a,l={current:r,total:o},d=t.slice(0,c),u={...a,uids:d},h=Date.now();try{await $t(e,u,l);const t=new Set(d);await g.Z.buffer.where("_id").equals(a._id).modify((function(e){e.uids=e.uids.filter((e=>!t.has(e))),e.uids.length>0?(e.current=r+d.length,e.total=o,e.isFlushing=!1):delete this.value}));const i=Qt(c,Date.now()-h);qt.set(n,i)}catch(e){Bt.set(n,i+1),k.Z.error("Mail",["flushBuffer",n,s],e),e instanceof zt?await g.Z.buffer.where("_id").equals(a._id).delete():await g.Z.buffer.where("_id").equals(a._id).modify({isFlushing:!1})}}else{let t;t="BUFFER_OPERATION_DELETE_POP"===a.operation?{current:a.searchListIds.length,total:a.searchListIds.length}:{current:1,total:1};try{if(await $t(e,a,t),void 0!==a.uids){const e=new Set(a.uids);await g.Z.buffer.where("_id").equals(a._id).modify((function(t){t.isFlushing=!1,t.uids=t.uids.filter((t=>!e.has(t))),0===t.uids.length&&delete this.value}))}else await g.Z.buffer.where("_id").equals(a._id).delete()}catch(e){Bt.set(n,i+1),k.Z.error("Mail",["flushBuffer",n,s],e),e instanceof zt?await g.Z.buffer.where("_id").equals(a._id).delete():await g.Z.buffer.where("_id").equals(a._id).modify({isFlushing:!1})}}await Promise.resolve().then((()=>Kt(e,t)))}catch(i){k.Z.error("Mail",["flushBuffer",n],i),Bt.set(n,void 0),U.QO.removeAccountIndicator(n,"INDICATOR_TYPE_FLUSHING"),jt(e,t)}}const Wt={call:function(){navigator.onLine&&Ht()}};var Gt=n(12382);async function Yt(e,t,n){const i=[],a=[],s=new Map,r=_.Z.getByFolderId([e,t]);return n.forEach((n=>{const{uid:i}=n;a.push([e,t,i]),s.set(i,n)})),await g.Z.transaction("rw",[g.Z.imap,g.Z.searchList,g.Z.filteringQueue,g.Z.buffer],(async()=>{const n=await g.Z.imap.where("[accountId+path+uid]").anyOf(a).toArray(),o=new Map;n.forEach((e=>{const{searchListId:t,uid:n}=e,i=s.get(n);if(!i)throw new Error("imapMessage not found");o.set(t,i)}));const c=new Gt.Z.FilteringUpdatesSorter,l=[],d=[],u=[];await g.Z.searchList.where("id").anyOf([...o.keys()]).modify((n=>{const{id:a,unseen:s,flags:h}=n,f=o.get(a),p={},g={sources:new Map},m=(0,H.jw)(f.flags);p.sources=new Map;const w=(0,H.QE)(h,m);Object.keys(w).length>0&&(!function(e,t){delete t[P.T4.RECENT];const n=u.find((e=>(0,H.ui)(e.imapFlagUpdates,t)));n?n.searchListIds.push(e):u.push({searchListIds:[e],imapFlagUpdates:t})}(a,w),p.flags=n.flags=m,(0,H.wh)(h,f.flags,a,d),(0,H.Oj)(h,f.flags,a,l));const y=n.sources.get(r.id);if(!y)return void k.Z.warn("Mail",["imapUpdateFlags"],`Source not found for ${e}, ${t}`);const v=!(0,H.FL)(f),I={};y.read!==v&&(s&&v&&(n.unseen=p.unseen=g.unseen=!1),y.read=I.read=v);for(const[t,i]of n.sources)if(i.internal){const n=_.Z.get(t)?.accountId;t!==r.id&&n===e&&v!==i.read&&(i.read=v,p.sources.set(t,{read:v}))}const E=(0,H.uY)(f);if(y.deleted!==E&&(y.deleted=I.deleted=E),Object.keys(I).length>0&&(p.sources.set(r.id,I),g.sources.set(r.id,I)),!E){const i=b.Z.getFolderType(e,t);if(![P.uT,P.Hd,P.hn].includes(i)){[...n.sources.keys()].forEach((t=>{const i=n.sources.get(t);if(!i)throw new Error("Source not found "+t);if(i.internal&&i.deleted){const i=_.Z.get(t);if(!i)throw new Error("Filter not found "+t);i.accountId===e&&(n.sources.delete(t),p.sources.set(t,void 0),g.sources.set(t,void 0))}}))}}(Object.keys(p).length>1||p.sources.size>0)&&i.push({id:a,updates:p}),(Object.keys(g).length>1||g.sources.size>0)&&c.add(a,g)}));for(const e of c.getSorted()){const{searchListIds:t,updates:n}=e;if(n.sources.size>0){const e=[[P.of,P.cm],[P.of,P.tB],[P.of,P.rp],[P.of,P.$T]];await y.Z.call({type:"FILTERS_SLES",priority:P.Un.HIGH,folderIds:e,searchListIds:t})}}for(const e of d){const{searchListIds:t,oldStandardFlag:n,newStandardFlag:i}=e,a=[];n&&a.push([P.MN,n]),i&&a.push([P.MN,i]),a.length>0&&await y.Z.call({type:"FILTERS_SLES",priority:P.Un.HIGH,folderIds:a,searchListIds:[...t]})}for(const e of l){const{searchListIds:t,flag:n}=e,i=[[P.ut,n]];await y.Z.call({type:"FILTERS_SLES",priority:P.Un.HIGH,folderIds:i,searchListIds:[...t],runLabels:!0})}for(const e of c.getSorted()){const{searchListIds:t,updates:n}=e;await y.Z.call({type:"UPDATE_SLE",priority:P.Un.HIGH,searchListIds:t,...n})}if(u.length>0){for(const{searchListIds:t,imapFlagUpdates:n}of u)await w.Z.call(t,n,e);Wt.call()}})),i}var Xt=n(89846);async function Jt(e,t){return await g.Z.transaction("rw",[g.Z.searchList,g.Z.messages,g.Z.threading],(async()=>{const n=(await g.Z.searchList.where("messageId").equals(e).toArray()).map((e=>e.id));await g.Z.searchList.where("id").anyOf(n).modify((e=>e.messageId=t)),await g.Z.messages.where("id").anyOf(n).modify((e=>e.messageId=t)),await g.Z.threading.where("id").anyOf(n).modify((e=>e.messageId=t))}))}async function en(e,t,n,i){let a=[];const s=await g.Z.transaction("rw",m.E.concat([g.Z.imap,g.Z.accounts,g.Z.filters,g.Z.searchList,g.Z.filteringQueue,g.Z.buffer]),(async()=>{const s=[],o=[],c=[],l={};for(const e of i)if(e.originalMessageId){const t=e.originalMessageId;l[t]=e.messageId,await Jt(t,e.messageId)}if(Object.keys(l).length>0)for(const e of i)l[e.messageId]&&(e.messageId=l[e.messageId]);const d=await h.Z.findMatchingSles(i),u=await async function(e,t,n){if(e.every((({searchListEntry:e})=>!e)))return{intact:e,newImapEntries:[],sleUpdates:[]};const i={},a=await r.Z.getFolderByPath(t,n);if(!a)throw new Error(`${n} not found in db.accounts table for ${t}`);const s=a.type,o=_.Z.getByFolderId([t,n]);if(!o)throw new Error(`Filter not found for ${t} ${n}`);const c=[],l=[];for(const a of e){const{message:e,searchListEntry:r}=a;if(!r||e.sentDate!==r.sentDate||e.subject!==r.subject){l.push(a);continue}const{sourceFilterIds:d,sources:u}=r,h=u.get(o.id);if(!h||!h.internal){l.push(a);continue}const f=_.Z.getByIds(d);let p,g;for(const e of f){const{accountId:i,path:a}=e,r=i===t&&a===n;if(i===P.of&&a===P.N1&&s===P.Nz||r){p=i,g=a;break}}if(!p){l.push(a);continue}if(!g){l.push(a);continue}i[r.id]=e.uid;const{sleUpdate:m}=await(0,Xt.Z)(r.id,p,g,t,n,{addedProperties:{searchListSource:{internal:!1}}});c.push(m)}const d=[],u=[];for(const e of c)u.push(e),d.push({accountId:t,path:n,uid:i[e.id],searchListId:e.id});return{intact:l,newImapEntries:d,sleUpdates:u}}(d,e,t),{intact:f,newImapEntries:w,sleUpdates:b}=u;if(s.push(...w),c.push(...b),0===f.length){await g.Z.imap.bulkPut(s);const n=await Yt(e,t,i);return c.push(...n),{sleUpdates:c}}const{newMessageGroups:y,duplicates:v}=h.Z.findDuplicates(f);for(const n of v){const{message:i,searchListEntry:a}=n,r={accountId:e,path:t,uid:i.uid,searchListId:a.id};s.push(r)}const I=y.map((e=>e[0])),k=await(0,m.Z)(e,t,n,I),E=k.addedSles;if(a=k.forSearchDb,E.forEach(((n,i)=>{y[i].forEach((i=>{s.push({accountId:e,path:t,uid:i.uid,searchListId:n.id})})),o.push(n)})),s.length!==i.length)throw new Error("Assert error in addImap: expected imapEntries to match imapMessages");const x=await g.Z.imap.where("searchListId").anyOf(s.map((e=>e.searchListId))).toArray(),A=[];for(const e of s){p()(x,e,ne.gE)<0&&A.push(e)}await g.Z.imap.bulkAdd(A);const S=new Set(w.map((e=>e.uid))),M=i.filter((e=>S.has(e.uid))),N=await Yt(e,t,M);if(c.push(...N),v.length>0){const i=await h.Z.addSourceFilters(e,t,n,v,!1);c.push(...i)}return{addedSles:o,sleUpdates:c}}));return(0,z.Z)(a),s}const tn=async function(e,t){const n=[],i=e.map((e=>e.searchListId));return g.Z.imap.bulkAdd(e),await g.Z.searchList.where("id").anyOf(i).modify((e=>{const{id:i}=e,a={sources:new Map},s=e.sources.get(t.id);if(s)s.internal=!1,a.sources.set(t.id,{...s});else{const n={read:!1,deleted:!1,internal:!1};e.sources.set(t.id,n),a.sources.set(t.id,{...n})}n.push({id:i,updates:a})})),n};const nn=async function(e,t,n){await g.Z.buffer.where("[accountId+path+operation]").equals([e,t,"BUFFER_OPERATION_CUSTOM_FLAG"]).modify((function(e){const{uids:t,flagUpdates:i}=e,a=new Set(t);n.forEach((e=>{Object.keys(i).every((t=>i[t]?e.flags.includes(t):!e.flags.includes(t)))&&a.delete(e.uid)})),0===a.size?delete this.value:e.uids=[...a]}))};var an=n(9112),sn=n(93818);const rn=async function(e){const{sources:t}=e;if(0===t.size)return Promise.resolve(!1);if(![...t.values()].every((e=>e.deleted&&e.internal)))return Promise.resolve(!0);const n=new Set,i=_.Z.getByIds([...t.keys()]);for(const e of i)n.add(e.accountId);const a=await A.Z.getBySearchListIdAccountIds(e.id,[...n]);return Promise.resolve(a.some((e=>e?.hasRaw)))};var on=n(93043);var cn=n(89555);let ln,dn,un,hn={};function fn(){k.Z.info("Mail",["imapCache"],"Resetting init promise"),ln=new Promise(((e,t)=>{dn=()=>{k.Z.info("Mail",["imapCache"],"Resolving init promise"),e()},un=e=>{k.Z.info("Mail",["imapCache"],"Rejecting init promise"),t(e)}})),ln.catch(cn.Z)}function pn(){return k.Z.info("Mail",["imapCache"],"Initializing UID lists"),g.Z.imap.orderBy("[accountId+path+uid]").primaryKeys().then((e=>{e.forEach((e=>{const[t,n,i]=e;hn[t]||(hn[t]={}),hn[t][n]||(hn[t][n]=new Set),hn[t][n].add(i)})),dn()})).catch((e=>{throw un(e),e}))}async function gn(e){await ln;const t=await async function(e){const t=new Set,n=await r.Z.getFolder(e);for(const e of Object.keys(n)){const i=n[e];for(const e of i)t.add(e.path)}return t}(e),n=await g.Z.mailboxCache.where("accountId").equals(e).toArray(),i=hn[e]||{},a={};for(const e of n)a[e.path]=e,a[e.path].uidlist=Array.from(i[e.path]||[]),a[e.path].exists=a[e.path].uidlist.length,a[e.path].highestModseq=a[e.path].highestModseq||"0",t.delete(e.path),a[e.path].noModseq=a[e.path].noModseq||!1;for(const e of t){const t=Array.from(i[e]||[]),n=t.length>0?t[t.length-1]+1:0;a[e]={uidlist:t,uidNext:n,exists:t.length}}return a}fn();var mn=n(83065),wn=n(13248);function _n(e){const t=e.split(","),n=[];return t.forEach((e=>{if(e.indexOf(":")>=0){const[t,i]=e.split(":"),a=Number.parseInt(t),s=Number.parseInt(i);if(a<s)for(let e=a;e<=s;e++)n.push(e);else for(let e=s;e<=a;e++)n.push(e)}else{const t=Number.parseInt(e);n.push(t)}})),n}var bn=n(72315),yn=n.n(bn),vn=n(91258);const In={debug:e=>{i.Z.get(T.kMailImapLogsOn)&&k.Z.debug("Mail",["imap-client"],...e())},info:e=>{i.Z.get(T.kMailImapLogsOn)&&k.Z.info("Mail",["imap-client"],...e())},error:e=>{i.Z.get(T.kMailImapLogsOn)&&k.Z.error("Mail",["imap-client"],...e())}};function kn(e,t){const n=t||{user:e.MAIL_USER,pass:(0,Re.DA)((new TextEncoder).encode(e.MAIL_PASSWORD))},a=new(yn())({host:e.MAIL_SERVER,port:Number(e.MAIL_PORT),auth:n,secure:!0,ignoreTLS:!1,id:{name:`Vivaldi Mail/${N.Z.utilities.getVersion().vivaldiVersion}`},logger:In});return a._client.logLevel=i.Z.get(T.kMailImapLogsOn)?vn.lw:vn.jF,a._client.timeoutConnection=1e4,a._client._enableCompression=!1,a}var En=n(82164),xn=n(36154);let An={};async function Sn(e,t){const n=await(0,xn.Vf)(e,t),{accessToken:i,refreshToken:a,expiresIn:s,usernameFromIdToken:r}=n;r&&r.toLowerCase()!==e.toLowerCase()&&(Nn(e,["Username and the sub from idToken do not match",e,r]),e=r);const o=Date.now()+1e3*parseInt(s);if(Nn(e,["Fetched both refresh_token and access_token that expires in: ",Mn(o)]),Tn({[e]:{accessToken:i,expiryTime:o}}),a)try{const n={refreshToken:await N.Z.utilities.osCrypt(a),provider:t};Rn.call(e,n)}catch(e){k.Z.error("oAuth","Error crypting refresh_token",e)}return{accessToken:i,usernameFromIdToken:e}}function Mn(e){const t=new Date(e);return`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()} ${t.getHours()}:${t.getMinutes()}:${t.getSeconds()}`}function Nn(e,t){k.Z.info("oAuth",[e],t.join(" "))}async function On(e,t){const n=(await Ln.call())[e],a=function(e){return(i.Z.get(T.kOauthRefreshTokens)||{})[e.toLowerCase()]}(e);if(n&&n.expiryTime>Date.now())return Nn(e,[`Valid access_token found in cache that expires in: ${Mn(n.expiryTime)}`]),{accessToken:n.accessToken,usernameFromIdToken:e};if(a){let n="";try{n=await N.Z.utilities.osDecrypt(a.refreshToken)}catch{return Zn(e,t)}Nn(e,["The access_token has expired in-session or we restarted the session.","Lets fetch new access_token using refresh_token from prefs"]);const i=await xn.jb.call(n,t),{accessToken:s,expiresIn:r,invalidGrant:o,refreshToken:c,usernameFromIdToken:l}=i;if(c&&c!==n&&Rn.call(e,{refreshToken:await N.Z.utilities.osCrypt(c),provider:t}),o)return Nn(e,["Invalid oAuth grant. Refresh Token has expired or has been revoked"]),k.Z.warn("oAuth","Invalid oAuth grant. Refresh Token has expired or has been revoked"),Zn(e,t);{const t=Date.now()+1e3*parseInt(r);return Nn(e,[`Got new access token with new expiry time: ${Mn(t)}\n        (fetched with stored refresh_token)`]),Tn({[e]:{accessToken:s,expiryTime:t}}),{accessToken:s,usernameFromIdToken:l}}}return Nn(e,["We don't have a cached token and we don't have a refresh token.","Need to fetch both."]),await Sn(e,t)}function Tn(e){An={...An,...e}}async function Zn(e,t){return Pn.call(e),Sn(e,t)}const Ln={call:function(){return An}},Rn={call:async function(e,t){M.Z.set(T.kOauthRefreshTokens,{...i.Z.get(T.kOauthRefreshTokens),[e]:t})}},Pn={call:async function(e){const t={...i.Z.get(T.kOauthRefreshTokens)},{provider:n}=t[e],a=En.Z.oAuthProviders().get(n),s=(await Ln.call())[e];if(a?.revokeRefreshToken&&s){const{accessToken:e}=s;a.revokeRefreshToken(e)}!function(e){delete An[e]}(e),delete t[e.toLowerCase()],M.Z.set(T.kOauthRefreshTokens,t)}};var Cn=n(6271);async function Un(e){const{accessToken:t}=await On(e.MAIL_EMAIL,(0,Cn.dn)(e));return{user:e.MAIL_EMAIL,xoauth2:t}}var Fn=n(35874);const Dn=new Map,zn=new Map,Bn=new Set,$n=new Map,jn=new Map,Vn=18e5,qn=9e5,Qn={},Hn={},Kn=new Set;let Wn=!1,Gn=!1;const Yn=new Map;let Xn,Jn=!1,ei=!1;const ti=500,ni=new Map,ii=new class{constructor(e){this.lock=(0,l.M)(),this._priorityQueue=[];for(let t=0;t<e;t++)this._priorityQueue.push([])}queue(e,t,...n){return new Promise(((i,a)=>{this._priorityQueue[t].push({func:e,resolve:i,reject:a,params:n}),this._processQueue()}))}async _processQueue(){const e=await this.lock();try{await this._runNextInLine()}finally{e()}}async _runNextInLine(){for(const e of this._priorityQueue){const t=e.shift();if(t){const{func:e,resolve:n,reject:i,params:a}=t;try{n(await e(...a))}catch(e){i(e)}return!0}}return!1}}(Object.keys(P.NB).length);let ai=!1;function si(e){if(!navigator.onLine){const e=(0,d.Z)("No network connection");throw new Error(e)}if(i.Z.get(T.kMailIsTurnedOff))throw new Error((0,d.Z)("Mail has been turned off"));const t=(i.Z.get(T.kMailAccounts)||[]).find((t=>t.MAIL_EMAIL===e));if(!t)throw new Error((0,d.Z)("Account has been deleted"));if(t.offline)throw new Error((0,d.Z)("Account is offline"));const n=Dn.get(e);if(n)return n;if(zn.has(e))throw(0,d.Z)("Is logging into mail account $1",[e]);throw U.U.setStatus(C.A4,(0,d.Z)("Reconnecting $1",[e])),Ii(e),(0,d.Z)("Not connected to $1 - Attempting to connect",[e])}function ri(e){e!==P.of&&(Bn.add(e),ci())}function oi(e){k.Z.error("Mail",["imap"],e)}const ci=(0,F.Z)((async()=>{const e=[...Bn];Bn.clear();for(const t of e){const[e]=b.Z.getPathsByType(t,P.e9);if(!e)return void k.Z.warn("Mail",["imap",t],"No inbox found to park in");if(Dn.has(t))try{await li(t,e,!0)}catch(e){oi(e)}}}),2e3);function li(e,t,n=!1){if(!navigator.onLine)return Promise.reject((0,d.Z)("No network connection"));Qn[e]||(Qn[e]=[]);const i=Qn[e];return new Promise(((s,r)=>{n?0!==i.length&&i[0].path===t||i.unshift({path:t,resolve:s,reject:r}):i.find((e=>e.path===t))||i.push({path:t,resolve:s,reject:r}),Hn[e]||(Hn[e]=!0,a())}));async function a(){const t=Qn[e];if(!t||t.length<=0)return void(Hn[e]=!1);const{path:n,resolve:i,reject:s}=t.pop();try{const t=si(e);await t.selectMailbox({path:n}),i()}catch(e){s(e)}finally{U.QO.removePathIndicator(e,n),a()}}}async function di(e,t){const n=await g.Z.imap.where("searchListId").equals(t).filter((t=>t.accountId===e)).toArray();if(0===n.length)return;const i=new Map(n.map((({path:e,uid:t})=>[e,t]))),a={accountId:e,pathToUid:i,size:0,searchListId:t};return(await ii.queue(ui,P.NB.FETCH_RAW,e,[a])).get(t)}async function ui(e,t){const n=new Map;if(0===t.length)return n;if(!navigator.onLine)throw new Error((0,d.Z)("No network connection"));const i=new Set;for(const{pathToUid:e}of t)for(const t of e.keys())i.add(t);try{for(const a of[...i]){const i=new Map;for(const{searchListId:e,pathToUid:s}of t){if(n.has(e))continue;const t=s.get(a);void 0!==t&&i.set(t,e)}if(0===i.size)continue;const s=[...i.keys()],r=si(e),o=await r.getMessages({path:a,uids:s});Object.keys(o).forEach((t=>{const s=i.get(parseInt(t));s?o[t]?n.set(s,o[t]):oi(`Expected to find raw for ${e}/${a}/${t}`):oi(`Un-expected uid ${e}/${a}/${t}`)}))}return ri(e),n}catch(t){throw U.U.setStatus(C.A4,(0,d.Z)("Failed to get message body - $1",[t])),k.Z.warn("Mail",["imap",e],"Fetch raw",t),t}}async function hi(e,t,n,a,s){if(!navigator.onLine)throw new Error((0,d.Z)("No network connection"));const r=si(e),o=await r.listMessages({path:t,uids:n});i.Z.get(T.kMailAutoGenerateContacts)&&await(0,Nt.Z)(e,t,o);const c=b.Z.getFolderType(e,t),l=await en(e,t,c,o);ei=!1,U.QO.updateIndex(l),me.filter(),Le.updateThreads();const{addedSles:u,sleUpdates:h}=l;(u&&u.length>0||h&&h.length>0)&&(U.U.setStatus(C.A4,(0,d.Z)("Indexing mail $1 $2 $3/$4",[e,t,s,a])),U.QO.setPathIndicator(e,t,"INDICATOR_TYPE_FETCHING",P.NB.SYNC_NEW_DELETED,s,a));!function(e,t,n){if(hn[e]||(hn[e]={}),hn[e][t]){const i=[...hn[e][t],...n].sort(((e,t)=>e-t));hn[e][t]=new Set(i)}else hn[e][t]=new Set(n)}(e,t,o.map((e=>e.uid)))}function fi(e){if(i.Z.get(T.kMailIsTurnedOff))return!1;const t=(i.Z.get(T.kMailAccounts)||[]).find((t=>t.MAIL_EMAIL===e));return!!t&&!t.offline}function pi(e){if(i.Z.get(T.kMailIsTurnedOff)||Gn)return!1;const t=(i.Z.get(T.kMailAccounts)||[]).find((t=>t.MAIL_EMAIL===e));return!!t&&!t.offline&&t.preFetch}async function gi(e,t,n,i){let a=100,s=0;const r=new v.Z.BatchSizeOptimizer(100,2e3);return new Promise(((o,c)=>{ii.queue((async function l(){if(!fi(e))return void o();const d=t.slice(s,s+a);if(0===d.length)return void o();const u=Date.now();try{await i(d,t.length,s),s+=a}catch(e){return void c(e)}const h=Date.now();a=r.optimize(a,h-u),ii.queue(l,n)}),n)}))}async function mi(e,t){if(!navigator.onLine)throw new Error((0,d.Z)("No network connection"));U.U.setStatus(C.A4,(0,d.Z)("Indexing - $1 $2",[e,t.path]));const{list:n,path:i,type:a}=t;try{if("new"===a)k.Z.log("Mail",["imap",e],"new messages received",i,n),n.reverse(),await gi(e,n,P.NB.SYNC_NEW_DELETED,(async(t,n,a)=>{await hi(e,i,t,n,a)})),await Si(e);else if("deleted"===a){if(k.Z.log("Mail",["imap",e],"messages deleted on server",i,n),await gi(e,n,P.NB.SYNC_NEW_DELETED,(async t=>{await async function(e,t,n){const i=n.map((n=>[e,t,n])),a=[];let s=[];const r=[],o=new Gt.Z.FilteringUpdatesSorter,c=_.Z.getByFolderId([e,t]);await g.Z.transaction("rw",[g.Z.searchList,g.Z.messages,g.Z.buffer,g.Z.imap,g.Z.filteringQueue,g.Z.hasRaw,g.Z.threading,g.Z.viewIds],(async()=>{await g.Z.imap.where("[accountId+path+uid]").anyOf(i).modify(((e,t)=>{a.push(e.searchListId),delete t.value}));const l=[];await g.Z.searchList.where("id").anyOf(a).modify((n=>{const{id:i}=n,a={},r={sources:new Map};let d=!1;a.sources=new Map;const u=n.sources.get(c.id);if(u){const i=[P.uT,P.Hd,P.hn],s=b.Z.getFolderType(e,t),o=i.includes(s);let l=!1,h=!1;for(const t of[...n.sources.keys()]){const n=_.Z.get(t);if(!n)throw new Error("Filter not found "+t);if(n.accountId!==e)continue;const a=b.Z.getFolderType(n.accountId,n.path);i.includes(a)?h=!0:l=!0}!l||!o&&h?(u.deleted=!0,u.internal=!0,r.sources.set(c.id,{...u}),a.sources.set(c.id,{...u})):(n.sources.delete(c.id),d=!0,r.sources.set(c.id,void 0),a.sources.set(c.id,void 0))}const h=0===n.sources.size||[...n.sources.values()].every((e=>e.internal));h&&l.push(n),(Object.keys(a).length>1||a.sources.size>0)&&s.push({id:i,updates:a}),o.add(i,r,d)}));for(const e of l)if(!await rn(e)){const{id:t}=e;r.push(t)}if(r.length>0){await on.Z.call(r);const e=new Set(r);s=s.filter((({id:t})=>!e.has(t)))}await E.byUids(e,t,n);for(const e of o.getSorted()){const{searchListIds:t,updates:n,rerunFiltering:i}=e;i?await y.Z.call({type:"RE_RUN_SLES",priority:P.Un.NORMAL,searchListIds:t,folderIds:[[P.of,P.cm],[P.of,P.rp]]}):await y.Z.call({type:"FILTERS_SLES",priority:P.Un.NORMAL,searchListIds:t,folderIds:[[P.of,P.cm],[P.of,P.rp]]}),await y.Z.call({type:"UPDATE_SLE",priority:P.Un.NORMAL,searchListIds:t,...n})}})),r.length>0&&await vt.Z.deleteMessages(r),await U.QO.updateIndex({sleUpdates:s,removedSles:r})}(e,i,t)})),b.Z.getFolderType(e,i)!==P.uT){const t=b.Z.getPathsByType(e,P.uT);try{for(const n of t)li(e,n)}catch(e){oi(e)}finally{ri(e)}}}else"messages"===a&&(k.Z.log("Mail",["imap",e],"flag updates from server",i,n),await gi(e,n,P.NB.SYNC_FLAGS,(async(t,n,a)=>{await async function(e,t,n,i,a){await nn(e,t,n);const s=await Yt(e,t,n);U.QO.updateIndex({sleUpdates:s}),U.U.setStatus(C.A4,(0,d.Z)("Updating flags $1 $2 $3/$4",[e,t,a,i])),U.QO.setPathIndicator(e,t,"INDICATOR_TYPE_FLAGS",P.NB.SYNC_FLAGS,a,i)}(e,i,t,n,a)})));if(fi(e)){const t=si(e);!function(e,t,n){"inbox"===t.toLowerCase()&&(t=P.Gf),ln.then((()=>g.Z.transaction("rw",g.Z.mailboxCache,(()=>{Object.keys(n).forEach((i=>{const a=n[i];i!==t&&0!==a.exists||g.Z.mailboxCache.put({accountId:e,path:i,uidNext:a.uidNext,highestModseq:a.highestModseq||"0",noModseq:a.noModseq||!1})}))}))))}(e,i,t.mailboxCache)}U.U.setStatus(C.A4,(0,d.Z)("Finished indexing - $1 $2",[e,i]),P.QM)}catch(e){oi(e),U.U.setStatus(C.A4,(0,d.Z)("Failed indexing - $1",[e]))}U.QO.removePathIndicator(e,i),U.QO.removePathIndicator(e,i),me.filter()}function wi(e,t){if(U.KU.set(e,"IMAP",t,t.code),(0,wn.dS)(e)&&"The user did not approve access."===t.message)k.Z.info("Mail",["imap",e],"User closed oAuth popup dialog");else if((0,Fn.I)(t.code))k.Z.info("Mail",["imap",e],"Authentication failed"),Yn.delete(e),U.QO.setDisconnected(e,!0);else{t.code?(k.Z.info("Mail",["imap",e],"Error",t.code,t.message||t),U.U.setStatus(C.A4,`[${t.code}] ${t.message||t}`)):(k.Z.info("Mail",["imap",e],"Error",t.message||t),U.U.setStatus(C.A4,`${t.message||t}`));const n=function(e){let t=Yn.get(e)||0;if(++t<=5)return Yn.set(e,t),2e3*t;let n=$n.get(e);n=void 0===n?6e4:Math.min(n+qn,Vn),$n.set(e,n);const i=Math.floor(1e3*Math.random()*6-3e3);return n+i}(e);Ii(e,n,t)}}async function _i(){const e=await I.Z.loadImapAccounts();if(e)for(const t of e)await bi(t);else k.Z.warn("Mail",["imap"],"No IMAP accounts found!")}async function bi(e){const t=e.MAIL_EMAIL;if(k.Z.info("Mail",["imap",t],"connectImapclient"),e.isDeleted||e.offline)return void k.Z.info("Mail",["imap",t],"deleted or offline",!!e.isDeleted,!!e.offline);if(!navigator.onLine)return k.Z.info("Mail",["imap",t],"No network connection"),void U.QO.setDisconnected(t,!0);if(!e.MAIL_PORT||e.MAIL_PORT<=0)throw new Error(`Port missing or invalid: ${e.MAIL_PORT||""}`);if((await g.Z.systemTasks.toArray()).some((e=>"restore_mail_db"===e.taskName)))k.Z.warn("Mail",["imap",t],"Not connecting while restoration in progress");else if(Dn.has(t))k.Z.info("Mail",["imap",t],"Already connected");else if(zn.has(t))k.Z.info("Mail",["imap",t],"Currently being connected");else{try{zn.set(t);let n=!1;const i=setTimeout((()=>{throw zn.delete(t),n=!0,new Error(`IMAP client initialization for ${t} timed out`)}),1e4);let a;if(k.Z.info("Mail",["imap",t],"Creating client"),e.useOAuth){a=kn(e,await Un(e))}else a=kn(e);a.onSyncUpdate=mi.bind(null,t),a.onError=e=>{wi(t,e)},k.Z.info("Mail",["imap",t],"Fetching mailbox cache");const s=await gn(t);if(a.mailboxCache=s||{},n)return;if(clearTimeout(i),!zn.has(t))return;if(zn.set(t,a),U.QO.setAccountIndicator(t,"INDICATOR_TYPE_CONNECTING"),U.QO.setConnecting(t,!0),k.Z.info("Mail",["imap",t],"Connecting"),await a.login(),!zn.has(t))return;k.Z.info("Mail",["imap",t],"Connected"),U.U.setStatus(C.A4,(0,d.Z)("Connected to $1",[t]),P.QM);const c=u.Z.get(t);c&&0===Object.keys(c.folders).length&&await async function(e){const t=await e.listWellKnownFolders();for(const n of[P.e9,P.Nz,P.uT])if(Array.isArray(t[n])&&t[n].length>0){const{path:i,subscribed:a}=t[n][0];a||await e.subscribeMailbox({path:i})}}(a);const l=await a.listWellKnownFolders();if(!zn.has(t))return;l.Inbox&&l.Inbox.forEach((e=>{"inbox"===e.path.toLowerCase()&&(e.path=P.Gf)})),await r.Z.addFolders(t,l),await u.Z.updateAccount(t,{folders:l});const h=await o.Z.foldersToFilters(t,l);_.Z.updateFilters(h),J.Z.addFolders(t,l),k.Z.info("Mail",["imap",t],"Clean up after connection"),$n.delete(t),ki(t),Yn.delete(t),zn.has(t)&&(Dn.set(t,a),U.QO.setDisconnected(t,!1),U.KU.delete(t,"IMAP"),Wt.call())}catch(e){wi(t,e)}finally{zn.delete(t),U.QO.setConnecting(t,!1),U.QO.removeAccountIndicator(t,"INDICATOR_TYPE_CONNECTING")}if(Dn.has(t))try{await xi(t),Si(t)}catch(e){oi(e)}}}async function yi(){for(const e of[...zn.keys(),...Dn.keys()])await vi(e)}async function vi(e,t){const n=Dn.get(e)||zn.get(e);if(k.Z.info("Mail",["imap",e],"Disconnect",!!n),delete Qn[e],delete Hn[e],ki(e),zn.has(e)&&(k.Z.info("Mail",["imap",e],"Client initialization cancelled"),zn.delete(e)),Dn.has(e)&&(k.Z.info("Mail",["imap",e],"Client disconnected"),Dn.delete(e)),U.QO.setDisconnected(e,!0),U.QO.removeAllIndicators(e),t&&U.KU.set(e,"IMAP",t,t.code),n)try{n.onSyncUpdate=!1,n.onError=cn.Z,await n.logout()}catch(t){oi(t)}finally{k.Z.info("Mail",["imap",e],"Logged out")}}async function Ii(e,t,n){async function a(){if(!navigator.onLine)return void k.Z.info("Mail",["imap",e],"No network. Skip reconnection attempt");const t=(await I.Z.loadImapAccounts()).find((t=>t.MAIL_EMAIL===e));k.Z.info("Mail",["imap",e],"Reconnect",t),t&&await bi(t)}i.Z.get(T.kMailIsTurnedOff)?k.Z.info("Mail",["imap",e],"Mail was turned off"):(await vi(e,n),t?function(e,t,n){if(jn.has(n))return void k.Z.info("Mail",["imap",n],"Has reconnect timeout");k.Z.info("Mail",["imap",n],"Set reconnect timeout");const i=setTimeout(e,t);jn.set(n,i)}(a,t,e):await a())}function ki(e){const t=jn.get(e);void 0!==t&&(clearTimeout(t),jn.delete(e))}function Ei(){return 0===Dn.size}function xi(e){if(Ei()||e&&!Dn.has(e))return Promise.resolve();let t;return t=e?r.Z.getFolder(e).then((t=>({[e]:{folders:t}}))):I.Z.loadImapAccounts().then((e=>r.Z.getAll().then((t=>{const n={};for(let i=0;i<e.length;i++){const a=e[i],s=t.find((e=>a.MAIL_EMAIL===e.accountId));s&&(n[s.accountId]={folders:s.folders})}return n})))),t.then((e=>{const t=c.Z.getFolders(e,!1);Promise.all(t.map((e=>{const t=e.accountId,i=e.children;if(!i||i.length<=0)return Promise.resolve();i.sort(((e,t)=>e.type===t.type?0:"Inbox"===e.type?1:"Inbox"===t.type?-1:"All"===e.type?1:"All"===t.type?-1:0)),Promise.all(n(t,i)).catch(oi).then((()=>ri(t)))})))}));function n(e,t){let i=[];for(const a of t)a.subscribed&&i.push(li(e,a.path)),a.children&&(i=i.concat(n(e,a.children)));return i}}async function Ai(e){Ei()||e&&!Dn.has(e)?await _i():xi(e)}function Si(e){Kn.add(e),Mi()}function Mi(){if(Wn||Gn)return;Wn=!0;const e=[...Kn];Kn.clear();let t=!1;e.reduce(((e,n)=>e.then((()=>async function(e){if(!pi(e))return;k.Z.log("Mail",["imap","prefetch",e],"starting"),t=!1;let n=0;const i=[],a=200;let s,r=!0;for(;r;)r=await ii.queue(o,P.NB.PRE_FETCH);t&&U.QO.removeAccountIndicator(e,"INDICATOR_TYPE_PRE_FETCHING");async function o(){if(!pi(e))return t&&(k.Z.log("Mail",["imap","prefetch",e],"stopped"),U.U.setStatus(C.A4,(0,d.Z)("Stopped prefetching - $1",[e])),k.Z.log("Mail",["imap","countWithNoRaw"],"resetting"),Xn=void 0,ni.clear(),ei=!1),!1;if(i.length<a&&await g.Z.transaction("r",[g.Z.hasRaw,g.Z.imap,g.Z.searchList],(async()=>{const t=await A.Z.getByAccountIdHasRaw(e,!1,5*a,s);if(0===t.length)return;const n=t[t.length-1];s=[0,e,n.searchListId];const r=t.map((({searchListId:e})=>e)),o=await g.Z.imap.where("searchListId").anyOf(r).filter((t=>t.accountId===e)).toArray();let c;for(const t of o){const{searchListId:n,path:a,uid:s}=t;if(c&&c.searchListId===n)c.pathToUid.set(a,s);else{const t=await g.Z.searchList.get(n);c={accountId:e,pathToUid:new Map([[a,s]]),size:t.size,searchListId:n},i.push(c)}}})),0===i.length)return k.Z.log("Mail",["imap","prefetch",e],"done"),t&&U.U.setStatus(C.A4,(0,d.Z)("Finished prefetching - $1",[e])),!1;const r=i.shift();let o=r.size,c=o?0:1;const l=32768,u=10,h=[r];for(;i.length>0&&o<l&&c<u;){const e=i.shift();h.push(e),e.size?o+=e.size:c++}k.Z.log("Mail",["imap","prefetch",e],"fetching batch",h.length),async function(){if(Jn||ei)return;Jn=!0,k.Z.log("Mail",["imap","countWithNoRaw"],"starting");try{for(;Jn;)Jn=await e();ei=!0}catch(e){oi(e)}finally{Jn=!1}async function e(){if(!Wn)return k.Z.log("Mail",["imap","countWithNoRaw"],"stopped"),!1;const e=Date.now(),t=Xn?await g.Z.hasRaw.where("[searchListId+accountId]").above(Xn).until((()=>Date.now()-e>ti)).toArray():await g.Z.hasRaw.orderBy("[searchListId+accountId]").until((()=>Date.now()-e>ti)).toArray();if(0===t.length)return k.Z.log("Mail",["imap","countWithNoRaw"],"done"),!1;k.Z.log("Mail",["imap","countWithNoRaw"],"counting batch",t.length);for(const{searchListId:e,accountId:n,hasRaw:i}of t){if(0===i){const e=ni.get(n)||0;ni.set(n,e+1)}Xn=[e,n]}return!0}}();const f=await async function(e,t){const n=await ui(e,t),i=await(0,an.Z)(Array.from(n.keys())),a=new Map;for(const e of i)a.set(e.id,e);const s=[];for(const[i,r]of n){const n=a.get(i);if(n){const{sentDate:t}=n,a=await(0,L.Z)(i,n,r);await R.Z.call(e,t,i,a),s.push(i)}else{const n=t.find((({searchListId:e})=>e===i));if(n){const t=[];for(const[a,s]of n.pathToUid)t.push([e,a,s]),k.Z.warn("Mail",["imap",e],`fetchRawFromImapEntries: Expected message ${i} to exist, deleting imap entry ${a}/${s}`);await g.Z.imap.bulkDelete(t);const a=[n.searchListId,n.accountId];await g.Z.hasRaw.delete(a)}}}return S.Z.setHasRaws(e,s)}(e,h);t=!0,n+=f;const p=ei?(0,d.Z)("Prefetching - $1 $2/$3",[e,n,ni.get(e)??""]):(0,d.Z)("Prefetching - $1",[e]);return U.U.setStatus(C.A4,p),U.QO.setAccountIndicator(e,"INDICATOR_TYPE_PRE_FETCHING",P.NB.PRE_FETCH,n,ei?ni.get(e):0),U.QO.runStoredQueryFilters(h.map((e=>e.searchListId))),!0}}(n).catch((e=>{U.U.setStatus(C.A4,(0,d.Z)("Error prefetching - $1",[n])),U.QO.removeAllIndicators(n),oi(`Error prefetching ${n} ${e}`)}))))),Promise.resolve()).then((()=>{Wn=!1,Kn.size>0&&Mi()}))}const Ni={setCheckInterval:function(e,t){ai&&clearInterval(ai),ai=!!e&&setInterval(xi,6e4*t)},fetchRawOfMessage:di,connectIMAPClient:bi,connectIMAPClients:_i,disconnectIMAPClient:vi,reconnectIMAPClient:Ii,reconnectIMAPClients:async function(){i.Z.get(T.kMailIsTurnedOff)||(await yi(),await _i())},disconnectIMAPClients:yi,checkNewDeletedModified:function(e,t){li(e,t).catch(oi).then((()=>ri(e)))},rescanUnreadFlags:function(e,t){const n=si(e).mailboxCache[t];n&&(n.highestModseq="0",li(e,t).catch(oi).then((()=>ri(e))))},checkForMail:Ai,preFetch:Si,subscribeMailbox:async function(e){const{accountId:t,path:n}=e,i=si(t);await i.subscribeMailbox({path:n}),Ii(t)},unsubscribeMailbox:async function(e,t){if(!c.Z.isUnsubscribable(e))throw new Error(`Folder ${e.accountId}/${e.path} can not be unsubscribed.`);const{accountId:n,path:i}=e,a=si(n);await a.unsubscribeMailbox({path:i}),t&&function(e,t){delete hn[e][t]}(n,i),Ii(n)},createMailbox:async function(e,t){try{t=(0,mn.y3)(t);const n=si(e),i=async()=>{await n.createFolder({path:t}),await n.subscribeMailbox({path:t})};await i(),Ii(e)}catch(n){k.Z.error("Mail",["imap",e,t,"create mailbox"],n.message||n)}},deleteMailbox:async function(e,t){try{const n=si(e),i=async()=>{await n.unsubscribeMailbox({path:t}),await Ct(e,t,!0),await n.deleteFolder({path:t})};await i(),Ii(e)}catch(n){k.Z.error("Mail",["imap",e,t,"delete mailbox"],n.message||n)}}};self.addEventListener("message",(async function({origin:e,data:t,source:n}){if(e!==C.oP||!t||!t.imap)return;const{promiseId:i,func:a,args:s=[]}=t.imap;if(a)try{const e=await Ni[a](...s),t=e&&"fetchRawOfMessage"===a?[e.buffer]:void 0;n.postMessage({imap:{promiseId:i,results:e}},{transfer:t})}catch(e){const t=e.message||e;n.postMessage({imap:{promiseId:i,error:t}})}}),!1);const Oi={checkForMail:Ai,copyMessages:async function(e,t,n,i){const a={path:t,uids:n,destination:i},s=[e,i],r=_.Z.getByFolderId(s);if(!r)throw new Error("Destination filter not found for "+s.join(", "));const o=await g.Z.imap.where("[accountId+path+uid]").anyOf(n.map((n=>[e,t,n]))).toArray(),c=new Map(o.map((e=>[e.uid,e]))),l=si(e),d=await l.copyMessages(a);if(!d)return void k.Z.warn("Mail",["imap",e],"UIDPLUS not supported, cannot create imap entries");const{srcSeqSet:u,destSeqSet:h}=d,f=_n(u),p=_n(h);let m;await g.Z.transaction("rw",[g.Z.imap,g.Z.searchList],(async()=>{const n=[];f.forEach(((a,s)=>{const r=p[s],o=c.get(a);o?n.push({...o,path:i,uid:r}):k.Z.warn("Mail",["imap",e],"cannot create imap entry for "+JSON.stringify([t,a]))})),m=await tn(n,r)})),m&&U.QO.updateIndex({sleUpdates:m})},deleteMessages:async function(e,t,n){const i={path:t,uids:n};return si(e).deleteMessages(i)},disconnectIMAPClient:vi,fetchRawOfMessage:di,moveMessages:function(e,t,n,i){const a={path:t,uids:n,destination:i};return si(e).moveMessages(a)},park:ri,selectMailbox:li,updateFlags:function(e,t,n,i){const a=[],s=[];for(const[e,t]of Object.entries(i))t?a.push(e):s.push(e);const r={path:t,uids:n,add:a,remove:s};return si(e).updateFlags(r)},uploadMessage:async function(e,t,n,i){const a=await(0,sn.Z)(n);if(!a)throw new zt(`Entry ${n} not found in searchList table`);const s=await Et.Z.call(e,n,a.sentDate);if(!s)throw new zt(`Can not upload message ${n} as raw file was not found on disk`);(await A.Z.getBySearchListId(n)).find((e=>e.hasRaw))||k.Z.warn("Mail",["imap",e,t,n],"imap.js: Data inconsistency, raw file found on disk contrary to hasRaw table");const r=(0,Re.DA)(s),o=[e,t],c=_.Z.getByFolderId(o);if(!c)throw new Error("Destination filter not found for "+o.join(", "));const l=si(e),d=i.indexOf(P.T4.RECENT);d>-1&&i.splice(d,1);const u=await l.uploadMessage({path:t,message:r,flags:i});if(ri(e),!u)return void k.Z.warn("Mail",["imap",e],"UIDPLUS not supported, cannot create imap entry");const h=Number.parseInt(u);let f;await g.Z.transaction("rw",[g.Z.imap,g.Z.searchList,g.Z.hasRaw],(async()=>{const i={accountId:e,path:t,uid:h,searchListId:n};f=await tn([i],c);const a={searchListId:n,accountId:e,hasRaw:1};await g.Z.hasRaw.put(a)})),f&&U.QO.updateIndex({sleUpdates:f})},pausePrefetching:function(e){k.Z.log("Mail",["imap","prefetch"],e?"pause possible prefetching":"resume possible prefetching"),Gn=e}};var Ti=n(78134),Zi=n(85834),Li=n(95064);const Ri=[{listId:"meetup.com",name:"meetup.com",parentFolderType:"endsWith",subFolderType:"title",isIgnored:!1},{listId:"facebook.com",name:"facebook.com",parentFolderType:"endsWith",subFolderType:"title",isIgnored:!1},{listId:"google.com",name:"google.com",parentFolderType:"endsWith",subFolderType:"senderName",isIgnored:!1},{listId:"groupon",name:"groupon",parentFolderType:"endsWith",subFolderType:"senderName",isIgnored:!1},{listId:"xt.local",name:"xt.local",parentFolderType:"endsWith",subFolderType:"host",isIgnored:!1},{listId:"sparkpostmail.com",name:"sparkpostmail.com",parentFolderType:"endsWith",subFolderType:"host",isIgnored:!1},{listId:"list-id.mcsv.net",name:"list-id.mcsv.net",parentFolderType:"endsWith",subFolderType:"host",isIgnored:!1},{listId:"spc-",name:"sparkpostmail.com (spc-)",parentFolderType:"startsWith",subFolderType:"host",isIgnored:!1},{listId:"MAILING_LIST_GROUPS_UNCATEGORIZED",name:"",parentFolderType:"uncategorized",subFolderType:"host",isIgnored:!1}];var Pi=n(65741);const Ci="Contacts";class Ui{count=0;constructor(e,t){this.version=e,this.interval=setInterval((()=>this.total&&U.U.setStatus(C.A4,`Upgrade v${e} mail: ${t} ${this.count} / ${this.total}`)),1e3),k.Z.info("Mail","Upgrade started: ",e)}stop(){clearInterval(this.interval),U.U.setStatus(C.A4,`Upgrade v${this.version} mail: Finalizing...`,5e3),k.Z.info("Mail","Upgrade finished: ",this.version)}}g.Z.on("populate",(()=>{g.Z.filters.bulkAdd(Li.j),g.Z.mailingList.bulkAdd(Ri),g.Z._upgrades.add({version:g.Z.verno})})),g.Z.version(136).stores({messages:"++id",searchList:["++id","messageId","*sourceFilterIds"].join(","),threading:["++id","*references","inReplyTo","messageId"].join(","),accounts:"accountId",mailboxCache:"[accountId+path],accountId",filters:"++id,&[accountId+path]",buffer:["++_id","[accountId+path+operation]","accountId","[accountId+path]","operation","[accountId+destinationPath+operation]"].join(","),views:"++id,filterId",imap:["[accountId+path+uid]","searchListId","[hasRaw+accountId+searchListId]","[accountId+path+searchListId]","accountId"].join(","),pop:"[accountId+uidl],searchListId,accountId",filteringQueue:"++id,priority",threadingQueue:"++id",viewIds:"searchListId,*viewIds",flaggingQueue:"++id",drafts:null,tokens:null,folders:null}).upgrade((e=>{e.messages.clear(),e.searchList.clear(),e.threading.clear(),e.accounts.clear(),e.mailboxCache.clear(),e.filters.clear(),e.buffer.clear(),e.views.clear(),e.imap.clear(),e.pop.clear(),e.filteringQueue.clear(),e.threadingQueue.clear(),e.viewIds.clear(),e.flaggingQueue.clear()}));const Fi=new Map;g.Z.version(137).stores({_upgrades:"version"}),Fi.set(137,(async e=>{new Ui(137,"Upgrade v137 mail").stop()})),Fi.set(138,(async e=>{const t=new Ui(138,"Upgrade v138 mail: Run Custom Folder");await e.filteringQueue.add({priority:P.Un.LOW,type:"RUN_FILTERS",folderIds:[[P.Ry,P.ym]],updateFilters:!0}),t.stop()})),Fi.set(139,(async e=>{const t=new Ui(139,"Upgrade v139 mail: Repair default filters"),n=[],i=["total","unseen","unread","excludeMailingLists","excludeDeleted","excludeRssFeeds","excludeJunk","excludeCustomFolders"];for(const t of Li.j){const{accountId:a,path:s}=t,r=await e.filters.where("[accountId+path]").equals([a,s]).first();if(r){const{id:a}=r,s={id:a,...t};await e.filters.put(s);const o=await e.views.where("filterId").equals(a).toArray(),c=new Set(o.map((e=>e.type)));for(const t of i)if(!c.has(t)){const n={filterId:a,type:t};e.views.add(n)}n.push(a)}else{const a=await e.filters.add(t);for(const t of i)await e.views.add({filterId:a,type:t});n.push(a)}}if(n.length>0){const t={priority:P.Un.LOW,type:"RUN_FILTERS",filterIds:n};e.filteringQueue.add(t)}t.stop()})),Fi.set(140,(async e=>{const t=new Ui(140,"Map viewIds to new format");t.total=await e.viewIds.count()+await e.views.count();const n=new Map,i=["total","unseen","unread","excludeMailingLists","excludeDeleted","excludeRssFeeds","excludeJunk","excludeCustomFolders"];await e.views.each((e=>{const a=i.indexOf(e.type);-1!==a&&n.set(e.id,100*e.filterId+a),t.count++})),await e.viewIds.toCollection().modify((e=>{const i=new Set;e.viewIds.forEach((e=>{const t=n.get(e);"number"==typeof t&&i.add(t)})),e.viewIds=[...i],t.count++})),e.views.clear(),t.stop()})),g.Z.version(141).stores({deletedFeedItems:"++id,path"}),Fi.set(142,(async e=>{const t=new Ui(142,"Fixing default parent filters");let n,i,a,s,r,o;function c(e,t){const{include:n}=e.filterValue;for(const e of t){n.some((t=>(0,Pi.Z)(t,e)))||n.push(e)}}o=[P.wC,""],r=[P.wC,"￿"];const l=await e.filters.where("[accountId+path]").between(o,r).toArray(),d=[],u=[];for(const e of l){const{path:t,filterValue:s}=e;if(t===P.ym)n=e;else if(t===P.W4)i=e;else if(t===P.cs)a=e;else{const e=s.include.filter((e=>1===e.length&&(e[0].listId||e[0].senderIsMailingList)));t.startsWith(P.W4)?d.push(...e):t.startsWith(P.cs)&&u.push(...e)}}if(!n)throw new Error("Mailing list root folder not found");if(!i)throw new Error("Mailing list Important folder not found");if(!a)throw new Error("Mailing list Other folder not found");c(n,d),c(n,u),c(i,d),c(a,u),o=[P.ut,""],r=[P.ut,"￿"];const h=await e.filters.where("[accountId+path]").between(o,r).toArray(),f=[];for(const e of h){const{path:t,filterValue:n}=e;if(t===P.ym)s=e;else{const e=n.include.filter((e=>1===e.length&&e[0].flag));f.push(...e)}}if(!s)throw new Error("Labels root folder not found");c(s,f),await e.filters.bulkPut([n,i,a,s]);const p=[n.id,i.id,a.id,s.id];await _.Z.updateFilters(p),await y.Z.call({type:"RUN_FILTERS",priority:P.Un.LOW,filterIds:p}),t.stop()})),Fi.set(143,(async e=>{const t=new Ui(143,"Fixing database inconsistency"),n=await e.searchList.toCollection().primaryKeys(),i=await e.viewIds.toCollection().primaryKeys(),a=new Set(n),s=i.filter((e=>!a.has(e)));await e.viewIds.where("searchListId").anyOf(s).delete(),t.stop()})),g.Z.version(144).stores({viewIds:"searchListId"}),Fi.set(146,(async e=>{const t=new Ui(146,"Fixing state of show-read button in received folder");await e.filters.where("[accountId+path]").equals([P.of,P.ik]).modify((e=>{e.filterValue={...e.filterValue,showReadButton:!0}})),t.stop()})),g.Z.version(147).stores({mailingList:"listId"}),Fi.set(147,(async e=>{const t=new Ui(147,"Group mailing lists providers (like xt.local and sparkpostmail.com)");await e.mailingList.bulkAdd(Ri);const n=P.wC,i=[n,""],a=[n,"￿"],s=await e.filters.where("[accountId+path]").between(i,a).toArray(),r=[];if(s.forEach((e=>{(e.path.endsWith(".xt.local")||e.path.endsWith(".sparkpostmail.com")||e.path.endsWith("list-id.mcsv.net")||e.path.startsWith(P.cs+"/spc-")||e.path.startsWith(P.W4+"/spc-"))&&r.push(e.id)})),r.length>0){const n=r.map((e=>100*e));await e.filters.where("id").anyOf(r).delete();const i=new Set,a=8;t.total=n.length,n.forEach((e=>{for(let t=0;t<a;t++)i.add(e+t)}));const s=[];await e.viewIds.toCollection().modify((e=>{const n=e.viewIds.filter((e=>!i.has(e)));n.length!==e.viewIds&&(s.push(e.searchListId),e.viewIds=n),t.count++})),await e.filteringQueue.add({priority:P.Un.LOW,type:"RE_RUN_SLES",searchListIds:s,runMailingLists:!0,updateFilters:!0})}t.stop()})),Fi.set(148,(async e=>{const t=new Ui(148,"VB-78846: Rerun views for flags and labels"),n=[P.ut,""],i=[P.ut,"￿"],a=await e.filters.where("[accountId+path]").between(n,i).primaryKeys(),s=[P.MN,""],r=[P.MN,"￿"],o=await e.filters.where("[accountId+path]").between(s,r).primaryKeys();await e.filteringQueue.add({priority:P.Un.LOW,type:"RUN_FILTERS",filterIds:[...a,...o]}),t.stop()})),g.Z.version(149).stores({systemTasks:"++id",tokens:null}),Fi.set(149,(async e=>{const t=new Ui(149,"Clear tokens table and prepare for transition to new search db ...");await e.systemTasks.add({taskName:"restore_full_text_search_db",currentPosition:0}),t.stop()})),Fi.set(150,(async e=>{const t=new Ui(150,"VB-79158: [Mail] Unseen/Read status does not always match changes done with external server"),n=await e.accounts.toArray(),i=[];for(const e of n){const{accountId:t,folders:n}=e;for(const e in n)n[e].forEach((e=>{i.push([t,e.path])}))}const a=await e.filters.where("[accountId+path]").anyOf(i).toArray(),s=new Set;await e.searchList.toCollection().modify((e=>{const t=[...e.sources].filter((([e,t])=>t.internal)),n=[...e.sources].filter((([e,t])=>!t.internal));t&&0!==t.length&&n&&0!==n.length&&n.forEach((([n,i])=>{const r=a.find((e=>e.id===n))?.accountId;r&&t.forEach((([t,n])=>{const o=a.find((e=>e.id===t))?.accountId;if(o&&o===r){const n=e.sources.get(t);n&&n.read!==i.read&&(n.read=i.read,s.add(e.id),n.read&&(e.unseen=!1))}}))}))})),await e.filteringQueue.add({priority:P.Un.LOW,type:"RE_RUN_SLES",searchListIds:[...s]}),t.stop()})),Fi.set(151,(async e=>{const t=new Ui(151,"Removing orphan source-filter IDs");t.total=await e.searchList.count();const n=await e.filters.toCollection().primaryKeys(),i=new Set(n);await e.searchList.toCollection().modify((e=>{e.sourceFilterIds=e.sourceFilterIds.filter((e=>i.has(e)));const n=new Map;for(const[t,a]of e.sources)i.has(t)&&n.set(t,a);e.sources=n,t.count++})),t.stop()})),Fi.set(152,(async e=>{const t=new Ui(152,"Resetting feed data for updating paths"),n=await Ti.Z.waitFor((()=>N.Z.prefs.get(T.kRssSettings)));if(0===n.length)return void t.stop();const i={},a=[];t.total=n.length;for(const s of n){const n=await e.filters.where("[accountId+path]").equals([P.u4,s.path]).first();if(i[s.path])try{const t={accountId:P.u4,filterValue:{exclude:i[s.path].filterValue.exclude.slice(),include:[[{accountId:P.u4},{path:s.url}]],showCustomFolderButton:!1,showFeedsButton:!1,showJunkButton:!1,showMailingListsButton:!1},name:s.title,path:s.url},n=await e.filters.add(t);a.push(n)}catch(e){console.error(e)}else if(n){i[s.path]=n;const t={...n.filterValue,include:[[{accountId:P.u4},{path:s.url}]]};await e.filters.update(n.id,{path:s.url,filterValue:t}),a.push(n.id)}else console.error("Filter not found for feed path",s.path);s.path=s.url,t.count++}N.Z.prefs.set({path:"vivaldi.rss.settings",value:n}),await y.Z.call({type:"RUN_FILTERS",priority:P.Un.LOW,filterIds:a}),t.stop()})),Fi.set(153,(async e=>{const t=new Ui(153,"Re-run sender is a mailing list filters"),n=await e.filters.where("[accountId+path]").between([P.wC,""],[P.wC,"￿"]).filter((e=>e.filterValue.include?.some((e=>e.some((e=>!!e.senderIsMailingList)))))).primaryKeys();await y.Z.call({type:"RUN_FILTERS",priority:P.Un.LOW,filterIds:n}),t.stop()})),Fi.set(154,(async e=>{const t=new Ui(154,"Fix unseen counters");t.total=await e.searchList.count();const n=[];await _.Z.initFilters(),await e.searchList.toCollection().modify((e=>{e.unseen&&Q.Z.call(e.sources)&&(e.unseen=!1,n.push(e.id)),t.count++})),await e.filteringQueue.add({priority:P.Un.LOW,type:"RE_RUN_SLES",searchListIds:n}),t.stop()})),Fi.set(158,(async e=>{const t=new Ui(158,"Update thread key");t.total=await e.searchList.count(),await e.searchList.toCollection().modify((e=>{0===e.threadKey[1]&&(e.threadKey[1]=e.id),t.count++})),t.stop()})),Fi.set(159,(async e=>{const t=new Ui(159,"Update old filter rules and delete contact filters"),n=await e.filters.where("[accountId+path]").between([P.wC,""],[P.wC,"￿"]).count()+await e.filters.where("[accountId+path]").between([P.Kz,""],[P.Kz,"￿"]).count(),i=[Ci,""],a=[Ci,"￿"],s=await e.filters.where("[accountId+path]").between(i,a).primaryKeys(),r=await e.filters.where("[accountId+path]").equals([P.Kz,P.ym]).primaryKeys();if(s.push(...r),s.length>0){const i=100,a=s.map((e=>e*i));await e.filters.where("id").anyOf(s).delete();const r=new Set,o=8;a.forEach((e=>{for(let t=0;t<o;t++)r.add(e+t)})),t.total=await e.viewIds.count()+n,await e.viewIds.toCollection().modify((e=>{const n=e.viewIds.filter((e=>!r.has(e)));n.length!==e.viewIds&&(e.viewIds=n),t.count++}))}else t.total=n;function o(e,t,n,i,a){e||(e="");let s=n;return i.includes("equal")&&["subject"].includes(t)&&(s=`"${s}"`),"anywhere"!==t&&(s=`${t}:${s}`),a&&e&&(s=`${e?" ":""}${a} `+s),e?e+s:s}const c=(e,t)=>{const n=[...e.filterValue[t]].filter(((n,i)=>{const a=[...n].filter(((n,i)=>{for(const a in n){let s="";const r="exclude"===t?"NOT":i?"AND":"OR";return"subject"!==a&&"to"!==a&&"from"!==a&&"cc"!==a||(s="subject"===a?n[a]:n[a].address,e.filterValue.query=o(e.filterValue.query,a,s,"equal",r),!1)}}));return e.filterValue[t][i]=a,0!==a.length}));0===n.length?delete e.filterValue[t]:e.filterValue[t]=n},l=e=>{e.filterValue.include&&c(e,"include"),e.filterValue.exclude&&c(e,"exclude")};await e.filters.where("[accountId+path]").between([P.wC,""],[P.wC,"￿"]).modify((e=>{l(e),t.count++})),await e.filters.where("[accountId+path]").between([P.Kz,""],[P.Kz,"￿"]).modify((e=>{e.path===P.ym?(e.filterValue.include=[],e.filterValue.exclude&&delete e.filterValue.exclude):l(e),t.count++})),t.stop()})),Fi.set(160,(async e=>{const t=new Ui(160,"Update viewIds of messages that have too many unseen counters"),n=[];await e.searchList.toArray().then((e=>{e.forEach((e=>{e.unseen||n.push(e.id)}))})),t.total=n.length,await e.viewIds.where("searchListId").anyOf(n).modify((e=>{e.viewIds=e.viewIds.filter((e=>!function(e){return e%100==1}(e))),t.count++})),t.stop()})),Fi.set(161,(async e=>{const t=new Ui(161,"Update Received folder to include send to self"),n={name:P.ik,accountId:P.of,path:P.ik,filterValue:{include:[[{folder:"Archive"}],[{folder:"Flagged"}],[{folder:P.Oi}],[{folder:P.e9}],[{folder:P.Hd}],[{folder:P.uT},{folder:"Not Sent Internal"}]],...$.Z.getSearchListButtons(P.HM)}};n&&(await e.filters.where("[accountId+path]").equals([n.accountId,n.path]).modify((e=>{e.filterValue.include=n.filterValue.include,e.filterValue.exclude=e.filterValue.exclude.filter((e=>!e.some((e=>e.folder===P.Nz))))})),await y.Z.call({priority:P.Un.LOW,type:"RUN_FILTERS",folderIds:[[P.of,P.ik]]})),t.stop()})),g.Z.version(162).stores({filteringQueue:"++id"}),Fi.set(163,(async e=>{const t=new Ui(163,"Adding support for Archive folders"),n="Archive",i="Archive",a=new Map;await e.accounts.toCollection().modify((({accountId:e,folders:t})=>{const s=t.Other;if(!s)return;const r=[];if(t.Other=s.filter((e=>{const{name:t,path:a}=e;return t!==i&&a!==i||(r.push({...e,type:n}),!1)})),r.length>0){const e=t.Archive;e?e.push(...r):t.Archive=r}const o=new Map;a.set(e,o);Object.keys(t).forEach((e=>{t[e].forEach((t=>{o.set(t.path,e)}))}))}));let s=!1;await e.filters.toCollection().modify((e=>{const{accountId:t,path:n,filterValue:i}=e;"All Messages"===t&&"Archive"===n&&(s=!0);const r=function(e,t){const n=a.get(e)?.get(t);return n||(e===P.of&&t===P.rp?P.Hd:t)}(t,n);if((["Sent","Drafts","Outbox"].includes(r)||["Single thread","Feeds"].includes(t))&&(i.showArchivedButton=!1),"Archive"===r){const e=[{accountId:t},{folder:"Archive"}];i.include?i.include.push(e):i.include=[e],i.showCustomFolderButton=!1,i.showJunkButton=!1,i.showArchivedButton=!1}})),s||(await e.filters.add({name:"Archive",accountId:"All Messages",path:"Archive",filterValue:{include:[[{folder:"Archive"}]],exclude:[[{flag:"\\Deleted"}],[{folder:"Trash"}]],showCustomFolderButton:!1,showJunkButton:!1,showArchivedButton:!1}}),await e.filteringQueue.add({priority:15,type:"RE_RUN_SLES",folderIds:[["All Messages","Archive"]],runMailingLists:!0})),t.stop()})),Fi.set(164,(async e=>{const t=new Ui(164,"Update names for filters");e.filters.toCollection().modify((e=>{e.name===P.ym&&(e.name=e.accountId)})),t.stop()})),Fi.set(165,(async e=>{const t=new Ui(165,"Fix Archive status in filters"),n=new Map;function i(e,t){return e.some((e=>1===e.length&&e[0]?.folder===t))}await e.accounts.each((({accountId:e,folders:t})=>{const i=new Map;n.set(e,i);Object.keys(t).forEach((e=>{t[e].forEach((t=>{i.set(t.path,e)}))}))})),await e.filters.toCollection().modify((e=>{const{accountId:t,path:a,filterValue:s}=e,r=function(e,t){const i=n.get(e)?.get(t);return i||(e===P.of&&t===P.rp?P.Hd:t)}(t,a);if("Archive"===r){delete s.showJunkButton;const e=[{folder:"Junk"}];s.exclude?i(s.exclude,"Junk")||s.exclude.push(e):s.exclude=[e]}else if(!1!==s.showArchivedButton){const e=[{folder:"Archive"}];s.exclude?i(s.exclude,"Archive")||s.exclude.push(e):s.exclude=[e]}})),t.stop()})),Fi.set(166,(async e=>{const t=new Ui(166,"Apply default showSubFolders and clear related include rules"),n=new Set(["Custom Folders","Mailing Lists","Filters","Labels","Flags","Feeds"]),i=new Set(["Other Mailing Lists","Important Mailing Lists"]),a=await e.accounts.toCollection().primaryKeys(),s=new Map,r=new Set;await e.filters.toCollection().modify((e=>{const{id:t,accountId:o,path:c,filterValue:l}=e;"VIVALDI_RESERVED_DUMMY_ROOT_PLACEHOLDER_PATH"===c&&(n.has(o)||a.includes(o))?(l.include=[],l.showSubFolders=!0,r.add(t)):"Mailing Lists"===o&&(i.has(c)?(l.include=[],l.showSubFolders=!0,r.add(t)):s.set(c,e))}));for(const e of[...s.values()]){const{include:t}=e.filterValue;if(!t||0===t.length)continue;const n=new Set;for(const e of t)for(const t of e)t.listId&&n.add(t.listId);if(0===n.size)continue;let i=e.path.substring(0,e.path.lastIndexOf("/")),a=s.get(i);for(;a;){const{id:e,filterValue:t}=a;if(t.include?.length>0){const i=t.include.length;t.include=t.include.filter((e=>!e.some((e=>n.has(e.listId))))),t.include.length<i&&r.add(e)}t.showSubFolders=!0,i=i.substring(0,i.lastIndexOf("/")),a=s.get(i)}}s.size>0&&await e.filters.bulkPut([...s.values()]),r.size>0&&await e.filteringQueue.add({priority:P.Un.LOW,type:"RUN_FILTERS",filterIds:[...r]}),t.stop()})),Fi.set(167,(async e=>{const t=new Ui(167,"Fix filter include rules"),n=[],i=new Set(["Flags","Custom Folders","All Accounts"]),a=await e.accounts.toCollection().primaryKeys(),s=new Set(a);await e.filters.toCollection().modify((e=>{const{id:t,accountId:a,path:r,filterValue:o}=e;"VIVALDI_RESERVED_DUMMY_ROOT_PLACEHOLDER_PATH"===r&&(i.has(a)&&(!o.include||o.include.length>0)&&(o.include=[],n.push(t)),!o.include&&s.has(a)&&(o.include=[],n.push(t)))})),n.length>0&&await e.filteringQueue.add({priority:15,type:"RUN_FILTERS",filterIds:n}),t.stop()})),Fi.set(170,(async e=>e.buffer.where("operation").equals("BUFFER_OPERATION_REMOVE_ACCOUNT_PATH").filter((e=>void 0===e.path)).delete())),Fi.set(171,(async e=>{await e.filteringQueue.toCollection().modify((e=>{if(e.folderIds){Array.isArray(e.folderIds[0])||(e.folderIds=[e.folderIds]);for(const t of e.folderIds)t[1]=t[1]||"VIVALDI_RESERVED_DUMMY_ROOT_PLACEHOLDER_PATH"}}))})),Fi.set(173,(async e=>{const t=new Ui(173,"Fix casing of inbox and remove duplicates if found"),n=await e.accounts.toArray();for(const t of n){if(t.accountId===P.of){await e.accounts.delete(P.of);continue}const n=t.folders.Inbox||[];for(const i of n)"inbox"===i.path.toLowerCase()&&"Inbox"!==i.path&&(i.path="Inbox",await e.accounts.update(t.accountId,t))}function i(e){let t=!1;"inbox"===e.path.toLowerCase()&&"Inbox"!==e.path&&(e.path="Inbox",t=!0);for(const n of["include","exclude"])if(e.filterValue[n])for(const i of e.filterValue[n])for(const e of i)e.path&&"inbox"===e.path.toLowerCase()&&"Inbox"!==e.path&&(e.path="Inbox",t=!0);return t}const a=await e.filters.toArray(),s=a.filter((e=>"inbox"===e.path.toLowerCase())),r={};for(const e of s)r[e.accountId]?r[e.accountId].push(e):r[e.accountId]=[e];for(const n in r){const a=(await e.imap.where("accountId").equals(n).toArray()).filter((e=>"inbox"===e.path.toLowerCase())),s=new Map;t.total=a.length,t.count=0;for(const n of a){t.count++;const{accountId:i,path:a,uid:r}=n,o=s.get(r);o?0===o.hasRaw&&1===n.hasRaw&&(o.hasRaw=1):s.set(r,{...n,path:"Inbox"}),"Inbox"!==a&&await e.imap.delete([i,a,r])}await e.imap.bulkPut(Array.from(s.values()));const o=(await e.mailboxCache.where("accountId").equals(n).toArray()).filter((e=>"inbox"===e.path.toLowerCase())),c=new Map;t.total=o.length,t.count=0;for(const n of o){t.count++;const{accountId:i,path:a}=n,s=c.get(a);s?(Number(n.highestModseq)>Number(s.highestModseq)&&(s.highestModseq=n.highestModseq),n.uidNext>s.uidNext&&(s.uidNext=n.uidNext),n.exists>s.exists&&(s.exists=n.exists)):c.set(a,{...n,path:"Inbox"}),await e.mailboxCache.delete([i,a])}await e.mailboxCache.bulkPut(Array.from(c.values()));const l=await e.buffer.where("accountId").equals(n).toArray();t.total=l.length,t.count=0;for(const n of l){t.count++;const{_id:i,path:a="",destinationPath:s=""}=n;"inbox"===a.toLowerCase()&&"Inbox"!==a&&await e.buffer.update(i,{path:"Inbox"}),s&&"inbox"===s.toLowerCase()&&"Inbox"!==s&&await e.buffer.update(i,{destinationPath:"Inbox"})}const d=await e.filteringQueue.toArray();t.total=d.length,t.count=0;for(const n of d){t.count++;let i=!1;const{id:a,folderIds:s,fromFolderId:r,toFolderId:o}=n;if(s)for(const e of s)"inbox"===e[1].toLowerCase()&&"Inbox"!==e[1]&&(e[1]="Inbox",i=!0);r&&"inbox"===r[1].toLowerCase()&&"Inbox"!==r[1]&&(r[1]="Inbox",i=!0),o&&"inbox"===o[1].toLowerCase()&&"Inbox"!==o[1]&&(o[1]="Inbox",i=!0),i&&await e.filteringQueue.update(a,n)}const u=r[n];if(1===u.length){const t=u[0];i(t)&&await e.filters.update(t.id,t)}else if(u.length>1){let n=u.find((e=>"Inbox"===e.path));n||(n=u[0],i(n)&&await e.filters.update(n.id,n));const a=u.filter((e=>e.id!==n.id)),s=a.map((e=>e.id)),r=a.map((e=>100*e.id));await e.filters.where("id").anyOf(s).delete();const o=new Set,c=9;t.total=r.length,t.count=0,r.forEach((e=>{for(let t=0;t<c;t++)o.add(e+t)})),await e.viewIds.toCollection().modify((e=>{const n=e.viewIds.filter((e=>!o.has(e)));n.length!==e.viewIds&&(e.viewIds=n),t.count++}))}}const o=a.filter((e=>"inbox"!==e.path.toLowerCase()));t.total=o.length,t.count=0;for(const n of o)t.count++,i(n)&&await e.filters.update(n.id,n);t.stop()})),Fi.set(174,(async e=>{const t=new Ui(174,"Delete empty label if there is one"),n=await e.filters.where("[accountId+path]").equals([P.ut,""]).primaryKeys(),i=[0,1,2,3,4,5,6,7,8];if(n.length>0)for(const a of n){t.total=await e.viewIds.count();const n=100,s=new Set(i.map((e=>a*n+e)));await e.viewIds.toCollection().modify((e=>{const n=e.viewIds.filter((e=>!s.has(e)));n.length!==e.viewIds&&(e.viewIds=n),t.count++})),e.filters.delete(a)}t.stop()})),Fi.set(175,(async e=>{const t=new Ui(175,"Re-run filtering"),n=new Map;await e.searchList.each((({id:e,sourceFilterIds:i})=>{for(const t of i){const i=n.get(t);i?i.push(e):n.set(t,[e])}t.count++}));for(const[t,i]of n)await e.filteringQueue.add({type:"FILTERS_SLES",priority:20,searchListIds:i,filterIds:[t],runAllMessages:!0,runMailingLists:!0,runCustomFolders:!0,runFlagFolders:!0,runLabels:!0,runQueries:!0,runSingleThread:!0})})),Fi.set(176,(async e=>{const t=new Ui(176,"Fix grouped mailing lists"),n=await e.mailingList.toArray(),i=await e.filters.where("[accountId+path]").between(["Mailing Lists",""],["Mailing Lists","￿"]).filter((e=>{const{path:t}=e,i=t.indexOf("/");if(i<0)return!1;const a=t.substring(i+1);return!a.includes("/")&&n.some((({listId:e,parentFolderType:t})=>{switch(t){case"endsWith":return a.endsWith(e);case"startsWith":return a.startsWith(e);case"matches":return a===e}}))})).primaryKeys();if(0===i.length)return;await e.filters.bulkDelete(i);const a=new Set;for(const e of i)for(let t=0;t<9;t++)a.add(100*e+t);t.total=await e.viewIds.count(),await e.viewIds.toCollection().modify((e=>{const n=e.viewIds.filter((e=>!a.has(e)));n.length<e.viewIds.length&&(e.viewIds=n),t.count++})),await e.filteringQueue.add({priority:20,type:"RE_RUN_SLES",runMailingLists:!0}),t.stop()})),Fi.set(177,(async e=>{const t=new Ui(177,"Add default labels"),n=structuredClone(Li.j).filter((e=>e.accountId===P.ut)),i=await e.filters.where("[accountId+path]").between([P.ut,""],[P.ut,"￿"]).toArray(),a=n.filter((e=>!i.some((t=>t.path===e.path))));a.length>0&&await e.filters.bulkAdd(a),t.stop()})),Fi.set(178,(async e=>{const t=new Ui(178,"Delete empty label actions");await e.filters.where("[accountId+path]").between([P.Kz,""],[P.ut,"￿"]).modify((e=>{e.triggers&&(e.triggers=e.triggers.filter((e=>void 0===e.label||""!==e.label)))})),t.stop()})),Fi.set(179,(async e=>{const t=new Ui(179,"Fixing saved searches"),n=["Filters",""],i=["Filters","￿"],a=await e.accounts.toCollection().primaryKeys();if(a.length>0){const t="VIVALDI_RESERVED_DUMMY_ROOT_PLACEHOLDER_PATH",s=a.map((e=>[e,t])),r=(e,t)=>{const{filterValue:n}=e;if(n.showSubFolders){delete n.showSubFolders;const e=n.include||[];n.include=[...e,[{accountId:t}]]}};await e.filters.where("[accountId+path]").anyOf(s).modify((e=>r(e,e.accountId))),await e.filters.where("[accountId+path]").between(n,i).filter((e=>{const{selectedAccountId:t,selectedName:n}=e;return t===n&&a.includes(t)})).modify((e=>{const{selectedAccountId:t,accountId:n,path:i}=e;r(e,t),s.push([n,i])})),await e.filteringQueue.add({type:"RUN_FILTERS",priority:15,folderIds:s})}const s=await e.filters.toArray(),r=await e.filters.where("[accountId+path]").between(n,i).filter((({filterValue:e,selectedAccountId:t,selectedName:n})=>{if(e.showSubFolders)return!0;if(t&&n){if(!s.some((e=>e.accountId===t&&e.name===n)))return!0}return!1})).primaryKeys();if(r.length>0){await e.filters.bulkDelete(r);const n=new Set;for(const e of r)for(let t=0;t<9;t++)n.add(100*e+t);t.total=await e.viewIds.count(),await e.viewIds.toCollection().modify((e=>{const i=e.viewIds.filter((e=>!n.has(e)));i.length<e.viewIds.length&&(e.viewIds=i),t.count++}))}t.stop()})),Fi.set(180,(async e=>{const t=new Ui(180,"Decode imap folder filter names"),n=await e.accounts.toCollection().primaryKeys();await e.filters.toCollection().modify((e=>{n.includes(e.accountId)&&(e.name=(0,mn.kF)(e.name))})),t.stop()})),Fi.set(181,(async e=>{const t=new Ui(181,"Adding labels made from webmail");const n=[P.ut,""],i=[P.ut,"￿"],a=(await e.filters.where("[accountId+path]").between(n,i).toArray()).map((e=>e.path)),s=new Set,r=new Set,o=await e.searchList.toArray();if(t.total=o.length,o.forEach((e=>{e.flags.forEach((t=>{!a.includes(t)&&function(e){const t=e.toLowerCase();return t.startsWith("$label")||"$"!==t[0]&&"\\"!==t[0]&&!["mdnsent","forwarded","submitpending","submitted","junk","notjunk","nonjunk","phishing","important","draft","seen","flagged","answered","recent"].includes(t)}(t)&&(s.add(t),r.add(e))})),t.count++})),[...s].length>0){const t=[...s].map((e=>{const t=[{flag:e}];return{name:e,accountId:P.ut,path:e,filterValue:{include:[t],...$.Z.getSearchListButtons(P.ut)}}})),n=await e.filters.bulkAdd(t,{allKeys:!0});y.Z.call({type:"RE_RUN_SLES",priority:P.Un.LOW,folderIds:[[P.ut,P.ym]],filterIds:n,searchListIds:[...r].map((e=>e.id))})}t.stop()})),Fi.set(182,(async e=>{const t=new Ui(182,"Refactor filter view toggles");t.total=await e.filters.count(),await e.filters.toCollection().modify((e=>{const{accountId:n,path:i,filterValue:a}=e;a.exclude&&(a.exclude=a.exclude.filter((t=>{for(const a of t)return a.flag===P.T4.SEEN?(e.filterValue.showRead=!1,n===P.of&&i===P.tB):a.flag===P.T4.DELETED||a.folder===P.uT?(e.filterValue.showDeleted=!1,!1):a.folder===P.Hd?(e.filterValue.showJunk=!1,!1):a.folder===P.Oi?(e.filterValue.showCustomFolder=!1,!1):a.folder!==P.hn||(e.filterValue.showArchived=!1,!1)})),0===a.exclude.length&&delete a.exclude),a.include&&(a.include=a.include.filter((t=>{let i=!1,a=!1,s=!1;return 2!==t.length||(t.forEach((e=>{i=e.accountId===n||i,a=e.folder===P.Hd||a,s=e.folder===P.hn||s})),i&&a?(e.filterValue.showJunk=!0,!1):!i||!s||(e.filterValue.showArchived=!0,!1))}))),t.count++})),t.stop()})),g.Z.version(183).stores({importStatus:null,importProgress:"path"}),Fi.set(184,(async e=>{const t=new Ui(184,"Make feed-sources internal"),n=[P.u4,""],i=[P.u4,"￿"],a=await e.filters.where("[accountId+path]").between(n,i).primaryKeys();t.total=await e.searchList.where("sourceFilterIds").anyOf(a).count(),await e.searchList.where("sourceFilterIds").anyOf(a).modify((e=>{t.count++;for(const[t,n]of e.sources)a.includes(t)&&!n.internal&&(n.internal=!0)})),t.stop()})),Fi.set(185,(async e=>{const t=new Ui(185,"Removing custom folder filters"),n=await e.filters.toCollection().filter((({accountId:e,path:t})=>"Custom Folders"===e&&"VIVALDI_RESERVED_DUMMY_ROOT_PLACEHOLDER_PATH"!==t)).primaryKeys();if(n.length>0){await e.filters.bulkDelete(n);const i=new Set;for(const e of n)for(let t=0;t<9;t++)i.add(100*e+t);t.total=await e.viewIds.count(),await e.viewIds.toCollection().modify((e=>{const n=e.viewIds.filter((e=>!i.has(e)));n.length<e.viewIds.length&&(e.viewIds=n),t.count++}))}t.stop()})),g.Z.version(186).stores({hasRaw:"[searchListId+accountId],[hasRaw+accountId+searchListId],accountId,searchListId"}),Fi.set(186,(async e=>{const t=new Ui(186,"Processing raw data"),n=await e.searchList.count(),i=await e.imap.count(),a=await e.pop.count();t.total=n+i+a;const s=new Map;await e.imap.toCollection().modify((e=>{const{searchListId:n,accountId:i,hasRaw:a}=e;let r=s.get(n);r||(r=new Map,s.set(n,r)),r.set(i,1===a),delete e.hasRaw,t.count++})),await e.pop.toCollection().modify((e=>{const{searchListId:n,accountId:i,headersOnly:a}=e;let r=s.get(n);r||(r=new Map,s.set(n,r)),r.set(i,!a),delete e.headersOnly,t.count++}));const r=await e.filters.toArray(),o=new Map(r.map((e=>[e.id,e]))),c=[],l=[];for(await e.searchList.each((e=>{const n=new Set;let i=!0;for(const[t,a]of e.sources){const e=o.get(t);e?(n.add(e.accountId),a.internal||(i=!1)):k.Z.error("Mail",["Upgrade","186"],"Filter not found "+t)}for(const a of n){const n=s.get(e.id)?.get(a);let r;if(void 0!==n)r=n?1:0;else if(i)r=1;else{const{id:t,sentDate:n}=e;l.push({accountId:a,searchListId:t,sentDate:n}),r=1}c.push({searchListId:e.id,accountId:a,hasRaw:r}),t.total++}t.count++}));c.length>0;){const n=c.splice(0,1e4);await e.hasRaw.bulkAdd(n),t.count+=n.length}l.length>0&&await e.systemTasks.add({taskName:"check_disk_for_raw",fileKeys:l}),t.stop()})),g.Z.version(187).stores({hasRaw:"[searchListId+accountId],accountId,searchListId,[hasRaw+accountId]"}),g.Z.version(188).stores({hasRaw:"[searchListId+accountId],accountId,searchListId,[hasRaw+accountId+searchListId]"}),Fi.set(189,(async e=>{const t=new Ui(189,"Upgrade pending upload entries in buffer");t.total=await e.buffer.count();const n=await e.buffer.toArray();for(const i of n)"BUFFER_OPERATION_UPLOAD_MESSAGE"!==i.operation||i.flags?"BUFFER_OPERATION_MOVE"===i.operation&&i.destinationAccountId&&(await e.buffer.delete(i._id),k.Z.warn("Mail",["Upgrade","189"],"An old, broken buffer action for moving between accounts was removed")):(await e.buffer.update(i._id,{flags:[]}),k.Z.info("Mail",["Upgrade","189"],"An old buffer action for uploading was modified to include an empty flags array")),t.count++;t.stop()})),Fi.set(191,(async e=>{const t=new Ui(191,"Converting draft attachments");t.total=await e.messages.count();const n=new TextEncoder;await e.messages.toCollection().modify((e=>{e.bodyParts?.forEach((e=>{if("attachment"===e.type&&"string"==typeof e.content){const t=(0,Zi.tV)(e.content);if(e.content=n.encode(t),"application/ics"===e.mimeType){const n=t.match(/METHOD:\s*(\w+)/);n&&(e.method=n[1])}}})),t.count++})),t.stop()})),Fi.set(192,(async e=>{const t=new Ui(192,"Remove buffer entries for moving that have an empty uid list");t.total=await e.buffer.count();const n=await e.buffer.toArray();for(const i of n)"BUFFER_OPERATION_MOVE"!==i.operation||i.uids&&0!==i.uids.length||(await e.buffer.delete(i._id),k.Z.info("Mail",["Upgrade","192"],"Removed an unwanted buffer entry for moving an internal message")),t.count++;t.stop()})),Fi.set(193,(async e=>{const t=new Ui(193,"Preparing to re-run threading..."),n=await e.threading.toCollection().primaryKeys();await e.threadingQueue.add({threadingIds:n}),t.stop()})),Fi.set(194,(async e=>{const t=new Ui(194,"Moving size from imap table to searchList table...");t.total=await e.imap.count(),await e.imap.toCollection().modify((async n=>{const{searchListId:i,size:a}=n;await e.searchList.update(i,{size:a}),delete n.size,t.count++})),t.stop()})),Fi.set(195,(async e=>{const t=new Ui(195,"Clearing capabilities from accounts table");t.total=await e.accounts.count(),await e.accounts.toCollection().modify((async e=>{delete e.capability,t.count++})),t.stop()})),Fi.set(196,(async e=>{const t=new Ui(196,"Clearing unused gmailId from messages table");t.total=await e.messages.count(),await e.messages.toCollection().modify((e=>{delete e.gmailId,t.count++})),t.stop()})),Fi.set(197,(async e=>{const t=new Ui(197,"Clearing lastNotificaton from accounts table");t.total=await e.accounts.count(),await e.accounts.toCollection().modify((e=>{delete e.lastNotification,t.count++})),t.stop()})),Fi.set(198,(async e=>{const t=await e.filters.get({"[accountId+path]":[P.of,P.rp]});let n=!1;if(t){const i=t.filterValue;i.include&&2===i.include.length&&i.include.find((e=>e.find((e=>e.flag&&e.flag===P.T4.JUNK))&&e.find((e=>e.folder&&e.folder===P.Hd))))||(i.include=[[{folder:P.Hd}],[{flag:P.T4.JUNK}]],await e.filters.update(t.id,{filterValue:i}),n=!0)}else{const t={name:P.rp,accountId:P.of,path:P.rp,filterValue:{include:[[{folder:P.Hd}],[{flag:P.T4.JUNK}]],...$.Z.getSearchListButtons(P.Hd)}};await e.filters.add(t),n=!0}n&&e.filteringQueue.add({type:"RUN_FILTERS",priority:P.Un.LOW,folderIds:[[P.of,P.rp]]})})),Fi.set(201,(async e=>{const t=new Ui(201,"Update Received folder so Feeds filter button works");await e.filters.where("[accountId+path]").equals([P.of,P.ik]).modify((e=>{e.filterValue.include=[...e.filterValue.include,[{accountId:P.u4}]],e.filterValue={...e.filterValue,showFeeds:!1}})),await y.Z.call({priority:P.Un.LOW,type:"RUN_FILTERS",folderIds:[[P.of,P.ik]]}),t.stop()})),Fi.set(202,(async e=>{const t=new Ui(202,"Setting new listPost attribute to empty string");t.total=await e.messages.count(),await e.messages.toCollection().modify((e=>{e.listPost="",t.count++})),t.stop()})),Fi.set(203,(async e=>{const t=new Ui(203,"Make sure All Messages Unread has the exclude seen rule"),n=["All Messages","Unread"];let i=!0;await e.filters.where("[accountId+path]").equals(n).modify((e=>{e.filterValue.exclude||(e.filterValue.exclude=[]),i=e.filterValue.exclude.some((e=>1===e.length&&e[0]?.flag===P.T4.SEEN)),i||e.filterValue.exclude.push([{flag:P.T4.SEEN}])})),i||await e.filteringQueue.add({priority:P.Un.LOW,type:"RUN_FILTERS",folderIds:[n]}),t.stop()})),Fi.forEach(((e,t)=>g.Z.version(t).upgrade((async n=>{try{await e(n),await n._upgrades.add({version:t})}catch(e){throw k.Z.error("Mail",["Upgrade",""+t],e),e}})))),g.Z.on("ready",(async()=>{const e=await g.Z._upgrades.toCollection().last();let t=[...Fi.keys()];e&&(t=t.filter((t=>t>e.version))),t.sort(((e,t)=>e-t));for(const e of t){const t=Fi.get(e);t&&await g.Z.transaction("rw",g.Z.tables,(n=>t(n).then((()=>n._upgrades.add({version:e})))))}}));const Di=g.Z;var zi=n(87192),Bi=n(24600);function $i(e){if(0===e.length)throw new Error("raceToResolve: Need an array with at least one Promise.");let t;return new Promise(((n,i)=>Promise.all(e.map((e=>e.then(n).catch((e=>t=e))))).then((()=>i(t)))))}var ji=n(16932);const{OK:Vi,ERROR:qi,OFFLINE:Qi}=P.In;async function Hi(e){try{let t;if(e.useOAuth){const n=await Un(e);t=kn(e,n)}else t=kn(e);await new Promise(((e,n)=>{t.onError=n,t.login().then((()=>t.logout())).then(e).catch(n)}))}catch(t){throw new Error((0,d.Z)("Login for $1 failed. $2",[e.MAIL_SERVER,t.message]))}}async function Ki(e){try{await ct.verifyLogin(e)}catch(t){throw new Error((0,d.Z)("Login for $1 failed.",[e.MAIL_SERVER]))}}async function Wi(e){try{let t;if(e.useOAuth){const n=await Un(e);t=(0,Bi.Z)(e,n)}else t=(0,Bi.Z)(e);await new Promise(((e,n)=>{t.onidle=t.quit,t.onerror=n,t.onclose=e,t.connect()}))}catch(t){throw e.useOAuth&&await Sn(e.MAIL_EMAIL,(0,Cn.dn)(e)),new Error((0,d.Z)("Login for $1 failed.",[e.MAIL_SMTP_SERVER]))}}const Gi=(e,t=!1)=>{const[n,i,a,s]=t?[e.MAIL_SMTP_PORT,e.MAIL_SMTP_SERVER,e.MAIL_SMTP_USER,e.MAIL_SMTP_PASSWORD]:[e.MAIL_PORT,e.MAIL_SERVER,e.MAIL_USER,e.MAIL_PASSWORD];if(!n||"number"!=typeof n)throw new Error(t?(0,d.Z)("Outgoing port is missing or not a number"):(0,d.Z)("Incoming port is missing or not a number"));if(!i)throw new Error(t?(0,d.Z)("Outgoing server information is missing"):(0,d.Z)("Incoming server information is missing"));if(!e.useOAuth){if(!a)throw new Error(t?(0,d.Z)("Outgoing username is missing"):(0,d.Z)("Incoming username is missing"));if(!s)throw new Error(t?(0,d.Z)("Outgoing password is missing"):(0,d.Z)("Incoming password is missing"))}},Yi=(e,t,n,i,a)=>new Promise(((a,s)=>{const r=D.default.open(e,t,{useSecureTransport:"ssl"===n});r.onerror=s,r.onopen=()=>{r.close(),a("MAIL_SMTP_SERVER"===i?{MAIL_SMTP_SERVER:e,MAIL_SMTP_PORT:t,MAIL_SMTP_SOCKET_TYPE:n}:{MAIL_SERVER:e,MAIL_PORT:t})}})),Xi=(e,t)=>{const n={...e,MAIL_SMTP_USER:t};return Wi(n).then((()=>[Vi,"Outgoing connection success",n])).catch((t=>{throw[qi,t.message,e]}))},Ji=async(e,t,n)=>{const i=await ta(t);return i?ea(e,i,n):Promise.reject(`No MX record found for ${t}`)},ea=(e,t,n)=>{const i=[`https://autoconfig.${t}/mail/config-v1.1.xml?emailaddress=${e.MAIL_EMAIL}`,`https://autoconfig.vivaldi.net/v1.1/${t}`,`https://${t}/.well-known/autoconfig/mail/config-v1.1.xml?emailaddress=${e.MAIL_EMAIL}`],a="pop"===n?"pop3":n;return $i(i.map((t=>na(e,a,t))))},ta=async e=>{const t=await fetch(`https://autoconfig.vivaldi.net/mxlookup?domain=${e}`);if(t.ok){const e=await t.json();if(e&&e[0]?.target){return sa(e[0]?.target)}}},na=async(e,t,n)=>{const i=await fetch(n);if(!i.ok)throw new Error("autodiscover: Error looking up in autoconfig");try{const n=await i.text(),a=new ji.XMLParser({ignoreAttributes:!1}).parse(n),{emailProvider:s}=a.clientConfig,{outgoingServer:r,incomingServer:o}=s,c=Array.isArray(o)?o:[o],l=Array.isArray(r)?r:[r];let d,u,h,f,p;for(const e of c)if(e["@_type"]===t&&"ssl"===e.socketType.toLowerCase()){d=e.hostname,u=e.port;break}for(const e of l)if("smtp"===e["@_type"]&&"plain"!==e.socketType.toLowerCase()){h=e.hostname,f=e.port,p=e.socketType.toLowerCase();break}if(!(d&&u&&h&&f&&p))throw new Error("autodiscover: Missing Outgoing or Incoming Server/Port information");const g={...e,MAIL_SERVER:d,MAIL_PORT:Number(u),MAIL_SMTP_SERVER:h,MAIL_SMTP_PORT:Number(f),MAIL_SMTP_SOCKET_TYPE:"ssl"===p?"ssl":"starttls"};return[Vi,g]}catch(e){throw new Error(`autodiscover: ${e}`)}},ia=async(e,t,n,i)=>{const a=await ta(t);return a?aa(e,a,n,i):[qi,e]},aa=(e,t,n,i)=>{const a=[`${n}.${t}`,`mail.${t}`,`${n}.mail.${t}`],s=[`smtp.${t}`,`mail.${t}`,`smtp.mail.${t}`];let r,o;return Promise.race([new Promise((e=>setTimeout(e,1e4))),Promise.allSettled([$i([...a.map((e=>Yi(e,i,"ssl","MAIL_SERVER")))]).then((e=>{r=e})),new Promise((e=>Promise.allSettled([$i([...s.map((e=>Yi(e,465,"ssl","MAIL_SMTP_SERVER")))]).then((t=>{o=t,e()})),$i([...s.map((e=>Yi(e,587,"starttls","MAIL_SMTP_SERVER")))]).then((e=>{o||(o=e)}))]).then(e)))])]).then((()=>{const t={...e,...r,...o};return[["MAIL_SERVER","MAIL_PORT","MAIL_SMTP_SERVER","MAIL_SMTP_PORT","MAIL_SMTP_SOCKET_TYPE"].every((e=>t[e]))?Vi:qi,t]}))},sa=e=>{let t=e;if(null!=e){var n=e.split(".").reverse();null!=n&&n.length>1&&(t=n[1]+"."+n[0],-1!==e.toLowerCase().indexOf(".co.uk")&&n.length>2&&(t=n[2]+"."+t))}return t.toLowerCase()};var ra=n(6977);const oa={call:async function(e){if(0===e.length)return;const t=[],n=new Map;e.forEach((e=>{const{id:i,updates:a}=e,{sources:s=new Map}=a;s.forEach((async(e,n)=>{if(!e||0===Object.keys(e).length)return;const a=_.Z.get(n);if(!a)throw new Error(`Source filter ${n} not found in cache`);const{accountId:s,path:r}=a;t.push([s,r,i])})),n.set(i,e)})),0!==t.length&&await g.Z.transaction("rw",[g.Z.buffer,g.Z.imap],(async()=>{const e=[];(await g.Z.imap.where("[accountId+path+searchListId]").anyOf(t).toArray()).forEach((t=>{const{accountId:i,path:a,uid:s,searchListId:r}=t,o=n.get(r),c=_.Z.getByFolderId([i,a]),{sources:l}=o.updates;if(l){const t=l.get(c.id),n={},{deleted:r,read:o}=t;void 0!==r&&(n[P.T4.DELETED]=r),void 0!==o&&(n[P.T4.SEEN]=o),e.push({accountId:i,path:a,uid:s,flagUpdates:n})}})),e.length>0&&await ra.Z.addCustomFlags(e)}))}};var ca=n(47482);let la=!1;const da=v.Z.adjustBatchSize.bind(void 0,100,1e3,500);let ua=100;async function ha(e){const t=await g.Z.flaggingQueue.toCollection().first();if(!t)return;let{id:n,searchListIds:i,sourcesPerSle:a,flagUpdates:s}=t;for(a instanceof Map||(console.warn("flagging.js: Invalid entry in flaggingQueue table"),a=new Map);i.length>0;){const e=i.splice(0,ua),t=Date.now(),r=e.map((e=>({searchListId:e,sources:a.get(e)||new Map})));await g.Z.transaction("rw",[g.Z.searchList,g.Z.filteringQueue,g.Z.flaggingQueue,g.Z.buffer,g.Z.imap],(async()=>{const t=await ca.Z.call(r,s);U.QO.updateIndex({sleUpdates:t}),Object.keys(s).length>0&&await w.Z.call(e,s),a.size>0&&await oa.call(t),Wt.call();const o={id:n,searchListIds:i,sourcesPerSle:a,flagUpdates:s};await g.Z.flaggingQueue.put(o)}));const o=Date.now();ua=da(ua,o-t),me.filter()}await g.Z.flaggingQueue.delete(n),await ha(e)}Di.open();const fa={updateThreads:Le.updateThreads,start:async function(){await Promise.all([pn(),_.Z.initFilters(),b.Z.initFolders(),Ee(),ee.Z.initMailingLists()])},stop:function(){void 0!==un&&un("Clearing UID sequence sets."),fn(),hn={},_.Z.clear(),ee.Z.clear(),Ie(),ye={level:0,children:new Map},u.Z.clear()},addAccount:async function(e){const t=e.MAIL_EMAIL,{accountType:n,offline:i}=e,a=n===P.s9.POP,s=n===P.s9.IMAP;if(!a&&!s)throw new Error(`Trying to add account ${t} of unsupported type ${n}`);const l=a||i?c.Z.getDefaultFolders():{},d=await r.Z.add(t,l);await u.Z.addAccounts({[t]:d});const h=await o.Z.foldersToFilters(t,l);_.Z.updateFilters(h)},flushBuffer:Wt.call,updateFlags:async function(){if(!la){la=!0;try{await ha()}finally{la=!1}}},runSystemTasks:async function(){const e=await g.Z.systemTasks.toArray();for(const t of e)await Pt(t)},getOAuthAccessToken:On,fetchAccessTokenAndRefreshToken:Sn,verify:async function(e){await(async e=>(Gi(e,!0),Wi(e)))(e),await(async e=>{Gi(e,!1),e.accountType===P.s9.IMAP?await Hi(e):await Ki(e)})(e)},autofill:async function(e){if(!zi.Z.isValidEmail(e))return[qi,e];const t=e.MAIL_EMAIL,n=e.MAIL_EMAIL&&t.split("@")[1];let i="imap",a=993;return e.accountType===P.s9.POP&&(i="pop",a=995),$i([ea(e,n,i),Ji(e,n,i)]).catch((()=>{let t;return new Promise((s=>Promise.allSettled([aa(e,n,i,a).then((e=>{e[0]===Vi&&s(e),t||(t=e)})),ia(e,n,i,a).then((e=>{e[0]===Vi&&s(e),t||(t=e)}))]).then((()=>s(t)))))})).then((e=>e))},signIn:async function(e){if(e.offline)return[Qi,"offline",e];e.MAIL_PORT||(e.MAIL_PORT=e.accountType===P.s9.IMAP?993:995),e.MAIL_SMTP_PORT||(e.MAIL_SMTP_PORT=465);try{Gi(e,!1),Gi(e,!0)}catch(t){return[qi,t.message,e]}if(e.useOAuth)try{return await Xi(e,e.MAIL_EMAIL)}catch(e){return e}const t=[e.MAIL_USER],n=[e.MAIL_SMTP_USER];if(e.MAIL_EMAIL===e.MAIL_USER&&e.MAIL_EMAIL===e.MAIL_SMTP_USER&&e.MAIL_EMAIL.includes("@")){const i=e.MAIL_EMAIL.split("@")[0];t.push(i),n.push(i)}const i=await Promise.allSettled([$i(n.map((t=>Xi(e,t)))),$i(t.map((t=>(async(e,t)=>{const n={...e,MAIL_USER:t};try{return e.accountType===P.s9.IMAP?(await Hi(n),[Vi,"Incoming connection success",n]):(await Ki(e),[Vi,"Incoming connection success",n])}catch(t){throw[qi,t.message,e,[]]}})(e,t))))]);let a={...e},s=Vi,r="";for(const e of i)e.reason?(s=qi,r=e.reason[1],a={...a,...e.reason[2]}):e.value&&(a={...a,...e.value[2]});return[s,r,a]}};function pa(e){if(e.origin!==C.oP)return;const{background:t}=e.data;if(t){const{promiseId:n,func:i,args:a=[]}=t;Promise.resolve().then((()=>fa[i](...a))).then((t=>{e.source.postMessage({background:{promiseId:n,results:t}})})).catch((t=>{t=t.message||t,e.source.postMessage({background:{promiseId:n,error:t}})}))}}self.addEventListener("install",(e=>{self.skipWaiting()}));let ga=!1;!async function(){ga||(ga=!0,self.addEventListener("message",pa,!1),await Promise.all([i.Z.loadPromise(),a.Z.loadPromise(),s.Z.loadPromise()]))}()},44983:()=>{!function(e){var t={};function n(i){if(t[i])return t[i].exports;var a=t[i]={i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(i,a,function(t){return e[t]}.bind(null,a));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=11)}([function(e,t,n){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t,n){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t,n){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function a(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var i in n)a(n,i)&&(e[i]=n[i])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var s={arraySet:function(e,t,n,i,a){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+i),a);else for(var s=0;s<i;s++)e[a+s]=t[n+s]},flattenChunks:function(e){var t,n,i,a,s,r;for(i=0,t=0,n=e.length;t<n;t++)i+=e[t].length;for(r=new Uint8Array(i),a=0,t=0,n=e.length;t<n;t++)s=e[t],r.set(s,a),a+=s.length;return r}},r={arraySet:function(e,t,n,i,a){for(var s=0;s<i;s++)e[a+s]=t[n+s]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,s)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,r))},t.setTyped(i)},function(e,t,n){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t,n){"use strict";var i,a=n(2),s=n(8),r=n(6),o=n(7),c=n(1),l=-2,d=258,u=262,h=103,f=113,p=666;function g(e,t){return e.msg=c[t],t}function m(e){return(e<<1)-(e>4?9:0)}function w(e){for(var t=e.length;--t>=0;)e[t]=0}function _(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(a.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function b(e,t){s._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,_(e.strm)}function y(e,t){e.pending_buf[e.pending++]=t}function v(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function I(e,t){var n,i,a=e.max_chain_length,s=e.strstart,r=e.prev_length,o=e.nice_match,c=e.strstart>e.w_size-u?e.strstart-(e.w_size-u):0,l=e.window,h=e.w_mask,f=e.prev,p=e.strstart+d,g=l[s+r-1],m=l[s+r];e.prev_length>=e.good_match&&(a>>=2),o>e.lookahead&&(o=e.lookahead);do{if(l[(n=t)+r]===m&&l[n+r-1]===g&&l[n]===l[s]&&l[++n]===l[s+1]){s+=2,n++;do{}while(l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&s<p);if(i=d-(p-s),s=p-d,i>r){if(e.match_start=t,r=i,i>=o)break;g=l[s+r-1],m=l[s+r]}}}while((t=f[t&h])>c&&0!=--a);return r<=e.lookahead?r:e.lookahead}function k(e){var t,n,i,s,c,l,d,h,f,p,g=e.w_size;do{if(s=e.window_size-e.lookahead-e.strstart,e.strstart>=g+(g-u)){a.arraySet(e.window,e.window,g,g,0),e.match_start-=g,e.strstart-=g,e.block_start-=g,t=n=e.hash_size;do{i=e.head[--t],e.head[t]=i>=g?i-g:0}while(--n);t=n=g;do{i=e.prev[--t],e.prev[t]=i>=g?i-g:0}while(--n);s+=g}if(0===e.strm.avail_in)break;if(l=e.strm,d=e.window,h=e.strstart+e.lookahead,f=s,p=void 0,(p=l.avail_in)>f&&(p=f),n=0===p?0:(l.avail_in-=p,a.arraySet(d,l.input,l.next_in,p,h),1===l.state.wrap?l.adler=r(l.adler,d,p,h):2===l.state.wrap&&(l.adler=o(l.adler,d,p,h)),l.next_in+=p,l.total_in+=p,p),e.lookahead+=n,e.lookahead+e.insert>=3)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=(e.ins_h<<e.hash_shift^e.window[c+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[c+3-1])&e.hash_mask,e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<u&&0!==e.strm.avail_in)}function E(e,t){for(var n,i;;){if(e.lookahead<u){if(k(e),e.lookahead<u&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-u&&(e.match_length=I(e,n)),e.match_length>=3)if(i=s._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(b(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(b(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(b(e,!1),0===e.strm.avail_out)?1:2}function x(e,t){for(var n,i,a;;){if(e.lookahead<u){if(k(e),e.lookahead<u&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-u&&(e.match_length=I(e,n),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-3,i=s._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=a&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(b(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((i=s._tr_tally(e,0,e.window[e.strstart-1]))&&b(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=s._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(b(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(b(e,!1),0===e.strm.avail_out)?1:2}function A(e,t,n,i,a){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=a}function S(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new a.Buf16(1146),this.dyn_dtree=new a.Buf16(122),this.bl_tree=new a.Buf16(78),w(this.dyn_ltree),w(this.dyn_dtree),w(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new a.Buf16(16),this.heap=new a.Buf16(573),w(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new a.Buf16(573),w(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function M(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:f,e.adler=2===t.wrap?0:1,t.last_flush=0,s._tr_init(t),0):g(e,l)}function N(e){var t,n=M(e);return 0===n&&((t=e.state).window_size=2*t.w_size,w(t.head),t.max_lazy_match=i[t.level].max_lazy,t.good_match=i[t.level].good_length,t.nice_match=i[t.level].nice_length,t.max_chain_length=i[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),n}function O(e,t,n,i,s,r){if(!e)return l;var o=1;if(-1===t&&(t=6),i<0?(o=0,i=-i):i>15&&(o=2,i-=16),s<1||s>9||8!==n||i<8||i>15||t<0||t>9||r<0||r>4)return g(e,l);8===i&&(i=9);var c=new S;return e.state=c,c.strm=e,c.wrap=o,c.gzhead=null,c.w_bits=i,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=s+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+3-1)/3),c.window=new a.Buf8(2*c.w_size),c.head=new a.Buf16(c.hash_size),c.prev=new a.Buf16(c.w_size),c.lit_bufsize=1<<s+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new a.Buf8(c.pending_buf_size),c.d_buf=1*c.lit_bufsize,c.l_buf=3*c.lit_bufsize,c.level=t,c.strategy=r,c.method=n,N(e)}i=[new A(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(k(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+n;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,b(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-u&&(b(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(b(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(b(e,!1),e.strm.avail_out),1)})),new A(4,4,8,4,E),new A(4,5,16,8,E),new A(4,6,32,32,E),new A(4,4,16,16,x),new A(8,16,32,32,x),new A(8,16,128,128,x),new A(8,32,128,256,x),new A(32,128,258,1024,x),new A(32,258,258,4096,x)],t.deflateInit=function(e,t){return O(e,t,8,15,8,0)},t.deflateInit2=O,t.deflateReset=N,t.deflateResetKeep=M,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?l:(e.state.gzhead=t,0):l},t.deflate=function(e,t){var n,a,r,c;if(!e||!e.state||t>5||t<0)return e?g(e,l):l;if(a=e.state,!e.output||!e.input&&0!==e.avail_in||a.status===p&&4!==t)return g(e,0===e.avail_out?-5:l);if(a.strm=e,n=a.last_flush,a.last_flush=t,42===a.status)if(2===a.wrap)e.adler=0,y(a,31),y(a,139),y(a,8),a.gzhead?(y(a,(a.gzhead.text?1:0)+(a.gzhead.hcrc?2:0)+(a.gzhead.extra?4:0)+(a.gzhead.name?8:0)+(a.gzhead.comment?16:0)),y(a,255&a.gzhead.time),y(a,a.gzhead.time>>8&255),y(a,a.gzhead.time>>16&255),y(a,a.gzhead.time>>24&255),y(a,9===a.level?2:a.strategy>=2||a.level<2?4:0),y(a,255&a.gzhead.os),a.gzhead.extra&&a.gzhead.extra.length&&(y(a,255&a.gzhead.extra.length),y(a,a.gzhead.extra.length>>8&255)),a.gzhead.hcrc&&(e.adler=o(e.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=69):(y(a,0),y(a,0),y(a,0),y(a,0),y(a,0),y(a,9===a.level?2:a.strategy>=2||a.level<2?4:0),y(a,3),a.status=f);else{var u=8+(a.w_bits-8<<4)<<8;u|=(a.strategy>=2||a.level<2?0:a.level<6?1:6===a.level?2:3)<<6,0!==a.strstart&&(u|=32),u+=31-u%31,a.status=f,v(a,u),0!==a.strstart&&(v(a,e.adler>>>16),v(a,65535&e.adler)),e.adler=1}if(69===a.status)if(a.gzhead.extra){for(r=a.pending;a.gzindex<(65535&a.gzhead.extra.length)&&(a.pending!==a.pending_buf_size||(a.gzhead.hcrc&&a.pending>r&&(e.adler=o(e.adler,a.pending_buf,a.pending-r,r)),_(e),r=a.pending,a.pending!==a.pending_buf_size));)y(a,255&a.gzhead.extra[a.gzindex]),a.gzindex++;a.gzhead.hcrc&&a.pending>r&&(e.adler=o(e.adler,a.pending_buf,a.pending-r,r)),a.gzindex===a.gzhead.extra.length&&(a.gzindex=0,a.status=73)}else a.status=73;if(73===a.status)if(a.gzhead.name){r=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>r&&(e.adler=o(e.adler,a.pending_buf,a.pending-r,r)),_(e),r=a.pending,a.pending===a.pending_buf_size)){c=1;break}c=a.gzindex<a.gzhead.name.length?255&a.gzhead.name.charCodeAt(a.gzindex++):0,y(a,c)}while(0!==c);a.gzhead.hcrc&&a.pending>r&&(e.adler=o(e.adler,a.pending_buf,a.pending-r,r)),0===c&&(a.gzindex=0,a.status=91)}else a.status=91;if(91===a.status)if(a.gzhead.comment){r=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>r&&(e.adler=o(e.adler,a.pending_buf,a.pending-r,r)),_(e),r=a.pending,a.pending===a.pending_buf_size)){c=1;break}c=a.gzindex<a.gzhead.comment.length?255&a.gzhead.comment.charCodeAt(a.gzindex++):0,y(a,c)}while(0!==c);a.gzhead.hcrc&&a.pending>r&&(e.adler=o(e.adler,a.pending_buf,a.pending-r,r)),0===c&&(a.status=h)}else a.status=h;if(a.status===h&&(a.gzhead.hcrc?(a.pending+2>a.pending_buf_size&&_(e),a.pending+2<=a.pending_buf_size&&(y(a,255&e.adler),y(a,e.adler>>8&255),e.adler=0,a.status=f)):a.status=f),0!==a.pending){if(_(e),0===e.avail_out)return a.last_flush=-1,0}else if(0===e.avail_in&&m(t)<=m(n)&&4!==t)return g(e,-5);if(a.status===p&&0!==e.avail_in)return g(e,-5);if(0!==e.avail_in||0!==a.lookahead||0!==t&&a.status!==p){var I=2===a.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(k(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,n=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(b(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(b(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(b(e,!1),0===e.strm.avail_out)?1:2}(a,t):3===a.strategy?function(e,t){for(var n,i,a,r,o=e.window;;){if(e.lookahead<=d){if(k(e),e.lookahead<=d&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=o[a=e.strstart-1])===o[++a]&&i===o[++a]&&i===o[++a]){r=e.strstart+d;do{}while(i===o[++a]&&i===o[++a]&&i===o[++a]&&i===o[++a]&&i===o[++a]&&i===o[++a]&&i===o[++a]&&i===o[++a]&&a<r);e.match_length=d-(r-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=s._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(b(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(b(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(b(e,!1),0===e.strm.avail_out)?1:2}(a,t):i[a.level].func(a,t);if(3!==I&&4!==I||(a.status=p),1===I||3===I)return 0===e.avail_out&&(a.last_flush=-1),0;if(2===I&&(1===t?s._tr_align(a):5!==t&&(s._tr_stored_block(a,0,0,!1),3===t&&(w(a.head),0===a.lookahead&&(a.strstart=0,a.block_start=0,a.insert=0))),_(e),0===e.avail_out))return a.last_flush=-1,0}return 4!==t?0:a.wrap<=0?1:(2===a.wrap?(y(a,255&e.adler),y(a,e.adler>>8&255),y(a,e.adler>>16&255),y(a,e.adler>>24&255),y(a,255&e.total_in),y(a,e.total_in>>8&255),y(a,e.total_in>>16&255),y(a,e.total_in>>24&255)):(v(a,e.adler>>>16),v(a,65535&e.adler)),_(e),a.wrap>0&&(a.wrap=-a.wrap),0!==a.pending?0:1)},t.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&t!==h&&t!==f&&t!==p?g(e,l):(e.state=null,t===f?g(e,-3):0):l},t.deflateSetDictionary=function(e,t){var n,i,s,o,c,d,u,h,f=t.length;if(!e||!e.state)return l;if(2===(o=(n=e.state).wrap)||1===o&&42!==n.status||n.lookahead)return l;for(1===o&&(e.adler=r(e.adler,t,f,0)),n.wrap=0,f>=n.w_size&&(0===o&&(w(n.head),n.strstart=0,n.block_start=0,n.insert=0),h=new a.Buf8(n.w_size),a.arraySet(h,t,f-n.w_size,n.w_size,0),t=h,f=n.w_size),c=e.avail_in,d=e.next_in,u=e.input,e.avail_in=f,e.next_in=0,e.input=t,k(n);n.lookahead>=3;){i=n.strstart,s=n.lookahead-2;do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[i+3-1])&n.hash_mask,n.prev[i&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=i,i++}while(--s);n.strstart=i,n.lookahead=2,k(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=d,e.input=u,e.avail_in=c,n.wrap=o,0},t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t,n){"use strict";var i=n(2),a=n(6),s=n(7),r=n(9),o=n(10),c=-2,l=12,d=30;function u(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function h(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function f(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new i.Buf32(852),t.distcode=t.distdyn=new i.Buf32(592),t.sane=1,t.back=-1,0):c}function p(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,f(e)):c}function g(e,t){var n,i;return e&&e.state?(i=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?c:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,p(e))):c}function m(e,t){var n,i;return e?(i=new h,e.state=i,i.window=null,0!==(n=g(e,t))&&(e.state=null),n):c}var w,_,b=!0;function y(e){if(b){var t;for(w=new i.Buf32(512),_=new i.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(o(1,e.lens,0,288,w,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;o(2,e.lens,0,32,_,0,e.work,{bits:5}),b=!1}e.lencode=w,e.lenbits=9,e.distcode=_,e.distbits=5}function v(e,t,n,a){var s,r=e.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new i.Buf8(r.wsize)),a>=r.wsize?(i.arraySet(r.window,t,n-r.wsize,r.wsize,0),r.wnext=0,r.whave=r.wsize):((s=r.wsize-r.wnext)>a&&(s=a),i.arraySet(r.window,t,n-a,s,r.wnext),(a-=s)?(i.arraySet(r.window,t,n-a,a,0),r.wnext=a,r.whave=r.wsize):(r.wnext+=s,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=s))),0}t.inflateReset=p,t.inflateReset2=g,t.inflateResetKeep=f,t.inflateInit=function(e){return m(e,15)},t.inflateInit2=m,t.inflate=function(e,t){var n,h,f,p,g,m,w,_,b,I,k,E,x,A,S,M,N,O,T,Z,L,R,P,C,U=0,F=new i.Buf8(4),D=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return c;(n=e.state).mode===l&&(n.mode=13),g=e.next_out,f=e.output,w=e.avail_out,p=e.next_in,h=e.input,m=e.avail_in,_=n.hold,b=n.bits,I=m,k=w,R=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;b<16;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(2&n.wrap&&35615===_){n.check=0,F[0]=255&_,F[1]=_>>>8&255,n.check=s(n.check,F,2,0),_=0,b=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&_)<<8)+(_>>8))%31){e.msg="incorrect header check",n.mode=d;break}if(8!=(15&_)){e.msg="unknown compression method",n.mode=d;break}if(b-=4,L=8+(15&(_>>>=4)),0===n.wbits)n.wbits=L;else if(L>n.wbits){e.msg="invalid window size",n.mode=d;break}n.dmax=1<<L,e.adler=n.check=1,n.mode=512&_?10:l,_=0,b=0;break;case 2:for(;b<16;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(n.flags=_,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=d;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=d;break}n.head&&(n.head.text=_>>8&1),512&n.flags&&(F[0]=255&_,F[1]=_>>>8&255,n.check=s(n.check,F,2,0)),_=0,b=0,n.mode=3;case 3:for(;b<32;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}n.head&&(n.head.time=_),512&n.flags&&(F[0]=255&_,F[1]=_>>>8&255,F[2]=_>>>16&255,F[3]=_>>>24&255,n.check=s(n.check,F,4,0)),_=0,b=0,n.mode=4;case 4:for(;b<16;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}n.head&&(n.head.xflags=255&_,n.head.os=_>>8),512&n.flags&&(F[0]=255&_,F[1]=_>>>8&255,n.check=s(n.check,F,2,0)),_=0,b=0,n.mode=5;case 5:if(1024&n.flags){for(;b<16;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}n.length=_,n.head&&(n.head.extra_len=_),512&n.flags&&(F[0]=255&_,F[1]=_>>>8&255,n.check=s(n.check,F,2,0)),_=0,b=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((E=n.length)>m&&(E=m),E&&(n.head&&(L=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),i.arraySet(n.head.extra,h,p,E,L)),512&n.flags&&(n.check=s(n.check,h,E,p)),m-=E,p+=E,n.length-=E),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===m)break e;E=0;do{L=h[p+E++],n.head&&L&&n.length<65536&&(n.head.name+=String.fromCharCode(L))}while(L&&E<m);if(512&n.flags&&(n.check=s(n.check,h,E,p)),m-=E,p+=E,L)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===m)break e;E=0;do{L=h[p+E++],n.head&&L&&n.length<65536&&(n.head.comment+=String.fromCharCode(L))}while(L&&E<m);if(512&n.flags&&(n.check=s(n.check,h,E,p)),m-=E,p+=E,L)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;b<16;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(_!==(65535&n.check)){e.msg="header crc mismatch",n.mode=d;break}_=0,b=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=l;break;case 10:for(;b<32;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}e.adler=n.check=u(_),_=0,b=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=g,e.avail_out=w,e.next_in=p,e.avail_in=m,n.hold=_,n.bits=b,2;e.adler=n.check=1,n.mode=l;case l:if(5===t||6===t)break e;case 13:if(n.last){_>>>=7&b,b-=7&b,n.mode=27;break}for(;b<3;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}switch(n.last=1&_,b-=1,3&(_>>>=1)){case 0:n.mode=14;break;case 1:if(y(n),n.mode=20,6===t){_>>>=2,b-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=d}_>>>=2,b-=2;break;case 14:for(_>>>=7&b,b-=7&b;b<32;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if((65535&_)!=(_>>>16^65535)){e.msg="invalid stored block lengths",n.mode=d;break}if(n.length=65535&_,_=0,b=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(E=n.length){if(E>m&&(E=m),E>w&&(E=w),0===E)break e;i.arraySet(f,h,p,E,g),m-=E,p+=E,w-=E,g+=E,n.length-=E;break}n.mode=l;break;case 17:for(;b<14;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(n.nlen=257+(31&_),_>>>=5,b-=5,n.ndist=1+(31&_),_>>>=5,b-=5,n.ncode=4+(15&_),_>>>=4,b-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=d;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;b<3;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}n.lens[D[n.have++]]=7&_,_>>>=3,b-=3}for(;n.have<19;)n.lens[D[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,P={bits:n.lenbits},R=o(0,n.lens,0,19,n.lencode,0,n.work,P),n.lenbits=P.bits,R){e.msg="invalid code lengths set",n.mode=d;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;M=(U=n.lencode[_&(1<<n.lenbits)-1])>>>16&255,N=65535&U,!((S=U>>>24)<=b);){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(N<16)_>>>=S,b-=S,n.lens[n.have++]=N;else{if(16===N){for(C=S+2;b<C;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(_>>>=S,b-=S,0===n.have){e.msg="invalid bit length repeat",n.mode=d;break}L=n.lens[n.have-1],E=3+(3&_),_>>>=2,b-=2}else if(17===N){for(C=S+3;b<C;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}b-=S,L=0,E=3+(7&(_>>>=S)),_>>>=3,b-=3}else{for(C=S+7;b<C;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}b-=S,L=0,E=11+(127&(_>>>=S)),_>>>=7,b-=7}if(n.have+E>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=d;break}for(;E--;)n.lens[n.have++]=L}}if(n.mode===d)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=d;break}if(n.lenbits=9,P={bits:n.lenbits},R=o(1,n.lens,0,n.nlen,n.lencode,0,n.work,P),n.lenbits=P.bits,R){e.msg="invalid literal/lengths set",n.mode=d;break}if(n.distbits=6,n.distcode=n.distdyn,P={bits:n.distbits},R=o(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,P),n.distbits=P.bits,R){e.msg="invalid distances set",n.mode=d;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(m>=6&&w>=258){e.next_out=g,e.avail_out=w,e.next_in=p,e.avail_in=m,n.hold=_,n.bits=b,r(e,k),g=e.next_out,f=e.output,w=e.avail_out,p=e.next_in,h=e.input,m=e.avail_in,_=n.hold,b=n.bits,n.mode===l&&(n.back=-1);break}for(n.back=0;M=(U=n.lencode[_&(1<<n.lenbits)-1])>>>16&255,N=65535&U,!((S=U>>>24)<=b);){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(M&&0==(240&M)){for(O=S,T=M,Z=N;M=(U=n.lencode[Z+((_&(1<<O+T)-1)>>O)])>>>16&255,N=65535&U,!(O+(S=U>>>24)<=b);){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}_>>>=O,b-=O,n.back+=O}if(_>>>=S,b-=S,n.back+=S,n.length=N,0===M){n.mode=26;break}if(32&M){n.back=-1,n.mode=l;break}if(64&M){e.msg="invalid literal/length code",n.mode=d;break}n.extra=15&M,n.mode=22;case 22:if(n.extra){for(C=n.extra;b<C;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}n.length+=_&(1<<n.extra)-1,_>>>=n.extra,b-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;M=(U=n.distcode[_&(1<<n.distbits)-1])>>>16&255,N=65535&U,!((S=U>>>24)<=b);){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(0==(240&M)){for(O=S,T=M,Z=N;M=(U=n.distcode[Z+((_&(1<<O+T)-1)>>O)])>>>16&255,N=65535&U,!(O+(S=U>>>24)<=b);){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}_>>>=O,b-=O,n.back+=O}if(_>>>=S,b-=S,n.back+=S,64&M){e.msg="invalid distance code",n.mode=d;break}n.offset=N,n.extra=15&M,n.mode=24;case 24:if(n.extra){for(C=n.extra;b<C;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}n.offset+=_&(1<<n.extra)-1,_>>>=n.extra,b-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=d;break}n.mode=25;case 25:if(0===w)break e;if(E=k-w,n.offset>E){if((E=n.offset-E)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=d;break}E>n.wnext?(E-=n.wnext,x=n.wsize-E):x=n.wnext-E,E>n.length&&(E=n.length),A=n.window}else A=f,x=g-n.offset,E=n.length;E>w&&(E=w),w-=E,n.length-=E;do{f[g++]=A[x++]}while(--E);0===n.length&&(n.mode=21);break;case 26:if(0===w)break e;f[g++]=n.length,w--,n.mode=21;break;case 27:if(n.wrap){for(;b<32;){if(0===m)break e;m--,_|=h[p++]<<b,b+=8}if(k-=w,e.total_out+=k,n.total+=k,k&&(e.adler=n.check=n.flags?s(n.check,f,k,g-k):a(n.check,f,k,g-k)),k=w,(n.flags?_:u(_))!==n.check){e.msg="incorrect data check",n.mode=d;break}_=0,b=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;b<32;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(_!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=d;break}_=0,b=0}n.mode=29;case 29:R=1;break e;case d:R=-3;break e;case 31:return-4;default:return c}return e.next_out=g,e.avail_out=w,e.next_in=p,e.avail_in=m,n.hold=_,n.bits=b,(n.wsize||k!==e.avail_out&&n.mode<d&&(n.mode<27||4!==t))&&v(e,e.output,e.next_out,k-e.avail_out)?(n.mode=31,-4):(I-=e.avail_in,k-=e.avail_out,e.total_in+=I,e.total_out+=k,n.total+=k,n.wrap&&k&&(e.adler=n.check=n.flags?s(n.check,f,k,e.next_out-k):a(n.check,f,k,e.next_out-k)),e.data_type=n.bits+(n.last?64:0)+(n.mode===l?128:0)+(20===n.mode||15===n.mode?256:0),(0===I&&0===k||4===t)&&0===R&&(R=-5),R)},t.inflateEnd=function(e){if(!e||!e.state)return c;var t=e.state;return t.window&&(t.window=null),e.state=null,0},t.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?c:(n.head=t,t.done=!1,0):c},t.inflateSetDictionary=function(e,t){var n,i=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?c:11===n.mode&&a(1,t,i,0)!==n.check?-3:v(e,t,i,i)?(n.mode=31,-4):(n.havedict=1,0):c},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t,n){"use strict";e.exports=function(e,t,n,i){for(var a=65535&e|0,s=e>>>16&65535|0,r=0;0!==n;){n-=r=n>2e3?2e3:n;do{s=s+(a=a+t[i++]|0)|0}while(--r);a%=65521,s%=65521}return a|s<<16|0}},function(e,t,n){"use strict";var i=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();e.exports=function(e,t,n,a){var s=i,r=a+n;e^=-1;for(var o=a;o<r;o++)e=e>>>8^s[255&(e^t[o])];return-1^e}},function(e,t,n){"use strict";var i=n(2);function a(e){for(var t=e.length;--t>=0;)e[t]=0}var s=256,r=286,o=30,c=15,l=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],d=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],h=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],f=new Array(576);a(f);var p=new Array(60);a(p);var g=new Array(512);a(g);var m=new Array(256);a(m);var w=new Array(29);a(w);var _,b,y,v=new Array(o);function I(e,t,n,i,a){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=a,this.has_stree=e&&e.length}function k(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function E(e){return e<256?g[e]:g[256+(e>>>7)]}function x(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function A(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,x(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function S(e,t,n){A(e,n[2*t],n[2*t+1])}function M(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function N(e,t,n){var i,a,s=new Array(16),r=0;for(i=1;i<=c;i++)s[i]=r=r+n[i-1]<<1;for(a=0;a<=t;a++){var o=e[2*a+1];0!==o&&(e[2*a]=M(s[o]++,o))}}function O(e){var t;for(t=0;t<r;t++)e.dyn_ltree[2*t]=0;for(t=0;t<o;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function T(e){e.bi_valid>8?x(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function Z(e,t,n,i){var a=2*t,s=2*n;return e[a]<e[s]||e[a]===e[s]&&i[t]<=i[n]}function L(e,t,n){for(var i=e.heap[n],a=n<<1;a<=e.heap_len&&(a<e.heap_len&&Z(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!Z(t,i,e.heap[a],e.depth));)e.heap[n]=e.heap[a],n=a,a<<=1;e.heap[n]=i}function R(e,t,n){var i,a,r,o,c=0;if(0!==e.last_lit)do{i=e.pending_buf[e.d_buf+2*c]<<8|e.pending_buf[e.d_buf+2*c+1],a=e.pending_buf[e.l_buf+c],c++,0===i?S(e,a,t):(S(e,(r=m[a])+s+1,t),0!==(o=l[r])&&A(e,a-=w[r],o),S(e,r=E(--i),n),0!==(o=d[r])&&A(e,i-=v[r],o))}while(c<e.last_lit);S(e,256,t)}function P(e,t){var n,i,a,s=t.dyn_tree,r=t.stat_desc.static_tree,o=t.stat_desc.has_stree,l=t.stat_desc.elems,d=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<l;n++)0!==s[2*n]?(e.heap[++e.heap_len]=d=n,e.depth[n]=0):s[2*n+1]=0;for(;e.heap_len<2;)s[2*(a=e.heap[++e.heap_len]=d<2?++d:0)]=1,e.depth[a]=0,e.opt_len--,o&&(e.static_len-=r[2*a+1]);for(t.max_code=d,n=e.heap_len>>1;n>=1;n--)L(e,s,n);a=l;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],L(e,s,1),i=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=i,s[2*a]=s[2*n]+s[2*i],e.depth[a]=(e.depth[n]>=e.depth[i]?e.depth[n]:e.depth[i])+1,s[2*n+1]=s[2*i+1]=a,e.heap[1]=a++,L(e,s,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,i,a,s,r,o,l=t.dyn_tree,d=t.max_code,u=t.stat_desc.static_tree,h=t.stat_desc.has_stree,f=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,g=t.stat_desc.max_length,m=0;for(s=0;s<=c;s++)e.bl_count[s]=0;for(l[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(s=l[2*l[2*(i=e.heap[n])+1]+1]+1)>g&&(s=g,m++),l[2*i+1]=s,i>d||(e.bl_count[s]++,r=0,i>=p&&(r=f[i-p]),o=l[2*i],e.opt_len+=o*(s+r),h&&(e.static_len+=o*(u[2*i+1]+r)));if(0!==m){do{for(s=g-1;0===e.bl_count[s];)s--;e.bl_count[s]--,e.bl_count[s+1]+=2,e.bl_count[g]--,m-=2}while(m>0);for(s=g;0!==s;s--)for(i=e.bl_count[s];0!==i;)(a=e.heap[--n])>d||(l[2*a+1]!==s&&(e.opt_len+=(s-l[2*a+1])*l[2*a],l[2*a+1]=s),i--)}}(e,t),N(s,d,e.bl_count)}function C(e,t,n){var i,a,s=-1,r=t[1],o=0,c=7,l=4;for(0===r&&(c=138,l=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)a=r,r=t[2*(i+1)+1],++o<c&&a===r||(o<l?e.bl_tree[2*a]+=o:0!==a?(a!==s&&e.bl_tree[2*a]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,s=a,0===r?(c=138,l=3):a===r?(c=6,l=3):(c=7,l=4))}function U(e,t,n){var i,a,s=-1,r=t[1],o=0,c=7,l=4;for(0===r&&(c=138,l=3),i=0;i<=n;i++)if(a=r,r=t[2*(i+1)+1],!(++o<c&&a===r)){if(o<l)do{S(e,a,e.bl_tree)}while(0!=--o);else 0!==a?(a!==s&&(S(e,a,e.bl_tree),o--),S(e,16,e.bl_tree),A(e,o-3,2)):o<=10?(S(e,17,e.bl_tree),A(e,o-3,3)):(S(e,18,e.bl_tree),A(e,o-11,7));o=0,s=a,0===r?(c=138,l=3):a===r?(c=6,l=3):(c=7,l=4)}}a(v);var F=!1;function D(e,t,n,a){A(e,0+(a?1:0),3),function(e,t,n,a){T(e),x(e,n),x(e,~n),i.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n)}t._tr_init=function(e){F||(function(){var e,t,n,i,a,s=new Array(16);for(n=0,i=0;i<28;i++)for(w[i]=n,e=0;e<1<<l[i];e++)m[n++]=i;for(m[n-1]=i,a=0,i=0;i<16;i++)for(v[i]=a,e=0;e<1<<d[i];e++)g[a++]=i;for(a>>=7;i<o;i++)for(v[i]=a<<7,e=0;e<1<<d[i]-7;e++)g[256+a++]=i;for(t=0;t<=c;t++)s[t]=0;for(e=0;e<=143;)f[2*e+1]=8,e++,s[8]++;for(;e<=255;)f[2*e+1]=9,e++,s[9]++;for(;e<=279;)f[2*e+1]=7,e++,s[7]++;for(;e<=287;)f[2*e+1]=8,e++,s[8]++;for(N(f,287,s),e=0;e<o;e++)p[2*e+1]=5,p[2*e]=M(e,5);_=new I(f,l,257,r,c),b=new I(p,d,0,o,c),y=new I(new Array(0),u,0,19,7)}(),F=!0),e.l_desc=new k(e.dyn_ltree,_),e.d_desc=new k(e.dyn_dtree,b),e.bl_desc=new k(e.bl_tree,y),e.bi_buf=0,e.bi_valid=0,O(e)},t._tr_stored_block=D,t._tr_flush_block=function(e,t,n,i){var a,r,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<s;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),P(e,e.l_desc),P(e,e.d_desc),o=function(e){var t;for(C(e,e.dyn_ltree,e.l_desc.max_code),C(e,e.dyn_dtree,e.d_desc.max_code),P(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*h[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),a=e.opt_len+3+7>>>3,(r=e.static_len+3+7>>>3)<=a&&(a=r)):a=r=n+5,n+4<=a&&-1!==t?D(e,t,n,i):4===e.strategy||r===a?(A(e,2+(i?1:0),3),R(e,f,p)):(A(e,4+(i?1:0),3),function(e,t,n,i){var a;for(A(e,t-257,5),A(e,n-1,5),A(e,i-4,4),a=0;a<i;a++)A(e,e.bl_tree[2*h[a]+1],3);U(e,e.dyn_ltree,t-1),U(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),R(e,e.dyn_ltree,e.dyn_dtree)),O(e),i&&T(e)},t._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(m[n]+s+1)]++,e.dyn_dtree[2*E(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){A(e,2,3),S(e,256,f),function(e){16===e.bi_valid?(x(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},function(e,t,n){"use strict";e.exports=function(e,t){var n,i,a,s,r,o,c,l,d,u,h,f,p,g,m,w,_,b,y,v,I,k,E,x,A;n=e.state,i=e.next_in,x=e.input,a=i+(e.avail_in-5),s=e.next_out,A=e.output,r=s-(t-e.avail_out),o=s+(e.avail_out-257),c=n.dmax,l=n.wsize,d=n.whave,u=n.wnext,h=n.window,f=n.hold,p=n.bits,g=n.lencode,m=n.distcode,w=(1<<n.lenbits)-1,_=(1<<n.distbits)-1;e:do{p<15&&(f+=x[i++]<<p,p+=8,f+=x[i++]<<p,p+=8),b=g[f&w];t:for(;;){if(f>>>=y=b>>>24,p-=y,0==(y=b>>>16&255))A[s++]=65535&b;else{if(!(16&y)){if(0==(64&y)){b=g[(65535&b)+(f&(1<<y)-1)];continue t}if(32&y){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}v=65535&b,(y&=15)&&(p<y&&(f+=x[i++]<<p,p+=8),v+=f&(1<<y)-1,f>>>=y,p-=y),p<15&&(f+=x[i++]<<p,p+=8,f+=x[i++]<<p,p+=8),b=m[f&_];n:for(;;){if(f>>>=y=b>>>24,p-=y,!(16&(y=b>>>16&255))){if(0==(64&y)){b=m[(65535&b)+(f&(1<<y)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(I=65535&b,p<(y&=15)&&(f+=x[i++]<<p,(p+=8)<y&&(f+=x[i++]<<p,p+=8)),(I+=f&(1<<y)-1)>c){e.msg="invalid distance too far back",n.mode=30;break e}if(f>>>=y,p-=y,I>(y=s-r)){if((y=I-y)>d&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(k=0,E=h,0===u){if(k+=l-y,y<v){v-=y;do{A[s++]=h[k++]}while(--y);k=s-I,E=A}}else if(u<y){if(k+=l+u-y,(y-=u)<v){v-=y;do{A[s++]=h[k++]}while(--y);if(k=0,u<v){v-=y=u;do{A[s++]=h[k++]}while(--y);k=s-I,E=A}}}else if(k+=u-y,y<v){v-=y;do{A[s++]=h[k++]}while(--y);k=s-I,E=A}for(;v>2;)A[s++]=E[k++],A[s++]=E[k++],A[s++]=E[k++],v-=3;v&&(A[s++]=E[k++],v>1&&(A[s++]=E[k++]))}else{k=s-I;do{A[s++]=A[k++],A[s++]=A[k++],A[s++]=A[k++],v-=3}while(v>2);v&&(A[s++]=A[k++],v>1&&(A[s++]=A[k++]))}break}}break}}while(i<a&&s<o);i-=v=p>>3,f&=(1<<(p-=v<<3))-1,e.next_in=i,e.next_out=s,e.avail_in=i<a?a-i+5:5-(i-a),e.avail_out=s<o?o-s+257:257-(s-o),n.hold=f,n.bits=p}},function(e,t,n){"use strict";var i=n(2),a=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],s=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],r=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],o=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,n,c,l,d,u,h){var f,p,g,m,w,_,b,y,v,I=h.bits,k=0,E=0,x=0,A=0,S=0,M=0,N=0,O=0,T=0,Z=0,L=null,R=0,P=new i.Buf16(16),C=new i.Buf16(16),U=null,F=0;for(k=0;k<=15;k++)P[k]=0;for(E=0;E<c;E++)P[t[n+E]]++;for(S=I,A=15;A>=1&&0===P[A];A--);if(S>A&&(S=A),0===A)return l[d++]=20971520,l[d++]=20971520,h.bits=1,0;for(x=1;x<A&&0===P[x];x++);for(S<x&&(S=x),O=1,k=1;k<=15;k++)if(O<<=1,(O-=P[k])<0)return-1;if(O>0&&(0===e||1!==A))return-1;for(C[1]=0,k=1;k<15;k++)C[k+1]=C[k]+P[k];for(E=0;E<c;E++)0!==t[n+E]&&(u[C[t[n+E]]++]=E);if(0===e?(L=U=u,_=19):1===e?(L=a,R-=257,U=s,F-=257,_=256):(L=r,U=o,_=-1),Z=0,E=0,k=x,w=d,M=S,N=0,g=-1,m=(T=1<<S)-1,1===e&&T>852||2===e&&T>592)return 1;for(;;){b=k-N,u[E]<_?(y=0,v=u[E]):u[E]>_?(y=U[F+u[E]],v=L[R+u[E]]):(y=96,v=0),f=1<<k-N,x=p=1<<M;do{l[w+(Z>>N)+(p-=f)]=b<<24|y<<16|v|0}while(0!==p);for(f=1<<k-1;Z&f;)f>>=1;if(0!==f?(Z&=f-1,Z+=f):Z=0,E++,0==--P[k]){if(k===A)break;k=t[n+u[E]]}if(k>S&&(Z&m)!==g){for(0===N&&(N=S),w+=x,O=1<<(M=k-N);M+N<A&&!((O-=P[M+N])<=0);)M++,O<<=1;if(T+=1<<M,1===e&&T>852||2===e&&T>592)return 1;l[g=Z&m]=S<<24|M<<16|w-d|0}}return 0!==Z&&(l[w+Z]=k-N<<24|64<<16|0),h.bits=S,0}},function(e,t,n){"use strict";n.r(t);var i=n(3),a=n.n(i),s=n(4),r=n(5),o=n(1),c=n.n(o),l=n(0),d=16384;function u(e,t){var n=this;this.inflatedReady=e,this.deflatedReady=t,this._inflate=function(e){var t=new a.a,n=Object(r.inflateInit2)(t,15);if(n!==l.Z_OK)throw new Error("Problem initializing inflate stream: "+c.a[n]);return function(n){if(void 0===n)return e();var i,a,s;t.input=n,t.next_in=0,t.avail_in=t.input.length;var o=!0;do{if(0===t.avail_out&&(t.output=new Uint8Array(d),i=t.next_out=0,t.avail_out=d),(a=Object(r.inflate)(t,l.Z_NO_FLUSH))!==l.Z_STREAM_END&&a!==l.Z_OK)throw new Error("inflate problem: "+c.a[a]);t.next_out&&(0!==t.avail_out&&a!==l.Z_STREAM_END||(s=t.output.subarray(i,i=t.next_out),o=e(s)))}while(t.avail_in>0&&a!==l.Z_STREAM_END);return t.next_out>i&&(s=t.output.subarray(i,i=t.next_out),o=e(s)),o}}((function(e){return n.inflatedReady(e.buffer.slice(e.byteOffset,e.byteOffset+e.length))})),this._deflate=function(e){var t=new a.a,n=Object(s.deflateInit2)(t,l.Z_DEFAULT_COMPRESSION,l.Z_DEFLATED,15,8,l.Z_DEFAULT_STRATEGY);if(n!==l.Z_OK)throw new Error("Problem initializing deflate stream: "+c.a[n]);return function(n){if(void 0===n)return e();var i,a,r;t.input=n,t.next_in=0,t.avail_in=t.input.length;var o=!0;do{if(0===t.avail_out&&(t.output=new Uint8Array(d),r=t.next_out=0,t.avail_out=d),(i=Object(s.deflate)(t,l.Z_SYNC_FLUSH))!==l.Z_STREAM_END&&i!==l.Z_OK)throw new Error("Deflate problem: "+c.a[i]);0===t.avail_out&&t.next_out>r&&(a=t.output.subarray(r,r=t.next_out),o=e(a))}while((t.avail_in>0||0===t.avail_out)&&i!==l.Z_STREAM_END);return t.next_out>r&&(a=t.output.subarray(r,r=t.next_out),o=e(a)),o}}((function(e){return n.deflatedReady(e.buffer.slice(e.byteOffset,e.byteOffset+e.length))}))}u.prototype.inflate=function(e){this._inflate(new Uint8Array(e))},u.prototype.deflate=function(e){this._deflate(new Uint8Array(e))};var h=function(e,t){return{message:e,buffer:t}},f=new u((function(e){return self.postMessage(h("inflated_ready",e),[e])}),(function(e){return self.postMessage(h("deflated_ready",e),[e])}));self.onmessage=function(e){var t=e.data.message,n=e.data.buffer;switch(t){case"start":break;case"inflate":f.inflate(n);break;case"deflate":f.deflate(n)}}}])},9673:(e,t,n)=>{"use strict";function i(e){return null!=e&&"object"==typeof e&&!0===e["@@functional/placeholder"]}function a(e){return function t(n){return 0===arguments.length||i(n)?t:e.apply(this,arguments)}}function s(e){return function t(n,s){switch(arguments.length){case 0:return t;case 1:return i(n)?t:a((function(t){return e(n,t)}));default:return i(n)&&i(s)?t:i(n)?a((function(t){return e(t,s)})):i(s)?a((function(t){return e(n,t)})):e(n,s)}}}function r(e){return function t(n,r,o){switch(arguments.length){case 0:return t;case 1:return i(n)?t:s((function(t,i){return e(n,t,i)}));case 2:return i(n)&&i(r)?t:i(n)?s((function(t,n){return e(t,r,n)})):i(r)?s((function(t,i){return e(n,t,i)})):a((function(t){return e(n,r,t)}));default:return i(n)&&i(r)&&i(o)?t:i(n)&&i(r)?s((function(t,n){return e(t,n,o)})):i(n)&&i(o)?s((function(t,n){return e(t,r,n)})):i(r)&&i(o)?s((function(t,i){return e(n,t,i)})):i(n)?a((function(t){return e(t,r,o)})):i(r)?a((function(t){return e(n,t,o)})):i(o)?a((function(t){return e(n,r,t)})):e(n,r,o)}}}n.d(t,{ZP:()=>At});const o=s((function(e,t){return null==t||t!=t?e:t}));const c=s((function(e,t){for(var n=t,i=0;i<e.length;){if(null==n)return;n=n[e[i]],i+=1}return n}));const l=r((function(e,t,n){return o(e,c(t,n))}));const d=r((function(e,t,n){return l(e,[t],n)})),u=Array.isArray||function(e){return null!=e&&e.length>=0&&"[object Array]"===Object.prototype.toString.call(e)};function h(e){return"[object String]"===Object.prototype.toString.call(e)}const f=a((function(e){return!!u(e)||!!e&&("object"==typeof e&&(!h(e)&&(1===e.nodeType?!!e.length:0===e.length||e.length>0&&(e.hasOwnProperty(0)&&e.hasOwnProperty(e.length-1)))))}));function p(e){return function t(n){for(var i,a,s,r=[],o=0,c=n.length;o<c;){if(f(n[o]))for(s=0,a=(i=e?t(n[o]):n[o]).length;s<a;)r[r.length]=i[s],s+=1;else r[r.length]=n[o];o+=1}return r}}const g=a(p(!0));const m=a((function(e){for(var t={},n=0;n<e.length;)t[e[n][0]]=e[n][1],n+=1;return t}));const w=s((function(e,t){for(var n=[],i=0,a=Math.min(e.length,t.length);i<a;)n[i]=[e[i],t[i]],i+=1;return n}));function _(e,t){var n;t=t||[];var i=(e=e||[]).length,a=t.length,s=[];for(n=0;n<i;)s[s.length]=e[n],n+=1;for(n=0;n<a;)s[s.length]=t[n],n+=1;return s}function b(e,t){switch(e){case 0:return function(){return t.apply(this,arguments)};case 1:return function(e){return t.apply(this,arguments)};case 2:return function(e,n){return t.apply(this,arguments)};case 3:return function(e,n,i){return t.apply(this,arguments)};case 4:return function(e,n,i,a){return t.apply(this,arguments)};case 5:return function(e,n,i,a,s){return t.apply(this,arguments)};case 6:return function(e,n,i,a,s,r){return t.apply(this,arguments)};case 7:return function(e,n,i,a,s,r,o){return t.apply(this,arguments)};case 8:return function(e,n,i,a,s,r,o,c){return t.apply(this,arguments)};case 9:return function(e,n,i,a,s,r,o,c,l){return t.apply(this,arguments)};case 10:return function(e,n,i,a,s,r,o,c,l,d){return t.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}}function y(e,t){return function(){return t.call(this,e.apply(this,arguments))}}var v=function(){function e(e){this.f=e}return e.prototype["@@transducer/init"]=function(){throw new Error("init not implemented on XWrap")},e.prototype["@@transducer/result"]=function(e){return e},e.prototype["@@transducer/step"]=function(e,t){return this.f(e,t)},e}();const I=s((function(e,t){return b(e.length,(function(){return e.apply(t,arguments)}))}));function k(e,t,n){for(var i=n.next();!i.done;){if((t=e["@@transducer/step"](t,i.value))&&t["@@transducer/reduced"]){t=t["@@transducer/value"];break}i=n.next()}return e["@@transducer/result"](t)}function E(e,t,n,i){return e["@@transducer/result"](n[i](I(e["@@transducer/step"],e),t))}var x="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator";function A(e,t,n){if("function"==typeof e&&(e=function(e){return new v(e)}(e)),f(n))return function(e,t,n){for(var i=0,a=n.length;i<a;){if((t=e["@@transducer/step"](t,n[i]))&&t["@@transducer/reduced"]){t=t["@@transducer/value"];break}i+=1}return e["@@transducer/result"](t)}(e,t,n);if("function"==typeof n["fantasy-land/reduce"])return E(e,t,n,"fantasy-land/reduce");if(null!=n[x])return k(e,t,n[x]());if("function"==typeof n.next)return k(e,t,n);if("function"==typeof n.reduce)return E(e,t,n,"reduce");throw new TypeError("reduce: list must be array or iterable")}const S=r(A);function M(e,t){return function(){var n=arguments.length;if(0===n)return t();var i=arguments[n-1];return u(i)||"function"!=typeof i[e]?t.apply(this,arguments):i[e].apply(i,Array.prototype.slice.call(arguments,0,n-1))}}const N=a(M("tail",r(M("slice",(function(e,t,n){return Array.prototype.slice.call(n,e,t)})))(1,1/0)));function O(){if(0===arguments.length)throw new Error("pipe requires at least one argument");return b(arguments[0].length,S(y,arguments[0],N(arguments)))}const T=a((function(e){return h(e)?e.split("").reverse().join(""):Array.prototype.slice.call(e,0).reverse()}));function Z(){if(0===arguments.length)throw new Error("compose requires at least one argument");return O.apply(this,T(arguments))}function L(e){return e}const R=a(L);function P(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n}function C(e,t,n){for(var i=0,a=n.length;i<a;){if(e(t,n[i]))return!0;i+=1}return!1}function U(e,t){return Object.prototype.hasOwnProperty.call(t,e)}const F="function"==typeof Object.is?Object.is:function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t};var D=Object.prototype.toString;const z=function(){return"[object Arguments]"===D.call(arguments)?function(e){return"[object Arguments]"===D.call(e)}:function(e){return U("callee",e)}}();var B=!{toString:null}.propertyIsEnumerable("toString"),$=["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],j=function(){return arguments.propertyIsEnumerable("length")}(),V=function(e,t){for(var n=0;n<e.length;){if(e[n]===t)return!0;n+=1}return!1},q="function"!=typeof Object.keys||j?a((function(e){if(Object(e)!==e)return[];var t,n,i=[],a=j&&z(e);for(t in e)!U(t,e)||a&&"length"===t||(i[i.length]=t);if(B)for(n=$.length-1;n>=0;)U(t=$[n],e)&&!V(i,t)&&(i[i.length]=t),n-=1;return i})):a((function(e){return Object(e)!==e?[]:Object.keys(e)}));const Q=q;const H=a((function(e){return null===e?"Null":void 0===e?"Undefined":Object.prototype.toString.call(e).slice(8,-1)}));function K(e,t,n,i){var a=P(e);function s(e,t){return W(e,t,n.slice(),i.slice())}return!C((function(e,t){return!C(s,t,e)}),P(t),a)}function W(e,t,n,i){if(F(e,t))return!0;var a,s,r=H(e);if(r!==H(t))return!1;if(null==e||null==t)return!1;if("function"==typeof e["fantasy-land/equals"]||"function"==typeof t["fantasy-land/equals"])return"function"==typeof e["fantasy-land/equals"]&&e["fantasy-land/equals"](t)&&"function"==typeof t["fantasy-land/equals"]&&t["fantasy-land/equals"](e);if("function"==typeof e.equals||"function"==typeof t.equals)return"function"==typeof e.equals&&e.equals(t)&&"function"==typeof t.equals&&t.equals(e);switch(r){case"Arguments":case"Array":case"Object":if("function"==typeof e.constructor&&"Promise"===(a=e.constructor,null==(s=String(a).match(/^function (\w*)/))?"":s[1]))return e===t;break;case"Boolean":case"Number":case"String":if(typeof e!=typeof t||!F(e.valueOf(),t.valueOf()))return!1;break;case"Date":if(!F(e.valueOf(),t.valueOf()))return!1;break;case"Error":return e.name===t.name&&e.message===t.message;case"RegExp":if(e.source!==t.source||e.global!==t.global||e.ignoreCase!==t.ignoreCase||e.multiline!==t.multiline||e.sticky!==t.sticky||e.unicode!==t.unicode)return!1}for(var o=n.length-1;o>=0;){if(n[o]===e)return i[o]===t;o-=1}switch(r){case"Map":return e.size===t.size&&K(e.entries(),t.entries(),n.concat([e]),i.concat([t]));case"Set":return e.size===t.size&&K(e.values(),t.values(),n.concat([e]),i.concat([t]));case"Arguments":case"Array":case"Object":case"Boolean":case"Number":case"String":case"Date":case"Error":case"RegExp":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"ArrayBuffer":break;default:return!1}var c=Q(e);if(c.length!==Q(t).length)return!1;var l=n.concat([e]),d=i.concat([t]);for(o=c.length-1;o>=0;){var u=c[o];if(!U(u,t)||!W(t[u],e[u],l,d))return!1;o-=1}return!0}const G=s((function(e,t){return W(e,t,[],[])}));function Y(e,t){return function(e,t,n){var i,a;if("function"==typeof e.indexOf)switch(typeof t){case"number":if(0===t){for(i=1/t;n<e.length;){if(0===(a=e[n])&&1/a===i)return n;n+=1}return-1}if(t!=t){for(;n<e.length;){if("number"==typeof(a=e[n])&&a!=a)return n;n+=1}return-1}return e.indexOf(t,n);case"string":case"boolean":case"function":case"undefined":return e.indexOf(t,n);case"object":if(null===t)return e.indexOf(t,n)}for(;n<e.length;){if(G(e[n],t))return n;n+=1}return-1}(t,e,0)>=0}function X(e,t,n){var i,a=typeof e;switch(a){case"string":case"number":return 0===e&&1/e==-1/0?!!n._items["-0"]||(t&&(n._items["-0"]=!0),!1):null!==n._nativeSet?t?(i=n._nativeSet.size,n._nativeSet.add(e),n._nativeSet.size===i):n._nativeSet.has(e):a in n._items?e in n._items[a]||(t&&(n._items[a][e]=!0),!1):(t&&(n._items[a]={},n._items[a][e]=!0),!1);case"boolean":if(a in n._items){var s=e?1:0;return!!n._items[a][s]||(t&&(n._items[a][s]=!0),!1)}return t&&(n._items[a]=e?[!1,!0]:[!0,!1]),!1;case"function":return null!==n._nativeSet?t?(i=n._nativeSet.size,n._nativeSet.add(e),n._nativeSet.size===i):n._nativeSet.has(e):a in n._items?!!Y(e,n._items[a])||(t&&n._items[a].push(e),!1):(t&&(n._items[a]=[e]),!1);case"undefined":return!!n._items[a]||(t&&(n._items[a]=!0),!1);case"object":if(null===e)return!!n._items.null||(t&&(n._items.null=!0),!1);default:return(a=Object.prototype.toString.call(e))in n._items?!!Y(e,n._items[a])||(t&&n._items[a].push(e),!1):(t&&(n._items[a]=[e]),!1)}}const J=function(){function e(){this._nativeSet="function"==typeof Set?new Set:null,this._items={}}return e.prototype.add=function(e){return!X(e,!0,this)},e.prototype.has=function(e){return X(e,!1,this)},e}();const ee=s(Z(s((function(e,t){for(var n,i,a=new J,s=[],r=0;r<t.length;)n=e(i=t[r]),a.add(n)&&s.push(i),r+=1;return s}))(R),_));function te(e){return null!=e&&"function"==typeof e["@@transducer/step"]}function ne(e,t,n){return function(){if(0===arguments.length)return n();var i=Array.prototype.slice.call(arguments,0),a=i.pop();if(!u(a)){for(var s=0;s<e.length;){if("function"==typeof a[e[s]])return a[e[s]].apply(a,i);s+=1}if(te(a)){var r=t.apply(null,i);return r(a)}}return n.apply(this,arguments)}}function ie(e,t){for(var n=0,i=t.length,a=Array(i);n<i;)a[n]=e(t[n]),n+=1;return a}const ae=function(){return this.xf["@@transducer/init"]()},se=function(e){return this.xf["@@transducer/result"](e)};var re=function(){function e(e,t){this.xf=t,this.f=e}return e.prototype["@@transducer/init"]=ae,e.prototype["@@transducer/result"]=se,e.prototype["@@transducer/step"]=function(e,t){return this.xf["@@transducer/step"](e,this.f(t))},e}();const oe=s((function(e,t){return new re(e,t)}));function ce(e,t,n){return function(){for(var a=[],s=0,r=e,o=0;o<t.length||s<arguments.length;){var c;o<t.length&&(!i(t[o])||s>=arguments.length)?c=t[o]:(c=arguments[s],s+=1),a[o]=c,i(c)||(r-=1),o+=1}return r<=0?n.apply(this,a):b(r,ce(e,a,n))}}const le=s((function(e,t){return 1===e?a(t):b(e,ce(e,[],t))}));const de=s(ne(["fantasy-land/map","map"],oe,(function(e,t){switch(Object.prototype.toString.call(t)){case"[object Function]":return le(t.length,(function(){return e.call(this,t.apply(this,arguments))}));case"[object Object]":return A((function(n,i){return n[i]=e(t[i]),n}),{},Q(t));default:return ie(e,t)}})));var ue=n(83065),he=n(84846);const fe=32,pe=93,ge=e=>(e=>e>=1&&e<=127)(e)&&!me(e),me=e=>40===e||41===e||123===e||e===fe||we(e)||_e(e)||be(e)||ye(e),we=e=>e>=0&&e<=31||127===e,_e=e=>37===e||42===e,be=e=>34===e||92===e,ye=e=>e===pe,ve=e=>e>=48&&e<=57,Ie=e=>(e=>e>=65&&e<=90||e>=97&&e<=122)(e)||ve(e),ke=e=>ge(e)||ye(e);function Ee(e,t,n){let i=[],a=(e.tag||"")+(e.command?" "+e.command:""),s=!0,r=function(e){if(a.length>0&&s&&(a+=" "),Array.isArray(e))return s=!1,a+="(",e.forEach(r),void(a+=")");if(s=!0,e||"string"==typeof e||"number"==typeof e)if("string"!=typeof e)if("number"!=typeof e)if(n&&e.sensitive)a+='"(* value hidden *)"';else switch(e.type.toUpperCase()){case"LITERAL":n?a+='"(* '+e.value.length+'B literal *)"':(e.value?a+="{"+e.value.length+"}\r\n":a+="{0}\r\n",i.push(a),a=e.value||"");break;case"STRING":n&&e.value.length>20?a+='"(* '+e.value.length+'B string *)"':a+=JSON.stringify(e.value||"");break;case"TEXT":case"SEQUENCE":a+=e.value||"";break;case"NUMBER":a+=e.value||0;break;case"ATOM":case"SECTION":let t=e.value||"";for(let e=92===t.charCodeAt(0)?1:0;e<t.length;e++)if(!ge(t.charCodeAt(e))){t=JSON.stringify(t);break}a+=t,e.section&&(a+="[",e.section.length&&(s=!1,e.section.forEach(r)),a+="]"),e.partial&&(a+="<"+e.partial.join(".")+">")}else a+=Math.round(e)||0;else n&&e.length>20?a+='"(* '+e.length+'B string *)"':a+=JSON.stringify(e);else a+="NIL"};return[].concat(e.attributes||[]).forEach(r),a.length&&i.push(a),t?i:i.join("")}function xe(e){return"[object Function]"===Object.prototype.toString.call(e)}function Ae(e){return'"'+e.replace(/\\/g,"\\\\").replace(/[\b]/g,"\\b").replace(/\f/g,"\\f").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t").replace(/\v/g,"\\v").replace(/\0/g,"\\0").replace(/"/g,'\\"')+'"'}var Se=function(e){return(e<10?"0":"")+e};const Me="function"==typeof Date.prototype.toISOString?function(e){return e.toISOString()}:function(e){return e.getUTCFullYear()+"-"+Se(e.getUTCMonth()+1)+"-"+Se(e.getUTCDate())+"T"+Se(e.getUTCHours())+":"+Se(e.getUTCMinutes())+":"+Se(e.getUTCSeconds())+"."+(e.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"};var Ne=function(){function e(e,t){this.xf=t,this.f=e}return e.prototype["@@transducer/init"]=ae,e.prototype["@@transducer/result"]=se,e.prototype["@@transducer/step"]=function(e,t){return this.f(t)?this.xf["@@transducer/step"](e,t):e},e}();const Oe=s(ne(["filter"],s((function(e,t){return new Ne(e,t)})),(function(e,t){return n=t,"[object Object]"===Object.prototype.toString.call(n)?A((function(n,i){return e(t[i])&&(n[i]=t[i]),n}),{},Q(t)):function(e,t){for(var n=0,i=t.length,a=[];n<i;)e(t[n])&&(a[a.length]=t[n]),n+=1;return a}(e,t);var n})));const Te=s((function(e,t){return Oe((n=e,function(){return!n.apply(this,arguments)}),t);var n}));function Ze(e,t){var n=function(n){var i=t.concat([e]);return Y(n,i)?"<Circular>":Ze(n,i)},i=function(e,t){return ie((function(t){return Ae(t)+": "+n(e[t])}),t.slice().sort())};switch(Object.prototype.toString.call(e)){case"[object Arguments]":return"(function() { return arguments; }("+ie(n,e).join(", ")+"))";case"[object Array]":return"["+ie(n,e).concat(i(e,Te((function(e){return/^\d+$/.test(e)}),Q(e)))).join(", ")+"]";case"[object Boolean]":return"object"==typeof e?"new Boolean("+n(e.valueOf())+")":e.toString();case"[object Date]":return"new Date("+(isNaN(e.valueOf())?n(NaN):Ae(Me(e)))+")";case"[object Null]":return"null";case"[object Number]":return"object"==typeof e?"new Number("+n(e.valueOf())+")":1/e==-1/0?"-0":e.toString(10);case"[object String]":return"object"==typeof e?"new String("+n(e.valueOf())+")":Ae(e);case"[object Undefined]":return"undefined";default:if("function"==typeof e.toString){var a=e.toString();if("[object Object]"!==a)return a}return"{"+i(e,Q(e)).join(", ")+"}"}}const Le=a((function(e){return Ze(e,[])}));const Re=s((function(e,t){return le(e+1,(function(){var n=arguments[e];if(null!=n&&xe(n[t]))return n[t].apply(n,Array.prototype.slice.call(arguments,0,e));throw new TypeError(Le(n)+' does not have a method named "'+t+'"')}))}))(0,"toLowerCase");const Pe=s((function(e,t){return c([e],t)}));var Ce=n(85834);function Ue(e){return!!e&&(e=[].concat(e||[])).map((e=>!(!e||!e.length)&&{prefix:e[0].value,delimiter:e[1]&&e[1].value}))}function Fe(e){const t={};return e[0]&&e[0].value&&(t.date=e[0].value),e[1]&&e[1].value&&(t.subject=(0,Ce.Mf)(e[1]&&e[1].value)),e[2]&&e[2].length&&(t.from=De(e[2])),e[3]&&e[3].length&&(t.sender=De(e[3])),e[4]&&e[4].length&&(t["reply-to"]=De(e[4])),e[5]&&e[5].length&&(t.to=De(e[5])),e[6]&&e[6].length&&(t.cc=De(e[6])),e[7]&&e[7].length&&(t.bcc=De(e[7])),e[8]&&e[8].value&&(t["in-reply-to"]=e[8].value),e[9]&&e[9].value&&(t["message-id"]=e[9].value),t}function De(e=[]){return e.map((e=>{const t=l("",["0","value"],e).trim(),n=l("",["2","value"],e)+"@"+l("",["3","value"],e),i=t?function(e){if(!/^[\w ']*$/.test(e))return/^[\x20-\x7e]*$/.test(e)?JSON.stringify(e):(0,Ce.KR)(e,"Q",52);return e}(t)+" <"+n+">":n,a=(0,he.Z)(i).shift();return a.name=(0,Ce.Mf)(a.name),a}))}function ze(e,t=[]){const n={};let i=0,a=0;if(t.length&&(n.part=t.join(".")),Array.isArray(e[0])){for(n.childNodes=[];Array.isArray(e[i]);)n.childNodes.push(ze(e[i],t.concat(++a))),i++;n.type="multipart/"+((e[i++]||{}).value||"").toString().toLowerCase(),i<e.length-1&&(e[i]&&(n.parameters=Be(e[i])),i++)}else n.type=[((e[i++]||{}).value||"").toString().toLowerCase(),((e[i++]||{}).value||"").toString().toLowerCase()].join("/"),e[i]&&(n.parameters=Be(e[i])),i++,e[i]&&(n.id=((e[i]||{}).value||"").toString()),i++,e[i]&&(n.description=((e[i]||{}).value||"").toString()),i++,e[i]&&(n.encoding=((e[i]||{}).value||"").toString().toLowerCase()),i++,e[i]&&(n.size=Number((e[i]||{}).value||0)||0),i++,"message/rfc822"===n.type?(e[i]&&(n.envelope=Fe([].concat(e[i]||[]))),i++,e[i]&&(n.childNodes=[ze(e[i],t)]),i++,e[i]&&(n.lineCount=Number((e[i]||{}).value||0)||0),i++):/^text\//.test(n.type)&&(e[i]&&(n.lineCount=Number((e[i]||{}).value||0)||0),i++),i<e.length-1&&(e[i]&&(n.md5=((e[i]||{}).value||"").toString().toLowerCase()),i++);return i<e.length-1&&(Array.isArray(e[i])&&e[i].length&&(n.disposition=((e[i][0]||{}).value||"").toString().toLowerCase(),Array.isArray(e[i][1])&&(n.dispositionParameters=Be(e[i][1]))),i++),i<e.length-1&&(e[i]&&(n.language=[].concat(e[i]).map((e=>d("","value",e).toLowerCase()))),i++),i<e.length-1&&(e[i]&&(n.location=((e[i]||{}).value||"").toString()),i++),n}function Be(e=[],t=Re,n=Ce.Mf){const i=e.map(Pe("value")),a=i.filter(((e,t)=>t%2==0)).map(t),s=i.filter(((e,t)=>t%2==1)).map(n);return m(w(a,s))}function $e(e){if(!(e&&e.payload&&e.payload.FETCH&&e.payload.FETCH.length))return[];const t=[],n={};return e.payload.FETCH.forEach((e=>{const i=[].concat([].concat(e.attributes||[])[0]||[]);let a,s,r,o;for(n[e.nr]?a=n[e.nr]:(n[e.nr]=a={"#":e.nr},t.push(a)),s=0,r=i.length;s<r;s++)s%2!=0?a[o]=je(o,i[s]):o=Ee({attributes:[i[s]]}).toLowerCase().replace(/<\d+>$/,"")})),t}function je(e,t){if(!t)return null;if(!Array.isArray(t)){switch(e){case"uid":case"rfc822.size":return Number(t.value)||0;case"modseq":return t.value||"0"}return t.value}switch(e){case"flags":case"x-gm-labels":t=[].concat(t).map((e=>e.value||""));break;case"envelope":t=Fe([].concat(t||[]));break;case"bodystructure":t=ze([].concat(t||[]));break;case"modseq":t=(t.shift()||{}).value||"0"}return t}function Ve(e){for(var t=[],n=0;n<e.length;n+=10240){const i=n,a=Math.min(n+10240,e.length);t.push(String.fromCharCode.apply(null,e.subarray(i,a)))}return t.join("")}function qe(e){let t=0,n=e.length;for(;e[t]===fe;)t++;for(;e[n-1]===fe;)n--;return 0===t&&n===e.length||(e=e.subarray(t,n)),Ve(e)}class Qe{constructor(e,t){this.remainder=new Uint8Array(e||0),this.options=t||{},this.pos=0}getTag(){if(!this.tag){const e=e=>(e=>ke(e)&&43!==e)(e)||42===e||43===e;this.tag=this.getElement(e)}return this.tag}getCommand(){switch(this.command||(this.command=this.getElement(Ie)),(this.command||"").toString().toUpperCase()){case"OK":case"NO":case"BAD":case"PREAUTH":case"BYE":let e=this.remainder.lastIndexOf(pe);91===this.remainder[1]&&e>1?(this.humanReadable=qe(this.remainder.subarray(e+1)),this.remainder=this.remainder.subarray(0,e+1)):(this.humanReadable=qe(this.remainder),this.remainder=new Uint8Array(0))}return this.command}getElement(e){let t;if(this.remainder[0]===fe)throw new Error("Unexpected whitespace at position "+this.pos);let n=this.remainder.indexOf(fe);if(!(this.remainder.length>0&&0!==n))throw new Error("Unexpected end of input at position "+this.pos);t=-1===n?this.remainder:this.remainder.subarray(0,n);for(let n=0;n<t.length;n++)if(!e(t[n]))throw new Error("Unexpected char at position "+(this.pos+n));return this.pos+=t.length,this.remainder=this.remainder.subarray(t.length),Ve(t)}getSpace(){if(!this.remainder.length)throw new Error("Unexpected end of input at position "+this.pos);if(this.remainder[0]!==fe)throw new Error("Unexpected char at position "+this.pos);this.pos++,this.remainder=this.remainder.subarray(1)}getAttributes(){if(!this.remainder.length)throw new Error("Unexpected end of input at position "+this.pos);if(this.remainder[0]===fe)throw new Error("Unexpected whitespace at position "+this.pos);return new Ke(this,this.pos,this.remainder.subarray(),this.options).getAttributes()}}class He{constructor(e,t,n){this.uint8Array=e,this.childNodes=[],this.type=!1,this.closed=!0,this.valueSkip=[],this.startPos=n,this.valueStart=this.valueEnd="number"==typeof n?n+1:0,t&&(this.parentNode=t,t.childNodes.push(this))}getValue(){let e=Ve(this.getValueArray());return this.valueToUpperCase?e.toUpperCase():e}getValueLength(){return this.valueEnd-this.valueStart-this.valueSkip.length}getValueArray(){const e=this.uint8Array.subarray(this.valueStart,this.valueEnd);if(0===this.valueSkip.length)return e;let t=new Uint8Array(e.length-this.valueSkip.length),n=0,i=0,a=this.valueSkip.slice();return a.push(e.length),a.forEach((function(a){if(a>n){var s=e.subarray(n,a);t.set(s,i),i+=s.length}n=a+1})),t}equals(e,t){return this.getValueLength()===e.length&&this.equalsAt(e,0,t)}equalsAt(e,t,n){if(n="boolean"!=typeof n||n,t<0)for(t=this.valueEnd+t;this.valueSkip.indexOf(this.valueStart+t)>=0;)t--;else t=this.valueStart+t;for(let i=0;i<e.length;i++){for(;this.valueSkip.indexOf(t-this.valueStart)>=0;)t++;if(t>=this.valueEnd)return!1;let a=String.fromCharCode(this.uint8Array[t]),s=e[i];if(n||(a=a.toUpperCase(),s=s.toUpperCase()),a!==s)return!1;t++}return!0}isNumber(){for(let e=0;e<this.valueEnd-this.valueStart;e++)if(!(this.valueSkip.indexOf(e)>=0||this.isDigit(e)))return!1;return!0}isDigit(e){if(e<0)for(e=this.valueEnd+e;this.valueSkip.indexOf(this.valueStart+e)>=0;)e--;else for(e=this.valueStart+e;this.valueSkip.indexOf(this.valueStart+e)>=0;)e++;return ve(this.uint8Array[e])}containsChar(e){let t=e.charCodeAt(0);for(let e=this.valueStart;e<this.valueEnd;e++)if(!(this.valueSkip.indexOf(e-this.valueStart)>=0)&&this.uint8Array[e]===t)return!0;return!1}}class Ke{constructor(e,t,n,i={}){this.uint8Array=n,this.options=i,this.parent=e,this.tree=this.currentNode=this.createNode(),this.pos=t||0,this.currentNode.type="TREE",this.state="NORMAL",void 0===this.options.valueAsString&&(this.options.valueAsString=!0),this.processString()}getAttributes(){let e=[],t=e,n=e=>{let i,a,s=t;if(!e.closed&&"SEQUENCE"===e.type&&e.equals("*")&&(e.closed=!0,e.type="ATOM"),!e.closed)throw new Error("Unexpected end of input at position "+(this.pos+this.uint8Array.length-1));switch(e.type.toUpperCase()){case"LITERAL":case"STRING":i={type:e.type.toUpperCase(),value:this.options.valueAsString?e.getValue():e.getValueArray()},t.push(i);break;case"SEQUENCE":i={type:e.type.toUpperCase(),value:e.getValue()},t.push(i);break;case"ATOM":if(e.equals("NIL",!0)){t.push(null);break}i={type:e.type.toUpperCase(),value:e.getValue()},t.push(i);break;case"SECTION":t=t[t.length-1].section=[];break;case"LIST":i=[],t.push(i),t=i;break;case"PARTIAL":a=e.getValue().split(".").map(Number),t[t.length-1].partial=a}e.childNodes.forEach((function(e){n(e)})),t=s};return n(this.tree),e}createNode(e,t){return new He(this.uint8Array,e,t)}processString(){let e,t;const n=t=>{for(;this.uint8Array[e+1]===fe;)e++};for(e=0,t=this.uint8Array.length;e<t;e++){let i=this.uint8Array[e];switch(this.state){case"NORMAL":switch(i){case 34:this.currentNode=this.createNode(this.currentNode,e),this.currentNode.type="string",this.state="STRING",this.currentNode.closed=!1;break;case 40:this.currentNode=this.createNode(this.currentNode,e),this.currentNode.type="LIST",this.currentNode.closed=!1;break;case 41:if("LIST"!==this.currentNode.type)throw new Error("Unexpected list terminator ) at position "+(this.pos+e));this.currentNode.closed=!0,this.currentNode.endPos=this.pos+e,this.currentNode=this.currentNode.parentNode,n();break;case pe:if("SECTION"!==this.currentNode.type)throw new Error("Unexpected section terminator ] at position "+(this.pos+e));this.currentNode.closed=!0,this.currentNode.endPos=this.pos+e,this.currentNode=this.currentNode.parentNode,n();break;case 60:this.uint8Array[e-1]!==pe?(this.currentNode=this.createNode(this.currentNode,e),this.currentNode.type="ATOM",this.currentNode.valueStart=e,this.currentNode.valueEnd=e+1,this.state="ATOM"):(this.currentNode=this.createNode(this.currentNode,e),this.currentNode.type="PARTIAL",this.state="PARTIAL",this.currentNode.closed=!1);break;case 123:this.currentNode=this.createNode(this.currentNode,e),this.currentNode.type="LITERAL",this.state="LITERAL",this.currentNode.closed=!1;break;case 42:this.currentNode=this.createNode(this.currentNode,e),this.currentNode.type="SEQUENCE",this.currentNode.valueStart=e,this.currentNode.valueEnd=e+1,this.currentNode.closed=!1,this.state="SEQUENCE";break;case fe:case 126:break;case 91:if(["OK","NO","BAD","BYE","PREAUTH"].indexOf(this.parent.command.toUpperCase())>=0&&this.currentNode===this.tree){this.currentNode.endPos=this.pos+e,this.currentNode=this.createNode(this.currentNode,e),this.currentNode.type="ATOM",this.currentNode=this.createNode(this.currentNode,e),this.currentNode.type="SECTION",this.currentNode.closed=!1,this.state="NORMAL","REFERRAL "===Ve(this.uint8Array.subarray(e+1,e+10)).toUpperCase()&&(this.currentNode=this.createNode(this.currentNode,this.pos+e+1),this.currentNode.type="ATOM",this.currentNode.endPos=this.pos+e+8,this.currentNode.valueStart=e+1,this.currentNode.valueEnd=e+9,this.currentNode.valueToUpperCase=!0,this.currentNode=this.currentNode.parentNode,this.currentNode=this.createNode(this.currentNode,this.pos+e+10),this.currentNode.type="ATOM",e=this.uint8Array.indexOf(pe,e+10),this.currentNode.endPos=this.pos+e-1,this.currentNode.valueStart=this.currentNode.startPos-this.pos,this.currentNode.valueEnd=this.currentNode.endPos-this.pos+1,this.currentNode=this.currentNode.parentNode,this.currentNode.closed=!0,this.currentNode=this.currentNode.parentNode,n());break}default:if(!ge(i)&&92!==i&&37!==i)throw new Error("Unexpected char at position "+(this.pos+e));this.currentNode=this.createNode(this.currentNode,e),this.currentNode.type="ATOM",this.currentNode.valueStart=e,this.currentNode.valueEnd=e+1,this.state="ATOM"}break;case"ATOM":if(i===fe){this.currentNode.endPos=this.pos+e-1,this.currentNode=this.currentNode.parentNode,this.state="NORMAL";break}if(this.currentNode.parentNode&&(41===i&&"LIST"===this.currentNode.parentNode.type||i===pe&&"SECTION"===this.currentNode.parentNode.type)){this.currentNode.endPos=this.pos+e-1,this.currentNode=this.currentNode.parentNode,this.currentNode.closed=!0,this.currentNode.endPos=this.pos+e,this.currentNode=this.currentNode.parentNode,this.state="NORMAL",n();break}if(44!==i&&58!==i||!this.currentNode.isNumber()||(this.currentNode.type="SEQUENCE",this.currentNode.closed=!0,this.state="SEQUENCE"),91===i&&(this.currentNode.equals("BODY",!1)||this.currentNode.equals("BODY.PEEK",!1))){this.currentNode.endPos=this.pos+e,this.currentNode=this.createNode(this.currentNode.parentNode,this.pos+e),this.currentNode.type="SECTION",this.currentNode.closed=!1,this.state="NORMAL";break}if(60===i)throw new Error("Unexpected start of partial at position "+this.pos);if(!(ge(i)||i===pe||42===i&&this.currentNode.equals("\\")))throw new Error("Unexpected char at position "+(this.pos+e));if(this.currentNode.equals("\\*"))throw new Error("Unexpected char at position "+(this.pos+e));this.currentNode.valueEnd=e+1;break;case"STRING":if(34===i){this.currentNode.endPos=this.pos+e,this.currentNode.closed=!0,this.currentNode=this.currentNode.parentNode,this.state="NORMAL",n();break}if(92===i){if(this.currentNode.valueSkip.push(e-this.currentNode.valueStart),e++,e>=t)throw new Error("Unexpected end of input at position "+(this.pos+e));i=this.uint8Array[e]}this.currentNode.valueEnd=e+1;break;case"PARTIAL":if(62===i){if(this.currentNode.equalsAt(".",-1))throw new Error("Unexpected end of partial at position "+this.pos);this.currentNode.endPos=this.pos+e,this.currentNode.closed=!0,this.currentNode=this.currentNode.parentNode,this.state="NORMAL",n();break}if(46===i&&(!this.currentNode.getValueLength()||this.currentNode.containsChar(".")))throw new Error("Unexpected partial separator . at position "+this.pos);if(!ve(i)&&46!==i)throw new Error("Unexpected char at position "+(this.pos+e));if(46!==i&&(this.currentNode.equals("0")||this.currentNode.equalsAt(".0",-2)))throw new Error("Invalid partial at position "+(this.pos+e));this.currentNode.valueEnd=e+1;break;case"LITERAL":if(this.currentNode.started){this.currentNode.valueEnd=e+1,this.currentNode.getValueLength()>=this.currentNode.literalLength&&(this.currentNode.endPos=this.pos+e,this.currentNode.closed=!0,this.currentNode=this.currentNode.parentNode,this.state="NORMAL",n());break}if(43===i){this.currentNode.literalPlus=!0;break}if(125===i){if(!("literalLength"in this.currentNode))throw new Error("Unexpected literal prefix end char } at position "+(this.pos+e));if(10===this.uint8Array[e+1])e++;else{if(13!==this.uint8Array[e+1]||10!==this.uint8Array[e+2])throw new Error("Unexpected char at position "+(this.pos+e));e+=2}this.currentNode.valueStart=e+1,this.currentNode.literalLength=Number(this.currentNode.literalLength),this.currentNode.started=!0,this.currentNode.literalLength||(this.currentNode.endPos=this.pos+e,this.currentNode.closed=!0,this.currentNode=this.currentNode.parentNode,this.state="NORMAL",n());break}if(!ve(i))throw new Error("Unexpected char at position "+(this.pos+e));if("0"===this.currentNode.literalLength)throw new Error("Invalid literal at position "+(this.pos+e));this.currentNode.literalLength=(this.currentNode.literalLength||"")+String.fromCharCode(i);break;case"SEQUENCE":if(i===fe){if(!this.currentNode.isDigit(-1)&&!this.currentNode.equalsAt("*",-1))throw new Error("Unexpected whitespace at position "+(this.pos+e));if(this.currentNode.equalsAt("*",-1)&&!this.currentNode.equalsAt(":",-2))throw new Error("Unexpected whitespace at position "+(this.pos+e));this.currentNode.closed=!0,this.currentNode.endPos=this.pos+e-1,this.currentNode=this.currentNode.parentNode,this.state="NORMAL";break}if(this.currentNode.parentNode&&i===pe&&"SECTION"===this.currentNode.parentNode.type){this.currentNode.endPos=this.pos+e-1,this.currentNode=this.currentNode.parentNode,this.currentNode.closed=!0,this.currentNode.endPos=this.pos+e,this.currentNode=this.currentNode.parentNode,this.state="NORMAL",n();break}if(58===i){if(!this.currentNode.isDigit(-1)&&!this.currentNode.equalsAt("*",-1))throw new Error("Unexpected range separator : at position "+(this.pos+e))}else if(42===i){if(!this.currentNode.equalsAt(",",-1)&&!this.currentNode.equalsAt(":",-1))throw new Error("Unexpected range wildcard at position "+(this.pos+e))}else if(44===i){if(!this.currentNode.isDigit(-1)&&!this.currentNode.equalsAt("*",-1))throw new Error("Unexpected sequence separator , at position "+(this.pos+e));if(this.currentNode.equalsAt("*",-1)&&!this.currentNode.equalsAt(":",-2))throw new Error("Unexpected sequence separator , at position "+(this.pos+e))}else if(!ve(i))throw new Error("Unexpected char at position "+(this.pos+e));if(ve(i)&&this.currentNode.equalsAt("*",-1))throw new Error("Unexpected number at position "+(this.pos+e));this.currentNode.valueEnd=e+1}}}}function We(e,t={}){let n=new Qe(e,t),i={};return i.tag=n.getTag(),n.getSpace(),i.command=n.getCommand(),["UID","AUTHENTICATE"].indexOf((i.command||"").toUpperCase())>=0&&(n.getSpace(),i.command+=" "+n.getElement(Ie)),function(e){for(let t=0;t<e.length;t++)if(e[t]!==fe)return!1;return!0}(n.remainder)||(n.getSpace(),i.attributes=n.getAttributes()),n.humanReadable&&(i.attributes=(i.attributes||[]).concat({type:"TEXT",value:n.humanReadable})),i}var Ge=n(65546);const Ye=e=>new Uint8Array(e.split("").map((e=>e.charCodeAt(0)))),Xe=e=>String.fromCharCode.apply(null,e);function Je(e="",t){const n=[`user=${e}`,`auth=Bearer ${t}`,"",""];return(0,Ge.encode)(n.join(""))}let et=0;function tt(e,t){const n=++et,i=(i,a)=>{a=a.map((e=>"function"==typeof e?e():e));const s=`[${(new Date).toISOString()}][${n}][${e}][${t}] ${a.join(" ")}`;10===i?console.log("[DEBUG]"+s):20===i?console.info("[INFO]"+s):30===i?console.warn("[WARN]"+s):40===i&&console.error("[ERROR]"+s)};return{debug:e=>i(10,e),info:e=>i(20,e),warn:e=>i(30,e),error:e=>i(40,e)}}var nt=n(16504),it=n(62292),at=n.n(it),st=n(30405),rt=n(27948),ot=n(48898),ct=n.n(ot),lt=n(71619);const dt=16384;function ut(e,t){this.inflatedReady=e,this.deflatedReady=t,this._inflate=function(e){const t=new(at()),n=(0,rt.Ul)(t,15);if(n!==lt.Z_OK)throw new Error("Problem initializing inflate stream: "+ct()[n]);return function(n){if(void 0===n)return e();let i,a,s;t.input=n,t.next_in=0,t.avail_in=t.input.length;let r=!0;do{if(0===t.avail_out&&(t.output=new Uint8Array(dt),i=t.next_out=0,t.avail_out=dt),a=(0,rt.rr)(t,lt.Z_NO_FLUSH),a!==lt.Z_STREAM_END&&a!==lt.Z_OK)throw new Error("inflate problem: "+ct()[a]);t.next_out&&(0!==t.avail_out&&a!==lt.Z_STREAM_END||(s=t.output.subarray(i,i=t.next_out),r=e(s)))}while(t.avail_in>0&&a!==lt.Z_STREAM_END);return t.next_out>i&&(s=t.output.subarray(i,i=t.next_out),r=e(s)),r}}((e=>this.inflatedReady(e.buffer.slice(e.byteOffset,e.byteOffset+e.length)))),this._deflate=function(e){const t=new(at()),n=(0,st.Ue)(t,lt.Z_DEFAULT_COMPRESSION,lt.Z_DEFLATED,15,8,lt.Z_DEFAULT_STRATEGY);if(n!==lt.Z_OK)throw new Error("Problem initializing deflate stream: "+ct()[n]);return function(n){if(void 0===n)return e();let i,a,s;t.input=n,t.next_in=0,t.avail_in=t.input.length;let r=!0;do{if(0===t.avail_out&&(t.output=new Uint8Array(dt),s=t.next_out=0,t.avail_out=dt),i=(0,st.Wt)(t,lt.Z_SYNC_FLUSH),i!==lt.Z_STREAM_END&&i!==lt.Z_OK)throw new Error("Deflate problem: "+ct()[i]);0===t.avail_out&&t.next_out>s&&(a=t.output.subarray(s,s=t.next_out),r=e(a))}while((t.avail_in>0||0===t.avail_out)&&i!==lt.Z_STREAM_END);return t.next_out>s&&(a=t.output.subarray(s,s=t.next_out),r=e(a)),r}}((e=>this.deflatedReady(e.buffer.slice(e.byteOffset,e.byteOffset+e.length))))}ut.prototype.inflate=function(e){this._inflate(new Uint8Array(e))},ut.prototype.deflate=function(e){this._deflate(new Uint8Array(e))};var ht=n(44983),ft=n.n(ht);const pt="\r\n",gt="literal",mt="literal_length_1",wt="literal_length_2",_t="default";class bt{constructor(e,t,n={}){this.timeoutEnterIdle=1e3,this.timeoutSocketLowerBound=1e4,this.timeoutSocketMultiplier=.1,this.options=n,this.port=t||(this.options.useSecureTransport?993:143),this.host=e||"localhost",this.options.useSecureTransport="useSecureTransport"in this.options?!!this.options.useSecureTransport:993===this.port,this.secureMode=!!this.options.useSecureTransport,this._connectionReady=!1,this._globalAcceptUntagged={},this._clientQueue=[],this._canSend=!1,this._tagCounter=0,this._currentCommand=!1,this._idleTimer=!1,this._socketTimeoutTimer=!1,this.compressed=!1,this._incomingBuffers=[],this._bufferState=_t,this._literalRemaining=0,this.oncert=null,this.onerror=null,this.onready=null,this.onidle=null}connect(e=nt.default){return new Promise(((t,n)=>{this.socket=e.open(this.host,this.port,{binaryType:"arraybuffer",useSecureTransport:this.secureMode,ca:this.options.ca});try{this.socket.oncert=e=>{this.oncert&&this.oncert(e)}}catch(e){}this.socket.onclose=()=>this._onError(new Error("Socket closed unexpectedly!")),this.socket.ondata=e=>{try{this._onData(e)}catch(e){this._onError(e)}},this.socket.onerror=e=>{n(new Error("Could not open socket: "+e.data.message))},this.socket.onopen=()=>{this.socket.onerror=e=>this._onError(e),t()}}))}close(e){return new Promise((t=>{var n=()=>{if(this._clientQueue.forEach((t=>t.callback(e))),this._currentCommand&&this._currentCommand.callback(e),this._clientQueue=[],this._currentCommand=!1,clearTimeout(this._idleTimer),this._idleTimer=null,clearTimeout(this._socketTimeoutTimer),this._socketTimeoutTimer=null,this.socket){this.socket.onopen=null,this.socket.onclose=null,this.socket.ondata=null,this.socket.onerror=null;try{this.socket.oncert=null}catch(e){}this.socket=null}t()};if(this._disableCompression(),!this.socket||"open"!==this.socket.readyState)return n();this.socket.onclose=this.socket.onerror=n,this.socket.close()}))}logout(){return new Promise(((e,t)=>{this.socket.onclose=this.socket.onerror=()=>{this.close("Client logging out").then(e).catch(t)},this.enqueueCommand("LOGOUT")}))}upgrade(){this.secureMode=!0,this.socket.upgradeToSecure()}enqueueCommand(e,t,n){"string"==typeof e&&(e={command:e}),t=[].concat(t||[]).map((e=>(e||"").toString().toUpperCase().trim()));var i="W"+ ++this._tagCounter;return e.tag=i,new Promise(((a,s)=>{var r={tag:i,request:e,payload:t.length?{}:void 0,callback:e=>{if(this.isError(e))return s(e);{const n=d("","command",e).toUpperCase().trim();if(["NO","BAD"].includes(n)){var t=new Error(e.humanReadable||"Error");return t.command=n,e.code&&(t.code=e.code),s(t)}}a(e)}};Object.keys(n||{}).forEach((e=>{r[e]=n[e]})),t.forEach((e=>{r.payload[e]=[]}));var o=r.ctx?this._clientQueue.indexOf(r.ctx):-1;o>=0?(r.tag+=".p",r.request.tag+=".p",this._clientQueue.splice(o,0,r)):this._clientQueue.push(r),this._canSend&&this._sendRequest()}))}getPreviouslyQueued(e,t){for(let e=this._clientQueue.indexOf(t)-1;e>=0;e--)if(n(this._clientQueue[e]))return this._clientQueue[e];return!!n(this._currentCommand)&&this._currentCommand;function n(t){return t&&t.request&&e.indexOf(t.request.command)>=0}}send(e){const t=Ye(e).buffer;this._resetSocketTimeout(t.byteLength),this.compressed?this._sendCompressed(t):this.socket.send(t)}setHandler(e,t){this._globalAcceptUntagged[e.toUpperCase().trim()]=t}_onError(e){var t;t=this.isError(e)?e:e&&this.isError(e.data)?e.data:new Error(e&&e.data&&e.data.message||e.data||e||"Error"),this.logger.error(t),this.close(t).then((()=>{this.onerror&&this.onerror(t)}),(()=>{this.onerror&&this.onerror(t)}))}_onData(e){this._resetSocketTimeout(),this._incomingBuffers.push(new Uint8Array(e.data)),this._parseIncomingCommands(this._iterateIncomingBuffer())}*_iterateIncomingBuffer(){let e=this._incomingBuffers[this._incomingBuffers.length-1]||[],t=0;for(;t<e.length;)switch(this._bufferState){case gt:const n=Math.min(e.length-t,this._literalRemaining);this._literalRemaining-=n,t+=n,0===this._literalRemaining&&(this._bufferState=_t);continue;case wt:t<e.length&&(13===e[t]?(this._literalRemaining=Number(Xe(this._lengthBuffer))+2,this._bufferState=gt):this._bufferState=_t,delete this._lengthBuffer);continue;case mt:const i=t;for(;t<e.length&&e[t]>=48&&e[t]<=57;)t++;if(i!==t){const n=e.subarray(i,t),a=this._lengthBuffer;this._lengthBuffer=new Uint8Array(a.length+n.length),this._lengthBuffer.set(a),this._lengthBuffer.set(n,a.length)}t<e.length&&(this._lengthBuffer.length>0&&125===e[t]?this._bufferState=wt:(delete this._lengthBuffer,this._bufferState=_t),t++);continue;default:const a=e.indexOf(123,t);if(a>-1){if(-1===new Uint8Array(e.buffer,t,a-t).indexOf(10)){t=a+1,this._lengthBuffer=new Uint8Array(0),this._bufferState=mt;continue}}const s=e.indexOf(10,t);if(!(s>-1))return;{s<e.length-1&&(this._incomingBuffers[this._incomingBuffers.length-1]=new Uint8Array(e.buffer,0,s+1));const n=this._incomingBuffers.reduce(((e,t)=>e+t.length),0)-2,i=new Uint8Array(n);let a=0;for(;this._incomingBuffers.length>0;){let e=this._incomingBuffers.shift();const t=n-a;if(e.length>t){const n=e.length-t;e=e.subarray(0,-n),this._incomingBuffers.length>0&&(this._incomingBuffers=[])}i.set(e,a),a+=e.length}if(yield i,!(s<e.length-1))return clearTimeout(this._socketTimeoutTimer),void(this._socketTimeoutTimer=null);e=new Uint8Array(e.subarray(s+1)),this._incomingBuffers.push(e),t=0}}}_parseIncomingCommands(e){for(var t of e)if(this._clearIdle(),43!==t[0]){var n;try{const e=this._currentCommand.request&&this._currentCommand.request.valueAsString;n=We(t,{valueAsString:e}),this.logger.debug("S:",(()=>Ee(n,!1,!0)))}catch(e){return this.logger.error("Error parsing imap command!",n),this._onError(e)}this._processResponse(n),this._handleResponse(n),this._connectionReady||(this._connectionReady=!0,this.onready&&this.onready())}else if(this._currentCommand.data.length){var i=this._currentCommand.data.shift();i+=this._currentCommand.data.length?"":pt,this.send(i)}else this._currentCommand.errorResponseExpectsEmptyLine&&this.send(pt)}_handleResponse(e){var t=d("","command",e).toUpperCase().trim();this._currentCommand?this._currentCommand.payload&&"*"===e.tag&&t in this._currentCommand.payload?(this._currentCommand.payload[t].push(e),this._resetSocketTimeout()):"*"===e.tag&&t in this._globalAcceptUntagged?(this._globalAcceptUntagged[t](e),this._resetSocketTimeout()):e.tag===this._currentCommand.tag&&(this._currentCommand.payload&&Object.keys(this._currentCommand.payload).length&&(e.payload=this._currentCommand.payload),this._currentCommand.callback(e),this._canSend=!0,this._sendRequest()):"*"===e.tag&&t in this._globalAcceptUntagged&&(this._globalAcceptUntagged[t](e),this._canSend=!0,this._sendRequest())}_sendRequest(){if(!this._clientQueue.length)return this._currentCommand=!1,this._enterIdle();this._clearIdle(),this._restartQueue=!1;var e=this._clientQueue[0];if("function"==typeof e.precheck){var t=e,n=t.precheck;return delete t.precheck,this._restartQueue=!0,void n(t).then((()=>{this._restartQueue&&this._sendRequest()})).catch((e=>{let n;const i=this._clientQueue.indexOf(t);i>=0&&(n=this._clientQueue.splice(i,1)[0]),n&&n.callback&&(n.callback(e),this._canSend=!0,this._parseIncomingCommands(this._iterateIncomingBuffer()),this._sendRequest())}))}this._canSend=!1,this._currentCommand=this._clientQueue.shift();try{this._currentCommand.data=Ee(this._currentCommand.request,!0),this.logger.debug("C:",(()=>Ee(this._currentCommand.request,!1,!0)))}catch(e){return this.logger.error("Error compiling imap command!",this._currentCommand.request),this._onError(new Error("Error compiling imap command!"))}var i=this._currentCommand.data.shift();return this.send(i+(this._currentCommand.data.length?"":pt)),this.waitDrain}_enterIdle(){clearTimeout(this._idleTimer),this._idleTimer=setTimeout((()=>this.onidle&&this.onidle()),this.timeoutEnterIdle)}_clearIdle(){clearTimeout(this._idleTimer),this._idleTimer=null}_processResponse(e){const t=d("","command",e).toUpperCase().trim();if(e&&e.attributes&&e.attributes.length&&("*"===e.tag&&/^\d+$/.test(e.command)&&"ATOM"===e.attributes[0].type&&(e.nr=Number(e.command),e.command=(e.attributes.shift().value||"").toString().toUpperCase().trim()),!(["OK","NO","BAD","BYE","PREAUTH"].indexOf(t)<0)&&("TEXT"===e.attributes[e.attributes.length-1].type&&(e.humanReadable=e.attributes[e.attributes.length-1].value),"ATOM"===e.attributes[0].type&&e.attributes[0].section))){const t=e.attributes[0].section.map((e=>{if(e)return Array.isArray(e)?e.map((e=>(e.value||"").toString().trim())):(e.value||"").toString().toUpperCase().trim()})),n=t.shift();e.code=n,1===t.length?e[n.toLowerCase()]=t[0]:t.length>1&&(e[n.toLowerCase()]=t)}}isError(e){return!!Object.prototype.toString.call(e).match(/Error\]$/)}enableCompression(){if(this._socketOnData=this.socket.ondata,this.compressed=!0,"undefined"!=typeof window&&window.Worker)this._compressionWorker=new Worker(URL.createObjectURL(new Blob([ft()]))),this._compressionWorker.onmessage=e=>{var t=e.data.message,n=e.data.buffer;switch(t){case"inflated_ready":this._socketOnData({data:n});break;case"deflated_ready":this.waitDrain=this.socket.send(n)}},this._compressionWorker.onerror=e=>{this._onError(new Error("Error handling compression web worker: "+e.message))},this._compressionWorker.postMessage(yt("start"));else{const e=e=>{this._socketOnData({data:e})},t=e=>{this.waitDrain=this.socket.send(e)};this._compression=new ut(e,t)}this.socket.ondata=e=>{this.compressed&&(this._compressionWorker?this._compressionWorker.postMessage(yt("inflate",e.data),[e.data]):this._compression.inflate(e.data))}}_disableCompression(){this.compressed&&(this.compressed=!1,this.socket.ondata=this._socketOnData,this._socketOnData=null,this._compressionWorker&&(this._compressionWorker.terminate(),this._compressionWorker=null))}_sendCompressed(e){this._compressionWorker?this._compressionWorker.postMessage(yt("deflate",e),[e]):this._compression.deflate(e)}_resetSocketTimeout(e){clearTimeout(this._socketTimeoutTimer);const t=this.timeoutSocketLowerBound+Math.floor((e||4096)*this.timeoutSocketMultiplier);this._socketTimeoutTimer=setTimeout((()=>this._onError(new Error(" Socket timed out!"))),t)}}const yt=(e,t)=>({message:e,buffer:t}),vt=["\\All","\\Archive","\\Drafts","\\Flagged","\\Junk","\\Sent","\\Trash"],It={"\\Sent":["aika","bidaliak","bidalita","dihantar","e rometsweng","e tindami","elküldött","elküldöttek","enviadas","enviadas","enviados","enviats","envoyés","ethunyelweyo","expediate","ezipuru","gesendete","gestuur","gönderilmiş öğeler","göndərilənlər","iberilen","inviati","išsiųstieji","kuthunyelwe","lasa","lähetetyt","messages envoyés","naipadala","nalefa","napadala","nosūtītās ziņas","odeslané","padala","poslane","poslano","poslano","poslané","poslato","saadetud","saadetud kirjad","sendt","sendt","sent","sent items","sent messages","sända poster","sänt","terkirim","ti fi ranṣẹ","të dërguara","verzonden","vilivyotumwa","wysłane","đã gửi","σταλθέντα","жиберилген","жіберілгендер","изпратени","илгээсэн","ирсол шуд","испратено","надіслані","отправленные","пасланыя","юборилган","ուղարկված","נשלחו","פריטים שנשלחו","المرسلة","بھیجے گئے","سوزمژہ","لېګل شوی","موارد ارسال شده","पाठविले","पाठविलेले","प्रेषित","भेजा गया","প্রেরিত","প্রেরিত","প্ৰেৰিত","ਭੇਜੇ","મોકલેલા","ପଠାଗଲା","அனுப்பியவை","పంపించబడింది","ಕಳುಹಿಸಲಾದ","അയച്ചു","යැවු පණිවුඩ","ส่งแล้ว","გაგზავნილი","የተላኩ","បាន​ផ្ញើ","寄件備份","寄件備份","已发信息","送信済みﾒｰﾙ","발신 메시지","보낸 편지함"],"\\Trash":["articole șterse","bin","borttagna objekt","deleted","deleted items","deleted messages","elementi eliminati","elementos borrados","elementos eliminados","gelöschte objekte","item dipadam","itens apagados","itens excluídos","mục đã xóa","odstraněné položky","pesan terhapus","poistetut","praht","prügikast","silinmiş öğeler","slettede beskeder","slettede elementer","trash","törölt elemek","usunięte wiadomości","verwijderde items","vymazané správy","éléments supprimés","видалені","жойылғандар","удаленные","פריטים שנמחקו","العناصر المحذوفة","موارد حذف شده","รายการที่ลบ","已删除邮件","已刪除項目","已刪除項目"],"\\Junk":["bulk mail","correo no deseado","courrier indésirable","istenmeyen","istenmeyen e-posta","junk","levélszemét","nevyžiadaná pošta","nevyžádaná pošta","no deseado","posta indesiderata","pourriel","roskaposti","skräppost","spam","spam","spamowanie","søppelpost","thư rác","спам","דואר זבל","الرسائل العشوائية","هرزنامه","สแปม","‎垃圾郵件","垃圾邮件","垃圾電郵"],"\\Drafts":["ba brouillon","borrador","borrador","borradores","bozze","brouillons","bản thảo","ciorne","concepten","draf","drafts","drög","entwürfe","esborranys","garalamalar","ihe edeturu","iidrafti","izinhlaka","juodraščiai","kladd","kladder","koncepty","koncepty","konsep","konsepte","kopie robocze","layihələr","luonnokset","melnraksti","meralo","mesazhe të padërguara","mga draft","mustandid","nacrti","nacrti","osnutki","piszkozatok","rascunhos","rasimu","skice","taslaklar","tsararrun saƙonni","utkast","vakiraoka","vázlatok","zirriborroak","àwọn àkọpamọ́","πρόχειρα","жобалар","нацрти","нооргууд","сиёҳнавис","хомаки хатлар","чарнавікі","чернетки","чернови","черновики","черновиктер","սևագրեր","טיוטות","مسودات","مسودات","موسودې","پیش نویسها","ڈرافٹ/","ड्राफ़्ट","प्रारूप","খসড়া","খসড়া","ড্ৰাফ্ট","ਡ੍ਰਾਫਟ","ડ્રાફ્ટસ","ଡ୍ରାଫ୍ଟ","வரைவுகள்","చిత్తు ప్రతులు","ಕರಡುಗಳು","കരടുകള്‍","කෙටුම් පත්","ฉบับร่าง","მონახაზები","ረቂቆች","សារព្រាង","下書き","草稿","草稿","草稿","임시 보관함"]},kt=Object.keys(It);function Et(e){if(e.flags)for(let t=0;t<vt.length;t++){const n=vt[t];if((e.flags||[]).indexOf(n)>=0)return e.specialUse=n,e.specialUseFlag=n,n}return function(e){const t=d("","name",e).toLowerCase().trim();for(let n=0;n<kt.length;n++){const i=kt[n];if(It[i].indexOf(t)>=0)return e.specialUse=i,i}return!1}(e)}const xt={name:"emailjs-imap-client"};const At=class{constructor(e,t,n={}){this.timeoutConnection=9e4,this.timeoutNoop=6e4,this.timeoutIdle=6e4,this.serverId=!1,this.oncert=null,this.onupdate=null,this.onselectmailbox=null,this.onclosemailbox=null,this._host=e,this._clientId=d(xt,"id",n),this._state=!1,this._authenticated=!1,this._capability=[],this._humanReadable="",this._okGreeting="",this._selectedMailbox=!1,this._enteredIdle=!1,this._idleTimeout=!1,this._enableCompression=!!n.enableCompression,this._auth=n.auth,this._requireTLS=!!n.requireTLS,this._ignoreTLS=!!n.ignoreTLS,this.client=new bt(e,t,n),this.client.onerror=this._onError.bind(this),this.client.oncert=e=>this.oncert&&this.oncert(e),this.client.onidle=()=>this._onIdle(),this.client.setHandler("capability",(e=>this._untaggedCapabilityHandler(e))),this.client.setHandler("ok",(e=>this._untaggedOkHandler(e))),this.client.setHandler("exists",(e=>this._untaggedExistsHandler(e))),this.client.setHandler("expunge",(e=>this._untaggedExpungeHandler(e))),this.client.setHandler("fetch",(e=>this._untaggedFetchHandler(e))),this.createLogger(),this.logLevel=d(0,"logLevel",n)}_onError(e){clearTimeout(this._idleTimeout),this.onerror&&this.onerror(e)}async connect(){try{await this.openConnection(),await this.upgradeConnection();try{await this.updateId(this._clientId)}catch(e){if("BAD"!==e.command)throw e;this.logger.warn("Failed to update server id!",e.message)}await this.login(this._auth),await this.compressConnection(),this.logger.debug("Connection established, ready to roll!"),this.client.onerror=this._onError.bind(this)}catch(e){throw this.logger.error("Could not connect to server",e),this.close(e),e}}openConnection(){return new Promise(((e,t)=>{const n=setTimeout((()=>t(new Error("Timeout connecting to server"))),this.timeoutConnection);this.logger.debug("Connecting to",this.client.host,":",this.client.port),this._changeState(1),this.client.connect().then((()=>{this.logger.debug("Socket opened, waiting for greeting from the server..."),this.client.onready=()=>{clearTimeout(n),this._changeState(2),this._okGreeting=this._humanReadable,this.updateCapability().then((()=>e(this._capability)))},this.client.onerror=e=>{clearTimeout(n),t(e)}})).catch(t)}))}async logout(){this._changeState(5),this.logger.debug("Logging out..."),await this.client.logout(),clearTimeout(this._idleTimeout)}async close(e){this._changeState(5),clearTimeout(this._idleTimeout),this.logger.debug("Closing connection..."),await this.client.close(e),clearTimeout(this._idleTimeout)}async updateId(e){if(this._capability.indexOf("ID")<0)return;this.logger.debug("Updating id...");const t=e?[g(Object.entries(e))]:[null],n=await this.exec({command:"ID",attributes:t},"ID"),i=g(l([],["payload","ID","0","attributes","0"],n).map(Object.values)),a=i.filter(((e,t)=>t%2==0)),s=i.filter(((e,t)=>t%2==1));this.serverId=m(w(a,s)),this.logger.debug("Server id updated!",this.serverId)}_shouldSelectMailbox(e,t){if(!t)return!0;const n=this.client.getPreviouslyQueued(["SELECT","EXAMINE"],t);if(n&&n.request.attributes){const t=n.request.attributes.find((e=>"STRING"===e.type));if(t)return t.value!==e}return this._selectedMailbox!==e}async selectMailbox(e,t={}){const n={command:t.readOnly?"EXAMINE":"SELECT",attributes:[{type:"STRING",value:e}]};t.condstore&&this._capability.indexOf("CONDSTORE")>=0&&n.attributes.push([{type:"ATOM",value:"CONDSTORE"}]),this.logger.debug("Opening",e,"...");const i=function(e){if(!e||!e.payload)return;const t={readOnly:"READ-ONLY"===e.code},n=e.payload.EXISTS&&e.payload.EXISTS.pop(),i=e.payload.FLAGS&&e.payload.FLAGS.pop(),a=e.payload.OK;return n&&(t.exists=n.nr||0),i&&i.attributes&&i.attributes.length&&(t.flags=i.attributes[0].map((e=>(e.value||"").toString().trim()))),[].concat(a||[]).forEach((e=>{switch(e&&e.code){case"PERMANENTFLAGS":t.permanentFlags=[].concat(e.permanentflags||[]);break;case"UIDVALIDITY":t.uidValidity=Number(e.uidvalidity)||0;break;case"UIDNEXT":t.uidNext=Number(e.uidnext)||0;break;case"HIGHESTMODSEQ":t.highestModseq=e.highestmodseq||"0";break;case"NOMODSEQ":t.noModseq=!0}})),t}(await this.exec(n,["EXISTS","FLAGS","OK"],{ctx:t.ctx}));return this._changeState(4),this._selectedMailbox!==e&&this.onclosemailbox&&await this.onclosemailbox(this._selectedMailbox),this._selectedMailbox=e,this.onselectmailbox&&await this.onselectmailbox(e,i),i}async subscribeMailbox(e){return this.logger.debug("Subscribing to mailbox",e,"..."),this.exec({command:"SUBSCRIBE",attributes:[e]})}async unsubscribeMailbox(e){return this.logger.debug("Unsubscribing to mailbox",e,"..."),this.exec({command:"UNSUBSCRIBE",attributes:[e]})}async listNamespaces(){if(this._capability.indexOf("NAMESPACE")<0)return!1;this.logger.debug("Listing namespaces...");return function(e){if(!e.payload||!e.payload.NAMESPACE||!e.payload.NAMESPACE.length)return!1;const t=[].concat(e.payload.NAMESPACE.pop().attributes||[]);return!!t.length&&{personal:Ue(t[0]),users:Ue(t[1]),shared:Ue(t[2])}}(await this.exec("NAMESPACE","NAMESPACE"))}async listMailboxes(){const e={root:!0,children:[]};this.logger.debug("Listing mailboxes...");const t=await this.exec({command:"LIST",attributes:["","*"]},"LIST");let n;if(l([],["payload","LIST"],t).forEach((t=>{const n=d([],"attributes",t);if(n.length<3)return;const i=l("",["2","value"],n),a=l("/",["1","value"],n),s=this._ensurePath(e,i,a);s.flags=d([],"0",n).map((({value:e})=>e||"")),s.listed=!0,Et(s)})),this._capability.indexOf("LIST-EXTENDED")>-1){const e=await this.exec({command:"LIST (SUBSCRIBED)",attributes:["","*"]},"LIST");n=l([],["payload","LIST"],e)}else{const e=await this.exec({command:"LSUB",attributes:["","*"]},"LSUB");n=l([],["payload","LSUB"],e)}return n.forEach((t=>{const n=d([],"attributes",t);if(n.length<3)return;const i=l("",["2","value"],n),a=l("/",["1","value"],n),s=this._ensurePath(e,i,a);d([],"0",n).map(((e="")=>{s.flags=ee(s.flags,[e])})),s.subscribed=!0})),e}async createMailbox(e){this.logger.debug("Creating mailbox",e,"...");try{await this.exec({command:"CREATE",attributes:[e]})}catch(e){if(e&&"ALREADYEXISTS"===e.code)return;throw e}}deleteMailbox(e){return this.logger.debug("Deleting mailbox",e,"..."),this.exec({command:"DELETE",attributes:[e]})}async listMessages(e,t,n=[{fast:!0}],i={}){this.logger.debug("Fetching messages",t,"from",e,"...");const a=function(e,t,n){const i={command:n.byUid?"UID FETCH":"FETCH",attributes:[{type:"SEQUENCE",value:e}]};void 0!==n.valueAsString&&(i.valueAsString=n.valueAsString);let a=[];return t.forEach((e=>{if(e=e.toUpperCase().trim(),/^\w+$/.test(e))a.push({type:"ATOM",value:e});else if(e)try{const t=We(Ye("* Z "+e));a=a.concat(t.attributes||[])}catch(t){a.push({type:"ATOM",value:e})}})),1===a.length&&(a=a.pop()),i.attributes.push(a),n.changedSince&&i.attributes.push([{type:"ATOM",value:"CHANGEDSINCE"},{type:"ATOM",value:n.changedSince}]),i}(t,n,i);return $e(await this.exec(a,"FETCH",{precheck:t=>this._shouldSelectMailbox(e,t)?this.selectMailbox(e,{ctx:t}):Promise.resolve()}))}async search(e,t,n={}){this.logger.debug("Searching in",e,"...");const i=function(e={},t={}){const n={command:t.byUid?"UID SEARCH":"SEARCH"};let i=!0;const a=e=>{let t=[];return Object.keys(e).forEach((n=>{let s=[];const r=e=>{return"number"==typeof e?{type:"number",value:e}:"string"==typeof e?/[\u0080-\uFFFF]/.test(e)?(i=!1,{type:"literal",value:Xe((0,Ce.cv)(e))}):{type:"string",value:e}:"[object Date]"===Object.prototype.toString.call(e)?{type:"atom",value:(t=e,t.toUTCString().replace(/^\w+, 0?(\d+) (\w+) (\d+).*/,"$1-$2-$3"))}:Array.isArray(e)?e.map(r):"object"==typeof e?a(e):void 0;var t};s.push({type:"atom",value:n.toUpperCase()}),[].concat(e[n]||[]).forEach((e=>{switch(n.toLowerCase()){case"uid":e={type:"sequence",value:e};break;case"x-gm-thrid":case"x-gm-msgid":e={type:"number",value:e};break;default:e=r(e)}e&&(s=s.concat(e||[]))})),t=t.concat(s||[])})),t};return n.attributes=a(e),i||(n.attributes.unshift({type:"atom",value:"UTF-8"}),n.attributes.unshift({type:"atom",value:"CHARSET"})),n}(t,n);return function(e){const t=[];if(!e)throw new Error("parseSEARCH can not parse undefined response");return e.payload&&e.payload.SEARCH&&e.payload.SEARCH.length?(e.payload.SEARCH.forEach((e=>(e.attributes||[]).forEach((e=>{e=Number(e&&e.value||e)||0;const n=function(e,t,n=((e,t)=>e-t)){for(var i,a,s=0,r=e.length-1;s<=r;)if((a=+n(e[i=s+(r-s>>1)],t))<0)s=i+1;else{if(!(a>0))return i;r=i-1}return~s}(t,e);n<0&&t.splice(-n-1,0,e)})))),t):t}(await this.exec(i,"SEARCH",{precheck:t=>this._shouldSelectMailbox(e,t)?this.selectMailbox(e,{ctx:t}):Promise.resolve()}))}setFlags(e,t,n,i){let a="",s=[];return Array.isArray(n)||"object"!=typeof n?(s=[].concat(n||[]),a=""):n.add?(s=[].concat(n.add||[]),a="+"):n.set?(a="",s=[].concat(n.set||[])):n.remove&&(a="-",s=[].concat(n.remove||[])),this.logger.debug("Setting flags on",t,"in",e,"..."),this.store(e,t,a+"FLAGS",s,i)}async store(e,t,n,i,a={}){const s=function(e,t="",n=[],i={}){const a={command:i.byUid?"UID STORE":"STORE",attributes:[{type:"sequence",value:e}]};return a.attributes.push({type:"atom",value:t.toUpperCase()+(i.silent?".SILENT":"")}),a.attributes.push(n.map((e=>({type:"atom",value:e})))),a}(t,n,i,a);return $e(await this.exec(s,"FETCH",{precheck:t=>this._shouldSelectMailbox(e,t)?this.selectMailbox(e,{ctx:t}):Promise.resolve()}))}async upload(e,t,n={}){const i={command:"APPEND",attributes:[{type:"atom",value:e},d(["\\Seen"],"flags",n).map((e=>({type:"atom",value:e}))),{type:"literal",value:t}]};this.logger.debug("Uploading message to",e,"...");return function(e){return e&&e.appenduid&&e.appenduid[1]}(await this.exec(i))}async deleteMessages(e,t,n={}){this.logger.debug("Deleting messages",t,"in",e,"...");const i=n.byUid&&this._capability.indexOf("UIDPLUS")>=0,a={command:"UID EXPUNGE",attributes:[{type:"sequence",value:t}]};await this.setFlags(e,t,{add:"\\Deleted"},n);const s=i?a:"EXPUNGE";return this.exec(s,null,{precheck:t=>this._shouldSelectMailbox(e,t)?this.selectMailbox(e,{ctx:t}):Promise.resolve()})}async copyMessages(e,t,n,i={}){this.logger.debug("Copying messages",t,"from",e,"to",n,"...");return function(e){const t=e&&e.copyuid;if(t)return{srcSeqSet:t[1],destSeqSet:t[2]}}(await this.exec({command:i.byUid?"UID COPY":"COPY",attributes:[{type:"sequence",value:t},{type:"atom",value:n}]},null,{precheck:t=>this._shouldSelectMailbox(e,t)?this.selectMailbox(e,{ctx:t}):Promise.resolve()}))}async moveMessages(e,t,n,i={}){return this.logger.debug("Moving messages",t,"from",e,"to",n,"..."),-1===this._capability.indexOf("MOVE")?(await this.copyMessages(e,t,n,i),this.deleteMessages(e,t,i)):this.exec({command:i.byUid?"UID MOVE":"MOVE",attributes:[{type:"sequence",value:t},{type:"atom",value:n}]},["OK"],{precheck:t=>this._shouldSelectMailbox(e,t)?this.selectMailbox(e,{ctx:t}):Promise.resolve()})}async compressConnection(){if(!this._enableCompression||this._capability.indexOf("COMPRESS=DEFLATE")<0||this.client.compressed)return!1;this.logger.debug("Enabling compression..."),await this.exec({command:"COMPRESS",attributes:[{type:"ATOM",value:"DEFLATE"}]}),this.client.enableCompression(),this.logger.debug("Compression enabled, all data sent and received is deflated!")}async login(e){let t;const n={};if(!e)throw new Error("Authentication information not provided");this._capability.indexOf("AUTH=XOAUTH2")>=0&&e&&e.xoauth2?(t={command:"AUTHENTICATE",attributes:[{type:"ATOM",value:"XOAUTH2"},{type:"ATOM",value:Je(e.user,e.xoauth2),sensitive:!0}]},n.errorResponseExpectsEmptyLine=!0):t={command:"login",attributes:[{type:"STRING",value:e.user||""},{type:"STRING",value:e.pass||"",sensitive:!0}]},this.logger.debug("Logging in...");const i=await this.exec(t,"capability",n);i.capability&&i.capability.length?this._capability=i.capability:i.payload&&i.payload.CAPABILITY&&i.payload.CAPABILITY.length?this._capability=i.payload.CAPABILITY.pop().attributes.map(((e="")=>e.value.toUpperCase().trim())):await this.updateCapability(!0),this._changeState(3),this._authenticated=!0,this.logger.debug("Login successful, post-auth capabilites updated!",this._capability)}async exec(e,t,n){this.breakIdle();const i=await this.client.enqueueCommand(e,t,n);return i&&i.capability&&(this._capability=i.capability),i}enterIdle(){if(this._enteredIdle)return;const e=this._capability.indexOf("IDLE")>=0;this._enteredIdle=e&&this._selectedMailbox?"IDLE":"NOOP",this.logger.debug("Entering idle with "+this._enteredIdle),"NOOP"===this._enteredIdle?this._idleTimeout=setTimeout((()=>{this.logger.debug("Sending NOOP"),this.exec("NOOP")}),this.timeoutNoop):"IDLE"===this._enteredIdle&&(this.client.enqueueCommand({command:"IDLE"}),this._idleTimeout=setTimeout((()=>{this.client.send("DONE\r\n"),this._enteredIdle=!1,this.logger.debug("Idle terminated")}),this.timeoutIdle))}breakIdle(){this._enteredIdle&&(clearTimeout(this._idleTimeout),"IDLE"===this._enteredIdle&&(this.client.send("DONE\r\n"),this.logger.debug("Idle terminated")),this._enteredIdle=!1)}async upgradeConnection(){return!this.client.secureMode&&(!((this._capability.indexOf("STARTTLS")<0||this._ignoreTLS)&&!this._requireTLS)&&(this.logger.debug("Encrypting connection..."),await this.exec("STARTTLS"),this._capability=[],this.client.upgrade(),this.updateCapability()))}async updateCapability(e){if((e||!this._capability.length)&&(this.client.secureMode||!this._requireTLS))return this.logger.debug("Updating capability..."),this.exec("CAPABILITY")}hasCapability(e=""){return this._capability.indexOf(e.toUpperCase().trim())>=0}getOkGreeting(){return this._okGreeting}_untaggedOkHandler(e){e&&(e.capability&&(this._capability=e.capability),this._humanReadable=e.humanReadable)}_untaggedCapabilityHandler(e){this._capability=O(d([],"attributes"),de((({value:e})=>(e||"").toUpperCase().trim())))(e)}_untaggedExistsHandler(e){e&&Object.prototype.hasOwnProperty.call(e,"nr")&&this.onupdate&&this.onupdate(this._selectedMailbox,"exists",e.nr)}_untaggedExpungeHandler(e){e&&Object.prototype.hasOwnProperty.call(e,"nr")&&this.onupdate&&this.onupdate(this._selectedMailbox,"expunge",e.nr)}_untaggedFetchHandler(e){this.onupdate&&this.onupdate(this._selectedMailbox,"fetch",[].concat($e({payload:{FETCH:[e]}})||[]).shift())}_onIdle(){this._authenticated&&!this._enteredIdle&&(this.logger.debug("Client started idling"),this.enterIdle())}_changeState(e){e!==this._state&&(this.logger.debug("Entering state: "+e),4===this._state&&this._selectedMailbox&&(this.onclosemailbox&&this.onclosemailbox(this._selectedMailbox),this._selectedMailbox=!1),this._state=e)}_ensurePath(e,t,n){const i=t.split(n);let a=e;for(let e=0;e<i.length;e++){let t=!1;for(let n=0;n<a.children.length;n++)if(this._compareMailboxNames(a.children[n].name,(0,ue.kF)(i[e]))){a=a.children[n],t=!0;break}t||(a.children.push({name:(0,ue.kF)(i[e]),delimiter:n,path:i.slice(0,e+1).join(n),children:[]}),a=a.children[a.children.length-1])}return a}_compareMailboxNames(e,t){return("INBOX"===e.toUpperCase()?"INBOX":e)===("INBOX"===t.toUpperCase()?"INBOX":t)}createLogger(e=tt){const t=e((this._auth||{}).user||"",this._host);this.logger=this.client.logger={debug:(...e)=>{10>=this.logLevel&&t.debug(e)},info:(...e)=>{20>=this.logLevel&&t.info(e)},warn:(...e)=>{30>=this.logLevel&&t.warn(e)},error:(...e)=>{40>=this.logLevel&&t.error(e)}}}}},16932:(e,t,n)=>{"use strict";const i=n(78501),a=n(58844),s=n(41192);e.exports={XMLParser:a,XMLValidator:i,XMLBuilder:s}},17849:(e,t)=>{"use strict";const n=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",i="["+n+"][:A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*",a=new RegExp("^"+i+"$");t.isExist=function(e){return void 0!==e},t.isEmptyObject=function(e){return 0===Object.keys(e).length},t.merge=function(e,t,n){if(t){const i=Object.keys(t),a=i.length;for(let s=0;s<a;s++)e[i[s]]="strict"===n?[t[i[s]]]:t[i[s]]}},t.getValue=function(e){return t.isExist(e)?e:""},t.isName=function(e){const t=a.exec(e);return!(null==t)},t.getAllMatches=function(e,t){const n=[];let i=t.exec(e);for(;i;){const a=[];a.startIndex=t.lastIndex-i[0].length;const s=i.length;for(let e=0;e<s;e++)a.push(i[e]);n.push(a),i=t.exec(e)}return n},t.nameRegexp=i},78501:(e,t,n)=>{"use strict";const i=n(17849),a={allowBooleanAttributes:!1,unpairedTags:[]};function s(e){return" "===e||"\t"===e||"\n"===e||"\r"===e}function r(e,t){const n=t;for(;t<e.length;t++)if("?"!=e[t]&&" "!=e[t]);else{const i=e.substr(n,t-n);if(t>5&&"xml"===i)return h("InvalidXml","XML declaration allowed only at the start of the document.",p(e,t));if("?"==e[t]&&">"==e[t+1]){t++;break}}return t}function o(e,t){if(e.length>t+5&&"-"===e[t+1]&&"-"===e[t+2]){for(t+=3;t<e.length;t++)if("-"===e[t]&&"-"===e[t+1]&&">"===e[t+2]){t+=2;break}}else if(e.length>t+8&&"D"===e[t+1]&&"O"===e[t+2]&&"C"===e[t+3]&&"T"===e[t+4]&&"Y"===e[t+5]&&"P"===e[t+6]&&"E"===e[t+7]){let n=1;for(t+=8;t<e.length;t++)if("<"===e[t])n++;else if(">"===e[t]&&(n--,0===n))break}else if(e.length>t+9&&"["===e[t+1]&&"C"===e[t+2]&&"D"===e[t+3]&&"A"===e[t+4]&&"T"===e[t+5]&&"A"===e[t+6]&&"["===e[t+7])for(t+=8;t<e.length;t++)if("]"===e[t]&&"]"===e[t+1]&&">"===e[t+2]){t+=2;break}return t}t.validate=function(e,t){t=Object.assign({},a,t);const n=[];let l=!1,f=!1;"\ufeff"===e[0]&&(e=e.substr(1));for(let a=0;a<e.length;a++)if("<"===e[a]&&"?"===e[a+1]){if(a+=2,a=r(e,a),a.err)return a}else{if("<"!==e[a]){if(s(e[a]))continue;return h("InvalidChar","char '"+e[a]+"' is not expected.",p(e,a))}{let m=a;if(a++,"!"===e[a]){a=o(e,a);continue}{let w=!1;"/"===e[a]&&(w=!0,a++);let _="";for(;a<e.length&&">"!==e[a]&&" "!==e[a]&&"\t"!==e[a]&&"\n"!==e[a]&&"\r"!==e[a];a++)_+=e[a];if(_=_.trim(),"/"===_[_.length-1]&&(_=_.substring(0,_.length-1),a--),g=_,!i.isName(g)){let t;return t=0===_.trim().length?"Invalid space after '<'.":"Tag '"+_+"' is an invalid name.",h("InvalidTag",t,p(e,a))}const b=c(e,a);if(!1===b)return h("InvalidAttr","Attributes for '"+_+"' have open quote.",p(e,a));let y=b.value;if(a=b.index,"/"===y[y.length-1]){const n=a-y.length;y=y.substring(0,y.length-1);const i=d(y,t);if(!0!==i)return h(i.err.code,i.err.msg,p(e,n+i.err.line));l=!0}else if(w){if(!b.tagClosed)return h("InvalidTag","Closing tag '"+_+"' doesn't have proper closing.",p(e,a));if(y.trim().length>0)return h("InvalidTag","Closing tag '"+_+"' can't have attributes or invalid starting.",p(e,m));{const t=n.pop();if(_!==t.tagName){let n=p(e,t.tagStartPos);return h("InvalidTag","Expected closing tag '"+t.tagName+"' (opened in line "+n.line+", col "+n.col+") instead of closing tag '"+_+"'.",p(e,m))}0==n.length&&(f=!0)}}else{const i=d(y,t);if(!0!==i)return h(i.err.code,i.err.msg,p(e,a-y.length+i.err.line));if(!0===f)return h("InvalidXml","Multiple possible root nodes found.",p(e,a));-1!==t.unpairedTags.indexOf(_)||n.push({tagName:_,tagStartPos:m}),l=!0}for(a++;a<e.length;a++)if("<"===e[a]){if("!"===e[a+1]){a++,a=o(e,a);continue}if("?"!==e[a+1])break;if(a=r(e,++a),a.err)return a}else if("&"===e[a]){const t=u(e,a);if(-1==t)return h("InvalidChar","char '&' is not expected.",p(e,a));a=t}else if(!0===f&&!s(e[a]))return h("InvalidXml","Extra text at the end",p(e,a));"<"===e[a]&&a--}}}var g;return l?1==n.length?h("InvalidTag","Unclosed tag '"+n[0].tagName+"'.",p(e,n[0].tagStartPos)):!(n.length>0)||h("InvalidXml","Invalid '"+JSON.stringify(n.map((e=>e.tagName)),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1}):h("InvalidXml","Start tag expected.",1)};function c(e,t){let n="",i="",a=!1;for(;t<e.length;t++){if('"'===e[t]||"'"===e[t])""===i?i=e[t]:i!==e[t]||(i="");else if(">"===e[t]&&""===i){a=!0;break}n+=e[t]}return""===i&&{value:n,index:t,tagClosed:a}}const l=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function d(e,t){const n=i.getAllMatches(e,l),a={};for(let e=0;e<n.length;e++){if(0===n[e][1].length)return h("InvalidAttr","Attribute '"+n[e][2]+"' has no space in starting.",g(n[e]));if(void 0!==n[e][3]&&void 0===n[e][4])return h("InvalidAttr","Attribute '"+n[e][2]+"' is without value.",g(n[e]));if(void 0===n[e][3]&&!t.allowBooleanAttributes)return h("InvalidAttr","boolean attribute '"+n[e][2]+"' is not allowed.",g(n[e]));const i=n[e][2];if(!f(i))return h("InvalidAttr","Attribute '"+i+"' is an invalid name.",g(n[e]));if(a.hasOwnProperty(i))return h("InvalidAttr","Attribute '"+i+"' is repeated.",g(n[e]));a[i]=1}return!0}function u(e,t){if(";"===e[++t])return-1;if("#"===e[t])return function(e,t){let n=/\d/;for("x"===e[t]&&(t++,n=/[\da-fA-F]/);t<e.length;t++){if(";"===e[t])return t;if(!e[t].match(n))break}return-1}(e,++t);let n=0;for(;t<e.length;t++,n++)if(!(e[t].match(/\w/)&&n<20)){if(";"===e[t])break;return-1}return t}function h(e,t,n){return{err:{code:e,msg:t,line:n.line||n,col:n.col}}}function f(e){return i.isName(e)}function p(e,t){const n=e.substring(0,t).split(/\r?\n/);return{line:n.length,col:n[n.length-1].length+1}}function g(e){return e.startIndex+e[1].length}},41192:(e,t,n)=>{"use strict";const i=n(82592),a={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function s(e){this.options=Object.assign({},a,e),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=c),this.processTextOrObjNode=r,this.options.format?(this.indentate=o,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}function r(e,t,n){const i=this.j2x(e,n+1);return void 0!==e[this.options.textNodeName]&&1===Object.keys(e).length?this.buildTextValNode(e[this.options.textNodeName],t,i.attrStr,n):this.buildObjectNode(i.val,t,i.attrStr,n)}function o(e){return this.options.indentBy.repeat(e)}function c(e){return!(!e.startsWith(this.options.attributeNamePrefix)||e===this.options.textNodeName)&&e.substr(this.attrPrefixLen)}s.prototype.build=function(e){return this.options.preserveOrder?i(e,this.options):(Array.isArray(e)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(e={[this.options.arrayNodeName]:e}),this.j2x(e,0).val)},s.prototype.j2x=function(e,t){let n="",i="";for(let a in e)if(Object.prototype.hasOwnProperty.call(e,a))if(void 0===e[a])this.isAttribute(a)&&(i+="");else if(null===e[a])this.isAttribute(a)?i+="":"?"===a[0]?i+=this.indentate(t)+"<"+a+"?"+this.tagEndChar:i+=this.indentate(t)+"<"+a+"/"+this.tagEndChar;else if(e[a]instanceof Date)i+=this.buildTextValNode(e[a],a,"",t);else if("object"!=typeof e[a]){const s=this.isAttribute(a);if(s)n+=this.buildAttrPairStr(s,""+e[a]);else if(a===this.options.textNodeName){let t=this.options.tagValueProcessor(a,""+e[a]);i+=this.replaceEntitiesValue(t)}else i+=this.buildTextValNode(e[a],a,"",t)}else if(Array.isArray(e[a])){const n=e[a].length;let s="";for(let r=0;r<n;r++){const n=e[a][r];void 0===n||(null===n?"?"===a[0]?i+=this.indentate(t)+"<"+a+"?"+this.tagEndChar:i+=this.indentate(t)+"<"+a+"/"+this.tagEndChar:"object"==typeof n?this.options.oneListGroup?s+=this.j2x(n,t+1).val:s+=this.processTextOrObjNode(n,a,t):s+=this.buildTextValNode(n,a,"",t))}this.options.oneListGroup&&(s=this.buildObjectNode(s,a,"",t)),i+=s}else if(this.options.attributesGroupName&&a===this.options.attributesGroupName){const t=Object.keys(e[a]),i=t.length;for(let s=0;s<i;s++)n+=this.buildAttrPairStr(t[s],""+e[a][t[s]])}else i+=this.processTextOrObjNode(e[a],a,t);return{attrStr:n,val:i}},s.prototype.buildAttrPairStr=function(e,t){return t=this.options.attributeValueProcessor(e,""+t),t=this.replaceEntitiesValue(t),this.options.suppressBooleanAttributes&&"true"===t?" "+e:" "+e+'="'+t+'"'},s.prototype.buildObjectNode=function(e,t,n,i){if(""===e)return"?"===t[0]?this.indentate(i)+"<"+t+n+"?"+this.tagEndChar:this.indentate(i)+"<"+t+n+this.closeTag(t)+this.tagEndChar;{let a="</"+t+this.tagEndChar,s="";return"?"===t[0]&&(s="?",a=""),!n&&""!==n||-1!==e.indexOf("<")?!1!==this.options.commentPropName&&t===this.options.commentPropName&&0===s.length?this.indentate(i)+`\x3c!--${e}--\x3e`+this.newLine:this.indentate(i)+"<"+t+n+s+this.tagEndChar+e+this.indentate(i)+a:this.indentate(i)+"<"+t+n+s+">"+e+a}},s.prototype.closeTag=function(e){let t="";return-1!==this.options.unpairedTags.indexOf(e)?this.options.suppressUnpairedNode||(t="/"):t=this.options.suppressEmptyNode?"/":`></${e}`,t},s.prototype.buildTextValNode=function(e,t,n,i){if(!1!==this.options.cdataPropName&&t===this.options.cdataPropName)return this.indentate(i)+`<![CDATA[${e}]]>`+this.newLine;if(!1!==this.options.commentPropName&&t===this.options.commentPropName)return this.indentate(i)+`\x3c!--${e}--\x3e`+this.newLine;if("?"===t[0])return this.indentate(i)+"<"+t+n+"?"+this.tagEndChar;{let a=this.options.tagValueProcessor(t,e);return a=this.replaceEntitiesValue(a),""===a?this.indentate(i)+"<"+t+n+this.closeTag(t)+this.tagEndChar:this.indentate(i)+"<"+t+n+">"+a+"</"+t+this.tagEndChar}},s.prototype.replaceEntitiesValue=function(e){if(e&&e.length>0&&this.options.processEntities)for(let t=0;t<this.options.entities.length;t++){const n=this.options.entities[t];e=e.replace(n.regex,n.val)}return e},e.exports=s},82592:e=>{function t(e,r,o,c){let l="",d=!1;for(let u=0;u<e.length;u++){const h=e[u],f=n(h);if(void 0===f)continue;let p="";if(p=0===o.length?f:`${o}.${f}`,f===r.textNodeName){let e=h[f];a(p,r)||(e=r.tagValueProcessor(f,e),e=s(e,r)),d&&(l+=c),l+=e,d=!1;continue}if(f===r.cdataPropName){d&&(l+=c),l+=`<![CDATA[${h[f][0][r.textNodeName]}]]>`,d=!1;continue}if(f===r.commentPropName){l+=c+`\x3c!--${h[f][0][r.textNodeName]}--\x3e`,d=!0;continue}if("?"===f[0]){const e=i(h[":@"],r),t="?xml"===f?"":c;let n=h[f][0][r.textNodeName];n=0!==n.length?" "+n:"",l+=t+`<${f}${n}${e}?>`,d=!0;continue}let g=c;""!==g&&(g+=r.indentBy);const m=c+`<${f}${i(h[":@"],r)}`,w=t(h[f],r,p,g);-1!==r.unpairedTags.indexOf(f)?r.suppressUnpairedNode?l+=m+">":l+=m+"/>":w&&0!==w.length||!r.suppressEmptyNode?w&&w.endsWith(">")?l+=m+`>${w}${c}</${f}>`:(l+=m+">",w&&""!==c&&(w.includes("/>")||w.includes("</"))?l+=c+r.indentBy+w+c:l+=w,l+=`</${f}>`):l+=m+"/>",d=!0}return l}function n(e){const t=Object.keys(e);for(let n=0;n<t.length;n++){const i=t[n];if(e.hasOwnProperty(i)&&":@"!==i)return i}}function i(e,t){let n="";if(e&&!t.ignoreAttributes)for(let i in e){if(!e.hasOwnProperty(i))continue;let a=t.attributeValueProcessor(i,e[i]);a=s(a,t),!0===a&&t.suppressBooleanAttributes?n+=` ${i.substr(t.attributeNamePrefix.length)}`:n+=` ${i.substr(t.attributeNamePrefix.length)}="${a}"`}return n}function a(e,t){let n=(e=e.substr(0,e.length-t.textNodeName.length-1)).substr(e.lastIndexOf(".")+1);for(let i in t.stopNodes)if(t.stopNodes[i]===e||t.stopNodes[i]==="*."+n)return!0;return!1}function s(e,t){if(e&&e.length>0&&t.processEntities)for(let n=0;n<t.entities.length;n++){const i=t.entities[n];e=e.replace(i.regex,i.val)}return e}e.exports=function(e,n){let i="";return n.format&&n.indentBy.length>0&&(i="\n"),t(e,n,"",i)}},74780:(e,t,n)=>{const i=n(17849);function a(e,t){let n="";for(;t<e.length&&"'"!==e[t]&&'"'!==e[t];t++)n+=e[t];if(n=n.trim(),-1!==n.indexOf(" "))throw new Error("External entites are not supported");const i=e[t++];let a="";for(;t<e.length&&e[t]!==i;t++)a+=e[t];return[n,a,t]}function s(e,t){return"!"===e[t+1]&&"-"===e[t+2]&&"-"===e[t+3]}function r(e,t){return"!"===e[t+1]&&"E"===e[t+2]&&"N"===e[t+3]&&"T"===e[t+4]&&"I"===e[t+5]&&"T"===e[t+6]&&"Y"===e[t+7]}function o(e,t){return"!"===e[t+1]&&"E"===e[t+2]&&"L"===e[t+3]&&"E"===e[t+4]&&"M"===e[t+5]&&"E"===e[t+6]&&"N"===e[t+7]&&"T"===e[t+8]}function c(e,t){return"!"===e[t+1]&&"A"===e[t+2]&&"T"===e[t+3]&&"T"===e[t+4]&&"L"===e[t+5]&&"I"===e[t+6]&&"S"===e[t+7]&&"T"===e[t+8]}function l(e,t){return"!"===e[t+1]&&"N"===e[t+2]&&"O"===e[t+3]&&"T"===e[t+4]&&"A"===e[t+5]&&"T"===e[t+6]&&"I"===e[t+7]&&"O"===e[t+8]&&"N"===e[t+9]}function d(e){if(i.isName(e))return e;throw new Error(`Invalid entity name ${e}`)}e.exports=function(e,t){const n={};if("O"!==e[t+3]||"C"!==e[t+4]||"T"!==e[t+5]||"Y"!==e[t+6]||"P"!==e[t+7]||"E"!==e[t+8])throw new Error("Invalid Tag instead of DOCTYPE");{t+=9;let i=1,u=!1,h=!1,f="";for(;t<e.length;t++)if("<"!==e[t]||h)if(">"===e[t]){if(h?"-"===e[t-1]&&"-"===e[t-2]&&(h=!1,i--):i--,0===i)break}else"["===e[t]?u=!0:f+=e[t];else{if(u&&r(e,t))t+=7,[entityName,val,t]=a(e,t+1),-1===val.indexOf("&")&&(n[d(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(u&&o(e,t))t+=8;else if(u&&c(e,t))t+=8;else if(u&&l(e,t))t+=9;else{if(!s)throw new Error("Invalid DOCTYPE");h=!0}i++,f=""}if(0!==i)throw new Error("Unclosed DOCTYPE")}return{entities:n,i:t}}},66745:(e,t)=>{const n={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(e,t,n){return e}};t.buildOptions=function(e){return Object.assign({},n,e)},t.defaultOptions=n},81078:(e,t,n)=>{"use strict";const i=n(17849),a=n(36311),s=n(74780),r=n(14153);function o(e){const t=Object.keys(e);for(let n=0;n<t.length;n++){const i=t[n];this.lastEntities[i]={regex:new RegExp("&"+i+";","g"),val:e[i]}}}function c(e,t,n,i,a,s,r){if(void 0!==e&&(this.options.trimValues&&!i&&(e=e.trim()),e.length>0)){r||(e=this.replaceEntitiesValue(e));const i=this.options.tagValueProcessor(t,e,n,a,s);if(null==i)return e;if(typeof i!=typeof e||i!==e)return i;if(this.options.trimValues)return y(e,this.options.parseTagValue,this.options.numberParseOptions);return e.trim()===e?y(e,this.options.parseTagValue,this.options.numberParseOptions):e}}function l(e){if(this.options.removeNSPrefix){const t=e.split(":"),n="/"===e.charAt(0)?"/":"";if("xmlns"===t[0])return"";2===t.length&&(e=n+t[1])}return e}const d=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");function u(e,t,n){if(!this.options.ignoreAttributes&&"string"==typeof e){const n=i.getAllMatches(e,d),a=n.length,s={};for(let e=0;e<a;e++){const i=this.resolveNameSpace(n[e][1]);let a=n[e][4],r=this.options.attributeNamePrefix+i;if(i.length)if(this.options.transformAttributeName&&(r=this.options.transformAttributeName(r)),"__proto__"===r&&(r="#__proto__"),void 0!==a){this.options.trimValues&&(a=a.trim()),a=this.replaceEntitiesValue(a);const e=this.options.attributeValueProcessor(i,a,t);s[r]=null==e?a:typeof e!=typeof a||e!==a?e:y(a,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(s[r]=!0)}if(!Object.keys(s).length)return;if(this.options.attributesGroupName){const e={};return e[this.options.attributesGroupName]=s,e}return s}}const h=function(e){e=e.replace(/\r\n?/g,"\n");const t=new a("!xml");let n=t,i="",r="";for(let o=0;o<e.length;o++){if("<"===e[o])if("/"===e[o+1]){const t=w(e,">",o,"Closing Tag is not closed.");let a=e.substring(o+2,t).trim();if(this.options.removeNSPrefix){const e=a.indexOf(":");-1!==e&&(a=a.substr(e+1))}this.options.transformTagName&&(a=this.options.transformTagName(a)),n&&(i=this.saveTextToParentTag(i,n,r));const s=r.substring(r.lastIndexOf(".")+1);if(a&&-1!==this.options.unpairedTags.indexOf(a))throw new Error(`Unpaired tag can not be used as closing tag: </${a}>`);let c=0;s&&-1!==this.options.unpairedTags.indexOf(s)?(c=r.lastIndexOf(".",r.lastIndexOf(".")-1),this.tagsNodeStack.pop()):c=r.lastIndexOf("."),r=r.substring(0,c),n=this.tagsNodeStack.pop(),i="",o=t}else if("?"===e[o+1]){let t=_(e,o,!1,"?>");if(!t)throw new Error("Pi Tag is not closed.");if(i=this.saveTextToParentTag(i,n,r),this.options.ignoreDeclaration&&"?xml"===t.tagName||this.options.ignorePiTags);else{const e=new a(t.tagName);e.add(this.options.textNodeName,""),t.tagName!==t.tagExp&&t.attrExpPresent&&(e[":@"]=this.buildAttributesMap(t.tagExp,r,t.tagName)),this.addChild(n,e,r)}o=t.closeIndex+1}else if("!--"===e.substr(o+1,3)){const t=w(e,"--\x3e",o+4,"Comment is not closed.");if(this.options.commentPropName){const a=e.substring(o+4,t-2);i=this.saveTextToParentTag(i,n,r),n.add(this.options.commentPropName,[{[this.options.textNodeName]:a}])}o=t}else if("!D"===e.substr(o+1,2)){const t=s(e,o);this.docTypeEntities=t.entities,o=t.i}else if("!["===e.substr(o+1,2)){const t=w(e,"]]>",o,"CDATA is not closed.")-2,a=e.substring(o+9,t);i=this.saveTextToParentTag(i,n,r);let s=this.parseTextData(a,n.tagname,r,!0,!1,!0,!0);null==s&&(s=""),this.options.cdataPropName?n.add(this.options.cdataPropName,[{[this.options.textNodeName]:a}]):n.add(this.options.textNodeName,s),o=t+2}else{let s=_(e,o,this.options.removeNSPrefix),c=s.tagName;const l=s.rawTagName;let d=s.tagExp,u=s.attrExpPresent,h=s.closeIndex;this.options.transformTagName&&(c=this.options.transformTagName(c)),n&&i&&"!xml"!==n.tagname&&(i=this.saveTextToParentTag(i,n,r,!1));const f=n;if(f&&-1!==this.options.unpairedTags.indexOf(f.tagname)&&(n=this.tagsNodeStack.pop(),r=r.substring(0,r.lastIndexOf("."))),c!==t.tagname&&(r+=r?"."+c:c),this.isItStopNode(this.options.stopNodes,r,c)){let t="";if(d.length>0&&d.lastIndexOf("/")===d.length-1)o=s.closeIndex;else if(-1!==this.options.unpairedTags.indexOf(c))o=s.closeIndex;else{const n=this.readStopNodeData(e,l,h+1);if(!n)throw new Error(`Unexpected end of ${l}`);o=n.i,t=n.tagContent}const i=new a(c);c!==d&&u&&(i[":@"]=this.buildAttributesMap(d,r,c)),t&&(t=this.parseTextData(t,c,r,!0,u,!0,!0)),r=r.substr(0,r.lastIndexOf(".")),i.add(this.options.textNodeName,t),this.addChild(n,i,r)}else{if(d.length>0&&d.lastIndexOf("/")===d.length-1){"/"===c[c.length-1]?(c=c.substr(0,c.length-1),r=r.substr(0,r.length-1),d=c):d=d.substr(0,d.length-1),this.options.transformTagName&&(c=this.options.transformTagName(c));const e=new a(c);c!==d&&u&&(e[":@"]=this.buildAttributesMap(d,r,c)),this.addChild(n,e,r),r=r.substr(0,r.lastIndexOf("."))}else{const e=new a(c);this.tagsNodeStack.push(n),c!==d&&u&&(e[":@"]=this.buildAttributesMap(d,r,c)),this.addChild(n,e,r),n=e}i="",o=h}}else i+=e[o]}return t.child};function f(e,t,n){const i=this.options.updateTag(t.tagname,n,t[":@"]);!1===i||("string"==typeof i?(t.tagname=i,e.addChild(t)):e.addChild(t))}const p=function(e){if(this.options.processEntities){for(let t in this.docTypeEntities){const n=this.docTypeEntities[t];e=e.replace(n.regx,n.val)}for(let t in this.lastEntities){const n=this.lastEntities[t];e=e.replace(n.regex,n.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){const n=this.htmlEntities[t];e=e.replace(n.regex,n.val)}e=e.replace(this.ampEntity.regex,this.ampEntity.val)}return e};function g(e,t,n,i){return e&&(void 0===i&&(i=0===Object.keys(t.child).length),void 0!==(e=this.parseTextData(e,t.tagname,n,!1,!!t[":@"]&&0!==Object.keys(t[":@"]).length,i))&&""!==e&&t.add(this.options.textNodeName,e),e=""),e}function m(e,t,n){const i="*."+n;for(const n in e){const a=e[n];if(i===a||t===a)return!0}return!1}function w(e,t,n,i){const a=e.indexOf(t,n);if(-1===a)throw new Error(i);return a+t.length-1}function _(e,t,n,i=">"){const a=function(e,t,n=">"){let i,a="";for(let s=t;s<e.length;s++){let t=e[s];if(i)t===i&&(i="");else if('"'===t||"'"===t)i=t;else if(t===n[0]){if(!n[1])return{data:a,index:s};if(e[s+1]===n[1])return{data:a,index:s}}else"\t"===t&&(t=" ");a+=t}}(e,t+1,i);if(!a)return;let s=a.data;const r=a.index,o=s.search(/\s/);let c=s,l=!0;-1!==o&&(c=s.substring(0,o),s=s.substring(o+1).trimStart());const d=c;if(n){const e=c.indexOf(":");-1!==e&&(c=c.substr(e+1),l=c!==a.data.substr(e+1))}return{tagName:c,tagExp:s,closeIndex:r,attrExpPresent:l,rawTagName:d}}function b(e,t,n){const i=n;let a=1;for(;n<e.length;n++)if("<"===e[n])if("/"===e[n+1]){const s=w(e,">",n,`${t} is not closed`);if(e.substring(n+2,s).trim()===t&&(a--,0===a))return{tagContent:e.substring(i,n),i:s};n=s}else if("?"===e[n+1]){n=w(e,"?>",n+1,"StopNode is not closed.")}else if("!--"===e.substr(n+1,3)){n=w(e,"--\x3e",n+3,"StopNode is not closed.")}else if("!["===e.substr(n+1,2)){n=w(e,"]]>",n,"StopNode is not closed.")-2}else{const i=_(e,n,">");if(i){(i&&i.tagName)===t&&"/"!==i.tagExp[i.tagExp.length-1]&&a++,n=i.closeIndex}}}function y(e,t,n){if(t&&"string"==typeof e){const t=e.trim();return"true"===t||"false"!==t&&r(e,n)}return i.isExist(e)?e:""}e.exports=class{constructor(e){this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"}},this.addExternalEntities=o,this.parseXml=h,this.parseTextData=c,this.resolveNameSpace=l,this.buildAttributesMap=u,this.isItStopNode=m,this.replaceEntitiesValue=p,this.readStopNodeData=b,this.saveTextToParentTag=g,this.addChild=f}}},58844:(e,t,n)=>{const{buildOptions:i}=n(66745),a=n(81078),{prettify:s}=n(16997),r=n(78501);e.exports=class{constructor(e){this.externalEntities={},this.options=i(e)}parse(e,t){if("string"==typeof e);else{if(!e.toString)throw new Error("XML data is accepted in String or Bytes[] form.");e=e.toString()}if(t){!0===t&&(t={});const n=r.validate(e,t);if(!0!==n)throw Error(`${n.err.msg}:${n.err.line}:${n.err.col}`)}const n=new a(this.options);n.addExternalEntities(this.externalEntities);const i=n.parseXml(e);return this.options.preserveOrder||void 0===i?i:s(i,this.options)}addEntity(e,t){if(-1!==t.indexOf("&"))throw new Error("Entity value can't have '&'");if(-1!==e.indexOf("&")||-1!==e.indexOf(";"))throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if("&"===t)throw new Error("An entity with value '&' is not permitted");this.externalEntities[e]=t}}},16997:(e,t)=>{"use strict";function n(e,t,r){let o;const c={};for(let l=0;l<e.length;l++){const d=e[l],u=i(d);let h="";if(h=void 0===r?u:r+"."+u,u===t.textNodeName)void 0===o?o=d[u]:o+=""+d[u];else{if(void 0===u)continue;if(d[u]){let e=n(d[u],t,h);const i=s(e,t);d[":@"]?a(e,d[":@"],h,t):1!==Object.keys(e).length||void 0===e[t.textNodeName]||t.alwaysCreateTextNode?0===Object.keys(e).length&&(t.alwaysCreateTextNode?e[t.textNodeName]="":e=""):e=e[t.textNodeName],void 0!==c[u]&&c.hasOwnProperty(u)?(Array.isArray(c[u])||(c[u]=[c[u]]),c[u].push(e)):t.isArray(u,h,i)?c[u]=[e]:c[u]=e}}}return"string"==typeof o?o.length>0&&(c[t.textNodeName]=o):void 0!==o&&(c[t.textNodeName]=o),c}function i(e){const t=Object.keys(e);for(let e=0;e<t.length;e++){const n=t[e];if(":@"!==n)return n}}function a(e,t,n,i){if(t){const a=Object.keys(t),s=a.length;for(let r=0;r<s;r++){const s=a[r];i.isArray(s,n+"."+s,!0,!0)?e[s]=[t[s]]:e[s]=t[s]}}}function s(e,t){const{textNodeName:n}=t,i=Object.keys(e).length;return 0===i||!(1!==i||!e[n]&&"boolean"!=typeof e[n]&&0!==e[n])}t.prettify=function(e,t){return n(e,t)}},36311:e=>{"use strict";e.exports=class{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){"__proto__"===e&&(e="#__proto__"),this.child.push({[e]:t})}addChild(e){"__proto__"===e.tagname&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}}},72315:(e,t,n)=>{!function(t){"use strict";e.exports=t(n(9673).ZP,n(84846).Z)}((function(e,t){"use strict";let n;const i={debug:()=>{},info:()=>{},error:()=>{}};var a=function(t,a){var s=this;if(n=t.logger||i,s._loggedIn=!1,s._loggingIn=!1,s._shouldLogOut=!1,a)s._client=a;else{var r={useSecureTransport:t.secure,ignoreTLS:t.ignoreTLS,requireTLS:t.requireTLS,auth:t.auth,ca:t.ca,tlsWorkerPath:t.tlsWorkerPath,enableCompression:!0,compressionWorkerPath:t.compressionWorkerPath,id:t.id};s._client=new e(t.host,t.port,r)}s._client.oncert=function(e){s.onCert(e)},s.mailboxCache={},s._registerEventHandlers(s._client)};function s(e){return e.childNodes?e.childNodes.some((e=>s(e))):/^text\/html/i.test(e.type)}function r(e,t,n){if(e.size&&(t.size+=e.size),e.childNodes)e.childNodes.forEach((function(e){r(e,t,n)}));else{n&&e.id&&e.disposition?.startsWith("inline")||!e.disposition?.startsWith("attachment")&&/^text\/(plain|html)/i.test(e.type)||(t.attachment+=1)}}function o(e,t){return e-t}return a.prototype._registerEventHandlers=function(e){e.onselectmailbox=this._onSelectMailbox.bind(this,e),e.onupdate=this._onUpdate.bind(this,e),e.onerror=this._onError.bind(this,e)},a.prototype._onError=function(e,t){var i="IMAP connection encountered an error! "+t;e===this._client&&(this._loggedIn=!1,e.close(t),n.error((()=>[new Error(i)])),this.onError(new Error(i)))},a.prototype._onSelectMailbox=function(e,t,i){var a,s=this;if(s.onSyncUpdate){if(n.debug((()=>["selected mailbox "+t])),s.mailboxCache[t]||(n.debug((()=>["populating cache object for mailbox "+t])),s.mailboxCache[t]={exists:0,uidNext:0,uidlist:[],highestModseq:"0"}),(a=s.mailboxCache[t]).noModseq=i.noModseq||!1,a.exists!==i.exists||a.uidNext!==i.uidNext){n.debug((()=>["possible updates available in "+t+". exists: "+i.exists+", uidNext: "+i.uidNext]));var r=0===a.exists;return a.exists=i.exists,a.uidNext=i.uidNext,s.search({path:t,client:e}).then((function(c){a.uidlist=a.uidlist||[];var l=0;for(var d of c){if(d<l){n.debug((()=>["imapUidList not sorted"])),c.sort(o);break}l=d}var u=function(e,t){var n=0,i=0,a=[],s=[];for(;n<e.length&&i<t.length;)e[n]<t[i]?(a.push(e[n]),n++):e[n]>t[i]?(s.push(t[i]),i++):(n++,i++);n===e.length?s=s.concat(t.slice(i)):i===t.length&&(a=a.concat(e.slice(n)));return[a,s]}(a.uidlist,c),h=u[0],f=u[1];return a.uidlist=c,Promise.resolve().then((function(){if(h.length)return n.debug((()=>["onSyncUpdate for deleted uids in "+t+": "+h])),s.onSyncUpdate({type:"deleted",path:t,list:h})})).then((function(){if(f.length)return n.debug((()=>["onSyncUpdate for new uids in "+t+": "+f])),s.onSyncUpdate({type:"new",path:t,list:f})})).then((function(){if(!r)return n.debug((()=>["no changes in message count in "+t+". exists: "+i.exists+", uidNext: "+i.uidNext])),s._checkFlags({path:t,highestModseq:i.highestModseq,noModseq:i.noModseq,client:e}).catch((function(e){n.error((()=>["error checking modseq: "+e+"\n"+e.stack]))}))}))}))}return n.debug((()=>["no changes in message count in "+t+". exists: "+i.exists+", uidNext: "+i.uidNext])),s._checkFlags({path:t,highestModseq:i.highestModseq,noModseq:i.noModseq,client:e}).catch((function(e){n.error((()=>["error checking modseq: "+e+"\n"+e.stack]))}))}},a.prototype._onUpdate=function(e,t,i,a){var s=this,r=s.mailboxCache[t];if(s.onSyncUpdate&&r)if("expunge"===i){n.debug((()=>["expunge notice received for "+t+" with sequence number: "+a]));var c=r.uidlist[a-1];r.uidlist.splice(a-1,1),c&&(n.debug((()=>["deleted uid in "+t+": "+c])),s.onSyncUpdate({type:"deleted",path:t,list:[c]}))}else"exists"===i?(n.debug((()=>["exists notice received for "+t+", checking for updates"])),r.exists=a,s.search({path:t,uid:r.uidNext+":*",client:e}).then((function(e){!e.length||1===e.length&&r.uidlist.indexOf(e[0])>=0||(e.sort(o),n.debug((()=>["new uids in "+t+": "+e])),r.uidlist=r.uidlist.concat(e),r.uidNext=r.uidlist[r.uidlist.length-1]+1,n.debug((()=>["new uids in "+t+": "+e])),s.onSyncUpdate({type:"new",path:t,list:e}))})).catch((function(e){n.error((()=>["error handling exists notice: "+e+"\n"+e.stack]))}))):"fetch"===i&&(n.debug((()=>["fetch notice received for "+t])),s.onSyncUpdate({type:"messages",path:t,list:[a].map((function(e){return!e.uid&&r.uidlist&&(e.uid=r.uidlist[e["#"]-1]),e}))}))},a.prototype._checkFlags=function(e){var t=this,i=e.highestModseq,a=e.noModseq,s=e.client||t._client,r=e.path;if(a)return n.info((()=>["can not check MODSEQ, mailbox has NOMODSEQ directive"])),new Promise((function(e){e([])}));if(!s.hasCapability("CONDSTORE")||!i||!r)return n.info((()=>["can not check MODSEQ, server does not support CONDSTORE extension"])),new Promise((function(e){e([])}));var o=t.mailboxCache[r];if(!o||!o.highestModseq||o.highestModseq===i)return new Promise((function(e){e([])}));var c=o.uidNext>1?o.uidNext-1:1;return n.debug((()=>["listing changes since MODSEQ "+i+" for "+r])),s.listMessages(r,"1:"+c,["uid","flags","modseq"],{byUid:!0,changedSince:o.highestModseq}).then((function(e){return o.highestModseq=i,e&&e.length?(n.debug((()=>["changes since MODSEQ "+i+" for "+r+" available!"])),t.onSyncUpdate({type:"messages",path:r,list:e})):[]})).catch((function(e){n.error((()=>["error handling exists notice: "+e+"\n"+e.stack]))}))},a.prototype.onSyncUpdate=!1,a.prototype.login=function(){var e=this;return e._loggedIn||e._loggingIn?(n.debug((()=>["refusing login while logged/logging in!"])),Promise.resolve()):(e._loggingIn=!0,e._client.connect().then((function(){if(n.debug((()=>["login completed, ready to roll!"])),e._loggedIn=!0,e._shouldLogOut)return e.logout()})).finally((function(){e._loggingIn=!1})))},a.prototype.logout=function(){var e=this;return e._loggingIn?(n.debug((()=>["currently logging in, will log right back out!"])),e._shouldLogOut=!0,Promise.resolve()):e._loggedIn?(e._loggedIn=!1,e._shouldLogOut=!1,e._client.close().then((function(){n.debug((()=>["logout completed, kthxbye!"]))}))):(n.debug((()=>["refusing logout while already logged out!"])),Promise.resolve())},a.prototype.selectMailbox=function(e){return n.debug((()=>["selecting mailbox "+e.path])),this._client.selectMailbox(e.path)},a.prototype.subscribeMailbox=function(e){return n.debug((()=>["subscribing to mailbox "+e.path])),this._client.subscribeMailbox(e.path)},a.prototype.unsubscribeMailbox=function(e){return n.debug((()=>["unsubscribing to mailbox "+e.path])),this._client.unsubscribeMailbox(e.path)},a.prototype.listWellKnownFolders=function(){var e=this,t={Inbox:[],Drafts:[],All:[],Flagged:[],Sent:[],Trash:[],Junk:[],Archive:[],Other:[]};return n.debug((()=>["listing folders"])),e._checkOnline().then((function(){return e._client.listMailboxes()})).then((function(e){return n.debug((()=>["folder list received!"])),i(e),t})).catch((function(e){throw n.error((()=>["error listing folders: "+e+"\n"+e.stack])),e}));function i(a){if(a.path&&-1===(a.flags||[]).indexOf("\\Noselect")){n.debug((()=>["name: "+a.name+", path: "+a.path+(a.flags?", flags: "+a.flags:"")+(a.specialUse?", special use: "+a.specialUse:"")]));var s={name:a.name||a.path,path:a.path,subscribed:a.subscribed,delimiter:a.delimiter};"INBOX"===s.name.toUpperCase()?(s.type="Inbox",e._delimiter=a.delimiter,t.Inbox.push(s)):"\\Drafts"===a.specialUse?(s.type="Drafts",t.Drafts.push(s)):"\\All"===a.specialUse?(s.type="All",t.All.push(s)):"\\Flagged"===a.specialUse?(s.type="Flagged",t.Flagged.push(s)):"\\Sent"===a.specialUse?(s.type="Sent",t.Sent.push(s)):"\\Trash"===a.specialUse?(s.type="Trash",t.Trash.push(s)):"\\Junk"===a.specialUse?(s.type="Junk",t.Junk.push(s)):"\\Archive"===a.specialUse||["ARCHIVE","ARCHIVES"].some((e=>function(e){return e.path.split(e.delimiter).map((e=>e.toUpperCase()))}(a).includes(e)))?(s.type="Archive",t.Archive.push(s)):(s.type="Other",t.Other.push(s))}a.children&&a.children.forEach(i)}},a.prototype.deleteFolder=function(e){var t=this;return t._checkOnline().then((function(){return t._client.deleteMailbox(e.path)})).catch((function(t){throw n.error((()=>["error deleting folder"+e.path+": "+t+"\n"+t.stack])),t}))},a.prototype.createFolder=function(e){var t,i=this,a=e.path;return Array.isArray(a)||(a=[a]),i._checkOnline().then((function(){if(void 0===i._delimiter||void 0===i._prefix)return i._client.listNamespaces().then((function(e){return e&&e.personal&&e.personal[0]?(i._delimiter=e.personal[0].delimiter,void(i._prefix=e.personal[0].prefix.split(i._delimiter).shift())):(i._prefix="",i._delimiter?void 0:i._client.listMailboxes().then((function(e){s(e)})))}))})).then((function(){if(!i._delimiter)throw new Error("Could not determine delimiter for mailbox hierarchy");return i._prefix&&a.unshift(i._prefix),t=a.join(i._delimiter),i._client.createMailbox(t)})).then((function(){return t})).catch((function(t){throw n.error((()=>["error creating folder "+e.path+": "+t+"\n"+t.stack])),t}));function s(e){"INBOX"!==(e.path||"").toUpperCase()?e.children&&e.children.forEach(s):i._delimiter=e.delimiter}},a.prototype.search=function(e){var t=e.client||this._client,i={},a={byUid:!0};return i.all=!0,!0===e.unread?i.unseen=!0:!1===e.unread&&(i.seen=!0),!0===e.answered?i.answered=!0:!1===e.answered&&(i.unanswered=!0),e.header&&(i.header=e.header),e.uid&&(i.uid=e.uid),n.debug((()=>["searching in "+e.path+" for "+Object.keys(i).join(",")])),this._checkOnline().then((function(){return t.search(e.path,i,a)})).then((function(t){return n.debug((()=>["searched in "+e.path+" for "+Object.keys(i).join(",")+" ("+t.length+" uids)"])),t})).catch((function(t){throw n.error((()=>["error searching "+e.path+": "+t+"\n"+t.stack])),t}))},a.prototype.listMessages=function(e){var t,i=this,a=["uid","bodystructure","flags","envelope","body.peek[header.fields (references list-id x-microsoft-original-message-id from list-post)]"],o={byUid:!0};this._client.hasCapability("X-GM-EXT-1")&&a.push("x-gm-msgid"),t=e.uids?e.uids.join(","):(e.firstUid||1)+":"+(e.lastUid||"*");let c=i.mailboxCache[e.path];const l=c&&c.noModseq;return this._client.hasCapability("CONDSTORE")&&!l&&a.push("modseq"),n.debug((()=>["listing messages in "+e.path+" for interval "+t])),i._checkOnline().then((function(){return i._client.listMessages(e.path,t,a,o)})).then((function(e){var t=[];return e.forEach((function(e){if(!e.envelope||!e.uid)return void n.debug((()=>["message is malformed: "+JSON.stringify(e)]));var a=e["body[header.fields (references list-id x-microsoft-original-message-id from list-post)]"];a&&(a=a.replace(/\r?\n([ \t])/g,"$1"));var o=/References:\s*((?:<\S+>\s*)+)/.exec(a),c=/list-id *: *(.*(?:\r?\n[\t ].+)*)/i.exec(a),l=/list-post *: *(.*(?:\r?\n[\t ].+)*)/i.exec(a),d=/X-Microsoft-Original-Message-ID:\s*\S*\s<(\S+)>/.exec(a);const u=e.envelope.from||[];i._addFromHeaderAddresses(u,a);var h=Date.now(),f=Date.parse(e.envelope.date)||h;f>h&&(f=h);var p={uid:e.uid,messageId:(e.envelope["message-id"]||"").replace(/[<>]/g,"").trim(),originalMessageId:d?d[1]:"",listId:c?c[1]:"",listPost:l?l[1]:"",gmailId:e["x-gm-msgid"]||"",from:u,replyTo:e.envelope["reply-to"]||[],to:e.envelope.to||[],cc:e.envelope.cc||[],bcc:e.envelope.bcc||[],modseq:e.modseq||"0",subject:e.envelope.subject||"(no subject)",inReplyTo:(e.envelope["in-reply-to"]||"").replace(/[<>]/g,"").trim(),references:o?o[1].split(/\s+/).filter((function(e){return""!==e})).map((function(e){return e.replace(/[<>]/g,"")})):[],sentDate:f,flags:e.flags||[],attachment:0,size:0};const g=e.bodystructure||{};r(g,p,s(g)),n.debug((()=>["listing message: [uid: "+p.uid+"]"])),t.push(p)})),t})).catch((function(t){throw n.error((()=>["error listing messages in "+e.path+": "+t+"\n"+t.stack])),t}))},a.prototype.getMessages=function(e){var t=this,i=["body.peek[]"],a={byUid:!0,valueAsString:!1},s=e.uids.join(",");return n.debug((()=>["retrieving body parts for uid(s) "+s+" in folder "+e.path+": "+i])),t._checkOnline().then((function(){return t._client.listMessages(e.path,s,i,a)})).then((function(e){const t={};return e.forEach((function(e){t[e.uid]=e["body[]"]})),t})).catch((function(t){throw n.error((()=>["error fetching message for uid(s) "+s+" in folder "+e.path+": "+t+"\n"+t.stack])),t}))},a.prototype.updateFlags=function(e){const t=e.uids.sort(o);let i=t[0],a=[];function s(e){e===i?a.push(i):a.push(i+":"+e)}for(let e=1;e<t.length;e++)t[e]-t[e-1]!=1&&(s(t[e-1]),i=t[e]);s(t[t.length-1]);const r=a.join(",");var c=this,l={byUid:!0},d=e.add||[],u=e.remove||[];return n.debug((()=>["updating flags for uids "+r+" in folder "+e.path+": "+(u.length>0?" removing "+u:"")+(d.length>0?" adding "+d:"")])),c._checkOnline().then((function(){if(d.length>0)return c._client.setFlags(e.path,r,{add:d},l)})).then((function(){if(u.length>0)return c._client.setFlags(e.path,r,{remove:u},l)})).then((function(){n.debug((()=>["successfully updated flags for uids "+r+" in folder "+e.path+": added "+d+" and removed "+u]))})).catch((function(t){throw n.error((()=>["error updating flags for uids "+r+" in folder "+e.path+" : "+t+"\n"+t.stack])),t}))},a.prototype.copyMessages=function(e){var t=this;return n.debug((()=>["copying uids "+e.uids+" from "+e.path+" to "+e.destination])),t._checkOnline().then((function(){var n=e.uids.join(",");return t._client.copyMessages(e.path,n,e.destination,{byUid:!0})})).then((function(t){return n.debug((()=>["successfully copied uids "+e.uids+" from "+e.path+" to "+e.destination])),t})).catch((function(t){throw n.error((()=>["error copying uids "+e.uids+" from "+e.path+" to "+e.destination+" : "+t+"\n"+t.stack])),t}))},a.prototype.moveMessages=function(e){var t=this;return n.debug((()=>["moving uids "+e.uids+" from "+e.path+" to "+e.destination])),t._checkOnline().then((function(){var n=e.uids.join(",");return t._client.moveMessages(e.path,n,e.destination,{byUid:!0})})).then((function(){n.debug((()=>["successfully moved uids "+e.uids+" from "+e.path+" to "+e.destination]))})).catch((function(t){throw n.error((()=>["error moving uids "+e.uids+" from "+e.path+" to "+e.destination+" : "+t+"\n"+t.stack])),t}))},a.prototype.uploadMessage=function(e){var t=this,i=e.message instanceof Uint8Array?function(e){const t=10240,n=[];for(var i=0;i<e.length;i+=t){const a=i,s=Math.min(i+t,e.length);n.push(String.fromCharCode.apply(null,e.subarray(a,s)))}return n.join("")}(e.message):e.message,a=Array.isArray(e.flags)&&e.flags.length>0?{flags:e.flags}:{};return n.debug((()=>["uploading a message of "+i.length+" bytes to "+e.path])),t._checkOnline().then((function(){return t._client.upload(e.path,i,a)})).then((function(t){return n.debug((()=>["successfully uploaded message to "+e.path])),t})).catch((function(t){throw n.error((()=>["error uploading <"+i.length+"> bytes to "+e.path+" : "+t+"\n"+t.stack])),t}))},a.prototype.deleteMessages=function(e){var t=this;return n.debug((()=>["deleting uid "+e.uid+" from "+e.path])),t._checkOnline().then((function(){var n=e.uids.join(",");return t._client.deleteMessages(e.path,n,{byUid:!0})})).then((function(){n.debug((()=>["successfully deleted uid "+e.uid+" from "+e.path]))})).catch((function(t){throw n.error((()=>["error deleting uid "+e.uid+" from "+e.path+" : "+t+"\n"+t.stack])),t}))},a.prototype._addFromHeaderAddresses=function(e,n){if(n)for(const i of n.matchAll(/from\s*:\s*([^\n\r]+)/gi))if(i.length>1&&i[1]){const n=t(i[1])||[];for(const t of n){const n=e.find((e=>e.address===t.address));n?n.name||(n.name=t.name):e.push(t)}}},a.prototype._checkOnline=function(){var e=this;return new Promise((function(t){if(!e._loggedIn)throw new Error("Not logged in!");t()}))},a}))},24236:(e,t)=>{"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var a in n)i(n,a)&&(e[a]=n[a])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var a={arraySet:function(e,t,n,i,a){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+i),a);else for(var s=0;s<i;s++)e[a+s]=t[n+s]},flattenChunks:function(e){var t,n,i,a,s,r;for(i=0,t=0,n=e.length;t<n;t++)i+=e[t].length;for(r=new Uint8Array(i),a=0,t=0,n=e.length;t<n;t++)s=e[t],r.set(s,a),a+=s.length;return r}},s={arraySet:function(e,t,n,i,a){for(var s=0;s<i;s++)e[a+s]=t[n+s]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,a)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,s))},t.setTyped(n)},66069:e=>{"use strict";e.exports=function(e,t,n,i){for(var a=65535&e|0,s=e>>>16&65535|0,r=0;0!==n;){n-=r=n>2e3?2e3:n;do{s=s+(a=a+t[i++]|0)|0}while(--r);a%=65521,s%=65521}return a|s<<16|0}},71619:e=>{"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},2869:e=>{"use strict";var t=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();e.exports=function(e,n,i,a){var s=t,r=a+i;e^=-1;for(var o=a;o<r;o++)e=e>>>8^s[255&(e^n[o])];return-1^e}},30405:(e,t,n)=>{"use strict";var i,a=n(24236),s=n(10342),r=n(66069),o=n(2869),c=n(48898),l=-2,d=258,u=262,h=103,f=113,p=666;function g(e,t){return e.msg=c[t],t}function m(e){return(e<<1)-(e>4?9:0)}function w(e){for(var t=e.length;--t>=0;)e[t]=0}function _(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(a.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function b(e,t){s._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,_(e.strm)}function y(e,t){e.pending_buf[e.pending++]=t}function v(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function I(e,t){var n,i,a=e.max_chain_length,s=e.strstart,r=e.prev_length,o=e.nice_match,c=e.strstart>e.w_size-u?e.strstart-(e.w_size-u):0,l=e.window,h=e.w_mask,f=e.prev,p=e.strstart+d,g=l[s+r-1],m=l[s+r];e.prev_length>=e.good_match&&(a>>=2),o>e.lookahead&&(o=e.lookahead);do{if(l[(n=t)+r]===m&&l[n+r-1]===g&&l[n]===l[s]&&l[++n]===l[s+1]){s+=2,n++;do{}while(l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&s<p);if(i=d-(p-s),s=p-d,i>r){if(e.match_start=t,r=i,i>=o)break;g=l[s+r-1],m=l[s+r]}}}while((t=f[t&h])>c&&0!=--a);return r<=e.lookahead?r:e.lookahead}function k(e){var t,n,i,s,c,l,d,h,f,p,g=e.w_size;do{if(s=e.window_size-e.lookahead-e.strstart,e.strstart>=g+(g-u)){a.arraySet(e.window,e.window,g,g,0),e.match_start-=g,e.strstart-=g,e.block_start-=g,t=n=e.hash_size;do{i=e.head[--t],e.head[t]=i>=g?i-g:0}while(--n);t=n=g;do{i=e.prev[--t],e.prev[t]=i>=g?i-g:0}while(--n);s+=g}if(0===e.strm.avail_in)break;if(l=e.strm,d=e.window,h=e.strstart+e.lookahead,f=s,p=void 0,(p=l.avail_in)>f&&(p=f),n=0===p?0:(l.avail_in-=p,a.arraySet(d,l.input,l.next_in,p,h),1===l.state.wrap?l.adler=r(l.adler,d,p,h):2===l.state.wrap&&(l.adler=o(l.adler,d,p,h)),l.next_in+=p,l.total_in+=p,p),e.lookahead+=n,e.lookahead+e.insert>=3)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=(e.ins_h<<e.hash_shift^e.window[c+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[c+3-1])&e.hash_mask,e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<u&&0!==e.strm.avail_in)}function E(e,t){for(var n,i;;){if(e.lookahead<u){if(k(e),e.lookahead<u&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-u&&(e.match_length=I(e,n)),e.match_length>=3)if(i=s._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(b(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(b(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(b(e,!1),0===e.strm.avail_out)?1:2}function x(e,t){for(var n,i,a;;){if(e.lookahead<u){if(k(e),e.lookahead<u&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-u&&(e.match_length=I(e,n),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-3,i=s._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=a&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(b(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((i=s._tr_tally(e,0,e.window[e.strstart-1]))&&b(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=s._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(b(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(b(e,!1),0===e.strm.avail_out)?1:2}function A(e,t,n,i,a){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=a}function S(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new a.Buf16(1146),this.dyn_dtree=new a.Buf16(122),this.bl_tree=new a.Buf16(78),w(this.dyn_ltree),w(this.dyn_dtree),w(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new a.Buf16(16),this.heap=new a.Buf16(573),w(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new a.Buf16(573),w(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function M(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:f,e.adler=2===t.wrap?0:1,t.last_flush=0,s._tr_init(t),0):g(e,l)}function N(e){var t,n=M(e);return 0===n&&((t=e.state).window_size=2*t.w_size,w(t.head),t.max_lazy_match=i[t.level].max_lazy,t.good_match=i[t.level].good_length,t.nice_match=i[t.level].nice_length,t.max_chain_length=i[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),n}function O(e,t,n,i,s,r){if(!e)return l;var o=1;if(-1===t&&(t=6),i<0?(o=0,i=-i):i>15&&(o=2,i-=16),s<1||s>9||8!==n||i<8||i>15||t<0||t>9||r<0||r>4)return g(e,l);8===i&&(i=9);var c=new S;return e.state=c,c.strm=e,c.wrap=o,c.gzhead=null,c.w_bits=i,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=s+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+3-1)/3),c.window=new a.Buf8(2*c.w_size),c.head=new a.Buf16(c.hash_size),c.prev=new a.Buf16(c.w_size),c.lit_bufsize=1<<s+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new a.Buf8(c.pending_buf_size),c.d_buf=1*c.lit_bufsize,c.l_buf=3*c.lit_bufsize,c.level=t,c.strategy=r,c.method=n,N(e)}i=[new A(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(k(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+n;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,b(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-u&&(b(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(b(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(b(e,!1),e.strm.avail_out),1)})),new A(4,4,8,4,E),new A(4,5,16,8,E),new A(4,6,32,32,E),new A(4,4,16,16,x),new A(8,16,32,32,x),new A(8,16,128,128,x),new A(8,32,128,256,x),new A(32,128,258,1024,x),new A(32,258,258,4096,x)],t.Ue=O,t.Wt=function(e,t){var n,a,r,c;if(!e||!e.state||t>5||t<0)return e?g(e,l):l;if(a=e.state,!e.output||!e.input&&0!==e.avail_in||a.status===p&&4!==t)return g(e,0===e.avail_out?-5:l);if(a.strm=e,n=a.last_flush,a.last_flush=t,42===a.status)if(2===a.wrap)e.adler=0,y(a,31),y(a,139),y(a,8),a.gzhead?(y(a,(a.gzhead.text?1:0)+(a.gzhead.hcrc?2:0)+(a.gzhead.extra?4:0)+(a.gzhead.name?8:0)+(a.gzhead.comment?16:0)),y(a,255&a.gzhead.time),y(a,a.gzhead.time>>8&255),y(a,a.gzhead.time>>16&255),y(a,a.gzhead.time>>24&255),y(a,9===a.level?2:a.strategy>=2||a.level<2?4:0),y(a,255&a.gzhead.os),a.gzhead.extra&&a.gzhead.extra.length&&(y(a,255&a.gzhead.extra.length),y(a,a.gzhead.extra.length>>8&255)),a.gzhead.hcrc&&(e.adler=o(e.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=69):(y(a,0),y(a,0),y(a,0),y(a,0),y(a,0),y(a,9===a.level?2:a.strategy>=2||a.level<2?4:0),y(a,3),a.status=f);else{var u=8+(a.w_bits-8<<4)<<8;u|=(a.strategy>=2||a.level<2?0:a.level<6?1:6===a.level?2:3)<<6,0!==a.strstart&&(u|=32),u+=31-u%31,a.status=f,v(a,u),0!==a.strstart&&(v(a,e.adler>>>16),v(a,65535&e.adler)),e.adler=1}if(69===a.status)if(a.gzhead.extra){for(r=a.pending;a.gzindex<(65535&a.gzhead.extra.length)&&(a.pending!==a.pending_buf_size||(a.gzhead.hcrc&&a.pending>r&&(e.adler=o(e.adler,a.pending_buf,a.pending-r,r)),_(e),r=a.pending,a.pending!==a.pending_buf_size));)y(a,255&a.gzhead.extra[a.gzindex]),a.gzindex++;a.gzhead.hcrc&&a.pending>r&&(e.adler=o(e.adler,a.pending_buf,a.pending-r,r)),a.gzindex===a.gzhead.extra.length&&(a.gzindex=0,a.status=73)}else a.status=73;if(73===a.status)if(a.gzhead.name){r=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>r&&(e.adler=o(e.adler,a.pending_buf,a.pending-r,r)),_(e),r=a.pending,a.pending===a.pending_buf_size)){c=1;break}c=a.gzindex<a.gzhead.name.length?255&a.gzhead.name.charCodeAt(a.gzindex++):0,y(a,c)}while(0!==c);a.gzhead.hcrc&&a.pending>r&&(e.adler=o(e.adler,a.pending_buf,a.pending-r,r)),0===c&&(a.gzindex=0,a.status=91)}else a.status=91;if(91===a.status)if(a.gzhead.comment){r=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>r&&(e.adler=o(e.adler,a.pending_buf,a.pending-r,r)),_(e),r=a.pending,a.pending===a.pending_buf_size)){c=1;break}c=a.gzindex<a.gzhead.comment.length?255&a.gzhead.comment.charCodeAt(a.gzindex++):0,y(a,c)}while(0!==c);a.gzhead.hcrc&&a.pending>r&&(e.adler=o(e.adler,a.pending_buf,a.pending-r,r)),0===c&&(a.status=h)}else a.status=h;if(a.status===h&&(a.gzhead.hcrc?(a.pending+2>a.pending_buf_size&&_(e),a.pending+2<=a.pending_buf_size&&(y(a,255&e.adler),y(a,e.adler>>8&255),e.adler=0,a.status=f)):a.status=f),0!==a.pending){if(_(e),0===e.avail_out)return a.last_flush=-1,0}else if(0===e.avail_in&&m(t)<=m(n)&&4!==t)return g(e,-5);if(a.status===p&&0!==e.avail_in)return g(e,-5);if(0!==e.avail_in||0!==a.lookahead||0!==t&&a.status!==p){var I=2===a.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(k(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,n=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(b(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(b(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(b(e,!1),0===e.strm.avail_out)?1:2}(a,t):3===a.strategy?function(e,t){for(var n,i,a,r,o=e.window;;){if(e.lookahead<=d){if(k(e),e.lookahead<=d&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=o[a=e.strstart-1])===o[++a]&&i===o[++a]&&i===o[++a]){r=e.strstart+d;do{}while(i===o[++a]&&i===o[++a]&&i===o[++a]&&i===o[++a]&&i===o[++a]&&i===o[++a]&&i===o[++a]&&i===o[++a]&&a<r);e.match_length=d-(r-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=s._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(b(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(b(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(b(e,!1),0===e.strm.avail_out)?1:2}(a,t):i[a.level].func(a,t);if(3!==I&&4!==I||(a.status=p),1===I||3===I)return 0===e.avail_out&&(a.last_flush=-1),0;if(2===I&&(1===t?s._tr_align(a):5!==t&&(s._tr_stored_block(a,0,0,!1),3===t&&(w(a.head),0===a.lookahead&&(a.strstart=0,a.block_start=0,a.insert=0))),_(e),0===e.avail_out))return a.last_flush=-1,0}return 4!==t?0:a.wrap<=0?1:(2===a.wrap?(y(a,255&e.adler),y(a,e.adler>>8&255),y(a,e.adler>>16&255),y(a,e.adler>>24&255),y(a,255&e.total_in),y(a,e.total_in>>8&255),y(a,e.total_in>>16&255),y(a,e.total_in>>24&255)):(v(a,e.adler>>>16),v(a,65535&e.adler)),_(e),a.wrap>0&&(a.wrap=-a.wrap),0!==a.pending?0:1)}},94264:e=>{"use strict";e.exports=function(e,t){var n,i,a,s,r,o,c,l,d,u,h,f,p,g,m,w,_,b,y,v,I,k,E,x,A;n=e.state,i=e.next_in,x=e.input,a=i+(e.avail_in-5),s=e.next_out,A=e.output,r=s-(t-e.avail_out),o=s+(e.avail_out-257),c=n.dmax,l=n.wsize,d=n.whave,u=n.wnext,h=n.window,f=n.hold,p=n.bits,g=n.lencode,m=n.distcode,w=(1<<n.lenbits)-1,_=(1<<n.distbits)-1;e:do{p<15&&(f+=x[i++]<<p,p+=8,f+=x[i++]<<p,p+=8),b=g[f&w];t:for(;;){if(f>>>=y=b>>>24,p-=y,0===(y=b>>>16&255))A[s++]=65535&b;else{if(!(16&y)){if(0==(64&y)){b=g[(65535&b)+(f&(1<<y)-1)];continue t}if(32&y){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}v=65535&b,(y&=15)&&(p<y&&(f+=x[i++]<<p,p+=8),v+=f&(1<<y)-1,f>>>=y,p-=y),p<15&&(f+=x[i++]<<p,p+=8,f+=x[i++]<<p,p+=8),b=m[f&_];n:for(;;){if(f>>>=y=b>>>24,p-=y,!(16&(y=b>>>16&255))){if(0==(64&y)){b=m[(65535&b)+(f&(1<<y)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(I=65535&b,p<(y&=15)&&(f+=x[i++]<<p,(p+=8)<y&&(f+=x[i++]<<p,p+=8)),(I+=f&(1<<y)-1)>c){e.msg="invalid distance too far back",n.mode=30;break e}if(f>>>=y,p-=y,I>(y=s-r)){if((y=I-y)>d&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(k=0,E=h,0===u){if(k+=l-y,y<v){v-=y;do{A[s++]=h[k++]}while(--y);k=s-I,E=A}}else if(u<y){if(k+=l+u-y,(y-=u)<v){v-=y;do{A[s++]=h[k++]}while(--y);if(k=0,u<v){v-=y=u;do{A[s++]=h[k++]}while(--y);k=s-I,E=A}}}else if(k+=u-y,y<v){v-=y;do{A[s++]=h[k++]}while(--y);k=s-I,E=A}for(;v>2;)A[s++]=E[k++],A[s++]=E[k++],A[s++]=E[k++],v-=3;v&&(A[s++]=E[k++],v>1&&(A[s++]=E[k++]))}else{k=s-I;do{A[s++]=A[k++],A[s++]=A[k++],A[s++]=A[k++],v-=3}while(v>2);v&&(A[s++]=A[k++],v>1&&(A[s++]=A[k++]))}break}}break}}while(i<a&&s<o);i-=v=p>>3,f&=(1<<(p-=v<<3))-1,e.next_in=i,e.next_out=s,e.avail_in=i<a?a-i+5:5-(i-a),e.avail_out=s<o?o-s+257:257-(s-o),n.hold=f,n.bits=p}},27948:(e,t,n)=>{"use strict";var i=n(24236),a=n(66069),s=n(2869),r=n(94264),o=n(9241),c=-2,l=12,d=30;function u(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function h(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function f(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new i.Buf32(852),t.distcode=t.distdyn=new i.Buf32(592),t.sane=1,t.back=-1,0):c}function p(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,f(e)):c}function g(e,t){var n,i;return e&&e.state?(i=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?c:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,p(e))):c}function m(e,t){var n,i;return e?(i=new h,e.state=i,i.window=null,0!==(n=g(e,t))&&(e.state=null),n):c}var w,_,b=!0;function y(e){if(b){var t;for(w=new i.Buf32(512),_=new i.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(o(1,e.lens,0,288,w,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;o(2,e.lens,0,32,_,0,e.work,{bits:5}),b=!1}e.lencode=w,e.lenbits=9,e.distcode=_,e.distbits=5}function v(e,t,n,a){var s,r=e.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new i.Buf8(r.wsize)),a>=r.wsize?(i.arraySet(r.window,t,n-r.wsize,r.wsize,0),r.wnext=0,r.whave=r.wsize):((s=r.wsize-r.wnext)>a&&(s=a),i.arraySet(r.window,t,n-a,s,r.wnext),(a-=s)?(i.arraySet(r.window,t,n-a,a,0),r.wnext=a,r.whave=r.wsize):(r.wnext+=s,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=s))),0}t.Ul=m,t.rr=function(e,t){var n,h,f,p,g,m,w,_,b,I,k,E,x,A,S,M,N,O,T,Z,L,R,P,C,U=0,F=new i.Buf8(4),D=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return c;(n=e.state).mode===l&&(n.mode=13),g=e.next_out,f=e.output,w=e.avail_out,p=e.next_in,h=e.input,m=e.avail_in,_=n.hold,b=n.bits,I=m,k=w,R=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;b<16;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(2&n.wrap&&35615===_){n.check=0,F[0]=255&_,F[1]=_>>>8&255,n.check=s(n.check,F,2,0),_=0,b=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&_)<<8)+(_>>8))%31){e.msg="incorrect header check",n.mode=d;break}if(8!=(15&_)){e.msg="unknown compression method",n.mode=d;break}if(b-=4,L=8+(15&(_>>>=4)),0===n.wbits)n.wbits=L;else if(L>n.wbits){e.msg="invalid window size",n.mode=d;break}n.dmax=1<<L,e.adler=n.check=1,n.mode=512&_?10:l,_=0,b=0;break;case 2:for(;b<16;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(n.flags=_,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=d;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=d;break}n.head&&(n.head.text=_>>8&1),512&n.flags&&(F[0]=255&_,F[1]=_>>>8&255,n.check=s(n.check,F,2,0)),_=0,b=0,n.mode=3;case 3:for(;b<32;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}n.head&&(n.head.time=_),512&n.flags&&(F[0]=255&_,F[1]=_>>>8&255,F[2]=_>>>16&255,F[3]=_>>>24&255,n.check=s(n.check,F,4,0)),_=0,b=0,n.mode=4;case 4:for(;b<16;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}n.head&&(n.head.xflags=255&_,n.head.os=_>>8),512&n.flags&&(F[0]=255&_,F[1]=_>>>8&255,n.check=s(n.check,F,2,0)),_=0,b=0,n.mode=5;case 5:if(1024&n.flags){for(;b<16;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}n.length=_,n.head&&(n.head.extra_len=_),512&n.flags&&(F[0]=255&_,F[1]=_>>>8&255,n.check=s(n.check,F,2,0)),_=0,b=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((E=n.length)>m&&(E=m),E&&(n.head&&(L=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),i.arraySet(n.head.extra,h,p,E,L)),512&n.flags&&(n.check=s(n.check,h,E,p)),m-=E,p+=E,n.length-=E),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===m)break e;E=0;do{L=h[p+E++],n.head&&L&&n.length<65536&&(n.head.name+=String.fromCharCode(L))}while(L&&E<m);if(512&n.flags&&(n.check=s(n.check,h,E,p)),m-=E,p+=E,L)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===m)break e;E=0;do{L=h[p+E++],n.head&&L&&n.length<65536&&(n.head.comment+=String.fromCharCode(L))}while(L&&E<m);if(512&n.flags&&(n.check=s(n.check,h,E,p)),m-=E,p+=E,L)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;b<16;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(_!==(65535&n.check)){e.msg="header crc mismatch",n.mode=d;break}_=0,b=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=l;break;case 10:for(;b<32;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}e.adler=n.check=u(_),_=0,b=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=g,e.avail_out=w,e.next_in=p,e.avail_in=m,n.hold=_,n.bits=b,2;e.adler=n.check=1,n.mode=l;case l:if(5===t||6===t)break e;case 13:if(n.last){_>>>=7&b,b-=7&b,n.mode=27;break}for(;b<3;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}switch(n.last=1&_,b-=1,3&(_>>>=1)){case 0:n.mode=14;break;case 1:if(y(n),n.mode=20,6===t){_>>>=2,b-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=d}_>>>=2,b-=2;break;case 14:for(_>>>=7&b,b-=7&b;b<32;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if((65535&_)!=(_>>>16^65535)){e.msg="invalid stored block lengths",n.mode=d;break}if(n.length=65535&_,_=0,b=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(E=n.length){if(E>m&&(E=m),E>w&&(E=w),0===E)break e;i.arraySet(f,h,p,E,g),m-=E,p+=E,w-=E,g+=E,n.length-=E;break}n.mode=l;break;case 17:for(;b<14;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(n.nlen=257+(31&_),_>>>=5,b-=5,n.ndist=1+(31&_),_>>>=5,b-=5,n.ncode=4+(15&_),_>>>=4,b-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=d;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;b<3;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}n.lens[D[n.have++]]=7&_,_>>>=3,b-=3}for(;n.have<19;)n.lens[D[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,P={bits:n.lenbits},R=o(0,n.lens,0,19,n.lencode,0,n.work,P),n.lenbits=P.bits,R){e.msg="invalid code lengths set",n.mode=d;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;M=(U=n.lencode[_&(1<<n.lenbits)-1])>>>16&255,N=65535&U,!((S=U>>>24)<=b);){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(N<16)_>>>=S,b-=S,n.lens[n.have++]=N;else{if(16===N){for(C=S+2;b<C;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(_>>>=S,b-=S,0===n.have){e.msg="invalid bit length repeat",n.mode=d;break}L=n.lens[n.have-1],E=3+(3&_),_>>>=2,b-=2}else if(17===N){for(C=S+3;b<C;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}b-=S,L=0,E=3+(7&(_>>>=S)),_>>>=3,b-=3}else{for(C=S+7;b<C;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}b-=S,L=0,E=11+(127&(_>>>=S)),_>>>=7,b-=7}if(n.have+E>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=d;break}for(;E--;)n.lens[n.have++]=L}}if(n.mode===d)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=d;break}if(n.lenbits=9,P={bits:n.lenbits},R=o(1,n.lens,0,n.nlen,n.lencode,0,n.work,P),n.lenbits=P.bits,R){e.msg="invalid literal/lengths set",n.mode=d;break}if(n.distbits=6,n.distcode=n.distdyn,P={bits:n.distbits},R=o(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,P),n.distbits=P.bits,R){e.msg="invalid distances set",n.mode=d;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(m>=6&&w>=258){e.next_out=g,e.avail_out=w,e.next_in=p,e.avail_in=m,n.hold=_,n.bits=b,r(e,k),g=e.next_out,f=e.output,w=e.avail_out,p=e.next_in,h=e.input,m=e.avail_in,_=n.hold,b=n.bits,n.mode===l&&(n.back=-1);break}for(n.back=0;M=(U=n.lencode[_&(1<<n.lenbits)-1])>>>16&255,N=65535&U,!((S=U>>>24)<=b);){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(M&&0==(240&M)){for(O=S,T=M,Z=N;M=(U=n.lencode[Z+((_&(1<<O+T)-1)>>O)])>>>16&255,N=65535&U,!(O+(S=U>>>24)<=b);){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}_>>>=O,b-=O,n.back+=O}if(_>>>=S,b-=S,n.back+=S,n.length=N,0===M){n.mode=26;break}if(32&M){n.back=-1,n.mode=l;break}if(64&M){e.msg="invalid literal/length code",n.mode=d;break}n.extra=15&M,n.mode=22;case 22:if(n.extra){for(C=n.extra;b<C;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}n.length+=_&(1<<n.extra)-1,_>>>=n.extra,b-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;M=(U=n.distcode[_&(1<<n.distbits)-1])>>>16&255,N=65535&U,!((S=U>>>24)<=b);){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(0==(240&M)){for(O=S,T=M,Z=N;M=(U=n.distcode[Z+((_&(1<<O+T)-1)>>O)])>>>16&255,N=65535&U,!(O+(S=U>>>24)<=b);){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}_>>>=O,b-=O,n.back+=O}if(_>>>=S,b-=S,n.back+=S,64&M){e.msg="invalid distance code",n.mode=d;break}n.offset=N,n.extra=15&M,n.mode=24;case 24:if(n.extra){for(C=n.extra;b<C;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}n.offset+=_&(1<<n.extra)-1,_>>>=n.extra,b-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=d;break}n.mode=25;case 25:if(0===w)break e;if(E=k-w,n.offset>E){if((E=n.offset-E)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=d;break}E>n.wnext?(E-=n.wnext,x=n.wsize-E):x=n.wnext-E,E>n.length&&(E=n.length),A=n.window}else A=f,x=g-n.offset,E=n.length;E>w&&(E=w),w-=E,n.length-=E;do{f[g++]=A[x++]}while(--E);0===n.length&&(n.mode=21);break;case 26:if(0===w)break e;f[g++]=n.length,w--,n.mode=21;break;case 27:if(n.wrap){for(;b<32;){if(0===m)break e;m--,_|=h[p++]<<b,b+=8}if(k-=w,e.total_out+=k,n.total+=k,k&&(e.adler=n.check=n.flags?s(n.check,f,k,g-k):a(n.check,f,k,g-k)),k=w,(n.flags?_:u(_))!==n.check){e.msg="incorrect data check",n.mode=d;break}_=0,b=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;b<32;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(_!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=d;break}_=0,b=0}n.mode=29;case 29:R=1;break e;case d:R=-3;break e;case 31:return-4;default:return c}return e.next_out=g,e.avail_out=w,e.next_in=p,e.avail_in=m,n.hold=_,n.bits=b,(n.wsize||k!==e.avail_out&&n.mode<d&&(n.mode<27||4!==t))&&v(e,e.output,e.next_out,k-e.avail_out)?(n.mode=31,-4):(I-=e.avail_in,k-=e.avail_out,e.total_in+=I,e.total_out+=k,n.total+=k,n.wrap&&k&&(e.adler=n.check=n.flags?s(n.check,f,k,e.next_out-k):a(n.check,f,k,e.next_out-k)),e.data_type=n.bits+(n.last?64:0)+(n.mode===l?128:0)+(20===n.mode||15===n.mode?256:0),(0===I&&0===k||4===t)&&0===R&&(R=-5),R)}},9241:(e,t,n)=>{"use strict";var i=n(24236),a=15,s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],r=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,n,l,d,u,h,f){var p,g,m,w,_,b,y,v,I,k=f.bits,E=0,x=0,A=0,S=0,M=0,N=0,O=0,T=0,Z=0,L=0,R=null,P=0,C=new i.Buf16(16),U=new i.Buf16(16),F=null,D=0;for(E=0;E<=a;E++)C[E]=0;for(x=0;x<l;x++)C[t[n+x]]++;for(M=k,S=a;S>=1&&0===C[S];S--);if(M>S&&(M=S),0===S)return d[u++]=20971520,d[u++]=20971520,f.bits=1,0;for(A=1;A<S&&0===C[A];A++);for(M<A&&(M=A),T=1,E=1;E<=a;E++)if(T<<=1,(T-=C[E])<0)return-1;if(T>0&&(0===e||1!==S))return-1;for(U[1]=0,E=1;E<a;E++)U[E+1]=U[E]+C[E];for(x=0;x<l;x++)0!==t[n+x]&&(h[U[t[n+x]]++]=x);if(0===e?(R=F=h,b=19):1===e?(R=s,P-=257,F=r,D-=257,b=256):(R=o,F=c,b=-1),L=0,x=0,E=A,_=u,N=M,O=0,m=-1,w=(Z=1<<M)-1,1===e&&Z>852||2===e&&Z>592)return 1;for(;;){y=E-O,h[x]<b?(v=0,I=h[x]):h[x]>b?(v=F[D+h[x]],I=R[P+h[x]]):(v=96,I=0),p=1<<E-O,A=g=1<<N;do{d[_+(L>>O)+(g-=p)]=y<<24|v<<16|I|0}while(0!==g);for(p=1<<E-1;L&p;)p>>=1;if(0!==p?(L&=p-1,L+=p):L=0,x++,0==--C[E]){if(E===S)break;E=t[n+h[x]]}if(E>M&&(L&w)!==m){for(0===O&&(O=M),_+=A,T=1<<(N=E-O);N+O<S&&!((T-=C[N+O])<=0);)N++,T<<=1;if(Z+=1<<N,1===e&&Z>852||2===e&&Z>592)return 1;d[m=L&w]=M<<24|N<<16|_-u|0}}return 0!==L&&(d[_+L]=E-O<<24|64<<16|0),f.bits=M,0}},48898:e=>{"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},10342:(e,t,n)=>{"use strict";var i=n(24236);function a(e){for(var t=e.length;--t>=0;)e[t]=0}var s=256,r=286,o=30,c=15,l=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],d=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],h=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],f=new Array(576);a(f);var p=new Array(60);a(p);var g=new Array(512);a(g);var m=new Array(256);a(m);var w=new Array(29);a(w);var _,b,y,v=new Array(o);function I(e,t,n,i,a){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=a,this.has_stree=e&&e.length}function k(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function E(e){return e<256?g[e]:g[256+(e>>>7)]}function x(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function A(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,x(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function S(e,t,n){A(e,n[2*t],n[2*t+1])}function M(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function N(e,t,n){var i,a,s=new Array(16),r=0;for(i=1;i<=c;i++)s[i]=r=r+n[i-1]<<1;for(a=0;a<=t;a++){var o=e[2*a+1];0!==o&&(e[2*a]=M(s[o]++,o))}}function O(e){var t;for(t=0;t<r;t++)e.dyn_ltree[2*t]=0;for(t=0;t<o;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function T(e){e.bi_valid>8?x(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function Z(e,t,n,i){var a=2*t,s=2*n;return e[a]<e[s]||e[a]===e[s]&&i[t]<=i[n]}function L(e,t,n){for(var i=e.heap[n],a=n<<1;a<=e.heap_len&&(a<e.heap_len&&Z(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!Z(t,i,e.heap[a],e.depth));)e.heap[n]=e.heap[a],n=a,a<<=1;e.heap[n]=i}function R(e,t,n){var i,a,r,o,c=0;if(0!==e.last_lit)do{i=e.pending_buf[e.d_buf+2*c]<<8|e.pending_buf[e.d_buf+2*c+1],a=e.pending_buf[e.l_buf+c],c++,0===i?S(e,a,t):(S(e,(r=m[a])+s+1,t),0!==(o=l[r])&&A(e,a-=w[r],o),S(e,r=E(--i),n),0!==(o=d[r])&&A(e,i-=v[r],o))}while(c<e.last_lit);S(e,256,t)}function P(e,t){var n,i,a,s=t.dyn_tree,r=t.stat_desc.static_tree,o=t.stat_desc.has_stree,l=t.stat_desc.elems,d=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<l;n++)0!==s[2*n]?(e.heap[++e.heap_len]=d=n,e.depth[n]=0):s[2*n+1]=0;for(;e.heap_len<2;)s[2*(a=e.heap[++e.heap_len]=d<2?++d:0)]=1,e.depth[a]=0,e.opt_len--,o&&(e.static_len-=r[2*a+1]);for(t.max_code=d,n=e.heap_len>>1;n>=1;n--)L(e,s,n);a=l;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],L(e,s,1),i=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=i,s[2*a]=s[2*n]+s[2*i],e.depth[a]=(e.depth[n]>=e.depth[i]?e.depth[n]:e.depth[i])+1,s[2*n+1]=s[2*i+1]=a,e.heap[1]=a++,L(e,s,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,i,a,s,r,o,l=t.dyn_tree,d=t.max_code,u=t.stat_desc.static_tree,h=t.stat_desc.has_stree,f=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,g=t.stat_desc.max_length,m=0;for(s=0;s<=c;s++)e.bl_count[s]=0;for(l[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(s=l[2*l[2*(i=e.heap[n])+1]+1]+1)>g&&(s=g,m++),l[2*i+1]=s,i>d||(e.bl_count[s]++,r=0,i>=p&&(r=f[i-p]),o=l[2*i],e.opt_len+=o*(s+r),h&&(e.static_len+=o*(u[2*i+1]+r)));if(0!==m){do{for(s=g-1;0===e.bl_count[s];)s--;e.bl_count[s]--,e.bl_count[s+1]+=2,e.bl_count[g]--,m-=2}while(m>0);for(s=g;0!==s;s--)for(i=e.bl_count[s];0!==i;)(a=e.heap[--n])>d||(l[2*a+1]!==s&&(e.opt_len+=(s-l[2*a+1])*l[2*a],l[2*a+1]=s),i--)}}(e,t),N(s,d,e.bl_count)}function C(e,t,n){var i,a,s=-1,r=t[1],o=0,c=7,l=4;for(0===r&&(c=138,l=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)a=r,r=t[2*(i+1)+1],++o<c&&a===r||(o<l?e.bl_tree[2*a]+=o:0!==a?(a!==s&&e.bl_tree[2*a]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,s=a,0===r?(c=138,l=3):a===r?(c=6,l=3):(c=7,l=4))}function U(e,t,n){var i,a,s=-1,r=t[1],o=0,c=7,l=4;for(0===r&&(c=138,l=3),i=0;i<=n;i++)if(a=r,r=t[2*(i+1)+1],!(++o<c&&a===r)){if(o<l)do{S(e,a,e.bl_tree)}while(0!=--o);else 0!==a?(a!==s&&(S(e,a,e.bl_tree),o--),S(e,16,e.bl_tree),A(e,o-3,2)):o<=10?(S(e,17,e.bl_tree),A(e,o-3,3)):(S(e,18,e.bl_tree),A(e,o-11,7));o=0,s=a,0===r?(c=138,l=3):a===r?(c=6,l=3):(c=7,l=4)}}a(v);var F=!1;function D(e,t,n,a){A(e,0+(a?1:0),3),function(e,t,n,a){T(e),a&&(x(e,n),x(e,~n)),i.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n,!0)}t._tr_init=function(e){F||(!function(){var e,t,n,i,a,s=new Array(16);for(n=0,i=0;i<28;i++)for(w[i]=n,e=0;e<1<<l[i];e++)m[n++]=i;for(m[n-1]=i,a=0,i=0;i<16;i++)for(v[i]=a,e=0;e<1<<d[i];e++)g[a++]=i;for(a>>=7;i<o;i++)for(v[i]=a<<7,e=0;e<1<<d[i]-7;e++)g[256+a++]=i;for(t=0;t<=c;t++)s[t]=0;for(e=0;e<=143;)f[2*e+1]=8,e++,s[8]++;for(;e<=255;)f[2*e+1]=9,e++,s[9]++;for(;e<=279;)f[2*e+1]=7,e++,s[7]++;for(;e<=287;)f[2*e+1]=8,e++,s[8]++;for(N(f,287,s),e=0;e<o;e++)p[2*e+1]=5,p[2*e]=M(e,5);_=new I(f,l,257,r,c),b=new I(p,d,0,o,c),y=new I(new Array(0),u,0,19,7)}(),F=!0),e.l_desc=new k(e.dyn_ltree,_),e.d_desc=new k(e.dyn_dtree,b),e.bl_desc=new k(e.bl_tree,y),e.bi_buf=0,e.bi_valid=0,O(e)},t._tr_stored_block=D,t._tr_flush_block=function(e,t,n,i){var a,r,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<s;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),P(e,e.l_desc),P(e,e.d_desc),o=function(e){var t;for(C(e,e.dyn_ltree,e.l_desc.max_code),C(e,e.dyn_dtree,e.d_desc.max_code),P(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*h[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),a=e.opt_len+3+7>>>3,(r=e.static_len+3+7>>>3)<=a&&(a=r)):a=r=n+5,n+4<=a&&-1!==t?D(e,t,n,i):4===e.strategy||r===a?(A(e,2+(i?1:0),3),R(e,f,p)):(A(e,4+(i?1:0),3),function(e,t,n,i){var a;for(A(e,t-257,5),A(e,n-1,5),A(e,i-4,4),a=0;a<i;a++)A(e,e.bl_tree[2*h[a]+1],3);U(e,e.dyn_ltree,t-1),U(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),R(e,e.dyn_ltree,e.dyn_dtree)),O(e),i&&T(e)},t._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(m[n]+s+1)]++,e.dyn_dtree[2*E(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){A(e,2,3),S(e,256,f),function(e){16===e.bi_valid?(x(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},62292:e=>{"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},14153:e=>{const t=/^[-+]?0x[a-fA-F0-9]+$/,n=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const i={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};e.exports=function(e,a={}){if(a=Object.assign({},i,a),!e||"string"!=typeof e)return e;let s=e.trim();if(void 0!==a.skipLike&&a.skipLike.test(s))return e;if(a.hex&&t.test(s))return Number.parseInt(s,16);{const t=n.exec(s);if(t){const n=t[1],i=t[2];let r=function(e){if(e&&-1!==e.indexOf("."))return"."===(e=e.replace(/0+$/,""))?e="0":"."===e[0]?e="0"+e:"."===e[e.length-1]&&(e=e.substr(0,e.length-1)),e;return e}(t[3]);const o=t[4]||t[6];if(!a.leadingZeros&&i.length>0&&n&&"."!==s[2])return e;if(!a.leadingZeros&&i.length>0&&!n&&"."!==s[1])return e;{const t=Number(s),c=""+t;return-1!==c.search(/[eE]/)||o?a.eNotation?t:e:-1!==s.indexOf(".")?"0"===c&&""===r||c===r||n&&c==="-"+r?t:e:i?r===c||n+r===c?t:e:s===c||s===n+c?t:e}}return e}}}},n={};function i(e){var a=n[e];if(void 0!==a)return a.exports;var s=n[e]={id:e,loaded:!1,exports:{}};return t[e].call(s.exports,s,s.exports,i),s.loaded=!0,s.exports}i.m=t,e=[],i.O=(t,n,a,s)=>{if(!n){var r=1/0;for(d=0;d<e.length;d++){for(var[n,a,s]=e[d],o=!0,c=0;c<n.length;c++)(!1&s||r>=s)&&Object.keys(i.O).every((e=>i.O[e](n[c])))?n.splice(c--,1):(o=!1,s<r&&(r=s));if(o){e.splice(d--,1);var l=a();void 0!==l&&(t=l)}}return t}s=s||0;for(var d=e.length;d>0&&e[d-1][2]>s;d--)e[d]=e[d-1];e[d]=[n,a,s]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),i.j=670,(()=>{var e={670:0};i.O.j=t=>0===e[t];var t=(t,n)=>{var a,s,[r,o,c]=n,l=0;if(r.some((t=>0!==e[t]))){for(a in o)i.o(o,a)&&(i.m[a]=o[a]);if(c)var d=c(i)}for(t&&t(n);l<r.length;l++)s=r[l],i.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return i.O(d)},n=self.webpackChunkgapp_browser_react=self.webpackChunkgapp_browser_react||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var a=i.O(void 0,[739],(()=>i(338)));a=i.O(a)})();