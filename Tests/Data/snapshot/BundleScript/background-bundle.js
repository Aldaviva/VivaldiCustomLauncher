(()=>{var e,t={84936:(e,t,n)=>{"use strict";var i=n(29087),s=n(16716),a=n(38005);n(89907);self.jasmine;var r=n(39045),o=n(82227),c=n(90864),l=n(82786);var d=n(56371),u=n(78347),h=n(84321),f=n(47513),p=n.n(f),g=n(48868),m=n(21285),w=n(10048),_=n(71320),b=n(10671),y=n(68906),v=n(95095),I=n(97823),k=n(88212);const E={byIds:async function(e){await g.Z.buffer.bulkDelete(e)},byUids:async function(e,t,n){await g.Z.buffer.where("[accountId+path]").equals([e,t]).filter((e=>void 0!==e.uids)).modify((function(e){const t=new Set(e.uids);n.forEach((e=>{t.delete(e)})),0===t.size?delete this.value:e.uids=[...t]}))}};var x=n(55346),A=n(35489),S=n(24651),M=n(68247),O=n(7064),N=n(87155),Z=n(89175);function T(e,t){const n=i.Z.get(Z.kMailAccounts).slice(),s=n.findIndex((t=>t.MAIL_EMAIL===e));if(-1===s)throw new Error(`Account to be removed, ${e}, was not found in settings`);const a=n.splice(s,1);M.Z.set(Z.kMailAccounts,n);const r=a[0];t&&(O.Z.savedpasswords.delete(!0,(0,N.B)(r)),O.Z.savedpasswords.delete(!0,(0,N.Y)(r)))}var L=n(16888),R=n(99895),P=n(5863),C=n(1407),U=n(25051),F=n(16152),D=n(16504),z=n(61839);const B={call:async function(e,t){let n=[];const i=Date.now(),s=await g.Z.transaction("rw",m.E.concat([g.Z.pop,g.Z.filters]),(async()=>{const s=await h.Z.findMatchingSles(t),{newMessageGroups:a,duplicates:r}=h.Z.findDuplicates(s),o=[];for(const t of r){const{message:n,searchListEntry:s}=t,a={accountId:e,uidl:n.uidl||"",createdTimestamp:i,searchListId:s.id};o.push(a)}const c=a.map((e=>e[0])),l=await(0,m.Z)(e,P.Gf,P.e9,c),d=l.addedSles;return n=l.forSearchDb,d.forEach(((t,n)=>{a[n].forEach((n=>{o.push({accountId:e,uidl:n.uidl,createdTimestamp:i,searchListId:t.id})}))})),g.Z.pop.bulkPut(o),r.length>0&&await h.Z.addSourceFilters(e,P.Gf,P.e9,r,!1),d}));return(0,z.Z)(n),s}};var $=n(51501),j=n(75401),q=n(84283),V=n(89165),Q=n(95752),H=n(49168),K=n(34198);function W(e,t,n,i){return n.some((n=>0!==n.length&&n.every((n=>function(e,t,n,i){if(n.accountId||n.path||n.hasOwnProperty("folder")){const t=_.Z.getByIds(e.sourceFilterIds);let s;if(n.accountId?s=t.some((e=>e.accountId===n.accountId)):n.path&&(s=t.some((e=>e.path===n.path))),n.hasOwnProperty("folder"))if(n.folder===P.uT){const t=!1;s=q.Z.isMessageDeleted(e.sources,i,t)}else s=n.folder===P.Hd?(0,V.Z)(e.sources,e.flags):n.folder===P.hn?(0,j.Z)(e.sources):n.folder===P.Z3?!t.some((t=>{if(b.Z.getFolderType(t.accountId,t.path)===P.Nz){return e.sources.get(t.id)?.internal}return!1})):t.some((e=>{const t=b.Z.getFolderType(e.accountId,e.path);return n.folder&&n.folder===t}));if(!s)return!1}if(n.listId&&n.listId!==(0,K.P7)(t.listId))return!1;if(n.flag){let t;if((0,H.R7)(n.flag))if(n.flag===P.T4.DELETED)t=q.Z.isMessageDeleted(e.sources,i);else{if(n.flag!==P.T4.SEEN)throw new Error("Unhandled source flag "+n.flag);t=Q.Z.call(e.sources,i)}else t=e.flags.includes(n.flag);if(!t)return!1}if(n.senderIsMailingList&&(!e.from[0]||n.senderIsMailingList!==e.from[0].address))return!1;return!0}(e,t,n,i)))))}const G={searchAddresses:function(e,t){const n=t.map((e=>e.address)),i=e.address;return n.some((e=>e.toLowerCase()===i))},filterMessage:function(e,t,n){let i=!1;const{filterValue:s}=e,{include:a,exclude:r,attachments:o,sentDate:c,sentDateEnd:l}=s;if("number"==typeof o){if(0===o&&t.attachment>0)return!1;if(o>0&&0===t.attachment)return!1}if(c&&c>t.sentDate)return!1;if(l&&l<t.sentDate)return!1;if(r||a)if(r&&a){const s=W(t,n,r,e),o=W(t,n,a,e);!s&&o&&(i=!0)}else a?i=W(t,n,a,e):r&&(i=!W(t,n,r,e));else i=!0;return i}},Y={mergeFilteringQueueItems:function(e){const t=new Map,n=new Set;if(e.length<=1)return{updatedItems:t,deletedItemIds:n};let i,s,a=0;for(;a<e.length;){let r=1;if(i){const s=e[a],r=i.id;i=Y.mergeItems(i,s),i&&(i.id===r?n.add(s.id):(n.add(r),t.delete(r)),t.set(i.id,i))}if(!i&&a<e.length-1){if(s){const i=[e[a],e[a+1]],o=s.map((({id:e})=>e));if(s=Y.mergeItemPairs(s,i),s){for(let e=0;e<2;e++){const a=s[e],r=o[e],c=i[e];a.id===r?n.add(c.id):(n.add(r),t.delete(r)),t.set(a.id,a)}r=2}}if(!s){const o=e[a],c=e[a+1];if(i=Y.mergeItems(o,c),i){const e=i.id===o.id?c.id:o.id;n.add(e),t.set(i.id,i),r=2}else if(a<e.length-3){const i=[o,c],l=[e[a+2],e[a+3]];if(s=Y.mergeItemPairs(i,l),s){for(let e=0;e<2;e++){const a=s[e],r=i[e],o=l[e];n.add(a.id===r.id?o.id:r.id),t.set(a.id,a)}r=4}}}}a+=r}return{updatedItems:t,deletedItemIds:n}},mergeItems:function(e,t){if(e.priority!==t.priority)return;if("FILTERS_SLES"===e.type&&"FILTERS_SLES"===t.type)return Y.mergeFiltersSles(e,t);if("UPDATE_SLE"===e.type&&"UPDATE_SLE"===t.type)return Y.mergeUpdateSle(e,t)},mergeItemPairs:function(e,t){if(Y.numberArraysMatch(t[0].searchListIds||void 0,t[1].searchListIds||void 0)){const n=Y.mergeItems(e[0],t[0]);if(n){const i=Y.mergeItems(e[1],t[1]);if(i)return[n,i]}}},mergeFiltersSles:function(e,t){if(!Y.numberArraysMatch(e.filterIds,t.filterIds))return;if(!Y.folderIdsMatch(e.folderIds,t.folderIds))return;if(e.runAllMessages!==t.runAllMessages)return;if(e.runMailingLists!==t.runMailingLists)return;if(e.runCustomFolders!==t.runCustomFolders)return;if(e.runFlagFolders!==t.runFlagFolders)return;if(e.runLabels!==t.runLabels)return;if(e.runQueries!==t.runQueries)return;if(e.runSingleThread!==t.runSingleThread)return;const n=new Set([...e.searchListIds,...t.searchListIds]);return{...e,searchListIds:[...n]}},mergeUpdateSle:function(e,t){if(void 0!==e.currentSearchListId||void 0!==t.currentSearchListId)return;if(e.unread!==t.unread)return;if(e.unseen!==t.unseen)return;if(!Y.viewIdSetsMatch(e.removeViewIds,t.removeViewIds))return;if(!Y.sourcesMatch(e.sources,t.sources))return;if(e.reRunUpdated!==t.reRunUpdated)return;if(e.searchListIds&&t.searchListIds){const n=new Set([...e.searchListIds,...t.searchListIds]);return{...e,searchListIds:[...n]}}return t.searchListIds?{...e}:e.searchListIds?{...t}:{...e}},numberArraysMatch:function(e,t){return Y.arraysMatch(e,t,(function(e,t){const n=new Set(t);return!e.some((e=>!n.has(e)))}))},folderIdsMatch:function(e,t){return Y.arraysMatch(e,t,(function(e,t){return!e.some((e=>!t.find((t=>e[0]===t[0]&&e[1]===t[1]))))}))},viewIdSetsMatch:function(e,t){if(!e&&!t)return!0;if(!e||!t)return!1;if(e.size!==t.size)return!1;return![...e].some((e=>!t.has(e)))},sourcesMatch:function(e,t){if(!e&&!t)return!0;if(!e||!t)return!1;if(e.size!==t.size)return!1;return![...e.keys()].some((n=>{const i=e.get(n),s=t.get(n);if(!i&&!s)return!1;if(!i||!s)return!0;const a=Object.keys(i),r=Object.keys(s);if(a.length!==r.length)return!0;for(const e of a)if(i[e]!==s[e])return!0;return!1}))},arraysMatch:function(e,t,n){if(void 0===e&&void 0===t)return!0;if(void 0===e||void 0===t)return!1;if(e.length!==t.length)return!1;return n(e,t)}};const X=Y;var J=n(5204),ee=n(95538),te=n(81830),ne=n(51733);const ie=function(e,t){return[...e.entries()].some((([e,n])=>{if(n.deleted)return!1;const i=_.Z.get(e);if(!i)throw new Error("Source filter not found "+e);const{accountId:s,path:a}=i;return b.Z.getFolderType(s,a)===t}))},se={filter:le,filterUpdateSle:async function(e){const{priority:t,searchListIds:n,currentSearchListId:i=0,unread:s,unseen:a,sources:r,removeViewIds:o=new Set,batchSize:c=oe,reRunUpdated:l}=e,d=[],u=Date.now();let h,f;if(n){const e=n.splice(0,c);[h,f]=await g.Z.transaction("rw",[g.Z.searchList,g.Z.viewIds],(()=>Promise.all([g.Z.searchList.where("id").anyOf(e).toArray(),g.Z.viewIds.where("searchListId").anyOf(e).toArray()])))}else{if([h,f]=await g.Z.transaction("rw",[g.Z.searchList,g.Z.viewIds],(()=>Promise.all([g.Z.searchList.where("id").above(i).limit(c).toArray(),g.Z.viewIds.where("searchListId").above(i).limit(c).toArray()]))),0===h.length)return!0;e.currentSearchListId=h[h.length-1].id}const p=new Map(f.map((({searchListId:e,viewIds:t})=>[e,t])));for(const e of h){const t=new Set,n=new Set([...o]),{id:i}=e,c=p.get(i);if(!c)throw new Error("viewIds not found "+i);const l=new Set;if(c.forEach((e=>{const t=Math.floor(e/P.XN);l.add(t)})),l.forEach((i=>{if(void 0!==s){const e=i*P.XN+P.aD;s?t.add(e):n.add(e)}if(void 0!==a){const e=i*P.XN+P.ZC;a?t.add(e):n.add(e)}if(void 0!==r){const s=i*P.XN+P.IK,a=i*P.XN+P.aD;r.forEach(((r,o)=>{i===o?r?(void 0!==r.deleted&&(r.deleted?(0,V.Z)(e.sources,e.flags)||n.add(s):t.add(s)),void 0!==r.read&&(r.read?n.add(a):t.add(a))):$.Z.getAllViewTypes().forEach((e=>{n.add(i*P.XN+e)})):e.sources.has(i)||(q.Z.isMessageDeleted(e.sources)?n.add(s):t.add(s),Q.Z.call(e.sources)?n.add(a):t.add(a))}))}})),c.forEach((e=>{t.delete(e)})),[...n].forEach((e=>{c.includes(e)||n.delete(e)})),t.size>0||n.size>0){const e={id:i,updates:{}};t.size>0&&(e.updates.addedViewIds=[...t],t.forEach((e=>{c.push(e)}))),n.size>0&&(e.updates.removedViewIds=[...n],n.forEach((e=>{const t=c.indexOf(e);t>=0&&c.splice(t,1)}))),d.push(e)}else p.delete(i)}if(p.size>0&&(await g.Z.viewIds.where("searchListId").anyOf([...p.keys()]).modify((e=>{const t=p.get(e.searchListId);t&&(e.viewIds=t)})),l)){const e=[...p.keys()];await y.Z.call({type:"RE_RUN_SLES",priority:t,searchListIds:e})}d.length>0&&U.QO.updateIndex({sleUpdates:d});if(n&&0===n.length)return!0;{const t=Date.now();return e.batchSize=ce(c,t-u),!1}},filterSles:async function(e,t,n,i,s){const a=[],r=[],o=[],c=[],l=[],d=new Set,h=new Map,f=new Map,p=new Map,m=function(e){const t=new Set,n=[];for(const{accountId:i,path:s}of e)u.Z.isMailAccount(i)&&(s===P.ym?n.push(i):t.add(i));for(const e of n)t.delete(e);if(0===t.size)return[];const i=[...t].map((e=>[e,P.ym]));return _.Z.getByFolderIds(i)}(i),w=[...i,...m];for(let i=0;i<e.length;i++){const a=e[i],r=t[i],o=new Map;for(const e of w){if(G.filterMessage(e,a,r)){const{query:t}=e.filterValue;if(!n.get(a.id))throw new Error("viewIds not found in viewIdsBySleId for "+a.id);if(t&&!s?.skipQueries){const t=p.get(e);t?t.push(a):p.set(e,[a])}else o.set(e,!0)}else o.set(e,!1)}f.set(a,o)}if(p.size>0)for(const[e,t]of p){const{query:n}=e.filterValue;if(n){const i=await(0,te.Z)(n),s=new Set(i);for(const n of t){let t=f.get(n);t||(t=new Map,f.set(n,t)),s.has(n.id)?t.set(e,!0):t.set(e,!1)}}}for(const e of w){const t=$.Z.getViewIdsByFilterId(e.id);for(const e of t)d.add(e)}for(let i=0;i<e.length;i++){const u=e[i],p=t[i],g=f.get(u);if(!g)continue;const m=se.getMatchResults(u,p,g,s?.triggerFilterIdCandidates),{id:w}=u,{addedViewIds:_,removedViewIds:b,runTriggerFilterIds:y,isOnMailingList:v}=m,I=n.get(w);if(!I)throw new Error("viewIds not found in viewIdsBySleId for "+w);if(v){[...I,..._].filter((e=>(e-P.EO)%P.XN==0)).forEach((e=>{_.delete(e),b.add(e)}))}const k=I.filter((e=>d.has(e))),E=k.filter((e=>!b.has(e))).concat([..._]);let x;if(!(E.length===k.length&&E.every((e=>k.includes(e))))){const e=I.filter((e=>!b.has(e))).concat([..._]);h.set(w,e),x={addedViewIds:[..._].filter((e=>!I.includes(e))),removedViewIds:I.filter((e=>b.has(e)&&!_.has(e)))},n.set(w,e)}y.size>0&&(x={...x||{},runTriggerFilterIds:[...y]}),x&&a.push({id:w,updates:x}),(0,K.P7)(p.listId)&&(r.push(u),o.push(p)),(0,H.OK)(u.flags)&&(c.push(u),l.push(p))}h.size>0&&await g.Z.viewIds.where("searchListId").anyOf([...h.keys()]).modify((e=>{const t=h.get(e.searchListId);t&&(e.viewIds=t)}));return{sleUpdates:a,mailingListCandidateSles:r,mailingListCandidateMessages:o,labelsCandidateSles:c,labelsCandidateMessages:l}},getMatchResults:function(e,t,n,i){const s=new Set,a=new Set,r=new Set,o=_.Z.getByIds(e.sourceFilterIds);let c=!1;for(const[l,d]of n){const n=$.Z.getViewIdsByFilterId(l.id);for(const e of n)a.add(e);d&&(i?.includes(l.id)&&r.add(l.id),n.forEach((n=>{switch($.Z.getViewType(n)){case P.xE:s.add(n);break;case P.ZC:e.unseen&&s.add(n);break;case P.aD:Q.Z.call(e.sources,l)||s.add(n);break;case P.EO:const i=(0,K.P7)(t.listId);if(i){const e=ee.Z.getMailingListGroup(i);e&&e.isIgnored?s.add(n):c=!0}else ge(e.from)?c=!0:s.add(n);break;case P.IK:const a=b.Z.getFolderType(l.accountId,l.path)===P.Nz;q.Z.isMessageDeleted(e.sources,l,a)||s.add(n);break;case P.Fz:o.some((e=>e.accountId!==P.u4))&&s.add(n);break;case P.Jq:(0,V.Z)(e.sources,e.flags)||s.add(n);break;case P.js:const r=ie(e.sources,P.Oi),d=ie(e.sources,P.e9);r&&!d||s.add(n);break;case P.pF:(0,j.Z)(e.sources)||s.add(n)}})))}return{addedViewIds:s,removedViewIds:a,runTriggerFilterIds:r,isOnMailingList:c}},updateFilteringQueue:async function(){return g.Z.transaction("rw",[g.Z.filteringQueue],(async()=>{const e=de.reduce(((e,{id:t})=>Math.max(e,t)),0),t=await g.Z.filteringQueue.where("id").above(e).toArray();de.push(...t),de.sort(ne.Hc);const{updatedItems:n,deletedItemIds:i}=X.mergeFilteringQueueItems(de);if(0===n.size&&0===i.size)return de;const s=[];for(const e of de){const t=n.get(e.id);t?s.push(t):i.has(e.id)||s.push(e)}return de=s,g.Z.filteringQueue.bulkPut([...n.values()]),g.Z.filteringQueue.bulkDelete([...i]),s}))},clearQueue:function(){de=[]},deleteFilteringItem:async function(e){await g.Z.filteringQueue.delete(e.id);const t=de.indexOf(e);t>=0&&de.splice(t,1)}};let ae=!1;const re=100,oe=2e3,ce=v.Z.adjustBatchSize.bind(void 0,re,2e4,1e3);async function le(){if(ae)return k.Z.log("Mail",["filtering"],"Already filtering."),Promise.resolve();ae=!0;try{U.U.setPersistentStatus(C.A4,"MAIL_FILTERING",(0,d.Z)("Running mail filters..."));let e=await se.updateFilteringQueue();for(;e.length>0;){const t=e[0];let n=!0;try{switch(t.type){case"FILTERS_SLES":n=await ue(t);break;case"UPDATE_SLE":n=await se.filterUpdateSle(t);break;case"MOVE_SLE":await he(t);break;case"RUN_FILTERS":n=await fe(t);break;case"RE_RUN_SLES":n=await pe(t);break;default:k.Z.warn("Mail",["filtering"],"Invalid filtering queue item type",t.type)}n&&await se.deleteFilteringItem(t)}catch(e){k.Z.error("Mail",["filtering"],"Filtering failed",JSON.stringify(t),e),await se.deleteFilteringItem(t)}e=await se.updateFilteringQueue()}}catch(e){k.Z.error("Mail",["filtering"],e)}finally{ae=!1,U.U.clearPersistentStatus(C.A4,"MAIL_FILTERING")}}let de=[];async function ue(e){const{filterIds:t,folderIds:n=[],searchListIds:i,runAllMessages:s=!1,runMailingLists:a=!1,runCustomFolders:r=!1,runLabels:o=!1,runFlagFolders:c=!1,runQueries:l=!1,runSingleThread:d=!1,batchSize:u=oe}=e,h=_.Z.getAll().filter((e=>{const{id:i,accountId:u,path:h}=e;if(!!n.find((e=>{const[t,n]=e;return t===u&&n===h})))return!0;if(t&&t.includes(i))return!0;switch(u){case P.of:return s&&[P.ym,P.tB,P.ik,P.rp,P.N1,P.cm,P.$T].includes(h);case P.wC:return a;case P.MN:return c;case P.Ry:return r;case P.ut:return o;case P.Kz:return l;case P.tQ:return d}}));if(0===h.length)return!0;const f=Date.now(),p=i.splice(0,u),[m,w,b]=await g.Z.transaction("rw",[g.Z.searchList,g.Z.messages,g.Z.viewIds],(()=>Promise.all([g.Z.searchList.where("id").anyOf(p).toArray(),g.Z.messages.where("id").anyOf(p).toArray(),g.Z.viewIds.where("searchListId").anyOf(p).toArray()])));if(0===m.length)return!0;const y=new Map(b.map((e=>[e.searchListId,e.viewIds]))),v=await se.filterSles(m,w,y,h),{sleUpdates:I,mailingListCandidateSles:k,mailingListCandidateMessages:E,labelsCandidateSles:x,labelsCandidateMessages:A}=v;if(I.length>0&&U.QO.updateIndex({sleUpdates:I}),k.length>0){const e=await K.ZP.createMailingListFilters(E);if(e.length>0){await _.Z.updateFilters(e.map((({id:e})=>e)));const t=await se.filterSles(k,E,y,e),{sleUpdates:n}=t;n.length>0&&U.QO.updateIndex({sleUpdates:n})}}if(x.length>0){const e=await(0,H.uR)(x);await _.Z.updateFilters(e);const t=_.Z.getByIds(e),n=await se.filterSles(x,A,y,t),{sleUpdates:i}=n;i.length>0&&U.QO.updateIndex({sleUpdates:i})}if(i.length>0){const t=Date.now();e.batchSize=ce(u,t-f)}return 0===i.length}async function he(e){const{searchListIds:t,fromFolderId:n,toFolderId:i}=e,s=_.Z.getByFolderId(n),a=_.Z.getByFolderId(i);if(!s||!a)throw new Error("Either from- or to-filter not found");const r=[],[o,c]=await g.Z.transaction("rw",[g.Z.searchList,g.Z.viewIds],(()=>Promise.all([g.Z.searchList.where("id").anyOf(t).toArray(),g.Z.viewIds.where("searchListId").anyOf(t).toArray()]))),l=new Map(c.map((e=>[e.searchListId,e.viewIds]))),d=new Set,u=new Set;for(const e of o){const{id:t}=e,n=l.get(t);if(!n)throw new Error("viewIds not found "+t);const i={id:t,updates:{}};for(const e of $.Z.getAllViewTypes()){const t=s.id*P.XN+e;if(n.includes(t)){const n=a.id*P.XN+e;u.add(t),d.add(n)}}i.updates.addedViewIds=[...d],i.updates.removedViewIds=[...u],r.push(i),u.forEach((e=>{const t=n.indexOf(e);t>=0&&n.splice(t,1)})),d.forEach((e=>{n.push(e)}))}await g.Z.viewIds.where("searchListId").anyOf([...l.keys()]).modify((e=>{const t=l.get(e.searchListId);t&&(e.viewIds=t)})),U.QO.updateIndex({sleUpdates:r})}async function fe(e){const t=[],{filterIds:n,folderIds:i,currentSearchListId:s=0,batchSize:a=oe,triggerFilterIdCandidates:r}=e;if(n){const e=_.Z.getByIds(n);t.push(...e)}if(i){const e=_.Z.getByFolderIds(i);t.push(...e)}if(0===t.length)throw new Error("No valid filters in filtering request");const o=Date.now(),[c,l,d]=await g.Z.transaction("rw",[g.Z.searchList,g.Z.messages,g.Z.viewIds],(()=>Promise.all([g.Z.searchList.where("id").above(s).limit(a).toArray(),g.Z.viewIds.where("searchListId").above(s).limit(a).toArray(),g.Z.messages.where("id").above(s).limit(a).toArray()])));if(0===c.length)return!0;const u=new Map(l.map((e=>[e.searchListId,e.viewIds])));e.currentSearchListId=c[c.length-1].id;const h=await se.filterSles(c,d,u,t,{triggerFilterIdCandidates:r}),{sleUpdates:f}=h;f.length>0&&U.QO.updateIndex({sleUpdates:f});const p=Date.now();return e.batchSize=ce(a,p-o),!1}async function pe(e){const{filterIds:t,folderIds:n,batchSize:i=re,currentSearchListId:s=0,runMailingLists:a=!1}=e,r=[];if(t&&r.push(...t),n){const e=_.Z.getByFolderIds(n);r.push(...e.map((e=>e.id)))}const o=Date.now(),c=[],l=[],[d,u,h]=e.searchListIds?await async function(e,t){const n=e.splice(0,t);return await g.Z.transaction("rw",[g.Z.searchList,g.Z.messages,g.Z.viewIds],(()=>Promise.all([g.Z.searchList.where("id").anyOf(n).toArray(),g.Z.messages.where("id").anyOf(n).toArray(),g.Z.viewIds.where("searchListId").anyOf(n).toArray()])))}(e.searchListIds,i):await async function(e,t){return g.Z.transaction("rw",[g.Z.searchList,g.Z.messages,g.Z.viewIds],(()=>Promise.all([g.Z.searchList.where("id").above(e).limit(t).toArray(),g.Z.messages.where("id").above(e).limit(t).toArray(),g.Z.viewIds.where("searchListId").above(e).limit(t).toArray()])))}(s,i);if(0===d.length)return!0;void 0===e.searchListIds&&(e.currentSearchListId=d[d.length-1].id);const f=_.Z.getAll(),p=new Map(h.map((e=>[e.searchListId,e.viewIds]))),m=[];for(let e=0;e<d.length;e++){const t=d[e],n=p.get(t.id),i=m.find((e=>{const[t]=e;if(n.length!==t.length)return!1;for(let e=0;e<t.length;e++)if(n[e]!==t[e])return!1;return!0})),s=u[e];if(i){const[,[e,n]]=i;e.push(t),n.push(s)}else m.push([n,[[t],[s]]])}const w=[];for(const t of m){const[n,[i,s]]=t,o=new Set([...r,...w]);n.forEach((e=>{const t=Math.floor(e/P.XN);o.add(t)}));const d=f.filter((e=>o.has(e.id)));if(0===d.length)continue;const{skipQueries:u}=e,h=await se.filterSles(i,s,p,d,{skipQueries:u}),{mailingListCandidateSles:g,mailingListCandidateMessages:m}=h;if(c.push(...h.sleUpdates),a&&g.length>0){const t=await K.ZP.createMailingListFilters(m);if(t.length>0){const n=t.map((({id:e})=>e));await _.Z.updateFilters(n);const{filterIds:i=[]}=e;e.filterIds=[...i,...n],w.push(...n);const s=await se.filterSles(g,m,p,t,{skipQueries:u}),{sleUpdates:a}=s;l.push(...a)}}}c.length>0&&U.QO.updateIndex({sleUpdates:c}),l.length>0&&U.QO.updateIndex({sleUpdates:l});const b=Date.now();return e.batchSize=ce(i,b-o),!1}function ge(e){const t=e[0]?.address;return!!t&&!!_.Z.getByAddress(t)}J.Z.addListener((async function(e){if("filter"===e.func)await le()}));const me=se;var we=n(57357),_e=n(77150),be=n.n(_e),ye=n(16445);let ve={level:0,children:new Map};const Ie={data:new Map,add:e=>{void 0!==e.id&&Ie.data.set(e.id,e)},async get(e){const t=Ie.data.get(e);if(t)return t;{const t=await g.Z.threading.get(e);if(!t)return;const n={id:t.id,messageId:t.messageId};return Ie.add(n),n}},clear:()=>{Ie.data.clear()}};function ke(){Ie.clear()}function Ee(e){e.forEach((e=>{const{id:t,messageId:n}=e,i={id:t,messageId:n};Ie.add(i)}))}async function xe(){const e=await g.Z.threading.toArray();for(const t of e){const{id:e,messageId:n}=t,i={id:e,messageId:n};Ie.add(i),await Ae(t)}ke()}function Ae(e){const{inReplyTo:t,references:n}=e,i=[...n];return t&&!i.includes(t)&&i.push(t),i.reduce(((e,t)=>e.then((e=>Oe(t).then((n=>{if(n)return n;{const n={messageId:t},i=Me(void 0,e);return Se(n,i).then((()=>i))}}))))),Promise.resolve()).then((t=>{const{id:n,sentDate:i,messageId:s,outbound:a}=e,r={id:n,messageId:s};return Oe(s).then((e=>{if(e)return e.sentDateById.has(n)?(e.sentDateById.set(n,i),e):(e.sentDateById.set(n,i),Se(r,e).then((()=>e)));{const e=Me({id:n,sentDate:i,outbound:a},t);return Se(r,e).then((()=>e))}}))}))}function Se(e,t,n=ve){if(n.threadNode)return Promise.resolve().then((()=>{if(void 0!==n.id)return Ie.get(n.id).then((t=>{if(t&&t.messageId!==e.messageId)return{id:t.id,messageId:t.messageId}}));if(void 0!==n.messageId){if(n.messageId!==e.messageId)return{messageId:n.messageId};void 0!==e.id&&(n.id=e.id,delete n.messageId)}})).then((s=>{if(!s)return;const a=n.parent,r={children:new Map,level:a.level+1},o=e.messageId.substr(2*a.level,2);a.children.set(o,r);const c=n.threadNode,l=s.messageId.substr(2*r.level,2),d=e.messageId.substr(2*r.level,2);if(l!==d)return i(s,r,c),i(e,r,t),Promise.resolve();{const n={level:r.level+1,children:new Map};return r.children.set(d,n),Promise.all([Se(s,c,n),Se(e,t,n)])}}));{const s=e.messageId.substr(2*n.level,2),a=n.children.get(s);return a?Se(e,t,a):(i(e,n,t),Promise.resolve())}function i(e,t,n){const i={parent:t,threadNode:n},{id:s,messageId:a}=e;void 0!==s?i.id=s:i.messageId=a;const r=e.messageId.substr(2*t.level,2);t.children.set(r,i)}}function Me(e,t){const n={sentDateById:new Map,children:[],outbound:!1};if(e){const{id:t,sentDate:i}=e;n.sentDateById.set(t,i),n.outbound=e.outbound}return t&&(t.children.push(n),n.parent=t),n}function Oe(e,t=ve){if(!e)return Promise.resolve();if(t.threadNode){if(void 0!==t.messageId)return t.messageId===e?Promise.resolve(t.threadNode):Promise.resolve();if(void 0!==t.id)return Ie.get(t.id).then((n=>n&&n.messageId===e?t.threadNode:Promise.resolve()));throw new Error("Missing messageId and id: "+JSON.stringify(t))}{const n=e.substr(2*t.level,2),i=t.children.get(n);return i?Oe(e,i):Promise.resolve()}}function Ne(e){const t=new Map,n=[...e.keys()];return g.Z.searchList.where("id").anyOf(n).modify((n=>{const{id:i}=n,s=e.get(i);s&&(t.set(i,s),n.threadKey=s)})).then((()=>t))}var Ze=n(13617);let Te=!1;function Le(e){return Ae(e).then((e=>{if(!e.parent&&0===e.children.length)return[];let n=e;for(;n.parent;)n=n.parent;return t(n)}));function t(e,s){const{sentDateById:a,children:r}=e;let o,c=[];if(void 0===s){let t=n(e);t||(t=n(e,!1));let s=e.sentDateById.keys().next().value;s||(s=i(e,[0,Number.MAX_SAFE_INTEGER])[0]),o=(0,Ze._)(t,s),a.forEach(((e,t)=>{c.push({id:t,newThreadKey:o})}))}else a.size>0?a.forEach(((e,t)=>{o=[...s,e],c.push({id:t,newThreadKey:o})})):o=s;return r.forEach((e=>{const n=t(e,o);c=[...c,...n]})),c}function n(e,t=!0){const i=t&&e.outbound;let s=[...e.sentDateById.values()].reduce(((e,t)=>Math.max(e,i?0:t)),0);return e.children.forEach((e=>{s=Math.max(s,n(e,t))})),s}function i(e,t){return t=[...e.sentDateById.entries()].reduce(((e,t)=>e[1]<t[1]?e:t),t),e.children.forEach((e=>{t=i(e,t)})),t}}const Re={updateThreads:async function(){if(!Te)for(Te=!0;Te;)try{const e=await g.Z.threadingQueue.toCollection().first();if(!e)return ke(),void(Te=!1);const{threadingIds:t}=e;let n=2e3;const i=new v.Z.BatchSizeOptimizer(n,2e3);for(;t.length>0;){const s=t.splice(0,n);await g.Z.transaction("rw",[g.Z.threadingQueue,g.Z.threading,g.Z.searchList],(async()=>{const a=Date.now(),r=await g.Z.threading.where("id").anyOf(s).toArray(),o=new Map;Ee(r);for(const e of r){(await Le(e)).forEach((e=>{const{id:t,newThreadKey:n}=e;o.set(t,n)}))}if(o.size>0){const e=await Ne(o);U.QO.updateThreadKeys(e)}if(t.length>0){await g.Z.threadingQueue.put(e);const t=Date.now();n=i.optimize(n,t-a)}else await g.Z.threadingQueue.delete(e.id)}))}}catch(e){throw Te=!1,k.Z.error("Mail",["Threading"],e),U.U.setStatus(C.A4,(0,d.Z)("Error during threading"),5e3),e}}};var Pe=n(3664),Ce=n(76257),Ue=n(13519),Fe=n(27950);const De=1048576;class ze extends Error{constructor(e,t,n){super(t),this.code=e,this.socket=n}}function Be(e){return(0,Pe.vi)(e,[43,79,75])}function $e(e){return 0===e.indexOf("PASS")?"PASS":0===e.indexOf("APOP")?e.replace(/\w+\s*$/,"the_md5_hash"):e}async function je(e,t,n){const i=[];return new Promise(((s,a)=>{let r=setTimeout((function(){a(new ze("SOCKET_TIMEOUT",(0,d.Z)("Failed to connect to POP server after $1 ms",[n]),o))}),n);const o=D.default.open(e,t,{useSecureTransport:110!==t});if("connecting"!==o.readyState)return clearTimeout(r),void a(new ze("NO_SOCKET",(0,d.Z)('POP socket did not switch to "connecting" when trying to connect to $1:$2',[e,t]),o));o.onerror=e=>{clearTimeout(r),a(new ze("NO_SOCKET",(0,d.Z)("POP socket generated unknown error when connecting. Response message: $1",[e.data?.message||e.message||""]),o))},o.ondata=e=>{clearTimeout(r);const t=new Uint8Array(e.data);i.push(...t),(0,Pe.MF)(i,[13,10])?s({socket:o,response:new Uint8Array(i)}):r=setTimeout((function(){a(new ze("SOCKET_TIMEOUT",(0,d.Z)("POP server failed to send connection chunk after $1 ms",[n]),o))}),n)}}))}async function qe(e,t,n=!1,i=3e4){if(!e)throw new ze("NO_SOCKET",(0,d.Z)('No POP socket when sending "$1"',[$e(t)]),e);if(await!Qe(e))throw new ze("SOCKET_CLOSED",(0,d.Z)('POP socket unexpectedly closed before "$1" command could be sent',[$e(t)]),e);const s=[];return new Promise(((a,r)=>{let o=setTimeout((function(){clearTimeout(o),r(new ze("SOCKET_TIMEOUT",(0,d.Z)('POP server did not reply to command "$1" after $2 ms',[$e(t),i]),e))}),i);e.onerror=n=>{clearTimeout(o),r(new ze("SEND_ERROR",(0,d.Z)('POP socket generated unknown error when sending command "$1"',[$e(t)]),e))};let c=Date.now();e.ondata=l=>{clearTimeout(o);const u=new Uint8Array(l.data);if(s.push(...u),Date.now()-c>1e3){const e=Math.round(s.length/De*10)/10;U.U.setStatus(C.A4,(0,d.Z)("Fetching message: $1 MB",[e])),c=Date.now()}(0,Pe.MF)(s,[13,10,46,13,10])||!n&&(0,Pe.MF)(s,[13,10])?(n?s.splice(-5):s.splice(-2),(0,Pe.Xh)(s,[13,10,46],[13,10]),a(new Uint8Array(s))):o=setTimeout((function(){r(new ze("SOCKET_TIMEOUT",(0,d.Z)('POP server failed to send additional chunk for command "$1" after $2 ms',[$e(t),i]),e))}),i)};const l=`${t}\r\n`,u=(0,Pe.sy)(l);e.send(u)}))}async function Ve(e,t,n){const i=await qe(e,`USER ${t}`);if(!Be(i))throw new ze("AUTH_FAIL",(0,d.Z)("Invalid username for POP, server responded with: $1",[(0,Pe.DA)(i)]),e);const s=(0,Pe.DA)((new TextEncoder).encode(n)),a=await qe(e,`PASS ${s}`);if(!Be(a))throw new ze("AUTH_FAIL",(0,d.Z)("Login to POP server failed, server responded with: $1",[(0,Pe.DA)(a)]),e)}function Qe(e){return new Promise((t=>{setTimeout((()=>{t("open"===e.readyState)}),0)}))}async function He(e,t,n,i,s=6e4,a=!1){const{socket:r,response:o}=await je(e,t,s);if(!Be(o))throw new ze("CONNECT_ERROR",(0,d.Z)("POP server $1:$2 responded with an error after connection",[e,t]),r);const c=Ke(o);if(!c||a)return await Ve(r,n,i),r;try{return await async function(e,t,n,i){const s=(0,Pe.DA)((new TextEncoder).encode(n)),a=be()(`${i}${s}`),r=await qe(e,`APOP ${t} ${a}`);if(!Be(r))throw new ze("AUTH_FAIL",(0,d.Z)("APOP authentication failed: $1",[(0,Pe.DA)(r)]),e)}(r,n,i,c),r}catch(a){if("AUTH_FAIL"===a.message){return await Qe(r)?(await Ve(r,n,i),r):He(e,t,n,i,s,!0)}throw a}}function Ke(e){const t=e.lastIndexOf(60);if(-1!==t){const n=e.indexOf(62,t);if(-1!==n){const i=e.subarray(t,n+1);return(0,Pe.DA)(i)}}}async function We(e,t){const n=await qe(e,`TOP ${t.index} 0`,!0);if(Be(n))return{...t,headersOnly:!0,message:Je(n)};throw new ze("TOP_ERROR",(0,d.Z)("POP server did not respond correctly to TOP command. Response: $1",[(0,Pe.DA)(n)]))}async function Ge(e,t){const n=await qe(e,`RETR ${t.index}`,!0);if(Be(n))return{...t,headersOnly:!1,message:Je(n)};throw new ze("RETR_ERROR",(0,d.Z)("POP server did not respond correctly to RETR command. Response: $1",[(0,Pe.DA)(n)]),e)}function Ye(e){const t=[...e],n=new Map;let i=(0,Pe.L2)(t,[13,10]);for(;-1!==i;){const e=(0,Pe.L2)(t,[13,10],i+1),s=-1!==e?t.slice(i+2,e):t.slice(i+2),a=s.indexOf(32);if(-1===a){i=e;continue}const r=s.slice(0,a),o=s.slice(a+1),c=Number(String.fromCharCode(...r)),l=String.fromCharCode(...o);n.set(l,c),i=e}return n}function Xe(e){const t=[...e],n=new Map;let i=(0,Pe.L2)(t,[13,10]);for(;-1!==i;){const e=(0,Pe.L2)(t,[13,10],i+1),s=-1!==e?t.slice(i+2,e):t.slice(i+2),a=s.indexOf(32);if(-1===a){i=e;continue}const r=s.slice(0,a),o=s.slice(a+1),c=Number(String.fromCharCode(...r)),l=parseInt(String.fromCharCode(...o));n.set(c,l),i=e}return n}function Je(e){const t=(0,Pe.L2)(e,[13,10]);if(-1===t)throw new Error("parseRetrResponse: Expected end of line");return e.subarray(t+2)}async function et(e,t,n){const i=[];for(const e of n){const t=ye.Z.call(e.message),n=(0,Ce.Zp)(e.message),s=(0,Ce.Dc)(n),a={to:t.to,from:t.from,cc:t.cc,inReplyTo:t.inReplyTo,replyTo:t.replyTo,subject:t.subject,sentDate:t.sentDate,messageId:t.messageId,listId:t.listId,listPost:t.listPost,references:t.references,flags:[],uidl:e.uidl||"",attachment:s.length,size:e.size};a.messageId||(a.messageId=""),i.push(a)}const s=await B.call(t,i).catch((n=>{throw new ze("STORE_ERROR",(0,d.Z)("Unable to store POP message in mail store.",[t]),e)}));if(s.length>0){const a=[];for(const r of s){const s=i.findIndex((e=>h.Z.messageEqualsSle(e,r))),o=i[s],c=n[s];if(!c.headersOnly){const{sentDate:n,id:i}=r;try{const s=await(0,L.Z)(i,o,c.message);s&&(c.message=s.raw,r.preview=(0,Ue.Q)(s.bodyParts),await(0,we.Z)(i,r.preview)),await tt(e,t,c,n,i),a.push(i)}catch(e){k.Z.error("Mail",["pop",t,i],"Failed to process mail: ",e)}}}a.length>0&&await S.Z.setHasRaws(t,a)}return s}async function tt(e,t,n,i,s){try{await R.Z.call(t,i,s,n.message)}catch(n){throw new ze("STORE_ERROR",(0,d.Z)("Unable to store POP message as writing to disk failed.",[t]),e)}}async function nt(e,t){switch(e.message){case"SOCKET_TIMEOUT":case"SEND_ERROR":case"CONNECT_ERROR":case"DELETE_ERROR":case"NO_UIDL":case"NO_SOCKET":e.socket&&e.socket.close();break;case"MISCONFIGURED_ACCOUNT":case"SOCKET_CLOSED":break;default:if(e.socket){const{socket:t}=e;it(t,!1)}}throw e.socket&&(e.socket.onerror=null),U.KU.set(t,"POP",e,e.code),e}async function it(e,t=!0){try{await qe(e,"QUIT"),e.close()}catch(e){if(t)throw e;k.Z.error("Mail",["pop-client"],e)}}async function st(e,t){const n=await qe(e,"UIDL",!0);if(!Be(n))throw new ze("NO_UIDL",(0,d.Z)("POP server $1 does not support UIDL",[t]),e);const i=Ye(n);U.U.setStatus(C.A4,(0,d.Z)("$1 message exists on POP account $2","$1 messages exist on POP account $2",[i.size,t]));const s=await qe(e,"LIST",!0);if(!Be(s))throw new ze("NO_LIST",(0,d.Z)("POP server $1 does not support LIST",[t]),e);return{uidlMap:i,sizeMap:Xe(s)}}async function at(e){try{const t=e.MAIL_USER,n=e.MAIL_PASSWORD,i=e.MAIL_SERVER,s=e.MAIL_PORT;if(!(t&&n&&i&&s))throw new ze("MISCONFIGURED_ACCOUNT",(0,d.Z)("Incoming POP server attributes missing for $1",[e.MAIL_EMAIL]));const a=await He(i,s,t,n);return U.KU.delete(e.MAIL_EMAIL,"POP"),a}catch(t){throw U.KU.set(e.MAIL_EMAIL,"POP",t,t.code),t}}function rt(e){return e.popDeletion||{when:P.qd,howManyDays:0}}async function ot(e){const t=(await I.Z.loadPopAccounts()).find((({MAIL_EMAIL:t})=>t===e));if(t)return t;throw new Error("Account not found "+e)}async function ct(e,t,n){const i=[],s=[];let a=!0;const r=rt(e),o=function(e){const t=e.popMaxSize||{limited:!1,limit:0};return t.limited?t.limit*De:0}(e);for(const e of t){const{index:t,size:c}=e;let l;if(a&&o&&void 0!==c&&c>o)try{l=await We(n,e)}catch(e){a=!1,k.Z.warn("Mail",["pop-client"],"Error using TOP to fetch mail, using RETR instead.",e)}l||(l=await Ge(n,e),r.when===P.eQ&&s.push(t)),i.push(l)}return{popMails:i,safeToDelete:s}}async function lt(e,t){for(const n of t){if(!Be(await qe(e,`DELE ${n}`)))throw new ze("DELETE_ERROR",(0,d.Z)("Failed to delete mail with index $1",[n]),e)}}const dt={verifyLogin:async function(e){const{MAIL_SERVER:t,MAIL_PORT:n,MAIL_USER:i,MAIL_PASSWORD:s,MAIL_EMAIL:a}=e;if(!(t&&n&&(i&&s||e.useOAuth)))throw new ze("MISCONFIGURED_ACCOUNT",(0,d.Z)("Incoming server attributes missing for $1",[a]));try{const e=await He(t,n,i,s,1e4);await it(e)}catch(e){await nt(e,a)}},deleteMail:async function(e,t){if(!e.popDeletion||e.popDeletion.when!==P.Qp)return;const n=e.MAIL_EMAIL;try{const i=await at(e),s=await qe(i,"UIDL",!0);if(!Be(s))throw new ze("NO_UIDL",(0,d.Z)("POP server $1 does not support UIDL",[n]),i);const a=(await g.Z.pop.where("searchListId").anyOf(t).toArray()).filter((e=>e.accountId===n)).map((e=>e.uidl)),r=Ye(s),o=[];for(const e of a)r.has(e)&&o.push(e);await lt(i,o),await qe(i,"QUIT"),await i.close()}catch(e){await nt(e,n)}},getMail:async function(e){const t=await at(e),n=e.MAIL_EMAIL;U.U.setStatus(C.A4,(0,d.Z)("Checking for new mail on POP account $1",[n]));try{const{uidlMap:i,sizeMap:s}=await st(t,n),a=await async function(e,t,n){const i=e.MAIL_EMAIL,s=[...t.keys()],a=await async function(e,t){const n=t.map((t=>[e,t]));return await g.Z.pop.where("[accountId+uidl]").anyOf(n).toArray()}(i,s),r=new Map,o=new Set;for(const e of a){const{uidl:t,searchListId:n}=e,i=r.get(t);i?i.push(e):r.set(t,[e]),o.add(n)}const c=await A.Z.getBySearchListIdsAccountId([...o],i),l=new Map;for(const e of c)if(e){const{searchListId:t,hasRaw:n}=e;l.set(t,1===n)}const d=[],u=new Set,h=rt(e);for(const[e,s]of t){if(!e){k.Z.warn("Mail",["pop-client"],"POP message does not have UIDL: "+i+" index: "+s);continue}const t=r.get(e);if(t&&0!==t.length){const[{searchListId:e,createdTimestamp:n}]=t;!1!==l.get(e)&&(h.when===P.eQ||h.when===P.kA&&n+24*h.howManyDays*60*60*1e3<Date.now())&&u.add(s)}else{const t={index:s,uidl:e,size:n.get(s)||0};d.push(t)}}return{toFetch:d,safeToDelete:u}}(e,i,s),{toFetch:r}=a,o=r.length;let c=0;U.U.setStatus(C.A4,(0,d.Z)("Need to fetch $1 message - $2","Need to fetch $1 messages - $2",[o,n]));let l=123;const u=new v.Z.BatchSizeOptimizer(123,5e3);for(;r.length>0;){const i=Date.now(),s=r.splice(0,l),h=await ot(n);if((0,Fe.OM)(e,h))break;const f=await ct(h,s,t),{popMails:p,safeToDelete:g}=f;if(p.length>0){const e=await et(t,n,p);e.length>0&&U.QO.updateIndex({addedSles:e}),me.filter(),Re.updateThreads()}if(g.length>0){await lt(t,g);for(const e of g)a.safeToDelete.delete(e)}const m=Date.now();c+=l,l=u.optimize(l,m-i),U.U.setStatus(C.A4,(0,d.Z)("Indexing mail $1 $2/$3",[n,c,o]))}a.safeToDelete.size>0&&await lt(t,[...a.safeToDelete]),await it(t)}catch(e){await nt(e,n)}},getMessage:async function(e,t,n){const i=e.MAIL_EMAIL,s=await at(e),{uidlMap:a,sizeMap:r}=await st(s,i),o=a.get(t);if(void 0===o)throw new Error("Message not listed on POP server "+t);const c={index:o,uidl:t,size:r.get(o)||0},{message:l}=await Ge(s,c);U.QO.runStoredQueryFilters([n]);const d=(0,Ce.Zp)(l),u=(0,Ce.Dc)(d).length;return u>0&&(await g.Z.searchList.update(n,{attachment:u}),U.QO.updateIndex({sleUpdates:[{id:n,updates:{attachment:u}}]})),l},repliedOK:Be,openPOP:je,sendAndReceive:qe,parseUidlResponse:Ye,parseListResponse:Xe,parseRetrResponse:Je,arrayEndsWith:Pe.MF,getNonce:Ke};let ut=!1;const ht={};async function ft(e){if(e.isDeleted)return;const t=e.MAIL_EMAIL;if(navigator.onLine)if(e.offline)U.U.setStatus(C.A4,(0,d.Z)("Account $1 has been set as an offline account. Check settings.",[t]));else{if(!e.MAIL_PORT||e.MAIL_PORT<=0)throw new Error(`Port missing or invalid: ${e.MAIL_PORT||""}`);if(!ht[t]){ht[t]=!0,U.U.setStatus(C.A4,(0,d.Z)("Indexing - $1 $2",[t,P.Gf]));try{await dt.getMail(e),U.U.setStatus(C.A4,(0,d.Z)("Finished indexing - $1",[t]),P.QM)}catch(t){!function(e,t){k.Z.error("Mail",["pop"],t);const n=`${e.MAIL_SERVER||""} / ${e.MAIL_USER||""}: ${t.name} `;t.message=n+t.message,U.U.setStatus(C.A4,t.message)}(e,t)}finally{ht[t]=!1,U.QO.removePathIndicator(t,P.Gf)}}}else U.U.setStatus(C.A4,(0,d.Z)("No network connection"))}async function pt(e){let t=await I.Z.loadPopAccounts();if(t=t.filter((e=>!e.offline)),!t)return;if((await g.Z.systemTasks.toArray()).some((e=>"restore_mail_db"===e.taskName)))k.Z.warn("Mail",["pop"],"Not connecting while restoration in progress");else if(e){const n=t.find((t=>t.MAIL_EMAIL===e));n&&await ft(n)}else for(let e=0;e<t.length;e++)await ft(t[e])}function gt(e,t){return dt.deleteMail(e,t)}function mt(e,t,n){return dt.getMessage(e,t,n)}const wt={checkForMail:pt,deletePopMail:gt,getPopMessage:mt,setCheckInterval:function(e,t){ut&&clearInterval(ut),ut=!!e&&setInterval(pt,6e4*t)}};self.addEventListener("message",(async function({origin:e,data:t,source:n}){if(e!==C.oP||!t||!t.pop)return;const{promiseId:i,func:s,args:a=[]}=t.pop;if(s)try{const e=await wt[s](...a),t=e&&"getPopMessage"===s?[e.buffer]:void 0;n.postMessage({pop:{promiseId:i,results:e}},{transfer:t})}catch(e){n.postMessage({pop:{promiseId:i,error:e.message||e}})}}),!1);var _t=n(83204),bt=n(92292),yt=n(26067);function vt(e,t,n){const{pathArray:i,fileName:s}=(0,yt.ZP)(e,t,n);return new Promise((e=>{O.Z.mailPrivate.messageFileExists(i,s,(t=>{bt.Z.runtime.lastError?e(!1):e(t)}))}))}const It={runSystemTask:async function(e){const{fileKeys:t}=e,n=t.length;let i=0,s=111;const a=new v.Z.BatchSizeOptimizer(s,2e3);for(;t.length>0;){U.U.setStatus(C.A4,(0,d.Z)("Checking raw email files $1/$2",[i,n]));const r=Date.now(),o=t.splice(0,s),c=[];for(const e of o){const{accountId:t,searchListId:n,sentDate:i}=e,s=await vt(t,i,n)?1:0;c.push({accountId:t,searchListId:n,hasRaw:s})}await g.Z.transaction("rw",[g.Z.hasRaw,g.Z.systemTasks],(()=>{g.Z.hasRaw.bulkPut(c),g.Z.systemTasks.update(e.id,{fileKeys:t})})),i+=s;const l=Date.now();s=a.optimize(s,l-r)}await g.Z.systemTasks.delete(e.id),U.U.setStatus(C.A4,(0,d.Z)("Done checking $1 raw email files",[n]))},isRawOnDisk:vt};var kt=n(5267),Et=n(11430),xt=n(83507);var At=n(89378),St=n(57654),Mt=n(19789);var Ot=n(60308),Nt=n(9982),Zt=n(25100),Tt=n(40348);async function Lt(e,t,n,i,s){const a={added:0,failed:0,dups:0,renamed:0};if(e.from.length+e.to.length+e.cc.length===0&&!e.subject){k.Z.warn("Mail",["restoreMailDb",t,n,i],"Selected file does not seem to be a mail file");const e=(0,d.Z)("Selected file does not seem to be a mail file: $1",[i]);return U.U.setStatus(C.A4,e,P.QM),a}const r=b.Z.getFolderType(t,n),{indexUpdates:o}=await Ot.Z.call(t,n,r,[e]),{addedSles:c=[],sleUpdates:l=[]}=o,u=c[0];if(!(u||l&&0!==l.length))return k.Z.info("Mail",["restoreMailDb",t,n,i],"Message already exists."),a.dups+=1,a;if(u&&s){const n=b.Z.getFolderType(t,P.N1),i=await h.Z.addSourceFilters(t,P.N1,n,[{message:e,searchListEntry:u}],!0);l.push(...i)}U.QO.updateIndex(o),a.added+=c.length;const{id:f}=u||l[0],{relativePathParts:p,fileName:g}=(0,yt.xh)(i);try{await O.Z.mailPrivate.renameMessageFile(p,g,`_${f}.eml`),bt.Z.runtime.lastError&&k.Z.error("Mail",["restoreMailDb","renameMessageFile",g],bt.Z.runtime.lastError)}catch(e){return k.Z.error("Mail",["restoreMailDb",p,g,f],e),a.failed+=1,a}return a.renamed+=1,await S.Z.setHasRaw(t,f),await(0,Nt.Z)(t,n,[e]),J.Z.filter(),Re.updateThreads(),a}async function Rt(e){try{const t=(0,yt.sz)(e),n=await O.Z.mailPrivate.getFilePaths(t);bt.Z.runtime.lastError&&k.Z.error("Mail",["restoreMailDb","getFilePaths",t],bt.Z.runtime.lastError);for(const e of n){const{fileName:t,relativePathParts:n}=(0,yt.xh)(e);if("_"===t[0]){const e=t.slice(1);await O.Z.mailPrivate.renameMessageFile(n,t,e),bt.Z.runtime.lastError&&k.Z.error("Mail",["restoreMailDb","renameMessageFile",t,e],bt.Z.runtime.lastError)}}}catch(e){k.Z.error("Mail",["restoreMailDb"],e)}}async function Pt(e,t,n){if(!n.includes(e)){if(t.find((t=>t.MAIL_EMAIL===e))){k.Z.warn("Mail",["restoreMailDb"],`Account ${e} missing and being added`);const t=c.Z.getDefaultFolders(),n=await r.Z.add(e,t);await u.Z.addAccounts({[e]:n});const i=await o.Z.foldersToFilters(e,t);_.Z.updateFilters(i)}}}async function Ct(e){"restore_mail_db"===e.taskName?await async function(e){let t=0,n=0,i=0,s=0,a=0,o=0,c=0,l=0,u=0;try{const h=await O.Z.mailPrivate.getMailFilePaths();bt.Z.runtime.lastError&&k.Z.error("Mail",["restoreMailDb","getMailFilePaths"],bt.Z.runtime.lastError),h.sort();const f=await I.Z.loadAllAccounts(),p=f.map((e=>e.MAIL_EMAIL)),m={};for(const e of p)m[(0,yt.BB)(e)]=e;const w=(0,yt.BB)(P.u4);let _=[],b=0;if(e.currentFilePath)for(;b<h.length;b++){const t=h[b];if(t.slice(0,t.lastIndexOf("/"))===e.currentFilePath.slice(0,e.currentFilePath.lastIndexOf("/")))break}for(let p=b;p<h.length;p++){p%20==0&&U.U.setStatus(C.A4,(0,d.Z)("Rebuilding database: $1/$2",[p,h.length]));const b=h[p];try{const{relativePathParts:d,fullPathParts:u}=(0,yt.xh)(b),[h]=d;if(h===w)continue;_.length>0&&u.slice(0,u.length-1).some(((e,t)=>_[t]!==e))&&(await Rt(_),await g.Z.systemTasks.update(e.id,{currentFilePath:b})),_=u;const p=u[u.length-1];let[y,v]=p.split(".");if("_"===y[0]&&(y=y.slice(1)),!v||"eml"!==v.toLowerCase()){k.Z.warn("Mail",["restoreMailDb"],"file name does not have an eml extension",b);continue}if(!Number(y)){k.Z.warn("Mail",["restoreMailDb"],"file does not have a numeric file name",b);continue}if(h===w){k.Z.warn("Mail",["restoreMailDb"],"Not able to restore Feed items yet!");continue}const I=await(0,Tt.Z)(b);if(0===I.length){k.Z.warn("Mail",["restoreMailDb"],"file is empty",b);continue}t+=1;const E=ye.Z.call(I),x=await(0,Zt.Z)(E,[],I),A=m[h],S=x.to.find((e=>e.address===A)),M=x.from.find((e=>e.address===A));let O=S?.address;const N=M?.address;let Z;O||N||(O=A);const T=O===N,L=(await r.Z.getAll()).map((e=>e.accountId));if(O){await Pt(O,f,L);const{added:e,failed:t,dups:s,renamed:r}=await Lt(x,O,P.Gf,b,T);T?a+=e:i+=e,o+=t,l+=s,n+=r,n>0&&(Z=b.replace(/([0-9]+\.eml)$/,"_$1"))}if(N&&!T){await Pt(N,f,L);const e=Z||b,{added:t,failed:i,dups:a,renamed:r}=await Lt(x,N,P.N1,e,!1);s+=t,c+=i,l+=a,n+=r}}catch(e){u+=1,k.Z.error("Mail",["restoreMailDb"],e)}}_.length>0&&await Rt(_),await g.Z.systemTasks.delete(e.id)}catch(e){u+=1,k.Z.error("Mail",["restoreMailDb"],e)}k.Z.warn("Mail",["restoreMailDb"],"Message files read",t),k.Z.warn("Mail",["restoreMailDb"],"Message files renamed",n),k.Z.warn("Mail",["restoreMailDb"],"Duplicates",l),k.Z.warn("Mail",["restoreMailDb"],"Added to Inbox",i),k.Z.warn("Mail",["restoreMailDb"],"Added to Inbox and Sent",a),k.Z.warn("Mail",["restoreMailDb"],"Added to Sent",s),k.Z.warn("Mail",["restoreMailDb"],"Failed adding to Inbox",o),k.Z.warn("Mail",["restoreMailDb"],"Failed adding to Sent",c),k.Z.warn("Mail",["restoreMailDb"],"Errors",u)}(e):"restore_full_text_search_db"===e.taskName?await async function(e){const t=await g.Z.searchList.toCollection().last();if(t){Zi.pausePrefetching(!0);try{let{currentPosition:n}=e;for(;n<=t.id;){if(i.Z.get(Z.kMailIsTurnedOff)){U.U.setStatus(C.A4,(0,d.Z)("Mail client turned off - Stopped building text-search database"),3e3);break}U.U.setStatus(C.A4,(0,d.Z)("Building text-search database: $1/$2",[(0,Mt.uf)(n),(0,Mt.uf)(t.id)]));const s=await g.Z.messages.where("id").between(n,t.id+1).limit(20).toArray();if(0===s.length)break;const a=await g.Z.searchList.where("id").between(n,s[s.length-1].id+1).toArray(),r=[];for(let e=0;e<s.length;e++){const t=s[e],n=a[e],{subject:i,to:o,cc:c,from:l,replyTo:d}=t;let u=(0,Ue.H)(t.bodyParts);if(!u)for(const e of new Set(n.sourceFilterIds.map((e=>_.Z.get(e))).filter(Boolean).map((e=>e.accountId)))){const t=await xt.Z.call(e,n.id,n.sentDate);if(t){if(e===P.u4){const e=new TextDecoder("utf-8").decode(t);u=(0,St.Z)(e)}else{const e=(0,Ce.PW)((0,Ce.Zp)(t));if(!e)break;const n=await Et.Z.parseMail(t,e.mimeTree);u=(0,Ue.H)(n.bodyParts)}break}}r.push({searchListId:n.id,subject:i,body:u,to:(0,At.Z)(o),cc:(0,At.Z)(c),from:(0,At.Z)(l),replyTo:(0,At.Z)(d)})}await(0,z.Z)(r),n=s[s.length-1].id+1,await g.Z.systemTasks.update(e.id,{currentPosition:n})}i.Z.get(Z.kMailIsTurnedOff)||(await g.Z.systemTasks.delete(e.id),U.U.setStatus(C.A4,(0,d.Z)("Building text-search database finished"),P.QM))}finally{Zi.pausePrefetching(!1)}}else await g.Z.systemTasks.delete(e.id)}(e):"delete_full_text_search_entries"===e.taskName?await kt.Z.systemTaskDelete(e):"check_disk_for_raw"===e.taskName?await It.runSystemTask(e):"generate_missing_previews"===e.taskName?await async function(e){const t=e.currentId||0;let n=128;const i=new v.Z.BatchSizeOptimizer(n,2e3),s=await g.Z.searchList.toCollection().primaryKeys(),a=s[s.length-1];!async function t(s){if(s>=a)return void g.Z.systemTasks.delete(e.id);const r=Date.now(),o=await g.Z.searchList.where("id").between(s,a+1).limit(n).toArray();if(U.U.setStatus(C.A4,(0,d.Z)("Generate previews: $1/$2",[s,a]),P.QM),0===o.length)return void g.Z.systemTasks.delete(e.id);const c=o.map((e=>e.id)),l=new Map;o.forEach((e=>l.set(e.id,e)));const u=(await g.Z.hasRaw.where("searchListId").anyOf(c).toArray()).filter((e=>e.hasRaw)),h=[];for(const e of u){const{accountId:t,searchListId:n}=e,i=l.get(n);if(i){const e=await xt.Z.call(t,n,i.sentDate);if(e){const t=(0,Ce.PW)((0,Ce.Zp)(e));if(t){const i=await Et.Z.parseMail(e,t.mimeTree),s=(0,Ue.Q)(i.bodyParts);h.push({id:n,updates:{preview:s}})}}}}s=c[c.length-1]+1,await g.Z.transaction("rw",[g.Z.searchList,g.Z.systemTasks],(async()=>{await Promise.all(h.map((e=>g.Z.searchList.update(e.id,e.updates)))),await g.Z.systemTasks.update(e.id,{currentId:s})})),U.QO.updateIndex({sleUpdates:h});const f=Date.now();n=i.optimize(n,f-r),t(s)}(t)}(e):console.error("task not supported",e)}async function Ut(e,t,n){U.U.setStatus(C.A4,(0,d.Z)("Removing data from $1 in $2",[t,e]));const i=[e,t,0],s=[e,t,Number.MAX_VALUE];await g.Z.imap.where("[accountId+path+uid]").between(i,s).delete(),await g.Z.mailboxCache.where("[accountId+path]").equals([e,t]).delete();const a=await g.Z.filters.where("[accountId+path]").equals([e,t]).first(),r=await g.Z.filters.toCollection().filter((n=>n.accountId===e&&n.path===t||n.selectedAccountId===e&&n.selectedName===a.name)).primaryKeys(),o=await zt(e,r);e===P.u4&&await g.Z.deletedFeedItems.where("path").equals(t).delete(),n&&await Dt(e,o),await g.Z.buffer.where("[accountId+path]").equals([e,t]).delete(),U.U.setStatus(C.A4,(0,d.Z)("Finshed removing data from $1 in $2",[t,e]))}async function Ft(e,t){U.U.setStatus(C.A4,(0,d.Z)("Removing data for $1",[e]));const n=[e,""],i=[e,"￿"];await g.Z.imap.where("accountId").equals(e).delete(),await g.Z.hasRaw.where("accountId").equals(e).delete(),await g.Z.pop.where("accountId").equals(e).delete(),await g.Z.mailboxCache.where("accountId").equals(e).delete();const s=(await g.Z.filters.where("[accountId+path]").between(n,i).toArray()).map((e=>e.id)),a=await zt(e,s);t&&await Dt(e,a),await g.Z.buffer.where("accountId").equals(e).delete()}async function Dt(e,t){U.U.setStatus(C.A4,(0,d.Z)("Removing raw message files for $1",[e])),await Promise.all(t.map((t=>{_t.Z.call(e,t.id,t.sentDate).catch((n=>console.warn(`Error deleting file for ${e}/${t.id}. May not exist! ${n}`)))})))}async function zt(e,t){const n=[],i=[],s=new Set;let a,r;t.forEach((e=>{for(let t=0;t<P.XN;t++)s.add(e*P.XN+t)}));const o=[];await g.Z.transaction("rw",[g.Z.messages,g.Z.searchList,g.Z.threading,g.Z.filters,g.Z.viewIds,g.Z.systemTasks,g.Z.hasRaw],(async()=>{U.U.setStatus(C.A4,(0,d.Z)("Updating database...")),await g.Z.searchList.where("sourceFilterIds").anyOf(t).distinct().modify(((e,s)=>{if(t.forEach((t=>{e.sources.delete(t)})),e.sources.size>0){const i=new Set(t);e.sourceFilterIds=e.sourceFilterIds.filter((e=>!i.has(e))),n.push(e);const s=new Set(_.Z.getByIds([...e.sources.keys()]).map((({accountId:e})=>e))),a=new Set(_.Z.getByIds(t).map((({accountId:e})=>e)).filter((e=>!s.has(e))));for(const t of a)o.push([e.id,t])}else i.push(e),delete s.value})),r=i.map((e=>e.id)),U.U.setStatus(C.A4,(0,d.Z)("Removing messages...")),await Promise.all([g.Z.messages.where("id").anyOf(r).delete().then((()=>U.U.setStatus(C.A4,(0,d.Z)("Removing threading info...")))),g.Z.threading.where("id").anyOf(r).delete().then((()=>U.U.setStatus(C.A4,(0,d.Z)("Removing header info...")))),g.Z.viewIds.where("searchListId").anyOf(r).delete().then((()=>U.U.setStatus(C.A4,(0,d.Z)("Updating view indices...")))),g.Z.viewIds.where("searchListId").anyOf(n.map((e=>e.id))).modify((e=>{e.viewIds=e.viewIds.filter((e=>!s.has(e)))})).then((()=>U.U.setStatus(C.A4,(0,d.Z)("Removing raw indicators...")))),g.Z.hasRaw.where("searchListId").anyOf(r).delete().then((()=>U.U.setStatus(C.A4,(0,d.Z)("Removing raw indicators...")))),g.Z.hasRaw.bulkDelete(o).then((()=>U.U.setStatus(C.A4,(0,d.Z)("Removing message filters...")))),g.Z.filters.where("id").anyOf(t).delete().then((()=>U.U.setStatus(C.A4,(0,d.Z)("Finished updating database"))))]);const e={taskName:"delete_full_text_search_entries",currentPosition:0,searchListIds:r},c=await g.Z.systemTasks.add(e);a={id:c,...e}})),a?Ct(a):console.warn("removeBySourceFilterIds: Expected task to be added"),_.Z.updateFilters(t);const c=n.map((e=>{const n=new Map([...t.map((e=>[e,void 0]))]);for(const[t,i]of e.sources)n.set(t,{...i});return{id:e.id,updates:{sources:n,sourceFilterIds:e.sourceFilterIds,removedViewIds:[...s]}}})),l={removedSles:r,sleUpdates:c};return U.QO.updateIndex(l),i}class Bt extends Error{}const $t=new Map;function jt(e,t,n){switch(U.QO.setAccountIndicator(e.MAIL_EMAIL,"INDICATOR_TYPE_FLUSHING",n.current,n.total),t.operation){case"BUFFER_OPERATION_CUSTOM_FLAG":return Zi.updateFlags(e.MAIL_EMAIL,t.path,t.uids,t.flagUpdates);case"BUFFER_OPERATION_DELETE_IMAP":return Zi.deleteMessages(e.MAIL_EMAIL,t.path,t.uids);case"BUFFER_OPERATION_DELETE_POP":return gt(e,t.searchListIds);case"BUFFER_OPERATION_MOVE":return Zi.moveMessages(t.accountId,t.path,t.uids,t.destinationPath);case"BUFFER_OPERATION_COPY":return Zi.copyMessages(e.MAIL_EMAIL,t.path,t.uids,t.destinationPath);case"BUFFER_OPERATION_UPLOAD_MESSAGE":return Zi.uploadMessage(e.MAIL_EMAIL,t.path,t.searchListId,t.flags);default:return Promise.reject("Unknown batch operation '"+t.operation+"'")}}async function qt(e,t){if(e.accountType===P.s9.IMAP&&!e.offline){for(const n of t)if("Inbox"!==n)try{await Zi.selectMailbox(e.MAIL_EMAIL,n)}catch(t){k.Z.error("Mail",["syncAndPark",e.MAIL_EMAIL,n],t)}Zi.park(e.MAIL_EMAIL)}}async function Vt(e){const t=await x.Z.call(e);if(!t)return;const n=await A.Z.getBySearchListIdHasRaw(e,!1);if(0===n.length)return;const s=new Map(n.map((({accountId:e})=>[e,!1]))),a=await g.Z.imap.where("searchListId").equals(e).toArray();if(a.length>0){const n=i.Z.get(Z.kMailAccounts),r=new Set(n.filter((({accountType:e,offline:t})=>e===P.s9.IMAP&&!t)).map((({accountId:e})=>e)));for(const{accountId:n}of a){if(!s.has(n)||s.get(n))continue;if(!r.has(n))continue;U.U.setStatus(C.A4,(0,d.Z)("Fetching message with subject $1 on mail server $2",[t.subject,n]),3e3);let i=await Zi.fetchRawOfMessage(n,e);if(i){const a=await(0,L.Z)(e,t,i);a&&(i=a.raw,await R.Z.call(n,t.sentDate,e,i),await S.Z.setHasRaw(n,e)),s.set(n,!0)}}}const r=await g.Z.pop.where("searchListId").equals(e).toArray();for(const{accountId:n,uidl:i}of r){if(!s.has(n)||s.get(n))continue;const a=await I.Z.loadAccount(n);let r=await mt(a,i,e);const o=await(0,L.Z)(e,t,r);o&&(r=o.raw,await R.Z.call(n,t.sentDate,e,r),await S.Z.setHasRaw(n,e)),s.set(n,!0)}}const Qt=new Map;function Ht(e,t){return v.Z.adjustBatchSize(100,1e3,500,e,t)}const Kt=(0,F.Z)((async()=>{await async function(){const e=await g.Z.buffer.where("operation").equals("BUFFER_OPERATION_REMOVE_ACCOUNT").toArray();for(const t of e){const{accountId:e,deleteFiles:n,deletePasswords:i}=t;await Ft(e,n),T(e,i)}}(),await async function(){const e=await g.Z.buffer.where("operation").equals("BUFFER_OPERATION_REMOVE_ACCOUNT_PATH").toArray();for(const t of e){const{accountId:e,path:n,deleteFiles:i}=t;await Ut(e,n,i)}}();(await I.Z.loadAllAccounts()).forEach((e=>{const{MAIL_EMAIL:t}=e;void 0===$t.get(t)&&Wt(e)})),await async function(){const e=await g.Z.buffer.where("operation").equals("BUFFER_OPERATION_FETCH_RAW_FOR_ALL_SOURCES").toArray();for(const t of e)await Vt(t.searchListId);if(e.length>0){const t=e.map((e=>e._id));E.byIds(t);const n=e.map((e=>e.searchListId));U.QO.runStoredQueryFilters(n)}}()}),1e3);async function Wt(e,t=[]){const{MAIL_EMAIL:n}=e,i=$t.get(n)||0;$t.set(n,i);try{let s;if(await g.Z.buffer.where("accountId").equals(n).offset(i).limit(1).modify((e=>{e.isFlushing=!0,s=e})),!s)return $t.set(n,void 0),U.QO.removeAccountIndicator(n,"INDICATOR_TYPE_FLUSHING"),qt(e,t),void Qt.delete(n);if(e.offline)return await g.Z.buffer.where("_id").equals(s._id).delete(),void await Promise.resolve().then((()=>Wt(e,t)));const a="BUFFER_OPERATION_DELETE_POP"===s.operation?P.Gf:s.path,o=await r.Z.getFolderByPath(n,a);if(!o||e.accountType===P.s9.IMAP&&!o.subscribed)return k.Z.info("Mail",["flushBuffer",n,a],"Removing batch for a path that no longer exist or is not subscribed"),await g.Z.buffer.where("_id").equals(s._id).delete(),void await Promise.resolve().then((()=>Wt(e,t)));t.push(a),s.destinationPath&&t.push(s.destinationPath);const c=Qt.get(n)||Ht(100,500);if(void 0!==s.uids&&s.uids.length>c){const{uids:t}=s,{current:r=0,total:o=t.length}=s,l={current:r,total:o},d=t.slice(0,c),u={...s,uids:d},h=Date.now();try{await jt(e,u,l);const t=new Set(d);await g.Z.buffer.where("_id").equals(s._id).modify((function(e){e.uids=e.uids.filter((e=>!t.has(e))),e.uids.length>0?(e.current=r+d.length,e.total=o,e.isFlushing=!1):delete this.value}));const i=Ht(c,Date.now()-h);Qt.set(n,i)}catch(e){$t.set(n,i+1),k.Z.error("Mail",["flushBuffer",n,a],e),e instanceof Bt?await g.Z.buffer.where("_id").equals(s._id).delete():await g.Z.buffer.where("_id").equals(s._id).modify({isFlushing:!1})}}else{let t;t="BUFFER_OPERATION_DELETE_POP"===s.operation?{current:s.searchListIds.length,total:s.searchListIds.length}:{current:1,total:1};try{if(await jt(e,s,t),void 0!==s.uids){const e=new Set(s.uids);await g.Z.buffer.where("_id").equals(s._id).modify((function(t){t.isFlushing=!1,t.uids=t.uids.filter((t=>!e.has(t))),0===t.uids.length&&delete this.value}))}else await g.Z.buffer.where("_id").equals(s._id).delete()}catch(e){$t.set(n,i+1),k.Z.error("Mail",["flushBuffer",n,a],e),e instanceof Bt?await g.Z.buffer.where("_id").equals(s._id).delete():await g.Z.buffer.where("_id").equals(s._id).modify({isFlushing:!1})}}await Promise.resolve().then((()=>Wt(e,t)))}catch(i){k.Z.error("Mail",["flushBuffer",n],i),$t.set(n,void 0),U.QO.removeAccountIndicator(n,"INDICATOR_TYPE_FLUSHING"),qt(e,t)}}const Gt={call:function(){navigator.onLine&&Kt()}};var Yt=n(12382);async function Xt(e,t,n){const i=[],s=[],a=new Map,r=_.Z.getByFolderId([e,t]);return n.forEach((n=>{const{uid:i}=n;s.push([e,t,i]),a.set(i,n)})),await g.Z.transaction("rw",[g.Z.imap,g.Z.searchList,g.Z.filteringQueue,g.Z.buffer],(async()=>{const n=await g.Z.imap.where("[accountId+path+uid]").anyOf(s).toArray(),o=new Map;n.forEach((e=>{const{searchListId:t,uid:n}=e,i=a.get(n);if(!i)throw new Error("imapMessage not found");o.set(t,i)}));const c=new Yt.Z.FilteringUpdatesSorter,l=[],d=[],u=[];await g.Z.searchList.where("id").anyOf([...o.keys()]).modify((n=>{const{id:s,unseen:a,flags:h}=n,f=o.get(s),p={},g={sources:new Map},m=(0,H.jw)(f.flags);p.sources=new Map;const w=(0,H.QE)(h,m);Object.keys(w).length>0&&(!function(e,t){delete t[P.T4.RECENT];const n=u.find((e=>(0,H.ui)(e.imapFlagUpdates,t)));n?n.searchListIds.push(e):u.push({searchListIds:[e],imapFlagUpdates:t})}(s,w),p.flags=n.flags=m,(0,H.wh)(h,f.flags,s,d),(0,H.Oj)(h,f.flags,s,l));const y=n.sources.get(r.id);if(!y)return void k.Z.warn("Mail",["imapUpdateFlags"],`Source not found for ${e}, ${t}`);const v=!(0,H.FL)(f),I={};y.read!==v&&(a&&v&&(n.unseen=p.unseen=g.unseen=!1),y.read=I.read=v);for(const[t,i]of n.sources)if(i.internal){const n=_.Z.get(t)?.accountId;t!==r.id&&n===e&&v!==i.read&&(i.read=v,p.sources.set(t,{read:v}))}const E=(0,H.uY)(f);if(y.deleted!==E&&(y.deleted=I.deleted=E),Object.keys(I).length>0&&(p.sources.set(r.id,I),g.sources.set(r.id,I)),!E){const i=b.Z.getFolderType(e,t);if(![P.uT,P.Hd,P.hn].includes(i)){[...n.sources.keys()].forEach((t=>{const i=n.sources.get(t);if(!i)throw new Error("Source not found "+t);if(i.internal&&i.deleted){const i=_.Z.get(t);if(!i)throw new Error("Filter not found "+t);i.accountId===e&&(n.sources.delete(t),p.sources.set(t,void 0),g.sources.set(t,void 0))}}))}}(Object.keys(p).length>1||p.sources.size>0)&&i.push({id:s,updates:p}),(Object.keys(g).length>1||g.sources.size>0)&&c.add(s,g)}));for(const e of c.getSorted()){const{searchListIds:t,updates:n}=e;if(n.sources.size>0){const e=[[P.of,P.cm],[P.of,P.tB],[P.of,P.rp],[P.of,P.$T]];await y.Z.call({type:"FILTERS_SLES",priority:P.Un.HIGH,folderIds:e,searchListIds:t})}}for(const e of d){const{searchListIds:t,oldStandardFlag:n,newStandardFlag:i}=e,s=[];n&&s.push([P.MN,n]),i&&s.push([P.MN,i]),s.length>0&&await y.Z.call({type:"FILTERS_SLES",priority:P.Un.HIGH,folderIds:s,searchListIds:[...t]})}for(const e of l){const{searchListIds:t,flag:n}=e,i=[[P.ut,n]];await y.Z.call({type:"FILTERS_SLES",priority:P.Un.HIGH,folderIds:i,searchListIds:[...t],runLabels:!0})}for(const e of c.getSorted()){const{searchListIds:t,updates:n}=e;await y.Z.call({type:"UPDATE_SLE",priority:P.Un.HIGH,searchListIds:t,...n})}if(u.length>0){for(const{searchListIds:t,imapFlagUpdates:n}of u)await w.Z.call(t,n,e);Gt.call()}})),i}var Jt=n(89846);async function en(e,t){return await g.Z.transaction("rw",[g.Z.searchList,g.Z.messages,g.Z.threading],(async()=>{const n=(await g.Z.searchList.where("messageId").equals(e).toArray()).map((e=>e.id));await g.Z.searchList.where("id").anyOf(n).modify((e=>e.messageId=t)),await g.Z.messages.where("id").anyOf(n).modify((e=>e.messageId=t)),await g.Z.threading.where("id").anyOf(n).modify((e=>e.messageId=t))}))}async function tn(e,t,n,i){let s=[];const a=await g.Z.transaction("rw",m.E.concat([g.Z.imap,g.Z.accounts,g.Z.filters,g.Z.searchList,g.Z.filteringQueue,g.Z.buffer]),(async()=>{const a=[],o=[],c=[],l={};for(const e of i)if(e.originalMessageId){const t=e.originalMessageId;l[t]=e.messageId,await en(t,e.messageId)}if(Object.keys(l).length>0)for(const e of i)l[e.messageId]&&(e.messageId=l[e.messageId]);const d=await h.Z.findMatchingSles(i),u=await async function(e,t,n){if(e.every((({searchListEntry:e})=>!e)))return{intact:e,newImapEntries:[],sleUpdates:[]};const i={},s=await r.Z.getFolderByPath(t,n);if(!s)throw new Error(`${n} not found in db.accounts table for ${t}`);const a=s.type,o=_.Z.getByFolderId([t,n]);if(!o)throw new Error(`Filter not found for ${t} ${n}`);const c=[],l=[];for(const s of e){const{message:e,searchListEntry:r}=s;if(!r||e.sentDate!==r.sentDate||e.subject!==r.subject){l.push(s);continue}const{sourceFilterIds:d,sources:u}=r,h=u.get(o.id);if(!h||!h.internal){l.push(s);continue}const f=_.Z.getByIds(d);let p,g;for(const e of f){const{accountId:i,path:s}=e,r=i===t&&s===n;if(i===P.of&&s===P.N1&&a===P.Nz||r){p=i,g=s;break}}if(!p){l.push(s);continue}if(!g){l.push(s);continue}i[r.id]=e.uid;const{sleUpdate:m}=await(0,Jt.Z)(r.id,p,g,t,n,{addedProperties:{searchListSource:{internal:!1}}});c.push(m)}const d=[],u=[];for(const e of c)u.push(e),d.push({accountId:t,path:n,uid:i[e.id],searchListId:e.id});return{intact:l,newImapEntries:d,sleUpdates:u}}(d,e,t),{intact:f,newImapEntries:w,sleUpdates:b}=u;if(a.push(...w),c.push(...b),0===f.length){await g.Z.imap.bulkPut(a);const n=await Xt(e,t,i);return c.push(...n),{sleUpdates:c}}const{newMessageGroups:y,duplicates:v}=h.Z.findDuplicates(f);for(const n of v){const{message:i,searchListEntry:s}=n,r={accountId:e,path:t,uid:i.uid,searchListId:s.id};a.push(r)}const I=y.map((e=>e[0])),k=await(0,m.Z)(e,t,n,I),E=k.addedSles;if(s=k.forSearchDb,E.forEach(((n,i)=>{y[i].forEach((i=>{a.push({accountId:e,path:t,uid:i.uid,searchListId:n.id})})),o.push(n)})),a.length!==i.length)throw new Error("Assert error in addImap: expected imapEntries to match imapMessages");const x=await g.Z.imap.where("searchListId").anyOf(a.map((e=>e.searchListId))).toArray(),A=[];for(const e of a){p()(x,e,ne.gE)<0&&A.push(e)}await g.Z.imap.bulkAdd(A);const S=new Set(w.map((e=>e.uid))),M=i.filter((e=>S.has(e.uid))),O=await Xt(e,t,M);if(c.push(...O),v.length>0){const i=await h.Z.addSourceFilters(e,t,n,v,!1);c.push(...i)}return{addedSles:o,sleUpdates:c}}));return(0,z.Z)(s),a}const nn=async function(e,t){const n=[],i=e.map((e=>e.searchListId));return g.Z.imap.bulkAdd(e),await g.Z.searchList.where("id").anyOf(i).modify((e=>{const{id:i}=e,s={sources:new Map},a=e.sources.get(t.id);if(a)a.internal=!1,s.sources.set(t.id,{...a});else{const n={read:!1,deleted:!1,internal:!1};e.sources.set(t.id,n),s.sources.set(t.id,{...n})}n.push({id:i,updates:s})})),n};const sn=async function(e,t,n){await g.Z.buffer.where("[accountId+path+operation]").equals([e,t,"BUFFER_OPERATION_CUSTOM_FLAG"]).modify((function(e){const{uids:t,flagUpdates:i}=e,s=new Set(t);n.forEach((e=>{Object.keys(i).every((t=>i[t]?e.flags.includes(t):!e.flags.includes(t)))&&s.delete(e.uid)})),0===s.size?delete this.value:e.uids=[...s]}))};var an=n(9112),rn=n(93818);const on=async function(e){const{sources:t}=e;if(0===t.size)return Promise.resolve(!1);if(![...t.values()].every((e=>e.deleted&&e.internal)))return Promise.resolve(!0);const n=new Set,i=_.Z.getByIds([...t.keys()]);for(const e of i)n.add(e.accountId);const s=await A.Z.getBySearchListIdAccountIds(e.id,[...n]);return Promise.resolve(s.some((e=>e?.hasRaw)))};var cn=n(93043);var ln=n(89555);let dn,un,hn,fn={};function pn(){k.Z.info("Mail",["imapCache"],"Resetting init promise"),dn=new Promise(((e,t)=>{un=()=>{k.Z.info("Mail",["imapCache"],"Resolving init promise"),e()},hn=e=>{k.Z.info("Mail",["imapCache"],"Rejecting init promise"),t(e)}})),dn.catch(ln.Z)}function gn(){return k.Z.info("Mail",["imapCache"],"Initializing UID lists"),g.Z.imap.orderBy("[accountId+path+uid]").primaryKeys().then((e=>{e.forEach((e=>{const[t,n,i]=e;fn[t]||(fn[t]={}),fn[t][n]||(fn[t][n]=new Set),fn[t][n].add(i)})),un()})).catch((e=>{throw hn(e),e}))}async function mn(e){await dn;const t=await async function(e){const t=new Set,n=await r.Z.getFolder(e);for(const e of Object.keys(n)){const i=n[e];for(const e of i)t.add(e.path)}return t}(e),n=await g.Z.mailboxCache.where("accountId").equals(e).toArray(),i=fn[e]||{},s={};for(const e of n)s[e.path]=e,s[e.path].uidlist=Array.from(i[e.path]||[]),s[e.path].exists=s[e.path].uidlist.length,s[e.path].highestModseq=s[e.path].highestModseq||"0",t.delete(e.path),s[e.path].noModseq=s[e.path].noModseq||!1;for(const e of t){const t=Array.from(i[e]||[]),n=t.length>0?t[t.length-1]+1:0;s[e]={uidlist:t,uidNext:n,exists:t.length}}return s}pn();var wn=n(83065),_n=n(13248);function bn(e){const t=e.split(","),n=[];return t.forEach((e=>{if(e.indexOf(":")>=0){const[t,i]=e.split(":"),s=Number.parseInt(t),a=Number.parseInt(i);if(s<a)for(let e=s;e<=a;e++)n.push(e);else for(let e=a;e<=s;e++)n.push(e)}else{const t=Number.parseInt(e);n.push(t)}})),n}var yn=n(72315),vn=n.n(yn),In=n(91258);const kn={debug:e=>{i.Z.get(Z.kMailImapLogsOn)&&k.Z.debug("Mail",["imap-client"],...e())},info:e=>{i.Z.get(Z.kMailImapLogsOn)&&k.Z.info("Mail",["imap-client"],...e())},error:e=>{i.Z.get(Z.kMailImapLogsOn)&&k.Z.error("Mail",["imap-client"],...e())}};function En(e,t){const n=t||{user:e.MAIL_USER,pass:(0,Pe.DA)((new TextEncoder).encode(e.MAIL_PASSWORD))},s=new(vn())({host:e.MAIL_SERVER,port:Number(e.MAIL_PORT),auth:n,secure:!0,ignoreTLS:!1,id:{name:`Vivaldi Mail/${O.Z.utilities.getVersion().vivaldiVersion}`},logger:kn});return s._client.logLevel=i.Z.get(Z.kMailImapLogsOn)?In.lw:In.jF,s._client.timeoutConnection=1e4,s._client._enableCompression=!1,s}var xn=n(82164),An=n(36154);let Sn={};async function Mn(e,t){const n=await(0,An.Vf)(e,t),{accessToken:i,refreshToken:s,expiresIn:a,usernameFromIdToken:r}=n;r&&r.toLowerCase()!==e.toLowerCase()&&(Nn(e,["Username and the sub from idToken do not match",e,r]),e=r);const o=Date.now()+1e3*parseInt(a);if(Nn(e,["Fetched both refresh_token and access_token that expires in: ",On(o)]),Tn({[e]:{accessToken:i,expiryTime:o}}),s)try{const n={refreshToken:await O.Z.utilities.osCrypt(s),provider:t};Pn.call(e,n)}catch(e){k.Z.error("oAuth","Error crypting refresh_token",e)}return{accessToken:i,usernameFromIdToken:e}}function On(e){const t=new Date(e);return`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()} ${t.getHours()}:${t.getMinutes()}:${t.getSeconds()}`}function Nn(e,t){k.Z.info("oAuth",[e],t.join(" "))}async function Zn(e,t){const n=(await Rn.call())[e],s=function(e){return(i.Z.get(Z.kOauthRefreshTokens)||{})[e.toLowerCase()]}(e);if(n&&n.expiryTime>Date.now())return Nn(e,[`Valid access_token found in cache that expires in: ${On(n.expiryTime)}`]),{accessToken:n.accessToken,usernameFromIdToken:e};if(s){let n="";try{n=await O.Z.utilities.osDecrypt(s.refreshToken)}catch{return Ln(e,t)}Nn(e,["The access_token has expired in-session or we restarted the session.","Lets fetch new access_token using refresh_token from prefs"]);const i=await An.jb.call(n,t),{accessToken:a,expiresIn:r,invalidGrant:o,refreshToken:c,usernameFromIdToken:l}=i;if(c&&c!==n&&Pn.call(e,{refreshToken:await O.Z.utilities.osCrypt(c),provider:t}),o)return Nn(e,["Invalid oAuth grant. Refresh Token has expired or has been revoked"]),k.Z.warn("oAuth","Invalid oAuth grant. Refresh Token has expired or has been revoked"),Ln(e,t);{const t=Date.now()+1e3*parseInt(r);return Nn(e,[`Got new access token with new expiry time: ${On(t)}\n        (fetched with stored refresh_token)`]),Tn({[e]:{accessToken:a,expiryTime:t}}),{accessToken:a,usernameFromIdToken:l}}}return Nn(e,["We don't have a cached token and we don't have a refresh token.","Need to fetch both."]),await Mn(e,t)}function Tn(e){Sn={...Sn,...e}}async function Ln(e,t){return Cn.call(e),Mn(e,t)}const Rn={call:function(){return Sn}},Pn={call:async function(e,t){M.Z.set(Z.kOauthRefreshTokens,{...i.Z.get(Z.kOauthRefreshTokens),[e]:t})}},Cn={call:async function(e){const t={...i.Z.get(Z.kOauthRefreshTokens)},{provider:n}=t[e],s=xn.Z.oAuthProviders().get(n),a=(await Rn.call())[e];if(s?.revokeRefreshToken&&a){const{accessToken:e}=a;s.revokeRefreshToken(e)}!function(e){delete Sn[e]}(e),delete t[e.toLowerCase()],M.Z.set(Z.kOauthRefreshTokens,t)}};var Un=n(6271);async function Fn(e){const{accessToken:t}=await Zn(e.MAIL_EMAIL,(0,Un.dn)(e));return{user:e.MAIL_EMAIL,xoauth2:t}}var Dn=n(35874);const zn=new Map,Bn=new Map,$n=new Set,jn=new Map,qn=new Map,Vn=18e5,Qn=9e5,Hn={},Kn={},Wn=new Set;let Gn=!1,Yn=!1;const Xn=new Map;let Jn,ei=!1,ti=!1;const ni=500,ii=new Map,si=new class{constructor(e){this.lock=(0,l.M)(),this._priorityQueue=[];for(let t=0;t<e;t++)this._priorityQueue.push([])}queue(e,t,...n){return new Promise(((i,s)=>{this._priorityQueue[t].push({func:e,resolve:i,reject:s,params:n}),this._processQueue()}))}async _processQueue(){const e=await this.lock();try{await this._runNextInLine()}finally{e()}}async _runNextInLine(){for(const e of this._priorityQueue){const t=e.shift();if(t){const{func:e,resolve:n,reject:i,params:s}=t;try{n(await e(...s))}catch(e){i(e)}return!0}}return!1}}(Object.keys(P.NB).length);let ai=!1;function ri(e){if(!navigator.onLine){const e=(0,d.Z)("No network connection");throw new Error(e)}if(i.Z.get(Z.kMailIsTurnedOff))throw new Error((0,d.Z)("Mail has been turned off"));const t=(i.Z.get(Z.kMailAccounts)||[]).find((t=>t.MAIL_EMAIL===e));if(!t)throw new Error((0,d.Z)("Account has been deleted"));if(t.offline)throw new Error((0,d.Z)("Account is offline"));const n=zn.get(e);if(n)return n;if(Bn.has(e))throw(0,d.Z)("Is logging into mail account $1",[e]);throw U.U.setStatus(C.A4,(0,d.Z)("Reconnecting $1",[e])),ki(e),(0,d.Z)("Not connected to $1 - Attempting to connect",[e])}function oi(e){e!==P.of&&($n.add(e),li())}function ci(e){k.Z.error("Mail",["imap"],e)}const li=(0,F.Z)((async()=>{const e=[...$n];$n.clear();for(const t of e){const[e]=b.Z.getPathsByType(t,P.e9);if(!e)return void k.Z.warn("Mail",["imap",t],"No inbox found to park in");if(zn.has(t))try{await di(t,e,!0)}catch(e){ci(e)}}}),2e3);function di(e,t,n=!1){if(!navigator.onLine)return Promise.reject((0,d.Z)("No network connection"));Hn[e]||(Hn[e]=[]);const i=Hn[e];return new Promise(((a,r)=>{n?0!==i.length&&i[0].path===t||i.unshift({path:t,resolve:a,reject:r}):i.find((e=>e.path===t))||i.push({path:t,resolve:a,reject:r}),Kn[e]||(Kn[e]=!0,s())}));async function s(){const t=Hn[e];if(!t||t.length<=0)return void(Kn[e]=!1);const{path:n,resolve:i,reject:a}=t.pop();try{const t=ri(e);await t.selectMailbox({path:n}),i()}catch(e){a(e)}finally{U.QO.removePathIndicator(e,n),s()}}}async function ui(e,t){const n=await g.Z.imap.where("searchListId").equals(t).filter((t=>t.accountId===e)).toArray();if(0===n.length)return;const i=new Map(n.map((({path:e,uid:t})=>[e,t]))),s={accountId:e,pathToUid:i,size:0,searchListId:t};return(await si.queue(hi,P.NB.FETCH_RAW,e,[s])).get(t)}async function hi(e,t){const n=new Map;if(0===t.length)return n;if(!navigator.onLine)throw new Error((0,d.Z)("No network connection"));const i=new Set;for(const{pathToUid:e}of t)for(const t of e.keys())i.add(t);try{for(const s of[...i]){const i=new Map;for(const{searchListId:e,pathToUid:a}of t){if(n.has(e))continue;const t=a.get(s);void 0!==t&&i.set(t,e)}if(0===i.size)continue;const a=[...i.keys()],r=ri(e),o=await r.getMessages({path:s,uids:a});Object.keys(o).forEach((t=>{const a=i.get(parseInt(t));a?o[t]?n.set(a,o[t]):ci(`Expected to find raw for ${e}/${s}/${t}`):ci(`Un-expected uid ${e}/${s}/${t}`)}))}return oi(e),n}catch(t){throw U.U.setStatus(C.A4,(0,d.Z)("Failed to get message body - $1",[t])),k.Z.warn("Mail",["imap",e],"Fetch raw",t),t}}async function fi(e,t,n,s,a){if(!navigator.onLine)throw new Error((0,d.Z)("No network connection"));const r=ri(e),o=function(e){const t=[...e];let n;t.sort(((e,t)=>e-t));const i=[];for(const e of t)n&&n[n.length-1]===e-1?n.push(e):(n=[e],i.push(n));const s=i.map((e=>1===e.length?e[0]:e[0]+":"+e[e.length-1]));return s.join(",")}(n),c=await r.listMessages({path:t,sequence:o});i.Z.get(Z.kMailAutoGenerateContacts)&&await(0,Nt.Z)(e,t,c);const l=b.Z.getFolderType(e,t),u=await tn(e,t,l,c);ti=!1,U.QO.updateIndex(u),me.filter(),Re.updateThreads();const{addedSles:h,sleUpdates:f}=u;(h&&h.length>0||f&&f.length>0)&&(U.U.setStatus(C.A4,(0,d.Z)("Indexing mail $1 $2 $3/$4",[e,t,a,s])),U.QO.setPathIndicator(e,t,"INDICATOR_TYPE_FETCHING",P.NB.SYNC_NEW_DELETED,a,s));!function(e,t,n){if(fn[e]||(fn[e]={}),fn[e][t]){const i=[...fn[e][t],...n].sort(((e,t)=>e-t));fn[e][t]=new Set(i)}else fn[e][t]=new Set(n)}(e,t,c.map((e=>e.uid)))}function pi(e){if(i.Z.get(Z.kMailIsTurnedOff))return!1;const t=(i.Z.get(Z.kMailAccounts)||[]).find((t=>t.MAIL_EMAIL===e));return!!t&&!t.offline}function gi(e){if(i.Z.get(Z.kMailIsTurnedOff)||Yn)return!1;const t=(i.Z.get(Z.kMailAccounts)||[]).find((t=>t.MAIL_EMAIL===e));return!!t&&!t.offline&&t.preFetch}async function mi(e,t,n,i){let s=100,a=0;const r=new v.Z.BatchSizeOptimizer(100,2e3);return new Promise(((o,c)=>{si.queue((async function l(){if(!pi(e))return void o();const d=t.slice(a,a+s);if(0===d.length)return void o();const u=Date.now();try{await i(d,t.length,a),a+=s}catch(e){return void c(e)}const h=Date.now();s=r.optimize(s,h-u),si.queue(l,n)}),n)}))}async function wi(e,t){if(!navigator.onLine)throw new Error((0,d.Z)("No network connection"));U.U.setStatus(C.A4,(0,d.Z)("Indexing - $1 $2",[e,t.path]));const{list:n,path:i,type:s}=t;try{if("new"===s){k.Z.log("Mail",["imap",e],"new messages received",i,n),n.reverse();try{U.QO.setSyncing(e,!0),await mi(e,n,P.NB.SYNC_NEW_DELETED,(async(t,n,s)=>{await fi(e,i,t,n,s)}))}finally{U.QO.setSyncing(e,!1)}await Mi(e)}else if("deleted"===s){if(k.Z.log("Mail",["imap",e],"messages deleted on server",i,n),await mi(e,n,P.NB.SYNC_NEW_DELETED,(async t=>{await async function(e,t,n){const i=n.map((n=>[e,t,n])),s=[];let a=[];const r=[],o=new Yt.Z.FilteringUpdatesSorter,c=_.Z.getByFolderId([e,t]);await g.Z.transaction("rw",[g.Z.searchList,g.Z.messages,g.Z.buffer,g.Z.imap,g.Z.filteringQueue,g.Z.hasRaw,g.Z.threading,g.Z.viewIds],(async()=>{await g.Z.imap.where("[accountId+path+uid]").anyOf(i).modify(((e,t)=>{s.push(e.searchListId),delete t.value}));const l=[];await g.Z.searchList.where("id").anyOf(s).modify((n=>{const{id:i}=n,s={};s.sources=new Map;const r=n.sources.get(c.id);if(r){const a=[P.uT,P.Hd,P.hn],l=b.Z.getFolderType(e,t),d=a.includes(l);let u=!1,h=!1;for(const t of[...n.sources.keys()]){const n=_.Z.get(t);if(!n)throw new Error("Filter not found "+t);if(n.accountId!==e)continue;const i=b.Z.getFolderType(n.accountId,n.path);a.includes(i)?h=!0:u=!0}const f={sources:new Map};let p=!1;!u||!d&&h?(r.deleted=!0,r.internal=!0,f.sources.set(c.id,{...r}),s.sources.set(c.id,{...r})):(n.sources.delete(c.id),p=!0,f.sources.set(c.id,void 0),s.sources.set(c.id,void 0)),o.add(i,f,p)}const d=0===n.sources.size||[...n.sources.values()].every((e=>e.internal));d&&l.push(n),(Object.keys(s).length>1||s.sources.size>0)&&a.push({id:i,updates:s})}));for(const e of l)if(!await on(e)){const{id:t}=e;r.push(t)}if(r.length>0){await cn.Z.call(r);const e=new Set(r);a=a.filter((({id:t})=>!e.has(t)))}await E.byUids(e,t,n);for(const e of o.getSorted()){const{searchListIds:t,updates:n,rerunFiltering:i}=e;i?await y.Z.call({type:"RE_RUN_SLES",priority:P.Un.NORMAL,searchListIds:t,folderIds:[[P.of,P.cm],[P.of,P.rp]]}):await y.Z.call({type:"FILTERS_SLES",priority:P.Un.NORMAL,searchListIds:t,folderIds:[[P.of,P.cm],[P.of,P.rp]]}),await y.Z.call({type:"UPDATE_SLE",priority:P.Un.NORMAL,searchListIds:t,...n})}})),r.length>0&&await kt.Z.deleteMessages(r),await U.QO.updateIndex({sleUpdates:a,removedSles:r})}(e,i,t)})),b.Z.getFolderType(e,i)!==P.uT){const t=b.Z.getPathsByType(e,P.uT);try{for(const n of t)di(e,n)}catch(e){ci(e)}finally{oi(e)}}}else if("messages"===s){k.Z.log("Mail",["imap",e],"flag updates from server",i,n);try{U.QO.setSyncingFlags(e,!0),await mi(e,n,P.NB.SYNC_FLAGS,(async(t,n,s)=>{await async function(e,t,n,i,s){await sn(e,t,n);const a=await Xt(e,t,n);U.QO.updateIndex({sleUpdates:a}),U.U.setStatus(C.A4,(0,d.Z)("Updating flags $1 $2 $3/$4",[e,t,s,i])),U.QO.setPathIndicator(e,t,"INDICATOR_TYPE_FLAGS",P.NB.SYNC_FLAGS,s,i)}(e,i,t,n,s)}))}finally{U.QO.setSyncingFlags(e,!1)}}if(pi(e)){const t=ri(e);!function(e,t,n){"inbox"===t.toLowerCase()&&(t=P.Gf),dn.then((()=>g.Z.transaction("rw",g.Z.mailboxCache,(()=>{Object.keys(n).forEach((i=>{const s=n[i];i!==t&&0!==s.exists||g.Z.mailboxCache.put({accountId:e,path:i,uidNext:s.uidNext,highestModseq:s.highestModseq||"0",noModseq:s.noModseq||!1})}))}))))}(e,i,t.mailboxCache)}U.U.setStatus(C.A4,(0,d.Z)("Finished indexing - $1 $2",[e,i]),P.QM)}catch(e){ci(e),U.U.setStatus(C.A4,(0,d.Z)("Failed indexing - $1",[e]))}U.QO.removePathIndicator(e,i),U.QO.removePathIndicator(e,i),me.filter()}function _i(e,t){if(U.KU.set(e,"IMAP",t,t.code),(0,_n.dS)(e)&&"The user did not approve access."===t.message)k.Z.info("Mail",["imap",e],"User closed oAuth popup dialog");else if((0,Dn.I)(t.code))k.Z.info("Mail",["imap",e],"Authentication failed"),Xn.delete(e),U.QO.setDisconnected(e,!0);else{t.code?(k.Z.info("Mail",["imap",e],"Error",t.code,t.message||t),U.U.setStatus(C.A4,`[${t.code}] ${t.message||t}`)):(k.Z.info("Mail",["imap",e],"Error",t.message||t),U.U.setStatus(C.A4,`${t.message||t}`));const n=function(e){let t=Xn.get(e)||0;if(++t<=5)return Xn.set(e,t),2e3*t;let n=jn.get(e);n=void 0===n?6e4:Math.min(n+Qn,Vn),jn.set(e,n);const i=Math.floor(1e3*Math.random()*6-3e3);return n+i}(e);ki(e,n,t)}}async function bi(){const e=await I.Z.loadImapAccounts();if(e)for(const t of e)await yi(t);else k.Z.warn("Mail",["imap"],"No IMAP accounts found!")}async function yi(e){const t=e.MAIL_EMAIL;if(k.Z.info("Mail",["imap",t],"connectImapclient"),e.isDeleted||e.offline)return void k.Z.info("Mail",["imap",t],"deleted or offline",!!e.isDeleted,!!e.offline);if(!navigator.onLine)return k.Z.info("Mail",["imap",t],"No network connection"),void U.QO.setDisconnected(t,!0);if(!e.MAIL_PORT||e.MAIL_PORT<=0)throw new Error(`Port missing or invalid: ${e.MAIL_PORT||""}`);if((await g.Z.systemTasks.toArray()).some((e=>"restore_mail_db"===e.taskName)))k.Z.warn("Mail",["imap",t],"Not connecting while restoration in progress");else if(zn.has(t))k.Z.info("Mail",["imap",t],"Already connected");else if(Bn.has(t))k.Z.info("Mail",["imap",t],"Currently being connected");else{try{Bn.set(t);let n=!1;const i=setTimeout((()=>{throw Bn.delete(t),n=!0,new Error(`IMAP client initialization for ${t} timed out`)}),1e4);let s;if(k.Z.info("Mail",["imap",t],"Creating client"),e.useOAuth){s=En(e,await Fn(e))}else s=En(e);s.onSyncUpdate=wi.bind(null,t),s.onError=e=>{_i(t,e)},k.Z.info("Mail",["imap",t],"Fetching mailbox cache");const a=await mn(t);if(s.mailboxCache=a||{},n)return;if(clearTimeout(i),!Bn.has(t))return;if(Bn.set(t,s),U.QO.setAccountIndicator(t,"INDICATOR_TYPE_CONNECTING"),U.QO.setConnecting(t,!0),k.Z.info("Mail",["imap",t],"Connecting"),await s.login(),!Bn.has(t))return;k.Z.info("Mail",["imap",t],"Connected"),U.U.setStatus(C.A4,(0,d.Z)("Connected to $1",[t]),P.QM);const c=u.Z.get(t);c&&0===Object.keys(c.folders).length&&await async function(e){const t=await e.listWellKnownFolders();for(const n of[P.e9,P.Nz,P.uT])if(Array.isArray(t[n])&&t[n].length>0){const{path:i,subscribed:s}=t[n][0];s||await e.subscribeMailbox({path:i})}}(s);const l=await s.listWellKnownFolders();if(!Bn.has(t))return;l.Inbox&&l.Inbox.forEach((e=>{"inbox"===e.path.toLowerCase()&&(e.path=P.Gf)})),await r.Z.addFolders(t,l),await u.Z.updateAccount(t,{folders:l});const h=await o.Z.foldersToFilters(t,l);_.Z.updateFilters(h),J.Z.addFolders(t,l),k.Z.info("Mail",["imap",t],"Clean up after connection"),jn.delete(t),Ei(t),Xn.delete(t),Bn.has(t)&&(zn.set(t,s),U.QO.setDisconnected(t,!1),U.KU.delete(t,"IMAP"),Gt.call())}catch(e){_i(t,e)}finally{Bn.delete(t),U.QO.setConnecting(t,!1),U.QO.removeAccountIndicator(t,"INDICATOR_TYPE_CONNECTING")}if(zn.has(t))try{await Ai(t),Mi(t)}catch(e){ci(e)}}}async function vi(){for(const e of[...Bn.keys(),...zn.keys()])await Ii(e)}async function Ii(e,t){const n=zn.get(e)||Bn.get(e);if(k.Z.info("Mail",["imap",e],"Disconnect",!!n),delete Hn[e],delete Kn[e],Ei(e),Bn.has(e)&&(k.Z.info("Mail",["imap",e],"Client initialization cancelled"),Bn.delete(e)),zn.has(e)&&(k.Z.info("Mail",["imap",e],"Client disconnected"),zn.delete(e)),U.QO.setDisconnected(e,!0),U.QO.removeAllIndicators(e),t&&U.KU.set(e,"IMAP",t,t.code),n)try{n.onSyncUpdate=!1,n.onError=ln.Z,await n.logout()}catch(t){ci(t)}finally{k.Z.info("Mail",["imap",e],"Logged out")}}async function ki(e,t,n){async function s(){if(!navigator.onLine)return void k.Z.info("Mail",["imap",e],"No network. Skip reconnection attempt");const t=(await I.Z.loadImapAccounts()).find((t=>t.MAIL_EMAIL===e));k.Z.info("Mail",["imap",e],"Reconnect",t),t&&await yi(t)}i.Z.get(Z.kMailIsTurnedOff)?k.Z.info("Mail",["imap",e],"Mail was turned off"):(await Ii(e,n),t?function(e,t,n){if(qn.has(n))return void k.Z.info("Mail",["imap",n],"Has reconnect timeout");k.Z.info("Mail",["imap",n],"Set reconnect timeout");const i=setTimeout(e,t);qn.set(n,i)}(s,t,e):await s())}function Ei(e){const t=qn.get(e);void 0!==t&&(clearTimeout(t),qn.delete(e))}function xi(){return 0===zn.size}function Ai(e){if(xi()||e&&!zn.has(e))return Promise.resolve();let t;return t=e?r.Z.getFolder(e).then((t=>({[e]:{folders:t}}))):I.Z.loadImapAccounts().then((e=>r.Z.getAll().then((t=>{const n={};for(let i=0;i<e.length;i++){const s=e[i],a=t.find((e=>s.MAIL_EMAIL===e.accountId));a&&(n[a.accountId]={folders:a.folders})}return n})))),t.then((e=>{const t=c.Z.getFolders(e,!1);Promise.all(t.map((e=>{const t=e.accountId,i=e.children;if(!i||i.length<=0)return Promise.resolve();i.sort(((e,t)=>e.type===t.type?0:"Inbox"===e.type?1:"Inbox"===t.type?-1:"All"===e.type?1:"All"===t.type?-1:0)),Promise.all(n(t,i)).catch(ci).then((()=>oi(t)))})))}));function n(e,t){let i=[];for(const s of t)s.subscribed&&i.push(di(e,s.path)),s.children&&(i=i.concat(n(e,s.children)));return i}}async function Si(e){xi()||e&&!zn.has(e)?await bi():Ai(e)}function Mi(e){Wn.add(e),Oi()}function Oi(){if(Gn||Yn)return;Gn=!0;const e=[...Wn];Wn.clear();let t=!1;e.reduce(((e,n)=>e.then((()=>async function(e){if(!gi(e))return;k.Z.log("Mail",["imap","prefetch",e],"starting"),t=!1;let n=0;const i=[],s=200;let a;try{U.QO.setPreFetching(e,!0);let t=!0;for(;t;)t=await si.queue(r,P.NB.PRE_FETCH)}finally{U.QO.setPreFetching(e,!1)}t&&U.QO.removeAccountIndicator(e,"INDICATOR_TYPE_PRE_FETCHING");async function r(){if(!gi(e))return t&&(k.Z.log("Mail",["imap","prefetch",e],"stopped"),U.U.setStatus(C.A4,(0,d.Z)("Stopped prefetching - $1",[e])),k.Z.log("Mail",["imap","countWithNoRaw"],"resetting"),Jn=void 0,ii.clear(),ti=!1),!1;if(i.length<s&&await g.Z.transaction("r",[g.Z.hasRaw,g.Z.imap,g.Z.searchList],(async()=>{const t=await A.Z.getByAccountIdHasRaw(e,!1,5*s,a);if(0===t.length)return;const n=t[t.length-1];a=[0,e,n.searchListId];const r=t.map((({searchListId:e})=>e)),o=await g.Z.imap.where("searchListId").anyOf(r).filter((t=>t.accountId===e)).toArray();let c;for(const t of o){const{searchListId:n,path:s,uid:a}=t;if(c&&c.searchListId===n)c.pathToUid.set(s,a);else{const t=await g.Z.searchList.get(n);c={accountId:e,pathToUid:new Map([[s,a]]),size:t.size,searchListId:n},i.push(c)}}})),0===i.length)return k.Z.log("Mail",["imap","prefetch",e],"done"),t&&U.U.setStatus(C.A4,(0,d.Z)("Finished prefetching - $1",[e])),!1;const r=i.shift();let o=r.size,c=o?0:1;const l=32768,u=10,h=[r];for(;i.length>0&&o<l&&c<u;){const e=i.shift();h.push(e),e.size?o+=e.size:c++}k.Z.log("Mail",["imap","prefetch",e],"fetching batch",h.length),async function(){if(ei||ti)return;ei=!0,k.Z.log("Mail",["imap","countWithNoRaw"],"starting");try{for(;ei;)ei=await e();ti=!0}catch(e){ci(e)}finally{ei=!1}async function e(){if(!Gn)return k.Z.log("Mail",["imap","countWithNoRaw"],"stopped"),!1;const e=Date.now(),t=Jn?await g.Z.hasRaw.where("[searchListId+accountId]").above(Jn).until((()=>Date.now()-e>ni)).toArray():await g.Z.hasRaw.orderBy("[searchListId+accountId]").until((()=>Date.now()-e>ni)).toArray();if(0===t.length)return k.Z.log("Mail",["imap","countWithNoRaw"],"done"),!1;k.Z.log("Mail",["imap","countWithNoRaw"],"counting batch",t.length);for(const{searchListId:e,accountId:n,hasRaw:i}of t){if(0===i){const e=ii.get(n)||0;ii.set(n,e+1)}Jn=[e,n]}return!0}}();const f=await async function(e,t){const n=await hi(e,t),i=await(0,an.Z)(Array.from(n.keys())),s=new Map;for(const e of i)s.set(e.id,e);const a=[];for(let[i,r]of n){const n=s.get(i);if(n)try{const{sentDate:t}=n,s=await(0,L.Z)(i,n,r);if(s){r=s.raw;const e=(0,Ue.Q)(s.bodyParts);await(0,we.Z)(i,e),U.QO.updateIndex({sleUpdates:[{id:i,updates:{preview:e}}]})}await R.Z.call(e,t,i,r),a.push(i)}catch(t){k.Z.error("Mail",["imap",e,i],"Failed to process mail: ",t)}else{const n=t.find((({searchListId:e})=>e===i));if(n){const t=[];for(const[s,a]of n.pathToUid)t.push([e,s,a]),k.Z.warn("Mail",["imap",e],`fetchRawFromImapEntries: Expected message ${i} to exist, deleting imap entry ${s}/${a}`);await g.Z.imap.bulkDelete(t);const s=[n.searchListId,n.accountId];await g.Z.hasRaw.delete(s)}}}return S.Z.setHasRaws(e,a)}(e,h);t=!0,n+=f;const p=ti?(0,d.Z)("Prefetching - $1 $2/$3",[e,n,ii.get(e)??""]):(0,d.Z)("Prefetching - $1",[e]);return U.U.setStatus(C.A4,p),U.QO.setAccountIndicator(e,"INDICATOR_TYPE_PRE_FETCHING",P.NB.PRE_FETCH,n,ti?ii.get(e):0),U.QO.runStoredQueryFilters(h.map((e=>e.searchListId))),!0}}(n).catch((e=>{U.U.setStatus(C.A4,(0,d.Z)("Error prefetching - $1",[n])),U.QO.removeAllIndicators(n),ci(`Error prefetching ${n} ${e}`)}))))),Promise.resolve()).then((()=>{Gn=!1,Wn.size>0&&Oi()}))}const Ni={setCheckInterval:function(e,t){ai&&clearInterval(ai),ai=!!e&&setInterval(Ai,6e4*t)},fetchRawOfMessage:ui,connectIMAPClient:yi,connectIMAPClients:bi,disconnectIMAPClient:Ii,reconnectIMAPClient:ki,reconnectIMAPClients:async function(){i.Z.get(Z.kMailIsTurnedOff)||(await vi(),await bi())},disconnectIMAPClients:vi,checkNewDeletedModified:function(e,t){di(e,t).catch(ci).then((()=>oi(e)))},rescanUnreadFlags:function(e,t){const n=ri(e).mailboxCache[t];n&&(n.highestModseq="0",di(e,t).catch(ci).then((()=>oi(e))))},checkForMail:Si,preFetch:Mi,subscribeMailbox:async function(e){const{accountId:t,path:n}=e,i=ri(t);await i.subscribeMailbox({path:n}),ki(t)},unsubscribeMailbox:async function(e,t){if(!c.Z.isUnsubscribable(e))throw new Error(`Folder ${e.accountId}/${e.path} can not be unsubscribed.`);const{accountId:n,path:i}=e,s=ri(n);await s.unsubscribeMailbox({path:i}),t&&function(e,t){delete fn[e][t]}(n,i),ki(n)},createMailbox:async function(e,t){try{t=(0,wn.y3)(t);const n=ri(e),i=async()=>{await n.createFolder({path:t}),await n.subscribeMailbox({path:t})};await i(),ki(e)}catch(n){k.Z.error("Mail",["imap",e,t,"create mailbox"],n.message||n)}},deleteMailbox:async function(e,t){try{const n=ri(e),i=async()=>{await n.unsubscribeMailbox({path:t}),await Ut(e,t,!0),await n.deleteFolder({path:t})};await i(),ki(e)}catch(n){k.Z.error("Mail",["imap",e,t,"delete mailbox"],n.message||n)}}};self.addEventListener("message",(async function({origin:e,data:t,source:n}){if(e!==C.oP||!t||!t.imap)return;const{promiseId:i,func:s,args:a=[]}=t.imap;if(s)try{const e=await Ni[s](...a),t=e&&"fetchRawOfMessage"===s?[e.buffer]:void 0;n.postMessage({imap:{promiseId:i,results:e}},{transfer:t})}catch(e){const t=e.message||e;n.postMessage({imap:{promiseId:i,error:t}})}}),!1);const Zi={checkForMail:Si,copyMessages:async function(e,t,n,i){const s={path:t,uids:n,destination:i},a=[e,i],r=_.Z.getByFolderId(a);if(!r)throw new Error("Destination filter not found for "+a.join(", "));const o=await g.Z.imap.where("[accountId+path+uid]").anyOf(n.map((n=>[e,t,n]))).toArray(),c=new Map(o.map((e=>[e.uid,e]))),l=ri(e),d=await l.copyMessages(s);if(!d)return void k.Z.warn("Mail",["imap",e],"UIDPLUS not supported, cannot create imap entries");const{srcSeqSet:u,destSeqSet:h}=d,f=bn(u),p=bn(h);let m;await g.Z.transaction("rw",[g.Z.imap,g.Z.searchList],(async()=>{const n=[];f.forEach(((s,a)=>{const r=p[a],o=c.get(s);o?n.push({...o,path:i,uid:r}):k.Z.warn("Mail",["imap",e],"cannot create imap entry for "+JSON.stringify([t,s]))})),m=await nn(n,r)})),m&&U.QO.updateIndex({sleUpdates:m})},deleteMessages:async function(e,t,n){const i={path:t,uids:n};return ri(e).deleteMessages(i)},disconnectIMAPClient:Ii,fetchRawOfMessage:ui,moveMessages:function(e,t,n,i){const s={path:t,uids:n,destination:i};return ri(e).moveMessages(s)},park:oi,selectMailbox:di,updateFlags:function(e,t,n,i){const s=[],a=[];for(const[e,t]of Object.entries(i))t?s.push(e):a.push(e);const r={path:t,uids:n,add:s,remove:a};return ri(e).updateFlags(r)},uploadMessage:async function(e,t,n,i){const s=await(0,rn.Z)(n);if(!s)throw new Bt(`Entry ${n} not found in searchList table`);const a=await xt.Z.call(e,n,s.sentDate);if(!a)throw new Bt(`Can not upload message ${n} as raw file was not found on disk`);(await A.Z.getBySearchListId(n)).find((e=>e.hasRaw))||k.Z.warn("Mail",["imap",e,t,n],"imap.js: Data inconsistency, raw file found on disk contrary to hasRaw table");const r=(0,Pe.DA)(a),o=[e,t],c=_.Z.getByFolderId(o);if(!c)throw new Error("Destination filter not found for "+o.join(", "));const l=ri(e),d=i.indexOf(P.T4.RECENT);d>-1&&i.splice(d,1);const u=await l.uploadMessage({path:t,message:r,flags:i});if(oi(e),!u)return void k.Z.warn("Mail",["imap",e],"UIDPLUS not supported, cannot create imap entry");const h=Number.parseInt(u);let f;await g.Z.transaction("rw",[g.Z.imap,g.Z.searchList,g.Z.hasRaw],(async()=>{const i={accountId:e,path:t,uid:h,searchListId:n};f=await nn([i],c);const s={searchListId:n,accountId:e,hasRaw:1};await g.Z.hasRaw.put(s)})),f&&U.QO.updateIndex({sleUpdates:f})},pausePrefetching:function(e){k.Z.log("Mail",["imap","prefetch"],e?"pause possible prefetching":"resume possible prefetching"),Yn=e}};var Ti=n(78134),Li=n(85834),Ri=n(95064);const Pi=[{listId:"meetup.com",name:"meetup.com",parentFolderType:"endsWith",subFolderType:"title",isIgnored:!1},{listId:"facebook.com",name:"facebook.com",parentFolderType:"endsWith",subFolderType:"title",isIgnored:!1},{listId:"github.com",name:"github.com",parentFolderType:"endsWith",subFolderType:"title",isIgnored:!1},{listId:"google.com",name:"google.com",parentFolderType:"endsWith",subFolderType:"senderName",isIgnored:!1},{listId:"googlegroups.com",name:"googlegroups.com",parentFolderType:"endsWith",subFolderType:"title",isIgnored:!1},{listId:"groupon",name:"groupon",parentFolderType:"endsWith",subFolderType:"senderName",isIgnored:!1},{listId:"xt.local",name:"xt.local",parentFolderType:"endsWith",subFolderType:"host",isIgnored:!1},{listId:"sparkpostmail.com",name:"sparkpostmail.com",parentFolderType:"endsWith",subFolderType:"host",isIgnored:!1},{listId:"substack.com",name:"substack.com",parentFolderType:"endsWith",subFolderType:"senderName",isIgnored:!1},{listId:"list-id.mcsv.net",name:"list-id.mcsv.net",parentFolderType:"endsWith",subFolderType:"host",isIgnored:!1},{listId:"spc-",name:"sparkpostmail.com (spc-)",parentFolderType:"startsWith",subFolderType:"host",isIgnored:!1},{listId:"MAILING_LIST_GROUPS_UNCATEGORIZED",name:"",parentFolderType:"uncategorized",subFolderType:"host",isIgnored:!1}];var Ci=n(65741);const Ui="Contacts";class Fi{count=0;constructor(e,t){this.version=e,this.interval=setInterval((()=>this.total&&U.U.setStatus(C.A4,`Upgrade v${e} mail: ${t} ${this.count} / ${this.total}`)),1e3),k.Z.info("Mail","Upgrade started: ",e)}stop(){clearInterval(this.interval),U.U.setStatus(C.A4,`Upgrade v${this.version} mail: Finalizing...`,5e3),k.Z.info("Mail","Upgrade finished: ",this.version)}}g.Z.on("populate",(()=>{g.Z.filters.bulkAdd(Ri.j),g.Z.mailingList.bulkAdd(Pi),g.Z._upgrades.add({version:g.Z.verno})})),g.Z.version(136).stores({messages:"++id",searchList:["++id","messageId","*sourceFilterIds"].join(","),threading:["++id","*references","inReplyTo","messageId"].join(","),accounts:"accountId",mailboxCache:"[accountId+path],accountId",filters:"++id,&[accountId+path]",buffer:["++_id","[accountId+path+operation]","accountId","[accountId+path]","operation","[accountId+destinationPath+operation]"].join(","),views:"++id,filterId",imap:["[accountId+path+uid]","searchListId","[hasRaw+accountId+searchListId]","[accountId+path+searchListId]","accountId"].join(","),pop:"[accountId+uidl],searchListId,accountId",filteringQueue:"++id,priority",threadingQueue:"++id",viewIds:"searchListId,*viewIds",flaggingQueue:"++id",drafts:null,tokens:null,folders:null}).upgrade((e=>{e.messages.clear(),e.searchList.clear(),e.threading.clear(),e.accounts.clear(),e.mailboxCache.clear(),e.filters.clear(),e.buffer.clear(),e.views.clear(),e.imap.clear(),e.pop.clear(),e.filteringQueue.clear(),e.threadingQueue.clear(),e.viewIds.clear(),e.flaggingQueue.clear()}));const Di=new Map;g.Z.version(137).stores({_upgrades:"version"}),Di.set(137,(async e=>{new Fi(137,"Upgrade v137 mail").stop()})),Di.set(138,(async e=>{const t=new Fi(138,"Upgrade v138 mail: Run Custom Folder");await e.filteringQueue.add({priority:P.Un.LOW,type:"RUN_FILTERS",folderIds:[[P.Ry,P.ym]],updateFilters:!0}),t.stop()})),Di.set(139,(async e=>{const t=new Fi(139,"Upgrade v139 mail: Repair default filters"),n=[],i=["total","unseen","unread","excludeMailingLists","excludeDeleted","excludeRssFeeds","excludeJunk","excludeCustomFolders"];for(const t of Ri.j){const{accountId:s,path:a}=t,r=await e.filters.where("[accountId+path]").equals([s,a]).first();if(r){const{id:s}=r,a={id:s,...t};await e.filters.put(a);const o=await e.views.where("filterId").equals(s).toArray(),c=new Set(o.map((e=>e.type)));for(const t of i)if(!c.has(t)){const n={filterId:s,type:t};e.views.add(n)}n.push(s)}else{const s=await e.filters.add(t);for(const t of i)await e.views.add({filterId:s,type:t});n.push(s)}}if(n.length>0){const t={priority:P.Un.LOW,type:"RUN_FILTERS",filterIds:n};e.filteringQueue.add(t)}t.stop()})),Di.set(140,(async e=>{const t=new Fi(140,"Map viewIds to new format");t.total=await e.viewIds.count()+await e.views.count();const n=new Map,i=["total","unseen","unread","excludeMailingLists","excludeDeleted","excludeRssFeeds","excludeJunk","excludeCustomFolders"];await e.views.each((e=>{const s=i.indexOf(e.type);-1!==s&&n.set(e.id,100*e.filterId+s),t.count++})),await e.viewIds.toCollection().modify((e=>{const i=new Set;e.viewIds.forEach((e=>{const t=n.get(e);"number"==typeof t&&i.add(t)})),e.viewIds=[...i],t.count++})),e.views.clear(),t.stop()})),g.Z.version(141).stores({deletedFeedItems:"++id,path"}),Di.set(142,(async e=>{const t=new Fi(142,"Fixing default parent filters");let n,i,s,a,r,o;function c(e,t){const{include:n}=e.filterValue;for(const e of t){n.some((t=>(0,Ci.Z)(t,e)))||n.push(e)}}o=[P.wC,""],r=[P.wC,"￿"];const l=await e.filters.where("[accountId+path]").between(o,r).toArray(),d=[],u=[];for(const e of l){const{path:t,filterValue:a}=e;if(t===P.ym)n=e;else if(t===P.W4)i=e;else if(t===P.cs)s=e;else{const e=a.include.filter((e=>1===e.length&&(e[0].listId||e[0].senderIsMailingList)));t.startsWith(P.W4)?d.push(...e):t.startsWith(P.cs)&&u.push(...e)}}if(!n)throw new Error("Mailing list root folder not found");if(!i)throw new Error("Mailing list Important folder not found");if(!s)throw new Error("Mailing list Other folder not found");c(n,d),c(n,u),c(i,d),c(s,u),o=[P.ut,""],r=[P.ut,"￿"];const h=await e.filters.where("[accountId+path]").between(o,r).toArray(),f=[];for(const e of h){const{path:t,filterValue:n}=e;if(t===P.ym)a=e;else{const e=n.include.filter((e=>1===e.length&&e[0].flag));f.push(...e)}}if(!a)throw new Error("Labels root folder not found");c(a,f),await e.filters.bulkPut([n,i,s,a]);const p=[n.id,i.id,s.id,a.id];await _.Z.updateFilters(p),await y.Z.call({type:"RUN_FILTERS",priority:P.Un.LOW,filterIds:p}),t.stop()})),Di.set(143,(async e=>{const t=new Fi(143,"Fixing database inconsistency"),n=await e.searchList.toCollection().primaryKeys(),i=await e.viewIds.toCollection().primaryKeys(),s=new Set(n),a=i.filter((e=>!s.has(e)));await e.viewIds.where("searchListId").anyOf(a).delete(),t.stop()})),g.Z.version(144).stores({viewIds:"searchListId"}),Di.set(146,(async e=>{const t=new Fi(146,"Fixing state of show-read button in received folder");await e.filters.where("[accountId+path]").equals([P.of,P.ik]).modify((e=>{e.filterValue={...e.filterValue,showReadButton:!0}})),t.stop()})),g.Z.version(147).stores({mailingList:"listId"}),Di.set(147,(async e=>{const t=new Fi(147,"Group mailing lists providers (like xt.local and sparkpostmail.com)");await e.mailingList.bulkAdd(Pi);const n=P.wC,i=[n,""],s=[n,"￿"],a=await e.filters.where("[accountId+path]").between(i,s).toArray(),r=[];if(a.forEach((e=>{(e.path.endsWith(".xt.local")||e.path.endsWith(".sparkpostmail.com")||e.path.endsWith("list-id.mcsv.net")||e.path.startsWith(P.cs+"/spc-")||e.path.startsWith(P.W4+"/spc-"))&&r.push(e.id)})),r.length>0){const n=r.map((e=>100*e));await e.filters.where("id").anyOf(r).delete();const i=new Set,s=8;t.total=n.length,n.forEach((e=>{for(let t=0;t<s;t++)i.add(e+t)}));const a=[];await e.viewIds.toCollection().modify((e=>{const n=e.viewIds.filter((e=>!i.has(e)));n.length!==e.viewIds&&(a.push(e.searchListId),e.viewIds=n),t.count++})),await e.filteringQueue.add({priority:P.Un.LOW,type:"RE_RUN_SLES",searchListIds:a,runMailingLists:!0,updateFilters:!0})}t.stop()})),Di.set(148,(async e=>{const t=new Fi(148,"VB-78846: Rerun views for flags and labels"),n=[P.ut,""],i=[P.ut,"￿"],s=await e.filters.where("[accountId+path]").between(n,i).primaryKeys(),a=[P.MN,""],r=[P.MN,"￿"],o=await e.filters.where("[accountId+path]").between(a,r).primaryKeys();await e.filteringQueue.add({priority:P.Un.LOW,type:"RUN_FILTERS",filterIds:[...s,...o]}),t.stop()})),g.Z.version(149).stores({systemTasks:"++id",tokens:null}),Di.set(149,(async e=>{const t=new Fi(149,"Clear tokens table and prepare for transition to new search db ...");await e.systemTasks.add({taskName:"restore_full_text_search_db",currentPosition:0}),t.stop()})),Di.set(150,(async e=>{const t=new Fi(150,"VB-79158: [Mail] Unseen/Read status does not always match changes done with external server"),n=await e.accounts.toArray(),i=[];for(const e of n){const{accountId:t,folders:n}=e;for(const e in n)n[e].forEach((e=>{i.push([t,e.path])}))}const s=await e.filters.where("[accountId+path]").anyOf(i).toArray(),a=new Set;await e.searchList.toCollection().modify((e=>{const t=[...e.sources].filter((([e,t])=>t.internal)),n=[...e.sources].filter((([e,t])=>!t.internal));t&&0!==t.length&&n&&0!==n.length&&n.forEach((([n,i])=>{const r=s.find((e=>e.id===n))?.accountId;r&&t.forEach((([t,n])=>{const o=s.find((e=>e.id===t))?.accountId;if(o&&o===r){const n=e.sources.get(t);n&&n.read!==i.read&&(n.read=i.read,a.add(e.id),n.read&&(e.unseen=!1))}}))}))})),await e.filteringQueue.add({priority:P.Un.LOW,type:"RE_RUN_SLES",searchListIds:[...a]}),t.stop()})),Di.set(151,(async e=>{const t=new Fi(151,"Removing orphan source-filter IDs");t.total=await e.searchList.count();const n=await e.filters.toCollection().primaryKeys(),i=new Set(n);await e.searchList.toCollection().modify((e=>{e.sourceFilterIds=e.sourceFilterIds.filter((e=>i.has(e)));const n=new Map;for(const[t,s]of e.sources)i.has(t)&&n.set(t,s);e.sources=n,t.count++})),t.stop()})),Di.set(152,(async e=>{const t=new Fi(152,"Resetting feed data for updating paths"),n=await Ti.Z.waitFor((()=>O.Z.prefs.get(Z.kRssSettings)));if(0===n.length)return void t.stop();const i={},s=[];t.total=n.length;for(const a of n){const n=await e.filters.where("[accountId+path]").equals([P.u4,a.path]).first();if(i[a.path])try{const t={accountId:P.u4,filterValue:{exclude:i[a.path].filterValue.exclude.slice(),include:[[{accountId:P.u4},{path:a.url}]],showCustomFolderButton:!1,showFeedsButton:!1,showJunkButton:!1,showMailingListsButton:!1},name:a.title,path:a.url},n=await e.filters.add(t);s.push(n)}catch(e){console.error(e)}else if(n){i[a.path]=n;const t={...n.filterValue,include:[[{accountId:P.u4},{path:a.url}]]};await e.filters.update(n.id,{path:a.url,filterValue:t}),s.push(n.id)}else console.error("Filter not found for feed path",a.path);a.path=a.url,t.count++}O.Z.prefs.set({path:"vivaldi.rss.settings",value:n}),await y.Z.call({type:"RUN_FILTERS",priority:P.Un.LOW,filterIds:s}),t.stop()})),Di.set(153,(async e=>{const t=new Fi(153,"Re-run sender is a mailing list filters"),n=await e.filters.where("[accountId+path]").between([P.wC,""],[P.wC,"￿"]).filter((e=>e.filterValue.include?.some((e=>e.some((e=>!!e.senderIsMailingList)))))).primaryKeys();await y.Z.call({type:"RUN_FILTERS",priority:P.Un.LOW,filterIds:n}),t.stop()})),Di.set(154,(async e=>{const t=new Fi(154,"Fix unseen counters");t.total=await e.searchList.count();const n=[];await _.Z.initFilters(),await e.searchList.toCollection().modify((e=>{e.unseen&&Q.Z.call(e.sources)&&(e.unseen=!1,n.push(e.id)),t.count++})),await e.filteringQueue.add({priority:P.Un.LOW,type:"RE_RUN_SLES",searchListIds:n}),t.stop()})),Di.set(158,(async e=>{const t=new Fi(158,"Update thread key");t.total=await e.searchList.count(),await e.searchList.toCollection().modify((e=>{0===e.threadKey[1]&&(e.threadKey[1]=e.id),t.count++})),t.stop()})),Di.set(159,(async e=>{const t=new Fi(159,"Update old filter rules and delete contact filters"),n=await e.filters.where("[accountId+path]").between([P.wC,""],[P.wC,"￿"]).count()+await e.filters.where("[accountId+path]").between([P.Kz,""],[P.Kz,"￿"]).count(),i=[Ui,""],s=[Ui,"￿"],a=await e.filters.where("[accountId+path]").between(i,s).primaryKeys(),r=await e.filters.where("[accountId+path]").equals([P.Kz,P.ym]).primaryKeys();if(a.push(...r),a.length>0){const i=100,s=a.map((e=>e*i));await e.filters.where("id").anyOf(a).delete();const r=new Set,o=8;s.forEach((e=>{for(let t=0;t<o;t++)r.add(e+t)})),t.total=await e.viewIds.count()+n,await e.viewIds.toCollection().modify((e=>{const n=e.viewIds.filter((e=>!r.has(e)));n.length!==e.viewIds&&(e.viewIds=n),t.count++}))}else t.total=n;function o(e,t,n,i,s){e||(e="");let a=n;return i.includes("equal")&&["subject"].includes(t)&&(a=`"${a}"`),"anywhere"!==t&&(a=`${t}:${a}`),s&&e&&(a=`${e?" ":""}${s} `+a),e?e+a:a}const c=(e,t)=>{const n=[...e.filterValue[t]].filter(((n,i)=>{const s=[...n].filter(((n,i)=>{for(const s in n){let a="";const r="exclude"===t?"NOT":i?"AND":"OR";return"subject"!==s&&"to"!==s&&"from"!==s&&"cc"!==s||(a="subject"===s?n[s]:n[s].address,e.filterValue.query=o(e.filterValue.query,s,a,"equal",r),!1)}}));return e.filterValue[t][i]=s,0!==s.length}));0===n.length?delete e.filterValue[t]:e.filterValue[t]=n},l=e=>{e.filterValue.include&&c(e,"include"),e.filterValue.exclude&&c(e,"exclude")};await e.filters.where("[accountId+path]").between([P.wC,""],[P.wC,"￿"]).modify((e=>{l(e),t.count++})),await e.filters.where("[accountId+path]").between([P.Kz,""],[P.Kz,"￿"]).modify((e=>{e.path===P.ym?(e.filterValue.include=[],e.filterValue.exclude&&delete e.filterValue.exclude):l(e),t.count++})),t.stop()})),Di.set(160,(async e=>{const t=new Fi(160,"Update viewIds of messages that have too many unseen counters"),n=[];await e.searchList.toArray().then((e=>{e.forEach((e=>{e.unseen||n.push(e.id)}))})),t.total=n.length,await e.viewIds.where("searchListId").anyOf(n).modify((e=>{e.viewIds=e.viewIds.filter((e=>!function(e){return e%100==1}(e))),t.count++})),t.stop()})),Di.set(161,(async e=>{const t=new Fi(161,"Update Received folder to include send to self"),n={name:P.ik,accountId:P.of,path:P.ik,filterValue:{include:[[{folder:"Archive"}],[{folder:"Flagged"}],[{folder:P.Oi}],[{folder:P.e9}],[{folder:P.Hd}],[{folder:P.uT},{folder:"Not Sent Internal"}]],...$.Z.getSearchListButtons(P.HM)}};n&&(await e.filters.where("[accountId+path]").equals([n.accountId,n.path]).modify((e=>{e.filterValue.include=n.filterValue.include,e.filterValue.exclude=e.filterValue.exclude.filter((e=>!e.some((e=>e.folder===P.Nz))))})),await y.Z.call({priority:P.Un.LOW,type:"RUN_FILTERS",folderIds:[[P.of,P.ik]]})),t.stop()})),g.Z.version(162).stores({filteringQueue:"++id"}),Di.set(163,(async e=>{const t=new Fi(163,"Adding support for Archive folders"),n="Archive",i="Archive",s=new Map;await e.accounts.toCollection().modify((({accountId:e,folders:t})=>{const a=t.Other;if(!a)return;const r=[];if(t.Other=a.filter((e=>{const{name:t,path:s}=e;return t!==i&&s!==i||(r.push({...e,type:n}),!1)})),r.length>0){const e=t.Archive;e?e.push(...r):t.Archive=r}const o=new Map;s.set(e,o);Object.keys(t).forEach((e=>{t[e].forEach((t=>{o.set(t.path,e)}))}))}));let a=!1;await e.filters.toCollection().modify((e=>{const{accountId:t,path:n,filterValue:i}=e;"All Messages"===t&&"Archive"===n&&(a=!0);const r=function(e,t){const n=s.get(e)?.get(t);return n||(e===P.of&&t===P.rp?P.Hd:t)}(t,n);if((["Sent","Drafts","Outbox"].includes(r)||["Single thread","Feeds"].includes(t))&&(i.showArchivedButton=!1),"Archive"===r){const e=[{accountId:t},{folder:"Archive"}];i.include?i.include.push(e):i.include=[e],i.showCustomFolderButton=!1,i.showJunkButton=!1,i.showArchivedButton=!1}})),a||(await e.filters.add({name:"Archive",accountId:"All Messages",path:"Archive",filterValue:{include:[[{folder:"Archive"}]],exclude:[[{flag:"\\Deleted"}],[{folder:"Trash"}]],showCustomFolderButton:!1,showJunkButton:!1,showArchivedButton:!1}}),await e.filteringQueue.add({priority:15,type:"RE_RUN_SLES",folderIds:[["All Messages","Archive"]],runMailingLists:!0})),t.stop()})),Di.set(164,(async e=>{const t=new Fi(164,"Update names for filters");e.filters.toCollection().modify((e=>{e.name===P.ym&&(e.name=e.accountId)})),t.stop()})),Di.set(165,(async e=>{const t=new Fi(165,"Fix Archive status in filters"),n=new Map;function i(e,t){return e.some((e=>1===e.length&&e[0]?.folder===t))}await e.accounts.each((({accountId:e,folders:t})=>{const i=new Map;n.set(e,i);Object.keys(t).forEach((e=>{t[e].forEach((t=>{i.set(t.path,e)}))}))})),await e.filters.toCollection().modify((e=>{const{accountId:t,path:s,filterValue:a}=e,r=function(e,t){const i=n.get(e)?.get(t);return i||(e===P.of&&t===P.rp?P.Hd:t)}(t,s);if("Archive"===r){delete a.showJunkButton;const e=[{folder:"Junk"}];a.exclude?i(a.exclude,"Junk")||a.exclude.push(e):a.exclude=[e]}else if(!1!==a.showArchivedButton){const e=[{folder:"Archive"}];a.exclude?i(a.exclude,"Archive")||a.exclude.push(e):a.exclude=[e]}})),t.stop()})),Di.set(166,(async e=>{const t=new Fi(166,"Apply default showSubFolders and clear related include rules"),n=new Set(["Custom Folders","Mailing Lists","Filters","Labels","Flags","Feeds"]),i=new Set(["Other Mailing Lists","Important Mailing Lists"]),s=await e.accounts.toCollection().primaryKeys(),a=new Map,r=new Set;await e.filters.toCollection().modify((e=>{const{id:t,accountId:o,path:c,filterValue:l}=e;"VIVALDI_RESERVED_DUMMY_ROOT_PLACEHOLDER_PATH"===c&&(n.has(o)||s.includes(o))?(l.include=[],l.showSubFolders=!0,r.add(t)):"Mailing Lists"===o&&(i.has(c)?(l.include=[],l.showSubFolders=!0,r.add(t)):a.set(c,e))}));for(const e of[...a.values()]){const{include:t}=e.filterValue;if(!t||0===t.length)continue;const n=new Set;for(const e of t)for(const t of e)t.listId&&n.add(t.listId);if(0===n.size)continue;let i=e.path.substring(0,e.path.lastIndexOf("/")),s=a.get(i);for(;s;){const{id:e,filterValue:t}=s;if(t.include?.length>0){const i=t.include.length;t.include=t.include.filter((e=>!e.some((e=>n.has(e.listId))))),t.include.length<i&&r.add(e)}t.showSubFolders=!0,i=i.substring(0,i.lastIndexOf("/")),s=a.get(i)}}a.size>0&&await e.filters.bulkPut([...a.values()]),r.size>0&&await e.filteringQueue.add({priority:P.Un.LOW,type:"RUN_FILTERS",filterIds:[...r]}),t.stop()})),Di.set(167,(async e=>{const t=new Fi(167,"Fix filter include rules"),n=[],i=new Set(["Flags","Custom Folders","All Accounts"]),s=await e.accounts.toCollection().primaryKeys(),a=new Set(s);await e.filters.toCollection().modify((e=>{const{id:t,accountId:s,path:r,filterValue:o}=e;"VIVALDI_RESERVED_DUMMY_ROOT_PLACEHOLDER_PATH"===r&&(i.has(s)&&(!o.include||o.include.length>0)&&(o.include=[],n.push(t)),!o.include&&a.has(s)&&(o.include=[],n.push(t)))})),n.length>0&&await e.filteringQueue.add({priority:15,type:"RUN_FILTERS",filterIds:n}),t.stop()})),Di.set(170,(async e=>e.buffer.where("operation").equals("BUFFER_OPERATION_REMOVE_ACCOUNT_PATH").filter((e=>void 0===e.path)).delete())),Di.set(171,(async e=>{await e.filteringQueue.toCollection().modify((e=>{if(e.folderIds){Array.isArray(e.folderIds[0])||(e.folderIds=[e.folderIds]);for(const t of e.folderIds)t[1]=t[1]||"VIVALDI_RESERVED_DUMMY_ROOT_PLACEHOLDER_PATH"}}))})),Di.set(173,(async e=>{const t=new Fi(173,"Fix casing of inbox and remove duplicates if found"),n=await e.accounts.toArray();for(const t of n){if(t.accountId===P.of){await e.accounts.delete(P.of);continue}const n=t.folders.Inbox||[];for(const i of n)"inbox"===i.path.toLowerCase()&&"Inbox"!==i.path&&(i.path="Inbox",await e.accounts.update(t.accountId,t))}function i(e){let t=!1;"inbox"===e.path.toLowerCase()&&"Inbox"!==e.path&&(e.path="Inbox",t=!0);for(const n of["include","exclude"])if(e.filterValue[n])for(const i of e.filterValue[n])for(const e of i)e.path&&"inbox"===e.path.toLowerCase()&&"Inbox"!==e.path&&(e.path="Inbox",t=!0);return t}const s=await e.filters.toArray(),a=s.filter((e=>"inbox"===e.path.toLowerCase())),r={};for(const e of a)r[e.accountId]?r[e.accountId].push(e):r[e.accountId]=[e];for(const n in r){const s=(await e.imap.where("accountId").equals(n).toArray()).filter((e=>"inbox"===e.path.toLowerCase())),a=new Map;t.total=s.length,t.count=0;for(const n of s){t.count++;const{accountId:i,path:s,uid:r}=n,o=a.get(r);o?0===o.hasRaw&&1===n.hasRaw&&(o.hasRaw=1):a.set(r,{...n,path:"Inbox"}),"Inbox"!==s&&await e.imap.delete([i,s,r])}await e.imap.bulkPut(Array.from(a.values()));const o=(await e.mailboxCache.where("accountId").equals(n).toArray()).filter((e=>"inbox"===e.path.toLowerCase())),c=new Map;t.total=o.length,t.count=0;for(const n of o){t.count++;const{accountId:i,path:s}=n,a=c.get(s);a?(Number(n.highestModseq)>Number(a.highestModseq)&&(a.highestModseq=n.highestModseq),n.uidNext>a.uidNext&&(a.uidNext=n.uidNext),n.exists>a.exists&&(a.exists=n.exists)):c.set(s,{...n,path:"Inbox"}),await e.mailboxCache.delete([i,s])}await e.mailboxCache.bulkPut(Array.from(c.values()));const l=await e.buffer.where("accountId").equals(n).toArray();t.total=l.length,t.count=0;for(const n of l){t.count++;const{_id:i,path:s="",destinationPath:a=""}=n;"inbox"===s.toLowerCase()&&"Inbox"!==s&&await e.buffer.update(i,{path:"Inbox"}),a&&"inbox"===a.toLowerCase()&&"Inbox"!==a&&await e.buffer.update(i,{destinationPath:"Inbox"})}const d=await e.filteringQueue.toArray();t.total=d.length,t.count=0;for(const n of d){t.count++;let i=!1;const{id:s,folderIds:a,fromFolderId:r,toFolderId:o}=n;if(a)for(const e of a)"inbox"===e[1].toLowerCase()&&"Inbox"!==e[1]&&(e[1]="Inbox",i=!0);r&&"inbox"===r[1].toLowerCase()&&"Inbox"!==r[1]&&(r[1]="Inbox",i=!0),o&&"inbox"===o[1].toLowerCase()&&"Inbox"!==o[1]&&(o[1]="Inbox",i=!0),i&&await e.filteringQueue.update(s,n)}const u=r[n];if(1===u.length){const t=u[0];i(t)&&await e.filters.update(t.id,t)}else if(u.length>1){let n=u.find((e=>"Inbox"===e.path));n||(n=u[0],i(n)&&await e.filters.update(n.id,n));const s=u.filter((e=>e.id!==n.id)),a=s.map((e=>e.id)),r=s.map((e=>100*e.id));await e.filters.where("id").anyOf(a).delete();const o=new Set,c=9;t.total=r.length,t.count=0,r.forEach((e=>{for(let t=0;t<c;t++)o.add(e+t)})),await e.viewIds.toCollection().modify((e=>{const n=e.viewIds.filter((e=>!o.has(e)));n.length!==e.viewIds&&(e.viewIds=n),t.count++}))}}const o=s.filter((e=>"inbox"!==e.path.toLowerCase()));t.total=o.length,t.count=0;for(const n of o)t.count++,i(n)&&await e.filters.update(n.id,n);t.stop()})),Di.set(174,(async e=>{const t=new Fi(174,"Delete empty label if there is one"),n=await e.filters.where("[accountId+path]").equals([P.ut,""]).primaryKeys(),i=[0,1,2,3,4,5,6,7,8];if(n.length>0)for(const s of n){t.total=await e.viewIds.count();const n=100,a=new Set(i.map((e=>s*n+e)));await e.viewIds.toCollection().modify((e=>{const n=e.viewIds.filter((e=>!a.has(e)));n.length!==e.viewIds&&(e.viewIds=n),t.count++})),e.filters.delete(s)}t.stop()})),Di.set(175,(async e=>{const t=new Fi(175,"Re-run filtering"),n=new Map;await e.searchList.each((({id:e,sourceFilterIds:i})=>{for(const t of i){const i=n.get(t);i?i.push(e):n.set(t,[e])}t.count++}));for(const[t,i]of n)await e.filteringQueue.add({type:"FILTERS_SLES",priority:20,searchListIds:i,filterIds:[t],runAllMessages:!0,runMailingLists:!0,runCustomFolders:!0,runFlagFolders:!0,runLabels:!0,runQueries:!0,runSingleThread:!0})})),Di.set(176,(async e=>{const t=new Fi(176,"Fix grouped mailing lists"),n=await e.mailingList.toArray(),i=await e.filters.where("[accountId+path]").between(["Mailing Lists",""],["Mailing Lists","￿"]).filter((e=>{const{path:t}=e,i=t.indexOf("/");if(i<0)return!1;const s=t.substring(i+1);return!s.includes("/")&&n.some((({listId:e,parentFolderType:t})=>{switch(t){case"endsWith":return s.endsWith(e);case"startsWith":return s.startsWith(e);case"matches":return s===e}}))})).primaryKeys();if(0===i.length)return;await e.filters.bulkDelete(i);const s=new Set;for(const e of i)for(let t=0;t<9;t++)s.add(100*e+t);t.total=await e.viewIds.count(),await e.viewIds.toCollection().modify((e=>{const n=e.viewIds.filter((e=>!s.has(e)));n.length<e.viewIds.length&&(e.viewIds=n),t.count++})),await e.filteringQueue.add({priority:20,type:"RE_RUN_SLES",runMailingLists:!0}),t.stop()})),Di.set(177,(async e=>{const t=new Fi(177,"Add default labels"),n=structuredClone(Ri.j).filter((e=>e.accountId===P.ut)),i=await e.filters.where("[accountId+path]").between([P.ut,""],[P.ut,"￿"]).toArray(),s=n.filter((e=>!i.some((t=>t.path===e.path))));s.length>0&&await e.filters.bulkAdd(s),t.stop()})),Di.set(178,(async e=>{const t=new Fi(178,"Delete empty label actions");await e.filters.where("[accountId+path]").between([P.Kz,""],[P.ut,"￿"]).modify((e=>{e.triggers&&(e.triggers=e.triggers.filter((e=>void 0===e.label||""!==e.label)))})),t.stop()})),Di.set(179,(async e=>{const t=new Fi(179,"Fixing saved searches"),n=["Filters",""],i=["Filters","￿"],s=await e.accounts.toCollection().primaryKeys();if(s.length>0){const t="VIVALDI_RESERVED_DUMMY_ROOT_PLACEHOLDER_PATH",a=s.map((e=>[e,t])),r=(e,t)=>{const{filterValue:n}=e;if(n.showSubFolders){delete n.showSubFolders;const e=n.include||[];n.include=[...e,[{accountId:t}]]}};await e.filters.where("[accountId+path]").anyOf(a).modify((e=>r(e,e.accountId))),await e.filters.where("[accountId+path]").between(n,i).filter((e=>{const{selectedAccountId:t,selectedName:n}=e;return t===n&&s.includes(t)})).modify((e=>{const{selectedAccountId:t,accountId:n,path:i}=e;r(e,t),a.push([n,i])})),await e.filteringQueue.add({type:"RUN_FILTERS",priority:15,folderIds:a})}const a=await e.filters.toArray(),r=await e.filters.where("[accountId+path]").between(n,i).filter((({filterValue:e,selectedAccountId:t,selectedName:n})=>{if(e.showSubFolders)return!0;if(t&&n){if(!a.some((e=>e.accountId===t&&e.name===n)))return!0}return!1})).primaryKeys();if(r.length>0){await e.filters.bulkDelete(r);const n=new Set;for(const e of r)for(let t=0;t<9;t++)n.add(100*e+t);t.total=await e.viewIds.count(),await e.viewIds.toCollection().modify((e=>{const i=e.viewIds.filter((e=>!n.has(e)));i.length<e.viewIds.length&&(e.viewIds=i),t.count++}))}t.stop()})),Di.set(180,(async e=>{const t=new Fi(180,"Decode imap folder filter names"),n=await e.accounts.toCollection().primaryKeys();await e.filters.toCollection().modify((e=>{n.includes(e.accountId)&&(e.name=(0,wn.kF)(e.name))})),t.stop()})),Di.set(181,(async e=>{const t=new Fi(181,"Adding labels made from webmail");const n=[P.ut,""],i=[P.ut,"￿"],s=(await e.filters.where("[accountId+path]").between(n,i).toArray()).map((e=>e.path)),a=new Set,r=new Set,o=await e.searchList.toArray();if(t.total=o.length,o.forEach((e=>{e.flags.forEach((t=>{!s.includes(t)&&function(e){const t=e.toLowerCase();return t.startsWith("$label")||"$"!==t[0]&&"\\"!==t[0]&&!["mdnsent","forwarded","submitpending","submitted","junk","notjunk","nonjunk","phishing","important","draft","seen","flagged","answered","recent"].includes(t)}(t)&&(a.add(t),r.add(e))})),t.count++})),[...a].length>0){const t=[...a].map((e=>{const t=[{flag:e}];return{name:e,accountId:P.ut,path:e,filterValue:{include:[t],...$.Z.getSearchListButtons(P.ut)}}})),n=await e.filters.bulkAdd(t,{allKeys:!0});y.Z.call({type:"RE_RUN_SLES",priority:P.Un.LOW,folderIds:[[P.ut,P.ym]],filterIds:n,searchListIds:[...r].map((e=>e.id))})}t.stop()})),Di.set(182,(async e=>{const t=new Fi(182,"Refactor filter view toggles");t.total=await e.filters.count(),await e.filters.toCollection().modify((e=>{const{accountId:n,path:i,filterValue:s}=e;s.exclude&&(s.exclude=s.exclude.filter((t=>{for(const s of t)return s.flag===P.T4.SEEN?(e.filterValue.showRead=!1,n===P.of&&i===P.tB):s.flag===P.T4.DELETED||s.folder===P.uT?(e.filterValue.showDeleted=!1,!1):s.folder===P.Hd?(e.filterValue.showJunk=!1,!1):s.folder===P.Oi?(e.filterValue.showCustomFolder=!1,!1):s.folder!==P.hn||(e.filterValue.showArchived=!1,!1)})),0===s.exclude.length&&delete s.exclude),s.include&&(s.include=s.include.filter((t=>{let i=!1,s=!1,a=!1;return 2!==t.length||(t.forEach((e=>{i=e.accountId===n||i,s=e.folder===P.Hd||s,a=e.folder===P.hn||a})),i&&s?(e.filterValue.showJunk=!0,!1):!i||!a||(e.filterValue.showArchived=!0,!1))}))),t.count++})),t.stop()})),g.Z.version(183).stores({importStatus:null,importProgress:"path"}),Di.set(184,(async e=>{const t=new Fi(184,"Make feed-sources internal"),n=[P.u4,""],i=[P.u4,"￿"],s=await e.filters.where("[accountId+path]").between(n,i).primaryKeys();t.total=await e.searchList.where("sourceFilterIds").anyOf(s).count(),await e.searchList.where("sourceFilterIds").anyOf(s).modify((e=>{t.count++;for(const[t,n]of e.sources)s.includes(t)&&!n.internal&&(n.internal=!0)})),t.stop()})),Di.set(185,(async e=>{const t=new Fi(185,"Removing custom folder filters"),n=await e.filters.toCollection().filter((({accountId:e,path:t})=>"Custom Folders"===e&&"VIVALDI_RESERVED_DUMMY_ROOT_PLACEHOLDER_PATH"!==t)).primaryKeys();if(n.length>0){await e.filters.bulkDelete(n);const i=new Set;for(const e of n)for(let t=0;t<9;t++)i.add(100*e+t);t.total=await e.viewIds.count(),await e.viewIds.toCollection().modify((e=>{const n=e.viewIds.filter((e=>!i.has(e)));n.length<e.viewIds.length&&(e.viewIds=n),t.count++}))}t.stop()})),g.Z.version(186).stores({hasRaw:"[searchListId+accountId],[hasRaw+accountId+searchListId],accountId,searchListId"}),Di.set(186,(async e=>{const t=new Fi(186,"Processing raw data"),n=await e.searchList.count(),i=await e.imap.count(),s=await e.pop.count();t.total=n+i+s;const a=new Map;await e.imap.toCollection().modify((e=>{const{searchListId:n,accountId:i,hasRaw:s}=e;let r=a.get(n);r||(r=new Map,a.set(n,r)),r.set(i,1===s),delete e.hasRaw,t.count++})),await e.pop.toCollection().modify((e=>{const{searchListId:n,accountId:i,headersOnly:s}=e;let r=a.get(n);r||(r=new Map,a.set(n,r)),r.set(i,!s),delete e.headersOnly,t.count++}));const r=await e.filters.toArray(),o=new Map(r.map((e=>[e.id,e]))),c=[],l=[];for(await e.searchList.each((e=>{const n=new Set;let i=!0;for(const[t,s]of e.sources){const e=o.get(t);e?(n.add(e.accountId),s.internal||(i=!1)):k.Z.error("Mail",["Upgrade","186"],"Filter not found "+t)}for(const s of n){const n=a.get(e.id)?.get(s);let r;if(void 0!==n)r=n?1:0;else if(i)r=1;else{const{id:t,sentDate:n}=e;l.push({accountId:s,searchListId:t,sentDate:n}),r=1}c.push({searchListId:e.id,accountId:s,hasRaw:r}),t.total++}t.count++}));c.length>0;){const n=c.splice(0,1e4);await e.hasRaw.bulkAdd(n),t.count+=n.length}l.length>0&&await e.systemTasks.add({taskName:"check_disk_for_raw",fileKeys:l}),t.stop()})),g.Z.version(187).stores({hasRaw:"[searchListId+accountId],accountId,searchListId,[hasRaw+accountId]"}),g.Z.version(188).stores({hasRaw:"[searchListId+accountId],accountId,searchListId,[hasRaw+accountId+searchListId]"}),Di.set(189,(async e=>{const t=new Fi(189,"Upgrade pending upload entries in buffer");t.total=await e.buffer.count();const n=await e.buffer.toArray();for(const i of n)"BUFFER_OPERATION_UPLOAD_MESSAGE"!==i.operation||i.flags?"BUFFER_OPERATION_MOVE"===i.operation&&i.destinationAccountId&&(await e.buffer.delete(i._id),k.Z.warn("Mail",["Upgrade","189"],"An old, broken buffer action for moving between accounts was removed")):(await e.buffer.update(i._id,{flags:[]}),k.Z.info("Mail",["Upgrade","189"],"An old buffer action for uploading was modified to include an empty flags array")),t.count++;t.stop()})),Di.set(191,(async e=>{const t=new Fi(191,"Converting draft attachments");t.total=await e.messages.count();const n=new TextEncoder;await e.messages.toCollection().modify((e=>{e.bodyParts?.forEach((e=>{if("attachment"===e.type&&"string"==typeof e.content){const t=(0,Li.tV)(e.content);if(e.content=n.encode(t),"application/ics"===e.mimeType){const n=t.match(/METHOD:\s*(\w+)/);n&&(e.method=n[1])}}})),t.count++})),t.stop()})),Di.set(192,(async e=>{const t=new Fi(192,"Remove buffer entries for moving that have an empty uid list");t.total=await e.buffer.count();const n=await e.buffer.toArray();for(const i of n)"BUFFER_OPERATION_MOVE"!==i.operation||i.uids&&0!==i.uids.length||(await e.buffer.delete(i._id),k.Z.info("Mail",["Upgrade","192"],"Removed an unwanted buffer entry for moving an internal message")),t.count++;t.stop()})),Di.set(193,(async e=>{const t=new Fi(193,"Preparing to re-run threading..."),n=await e.threading.toCollection().primaryKeys();await e.threadingQueue.add({threadingIds:n}),t.stop()})),Di.set(194,(async e=>{const t=new Fi(194,"Moving size from imap table to searchList table...");t.total=await e.imap.count(),await e.imap.toCollection().modify((async n=>{const{searchListId:i,size:s}=n;await e.searchList.update(i,{size:s}),delete n.size,t.count++})),t.stop()})),Di.set(195,(async e=>{const t=new Fi(195,"Clearing capabilities from accounts table");t.total=await e.accounts.count(),await e.accounts.toCollection().modify((async e=>{delete e.capability,t.count++})),t.stop()})),Di.set(196,(async e=>{const t=new Fi(196,"Clearing unused gmailId from messages table");t.total=await e.messages.count(),await e.messages.toCollection().modify((e=>{delete e.gmailId,t.count++})),t.stop()})),Di.set(197,(async e=>{const t=new Fi(197,"Clearing lastNotificaton from accounts table");t.total=await e.accounts.count(),await e.accounts.toCollection().modify((e=>{delete e.lastNotification,t.count++})),t.stop()})),Di.set(198,(async e=>{const t=await e.filters.get({"[accountId+path]":[P.of,P.rp]});let n=!1;if(t){const i=t.filterValue;i.include&&2===i.include.length&&i.include.find((e=>e.find((e=>e.flag&&e.flag===P.T4.JUNK))&&e.find((e=>e.folder&&e.folder===P.Hd))))||(i.include=[[{folder:P.Hd}],[{flag:P.T4.JUNK}]],await e.filters.update(t.id,{filterValue:i}),n=!0)}else{const t={name:P.rp,accountId:P.of,path:P.rp,filterValue:{include:[[{folder:P.Hd}],[{flag:P.T4.JUNK}]],...$.Z.getSearchListButtons(P.Hd)}};await e.filters.add(t),n=!0}n&&e.filteringQueue.add({type:"RUN_FILTERS",priority:P.Un.LOW,folderIds:[[P.of,P.rp]]})})),Di.set(201,(async e=>{const t=new Fi(201,"Update Received folder so Feeds filter button works");await e.filters.where("[accountId+path]").equals([P.of,P.ik]).modify((e=>{e.filterValue.include=[...e.filterValue.include,[{accountId:P.u4}]],e.filterValue={...e.filterValue,showFeeds:!1}})),await y.Z.call({priority:P.Un.LOW,type:"RUN_FILTERS",folderIds:[[P.of,P.ik]]}),t.stop()})),Di.set(202,(async e=>{const t=new Fi(202,"Setting new listPost attribute to empty string");t.total=await e.messages.count(),await e.messages.toCollection().modify((e=>{e.listPost="",t.count++})),t.stop()})),Di.set(203,(async e=>{const t=new Fi(203,"Make sure All Messages Unread has the exclude seen rule"),n=["All Messages","Unread"];let i=!0;await e.filters.where("[accountId+path]").equals(n).modify((e=>{e.filterValue.exclude||(e.filterValue.exclude=[]),i=e.filterValue.exclude.some((e=>1===e.length&&e[0]?.flag===P.T4.SEEN)),i||e.filterValue.exclude.push([{flag:P.T4.SEEN}])})),i||await e.filteringQueue.add({priority:P.Un.LOW,type:"RUN_FILTERS",folderIds:[n]}),t.stop()})),Di.set(204,(async e=>{const t=new Fi(204,"Generate missing previews");await e.systemTasks.add({taskName:"generate_missing_previews",currentId:0}),t.stop()})),Di.set(205,(async e=>{const t=new Fi(205,"Fixing mailing lists"),n=await e.filters.where("[accountId+path]").between(["Mailing Lists",""],["Mailing Lists","￿"]).primaryKeys();0!==n.length&&(await e.filteringQueue.add({priority:20,type:"RE_RUN_SLES",filterIds:n,runMailingLists:!0}),t.stop())})),Di.forEach(((e,t)=>g.Z.version(t).upgrade((async n=>{try{await e(n),await n._upgrades.add({version:t})}catch(e){throw k.Z.error("Mail",["Upgrade",""+t],e),e}})))),g.Z.on("ready",(async()=>{const e=await g.Z._upgrades.toCollection().last();let t=[...Di.keys()];e&&(t=t.filter((t=>t>e.version))),t.sort(((e,t)=>e-t));for(const e of t){const t=Di.get(e);t&&await g.Z.transaction("rw",g.Z.tables,(n=>t(n).then((()=>n._upgrades.add({version:e})))))}}));const zi=g.Z;var Bi=n(87192),$i=n(24600);function ji(e){if(0===e.length)throw new Error("raceToResolve: Need an array with at least one Promise.");let t;return new Promise(((n,i)=>Promise.all(e.map((e=>e.then(n).catch((e=>t=e))))).then((()=>i(t)))))}var qi=n(16932);const{OK:Vi,ERROR:Qi,OFFLINE:Hi}=P.In;async function Ki(e){try{let t;if(e.useOAuth){const n=await Fn(e);t=En(e,n)}else t=En(e);await new Promise(((e,n)=>{t.onError=n,t.login().then((()=>t.logout())).then(e).catch(n)}))}catch(t){throw new Error((0,d.Z)("Login for $1 failed. $2",[e.MAIL_SERVER,t.message]))}}async function Wi(e){try{await dt.verifyLogin(e)}catch(t){throw new Error((0,d.Z)("Login for $1 failed.",[e.MAIL_SERVER]))}}async function Gi(e){try{let t;if(e.useOAuth){const n=await Fn(e);t=(0,$i.Z)(e,n)}else t=(0,$i.Z)(e);await new Promise(((e,n)=>{t.onidle=t.quit,t.onerror=n,t.onclose=e,t.connect()}))}catch(t){throw e.useOAuth&&await Mn(e.MAIL_EMAIL,(0,Un.dn)(e)),new Error((0,d.Z)("Login for $1 failed.",[e.MAIL_SMTP_SERVER]))}}const Yi=(e,t=!1)=>{const[n,i,s,a]=t?[e.MAIL_SMTP_PORT,e.MAIL_SMTP_SERVER,e.MAIL_SMTP_USER,e.MAIL_SMTP_PASSWORD]:[e.MAIL_PORT,e.MAIL_SERVER,e.MAIL_USER,e.MAIL_PASSWORD];if(!n||"number"!=typeof n)throw new Error(t?(0,d.Z)("Outgoing port is missing or not a number"):(0,d.Z)("Incoming port is missing or not a number"));if(!i)throw new Error(t?(0,d.Z)("Outgoing server information is missing"):(0,d.Z)("Incoming server information is missing"));if(!e.useOAuth){if(!s)throw new Error(t?(0,d.Z)("Outgoing username is missing"):(0,d.Z)("Incoming username is missing"));if(!a)throw new Error(t?(0,d.Z)("Outgoing password is missing"):(0,d.Z)("Incoming password is missing"))}},Xi=(e,t,n,i,s)=>new Promise(((s,a)=>{const r=D.default.open(e,t,{useSecureTransport:"ssl"===n});r.onerror=a,r.onopen=()=>{r.close(),s("MAIL_SMTP_SERVER"===i?{MAIL_SMTP_SERVER:e,MAIL_SMTP_PORT:t,MAIL_SMTP_SOCKET_TYPE:n}:{MAIL_SERVER:e,MAIL_PORT:t})}})),Ji=(e,t)=>{const n={...e,MAIL_SMTP_USER:t};return Gi(n).then((()=>[Vi,"Outgoing connection success",n])).catch((t=>{throw[Qi,t.message,e]}))},es=async(e,t,n)=>{const i=await ns(t);return i?ts(e,i,n):Promise.reject(`No MX record found for ${t}`)},ts=(e,t,n)=>{const i=[`https://autoconfig.${t}/mail/config-v1.1.xml?emailaddress=${e.MAIL_EMAIL}`,`https://autoconfig.vivaldi.net/v1.1/${t}`,`https://${t}/.well-known/autoconfig/mail/config-v1.1.xml?emailaddress=${e.MAIL_EMAIL}`],s="pop"===n?"pop3":n;return ji(i.map((t=>is(e,s,t))))},ns=async e=>{const t=await fetch(`https://autoconfig.vivaldi.net/mxlookup?domain=${e}`);if(t.ok){const e=await t.json();if(e&&e[0]?.target){return rs(e[0]?.target)}}},is=async(e,t,n)=>{const i=await fetch(n);if(!i.ok)throw new Error("autodiscover: Error looking up in autoconfig");try{const n=await i.text(),s=new qi.XMLParser({ignoreAttributes:!1}).parse(n),{emailProvider:a}=s.clientConfig,{outgoingServer:r,incomingServer:o}=a,c=Array.isArray(o)?o:[o],l=Array.isArray(r)?r:[r];let d,u,h,f,p;for(const e of c)if(e["@_type"]===t&&"ssl"===e.socketType.toLowerCase()){d=e.hostname,u=e.port;break}for(const e of l)if("smtp"===e["@_type"]&&"plain"!==e.socketType.toLowerCase()){h=e.hostname,f=e.port,p=e.socketType.toLowerCase();break}if(!(d&&u&&h&&f&&p))throw new Error("autodiscover: Missing Outgoing or Incoming Server/Port information");const g={...e,MAIL_SERVER:d,MAIL_PORT:Number(u),MAIL_SMTP_SERVER:h,MAIL_SMTP_PORT:Number(f),MAIL_SMTP_SOCKET_TYPE:"ssl"===p?"ssl":"starttls"};return[Vi,g]}catch(e){throw new Error(`autodiscover: ${e}`)}},ss=async(e,t,n,i)=>{const s=await ns(t);return s?as(e,s,n,i):[Qi,e]},as=(e,t,n,i)=>{const s=[`${n}.${t}`,`mail.${t}`,`${n}.mail.${t}`],a=[`smtp.${t}`,`mail.${t}`,`smtp.mail.${t}`];let r,o;return Promise.race([new Promise((e=>setTimeout(e,1e4))),Promise.allSettled([ji([...s.map((e=>Xi(e,i,"ssl","MAIL_SERVER")))]).then((e=>{r=e})),new Promise((e=>Promise.allSettled([ji([...a.map((e=>Xi(e,465,"ssl","MAIL_SMTP_SERVER")))]).then((t=>{o=t,e()})),ji([...a.map((e=>Xi(e,587,"starttls","MAIL_SMTP_SERVER")))]).then((e=>{o||(o=e)}))]).then(e)))])]).then((()=>{const t={...e,...r,...o};return[["MAIL_SERVER","MAIL_PORT","MAIL_SMTP_SERVER","MAIL_SMTP_PORT","MAIL_SMTP_SOCKET_TYPE"].every((e=>t[e]))?Vi:Qi,t]}))},rs=e=>{let t=e;if(null!=e){var n=e.split(".").reverse();null!=n&&n.length>1&&(t=n[1]+"."+n[0],-1!==e.toLowerCase().indexOf(".co.uk")&&n.length>2&&(t=n[2]+"."+t))}return t.toLowerCase()};var os=n(6977);const cs={call:async function(e){if(0===e.length)return;const t=[],n=new Map;e.forEach((e=>{const{id:i,updates:s}=e,{sources:a=new Map}=s;a.forEach((async(e,n)=>{if(!e||0===Object.keys(e).length)return;const s=_.Z.get(n);if(!s)throw new Error(`Source filter ${n} not found in cache`);const{accountId:a,path:r}=s;t.push([a,r,i])})),n.set(i,e)})),0!==t.length&&await g.Z.transaction("rw",[g.Z.buffer,g.Z.imap],(async()=>{const e=[];(await g.Z.imap.where("[accountId+path+searchListId]").anyOf(t).toArray()).forEach((t=>{const{accountId:i,path:s,uid:a,searchListId:r}=t,o=n.get(r),c=_.Z.getByFolderId([i,s]),{sources:l}=o.updates;if(l){const t=l.get(c.id),n={},{deleted:r,read:o}=t;void 0!==r&&(n[P.T4.DELETED]=r),void 0!==o&&(n[P.T4.SEEN]=o),e.push({accountId:i,path:s,uid:a,flagUpdates:n})}})),e.length>0&&await os.Z.addCustomFlags(e)}))}};var ls=n(47482);let ds=!1;const us=v.Z.adjustBatchSize.bind(void 0,100,1e3,500);let hs=100;async function fs(e){const t=await g.Z.flaggingQueue.toCollection().first();if(!t)return;let{id:n,searchListIds:i,sourcesPerSle:s,flagUpdates:a}=t;for(s instanceof Map||(console.warn("flagging.js: Invalid entry in flaggingQueue table"),s=new Map);i.length>0;){const e=i.splice(0,hs),t=Date.now(),r=e.map((e=>({searchListId:e,sources:s.get(e)||new Map})));await g.Z.transaction("rw",[g.Z.searchList,g.Z.filteringQueue,g.Z.flaggingQueue,g.Z.buffer,g.Z.imap],(async()=>{const t=await ls.Z.call(r,a);U.QO.updateIndex({sleUpdates:t}),Object.keys(a).length>0&&await w.Z.call(e,a),s.size>0&&await cs.call(t),Gt.call();const o={id:n,searchListIds:i,sourcesPerSle:s,flagUpdates:a};await g.Z.flaggingQueue.put(o)}));const o=Date.now();hs=us(hs,o-t),me.filter()}await g.Z.flaggingQueue.delete(n),await fs(e)}zi.open();const ps={updateThreads:Re.updateThreads,start:async function(){await Promise.all([gn(),_.Z.initFilters(),b.Z.initFolders(),xe(),ee.Z.initMailingLists()])},stop:function(){void 0!==hn&&hn("Clearing UID sequence sets."),pn(),fn={},_.Z.clear(),ee.Z.clear(),ke(),ve={level:0,children:new Map},u.Z.clear()},addAccount:async function(e){const t=e.MAIL_EMAIL,{accountType:n,offline:i}=e,s=n===P.s9.POP,a=n===P.s9.IMAP;if(!s&&!a)throw new Error(`Trying to add account ${t} of unsupported type ${n}`);const l=s||i?c.Z.getDefaultFolders():{},d=await r.Z.add(t,l);await u.Z.addAccounts({[t]:d});const h=await o.Z.foldersToFilters(t,l);_.Z.updateFilters(h)},flushBuffer:Gt.call,updateFlags:async function(){if(!ds){ds=!0;try{await fs()}finally{ds=!1}}},runSystemTasks:async function(){const e=await g.Z.systemTasks.toArray();for(const t of e)await Ct(t)},getOAuthAccessToken:Zn,fetchAccessTokenAndRefreshToken:Mn,verify:async function(e){await(async e=>(Yi(e,!0),Gi(e)))(e),await(async e=>{Yi(e,!1),e.accountType===P.s9.IMAP?await Ki(e):await Wi(e)})(e)},autofill:async function(e){if(!Bi.Z.isValidEmail(e))return[Qi,e];const t=e.MAIL_EMAIL,n=e.MAIL_EMAIL&&t.split("@")[1];let i="imap",s=993;return e.accountType===P.s9.POP&&(i="pop",s=995),ji([ts(e,n,i),es(e,n,i)]).catch((()=>{let t;return new Promise((a=>Promise.allSettled([as(e,n,i,s).then((e=>{e[0]===Vi&&a(e),t||(t=e)})),ss(e,n,i,s).then((e=>{e[0]===Vi&&a(e),t||(t=e)}))]).then((()=>a(t)))))})).then((e=>e))},signIn:async function(e){if(e.offline)return[Hi,"offline",e];e.MAIL_PORT||(e.MAIL_PORT=e.accountType===P.s9.IMAP?993:995),e.MAIL_SMTP_PORT||(e.MAIL_SMTP_PORT=465);try{Yi(e,!1),Yi(e,!0)}catch(t){return[Qi,t.message,e]}if(e.useOAuth)try{return await Ji(e,e.MAIL_EMAIL)}catch(e){return e}const t=[e.MAIL_USER],n=[e.MAIL_SMTP_USER];if(e.MAIL_EMAIL===e.MAIL_USER&&e.MAIL_EMAIL===e.MAIL_SMTP_USER&&e.MAIL_EMAIL.includes("@")){const i=e.MAIL_EMAIL.split("@")[0];t.push(i),n.push(i)}const i=await Promise.allSettled([ji(n.map((t=>Ji(e,t)))),ji(t.map((t=>(async(e,t)=>{const n={...e,MAIL_USER:t};try{return e.accountType===P.s9.IMAP?(await Ki(n),[Vi,"Incoming connection success",n]):(await Wi(e),[Vi,"Incoming connection success",n])}catch(t){throw[Qi,t.message,e,[]]}})(e,t))))]);let s={...e},a=Vi,r="";for(const e of i)e.reason?(a=Qi,r=e.reason[1],s={...s,...e.reason[2]}):e.value&&(s={...s,...e.value[2]});return[a,r,s]}};function gs(e){if(e.origin!==C.oP)return;const{background:t}=e.data;if(t){const{promiseId:n,func:i,args:s=[]}=t;Promise.resolve().then((()=>ps[i](...s))).then((t=>{e.source.postMessage({background:{promiseId:n,results:t}})})).catch((t=>{t=t.message||t,e.source.postMessage({background:{promiseId:n,error:t}})}))}}self.addEventListener("install",(e=>{self.skipWaiting()}));let ms=!1;!async function(){ms||(ms=!0,self.addEventListener("message",gs,!1),await Promise.all([i.Z.loadPromise(),s.Z.loadPromise(),a.Z.loadPromise()]))}()},44983:()=>{!function(e){var t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(i,s,function(t){return e[t]}.bind(null,s));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=11)}([function(e,t,n){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t,n){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t,n){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function s(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var i in n)s(n,i)&&(e[i]=n[i])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var a={arraySet:function(e,t,n,i,s){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+i),s);else for(var a=0;a<i;a++)e[s+a]=t[n+a]},flattenChunks:function(e){var t,n,i,s,a,r;for(i=0,t=0,n=e.length;t<n;t++)i+=e[t].length;for(r=new Uint8Array(i),s=0,t=0,n=e.length;t<n;t++)a=e[t],r.set(a,s),s+=a.length;return r}},r={arraySet:function(e,t,n,i,s){for(var a=0;a<i;a++)e[s+a]=t[n+a]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,a)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,r))},t.setTyped(i)},function(e,t,n){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t,n){"use strict";var i,s=n(2),a=n(8),r=n(6),o=n(7),c=n(1),l=-2,d=258,u=262,h=103,f=113,p=666;function g(e,t){return e.msg=c[t],t}function m(e){return(e<<1)-(e>4?9:0)}function w(e){for(var t=e.length;--t>=0;)e[t]=0}function _(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(s.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function b(e,t){a._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,_(e.strm)}function y(e,t){e.pending_buf[e.pending++]=t}function v(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function I(e,t){var n,i,s=e.max_chain_length,a=e.strstart,r=e.prev_length,o=e.nice_match,c=e.strstart>e.w_size-u?e.strstart-(e.w_size-u):0,l=e.window,h=e.w_mask,f=e.prev,p=e.strstart+d,g=l[a+r-1],m=l[a+r];e.prev_length>=e.good_match&&(s>>=2),o>e.lookahead&&(o=e.lookahead);do{if(l[(n=t)+r]===m&&l[n+r-1]===g&&l[n]===l[a]&&l[++n]===l[a+1]){a+=2,n++;do{}while(l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&a<p);if(i=d-(p-a),a=p-d,i>r){if(e.match_start=t,r=i,i>=o)break;g=l[a+r-1],m=l[a+r]}}}while((t=f[t&h])>c&&0!=--s);return r<=e.lookahead?r:e.lookahead}function k(e){var t,n,i,a,c,l,d,h,f,p,g=e.w_size;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=g+(g-u)){s.arraySet(e.window,e.window,g,g,0),e.match_start-=g,e.strstart-=g,e.block_start-=g,t=n=e.hash_size;do{i=e.head[--t],e.head[t]=i>=g?i-g:0}while(--n);t=n=g;do{i=e.prev[--t],e.prev[t]=i>=g?i-g:0}while(--n);a+=g}if(0===e.strm.avail_in)break;if(l=e.strm,d=e.window,h=e.strstart+e.lookahead,f=a,p=void 0,(p=l.avail_in)>f&&(p=f),n=0===p?0:(l.avail_in-=p,s.arraySet(d,l.input,l.next_in,p,h),1===l.state.wrap?l.adler=r(l.adler,d,p,h):2===l.state.wrap&&(l.adler=o(l.adler,d,p,h)),l.next_in+=p,l.total_in+=p,p),e.lookahead+=n,e.lookahead+e.insert>=3)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=(e.ins_h<<e.hash_shift^e.window[c+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[c+3-1])&e.hash_mask,e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<u&&0!==e.strm.avail_in)}function E(e,t){for(var n,i;;){if(e.lookahead<u){if(k(e),e.lookahead<u&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-u&&(e.match_length=I(e,n)),e.match_length>=3)if(i=a._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(b(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(b(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(b(e,!1),0===e.strm.avail_out)?1:2}function x(e,t){for(var n,i,s;;){if(e.lookahead<u){if(k(e),e.lookahead<u&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-u&&(e.match_length=I(e,n),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-3,i=a._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=s&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(b(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((i=a._tr_tally(e,0,e.window[e.strstart-1]))&&b(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=a._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(b(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(b(e,!1),0===e.strm.avail_out)?1:2}function A(e,t,n,i,s){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=s}function S(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(1146),this.dyn_dtree=new s.Buf16(122),this.bl_tree=new s.Buf16(78),w(this.dyn_ltree),w(this.dyn_dtree),w(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(16),this.heap=new s.Buf16(573),w(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(573),w(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function M(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:f,e.adler=2===t.wrap?0:1,t.last_flush=0,a._tr_init(t),0):g(e,l)}function O(e){var t,n=M(e);return 0===n&&((t=e.state).window_size=2*t.w_size,w(t.head),t.max_lazy_match=i[t.level].max_lazy,t.good_match=i[t.level].good_length,t.nice_match=i[t.level].nice_length,t.max_chain_length=i[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),n}function N(e,t,n,i,a,r){if(!e)return l;var o=1;if(-1===t&&(t=6),i<0?(o=0,i=-i):i>15&&(o=2,i-=16),a<1||a>9||8!==n||i<8||i>15||t<0||t>9||r<0||r>4)return g(e,l);8===i&&(i=9);var c=new S;return e.state=c,c.strm=e,c.wrap=o,c.gzhead=null,c.w_bits=i,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=a+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+3-1)/3),c.window=new s.Buf8(2*c.w_size),c.head=new s.Buf16(c.hash_size),c.prev=new s.Buf16(c.w_size),c.lit_bufsize=1<<a+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new s.Buf8(c.pending_buf_size),c.d_buf=1*c.lit_bufsize,c.l_buf=3*c.lit_bufsize,c.level=t,c.strategy=r,c.method=n,O(e)}i=[new A(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(k(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+n;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,b(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-u&&(b(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(b(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(b(e,!1),e.strm.avail_out),1)})),new A(4,4,8,4,E),new A(4,5,16,8,E),new A(4,6,32,32,E),new A(4,4,16,16,x),new A(8,16,32,32,x),new A(8,16,128,128,x),new A(8,32,128,256,x),new A(32,128,258,1024,x),new A(32,258,258,4096,x)],t.deflateInit=function(e,t){return N(e,t,8,15,8,0)},t.deflateInit2=N,t.deflateReset=O,t.deflateResetKeep=M,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?l:(e.state.gzhead=t,0):l},t.deflate=function(e,t){var n,s,r,c;if(!e||!e.state||t>5||t<0)return e?g(e,l):l;if(s=e.state,!e.output||!e.input&&0!==e.avail_in||s.status===p&&4!==t)return g(e,0===e.avail_out?-5:l);if(s.strm=e,n=s.last_flush,s.last_flush=t,42===s.status)if(2===s.wrap)e.adler=0,y(s,31),y(s,139),y(s,8),s.gzhead?(y(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),y(s,255&s.gzhead.time),y(s,s.gzhead.time>>8&255),y(s,s.gzhead.time>>16&255),y(s,s.gzhead.time>>24&255),y(s,9===s.level?2:s.strategy>=2||s.level<2?4:0),y(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(y(s,255&s.gzhead.extra.length),y(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=o(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69):(y(s,0),y(s,0),y(s,0),y(s,0),y(s,0),y(s,9===s.level?2:s.strategy>=2||s.level<2?4:0),y(s,3),s.status=f);else{var u=8+(s.w_bits-8<<4)<<8;u|=(s.strategy>=2||s.level<2?0:s.level<6?1:6===s.level?2:3)<<6,0!==s.strstart&&(u|=32),u+=31-u%31,s.status=f,v(s,u),0!==s.strstart&&(v(s,e.adler>>>16),v(s,65535&e.adler)),e.adler=1}if(69===s.status)if(s.gzhead.extra){for(r=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>r&&(e.adler=o(e.adler,s.pending_buf,s.pending-r,r)),_(e),r=s.pending,s.pending!==s.pending_buf_size));)y(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>r&&(e.adler=o(e.adler,s.pending_buf,s.pending-r,r)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=73)}else s.status=73;if(73===s.status)if(s.gzhead.name){r=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>r&&(e.adler=o(e.adler,s.pending_buf,s.pending-r,r)),_(e),r=s.pending,s.pending===s.pending_buf_size)){c=1;break}c=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,y(s,c)}while(0!==c);s.gzhead.hcrc&&s.pending>r&&(e.adler=o(e.adler,s.pending_buf,s.pending-r,r)),0===c&&(s.gzindex=0,s.status=91)}else s.status=91;if(91===s.status)if(s.gzhead.comment){r=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>r&&(e.adler=o(e.adler,s.pending_buf,s.pending-r,r)),_(e),r=s.pending,s.pending===s.pending_buf_size)){c=1;break}c=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,y(s,c)}while(0!==c);s.gzhead.hcrc&&s.pending>r&&(e.adler=o(e.adler,s.pending_buf,s.pending-r,r)),0===c&&(s.status=h)}else s.status=h;if(s.status===h&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&_(e),s.pending+2<=s.pending_buf_size&&(y(s,255&e.adler),y(s,e.adler>>8&255),e.adler=0,s.status=f)):s.status=f),0!==s.pending){if(_(e),0===e.avail_out)return s.last_flush=-1,0}else if(0===e.avail_in&&m(t)<=m(n)&&4!==t)return g(e,-5);if(s.status===p&&0!==e.avail_in)return g(e,-5);if(0!==e.avail_in||0!==s.lookahead||0!==t&&s.status!==p){var I=2===s.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(k(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,n=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(b(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(b(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(b(e,!1),0===e.strm.avail_out)?1:2}(s,t):3===s.strategy?function(e,t){for(var n,i,s,r,o=e.window;;){if(e.lookahead<=d){if(k(e),e.lookahead<=d&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=o[s=e.strstart-1])===o[++s]&&i===o[++s]&&i===o[++s]){r=e.strstart+d;do{}while(i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&s<r);e.match_length=d-(r-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=a._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(b(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(b(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(b(e,!1),0===e.strm.avail_out)?1:2}(s,t):i[s.level].func(s,t);if(3!==I&&4!==I||(s.status=p),1===I||3===I)return 0===e.avail_out&&(s.last_flush=-1),0;if(2===I&&(1===t?a._tr_align(s):5!==t&&(a._tr_stored_block(s,0,0,!1),3===t&&(w(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),_(e),0===e.avail_out))return s.last_flush=-1,0}return 4!==t?0:s.wrap<=0?1:(2===s.wrap?(y(s,255&e.adler),y(s,e.adler>>8&255),y(s,e.adler>>16&255),y(s,e.adler>>24&255),y(s,255&e.total_in),y(s,e.total_in>>8&255),y(s,e.total_in>>16&255),y(s,e.total_in>>24&255)):(v(s,e.adler>>>16),v(s,65535&e.adler)),_(e),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?0:1)},t.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&t!==h&&t!==f&&t!==p?g(e,l):(e.state=null,t===f?g(e,-3):0):l},t.deflateSetDictionary=function(e,t){var n,i,a,o,c,d,u,h,f=t.length;if(!e||!e.state)return l;if(2===(o=(n=e.state).wrap)||1===o&&42!==n.status||n.lookahead)return l;for(1===o&&(e.adler=r(e.adler,t,f,0)),n.wrap=0,f>=n.w_size&&(0===o&&(w(n.head),n.strstart=0,n.block_start=0,n.insert=0),h=new s.Buf8(n.w_size),s.arraySet(h,t,f-n.w_size,n.w_size,0),t=h,f=n.w_size),c=e.avail_in,d=e.next_in,u=e.input,e.avail_in=f,e.next_in=0,e.input=t,k(n);n.lookahead>=3;){i=n.strstart,a=n.lookahead-2;do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[i+3-1])&n.hash_mask,n.prev[i&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=i,i++}while(--a);n.strstart=i,n.lookahead=2,k(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=d,e.input=u,e.avail_in=c,n.wrap=o,0},t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t,n){"use strict";var i=n(2),s=n(6),a=n(7),r=n(9),o=n(10),c=-2,l=12,d=30;function u(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function h(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function f(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new i.Buf32(852),t.distcode=t.distdyn=new i.Buf32(592),t.sane=1,t.back=-1,0):c}function p(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,f(e)):c}function g(e,t){var n,i;return e&&e.state?(i=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?c:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,p(e))):c}function m(e,t){var n,i;return e?(i=new h,e.state=i,i.window=null,0!==(n=g(e,t))&&(e.state=null),n):c}var w,_,b=!0;function y(e){if(b){var t;for(w=new i.Buf32(512),_=new i.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(o(1,e.lens,0,288,w,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;o(2,e.lens,0,32,_,0,e.work,{bits:5}),b=!1}e.lencode=w,e.lenbits=9,e.distcode=_,e.distbits=5}function v(e,t,n,s){var a,r=e.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new i.Buf8(r.wsize)),s>=r.wsize?(i.arraySet(r.window,t,n-r.wsize,r.wsize,0),r.wnext=0,r.whave=r.wsize):((a=r.wsize-r.wnext)>s&&(a=s),i.arraySet(r.window,t,n-s,a,r.wnext),(s-=a)?(i.arraySet(r.window,t,n-s,s,0),r.wnext=s,r.whave=r.wsize):(r.wnext+=a,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=a))),0}t.inflateReset=p,t.inflateReset2=g,t.inflateResetKeep=f,t.inflateInit=function(e){return m(e,15)},t.inflateInit2=m,t.inflate=function(e,t){var n,h,f,p,g,m,w,_,b,I,k,E,x,A,S,M,O,N,Z,T,L,R,P,C,U=0,F=new i.Buf8(4),D=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return c;(n=e.state).mode===l&&(n.mode=13),g=e.next_out,f=e.output,w=e.avail_out,p=e.next_in,h=e.input,m=e.avail_in,_=n.hold,b=n.bits,I=m,k=w,R=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;b<16;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(2&n.wrap&&35615===_){n.check=0,F[0]=255&_,F[1]=_>>>8&255,n.check=a(n.check,F,2,0),_=0,b=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&_)<<8)+(_>>8))%31){e.msg="incorrect header check",n.mode=d;break}if(8!=(15&_)){e.msg="unknown compression method",n.mode=d;break}if(b-=4,L=8+(15&(_>>>=4)),0===n.wbits)n.wbits=L;else if(L>n.wbits){e.msg="invalid window size",n.mode=d;break}n.dmax=1<<L,e.adler=n.check=1,n.mode=512&_?10:l,_=0,b=0;break;case 2:for(;b<16;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(n.flags=_,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=d;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=d;break}n.head&&(n.head.text=_>>8&1),512&n.flags&&(F[0]=255&_,F[1]=_>>>8&255,n.check=a(n.check,F,2,0)),_=0,b=0,n.mode=3;case 3:for(;b<32;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}n.head&&(n.head.time=_),512&n.flags&&(F[0]=255&_,F[1]=_>>>8&255,F[2]=_>>>16&255,F[3]=_>>>24&255,n.check=a(n.check,F,4,0)),_=0,b=0,n.mode=4;case 4:for(;b<16;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}n.head&&(n.head.xflags=255&_,n.head.os=_>>8),512&n.flags&&(F[0]=255&_,F[1]=_>>>8&255,n.check=a(n.check,F,2,0)),_=0,b=0,n.mode=5;case 5:if(1024&n.flags){for(;b<16;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}n.length=_,n.head&&(n.head.extra_len=_),512&n.flags&&(F[0]=255&_,F[1]=_>>>8&255,n.check=a(n.check,F,2,0)),_=0,b=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((E=n.length)>m&&(E=m),E&&(n.head&&(L=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),i.arraySet(n.head.extra,h,p,E,L)),512&n.flags&&(n.check=a(n.check,h,E,p)),m-=E,p+=E,n.length-=E),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===m)break e;E=0;do{L=h[p+E++],n.head&&L&&n.length<65536&&(n.head.name+=String.fromCharCode(L))}while(L&&E<m);if(512&n.flags&&(n.check=a(n.check,h,E,p)),m-=E,p+=E,L)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===m)break e;E=0;do{L=h[p+E++],n.head&&L&&n.length<65536&&(n.head.comment+=String.fromCharCode(L))}while(L&&E<m);if(512&n.flags&&(n.check=a(n.check,h,E,p)),m-=E,p+=E,L)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;b<16;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(_!==(65535&n.check)){e.msg="header crc mismatch",n.mode=d;break}_=0,b=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=l;break;case 10:for(;b<32;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}e.adler=n.check=u(_),_=0,b=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=g,e.avail_out=w,e.next_in=p,e.avail_in=m,n.hold=_,n.bits=b,2;e.adler=n.check=1,n.mode=l;case l:if(5===t||6===t)break e;case 13:if(n.last){_>>>=7&b,b-=7&b,n.mode=27;break}for(;b<3;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}switch(n.last=1&_,b-=1,3&(_>>>=1)){case 0:n.mode=14;break;case 1:if(y(n),n.mode=20,6===t){_>>>=2,b-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=d}_>>>=2,b-=2;break;case 14:for(_>>>=7&b,b-=7&b;b<32;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if((65535&_)!=(_>>>16^65535)){e.msg="invalid stored block lengths",n.mode=d;break}if(n.length=65535&_,_=0,b=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(E=n.length){if(E>m&&(E=m),E>w&&(E=w),0===E)break e;i.arraySet(f,h,p,E,g),m-=E,p+=E,w-=E,g+=E,n.length-=E;break}n.mode=l;break;case 17:for(;b<14;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(n.nlen=257+(31&_),_>>>=5,b-=5,n.ndist=1+(31&_),_>>>=5,b-=5,n.ncode=4+(15&_),_>>>=4,b-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=d;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;b<3;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}n.lens[D[n.have++]]=7&_,_>>>=3,b-=3}for(;n.have<19;)n.lens[D[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,P={bits:n.lenbits},R=o(0,n.lens,0,19,n.lencode,0,n.work,P),n.lenbits=P.bits,R){e.msg="invalid code lengths set",n.mode=d;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;M=(U=n.lencode[_&(1<<n.lenbits)-1])>>>16&255,O=65535&U,!((S=U>>>24)<=b);){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(O<16)_>>>=S,b-=S,n.lens[n.have++]=O;else{if(16===O){for(C=S+2;b<C;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(_>>>=S,b-=S,0===n.have){e.msg="invalid bit length repeat",n.mode=d;break}L=n.lens[n.have-1],E=3+(3&_),_>>>=2,b-=2}else if(17===O){for(C=S+3;b<C;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}b-=S,L=0,E=3+(7&(_>>>=S)),_>>>=3,b-=3}else{for(C=S+7;b<C;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}b-=S,L=0,E=11+(127&(_>>>=S)),_>>>=7,b-=7}if(n.have+E>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=d;break}for(;E--;)n.lens[n.have++]=L}}if(n.mode===d)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=d;break}if(n.lenbits=9,P={bits:n.lenbits},R=o(1,n.lens,0,n.nlen,n.lencode,0,n.work,P),n.lenbits=P.bits,R){e.msg="invalid literal/lengths set",n.mode=d;break}if(n.distbits=6,n.distcode=n.distdyn,P={bits:n.distbits},R=o(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,P),n.distbits=P.bits,R){e.msg="invalid distances set",n.mode=d;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(m>=6&&w>=258){e.next_out=g,e.avail_out=w,e.next_in=p,e.avail_in=m,n.hold=_,n.bits=b,r(e,k),g=e.next_out,f=e.output,w=e.avail_out,p=e.next_in,h=e.input,m=e.avail_in,_=n.hold,b=n.bits,n.mode===l&&(n.back=-1);break}for(n.back=0;M=(U=n.lencode[_&(1<<n.lenbits)-1])>>>16&255,O=65535&U,!((S=U>>>24)<=b);){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(M&&0==(240&M)){for(N=S,Z=M,T=O;M=(U=n.lencode[T+((_&(1<<N+Z)-1)>>N)])>>>16&255,O=65535&U,!(N+(S=U>>>24)<=b);){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}_>>>=N,b-=N,n.back+=N}if(_>>>=S,b-=S,n.back+=S,n.length=O,0===M){n.mode=26;break}if(32&M){n.back=-1,n.mode=l;break}if(64&M){e.msg="invalid literal/length code",n.mode=d;break}n.extra=15&M,n.mode=22;case 22:if(n.extra){for(C=n.extra;b<C;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}n.length+=_&(1<<n.extra)-1,_>>>=n.extra,b-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;M=(U=n.distcode[_&(1<<n.distbits)-1])>>>16&255,O=65535&U,!((S=U>>>24)<=b);){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(0==(240&M)){for(N=S,Z=M,T=O;M=(U=n.distcode[T+((_&(1<<N+Z)-1)>>N)])>>>16&255,O=65535&U,!(N+(S=U>>>24)<=b);){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}_>>>=N,b-=N,n.back+=N}if(_>>>=S,b-=S,n.back+=S,64&M){e.msg="invalid distance code",n.mode=d;break}n.offset=O,n.extra=15&M,n.mode=24;case 24:if(n.extra){for(C=n.extra;b<C;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}n.offset+=_&(1<<n.extra)-1,_>>>=n.extra,b-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=d;break}n.mode=25;case 25:if(0===w)break e;if(E=k-w,n.offset>E){if((E=n.offset-E)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=d;break}E>n.wnext?(E-=n.wnext,x=n.wsize-E):x=n.wnext-E,E>n.length&&(E=n.length),A=n.window}else A=f,x=g-n.offset,E=n.length;E>w&&(E=w),w-=E,n.length-=E;do{f[g++]=A[x++]}while(--E);0===n.length&&(n.mode=21);break;case 26:if(0===w)break e;f[g++]=n.length,w--,n.mode=21;break;case 27:if(n.wrap){for(;b<32;){if(0===m)break e;m--,_|=h[p++]<<b,b+=8}if(k-=w,e.total_out+=k,n.total+=k,k&&(e.adler=n.check=n.flags?a(n.check,f,k,g-k):s(n.check,f,k,g-k)),k=w,(n.flags?_:u(_))!==n.check){e.msg="incorrect data check",n.mode=d;break}_=0,b=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;b<32;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(_!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=d;break}_=0,b=0}n.mode=29;case 29:R=1;break e;case d:R=-3;break e;case 31:return-4;default:return c}return e.next_out=g,e.avail_out=w,e.next_in=p,e.avail_in=m,n.hold=_,n.bits=b,(n.wsize||k!==e.avail_out&&n.mode<d&&(n.mode<27||4!==t))&&v(e,e.output,e.next_out,k-e.avail_out)?(n.mode=31,-4):(I-=e.avail_in,k-=e.avail_out,e.total_in+=I,e.total_out+=k,n.total+=k,n.wrap&&k&&(e.adler=n.check=n.flags?a(n.check,f,k,e.next_out-k):s(n.check,f,k,e.next_out-k)),e.data_type=n.bits+(n.last?64:0)+(n.mode===l?128:0)+(20===n.mode||15===n.mode?256:0),(0===I&&0===k||4===t)&&0===R&&(R=-5),R)},t.inflateEnd=function(e){if(!e||!e.state)return c;var t=e.state;return t.window&&(t.window=null),e.state=null,0},t.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?c:(n.head=t,t.done=!1,0):c},t.inflateSetDictionary=function(e,t){var n,i=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?c:11===n.mode&&s(1,t,i,0)!==n.check?-3:v(e,t,i,i)?(n.mode=31,-4):(n.havedict=1,0):c},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t,n){"use strict";e.exports=function(e,t,n,i){for(var s=65535&e|0,a=e>>>16&65535|0,r=0;0!==n;){n-=r=n>2e3?2e3:n;do{a=a+(s=s+t[i++]|0)|0}while(--r);s%=65521,a%=65521}return s|a<<16|0}},function(e,t,n){"use strict";var i=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();e.exports=function(e,t,n,s){var a=i,r=s+n;e^=-1;for(var o=s;o<r;o++)e=e>>>8^a[255&(e^t[o])];return-1^e}},function(e,t,n){"use strict";var i=n(2);function s(e){for(var t=e.length;--t>=0;)e[t]=0}var a=256,r=286,o=30,c=15,l=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],d=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],h=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],f=new Array(576);s(f);var p=new Array(60);s(p);var g=new Array(512);s(g);var m=new Array(256);s(m);var w=new Array(29);s(w);var _,b,y,v=new Array(o);function I(e,t,n,i,s){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=s,this.has_stree=e&&e.length}function k(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function E(e){return e<256?g[e]:g[256+(e>>>7)]}function x(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function A(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,x(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function S(e,t,n){A(e,n[2*t],n[2*t+1])}function M(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function O(e,t,n){var i,s,a=new Array(16),r=0;for(i=1;i<=c;i++)a[i]=r=r+n[i-1]<<1;for(s=0;s<=t;s++){var o=e[2*s+1];0!==o&&(e[2*s]=M(a[o]++,o))}}function N(e){var t;for(t=0;t<r;t++)e.dyn_ltree[2*t]=0;for(t=0;t<o;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function Z(e){e.bi_valid>8?x(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function T(e,t,n,i){var s=2*t,a=2*n;return e[s]<e[a]||e[s]===e[a]&&i[t]<=i[n]}function L(e,t,n){for(var i=e.heap[n],s=n<<1;s<=e.heap_len&&(s<e.heap_len&&T(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!T(t,i,e.heap[s],e.depth));)e.heap[n]=e.heap[s],n=s,s<<=1;e.heap[n]=i}function R(e,t,n){var i,s,r,o,c=0;if(0!==e.last_lit)do{i=e.pending_buf[e.d_buf+2*c]<<8|e.pending_buf[e.d_buf+2*c+1],s=e.pending_buf[e.l_buf+c],c++,0===i?S(e,s,t):(S(e,(r=m[s])+a+1,t),0!==(o=l[r])&&A(e,s-=w[r],o),S(e,r=E(--i),n),0!==(o=d[r])&&A(e,i-=v[r],o))}while(c<e.last_lit);S(e,256,t)}function P(e,t){var n,i,s,a=t.dyn_tree,r=t.stat_desc.static_tree,o=t.stat_desc.has_stree,l=t.stat_desc.elems,d=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<l;n++)0!==a[2*n]?(e.heap[++e.heap_len]=d=n,e.depth[n]=0):a[2*n+1]=0;for(;e.heap_len<2;)a[2*(s=e.heap[++e.heap_len]=d<2?++d:0)]=1,e.depth[s]=0,e.opt_len--,o&&(e.static_len-=r[2*s+1]);for(t.max_code=d,n=e.heap_len>>1;n>=1;n--)L(e,a,n);s=l;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],L(e,a,1),i=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=i,a[2*s]=a[2*n]+a[2*i],e.depth[s]=(e.depth[n]>=e.depth[i]?e.depth[n]:e.depth[i])+1,a[2*n+1]=a[2*i+1]=s,e.heap[1]=s++,L(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,i,s,a,r,o,l=t.dyn_tree,d=t.max_code,u=t.stat_desc.static_tree,h=t.stat_desc.has_stree,f=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,g=t.stat_desc.max_length,m=0;for(a=0;a<=c;a++)e.bl_count[a]=0;for(l[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(a=l[2*l[2*(i=e.heap[n])+1]+1]+1)>g&&(a=g,m++),l[2*i+1]=a,i>d||(e.bl_count[a]++,r=0,i>=p&&(r=f[i-p]),o=l[2*i],e.opt_len+=o*(a+r),h&&(e.static_len+=o*(u[2*i+1]+r)));if(0!==m){do{for(a=g-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[g]--,m-=2}while(m>0);for(a=g;0!==a;a--)for(i=e.bl_count[a];0!==i;)(s=e.heap[--n])>d||(l[2*s+1]!==a&&(e.opt_len+=(a-l[2*s+1])*l[2*s],l[2*s+1]=a),i--)}}(e,t),O(a,d,e.bl_count)}function C(e,t,n){var i,s,a=-1,r=t[1],o=0,c=7,l=4;for(0===r&&(c=138,l=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)s=r,r=t[2*(i+1)+1],++o<c&&s===r||(o<l?e.bl_tree[2*s]+=o:0!==s?(s!==a&&e.bl_tree[2*s]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,a=s,0===r?(c=138,l=3):s===r?(c=6,l=3):(c=7,l=4))}function U(e,t,n){var i,s,a=-1,r=t[1],o=0,c=7,l=4;for(0===r&&(c=138,l=3),i=0;i<=n;i++)if(s=r,r=t[2*(i+1)+1],!(++o<c&&s===r)){if(o<l)do{S(e,s,e.bl_tree)}while(0!=--o);else 0!==s?(s!==a&&(S(e,s,e.bl_tree),o--),S(e,16,e.bl_tree),A(e,o-3,2)):o<=10?(S(e,17,e.bl_tree),A(e,o-3,3)):(S(e,18,e.bl_tree),A(e,o-11,7));o=0,a=s,0===r?(c=138,l=3):s===r?(c=6,l=3):(c=7,l=4)}}s(v);var F=!1;function D(e,t,n,s){A(e,0+(s?1:0),3),function(e,t,n,s){Z(e),x(e,n),x(e,~n),i.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n)}t._tr_init=function(e){F||(function(){var e,t,n,i,s,a=new Array(16);for(n=0,i=0;i<28;i++)for(w[i]=n,e=0;e<1<<l[i];e++)m[n++]=i;for(m[n-1]=i,s=0,i=0;i<16;i++)for(v[i]=s,e=0;e<1<<d[i];e++)g[s++]=i;for(s>>=7;i<o;i++)for(v[i]=s<<7,e=0;e<1<<d[i]-7;e++)g[256+s++]=i;for(t=0;t<=c;t++)a[t]=0;for(e=0;e<=143;)f[2*e+1]=8,e++,a[8]++;for(;e<=255;)f[2*e+1]=9,e++,a[9]++;for(;e<=279;)f[2*e+1]=7,e++,a[7]++;for(;e<=287;)f[2*e+1]=8,e++,a[8]++;for(O(f,287,a),e=0;e<o;e++)p[2*e+1]=5,p[2*e]=M(e,5);_=new I(f,l,257,r,c),b=new I(p,d,0,o,c),y=new I(new Array(0),u,0,19,7)}(),F=!0),e.l_desc=new k(e.dyn_ltree,_),e.d_desc=new k(e.dyn_dtree,b),e.bl_desc=new k(e.bl_tree,y),e.bi_buf=0,e.bi_valid=0,N(e)},t._tr_stored_block=D,t._tr_flush_block=function(e,t,n,i){var s,r,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<a;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),P(e,e.l_desc),P(e,e.d_desc),o=function(e){var t;for(C(e,e.dyn_ltree,e.l_desc.max_code),C(e,e.dyn_dtree,e.d_desc.max_code),P(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*h[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),s=e.opt_len+3+7>>>3,(r=e.static_len+3+7>>>3)<=s&&(s=r)):s=r=n+5,n+4<=s&&-1!==t?D(e,t,n,i):4===e.strategy||r===s?(A(e,2+(i?1:0),3),R(e,f,p)):(A(e,4+(i?1:0),3),function(e,t,n,i){var s;for(A(e,t-257,5),A(e,n-1,5),A(e,i-4,4),s=0;s<i;s++)A(e,e.bl_tree[2*h[s]+1],3);U(e,e.dyn_ltree,t-1),U(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),R(e,e.dyn_ltree,e.dyn_dtree)),N(e),i&&Z(e)},t._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(m[n]+a+1)]++,e.dyn_dtree[2*E(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){A(e,2,3),S(e,256,f),function(e){16===e.bi_valid?(x(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},function(e,t,n){"use strict";e.exports=function(e,t){var n,i,s,a,r,o,c,l,d,u,h,f,p,g,m,w,_,b,y,v,I,k,E,x,A;n=e.state,i=e.next_in,x=e.input,s=i+(e.avail_in-5),a=e.next_out,A=e.output,r=a-(t-e.avail_out),o=a+(e.avail_out-257),c=n.dmax,l=n.wsize,d=n.whave,u=n.wnext,h=n.window,f=n.hold,p=n.bits,g=n.lencode,m=n.distcode,w=(1<<n.lenbits)-1,_=(1<<n.distbits)-1;e:do{p<15&&(f+=x[i++]<<p,p+=8,f+=x[i++]<<p,p+=8),b=g[f&w];t:for(;;){if(f>>>=y=b>>>24,p-=y,0==(y=b>>>16&255))A[a++]=65535&b;else{if(!(16&y)){if(0==(64&y)){b=g[(65535&b)+(f&(1<<y)-1)];continue t}if(32&y){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}v=65535&b,(y&=15)&&(p<y&&(f+=x[i++]<<p,p+=8),v+=f&(1<<y)-1,f>>>=y,p-=y),p<15&&(f+=x[i++]<<p,p+=8,f+=x[i++]<<p,p+=8),b=m[f&_];n:for(;;){if(f>>>=y=b>>>24,p-=y,!(16&(y=b>>>16&255))){if(0==(64&y)){b=m[(65535&b)+(f&(1<<y)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(I=65535&b,p<(y&=15)&&(f+=x[i++]<<p,(p+=8)<y&&(f+=x[i++]<<p,p+=8)),(I+=f&(1<<y)-1)>c){e.msg="invalid distance too far back",n.mode=30;break e}if(f>>>=y,p-=y,I>(y=a-r)){if((y=I-y)>d&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(k=0,E=h,0===u){if(k+=l-y,y<v){v-=y;do{A[a++]=h[k++]}while(--y);k=a-I,E=A}}else if(u<y){if(k+=l+u-y,(y-=u)<v){v-=y;do{A[a++]=h[k++]}while(--y);if(k=0,u<v){v-=y=u;do{A[a++]=h[k++]}while(--y);k=a-I,E=A}}}else if(k+=u-y,y<v){v-=y;do{A[a++]=h[k++]}while(--y);k=a-I,E=A}for(;v>2;)A[a++]=E[k++],A[a++]=E[k++],A[a++]=E[k++],v-=3;v&&(A[a++]=E[k++],v>1&&(A[a++]=E[k++]))}else{k=a-I;do{A[a++]=A[k++],A[a++]=A[k++],A[a++]=A[k++],v-=3}while(v>2);v&&(A[a++]=A[k++],v>1&&(A[a++]=A[k++]))}break}}break}}while(i<s&&a<o);i-=v=p>>3,f&=(1<<(p-=v<<3))-1,e.next_in=i,e.next_out=a,e.avail_in=i<s?s-i+5:5-(i-s),e.avail_out=a<o?o-a+257:257-(a-o),n.hold=f,n.bits=p}},function(e,t,n){"use strict";var i=n(2),s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],r=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],o=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,n,c,l,d,u,h){var f,p,g,m,w,_,b,y,v,I=h.bits,k=0,E=0,x=0,A=0,S=0,M=0,O=0,N=0,Z=0,T=0,L=null,R=0,P=new i.Buf16(16),C=new i.Buf16(16),U=null,F=0;for(k=0;k<=15;k++)P[k]=0;for(E=0;E<c;E++)P[t[n+E]]++;for(S=I,A=15;A>=1&&0===P[A];A--);if(S>A&&(S=A),0===A)return l[d++]=20971520,l[d++]=20971520,h.bits=1,0;for(x=1;x<A&&0===P[x];x++);for(S<x&&(S=x),N=1,k=1;k<=15;k++)if(N<<=1,(N-=P[k])<0)return-1;if(N>0&&(0===e||1!==A))return-1;for(C[1]=0,k=1;k<15;k++)C[k+1]=C[k]+P[k];for(E=0;E<c;E++)0!==t[n+E]&&(u[C[t[n+E]]++]=E);if(0===e?(L=U=u,_=19):1===e?(L=s,R-=257,U=a,F-=257,_=256):(L=r,U=o,_=-1),T=0,E=0,k=x,w=d,M=S,O=0,g=-1,m=(Z=1<<S)-1,1===e&&Z>852||2===e&&Z>592)return 1;for(;;){b=k-O,u[E]<_?(y=0,v=u[E]):u[E]>_?(y=U[F+u[E]],v=L[R+u[E]]):(y=96,v=0),f=1<<k-O,x=p=1<<M;do{l[w+(T>>O)+(p-=f)]=b<<24|y<<16|v|0}while(0!==p);for(f=1<<k-1;T&f;)f>>=1;if(0!==f?(T&=f-1,T+=f):T=0,E++,0==--P[k]){if(k===A)break;k=t[n+u[E]]}if(k>S&&(T&m)!==g){for(0===O&&(O=S),w+=x,N=1<<(M=k-O);M+O<A&&!((N-=P[M+O])<=0);)M++,N<<=1;if(Z+=1<<M,1===e&&Z>852||2===e&&Z>592)return 1;l[g=T&m]=S<<24|M<<16|w-d|0}}return 0!==T&&(l[w+T]=k-O<<24|64<<16|0),h.bits=S,0}},function(e,t,n){"use strict";n.r(t);var i=n(3),s=n.n(i),a=n(4),r=n(5),o=n(1),c=n.n(o),l=n(0),d=16384;function u(e,t){var n=this;this.inflatedReady=e,this.deflatedReady=t,this._inflate=function(e){var t=new s.a,n=Object(r.inflateInit2)(t,15);if(n!==l.Z_OK)throw new Error("Problem initializing inflate stream: "+c.a[n]);return function(n){if(void 0===n)return e();var i,s,a;t.input=n,t.next_in=0,t.avail_in=t.input.length;var o=!0;do{if(0===t.avail_out&&(t.output=new Uint8Array(d),i=t.next_out=0,t.avail_out=d),(s=Object(r.inflate)(t,l.Z_NO_FLUSH))!==l.Z_STREAM_END&&s!==l.Z_OK)throw new Error("inflate problem: "+c.a[s]);t.next_out&&(0!==t.avail_out&&s!==l.Z_STREAM_END||(a=t.output.subarray(i,i=t.next_out),o=e(a)))}while(t.avail_in>0&&s!==l.Z_STREAM_END);return t.next_out>i&&(a=t.output.subarray(i,i=t.next_out),o=e(a)),o}}((function(e){return n.inflatedReady(e.buffer.slice(e.byteOffset,e.byteOffset+e.length))})),this._deflate=function(e){var t=new s.a,n=Object(a.deflateInit2)(t,l.Z_DEFAULT_COMPRESSION,l.Z_DEFLATED,15,8,l.Z_DEFAULT_STRATEGY);if(n!==l.Z_OK)throw new Error("Problem initializing deflate stream: "+c.a[n]);return function(n){if(void 0===n)return e();var i,s,r;t.input=n,t.next_in=0,t.avail_in=t.input.length;var o=!0;do{if(0===t.avail_out&&(t.output=new Uint8Array(d),r=t.next_out=0,t.avail_out=d),(i=Object(a.deflate)(t,l.Z_SYNC_FLUSH))!==l.Z_STREAM_END&&i!==l.Z_OK)throw new Error("Deflate problem: "+c.a[i]);0===t.avail_out&&t.next_out>r&&(s=t.output.subarray(r,r=t.next_out),o=e(s))}while((t.avail_in>0||0===t.avail_out)&&i!==l.Z_STREAM_END);return t.next_out>r&&(s=t.output.subarray(r,r=t.next_out),o=e(s)),o}}((function(e){return n.deflatedReady(e.buffer.slice(e.byteOffset,e.byteOffset+e.length))}))}u.prototype.inflate=function(e){this._inflate(new Uint8Array(e))},u.prototype.deflate=function(e){this._deflate(new Uint8Array(e))};var h=function(e,t){return{message:e,buffer:t}},f=new u((function(e){return self.postMessage(h("inflated_ready",e),[e])}),(function(e){return self.postMessage(h("deflated_ready",e),[e])}));self.onmessage=function(e){var t=e.data.message,n=e.data.buffer;switch(t){case"start":break;case"inflate":f.inflate(n);break;case"deflate":f.deflate(n)}}}])},9673:(e,t,n)=>{"use strict";function i(e){return null!=e&&"object"==typeof e&&!0===e["@@functional/placeholder"]}function s(e){return function t(n){return 0===arguments.length||i(n)?t:e.apply(this,arguments)}}function a(e){return function t(n,a){switch(arguments.length){case 0:return t;case 1:return i(n)?t:s((function(t){return e(n,t)}));default:return i(n)&&i(a)?t:i(n)?s((function(t){return e(t,a)})):i(a)?s((function(t){return e(n,t)})):e(n,a)}}}function r(e){return function t(n,r,o){switch(arguments.length){case 0:return t;case 1:return i(n)?t:a((function(t,i){return e(n,t,i)}));case 2:return i(n)&&i(r)?t:i(n)?a((function(t,n){return e(t,r,n)})):i(r)?a((function(t,i){return e(n,t,i)})):s((function(t){return e(n,r,t)}));default:return i(n)&&i(r)&&i(o)?t:i(n)&&i(r)?a((function(t,n){return e(t,n,o)})):i(n)&&i(o)?a((function(t,n){return e(t,r,n)})):i(r)&&i(o)?a((function(t,i){return e(n,t,i)})):i(n)?s((function(t){return e(t,r,o)})):i(r)?s((function(t){return e(n,t,o)})):i(o)?s((function(t){return e(n,r,t)})):e(n,r,o)}}}n.d(t,{ZP:()=>At});const o=a((function(e,t){return null==t||t!=t?e:t}));const c=a((function(e,t){for(var n=t,i=0;i<e.length;){if(null==n)return;n=n[e[i]],i+=1}return n}));const l=r((function(e,t,n){return o(e,c(t,n))}));const d=r((function(e,t,n){return l(e,[t],n)})),u=Array.isArray||function(e){return null!=e&&e.length>=0&&"[object Array]"===Object.prototype.toString.call(e)};function h(e){return"[object String]"===Object.prototype.toString.call(e)}const f=s((function(e){return!!u(e)||!!e&&("object"==typeof e&&(!h(e)&&(1===e.nodeType?!!e.length:0===e.length||e.length>0&&(e.hasOwnProperty(0)&&e.hasOwnProperty(e.length-1)))))}));function p(e){return function t(n){for(var i,s,a,r=[],o=0,c=n.length;o<c;){if(f(n[o]))for(a=0,s=(i=e?t(n[o]):n[o]).length;a<s;)r[r.length]=i[a],a+=1;else r[r.length]=n[o];o+=1}return r}}const g=s(p(!0));const m=s((function(e){for(var t={},n=0;n<e.length;)t[e[n][0]]=e[n][1],n+=1;return t}));const w=a((function(e,t){for(var n=[],i=0,s=Math.min(e.length,t.length);i<s;)n[i]=[e[i],t[i]],i+=1;return n}));function _(e,t){var n;t=t||[];var i=(e=e||[]).length,s=t.length,a=[];for(n=0;n<i;)a[a.length]=e[n],n+=1;for(n=0;n<s;)a[a.length]=t[n],n+=1;return a}function b(e,t){switch(e){case 0:return function(){return t.apply(this,arguments)};case 1:return function(e){return t.apply(this,arguments)};case 2:return function(e,n){return t.apply(this,arguments)};case 3:return function(e,n,i){return t.apply(this,arguments)};case 4:return function(e,n,i,s){return t.apply(this,arguments)};case 5:return function(e,n,i,s,a){return t.apply(this,arguments)};case 6:return function(e,n,i,s,a,r){return t.apply(this,arguments)};case 7:return function(e,n,i,s,a,r,o){return t.apply(this,arguments)};case 8:return function(e,n,i,s,a,r,o,c){return t.apply(this,arguments)};case 9:return function(e,n,i,s,a,r,o,c,l){return t.apply(this,arguments)};case 10:return function(e,n,i,s,a,r,o,c,l,d){return t.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}}function y(e,t){return function(){return t.call(this,e.apply(this,arguments))}}var v=function(){function e(e){this.f=e}return e.prototype["@@transducer/init"]=function(){throw new Error("init not implemented on XWrap")},e.prototype["@@transducer/result"]=function(e){return e},e.prototype["@@transducer/step"]=function(e,t){return this.f(e,t)},e}();const I=a((function(e,t){return b(e.length,(function(){return e.apply(t,arguments)}))}));function k(e,t,n){for(var i=n.next();!i.done;){if((t=e["@@transducer/step"](t,i.value))&&t["@@transducer/reduced"]){t=t["@@transducer/value"];break}i=n.next()}return e["@@transducer/result"](t)}function E(e,t,n,i){return e["@@transducer/result"](n[i](I(e["@@transducer/step"],e),t))}var x="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator";function A(e,t,n){if("function"==typeof e&&(e=function(e){return new v(e)}(e)),f(n))return function(e,t,n){for(var i=0,s=n.length;i<s;){if((t=e["@@transducer/step"](t,n[i]))&&t["@@transducer/reduced"]){t=t["@@transducer/value"];break}i+=1}return e["@@transducer/result"](t)}(e,t,n);if("function"==typeof n["fantasy-land/reduce"])return E(e,t,n,"fantasy-land/reduce");if(null!=n[x])return k(e,t,n[x]());if("function"==typeof n.next)return k(e,t,n);if("function"==typeof n.reduce)return E(e,t,n,"reduce");throw new TypeError("reduce: list must be array or iterable")}const S=r(A);function M(e,t){return function(){var n=arguments.length;if(0===n)return t();var i=arguments[n-1];return u(i)||"function"!=typeof i[e]?t.apply(this,arguments):i[e].apply(i,Array.prototype.slice.call(arguments,0,n-1))}}const O=s(M("tail",r(M("slice",(function(e,t,n){return Array.prototype.slice.call(n,e,t)})))(1,1/0)));function N(){if(0===arguments.length)throw new Error("pipe requires at least one argument");return b(arguments[0].length,S(y,arguments[0],O(arguments)))}const Z=s((function(e){return h(e)?e.split("").reverse().join(""):Array.prototype.slice.call(e,0).reverse()}));function T(){if(0===arguments.length)throw new Error("compose requires at least one argument");return N.apply(this,Z(arguments))}function L(e){return e}const R=s(L);function P(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n}function C(e,t,n){for(var i=0,s=n.length;i<s;){if(e(t,n[i]))return!0;i+=1}return!1}function U(e,t){return Object.prototype.hasOwnProperty.call(t,e)}const F="function"==typeof Object.is?Object.is:function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t};var D=Object.prototype.toString;const z=function(){return"[object Arguments]"===D.call(arguments)?function(e){return"[object Arguments]"===D.call(e)}:function(e){return U("callee",e)}}();var B=!{toString:null}.propertyIsEnumerable("toString"),$=["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],j=function(){return arguments.propertyIsEnumerable("length")}(),q=function(e,t){for(var n=0;n<e.length;){if(e[n]===t)return!0;n+=1}return!1},V="function"!=typeof Object.keys||j?s((function(e){if(Object(e)!==e)return[];var t,n,i=[],s=j&&z(e);for(t in e)!U(t,e)||s&&"length"===t||(i[i.length]=t);if(B)for(n=$.length-1;n>=0;)U(t=$[n],e)&&!q(i,t)&&(i[i.length]=t),n-=1;return i})):s((function(e){return Object(e)!==e?[]:Object.keys(e)}));const Q=V;const H=s((function(e){return null===e?"Null":void 0===e?"Undefined":Object.prototype.toString.call(e).slice(8,-1)}));function K(e,t,n,i){var s=P(e);function a(e,t){return W(e,t,n.slice(),i.slice())}return!C((function(e,t){return!C(a,t,e)}),P(t),s)}function W(e,t,n,i){if(F(e,t))return!0;var s,a,r=H(e);if(r!==H(t))return!1;if(null==e||null==t)return!1;if("function"==typeof e["fantasy-land/equals"]||"function"==typeof t["fantasy-land/equals"])return"function"==typeof e["fantasy-land/equals"]&&e["fantasy-land/equals"](t)&&"function"==typeof t["fantasy-land/equals"]&&t["fantasy-land/equals"](e);if("function"==typeof e.equals||"function"==typeof t.equals)return"function"==typeof e.equals&&e.equals(t)&&"function"==typeof t.equals&&t.equals(e);switch(r){case"Arguments":case"Array":case"Object":if("function"==typeof e.constructor&&"Promise"===(s=e.constructor,null==(a=String(s).match(/^function (\w*)/))?"":a[1]))return e===t;break;case"Boolean":case"Number":case"String":if(typeof e!=typeof t||!F(e.valueOf(),t.valueOf()))return!1;break;case"Date":if(!F(e.valueOf(),t.valueOf()))return!1;break;case"Error":return e.name===t.name&&e.message===t.message;case"RegExp":if(e.source!==t.source||e.global!==t.global||e.ignoreCase!==t.ignoreCase||e.multiline!==t.multiline||e.sticky!==t.sticky||e.unicode!==t.unicode)return!1}for(var o=n.length-1;o>=0;){if(n[o]===e)return i[o]===t;o-=1}switch(r){case"Map":return e.size===t.size&&K(e.entries(),t.entries(),n.concat([e]),i.concat([t]));case"Set":return e.size===t.size&&K(e.values(),t.values(),n.concat([e]),i.concat([t]));case"Arguments":case"Array":case"Object":case"Boolean":case"Number":case"String":case"Date":case"Error":case"RegExp":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"ArrayBuffer":break;default:return!1}var c=Q(e);if(c.length!==Q(t).length)return!1;var l=n.concat([e]),d=i.concat([t]);for(o=c.length-1;o>=0;){var u=c[o];if(!U(u,t)||!W(t[u],e[u],l,d))return!1;o-=1}return!0}const G=a((function(e,t){return W(e,t,[],[])}));function Y(e,t){return function(e,t,n){var i,s;if("function"==typeof e.indexOf)switch(typeof t){case"number":if(0===t){for(i=1/t;n<e.length;){if(0===(s=e[n])&&1/s===i)return n;n+=1}return-1}if(t!=t){for(;n<e.length;){if("number"==typeof(s=e[n])&&s!=s)return n;n+=1}return-1}return e.indexOf(t,n);case"string":case"boolean":case"function":case"undefined":return e.indexOf(t,n);case"object":if(null===t)return e.indexOf(t,n)}for(;n<e.length;){if(G(e[n],t))return n;n+=1}return-1}(t,e,0)>=0}function X(e,t,n){var i,s=typeof e;switch(s){case"string":case"number":return 0===e&&1/e==-1/0?!!n._items["-0"]||(t&&(n._items["-0"]=!0),!1):null!==n._nativeSet?t?(i=n._nativeSet.size,n._nativeSet.add(e),n._nativeSet.size===i):n._nativeSet.has(e):s in n._items?e in n._items[s]||(t&&(n._items[s][e]=!0),!1):(t&&(n._items[s]={},n._items[s][e]=!0),!1);case"boolean":if(s in n._items){var a=e?1:0;return!!n._items[s][a]||(t&&(n._items[s][a]=!0),!1)}return t&&(n._items[s]=e?[!1,!0]:[!0,!1]),!1;case"function":return null!==n._nativeSet?t?(i=n._nativeSet.size,n._nativeSet.add(e),n._nativeSet.size===i):n._nativeSet.has(e):s in n._items?!!Y(e,n._items[s])||(t&&n._items[s].push(e),!1):(t&&(n._items[s]=[e]),!1);case"undefined":return!!n._items[s]||(t&&(n._items[s]=!0),!1);case"object":if(null===e)return!!n._items.null||(t&&(n._items.null=!0),!1);default:return(s=Object.prototype.toString.call(e))in n._items?!!Y(e,n._items[s])||(t&&n._items[s].push(e),!1):(t&&(n._items[s]=[e]),!1)}}const J=function(){function e(){this._nativeSet="function"==typeof Set?new Set:null,this._items={}}return e.prototype.add=function(e){return!X(e,!0,this)},e.prototype.has=function(e){return X(e,!1,this)},e}();const ee=a(T(a((function(e,t){for(var n,i,s=new J,a=[],r=0;r<t.length;)n=e(i=t[r]),s.add(n)&&a.push(i),r+=1;return a}))(R),_));function te(e){return null!=e&&"function"==typeof e["@@transducer/step"]}function ne(e,t,n){return function(){if(0===arguments.length)return n();var i=Array.prototype.slice.call(arguments,0),s=i.pop();if(!u(s)){for(var a=0;a<e.length;){if("function"==typeof s[e[a]])return s[e[a]].apply(s,i);a+=1}if(te(s)){var r=t.apply(null,i);return r(s)}}return n.apply(this,arguments)}}function ie(e,t){for(var n=0,i=t.length,s=Array(i);n<i;)s[n]=e(t[n]),n+=1;return s}const se=function(){return this.xf["@@transducer/init"]()},ae=function(e){return this.xf["@@transducer/result"](e)};var re=function(){function e(e,t){this.xf=t,this.f=e}return e.prototype["@@transducer/init"]=se,e.prototype["@@transducer/result"]=ae,e.prototype["@@transducer/step"]=function(e,t){return this.xf["@@transducer/step"](e,this.f(t))},e}();const oe=a((function(e,t){return new re(e,t)}));function ce(e,t,n){return function(){for(var s=[],a=0,r=e,o=0;o<t.length||a<arguments.length;){var c;o<t.length&&(!i(t[o])||a>=arguments.length)?c=t[o]:(c=arguments[a],a+=1),s[o]=c,i(c)||(r-=1),o+=1}return r<=0?n.apply(this,s):b(r,ce(e,s,n))}}const le=a((function(e,t){return 1===e?s(t):b(e,ce(e,[],t))}));const de=a(ne(["fantasy-land/map","map"],oe,(function(e,t){switch(Object.prototype.toString.call(t)){case"[object Function]":return le(t.length,(function(){return e.call(this,t.apply(this,arguments))}));case"[object Object]":return A((function(n,i){return n[i]=e(t[i]),n}),{},Q(t));default:return ie(e,t)}})));var ue=n(83065),he=n(84846);const fe=32,pe=93,ge=e=>(e=>e>=1&&e<=127)(e)&&!me(e),me=e=>40===e||41===e||123===e||e===fe||we(e)||_e(e)||be(e)||ye(e),we=e=>e>=0&&e<=31||127===e,_e=e=>37===e||42===e,be=e=>34===e||92===e,ye=e=>e===pe,ve=e=>e>=48&&e<=57,Ie=e=>(e=>e>=65&&e<=90||e>=97&&e<=122)(e)||ve(e),ke=e=>ge(e)||ye(e);function Ee(e,t,n){let i=[],s=(e.tag||"")+(e.command?" "+e.command:""),a=!0,r=function(e){if(s.length>0&&a&&(s+=" "),Array.isArray(e))return a=!1,s+="(",e.forEach(r),void(s+=")");if(a=!0,e||"string"==typeof e||"number"==typeof e)if("string"!=typeof e)if("number"!=typeof e)if(n&&e.sensitive)s+='"(* value hidden *)"';else switch(e.type.toUpperCase()){case"LITERAL":n?s+='"(* '+e.value.length+'B literal *)"':(e.value?s+="{"+e.value.length+"}\r\n":s+="{0}\r\n",i.push(s),s=e.value||"");break;case"STRING":n&&e.value.length>20?s+='"(* '+e.value.length+'B string *)"':s+=JSON.stringify(e.value||"");break;case"TEXT":case"SEQUENCE":s+=e.value||"";break;case"NUMBER":s+=e.value||0;break;case"ATOM":case"SECTION":let t=e.value||"";for(let e=92===t.charCodeAt(0)?1:0;e<t.length;e++)if(!ge(t.charCodeAt(e))){t=JSON.stringify(t);break}s+=t,e.section&&(s+="[",e.section.length&&(a=!1,e.section.forEach(r)),s+="]"),e.partial&&(s+="<"+e.partial.join(".")+">")}else s+=Math.round(e)||0;else n&&e.length>20?s+='"(* '+e.length+'B string *)"':s+=JSON.stringify(e);else s+="NIL"};return[].concat(e.attributes||[]).forEach(r),s.length&&i.push(s),t?i:i.join("")}function xe(e){return"[object Function]"===Object.prototype.toString.call(e)}function Ae(e){return'"'+e.replace(/\\/g,"\\\\").replace(/[\b]/g,"\\b").replace(/\f/g,"\\f").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t").replace(/\v/g,"\\v").replace(/\0/g,"\\0").replace(/"/g,'\\"')+'"'}var Se=function(e){return(e<10?"0":"")+e};const Me="function"==typeof Date.prototype.toISOString?function(e){return e.toISOString()}:function(e){return e.getUTCFullYear()+"-"+Se(e.getUTCMonth()+1)+"-"+Se(e.getUTCDate())+"T"+Se(e.getUTCHours())+":"+Se(e.getUTCMinutes())+":"+Se(e.getUTCSeconds())+"."+(e.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"};var Oe=function(){function e(e,t){this.xf=t,this.f=e}return e.prototype["@@transducer/init"]=se,e.prototype["@@transducer/result"]=ae,e.prototype["@@transducer/step"]=function(e,t){return this.f(t)?this.xf["@@transducer/step"](e,t):e},e}();const Ne=a(ne(["filter"],a((function(e,t){return new Oe(e,t)})),(function(e,t){return n=t,"[object Object]"===Object.prototype.toString.call(n)?A((function(n,i){return e(t[i])&&(n[i]=t[i]),n}),{},Q(t)):function(e,t){for(var n=0,i=t.length,s=[];n<i;)e(t[n])&&(s[s.length]=t[n]),n+=1;return s}(e,t);var n})));const Ze=a((function(e,t){return Ne((n=e,function(){return!n.apply(this,arguments)}),t);var n}));function Te(e,t){var n=function(n){var i=t.concat([e]);return Y(n,i)?"<Circular>":Te(n,i)},i=function(e,t){return ie((function(t){return Ae(t)+": "+n(e[t])}),t.slice().sort())};switch(Object.prototype.toString.call(e)){case"[object Arguments]":return"(function() { return arguments; }("+ie(n,e).join(", ")+"))";case"[object Array]":return"["+ie(n,e).concat(i(e,Ze((function(e){return/^\d+$/.test(e)}),Q(e)))).join(", ")+"]";case"[object Boolean]":return"object"==typeof e?"new Boolean("+n(e.valueOf())+")":e.toString();case"[object Date]":return"new Date("+(isNaN(e.valueOf())?n(NaN):Ae(Me(e)))+")";case"[object Null]":return"null";case"[object Number]":return"object"==typeof e?"new Number("+n(e.valueOf())+")":1/e==-1/0?"-0":e.toString(10);case"[object String]":return"object"==typeof e?"new String("+n(e.valueOf())+")":Ae(e);case"[object Undefined]":return"undefined";default:if("function"==typeof e.toString){var s=e.toString();if("[object Object]"!==s)return s}return"{"+i(e,Q(e)).join(", ")+"}"}}const Le=s((function(e){return Te(e,[])}));const Re=a((function(e,t){return le(e+1,(function(){var n=arguments[e];if(null!=n&&xe(n[t]))return n[t].apply(n,Array.prototype.slice.call(arguments,0,e));throw new TypeError(Le(n)+' does not have a method named "'+t+'"')}))}))(0,"toLowerCase");const Pe=a((function(e,t){return c([e],t)}));var Ce=n(85834);function Ue(e){return!!e&&(e=[].concat(e||[])).map((e=>!(!e||!e.length)&&{prefix:e[0].value,delimiter:e[1]&&e[1].value}))}function Fe(e){const t={};return e[0]&&e[0].value&&(t.date=e[0].value),e[1]&&e[1].value&&(t.subject=(0,Ce.Mf)(e[1]&&e[1].value)),e[2]&&e[2].length&&(t.from=De(e[2])),e[3]&&e[3].length&&(t.sender=De(e[3])),e[4]&&e[4].length&&(t["reply-to"]=De(e[4])),e[5]&&e[5].length&&(t.to=De(e[5])),e[6]&&e[6].length&&(t.cc=De(e[6])),e[7]&&e[7].length&&(t.bcc=De(e[7])),e[8]&&e[8].value&&(t["in-reply-to"]=e[8].value),e[9]&&e[9].value&&(t["message-id"]=e[9].value),t}function De(e=[]){return e.map((e=>{const t=l("",["0","value"],e).trim(),n=l("",["2","value"],e)+"@"+l("",["3","value"],e),i=t?function(e){if(!/^[\w ']*$/.test(e))return/^[\x20-\x7e]*$/.test(e)?JSON.stringify(e):(0,Ce.KR)(e,"Q",52);return e}(t)+" <"+n+">":n,s=(0,he.Z)(i).shift();return s.name=(0,Ce.Mf)(s.name),s}))}function ze(e,t=[]){const n={};let i=0,s=0;if(t.length&&(n.part=t.join(".")),Array.isArray(e[0])){for(n.childNodes=[];Array.isArray(e[i]);)n.childNodes.push(ze(e[i],t.concat(++s))),i++;n.type="multipart/"+((e[i++]||{}).value||"").toString().toLowerCase(),i<e.length-1&&(e[i]&&(n.parameters=Be(e[i])),i++)}else n.type=[((e[i++]||{}).value||"").toString().toLowerCase(),((e[i++]||{}).value||"").toString().toLowerCase()].join("/"),e[i]&&(n.parameters=Be(e[i])),i++,e[i]&&(n.id=((e[i]||{}).value||"").toString()),i++,e[i]&&(n.description=((e[i]||{}).value||"").toString()),i++,e[i]&&(n.encoding=((e[i]||{}).value||"").toString().toLowerCase()),i++,e[i]&&(n.size=Number((e[i]||{}).value||0)||0),i++,"message/rfc822"===n.type?(e[i]&&(n.envelope=Fe([].concat(e[i]||[]))),i++,e[i]&&(n.childNodes=[ze(e[i],t)]),i++,e[i]&&(n.lineCount=Number((e[i]||{}).value||0)||0),i++):/^text\//.test(n.type)&&(e[i]&&(n.lineCount=Number((e[i]||{}).value||0)||0),i++),i<e.length-1&&(e[i]&&(n.md5=((e[i]||{}).value||"").toString().toLowerCase()),i++);return i<e.length-1&&(Array.isArray(e[i])&&e[i].length&&(n.disposition=((e[i][0]||{}).value||"").toString().toLowerCase(),Array.isArray(e[i][1])&&(n.dispositionParameters=Be(e[i][1]))),i++),i<e.length-1&&(e[i]&&(n.language=[].concat(e[i]).map((e=>d("","value",e).toLowerCase()))),i++),i<e.length-1&&(e[i]&&(n.location=((e[i]||{}).value||"").toString()),i++),n}function Be(e=[],t=Re,n=Ce.Mf){const i=e.map(Pe("value")),s=i.filter(((e,t)=>t%2==0)).map(t),a=i.filter(((e,t)=>t%2==1)).map(n);return m(w(s,a))}function $e(e){if(!(e&&e.payload&&e.payload.FETCH&&e.payload.FETCH.length))return[];const t=[],n={};return e.payload.FETCH.forEach((e=>{const i=[].concat([].concat(e.attributes||[])[0]||[]);let s,a,r,o;for(n[e.nr]?s=n[e.nr]:(n[e.nr]=s={"#":e.nr},t.push(s)),a=0,r=i.length;a<r;a++)a%2!=0?s[o]=je(o,i[a]):o=Ee({attributes:[i[a]]}).toLowerCase().replace(/<\d+>$/,"")})),t}function je(e,t){if(!t)return null;if(!Array.isArray(t)){switch(e){case"uid":case"rfc822.size":return Number(t.value)||0;case"modseq":return t.value||"0"}return t.value}switch(e){case"flags":case"x-gm-labels":t=[].concat(t).map((e=>e.value||""));break;case"envelope":t=Fe([].concat(t||[]));break;case"bodystructure":t=ze([].concat(t||[]));break;case"modseq":t=(t.shift()||{}).value||"0"}return t}function qe(e){for(var t=[],n=0;n<e.length;n+=10240){const i=n,s=Math.min(n+10240,e.length);t.push(String.fromCharCode.apply(null,e.subarray(i,s)))}return t.join("")}function Ve(e){let t=0,n=e.length;for(;e[t]===fe;)t++;for(;e[n-1]===fe;)n--;return 0===t&&n===e.length||(e=e.subarray(t,n)),qe(e)}class Qe{constructor(e,t){this.remainder=new Uint8Array(e||0),this.options=t||{},this.pos=0}getTag(){if(!this.tag){const e=e=>(e=>ke(e)&&43!==e)(e)||42===e||43===e;this.tag=this.getElement(e)}return this.tag}getCommand(){switch(this.command||(this.command=this.getElement(Ie)),(this.command||"").toString().toUpperCase()){case"OK":case"NO":case"BAD":case"PREAUTH":case"BYE":let e=this.remainder.lastIndexOf(pe);91===this.remainder[1]&&e>1?(this.humanReadable=Ve(this.remainder.subarray(e+1)),this.remainder=this.remainder.subarray(0,e+1)):(this.humanReadable=Ve(this.remainder),this.remainder=new Uint8Array(0))}return this.command}getElement(e){let t;if(this.remainder[0]===fe)throw new Error("Unexpected whitespace at position "+this.pos);let n=this.remainder.indexOf(fe);if(!(this.remainder.length>0&&0!==n))throw new Error("Unexpected end of input at position "+this.pos);t=-1===n?this.remainder:this.remainder.subarray(0,n);for(let n=0;n<t.length;n++)if(!e(t[n]))throw new Error("Unexpected char at position "+(this.pos+n));return this.pos+=t.length,this.remainder=this.remainder.subarray(t.length),qe(t)}getSpace(){if(!this.remainder.length)throw new Error("Unexpected end of input at position "+this.pos);if(this.remainder[0]!==fe)throw new Error("Unexpected char at position "+this.pos);this.pos++,this.remainder=this.remainder.subarray(1)}getAttributes(){if(!this.remainder.length)throw new Error("Unexpected end of input at position "+this.pos);if(this.remainder[0]===fe)throw new Error("Unexpected whitespace at position "+this.pos);return new Ke(this,this.pos,this.remainder.subarray(),this.options).getAttributes()}}class He{constructor(e,t,n){this.uint8Array=e,this.childNodes=[],this.type=!1,this.closed=!0,this.valueSkip=[],this.startPos=n,this.valueStart=this.valueEnd="number"==typeof n?n+1:0,t&&(this.parentNode=t,t.childNodes.push(this))}getValue(){let e=qe(this.getValueArray());return this.valueToUpperCase?e.toUpperCase():e}getValueLength(){return this.valueEnd-this.valueStart-this.valueSkip.length}getValueArray(){const e=this.uint8Array.subarray(this.valueStart,this.valueEnd);if(0===this.valueSkip.length)return e;let t=new Uint8Array(e.length-this.valueSkip.length),n=0,i=0,s=this.valueSkip.slice();return s.push(e.length),s.forEach((function(s){if(s>n){var a=e.subarray(n,s);t.set(a,i),i+=a.length}n=s+1})),t}equals(e,t){return this.getValueLength()===e.length&&this.equalsAt(e,0,t)}equalsAt(e,t,n){if(n="boolean"!=typeof n||n,t<0)for(t=this.valueEnd+t;this.valueSkip.indexOf(this.valueStart+t)>=0;)t--;else t=this.valueStart+t;for(let i=0;i<e.length;i++){for(;this.valueSkip.indexOf(t-this.valueStart)>=0;)t++;if(t>=this.valueEnd)return!1;let s=String.fromCharCode(this.uint8Array[t]),a=e[i];if(n||(s=s.toUpperCase(),a=a.toUpperCase()),s!==a)return!1;t++}return!0}isNumber(){for(let e=0;e<this.valueEnd-this.valueStart;e++)if(!(this.valueSkip.indexOf(e)>=0||this.isDigit(e)))return!1;return!0}isDigit(e){if(e<0)for(e=this.valueEnd+e;this.valueSkip.indexOf(this.valueStart+e)>=0;)e--;else for(e=this.valueStart+e;this.valueSkip.indexOf(this.valueStart+e)>=0;)e++;return ve(this.uint8Array[e])}containsChar(e){let t=e.charCodeAt(0);for(let e=this.valueStart;e<this.valueEnd;e++)if(!(this.valueSkip.indexOf(e-this.valueStart)>=0)&&this.uint8Array[e]===t)return!0;return!1}}class Ke{constructor(e,t,n,i={}){this.uint8Array=n,this.options=i,this.parent=e,this.tree=this.currentNode=this.createNode(),this.pos=t||0,this.currentNode.type="TREE",this.state="NORMAL",void 0===this.options.valueAsString&&(this.options.valueAsString=!0),this.processString()}getAttributes(){let e=[],t=e,n=e=>{let i,s,a=t;if(!e.closed&&"SEQUENCE"===e.type&&e.equals("*")&&(e.closed=!0,e.type="ATOM"),!e.closed)throw new Error("Unexpected end of input at position "+(this.pos+this.uint8Array.length-1));switch(e.type.toUpperCase()){case"LITERAL":case"STRING":i={type:e.type.toUpperCase(),value:this.options.valueAsString?e.getValue():e.getValueArray()},t.push(i);break;case"SEQUENCE":i={type:e.type.toUpperCase(),value:e.getValue()},t.push(i);break;case"ATOM":if(e.equals("NIL",!0)){t.push(null);break}i={type:e.type.toUpperCase(),value:e.getValue()},t.push(i);break;case"SECTION":t=t[t.length-1].section=[];break;case"LIST":i=[],t.push(i),t=i;break;case"PARTIAL":s=e.getValue().split(".").map(Number),t[t.length-1].partial=s}e.childNodes.forEach((function(e){n(e)})),t=a};return n(this.tree),e}createNode(e,t){return new He(this.uint8Array,e,t)}processString(){let e,t;const n=t=>{for(;this.uint8Array[e+1]===fe;)e++};for(e=0,t=this.uint8Array.length;e<t;e++){let i=this.uint8Array[e];switch(this.state){case"NORMAL":switch(i){case 34:this.currentNode=this.createNode(this.currentNode,e),this.currentNode.type="string",this.state="STRING",this.currentNode.closed=!1;break;case 40:this.currentNode=this.createNode(this.currentNode,e),this.currentNode.type="LIST",this.currentNode.closed=!1;break;case 41:if("LIST"!==this.currentNode.type)throw new Error("Unexpected list terminator ) at position "+(this.pos+e));this.currentNode.closed=!0,this.currentNode.endPos=this.pos+e,this.currentNode=this.currentNode.parentNode,n();break;case pe:if("SECTION"!==this.currentNode.type)throw new Error("Unexpected section terminator ] at position "+(this.pos+e));this.currentNode.closed=!0,this.currentNode.endPos=this.pos+e,this.currentNode=this.currentNode.parentNode,n();break;case 60:this.uint8Array[e-1]!==pe?(this.currentNode=this.createNode(this.currentNode,e),this.currentNode.type="ATOM",this.currentNode.valueStart=e,this.currentNode.valueEnd=e+1,this.state="ATOM"):(this.currentNode=this.createNode(this.currentNode,e),this.currentNode.type="PARTIAL",this.state="PARTIAL",this.currentNode.closed=!1);break;case 123:this.currentNode=this.createNode(this.currentNode,e),this.currentNode.type="LITERAL",this.state="LITERAL",this.currentNode.closed=!1;break;case 42:this.currentNode=this.createNode(this.currentNode,e),this.currentNode.type="SEQUENCE",this.currentNode.valueStart=e,this.currentNode.valueEnd=e+1,this.currentNode.closed=!1,this.state="SEQUENCE";break;case fe:case 126:break;case 91:if(["OK","NO","BAD","BYE","PREAUTH"].indexOf(this.parent.command.toUpperCase())>=0&&this.currentNode===this.tree){this.currentNode.endPos=this.pos+e,this.currentNode=this.createNode(this.currentNode,e),this.currentNode.type="ATOM",this.currentNode=this.createNode(this.currentNode,e),this.currentNode.type="SECTION",this.currentNode.closed=!1,this.state="NORMAL","REFERRAL "===qe(this.uint8Array.subarray(e+1,e+10)).toUpperCase()&&(this.currentNode=this.createNode(this.currentNode,this.pos+e+1),this.currentNode.type="ATOM",this.currentNode.endPos=this.pos+e+8,this.currentNode.valueStart=e+1,this.currentNode.valueEnd=e+9,this.currentNode.valueToUpperCase=!0,this.currentNode=this.currentNode.parentNode,this.currentNode=this.createNode(this.currentNode,this.pos+e+10),this.currentNode.type="ATOM",e=this.uint8Array.indexOf(pe,e+10),this.currentNode.endPos=this.pos+e-1,this.currentNode.valueStart=this.currentNode.startPos-this.pos,this.currentNode.valueEnd=this.currentNode.endPos-this.pos+1,this.currentNode=this.currentNode.parentNode,this.currentNode.closed=!0,this.currentNode=this.currentNode.parentNode,n());break}default:if(!ge(i)&&92!==i&&37!==i)throw new Error("Unexpected char at position "+(this.pos+e));this.currentNode=this.createNode(this.currentNode,e),this.currentNode.type="ATOM",this.currentNode.valueStart=e,this.currentNode.valueEnd=e+1,this.state="ATOM"}break;case"ATOM":if(i===fe){this.currentNode.endPos=this.pos+e-1,this.currentNode=this.currentNode.parentNode,this.state="NORMAL";break}if(this.currentNode.parentNode&&(41===i&&"LIST"===this.currentNode.parentNode.type||i===pe&&"SECTION"===this.currentNode.parentNode.type)){this.currentNode.endPos=this.pos+e-1,this.currentNode=this.currentNode.parentNode,this.currentNode.closed=!0,this.currentNode.endPos=this.pos+e,this.currentNode=this.currentNode.parentNode,this.state="NORMAL",n();break}if(44!==i&&58!==i||!this.currentNode.isNumber()||(this.currentNode.type="SEQUENCE",this.currentNode.closed=!0,this.state="SEQUENCE"),91===i&&(this.currentNode.equals("BODY",!1)||this.currentNode.equals("BODY.PEEK",!1))){this.currentNode.endPos=this.pos+e,this.currentNode=this.createNode(this.currentNode.parentNode,this.pos+e),this.currentNode.type="SECTION",this.currentNode.closed=!1,this.state="NORMAL";break}if(60===i)throw new Error("Unexpected start of partial at position "+this.pos);if(!(ge(i)||i===pe||42===i&&this.currentNode.equals("\\")))throw new Error("Unexpected char at position "+(this.pos+e));if(this.currentNode.equals("\\*"))throw new Error("Unexpected char at position "+(this.pos+e));this.currentNode.valueEnd=e+1;break;case"STRING":if(34===i){this.currentNode.endPos=this.pos+e,this.currentNode.closed=!0,this.currentNode=this.currentNode.parentNode,this.state="NORMAL",n();break}if(92===i){if(this.currentNode.valueSkip.push(e-this.currentNode.valueStart),e++,e>=t)throw new Error("Unexpected end of input at position "+(this.pos+e));i=this.uint8Array[e]}this.currentNode.valueEnd=e+1;break;case"PARTIAL":if(62===i){if(this.currentNode.equalsAt(".",-1))throw new Error("Unexpected end of partial at position "+this.pos);this.currentNode.endPos=this.pos+e,this.currentNode.closed=!0,this.currentNode=this.currentNode.parentNode,this.state="NORMAL",n();break}if(46===i&&(!this.currentNode.getValueLength()||this.currentNode.containsChar(".")))throw new Error("Unexpected partial separator . at position "+this.pos);if(!ve(i)&&46!==i)throw new Error("Unexpected char at position "+(this.pos+e));if(46!==i&&(this.currentNode.equals("0")||this.currentNode.equalsAt(".0",-2)))throw new Error("Invalid partial at position "+(this.pos+e));this.currentNode.valueEnd=e+1;break;case"LITERAL":if(this.currentNode.started){this.currentNode.valueEnd=e+1,this.currentNode.getValueLength()>=this.currentNode.literalLength&&(this.currentNode.endPos=this.pos+e,this.currentNode.closed=!0,this.currentNode=this.currentNode.parentNode,this.state="NORMAL",n());break}if(43===i){this.currentNode.literalPlus=!0;break}if(125===i){if(!("literalLength"in this.currentNode))throw new Error("Unexpected literal prefix end char } at position "+(this.pos+e));if(10===this.uint8Array[e+1])e++;else{if(13!==this.uint8Array[e+1]||10!==this.uint8Array[e+2])throw new Error("Unexpected char at position "+(this.pos+e));e+=2}this.currentNode.valueStart=e+1,this.currentNode.literalLength=Number(this.currentNode.literalLength),this.currentNode.started=!0,this.currentNode.literalLength||(this.currentNode.endPos=this.pos+e,this.currentNode.closed=!0,this.currentNode=this.currentNode.parentNode,this.state="NORMAL",n());break}if(!ve(i))throw new Error("Unexpected char at position "+(this.pos+e));if("0"===this.currentNode.literalLength)throw new Error("Invalid literal at position "+(this.pos+e));this.currentNode.literalLength=(this.currentNode.literalLength||"")+String.fromCharCode(i);break;case"SEQUENCE":if(i===fe){if(!this.currentNode.isDigit(-1)&&!this.currentNode.equalsAt("*",-1))throw new Error("Unexpected whitespace at position "+(this.pos+e));if(this.currentNode.equalsAt("*",-1)&&!this.currentNode.equalsAt(":",-2))throw new Error("Unexpected whitespace at position "+(this.pos+e));this.currentNode.closed=!0,this.currentNode.endPos=this.pos+e-1,this.currentNode=this.currentNode.parentNode,this.state="NORMAL";break}if(this.currentNode.parentNode&&i===pe&&"SECTION"===this.currentNode.parentNode.type){this.currentNode.endPos=this.pos+e-1,this.currentNode=this.currentNode.parentNode,this.currentNode.closed=!0,this.currentNode.endPos=this.pos+e,this.currentNode=this.currentNode.parentNode,this.state="NORMAL",n();break}if(58===i){if(!this.currentNode.isDigit(-1)&&!this.currentNode.equalsAt("*",-1))throw new Error("Unexpected range separator : at position "+(this.pos+e))}else if(42===i){if(!this.currentNode.equalsAt(",",-1)&&!this.currentNode.equalsAt(":",-1))throw new Error("Unexpected range wildcard at position "+(this.pos+e))}else if(44===i){if(!this.currentNode.isDigit(-1)&&!this.currentNode.equalsAt("*",-1))throw new Error("Unexpected sequence separator , at position "+(this.pos+e));if(this.currentNode.equalsAt("*",-1)&&!this.currentNode.equalsAt(":",-2))throw new Error("Unexpected sequence separator , at position "+(this.pos+e))}else if(!ve(i))throw new Error("Unexpected char at position "+(this.pos+e));if(ve(i)&&this.currentNode.equalsAt("*",-1))throw new Error("Unexpected number at position "+(this.pos+e));this.currentNode.valueEnd=e+1}}}}function We(e,t={}){let n=new Qe(e,t),i={};return i.tag=n.getTag(),n.getSpace(),i.command=n.getCommand(),["UID","AUTHENTICATE"].indexOf((i.command||"").toUpperCase())>=0&&(n.getSpace(),i.command+=" "+n.getElement(Ie)),function(e){for(let t=0;t<e.length;t++)if(e[t]!==fe)return!1;return!0}(n.remainder)||(n.getSpace(),i.attributes=n.getAttributes()),n.humanReadable&&(i.attributes=(i.attributes||[]).concat({type:"TEXT",value:n.humanReadable})),i}var Ge=n(65546);const Ye=e=>new Uint8Array(e.split("").map((e=>e.charCodeAt(0)))),Xe=e=>String.fromCharCode.apply(null,e);function Je(e="",t){const n=[`user=${e}`,`auth=Bearer ${t}`,"",""];return(0,Ge.encode)(n.join(""))}let et=0;function tt(e,t){const n=++et,i=(i,s)=>{s=s.map((e=>"function"==typeof e?e():e));const a=`[${(new Date).toISOString()}][${n}][${e}][${t}] ${s.join(" ")}`;10===i?console.log("[DEBUG]"+a):20===i?console.info("[INFO]"+a):30===i?console.warn("[WARN]"+a):40===i&&console.error("[ERROR]"+a)};return{debug:e=>i(10,e),info:e=>i(20,e),warn:e=>i(30,e),error:e=>i(40,e)}}var nt=n(16504),it=n(62292),st=n.n(it),at=n(30405),rt=n(27948),ot=n(48898),ct=n.n(ot),lt=n(71619);const dt=16384;function ut(e,t){this.inflatedReady=e,this.deflatedReady=t,this._inflate=function(e){const t=new(st()),n=(0,rt.Ul)(t,15);if(n!==lt.Z_OK)throw new Error("Problem initializing inflate stream: "+ct()[n]);return function(n){if(void 0===n)return e();let i,s,a;t.input=n,t.next_in=0,t.avail_in=t.input.length;let r=!0;do{if(0===t.avail_out&&(t.output=new Uint8Array(dt),i=t.next_out=0,t.avail_out=dt),s=(0,rt.rr)(t,lt.Z_NO_FLUSH),s!==lt.Z_STREAM_END&&s!==lt.Z_OK)throw new Error("inflate problem: "+ct()[s]);t.next_out&&(0!==t.avail_out&&s!==lt.Z_STREAM_END||(a=t.output.subarray(i,i=t.next_out),r=e(a)))}while(t.avail_in>0&&s!==lt.Z_STREAM_END);return t.next_out>i&&(a=t.output.subarray(i,i=t.next_out),r=e(a)),r}}((e=>this.inflatedReady(e.buffer.slice(e.byteOffset,e.byteOffset+e.length)))),this._deflate=function(e){const t=new(st()),n=(0,at.Ue)(t,lt.Z_DEFAULT_COMPRESSION,lt.Z_DEFLATED,15,8,lt.Z_DEFAULT_STRATEGY);if(n!==lt.Z_OK)throw new Error("Problem initializing deflate stream: "+ct()[n]);return function(n){if(void 0===n)return e();let i,s,a;t.input=n,t.next_in=0,t.avail_in=t.input.length;let r=!0;do{if(0===t.avail_out&&(t.output=new Uint8Array(dt),a=t.next_out=0,t.avail_out=dt),i=(0,at.Wt)(t,lt.Z_SYNC_FLUSH),i!==lt.Z_STREAM_END&&i!==lt.Z_OK)throw new Error("Deflate problem: "+ct()[i]);0===t.avail_out&&t.next_out>a&&(s=t.output.subarray(a,a=t.next_out),r=e(s))}while((t.avail_in>0||0===t.avail_out)&&i!==lt.Z_STREAM_END);return t.next_out>a&&(s=t.output.subarray(a,a=t.next_out),r=e(s)),r}}((e=>this.deflatedReady(e.buffer.slice(e.byteOffset,e.byteOffset+e.length))))}ut.prototype.inflate=function(e){this._inflate(new Uint8Array(e))},ut.prototype.deflate=function(e){this._deflate(new Uint8Array(e))};var ht=n(44983),ft=n.n(ht);const pt="\r\n",gt="literal",mt="literal_length_1",wt="literal_length_2",_t="default";class bt{constructor(e,t,n={}){this.timeoutEnterIdle=1e3,this.timeoutSocketLowerBound=1e4,this.timeoutSocketMultiplier=.1,this.options=n,this.port=t||(this.options.useSecureTransport?993:143),this.host=e||"localhost",this.options.useSecureTransport="useSecureTransport"in this.options?!!this.options.useSecureTransport:993===this.port,this.secureMode=!!this.options.useSecureTransport,this._connectionReady=!1,this._globalAcceptUntagged={},this._clientQueue=[],this._canSend=!1,this._tagCounter=0,this._currentCommand=!1,this._idleTimer=!1,this._socketTimeoutTimer=!1,this.compressed=!1,this._incomingBuffers=[],this._bufferState=_t,this._literalRemaining=0,this.oncert=null,this.onerror=null,this.onready=null,this.onidle=null}connect(e=nt.default){return new Promise(((t,n)=>{this.socket=e.open(this.host,this.port,{binaryType:"arraybuffer",useSecureTransport:this.secureMode,ca:this.options.ca});try{this.socket.oncert=e=>{this.oncert&&this.oncert(e)}}catch(e){}this.socket.onclose=()=>this._onError(new Error("Socket closed unexpectedly!")),this.socket.ondata=e=>{try{this._onData(e)}catch(e){this._onError(e)}},this.socket.onerror=e=>{n(new Error("Could not open socket: "+e.data.message))},this.socket.onopen=()=>{this.socket.onerror=e=>this._onError(e),t()}}))}close(e){return new Promise((t=>{var n=()=>{if(this._clientQueue.forEach((t=>t.callback(e))),this._currentCommand&&this._currentCommand.callback(e),this._clientQueue=[],this._currentCommand=!1,clearTimeout(this._idleTimer),this._idleTimer=null,clearTimeout(this._socketTimeoutTimer),this._socketTimeoutTimer=null,this.socket){this.socket.onopen=null,this.socket.onclose=null,this.socket.ondata=null,this.socket.onerror=null;try{this.socket.oncert=null}catch(e){}this.socket=null}t()};if(this._disableCompression(),!this.socket||"open"!==this.socket.readyState)return n();this.socket.onclose=this.socket.onerror=n,this.socket.close()}))}logout(){return new Promise(((e,t)=>{this.socket.onclose=this.socket.onerror=()=>{this.close("Client logging out").then(e).catch(t)},this.enqueueCommand("LOGOUT")}))}upgrade(){this.secureMode=!0,this.socket.upgradeToSecure()}enqueueCommand(e,t,n){"string"==typeof e&&(e={command:e}),t=[].concat(t||[]).map((e=>(e||"").toString().toUpperCase().trim()));var i="W"+ ++this._tagCounter;return e.tag=i,new Promise(((s,a)=>{var r={tag:i,request:e,payload:t.length?{}:void 0,callback:e=>{if(this.isError(e))return a(e);{const n=d("","command",e).toUpperCase().trim();if(["NO","BAD"].includes(n)){var t=new Error(e.humanReadable||"Error");return t.command=n,e.code&&(t.code=e.code),a(t)}}s(e)}};Object.keys(n||{}).forEach((e=>{r[e]=n[e]})),t.forEach((e=>{r.payload[e]=[]}));var o=r.ctx?this._clientQueue.indexOf(r.ctx):-1;o>=0?(r.tag+=".p",r.request.tag+=".p",this._clientQueue.splice(o,0,r)):this._clientQueue.push(r),this._canSend&&this._sendRequest()}))}getPreviouslyQueued(e,t){for(let e=this._clientQueue.indexOf(t)-1;e>=0;e--)if(n(this._clientQueue[e]))return this._clientQueue[e];return!!n(this._currentCommand)&&this._currentCommand;function n(t){return t&&t.request&&e.indexOf(t.request.command)>=0}}send(e){const t=Ye(e).buffer;this._resetSocketTimeout(t.byteLength),this.compressed?this._sendCompressed(t):this.socket.send(t)}setHandler(e,t){this._globalAcceptUntagged[e.toUpperCase().trim()]=t}_onError(e){var t;t=this.isError(e)?e:e&&this.isError(e.data)?e.data:new Error(e&&e.data&&e.data.message||e.data||e||"Error"),this.onerror||this.logger.error(t),this.close(t).then((()=>{this.onerror&&this.onerror(t)}),(()=>{this.onerror&&this.onerror(t)}))}_onData(e){this._resetSocketTimeout(),this._incomingBuffers.push(new Uint8Array(e.data)),this._parseIncomingCommands(this._iterateIncomingBuffer())}*_iterateIncomingBuffer(){let e=this._incomingBuffers[this._incomingBuffers.length-1]||[],t=0;for(;t<e.length;)switch(this._bufferState){case gt:const n=Math.min(e.length-t,this._literalRemaining);this._literalRemaining-=n,t+=n,0===this._literalRemaining&&(this._bufferState=_t);continue;case wt:t<e.length&&(13===e[t]?(this._literalRemaining=Number(Xe(this._lengthBuffer))+2,this._bufferState=gt):this._bufferState=_t,delete this._lengthBuffer);continue;case mt:const i=t;for(;t<e.length&&e[t]>=48&&e[t]<=57;)t++;if(i!==t){const n=e.subarray(i,t),s=this._lengthBuffer;this._lengthBuffer=new Uint8Array(s.length+n.length),this._lengthBuffer.set(s),this._lengthBuffer.set(n,s.length)}t<e.length&&(this._lengthBuffer.length>0&&125===e[t]?this._bufferState=wt:(delete this._lengthBuffer,this._bufferState=_t),t++);continue;default:const s=e.indexOf(123,t);if(s>-1){if(-1===new Uint8Array(e.buffer,t,s-t).indexOf(10)){t=s+1,this._lengthBuffer=new Uint8Array(0),this._bufferState=mt;continue}}const a=e.indexOf(10,t);if(!(a>-1))return;{a<e.length-1&&(this._incomingBuffers[this._incomingBuffers.length-1]=new Uint8Array(e.buffer,0,a+1));const n=this._incomingBuffers.reduce(((e,t)=>e+t.length),0)-2,i=new Uint8Array(n);let s=0;for(;this._incomingBuffers.length>0;){let e=this._incomingBuffers.shift();const t=n-s;if(e.length>t){const n=e.length-t;e=e.subarray(0,-n),this._incomingBuffers.length>0&&(this._incomingBuffers=[])}i.set(e,s),s+=e.length}if(yield i,!(a<e.length-1))return clearTimeout(this._socketTimeoutTimer),void(this._socketTimeoutTimer=null);e=new Uint8Array(e.subarray(a+1)),this._incomingBuffers.push(e),t=0}}}_parseIncomingCommands(e){for(var t of e)if(this._clearIdle(),43!==t[0]){var n;try{const e=this._currentCommand.request&&this._currentCommand.request.valueAsString;n=We(t,{valueAsString:e}),this.logger.debug("S:",(()=>Ee(n,!1,!0)))}catch(e){return this.logger.error("Error parsing imap command!",n),this._onError(e)}this._processResponse(n),this._handleResponse(n),this._connectionReady||(this._connectionReady=!0,this.onready&&this.onready())}else if(this._currentCommand.data.length){var i=this._currentCommand.data.shift();i+=this._currentCommand.data.length?"":pt,this.send(i)}else this._currentCommand.errorResponseExpectsEmptyLine&&this.send(pt)}_handleResponse(e){var t=d("","command",e).toUpperCase().trim();this._currentCommand?this._currentCommand.payload&&"*"===e.tag&&t in this._currentCommand.payload?(this._currentCommand.payload[t].push(e),this._resetSocketTimeout()):"*"===e.tag&&t in this._globalAcceptUntagged?(this._globalAcceptUntagged[t](e),this._resetSocketTimeout()):e.tag===this._currentCommand.tag&&(this._currentCommand.payload&&Object.keys(this._currentCommand.payload).length&&(e.payload=this._currentCommand.payload),this._currentCommand.callback(e),this._canSend=!0,this._sendRequest()):"*"===e.tag&&t in this._globalAcceptUntagged&&(this._globalAcceptUntagged[t](e),this._canSend=!0,this._sendRequest())}_sendRequest(){if(!this._clientQueue.length)return this._currentCommand=!1,this._enterIdle();this._clearIdle(),this._restartQueue=!1;var e=this._clientQueue[0];if("function"==typeof e.precheck){var t=e,n=t.precheck;return delete t.precheck,this._restartQueue=!0,void n(t).then((()=>{this._restartQueue&&this._sendRequest()})).catch((e=>{let n;const i=this._clientQueue.indexOf(t);i>=0&&(n=this._clientQueue.splice(i,1)[0]),n&&n.callback&&(n.callback(e),this._canSend=!0,this._parseIncomingCommands(this._iterateIncomingBuffer()),this._sendRequest())}))}this._canSend=!1,this._currentCommand=this._clientQueue.shift();try{this._currentCommand.data=Ee(this._currentCommand.request,!0),this.logger.debug("C:",(()=>Ee(this._currentCommand.request,!1,!0)))}catch(e){return this.logger.error("Error compiling imap command!",this._currentCommand.request),this._onError(new Error("Error compiling imap command!"))}var i=this._currentCommand.data.shift();return this.send(i+(this._currentCommand.data.length?"":pt)),this.waitDrain}_enterIdle(){clearTimeout(this._idleTimer),this._idleTimer=setTimeout((()=>this.onidle&&this.onidle()),this.timeoutEnterIdle)}_clearIdle(){clearTimeout(this._idleTimer),this._idleTimer=null}_processResponse(e){const t=d("","command",e).toUpperCase().trim();if(e&&e.attributes&&e.attributes.length&&("*"===e.tag&&/^\d+$/.test(e.command)&&"ATOM"===e.attributes[0].type&&(e.nr=Number(e.command),e.command=(e.attributes.shift().value||"").toString().toUpperCase().trim()),!(["OK","NO","BAD","BYE","PREAUTH"].indexOf(t)<0)&&("TEXT"===e.attributes[e.attributes.length-1].type&&(e.humanReadable=e.attributes[e.attributes.length-1].value),"ATOM"===e.attributes[0].type&&e.attributes[0].section))){const t=e.attributes[0].section.map((e=>{if(e)return Array.isArray(e)?e.map((e=>(e.value||"").toString().trim())):(e.value||"").toString().toUpperCase().trim()})),n=t.shift();e.code=n,1===t.length?e[n.toLowerCase()]=t[0]:t.length>1&&(e[n.toLowerCase()]=t)}}isError(e){return!!Object.prototype.toString.call(e).match(/Error\]$/)}enableCompression(){if(this._socketOnData=this.socket.ondata,this.compressed=!0,"undefined"!=typeof window&&window.Worker)this._compressionWorker=new Worker(URL.createObjectURL(new Blob([ft()]))),this._compressionWorker.onmessage=e=>{var t=e.data.message,n=e.data.buffer;switch(t){case"inflated_ready":this._socketOnData({data:n});break;case"deflated_ready":this.waitDrain=this.socket.send(n)}},this._compressionWorker.onerror=e=>{this._onError(new Error("Error handling compression web worker: "+e.message))},this._compressionWorker.postMessage(yt("start"));else{const e=e=>{this._socketOnData({data:e})},t=e=>{this.waitDrain=this.socket.send(e)};this._compression=new ut(e,t)}this.socket.ondata=e=>{this.compressed&&(this._compressionWorker?this._compressionWorker.postMessage(yt("inflate",e.data),[e.data]):this._compression.inflate(e.data))}}_disableCompression(){this.compressed&&(this.compressed=!1,this.socket.ondata=this._socketOnData,this._socketOnData=null,this._compressionWorker&&(this._compressionWorker.terminate(),this._compressionWorker=null))}_sendCompressed(e){this._compressionWorker?this._compressionWorker.postMessage(yt("deflate",e),[e]):this._compression.deflate(e)}_resetSocketTimeout(e){clearTimeout(this._socketTimeoutTimer);const t=this.timeoutSocketLowerBound+Math.floor((e||4096)*this.timeoutSocketMultiplier);this._socketTimeoutTimer=setTimeout((()=>this._onError(new Error(" Socket timed out!"))),t)}}const yt=(e,t)=>({message:e,buffer:t}),vt=["\\All","\\Archive","\\Drafts","\\Flagged","\\Junk","\\Sent","\\Trash"],It={"\\Sent":["aika","bidaliak","bidalita","dihantar","e rometsweng","e tindami","elküldött","elküldöttek","enviadas","enviadas","enviados","enviats","envoyés","ethunyelweyo","expediate","ezipuru","gesendete","gestuur","gönderilmiş öğeler","göndərilənlər","iberilen","inviati","išsiųstieji","kuthunyelwe","lasa","lähetetyt","messages envoyés","naipadala","nalefa","napadala","nosūtītās ziņas","odeslané","padala","poslane","poslano","poslano","poslané","poslato","saadetud","saadetud kirjad","sendt","sendt","sent","sent items","sent messages","sända poster","sänt","terkirim","ti fi ranṣẹ","të dërguara","verzonden","vilivyotumwa","wysłane","đã gửi","σταλθέντα","жиберилген","жіберілгендер","изпратени","илгээсэн","ирсол шуд","испратено","надіслані","отправленные","пасланыя","юборилган","ուղարկված","נשלחו","פריטים שנשלחו","المرسلة","بھیجے گئے","سوزمژہ","لېګل شوی","موارد ارسال شده","पाठविले","पाठविलेले","प्रेषित","भेजा गया","প্রেরিত","প্রেরিত","প্ৰেৰিত","ਭੇਜੇ","મોકલેલા","ପଠାଗଲା","அனுப்பியவை","పంపించబడింది","ಕಳುಹಿಸಲಾದ","അയച്ചു","යැවු පණිවුඩ","ส่งแล้ว","გაგზავნილი","የተላኩ","បាន​ផ្ញើ","寄件備份","寄件備份","已发信息","送信済みﾒｰﾙ","발신 메시지","보낸 편지함"],"\\Trash":["articole șterse","bin","borttagna objekt","deleted","deleted items","deleted messages","elementi eliminati","elementos borrados","elementos eliminados","gelöschte objekte","item dipadam","itens apagados","itens excluídos","mục đã xóa","odstraněné položky","pesan terhapus","poistetut","praht","prügikast","silinmiş öğeler","slettede beskeder","slettede elementer","trash","törölt elemek","usunięte wiadomości","verwijderde items","vymazané správy","éléments supprimés","видалені","жойылғандар","удаленные","פריטים שנמחקו","العناصر المحذوفة","موارد حذف شده","รายการที่ลบ","已删除邮件","已刪除項目","已刪除項目"],"\\Junk":["bulk mail","correo no deseado","courrier indésirable","istenmeyen","istenmeyen e-posta","junk","levélszemét","nevyžiadaná pošta","nevyžádaná pošta","no deseado","posta indesiderata","pourriel","roskaposti","skräppost","spam","spam","spamowanie","søppelpost","thư rác","спам","דואר זבל","الرسائل العشوائية","هرزنامه","สแปม","‎垃圾郵件","垃圾邮件","垃圾電郵"],"\\Drafts":["ba brouillon","borrador","borrador","borradores","bozze","brouillons","bản thảo","ciorne","concepten","draf","drafts","drög","entwürfe","esborranys","garalamalar","ihe edeturu","iidrafti","izinhlaka","juodraščiai","kladd","kladder","koncepty","koncepty","konsep","konsepte","kopie robocze","layihələr","luonnokset","melnraksti","meralo","mesazhe të padërguara","mga draft","mustandid","nacrti","nacrti","osnutki","piszkozatok","rascunhos","rasimu","skice","taslaklar","tsararrun saƙonni","utkast","vakiraoka","vázlatok","zirriborroak","àwọn àkọpamọ́","πρόχειρα","жобалар","нацрти","нооргууд","сиёҳнавис","хомаки хатлар","чарнавікі","чернетки","чернови","черновики","черновиктер","սևագրեր","טיוטות","مسودات","مسودات","موسودې","پیش نویسها","ڈرافٹ/","ड्राफ़्ट","प्रारूप","খসড়া","খসড়া","ড্ৰাফ্ট","ਡ੍ਰਾਫਟ","ડ્રાફ્ટસ","ଡ୍ରାଫ୍ଟ","வரைவுகள்","చిత్తు ప్రతులు","ಕರಡುಗಳು","കരടുകള്‍","කෙටුම් පත්","ฉบับร่าง","მონახაზები","ረቂቆች","សារព្រាង","下書き","草稿","草稿","草稿","임시 보관함"]},kt=Object.keys(It);function Et(e){if(e.flags)for(let t=0;t<vt.length;t++){const n=vt[t];if((e.flags||[]).indexOf(n)>=0)return e.specialUse=n,e.specialUseFlag=n,n}return function(e){const t=d("","name",e).toLowerCase().trim();for(let n=0;n<kt.length;n++){const i=kt[n];if(It[i].indexOf(t)>=0)return e.specialUse=i,i}return!1}(e)}const xt={name:"emailjs-imap-client"};const At=class{constructor(e,t,n={}){this.timeoutConnection=9e4,this.timeoutNoop=6e4,this.timeoutIdle=6e4,this.serverId=!1,this.oncert=null,this.onupdate=null,this.onselectmailbox=null,this.onclosemailbox=null,this._host=e,this._clientId=d(xt,"id",n),this._state=!1,this._authenticated=!1,this._capability=[],this._humanReadable="",this._okGreeting="",this._selectedMailbox=!1,this._enteredIdle=!1,this._idleTimeout=!1,this._enableCompression=!!n.enableCompression,this._auth=n.auth,this._requireTLS=!!n.requireTLS,this._ignoreTLS=!!n.ignoreTLS,this.client=new bt(e,t,n),this.client.onerror=this._onError.bind(this),this.client.oncert=e=>this.oncert&&this.oncert(e),this.client.onidle=()=>this._onIdle(),this.client.setHandler("capability",(e=>this._untaggedCapabilityHandler(e))),this.client.setHandler("ok",(e=>this._untaggedOkHandler(e))),this.client.setHandler("exists",(e=>this._untaggedExistsHandler(e))),this.client.setHandler("expunge",(e=>this._untaggedExpungeHandler(e))),this.client.setHandler("fetch",(e=>this._untaggedFetchHandler(e))),this.createLogger(),this.logLevel=d(0,"logLevel",n)}_onError(e){clearTimeout(this._idleTimeout),this.onerror&&this.onerror(e)}async connect(){try{await this.openConnection(),await this.upgradeConnection();try{await this.updateId(this._clientId)}catch(e){if("BAD"!==e.command)throw e;this.logger.warn("Failed to update server id!",e.message)}await this.login(this._auth),await this.compressConnection(),this.logger.debug("Connection established, ready to roll!"),this.client.onerror=this._onError.bind(this)}catch(e){throw this.logger.error("Could not connect to server",e),this.close(e),e}}openConnection(){return new Promise(((e,t)=>{const n=setTimeout((()=>t(new Error("Timeout connecting to server"))),this.timeoutConnection);this.logger.debug("Connecting to",this.client.host,":",this.client.port),this._changeState(1),this.client.connect().then((()=>{this.logger.debug("Socket opened, waiting for greeting from the server..."),this.client.onready=()=>{clearTimeout(n),this._changeState(2),this._okGreeting=this._humanReadable,this.updateCapability().then((()=>e(this._capability)))},this.client.onerror=e=>{clearTimeout(n),t(e)}})).catch(t)}))}async logout(){this._changeState(5),this.logger.debug("Logging out..."),await this.client.logout(),clearTimeout(this._idleTimeout)}async close(e){this._changeState(5),clearTimeout(this._idleTimeout),this.logger.debug("Closing connection..."),await this.client.close(e),clearTimeout(this._idleTimeout)}async updateId(e){if(this._capability.indexOf("ID")<0)return;this.logger.debug("Updating id...");const t=e?[g(Object.entries(e))]:[null],n=await this.exec({command:"ID",attributes:t},"ID"),i=g(l([],["payload","ID","0","attributes","0"],n).map(Object.values)),s=i.filter(((e,t)=>t%2==0)),a=i.filter(((e,t)=>t%2==1));this.serverId=m(w(s,a)),this.logger.debug("Server id updated!",this.serverId)}_shouldSelectMailbox(e,t){if(!t)return!0;const n=this.client.getPreviouslyQueued(["SELECT","EXAMINE"],t);if(n&&n.request.attributes){const t=n.request.attributes.find((e=>"STRING"===e.type));if(t)return t.value!==e}return this._selectedMailbox!==e}async selectMailbox(e,t={}){const n={command:t.readOnly?"EXAMINE":"SELECT",attributes:[{type:"STRING",value:e}]};t.condstore&&this._capability.indexOf("CONDSTORE")>=0&&n.attributes.push([{type:"ATOM",value:"CONDSTORE"}]),this.logger.debug("Opening",e,"...");const i=function(e){if(!e||!e.payload)return;const t={readOnly:"READ-ONLY"===e.code},n=e.payload.EXISTS&&e.payload.EXISTS.pop(),i=e.payload.FLAGS&&e.payload.FLAGS.pop(),s=e.payload.OK;return n&&(t.exists=n.nr||0),i&&i.attributes&&i.attributes.length&&(t.flags=i.attributes[0].map((e=>(e.value||"").toString().trim()))),[].concat(s||[]).forEach((e=>{switch(e&&e.code){case"PERMANENTFLAGS":t.permanentFlags=[].concat(e.permanentflags||[]);break;case"UIDVALIDITY":t.uidValidity=Number(e.uidvalidity)||0;break;case"UIDNEXT":t.uidNext=Number(e.uidnext)||0;break;case"HIGHESTMODSEQ":t.highestModseq=e.highestmodseq||"0";break;case"NOMODSEQ":t.noModseq=!0}})),t}(await this.exec(n,["EXISTS","FLAGS","OK"],{ctx:t.ctx}));return this._changeState(4),this._selectedMailbox!==e&&this.onclosemailbox&&await this.onclosemailbox(this._selectedMailbox),this._selectedMailbox=e,this.onselectmailbox&&await this.onselectmailbox(e,i),i}async subscribeMailbox(e){return this.logger.debug("Subscribing to mailbox",e,"..."),this.exec({command:"SUBSCRIBE",attributes:[e]})}async unsubscribeMailbox(e){return this.logger.debug("Unsubscribing to mailbox",e,"..."),this.exec({command:"UNSUBSCRIBE",attributes:[e]})}async listNamespaces(){if(this._capability.indexOf("NAMESPACE")<0)return!1;this.logger.debug("Listing namespaces...");return function(e){if(!e.payload||!e.payload.NAMESPACE||!e.payload.NAMESPACE.length)return!1;const t=[].concat(e.payload.NAMESPACE.pop().attributes||[]);return!!t.length&&{personal:Ue(t[0]),users:Ue(t[1]),shared:Ue(t[2])}}(await this.exec("NAMESPACE","NAMESPACE"))}async listMailboxes(){const e={root:!0,children:[]};this.logger.debug("Listing mailboxes...");const t=await this.exec({command:"LIST",attributes:["","*"]},"LIST");let n;if(l([],["payload","LIST"],t).forEach((t=>{const n=d([],"attributes",t);if(n.length<3)return;const i=l("",["2","value"],n),s=l("/",["1","value"],n),a=this._ensurePath(e,i,s);a.flags=d([],"0",n).map((({value:e})=>e||"")),a.listed=!0,Et(a)})),this._capability.indexOf("LIST-EXTENDED")>-1){const e=await this.exec({command:"LIST (SUBSCRIBED)",attributes:["","*"]},"LIST");n=l([],["payload","LIST"],e)}else{const e=await this.exec({command:"LSUB",attributes:["","*"]},"LSUB");n=l([],["payload","LSUB"],e)}return n.forEach((t=>{const n=d([],"attributes",t);if(n.length<3)return;const i=l("",["2","value"],n),s=l("/",["1","value"],n),a=this._ensurePath(e,i,s);d([],"0",n).map(((e="")=>{a.flags=ee(a.flags,[e])})),a.subscribed=!0})),e}async createMailbox(e){this.logger.debug("Creating mailbox",e,"...");try{await this.exec({command:"CREATE",attributes:[e]})}catch(e){if(e&&"ALREADYEXISTS"===e.code)return;throw e}}deleteMailbox(e){return this.logger.debug("Deleting mailbox",e,"..."),this.exec({command:"DELETE",attributes:[e]})}async listMessages(e,t,n=[{fast:!0}],i={}){this.logger.debug("Fetching messages",t,"from",e,"...");const s=function(e,t,n){const i={command:n.byUid?"UID FETCH":"FETCH",attributes:[{type:"SEQUENCE",value:e}]};void 0!==n.valueAsString&&(i.valueAsString=n.valueAsString);let s=[];return t.forEach((e=>{if(e=e.toUpperCase().trim(),/^\w+$/.test(e))s.push({type:"ATOM",value:e});else if(e)try{const t=We(Ye("* Z "+e));s=s.concat(t.attributes||[])}catch(t){s.push({type:"ATOM",value:e})}})),1===s.length&&(s=s.pop()),i.attributes.push(s),n.changedSince&&i.attributes.push([{type:"ATOM",value:"CHANGEDSINCE"},{type:"ATOM",value:n.changedSince}]),i}(t,n,i);return $e(await this.exec(s,"FETCH",{precheck:t=>this._shouldSelectMailbox(e,t)?this.selectMailbox(e,{ctx:t}):Promise.resolve()}))}async search(e,t,n={}){this.logger.debug("Searching in",e,"...");const i=function(e={},t={}){const n={command:t.byUid?"UID SEARCH":"SEARCH"};let i=!0;const s=e=>{let t=[];return Object.keys(e).forEach((n=>{let a=[];const r=e=>{return"number"==typeof e?{type:"number",value:e}:"string"==typeof e?/[\u0080-\uFFFF]/.test(e)?(i=!1,{type:"literal",value:Xe((0,Ce.cv)(e))}):{type:"string",value:e}:"[object Date]"===Object.prototype.toString.call(e)?{type:"atom",value:(t=e,t.toUTCString().replace(/^\w+, 0?(\d+) (\w+) (\d+).*/,"$1-$2-$3"))}:Array.isArray(e)?e.map(r):"object"==typeof e?s(e):void 0;var t};a.push({type:"atom",value:n.toUpperCase()}),[].concat(e[n]||[]).forEach((e=>{switch(n.toLowerCase()){case"uid":e={type:"sequence",value:e};break;case"x-gm-thrid":case"x-gm-msgid":e={type:"number",value:e};break;default:e=r(e)}e&&(a=a.concat(e||[]))})),t=t.concat(a||[])})),t};return n.attributes=s(e),i||(n.attributes.unshift({type:"atom",value:"UTF-8"}),n.attributes.unshift({type:"atom",value:"CHARSET"})),n}(t,n);return function(e){const t=[];if(!e)throw new Error("parseSEARCH can not parse undefined response");return e.payload&&e.payload.SEARCH&&e.payload.SEARCH.length?(e.payload.SEARCH.forEach((e=>(e.attributes||[]).forEach((e=>{e=Number(e&&e.value||e)||0;const n=function(e,t,n=((e,t)=>e-t)){for(var i,s,a=0,r=e.length-1;a<=r;)if((s=+n(e[i=a+(r-a>>1)],t))<0)a=i+1;else{if(!(s>0))return i;r=i-1}return~a}(t,e);n<0&&t.splice(-n-1,0,e)})))),t):t}(await this.exec(i,"SEARCH",{precheck:t=>this._shouldSelectMailbox(e,t)?this.selectMailbox(e,{ctx:t}):Promise.resolve()}))}setFlags(e,t,n,i){let s="",a=[];return Array.isArray(n)||"object"!=typeof n?(a=[].concat(n||[]),s=""):n.add?(a=[].concat(n.add||[]),s="+"):n.set?(s="",a=[].concat(n.set||[])):n.remove&&(s="-",a=[].concat(n.remove||[])),this.logger.debug("Setting flags on",t,"in",e,"..."),this.store(e,t,s+"FLAGS",a,i)}async store(e,t,n,i,s={}){const a=function(e,t="",n=[],i={}){const s={command:i.byUid?"UID STORE":"STORE",attributes:[{type:"sequence",value:e}]};return s.attributes.push({type:"atom",value:t.toUpperCase()+(i.silent?".SILENT":"")}),s.attributes.push(n.map((e=>({type:"atom",value:e})))),s}(t,n,i,s);return $e(await this.exec(a,"FETCH",{precheck:t=>this._shouldSelectMailbox(e,t)?this.selectMailbox(e,{ctx:t}):Promise.resolve()}))}async upload(e,t,n={}){const i={command:"APPEND",attributes:[{type:"atom",value:e},d(["\\Seen"],"flags",n).map((e=>({type:"atom",value:e}))),{type:"literal",value:t}]};this.logger.debug("Uploading message to",e,"...");return function(e){return e&&e.appenduid&&e.appenduid[1]}(await this.exec(i))}async deleteMessages(e,t,n={}){this.logger.debug("Deleting messages",t,"in",e,"...");const i=n.byUid&&this._capability.indexOf("UIDPLUS")>=0,s={command:"UID EXPUNGE",attributes:[{type:"sequence",value:t}]};await this.setFlags(e,t,{add:"\\Deleted"},n);const a=i?s:"EXPUNGE";return this.exec(a,null,{precheck:t=>this._shouldSelectMailbox(e,t)?this.selectMailbox(e,{ctx:t}):Promise.resolve()})}async copyMessages(e,t,n,i={}){this.logger.debug("Copying messages",t,"from",e,"to",n,"...");return function(e){const t=e&&e.copyuid;if(t)return{srcSeqSet:t[1],destSeqSet:t[2]}}(await this.exec({command:i.byUid?"UID COPY":"COPY",attributes:[{type:"sequence",value:t},{type:"atom",value:n}]},null,{precheck:t=>this._shouldSelectMailbox(e,t)?this.selectMailbox(e,{ctx:t}):Promise.resolve()}))}async moveMessages(e,t,n,i={}){return this.logger.debug("Moving messages",t,"from",e,"to",n,"..."),-1===this._capability.indexOf("MOVE")?(await this.copyMessages(e,t,n,i),this.deleteMessages(e,t,i)):this.exec({command:i.byUid?"UID MOVE":"MOVE",attributes:[{type:"sequence",value:t},{type:"atom",value:n}]},["OK"],{precheck:t=>this._shouldSelectMailbox(e,t)?this.selectMailbox(e,{ctx:t}):Promise.resolve()})}async compressConnection(){if(!this._enableCompression||this._capability.indexOf("COMPRESS=DEFLATE")<0||this.client.compressed)return!1;this.logger.debug("Enabling compression..."),await this.exec({command:"COMPRESS",attributes:[{type:"ATOM",value:"DEFLATE"}]}),this.client.enableCompression(),this.logger.debug("Compression enabled, all data sent and received is deflated!")}async login(e){let t;const n={};if(!e)throw new Error("Authentication information not provided");this._capability.indexOf("AUTH=XOAUTH2")>=0&&e&&e.xoauth2?(t={command:"AUTHENTICATE",attributes:[{type:"ATOM",value:"XOAUTH2"},{type:"ATOM",value:Je(e.user,e.xoauth2),sensitive:!0}]},n.errorResponseExpectsEmptyLine=!0):t={command:"login",attributes:[{type:"STRING",value:e.user||""},{type:"STRING",value:e.pass||"",sensitive:!0}]},this.logger.debug("Logging in...");const i=await this.exec(t,"capability",n);i.capability&&i.capability.length?this._capability=i.capability:i.payload&&i.payload.CAPABILITY&&i.payload.CAPABILITY.length?this._capability=i.payload.CAPABILITY.pop().attributes.map(((e="")=>e.value.toUpperCase().trim())):await this.updateCapability(!0),this._changeState(3),this._authenticated=!0,this.logger.debug("Login successful, post-auth capabilites updated!",this._capability)}async exec(e,t,n){this.breakIdle();const i=await this.client.enqueueCommand(e,t,n);return i&&i.capability&&(this._capability=i.capability),i}enterIdle(){if(this._enteredIdle)return;const e=this._capability.indexOf("IDLE")>=0;this._enteredIdle=e&&this._selectedMailbox?"IDLE":"NOOP",this.logger.debug("Entering idle with "+this._enteredIdle),"NOOP"===this._enteredIdle?this._idleTimeout=setTimeout((()=>{this.logger.debug("Sending NOOP"),this.exec("NOOP").catch((e=>this.logger.error("Could not idle (NOOP)",e)))}),this.timeoutNoop):"IDLE"===this._enteredIdle&&(this.client.enqueueCommand({command:"IDLE"}).catch((e=>this.logger.error("Could not idle (IDLE)",e))),this._idleTimeout=setTimeout((()=>{this.client.send("DONE\r\n"),this._enteredIdle=!1,this.logger.debug("Idle terminated")}),this.timeoutIdle))}breakIdle(){this._enteredIdle&&(clearTimeout(this._idleTimeout),"IDLE"===this._enteredIdle&&(this.client.send("DONE\r\n"),this.logger.debug("Idle terminated")),this._enteredIdle=!1)}async upgradeConnection(){return!this.client.secureMode&&(!((this._capability.indexOf("STARTTLS")<0||this._ignoreTLS)&&!this._requireTLS)&&(this.logger.debug("Encrypting connection..."),await this.exec("STARTTLS"),this._capability=[],this.client.upgrade(),this.updateCapability()))}async updateCapability(e){if((e||!this._capability.length)&&(this.client.secureMode||!this._requireTLS))return this.logger.debug("Updating capability..."),this.exec("CAPABILITY")}hasCapability(e=""){return this._capability.indexOf(e.toUpperCase().trim())>=0}getOkGreeting(){return this._okGreeting}_untaggedOkHandler(e){e&&(e.capability&&(this._capability=e.capability),this._humanReadable=e.humanReadable)}_untaggedCapabilityHandler(e){this._capability=N(d([],"attributes"),de((({value:e})=>(e||"").toUpperCase().trim())))(e)}_untaggedExistsHandler(e){e&&Object.prototype.hasOwnProperty.call(e,"nr")&&this.onupdate&&this.onupdate(this._selectedMailbox,"exists",e.nr)}_untaggedExpungeHandler(e){e&&Object.prototype.hasOwnProperty.call(e,"nr")&&this.onupdate&&this.onupdate(this._selectedMailbox,"expunge",e.nr)}_untaggedFetchHandler(e){this.onupdate&&this.onupdate(this._selectedMailbox,"fetch",[].concat($e({payload:{FETCH:[e]}})||[]).shift())}_onIdle(){this._authenticated&&!this._enteredIdle&&(this.logger.debug("Client started idling"),this.enterIdle())}_changeState(e){e!==this._state&&(this.logger.debug("Entering state: "+e),4===this._state&&this._selectedMailbox&&(this.onclosemailbox&&this.onclosemailbox(this._selectedMailbox),this._selectedMailbox=!1),this._state=e)}_ensurePath(e,t,n){const i=t.split(n);let s=e;for(let e=0;e<i.length;e++){let t=!1;for(let n=0;n<s.children.length;n++)if(this._compareMailboxNames(s.children[n].name,(0,ue.kF)(i[e]))){s=s.children[n],t=!0;break}t||(s.children.push({name:(0,ue.kF)(i[e]),delimiter:n,path:i.slice(0,e+1).join(n),children:[]}),s=s.children[s.children.length-1])}return s}_compareMailboxNames(e,t){return("INBOX"===e.toUpperCase()?"INBOX":e)===("INBOX"===t.toUpperCase()?"INBOX":t)}createLogger(e=tt){const t=e((this._auth||{}).user||"",this._host);this.logger=this.client.logger={debug:(...e)=>{10>=this.logLevel&&t.debug(e)},info:(...e)=>{20>=this.logLevel&&t.info(e)},warn:(...e)=>{30>=this.logLevel&&t.warn(e)},error:(...e)=>{40>=this.logLevel&&t.error(e)}}}}},16932:(e,t,n)=>{"use strict";const i=n(78501),s=n(58844),a=n(41192);e.exports={XMLParser:s,XMLValidator:i,XMLBuilder:a}},17849:(e,t)=>{"use strict";const n=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",i="["+n+"][:A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*",s=new RegExp("^"+i+"$");t.isExist=function(e){return void 0!==e},t.isEmptyObject=function(e){return 0===Object.keys(e).length},t.merge=function(e,t,n){if(t){const i=Object.keys(t),s=i.length;for(let a=0;a<s;a++)e[i[a]]="strict"===n?[t[i[a]]]:t[i[a]]}},t.getValue=function(e){return t.isExist(e)?e:""},t.isName=function(e){const t=s.exec(e);return!(null==t)},t.getAllMatches=function(e,t){const n=[];let i=t.exec(e);for(;i;){const s=[];s.startIndex=t.lastIndex-i[0].length;const a=i.length;for(let e=0;e<a;e++)s.push(i[e]);n.push(s),i=t.exec(e)}return n},t.nameRegexp=i},78501:(e,t,n)=>{"use strict";const i=n(17849),s={allowBooleanAttributes:!1,unpairedTags:[]};function a(e){return" "===e||"\t"===e||"\n"===e||"\r"===e}function r(e,t){const n=t;for(;t<e.length;t++)if("?"!=e[t]&&" "!=e[t]);else{const i=e.substr(n,t-n);if(t>5&&"xml"===i)return h("InvalidXml","XML declaration allowed only at the start of the document.",p(e,t));if("?"==e[t]&&">"==e[t+1]){t++;break}}return t}function o(e,t){if(e.length>t+5&&"-"===e[t+1]&&"-"===e[t+2]){for(t+=3;t<e.length;t++)if("-"===e[t]&&"-"===e[t+1]&&">"===e[t+2]){t+=2;break}}else if(e.length>t+8&&"D"===e[t+1]&&"O"===e[t+2]&&"C"===e[t+3]&&"T"===e[t+4]&&"Y"===e[t+5]&&"P"===e[t+6]&&"E"===e[t+7]){let n=1;for(t+=8;t<e.length;t++)if("<"===e[t])n++;else if(">"===e[t]&&(n--,0===n))break}else if(e.length>t+9&&"["===e[t+1]&&"C"===e[t+2]&&"D"===e[t+3]&&"A"===e[t+4]&&"T"===e[t+5]&&"A"===e[t+6]&&"["===e[t+7])for(t+=8;t<e.length;t++)if("]"===e[t]&&"]"===e[t+1]&&">"===e[t+2]){t+=2;break}return t}t.validate=function(e,t){t=Object.assign({},s,t);const n=[];let l=!1,f=!1;"\ufeff"===e[0]&&(e=e.substr(1));for(let s=0;s<e.length;s++)if("<"===e[s]&&"?"===e[s+1]){if(s+=2,s=r(e,s),s.err)return s}else{if("<"!==e[s]){if(a(e[s]))continue;return h("InvalidChar","char '"+e[s]+"' is not expected.",p(e,s))}{let m=s;if(s++,"!"===e[s]){s=o(e,s);continue}{let w=!1;"/"===e[s]&&(w=!0,s++);let _="";for(;s<e.length&&">"!==e[s]&&" "!==e[s]&&"\t"!==e[s]&&"\n"!==e[s]&&"\r"!==e[s];s++)_+=e[s];if(_=_.trim(),"/"===_[_.length-1]&&(_=_.substring(0,_.length-1),s--),g=_,!i.isName(g)){let t;return t=0===_.trim().length?"Invalid space after '<'.":"Tag '"+_+"' is an invalid name.",h("InvalidTag",t,p(e,s))}const b=c(e,s);if(!1===b)return h("InvalidAttr","Attributes for '"+_+"' have open quote.",p(e,s));let y=b.value;if(s=b.index,"/"===y[y.length-1]){const n=s-y.length;y=y.substring(0,y.length-1);const i=d(y,t);if(!0!==i)return h(i.err.code,i.err.msg,p(e,n+i.err.line));l=!0}else if(w){if(!b.tagClosed)return h("InvalidTag","Closing tag '"+_+"' doesn't have proper closing.",p(e,s));if(y.trim().length>0)return h("InvalidTag","Closing tag '"+_+"' can't have attributes or invalid starting.",p(e,m));{const t=n.pop();if(_!==t.tagName){let n=p(e,t.tagStartPos);return h("InvalidTag","Expected closing tag '"+t.tagName+"' (opened in line "+n.line+", col "+n.col+") instead of closing tag '"+_+"'.",p(e,m))}0==n.length&&(f=!0)}}else{const i=d(y,t);if(!0!==i)return h(i.err.code,i.err.msg,p(e,s-y.length+i.err.line));if(!0===f)return h("InvalidXml","Multiple possible root nodes found.",p(e,s));-1!==t.unpairedTags.indexOf(_)||n.push({tagName:_,tagStartPos:m}),l=!0}for(s++;s<e.length;s++)if("<"===e[s]){if("!"===e[s+1]){s++,s=o(e,s);continue}if("?"!==e[s+1])break;if(s=r(e,++s),s.err)return s}else if("&"===e[s]){const t=u(e,s);if(-1==t)return h("InvalidChar","char '&' is not expected.",p(e,s));s=t}else if(!0===f&&!a(e[s]))return h("InvalidXml","Extra text at the end",p(e,s));"<"===e[s]&&s--}}}var g;return l?1==n.length?h("InvalidTag","Unclosed tag '"+n[0].tagName+"'.",p(e,n[0].tagStartPos)):!(n.length>0)||h("InvalidXml","Invalid '"+JSON.stringify(n.map((e=>e.tagName)),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1}):h("InvalidXml","Start tag expected.",1)};function c(e,t){let n="",i="",s=!1;for(;t<e.length;t++){if('"'===e[t]||"'"===e[t])""===i?i=e[t]:i!==e[t]||(i="");else if(">"===e[t]&&""===i){s=!0;break}n+=e[t]}return""===i&&{value:n,index:t,tagClosed:s}}const l=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function d(e,t){const n=i.getAllMatches(e,l),s={};for(let e=0;e<n.length;e++){if(0===n[e][1].length)return h("InvalidAttr","Attribute '"+n[e][2]+"' has no space in starting.",g(n[e]));if(void 0!==n[e][3]&&void 0===n[e][4])return h("InvalidAttr","Attribute '"+n[e][2]+"' is without value.",g(n[e]));if(void 0===n[e][3]&&!t.allowBooleanAttributes)return h("InvalidAttr","boolean attribute '"+n[e][2]+"' is not allowed.",g(n[e]));const i=n[e][2];if(!f(i))return h("InvalidAttr","Attribute '"+i+"' is an invalid name.",g(n[e]));if(s.hasOwnProperty(i))return h("InvalidAttr","Attribute '"+i+"' is repeated.",g(n[e]));s[i]=1}return!0}function u(e,t){if(";"===e[++t])return-1;if("#"===e[t])return function(e,t){let n=/\d/;for("x"===e[t]&&(t++,n=/[\da-fA-F]/);t<e.length;t++){if(";"===e[t])return t;if(!e[t].match(n))break}return-1}(e,++t);let n=0;for(;t<e.length;t++,n++)if(!(e[t].match(/\w/)&&n<20)){if(";"===e[t])break;return-1}return t}function h(e,t,n){return{err:{code:e,msg:t,line:n.line||n,col:n.col}}}function f(e){return i.isName(e)}function p(e,t){const n=e.substring(0,t).split(/\r?\n/);return{line:n.length,col:n[n.length-1].length+1}}function g(e){return e.startIndex+e[1].length}},41192:(e,t,n)=>{"use strict";const i=n(82592),s={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function a(e){this.options=Object.assign({},s,e),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=c),this.processTextOrObjNode=r,this.options.format?(this.indentate=o,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}function r(e,t,n){const i=this.j2x(e,n+1);return void 0!==e[this.options.textNodeName]&&1===Object.keys(e).length?this.buildTextValNode(e[this.options.textNodeName],t,i.attrStr,n):this.buildObjectNode(i.val,t,i.attrStr,n)}function o(e){return this.options.indentBy.repeat(e)}function c(e){return!(!e.startsWith(this.options.attributeNamePrefix)||e===this.options.textNodeName)&&e.substr(this.attrPrefixLen)}a.prototype.build=function(e){return this.options.preserveOrder?i(e,this.options):(Array.isArray(e)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(e={[this.options.arrayNodeName]:e}),this.j2x(e,0).val)},a.prototype.j2x=function(e,t){let n="",i="";for(let s in e)if(Object.prototype.hasOwnProperty.call(e,s))if(void 0===e[s])this.isAttribute(s)&&(i+="");else if(null===e[s])this.isAttribute(s)?i+="":"?"===s[0]?i+=this.indentate(t)+"<"+s+"?"+this.tagEndChar:i+=this.indentate(t)+"<"+s+"/"+this.tagEndChar;else if(e[s]instanceof Date)i+=this.buildTextValNode(e[s],s,"",t);else if("object"!=typeof e[s]){const a=this.isAttribute(s);if(a)n+=this.buildAttrPairStr(a,""+e[s]);else if(s===this.options.textNodeName){let t=this.options.tagValueProcessor(s,""+e[s]);i+=this.replaceEntitiesValue(t)}else i+=this.buildTextValNode(e[s],s,"",t)}else if(Array.isArray(e[s])){const n=e[s].length;let a="";for(let r=0;r<n;r++){const n=e[s][r];void 0===n||(null===n?"?"===s[0]?i+=this.indentate(t)+"<"+s+"?"+this.tagEndChar:i+=this.indentate(t)+"<"+s+"/"+this.tagEndChar:"object"==typeof n?this.options.oneListGroup?a+=this.j2x(n,t+1).val:a+=this.processTextOrObjNode(n,s,t):a+=this.buildTextValNode(n,s,"",t))}this.options.oneListGroup&&(a=this.buildObjectNode(a,s,"",t)),i+=a}else if(this.options.attributesGroupName&&s===this.options.attributesGroupName){const t=Object.keys(e[s]),i=t.length;for(let a=0;a<i;a++)n+=this.buildAttrPairStr(t[a],""+e[s][t[a]])}else i+=this.processTextOrObjNode(e[s],s,t);return{attrStr:n,val:i}},a.prototype.buildAttrPairStr=function(e,t){return t=this.options.attributeValueProcessor(e,""+t),t=this.replaceEntitiesValue(t),this.options.suppressBooleanAttributes&&"true"===t?" "+e:" "+e+'="'+t+'"'},a.prototype.buildObjectNode=function(e,t,n,i){if(""===e)return"?"===t[0]?this.indentate(i)+"<"+t+n+"?"+this.tagEndChar:this.indentate(i)+"<"+t+n+this.closeTag(t)+this.tagEndChar;{let s="</"+t+this.tagEndChar,a="";return"?"===t[0]&&(a="?",s=""),!n&&""!==n||-1!==e.indexOf("<")?!1!==this.options.commentPropName&&t===this.options.commentPropName&&0===a.length?this.indentate(i)+`\x3c!--${e}--\x3e`+this.newLine:this.indentate(i)+"<"+t+n+a+this.tagEndChar+e+this.indentate(i)+s:this.indentate(i)+"<"+t+n+a+">"+e+s}},a.prototype.closeTag=function(e){let t="";return-1!==this.options.unpairedTags.indexOf(e)?this.options.suppressUnpairedNode||(t="/"):t=this.options.suppressEmptyNode?"/":`></${e}`,t},a.prototype.buildTextValNode=function(e,t,n,i){if(!1!==this.options.cdataPropName&&t===this.options.cdataPropName)return this.indentate(i)+`<![CDATA[${e}]]>`+this.newLine;if(!1!==this.options.commentPropName&&t===this.options.commentPropName)return this.indentate(i)+`\x3c!--${e}--\x3e`+this.newLine;if("?"===t[0])return this.indentate(i)+"<"+t+n+"?"+this.tagEndChar;{let s=this.options.tagValueProcessor(t,e);return s=this.replaceEntitiesValue(s),""===s?this.indentate(i)+"<"+t+n+this.closeTag(t)+this.tagEndChar:this.indentate(i)+"<"+t+n+">"+s+"</"+t+this.tagEndChar}},a.prototype.replaceEntitiesValue=function(e){if(e&&e.length>0&&this.options.processEntities)for(let t=0;t<this.options.entities.length;t++){const n=this.options.entities[t];e=e.replace(n.regex,n.val)}return e},e.exports=a},82592:e=>{function t(e,r,o,c){let l="",d=!1;for(let u=0;u<e.length;u++){const h=e[u],f=n(h);if(void 0===f)continue;let p="";if(p=0===o.length?f:`${o}.${f}`,f===r.textNodeName){let e=h[f];s(p,r)||(e=r.tagValueProcessor(f,e),e=a(e,r)),d&&(l+=c),l+=e,d=!1;continue}if(f===r.cdataPropName){d&&(l+=c),l+=`<![CDATA[${h[f][0][r.textNodeName]}]]>`,d=!1;continue}if(f===r.commentPropName){l+=c+`\x3c!--${h[f][0][r.textNodeName]}--\x3e`,d=!0;continue}if("?"===f[0]){const e=i(h[":@"],r),t="?xml"===f?"":c;let n=h[f][0][r.textNodeName];n=0!==n.length?" "+n:"",l+=t+`<${f}${n}${e}?>`,d=!0;continue}let g=c;""!==g&&(g+=r.indentBy);const m=c+`<${f}${i(h[":@"],r)}`,w=t(h[f],r,p,g);-1!==r.unpairedTags.indexOf(f)?r.suppressUnpairedNode?l+=m+">":l+=m+"/>":w&&0!==w.length||!r.suppressEmptyNode?w&&w.endsWith(">")?l+=m+`>${w}${c}</${f}>`:(l+=m+">",w&&""!==c&&(w.includes("/>")||w.includes("</"))?l+=c+r.indentBy+w+c:l+=w,l+=`</${f}>`):l+=m+"/>",d=!0}return l}function n(e){const t=Object.keys(e);for(let n=0;n<t.length;n++){const i=t[n];if(e.hasOwnProperty(i)&&":@"!==i)return i}}function i(e,t){let n="";if(e&&!t.ignoreAttributes)for(let i in e){if(!e.hasOwnProperty(i))continue;let s=t.attributeValueProcessor(i,e[i]);s=a(s,t),!0===s&&t.suppressBooleanAttributes?n+=` ${i.substr(t.attributeNamePrefix.length)}`:n+=` ${i.substr(t.attributeNamePrefix.length)}="${s}"`}return n}function s(e,t){let n=(e=e.substr(0,e.length-t.textNodeName.length-1)).substr(e.lastIndexOf(".")+1);for(let i in t.stopNodes)if(t.stopNodes[i]===e||t.stopNodes[i]==="*."+n)return!0;return!1}function a(e,t){if(e&&e.length>0&&t.processEntities)for(let n=0;n<t.entities.length;n++){const i=t.entities[n];e=e.replace(i.regex,i.val)}return e}e.exports=function(e,n){let i="";return n.format&&n.indentBy.length>0&&(i="\n"),t(e,n,"",i)}},74780:(e,t,n)=>{const i=n(17849);function s(e,t){let n="";for(;t<e.length&&"'"!==e[t]&&'"'!==e[t];t++)n+=e[t];if(n=n.trim(),-1!==n.indexOf(" "))throw new Error("External entites are not supported");const i=e[t++];let s="";for(;t<e.length&&e[t]!==i;t++)s+=e[t];return[n,s,t]}function a(e,t){return"!"===e[t+1]&&"-"===e[t+2]&&"-"===e[t+3]}function r(e,t){return"!"===e[t+1]&&"E"===e[t+2]&&"N"===e[t+3]&&"T"===e[t+4]&&"I"===e[t+5]&&"T"===e[t+6]&&"Y"===e[t+7]}function o(e,t){return"!"===e[t+1]&&"E"===e[t+2]&&"L"===e[t+3]&&"E"===e[t+4]&&"M"===e[t+5]&&"E"===e[t+6]&&"N"===e[t+7]&&"T"===e[t+8]}function c(e,t){return"!"===e[t+1]&&"A"===e[t+2]&&"T"===e[t+3]&&"T"===e[t+4]&&"L"===e[t+5]&&"I"===e[t+6]&&"S"===e[t+7]&&"T"===e[t+8]}function l(e,t){return"!"===e[t+1]&&"N"===e[t+2]&&"O"===e[t+3]&&"T"===e[t+4]&&"A"===e[t+5]&&"T"===e[t+6]&&"I"===e[t+7]&&"O"===e[t+8]&&"N"===e[t+9]}function d(e){if(i.isName(e))return e;throw new Error(`Invalid entity name ${e}`)}e.exports=function(e,t){const n={};if("O"!==e[t+3]||"C"!==e[t+4]||"T"!==e[t+5]||"Y"!==e[t+6]||"P"!==e[t+7]||"E"!==e[t+8])throw new Error("Invalid Tag instead of DOCTYPE");{t+=9;let i=1,u=!1,h=!1,f="";for(;t<e.length;t++)if("<"!==e[t]||h)if(">"===e[t]){if(h?"-"===e[t-1]&&"-"===e[t-2]&&(h=!1,i--):i--,0===i)break}else"["===e[t]?u=!0:f+=e[t];else{if(u&&r(e,t))t+=7,[entityName,val,t]=s(e,t+1),-1===val.indexOf("&")&&(n[d(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(u&&o(e,t))t+=8;else if(u&&c(e,t))t+=8;else if(u&&l(e,t))t+=9;else{if(!a)throw new Error("Invalid DOCTYPE");h=!0}i++,f=""}if(0!==i)throw new Error("Unclosed DOCTYPE")}return{entities:n,i:t}}},66745:(e,t)=>{const n={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(e,t,n){return e}};t.buildOptions=function(e){return Object.assign({},n,e)},t.defaultOptions=n},81078:(e,t,n)=>{"use strict";const i=n(17849),s=n(36311),a=n(74780),r=n(14153);function o(e){const t=Object.keys(e);for(let n=0;n<t.length;n++){const i=t[n];this.lastEntities[i]={regex:new RegExp("&"+i+";","g"),val:e[i]}}}function c(e,t,n,i,s,a,r){if(void 0!==e&&(this.options.trimValues&&!i&&(e=e.trim()),e.length>0)){r||(e=this.replaceEntitiesValue(e));const i=this.options.tagValueProcessor(t,e,n,s,a);if(null==i)return e;if(typeof i!=typeof e||i!==e)return i;if(this.options.trimValues)return y(e,this.options.parseTagValue,this.options.numberParseOptions);return e.trim()===e?y(e,this.options.parseTagValue,this.options.numberParseOptions):e}}function l(e){if(this.options.removeNSPrefix){const t=e.split(":"),n="/"===e.charAt(0)?"/":"";if("xmlns"===t[0])return"";2===t.length&&(e=n+t[1])}return e}const d=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");function u(e,t,n){if(!this.options.ignoreAttributes&&"string"==typeof e){const n=i.getAllMatches(e,d),s=n.length,a={};for(let e=0;e<s;e++){const i=this.resolveNameSpace(n[e][1]);let s=n[e][4],r=this.options.attributeNamePrefix+i;if(i.length)if(this.options.transformAttributeName&&(r=this.options.transformAttributeName(r)),"__proto__"===r&&(r="#__proto__"),void 0!==s){this.options.trimValues&&(s=s.trim()),s=this.replaceEntitiesValue(s);const e=this.options.attributeValueProcessor(i,s,t);a[r]=null==e?s:typeof e!=typeof s||e!==s?e:y(s,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(a[r]=!0)}if(!Object.keys(a).length)return;if(this.options.attributesGroupName){const e={};return e[this.options.attributesGroupName]=a,e}return a}}const h=function(e){e=e.replace(/\r\n?/g,"\n");const t=new s("!xml");let n=t,i="",r="";for(let o=0;o<e.length;o++){if("<"===e[o])if("/"===e[o+1]){const t=w(e,">",o,"Closing Tag is not closed.");let s=e.substring(o+2,t).trim();if(this.options.removeNSPrefix){const e=s.indexOf(":");-1!==e&&(s=s.substr(e+1))}this.options.transformTagName&&(s=this.options.transformTagName(s)),n&&(i=this.saveTextToParentTag(i,n,r));const a=r.substring(r.lastIndexOf(".")+1);if(s&&-1!==this.options.unpairedTags.indexOf(s))throw new Error(`Unpaired tag can not be used as closing tag: </${s}>`);let c=0;a&&-1!==this.options.unpairedTags.indexOf(a)?(c=r.lastIndexOf(".",r.lastIndexOf(".")-1),this.tagsNodeStack.pop()):c=r.lastIndexOf("."),r=r.substring(0,c),n=this.tagsNodeStack.pop(),i="",o=t}else if("?"===e[o+1]){let t=_(e,o,!1,"?>");if(!t)throw new Error("Pi Tag is not closed.");if(i=this.saveTextToParentTag(i,n,r),this.options.ignoreDeclaration&&"?xml"===t.tagName||this.options.ignorePiTags);else{const e=new s(t.tagName);e.add(this.options.textNodeName,""),t.tagName!==t.tagExp&&t.attrExpPresent&&(e[":@"]=this.buildAttributesMap(t.tagExp,r,t.tagName)),this.addChild(n,e,r)}o=t.closeIndex+1}else if("!--"===e.substr(o+1,3)){const t=w(e,"--\x3e",o+4,"Comment is not closed.");if(this.options.commentPropName){const s=e.substring(o+4,t-2);i=this.saveTextToParentTag(i,n,r),n.add(this.options.commentPropName,[{[this.options.textNodeName]:s}])}o=t}else if("!D"===e.substr(o+1,2)){const t=a(e,o);this.docTypeEntities=t.entities,o=t.i}else if("!["===e.substr(o+1,2)){const t=w(e,"]]>",o,"CDATA is not closed.")-2,s=e.substring(o+9,t);i=this.saveTextToParentTag(i,n,r);let a=this.parseTextData(s,n.tagname,r,!0,!1,!0,!0);null==a&&(a=""),this.options.cdataPropName?n.add(this.options.cdataPropName,[{[this.options.textNodeName]:s}]):n.add(this.options.textNodeName,a),o=t+2}else{let a=_(e,o,this.options.removeNSPrefix),c=a.tagName;const l=a.rawTagName;let d=a.tagExp,u=a.attrExpPresent,h=a.closeIndex;this.options.transformTagName&&(c=this.options.transformTagName(c)),n&&i&&"!xml"!==n.tagname&&(i=this.saveTextToParentTag(i,n,r,!1));const f=n;if(f&&-1!==this.options.unpairedTags.indexOf(f.tagname)&&(n=this.tagsNodeStack.pop(),r=r.substring(0,r.lastIndexOf("."))),c!==t.tagname&&(r+=r?"."+c:c),this.isItStopNode(this.options.stopNodes,r,c)){let t="";if(d.length>0&&d.lastIndexOf("/")===d.length-1)o=a.closeIndex;else if(-1!==this.options.unpairedTags.indexOf(c))o=a.closeIndex;else{const n=this.readStopNodeData(e,l,h+1);if(!n)throw new Error(`Unexpected end of ${l}`);o=n.i,t=n.tagContent}const i=new s(c);c!==d&&u&&(i[":@"]=this.buildAttributesMap(d,r,c)),t&&(t=this.parseTextData(t,c,r,!0,u,!0,!0)),r=r.substr(0,r.lastIndexOf(".")),i.add(this.options.textNodeName,t),this.addChild(n,i,r)}else{if(d.length>0&&d.lastIndexOf("/")===d.length-1){"/"===c[c.length-1]?(c=c.substr(0,c.length-1),r=r.substr(0,r.length-1),d=c):d=d.substr(0,d.length-1),this.options.transformTagName&&(c=this.options.transformTagName(c));const e=new s(c);c!==d&&u&&(e[":@"]=this.buildAttributesMap(d,r,c)),this.addChild(n,e,r),r=r.substr(0,r.lastIndexOf("."))}else{const e=new s(c);this.tagsNodeStack.push(n),c!==d&&u&&(e[":@"]=this.buildAttributesMap(d,r,c)),this.addChild(n,e,r),n=e}i="",o=h}}else i+=e[o]}return t.child};function f(e,t,n){const i=this.options.updateTag(t.tagname,n,t[":@"]);!1===i||("string"==typeof i?(t.tagname=i,e.addChild(t)):e.addChild(t))}const p=function(e){if(this.options.processEntities){for(let t in this.docTypeEntities){const n=this.docTypeEntities[t];e=e.replace(n.regx,n.val)}for(let t in this.lastEntities){const n=this.lastEntities[t];e=e.replace(n.regex,n.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){const n=this.htmlEntities[t];e=e.replace(n.regex,n.val)}e=e.replace(this.ampEntity.regex,this.ampEntity.val)}return e};function g(e,t,n,i){return e&&(void 0===i&&(i=0===Object.keys(t.child).length),void 0!==(e=this.parseTextData(e,t.tagname,n,!1,!!t[":@"]&&0!==Object.keys(t[":@"]).length,i))&&""!==e&&t.add(this.options.textNodeName,e),e=""),e}function m(e,t,n){const i="*."+n;for(const n in e){const s=e[n];if(i===s||t===s)return!0}return!1}function w(e,t,n,i){const s=e.indexOf(t,n);if(-1===s)throw new Error(i);return s+t.length-1}function _(e,t,n,i=">"){const s=function(e,t,n=">"){let i,s="";for(let a=t;a<e.length;a++){let t=e[a];if(i)t===i&&(i="");else if('"'===t||"'"===t)i=t;else if(t===n[0]){if(!n[1])return{data:s,index:a};if(e[a+1]===n[1])return{data:s,index:a}}else"\t"===t&&(t=" ");s+=t}}(e,t+1,i);if(!s)return;let a=s.data;const r=s.index,o=a.search(/\s/);let c=a,l=!0;-1!==o&&(c=a.substring(0,o),a=a.substring(o+1).trimStart());const d=c;if(n){const e=c.indexOf(":");-1!==e&&(c=c.substr(e+1),l=c!==s.data.substr(e+1))}return{tagName:c,tagExp:a,closeIndex:r,attrExpPresent:l,rawTagName:d}}function b(e,t,n){const i=n;let s=1;for(;n<e.length;n++)if("<"===e[n])if("/"===e[n+1]){const a=w(e,">",n,`${t} is not closed`);if(e.substring(n+2,a).trim()===t&&(s--,0===s))return{tagContent:e.substring(i,n),i:a};n=a}else if("?"===e[n+1]){n=w(e,"?>",n+1,"StopNode is not closed.")}else if("!--"===e.substr(n+1,3)){n=w(e,"--\x3e",n+3,"StopNode is not closed.")}else if("!["===e.substr(n+1,2)){n=w(e,"]]>",n,"StopNode is not closed.")-2}else{const i=_(e,n,">");if(i){(i&&i.tagName)===t&&"/"!==i.tagExp[i.tagExp.length-1]&&s++,n=i.closeIndex}}}function y(e,t,n){if(t&&"string"==typeof e){const t=e.trim();return"true"===t||"false"!==t&&r(e,n)}return i.isExist(e)?e:""}e.exports=class{constructor(e){this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"}},this.addExternalEntities=o,this.parseXml=h,this.parseTextData=c,this.resolveNameSpace=l,this.buildAttributesMap=u,this.isItStopNode=m,this.replaceEntitiesValue=p,this.readStopNodeData=b,this.saveTextToParentTag=g,this.addChild=f}}},58844:(e,t,n)=>{const{buildOptions:i}=n(66745),s=n(81078),{prettify:a}=n(16997),r=n(78501);e.exports=class{constructor(e){this.externalEntities={},this.options=i(e)}parse(e,t){if("string"==typeof e);else{if(!e.toString)throw new Error("XML data is accepted in String or Bytes[] form.");e=e.toString()}if(t){!0===t&&(t={});const n=r.validate(e,t);if(!0!==n)throw Error(`${n.err.msg}:${n.err.line}:${n.err.col}`)}const n=new s(this.options);n.addExternalEntities(this.externalEntities);const i=n.parseXml(e);return this.options.preserveOrder||void 0===i?i:a(i,this.options)}addEntity(e,t){if(-1!==t.indexOf("&"))throw new Error("Entity value can't have '&'");if(-1!==e.indexOf("&")||-1!==e.indexOf(";"))throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if("&"===t)throw new Error("An entity with value '&' is not permitted");this.externalEntities[e]=t}}},16997:(e,t)=>{"use strict";function n(e,t,r){let o;const c={};for(let l=0;l<e.length;l++){const d=e[l],u=i(d);let h="";if(h=void 0===r?u:r+"."+u,u===t.textNodeName)void 0===o?o=d[u]:o+=""+d[u];else{if(void 0===u)continue;if(d[u]){let e=n(d[u],t,h);const i=a(e,t);d[":@"]?s(e,d[":@"],h,t):1!==Object.keys(e).length||void 0===e[t.textNodeName]||t.alwaysCreateTextNode?0===Object.keys(e).length&&(t.alwaysCreateTextNode?e[t.textNodeName]="":e=""):e=e[t.textNodeName],void 0!==c[u]&&c.hasOwnProperty(u)?(Array.isArray(c[u])||(c[u]=[c[u]]),c[u].push(e)):t.isArray(u,h,i)?c[u]=[e]:c[u]=e}}}return"string"==typeof o?o.length>0&&(c[t.textNodeName]=o):void 0!==o&&(c[t.textNodeName]=o),c}function i(e){const t=Object.keys(e);for(let e=0;e<t.length;e++){const n=t[e];if(":@"!==n)return n}}function s(e,t,n,i){if(t){const s=Object.keys(t),a=s.length;for(let r=0;r<a;r++){const a=s[r];i.isArray(a,n+"."+a,!0,!0)?e[a]=[t[a]]:e[a]=t[a]}}}function a(e,t){const{textNodeName:n}=t,i=Object.keys(e).length;return 0===i||!(1!==i||!e[n]&&"boolean"!=typeof e[n]&&0!==e[n])}t.prettify=function(e,t){return n(e,t)}},36311:e=>{"use strict";e.exports=class{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){"__proto__"===e&&(e="#__proto__"),this.child.push({[e]:t})}addChild(e){"__proto__"===e.tagname&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}}},72315:(e,t,n)=>{!function(t){"use strict";e.exports=t(n(9673).ZP,n(84846).Z)}((function(e,t){"use strict";let n;const i={debug:()=>{},info:()=>{},error:()=>{}};var s=function(t,s){var a=this;if(n=t.logger||i,a._loggedIn=!1,a._loggingIn=!1,a._shouldLogOut=!1,s)a._client=s;else{var r={useSecureTransport:t.secure,ignoreTLS:t.ignoreTLS,requireTLS:t.requireTLS,auth:t.auth,ca:t.ca,tlsWorkerPath:t.tlsWorkerPath,enableCompression:!0,compressionWorkerPath:t.compressionWorkerPath,id:t.id};a._client=new e(t.host,t.port,r)}a._client.oncert=function(e){a.onCert(e)},a.mailboxCache={},a._registerEventHandlers(a._client)};function a(e){return e.childNodes?e.childNodes.some((e=>a(e))):/^text\/html/i.test(e.type)}function r(e,t,n){if(e.size&&(t.size+=e.size),e.childNodes)e.childNodes.forEach((function(e){r(e,t,n)}));else{n&&e.id&&e.disposition?.startsWith("inline")||!e.disposition?.startsWith("attachment")&&/^text\/(plain|html)/i.test(e.type)||(t.attachment+=1)}}function o(e,t){return e-t}return s.prototype._registerEventHandlers=function(e){e.onselectmailbox=this._onSelectMailbox.bind(this,e),e.onupdate=this._onUpdate.bind(this,e),e.onerror=this._onError.bind(this,e)},s.prototype._onError=function(e,t){var i="IMAP connection encountered an error! "+t;e===this._client&&(this._loggedIn=!1,n.error((()=>[new Error(i)])),this.onError(new Error(i)))},s.prototype._onSelectMailbox=function(e,t,i){var s,a=this;if(a.onSyncUpdate){if(n.debug((()=>["selected mailbox "+t])),a.mailboxCache[t]||(n.debug((()=>["populating cache object for mailbox "+t])),a.mailboxCache[t]={exists:0,uidNext:0,uidlist:[],highestModseq:"0"}),(s=a.mailboxCache[t]).noModseq=i.noModseq||!1,s.exists!==i.exists||s.uidNext!==i.uidNext){n.debug((()=>["possible updates available in "+t+". exists: "+i.exists+", uidNext: "+i.uidNext]));var r=0===s.exists;return s.exists=i.exists,s.uidNext=i.uidNext,a.search({path:t,client:e}).then((function(c){s.uidlist=s.uidlist||[];var l=0;for(var d of c){if(d<l){n.debug((()=>["imapUidList not sorted"])),c.sort(o);break}l=d}var u=function(e,t){var n=0,i=0,s=[],a=[];for(;n<e.length&&i<t.length;)e[n]<t[i]?(s.push(e[n]),n++):e[n]>t[i]?(a.push(t[i]),i++):(n++,i++);n===e.length?a=a.concat(t.slice(i)):i===t.length&&(s=s.concat(e.slice(n)));return[s,a]}(s.uidlist,c),h=u[0],f=u[1];return s.uidlist=c,Promise.resolve().then((function(){if(h.length)return n.debug((()=>["onSyncUpdate for deleted uids in "+t+": "+h])),a.onSyncUpdate({type:"deleted",path:t,list:h})})).then((function(){if(f.length)return n.debug((()=>["onSyncUpdate for new uids in "+t+": "+f])),a.onSyncUpdate({type:"new",path:t,list:f})})).then((function(){if(!r)return n.debug((()=>["no changes in message count in "+t+". exists: "+i.exists+", uidNext: "+i.uidNext])),a._checkFlags({path:t,highestModseq:i.highestModseq,noModseq:i.noModseq,client:e}).catch((function(e){n.error((()=>["error checking modseq: "+e+"\n"+e.stack]))}))}))}))}return n.debug((()=>["no changes in message count in "+t+". exists: "+i.exists+", uidNext: "+i.uidNext])),a._checkFlags({path:t,highestModseq:i.highestModseq,noModseq:i.noModseq,client:e}).catch((function(e){n.error((()=>["error checking modseq: "+e+"\n"+e.stack]))}))}},s.prototype._onUpdate=function(e,t,i,s){var a=this,r=a.mailboxCache[t];if(a.onSyncUpdate&&r)if("expunge"===i){n.debug((()=>["expunge notice received for "+t+" with sequence number: "+s]));var c=r.uidlist[s-1];r.uidlist.splice(s-1,1),c&&(n.debug((()=>["deleted uid in "+t+": "+c])),a.onSyncUpdate({type:"deleted",path:t,list:[c]}))}else"exists"===i?(n.debug((()=>["exists notice received for "+t+", checking for updates"])),r.exists=s,a.search({path:t,uid:r.uidNext+":*",client:e}).then((function(e){!e.length||1===e.length&&r.uidlist.indexOf(e[0])>=0||(e.sort(o),n.debug((()=>["new uids in "+t+": "+e])),r.uidlist=r.uidlist.concat(e),r.uidNext=r.uidlist[r.uidlist.length-1]+1,n.debug((()=>["new uids in "+t+": "+e])),a.onSyncUpdate({type:"new",path:t,list:e}))})).catch((function(e){n.error((()=>["error handling exists notice: "+e+"\n"+e.stack]))}))):"fetch"===i&&(n.debug((()=>["fetch notice received for "+t])),a.onSyncUpdate({type:"messages",path:t,list:[s].map((function(e){return!e.uid&&r.uidlist&&(e.uid=r.uidlist[e["#"]-1]),e}))}))},s.prototype._checkFlags=function(e){var t=this,i=e.highestModseq,s=e.noModseq,a=e.client||t._client,r=e.path;if(s)return n.info((()=>["can not check MODSEQ, mailbox has NOMODSEQ directive"])),new Promise((function(e){e([])}));if(!a.hasCapability("CONDSTORE")||!i||!r)return n.info((()=>["can not check MODSEQ, server does not support CONDSTORE extension"])),new Promise((function(e){e([])}));var o=t.mailboxCache[r];if(!o||!o.highestModseq||o.highestModseq===i)return new Promise((function(e){e([])}));var c=o.uidNext>1?o.uidNext-1:1;return n.debug((()=>["listing changes since MODSEQ "+i+" for "+r])),a.listMessages(r,"1:"+c,["uid","flags","modseq"],{byUid:!0,changedSince:o.highestModseq}).then((function(e){return o.highestModseq=i,e&&e.length?(n.debug((()=>["changes since MODSEQ "+i+" for "+r+" available!"])),t.onSyncUpdate({type:"messages",path:r,list:e})):[]})).catch((function(e){n.error((()=>["error handling exists notice: "+e+"\n"+e.stack]))}))},s.prototype.onSyncUpdate=!1,s.prototype.login=function(){var e=this;return e._loggedIn||e._loggingIn?(n.debug((()=>["refusing login while logged/logging in!"])),Promise.resolve()):(e._loggingIn=!0,e._client.connect().then((function(){if(n.debug((()=>["login completed, ready to roll!"])),e._loggedIn=!0,e._shouldLogOut)return e.logout()})).finally((function(){e._loggingIn=!1})))},s.prototype.logout=function(){var e=this;return e._loggingIn?(n.debug((()=>["currently logging in, will log right back out!"])),e._shouldLogOut=!0,Promise.resolve()):e._loggedIn?(e._loggedIn=!1,e._shouldLogOut=!1,e._client.close().then((function(){n.debug((()=>["logout completed, kthxbye!"]))}))):(n.debug((()=>["refusing logout while already logged out!"])),Promise.resolve())},s.prototype.selectMailbox=function(e){return n.debug((()=>["selecting mailbox "+e.path])),this._client.selectMailbox(e.path)},s.prototype.subscribeMailbox=function(e){return n.debug((()=>["subscribing to mailbox "+e.path])),this._client.subscribeMailbox(e.path)},s.prototype.unsubscribeMailbox=function(e){return n.debug((()=>["unsubscribing to mailbox "+e.path])),this._client.unsubscribeMailbox(e.path)},s.prototype.listWellKnownFolders=function(){var e=this,t={Inbox:[],Drafts:[],All:[],Flagged:[],Sent:[],Trash:[],Junk:[],Archive:[],Other:[]};return n.debug((()=>["listing folders"])),e._checkOnline().then((function(){return e._client.listMailboxes()})).then((function(e){return n.debug((()=>["folder list received!"])),i(e),t})).catch((function(e){throw n.error((()=>["error listing folders: "+e+"\n"+e.stack])),e}));function i(s){if(s.path&&-1===(s.flags||[]).indexOf("\\Noselect")){n.debug((()=>["name: "+s.name+", path: "+s.path+(s.flags?", flags: "+s.flags:"")+(s.specialUse?", special use: "+s.specialUse:"")]));var a={name:s.name||s.path,path:s.path,subscribed:s.subscribed,delimiter:s.delimiter};"INBOX"===a.name.toUpperCase()?(a.type="Inbox",e._delimiter=s.delimiter,t.Inbox.push(a)):"\\Drafts"===s.specialUse?(a.type="Drafts",t.Drafts.push(a)):"\\All"===s.specialUse?(a.type="All",t.All.push(a)):"\\Flagged"===s.specialUse?(a.type="Flagged",t.Flagged.push(a)):"\\Sent"===s.specialUse?(a.type="Sent",t.Sent.push(a)):"\\Trash"===s.specialUse?(a.type="Trash",t.Trash.push(a)):"\\Junk"===s.specialUse?(a.type="Junk",t.Junk.push(a)):"\\Archive"===s.specialUse||["ARCHIVE","ARCHIVES"].some((e=>function(e){return e.path.split(e.delimiter).map((e=>e.toUpperCase()))}(s).includes(e)))?(a.type="Archive",t.Archive.push(a)):(a.type="Other",t.Other.push(a))}s.children&&s.children.forEach(i)}},s.prototype.deleteFolder=function(e){var t=this;return t._checkOnline().then((function(){return t._client.deleteMailbox(e.path)})).catch((function(t){throw n.error((()=>["error deleting folder"+e.path+": "+t+"\n"+t.stack])),t}))},s.prototype.createFolder=function(e){var t,i=this,s=e.path;return Array.isArray(s)||(s=[s]),i._checkOnline().then((function(){if(void 0===i._delimiter||void 0===i._prefix)return i._client.listNamespaces().then((function(e){return e&&e.personal&&e.personal[0]?(i._delimiter=e.personal[0].delimiter,void(i._prefix=e.personal[0].prefix.split(i._delimiter).shift())):(i._prefix="",i._delimiter?void 0:i._client.listMailboxes().then((function(e){a(e)})))}))})).then((function(){if(!i._delimiter)throw new Error("Could not determine delimiter for mailbox hierarchy");return i._prefix&&s.unshift(i._prefix),t=s.join(i._delimiter),i._client.createMailbox(t)})).then((function(){return t})).catch((function(t){throw n.error((()=>["error creating folder "+e.path+": "+t+"\n"+t.stack])),t}));function a(e){"INBOX"!==(e.path||"").toUpperCase()?e.children&&e.children.forEach(a):i._delimiter=e.delimiter}},s.prototype.search=function(e){var t=e.client||this._client,i={},s={byUid:!0};return i.all=!0,!0===e.unread?i.unseen=!0:!1===e.unread&&(i.seen=!0),!0===e.answered?i.answered=!0:!1===e.answered&&(i.unanswered=!0),e.header&&(i.header=e.header),e.uid&&(i.uid=e.uid),n.debug((()=>["searching in "+e.path+" for "+Object.keys(i).join(",")])),this._checkOnline().then((function(){return t.search(e.path,i,s)})).then((function(t){return n.debug((()=>["searched in "+e.path+" for "+Object.keys(i).join(",")+" ("+t.length+" uids)"])),t})).catch((function(t){throw n.error((()=>["error searching "+e.path+": "+t+"\n"+t.stack])),t}))},s.prototype.listMessages=function(e){var t,i=this,s=["uid","bodystructure","flags","envelope","body.peek[header.fields (references list-id x-microsoft-original-message-id from list-post)]"],o={byUid:!0};this._client.hasCapability("X-GM-EXT-1")&&s.push("x-gm-msgid"),this._client.hasCapability("PREVIEW")&&s.push("preview"),t=e.uids?e.uids.join(","):e.sequence?e.sequence:(e.firstUid||1)+":"+(e.lastUid||"*");let c=i.mailboxCache[e.path];const l=c&&c.noModseq;return this._client.hasCapability("CONDSTORE")&&!l&&s.push("modseq"),n.debug((()=>["listing messages in "+e.path+" for interval "+t])),i._checkOnline().then((function(){return i._client.listMessages(e.path,t,s,o)})).then((function(e){var t=[];return e.forEach((function(e){if(!e.envelope||!e.uid)return void n.debug((()=>["message is malformed: "+JSON.stringify(e)]));var s=e["body[header.fields (references list-id x-microsoft-original-message-id from list-post)]"];s&&(s=s.replace(/\r?\n([ \t])/g,"$1"));var o=/References:\s*((?:<\S+>\s*)+)/.exec(s),c=/list-id *: *(.*(?:\r?\n[\t ].+)*)/i.exec(s),l=/list-post *: *(.*(?:\r?\n[\t ].+)*)/i.exec(s),d=/X-Microsoft-Original-Message-ID:\s*\S*\s<(\S+)>/.exec(s);const u=e.envelope.from||[];i._addFromHeaderAddresses(u,s);var h=Date.now(),f=Date.parse(e.envelope.date)||h;f>h&&(f=h);let p="";Array.isArray(e.preview)?p=e.preview[1].value:"string"==typeof e.preview?p=e.preview:e.preview&&n.debug("Message preview of unexpected type:",e.preview,typeof e.preview);var g={uid:e.uid,messageId:(e.envelope["message-id"]||"").replace(/[<>]/g,"").trim(),originalMessageId:d?d[1]:"",listId:c?c[1]:"",listPost:l?l[1]:"",gmailId:e["x-gm-msgid"]||"",from:u,replyTo:e.envelope["reply-to"]||[],to:e.envelope.to||[],cc:e.envelope.cc||[],bcc:e.envelope.bcc||[],modseq:e.modseq||"0",subject:e.envelope.subject||"(no subject)",preview:p,inReplyTo:(e.envelope["in-reply-to"]||"").replace(/[<>]/g,"").trim(),references:o?o[1].split(/\s+/).filter((function(e){return""!==e})).map((function(e){return e.replace(/[<>]/g,"")})):[],sentDate:f,flags:e.flags||[],attachment:0,size:0};const m=e.bodystructure||{};r(m,g,a(m)),n.debug((()=>["listing message: [uid: "+g.uid+"]"])),t.push(g)})),t})).catch((function(t){throw n.error((()=>["error listing messages in "+e.path+": "+t+"\n"+t.stack])),t}))},s.prototype.getMessages=function(e){var t=this,i=["body.peek[]"],s={byUid:!0,valueAsString:!1},a=e.uids.join(",");return n.debug((()=>["retrieving body parts for uid(s) "+a+" in folder "+e.path+": "+i])),t._checkOnline().then((function(){return t._client.listMessages(e.path,a,i,s)})).then((function(e){const t={};return e.forEach((function(e){t[e.uid]=e["body[]"]})),t})).catch((function(t){throw n.error((()=>["error fetching message for uid(s) "+a+" in folder "+e.path+": "+t+"\n"+t.stack])),t}))},s.prototype.updateFlags=function(e){const t=e.uids.sort(o);let i=t[0],s=[];function a(e){e===i?s.push(i):s.push(i+":"+e)}for(let e=1;e<t.length;e++)t[e]-t[e-1]!=1&&(a(t[e-1]),i=t[e]);a(t[t.length-1]);const r=s.join(",");var c=this,l={byUid:!0},d=e.add||[],u=e.remove||[];return n.debug((()=>["updating flags for uids "+r+" in folder "+e.path+": "+(u.length>0?" removing "+u:"")+(d.length>0?" adding "+d:"")])),c._checkOnline().then((function(){if(d.length>0)return c._client.setFlags(e.path,r,{add:d},l)})).then((function(){if(u.length>0)return c._client.setFlags(e.path,r,{remove:u},l)})).then((function(){n.debug((()=>["successfully updated flags for uids "+r+" in folder "+e.path+": added "+d+" and removed "+u]))})).catch((function(t){throw n.error((()=>["error updating flags for uids "+r+" in folder "+e.path+" : "+t+"\n"+t.stack])),t}))},s.prototype.copyMessages=function(e){var t=this;return n.debug((()=>["copying uids "+e.uids+" from "+e.path+" to "+e.destination])),t._checkOnline().then((function(){var n=e.uids.join(",");return t._client.copyMessages(e.path,n,e.destination,{byUid:!0})})).then((function(t){return n.debug((()=>["successfully copied uids "+e.uids+" from "+e.path+" to "+e.destination])),t})).catch((function(t){throw n.error((()=>["error copying uids "+e.uids+" from "+e.path+" to "+e.destination+" : "+t+"\n"+t.stack])),t}))},s.prototype.moveMessages=function(e){var t=this;return n.debug((()=>["moving uids "+e.uids+" from "+e.path+" to "+e.destination])),t._checkOnline().then((function(){var n=e.uids.join(",");return t._client.moveMessages(e.path,n,e.destination,{byUid:!0})})).then((function(){n.debug((()=>["successfully moved uids "+e.uids+" from "+e.path+" to "+e.destination]))})).catch((function(t){throw n.error((()=>["error moving uids "+e.uids+" from "+e.path+" to "+e.destination+" : "+t+"\n"+t.stack])),t}))},s.prototype.uploadMessage=function(e){var t=this,i=e.message instanceof Uint8Array?function(e){const t=10240,n=[];for(var i=0;i<e.length;i+=t){const s=i,a=Math.min(i+t,e.length);n.push(String.fromCharCode.apply(null,e.subarray(s,a)))}return n.join("")}(e.message):e.message,s=Array.isArray(e.flags)&&e.flags.length>0?{flags:e.flags}:{};return n.debug((()=>["uploading a message of "+i.length+" bytes to "+e.path])),t._checkOnline().then((function(){return t._client.upload(e.path,i,s)})).then((function(t){return n.debug((()=>["successfully uploaded message to "+e.path])),t})).catch((function(t){throw n.error((()=>["error uploading <"+i.length+"> bytes to "+e.path+" : "+t+"\n"+t.stack])),t}))},s.prototype.deleteMessages=function(e){var t=this;return n.debug((()=>["deleting uid "+e.uid+" from "+e.path])),t._checkOnline().then((function(){var n=e.uids.join(",");return t._client.deleteMessages(e.path,n,{byUid:!0})})).then((function(){n.debug((()=>["successfully deleted uid "+e.uid+" from "+e.path]))})).catch((function(t){throw n.error((()=>["error deleting uid "+e.uid+" from "+e.path+" : "+t+"\n"+t.stack])),t}))},s.prototype._addFromHeaderAddresses=function(e,n){if(n)for(const i of n.matchAll(/from\s*:\s*([^\n\r]+)/gi))if(i.length>1&&i[1]){const n=t(i[1])||[];for(const t of n){const n=e.find((e=>e.address===t.address));n?n.name||(n.name=t.name):e.push(t)}}},s.prototype._checkOnline=function(){var e=this;return new Promise((function(t){if(!e._loggedIn)throw new Error("Not logged in!");t()}))},s}))},24236:(e,t)=>{"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var s in n)i(n,s)&&(e[s]=n[s])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var s={arraySet:function(e,t,n,i,s){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+i),s);else for(var a=0;a<i;a++)e[s+a]=t[n+a]},flattenChunks:function(e){var t,n,i,s,a,r;for(i=0,t=0,n=e.length;t<n;t++)i+=e[t].length;for(r=new Uint8Array(i),s=0,t=0,n=e.length;t<n;t++)a=e[t],r.set(a,s),s+=a.length;return r}},a={arraySet:function(e,t,n,i,s){for(var a=0;a<i;a++)e[s+a]=t[n+a]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,s)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,a))},t.setTyped(n)},66069:e=>{"use strict";e.exports=function(e,t,n,i){for(var s=65535&e|0,a=e>>>16&65535|0,r=0;0!==n;){n-=r=n>2e3?2e3:n;do{a=a+(s=s+t[i++]|0)|0}while(--r);s%=65521,a%=65521}return s|a<<16|0}},71619:e=>{"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},2869:e=>{"use strict";var t=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();e.exports=function(e,n,i,s){var a=t,r=s+i;e^=-1;for(var o=s;o<r;o++)e=e>>>8^a[255&(e^n[o])];return-1^e}},30405:(e,t,n)=>{"use strict";var i,s=n(24236),a=n(10342),r=n(66069),o=n(2869),c=n(48898),l=-2,d=258,u=262,h=103,f=113,p=666;function g(e,t){return e.msg=c[t],t}function m(e){return(e<<1)-(e>4?9:0)}function w(e){for(var t=e.length;--t>=0;)e[t]=0}function _(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(s.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function b(e,t){a._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,_(e.strm)}function y(e,t){e.pending_buf[e.pending++]=t}function v(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function I(e,t){var n,i,s=e.max_chain_length,a=e.strstart,r=e.prev_length,o=e.nice_match,c=e.strstart>e.w_size-u?e.strstart-(e.w_size-u):0,l=e.window,h=e.w_mask,f=e.prev,p=e.strstart+d,g=l[a+r-1],m=l[a+r];e.prev_length>=e.good_match&&(s>>=2),o>e.lookahead&&(o=e.lookahead);do{if(l[(n=t)+r]===m&&l[n+r-1]===g&&l[n]===l[a]&&l[++n]===l[a+1]){a+=2,n++;do{}while(l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&a<p);if(i=d-(p-a),a=p-d,i>r){if(e.match_start=t,r=i,i>=o)break;g=l[a+r-1],m=l[a+r]}}}while((t=f[t&h])>c&&0!=--s);return r<=e.lookahead?r:e.lookahead}function k(e){var t,n,i,a,c,l,d,h,f,p,g=e.w_size;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=g+(g-u)){s.arraySet(e.window,e.window,g,g,0),e.match_start-=g,e.strstart-=g,e.block_start-=g,t=n=e.hash_size;do{i=e.head[--t],e.head[t]=i>=g?i-g:0}while(--n);t=n=g;do{i=e.prev[--t],e.prev[t]=i>=g?i-g:0}while(--n);a+=g}if(0===e.strm.avail_in)break;if(l=e.strm,d=e.window,h=e.strstart+e.lookahead,f=a,p=void 0,(p=l.avail_in)>f&&(p=f),n=0===p?0:(l.avail_in-=p,s.arraySet(d,l.input,l.next_in,p,h),1===l.state.wrap?l.adler=r(l.adler,d,p,h):2===l.state.wrap&&(l.adler=o(l.adler,d,p,h)),l.next_in+=p,l.total_in+=p,p),e.lookahead+=n,e.lookahead+e.insert>=3)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=(e.ins_h<<e.hash_shift^e.window[c+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[c+3-1])&e.hash_mask,e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<u&&0!==e.strm.avail_in)}function E(e,t){for(var n,i;;){if(e.lookahead<u){if(k(e),e.lookahead<u&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-u&&(e.match_length=I(e,n)),e.match_length>=3)if(i=a._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(b(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(b(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(b(e,!1),0===e.strm.avail_out)?1:2}function x(e,t){for(var n,i,s;;){if(e.lookahead<u){if(k(e),e.lookahead<u&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-u&&(e.match_length=I(e,n),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-3,i=a._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=s&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(b(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((i=a._tr_tally(e,0,e.window[e.strstart-1]))&&b(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=a._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(b(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(b(e,!1),0===e.strm.avail_out)?1:2}function A(e,t,n,i,s){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=s}function S(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(1146),this.dyn_dtree=new s.Buf16(122),this.bl_tree=new s.Buf16(78),w(this.dyn_ltree),w(this.dyn_dtree),w(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(16),this.heap=new s.Buf16(573),w(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(573),w(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function M(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:f,e.adler=2===t.wrap?0:1,t.last_flush=0,a._tr_init(t),0):g(e,l)}function O(e){var t,n=M(e);return 0===n&&((t=e.state).window_size=2*t.w_size,w(t.head),t.max_lazy_match=i[t.level].max_lazy,t.good_match=i[t.level].good_length,t.nice_match=i[t.level].nice_length,t.max_chain_length=i[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),n}function N(e,t,n,i,a,r){if(!e)return l;var o=1;if(-1===t&&(t=6),i<0?(o=0,i=-i):i>15&&(o=2,i-=16),a<1||a>9||8!==n||i<8||i>15||t<0||t>9||r<0||r>4)return g(e,l);8===i&&(i=9);var c=new S;return e.state=c,c.strm=e,c.wrap=o,c.gzhead=null,c.w_bits=i,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=a+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+3-1)/3),c.window=new s.Buf8(2*c.w_size),c.head=new s.Buf16(c.hash_size),c.prev=new s.Buf16(c.w_size),c.lit_bufsize=1<<a+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new s.Buf8(c.pending_buf_size),c.d_buf=1*c.lit_bufsize,c.l_buf=3*c.lit_bufsize,c.level=t,c.strategy=r,c.method=n,O(e)}i=[new A(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(k(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+n;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,b(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-u&&(b(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(b(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(b(e,!1),e.strm.avail_out),1)})),new A(4,4,8,4,E),new A(4,5,16,8,E),new A(4,6,32,32,E),new A(4,4,16,16,x),new A(8,16,32,32,x),new A(8,16,128,128,x),new A(8,32,128,256,x),new A(32,128,258,1024,x),new A(32,258,258,4096,x)],t.Ue=N,t.Wt=function(e,t){var n,s,r,c;if(!e||!e.state||t>5||t<0)return e?g(e,l):l;if(s=e.state,!e.output||!e.input&&0!==e.avail_in||s.status===p&&4!==t)return g(e,0===e.avail_out?-5:l);if(s.strm=e,n=s.last_flush,s.last_flush=t,42===s.status)if(2===s.wrap)e.adler=0,y(s,31),y(s,139),y(s,8),s.gzhead?(y(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),y(s,255&s.gzhead.time),y(s,s.gzhead.time>>8&255),y(s,s.gzhead.time>>16&255),y(s,s.gzhead.time>>24&255),y(s,9===s.level?2:s.strategy>=2||s.level<2?4:0),y(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(y(s,255&s.gzhead.extra.length),y(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=o(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69):(y(s,0),y(s,0),y(s,0),y(s,0),y(s,0),y(s,9===s.level?2:s.strategy>=2||s.level<2?4:0),y(s,3),s.status=f);else{var u=8+(s.w_bits-8<<4)<<8;u|=(s.strategy>=2||s.level<2?0:s.level<6?1:6===s.level?2:3)<<6,0!==s.strstart&&(u|=32),u+=31-u%31,s.status=f,v(s,u),0!==s.strstart&&(v(s,e.adler>>>16),v(s,65535&e.adler)),e.adler=1}if(69===s.status)if(s.gzhead.extra){for(r=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>r&&(e.adler=o(e.adler,s.pending_buf,s.pending-r,r)),_(e),r=s.pending,s.pending!==s.pending_buf_size));)y(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>r&&(e.adler=o(e.adler,s.pending_buf,s.pending-r,r)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=73)}else s.status=73;if(73===s.status)if(s.gzhead.name){r=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>r&&(e.adler=o(e.adler,s.pending_buf,s.pending-r,r)),_(e),r=s.pending,s.pending===s.pending_buf_size)){c=1;break}c=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,y(s,c)}while(0!==c);s.gzhead.hcrc&&s.pending>r&&(e.adler=o(e.adler,s.pending_buf,s.pending-r,r)),0===c&&(s.gzindex=0,s.status=91)}else s.status=91;if(91===s.status)if(s.gzhead.comment){r=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>r&&(e.adler=o(e.adler,s.pending_buf,s.pending-r,r)),_(e),r=s.pending,s.pending===s.pending_buf_size)){c=1;break}c=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,y(s,c)}while(0!==c);s.gzhead.hcrc&&s.pending>r&&(e.adler=o(e.adler,s.pending_buf,s.pending-r,r)),0===c&&(s.status=h)}else s.status=h;if(s.status===h&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&_(e),s.pending+2<=s.pending_buf_size&&(y(s,255&e.adler),y(s,e.adler>>8&255),e.adler=0,s.status=f)):s.status=f),0!==s.pending){if(_(e),0===e.avail_out)return s.last_flush=-1,0}else if(0===e.avail_in&&m(t)<=m(n)&&4!==t)return g(e,-5);if(s.status===p&&0!==e.avail_in)return g(e,-5);if(0!==e.avail_in||0!==s.lookahead||0!==t&&s.status!==p){var I=2===s.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(k(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,n=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(b(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(b(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(b(e,!1),0===e.strm.avail_out)?1:2}(s,t):3===s.strategy?function(e,t){for(var n,i,s,r,o=e.window;;){if(e.lookahead<=d){if(k(e),e.lookahead<=d&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=o[s=e.strstart-1])===o[++s]&&i===o[++s]&&i===o[++s]){r=e.strstart+d;do{}while(i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&s<r);e.match_length=d-(r-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=a._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(b(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(b(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(b(e,!1),0===e.strm.avail_out)?1:2}(s,t):i[s.level].func(s,t);if(3!==I&&4!==I||(s.status=p),1===I||3===I)return 0===e.avail_out&&(s.last_flush=-1),0;if(2===I&&(1===t?a._tr_align(s):5!==t&&(a._tr_stored_block(s,0,0,!1),3===t&&(w(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),_(e),0===e.avail_out))return s.last_flush=-1,0}return 4!==t?0:s.wrap<=0?1:(2===s.wrap?(y(s,255&e.adler),y(s,e.adler>>8&255),y(s,e.adler>>16&255),y(s,e.adler>>24&255),y(s,255&e.total_in),y(s,e.total_in>>8&255),y(s,e.total_in>>16&255),y(s,e.total_in>>24&255)):(v(s,e.adler>>>16),v(s,65535&e.adler)),_(e),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?0:1)}},94264:e=>{"use strict";e.exports=function(e,t){var n,i,s,a,r,o,c,l,d,u,h,f,p,g,m,w,_,b,y,v,I,k,E,x,A;n=e.state,i=e.next_in,x=e.input,s=i+(e.avail_in-5),a=e.next_out,A=e.output,r=a-(t-e.avail_out),o=a+(e.avail_out-257),c=n.dmax,l=n.wsize,d=n.whave,u=n.wnext,h=n.window,f=n.hold,p=n.bits,g=n.lencode,m=n.distcode,w=(1<<n.lenbits)-1,_=(1<<n.distbits)-1;e:do{p<15&&(f+=x[i++]<<p,p+=8,f+=x[i++]<<p,p+=8),b=g[f&w];t:for(;;){if(f>>>=y=b>>>24,p-=y,0===(y=b>>>16&255))A[a++]=65535&b;else{if(!(16&y)){if(0==(64&y)){b=g[(65535&b)+(f&(1<<y)-1)];continue t}if(32&y){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}v=65535&b,(y&=15)&&(p<y&&(f+=x[i++]<<p,p+=8),v+=f&(1<<y)-1,f>>>=y,p-=y),p<15&&(f+=x[i++]<<p,p+=8,f+=x[i++]<<p,p+=8),b=m[f&_];n:for(;;){if(f>>>=y=b>>>24,p-=y,!(16&(y=b>>>16&255))){if(0==(64&y)){b=m[(65535&b)+(f&(1<<y)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(I=65535&b,p<(y&=15)&&(f+=x[i++]<<p,(p+=8)<y&&(f+=x[i++]<<p,p+=8)),(I+=f&(1<<y)-1)>c){e.msg="invalid distance too far back",n.mode=30;break e}if(f>>>=y,p-=y,I>(y=a-r)){if((y=I-y)>d&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(k=0,E=h,0===u){if(k+=l-y,y<v){v-=y;do{A[a++]=h[k++]}while(--y);k=a-I,E=A}}else if(u<y){if(k+=l+u-y,(y-=u)<v){v-=y;do{A[a++]=h[k++]}while(--y);if(k=0,u<v){v-=y=u;do{A[a++]=h[k++]}while(--y);k=a-I,E=A}}}else if(k+=u-y,y<v){v-=y;do{A[a++]=h[k++]}while(--y);k=a-I,E=A}for(;v>2;)A[a++]=E[k++],A[a++]=E[k++],A[a++]=E[k++],v-=3;v&&(A[a++]=E[k++],v>1&&(A[a++]=E[k++]))}else{k=a-I;do{A[a++]=A[k++],A[a++]=A[k++],A[a++]=A[k++],v-=3}while(v>2);v&&(A[a++]=A[k++],v>1&&(A[a++]=A[k++]))}break}}break}}while(i<s&&a<o);i-=v=p>>3,f&=(1<<(p-=v<<3))-1,e.next_in=i,e.next_out=a,e.avail_in=i<s?s-i+5:5-(i-s),e.avail_out=a<o?o-a+257:257-(a-o),n.hold=f,n.bits=p}},27948:(e,t,n)=>{"use strict";var i=n(24236),s=n(66069),a=n(2869),r=n(94264),o=n(9241),c=-2,l=12,d=30;function u(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function h(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function f(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new i.Buf32(852),t.distcode=t.distdyn=new i.Buf32(592),t.sane=1,t.back=-1,0):c}function p(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,f(e)):c}function g(e,t){var n,i;return e&&e.state?(i=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?c:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,p(e))):c}function m(e,t){var n,i;return e?(i=new h,e.state=i,i.window=null,0!==(n=g(e,t))&&(e.state=null),n):c}var w,_,b=!0;function y(e){if(b){var t;for(w=new i.Buf32(512),_=new i.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(o(1,e.lens,0,288,w,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;o(2,e.lens,0,32,_,0,e.work,{bits:5}),b=!1}e.lencode=w,e.lenbits=9,e.distcode=_,e.distbits=5}function v(e,t,n,s){var a,r=e.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new i.Buf8(r.wsize)),s>=r.wsize?(i.arraySet(r.window,t,n-r.wsize,r.wsize,0),r.wnext=0,r.whave=r.wsize):((a=r.wsize-r.wnext)>s&&(a=s),i.arraySet(r.window,t,n-s,a,r.wnext),(s-=a)?(i.arraySet(r.window,t,n-s,s,0),r.wnext=s,r.whave=r.wsize):(r.wnext+=a,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=a))),0}t.Ul=m,t.rr=function(e,t){var n,h,f,p,g,m,w,_,b,I,k,E,x,A,S,M,O,N,Z,T,L,R,P,C,U=0,F=new i.Buf8(4),D=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return c;(n=e.state).mode===l&&(n.mode=13),g=e.next_out,f=e.output,w=e.avail_out,p=e.next_in,h=e.input,m=e.avail_in,_=n.hold,b=n.bits,I=m,k=w,R=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;b<16;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(2&n.wrap&&35615===_){n.check=0,F[0]=255&_,F[1]=_>>>8&255,n.check=a(n.check,F,2,0),_=0,b=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&_)<<8)+(_>>8))%31){e.msg="incorrect header check",n.mode=d;break}if(8!=(15&_)){e.msg="unknown compression method",n.mode=d;break}if(b-=4,L=8+(15&(_>>>=4)),0===n.wbits)n.wbits=L;else if(L>n.wbits){e.msg="invalid window size",n.mode=d;break}n.dmax=1<<L,e.adler=n.check=1,n.mode=512&_?10:l,_=0,b=0;break;case 2:for(;b<16;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(n.flags=_,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=d;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=d;break}n.head&&(n.head.text=_>>8&1),512&n.flags&&(F[0]=255&_,F[1]=_>>>8&255,n.check=a(n.check,F,2,0)),_=0,b=0,n.mode=3;case 3:for(;b<32;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}n.head&&(n.head.time=_),512&n.flags&&(F[0]=255&_,F[1]=_>>>8&255,F[2]=_>>>16&255,F[3]=_>>>24&255,n.check=a(n.check,F,4,0)),_=0,b=0,n.mode=4;case 4:for(;b<16;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}n.head&&(n.head.xflags=255&_,n.head.os=_>>8),512&n.flags&&(F[0]=255&_,F[1]=_>>>8&255,n.check=a(n.check,F,2,0)),_=0,b=0,n.mode=5;case 5:if(1024&n.flags){for(;b<16;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}n.length=_,n.head&&(n.head.extra_len=_),512&n.flags&&(F[0]=255&_,F[1]=_>>>8&255,n.check=a(n.check,F,2,0)),_=0,b=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((E=n.length)>m&&(E=m),E&&(n.head&&(L=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),i.arraySet(n.head.extra,h,p,E,L)),512&n.flags&&(n.check=a(n.check,h,E,p)),m-=E,p+=E,n.length-=E),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===m)break e;E=0;do{L=h[p+E++],n.head&&L&&n.length<65536&&(n.head.name+=String.fromCharCode(L))}while(L&&E<m);if(512&n.flags&&(n.check=a(n.check,h,E,p)),m-=E,p+=E,L)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===m)break e;E=0;do{L=h[p+E++],n.head&&L&&n.length<65536&&(n.head.comment+=String.fromCharCode(L))}while(L&&E<m);if(512&n.flags&&(n.check=a(n.check,h,E,p)),m-=E,p+=E,L)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;b<16;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(_!==(65535&n.check)){e.msg="header crc mismatch",n.mode=d;break}_=0,b=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=l;break;case 10:for(;b<32;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}e.adler=n.check=u(_),_=0,b=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=g,e.avail_out=w,e.next_in=p,e.avail_in=m,n.hold=_,n.bits=b,2;e.adler=n.check=1,n.mode=l;case l:if(5===t||6===t)break e;case 13:if(n.last){_>>>=7&b,b-=7&b,n.mode=27;break}for(;b<3;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}switch(n.last=1&_,b-=1,3&(_>>>=1)){case 0:n.mode=14;break;case 1:if(y(n),n.mode=20,6===t){_>>>=2,b-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=d}_>>>=2,b-=2;break;case 14:for(_>>>=7&b,b-=7&b;b<32;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if((65535&_)!=(_>>>16^65535)){e.msg="invalid stored block lengths",n.mode=d;break}if(n.length=65535&_,_=0,b=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(E=n.length){if(E>m&&(E=m),E>w&&(E=w),0===E)break e;i.arraySet(f,h,p,E,g),m-=E,p+=E,w-=E,g+=E,n.length-=E;break}n.mode=l;break;case 17:for(;b<14;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(n.nlen=257+(31&_),_>>>=5,b-=5,n.ndist=1+(31&_),_>>>=5,b-=5,n.ncode=4+(15&_),_>>>=4,b-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=d;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;b<3;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}n.lens[D[n.have++]]=7&_,_>>>=3,b-=3}for(;n.have<19;)n.lens[D[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,P={bits:n.lenbits},R=o(0,n.lens,0,19,n.lencode,0,n.work,P),n.lenbits=P.bits,R){e.msg="invalid code lengths set",n.mode=d;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;M=(U=n.lencode[_&(1<<n.lenbits)-1])>>>16&255,O=65535&U,!((S=U>>>24)<=b);){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(O<16)_>>>=S,b-=S,n.lens[n.have++]=O;else{if(16===O){for(C=S+2;b<C;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(_>>>=S,b-=S,0===n.have){e.msg="invalid bit length repeat",n.mode=d;break}L=n.lens[n.have-1],E=3+(3&_),_>>>=2,b-=2}else if(17===O){for(C=S+3;b<C;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}b-=S,L=0,E=3+(7&(_>>>=S)),_>>>=3,b-=3}else{for(C=S+7;b<C;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}b-=S,L=0,E=11+(127&(_>>>=S)),_>>>=7,b-=7}if(n.have+E>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=d;break}for(;E--;)n.lens[n.have++]=L}}if(n.mode===d)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=d;break}if(n.lenbits=9,P={bits:n.lenbits},R=o(1,n.lens,0,n.nlen,n.lencode,0,n.work,P),n.lenbits=P.bits,R){e.msg="invalid literal/lengths set",n.mode=d;break}if(n.distbits=6,n.distcode=n.distdyn,P={bits:n.distbits},R=o(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,P),n.distbits=P.bits,R){e.msg="invalid distances set",n.mode=d;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(m>=6&&w>=258){e.next_out=g,e.avail_out=w,e.next_in=p,e.avail_in=m,n.hold=_,n.bits=b,r(e,k),g=e.next_out,f=e.output,w=e.avail_out,p=e.next_in,h=e.input,m=e.avail_in,_=n.hold,b=n.bits,n.mode===l&&(n.back=-1);break}for(n.back=0;M=(U=n.lencode[_&(1<<n.lenbits)-1])>>>16&255,O=65535&U,!((S=U>>>24)<=b);){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(M&&0==(240&M)){for(N=S,Z=M,T=O;M=(U=n.lencode[T+((_&(1<<N+Z)-1)>>N)])>>>16&255,O=65535&U,!(N+(S=U>>>24)<=b);){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}_>>>=N,b-=N,n.back+=N}if(_>>>=S,b-=S,n.back+=S,n.length=O,0===M){n.mode=26;break}if(32&M){n.back=-1,n.mode=l;break}if(64&M){e.msg="invalid literal/length code",n.mode=d;break}n.extra=15&M,n.mode=22;case 22:if(n.extra){for(C=n.extra;b<C;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}n.length+=_&(1<<n.extra)-1,_>>>=n.extra,b-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;M=(U=n.distcode[_&(1<<n.distbits)-1])>>>16&255,O=65535&U,!((S=U>>>24)<=b);){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(0==(240&M)){for(N=S,Z=M,T=O;M=(U=n.distcode[T+((_&(1<<N+Z)-1)>>N)])>>>16&255,O=65535&U,!(N+(S=U>>>24)<=b);){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}_>>>=N,b-=N,n.back+=N}if(_>>>=S,b-=S,n.back+=S,64&M){e.msg="invalid distance code",n.mode=d;break}n.offset=O,n.extra=15&M,n.mode=24;case 24:if(n.extra){for(C=n.extra;b<C;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}n.offset+=_&(1<<n.extra)-1,_>>>=n.extra,b-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=d;break}n.mode=25;case 25:if(0===w)break e;if(E=k-w,n.offset>E){if((E=n.offset-E)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=d;break}E>n.wnext?(E-=n.wnext,x=n.wsize-E):x=n.wnext-E,E>n.length&&(E=n.length),A=n.window}else A=f,x=g-n.offset,E=n.length;E>w&&(E=w),w-=E,n.length-=E;do{f[g++]=A[x++]}while(--E);0===n.length&&(n.mode=21);break;case 26:if(0===w)break e;f[g++]=n.length,w--,n.mode=21;break;case 27:if(n.wrap){for(;b<32;){if(0===m)break e;m--,_|=h[p++]<<b,b+=8}if(k-=w,e.total_out+=k,n.total+=k,k&&(e.adler=n.check=n.flags?a(n.check,f,k,g-k):s(n.check,f,k,g-k)),k=w,(n.flags?_:u(_))!==n.check){e.msg="incorrect data check",n.mode=d;break}_=0,b=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;b<32;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(_!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=d;break}_=0,b=0}n.mode=29;case 29:R=1;break e;case d:R=-3;break e;case 31:return-4;default:return c}return e.next_out=g,e.avail_out=w,e.next_in=p,e.avail_in=m,n.hold=_,n.bits=b,(n.wsize||k!==e.avail_out&&n.mode<d&&(n.mode<27||4!==t))&&v(e,e.output,e.next_out,k-e.avail_out)?(n.mode=31,-4):(I-=e.avail_in,k-=e.avail_out,e.total_in+=I,e.total_out+=k,n.total+=k,n.wrap&&k&&(e.adler=n.check=n.flags?a(n.check,f,k,e.next_out-k):s(n.check,f,k,e.next_out-k)),e.data_type=n.bits+(n.last?64:0)+(n.mode===l?128:0)+(20===n.mode||15===n.mode?256:0),(0===I&&0===k||4===t)&&0===R&&(R=-5),R)}},9241:(e,t,n)=>{"use strict";var i=n(24236),s=15,a=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],r=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,n,l,d,u,h,f){var p,g,m,w,_,b,y,v,I,k=f.bits,E=0,x=0,A=0,S=0,M=0,O=0,N=0,Z=0,T=0,L=0,R=null,P=0,C=new i.Buf16(16),U=new i.Buf16(16),F=null,D=0;for(E=0;E<=s;E++)C[E]=0;for(x=0;x<l;x++)C[t[n+x]]++;for(M=k,S=s;S>=1&&0===C[S];S--);if(M>S&&(M=S),0===S)return d[u++]=20971520,d[u++]=20971520,f.bits=1,0;for(A=1;A<S&&0===C[A];A++);for(M<A&&(M=A),Z=1,E=1;E<=s;E++)if(Z<<=1,(Z-=C[E])<0)return-1;if(Z>0&&(0===e||1!==S))return-1;for(U[1]=0,E=1;E<s;E++)U[E+1]=U[E]+C[E];for(x=0;x<l;x++)0!==t[n+x]&&(h[U[t[n+x]]++]=x);if(0===e?(R=F=h,b=19):1===e?(R=a,P-=257,F=r,D-=257,b=256):(R=o,F=c,b=-1),L=0,x=0,E=A,_=u,O=M,N=0,m=-1,w=(T=1<<M)-1,1===e&&T>852||2===e&&T>592)return 1;for(;;){y=E-N,h[x]<b?(v=0,I=h[x]):h[x]>b?(v=F[D+h[x]],I=R[P+h[x]]):(v=96,I=0),p=1<<E-N,A=g=1<<O;do{d[_+(L>>N)+(g-=p)]=y<<24|v<<16|I|0}while(0!==g);for(p=1<<E-1;L&p;)p>>=1;if(0!==p?(L&=p-1,L+=p):L=0,x++,0==--C[E]){if(E===S)break;E=t[n+h[x]]}if(E>M&&(L&w)!==m){for(0===N&&(N=M),_+=A,Z=1<<(O=E-N);O+N<S&&!((Z-=C[O+N])<=0);)O++,Z<<=1;if(T+=1<<O,1===e&&T>852||2===e&&T>592)return 1;d[m=L&w]=M<<24|O<<16|_-u|0}}return 0!==L&&(d[_+L]=E-N<<24|64<<16|0),f.bits=M,0}},48898:e=>{"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},10342:(e,t,n)=>{"use strict";var i=n(24236);function s(e){for(var t=e.length;--t>=0;)e[t]=0}var a=256,r=286,o=30,c=15,l=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],d=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],h=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],f=new Array(576);s(f);var p=new Array(60);s(p);var g=new Array(512);s(g);var m=new Array(256);s(m);var w=new Array(29);s(w);var _,b,y,v=new Array(o);function I(e,t,n,i,s){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=s,this.has_stree=e&&e.length}function k(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function E(e){return e<256?g[e]:g[256+(e>>>7)]}function x(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function A(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,x(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function S(e,t,n){A(e,n[2*t],n[2*t+1])}function M(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function O(e,t,n){var i,s,a=new Array(16),r=0;for(i=1;i<=c;i++)a[i]=r=r+n[i-1]<<1;for(s=0;s<=t;s++){var o=e[2*s+1];0!==o&&(e[2*s]=M(a[o]++,o))}}function N(e){var t;for(t=0;t<r;t++)e.dyn_ltree[2*t]=0;for(t=0;t<o;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function Z(e){e.bi_valid>8?x(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function T(e,t,n,i){var s=2*t,a=2*n;return e[s]<e[a]||e[s]===e[a]&&i[t]<=i[n]}function L(e,t,n){for(var i=e.heap[n],s=n<<1;s<=e.heap_len&&(s<e.heap_len&&T(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!T(t,i,e.heap[s],e.depth));)e.heap[n]=e.heap[s],n=s,s<<=1;e.heap[n]=i}function R(e,t,n){var i,s,r,o,c=0;if(0!==e.last_lit)do{i=e.pending_buf[e.d_buf+2*c]<<8|e.pending_buf[e.d_buf+2*c+1],s=e.pending_buf[e.l_buf+c],c++,0===i?S(e,s,t):(S(e,(r=m[s])+a+1,t),0!==(o=l[r])&&A(e,s-=w[r],o),S(e,r=E(--i),n),0!==(o=d[r])&&A(e,i-=v[r],o))}while(c<e.last_lit);S(e,256,t)}function P(e,t){var n,i,s,a=t.dyn_tree,r=t.stat_desc.static_tree,o=t.stat_desc.has_stree,l=t.stat_desc.elems,d=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<l;n++)0!==a[2*n]?(e.heap[++e.heap_len]=d=n,e.depth[n]=0):a[2*n+1]=0;for(;e.heap_len<2;)a[2*(s=e.heap[++e.heap_len]=d<2?++d:0)]=1,e.depth[s]=0,e.opt_len--,o&&(e.static_len-=r[2*s+1]);for(t.max_code=d,n=e.heap_len>>1;n>=1;n--)L(e,a,n);s=l;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],L(e,a,1),i=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=i,a[2*s]=a[2*n]+a[2*i],e.depth[s]=(e.depth[n]>=e.depth[i]?e.depth[n]:e.depth[i])+1,a[2*n+1]=a[2*i+1]=s,e.heap[1]=s++,L(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,i,s,a,r,o,l=t.dyn_tree,d=t.max_code,u=t.stat_desc.static_tree,h=t.stat_desc.has_stree,f=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,g=t.stat_desc.max_length,m=0;for(a=0;a<=c;a++)e.bl_count[a]=0;for(l[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(a=l[2*l[2*(i=e.heap[n])+1]+1]+1)>g&&(a=g,m++),l[2*i+1]=a,i>d||(e.bl_count[a]++,r=0,i>=p&&(r=f[i-p]),o=l[2*i],e.opt_len+=o*(a+r),h&&(e.static_len+=o*(u[2*i+1]+r)));if(0!==m){do{for(a=g-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[g]--,m-=2}while(m>0);for(a=g;0!==a;a--)for(i=e.bl_count[a];0!==i;)(s=e.heap[--n])>d||(l[2*s+1]!==a&&(e.opt_len+=(a-l[2*s+1])*l[2*s],l[2*s+1]=a),i--)}}(e,t),O(a,d,e.bl_count)}function C(e,t,n){var i,s,a=-1,r=t[1],o=0,c=7,l=4;for(0===r&&(c=138,l=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)s=r,r=t[2*(i+1)+1],++o<c&&s===r||(o<l?e.bl_tree[2*s]+=o:0!==s?(s!==a&&e.bl_tree[2*s]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,a=s,0===r?(c=138,l=3):s===r?(c=6,l=3):(c=7,l=4))}function U(e,t,n){var i,s,a=-1,r=t[1],o=0,c=7,l=4;for(0===r&&(c=138,l=3),i=0;i<=n;i++)if(s=r,r=t[2*(i+1)+1],!(++o<c&&s===r)){if(o<l)do{S(e,s,e.bl_tree)}while(0!=--o);else 0!==s?(s!==a&&(S(e,s,e.bl_tree),o--),S(e,16,e.bl_tree),A(e,o-3,2)):o<=10?(S(e,17,e.bl_tree),A(e,o-3,3)):(S(e,18,e.bl_tree),A(e,o-11,7));o=0,a=s,0===r?(c=138,l=3):s===r?(c=6,l=3):(c=7,l=4)}}s(v);var F=!1;function D(e,t,n,s){A(e,0+(s?1:0),3),function(e,t,n,s){Z(e),s&&(x(e,n),x(e,~n)),i.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n,!0)}t._tr_init=function(e){F||(!function(){var e,t,n,i,s,a=new Array(16);for(n=0,i=0;i<28;i++)for(w[i]=n,e=0;e<1<<l[i];e++)m[n++]=i;for(m[n-1]=i,s=0,i=0;i<16;i++)for(v[i]=s,e=0;e<1<<d[i];e++)g[s++]=i;for(s>>=7;i<o;i++)for(v[i]=s<<7,e=0;e<1<<d[i]-7;e++)g[256+s++]=i;for(t=0;t<=c;t++)a[t]=0;for(e=0;e<=143;)f[2*e+1]=8,e++,a[8]++;for(;e<=255;)f[2*e+1]=9,e++,a[9]++;for(;e<=279;)f[2*e+1]=7,e++,a[7]++;for(;e<=287;)f[2*e+1]=8,e++,a[8]++;for(O(f,287,a),e=0;e<o;e++)p[2*e+1]=5,p[2*e]=M(e,5);_=new I(f,l,257,r,c),b=new I(p,d,0,o,c),y=new I(new Array(0),u,0,19,7)}(),F=!0),e.l_desc=new k(e.dyn_ltree,_),e.d_desc=new k(e.dyn_dtree,b),e.bl_desc=new k(e.bl_tree,y),e.bi_buf=0,e.bi_valid=0,N(e)},t._tr_stored_block=D,t._tr_flush_block=function(e,t,n,i){var s,r,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<a;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),P(e,e.l_desc),P(e,e.d_desc),o=function(e){var t;for(C(e,e.dyn_ltree,e.l_desc.max_code),C(e,e.dyn_dtree,e.d_desc.max_code),P(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*h[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),s=e.opt_len+3+7>>>3,(r=e.static_len+3+7>>>3)<=s&&(s=r)):s=r=n+5,n+4<=s&&-1!==t?D(e,t,n,i):4===e.strategy||r===s?(A(e,2+(i?1:0),3),R(e,f,p)):(A(e,4+(i?1:0),3),function(e,t,n,i){var s;for(A(e,t-257,5),A(e,n-1,5),A(e,i-4,4),s=0;s<i;s++)A(e,e.bl_tree[2*h[s]+1],3);U(e,e.dyn_ltree,t-1),U(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),R(e,e.dyn_ltree,e.dyn_dtree)),N(e),i&&Z(e)},t._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(m[n]+a+1)]++,e.dyn_dtree[2*E(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){A(e,2,3),S(e,256,f),function(e){16===e.bi_valid?(x(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},62292:e=>{"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},14153:e=>{const t=/^[-+]?0x[a-fA-F0-9]+$/,n=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const i={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};e.exports=function(e,s={}){if(s=Object.assign({},i,s),!e||"string"!=typeof e)return e;let a=e.trim();if(void 0!==s.skipLike&&s.skipLike.test(a))return e;if(s.hex&&t.test(a))return Number.parseInt(a,16);{const t=n.exec(a);if(t){const n=t[1],i=t[2];let r=function(e){if(e&&-1!==e.indexOf("."))return"."===(e=e.replace(/0+$/,""))?e="0":"."===e[0]?e="0"+e:"."===e[e.length-1]&&(e=e.substr(0,e.length-1)),e;return e}(t[3]);const o=t[4]||t[6];if(!s.leadingZeros&&i.length>0&&n&&"."!==a[2])return e;if(!s.leadingZeros&&i.length>0&&!n&&"."!==a[1])return e;{const t=Number(a),c=""+t;return-1!==c.search(/[eE]/)||o?s.eNotation?t:e:-1!==a.indexOf(".")?"0"===c&&""===r||c===r||n&&c==="-"+r?t:e:i?r===c||n+r===c?t:e:a===c||a===n+c?t:e}}return e}}}},n={};function i(e){var s=n[e];if(void 0!==s)return s.exports;var a=n[e]={id:e,loaded:!1,exports:{}};return t[e].call(a.exports,a,a.exports,i),a.loaded=!0,a.exports}i.m=t,e=[],i.O=(t,n,s,a)=>{if(!n){var r=1/0;for(d=0;d<e.length;d++){for(var[n,s,a]=e[d],o=!0,c=0;c<n.length;c++)(!1&a||r>=a)&&Object.keys(i.O).every((e=>i.O[e](n[c])))?n.splice(c--,1):(o=!1,a<r&&(r=a));if(o){e.splice(d--,1);var l=s();void 0!==l&&(t=l)}}return t}a=a||0;for(var d=e.length;d>0&&e[d-1][2]>a;d--)e[d]=e[d-1];e[d]=[n,s,a]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),i.j=670,(()=>{var e={670:0};i.O.j=t=>0===e[t];var t=(t,n)=>{var s,a,[r,o,c]=n,l=0;if(r.some((t=>0!==e[t]))){for(s in o)i.o(o,s)&&(i.m[s]=o[s]);if(c)var d=c(i)}for(t&&t(n);l<r.length;l++)a=r[l],i.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return i.O(d)},n=self.webpackChunkgapp_browser_react=self.webpackChunkgapp_browser_react||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var s=i.O(void 0,[739],(()=>i(84936)));s=i.O(s)})();