(()=>{var e,t,n,i={36964:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var i=n(33638);const s=new class{composerSearchListId;setSearchListId(e){this.composerSearchListId=e}addAttachments(e){i.Z.dispatch({actionType:"MAIL_ACTIVE_COMPOSER_ADD_ATTACHMENTS",newAttachments:e})}}},43630:(e,t,n)=>{"use strict";n.d(t,{Z:()=>ue});var i=n(39005),s=n(99827),o=n(98611),a=n(36943),r=n(2431),l=n(54162),d=n(46382),c=n(96951),u=n(29087),p=n(81538),h=n(33638),g=n(56371),m=n(78347),f=n(2711),v=n(48868),y=n(83204),b=n(10671),S=n(5267),w=n(97823),C=n(68906),A=n(6977),I=n(35489),T=n(93043),Z=n(93789),E=n(5204),k=n(5863),_=n(51501),N=n(77312),P=n(89175);const D={call:async function(e,t){const n={},i=[],a=await w.Z.loadAllAccounts(),r=[],l=new Map,d=new _.RW,c=[];for(const s of e){const{id:e,messageId:p,sources:h}=s,g=t.get(e);if(!g)return;h.size===g.length?l.set(e,s):d.add(g,e);for(const[t,l]of h){const d=o.Z.get(t);if(!d)continue;const{accountId:h,path:g}=d;if(h===k.of&&[k.J8,k.Wb].includes(g))c.push(s.id);else if(h===k.u4){const e=u.Z.get(P.kRssSettings).find((e=>g.endsWith(e.feedId)));e&&r.push({feedId:e.feedId,messageId:p})}else{const t=a.find((e=>e.MAIL_EMAIL===h));t?t.accountType===k.s9.POP?n[h]?n[h].push(e):n[h]=[e]:!1===l.deleted&&!1===l.internal&&b.Z.isOnline(h,g)&&i.push({accountId:h,path:g,searchListId:e}):console.warn("Account "+h+" not found")}}}let p=[];c.length>0&&(p=await(0,N.TP)(c));const h=[v.Z.messages,v.Z.searchList,v.Z.threading,v.Z.filteringQueue,v.Z.viewIds,v.Z.hasRaw];(i.length>0||Object.keys(n).length>0)&&(h.push(v.Z.buffer),i.length>0&&h.push(v.Z.imap),Object.keys(n).length>0&&h.push(v.Z.pop)),r.length>0&&h.push(v.Z.deletedFeedItems);const g=[],m=[...l.keys()],D=[];await v.Z.transaction("rw",h,(async()=>{for(const{filterIds:e,searchListIds:t}of d.batches){const n=[...e],{fileKeys:i,sleUpdates:s}=await Z.Z.call(t,n);g.push(...i),D.push(...s);const o=new Map(n.map((e=>[e,void 0])));C.Z.call({type:"UPDATE_SLE",priority:k.Un.HIGH,searchListIds:t,sources:o})}if(r.length>0&&v.Z.deletedFeedItems.bulkAdd(r),m.length>0){const e=await I.Z.getBySearchListIds(m);for(const t of e){const{accountId:e,searchListId:n,hasRaw:i}=t;if(1===i){const t=l.get(n);if(!t)throw new Error("Item not found "+n);const{sentDate:i}=t;g.push({accountId:e,searchListId:n,sentDate:i})}}T.Z.call(m)}i.length>0&&A.Z.addDelete(i);const e=Object.keys(n);if(e.length>0){const t=[];for(const i of e)t.push({accountId:i,searchListIds:n[i],operation:"BUFFER_OPERATION_DELETE_POP"});t.length>0&&v.Z.buffer.bulkAdd(t)}})),m.length>0&&S.Z.deleteMessages(m),s.Z.updateIndex({removedSles:m,sleUpdates:D}),f.Z.flushBuffer(),E.Z.filter();for(const e of g){const{accountId:t,searchListId:n,sentDate:i}=e;await y.Z.call(t,n,i).catch((()=>console.warn("Error deleting file. May not exist!",e)))}for(const e of p)await(0,N.MT)(e)}};var M=n(71320),O=n(45709),x=n(26036),L=n(84283),R=n(45660),B=n(47482),F=n(59552),W=n(35458),U=n(13248),V=n(8684);const H="VIVALDI_MAIL_MESSAGES_TRASHED";const G={call:async function(e,t){const n=new Map,i=[],a=[],r=new Map,l=new Set,d=[],c=new Set,u=new Map;function p(e,t,i){const s=n.get(t),{id:o,accountId:a,path:r}=e,l={deleted:i,read:!0,internal:!b.Z.isOnline(a,r)||i};s?s.set(o,l):n.set(t,new Map([[o,l]]))}function h(e,t,n){const{id:i,sources:s}=e;c.add(e),s.forEach(((e,s)=>{let a=e.read?{}:{read:!0};if(t.has(s)){const e=o.Z.get(s);if(!e)throw new Error("Filter not found "+s);const{accountId:t,path:i}=e,r=!b.Z.isOnline(t,i)||n;a={...a,deleted:n,internal:r}}if(Object.keys(a).length>0){const e=u.get(i);e?e.set(s,a):u.set(i,new Map([[s,a]]))}}))}function y(e,t,n){const i=t.find((t=>{const n=e.sources.get(t);return n&&!n.internal}));if(i){const{accountId:t,path:s}=o.Z.get(i),d=[t,s,e.id];a.push({key:d,destinationPath:n});const c=e.sources.get(i);c&&!c.read&&(r.set(e.id,new Map([[i,{read:!0}]])),l.add(e.id))}}const S=new Set;e.forEach((e=>{const{id:s}=e;S.add(s);const a=t.get(s),r=new Map;a&&0!==a.length?(a.forEach((e=>{const t=o.Z.get(e),{accountId:n}=t,i=r.get(n);i?i.push(e):r.set(n,[e])})),r.forEach(((t,a)=>{const r=(0,U.ZA)(a)&&m.Z.getFoldersOfType(a,k.uT);if(r&&r.length>0){const l=new Set;r.forEach((i=>{const{path:r}=i,c=o.Z.getByFolder(a,r),{id:u}=c,g=e.sources.get(u);if(g)if(g.internal)y(e,t,r),g.deleted&&p(c,s,!1);else if(g.deleted){const t=new Set([u]);h(e,t,!1)}else d.push(e);else!function(e,t,i){const s=n.get(t),{id:o,accountId:a,path:r}=e,l={deleted:i,internal:!b.Z.isOnline(a,r)||i,read:!0};s?s.set(o,l):n.set(t,new Map([[o,l]]))}(c,s,!1),y(e,t,r);l.add(u)}));const c=t.filter((e=>!l.has(e)));h(e,new Set(c),!0),c.forEach((t=>{const n=e.sources.get(t),r=o.Z.get(t);if(!r)throw new Error("Filter not found "+t);n.internal||i.push([a,r.path,s]),p(r,s,!0)}))}else h(e,new Set(t),!0)}))):console.warn("No deleteSourceFilterIds for id "+s)}));const w=new Set;if(n.size>0&&(w.add(v.Z.searchList),w.add(v.Z.filteringQueue),w.add(v.Z.filters)),(i.length>0||a.length>0||r.size>0)&&(w.add(v.Z.imap),w.add(v.Z.buffer)),c.size>0&&w.add(v.Z.flaggingQueue),w.size>0){const e=[];await v.Z.transaction("rw",[...w],(async()=>{if(c.size>0){const{sleUpdates:t}=O.Z.setCustomFlags([...c],{},u);e.push(...t)}if(n.size>0){const t=await W.Z.call(n);e.push(...t);const i=new _.RW;n.forEach(((e,t)=>{const n=[...e.keys()];i.add(n,t)}));for(const{filterIds:e,searchListIds:t}of i.batches)C.Z.call({type:"RE_RUN_SLES",priority:k.Un.HIGH,searchListIds:t,filterIds:[...e],folderIds:[[k.of,k.cm]]})}if(r.size>0&&await A.Z.addSourceFlags(r),a.length>0){const e=[];for(const t of a){const{key:n,destinationPath:i}=t,[s,o,a]=n;e.push({accountId:s,path:o,searchListId:a,destinationPath:i})}await A.Z.addCopy(e)}if(i.length>0){const e=[];for(const t of i){const[n,i,s]=t;e.push({accountId:n,path:i,searchListId:s})}await A.Z.addDelete(e)}})),E.Z.filter(),f.Z.flushBuffer(),e.length>0&&s.Z.updateIndex({sleUpdates:e})}return d.length>0&&(e.length===d.length?(0,V.c)({title:(0,g.Z)("Already in trash"),icon:"resources/mail_notification_icon.png",timeout:3e4,tag:H}):(0,V.c)({title:(0,g.Z)("Some were already in trash"),icon:"resources/mail_notification_icon.png",timeout:3e4,tag:H})),{operation:"delete",searchListIds:S,markUnread:l}}};var $=n(307),K=n(67103),z=n(1407),j=n(49168),Y=n(81744),X=n(70752),Q=n(83065),q=n(19842),J=n(86088),ee=n(59275);const te={Red:"#f01",Orange:"#f80",Yellow:"#fd0",Green:"#3c0",Blue:"#08f",Purple:"#a09",Grey:"#666"},ne=new Image;ne.src=`data:image/svg+xml;base64,${btoa(J.nyn.medium)}`;const ie=[k.e9,k.Nz,k.hn,k.Hd,k.uT,k.Oi];function se(e){const t=document.createElement("canvas");t.width=32,t.height=32;const n=t.getContext("2d");return n.drawImage(ne,0,0),n.globalCompositeOperation="source-in",n.fillStyle=te[e],n.fillRect(0,0,32,32),t.toDataURL("image/png").replace("data:image/png;base64,","")}function oe(e,t){e.push(t),t.children&&t.children.forEach((t=>oe(e,t)))}function ae(e,t,n){const o=e.filter((e=>e&&(void 0===n||n(e))));if(0===o.length)return;const{sleUpdates:a,undoItem:r}=t(o);s.Z.updateIndex({sleUpdates:a}),s.Z.pushUndoItem(r);const l=i.Z.getActiveListEntry();if(l){const e=o.find((e=>e.id===l.id));e&&(l.flags=e.flags)}}function re(e){return Boolean(c.ZP.getActivePage(e)?.isMailPage)}function le(e){return u.Z.get(e?P.kMailDeleteInOtherLocations:P.kMailMarkDeleteInOtherLocations)}async function de(e){let t=i.Z.getActiveMessage();if(!t)return;let n=i.Z.getRenderingMethod();"raw"===n&&(n=u.Z.get(P.kMailPreferredRendering));const s=i.Z.getRaw();if(s&&!t.bodyParts){let i=await s.parseMainPart(n);e&&(i=i.concat(await s.parseAttachments())),t={...t,bodyParts:[...i]}}return t}const ce=new class{getSelectedEntries(e,t){const n=(0,q.Rr)(e);let s=[];if(!n){const e=p.Z.get(z.uP);if(!e)return s;e.selectedIds.forEach((e=>{const n=o.Z.getListEntry(e.id);n&&(t?oe(s,n):s.push(n))}))}if(!s.length||n){const e=i.Z.getActiveListEntry();if(e){const t=o.Z.getListEntry(e.id);t&&(s=[t])}}return s}markSelected(e,t,n){ae(this.getSelectedEntries(e),t,n)}enableThreadedView(e){if(!re(e))return;const t=this.getSelectedEntries(e);t&&t.length>0&&t[0]&&s.Z.selectThread(t[0])}enableCorrespondentView(e,t){if(re(e))if(t)s.Z.selectContactByAddress(e,t);else{const t=i.Z.getActiveMessage(),n=l.Z.getSelectedFolder();if(t&&n){const i=b.Z.getFolderType(n.accountId,n.path),{from:o,to:a,cc:r,bcc:l=[]}=t,d=i===k.Nz?a[0]||r[0]||l[0]:o[0];d&&d.address&&s.Z.selectContactByAddress(e,d.address)}}}enableContactView(e,t,n){re(e)&&(n?s.Z.selectContactByIdAndAddress(e,t,n):s.Z.selectContactById(e,t))}setActiveMailDetail(e){h.Z.dispatch({actionType:"MAIL_SET_ACTIVE_COMPONENT",mailDetail:e})}setActiveMessage(e){h.Z.dispatch({actionType:"MAIL_SET_ACTIVE_MESSAGE",message:e})}markAsReadAndGoToNextUnread(e){re(e)&&(ce.markRead(e),h.Z.dispatch({actionType:"MAIL_GOTO_UNREAD"}))}goToNextUnread(e){re(e)&&h.Z.dispatch({actionType:"MAIL_GOTO_NEXT_UNREAD"})}goToPreviousUnread(e){re(e)&&h.Z.dispatch({actionType:"MAIL_GOTO_PREVIOUS_UNREAD"})}openMessage=e=>{const t=i.Z.getActiveListEntry(),n=i.Z.getActiveMessage();if(!t||!n)return;const s=M.Z.getByIds(t.sourceFilterIds);if(s.some((e=>e.accountId===k.of&&(e.path===k.Wb||e.path===k.J8))))return r.Z.open(n,t.threadKey);const o=b.Z.getFolderTypes(s),a=o.has(k.kY);if(o.has(k.Nz)||a)return ce.createDraft();(0,$.Z)(e,n)};clearIfActive(e){setTimeout((()=>{h.Z.dispatch({actionType:"MAIL_CLEAR_IF_ACTIVE",mailDetail:e})}),100)}refreshActiveMessage=()=>{h.Z.dispatch({actionType:"MAIL_REFRESH_ACTIVE_MESSAGE"})};async createDraft(){const e=await de(!0);e&&r.Z.createDraftFromParsedMessage(e)}async reply(){const e=await de(!1);e&&await r.Z.reply(e)}async replyAll(){const e=await de(!1);e&&await r.Z.replyToAll(e)}async replyList(){const e=await de(!1);e&&await r.Z.replyToList(e)}async forward(){const e=await de(!0);e&&await r.Z.forward(e)}markRead(e){re(e)&&this.markSelected(e,(e=>O.Z.setRead(e,!0)))}markUnread(e){re(e)&&this.markSelected(e,(e=>O.Z.setRead(e,!1)))}markThreadRead(e){if(!re(e))return;ae(this.getSelectedEntries(e,!0),(e=>O.Z.setRead(e,!0)))}markThreadUnread(e){if(!re(e))return;ae(this.getSelectedEntries(e,!0),(e=>O.Z.setRead(e,!1)))}markFlagged(e){this.markSelected(e,(e=>O.Z.setFlagged(e,!0)),(e=>!(0,j.u9)(e)))}markUnflagged(e){this.markSelected(e,(e=>O.Z.setFlagged(e,!1)),(e=>(0,j.u9)(e)))}setCustomFlags(e,t){this.markSelected(e,(e=>O.Z.setCustomFlags(e,t,new Map)))}async prepareDelete(e,t,n,i){const s=n||this.getSelectedEntries(e);let a;if(a=t?s.some((e=>e.sources.size>1)):s.some((e=>[...e.sources.entries()].filter((([e,t])=>!L.Z.isSourceDeleted(e,t))).length>1)),a||i){const a=l.Z.getSelectedFolder();if(!a)return void R.Z.warn("Mail",["prepareDelete"],"No folder selected");const{accountId:r,path:c=k.ym,type:u}=a,p=u===k.Nz,h=function(e){let t=0;for(const n of e)for(const[e,i]of[...n.sources.entries()]){const{accountId:n,path:s}=o.Z.get(e);b.Z.getFolderType(n,s)===k.Nz||i.deleted||++t}return t}(s);if(p||h<=1&&!i);else{const i=o.Z.getByFolderId([r,c]),a=s.some((e=>e.sources.has(i.id))),l=le(t);if(a){if("ask"===l){const n=new Set,o=new Set;for(const{sources:e}of s){const t=M.Z.getByIds([...e.keys()]);for(const{accountId:e,path:s}of t)n.add(e),i.accountId===e&&o.add(s)}const a=n.size>1,r=o.size>1,l=a||r||t;if(l)return void d.Z.showMailDeleteDialogSetting(e,{entries:s,deletePermanently:t,showSelected:l,showFolders:r,showAccounts:a})}}else{if(n)return void d.Z.showMailDeleteDialogConfirmAll(e,{entries:s,deletePermanently:t});if(s.length>1){if(["selected","folders","ask"].includes(l))return void d.Z.showMailDeleteDialogConfirmAll(e,{entries:s,deletePermanently:t})}else{if("selected"===l)return void d.Z.showMailDeleteDialogFolders(e,{entries:s,deletePermanently:t});if(["folders","ask"].includes(l)){const n=new Set;if(s[0].sources.forEach(((e,t)=>{if(!L.Z.isSourceDeleted(t,e)){const e=M.Z.get(t);if(!e)throw new Error("Filter not found "+t);n.add(e.accountId)}})),n.size>1)return void d.Z.showMailDeleteDialogAccounts(e,{entries:s,deletePermanently:t})}}}}}await this.delete(e,s,t)}async delete(e,t,n,i={}){const{setting:a,accountIds:d,sourceFilterIds:c}=i,u=a||le(n),p=new Map,h=l.Z.getSelectedFolder();if(!h)return void console.warn("No folder selected");const{accountId:g,path:m=k.ym}=h,f=o.Z.getByFolderId([g,m]),v=f&&t.some((e=>e.sources.has(f.id))),y=l.Z.isSentFolderSelected();if(t.forEach((e=>{const t=[];e.sources.forEach(((e,i)=>{if(!n&&L.Z.isSourceDeleted(i,e))return void R.Z.log("Mail",["delete"],`No need to re-delete - sourceFilterId: ${i}`);if(!function(e,t,n){const{accountId:i,path:s}=o.Z.get(t),a=b.Z.getFolderType(i,s);return e.deleted||a===k.Nz===n}(e,i,y))return void R.Z.log("Mail",["delete"],`Will not delete from sent unless Sent folder is selected - isSentSelected: ${y.toString()} - sourceFilterId: ${i}`);const s=o.Z.get(i);if(s)return d||c?d&&!d.get(s.accountId)?void R.Z.log("Mail",["delete"],`Accounts selected to delete from do not match filter - sourceFilterId: ${s.id}`):c&&!c.get(i)?void R.Z.log("Mail",["delete"],`Folders selected to delete from do not match filter - sourceFilterId: ${i}`):void t.push(i):void("selected"===u&&v?f?.id===i?t.push(i):R.Z.log("Mail",["delete"],`filter not found - selectedFilter: ${f?f.id:"undefined"} - sourceFilterId: ${i}`):"folders"===u&&v?s.accountId===g?t.push(i):R.Z.log("Mail",["delete"],`filter not found -  source accountId: ${s.accountId} - selected accountId: ${g} - sourceFilterId: ${i}`):t.push(i));R.Z.log("Mail",["delete"],`sourceFilter not found! sourceFilterId: ${i}`)})),t.length>0&&p.set(e.id,t)})),0===p.size)return void R.Z.log("Mail",["delete"],"Nothing to delete");const S=t.filter((e=>p.has(e.id)));if(S.forEach((t=>{r.Z.closeComposer(e,t.id)})),S.length>0)if(n)D.call(S,p);else{const e=await G.call(S,p);s.Z.pushUndoItem(e)}}undelete(e){const t=this.getSelectedEntries(e);(0,K.Z)(t)}getMoveToFolderMenu=e=>{const t=this.getSelectedEntries(e),n=t.map((e=>{const t=[];return e.sources.forEach(((e,n)=>{e.deleted||t.push(n)})),t}));if(0===n.length)return[];const i=n.reduce(((e,t)=>e.filter((e=>t.includes(e)))));let s=[];if(M.Z.getByIds(i).forEach((e=>{const{accountId:t,path:n}=e,i=b.Z.getFolderType(t,n);m.Z.isMailAccount(t)&&ie.includes(i)&&s.push([t,n])})),0===s.length){return[{...1===t.length?(0,x.Z)("Can not move from this folder."):(0,x.Z)("No common folder. Can not move this selection."),isEnabled:()=>!1,mnemonic:!1}]}let o=!1;const a=l.Z.getSelectedFolder();if(a){const e=s.find((([e,t])=>e===a.accountId&&t===a.path));e&&(s=[e],o=!0)}const r=m.Z.getAccounts(),d=[];return s.forEach((([n,i])=>{const s=m.Z.getFolderName(n,i);let a=[];for(const e of ie)a.push(...b.Z.getPathsByType(n,e));if(a=a.filter((e=>e!==i)),a.length>0){const l=a.map((s=>{const o=(0,Q.kF)(s);return{handler:()=>(0,F.Z)(e,t,[{accountId:n,path:i}],n,s),label:(0,ee.e)(o),labelEnglish:o}})),c=[];for(const s in r)if(s!==n){const o=r[s].folders;for(const a in o)for(const r of o[a].sort(((e,t)=>e.name.localeCompare(t.name)))){const o=r.path;if(ie.includes(a)){const a=m.Z.getFolderName(s,o);c.push({handler:()=>(0,F.Z)(e,t,[{accountId:n,path:i}],s,o),label:`${s}/${(0,ee.e)(a)}`,labelEnglish:`${s}/${a}`})}}}if(o)d.push(...l,...c);else{const e=l.concat(c);d.push({items:e,label:(0,g.Z)("Move from $1 to",[n+"/"+(0,ee.e)(s)]),labelEnglish:`Move from ${n}/${s} to ...`})}}})),d};getCustomLabelsMenu=(e,t)=>{const n=o.Z.getByAccountId(k.ut).sort(j.jp),i=[];let s=!1;return n.forEach((n=>{!s&&n.path.startsWith("$labelviv")&&i.length>0&&(i.push({type:"separator",label:"",labelEnglish:""}),s=!0),i.push({type:"checkbox",checked:t.indexOf(n.path)>-1,handler:this.toggleLabel(e,n.path,t),...(0,x.Z)((0,Y.X)(n.name))})})),i};clearAllLabels=(e,t)=>{const n=Object.fromEntries(t.map((e=>[e,!1])));this.setCustomFlags(e,n)};toggleLabel=(e,t,n)=>()=>{const i=-1===n.indexOf(t);this.setCustomFlags(e,{[t]:i})};setLabel=(e,t)=>{this.setCustomFlags(e,{[t]:!0})};setLabels=(e,t)=>{this.setCustomFlags(e,t)};getReplyMenu=()=>[{type:"command",handler:()=>this.replyList(),label:(0,g.Z)("Reply to Mailing List"),labelEnglish:"Reply to Mailing List"},{type:"command",handler:()=>this.replyAll(),label:(0,g.Z)("Reply All"),labelEnglish:"Reply All"}];getStandardFlagsMenu=(e,t)=>{const n=[];for(const i of O.Z.getStandardFlagList()){let s=se(i);i===k.T4.CLEAR_FLAGS&&(n.push({type:"separator",label:"",labelEnglish:""}),s=void 0),n.push({type:"checkbox",checked:i===t,handler:()=>this.toggleStandardFlag(e,i,t),label:(0,X.M)(i),labelEnglish:i,iconPNG:s,iconPNGWhite:s})}return n};toggleStandardFlag=(e,t,n)=>{const i=n===t?(0,j.KR)(k.T4.CLEAR_FLAGS):(0,j.KR)(t);this.setCustomFlags(e,i)};async _updateFlags(e,t){const n=e.map((e=>({searchListId:e.id})));await B.Z.call(n,t),e.forEach((e=>{const n=(0,j.hY)(e.flags,t);s.Z.updateIndex({sleUpdates:[{id:e.id,updates:{flags:n}}]})}));const i=e.map((e=>e.id));await A.Z.addImapFlags(i,t)}setStandardFlag=(e,t)=>{const n=(0,j.KR)(t);this.setCustomFlags(e,n)};async markAsJunk(e){const t=this.getSelectedEntries(e);await a.Z.moveToJunk(t)}async markAsNotJunk(e){const t=this.getSelectedEntries(e);await a.Z.restoreFromJunk(t)}async clearJunkFlags(e,t,n){const i=n?t:t.filter((e=>[...e.flags].some((e=>e===k.T4.JUNK)))),s={[k.T4.JUNK]:!1,[k.T4.NOT_JUNK]:!0,Junk:!1};i.length>0&&await this._updateFlags(i,s)}async clearDeletedFlags(e,t){const n=t.filter((e=>[...e.flags].some((e=>e===k.T4.DELETED)))),i={[k.T4.DELETED]:!1};n.length>0&&await this._updateFlags(n,i)}moveToArchive(e){const t=this.getSelectedEntries(e);a.Z.moveToArchive(t)}restoreFromArchive(e){const t=this.getSelectedEntries(e);a.Z.restoreFromArchive(t)}},ue=ce},59720:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var i=n(33638);const s=new class{setActiveWebView(e,t){i.Z.dispatch({actionType:"WEBVIEW_SET_ACTIVE",windowId:e,component:t})}clearIfActive(e,t){i.Z.dispatch({actionType:"WEBVIEW_CLEAR_IF_ACTIVE",windowId:e,component:t})}}},48603:(e,t,n)=>{"use strict";n.d(t,{Z:()=>j});var i=n(27770),s=n(68247),o=n(29087),a=n(96098),r=n(92292),l=n(7064),d=n(89175);const c="[bookmark update]",u=function(){return new Promise((e=>{l.Z.bookmarksPrivate.updatePartners(((t,n,i)=>{r.Z.runtime.lastError&&(console.warn(c,"failed to call vivaldi.bookmarksPrivate.updatePartners:",r.Z.runtime.lastError.message),t=!1,n=!1),e([t,n,i])}))}))},p=function(e){const t=function(e,n){for(let i=0;i<e.length;i++){const s=e[i];s.url&&(s.partner?console.warn(c,"partner id in bookmark tree without version:",s.partner,s.url):n.set(s.url,s.id)),s.children&&t(s.children,n)}};return Promise.all([new Promise((e=>{r.Z.bookmarks.getTree((t=>{r.Z.runtime.lastError&&console.warn(c,"failed to call chrome.bookmarks.getTree:",r.Z.runtime.lastError.message),e(t)}))})).then((e=>{const n=new Map;return e&&t(e,n),n})),fetch("./default-bookmarks/fallback-partner-ids.json",{method:"GET"}).then((e=>e.json())).then((t=>{let n=t[e];return n||(n=t[a.Z.getFallbackLocale()]),n}))]).then((([e,t])=>{const n={numMatch:0,size:0};return t?Promise.all(function*(e,t,n){const i=Object.keys(t);e:for(const s of i){const i=t[s];n.size+=1;for(const t of i){const i=e.get(t);if(i){console.warn(c,"Match",s,t),n.numMatch+=1,yield new Promise((e=>{r.Z.bookmarks.update(i,{partner:s},(()=>{r.Z.runtime.lastError&&console.warn(c,"failed to update partner:",s,r.Z.runtime.lastError.message),e()}))}));continue e}}console.warn(c,"No match for",s,i.join(" "))}}(e,t,n)).then((()=>n)):n})).then((e=>{console.warn(c,"Urls matched",e.numMatch,"of",e.size)}))},h={init:()=>u().then((([e,t,n])=>t?p(n).then((()=>(s.Z.set(d.kBookmarksVersion,"0"),u().then((([e])=>e))))):e)).catch((e=>(console.warn(c,"error while updating bookmarks:",e),!1))).then((e=>(e||console.warn(c,"failed to update bookmarks, current version:",o.Z.get(d.kBookmarksVersion)),e)))};var g=n(59486),m=n(96951),f=n(57049),v=n(33638),y=n(56371),b=n(28773),S=n(30381),w=n.n(S),C=n(58379),A=n(35369),I=n(30460),T=n(44850),Z=n(59322);const E=f.t;let k=!0,_=!0;function N(){k=!0}function P(){k=!1,x()}function D(){v.Z.dispatch({actionType:"BOOKMARKS_SET_BATCH_MODE",edit:!0})}function M(){v.Z.dispatch({actionType:"BOOKMARKS_SET_BATCH_MODE",edit:!1})}function O(e){const t=[],n=[];for(const i of e)n.push(i.url),t.push({...i,faviconUrl:void 0,partner:""});if(!o.Z.get(d.kDashboardTopSitesHideSuggestions))for(const e of E){if(t.length>=10)break;n.includes(e.url)||t.push({...e,partner:e.url})}return t}async function x(e=!1){const t=fetch("./default-bookmarks/partners.json").then((e=>e.json())).catch((()=>(console.warn("Failed to load partner bookmarks"),{bookmarks:[],folders:[]}))),[n,i,s,o]=await Promise.all([r.Z.bookmarks.getTree(),t,l.Z.bookmarksPrivate.getFolderIds(),(0,C.Z)().then(O)]);v.Z.dispatch({actionType:"BOOKMARKS_INIT",bookmarks:n,folderIds:s,topSites:o,failedUpgrade:e,partnerDB:i})}function L(e,t){k||v.Z.dispatch({actionType:"BOOKMARKS_ADD_ITEM",id:e,changes:t})}function R(e,t){k||v.Z.dispatch({actionType:"BOOKMARKS_CHANGE_ITEM",id:e,changes:t})}function B(e,t){k||v.Z.dispatch({actionType:"BOOKMARKS_MOVE_ITEM",id:e,changes:t})}function F(e){v.Z.dispatch({actionType:"BOOKMARKS_REMOVE_ITEM",id:e})}function W(e,t){k||x()}function U(e,t){if(k)return;g.Z.getItemById(e)&&v.Z.dispatch({actionType:"BOOKMARKS_CHANGE_ITEM",id:e,changes:{faviconUrl:t}})}function V(e,t){k||v.Z.dispatch({actionType:"BOOKMARKS_CHANGE_ITEM",id:e,changes:t})}function H(){!1===_&&(_=!0,l.Z.bookmarksPrivate.onFaviconChanged.removeListener(U))}function G(){!0===_&&(_=!1,l.Z.bookmarksPrivate.onFaviconChanged.addListener(U))}async function $(e){const t=(0,m.NK)(e.pages).map((e=>({page:"group"===e.type?void 0:e.page,url:"group"===e.type?void 0:e.page.url,title:"group"===e.type?e.page?.vivExtData.fixedGroupTitle??(0,y.Z)("Stack"):e.page?.vivExtData.fixedTitle??(0,T.D1)(e.page),children:"group"===e.type?e.pages.map((e=>({page:e,url:e.url,title:(0,T.D1)(e)}))).toArray():void 0}))).filter((e=>e.children||e.url));if(!t.size)return;const{parentId:n,index:i}=e;if(1!==t.size||e.forceFolder){if(e.isStack){return await Promise.all(t.map((async({children:e,title:t})=>{if(!e?.length)return"";const i=await r.Z.bookmarks.create({parentId:n,title:t});return await z.createBookmarks(e,i.id,0,"none"),i.id}))).then((e=>e.filter(Boolean)[0]))}{const s={parentId:n,..."number"==typeof i?{index:i}:null},o=await r.Z.bookmarks.create(s),a=w()(o.dateAdded).format("YYYY-MM-DD, HH:mm:ss"),l=e.isSelection?(0,y.Z)("Saved Tab Selection ($1)",[a]):(0,y.Z)("Saved Tabs ($1)",[a]);return await r.Z.bookmarks.update(o.id,{title:l}),await Promise.all(t.map((async e=>{const{children:t,title:n,url:i}=e;if(t?.length){const e=await r.Z.bookmarks.create({parentId:o.id,title:n});await z.createBookmarks(t,e.id,0,"none")}else await r.Z.bookmarks.create({parentId:o.id,title:n,url:i})}))),o.id}}{const{children:e,title:s,page:o}=t.first();if(e?.length){const t={parentId:n,title:s,..."number"==typeof i?{index:i}:null},o=await r.Z.bookmarks.create(t);return await z.createBookmarks(e,o.id,0,"none"),o.id}return o&&!e?z.bookmarkPageInFolder(o,n,i):void 0}}function K({clipboardData:e},t,n){e&&(t=g.Z.validateForClipboard(t),e.setData("vivaldi/x-cut",n),e.setData(i.yR,JSON.stringify(t)),e.setData("text/plain",g.Z.getDragData("text/plain",t)))}const z=new class{loadPromise=()=>h.init().then((e=>x(!e))).then((()=>{k=!1,_=!1,r.Z.bookmarks.onImportBegan.addListener(N),r.Z.bookmarks.onImportEnded.addListener(P),r.Z.bookmarks.onChanged.addListener(R),r.Z.bookmarks.onCreated.addListener(L),r.Z.bookmarks.onRemoved.addListener(F),r.Z.bookmarks.onMoved.addListener(B),r.Z.bookmarks.onChildrenReordered.addListener(W),l.Z.bookmarkContextMenu.onOpen.addListener(H),l.Z.bookmarkContextMenu.onClose.addListener(G),l.Z.menubarMenu.onOpen.addListener(H),l.Z.menubarMenu.onClose.addListener(G),l.Z.bookmarksPrivate.onFaviconChanged.addListener(U),l.Z.bookmarksPrivate.onMetaInfoChanged.addListener(V),l.Z.utilities.onTopSitesChanged.addListener(this.setTopSites)}));setTopSites=async()=>{v.Z.dispatch({actionType:"BOOKMARKS_SET_TOPSITES",topSites:O(await(0,C.Z)())})};setBookmarkBarFolderAndToggleVisibility(e){const t=g.Z.getBookmarkBarFolderId()!==e||!o.Z.get(d.kBookmarksBarVisible);return z.setBookmarkBarFolder(e).then((e=>{e&&s.Z.set(d.kBookmarksBarVisible,t)}))}setBookmarkBarFolderAndShow(e){return z.setBookmarkBarFolder(e).then((e=>{e&&s.Z.set(d.kBookmarksBarVisible,!0)}))}async setBookmarkBarFolder(e){const t=g.Z.getItemById(e);if(!t||!g.Z.isFolder(t))return!1;const n=g.Z.getBookmarkBarFolderId();if(n===e)return!0;D();try{void 0!==n&&n!==g.Z.getRootId()&&await r.Z.bookmarks.update(n,{bookmarkbar:!1}),await r.Z.bookmarks.update(e,{bookmarkbar:!0})}catch(e){console.warn(`BookmarkActions: Failed to set bookmark bar folder: ${e}`)}finally{M()}return!0}addSpeeddialGroup(e){g.Z.isFolder(e)&&(r.Z.bookmarks.update(e.id,{speeddial:!0}),s.Z.set(d.kStartpageSpeedDialOrder,o.Z.get(d.kStartpageSpeedDialOrder).concat([e.id])))}removeSpeeddialGroup(e){g.Z.isFolder(e)&&(r.Z.bookmarks.update(e.id,{speeddial:!1}),s.Z.set(d.kStartpageSpeedDialOrder,o.Z.get(d.kStartpageSpeedDialOrder).filter((t=>t!==e.id))))}setActiveGroup(e,t){v.Z.dispatch({actionType:"BOOKMARKS_SET_ACTIVE_GROUP",windowId:e,id:t})}setCutIds=e=>{v.Z.dispatch({actionType:"BOOKMARKS_SET_CUT_IDS",ids:e})};installTopSites(){v.Z.dispatch({actionType:"BOOKMARKS_INSTALL_TOPSITES"})}async move(e,t,n){const i=g.Z.validateForDrag(e).map((e=>g.Z.getItemById(e)?.id)).filter(Boolean);D();const s=await function(e,{parentId:t,index:n}){return e.reduce((async(e,i)=>{const s=await e,o=s[s.length-1]?.index,a=await r.Z.bookmarks.move(i,{parentId:t,index:void 0!==o?o+1:n});return s.push(a),Promise.resolve(s)}),Promise.resolve([]))}(i,{parentId:t,index:n});return M(),s.map((e=>e.id))}reorder(e,t){return e=g.Z.validateForDrag(e),D(),Promise.all(e.reverse().map((e=>r.Z.bookmarks.move(e,{parentId:t,index:0}).then((e=>e.id))))).then((e=>(M(),e)))}async duplicate(e,t,n){const i=structuredClone(e.map((e=>g.Z.getItemById(e))).filter((e=>e&&!e.trash)).filter(Boolean));D();const s=await Promise.all(i.map((async e=>{const{title:i,url:s,description:o,nickname:a,children:l}=e,d=await r.Z.bookmarks.create({index:n++,parentId:t,title:i,...(0,b.Z)(s?{url:s}:null),...(0,b.Z)(o?{description:o}:null),...(0,b.Z)(a?{nickname:a}:null)});if(!d)throw new Error("Bookmark was not created");if(l?.length){const e=l.map((({id:e})=>e));await this.duplicate(e,d.id,0)}return d.id})));return M(),s}async createWithPromise(e,t,n){D();const i=await Promise.all(e.map((async e=>{if(e.separator)return this.createSeparator(t,void 0===n?void 0:n++);const i=await r.Z.bookmarks.create({title:e.title,url:e.url||(e.children?void 0:I.p),parentId:t,description:e.description,nickname:e.nickname,index:void 0===n?void 0:n++});return e.children?.length&&await z.createWithPromise(e.children,i.id,0),i})));return M(),i}createSeparator(e,t){return r.Z.bookmarks.create({title:"---",url:I.p,parentId:e,description:"separator",nickname:"",index:t})}async createBookmarks(e,t,n,i){if(D(),"none"!==i){const e={parentId:t,..."number"==typeof n?{index:n}:null},s=await r.Z.bookmarks.create(e),o=w()(s.dateAdded).format("YYYY-MM-DD, HH:mm:ss");let a;switch(i){case"history":a=(0,y.Z)("Saved History ($1)",[o]);break;case"sync":a=(0,y.Z)("Saved Synced Tabs ($1)",[o])}a&&await r.Z.bookmarks.update(s.id,{title:a}),t=s.id}const s=await Promise.all(e.map((({url:e,title:i})=>r.Z.bookmarks.create({parentId:t,url:e,title:i,index:n++}).then((({id:e})=>e)))));return M(),s}remove=e=>(D(),Promise.all(e.map((e=>{const t=g.Z.getItemById(e);return t&&g.Z.isFolder(t)&&t.id===o.Z.get(d.kBookmarksSaveFolder)&&s.Z.set(d.kBookmarksSaveFolder,g.Z.getRootId()),t&&g.Z.isFolder(t)?r.Z.bookmarks.removeTree(e).catch((()=>console.warn(`Error removing bookmark tree: ${e}`))):r.Z.bookmarks.remove(e).catch((()=>console.warn(`Error removing bookmark: ${e}`)))}))).then((()=>M())));async emptyTrash(){!1===await new Promise((e=>{l.Z.bookmarksPrivate.emptyTrash(e),l.Z.utilities.cleanUnusedImages(0)}))&&console.warn("Empty trash failed.")}bookmarkAllOpenPages(e,t,n){const i=m.ZP.getActiveWorkspace(e);return $({pages:m.ZP.getPages(e,{workspaceId:i}),parentId:t,index:n,isStack:!1,isSelection:!1,forceFolder:!0})}bookmarkPages(e,t,n,i){return $({pages:(0,Z.nq)(e)?e:A.aV.of(e),parentId:n,index:i,isStack:t,isSelection:!0,forceFolder:(0,Z.nq)(e)})}async bookmarkPageInFolder(e,t,n){const{url:i}=e,s=(0,T.D1)(e),{id:o}=await r.Z.bookmarks.create({parentId:t,url:i,title:s,..."number"==typeof n?{index:n}:null});return o}cut(e,t){K(e,t,"true"),z.setCutIds(t),e.stopPropagation(),e.preventDefault()}copy(e,t){K(e,t,"false"),e.stopPropagation(),e.preventDefault()}paste({clipboardData:e},t,n){const s=g.Z.getItemById(t);if(!s||!e)return Promise.resolve({isCut:!1,ids:[]});let o,a;if(g.Z.isFolder(s))o=s.id,!0===n&&s.children?(a=s.children.length,a>0&&s.children[a-1].trash&&a--):a=0;else if(o=s.parentId,a=(s.index||0)+1,void 0===o)return console.log("error","Can not paste, target has no parent"),Promise.resolve({isCut:!1,ids:[]});const r=-1!==e.types.findIndex((e=>e===i.yR))?JSON.parse(e.getData(i.yR)):[];if(0===r.length)return Promise.resolve({isCut:!1,ids:[]});return g.Z.getCutIds().length>0&&"true"===e.getData("vivaldi/x-cut")?z.move(r,o,a).then((e=>(z.setCutIds([]),{isCut:!0,ids:e}))):z.duplicate(r,o,a).then((e=>({isCut:!1,ids:e})))}async onDropEvent(e,t,n,s){if(e.dataTransfer.types.includes(i.yR)){const o=JSON.parse(e.nativeEvent.dataTransfer.getData(i.yR));i.ZP.isCopyModifierPressed(e)||s&&s.disableMove?await z.duplicate(o,t,n):await z.move(o,t,n)}else{const s=await i.ZP.getUrlsFromEventPromise(e,!0);await z.createBookmarks(s,t,n,"none")}}},j=z},15590:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var i=n(27508),s=n(59322),o=n(33638),a=n(92292),r=n(63164);const l={toggleBreakMode:async function(e){const t=!i.Z.getState().isActive;await async function(e,t){const n=t?"mute":"unmute";t&&o.Z.dispatch({actionType:"TOOLTIP_SET",id:null});await s.ZP.setMuting(e,"all",n),o.Z.dispatch({actionType:"BREAKMODE",isActive:t});const i=await a.Z.tabs.query({});await Promise.all(i.map((async e=>e.id&&e.id>=0?(0,r.VN)(e.id,{type:"BREAK_MODE_SET",value:t}):Promise.resolve())))}(e,t)}}},2934:(e,t,n)=>{"use strict";n.d(t,{z:()=>W,ZP:()=>z});var i=n(50522),s=n(51525),o=n(71636),a=n(12442),r=n(15800),l=n(34930),d=n(1712),c=n(46382),u=n(33499),p=n(17673),h=n(68247),g=n(29087),m=n(60331),f=n(33638),v=n(15489),y=n(56371),b=n(92292),S=n(98035),w=n(45660),C=n(28773),A=n(80008),I=n.n(A),T=n(41851),Z=n(7064),E=n(89175);const k={1:[{name:(0,y.Z)("One hour meeting"),ical:"BEGIN:VCALENDAR\nBEGIN:VEVENT\nUID:X-VIV-TEMPLATE-1\nDURATION:PT1H\nBEGIN:VALARM\nACTION:DISPLAY\nDESCRIPTION:\nTRIGGER:-PT15M\nEND:VALARM\nEND:VEVENT\nEND:VCALENDAR\n"},{name:(0,y.Z)("Doctor's appointment"),ical:"BEGIN:VCALENDAR\nBEGIN:VEVENT\nUID:X-VIV-TEMPLATE-2\nDURATION:PT15M\nBEGIN:VALARM\nACTION:DISPLAY\nDESCRIPTION:\nTRIGGER:-PT24H\nEND:VALARM\nEND:VEVENT\nEND:VCALENDAR\n"},{name:(0,y.Z)("calendar","Birthday"),ical:"BEGIN:VCALENDAR\nBEGIN:VEVENT\nUID:X-VIV-TEMPLATE-3\nX-VIV-ALLDAY:TRUE\nRRULE:FREQ=YEARLY;INTERVAL=1\nBEGIN:VALARM\nACTION:DISPLAY\nDESCRIPTION:\nTRIGGER:PT7H\nEND:VALARM\nEND:VEVENT\nEND:VCALENDAR\n"}]};var _=n(24522),N=n(87852),P=n(58228),D=n(47543),M=n(90870),O=n(13289),x=n(58821),L=n(34155);const{getPollResultText:R,validateEventTypes:B,getGeneratedSourceEvent:F}=r.ZP,W=new Set(I().tz.names());function U(){return{title:(0,y.Z)("Change External Event"),body:(0,y.Z)("You’re changing an external event. Changes you make will only show locally and may be overwritten by changes from event organiser."),actions:[{title:(0,y.Z)("Apply Change"),action:"confirm"}],cancelAction:{title:(0,y.Z)("Cancel"),action:"cancel",default:!0}}}function V(e){let t="",n="";switch(e){case"save":t=(0,y.Z)("Change Recurring Event"),n=(0,y.Z)("You’re changing a repeating event. Do you want to change this occurrence only, this and upcoming events or change all events from start?");break;case"trash":t=(0,y.Z)("Delete Recurring Event"),n=(0,y.Z)("You’re deleting a repeating event. Do you want to delete this occurrence only, this and upcoming events or delete all events from start?");break;case"move":t=(0,y.Z)("Reschedule Recurring Event"),n=(0,y.Z)("You’re rescheduling a repeating event. Do you want to change this occurrence only, this and upcoming events or reschedule all events from start by same amount?");break;case"copy":t=(0,y.Z)("Copy Recurring Event"),n=(0,y.Z)("You’re copying a repeating event. Do you want to copy this occurrence only, this and upcoming events or copy all events from start?")}return{title:t,body:n,actions:[{title:(0,y.Z)("Only this Event"),action:"single",default:!0},{title:(0,y.Z)("This and Upcoming"),action:"upcoming"},{title:(0,y.Z)("All Events"),action:"all"}],cancelAction:{title:(0,y.Z)("Cancel"),action:"cancel"}}}function H(e,t){const n={start:0,end:0},i=I()(t.start),s=t.end&&I()(t.end);return e.task?s?t.byDateOnly?(n.start=e.start?I()(e.start).year(i.year()).month(i.month()).date(i.date()).valueOf():t.start,n.end=e.end?I()(e.end).year(s.year()).month(s.month()).date(s.date()).valueOf():t.end||0):(n.start=t.start,n.end=t.end||0):(t.byDateOnly?n.end=e.end?I()(e.end).year(i.year()).month(i.month()).date(i.date()).valueOf():t.start:n.end=t.start,n.start=e.start&&e.end?n.end-(e.end-e.start):0):t.byDateOnly?(n.start=I()(e.start).year(i.year()).month(i.month()).date(i.date()).valueOf(),n.end=s?I()(e.end).year(s.year()).month(s.month()).date(s.date()).valueOf():e.end?n.start+e.end-e.start:0):(n.start=t.start,n.end=t.end||(e.end?n.start+e.end-e.start:0)),t.hasOwnProperty("allDay")&&(n.allDay=t.allDay),n}function G(e,t=!0){return t&&r.ZP.isCalDAV(r.ZP.getAccountAndCalendar(e.calendarId)?.account?.account_type)}function $(e,t,n){n===E.kMailIsTurnedOff&&(t?K.stopAPIChangeListeners():K.startAPIChangeListeners())}const K=new class{#e=!1;async loadEvents(){return K.transformVivaldiEvents(await Z.Z.calendar.getAllEvents())}loadDatabase=async()=>{if(!g.Z.get(E.kMailIsTurnedOff)){const[e,t,n]=await Promise.all([Z.Z.calendar.getAllAccounts(),K.loadEvents(),Z.Z.calendar.getAll(),u.ZP.loadNotifications()]);f.Z.dispatch({actionType:"CALENDAR_INIT",accounts:e,events:t,calendars:n})}};async loadTemplates(){const e=await T.Z.loadTemplatesList();f.Z.dispatch({actionType:"CALENDAR_INIT_TEMPLATES",templates:e})}async loadPromise(){this.loadDatabase(),this.loadTemplates()}transformVivaldiEvents(e){const t=(0,x.EP)()||"",n=I().tz.zone(t);return e.map((e=>{const{start:i,end:s,attachment:o,...a}=e;let l=0,d=0;e.timezone===_.$T||e.allDay?n&&(l=n.utcOffset(i||0)*_.lb,d=n.utcOffset(s||0)*_.lb):e.timezone&&W.has(e.timezone)||(a.timezone=t);const c=i?i+l:0;return{...a,start:c,end:s?s+d:c,attachment:r.ZP.stringToAttachments(o)}}))}async trimExceptions(e,t){const n=e.recurrenceExceptions;if(!n)return;let i=0;e.start&&t.start?i=e.start-t.start:e.end&&t.end&&(i=e.end-t.end);const s=e.start??0;let o=-1/0;const a=(0,D.Qj)(e.rrule);a&&(o=a.options.until?a.options.until.valueOf():a.options.count?a.all().pop().valueOf():1/0);for(const t of n){const{date:n,exception_id:a,parent_event_id:r}=t;a&&r===e.id&&(n+i<s||n+i>o)&&await Z.Z.calendar.deleteEventException(a)}}updateEditState(e,t,n){f.Z.dispatch({actionType:"CALENDAR_EVENT_EDIT",edit:{windowId:e,pageId:t,eventId:n}})}async createEventTemplate(e){const t=await T.Z.saveTemplate("",e);f.Z.dispatch({actionType:"CALENDAR_ADD_TEMPLATE",template:t})}async updateTemplate(e,t){const n=await T.Z.saveTemplate(e,t);f.Z.dispatch({actionType:"CALENDAR_UPDATE_TEMPLATE",templateId:e,template:n})}async removeTemplate(e){await T.Z.deleteTemplate(e),f.Z.dispatch({actionType:"CALENDAR_REMOVE_TEMPLATE",templateId:e})}async createEvent(e,t=!0,n=!0){const s=(0,x.sG)(e),a=i.Z.getCalendars().find((e=>e.id===s.calendarId));if(!a)throw"Can not create event, calendar not found";a.hidden&&K.updateCalendar(a.id,{hidden:!1}),s.syncPending=G(s,t);const r=(0,D.jw)(s.rrule,s.timezone);r&&(s.end_recurring=r);const l=await S.Z.createEvent(s);return n&&f.Z.dispatch({actionType:"CALENDAR_SET_EVENTS",events:[l]}),l.syncPending&&o.Z.createEvent(l),u.ZP.updateAlarmsForEvent(l),l}createEvents(e){if(!e.length)return Promise.resolve({created_count:0,failed_count:0});const t=e.map((e=>{const{exceptionEvents:t,...n}=e;return{...n,syncPending:!1}})).map(x.sG);return S.Z.createEvents(t)}eventToCreateDetails(e){const{alarmId:t,id:n,recurrenceExceptions:i,trash:s,trash_time:o,notifications:a,filteredOut:l,invites:d,attachment:c,recurrenceId:u,...p}=e,h={...p,attachment:r.ZP.attachmentsToString(c),is_template:!1};return h.timezone=h.timezone||(0,x.EP)(),h.notifications=a?.map((e=>({name:e.name,when:e.when}))),h.invites=d?.map((e=>({address:e.address,name:e.name||"",partstat:e.partstat||"NEEDS-ACTION"}))),h}async updateEvent(e,t,n=!1,s){const a={...e},d=i.Z.getEvent(a.id.split(":")[0])??{...a};async function h(e){let t=parseInt(a.id.split(":")[1]);e.start&&!a.start?t+=e.end-e.start:!e.start&&a.start&&(t-=a.end-a.start);let n=0,i=a.rrule??"",s=e.recurrenceExceptions;const o=(0,D.Qj)(i),r=(0,D.jw)(i,a.timezone),l=a.start||a.end;if(o&&t!==l){n=l-t;const a=(0,D.EE)(o.origOptions,n,e);i=(0,D.Ns)({...a,...(0,C.Z)(a.dtstart?{dtstart:new Date((0,x.FL)(a.dtstart).valueOf()+n)}:null)}),e.recurrenceExceptions?.length&&(s=e.recurrenceExceptions.map((e=>({...e,date:e.date+n}))))}let d,c;a.task?(c=e.end+n,d=a.start?c-(a.end-a.start):0):(d=e.start+w,c=d+a.end-a.start);const u={...a,uid:e.uid,id:e.id,start:d,end:c,rrule:i,end_recurring:r,recurrenceExceptions:s};return await K.trimExceptions(u,e),u}let g,m=(0,x.sG)(a);m.id=m.id.split("-")[0],m.syncPending||(m.syncPending=G(m,n));const b=parseInt(m.id.split(":")[1]),w=(a.start||a.end)-b;try{if(K.stopAPIChangeListeners(),r.ZP.isGeneratedRecurringEvent(a)){const e=m.id.split(":")[0],i=r.ZP.getGeneratedSourceEvent(a);switch(t){case"single":if(r.ZP.getBaseEventIfException(m)){const e=i.recurrenceExceptions?.find((e=>e.date===m.recurrenceId))?.exception_event_id;if(!e)throw new Error("Could not find exception event id");m.id=e,m.rrule="",m.recurrenceExceptions=[],g=await S.Z.updateEvent(m),u.ZP.updateAlarmsForEvent(g),m=i}else{const t=K.eventToCreateDetails({...a,calendarId:a.calendarId,start:a.start,sequence:0,rrule:""});g=await K.createEvent(t,!1,!1),m=await S.Z.createException(e,!1,b,g.id)}g.recurrenceId=b;break;case"upcoming":if(!b||!i)throw new Error(`Invalid event id to update, ${m.id}`);const{rrule:t}=i,s=new Date(b),l=(0,D.Qj)(t,i.timezone,i.start);if(!l)throw new Error(`No recurrence on event to update, ${m.id}`);const c=(0,D._v)(l,s,m.timezone);if(!c){m=await h(i);break}const{origOptions:p}=l;let f;if(p.dtstart=p.dtstart&&(0,x.FL)(p.dtstart),p.until=p.until&&(0,x.FL)(p.until),m.rrule){const{rrule:e,start:t,timezone:n}=m;f=(0,D.Qj)(e,n,t)?.origOptions,w&&(f=(0,D.EE)(f,w,i))}const v=(0,D.Zm)({...p,until:c});let y,C;const A=p.count;if(A){const e=v.all().length;y=(0,D.Ns)({...p,count:e});const t=A-e;C=f&&(0,D.Ns)({...f,count:t,dtstart:s})}else y=(0,D.Ns)({...p,until:c}),C=f&&(0,D.Ns)({...f,dtstart:s});const[I,T]=(0,M.Z)(m.recurrenceExceptions??[],(e=>e.date>=b));w&&I.forEach((e=>e.date=e.date+w));const Z=await S.Z.updateEvent({...i,rrule:y});if(r.ZP.isRemoteCalendar(Z.calendarId)&&n){const e={...Z,recurrenceExceptions:T};d?o.Z.updateEvent(e,{originalEvent:d}):o.Z.updateEvent(e)}u.ZP.updateAlarmsForEvent(Z),m.uid=crypto.randomUUID(),m.href="",m.etag="",m.trash||(m.rrule=C,m=await K.createEvent({...K.eventToCreateDetails(m),recurrenceExceptions:I}));const E=await S.Z.updateExceptions(I.map((e=>({exception_id:e.exception_id,parent_event_id:m.id,date:e.date}))));if(E){m=E;for(const e of I)e.exception_event_id&&S.Z.updateEvent({id:e.exception_event_id,uid:m.uid})}return await this.trimExceptions(m,a),m;default:if(!i)throw new Error(`Source event for ${a.id} not found`);m=await h(i)}}const e=i.Z.getEvents().find((e=>e.id===m.id)),C=r.ZP.isOwnEvent(m),A=r.ZP.shouldIncrementSequence(m,e);if(C&&A){const{sequence:e}=m;m.sequence=e?e+1:1}let I=[];if(m.trash||(!async function(e){const t=e.notifications||[];if(!e.id)throw new Error("Can not save event reminders, invalid event Id.");const n=p.Z.getState().notifications.filter((t=>t.event_id===e.id)),[i,s]=(0,M.Z)(t,(e=>!e.id)),o=n.filter((e=>!s.some((t=>t.id===e.id)))),a=i.filter((e=>!s.some((t=>e.when===t.when))));for(const t of a)await u.ZP.createNotification({event_id:e.id,when:t.when,period:t.period||0,delay:t.delay||0,name:t.name||"",description:t.description||""},e);for(const t of s)await u.ZP.updateNotification(t,e);for(const e of o)await u.ZP.deleteNotification(e)}(m),(A||e?.title!==m.title||e?.description!==m.description||e?.location!==m.location)&&(I=await async function(e,t,n,i=!1){if(!(t.invites&&0!==t.invites.length||n?.invites&&0!==n.invites.length))return[];if(!t.invites||!e)throw new Error("Missing invites from draft or invalid event Id");const s=n?.invites??[],o=(0,O.Z)(t.invites,s,"address"),a=(0,O.Z)(s,t.invites,"address"),l=(0,O.Z)(s,a,"address");for(const t of o)await Z.Z.calendar.createInvite({event_id:e,name:t.name||"",address:t.address,partstat:t.partstat});for(const e of l){const n=t.invites&&t.invites.find((t=>t.address===e.address));n&&await Z.Z.calendar.updateInvite({id:e.id,address:n.address,name:n.name,partstat:n.partstat})}for(const e of a)await Z.Z.calendar.deleteInvite(e.id);if(r.ZP.isOwnEvent(t)){const e=[];return o.length&&e.push(["create",o]),i&&l.length&&e.push(["update",l]),a.length&&e.push(["cancel",a]),e}return[]}(m.id,m,e,!0))),m.recurrenceExceptions?.length&&w)for(const e of m.recurrenceExceptions){if(!e.exception_id)throw Error("Inconsistent data. Exception missing ID.");await Z.Z.calendar.updateRecurrenceException(e.exception_id,{date:e.date})}let T=await S.Z.updateEvent(m);const E=[T];if(g&&E.push(g),f.Z.dispatch({actionType:"CALENDAR_SET_EVENTS",events:E}),u.ZP.updateAlarmsForEvent(T),n&&I.length&&await l.Z.sendAttendeeMails(s,T,I),n){let i;if(e&&e.calendarId!==T.calendarId)r.ZP.isRemoteCalendar(e.calendarId)&&await o.Z.deleteEvent(e.id),i=r.ZP.isRemoteCalendar(T.calendarId)?await o.Z.createEvent(o.Z.resetEventRemoteData(T)):T;else if(r.ZP.isRemoteCalendar(T.calendarId))try{i=await o.Z.updateEvent(T,{exceptionEvent:g,originalEvent:d})}catch(e){if(!(e instanceof o.t))throw e;{const o=v.ZP.getLastActiveBrowserWindowId(),{action:a}=await c.Z.showModal(o,{modal:{title:(0,y.Z)("Conflict when Saving Event"),body:(0,y.Z)("There is an updated version of the event on the calendar server. Which action do you want to take?"),actions:[{title:(0,y.Z)("Use Local Event"),action:"local"}],cancelAction:{title:(0,y.Z)("Use Server Event"),action:"server",default:!0}}}),r="local"===a?e.local:e.incoming;i=await K.updateEvent(r,t,n,s)}}i&&(T=i)}return T}finally{K.startAPIChangeListeners()}}showAddEvent(e,t,n){K.addEventCommand(e,r.ZP.minimalCreateEvent({title:t,url:n}))}async addEventCommand(e,t){t.task||t.start||(t.start=(0,x.zX)(Date.now())),t.url?.startsWith("data:")&&(t.url=""),K.updateEditState(e,N.W$,""),c.Z.showCalendarEditEvent(e,t)}async pollAllCalDAVAccountsWithStatus(){const e=await K.pollAllCalDAVAccounts();m.Z.setStatus(v.Ex,R(e),6e3)}async pollAllCalDAVAccounts(e){const t=i.Z.getState().accounts.filter((e=>e.url)).map((e=>e.id)),n={didPoll:!1,calendars:[],message:"",error:!1};if(0===t.length)return n.didPoll=!0,n;const s=i.Z.getState().calendars.filter((e=>t.some((t=>t===e.accountId)))).filter((e=>e.active)).map((e=>e.lastChecked)).filter(Boolean).reduce(((e,t)=>t>e?t:e),0)+6e4<=Date.now();return e&&!s?n:await o.Z.pollCalDAV(t)}async saveEvent(e,t,n){if(!e)return{clearDraft:!1};const i=v.ZP.getLastActiveBrowserWindowId();if(!r.ZP.doesCalendarsExistsAndShowWarning(i))return{clearDraft:!1};e.calendarId||(e.calendarId=r.ZP.getDefaultCalendar(e.task)?.id||""),e.id=e.id.split("-")[0],e.task&&(e.invites=[]);const s=r.ZP.shouldSaveEvent(e,t);if("IGNORE"===s||"DELETE"===s&&!e.id)return{clearDraft:!0};if("DELETE"===s){return{clearDraft:await K.trashEvent(e.id)}}if(!e.id){const t=await K.createEvent(B(K.eventToCreateDetails(e)));let i="sent";return t?.invites?.length&&(i=await l.Z.sendAttendeeMails(n,t,[["create",t.invites]])),{clearDraft:"edit"!==i,event:t}}{if("SAVE_INVITED"!==s&&!r.ZP.isOwnEvent(e)){const{action:e}=await c.Z.showModal(i,{modal:U()});if("cancel"===e)return{clearDraft:!0}}let o="all";if(t&&r.ZP.isRecurringEvent(t)){const{action:e}=await c.Z.showModal(i,{modal:V("save")});o=e}if("all"===o||"upcoming"===o||"single"===o){return{clearDraft:!0,event:await K.updateEvent(e,o,!0,n)}}}return{clearDraft:!0}}async moveEvent(e,t,n){const s=i.Z.getEvent(e);if(!s)return;const o=v.ZP.getLastActiveBrowserWindowId();if(!r.ZP.isOwnEvent(s)){const{action:e}=await c.Z.showModal(o,{modal:U()});if("cancel"===e)return s}const a=H(s,t);!1===t.allDay&&s.allDay&&s.end-s.start===_.hd&&(a.end=a.start+g.Z.get(E.kCalendarDefaultDuration));const l={...s,...a};if(!r.ZP.isRecurringEvent(s))return K.updateEvent(l,"single",!0,n);{const{action:e}=await c.Z.showModal(o,{modal:V("move")});if("all"===e||"upcoming"===e||"single"===e)return K.updateEvent(l,e,!0,n)}}async copyEvent(e,t,n){const s=i.Z.getEvent(e);if(s){const e=H(s,t),i={...s,...e,uid:crypto.randomUUID(),etag:"",href:""},{rrule:o}=s;if(o){const e=v.ZP.getLastActiveBrowserWindowId(),{action:n}=await c.Z.showModal(e,{modal:V("copy")});if("cancel"===n)return;if("single"===n)i.rrule=void 0;else{const e=t.start-s.start,o=F(s),a=(0,D.Qj)(o.rrule,o.timezone,o.start),r=(0,D.EE)(a?.origOptions,e,s);if("upcoming"===n){r.dtstart=new Date(i.start);const e=a?.origOptions.count;if(e){let t=0;const n=(0,x.VV)(new Date(s.start));a?.all(((e,i)=>!(e>=n)||(t=i,!1))),r.count=e-t}}else"all"===n&&a?.origOptions.dtstart&&(r.dtstart=(0,x.FL)(new Date(a.origOptions.dtstart.valueOf()+e)),i.start=r.dtstart?.valueOf()||0,i.end=i.start+s.end-s.start);a?.origOptions.until&&(r.until=(0,x.FL)(new Date(a.origOptions.until.valueOf()+e))),i.rrule=(0,D.Ns)(r)}}const a=l.Z.getOrganizerForEvent(i);i.organizer&&i.organizer!==a&&(i.organizer=a,i.invites=[]);const r=await K.createEvent(K.eventToCreateDetails(i));return r.invites?.length&&await l.Z.sendAttendeeMails(n,r,[["create",r.invites]]),r}}async deleteExceptions(e,t){const n=e.id.split(":")[0],{recurrenceExceptions:i}=e;if(i)for(const e of i){const{exception_id:i,exception_event_id:s,parent_event_id:o,date:a,cancelled:r}=e;!r&&s&&parseInt(s)&&n===o&&(void 0===t?.after||a&&a>=t?.after)&&(void 0===t?.at||a===t?.at)&&await K.deleteEvent(s),i&&Z.Z.calendar.deleteEventException(i)}}async trashEvent(e,t){function n(e){return e.invites?.length&&!1!==t?.sendEmails}async function a(e){K.deleteExceptions(e);const t=await K.updateEvent({...e,trash:!0,syncPending:G(e,!0)},"all");if(t.syncPending){(await o.Z.deleteEvent(e.id)).ok&&await S.Z.updateEvent({id:e.id,syncPending:!1})}if(n(e))if(r.ZP.isOwnEvent(e))await l.Z.sendAttendeeMails(null,e,[["cancel",e.invites??[]]]);else{const t=l.Z.getOrganizerForEvent(e);t&&await s.Z.replyToInvite(v.ZP.getActiveWindowId(),{...K.eventToCreateDetails(e),exceptionEvents:[]},t,t,"DECLINED")}return t}if(!e)return w.Z.debug("Can not delete event, no id given."),!1;const d=i.Z.getEvent(e);try{K.stopAPIChangeListeners();const[s,p]=e.split("-")[0].split(":"),h=parseInt(p),g=i.Z.getEvent(s);if(!g)return!1;let m;if(r.ZP.isRecurringEvent(g)){const u=v.ZP.getLastActiveBrowserWindowId();switch(t?.saveMode??(await c.Z.showModal(u,{modal:V("trash")})).action){case"single":{const t=i.Z.getEvent(e);if(t?.recurrenceId&&K.deleteExceptions(g,{at:t.recurrenceId}),m=await S.Z.createException(s,!0,t?.recurrenceId??h),r.ZP.isRemoteCalendar(m.calendarId)){const e=parseInt(m.sequence)+1,t=await S.Z.updateEvent({id:m.id,sequence:e});o.Z.updateEvent(t,{...(0,C.Z)(d?{originalEvent:d}:null)})}if(n(g)){const{rrule:e,...t}=g;await l.Z.sendAttendeeMails(null,t,[["cancel",g.invites??[]]],!0)}break}case"upcoming":{const{rrule:e,start:t,end:i,timezone:c}=g,u=t||i,p=(0,D.Qj)(e,c,u);if(!p||!u)return!1;const f=(0,D._v)(p,new Date(h));if(!f){a(g);break}const{count:v,...y}=p.origOptions,b=(0,D.Ns)({...y,until:f}),w=parseInt(g.sequence)+1;m=await S.Z.updateEvent({id:s,rrule:b,sequence:w}),K.deleteExceptions(g,{after:f.valueOf()}),n(m)&&await l.Z.sendAttendeeMails(null,m,[["update",m.invites??[]]]),r.ZP.isRemoteCalendar(m.calendarId)&&o.Z.updateEvent(m,{...(0,C.Z)(d?{originalEvent:d}:null)});break}case"all":m=await a(g)}}else m=await a(g);m&&u.ZP.updateAlarmsForEvent(m)}finally{K.startAPIChangeListeners()}return!0}async restoreEvent(e,t){await K.updateEvent({...t,trash:!1},"single",!0,e),t.invites?.length&&await l.Z.sendAttendeeMails(e,t,[["create",t.invites]]),r.ZP.isRemoteCalendar(t.calendarId)&&o.Z.createEvent(t),a.Z.selectEvent(e,{event:t})}createAccount(e){return new Promise(((t,n)=>{Z.Z.calendar.createAccount(e,(i=>{const s=b.Z.runtime.lastError;if(s)return w.Z.error("Calendar",["create","account"],e,new Error(s.message)),n(s.message);if(!["local","ical"].includes(i.account_type)){const e=d.Z.getEmptyLocalAccount();e&&this.deleteAccount(e.id)}g.Z.get(E.kMailIsTurnedOff)&&h.Z.set(E.kMailIsTurnedOff,!1),t(i)}))}))}updateAccount(e){const{id:t,...n}=e;Z.Z.calendar.updateAccount(t,n,(()=>{b.Z.runtime.lastError&&w.Z.error("Calendar",["update","account"],new Error(b.Z.runtime.lastError.message))}))}async updateCalendar(e,t,n=!0){const{account:s}=r.ZP.getAccountAndCalendar(e);return!!s&&(r.ZP.isCalDAV(s.account_type)&&n&&await o.Z.updateCalendar(e,t),(async(e,t)=>new Promise((n=>{Z.Z.calendar.update(e,t,(t=>{const s=b.Z.runtime.lastError;if(s){const t=i.Z.getCalendars().find((t=>t.id===e)),n=t?.description??t?.name??"Calendar not found";w.Z.error("Calendar",["update","calendar"],n,t,new Error(s.message))}n(t)}))})))(e,t))}toggleCalendarVisibility(e){const t=i.Z.getCalendars().find((t=>t.id===e));t&&this.updateCalendar(e,{hidden:!t.hidden},!1)}setDefaultCalendarId(e,t=!1){const n=t?E.kCalendarDefaultTaskCalendarId:E.kCalendarDefaultCalendarId;g.Z.get(n)!==e&&h.Z.set(n,e)}async createCalendar(e,t,n=!1,i=!1){if(!i&&"ical"===t?.account_type)return{result:{status:!1,message:(0,y.Z)("Can not create a calendar in a web calendar account")}};const s=!(!e||!t?.url);if(t&&n&&s){const{status:n,message:i,name:s,ctag:a}=await o.Z.createCalendar(t,e);if(!n)return{result:{status:n,message:i}};e.name=s,e.ctag=a||""}try{e.color||(e.color=r.ZP.getCalendarCreateColor());const t=await Z.Z.calendar.create(e);return{result:{status:!0,message:(0,y.Z)("Success")},calendar:t}}catch(i){return w.Z.error("Calendar",["create","calendar"],i),n&&t&&s&&await o.Z.deleteCalendar(t,e.name),{result:{status:!1,message:i}}}}async deleteAccount(e){const t=i.Z.getAccounts().find((t=>t.id===e));if(!t)return!1;let n;try{n=await Z.Z.calendar.deleteAccount(e),n&&(0,P.l)(t.username,"calendar")}catch(t){throw w.Z.error("Calendar",["delete","account"],e,new Error(t)),t}return n}async deleteCalendar(e,t=!1){const n=i.Z.getAccounts().find((t=>t.id===e.accountId));if(!n)return{status:!1,message:(0,y.Z)("No account found")};const s=!!n.url,a="ical"===n.account_type;if(t&&n&&s&&!a){const t=await o.Z.deleteCalendar(n,e.name);if(!t.status)return t}try{const t=await Z.Z.calendar.delete(e.id);if(a){return{status:await K.deleteAccount(n.id),message:""}}return{status:t,message:""}}catch(t){const n=e.description??e.name;return w.Z.error("Calendar",["delete","calendar"],n,t),{status:!1,message:t}}}async deleteEvent(e){const t=e.split("-")[0].split(":")[0],{notifications:n}=p.Z.getState();n.filter((e=>e.event_id===t)).forEach((e=>{u.ZP.deleteNotification(e)}));try{await Z.Z.calendar.deleteEvent(t)}catch(t){w.Z.error("Calendar",["delete","event"],e,new Error(t.message))}}importEventsDialog=e=>{const t=v.ZP.getLastActiveBrowserWindowId();c.Z.showCalendarImportEvents(t,e)};init(){g.Z.addListener(E.kMailIsTurnedOff,$),K.startAPIChangeListeners(!0),o.Z.calendarServiceStart(),Z.Z.calendar.onIcsFileOpened.addListener(K.importEventsDialog),Z.Z.calendar.onWebcalUrlOpened.addListener(K.importEventsDialog),async function(){const e=g.Z.get(E.kCalendarTemplatesVersion);if(e<1)for(let t=e+1;t<=1;t++)for(const e of k[t])await Z.Z.calendar.createEventTemplate(e.name,e.ical);h.Z.set(E.kCalendarTemplatesVersion,1)}()}startListeners(){K.startAPIChangeListeners(),o.Z.calendarServiceStart()}stopListeners(){o.Z.calendarServiceStop(),K.stopAPIChangeListeners()}startAPIChangeListeners(e=!1){this.#e||g.Z.get(E.kMailIsTurnedOff)||(Z.Z.calendar.onCalendarDataChanged.addListener(K.loadDatabase),e?L.nextTick((()=>K.loadPromise())):K.loadPromise(),u.ZP.startAPIChangeListeners(),this.#e=!0)}stopAPIChangeListeners(){this.#e&&(Z.Z.calendar.onCalendarDataChanged.removeListener(K.loadDatabase),u.ZP.stopAPIChangeListeners(),this.#e=!1)}},z=K},51525:(e,t,n)=>{"use strict";n.d(t,{Z:()=>y});var i=n(43630),s=n(39005),o=n(2934),a=n(50522),r=n(15800),l=n(34930),d=n(98035),c=n(45660),u=n(48868);function p(e,t){return u.Z.messages.update(e,{rsvpState:t})}var h=n(7064),g=n(93513),m=n(34006);function f(e="Undefined"){const t=(a.Z.getEvents()||[]).find((t=>t.uid===e&&!t.trash));if(!t)throw new Error(`Event with uid "${e}" not found.`);return t}function v(e){const{exceptionEvents:t,...n}=e;return o.ZP.createEvent(n)}const y=new class{async replyToInvite(e,t,n,o,c,u){if("DECLINECOUNTER"===c)throw new Error(`Can not reply to invite with method ${c}`);t=function(e,t,n,i){const s=e.invites?.find((e=>e.address===t));if(!s)throw new Error("Attendee not found");return t===n?s.partstat=i:e.invites?.push({...s,address:n,partstat:i}),e}(t,n,o,c);const y="ACCEPTED"===c||"TENTATIVE"===c;let b;try{b=f(t.uid)}catch(e){}let S,w=!1;if(b)if(w="ical"===r.ZP.getAccountAndCalendar(b.calendarId)?.account?.account_type,u?.value){const e=(0,m.Uq)(u),i=b.recurrenceExceptions?.find((t=>t.date===e));if(!i&&y){const n=await v(t);d.Z.createException(b.id,!1,e,n.id),b=n}else if(i?.exception_event_id){const e=a.Z.getEvent(i.exception_event_id);if(!e)throw new Error("Database inconsistency. Exception event not found.");!async function(e,t,n,i){const{invites:s}=e,o=s?.findIndex((e=>e.address===t));if(!s||"number"!=typeof o||-1===o)throw new Error("Attendee not found");if(t===n){const{event_id:t,...n}=s[o],a=await h.Z.calendar.updateInvite({...n,partstat:i});return(0,g.Uy)(e,(e=>{e.invites&&(e.invites[o]=a)}))}{const{id:t,...a}=s[o],r=await h.Z.calendar.createInvite({...a,name:a.name??"",event_id:a.event_id,address:n,partstat:i});(0,g.Uy)(e,(e=>{e.invites&&e.invites.push(r)}))}}(e,n,o,c),b=e}}else b.invites&&!w&&(b=await this.updateEventInCalendar(t,b));else y&&(b=await v(t));b||(b=function(e){const t=(e.invites||[]).map((e=>({...e,event_id:"",id:""}))),n=(e.notifications||[]).map((e=>({...e,id:""}))),{is_template:i,exceptionEvents:s,...o}=e;return{...o,id:"",start:e.start||0,end:e.end||0,notifications:n,invites:t,attachment:r.ZP.stringToAttachments(e.attachment)}}(t)),S=b.invites?.length?b.invites:t.invites?.map((e=>({...e,id:"",event_id:b?.id??""})));const C=S?.find((e=>e.address===o));if(!C)throw new Error("Attendee email address not found");const A={...b,invites:[C],organizer:b.organizer||t.organizer};await l.Z.sendReplyMails(e,A,n,o,c);const I=s.Z.getActiveMessage();I&&(I.rsvpState=c,p(I.id,I.rsvpState),i.Z.setActiveMessage(I))}async declineCounter(e,t,n,o){let a;try{a=f(t.uid)}catch(e){return void c.Z.error("Calendar",["invite"],"Error finding existing event to decline counter for",t)}await l.Z.sendReplyMails(e,a,n,o,"DECLINECOUNTER");const r=s.Z.getActiveMessage();if(r){const e={...r,rsvpState:"DECLINECOUNTER"};p(e.id,e.rsvpState),i.Z.setActiveMessage(e)}}addEventToCalendar(e,t){return v(e)}updateEventInCalendar(e,t){const{is_template:n,exceptionEvents:i,...s}=e,a=t.invites||[],l=s.invites||[],d=a.map((e=>{const t=l.find((t=>t.address===e.address));if(t)return{...e,partstat:t.partstat,name:t.name}})).filter(Boolean);l.forEach((e=>{a.find((t=>t.address===e.address))||d.push({...e,event_id:t.id,id:""})}));const c={...s,id:t.id,start:s.start||t.start,end:s.end||t.end,notifications:t.notifications,invites:d,attachment:r.ZP.stringToAttachments(s.attachment)},u=c.rrule?"all":"single";return o.ZP.updateEvent(c,u)}handleCancellation(e,t){const n=f(e.uid);if(t){const e=(0,m.Uq)(t),i=`${n.id}:${e}`;o.ZP.trashEvent(i,{sendEmails:!1,saveMode:"single"})}else o.ZP.trashEvent(n.id,{sendEmails:!1})}handleReply(e){const t=f(e.uid);if(!t.invites)throw new Error("Target event missing invites data.");if(!e.invites)throw new Error("Incoming event missing invites data.");const n=e.invites[0];let i=!1;t.invites.forEach((e=>{e.address===n.address&&(h.Z.calendar.updateInvite({id:e.id,partstat:n.partstat}),i=!0)})),i&&o.ZP.loadPromise()}}},12442:(e,t,n)=>{"use strict";n.d(t,{Z:()=>S});var i=n(50522),s=n(6320),o=n(15800),a=n(68247),r=n(33638),l=n(45660),d=n(30381),c=n.n(d),u=n(87852),p=n(9126),h=n(58821),g=n(93513);const m=["day","week","multiweek","month","year","agenda"],f=["day","week","agenda"];function v(e,t,n){const i=n??s.Z.getStateForPage(e),a=!n;if(t.displayMode||t.selectedDate){const e=t.selectedDate??i.selectedDate,n=t.anchorDate??i.anchorDate,s=t.displayMode??i.displayMode;if(e&&n&&s){o.ZP.getDisplayRange(n,s).contains(e)||(t={...t,anchorDate:e.clone(),selectedDate:e})}}const l=(0,g.Uy)(i,(e=>(e.anchorDate.localeData()!==c().localeData()&&(e.anchorDate.locale(c().locale()),e.selectedDate?.locale(c().locale())),{...e,...t})));return a&&r.Z.dispatch({actionType:"CALENDAR_UPDATE_UI",filter:l,pageId:e}),l}function y(e,t,n){const i=n?.filter??s.Z.getStateForPage(e),{anchorDate:a,displayMode:r,selectedDate:l}=i;if(!l)return i;let d;switch(r){case"agenda":case"multiweek":d="week";break;default:d=r}const c="previous"===t?a.clone().subtract(1,d):a.clone().add(1,d),u=n?.overrideSelected;let p;if(u&&o.ZP.getDisplayRange(c,r).contains(u))p=u.clone();else if("month"===r){const e=o.ZP.getDisplayRange(c,r),t=(0,h.Xq)(l,a);p=(0,h.FY)(t,l.weekday(),c,!1),p.isAfter(e.end,"day")&&(p=(0,h.Ro)(l.weekday(),c,!0))}else p="previous"===t?l.clone().subtract(1,d):l.clone().add(1,d);return v(e,{anchorDate:c,selectedDate:p},n?.filter)}const b=new class{init(e,t){v(e,t??(0,p.l)(e))}selectEvent(e,t){const{event:n,eventId:a,date:r,allDay:l,edit:d}=t,c=t.filter??s.Z.getStateForPage(e),u=n?.id??a??"";if(u===c.selectedEvent&&(void 0===d||d===c.editing))return c;let p=n;!p&&u&&(p=i.Z.getEvent(u));const h={};if(h.selectedEvent=u,t.hasOwnProperty("date")&&(h.selectedDate=r),p){if(!t.hasOwnProperty("date")){const e=o.ZP.getEventRange(p);!e||c.selectedDate&&e.contains(c.selectedDate)||(h.selectedDate=e.start)}h.editing=d??c.editing;!(p.start||p.end)&&"agenda"!==c.displayMode&&(h.displayMode="agenda")}return void 0!==l&&(h.allDaySelected=l),v(e,h,t.filter)}selectDate(e,t,n={}){const i=n.filter??s.Z.getStateForPage(e);if(t&&!t.isValid())return l.Z.error("Calendar",["actions"],new Error("Invalid date selected")),i;const{allDay:o,setToday:a}=n,{displayMode:r}=i;let d={allDaySelected:o??!1,selectedEvent:""};return d=t&&a&&"agenda"===r?{...d,anchorDate:t,selectedDate:t}:{...d,selectedDate:t},v(e,d,n.filter)}selectToday(e,t){const n=c()((0,h.zX)(Date.now()));return b.selectDate(e,n,{setToday:!0,filter:t?.filter})}viewPreviousPeriod(e,t){return y(e,"previous",t)}viewNextPeriod(e,t){return y(e,"next",t)}setViewMode(e,t,n){const i=n?.filter??s.Z.getStateForPage(e);if(e===u.G6&&!f.includes(t))return i;if((n?.save??!0)&&t!==i.displayMode){const n=(0,p.R)(e);n.displayMode=t;const i=o.ZP.getCalendarFilterPrefsKey(e);a.Z.set(i,n)}return v(e,{displayMode:t},n?.filter)}zoomViewMode(e,t,n){const i=s.Z.getStateForPage(e).displayMode,o=e===u.G6?f:m;let a=o.findIndex((e=>e===i))+t;return a<0?a=0:a>=o.length&&(a=o.length-1),v(e,{displayMode:o[a]},n?.filter)}showCompletedTasks(e,t){const n=t?.filter??s.Z.getStateForPage(e),i=t?.state??!n.showCompletedTasks,r=(0,p.R)(e);if(i!==n.showCompletedTasks){r.showCompletedTasks=i;const t=o.ZP.getCalendarFilterPrefsKey(e);a.Z.set(t,r)}return v(e,{showCompletedTasks:i},t?.filter)}search(e,t,n){return v(e,{filterText:t},n?.filter)}setCalendarIds(e,t,n){return v(e,{calendarIds:t},n?.filter)}},S=b},29717:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var i=n(33638);const s={enableCapture:function(e,t){i.Z.dispatch({actionType:"CAPTURE_ENABLE",winId:e,noteId:t})},disableCapture:function(e){i.Z.dispatch({actionType:"CAPTURE_DISABLE",winId:e})}}},21788:(e,t,n)=>{"use strict";n.d(t,{Z:()=>m});var i=n(21838),s=n(96951),o=n(29087),a=n(83526),r=n(15489),l=n(2497),d=n(94595),c=n(7064),u=n(89175);const p=["INPUT","FRAME","IFRAME","OBJECT","SELECT","TEXTAREA","EMBED"],h=[{className:"url",action:"urlPasteAndGo"},{className:"vivaldi-searchfield",action:"searchPasteAndGo"},{className:"quick-command-search",action:"qcPasteAndGo"}];function g(){let e;const t=function(t){const{clipboardData:n}=t;n&&n.types.indexOf("text/plain")>-1&&(e=n.getData("text/plain"),t.preventDefault())};return document.addEventListener("paste",t),document.execCommand("paste"),document.removeEventListener("paste",t),e}const m=new class{undo(e){c.Z.editcommand.execute("undo",e)}redo(e){c.Z.editcommand.execute("redo",e)}cut(e){c.Z.editcommand.execute("cut",e)}copy(e){c.Z.editcommand.execute("copy",e)}paste(e){c.Z.editcommand.execute("paste",e)}selectAll(e){c.Z.editcommand.execute("selectAll",e)}set(e){const{body:t}=document;if(!e||!t)return;const n=document.createElement("input");n.style.position="absolute",n.style.zIndex="-1",n.value=e,t.appendChild(n),n.select(),document.execCommand("copy")||console.error("Failed to copy text."),t.removeChild(n)}pasteAsPlainText(e){c.Z.editcommand.execute("pasteAndMatchStyle",e)}pasteAsPlainTextOrPasteAndGo(e,t){let n=g();if(!r.ZP.isPopup(e)){const i=(0,l.Z)(e),{activeElement:s}=i.document,o=h.find((e=>s?.classList.contains(e.className)));if(o&&s instanceof i.HTMLInputElement)return n=(0,d.Z)({textToStrip:n??"",caretPosition:s?.selectionStart??0,selectionEnd:s?.selectionEnd??0,currentValue:s?.value??""}),void a.Z.doAction(e,t,o.action,{clipboardText:n});if(p.indexOf(s?.tagName)>-1||s?.isContentEditable)return void c.Z.editcommand.execute("pasteAndMatchStyle",e)}c.Z.windowPrivate.getFocusedElementInfo(e).then((({editable:i})=>{i?c.Z.editcommand.execute("pasteAndMatchStyle",e):(o.Z.get(u.kAddressBarStripJavascriptOnPaste)&&(n=(0,d.Z)({textToStrip:n??"",caretPosition:0,selectionEnd:0,currentValue:""})),a.Z.doAction(e,t,"urlPasteAndGo",{clipboardText:n}))}))}copyWithFilter(e){const t=e.indexOf("?");-1!==t&&(e=e.slice(0,t)),this.copyTextToClipboard(e)}async createNoteFromSelection(e){const t=s.ZP.getActivePage(e);if(t){const n=g(),s=await c.Z.utilities.getSelectedText(t.id);await i.Z.createNote(e,{content:n,url:s===n?t.url:void 0,type:"note"})}}copyUrlToClipboard(e){const t=function(t){t.clipboardData&&(t.clipboardData.setData("text/plain",e),t.stopPropagation(),t.preventDefault())};document.addEventListener("copy",t),document.execCommand("copy"),document.removeEventListener("copy",t)}copyTextToClipboard=e=>{const t=t=>{t.clipboardData&&(t.clipboardData.setData("text/plain",e),t.stopPropagation(),t.preventDefault())};return document.addEventListener("copy",t),document.execCommand("copy"),document.removeEventListener("copy",t),Promise.resolve()}}},47995:(e,t,n)=>{"use strict";n.d(t,{Z:()=>C});var i=n(25795),s=n(68247),o=n(29087),a=n(33638),r=n(56371),l=n(92292),d=n(7064),c=n(10334),u=n(93196),p=n(47380),h=n(89175);const g={version:1,chains:[{category:"CATEGORY_COMMAND_CHAIN",key:"ckqjhvf430003c5429ni7i7bz",label:(0,r.Z)("command chain",(0,r.Z)("Close Other and Open Defined Tab")),name:"COMMAND_ckqjhvf430003c5429ni7i7bz",chain:[{defaultValue:"https://vivaldi.com",key:"f57b8092-9426-4bc8-8e39-fcf3e315b065",param:"https://vivaldi.com",label:"COMMAND_OPEN_LINK_DEFAULT",name:(0,r.Z)("Open Link in New Tab")},{key:"275ca3f7-ecfb-4445-bf87-686cd473536e"}]},{category:"CATEGORY_COMMAND_CHAIN",key:"ckqkoqycf0003wv4210uduu8n",label:(0,r.Z)("command chain",(0,r.Z)("Toggle Fullscreen and Reader Mode")),name:"COMMAND_ckqkoqycf0003wv4210uduu8n",chain:[{key:"7420368f-565e-409f-8eec-5b5c578429af"},{key:"8dd47fc9-4c1f-4487-a475-f55bfa61aaf2"}]},{category:"CATEGORY_COMMAND_CHAIN",key:"ckqjdk4o7000001l58zh17egm",label:(0,r.Z)("command chain",(0,r.Z)("Open Links and Tile")),name:"COMMAND_ckqjdk4o7000001l58zh17egm",chain:[{defaultValue:"https://vivaldi.com",key:"0b01337b-4c13-4197-90c8-179c5c91cfff",param:"https://vivaldi.com",label:"COMMAND_OPEN_LINK_CURRENT"},{defaultValue:"https://vivaldi.net",key:"f57b8092-9426-4bc8-8e39-fcf3e315b065",param:"https://vivaldi.net",label:"COMMAND_OPEN_LINK_DEFAULT"},{defaultValue:"https://help.vivaldi.com",key:"f57b8092-9426-4bc8-8e39-fcf3e315b065",param:"https://help.vivaldi.com",label:"COMMAND_OPEN_LINK_DEFAULT"},{defaultValue:1e3,key:"2eb81004-6703-46db-9933-6afcfde924e4",param:150},{key:"e245bce5-20a7-481f-910e-23bf1de86748"},{key:"e245bce5-20a7-481f-910e-23bf1de86748"},{defaultValue:1e3,key:"2eb81004-6703-46db-9933-6afcfde924e4",param:125},{key:"cdd99010-5477-4508-aa28-d671de35dcb2"},{key:"854f8a44-50bd-41bc-8277-acd51e719d1b"}]}]},m=function(e){i.Z.isNamedMenuAvailable(e)&&d.Z.menuContent.get(e,((t,n,i)=>{a.Z.dispatch({actionType:"COMMAND_SET_NAMED_MENU",name:e,content:i})}))},f=function(e){if(!e){const e=i.Z.getMenuContentName();e&&m(e)}},v=function(e,t,n){const i=b(e);if(!i)return;const s={shortcuts:t,gestures:n,feature:u.CN.concat(o.Z.get(h.kChainedCommandsCommandList)).find((t=>t.name===e))?.feature||"browser"};a.Z.dispatch({actionType:"COMMAND_UPDATE_COMMAND",item:{key:i,value:s}})},y=function(){const e=u.CN.concat(o.Z.get(h.kChainedCommandsCommandList)),t=o.Z.get(h.kActions)[0],n=e.map((e=>{const n=t[e.name];if(n)return{key:e.name,value:{...n,feature:e.feature||"browser"}}})).filter(Boolean);a.Z.dispatch({actionType:"COMMAND_RESET",items:n})};function b(e){if(e.startsWith("COMMAND_"))return e}function S(e,t){if(t.length<e.length){const n=e.filter((e=>-1===t.findIndex((t=>t.key===e.key))));if(1===n.length){const e=b(n[0].name);e&&a.Z.dispatch({actionType:"COMMAND_REMOVE_COMMAND",key:e})}else console.warn("Wrong number of elements removed")}}const w=new class{loadPromise=()=>{const{version:e}=g;e!==o.Z.get(h.kChainedCommandsVersion)&&(e=>{const{chains:t}=g,n=o.Z.get(h.kChainedCommandsDeletedCommandList),i=o.Z.get(h.kChainedCommandsCommandList),a=i.map((e=>e.key)),r=t.filter((e=>!n.includes(e.key)&&!a.includes(e.key))),l=[...i,...r];s.Z.set(h.kChainedCommandsCommandList,l),s.Z.set(h.kChainedCommandsVersion,e)})(e);const t=u.CN.concat(o.Z.get(h.kChainedCommandsCommandList)),n=o.Z.get(h.kActions)[0],i=t.map((e=>{const t=n[e.name];if(t)return{key:e.name,value:{...t,feature:e.feature||"browser"}}})).filter(Boolean);return a.Z.dispatch({actionType:"COMMAND_INITIALIZE",items:i}),d.Z.menuContent.onChanged.addListener(m),d.Z.menuContent.onResetAll.addListener(f),o.Z.addListener(h.kChainedCommandsCommandList,S),Promise.resolve()};requestNamedMenu(e){i.Z.getIsInitialized()&&!i.Z.isNamedMenuAvailable(e)&&d.Z.menuContent.get(e,((t,n,i)=>{l.Z.runtime.lastError?(a.Z.dispatch({actionType:"COMMAND_SET_NAMED_MENU",name:e,content:[]}),console.warn("Failed to read menu spec. Attempting fallback.",e),d.Z.menuContent.reset(e,!1,void 0,(()=>{}))):a.Z.dispatch({actionType:"COMMAND_SET_NAMED_MENU",name:e,content:i})}))}restoreShortcuts(){const e=structuredClone(o.Z.getDefault(h.kActions))[0];i.Z.getUserEditableCommands().forEach((t=>{const n=i.Z.getCommandConfiguration(t.name)?.gestures;n?e[t.name]={...e[t.name],gestures:n}:e[t.name]?.gestures&&delete e[t.name].gestures})),s.Z.set(h.kActions,[e]),y()}restoreGestures(){const e=structuredClone(o.Z.getDefault(h.kActions))[0];i.Z.getUserEditableCommands().forEach((t=>{const n=i.Z.getCommandConfiguration(t.name)?.shortcuts;n?e[t.name]={...e[t.name],shortcuts:n}:e[t.name]?.shortcuts&&delete e[t.name].shortcuts})),s.Z.set(h.kActions,[e]),y()}setShortcuts(e,t){const n=o.Z.get(h.kActions)[0],i={...n};i[e]={...n[e]},t&&t.length>0?i[e].shortcuts=t:delete i[e].shortcuts,s.Z.set(h.kActions,[i]),v(e,t,i[e].gestures)}setGestures(e,t){const n=o.Z.get(h.kActions)[0],i={...n};i[e]={...n[e]},t&&t.length>0?i[e].gestures=t:delete i[e].gestures,s.Z.set(h.kActions,[i]),v(e,i[e].shortcuts,t)}executeActions(e,t,n,s){const a=(0,p.m)(e,t),r=i.Z.getCommands().find((e=>e.name===n));if(!r){const e=o.Z.get(h.kChainedCommandsCommandList);for(let t=e.length-1;t>=0;t--)if(e[t].name===n){(0,c.hT)(a,e[t].chain);break}return void console.warn("[execute actions]: Lookup failed for command",n)}let l=s;void 0===l&&(l=(0,u.xU)(r.name)?.defaultValue),void 0!==l&&(a.param=l),r.action(a)}handleRockerGesture(e,t){const n=o.Z.get(t?h.kMouseGesturesRockerGesturesRightToLeft:h.kMouseGesturesRockerGesturesLeftToRight),s=i.Z.getCommandByGuid(n);s?w.executeActions("gesture",e,s.name):console.warn("[Rocker Gesture]: No command for guid",n)}},C=w},17751:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var i=n(33638);const s={log:function(e){i.Z.dispatch({actionType:"COMPONENT_LOGGER_LOG",entry:e})},prune:function(e,t,n){i.Z.dispatch({actionType:"COMPONENT_LOGGER_PRUNE",components:e,tags:t,levels:n})}}},4660:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u});var i=n(73132),s=n(72010),o=n(33638),a=n(7064);async function r(e){const t=await a.Z.contacts.getAll();o.Z.dispatch({actionType:"CONTACT_INITIALIZE",contacts:t.map((e=>(0,i.Z)(e))),newContact:e})}function l(e){o.Z.dispatch({actionType:"CONTACT_UPDATE_CONTACT",contact:e})}function d(e){o.Z.dispatch({actionType:"CONTACT_ADD_CONTACTS",contacts:e.map((e=>(0,i.Z)(e)))})}async function c(e,t){Object.keys(t).length>0&&await a.Z.contacts.update(e,t,(e=>l((0,i.Z)(e))))}const u={initialize:r,updateContact:l,addGeneratedContacts:d,addContact:async function(e){const t=await a.Z.contacts.create({name:e.name,birthday:e.birthday,note:e.note,generatedFromSentMail:e.generatedFromSentMail,avatarUrl:e.avatarUrl,separator:e.separator,trusted:e.trusted});for(const n of e.emailAddresses)await a.Z.contacts.addEmailAddress({contactId:t.id,emailAddress:n.emailAddress,type:n.type});for(const n of e.postalAddresses)await a.Z.contacts.addPropertyItem({propertyName:"postalAddress",contactId:t.id,propertyValue:n.postalAddress,type:n.type});for(const n of e.phoneNumbers)await a.Z.contacts.addPropertyItem({propertyName:"phoneNumber",contactId:t.id,propertyValue:n.phoneNumber,type:n.type});e.id=t.id,o.Z.dispatch({actionType:"CONTACT_ADD_CONTACT",contact:e})},selectContact:function(e,t=!1){o.Z.dispatch({actionType:"CONTACT_SELECT_CONTACT",contact:e,focusContactView:t})},deleteContactsByIds:function(e){const t=[],n=[];for(const i of e)"string"==typeof i&&(t.push(i),n.push(a.Z.contacts.delete(i)));return Promise.all(n).then((()=>{o.Z.dispatch({actionType:"CONTACT_DELETE_CONTACTS",ids:t})}))},newEmptyContact:function(){return new Promise((e=>{a.Z.contacts.create({},(t=>{const n=(0,i.Z)(t);return r(n),e(n)}))}))},newContactFromMailAddress:function(e,t){a.Z.contacts.create({name:e.name||""},(t=>a.Z.contacts.addEmailAddress({contactId:t.id,emailAddress:e.address},(e=>{r((0,i.Z)(e))}))))},putTrustedEmailAddress:function(e){let t=!1;s.Z.getAsArray().forEach((n=>n.emailAddresses.forEach((i=>{e.address===i.emailAddress&&(t=!0,c(n.id,{trusted:!0}))})))),!1===t&&a.Z.contacts.create({name:e.name||"",generatedFromSentMail:!0,trusted:!0},(t=>a.Z.contacts.addEmailAddress({contactId:t.id,emailAddress:e.address},(e=>d([e])))))},update:c,updatePropertyItem:function(e){a.Z.contacts.updatePropertyItem(e,(e=>l((0,i.Z)(e))))},updateEmailAddress:function(e,t){a.Z.contacts.updateEmailAddress(e,t,(e=>l((0,i.Z)(e))))},addPropertyItem:function(e){a.Z.contacts.addPropertyItem(e,(e=>l((0,i.Z)(e))))},removePropertyItem:function(e){a.Z.contacts.removePropertyItem(e,(e=>l((0,i.Z)(e))))},addEmailAddress:function(e){a.Z.contacts.addEmailAddress(e,(e=>l((0,i.Z)(e))))},removeEmailAddress:function(e){a.Z.contacts.removeEmailAddress(e,(e=>l((0,i.Z)(e))))},addIfNotAddressExists:function(e){a.Z.contacts.getAll((t=>{const n=new Set;t.forEach((e=>e.emailAddresses.forEach((e=>{e.emailAddress&&n.add(e.emailAddress.toLowerCase())}))));const i=[];e.forEach((e=>{n.has(e.address.toLowerCase())||(a.Z.contacts.create({name:e.name||"",generatedFromSentMail:!0},(t=>{a.Z.contacts.addEmailAddress({contactId:t.id,emailAddress:e.address},(e=>d([e])))})),i.push(e))}))}))}}},83784:(e,t,n)=>{"use strict";n.d(t,{Z:()=>S});var i=n(49777),s=n(29087),o=n(33638),a=n(63153),r=n(15489),l=n(56371),d=n(92292),c=n(2497),u=n(28773),p=n(7064),h=n(82786),g=n(8874),m=n(86662),f=n(89175),v=n(8684);function y(e){return new Promise((t=>{d.Z.downloads.search(e,t)}))}const b=(0,h.M)();const S=new class{_isPolling=!1;_dispatchUpdate=e=>{o.Z.dispatch({actionType:"DOWNLOAD_PANEL_UPDATED",downloadItems:e})};_replaceDownloadItem=(e,t)=>{const n=i.ZP.getItems({isIncognitoWindow:!1}),s=n.find((t=>t.id===e.id));if(!s)return;const o=n.indexOf(s),a=[...n.slice(0,o),t,...n.slice(o+1)];this._dispatchUpdate(a)};_startPolling=()=>{this._isPolling||(this._intervalId=setInterval(this._pollInProgressDownloads,500),this._isPolling=!0)};_stopPolling=()=>{this._isPolling=!1,clearInterval(this._intervalId)};_handleNewDownloadItem=e=>{const t=i.ZP.getFilter(),n=i.ZP.getOrderBy(),s={...(0,u.Z)(t?{query:t.split(" ")}:null),...(0,u.Z)(n?{orderBy:[n]}:null)};d.Z.downloads.search(s,(t=>{this._dispatchUpdate(t);const n=i.ZP.getItems({isIncognitoWindow:!1}).find((t=>t.id===e));n&&o.Z.dispatch({actionType:"DOWNLOAD_STARTED",downloadItem:n})}))};_updateState=e=>{const t=i.ZP.getItems({isIncognitoWindow:!1}),n=t.findIndex((t=>t.id===e.id));if(-1===n)return void this._handleNewDownloadItem(e.id);const s=t.with(n,e);this._dispatchUpdate(s),i.mb.append(e.id,e.currentSpeed)};_updateStateForDownloadItems=e=>{e.forEach(this._updateState)};_handleInProgressSearch=e=>{e.filter((e=>!e.paused)).length||this._stopPolling(),this._setTotalProgress(e),this._updateStateForDownloadItems(e)};_handleFileDeleted=(e,t)=>{this._pollInProgressDownloads(),e?d.Z.downloads.search({id:e,limit:1},(n=>{if(!n||!Array.isArray(n))return void console.warn(`DownloadActions: _handleFileDeleted: Failed to search downloads for ID ${e} (${t})`);const i=n[0];i&&this._updateState(i)})):console.warn(`DownloadActions: _handleFileDeleted: Invalid download ID ${e} (${t})`)};_pollInProgressDownloads=()=>{d.Z.downloads.search({state:"in_progress"},this._handleInProgressSearch)};_setTotalProgress=e=>{const t=e.filter((e=>!e.paused)),n=t.length,i=function(e){return e.length?e.map((e=>e.bytesReceived/e.totalBytes)).reduce(((e,t)=>e*t)):0}(t);o.Z.dispatch({actionType:"DOWNLOAD_SET_TOTAL_PROGRESS",totalNumberOfDownloads:n,totalProgress:i})};_handleDangerousFileDownload=e=>{const t=r.ZP.getLastActiveBrowserWindowId();r.ZP.isMinimized(t)&&a.Z.restore(t),async function(e,t){const n=await b();try{const{chrome:i}=(0,c.Z)(e);await i.downloads.acceptDanger(t)}catch(e){}finally{n()}}(t,e)};_onTransferChanged=e=>{e.paused&&e.paused.previous&&!e.paused.current?this._onTransferCreated():(e.filename&&this._handleNewDownloadItem(e.id),e.danger&&e.danger.current!==e.danger.previous&&this._handleDangerousFileDownload(e.id),e.exists&&!e.exists.current&&this._handleFileDeleted(e.id,"Deleted from disk"),e.state&&("interrupted"===e.state.current?(this._handleFileDeleted(e.id,"Interrupted"),d.Z.downloads.search({id:e.id,limit:1},(([e])=>{o.Z.dispatch({actionType:"DOWNLOAD_STOPPED",downloadItem:e}),this.#t(e)}))):"complete"===e.state.current&&(d.Z.downloads.search({id:e.id,limit:1},(([e])=>{this._updateState(e),this._pollInProgressDownloads(),o.Z.dispatch({actionType:"DOWNLOAD_COMPLETED",downloadItem:e}),this.#t(e)})),i.ZP.openAfterDownload.has(e.id)&&(d.Z.downloads.open(e.id),i.ZP.openAfterDownload.delete(e.id)))))};#t(e){if(!s.Z.get(f.kDownloadsNotifyOnComplete))return;const t=e.error?(0,g.U)(e.error):function(e){let{filename:t,extension:n}=(0,m.QQ)(e);return t.length>65&&(t=t.substring(0,65)+".."),t+n}(e.filename),n=e.error?(0,l.Z)("Download Failed"):(0,l.Z)("Download Complete"),i=this.showDownload.bind(null,e.id);d.Z.downloads.getFileIcon(e.id,{size:32},(s=>{(0,v.c)({title:n,body:t,icon:s,timeout:54e6,onClick:i,tag:`VIVALDI_DOWNLOAD_COMPLETE_ID_${e.finalUrl}`})}))}_onTransferErased=e=>{const t=i.ZP.getItems({isIncognitoWindow:!1}),n=t.findIndex((t=>t.id===e));if(-1===n)return;const s=[...t.slice(0,n),...t.slice(n+1)];this._dispatchUpdate(s)};_onTransferCreated=()=>{this._startPolling()};_showDownload=e=>{d.Z.downloads.show(e)};_openDownload=e=>{d.Z.downloads.open(e)};_pauseDownload=e=>{i.mb.clear(e),d.Z.downloads.pause(e)};_resumeDownload=e=>{d.Z.downloads.resume(e)};_eraseDownload=e=>{d.Z.downloads.erase({id:e})};_dragDownloads=e=>{const t=r.ZP.getLastActiveBrowserWindowId();p.Z.utilities.downloadsDrag(t,e)};_restartDownload=e=>y({id:e}).then((([t])=>{return(n={url:t.url},new Promise((e=>{d.Z.downloads.download(n,e)}))).then((e=>y({id:e}))).then((([e])=>this._replaceDownloadItem(t,e))).then((()=>{return t={id:e},new Promise((e=>{d.Z.downloads.erase(t,e)}));var t}));var n}));_searchDownloads({filter:e,orderBy:t}){return new Promise((n=>{const i={...(0,u.Z)(e?{query:e.split(" ")}:null),...(0,u.Z)(t?{orderBy:[t]}:null)};d.Z.downloads.search(i,(e=>{n(e)}))}))}_setSearchFilter(e){if(e===i.ZP.getFilter())return Promise.resolve();const t=i.ZP.getOrderBy();return this._searchDownloads({filter:e,orderBy:t}).then((t=>{o.Z.dispatch({actionType:"DOWNLOAD_SET_FILTER",downloadItems:t,filter:e})}))}_setOrderBy(e){if(e===i.ZP.getOrderBy())return Promise.resolve();const t=i.ZP.getFilter();return this._searchDownloads({filter:t,orderBy:e}).then((t=>{o.Z.dispatch({actionType:"DOWNLOAD_SET_ORDER_BY",downloadItems:t,orderBy:e})}))}_validateDownload=e=>{d.Z.downloads.acceptMixed(e)};forceUpdate=()=>{const e=i.ZP.getFilter(),t=i.ZP.getOrderBy();this._searchDownloads({filter:e,orderBy:t}).then((e=>{o.Z.dispatch({actionType:"DOWNLOAD_SET_ORDER_BY",downloadItems:e,orderBy:t})}))};startResolvingReady=()=>{let e,t,n;return Promise.race([function(){let t=0;return new Promise((n=>{!function i(){p.Z.utilities.isDownloadManagerReady((e=>{e&&n()})),t++,e=setTimeout(i,1e3*t)}()}))}(),new Promise((e=>{n=()=>{e()},p.Z.utilities.onDownloadManagerReady.addListener(n)})),new Promise((e=>{t=setTimeout(e,2e4)}))]).then((()=>{clearTimeout(e),clearTimeout(t),p.Z.utilities.onDownloadManagerReady.removeListener(n),i.ZP.resolveReady()}))};addOpenAfterDownload=e=>{i.ZP.openAfterDownload.add(e)};setSearchFilter=e=>i.ZP.ready.then((()=>this._setSearchFilter(e)));setOrderBy=e=>i.ZP.ready.then((()=>this._setOrderBy(e)));showDownload=e=>{i.ZP.ready.then((()=>{this._showDownload(e)}))};eraseDownload=e=>{i.ZP.ready.then((()=>{this._eraseDownload(e)}))};openDownload=e=>{i.ZP.ready.then((()=>{this._openDownload(e)}))};pauseDownload=e=>{i.ZP.ready.then((()=>{this._pauseDownload(e)}))};resumeDownload=e=>{i.ZP.ready.then((()=>{this._resumeDownload(e)}))};dragDownloads=e=>{i.ZP.ready.then((()=>{this._dragDownloads(e)}))};restartDownload=e=>i.ZP.ready.then((()=>this._restartDownload(e)));validateMixedDownload=e=>{i.ZP.ready.then((()=>{this._validateDownload(e)}))};load=()=>(d.Z.downloads.setShelfEnabled(!1),d.Z.downloads.onChanged.addListener(this._onTransferChanged),d.Z.downloads.onCreated.addListener(this._onTransferCreated),d.Z.downloads.onErased.addListener(this._onTransferErased),this.startResolvingReady(),i.ZP.ready.then(this._startPolling))}},87210:(e,t,n)=>{"use strict";n.d(t,{Z:()=>p});var i=n(16875),s=n(96951),o=n(29087),a=n(33638),r=n(83526),l=n(92292),d=n(63164),c=n(89175);const u=new class{setFastForwardUrl(e,t,n){a.Z.dispatch({actionType:"FAST_FORWARD_SET_FORWARD_URL",pageId:e,forwardUrl:t})}_updateRewindInfo(e,t,n){a.Z.dispatch({actionType:"FAST_FORWARD_SET_REWIND_INFO",pageId:e,history:n,currentIndex:t})}setRewindInfo(e,t){e.getPageHistory(((e,n)=>{l.Z.runtime.lastError||u._updateRewindInfo(t,e,n)}))}navigateRewind(e){const t=s.ZP.getActivePage(e);if(t){const n=i.Z.getRewindRelativeIndex(t.id);r.Z.go(e,t.id,-1*n)}}navigateFastforward(e){const t=s.ZP.getActivePage(e);t&&(0,d.VN)(t.id,{type:"FFW_NAVIGATE"})}isFFWEnabled(){return o.Z.get(c.kKeyboardShortcutsSpaceFastForwards)}onIsFFWEnabled(e){this.isFFWEnabled()&&(0,d.VN)(e,{type:"FFW_GO_FORWARD"})}initFastForward(){(0,d.Tg)(((e,t)=>{if(!t.tab?.id||0!==t.frameId)return;const{type:n}=e;"FFW_URL_CHANGED"===n&&"string"==typeof e.nextUrl?u.setFastForwardUrl(t.tab.id,e.nextUrl,t.url):"FFW_CAN_GO_FORWARD"===n&&u.onIsFFWEnabled(t.tab.id)}))}},p=u},22616:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var i=n(33638);class s{static setImportProgress(e,t,n,s,o){i.Z.dispatch({actionType:"IMPORT_PROGRESS",importType:e,importItemType:t,current:n,total:s,key:o})}static addImportWarning(e,t,n){i.Z.dispatch({actionType:"IMPORT_PROGRESS_WARN",importType:e,importItemType:t,message:n})}static addImportError(e,t,n){i.Z.dispatch({actionType:"IMPORT_PROGRESS_ERROR",importType:e,importItemType:t,message:n})}static clearImportProgress(e,t){i.Z.dispatch({actionType:"IMPORT_PROGRESS_CLEAR",importType:e,importItemType:t})}}},99827:(e,t,n)=>{"use strict";n.d(t,{Z:()=>$e});var i=n(39045),s=n(2711),o=n(72010),a=n(82227),r=n(3184),l=n(65093),d=n(98611),c=n(36943),u=n(54162),p=n(98484),h=n(46382),g=n(29087),m=n(60331),f=n(33638),v=n(56371),y=n(78347),b=n(95095),S=n(91834),w=n(48868),C=n(71320),A=n(51501),I=n(45709),T=n(10671),Z=n(60308),E=n(9982),k=n(25100),_=n(45660),N=n(6977),P=n(93818),D=n(24651),M=n(5204),O=n(16445),x=n(40348),L=n(7064),R=n(99895),B=n(32593),F=n(3664);async function W(e,t,n,i,o,a,r){const l=await function(e){const t=O.Z.call(e);return(0,k.Z)(t,[],e)}(t);if(l.from.length+l.to.length+l.cc.length===0&&!l.subject){_.Z.warn("Mail",["import file",n,i,o],"Selected file does not seem to be a mail file");const t=(0,v.Z)("Selected file does not seem to be a mail file: $1",[o]);return r?h.Z.showModalInfo(e,{title:(0,v.Z)("Mail Import File"),body:t}):m.Z.setStatus(e,t),!1}const d=T.Z.getFolderType(n,i),{indexUpdates:c}=await Z.Z.call(n,i,d,[l]);$e.updateIndex(c);const{addedSles:u,sleUpdates:p}=c;let g;if(u&&u.length>0?g=u[0]:p&&p.length>0&&(g=await(0,P.Z)(p[0].id),_.Z.info("Mail",["import file",n,i,o],"Message already exists but was also added to this folder -",l.subject)),g){const{id:e,sentDate:t}=g;return await R.Z.call(n,t,e,l.raw),await D.Z.setHasRaw(n,e),await(0,E.Z)(n,i,[l]),M.Z.filter(),s.Z.updateThreads(),a&&(await N.Z.addUpload([{accountId:n,path:i,searchListId:e,flags:[]}]),s.Z.flushBuffer()),!0}{_.Z.info("Mail",["import file",n,i,o],"Message already exists in this folder -",l.subject);const t=(0,v.Z)("Message already exists in this folder - $1",[l.subject]);return r?h.Z.showModalInfo(e,{title:(0,v.Z)("Mail Import File"),body:t}):m.Z.setStatus(e,t),!1}}async function U(e,t,n,i,s,o){const a=await async function(e,t){return new Promise((n=>{L.Z.importData.openThunderbirdMailbox(e,String(t),(e=>{n(Number(e))}))}))}(t,0);let r=await(0,B.tP)();if(r){let l=r.seekPosition,d=r.message,c=0,u=0;const p=(0,F.sy)(d);for(await W(e,p,n,i,t,s,o&&-1===l)?c+=1:u+=1;l>-1;){if(m.Z.setStatus(e,`${t}: ${Math.floor(l/1e3)}/${Math.floor(a/1e3)} kB (${c} messages)`,5e3),r=await(0,B.tP)(),!r){u+=1;break}{l=r.seekPosition,d=r.message;const o=(0,F.sy)(d);await W(e,o,n,i,t,s,!1)?c+=1:u+=1}}return L.Z.importData.closeThunderbirdMailbox(),{numAdded:c,numFailed:u}}L.Z.importData.closeThunderbirdMailbox();const l=await(0,x.Z)(t);return await W(e,l,n,i,t,s,o)?{numAdded:1,numFailed:0}:{numAdded:0,numFailed:1}}var V=n(95752),H=n(28918),G=n(68906),$=n(33956);const K=async function(e,t){const{id:n}=e;return await w.Z.searchList.update(n,{unseen:t}),[{id:n,updates:{unseen:t}}]};var z=n(15489),j=n(92292),Y=n(54773),X=n(25051),Q=n(16152),q=n(89175),J=n(78614),ee=n(8684),te=n(44850);const ne=new Set,ie=(0,Q.Z)((async function(){const e=[...ne].filter((e=>!V.Z.call(e.sources)));if(ne.clear(),e.length<=5)for(const t of e)await ae(t);else await async function(e){const t=()=>{const e=z.ZP.getMailWindowId();h.Z.showMail(e)};(0,ee.c)({title:(0,v.Z)("You have $1 new mail","You have $1 new mails",[e.length]),icon:"resources/mail_notification_icon.png",silent:!g.Z.get(q.kMailNotificationsSoundOn),onClick:t,timeout:oe,tag:se})}(e)}),5e3),se="VIVALDI_MAIL_BATCHED_MULTIMAIL",oe=36e5;function ae(e){const t=(0,J.Rz)(Y.Z.get(e.fromIds)),n=(0,J.Rz)(Y.Z.get(e.toIds));(0,ee.c)({title:e.subject,body:(0,v.Z)("New mail from $1 to $2",[t,n]),icon:"resources/mail_notification_icon.png",silent:!g.Z.get(q.kMailNotificationsSoundOn),onClick:()=>{const t=`message/${e.id}`,n=te.jk.internalUrl("mailpage",t,(0,v.Z)("Mail")),i=z.ZP.getMailWindowId();X.QJ.openURL(i,n),j.Z.windows.update(i,{drawAttention:!0})},timeout:108e5,tag:`VIVALDI_MAIL_MESSAGE_ID_${e.id}`})}const re={newMail:function(e){ne.add(e),ie()}};var le=n(95538),de=n(34198),ce=n(26219),ue=n(81830),pe=n(67103),he=n(5863),ge=n(65741),me=n(1407),fe=n(58228);function ve(e,t){const n=A.ZP.parseQuery(e),i=Date.now();return m.Z.setStatus(me.A4,(0,v.Z)("Searching for $1...",[n])),_.Z.log("Mail",["search"],`query:${e}, refined:${n}`),async function(e){return new Promise((t=>{try{L.Z.mailPrivate.searchMessages(e,t)}catch(t){_.Z.error("Mail",["searchMessages"],`Search failed for query: ${e}`,t)}}))}(n).then((e=>{if(t()){const e=`Discarding results for outdated query: ${n}`;throw _.Z.log("Mail",["search"],`${e}`),new Error(e)}{const t=Date.now()-i;return m.Z.setStatus(me.A4,(0,v.Z)("Search for $2 returned $1 result in $3ms.","Search for $2 returned $1 results in $3ms.",[e.length,n,t])),_.Z.log("Mail",["search"],`search for ${n} returned ${e.length} results in ${t}ms`),e}}))}var ye=n(49168),be=n(93986),Se=n(13248);function we(){const e=u.Z.getSelectedFolder();if(e){const{accountId:t,path:n}=e;return d.Z.getByFolderId([t,n])}}const Ce=(0,Q.Z)((async e=>{const t=we();if(t&&A.ZP.getFilterOptions(t).showRead&&g.Z.get(q.kMailAutoMarkAsRead)){const{sleUpdates:t}=I.Z.setRead([e],!0,!1);Me({sleUpdates:t})}else if(e.unseen){const t=await K(e,!1);await G.Z.call({priority:he.Un.HIGH,type:"RE_RUN_SLES",searchListIds:[e.id]}),Me({sleUpdates:t}),M.Z.filter()}}),1e3);function Ae(e){const{sleUpdates:t,undoItem:n}=I.Z.setRead(e,!0);Me({sleUpdates:t}),Ie(n)}function Ie(e){e&&f.Z.dispatch({actionType:"MAIL_UNDO_ADD_ITEM",undoItem:e,folder:u.Z.getSelectedFolder()})}async function Te(e,t){await w.Z.transaction("rw",[w.Z.buffer,w.Z.accounts],(async()=>{await(0,H.Z)({accountId:e,path:t,operation:"BUFFER_OPERATION_REMOVE_ACCOUNT_PATH",deleteFiles:!0}),(0,Se.ZA)(e)&&(await i.Z.removeFolder(e,t),await y.Z.removeFolder(e,t))})),s.Z.flushBuffer()}async function Ze(e,t){const n=he.wC,i=[he.W4,he.cs],s=[{senderIsMailingList:t}],o=i.map((e=>d.Z.getByFolder(n,[e,t].join("/")))).find((e=>void 0!==e));if(o)await a.Z.remove([o.id]),await C.Z.updateFilters([o.id]);else{const e={name:t,accountId:n,path:`${he.W4}/${t}`,filterValue:{include:[s],exclude:[[{flag:he.T4.DELETED}]],...A.ZP.getSearchListButtons(he.wC)}},i=await ve(`from:${t}`,(()=>!1)),o=await a.Z.add(e,he.Un.LOW,i);await C.Z.updateFilters(o)}M.Z.filter()}function Ee(e,t){function n(e="",t){return"anywhere"===t.queryType?e:A.ZP.getAddedQuery({conjunction:"",condition:"include",ruleName:t.queryType??"anywhere",rule:e})}const i=A.ZP.joinQueries(n(e.query,e),e.queryAddition,e.contactQuery,e.from,e.to,e.cc);if(e.queryFolder||A.ZP.isValidSearch(e)){const s=e.queryOptions,o=e.queryFolder,a=e.attachments,r=e.sentDate,l=e.sentDateEnd,c=o||u.Z.getSelectedFolder(),p={actionType:"MAIL_UPDATE_QUERY_RESULTS",threadPrefix:e.threadPrefix,...c&&{folder:c},filterOptions:s,attachments:a,sentDate:r,sentDateEnd:l,updateScrollPosition:t};!i||i.length<3?f.Z.dispatch({...p,queryResults:d.Z.getIndexSearchListIds()}):ve(i,(function(){const e=u.Z.getOptions(),t=A.ZP.joinQueries(n(e.query??"",e),e.queryAddition,e.contactQuery,e.from,e.to,e.cc);return i!==t})).then((e=>{f.Z.dispatch({...p,queryResults:e})})).catch((()=>{}))}}async function ke(){const e=d.Z.getByAccountId(he.wC),t=de.ZP.mailingListGroupToFilters(e),n=le.Z.getGroups(),i=t.filter((e=>!n.some((t=>t.listId===e.path.split("/")[1]))));await Pe(i,!0)}async function _e(e,t){const n=d.Z.getByAccountId(he.wC),i=de.ZP.mailingListGroupToFilters(n,t);if(le.Z.get(he.ZW)?.isIgnored)await Pe(i,!0);else{const e=de.ZP.mailingListGroupToFilters(n,t),s=[...new Set([...i,...e])];await Pe(s,!1)}}async function Ne(e,t=!1){const n=d.Z.getByAccountId(he.wC),i=de.ZP.mailingListGroupToFilters(n,e);await Pe(i,t)}async function Pe(e,t=!1){let n;if(!t){const t=e.map((e=>A.ZP.getTotalViewIdByFilterId(e.id)));n=d.Z.getListEntryIdsByViewIds(t)}await a.Z.remove(e.map((({id:e})=>e)));const i=new Set;for(const t of e)i.add(t.id);await C.Z.updateFilters([...i]),await G.Z.call({priority:he.Un.LOW,type:"RE_RUN_SLES",searchListIds:n,runMailingLists:!0}),M.Z.filter()}async function De(){await G.Z.call({priority:he.Un.LOW,type:"RE_RUN_SLES",runMailingLists:!0}),M.Z.filter()}function Me(e){f.Z.dispatch({actionType:"MAIL_INDEX_UPDATE",updates:e});const{sleUpdates:t=[]}=e,n=u.Z.getQuery(),i=Ue();let s=!1;const o=new Set(g.Z.get(q.kMailAccounts).filter((e=>e.offline)).map((e=>e.MAIL_EMAIL))),a=new Map,r=new Map,l=[],p=[],h=[];function m(e,t){let n;switch(t.type){case"ADD_LABEL":n=a.get(t.label),n?n.push(e):a.set(t.label,[e]);break;case"REMOVE_LABEL":n=r.get(t.label),n?n.push(e):r.set(t.label,[e]);break;case"MARK_READ":l.push(e);break;case"SET_FLAG":const i=(0,ye.KR)(t.flag);for(const t in i)i[t]?(n=a.get(t),n?n.push(e):a.set(t,[e])):(n=r.get(t),n?n.push(e):r.set(t,[e]));break;case"MARK_AS_SPAM":p.push(e);break;case"ARCHIVE":h.push(e)}}function v(e,t){const n=C.Z.get(e);if(!n)throw new Error("Filter not found "+e);const i=n.triggers;if(i){const e=Ue({accountId:n.accountId,path:n.path,name:n.name,id:A.ZP.toFolderPath(n.accountId,n.path)});for(const n of i)e&&!d.Z.matchesViewIntersection(t.viewIds,e,t.totalViewIds)||m(t,n)}}t.forEach((e=>{const t=d.Z.getListEntry(e.id),{addedViewIds:a,runTriggerFilterIds:r}=e.updates;if(t){if(n&&i&&(s=d.Z.matchesViewIntersection(t.viewIds,i,t.totalViewIds)),g.Z.get(q.kMailNotifications)){const e=a?.some((e=>{if(e%he.XN!=0)return!1;const n=e/he.XN,i=C.Z.get(n);if(!i)return!1;const{accountId:s,path:a}=i;if(o.has(s))return!1;if(!(T.Z.getFolderType(s,a)===he.e9))return!1;const r=(0,be.Ps)(s);return!r||t.sentDate>r}));e&&re.newMail(t)}if(a)for(const e of a){if(e%he.XN!=0)continue;v(e/he.XN,t)}r&&r.forEach((e=>{v(e,t)}))}else _.Z.warn("Mail",["updateIndex"],"ListEntry not found "+JSON.stringify(e))})),s&&Ee(u.Z.getOptions()),a.forEach(((e,t)=>{I.Z.setCustomFlags(e,{[t]:!0})})),r.forEach(((e,t)=>{I.Z.setCustomFlags(e,{[t]:!1})})),l.length>0&&I.Z.setRead(l,!0,!1),p.length>0&&c.Z.moveToJunk(p),h.length>0&&c.Z.moveToArchive(h)}function Oe(e){const t=Date.now(),n=d.Z.getCounterFolders(e);0!==n.length&&(d.Z.getIndex().forEach((e=>{const{viewIds:t,totalViewIds:i}=e;S.Z.updateCounterFolders(t,i,1,n)})),f.Z.dispatch({actionType:"MAIL_UPDATE_COUNTERS",countedFolders:n,deltaValues:!1}),_.Z.log("Mail",["counters"],`updateCounters took ${Date.now()-t}ms.`))}function xe(e,t){const n=u.Z.getOptionsFromHistory(t);f.Z.dispatch({actionType:"MAIL_FOLDER_SELECT_HISTORY_INDEX",historyIndex:t}),A.ZP.isValidSearch(n)?Ge.updateQueryResults(n):n.threadPrefix?Ve(n.threadPrefix,n.query):He(n.queryFolder)}function Le(e,t={}){f.Z.dispatch({actionType:"MAIL_SELECT_FOLDER",folder:e,options:t}),t.threadPrefix?Ve(t.threadPrefix):He()}function Re(e,t){const n={...e,subscribed:t};Le(n,{query:(e&&C.Z.getByFolderId([n.accountId,n.path]))?.filterValue.query||""})}function Be(e){if(e.accountId!==he.Ry)return e;const t=e.path.indexOf("/"),n=e.path.slice(0,t),i=e.path.slice(t+1);return{...e,accountId:n,path:i}}async function Fe(e,t,n,i){let s=!1;(0,Se.mq)(n)&&(s=await async function(){return new Promise((t=>{h.Z.showMailUploadConfirmation(e,n,t)}))}());let o=0,a=0;for(const r of t){const l=await L.Z.mailPrivate.getFullPath(r.filesystem.name,r.fullPath);m.Z.setStatus(e,(0,v.Z)("Importing message from file $1",[l]));try{const{numAdded:r,numFailed:d}=await U(e,l,n,i,s,1===t.length);o+=r,a+=d}catch(t){m.Z.setStatus(e,(0,v.Z)("Failed to import mail file: $1",[t])),_.Z.error("Mail",["import file",n,i],t)}}const r=(0,v.Z)("Finished importing $1 message.","Finished importing $1 messages.",[o]);let l=r;if(a>0){l=`${r} ${(0,v.Z)("Failed adding $1 message. See logs in Mail Status for details.","Failed adding $1 messages. See logs in Mail Status for details.",[a])}`}h.Z.showModalInfo(e,{title:(0,v.Z)("Mail Import File"),body:l})}function We(e,t,n){let i="",s=[];const a=t?o.Z.getNodeById(t):void 0;n?(s=[n],i=n):a&&(i=a.name,s=a.emailAddresses.map((e=>e.emailAddress)));const r={accountId:he.of,path:he.ym,id:i,name:i},l={forSender:n,forContact:t,contactQuery:A.ZP.getContactQuery(s,new Set(["to","from"])),queryFolder:r,queryType:"anywhere"};f.Z.dispatch({actionType:"MAIL_SELECT_FOLDER",folder:r,options:l}),Ge.updateQueryResults(l)}function Ue(e){if(e||(e=u.Z.getSelectedFolder()),!e)return;const{accountId:t,path:n=he.ym}=e,i=d.Z.getByFolder(t,n);return i?A.ZP.getViewIntersections(i):void 0}function Ve(e,t){f.Z.dispatch({actionType:"MAIL_SELECT_THREAD",threadPrefix:e,query:t})}function He(e){f.Z.dispatch({actionType:"MAIL_INIT_MESSAGES",folderIntersections:Ue(e)})}const Ge={init:function(){C.Z.addListener((e=>{"updateFilters"===e.target&&Ge.updateFilters(e.filterIds)}))},updateThreadKeys:function(e){f.Z.dispatch({actionType:"MAIL_UPDATE_THREAD_KEYS",updates:e})},getSelectedFilter:we,markSeenReadDebounced:Ce,setDisconnected:function(e,t){f.Z.dispatch({actionType:"MAIL_IS_DISCONNECTED",accountId:e,isDisconnected:t})},setConnecting:function(e,t){f.Z.dispatch({actionType:"MAIL_IS_CONNECTING",accountId:e,isConnecting:t})},setSyncing:function(e,t){f.Z.dispatch({actionType:"MAIL_IS_SYNCING",accountId:e,isSyncing:t})},setSyncingFlags:function(e,t){f.Z.dispatch({actionType:"MAIL_IS_SYNCING_FLAGS",accountId:e,isSyncingFlags:t})},setPreFetching:function(e,t){f.Z.dispatch({actionType:"MAIL_IS_PRE_FETCHING",accountId:e,isPreFetching:t})},pausePrefetching:function(e,t){t||l.Z.canResumePrefetch(e)?(f.Z.dispatch({actionType:"MAIL_PAUSE_PRE_FETCHING",requester:e,pause:t}),r.Z.pausePrefetching(t)):_.Z.info("Mail",["resume prefetching"],`Can not resume prefetching for ${e} as it is also paused for another requester`)},markAllReadCmd:function(){const e=u.Z.getSelectedFolder();let t;if(e){const{accountId:n,path:i}=e;t=d.Z.getByFolderId([n,i])}Ae(d.Z.getListEntries().filter((e=>!V.Z.call(e.sources,t))))},markAllRead:function(e,t){const n=e===he.Ry&&t!==he.ym?A.ZP.fromCustomFolderPath(t):[e,t],i=d.Z.getListEntriesByFolder(...n),s=d.Z.getByFolderId(n);if(!s)throw new Error("Filter not found");Ae(i.filter((e=>!V.Z.call(e.sources,s))))},markAllListEntriesRead:Ae,pushUndoItem:Ie,removeAccount:async function(e,t,n,i){await w.Z.transaction("rw",[w.Z.buffer,w.Z.accounts],(async()=>{await(0,H.Z)({accountId:e,path:"",operation:"BUFFER_OPERATION_REMOVE_ACCOUNT",deleteFiles:t,deletePasswords:n}),await w.Z.accounts.delete(e)})),i===he.s9.IMAP&&await r.Z.disconnectIMAPClient(e),await y.Z.removeAccount(e),M.Z.removeFolders(e),s.Z.flushBuffer(),(0,fe.l)(e,"mail")},removeAccountPath:Te,setSearchOptions:function(e){f.Z.dispatch({actionType:"MAIL_SEARCH_SET_OPTIONS",options:e})},addLabelsFilter:async function(e){const t={name:e,accountId:he.ut,path:e,filterValue:{include:[[{flag:e}]],...A.ZP.getSearchListButtons(he.ut)}},n=await a.Z.add(t,he.Un.NORMAL);await C.Z.updateFilters(n)},addFilter:async function(e,t=!0,n){const{query:i}=e.filterValue;let s;i&&!n&&(n=await(0,ue.Z)(i),s=!0);const o=await w.Z.transaction("rw",[w.Z.filters,w.Z.filteringQueue],(async()=>t?await a.Z.add(e,he.Un.LOW,n,s):await a.Z.add(e)));return await C.Z.updateFilters(o),t&&M.Z.filter(),o},putFilter:async function(e,t,n){const i=n||function(e,t){if(e.filterValue.query!==t.filterValue.query)return!0;const{filterValue:n}=e,{filterValue:i}=t;return!(0,ge.Z)(n.include,i.include)||!(0,ge.Z)(n.exclude||[],i.exclude||[])||n.sentDate!==i.sentDate||n.sentDateEnd!==i.sentDateEnd||n.attachments!==i.attachments||!(0,ge.Z)(e.triggers||[],t.triggers||[])}(e,t),s=await w.Z.transaction("rw",[w.Z.filters,w.Z.filteringQueue],(async()=>{const t=await a.Z.put(e);return i&&G.Z.call({type:"RUN_FILTERS",priority:he.Un.LOW,filterIds:[e.id],triggerFilterIdCandidates:[e.id]}),t}));await C.Z.updateFilters(s),i&&M.Z.filter()},removeFilter:async function(e){await a.Z.remove([e]),C.Z.updateFilters([e]),M.Z.filter()},rerunFilter:async function(e,t){await G.Z.call({type:"RUN_FILTERS",priority:he.Un.LOW,folderIds:[[e,t]]}),M.Z.filter()},reSyncFolder:async function(e,t){(0,Se.mq)(e)&&await r.Z.reSyncFolder(e,t)},reSyncAccount:async function(e){(0,Se.mq)(e)&&await r.Z.reSyncAccount(e)},reconnectAccount:async function(e){(0,Se.mq)(e)&&await r.Z.reconnectIMAPClient(e)},runStoredQueryFilters:async function(e){const t=d.Z.getByAccountId(he.Kz);if(0===t.length)return;const n=t.map((e=>[e.accountId,e.path]));await G.Z.call({type:"FILTERS_SLES",priority:he.Un.NORMAL,folderIds:n,searchListIds:e}),M.Z.filter()},updateFilters:async function(e){f.Z.dispatch({actionType:"MAIL_FILTERS_CHANGED",filterIds:e});const t=[];e.forEach((e=>A.ZP.getAllViewTypes().forEach((n=>t.push(e*he.XN+n))))),Oe(t)},toggleMoveToOther:async function(e){const t=e.path;let n,i,s;t.startsWith(he.cs)?(i=he.W4,n=he.cs,s=t.substr(he.cs.length+1)):(i=he.cs,n=he.W4,s=t.substr(he.W4.length+1));const o=await a.Z.move(e.accountId,n,i,s);await C.Z.updateFilters(o),Ge.selectFolder({...e,path:[i,s].join("/"),id:he.jT+"_"+[i,s].join("/")},u.Z.getOptions()),M.Z.filter()},removeMailingListFilter:async function(e,t){const n=t.filterValue.include,i=n&&n[0],s=i&&i[0];if(s?.listId){const e=s.listId,n={listId:e,name:e,parentFolderType:"matches",subFolderType:"none",isIgnored:!0};await M.Z.updateMailingListGroup(n),await a.Z.remove([t.id]),await C.Z.updateFilters([t.id]),f.Z.dispatch({actionType:"MAILING_LIST_GROUP_CHANGED",mailingListGroup:n}),M.Z.filter()}else s?.senderIsMailingList&&await Ze(e,s.senderIsMailingList)},toggleSenderAsMailingList:Ze,addSearchToHistory:function(e){if(!A.ZP.isMailSearching(u.Z.getOptions())){const t=u.Z.getSelectedFolder();let n,i;if(t&&"current"===g.Z.get(q.kMailSearchFolder)){n=t;const e=C.Z.getByFolderId([n.accountId,n.path]);i=A.ZP.getFilterOptions(e)}else{const e=u.Z.getSelectedFolder()?.accountId===he.u4,t=A.ZP.getDefaultFilterForPath(e?he.u4:he.of,he.ym);i=A.ZP.getFilterOptions(t),n={name:t.accountId,accountId:t.accountId,path:t.path,id:he.i4+"_"+t.accountId}}Ge.setSearchOptions({forContact:e.forContact,forSender:e.forSender,threadPrefix:e.threadPrefix}),Le(t||n,e={queryFolder:n,queryOptions:i,...e})}Ge.setSearchOptions(e),Ge.updateQueryResults(e,!0)},updateQueryResults:Ee,changeQuery:function(e){f.Z.dispatch({actionType:"MAIL_QUERY_CHANGE",query:e})},clearQuery:function(){f.Z.dispatch({actionType:"MAIL_CLEAR_QUERY"})},clearSearch:function(){f.Z.dispatch({actionType:"MAIL_CLEAR_SEARCH"})},showMailSearchOptions:function(){f.Z.dispatch({actionType:"SHOW_MAIL_SEARCH_OPTION"})},regenerateUncategorizedMailingLists:ke,regenerateAllMailingLists:async function(){const e=d.Z.getByAccountId(he.wC),t=de.ZP.mailingListGroupToFilters(e);await Pe(t,!0)},regenerateExistingMailingListGroup:_e,regenerateMailingListGroup:Ne,regenerateMailingLists:Pe,refreshMailingList:De,removeMailingListGroup:async function(e){await M.Z.removeMailingListGroup(e),await Ne(e),f.Z.dispatch({actionType:"MAILING_LIST_GROUP_CHANGED",mailingListGroup:e})},removeIgnoredMailingList:async function(e){await M.Z.removeMailingListGroup(e),await De(),f.Z.dispatch({actionType:"MAILING_LIST_GROUP_CHANGED",mailingListGroup:e})},initIndex:async function(){const e=await w.Z.searchList.count();let t=1e3,n=-1;await async function i(){const s=Date.now(),[o,a]=await Promise.all([w.Z.searchList.where("id").above(n).limit(t).toArray(),w.Z.viewIds.where("searchListId").above(n).limit(t).toArray()]);if(f.Z.dispatch({actionType:"MAIL_INIT_INDEX_BATCH",sleBatch:o,viewIdsBatch:a,total:e}),o.length===t){const{id:e}=o[t-1];n=e;const a=Date.now();t=b.Z.adjustBatchSize(1e3,1e5,50,t,a-s),await i()}}(),f.Z.dispatch({actionType:"MAIL_INIT_INDEX_FINISHED"})},updateIndex:Me,updateMailingListGroupName:async function(e){await M.Z.updateMailingListGroup(e);const t=await a.Z.updateName([[he.wC,he.W4+"/"+e.listId],[he.wC,he.cs+"/"+e.listId]],e.name);C.Z.updateFilters(t),f.Z.dispatch({actionType:"MAILING_LIST_GROUP_CHANGED",mailingListGroup:e})},updateMailingListGroup:async function(e){const t=le.Z.get(e.listId);if(await M.Z.updateMailingListGroup(e),"uncategorized"===e.parentFolderType)await ke();else if(t?.isIgnored&&!e.isIgnored)await De();else if(t)await _e(0,e);else{const t=!0;await Ne(e,t)}f.Z.dispatch({actionType:"MAILING_LIST_GROUP_CHANGED",mailingListGroup:e})},stop:function(){f.Z.dispatch({actionType:"MAIL_STOP"})},setAccountIndicator:function(e,t,n=0,i=0,s=0){f.Z.dispatch({actionType:"MAIL_INDICATOR_ADD_ACCOUNT",accountId:e,indicatorType:t,priority:n,current:i,total:s})},setPathIndicator:function(e,t,n,i,s,o){f.Z.dispatch({actionType:"MAIL_INDICATOR_ADD_PATH",accountId:e,path:t,indicatorType:n,priority:i,current:s,total:o})},removeAccountIndicator:function(e,t){f.Z.dispatch({actionType:"MAIL_INDICATOR_REMOVE_ACCOUNT",accountId:e,indicatorType:t})},removePathIndicator:function(e,t){f.Z.dispatch({actionType:"MAIL_INDICATOR_REMOVE_PATH",accountId:e,path:t})},removeAllIndicators:function(e){f.Z.dispatch({actionType:"MAIL_INDICATOR_REMOVE_ALL",accountId:e})},updateCounters:Oe,pageForward:function(e){if(u.Z.canGoForward()){xe(e,u.Z.getHistoryIndex()+1)}},pageBack:function(e){if(u.Z.canGoBack()){xe(e,u.Z.getHistoryIndex()-1)}},selectFolderFromHistory:xe,selectFolder:Le,selectFolderOnSubscriptionChange:Re,getImapFolderFromCustomFolder:Be,importMailFiles:Fe,selectAndImportMailFiles:async function(e,t){const n=await(0,ce.Z)(e,["eml","mbs","mbox"]),{accountId:i,path:s}=t;Fe(e.vivaldiWindowId,n,i,s)},subscribeMailbox:async function(e,t){const n=Be(t);Re(n,!0);try{await r.Z.subscribeMailbox(n)}catch(i){Re(n,!1),m.Z.setStatus(e,(0,v.Z)("Failed to subscribe to mailbox: $1",[i])),_.Z.error("Mail",["subscribeMailbox",t.accountId,t.path],i)}},unsubscribeMailbox:async function(e,t,n){const i=Be(t);try{Re(i,!1);try{await r.Z.unsubscribeMailbox(i,n)}catch(e){throw Re(i,!0),e}n&&Te(i.accountId,i.path)}catch(n){m.Z.setStatus(e,(0,v.Z)("Failed to unsubscribe from mailbox: $1",[n])),_.Z.error("Mail",["unsubscribeMailbox",t.accountId,t.path],n)}},selectThread:function(e){const t=[e.threadKey[0],e.threadKey[1]];Le({accountId:he.tQ,path:String(t),id:String(t),name:e.subject},{threadPrefix:t})},rerunThreading:async function(e,t){const n=y.Z.getFolderName(e,t);m.Z.setStatus(me.A4,(0,v.Z)("Re-threading - $1 $2",[e,n]),5e3);const i=C.Z.getByFolderId([e,t]);if(!i)throw new Error(`Filter not found for ${e} ${n}`);const o=A.ZP.getTotalViewIdByFilterId(i.id),a=d.Z.getListEntryIdsByViewIds([o]);await(0,$.Z)(a),s.Z.updateThreads()},selectContactById:function(e,t){We(e,t)},selectContactByAddress:function(e,t){We(e,void 0,t)},selectContactByIdAndAddress:function(e,t,n){We(e,t,n)},selectContact:We,sortListEntries:function(){if(f.Z.dispatch({actionType:"MAIL_SORT_LIST_ENTRIES"}),u.Z.getQuery()){const e=u.Z.getOptions();Ge.updateQueryResults(e)}},getViewIntersections:Ue,undo:function(e){if(e||(e=p.Z.getLatestUndoAction()),!e)return;const{undoItem:t}=e;switch(t.operation){case"setFlags":Ge.undoSetFlags(t);break;case"delete":Ge.undoDelete(t)}f.Z.dispatch({actionType:"MAIL_UNDO_DELETE_ITEM",undoAction:e})},undoSetFlags:function(e){const{updates:t,searchListIds:n,sourcesPerSle:i}=e;if(0===n.size)return;const s=d.Z.getListEntriesByIds(n),{sleUpdates:o}=I.Z.setCustomFlags(s,t,i);Me({sleUpdates:o})},undoDelete:function(e){const{searchListIds:t,markUnread:n}=e,i=d.Z.getListEntriesByIds(t);(0,pe.Z)(i,n)},fetchPreviews:async function(e){await Promise.all(e.map((e=>(0,H.Z)({operation:"BUFFER_OPERATION_FETCH_RAW_FOR_ALL_SOURCES",searchListId:e})))),await s.Z.flushBuffer()}},$e=Ge},43623:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var i=n(33638);const s={set:function(e,t,n,s,o){i.Z.dispatch({actionType:"MAIL_ERROR_SET",accountId:e,category:t,error:n,code:s,level:o})},remove:function(e,t){i.Z.dispatch({actionType:"MAIL_ERROR_DELETE",category:t,accountId:e})}}},97698:(e,t,n)=>{"use strict";n.d(t,{Z:()=>X});var i=n(2711),s=n(4660),o=n(99827),a=n(88630),r=n(43623),l=n(98611),d=n(60331),c=n(56371),u=n(24600),p=n(45660),h=n(5863),g=(n(20244),n(6271));let m=!1;async function f(e){if(e.useOAuth){const t=await async function(e){const{accessToken:t}=await i.Z.getOAuthAccessToken(e.MAIL_EMAIL,(0,g.dn)(e));return{user:e.MAIL_EMAIL,xoauth2:t}}(e);return(0,u.Z)(e,t)}return(0,u.Z)(e)}const v=function(e,t,n,i){if(this.alreadySending)return void p.Z.log("Mail",["smtp","onidle"],`[${e.MAIL_EMAIL}]Already Sending!`);p.Z.log("Mail",["smtp","onidle"],`[${e.MAIL_EMAIL}]`),this.alreadySending=!0;const s=[...t,...n,...i].map((e=>e.address));this.useEnvelope({from:e.MAIL_EMAIL,to:s})},y=function(e,t,n){p.Z.log("Mail",["smtp","onready"],"failedRecipients:",n.length),n.length>0?t({message:(0,c.Z)("Rejected recipients: $1",[n.join()])}):(this.send(e),this.end())},b=function(e,t,n,i,s){p.Z.log("Mail",["smtp","ondone"],`subject:"${t}" success:${s}`),m=!1,s?d.Z.setStatus(e,(0,c.Z)("Sent message: $1",[t]),h.QM):d.Z.setStatus(e,(0,c.Z)("Failed to send message: $1",[t])),this.quit(),s?n():i((0,c.Z)("Failed to send message: $1",[t]))},S=function(e,t,n,i){i||m?(p.Z.log("Mail",["smtp","onclose"],"Closed because of an error!"),d.Z.setStatus(e,(0,c.Z)("Failed to send message")),m=!1,n({message:(0,c.Z)("SMTP client closed on error")})):(p.Z.log("Mail",["smtp","onclose"],""),t())},w=function(e,t,n,s){p.Z.log("Mail",["smtp","onclose"],`[${t.MAIL_EMAIL}]${s.message}`),t.useOAuth&&i.Z.fetchAccessTokenAndRefreshToken(t.MAIL_EMAIL,(0,g.dn)(t)),m=!1;const o=t.MAIL_SMTP_SERVER||"",a=t.MAIL_SMTP_USER||"";d.Z.setStatus(e,(0,c.Z)("$1 - Server: $2 - User: $3",[s.message,o,a])),this.quit(),n(s)},C={send:function(e,t,n,i,s,o,a){return p.Z.log("Mail",["smtp","send"],`[${t.MAIL_EMAIL}]subject:"${n}"`),-1===t.MAIL_SMTP_PORT?(console.warn("not gonna send as the smtp port is missing"),d.Z.setStatus(e,(0,c.Z)("SMTP client not configured for sending mail")),Promise.reject()):(d.Z.setStatus(e,(0,c.Z)("Sending")),new Promise(((r,l)=>{f(t).then((d=>{m=`subject: ${n||""}, from: ${t.MAIL_EMAIL}`,d.onidle=v.bind(d,t,i,s,o),d.onready=y.bind(d,a,l),d.ondone=b.bind(d,e,n,r,l),d.onerror=w.bind(d,e,t,l),d.onclose=S.bind(d,e,r,l),d.connect()})).catch((e=>l(e)))})))}};var A=n(46382),I=n(68247),T=n(29087),Z=n(78347),E=n(45709),k=n(97823),_=n(21285),N=n(61839);var P=n(68906),D=n(33956),M=n(6977),O=n(55346),x=n(93818),L=n(89846),R=n(24651),B=n(5204),F=n(30628),W=n(40382),U=n(77312),V=n(27569),H=n(89175),G=n(8684);let $=!1;async function K(e,t){t||(e.queued=!0);const n=await async function(e){const{addedSles:t,forSearchDb:n}=await(0,_.Z)(h.of,h.J8,h.fZ,[e],{filteringPriority:h.Un.HIGH});(0,N.Z)(n);const[i]=t;if(!i)throw new Error("Failed to store message in outbox folder");return i}(e);return o.Z.updateIndex({addedSles:[n]}),B.Z.filter(),i.Z.updateThreads(),n}async function z(e,t){if(!t.from||0===t.from.length)throw new Error((0,c.Z)("Can not send. No sender specified!"));const n=await k.Z.loadAllAccountsAndAliases(),l=t.from.map((e=>e.address)),d=n.find((e=>e.MAIL_EMAIL===l[0]));if(!d)throw new Error((0,c.Z)("Can not send. No account set up for sender $1",[l[0]]));const u=k.Z.getAccountIdForEmail(d.MAIL_EMAIL)||d.MAIL_EMAIL,g=Z.Z.getFoldersOfType(u,h.Nz);let m,f,v=!1;g.length?(m=u,f=g[0].path,v=!0):(m=h.of,f=h.N1);let y=0;if(t.bodyParts?.forEach((e=>{e.fileSize?y+=e.fileSize:y+=e.content.length})),y>h.gh){const{action:t}=await A.Z.showModal(e,{modal:{title:(0,c.Z)("A Large Message in Outbox"),body:(0,c.Z)("A large message ($1MB) is about to be sent. The mail servers might not accomodate it and sending may fail.",[Number(y/1e6).toFixed(1)]),actions:[{title:(0,c.Z)("mail","Send anyway"),action:"continue"}],cancelAction:{title:(0,c.Z)("mail","Do not send"),action:"cancel",default:!0}}});if("cancel"===t)return void p.Z.log("Mail",["outbox"],"Sending of large message cancelled by user")}const b=t.bodyParts&&t.bodyParts[0];if(!b)throw new Error("No bodyPart found in message");const S=b.content;if("string"!=typeof S)throw new Error("The first bodyPart must be of type string, it is of type: "+typeof S);const w=1e3*Math.floor(Date.now()/1e3),_=(0,V.yN)(t.bodyParts),N=await a.Z.build({...t,sentDate:w},S,_),{id:O,subject:F,to:G,cc:$,bcc:K}=t;try{await C.send(e,d,F,G,$,K||[],N),r.Z.remove(d.MAIL_EMAIL,"SMTP")}catch(e){throw r.Z.set(d.MAIL_EMAIL,"SMTP",e),e}const z={searchList:{sentDate:w},messages:{sentDate:w},threading:{sentDate:w}},j={searchList:["queued"]};v&&(await(0,W.Z)(u,w,t.id,N),await R.Z.setHasRaw(u,t.id),j.messages=["bodyParts"],await(0,U.fN)(O));const Y={addedProperties:z,removedProperties:j,filteringPriority:h.Un.HIGH},{sleUpdate:X}=await(0,L.Z)(t.id,h.of,h.J8,m,f,Y);m!==h.of&&P.Z.call({type:"FILTERS_SLES",priority:h.Un.HIGH,searchListIds:[t.id],folderIds:[[h.of,h.N1]]}),await(0,D.Z)([t.id]),o.Z.updateIndex({sleUpdates:[X]}),B.Z.filter(),I.Z.set(H.kMailLastSentFrom,d.MAIL_EMAIL),v&&d.accountType===h.s9.IMAP&&(d.uploadSent??1)?(await M.Z.addUpload([{accountId:u,path:f,searchListId:t.id,flags:[h.T4.SEEN]}]),i.Z.flushBuffer()):d.accountType===h.s9.IMAP&&(d.uploadSent??1)&&console.warn("No sent folder found for account",u);const Q=t.forwarded||t.replied;if(void 0!==Q){const e=await(0,x.Z)(Q);if(!e)return void console.warn(`Referenced message with id ${Q} not found`);const{sleUpdates:n}=t.forwarded?E.Z.setForwarded([e],!0):E.Z.setReplied([e],!0);o.Z.updateIndex({sleUpdates:n})}T.Z.get(H.kMailAutoGenerateContacts)&&s.Z.addIfNotAddressExists(t.to)}async function j(e,t,n){if(0===t.length)return void d.Z.setStatus(e,(0,c.Z)("No messages to send"),2e3);if($)return;$=!0;let i=0,s=0;const o=l.Z.getByFolder(h.of,h.J8);if(o){d.Z.setStatus(e,(0,c.Z)("Preparing to send $1 message","Preparing to send $1 messages",[t.length]),2e3);try{for(const a of t){const t=a.sources.get(o.id);if(t&&!t.deleted&&(n||!a.queued)){const t=await O.Z.call(a.id);if(t)try{await z(e,t),++i}catch(e){++s,p.Z.error("Mail",["outbox"],"Failed to send:",e.message||e)}}}if(i+s>0){const t=[];i>0&&t.push((0,c.Z)("$1 message successfully sent","$1 messages successfully sent",[i])),s>0&&t.push((0,c.Z)("Failed to send $1 message","Failed to send $1 messages",[s])),(s>0||T.Z.get(H.kMailNotifications)&&T.Z.get(H.kMailNotificationsOnSuccessfullySent))&&(0,G.c)({title:(0,c.Z)("Sending mail"),body:t.join("\n"),icon:"resources/mail_notification_icon.png",timeout:3e4,tag:"VIVALDI_MAIL_OUTBOX_SENT_MESSAGES"}),d.Z.setStatus(e,t.join(" ")),p.Z.info("Mail",["outbox"],t.join(" "))}}catch(e){p.Z.error("Mail",["outbox"],e)}finally{$=!1}}else p.Z.error("Mail",["outbox"],"Outbox filter missing!")}const Y={sendAll:function(e,t=!0){F.Z.m3GetAll().then((n=>j(e,n,t)))},sendExternalMessage:async function(e,t,n=!0){const i=await K(t,n);n&&Y.sendSelected(e,[i])},sendForAccount:function(e,t){F.Z.m3GetAll().then((n=>j(e,n.filter((e=>e.from&&e.from[0]&&e.from[0].address===t)),!0)))},sendSelected:function(e,t){j(e,t,!0)},storeMessage:K},X=Y},2431:(e,t,n)=>{"use strict";n.d(t,{J:()=>D,Z:()=>U});var i=n(72010),s=n(13933),o=n(98611),a=n(54162),r=n(59322),l=n(96951),d=n(29087),c=n(15489),u=n(56371),p=n(71320),h=n(10671),g=n(88951),m=n(50399),f=n(97823),v=n(55346),y=n(93818),b=n(30381),S=n.n(b),w=n(51370),C=n(5863),A=n(44850),I=n(27569),T=n(78614),Z=n(89175),E=n(97781);function k(e){const t=o.Z.getListEntry(e.id),n=t?t.sourceFilterIds.map((e=>p.Z.get(e))):[],i=n.some((e=>e&&h.Z.getFolderType(e.accountId,e.path)===C.Nz)),s=n.some((e=>e&&h.Z.getFolderType(e.accountId,e.path)!==C.Nz));let a;return a=i&&!s?e.to:e.replyTo&&e.replyTo.length>0?e.replyTo:e.from,a}function _(e){const{listPost:t}=e,n=t.match(/mailto:\s*([^>,]+)/);return n?[{address:n[1]}]:[]}function N(e){const t=f.Z.getAccountsAndAliases()||[],{from:n,to:i,replyTo:s,cc:o}=e;return{uniqueTo:(0,T.Yn)(...s,...n,...i).filter((e=>t.every((t=>t.MAIL_EMAIL!==e.address)))),uniqueCc:(0,T.Yn)(...o).filter((e=>t.every((t=>t.MAIL_EMAIL!==e.address))))}}function P(e,t,n,i,s){const{inReplyTo:o,references:a}=O(e),{bodyParts:r=[],listId:l,listPost:d}=e,c=F(r),[p,,h]=B(e),g=function(e,t,n,i){if(t=(0,I.$P)(n,t)){const s=S()(e.sentDate).format("LLLL (Z)"),o=e.from,a=o.length>0?o[0].name||o[0].address:"unknown",r=n?"\n\n":"<br><br>",l=(0,u.Z)("On $1, $2 wrote:",[s,a])+r;return n?i+r+l+"> "+t.replace(/\r?\n/g,"\n> "):`${i}${r}${l}<blockquote style="margin: 0 0 0.80ex; border-left: #0000FF 2px solid; padding-left: 1ex">${t}</blockquote>`}return i}(e,p,c,i),{selectedAccount:m,from:f,messageId:v}=W(e),y=Date.now();return{selectedAccount:m,messageId:v,from:f,subject:R(e,"Re: "),sentDate:y,threadKey:[y,e.id,y],attachments:[],to:t,cc:n,bcc:[],plaintext:c,cidAttachments:h,body:g,listId:l,listPost:d,inReplyTo:o,references:a,focusOnBody:!0,replied:e.id,fromDraft:!1,replyScope:s}}function D(e){const{from:t,messageId:n,selectedAccount:i}=W(void 0,"account");return{bcc:[],body:"",cc:[],subject:"",to:[],...(0,w.Z)(e),attachments:[],from:t,messageId:n,plaintext:!0,selectedAccount:i,sentDate:Date.now(),listId:"",listPost:"",replyScope:""}}function M(e,t){const{bodyParts:n=[]}=e,i=F(n),[s,o,a]=B(e),{listId:r,listPost:l,inReplyTo:d,references:c,messageId:u,to:p,cc:h,bcc:g,subject:m,sentDate:f,replied:v}=e,{selectedAccount:y,from:b}=W(e,"message");return{plaintext:i,attachments:o,cidAttachments:a,body:s,listId:r,listPost:l,inReplyTo:d,references:c,messageId:u,to:p,cc:h,bcc:g||[],subject:m,sentDate:f,selectedAccount:y,from:[...b],threadKey:t,replied:v,replyScope:""}}function O(e){const{messageId:t,inReplyTo:n,references:i}=e,s={inReplyTo:t,references:i?i.slice():[]};return 0===s.references.length&&n&&s.references.push(n),t&&s.references.push(t),s}async function x(e){const t=c.ZP.getMailWindowId(),n=L(e);await r.ZP.openURL(t,n,{singleton:Boolean(e)})}function L(e){return A.jk.internalUrl("mailpage","composer/draft",(0,u.Z)("Mail - Draft"),e?JSON.stringify({id:e}):void 0)}function R(e,t=""){if(!e)return"";const n=e.subject||"";return 0===n.toLowerCase().indexOf(t.toLowerCase())?n:t+n}function B(e){const{bodyParts:t=[]}=e,n=(0,m.Z)(!0,t),s=(0,I.yN)(t);return"html"===n?.type?function(){const o={};s.forEach((e=>{e.id&&(o["cid:"+e.id]=e)}));const a=(c=e.from,c&&c.length>0&&i.Z.isTrustedEmailAddress(c[0].address)),r=(0,E.Nw)(n?.content??"",{attachments:o,blockHTTPLeaks:!e.trusted&&!a}),{attachments:l,cidAttachments:d}=function(e){const t=[],n=[];return(0,I.yN)(e).forEach((e=>{if(e.inUse)n.push(e);else{const{id:n,inUse:i,...s}=e;t.push(s)}})),{attachments:t,cidAttachments:n}}(t);var c;return[r.sanitized,l,d]}():(s.forEach((e=>{e.id&&delete e.id})),[n?.content??"",s,[]])}function F(e){const t=(0,m.Z)(!0,e);return!t||"html"!==t.type}function W(e,t){const n=d.Z.get(Z.kMailDefaultAccount)||C.Y6,i=d.Z.get(Z.kMailLastSentFrom),s=f.Z.getAccountsAndAliases();let r,l,c;if(s.length>0){if("account"===t){const e=a.Z.getSelectedFolder();if(e?.accountId&&(r=s.find((t=>t.MAIL_EMAIL===e.accountId))),!r&&e?.accountId===C.Ry){const t=e?.path.split("/")[0];r=s.find((e=>e.MAIL_EMAIL===t))}}else if(e){const{from:n,to:i}=e,a=n.map((e=>e.address)),l=i.map((e=>e.address));if("message"===t?a.length>0&&(r=s.find((e=>a.includes(e.MAIL_EMAIL)))):l.length>0&&(r=s.find((e=>l.includes(e.MAIL_EMAIL)))),!r){const t=o.Z.getSourceFilters(e.id),n=new Set(t.map((e=>e.accountId)));r=s.find((e=>n.has(e.MAIL_EMAIL)))}}!r&&n===C.Y6&&i&&(r=s.find((e=>e.MAIL_EMAIL===i))),r||n===C.Y6||(r=s.find((e=>e.MAIL_EMAIL===n))),r||(r=s[0])}return r?(l=[{name:r.MAIL_NAME,address:r.MAIL_EMAIL}],c=(0,g.Z)(r.MAIL_EMAIL)):(l=[],c=(0,g.Z)()),{selectedAccount:r,from:l,messageId:c}}const U={closeComposer:function(e,t){const n=L(t);r.ZP.closeUrl(e,n)},createDraft:async function(e={}){const{selectedAccount:t,from:n,messageId:i}=W(void 0,"account"),{to:o,cc:a,bcc:r,subject:l="",body:d=""}=e;if(!t)return;const c={selectedAccount:t,messageId:i,subject:l,body:d,from:[...n],sentDate:Date.now(),to:o||[],cc:a||[],bcc:r||[],plaintext:!0,attachments:[],fromDraft:!1,listId:"",listPost:"",replyScope:""};s.Z.set(c),await x()},createDraftFromParsedMessage:function(e){const{bodyParts:t=[]}=e,n=F(t),[i,o,a]=B(e),{selectedAccount:r,from:l,messageId:d}=W(e,"message"),{to:c,cc:u,bcc:p}=e,h={to:c,cc:u,bcc:p||[],sentDate:Date.now(),subject:R(e),plaintext:n,attachments:o,cidAttachments:a,body:i,focusOnBody:!0,selectedAccount:r,from:[...l],messageId:d,fromDraft:!1,listId:"",listPost:"",replyScope:""};s.Z.set(h),x()},forward:async function(e){const{inReplyTo:t,references:n}=O(e),{bodyParts:i=[]}=e,o=F(i),[a,r,l]=B(e),d=function(e,t){const n=S()(e.sentDate).format("LLLL (Z)"),i=(0,T.Rz)(e.from),s=(0,T.Rz)(e.to),o=(0,T.Rz)(e.cc);let r=`\n\n----- ${(0,u.Z)("Forwarded message")} -----\n`;i&&(r+=(0,u.Z)("From: $1",[i])+"\n");s&&(r+=(0,u.Z)("To: $1",[s])+"\n");o&&(r+=(0,u.Z)("Cc: $1",[o])+"\n");e.subject&&(r+=(0,u.Z)("Subject: $1",[e.subject])+"\n");return r+=(0,u.Z)("Date: $1",[n])+"\n\n\n",(t?r:r.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>"))+a}(e,o),{selectedAccount:c,from:p,messageId:h}=W(e),g=Date.now(),m={selectedAccount:c,messageId:h,from:[...p],sentDate:g,threadKey:[g,e.id,g],to:[],cc:[],bcc:[],subject:R(e,"Fwd: "),plaintext:o,attachments:r,cidAttachments:l,body:d,listId:"",listPost:"",inReplyTo:t,references:n,forwarded:e.id,fromDraft:!1,replyScope:""};s.Z.set(m),await x()},open:function(e,t){const n=M(e,t);s.Z.set(n),x(e.id)},prepareDraft:async function(e){const[t,n]=await Promise.all([v.Z.call(e),(0,y.Z)(e)]);if(!t||!n)return!1;const i=M(t,n.threadKey);return s.Z.set(i),!0},reply:async function(e){const t=P(e,k(e),[],"","sender");s.Z.set(t),await x()},replyToAll:async function(e){const{uniqueTo:t,uniqueCc:n}=N(e),i=P(e,[...t],[...n],"","all");s.Z.set(i),await x()},replyToList:async function(e){const t=P(e,_(e),[],"","list");s.Z.set(t),await x()},closeMailPages:function(){const e=A.xy.mailpage,t=l.ZP.filterPagesInAllWindows((t=>t.url.startsWith(e)));r.ZP.closePage(t)},createQuickReply:function(e,t,n){let i,s;if(n){const{uniqueTo:t,uniqueCc:n}=N(e);i=t,s=n}else i=k(e),s=[];return P(e,i,s,t,n?"all":"sender")},getTo:k,getUniqueReceivers:N,getListPostAddress:_}},46382:(e,t,n)=>{"use strict";n.d(t,{Z:()=>S});var i=n(12442),s=n(59322),o=n(29087),a=n(33638),r=n(63153),l=n(15489),d=n(56371),c=n(2497),u=n(7064),p=n(1407),h=n(12964),g=n(89175),m=n(44850);const f="window.html";let v;function y(e){const{screen:t}=(0,c.Z)(e),n=Math.max(o.Z.get(g.kSettingsSizeWidth),p.MK),i=Math.max(o.Z.get(g.kSettingsSizeHeight),p.mR),s=o.Z.get(g.kSettingsSizeLeft),a=o.Z.get(g.kSettingsSizeTop),r=i<=t.height?i:t.height;let l=s>=0?s:t.availLeft+n/2,d=a>=0?a:t.availTop+(t.height-i)/2;d<0&&(d=0);l+n>t.availLeft+t.width&&(l=t.availLeft+(t.width-n),l<0&&(l=0));return{left:Math.round(l),top:Math.round(d),width:Math.round(n),height:Math.round(r)}}const b=new class{openGuestWindow(){u.Z.runtimePrivate.switchToGuestSession((e=>{e||console.warn("Guest mode is disabled.")}))}closeGuestSession(){u.Z.runtimePrivate.closeGuestSession((e=>{e||console.warn("Guest mode is disabled.")}))}managePeople(){return u.Z.runtimePrivate.openProfileSelectionWindow()}closeActiveProfile(){u.Z.runtimePrivate.closeActiveProfile((e=>{e||console.warn("Failed to open profile window.")}))}showAddFeed(e,t){a.Z.dispatch({actionType:"MAIN_SHOW_ADD_FEED",winId:e,options:t})}showAddMailFolder(e,t){a.Z.dispatch({actionType:"MAIN_SHOW_ADD_MAIL_FOLDER",winId:e,options:t})}showDeleteMailFolder(e,t){a.Z.dispatch({actionType:"MAIN_SHOW_DELETE_MAIL_FOLDER",winId:e,options:t})}showAddFeedFolder(e,t){a.Z.dispatch({actionType:"MAIN_SHOW_ADD_FEED_FOLDER",winId:e,options:t})}showDeleteFeedFolder(e,t){a.Z.dispatch({actionType:"MAIN_SHOW_DELETE_FEED_FOLDER",winId:e,options:t})}showDeleteWorkspace(e,t){a.Z.dispatch({actionType:"MAIN_SHOW_DELETE_WORKSPACE",winId:e,options:t})}showQuickCommand(e){a.Z.dispatch({actionType:"MAIN_SHOW_QUICKCOMMANDS",winId:e})}async showCalendar(e,t){try{const n=await s.ZP.openURL(e,"vivaldi://calendar",{singleton:!0});t&&i.Z.selectEvent(n.pageId,{eventId:t})}catch(e){console.error(e)}}showCalendarNotification(e,t){a.Z.dispatch({actionType:"MAIN_SHOW_CALENDAR_ALARM",winId:e,options:t})}showCalendarEditEvent(e,t){a.Z.dispatch({actionType:"MAIN_SHOW_CALENDAR_EDIT_EVENT",winId:e,options:{event:t}})}showEditEventTemplate(e,t){a.Z.dispatch({actionType:"MAIN_SHOW_CALENDAR_EDIT_TEMPLATE",winId:e,options:t})}showCalendarImportEvents(e,t){a.Z.dispatch({actionType:"MAIN_SHOW_CALENDAR_IMPORT_EVENTS_DIALOG",winId:e,options:{uri:t}})}showKeyboardShortcuts(e){a.Z.dispatch({actionType:"MAIN_SHOW_KEYBOARDS_SHORTCUTS",winId:e})}showPageAccessKeys(e){a.Z.dispatch({actionType:"MAIN_SHOW_PAGE_ACCESS_KEYS",winId:e})}showConfirmOpenLinksDialog(e,t){a.Z.dispatch({actionType:"MAIN_SHOW_CONFIRM_OPEN_LINKS_DIALOG",winId:e,options:t})}showConfirmCloseOtherTabsDialog(e,t){a.Z.dispatch({actionType:"MAIN_SHOW_CONFIRM_CLOSE_OTHER_TABS_DIALOG",winId:e,options:t})}showClearBrowsingHistoryDialog(e){a.Z.dispatch({actionType:"MAIN_SHOW_CLEAR_BROWSING_HISTORY_DIALOG",winId:e})}showModal(e,t){return new Promise((n=>a.Z.dispatch({actionType:"MAIN_SHOW_MODAL_DIALOG",winId:e,options:{...t,resolve:n}})))}showModalInfo(e,t){a.Z.dispatch({actionType:"MAIN_SHOW_MODAL_INFO",winId:e,options:t})}showImportDataDialog(e){a.Z.dispatch({actionType:"MAIN_SHOW_IMPORT_DATA_DIALOG",winId:e})}showMailInfoDialog(e){a.Z.dispatch({actionType:"MAIN_SHOW_MAIL_INFO_DIALOG",winId:e})}showBookmarkDialog(e,t){a.Z.dispatch({actionType:"MAIN_SHOW_BOOKMARK_DIALOG",winId:e,options:t})}showBookmarkAddedPopup(e,t){a.Z.dispatch({actionType:"MAIN_SHOW_BOOKMARK_ADDED_POPUP",winId:e,options:t})}showContextDialog(e,t,n){a.Z.dispatch({actionType:"MAIN_SHOW_CONTEXT_DIALOG",winId:e,options:{id:t,force:n??!1}})}async showMail(e){await s.ZP.openURL(e,m.jk.internals.mailpage,{singleton:!0})}showMailUnsubscribeDialog(e,t){const n={actionType:"MAIN_SHOW_MAIL_UNSUBSCRIBE_DIALOG",winId:e,options:t};a.Z.dispatch(n)}showMailAuthenticationDialog(e,t){const n={actionType:"MAIN_SHOW_MAIL_AUTHENTICATION_DIALOG",winId:e,options:t};a.Z.dispatch(n)}showMailDeleteDialogSetting(e,t){const n={actionType:"MAIN_SHOW_MAIL_DELETE_DIALOG_SETTING",winId:e,options:t};a.Z.dispatch(n)}showMailDeleteDialogFolders(e,t){const n={actionType:"MAIN_SHOW_MAIL_DELETE_DIALOG_FOLDERS",winId:e,options:t};a.Z.dispatch(n)}showMailDeleteDialogAccounts(e,t){const n={actionType:"MAIN_SHOW_MAIL_DELETE_DIALOG_ACCOUNTS",winId:e,options:t};a.Z.dispatch(n)}showMailDeleteDialogConfirmAll(e,t){const n={actionType:"MAIN_SHOW_MAIL_DELETE_DIALOG_CONFIRM_ALL",winId:e,options:t};a.Z.dispatch(n)}showSaveSessionDialog(e,t){a.Z.dispatch({actionType:"MAIN_SHOW_SAVE_SESSION_DIALOG",winId:e,options:t})}showOpenSessionDialog(e){a.Z.dispatch({actionType:"MAIN_SHOW_OPEN_SESSION_DIALOG",winId:e})}showDialog(e,t,n){const i={actionType:"MAIN_SHOW_DIALOG",winId:e,options:t,onAfterClose:n};a.Z.dispatch(i)}async showExtensions(e){await s.ZP.openURL(e,"vivaldi://extensions",{singleton:!0})}async showHistory(e){await s.ZP.openURL(e,"vivaldi://history",{singleton:!0})}async showNotes(e){await s.ZP.openURL(e,"vivaldi://notes",{singleton:!0})}async showBookmarks(e,t=""){await s.ZP.openURL(e,`vivaldi://bookmarks/${t}`,{singleton:!0})}async showWelcome(e){await s.ZP.openURL(e,"vivaldi://welcome")}async showSettings(e,t="general",n,i=!1){const a=n&&!(0,h.Z)(n)?Object.keys(n).map((e=>`${e}=${n[e]??""}`)).join("&"):"";if(o.Z.get(g.kSettingsInTab)&&!i)await s.ZP.openURL(e,`vivaldi://settings/${t}/?${a}`,{singleton:!0,skipParams:!0});else{l.ZP.settingsCategory=`${t}&${a}`;const n={bounds:y(e),windowKey:"settings"};await r.Z.openWindow(e,f,"settings",n)}}showAccountSheet(e,t="login"){const n={actionType:"MAIN_SHOW_ACCOUNT_SHEET",winId:e,options:t};a.Z.dispatch(n)}showAddCustomLabel(e){a.Z.dispatch({actionType:"MAIN_SHOW_CREATE_LABEL",winId:e})}showCustomLabelDialog(e){a.Z.dispatch({actionType:"MAIN_SHOW_LABEL_FLAG_DIALOG",winId:e})}showDeleteCustomLabelConfirmation(e,t,n){a.Z.dispatch({actionType:"MAIN_SHOW_DELETE_LABEL_CONFIRMATION",winId:e,options:{label:t,callback:n}})}showDeleteFilterConfirmation(e,t,n){a.Z.dispatch({actionType:"MAIN_SHOW_DELETE_FILTER_CONFIRMATION",winId:e,options:{label:t,callback:n}})}showDeleteFeedConfirmation(e,t,n){a.Z.dispatch({actionType:"MAIN_SHOW_DELETE_FEED_CONFIRMATION",winId:e,options:{label:t,callback:n}})}showMailFilterViewConfirmation(e,t,n){a.Z.dispatch({actionType:"MAIN_SHOW_MAIL_VIEW_FILTER_CONFIRMATION",winId:e,options:{label:t,callback:n}})}showMailUploadConfirmation(e,t,n){a.Z.dispatch({actionType:"MAIN_SHOW_MAIL_UPLOAD_CONFIRMATION",winId:e,options:{accountId:t,callback:n}})}showMessageMoveConfirmation(e,t,n,i){a.Z.dispatch({actionType:"MAIN_SHOW_MAIL_MESSAGE_MOVE_CONFIRMATION",winId:e,options:{callback:t,title:n,body:i}})}showCreateArchiveFolderConfirmation(e,t,n,i){a.Z.dispatch({actionType:"MAIN_SHOW_MAIL_CREATE_ARCHIVE_FOLDER_CONFIRMATION",winId:e,options:{callback:t,title:n,body:i}})}showMailAccountDialog(e){const t={actionType:"MAIN_SHOW_MAIL_ACCOUNT_DIALOG",winId:e};a.Z.dispatch(t)}showCalendarAccountDialog(e){const t={actionType:"MAIN_SHOW_CALENDAR_ACCOUNT_DIALOG",winId:e};a.Z.dispatch(t)}showCreateCalendarDialog(e){a.Z.dispatch({actionType:"MAIN_SHOW_CREATE_CALENDAR_DIALOG",winId:e})}updateToolbarSpacer(e){a.Z.dispatch({actionType:"MAIN_TOOLBAR_SPACER_UPDATE",winId:e})}showResetToolbarConfirmation(e,t,n,i){a.Z.dispatch({actionType:"MAIN_SHOW_TOOLBAR_RESET",winId:e,options:{callback:t,title:n,body:i}})}showPrivacyStatsDialog(e){a.Z.dispatch({actionType:"MAIN_SHOW_PRIVACY_STATS",winId:e})}showWorkspaceDialog(e,t){a.Z.dispatch({actionType:"MAIN_SHOW_WORKSPACE_DIALOG",winId:e,options:t})}showNoteSelectionDialog(e,t){a.Z.dispatch({actionType:"MAIN_SHOW_NOTE_SELECTION_DIALOG",winId:e,options:t})}showEnableWorkspaceDialog(e,t){a.Z.dispatch({actionType:"MAIN_SHOW_ENABLE_WORKSPACE_DIALOG",winId:e,options:t})}showIncludeWorkspaceDialog(e,t){a.Z.dispatch({actionType:"MAIN_SHOW_INCLUDE_WORKSPACE_DIALOG",winId:e,options:t})}showEnableSessionAutosaveDialog(e,t){a.Z.dispatch({actionType:"MAIN_SHOW_ENABLE_SESSION_AUTOSAVE_DIALOG",winId:e,options:t})}async openNewPopAsTabOrWindow(e,t,n){if(o.Z.get(g.kPopupsShowInTab))t.window.accept(e+";1");else{const i={bounds:{left:t.initialLeft,top:t.initialTop,width:t.initialWidth,height:t.initialHeight},incognito:n},o=await r.Z.openWindow(e,f,"popup",i);t.window?t.window.accept(o+";1"):s.ZP.openURL(o,t.targetUrl)}}startCasting(e){u.Z.utilities.startChromecast(e)}setPaneFocus(e,t){a.Z.dispatch({actionType:"MAIN_SELECTING_TOOLBAR",winId:e,options:{enable:t}})}stepFocus(e,t){const i=e.vivaldiWindowId,{document:o,HTMLElement:a}=e;s.ZP.clearSelection(i);const r=function(e,t){return Array.from(o.querySelectorAll(e)).map((e=>{const t=e.getBoundingClientRect(),n=function(e){let t=0,n=0;for(;e instanceof a&&(t+=e.offsetTop,n+=e.offsetLeft,e.offsetParent);)e=e.offsetParent;return{left:n,top:t}}(e);return{elm:e,rect:{left:n.left,top:n.top,width:t.width,height:t.height}}})).sort(((e,n)=>t?e.rect.left<n.rect.left?-1:e.rect.left>n.rect.left?1:e.rect.top<n.rect.top?-1:e.rect.top>n.rect.top?1:0:e.rect.top<n.rect.top?-1:e.rect.top>n.rect.top?1:e.rect.left<n.rect.left?-1:e.rect.left>n.rect.left?1:0))},l=function(e,t){const n=t.children;let i=!1;for(let t=0;t<n.length;t++){if(n[t]===e)return!0;if(l(e,n[t])){i=!0;break}}return i},d=r(".pagefocusstop",!0),c=r(".uifocusstop",!1).concat(d);if(c.length>0){let a=-1;const r=o.activeElement;for(let e=0;e<c.length;e++)if(c[e].elm===r||l(r,c[e].elm)){a=e;break}a=-1===a?t?0:c.length-1:t?a+1<c.length?a+1:0:0===a?c.length-1:a-1;if(-1!==d.findIndex((e=>e===c[a]))){const t=parseInt(c[a].elm.getAttribute("data-id"));s.ZP.activateTab(t,i),n(47995).Z.executeActions("event",e,"COMMAND_FOCUS_WEBVIEW"),v=setTimeout((()=>b.setPaneFocus(i,!1)),1e3)}else c[a].elm.focus(),v&&clearTimeout(v);b.setPaneFocus(i,!0)}}async showLargeAttachmentWarning(e,t){const{action:n}=await b.showModal(l.ZP.getMailWindowId(),{modal:{title:(0,d.Z)("A large file is being attached"),body:(0,d.Z)(`Sending a message with a large attachment may fail: file: "${e}" size: ${Number(t/1e6).toFixed(1)}MB`),actions:[{title:"Do not attach",action:"cancel",default:!0}],cancelAction:{title:(0,d.Z)("mail","Attach anyway"),action:"continue"}}});return n}},S=b},8074:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var i=n(33638);const s=new class{setNavigationState(e,t,n,s){i.Z.dispatch({actionType:"NAVIGATION_SET_STATE",pageId:e,windowId:t,navigationState:n,isUrlFieldFocused:s})}setSSLState(e,t){i.Z.dispatch({actionType:"PAGE_SET_SSL_STATE",pageId:e,info:t})}addBlockedPopupEvent(e,t){i.Z.dispatch({actionType:"NAVIGATION_ADD_POPUP",pageId:e,popupEvent:t})}removeBlockedPopup(e,t){i.Z.dispatch({actionType:"NAVIGATION_REMOVE_POPUP",pageId:e,targetUrl:t})}resetBlockedPopups(e){i.Z.dispatch({actionType:"NAVIGATION_RESET_BLOCKED_POPUPS",pageId:e})}setPermission(e,t,n,s,o,a,r){i.Z.dispatch({actionType:"NAVIGATION_SET_PERMISSION",pageId:e,origin:t,permission:n,requestEvent:s,state:o,promptPermission:a,suppressedPrompt:r})}resetPermissions(e){i.Z.dispatch({actionType:"NAVIGATION_RESET_PERMISSIONS",pageId:e})}setPageHasBlockedContent(e,t){i.Z.dispatch({actionType:"NAVIGATION_SET_BLOCKED_CONTENT",pageId:e,contentType:t})}resetPageHasBlockedContent(e){i.Z.dispatch({actionType:"NAVIGATION_RESET_BLOCKED_CONTENT",pageId:e})}}},21838:(e,t,n)=>{"use strict";n.d(t,{Z:()=>M});var i=n(30626),s=n(62882),o=n(59322),a=n(96951),r=n(18350),l=n(15285),d=n(29087),c=n(60331),u=n(33638),p=n(15489),h=n(56371),g=n(92292),m=n(25372),f=n(7064),v=n(89175),y=n(8684),b=n(44850);let S=!0,w=!1;function C(e){const t=(0,m.Z)(e);return t?t.hostname+t.pathname:e}function A(){S=!0}function I(){S=!1,T()}async function T(){const e=await f.Z.notes.getTree();u.Z.dispatch({actionType:"NOTES_INIT",notes:e})}function Z(e,t){if(S)return;if(u.Z.dispatch({actionType:"NOTES_ADD_ITEM",id:e,item:t}),p.ZP.getActiveWindowId()===p.Ex||"note"!==t.type)return;const n=p.ZP.getLastActiveBrowserWindowId(),i=a.ZP.getActivePage(n);i&&b.jk.getDisplayUrlFromMapping(i.url).startsWith("vivaldi://notes")||(d.Z.get(v.kNotesCreationNotify)&&!l.ZP.getIsVisible(n,"PanelNotes")&&(0,y.c)({title:(0,h.Z)("New Note Created"),onClick:()=>r.Z.showContent(n,"PanelNotes",{setFocus:!0,selectId:e,reason:""}),timeout:3e4,tag:"VIVALDI_NOTES_NEW_CREATED"}),d.Z.get(v.kNotesCreationShowPanel)&&r.Z.showContent(n,"PanelNotes"))}function E(e,t){S||u.Z.dispatch({actionType:"NOTES_MOVE_ITEM",id:e,targetFolder:t.parentId,targetIndex:t.index})}function k(e,t){S||(u.Z.dispatch({actionType:"NOTES_CHANGE_ITEM",id:e,changes:t}),w&&(w=!1,c.Z.setStatus(p.ZP.getActiveWindowId(),(0,h.Z)("Text has been appended to note."),5e3)))}function _(e){S||u.Z.dispatch({actionType:"NOTES_REMOVE_ITEM",id:e})}const N={scale:1,width:0,height:0};async function P({id:e,dataURL:t,title:n,url:i}){if(!t)throw new Error("Missing dataURL parameter");const o=s.ZP.getNodeById(e);if(!o||"note"!==o.type)throw new Error("Not a valid node for attachments");const a=t.indexOf(",");if(-1===a)throw new Error("data url is lacking a comma");const r=t.slice(a+1);i&&await f.Z.notes.update(e,{url:i}),await f.Z.notes.create({parentId:e,content:r,url:i,title:n,type:"attachment"})}function D(e){return new Promise(((t,n)=>{const i=new FileReader;i.onloadend=({target:e})=>{t(e.result)},i.onerror=()=>{i.abort(),n()},i.readAsDataURL(e)}))}const M={loadPromise:async function(){await T(),S=!1,f.Z.notes.onImportBegan.addListener(A),f.Z.notes.onImportEnded.addListener(I),f.Z.notes.onCreated.addListener(Z),f.Z.notes.onMoved.addListener(E),f.Z.notes.onChanged.addListener(k),f.Z.notes.onRemoved.addListener(_)},emptyTrash:function(){return new Promise(((e,t)=>{f.Z.notes.emptyTrash((n=>{!1===n&&(console.warn("Empty trash failed."),t("Empty trash failed.")),e()}))}))},addScreenshotToNote:function(e,t,n){const i=a.ZP.getActivePage(e)?.url??"";P({id:t,url:i,dataURL:n,title:(0,h.Z)("Capture: $1",C(i))})},addFile:async function(e,t){return P({id:e,dataURL:await D(t),title:t.name})},appendToNode:async function(e,t){const n=s.ZP.getNodeById(e);if(0===t.trim().length||!n)return;const i=`${n.content??""}\r\n${t}`;w=!0;try{await f.Z.notes.update(e,{content:i})}catch{w=!1}},createNoteFromCapture:async function(e,t){if(!t)throw new Error("Missing capture content");const n=a.ZP.getActivePage(e)?.url??"",i=await f.Z.notes.create({type:"note",url:n}),s=l.ZP.hasPanel(e,"PanelNotes");if(i)if(await P({id:i.id,dataURL:t,url:n,title:(0,h.Z)("Capture: $1",[C(n)])}),s){const t={selectId:i.id,setFocus:!0,reason:""};r.Z.showContent(e,"PanelNotes",t)}else{const t=b.jk.internalUrl("notes",i.id);o.ZP.openURL(e,t,{inCurrent:!1})}},readFileAsDataURL:D,createNotesFromTreeNodes:async function e(t,n="",i){return Promise.all(t.map((async(t,o)=>{const a=i?i+o:void 0;if("separator"===t.type){return await f.Z.notes.create({index:a,parentId:n,type:"separator"})}const r=await f.Z.notes.create({parentId:n,index:a,type:s.ZP.isFolder(t)?"folder":t.type,content:t.content,title:t.title,url:t.url});return t.children&&(r.children=await e(t.children,r.id,0)),r})))},createNote:async function(e,t,n=!0){const{content:s,url:o}=t,a=await f.Z.notes.create({type:"note",content:s,url:o});return o&&d.Z.get(v.kNotesCreationAddScreenshot)&&n?async function(e,t){const n=i.Z.getActiveWebView(e);if(!n)return;const s=["richtexteditor","markdowneditor"].includes(n.name)||"data:text/html,<html/>"===n.src?void 0:n.src,o=await function(e,t=N){return new Promise(((n,i)=>{e.getThumbnail(t,(e=>{g.Z.runtime.lastError&&i(g.Z.runtime.lastError.message),n(e)}))}))}(n);return P({id:t,url:s,dataURL:o,title:(0,h.Z)("Screenshot: $1",C(s??""))})}(e,a.id):a},removeNode:async function(e){await f.Z.notes.remove(e)},setCutIds:function(e){u.Z.dispatch({actionType:"NOTES_SET_CUT_IDS",ids:e})},setClipboard:function({clipboardData:e},t,n){if(!e)return;const i=t.map((e=>e.id));let o="";!function e(t){for(const n of t){const{content:t,url:i}=n;o+=[t,i].filter(Boolean).join("\n")+"\n\n",s.ZP.isFolder(n)&&n.children&&e(n.children)}}(t),e.setData("vivaldi/x-cut",n?"true":"false"),e.setData(s.d0,JSON.stringify(i)),e.setData("text/plain",o)}}},33499:(e,t,n)=>{"use strict";function i(e){return Math.floor((e-1)/2)}n.d(t,{ZP:()=>N,y6:()=>T});const s=class{#n=[];constructor(e){this.comparator=e}_swap(e,t){const n=this.#n[e];this.#n[e]=this.#n[t],this.#n[t]=n}_heapify(e){const t=2*e+1;if(t>=this.#n.length)return;const n=t+1;let i=e;this.comparator(this.#n[t],this.#n[i])&&(i=t),n<this.#n.length&&this.comparator(this.#n[n],this.#n[i])&&(i=n),i!==e&&(this._swap(e,i),this._heapify(i))}peek(){return this.#n[0]}push(...e){e.forEach((e=>{let t=this.#n.length;this.#n.push(e);let n=i(t);for(;n>=0&&this.comparator(this.#n[t],this.#n[n]);)this._swap(n,t),t=n,n=i(n)}))}pop(){const e=this.#n.shift();return this._heapify(0),e}clear(){this.#n=[]}get size(){return this.#n.length}};var o=n(50522),a=n(46382),r=n(68247),l=n(29087),d=n(33638),c=n(63153),u=n(15489),p=n(45660),h=n(30381),g=n.n(h),m=n(7064),f=n(24522),v=n(25765),y=n(47543),b=n(58821),S=n(89175),w=n(8684),C=n(34155);const A=5*f.hd,I=20*f.QI;function T(e,t){let n="LT";return t?n="L":e.isSame(Date.now(),"day")||(n="L LT"),n}const Z=(e,t)=>e.alarmTime<t.alarmTime;function E(e,t){const{id:n,event_id:i,when:s}=e,a=t??(i&&o.Z.getEvent(i));if(!a)return p.Z.warn("Calendar",["reminders"],"Can not create alarms, event not found",e),void m.Z.calendar.deleteNotification(n);if(a.trash||a.task&&a.complete)return;const r=Date.now(),d=Math.max(l.Z.get(S.kCalendarLastNotificationTime)||r-f.hd,r-f.hd);let c=0,u=0;if(e.period){const t=r+f.QI;if(s>d&&s<t)return{alarmTime:s,notification:e,eventTime:(0,b.oJ)(a)}}else if(a.rrule){const{rrule:e}=a,t=parseInt(i?.split(":")[1]),n=new Set((a.recurrenceExceptions??[]).map((e=>e.date))),o=d+s+1e3,l=r+s+f.QI;c=(0,y.YE)(e,{from:o,to:l,eventStart:a.start,timezone:a.timezone}).map((e=>e.valueOf())).filter((e=>!t||e+s===t)).filter((e=>!n.has(e))).map((e=>e-s)).sort(((e,t)=>t-e))[0],u=c+s}else{const e=r+s+f.QI,t=(0,b.oJ)(a)-s;t>=d&&t<e&&(c=t)}return c?{alarmTime:c,notification:e,eventTime:u||(0,b.oJ)(a)}:void 0}async function k(e){const t=Date.now();e.timeoutId&&clearTimeout(e.timeoutId);const n=f.lb-(t+1)%f.lb;e.timeoutId=setTimeout(k,n,e),!e.alarms.size&&t>=e.nextBuildAlarms&&(_.updateAllAlarms(),e.nextBuildAlarms=(0,b.zX)(t));const i=l.Z.get(S.kCalendarNotificationType);if("none"===i)return;const s=e.alarms.peek();if(s&&!(s.alarmTime>t))try{const n=u.ZP.getLastActiveBrowserWindowId();for(;(e.alarms.peek()?.alarmTime??1/0)<=t;)_.showNotification(e.alarms.pop(),i,n)}catch(e){console.error("checkAlarms: Failed to retrive window id",e)}}const _=new class{#i={alarms:new s(Z),nextBuildAlarms:0};loadNotifications=async()=>{const e=await m.Z.calendar.getAllNotifications();d.Z.dispatch({actionType:"NOTIFICATIONS_INIT",notifications:e})};deleteAlarmsForNotification(e){const t=new s(Z);for(;this.#i.alarms.size;){const n=this.#i.alarms.pop();n.notification.id!==e&&t.push(n)}this.#i.alarms=t}deleteNotification(e){const{id:t,event_id:n}=e;n&&(m.Z.calendar.deleteNotification(t),this.deleteAlarmsForNotification(t))}async createNotification(e,t){e.event_id&&(e.event_id=e.event_id.split(":")[0]);const n=await m.Z.calendar.createNotification(e);if(n.event_id){const e=E(n,t);e&&this.#i.alarms.push(e)}return n}snooze(e,t){const{id:n,delay:i,eventTime:s,title:o,allDay:a,...r}=e;r.when=Date.now()+t*f.lb,r.period=e.eventTime,this.createNotification(r)}async updateNotification(e,t){let{id:n,event_id:i,...s}=e;i&&(i=i.split(":")[0]);const o=await m.Z.calendar.updateNotification(n,s);if(o.event_id){this.deleteAlarmsForNotification(n);const e=E(o,t);e&&this.#i.alarms.push(e)}}updateAlarmsForEvent(e){d.Z.dispatch({actionType:"NOTIFICATIONS_FOR_EVENT",event:e}),(e.notifications??[]).forEach((t=>this.updateAlarmsForNotification(t,e)))}updateAlarmsForNotification(e,t){this.deleteAlarmsForNotification(e.id);const n=E(e,t);n&&this.#i.alarms.push(n)}async updateAllAlarms(){this.#i.alarms.clear();const e=await m.Z.calendar.getAllNotifications();for(const t of e){const e=E(t);e&&this.#i.alarms.push(e)}}startAPIChangeListeners(){l.Z.get(S.kMailIsTurnedOff)||(m.Z.calendar.onNotificationChanged.addListener(_.loadNotifications),this.#i.alarms.clear(),this.#i.nextBuildAlarms=Date.now(),this.#i.timeoutId&&clearTimeout(this.#i.timeoutId),this.#i.timeoutId=setTimeout(k,5e3,this.#i))}stopAPIChangeListeners(){m.Z.calendar.onNotificationChanged.removeListener(_.loadNotifications),this.#i.timeoutId&&(clearTimeout(this.#i.timeoutId),delete this.#i.timeoutId)}async showNotification(e,t,n){const{notification:i,eventTime:s}=e,d=o.Z.getEvent(i.event_id||"");if(!d)return;if(l.Z.get(S.kCalendarHiddenHidesNotifications)){if(o.Z.getCalendars().find((e=>e.id===d.calendarId))?.hidden)return}const p=d.title||i.name||v.gT;if("system"===t){const e=g()(s),t=T(e,d.allDay??!1),i=e.format(t);(0,w.c)({title:`${i} - ${p}`,onClick:()=>{a.Z.showCalendar(n,d.id)},timeout:d.task?A:I,tag:`VIVALDI_CALENDAR_EVENT_ID_${d.id}`})}else{let e;const o="dialog"!==t&&l.Z.get(S.kCalendarNotificationFullscreen);if(o){const t=u.ZP.getWindowState(n);"normal"!==t?.state&&"minimized"!==t?.state||(c.Z.setFullscreen(n),e=n,await new Promise(C.nextTick))}const r={reminder:{...i,eventTime:s,allDay:d.allDay??!1,title:p},fullscreen:o,windowToRestore:e};a.Z.showCalendarNotification(n,r)}const h=l.Z.get(S.kCalendarNotificationSound);if(h){const e=new Audio(h);e.volume=l.Z.get(S.kCalendarNotificationVolume)/100,e.play()}r.Z.set(S.kCalendarLastNotificationTime,Date.now()),i.period&&m.Z.calendar.deleteNotification(i.id)}},N=_},59322:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>Ue,nq:()=>Ze});var i=n(7065),s=n(19789),o=n(46382),a=n(33638);var r=n(7168),l=n(8074),d=n(96951),c=n(17434),u=n(14481),p=n(68247),h=n(29087),g=n(18237),m=n(14022),f=n(70864),v=n(63153),y=n(15489),b=n(29104),S=n(53454),w=n(92292),C=n(2497),A=n(71193),I=n(84847),T=n(4027),Z=n(7064),E=n(1407),k=n(44850),_=n(35369),N=n(69046),P=n(751),D=n(82786),M=n(16152),O=n(42941),x=n(42578),L=n(36436),R=n(58821),B=n(89175),F=n(721),W=n(14789),U=n(80419),V=n(37441),H=n(34155);let G=0;async function $(){const e=y.ZP.getLastActiveBrowserWindowId();if(e===y.Ex)return void console.warn("showWhatsNewTab: Expected a valid windowId");if(y.ZP.isIncognitoOrGuest(e))return;const t=await async function(e){return(await w.Z.windows.getAll({populate:!0})).some((t=>t.tabs?.some((t=>t.url===e||t.pendingUrl===e))))}(k.xy.welcome),n=await Z.Z.utilities.canShowWhatsNewPage();if(!n.show)return;if(n.firstrun)return;const{vivaldiVersion:i}=Z.Z.utilities.getVersion();return Y(e,"https://vivaldi.com/newfeatures?hl="+s.ZP.UI_LANGUAGE+"&version="+i+"&os=W",{inCurrent:!1,inBackground:t})}const K=(0,M.Z)((()=>{const e=new Date;let t=h.Z.get(B.kStartupActiveDays);t.length>0&&(0,R.KC)(e,new Date(t[t.length-1]))||(t=t.filter((t=>e-t<12096e5)),t.push(e.getTime()),p.Z.set(B.kStartupActiveDays,t))}),1e4),z=(0,M.Z)((e=>{const{toStart:t,windowId:n}=e,i=d.ZP.getActivePage(n);if(!i)return;const s=d.ZP.getSelectionOrActivePage(n),o=(0,N.av)(i),a=d.ZP.getPages(n);if(o){const e=a.flatMap(((e,t)=>(0,N.av)(e)===o?[t]:[])),r=s.filter((e=>(0,N.av)(e)===o)),l=t?e.get(0):e.get(e.size-1);"number"==typeof l&&We.moveDroppedTabs(n,r,i.id,l,o)}else{const e=t?0:a.size-1;if(s.isEmpty())return;We.moveDroppedTabs(n,s,i.id,e,void 0)}}),50),j={bookmarkId:"",inBackground:!1,inCurrent:!1,inSpecificPageId:void 0,incognito:!1,inNewWindow:!1,transition:Z.Z.historyPrivate.TransitionType.AUTO_TOPLEVEL,fromUrlField:!1,index:void 0,postParams:void 0,contentType:void 0,singleton:!1,skipParams:!1,groupId:void 0,fixedGroupTitle:void 0};async function Y(e,t="",n=structuredClone(j)){K();const i=(0,k.Gr)(t),s=i&&"_blank"!==i?i:d.ZP.getDefaultStartpage(e);if(!y.ZP.getWindowState(e))return Promise.reject("Unknown window");if(y.ZP.isSettings(e)&&!0!==n.inNewWindow){let t=y.ZP.getLastActiveBrowserWindowId();if(t!==y.Ex&&y.ZP.isGuest()&&(t=y.Ex),t===y.Ex){const e=y.ZP.getIds("normal").filter((e=>!y.ZP.isGuest()));e.length>0&&(t=e[0])}t===y.Ex?(e=y.Ex,n.inNewWindow=!0,n.inBackground=!1):(e=t,n.inNewWindow=!1,n.inCurrent=!1)}if(y.ZP.isGuest()&&(0,k.YC)(s))return Promise.reject("Illegal URL for Guest mode");if(y.ZP.isIncognito(e)&&(0,k.CS)(s)){const t=y.ZP.getIds("normal").filter((e=>!y.ZP.isIncognitoOrGuest(e)));n.incognito=!1,t.length>0?e=t[0]:n.inNewWindow=!0}if(y.ZP.isPopup(e)&&(n.inNewWindow=!0,n.inBackground=!1),n.inNewWindow)return v.Z.openBrowserWindow(e,s,{incognito:n.incognito,transition:n.transition,fromUrlField:n.fromUrlField}).then((e=>{if(e&&e.tabs&&e.tabs.length>0){const t=e.tabs[0];return{windowId:parseInt(e.id),pageId:parseInt(t.id)}}return{windowId:-1,pageId:-1}}));let o="";if(n.contentType&&(o="Content-Type: "+n.contentType+"\r\n\r\n",console.assert(n.postParams)),n.singleton){const t=d.ZP.getPages(e).find((e=>(0,L.uu)(s,e.url,n.skipParams)));if(t){if(!n.inBackground){const n=d.ZP.getActiveWorkspace(e);(0,N.cm)(t)!==n&&await(0,V.V)(t.id,{workspaceId:n}),(0,k.Z7)(s)&&a.Z.dispatch({actionType:"PAGE_OPEN_URL",windowId:e,pageId:t.id,url:s}),a.Z.dispatch({actionType:"PAGE_OPEN",windowId:e,pageId:t.id})}return Promise.resolve({windowId:e,pageId:t.id})}}const r=n.inSpecificPageId?d.ZP.getPageInWindow(e,n.inSpecificPageId):d.ZP.getActivePage(e);if((n.inCurrent||n.inSpecificPageId)&&r&&!y.ZP.isPopup(e)){const t=r.vivExtData.ext_id;return u.Z.destroyPeriodicAlarm({ids:[t],from:"tab"}),a.Z.dispatch({actionType:"PAGE_OPEN_URL",pageId:r.id,windowId:e,url:s,postParams:n.postParams,headers:o,transition:n.transition,fromUrlField:n.fromUrlField,bookmarkId:n.bookmarkId}),Promise.resolve({windowId:e,pageId:r.id})}const l={url:n.postParams?E.f4:s,windowId:e,index:n.index,active:!n.inBackground,transition:n.transition,fromUrlField:n.fromUrlField,openerTabId:n.addOpenerTabId&&r&&!(0,k.$0)(r.url)?r.id:void 0};n.groupId&&(l.vivExtData=JSON.stringify({group:n.groupId,fixedGroupTitle:n.fixedGroupTitle}),l.pinned=d.ZP.isPinnedGroup(n.groupId,e));const c=(await w.Z.tabs.create(l)).id;return void 0===c?Promise.reject("Failed to create tab"):(n.postParams&&H.nextTick((()=>{a.Z.dispatch({actionType:"PAGE_OPEN_URL",pageId:c,windowId:e,url:s,postParams:n.postParams,headers:o,transition:n.transition,fromUrlField:n.fromUrlField,bookmarkId:n.bookmarkId})})),n.inBackground||await function(e,t){return new Promise((n=>{w.Z.windows.update(e,t,n)}))}(e,{focused:!0}),{windowId:e,pageId:c})}function X(e,t,n){if(c.Z.offerUpdatedTab(n))return;const i=n.windowId;if(n.url&&!(0,k.$0)(n.url)&&c.Z.closeAssociatedTabs(e),"complete"===t.status&&(t.title=n.title),a.Z.dispatch({actionType:"CHROME_TABS_UPDATED",tabId:e,windowId:i,changeInfo:t}),h.Z.get(B.kWorkspacesEnabled)&&t.url&&t.vivExtData&&"loading"===t.status){const s=JSON.parse(t.vivExtData).workspaceId,o=d.ZP.getActiveWorkspace(i),a=y.ZP.getActiveWindowId();a!==i?s===o?v.Z.focus(i).then((()=>We.activateTab(e,i))):_e(a,s).then((()=>We.activateTab(e,a))).catch((()=>{_e(i,s),We.activateTab(e,i)})):n.active&&s!==o&&Q(i,o).then((()=>_e(i,s)))}}function Q(e,t){if(d.ZP.getPages(e,{workspaceId:t}).isEmpty()){const n=d.ZP.getActiveWorkspace(e)!==t;return We.openURL(e,"",{inBackground:n})}return Promise.resolve()}function q(e){return e.some((e=>e.active))?(0,d.yz)(e)?.id:void 0}function J(e,t,n){(class{static setMediaState(e,t){a.Z.dispatch({actionType:"PAGE_SET_MEDIASTATE",tabId:e,mediastate:t})}}).setMediaState(e,n)}function ee(e,t,n,i){let s="undecided";switch(i){case"allow":s="allowed";break;case"block":s="blocked";break;default:s="undecided"}let o=null;try{o=new URL(n)}catch(e){return}l.Z.setPermission(e,o.origin,t,null,s)}function te(e,t,n){a.Z.dispatch({actionType:"VIVALDI_TABS_UPDATED",pageId:e,windowId:t,tabInfo:n})}function ne(e){a.Z.dispatch({actionType:"VIVALDI_TABRESOURCE_INFO_UPDATED",memoryInfo:e})}async function ie(e,t){if(!y.ZP.getWindowState(e))return;const n=d.ZP.getPageInWindow(e,t),i=n?(0,N.cm)(n):void 0;i!==d.ZP.getActiveWorkspace(e)&&await _e(e,i);const s=d.ZP.getActivePage(e);s&&s.id===t||ve(t,e)}function se(e,t){if(c.Z.eraseTabId(e,t.parentTabId))return;Z.Z.utilities.cleanUnusedImages(50);const n={actionType:"CHROME_TABS_REMOVED",tabId:e,removeInfo:t};a.Z.dispatch(n)}function oe(e,t){const n=f.Z.findPanelByTabId(t);if(n){f.Z.replaceTabId(e,t);const i=n.lastIndexOf("_"),s=n.substring(0,i),o=n.substring(i+1),r={actionType:"PANEL_TAB_REPLACED",addedTabId:e,removedTabId:t,panelId:s,windowId:Number(o)};return void a.Z.dispatch(r)}const i={actionType:"CHROME_TABS_REPLACED",addedTabId:e,removedTabId:t};a.Z.dispatch(i)}let ae=Promise.resolve();function re(){return"off"!==h.Z.get(B.kTabsStackingMode)}function le(e){if(c.Z.offerNewTab(e))return;const t=i.ZP.tabToPage(e),{openerTabId:n,windowId:s}=t,o=d.ZP.getActivePage(s),r=d.ZP.getActiveWorkspace(s),l={ext_id:(0,N._o)(t)||crypto.randomUUID()},u=[...d.ZP.getPageHistory(s)];t.active?(0,W.AL)(u,t.id):(0,W.EQ)(u,t.id);const p=t.index;if(!be&&!t.pinned){const n=e.vivExtData?.includes("ext_id")??!1;(!n||n&&r!==(0,N.cm)(t))&&(t.index=function(e,t,n){const{windowId:i}=e,s=d.ZP.getPages(i),o=n?"alwayslast":h.Z.get(B.kTabsNewPlacement),a="number"==typeof e.openerTabId?d.ZP.getPageById(e.openerTabId):null;let r;switch(r=n?void 0:a?(0,N.av)(a):(0,N.av)(e),o){case"openintabstackwithrelated":case"rightofcurrent":{if("number"!=typeof e.openerTabId)return r&&d.ZP.isGroup(r,i)?d.ZP.getGroup(r,i).last().index+1:e.index;if(a?.pinned)return d.ZP.getPinnedCount(a.windowId);const t=t=>t.id!==e.openerTabId&&t.openerTabId!==e.openerTabId,n=s.skipWhile(t).takeUntil(t).last();return n?n.index+1:e.index}case"alwayslast":{if(r&&h.Z.get(B.kTabsStackingOpenInCurrent)&&d.ZP.isGroup(r,i))return d.ZP.getGroup(r,i).last().index+1;const e=s.last();if(e)return e.index+1}}if(!t)return e.index;const l=(0,N.av)(t);if(r&&r!==l&&d.ZP.isGroup(l,t.windowId))return d.ZP.getGroup(l,t.windowId).last().index+1;return t.pinned?d.ZP.getPinnedCount(t.windowId):t.index+1}(t,o,n))}let f,v=t.pinned;if("number"==typeof n&&re()){const e=d.ZP.getPageById(n);if(e){const t="openintabstackwithrelated"===h.Z.get(B.kTabsNewPlacement)&&!(0,k.pM)(e.url)&&!e.pinned;if(t||h.Z.get(B.kTabsStackingOpenInCurrent)){let i=(0,N.av)(e);if(!i&&t&&(i=d.ZP.getNewGroupId(),f=n),i){v=d.ZP.isPinnedGroup(i,s);if(t||d.ZP.getGroup(i,e.windowId).size>1){l.group=i,(0,N.XN)(e)&&(l.fixedGroupTitle=(0,N.XN)(e));const{tiling:n}=e.vivExtData;!t&&n&&d.ZP.getTiles(n.id,s).size>1&&(l.tiling=n)}}}}}if(g.ZP.getIsLoading()){if(t.vivExtData?.group&&(l.group=g.ZP.getLoadGroup(s,t.vivExtData.group),!(0,N.XN)(t))){const e=g.ZP.getLoadGroupNameMap();if(e.size&&l.group){const t=e.get(l.group);t&&(l.fixedGroupTitle=t.name.substring(0,50))}}if(g.ZP.getLoadPersistentTabs())l.workspaceId=t.vivExtData?.workspaceId;else if(g.ZP.getLoadWorkspaceAsTabs())l.workspaceId=void 0;else{let e=h.Z.get(B.kWorkspacesEnabled)?(0,N.cm)(t):void 0;if(void 0!==e){const t=g.ZP.getLoadWorkspaceId(e);if(void 0!==t&&!S.Z.getWorkspaceById(t)){const n=g.ZP.getWorkspace(e);b.Z.addWorkspaceWithId(t,m.Z.getLoadingWorkspaceName(e),n?.icon??"",n?.emoji.length?n?.emoji:void 0)}e=t}l.workspaceId=e??r}}else y.ZP.initializingWindowId===s||y.ZP.isPopulatingEmptyWorkspace||g.ZP.inSessionRecovery()?l.workspaceId=(0,N.cm)(t):l.workspaceId=r;t.vivExtData=(0,_.TS)(t.vivExtData,l),a.Z.dispatch({actionType:"CHROME_TABS_CREATE",page:t,tabActivationHistory:u,deactivatePageId:t.active?o?.id:void 0,windowId:s,openerMissingGroupId:f});const C=Promise.all([(0,V.V)(t.id,l),f&&(0,V.V)(f,{group:l.group}),w.Z.windows.update(s,{focused:!0,drawAttention:!0}),p!==t.index&&w.Z.tabs.move([t.id],{index:t.index}),v!==t.pinned&&w.Z.tabs.update(t.id,{pinned:v})]).catch((e=>{console.warn("handleChromeTabsCreated:",e)}));ae=ae.then((()=>C))}function de(e){const t=e.windowId;if(f.Z.findPanelByTabId(e.tabId)){const n=d.ZP.getPageHistory(t);if(n.length>1){const i=n[n.length-1],s=d.ZP.getPageInWindow(t,i);s&&(e.tabId=s.id)}}a.Z.dispatch({actionType:"PAGE_OPEN",pageId:e.tabId,windowId:t,activatedByChrome:!0,selectGroup:!0})}function ce(e,t,n){if(void 0!==n.parentTabId)return;let i=e.get(t);if(!i)return;e.delete(t);const s=i.windowId,o=n.newWindowId;i={...i,index:n.newPosition,windowId:o,active:!1};const r=[...d.ZP.getPageHistory(o)];if(i.active?(0,W.AL)(r,i.id):(0,W.EQ)(r,i.id),o!==s){Q(s,d.ZP.getActiveWorkspace(s)).catch((()=>{}))}a.Z.dispatch({actionType:"CHROME_TABS_CREATE",page:i,tabActivationHistory:r,deactivatePageId:i.active?d.ZP.getActivePage(o)?.id:void 0,windowId:o})}function ue(e,t,n){if(void 0!==n.parentTabId)return;const i=n.oldWindowId,s=d.ZP.getPageInWindow(i,t);if(!s){const e=n.parentTabId?n.parentTabId:"n/a";return void console.error(`Expected to find page ${t} in window ${i}; parent=${e}`)}const o=s.active?(0,d.yz)(s)?.id:void 0;e.set(t,s),a.Z.dispatch({actionType:"CHROME_TABS_REMOVED",tabId:t,removeInfo:{isWindowClosing:!1,windowId:i}}),o&&setTimeout((()=>{d.ZP.getPageInWindow(i,o)&&w.Z.tabs.update(o,{active:!0})}))}function pe(e,t){const n=t.windowId;a.Z.dispatch({actionType:"CHROME_TABS_MOVED",tabId:e,windowId:n,index:t.toIndex})}function he(){w.Z.tabs.onReplaced.addListener(oe),w.Z.tabs.onCreated.addListener(le),w.Z.tabs.onUpdated.addListener(X),w.Z.tabs.onRemoved.addListener(se),w.Z.tabs.onMoved.addListener(pe),w.Z.tabs.onActivated.addListener(de);const e=new Map;w.Z.tabs.onDetached.addListener(ue.bind(null,e)),w.Z.tabs.onAttached.addListener(ce.bind(null,e))}async function ge(e,t,n){a.Z.dispatch({actionType:"UNLOAD_DIALOG_CLOSED",windowId:e,tabId:t,proceed:n}),n||(Se=(0,D.M)(),void 0!==d.ZP.replacementTab?.id&&(await w.Z.tabs.remove(d.ZP.replacementTab.id),d.ZP.replacementTab=void 0))}async function me(){const e=h.Z.get(B.kTabsStackingNameMap)||{};if(Object.keys(e).length){(await w.Z.tabs.query({})).forEach((async t=>{const n=i.ZP.tabToPage(t);if(n.vivExtData.group){const t=e[n.vivExtData.group];void 0!==t&&await(0,V.V)(n.id,{fixedGroupTitle:t.substring(0,50)})}})),p.Z.set(B.kTabsStackingNameMap,{})}}async function fe(e,t,n){const i=n?n.substring(0,50):void 0,s=d.ZP.getPages(e).filter((e=>(0,N.av)(e)===t));await Promise.all(s.map((({id:e})=>(0,V.V)(e,{fixedGroupTitle:i}))))}function ve(e,t,n=!0){a.Z.dispatch({actionType:"PAGE_OPEN",pageId:e,windowId:t,selectGroup:n})}function ye(e){a.Z.dispatch({actionType:"PAGE_MINIMIZE",windowId:e,workspaceId:d.ZP.getActiveWorkspace(e)})}let be=!1;let Se=(0,D.M)();async function we(e,t){for(let n=0;n<e.size;n++){const i=e.get(n);if(i){const n=(0,N.av)(i);if(n){const s=e.first().windowId,o=d.ZP.getPages(s).filter((t=>!e.find((e=>e.id===t.id))&&(0,N.av)(t)===n));1===o.size&&await Promise.all(o.map((e=>(0,V.V)(e.id,{fixedGroupTitle:void 0,group:void 0,tiling:void 0})))),t||await(0,V.V)(i.id,{fixedGroupTitle:void 0,group:void 0,tiling:void 0})}else t||await(0,V.V)(i.id,{tiling:void 0})}}}async function Ce(e,t){const{bypassConfirm:n=!1,forceClosePinned:i=!1}=t??{},s=Ze(e)?e:_.aV.of(e);if(0===s.size)return;const r=i?"on":h.Z.get(B.kTabsClosePinned),l=s.first().windowId,c=function(e,t,n){const i=d.ZP.getPages(t);if(1===i.size&&!d.ZP.canClosePage(i.first()))return(0,_.aV)([]);let s=e;if("off"===n||"bury"===n){const t=h.Z.get(B.kTabsClosePinnedInStack);s=e.filter((e=>!e.pinned||(0,N.av)(e)&&t))}return s}(s,l,r);if(!n&&h.Z.get(B.kTabsConfirmClosingTabs)&&c.size>=h.Z.get(B.kTabsConfirmClosingThreshold))return void o.Z.showConfirmCloseOtherTabsDialog(l,{pages:s});await we(s,!0),a.Z.dispatch({actionType:"PAGE_CLOSE",windowId:l,pages:c});s.some((e=>e.pinned&&e.active))&&"bury"===r&&ye(l);let u=!1,p=!1;for(const[e,t]of c.groupBy(N.cm)){if(t.size===d.ZP.getPages(l,{workspaceId:e}).size&&(p=void 0===e&&!h.Z.get(B.kTabsNeverCloseLast),u=void 0!==e&&!h.Z.get(B.kTabsNeverCloseLast),h.Z.get(B.kTabsNeverCloseLast)&&!d.ZP.replacementTab)){y.ZP.isPopulatingEmptyWorkspace=!0;const t=await w.Z.tabs.create({url:d.ZP.getDefaultStartpage(l),active:!1,transition:Z.Z.historyPrivate.TransitionType.AUTO_TOPLEVEL,windowId:l,vivExtData:JSON.stringify({workspaceId:e})});y.ZP.isPopulatingEmptyWorkspace=!1,d.ZP.replacementTab=t}}const g=c.map((e=>e.id)).toArray(),m=d.ZP.replacementTab?void 0:q(s);m&&We.activateTab(m,l),await w.Z.tabs.remove(g);const f=d.ZP.replacementTab?.id;d.ZP.replacementTab=void 0;const b=s.get(0);await async function(e,t){d.ZP.getPageInWindow(e.windowId,e.id)&&await new Promise((n=>{const i=setTimeout(o,t);d.ZP.addListener(a,(t=>t.get(e.windowId)));let s=!1;function o(){s||(n(),s=!0,d.ZP.removeListener(a),clearTimeout(i))}function a(){d.ZP.getPageInWindow(e.windowId,e.id)||o()}}))}(b,100),void 0!==f?await w.Z.tabs.update(f,{active:!0}):m&&d.ZP.getActivePage(l)?.id!==m&&We.activateTab(m,l),u&&_e(l,void 0),p&&await v.Z.close(l)}function Ae(e,t){const{windowId:n}=e,i=d.ZP.getActiveWorkspace(n),s=(0,N.av)(e);let o=d.ZP.getPages(n).filter((e=>(0,N.cm)(e)===i&&!e.pinned));return o=t?o.skipUntil((e=>(0,N.av)(e)===s)).takeUntil((t=>t.id===e.id)):d.ZP.isGroup((0,N.av)(e),e.windowId)?o.takeUntil((t=>t.id===e.id)).filter((e=>(0,N.av)(e)!==s)):o.takeUntil((t=>t.id===e.id)),o}function Ie(e,t){const{windowId:n}=e,i=d.ZP.getActiveWorkspace(n),s=(0,N.av)(e);let o=d.ZP.getPages(n,{workspaceId:i}).skipUntil((t=>t.id===e.id)).skip(1);return t?o=o.takeUntil((e=>(0,N.av)(e)!==s)):d.ZP.isGroup((0,N.av)(e),e.windowId)&&(o=o.filter((e=>(0,N.av)(e)!==s))),o}async function Te(e,t,n,i){if(0!==G)return;let s;if("other"===t){const t=d.ZP.getActivePage(e);if(!t)return;s=d.ZP.getPages(e).filter((e=>e.id!==t.id))}else if("all"===t)s=d.ZP.getPages(e);else if(i&&"selection"===t)s=i;else{const t=d.ZP.getActivePage(e);if(!t)return;s=_.aV.of(t)}await Promise.all(s.map((async e=>{G++;try{await Z.Z.tabsPrivate.update(e.id,{muteTab:"mute"===n})}finally{G--}})))}function Ze(e){return e instanceof _.aV}async function Ee(e,t,n){if(Ze(t)){const i=t;let s=i.some((e=>e.index<n))?n+1:n,o=!1;for(let t=0;t<i.size;t+=1){const a=i.get(t);if(!a)break;e!==a.windowId?await w.Z.tabs.move(a.id,{index:n+t,windowId:e}):(0===t&&s>a.index?s--:t>0&&(s<a.index||o)&&(s++,o=!0),a.index!==s&&await w.Z.tabs.move(a.id,{index:s,windowId:e}))}}else{const i=t;await w.Z.tabs.move(i.id,{windowId:e,index:n})}}async function ke(e,t,n){const i={updateWorkspace:!0,keepActiveTab:!1,...n};if(i.updateWorkspace){const n=d.ZP.getActiveWorkspace(t);await Promise.all(e.map((e=>(0,V.V)(e.id,{workspaceId:n}))))}const s=e.first().windowId;e.some((e=>e.active))&&!function(e,t){const n=q(e);return!!n&&(We.activateTab(n,t),!0)}(e,s)&&Y(s);const o=await w.Z.tabs.move(e.map((e=>e.id)).toArray(),{windowId:t,index:-1});if(i.keepActiveTab)We.openLastPage(t);else{await new Promise((e=>{w.Z.windows.update(t,{focused:!0},e)}));const n=e.find((e=>e.active));n&&await w.Z.tabs.update(n.id,{active:!0})}return o}async function _e(e,t){for(const[n]of d.ZP.getState())if((n===e||void 0!==t)&&t===d.ZP.getActiveWorkspace(n))return void v.Z.focus(n);let n;const i=void 0===t?e:d.ZP.findPageInAllWindows((e=>(0,N.cm)(e)===t))?.windowId;if(i){const e=d.ZP.getState().get(i);if(e){const{list:i,history:s}=e,o=i.filter((e=>(0,N.cm)(e)===t));for(let e=s.length-1;e>=0;e--){const t=s[e];if(n=o.find((e=>e.id===t)),n)break}n||(n=o.first())}}if(void 0!==t&&await function(e,t){const n=d.ZP.getWorkspacePages(t);if(n.size>0&&n.some((t=>t.windowId!==e)))return ke(n,e,{updateWorkspace:!1});return Promise.resolve()}(e,t),n)ve(n.id,e);else{const n={url:d.ZP.getDefaultStartpage(e),windowId:e,index:0,active:!0,vivExtData:JSON.stringify({workspaceId:t})};y.ZP.isPopulatingEmptyWorkspace=!0,await w.Z.tabs.create(n),y.ZP.isPopulatingEmptyWorkspace=!1}}async function Ne(e,t,n=!1){const i=Ze(e)?e:_.aV.of(e),s=i.first().windowId,o=d.ZP.getActiveWorkspace(s);let a=s;const r=i.groupBy(N.av).map(((e,t)=>void 0===t||d.ZP.getGroup(t,s).size===e.size?(0,_.aV)():e)).flatten().toList();if(await De(r),t&&(a=S.Z.getWindowId(t)??s,a!==s))return await _e(a,t),void await ke(i,a);const l=(d.ZP.getPages(a,{workspaceId:t}).map((e=>e.index)).max()??-1)+1,c={workspaceId:t};if(await Promise.all(i.map((e=>(0,V.V)(e.id,c)))),n||await We.moveToIndex(a,i,l),0===d.ZP.getPages(s,{workspaceId:o}).size){const{pageId:e}=await We.openURL(s,"",{inBackground:!0});We.activateTab(e,s)}}async function Pe(e,t,n){if(!re())return"";const i=e.count((e=>e.pinned));if(i>0&&i<e.size)return console.warn("Can't group a combination of pinned and unpinned pages."),"";const s=e.find(N.av),o=s?(0,N.av)(s):"",r=n||o||d.ZP.getNewGroupId(),l=s&&r===o?(0,N.XN)(s):void 0;await Promise.all(e.filter((e=>(0,N.av)(e)!==r)).map((({id:e})=>(0,V.V)(e,{group:r,fixedGroupTitle:l}))));const c="number"==typeof t?t:e.first().index,u=e.first().windowId;return await Ee(u,e,c),a.Z.dispatch({actionType:"PAGE_TABSTACK_CREATE",windowId:u,pages:e}),r}async function De(e){const t=Ze(e)?e:_.aV.of(e);if(t.isEmpty())return;const n=t.first().windowId;a.Z.dispatch({actionType:"PAGE_TABSTACK_REMOVE_FROM",windowId:n,pages:t}),await we(t,!1);const i=d.ZP.getPages(n).last().index+1;await We.moveToIndex(n,t,i)}function Me(e,t=(0,_.aV)()){const n=function(n){const{clipboardData:i}=n;if(!i)return;const s=e.map((e=>k.jk.getHoverUrl(e.url))).concat(t).join("\n");i.setData("text/plain",s),i.setData("text/uri-list",s),i.setData("vivaldi/x-uri-list",s),n.preventDefault()};document.addEventListener("copy",n),document.execCommand("copy"),document.removeEventListener("copy",n)}async function Oe(e,t){await Promise.all(e.map((e=>w.Z.tabs.update(e.id,{pinned:t}))))}async function xe(e,t){let n,i;"always"===t?(n=!0,i=!1):"cache"===t?(n=!0,i=!0):"never"===t&&(n=!1,i=!1),await Z.Z.tabsPrivate.update(e.id,{showImages:n,loadFromCacheOnly:i}),p.Z.set(B.kPageImageLoading,t)}async function Le(e,t,n="selection"){if(0===e.size)return;const i=e.first().windowId,s=t||(e.count()<4?"row":"grid"),o=crypto.randomUUID();await Promise.all(e.map((e=>(0,V.V)(e.id,{tiling:{layout:s,type:n,id:o}})))),a.Z.dispatch({actionType:"PAGE_TILE_PAGES",windowId:i,pages:e,id:o})}function Re(e,t){const n=d.ZP.getTiles(t,e);n&&Be(n)}async function Be(e){if(e.isEmpty())return;const t=e.first().windowId;a.Z.dispatch({actionType:"PAGE_TILE_REMOVE_PAGES",windowId:t,pages:e}),await Promise.all(e.map((e=>(0,V.V)(e.id,{tiling:void 0}))))}function Fe(e){a.Z.dispatch({actionType:"PAGE_SELECTION_CLEAR",windowId:e})}const We={clear:function(){a.Z.dispatch({actionType:"PAGE_CLEAR"})},clearSelection:Fe,clonePages:async function(e){if(be)return[];be=!0;const t=[];try{const n=e.sort(((e,t)=>e.index-t.index)).filter((e=>!(0,k.m7)(e)));let s=-1;for(const e of n){s++;const n=e.index,o=await w.Z.tabs.duplicate(e.id);if(!o)continue;const a=o.id;if(!a)continue;"alwayslast"===h.Z.get(B.kTabsActivationOnClone)?await w.Z.tabs.move(a,{index:-1}):await w.Z.tabs.move(a,{index:n+1+s});const r=(0,N.av)(e);if(r&&d.ZP.getGroup(r,e.windowId).size>1){const t=i.ZP.tabToPage(o);await Pe((0,_.aV)([e,t]))}t.push(a)}}finally{be=!1}return t},close:async function(e){const t=await Se();try{if(y.ZP.isTabbedBrowser(e)){const t=d.ZP.getSelectionOrActivePage(e);await We.closePage(t)}else await v.Z.close(e)}finally{t()}},closeOther:function(e,t,n){const i=Ze(e)?e:_.aV.of(e),s=i.first().windowId;let o;if(n){const e=i.flatMap((e=>(d.ZP.isGroup((0,N.av)(e),e.windowId)?d.ZP.getGroup((0,N.av)(e),e.windowId):_.aV.of(e)).map((e=>e.id))));o=d.ZP.getPages(s,{workspaceId:t}).filter((e=>!e.pinned)).filter((t=>!e.includes(t.id)))}else{const e=i.map(N.av).toSet();o=1===e.size&&void 0!==e.first()?d.ZP.getPages(s,{workspaceId:t}).filter((t=>(0,N.av)(t)===e.first())).filter((e=>!i.some((t=>t.id===e.id)))):d.ZP.getPages(s,{workspaceId:t}).filter((e=>!e.pinned)).filter((e=>!i.some((t=>t.id===e.id))))}return Ce(o)},closePage:Ce,closeTabStack:async function(e){const t=d.ZP.getPageById(e);if(!t)return;const n=(0,N.av)(t);Ce(d.ZP.getGroup(n,t.windowId))},closeToLeft:async function(e,t){const n=Ae(e,t);if(!n.isEmpty())return Ce(n)},closeToRight:async function(e,t){const n=Ie(e,t);if(!n.isEmpty())return Ce(n)},closeUrl:function(e,t){Ce(d.ZP.getPages(e).filter((e=>(0,L.uu)(t,e.url))))},copyUrls:Me,copyAllUrls:function(e,t){Me(d.ZP.getPages(e,{workspaceId:t}))},createStackFromActiveTab:async function(e){if(!re())return;const t=d.ZP.getSelectedPages(e);if(t.size>1)return We.createTabStack(t);const n=d.ZP.getActiveWorkspace(e),i=d.ZP.getPages(e,{workspaceId:n}).filter((e=>!e.pinned&&!(0,N.av)(e)));if(i.size>1){const[t,s]=(0,x.d)(d.ZP.unsafeGetActivePage(e),d.ZP.getWorkspaceTabsInWindow(e,n,!1));if(s.size>1){const n=d.ZP.getNewGroupId();return await fe(e,n,t),We.createTabStack(s,void 0,n)}return We.createTabStack(i)}},createTabStack:Pe,createGroupByHost:async function(e,t,n){const i=d.ZP.getGroupsForHosts(e,t).get(n);if(i){const t=d.ZP.getNewGroupId();return await We.createTabStack(i,void 0,t),await fe(e,t,n),t}},createGroupByHosts:function(e,t){d.ZP.getGroupsForHosts(e,t).forEach((async(t,n)=>{const i=d.ZP.getNewGroupId();await We.createTabStack(t,void 0,i),await fe(e,i,n)}))},changePeriodicReloadForPages:async function(e,t){await Promise.all(e.map((e=>(0,V.V)(e,{interval:t}))))},cycleByHistory:function(e,t,n={goBack:!1}){const i=(0,C.Z)(e),s=t instanceof i.WheelEvent&&t.buttons===T.Z.kRight,o=(0,I.Z)(t)||s;if(o){const n=()=>{a.Z.dispatch({actionType:"PAGE_CYCLE_HISTORY_MODIFIER_UP",windowId:e,workspaceId:d.ZP.getActiveWorkspace(e)})};s&&t instanceof i.WheelEvent?(0,U.g)(t,n,i.document):(0,F.Kz)(t,n)}a.Z.dispatch({actionType:"PAGE_SET_CYCLE_BY_HISTORY",windowId:e,goBack:n.goBack,activateEventModifierUp:o,workspaceId:d.ZP.getActiveWorkspace(e)})},cycleByOrder:function(e,t,n={goBack:!1}){const i=d.ZP.getActiveWorkspace(e),s=d.ZP.getCyclePageByOrder(e,i,n.goBack);s&&ve(s,e)},detachPage:async function(e,t,n){const i=Ze(e)?e:_.aV.of(e),s=i.first().windowId,o=i.map((e=>e.id)),a=(0,A.Z)(s).find((e=>!o.includes(e.id)));a&&ve(a.id,s),1===i.size&&await De(i),await Ne(i,void 0,!0);const r=i.first(),l=i.rest(),d=(await v.Z.openBrowserWindow(s,[],{tabId:r.id,left:t,top:n}))?.id;"number"==typeof d&&l.count()&&await ke(l,d)},detachWorkspace:async function(e,t){const n=d.ZP.getWorkspacePages(t).first(),i=await v.Z.openBrowserWindow(n?n.windowId:e,[]);i?.id&&await _e(i.id,t)},discardPage:function(e){e.isInspected||w.Z.tabs.discard(e.id)},exitPictureInPicture:function(e){w.Z.scripting.executeScript({target:{tabId:e},function:()=>{document.pictureInPictureElement&&document.exitPictureInPicture()}}).catch((e=>{}))},expandSelectionNext:function(e){a.Z.dispatch({actionType:"PAGE_SELECTION_EXPAND_NEXT",page:e})},expandSelectionPrevious:function(e){a.Z.dispatch({actionType:"PAGE_SELECTION_EXPAND_PREVIOUS",page:e})},expandTabStack:async function(e,t){const n=d.ZP.getPages(e).filter((e=>(0,N.av)(e)===t));await Promise.all(n.map((e=>(0,V.V)(e.id,{group:void 0,fixedGroupTitle:void 0}))))},getTabsToTheLeft:Ae,getTabsToTheRight:Ie,gotoParentDirectory:function(e,t){const{url:n}=t,i=n.lastIndexOf("/");if(-1===i)return;let s;if(i+1===n.length){const e=n.substr(0,n.length-1).lastIndexOf("/");-1!==e&&(s=n.substr(0,e+1))}else s=n.substr(0,i+1);s&&!s.endsWith("://")&&We.openURL(e,s,{inSpecificPageId:t.id})},load:function(){he(),function(){const{tabsPrivate:e}=Z.Z;e.onMediaStateChanged.addListener(J),e.onPermissionAccessed.addListener(ee),e.onTabUpdated.addListener(te),e.onBeforeUnloadDialogClosed.addListener(ge),e.onTabResourceMetricsRefreshed.addListener(ne)}(),function(){const{windowPrivate:e}=Z.Z;e.onBeforeUnloadDialogOpened.addListener(ie)}(),h.Z.addListener(B.kTabsSelectionIncludeActive,Fe),$();const e=h.Z.get(B.kTabsStackingNameMap)||{};Object.keys(e).length&&setTimeout(me,3e4)},minimizePage:ye,moveDroppedTabs:async function(e,t,n,i,s){const o=d.ZP.getActiveWorkspace(e);let a;if(void 0===s)a={workspaceId:o};else if(""===s)a={group:s,workspaceId:o,fixedGroupTitle:void 0};else{const t=d.ZP.getGroup(s,e).first(),n=t?(0,N.XN)(t):void 0;a={group:s,workspaceId:o,fixedGroupTitle:n}}t.map((e=>(0,V.V)(e.id,a))),await Ee(e,t,i),(n?t.find((e=>e.id===parseInt(n))):t.first())&&ve(n,e),await new Promise((e=>setTimeout(e,100))),Oe(t.filter((e=>e.pinned)),!0)},moveToIndex:Ee,moveToWindow:ke,moveSelectionToWorkspace:function(e,t){const n=t>0?S.Z.getState()[t-1]?.id:void 0;if(void 0===n&&0!==t)return void console.warn(`Workspace number ${t} does not exist.`);Ne(d.ZP.getSelectionOrActivePage(e).filter(Boolean),n)},muteAllExcept:function(e,t){Te(e,"selection","mute",d.ZP.getPages(e).filter((e=>-1===t.findIndex((t=>t.id===e.id)))))},pinTabStack:async function(e,t){const n=d.ZP.getGroup(e,t);await Oe(n,!0)},newTab:async function(e,t,n={index:void 0,workspaceId:void 0,groupId:void 0,ignoreLinkRouting:void 0}){const i=n.index,s=n.workspaceId,o=n.groupId??void 0,r=(0,k.Gr)(t),l=r&&"_blank"!==r?r:d.ZP.getDefaultStartpage(e),c={url:l,windowId:e,index:i,active:!0,ignoreLinkRouting:n.ignoreLinkRouting,vivExtData:JSON.stringify({workspaceId:s,group:o}),pinned:d.ZP.isPinnedGroup(o,e)};h.Z.get(B.kWorkspacesEnabled)&&await _e(e,s);const u=await w.Z.tabs.create(c);if(void 0!==u?.id){const t=u.id;return a.Z.dispatch({actionType:"PAGE_OPEN_URL",pageId:t,windowId:e,url:l,postParams:void 0}),t}throw new Error("Failed to create tab")},openLastPage:function(e){const t=d.ZP.getActiveWorkspace(e),n=!re(),i=d.ZP.getWorkspaceTabsInWindow(e,t,n).last();i&&ve(i.page.id,e)},activateTab:ve,activateTabByIndex:function(e,t){const n=d.ZP.getActiveWorkspace(e),i=!re(),s=d.ZP.getWorkspaceTabsInWindow(e,n,i).get(t);if(!s)return;const o="group"===s.type?s.pages:(0,_.aV)();if(!(o.size>0)||!s.page.active)return void ve(s.page.id,s.page.windowId);if(o.last()===s.page)return void ve(o.first().id,e);const a=o.findIndex((e=>e.active))+1,r=o.get(a)?.id;r&&ve(r,e)},openURL:Y,openUrls:async function(e,t,n){n.inNewWindow?await v.Z.openBrowserWindow(e,t,{incognito:n.incognito}):await Promise.all(t.map(((i,s)=>n.inCurrent?We.openURL(e,i,{...n,inCurrent:0===s,inBackground:0!==s}):We.openURL(e,i,{...n,inBackground:n.inBackground||i!==(0,O.Z)(t)}))))},reloadPage:async function(e){const t=Ze(e)?e:_.aV.of(e);await Promise.all(t.map((e=>w.Z.tabs.reload(e))))},removeFromTabStack:De,closeWorkspaceTabs:function(e){const t=d.ZP.getWorkspacePages(e).map((e=>e.id)).toArray();return w.Z.tabs.remove(t)},moveToWorkspace:Ne,setActiveWorkspace:_e,setFixedStackTitle:fe,setFixedTitle:async function(e,t){await(0,V.V)(e,{fixedTitle:t?t.substring(0,50):void 0})},setHistoryManagerState:async function(e,t){await(0,V.V)(e,{historyManagerState:t})},setImageInspector:function(e,t,n){a.Z.dispatch({actionType:"PAGE_SET_IMAGE_INSPECTOR",pageId:e,windowId:t,showImageInspector:n})},setImageLoading:xe,setMuting:Te,setPageInspected:function(e,t,n){a.Z.dispatch({actionType:"PAGE_SET_IS_INSPECTED",pageId:e,windowId:t,inspected:n})},setPinned:Oe,setReaderState:async function(e,t){await(0,V.V)(e,{readerMode:t})},setSelection:function(e,t){const{multiSelect:n=!1,addGroup:i=!0,excludeActive:s=!1}=t??{};a.Z.dispatch({actionType:"PAGE_SELECTION_SET",page:e,multiSelect:n,addGroup:i,excludeActive:s})},setThumbnail:async function(e,t){const n=d.ZP.getPageById(e);n&&(t?await(0,V.V)(e,{urlForThumbnail:n.url,thumbnail:t}):await(0,V.V)(e,{urlForThumbnail:void 0,thumbnail:void 0}))},setTitle:function(e,t,n){a.Z.dispatch({actionType:"PAGE_SET_TITLE",pageId:e,windowId:t,title:n})},showHomepage:async function(e,t){if(t.inCurrent){d.ZP.getActivePage(e)&&(0,P.gR)((0,C.Z)(e))}const n=h.Z.get(B.kHomepage),i=d.ZP.getDefaultStartpage(e),s=n===E.QG&&i===E.P1?i:n;await Y(e,s,t)},stepPage:async function(e,t,n,i){const s=d.ZP.getStepInfo(e,t,n,i);if(!s)return;const{pages:o,index:a}=s;await We.moveDroppedTabs(i,o,e.id,a,void 0)},stepTabsToStart:function(e){z({toStart:!0,windowId:e})},stepTabsToEnd:function(e){z({toStart:!1,windowId:e})},tileLastActive:async function(e,t){const n=d.ZP.getActivePage(e),i=d.ZP.getLastVisited(e);if(n&&i&&(0,N.cm)(n)===(0,N.cm)(i)){const s=(0,_.aV)([n,i]);s.forEach((t=>{const n=(0,N.jA)(t);n&&Re(e,n)})),await Le(s,t)}},tilePages:Le,tileTabStack:async function(e,t,n){const i=d.ZP.getGroup(t,e),s=n||(i.count()<4?"row":"grid");await Le(i,s,"group")},toggleImageLoading:async function(e){const t=h.Z.get(B.kPageImageLoading);"always"===t?await xe(e,"never"):"never"===t?await xe(e,"cache"):await xe(e,"always")},toggleMuting:async function(e,t){const n=t.filter((e=>{const t=r.Z.hasMediaState(e.id,"muting");return!e.vivExtData.vivaldi_tab_muted&&!t})),i=t.filter((e=>{const t=r.Z.hasMediaState(e.id,"muting");return e.vivExtData.vivaldi_tab_muted||t}));await Te(e,"selection","mute",n),await Te(e,"selection","unmute",i)},toggleRelatedSelection:function(e){a.Z.dispatch({actionType:"PAGE_SELECTION_TOGGLE_RELATED",page:e})},toggleSelectedPagesPinned:async function(e){const t=d.ZP.getSelectionOrActivePage(e);if(!t.isEmpty())for(let e=0;e<t.size;e+=1){const n=t.get(e);if(!n)return;const i=(0,N.av)(n),s=d.ZP.getGroup(i,n.windowId),o=n.pinned||s?.some((e=>e.pinned));if(s.size>1)for(let e=0;e<s.size;e+=1){const t=o?s.size-1-e:e,n=s.get(t);n&&await w.Z.tabs.update(n.id,{pinned:!o})}else await w.Z.tabs.update(n.id,{pinned:!o})}},tryToUpdateTabResources:function(e){Z.Z.tabsPrivate.getTabPerformanceData(e,(e=>{e.forEach((e=>ne(e)))}))},treeMove:async function({windowId:e,pages:t,groups:n,targetArea:i,targetPage:s,targetGroup:o="",targetWorkspaceId:a}){const r=d.ZP.getGroup(o,e).first(),l=r?(0,N.XN)(r):void 0,c=new Map;await Promise.all(t.map((async t=>{const s=(0,N.av)(t);switch(s&&c.set(s,t.windowId),i){case"pinned":return await(0,V.V)(t.id,{group:o,fixedGroupTitle:l,tiling:void 0,workspaceId:a}),void await w.Z.tabs.update(t.id,{pinned:!0});case"stack":{const n=d.ZP.getPages(e).find((e=>(0,N.av)(e)===o&&Boolean(e.vivExtData.tiling)))?.vivExtData.tiling;return await(0,V.V)(t.id,{group:o,fixedGroupTitle:l,tiling:n,workspaceId:a}),void await w.Z.tabs.update(t.id,{pinned:!1})}case"regular":{const e=(0,N.av)(t),i=n.includes(e)?e:void 0,s=t.vivExtData.tiling;return await(0,V.V)(t.id,{group:i,fixedGroupTitle:void 0,tiling:i?s:void 0,workspaceId:a}),void await w.Z.tabs.update(t.id,{pinned:!1})}}}))),s&&await We.moveToIndex(s.windowId,t,s.index),c.forEach(((e,t)=>{const n=d.ZP.getGroup(t,e).toArray();1===n.length&&(0,V.V)(n[0].id,{group:"",fixedGroupTitle:void 0})}))},unpinTabStack:async function(e,t){const n=d.ZP.getGroup(e,t);await Oe(n.reverse(),!1)},untilePages:Be,untileTileGroup:Re},Ue=We},18350:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});var i=n(15285),s=n(34197),o=n(68247),a=n(29087),r=n(33638),l=n(70864),d=n(7064),c=n(89175),u=n(34155);const p=new class{init(){const{barVisible:e}=a.Z.get(c.kPanelsWindowDefaults);r.Z.dispatch({actionType:"PANEL_INIT_COMMON",state:{regPanels:s.ZP.readRegPanelListFromPrefs(),webPanels:s.ZP.readWebPanelListFromPrefs(),barVisible:e}}),a.Z.addListener(c.kPanelsElements,p.setRegPanels),a.Z.addListener(c.kPanelsWebElements,p.setWebPanels),a.Z.addListener(c.kMailIsTurnedOff,p.setRegPanels)}setAddedButton(e,t,n,i){t===c.kToolbarsPanel&&r.Z.dispatch({actionType:"PANEL_ADDED",winId:e,panelId:n,showContent:i})}setRemovedButton(e,t,n){t===c.kToolbarsPanel&&r.Z.dispatch({actionType:"PANEL_REMOVED",winId:e,panelId:n})}setMuted(e,t,n){r.Z.dispatch({actionType:"PANEL_SET_MUTED",winId:e,panelId:t,muted:n})}setFocus(e){r.Z.dispatch({actionType:"PANEL_SET_FOCUS",winId:e})}removeFocus(e){r.Z.dispatch({actionType:"PANEL_REMOVE_FOCUS",winId:e})}toggleFloating(){r.Z.dispatch({actionType:"PANEL_TOGGLE_FLOATING"})}showNextPanel(e,t){r.Z.dispatch({actionType:"PANEL_SHOW_NEXT",winId:e,direction:t})}setContentVisible(e,t){r.Z.dispatch({actionType:"PANEL_SET_CONTENT_VISIBLE",winId:e,visible:t})}togglePanel(e){r.Z.dispatch({actionType:"PANEL_TOGGLE_PANEL",winId:e})}toggleContent(e,t){switch(t){case"webpanel 1":case"webpanel 2":case"webpanel 3":case"webpanel 4":case"webpanel 5":case"webpanel 6":case"webpanel 7":case"webpanel 8":case"webpanel 9":{const n=l.Z.getIndexByShortcut(t),i=[...a.Z.get(c.kToolbarsPanel)].filter((e=>s.ZP.isWebPanel(e)));n>=1&&n<=i.length&&r.Z.dispatch({actionType:"PANEL_TOGGLE_CONTENT",winId:e,panelId:i[n-1]});break}default:r.Z.dispatch({actionType:"PANEL_TOGGLE_CONTENT",winId:e,panelId:t})}}showContent(e,t,n={selectId:"",reason:""}){const{setFocus:i=!1,selectId:s,reason:o}=n;r.Z.dispatch({actionType:"PANEL_SHOW_CONTENT",winId:e,panelId:t,setFocus:i,selectId:s,reason:o})}setWidth(e,t,n){r.Z.dispatch({actionType:"PANEL_SET_WIDTH",winId:e,panelId:t,width:n})}toggleCurrentPanel(e){r.Z.dispatch({actionType:"PANEL_TOGGLE_CURRENT",winId:e})}setSeparateFloating(e,t){let n=a.Z.get(c.kPanelsWebElements).slice(),i=n.findIndex((t=>t.id===e));if(-1!==i){const e={...n[i]};return e.floating=t,n[i]=e,void o.Z.set(c.kPanelsWebElements,n)}if(n=a.Z.get(c.kPanelsElements).slice(),i=n.findIndex((t=>t.id===e)),-1!==i){const e={...n[i]};e.floating=t,n[i]=e,o.Z.set(c.kPanelsElements,n)}}setPanelResizable(e,t){r.Z.dispatch({actionType:"PANEL_SET_RESIZABLE",panelId:e,resizable:t})}setRegPanels=()=>{u.nextTick((()=>{r.Z.dispatch({actionType:"PANEL_SET_REG_PANELS",list:s.ZP.readRegPanelListFromPrefs()})}))};setWebPanels=()=>{u.nextTick((()=>{r.Z.dispatch({actionType:"PANEL_SET_WEB_PANELS",list:s.ZP.readWebPanelListFromPrefs()})}))};setWebPanelStringValue=(e,t,n)=>{"title"===t?l.Z.setTitle(e,n):"faviconUrl"===t?l.Z.setFaviconUrl(e,n):"activeUrl"===t&&l.Z.setActiveUrl(e,n)};setWebPanelBoolValue=(e,t,n)=>{"hasBeenVisible"===t&&l.Z.setHasBeenVisible(e,n)};translateWithPanel(e,t,n){i.ZP.getIsVisible(e,"PanelTranslate")||this.toggleContent(e,"PanelTranslate"),d.Z.utilities.broadcastMessage({translate:{winId:e,lang:t,text:n}})}clearTransitionState(e,t){r.Z.dispatch({actionType:"PANEL_CLEAR_TRANSITION_STATE",winId:e,panelId:t})}closePanel(e){const t=i.ZP.getSelected(e);t&&r.Z.dispatch({actionType:"PANEL_CLOSE",winId:e,panelId:t})}},h=p},14481:(e,t,n)=>{"use strict";n.d(t,{Z:()=>p});var i=n(59322),s=n(96951),o=n(34197),a=n(32921),r=n(33638),l=n(70864),d=n(69046);async function c(e){const{id:t,from:n,interval:o}=e;if(l.Z.isExtPanel(t))return;if(!o)return;const d={id:t,scheduledTime:(0,a.d)({periodInMinutes:o}),periodInMinutes:o,from:n},c=s.ZP.getPageByReloadId(t);c?await i.ZP.changePeriodicReloadForPages([c.id],o):"panel"===n&&l.Z.setPeriodicReload(t,o),r.Z.dispatch({actionType:"PERIODIC_RELOAD_CREATE",alarm:{alarmId:t,alarm:d}})}async function u({ids:e,from:t}){for(const n of e){if(l.Z.isExtPanel(n))continue;const e=s.ZP.getPageByReloadId(n);e?await i.ZP.changePeriodicReloadForPages([e.id],0):"panel"===t&&l.Z.setPeriodicReload(n,null)}r.Z.dispatch({actionType:"PERIODIC_RELOAD_DESTROY",alarmIds:e})}const p={load:async function(){const e=new Map,t=Date.now();s.ZP.getReloadingPages().forEach((n=>{const i=n.vivExtData.interval,s=n.vivExtData.ext_id;if(!i||!s)return;const o={id:s,periodInMinutes:i,scheduledTime:(0,a.d)({periodInMinutes:i,currentTime:t}),from:"tab"};e.set(s,o)})),o.ZP.readWebPanelListFromPrefs().forEach((n=>{if(n.interval&&n.interval>0){const{id:i,interval:s}=n,o={id:i,periodInMinutes:s,scheduledTime:(0,a.d)({periodInMinutes:s,currentTime:t}),from:"panel"};e.set(i,o)}})),r.Z.dispatch({actionType:"PERIODIC_RELOAD_ALL",alarms:e})},createOrDestroyAlarm:async function(e){const{alarm:t,id:n,interval:i,from:s}=e;l.Z.isExtPanel(n)||(t?.periodInMinutes===i?await u({ids:[n],from:s}):await c({id:n,interval:i,from:s}))},createPeriodicReloadAlarm:c,destroyTabPeriodicAlarms:async function(e){const t=s.ZP.getActiveWorkspace(e),n=s.ZP.getReloadingPages().filter((n=>n.windowId===e&&(0,d.cm)(n)===t)),o=n.map((e=>e.vivExtData.ext_id)).toArray(),a=n.map((e=>e.id)).toArray();await i.ZP.changePeriodicReloadForPages(a,0),r.Z.dispatch({actionType:"PERIODIC_RELOAD_DESTROY",alarmIds:o})},destroyAllPanelPeriodicAlarms:async function(){const e=[];for(const t of a.Z.getPanelAlarms().keys())e.push(t),l.Z.setPeriodicReload(t,null);r.Z.dispatch({actionType:"PERIODIC_RELOAD_DESTROY",alarmIds:e})},destroyPeriodicAlarm:u,updateRunningAlarm:function(e,t){const n={alarmId:e,alarm:t};r.Z.dispatch({actionType:"PERIODIC_RELOAD_UPDATE",alarm:n})}}},92413:(e,t,n)=>{"use strict";n.d(t,{Z:()=>f});var i=n(59322),s=n(96951),o=n(68247),a=n(29087),r=n(37330),l=n(33638),d=n(83526),c=n(68079),u=n.n(c),p=n(63164),h=n(89175);function g(e){const t=a.Z.get(h.kWebpagesReaderStyle),n=s.ZP.getActivePage(e);n?.vivExtData.readerMode&&(0,p.VN)(n.id,{type:"READER_MODE_SET_STYLE",readerStyle:{...t,...r.Z.getReaderThemeColor(e)}})}function m(e,t){if(t.tab?.id)switch(e.type){case"READER_MODE_SET_READERABLE":const n=e.isReaderable;l.Z.dispatch({actionType:"READERMODE",supportsReaderMode:n,pageId:t.tab.id,windowId:t.tab.windowId});break;case"READER_MODE_UPDATE_STYLE":g(t.tab.windowId)}}const f={init:function(){(0,p.Tg)(m)},setReaderModeStyle:g,resetReaderModeStyle:function(e){o.Z.reset(h.kWebpagesReaderStyle),g(e)},toggleReaderMode:async function(e){u()(e.url)&&(e.vivExtData.readerMode?await i.ZP.setReaderState(e.id,!1):await i.ZP.setReaderState(e.id,!0),d.Z.doAction(e.windowId,e.id,"focusWebView"))}}},54614:(e,t,n)=>{"use strict";n.d(t,{Bz:()=>m,Ey:()=>p,IH:()=>h,MT:()=>d,Od:()=>g,S1:()=>u});var i=n(96951),s=n(60331),o=n(33638),a=n(56371),r=n(7064);const l=["http://","https://","file://"];function d(e){return l.some((t=>e?.toLowerCase().startsWith(t)))}function c(){r.Z.readingListPrivate.getAll((e=>{o.Z.dispatch({actionType:"READING_LIST_UPDATE",entries:e})}))}function u(){c(),r.Z.readingListPrivate.onModelChanged.addListener((()=>c()))}function p(e,t){let n=0;t.forEach((t=>{d(t.url)&&r.Z.readingListPrivate.add(t.url,t.title,(t=>{t&&(n+=1,s.Z.setStatus(e,(0,a.Z)("$1 page has been added to Reading List.","$1 pages have been added to Reading List.",[n])))}))}))}function h(e,t,n=""){let o=t??"";if(!o){const t=i.ZP.getActivePage(e);t&&(o=t.url,n=t.title)}d(o)&&r.Z.readingListPrivate.add(o,n,(t=>{t&&s.Z.setStatus(e,(0,a.Z)("Page “$1” added to Reading List.",[n]))}))}function g(e){r.Z.readingListPrivate.remove(e,(()=>{}))}function m(e,t){r.Z.readingListPrivate.setReadStatus(e,t,(()=>{}))}},66971:(e,t,n)=>{"use strict";n.d(t,{Z:()=>A});var i=n(46382),s=n(29087),o=n(18237),a=n(33638),r=n(56371),l=n(30381),d=n.n(l),c=n(7064),u=n(15489),p=n(89175);function h(e,t,n){switch(t){case"added":n.item&&a.Z.dispatch({actionType:"SESSION_ADDED",id:e,owner:n.owner,parentId:n.parentId,index:n.index,item:n.item});break;case"changed":n.item&&a.Z.dispatch({actionType:"SESSION_CHANGED",id:e,item:n.item});break;case"content":n.content&&a.Z.dispatch({actionType:"SESSION_CONTENT",id:e,owner:"",content:n.content});break;case"deleted":a.Z.dispatch({actionType:"SESSION_DELETED",id:e});break;case"moved":n.item&&a.Z.dispatch({actionType:"SESSION_MOVED",id:e,item:n.item,parentId:n.parentId,index:n.index})}}function g(e){const t=new Map,n=new Map;a.Z.dispatch({actionType:"SESSION_SET_LOADING_PARAMETERS",opening:e,workspaceAsTabs:!1,persistentTabs:!0,workspaceMap:t,groupNameMap:n})}function m(){a.Z.dispatch({actionType:"SESSION_RECOVERY_START"})}function f(){a.Z.dispatch({actionType:"SESSION_RECOVERY_DONE"})}async function v(e,t){function n(e){const t=s.Z.get(p.kWorkspacesList);for(let n=0;n<t.length+1;n++)if(!t.some((t=>t.id===e+n)))return e+n;return-1}let i=!0;const r=new Map,l=new Map;for(let t=0;t<e.length;t++){const s=o.ZP.getById(e[t]),a=s?.item.workspaces;if(a?.length){let e=0;for(let t=0;t<a.length;t++){if(e=n(e+1),-1===e){i=!1;break}r.set(a[t].id,e)}}s?.item.groupNames.length&&s.item.groupNames.forEach((e=>{l.set(e.id,{windowId:u.Ex,name:e.name})}))}i||r.clear(),a.Z.dispatch({actionType:"SESSION_SET_LOADING_PARAMETERS",opening:e.length>0,workspaceAsTabs:t,persistentTabs:!1,workspaceMap:r,groupNameMap:l})}async function y(){const e=s.Z.get(p.kSessionsSaveDays),t=await c.Z.sessionsPrivate.getAutosaveIds(e);C.remove(t)}function b(){a.Z.dispatch({actionType:"SESSION_SET_TIMED_BACKUP",backup:"on"===s.Z.get(p.kSessionsSaveOnExit)})}function S(e){if("backup"===e.reason||"autosave"===e.reason){const t={name:"",filename:"",parentId:-1,index:-1,owner:"",backup:e.reason};c.Z.sessionsPrivate.add(t,(e=>{e&&console.warn("Error making session backup: "+e)}))}}function w(){return d()().format("YYYY-MM-DD_HH_mm_ss")}const C=new class{loadPromise=()=>(c.Z.sessionsPrivate.onChanged.addListener(h),c.Z.sessionsPrivate.onPersistentLoad.addListener(g),c.Z.utilities.onSessionRecoveryStart.addListener(m),c.Z.utilities.onSessionRecoveryDone.addListener(f),s.Z.addListener(p.kSessionsSaveDays,y),s.Z.addListener(p.kSessionsSaveOnExit,b),o.ZP.addListener(S),new Promise((e=>{c.Z.sessionsPrivate.getAll((t=>{t.loadingFailed&&console.warn("Error loading session list"),a.Z.dispatch({actionType:"SESSION_INIT",model:t,backup:"on"===s.Z.get(p.kSessionsSaveOnExit)}),e()}))})));setTitle=(e,t)=>{c.Z.sessionsPrivate.rename(e,t.trim())};add(e,t,n,i,s,a){const r=w(),l={name:e||r,filename:r,parentId:t,index:n,owner:i,windowId:s,ids:a};if(t<0||o.ZP.isTrash(t,!0))l.index=0;else if(t!==o.ZP.getRootId()){const e=o.ZP.getById(t);e?.item.parentId===o.ZP.getRootId()&&(l.index=e?.index??0)}return n<0&&(l.index=0),l.parentId=o.ZP.getRootId(),new Promise((e=>{c.Z.sessionsPrivate.add(l,(t=>{e(t)}))}))}duplicate(e,t,n,i){const s=o.ZP.getById(e),a=w(),l={name:s?.item.name?(0,r.Z)("$1 (copy)",[s?.item.name]):a,filename:a,parentId:t,index:n,owner:i,fromId:e};return new Promise((e=>{c.Z.sessionsPrivate.add(l,(t=>{e(t)}))}))}async requestContent(e,t){const n=await c.Z.sessionsPrivate.getContent(e);n.id===e&&0!==n.windows.length?a.Z.dispatch({actionType:"SESSION_CONTENT",id:e,owner:t,content:n}):console.warn("Failed to load content for",e)}emptyTrash(){return new Promise((e=>{c.Z.sessionsPrivate.emptyTrash((t=>{t&&console.warn("Error emptying trash: "+t),e()}))}))}makeContainer(e){return new Promise((t=>{c.Z.sessionsPrivate.makeContainer(e,(e=>{t(e)}))}))}modifyContent(e,t){return new Promise((n=>{c.Z.sessionsPrivate.modifyContent(e,t,(t=>{t&&console.warn("Error modifying session '"+e+"', error: "+t),n(t)}))}))}move(e,t,n){return Promise.all(e.map((e=>new Promise((i=>{const s=o.ZP.getById(e);c.Z.sessionsPrivate.move(e,t,n,(t=>{t&&console.warn("Error moving session '"+e+"', error: "+t),i(e)})),s&&(s.item.parentId!==t||s.index>n)&&n++})))))}async open(e,t,n,a=[]){const l=async(e,t,n,s,o)=>{const a={newWindow:n,oneWindow:!n,withWorkspace:!0,tabIds:o};return await v(t,s),Promise.all(t.map((t=>new Promise((n=>{c.Z.sessionsPrivate.open(t,e,a).then((s=>{s&&(console.warn("Error opening session '"+t+"', error: "+s),i.Z.showModalInfo(e,{title:(0,r.Z)("Sessions"),body:(0,r.Z)("No tabs were opened. You may have excluded all tabs in the session.")})),n()}))}))))).then((()=>{v([],!1)}))},d=t.length>1?[]:a;return t.map((e=>o.ZP.getById(e))).filter(Boolean).some((e=>e.item?.workspaces.length))?new Promise((o=>{s.Z.get(p.kWorkspacesEnabled)?i.Z.showIncludeWorkspaceDialog(e,{onClose:i=>{l(e,t,n,i,d),o()}}):i.Z.showEnableWorkspaceDialog(e,{onClose:i=>{l(e,t,n,i,d),o()}})})):l(e,t,n,!0,a)}remove(e){let t=0;return Promise.all(e.map((e=>new Promise((n=>{const i=o.ZP.isTrash(e,!1);c.Z.sessionsPrivate.delete(e,t,(t=>{t&&console.warn("Error deleting session '"+e+"', error: "+t),n()})),i||t++})))))}async restore(e){let t=0;for(const n of e){const e=o.ZP.getById(n);if(e&&o.ZP.isTrashFolder(e.item.parentId))if(o.ZP.isAutoSaveNode(n)){const e=o.ZP.getById(o.ZP.getTrashId()),t=e?e.index:0;await C.move([n],o.ZP.getRootId(),t)}else-1===e.item.containerId?await C.move([n],o.ZP.getRootId(),t++):await C.move([n],e.item.containerId,0)}}update(e,t,n){const i={name:"",filename:w(),parentId:-1,index:-1,owner:"",windowId:t,ids:n};return new Promise((t=>{c.Z.sessionsPrivate.update(e,i,(e=>{t(e)}))}))}},A=C},43656:(e,t,n)=>{"use strict";n.d(t,{Z:()=>A});var i=n(5298),s=n(84451),o=n(96951),a=n(29087),r=n(60331),l=n(15489),d=n(2497),c=n(7064),u=n(89175);const p=new Map;function h(e){return p.get(e)??{indicator:void 0,spatnavActive:!1,tabId:-1,point:void 0,url:"",path:""}}function g(e,t){p.get(e)?.spatnavActive!==t&&(p.set(e,{...h(e),spatnavActive:t}),t?(c.Z.tabsPrivate.onWebviewClickCheck.addListener(S),c.Z.tabsPrivate.onKeyboardChanged.addListener(m),s.Z.bind("ctrl+enter",v),s.Z.bind("shift+enter",y),s.Z.bind("ctrl+shift+enter",b)):(c.Z.tabsPrivate.onWebviewClickCheck.removeListener(S),c.Z.tabsPrivate.onKeyboardChanged.removeListener(m),s.Z.unbind("ctrl+enter",v),s.Z.unbind("shift+enter",y),s.Z.unbind("ctrl+shift+enter",b)))}function m(e,t,n,s){if(!t)return;const o=p.get(e);if(!o?.spatnavActive)return;const a=(0,d.Z)(e);if("WEBVIEW"!==a.document.activeElement?.tagName)g(e,!1);else if(s===i.Z.KEY_ESCAPE&&0===n&&o?.spatnavActive){const t=a.document.activeElement,n=parseInt(t.getAttribute("tab_id"));c.Z.tabsPrivate.closeSpatnavOrCurrentOpenMenu(n,(({layout_changed:t,current_element_valid:n})=>{t&&n||g(e,!1)}))}else s===i.Z.KEY_RETURN&&0===n&&f(e,0)}function f(e,t){g(e,!1);const n=p.get(e),i=(0,d.Z)(e).document.activeElement;if(n?.point&&i){const e=parseInt(i.getAttribute("tab_id"));c.Z.tabsPrivate.activateSpatnavElement(e,t)}}function v(e){f(e.windowId,2)}function y(e){f(e.windowId,1)}function b(e){f(e.windowId,3)}function S(e,t,n,i,s){const o=(0,d.Z)(e).document.activeElement;if(!o)return;const a=parseInt(o.getAttribute("tab_id"));p.get(e)?.spatnavActive&&c.Z.tabsPrivate.closeSpatnavOrCurrentOpenMenu(a,(({layout_changed:t,current_element_valid:n})=>{t&&n||g(e,!1)})),g(e,!1)}function w(e){if(e!==l.ZP.getActiveWindowId())return;if(!(0,d.Z)(e).document.activeElement)return;const t=o.ZP.getActivePage(e)?.url??"",n=p.get(e)?.url??"";if(n){if(n!==t){const n=p.get(e)?.spatnavActive;n&&g(e,!1),p.set(e,{...h(e),url:t,point:void 0})}}else p.set(e,{...h(e),url:t,point:void 0})}async function C(e,t){const n=(0,d.Z)(e).document.activeElement;if(!n)return;const i=parseInt(n.getAttribute("tab_id"));if(!a.Z.get(u.kWebpagesSpatialNavigationEnabled)&&i)return;if(p.set(e,{...h(e),tabId:i}),!i)return void g(e,!1);const s=await c.Z.tabsPrivate.moveSpatnavRect(i,t);s&&s.width>0?g(e,!0):g(e,!1),p.set(e,{...h(e),point:s}),r.Z.setStatus(e,s.href)}const A=new class{attachSpatnavListeners(e){const t={onPageStore:w.bind(this,e)};return o.ZP.addListener(t.onPageStore,(t=>t.get(e))),t}detachSpatnavListeners(e){o.ZP.removeListener(e.onPageStore)}async left(e){await C(e,"left")}async up(e){await C(e,"up")}async right(e){await C(e,"right")}async down(e){await C(e,"down")}}},60331:(e,t,n)=>{"use strict";n.d(t,{Z:()=>d});var i=n(33638),s=n(15489),o=n(1407);let a;function r(e){(e=l(e))!==o.Ex&&(clearTimeout(a),i.Z.dispatch({actionType:"STATUS_SET_STATUS",windowId:e,status:""}))}function l(e){return e===o.A4?s.ZP.getMailWindowId():e===o.Ex||s.ZP.isSettings(e)?s.ZP.getLastActiveBrowserWindowId():s.ZP.isTabbedBrowser(e)?e:o.Ex}const d={setStatus:function(e,t,n){(e=l(e))!==o.Ex&&(clearTimeout(a),i.Z.dispatch({actionType:"STATUS_SET_STATUS",windowId:e,status:t}),n&&(a=setTimeout((()=>r(e)),n)))},clearStatus:r,setPersistentStatus:function(e,t,n){(e=l(e))!==o.Ex&&i.Z.dispatch({actionType:"STATUS_SET_PERSISTENT_STATUS",windowId:e,key:t,status:n})},clearPersistentStatus:function(e,t){(e=l(e))!==o.Ex&&i.Z.dispatch({actionType:"STATUS_CLEAR_PERSISTENT_STATUS",windowId:e,key:t})},rerouteWindowId:l}},2699:(e,t,n)=>{"use strict";n.d(t,{Z:()=>_});var i=n(65792),s=n.n(i),o=n(68247),a=n(29087),r=n(9304),l=n(33638),d=n(15489),c=n(56371),u=n(92292),p=n(7064),h=n(58848),g=n(65741),m=n(89175),f=n(48588);const v=[m.kAppearanceDensity,m.kSystemAccentColor,m.kSystemDesktopThemeColor,m.kSystemHasDesktopWallpaperProtocol,m.kThemeDimBlurred,m.kThemePrivateWindow,m.kThemeScheduleEnabled,m.kThemeScheduleOS,m.kThemeScheduleTimeline,m.kThemeUseAnimation,m.kThemesCurrent,m.kThemeSimpleScrollbar,m.kThemesPreview,m.kThemesCurrentPrivate,m.kThemesSystem,m.kThemesUser];let y;const b=(0,h.Z)(((e,t)=>{s().valid(t)?l.Z.dispatch({actionType:"THEME_SET_META",tabId:e,color:s()(t)}):console.warn("Invalid meta theme color supplied for tabId",t,e)}),2e3,{trailing:!0});async function S(){const e=u.Z.extension.inIncognitoContext&&!window.isGuestSession?a.Z.get(m.kThemesCurrentPrivate):w(),t=r.ZP.getThemeWithFallback(e),{backgroundImage:n,backgroundPosition:i}=t;return[t,await r.ZP.getImageVars(n,i)]}function w(e){return r.ZP.getPreview()?.id||C(e)}function C(e){if(e&&d.ZP.isIncognito(e))return a.Z.get(m.kThemesCurrentPrivate);switch(a.Z.get(m.kThemeScheduleEnabled)){case"timeline":return r.ZP.getTimerByDate(new Date,"current").themeId;case"system":return a.Z.get(m.kThemeScheduleOS)[a.Z.get(m.kSystemDesktopThemeColor)];default:return a.Z.get(m.kThemesCurrent)}}function A(e){switch(a.Z.get(m.kThemeScheduleEnabled)){case"timeline":(0,f.kz)(m.kThemeScheduleTimeline,(t=>{const n=r.ZP.getTimerByDate(new Date,"current"),i=t.findIndex((e=>e.id===n.id));-1!==i&&(t[i].themeId=e)}));break;case"system":(0,f.kz)(m.kThemeScheduleOS,(t=>{t[a.Z.get(m.kSystemDesktopThemeColor)]=e}));break;default:o.Z.set(m.kThemesCurrent,e)}E()}function I(){if(u.Z.extension.inIncognitoContext)return;const e=new Date,t=r.ZP.getTimerByDate(e,"next");if(Z(),t&&"timeline"===a.Z.get(m.kThemeScheduleEnabled)){const n=60*(t.minutes+60*t.hours-60*e.getHours()-e.getMinutes())-e.getSeconds();y=setTimeout((async()=>{const e=r.ZP.getThemeWithFallback(t.themeId),n=await r.ZP.getImageVars(e.backgroundImage,e.backgroundPosition);l.Z.dispatch({actionType:"THEME_SET",style:n,theme:e}),I()}),1e3*n)}}async function T(){const e=a.Z.get(m.kThemeScheduleEnabled);if(["system","timeline"].includes(e)){const[e,t]=await S();l.Z.dispatch({actionType:"THEME_SET",style:t,theme:e})}"timeline"===e?I():Z()}function Z(){y&&clearTimeout(y)}function E(){a.Z.get(m.kThemesPreview)?.length>0&&o.Z.reset(m.kThemesPreview)}async function k(e,t,n){if((0,g.Z)(t,e))return;const[i,s]=await S();switch(n){case m.kThemeScheduleEnabled:case m.kThemeScheduleTimeline:l.Z.dispatch({actionType:"THEME_SET",style:s,theme:i}),"timeline"===a.Z.get(m.kThemeScheduleEnabled)?I():Z();break;case m.kThemeScheduleOS:case m.kThemesCurrent:case m.kSystemHasDesktopWallpaperProtocol:case m.kSystemDesktopThemeColor:case m.kThemesCurrentPrivate:case m.kThemeDimBlurred:case m.kAppearanceDensity:case m.kThemeSimpleScrollbar:case m.kThemesSystem:case m.kThemesUser:case m.kSystemAccentColor:case m.kThemeUseAnimation:case m.kThemesPreview:l.Z.dispatch({actionType:"THEME_SET",style:s,theme:i})}}const _={getCurrentId:w,getCurrentIdWithoutPreview:C,createTheme:function(e){const t=r.ZP.getThemeWithFallback(e),n={...t};return n.id=crypto.randomUUID(),n.version=1,n.url="",n.name=(0,c.Z)("$1 copy",[t.name]),A(n.id),o.Z.set(m.kThemesUser,[...a.Z.get(m.kThemesUser),n]),n.id},deleteTheme:function(e){const t=a.Z.get(m.kThemesUser),n=t.findIndex((t=>t.id===e));let i;if(-1!==n){if(t[n+1])i=t[n+1].id;else if(t[n-1])i=t[n-1].id;else{const e=a.Z.get(m.kThemesSystem);i=e[e.length-1].id}a.Z.get(m.kThemesCurrent)===e&&o.Z.set(m.kThemesCurrent,i),a.Z.get(m.kThemesCurrentButtons)===e&&o.Z.reset(m.kThemesCurrentButtons),(0,f.kz)(m.kThemeScheduleOS,(t=>{t.dark===e&&(t.dark=i),t.light===e&&(t.light=i)})),(0,f.kz)(m.kThemeScheduleTimeline,(t=>{for(let n=0;n<t.length;n++){const s=t[n];s.themeId===e&&(s.themeId=i)}})),o.Z.set(m.kThemesUser,t.filter((t=>t.id!==e)))}else console.warn(`Theme ${e} is not a user theme and cannot be deleted.`)},exportTheme:async function(e,t){await p.Z.themePrivate.export({...e,engineVersion:1},{windowId:t,dialogTitle:(0,c.Z)("Select Export Location")})},installTheme:function(){const e=a.Z.get(m.kThemesPreview)[0];if(e){const t=a.Z.get(m.kThemesUser);o.Z.set(m.kThemesUser,[...t,e]),A(e.id),E()}},updateTheme:function(){const e=a.Z.get(m.kThemesPreview)[0];if(e){(0,f.kz)(m.kThemesUser,(t=>{const n=t.findIndex((t=>t.id===e.id));t[n]=e}))&&A(e.id),E()}},clearThemePreview:E,loadFavicon:function(e,t){const n=new Image,i=e.url;n.crossOrigin="Anonymous",n.onload=()=>{n.height=16,n.width=16;const i=r.ZP.getPalette(n).map((e=>s()(e)));l.Z.dispatch({actionType:"THEME_SET_PAGE_PALETTE",favIconUrl:e.favIconUrl,hostname:t,windowId:e.windowId,colors:i})},n.onerror=()=>{l.Z.dispatch({actionType:"THEME_SET_FAILED_FAVICON_URL",url:i})},n.src=e.favIconUrl},loadPromise:async function(){E();const[e,t]=await S();l.Z.dispatch({actionType:"THEME_SET",style:t,theme:e,init:!0}),I(),a.Z.addListener(v,k),p.Z.tabsPrivate.onThemeColorChanged.addListener(b),p.Z.utilities.onSuspend.addListener(Z),p.Z.utilities.onResume.addListener(T)},revertSystemTheme:function(e){const t=a.Z.get(m.kThemesSystem),n=t.findIndex((t=>t.id===e)),i=a.Z.getDefault(m.kThemesSystem).find((t=>t.id===e));if(-1!==n&&void 0!==i){if(t[n]!==i){const e=[...t];e[n]=i,o.Z.set(m.kThemesSystem,e)}}else console.warn(e,"is not a valid system theme id")},updateCustomTheme:async function(e){const t=r.ZP.getTheme(e);if(t){const{url:e}=t,n=await fetch(e);n.ok||console.warn(`No response from: ${e}`);const i=await n.json();i.download&&t.version<=i.version?p.Z.themePrivate.download(t.id,i.download,(e=>console.log(`Theme loaded: ${e.themeID}`))):console.warn(`Bad response from: ${e}`)}},setNextTheme:function(){const e=a.Z.get(m.kThemesSystem),t=a.Z.get(m.kThemesUser),n=e.concat(t);let i;switch(a.Z.get(m.kThemeScheduleEnabled)){case"timeline":i=r.ZP.getTimerByDate(new Date,"current").themeId;break;case"system":const e=a.Z.get(m.kThemeScheduleOS),t=a.Z.get(m.kSystemDesktopThemeColor);i=e[t];break;default:i=a.Z.get(m.kThemesCurrent)}const s=n.findIndex((e=>e.id===i));A(n[s+1]?n[s+1].id:n[0].id)},setTheme:A,setThemeBackgroundImageFromUrl:function(e,t){const n=C(e);t.startsWith("file:")?p.Z.utilities.storeImage({themeId:n,url:t}):fetch(t).then((e=>e.blob())).then((e=>{e.arrayBuffer().then((t=>{p.Z.utilities.storeImage({themeId:n,mimeType:e.type,data:t})}))}))},setThemeByNameWithFallback:function(e){const t=a.Z.get(m.kThemesSystem),n=a.Z.get(m.kThemesUser),i=t.concat(n).find((t=>t?.name===e))?.id;i?A(i):console.warn((0,c.Z)("Unable to find a theme named $1",[e]))}}},69787:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var i=n(33638);class s{static setIntialized(e,t){i.Z.dispatch({actionType:"TILE_INITIALIZED",windowId:e,tilesState:t})}static setTileLayout(e,t,n){i.Z.dispatch({actionType:"TILE_SET_LAYOUT",windowId:e,mosaicLayout:t,id:n})}}},32773:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var i=n(33638);class s{static edit(e){i.Z.dispatch({actionType:"TOOLBAR_EDIT_MODE",toolbar:e})}static stopEditing(){i.Z.dispatch({actionType:"TOOLBAR_STOP_EDIT_MODE"})}}},65810:(e,t,n)=>{"use strict";n.d(t,{h:()=>a,i:()=>r});var i=n(33638);const s=(e,t)=>t?setTimeout(e,t):e();let o;function a(e,t=0){clearTimeout(o),o=s((()=>i.Z.dispatch({actionType:"TOOLTIP_SET",id:e})),t)}function r(e=0){clearTimeout(o),o=s((()=>i.Z.dispatch({actionType:"TOOLTIP_SET",id:null})),e)}},54058:(e,t,n)=>{"use strict";n.d(t,{Z:()=>S});var i=n(5198),s=n(96951),o=n(18350),a=n(29087),r=n(37330),l=n(9304),d=n(85374),c=n(33638),u=n(15489),p=n(7064),h=n(63164),g=n(89175);const m=["colorBgLighter","colorFg","colorBg","colorFgFadedMore","colorBorder","colorBgLighter","colorBgDark"];function f(e,t){let n=t.adoptedLanguage;"und"===n&&(n=t.cldLanguage,"und"===n&&(n="")),c.Z.dispatch({actionType:"VIVALDI_TABS_LANGUAGE_DETERMINED",tabId:e,pageLanguage:n})}function v(e,t,n,i){const s={isTranslated:!0,originalLang:t,translatedLang:n,error:i};c.Z.dispatch({actionType:"VIVALDI_TABS_PAGE_TRANSLATED",tabId:e,message:s})}function y(e,t){!1===t&&c.Z.dispatch({actionType:"VIVALDI_TABS_PAGE_TRANSLATED_REVERT",tabId:e})}const b={async translateSelection(e,t,n){const r=await i.Z.detectTextLanguage(t,n),l=n.replace(/\u00AD/g,"");a.Z.get(g.kPanelsTranslateRedirect)||s.ZP.getPageInWindow(e,t)?.isMailPage?o.Z.translateWithPanel(e,r,n):(0,h.VN)(t,{type:"TRANSLATE_SELECTION",text:l,textLanguage:r,destLanguage:i.Z.getTargetTranslationCode(),allLanguages:i.Z.getTranslationLocales()})},async sendInitDataToInjectedScript(e){const t=await p.Z.utilities.getCommandLineValue("translate-server-url");t&&console.warn("Translate server overridden: "+t);const n=s.ZP.getPageById(e)?.windowId,o=n?r.Z.getBaseStylesByWindowId(n,m):l.ZP.getFallbackStyle();try{await(0,h.VN)(e,{type:"TRANSLATE_INIT_DATA",destLanguage:i.Z.getTargetTranslationCode(),allLanguages:i.Z.getTranslationLocales(),buttonEnabled:a.Z.get(g.kWebpagesTranslateSelectionButtonEnabled),styles:o,overrideServer:t})}catch(e){}},async sendTextLanguageToInjectedScript(e,t){try{await(0,h.VN)(e,{type:"TRANSLATE_TEXT_LANGUAGE",textLanguage:t,textLanguageName:i.Z.getHumanReadableLanguageFromCode(t)})}catch(e){}},init(){p.Z.tabsPrivate.onLanguageDetermined.addListener(f),p.Z.tabsPrivate.onPageTranslated.addListener(v),p.Z.tabsPrivate.onIsPageTranslatedChanged.addListener(y),p.Z.tabsPrivate.onShowTranslationUI.addListener(((e,t,n,i)=>{c.Z.dispatch({actionType:"VIVALDI_TABS_TRANSLATION_PROGRESS",tabId:e,translateStep:t,error:n,autoTranslate:i})})),(0,h.Tg)((function(e,t,n){if(!t.tab?.id)return!1;const o=t.tab.id;switch(e.type){case"TRANSLATE_SELECTION_READY":return b.sendInitDataToInjectedScript(o),n(),!0;case"TRANSLATE_DETERMINE_LANGUAGE":i.Z.detectTextLanguage(o,e.text).then((e=>{b.sendTextLanguageToInjectedScript(o,e)}));break;case"TRANSLATE_RESULT":{const t=s.ZP.getPageById(o)?.windowId;t&&u.ZP.isActive(t)&&p.Z.translateHistory.add(e.item,0),i.Z.setTargetTranslationCode(e.destLang);break}case"TRANSLATE_SELECTION_BUTTON_CLICKED":{const t=s.ZP.getPageById(o)?.windowId;t&&b.translateSelection(t,o,e.text);break}}return!1}))},resetTranslationParameters(e){c.Z.dispatch({actionType:"PAGE_RESET_TRANSLATION_PARAMETERS",tabId:e})},async translatePage(e){const t=i.Z.getTargetTranslationCode(),n=d.ZP.getPageState(e);t&&n&&await p.Z.tabsPrivate.translatePage(e,n.pageLanguage?n.pageLanguage:"auto",t)}},S=b},76501:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u});var i=n(63365),s=n(33638),o=n(15489),a=n(92292),r=n(75256),l=n(7064);async function d(){const e=await a.Z.sessions.getRecentlyClosed();await new Promise((e=>setTimeout(e)));const t=e.filter((e=>{if(e.tab)return!0;if(!e.window)return!1;let t=!0;const n=(0,r.Z)(e.window.vivExtData);for(const[,e]of o.ZP.getState())if(t=e.extId!==n.ext_id,!t)break;return t}));s.Z.dispatch({actionType:"CHROME_SET_SESSION",session:t})}const c=new class{emptyTrash=()=>{l.Z.utilities.clearAllRecentlyClosedSessions()};removeTabs(e){l.Z.utilities.clearRecentlyClosedTabs(e,(e=>{e||console.warn("Error removing tabs")}))}undeleteTab(e){return new Promise(((t,n)=>{a.Z.sessions.restore(e,(i=>{a.Z.runtime.lastError&&(console.warn("Error restoring tab: ",e,a.Z.runtime.lastError),n()),t()}))}))}async undeletePreviousTab(){const e=i.Z.getTrash().find((e=>e.tab));e?.tab&&await c.undeleteTab(e.tab.sessionId)}undeleteWindow(e){a.Z.sessions.restore(e,(t=>{a.Z.runtime.lastError&&console.warn("Error restoring window: ",e,a.Z.runtime.lastError.message)}))}loadPromise=()=>(a.Z.sessions.onChanged.addListener(d),d())},u=c},67975:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var i=n(33638);const s=new class{updateState(e,t){i.Z.dispatch({actionType:"URLFIELD_UPDATE_STATE",pageId:e,state:t})}reset(e){i.Z.dispatch({actionType:"URLFIELD_RESET",pageId:e})}}},2004:(e,t,n)=>{"use strict";n.d(t,{Z:()=>_});var i=n(59322),s=n(39206),o=n(39840),a=n(16716),r=n(15489);const l=function(e){const t=e.replace(/^.*?\:\/\//,"");return!!t.includes('"')&&(!t.includes("/")||t.indexOf('"')<t.indexOf("/"))};var d=n(7064),c=n(36436),u=n(78614),p=n(86662);const h=/\s/,g=/^(\w{1,}\:(\/\/)?)?(\w{1,}(\.\w{1,})?(:\d{1,5})?[/?#])/,m=/\.(.{2,})(\/)/,f=/^([a-zA-Z0-9\-\._~!$&'()\*+,;=%]*(:[a-zA-Z0-9\-\._~!$&'()\*+,;=%]*)?)?@\S*/,v=/^[^\/ ]{1,}:(\/\/)?[^\/ ]{1,}(\/|\?|#)/,y=/^[^\/\s]+@[^@]+$/,b=/[a-z]+\/$/,S=/(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}/,w=/^localhost/,C=/https:\/+/i,A=/http:\/+/i;async function I(e,t,n){if(function(e){const t=e.split(" ");return t.length>=2&&void 0!==s.Z.getByKeyword(t[0])}(t))return T(e,t,n);const{addTypedSearchHistory:i,enableSearch:o,allowOverride:a,useSearchEngine:r,...I}=n,Z=t.trimEnd().replace(C,"https://").replace(A,"http://"),{urlValid:E,isBrowserUrl:k,schemeParsed:_}=d.Z.utilities.isUrlValid(Z);if((0,p.AZ)(Z)){const e=(0,c.q9)(Z);return Promise.resolve({url:e,options:I})}const N="file"!==_&&"javascript"!==_,P=h.test(Z),D=P&&g.test(Z),M=m.test(Z.split(" ")[0]),O=f.test(Z),x=v.test(Z);let L;function R(){return L||(L=d.Z.utilities.canOpenUrlExternally(Z)),L}const B=function(e){if(!e.includes(":"))return!1;if(e.includes(" ")&&e.indexOf(" ")<e.indexOf(":"))return!1;try{const t=parseInt(e.split(":")[1].split("/")[0]);return t>=0&&t<=65535}catch(e){return!1}}(Z);if(n.enableSearch&&!x&&!O&&!M&&!B&&(N&&P&&!D||""!==_&&!k&&!await R()))return T(e,Z,n);if(E&&(k||await R())&&!B)return Promise.resolve({url:Z,options:I});const F=Z.startsWith("?"),W=y.test(Z);if(F||W&&(0,u.HZ)(Z)||n.enableSearch&&l(Z))return T(e,F?Z.substr(1):Z,n);const U=(0,c.q9)(Z),V=b.test(Z),H=S.test(Z),G=d.Z.utilities.getUrlFragments(U),$=Boolean(G.tld),K=w.test(Z);if(n.enableSearch&&!H&&!$&&!B&&!K&&!V)return T(e,Z,n);try{return new URL(U),Promise.resolve({url:U,options:I})}catch(t){return n.enableSearch?T(e,Z,n):Promise.resolve({url:"vivaldi://network-error/-300",options:I})}}async function T(e,t,n={}){const i=t,{addTypedSearchHistory:o,enableSearch:a,allowOverride:l,useSearchEngine:c,...u}=n;if(c){Z(e,i,o);const{url:t,contentType:n,postParams:s}=await d.Z.searchEngines.getSearchRequest(c.guid,i);return{url:t,options:{...u,postParams:s,contentType:n,transition:d.Z.historyPrivate.TransitionType.KEYWORD}}}const p=s.Z.getByQuery(i);if(p){const t=i.substr(p.keyword.length+1),{url:n,contentType:s,postParams:a}=await d.Z.searchEngines.getSearchRequest(p.guid,t);return Z(e,t,o),{url:n,options:{...u,postParams:a,contentType:s,transition:d.Z.historyPrivate.TransitionType.KEYWORD}}}const h=s.Z.getDefault(r.ZP.isIncognito(e));if(h){const{url:t,contentType:n,postParams:s}=await d.Z.searchEngines.getSearchRequest(h.guid,i);return Z(e,i,o),{url:t,options:{...u,postParams:s,contentType:n}}}return{url:t,options:{...u}}}function Z(e,t,n){!a.Z.isEnabled("omnibox")&&n&&o.Z.addTypedSearchHistory(e,t)}async function E({windowId:e,url:t,options:n}){await i.ZP.openURL(e,t.replace(/ /g,"%20"),{inCurrent:!n.hasOwnProperty("inBackground"),...n})}const k={processUrl:I,processSearchUrl:T,go:async function(e,t,n){await Promise.all(t.map(((i,s)=>{const o=i.trimStart();if(!o)return Promise.resolve();const a={...n};return t.length>1&&(a.inBackground=s!==t.length-1),I(e,o,a).then((({url:t,options:n})=>E({windowId:e,url:t,options:n})))})))},goSearchUrl:async function(e,t,n){const{url:i,options:s}=await T(e,t,n);i&&await E({windowId:e,url:i,options:s})}},_=k},83526:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u});var i=n(30626),s=n(99827),o=n(96951),a=n(67975),r=n(33638),l=n(57904),d=n(2497),c=n(751);const u=new class{doAction(e,t,n,i){r.Z.dispatch({actionType:"WEBPAGEVIEW_ACTIONS",windowId:e,pageId:t,subAction:n,...i?{payload:i}:null})}findInPage(e,t,n,s){const o=i.Z.getActiveWebView(e);if(o){const i={findNext:!1,matchCase:s||!1};o.find(n,i,(i=>this._findCallback(e,t,n,s,i)))}}findNextInPage(e,t,n,s,o){const a=i.Z.getActiveWebView(e);if(a){const i={backward:s||!1,findNext:!0,matchCase:o||!1};a.find(n,i,(i=>this._findCallback(e,t,n,o,i)))}}_findCallback(e,t,n,i,s){s&&!s.canceled&&r.Z.dispatch({actionType:"WEBPAGEVIEW_RESULTS_FROM_FIND_IN_PAGE",windowId:e,pageId:t,searchText:n,matchCase:i,results:s})}closeFindInPageToolbar(e,t){return!0===l.Z.isFindInPageOpen(t)&&(r.Z.dispatch({actionType:"WEBPAGEVIEW_CLOSE_FIND_IN_PAGE",windowId:e,pageId:t}),!0)}go(e,t,n){r.Z.dispatch({actionType:"WEBPAGEVIEW_GO",windowId:e,pageId:t,index:n||0})}back(e,t){o.ZP.getPageInWindow(e,t)?.isMailPage?s.Z.pageBack(e):r.Z.dispatch({actionType:"WEBPAGEVIEW_BACK",windowId:e,pageId:t})}forward(e,t){o.ZP.getPageInWindow(e,t)?.isMailPage?s.Z.pageForward(e):r.Z.dispatch({actionType:"WEBPAGEVIEW_FORWARD",windowId:e,pageId:t})}getPageHistory(e,t,n){r.Z.dispatch({actionType:"WEBPAGEVIEW_GET_HISTORY",windowId:e,pageId:t,callback:n})}stop(e,t){r.Z.dispatch({actionType:"WEBPAGEVIEW_STOP",windowId:e,pageId:t})}reload(e,t,n){(0,c.gR)((0,d.Z)(e)),r.Z.dispatch({actionType:"WEBPAGEVIEW_RELOAD",windowId:e,pageId:t,bypassCache:n}),a.Z.reset(t)}}},63153:(e,t,n)=>{"use strict";n.d(t,{Z:()=>T});var i=n(30626),s=n(96951),o=n(68247),a=n(29087),r=n(60331),l=n(37330),d=n(9304),c=n(69787),u=n(33638),p=(n(96098),n(15489)),h=n(56371),g=n(92292),m=n(75256),f=n(7064),v=n(44850),y=n(89175),b=n(34155);function S(){0}function w(e,t){const n=p.ZP.getWindowState(e);n&&u.Z.dispatch({actionType:"WINDOW_STATE_CHANGED",windowId:e,oldState:n,change:t})}function C(e,t){u.Z.dispatch({actionType:"WINDOW_ACTIVATED",windowId:e,activated:t})}function A(e){u.Z.dispatch({actionType:"WINDOW_READY",windowId:e})}function I(e,t,n){for(const[e]of p.ZP.getState())u.Z.dispatch({actionType:"WINDOW_UPDATE_FROM_PREFS",windowId:e})}const T=new class{minimize(e){const t=p.ZP.getWindowState(e);t&&(f.Z.windowPrivate.setState(e,"minimized"),u.Z.dispatch({actionType:"WINDOW_STATE_CHANGED",windowId:e,oldState:t,change:"minimized"}))}minimizeAll(){for(const[e]of p.ZP.getState())this.minimize(e)}maximize(e){const t=p.ZP.getWindowState(e);t&&(f.Z.windowPrivate.setState(e,"maximized"),u.Z.dispatch({actionType:"WINDOW_STATE_CHANGED",windowId:e,oldState:t,change:"maximized"}))}restore(e){if(p.ZP.isHTML5Fullscreen(e)){const t=i.Z.getActiveWebView(e);t&&t.setIsFullscreen(!1),this.restoreStateAfterHTMLFullscreen(e)}else{const t=p.ZP.getWindowState(e);t&&(f.Z.windowPrivate.setState(e,"normal"),u.Z.dispatch({actionType:"WINDOW_STATE_CHANGED",windowId:e,oldState:t,change:"normal"}))}}setFullscreen(e){const t=p.ZP.getWindowState(e);t&&(f.Z.windowPrivate.setState(e,"fullscreen"),u.Z.dispatch({actionType:"WINDOW_STATE_CHANGED",windowId:e,oldState:t,change:"fullscreen"}))}toggleFullscreen(e){p.ZP.isFullscreen(e)?this.restore(e):this.setFullscreen(e)}restoreStateAfterHTMLFullscreen(e){const t=p.ZP.getWindowState(e);if(t){const n=p.ZP.getRestoreStateHtml5Fullscreen(e);f.Z.windowPrivate.setState(e,n),u.Z.dispatch({actionType:"WINDOW_STATE_CHANGED",windowId:e,oldState:t,change:n})}}async close(e){return g.Z.windows.remove(e)}onHTML5FullScreen(e,t){if(e)f.Z.windowPrivate.setState(t,"fullscreen");else{const e=p.ZP.getRestoreStateHtml5Fullscreen(t);f.Z.windowPrivate.setState(t,e)}u.Z.dispatch({actionType:"WINDOW_HTML5_FULL_SCREEN",windowId:t,html5FullScreen:e})}async setInert(e,t){u.Z.dispatch({actionType:"WINDOW_SET_INERT",windowId:e,inert:t})}toggleMinimalUI(e){u.Z.dispatch({actionType:"WINDOW_MINIMAL_UI",windowId:e,minimalUI:!p.ZP.isMinimalUI(e)})}toggleBookmarksBar(e){p.ZP.isMinimalUI(e)?u.Z.dispatch({actionType:"WINDOW_TOGGLE_BOOKMARKS_BAR",windowId:e}):p.ZP.isGuest()||o.Z.toggle(y.kBookmarksBarVisible,!0,!1)}toggleAddressBar(e){p.ZP.isMinimalUI(e)?u.Z.dispatch({actionType:"WINDOW_TOGGLE_ADDRESS_BAR",windowId:e}):o.Z.toggle(y.kAddressBarVisible,!0,!1)}toggleTabs(e){p.ZP.isMinimalUI(e)?u.Z.dispatch({actionType:"WINDOW_TOGGLE_TABS",windowId:e}):o.Z.toggle(y.kTabsVisible,!0,!1)}togglePanelToggle(e){p.ZP.isMinimalUI(e)?u.Z.dispatch({actionType:"WINDOW_TOGGLE_PANEL_TOGGLE",windowId:e}):o.Z.toggle(y.kPanelsShowToggle,!0,!1)}toggleStatusBar(e){p.ZP.isMinimalUI(e)?u.Z.dispatch({actionType:"WINDOW_TOGGLE_STATUS_BAR",windowId:e}):(o.Z.toggle(y.kStatusBarDisplay,"on",a.Z.get(y.kStatusBarMinimized)),b.nextTick((()=>{"overlay"===a.Z.get(y.kStatusBarDisplay)&&r.Z.setStatus(e,(0,h.Z)("Status Info set to Overlay"),2e3)})))}focus(e){return g.Z.windows.update(e,{focused:!0})}openWindow(e,t,n,i){const o={incognito:!1,state:"normal"===n&&p.ZP.isMaximized(e)?"maximized":"normal",...i};if(o.tabUrl)o.tabUrl=(0,v.Gr)(o.tabUrl);else if("normal"===n){const t=a.Z.get(y.kIncognitoShowIntro);o.tabUrl=o.incognito&&t?v.xy["private-intro"]:s.ZP.getDefaultStartpage(e)}const r={ext_id:crypto.randomUUID(),...o.vivExtData?JSON.parse(o.vivExtData):null};return"settings"===n&&(r.isSettings=!0),o.vivExtData=JSON.stringify(r),S(),f.Z.windowPrivate.create(t,o,n)}async openBrowserWindow(e,t,n={}){"string"==typeof t&&(t=(0,v.Gr)(t));let i=!1;const o={url:t,incognito:!1,transition:f.Z.historyPrivate.TransitionType.AUTO_TOPLEVEL,...n};p.ZP.isMaximized(e)&&(void 0===o.left&&void 0===o.top&&void 0===o.width&&void 0===o.height?o.state="maximized":i=!0);const r={ext_id:crypto.randomUUID(),...n.vivExtData?JSON.parse(n.vivExtData):null};if(o.vivExtData=JSON.stringify(r),S(),void 0===o.url){const t=a.Z.get(y.kIncognitoShowIntro);o.url=o.incognito&&t?v.xy["private-intro"]:s.ZP.getDefaultStartpage(e)}const l=await g.Z.windows.create(o);return i&&l?.id&&this.maximize(l.id),l}openIncognitoWindow(e,t){return this.openBrowserWindow(e,t,{incognito:!0})}__initForTests(){window.vivaldiWindowId=42,window.isGuestSession=!1,u.Z.dispatch({actionType:"WINDOW_SET_STATE",windowState:{extId:"cl75x1ek60000lji5dpopf94g",active:!0,state:"maximized",restoreStateFullscreen:"normal",restoreStateHtml5Fullscreen:"normal",guest:!1,html5FullScreen:!1,incognito:!1,nativeDecorations:!1,minimalUI:!1,type:"normal",visibleUI:{addressBar:!1,bookmarksBar:!1,panelToggle:!1,tabs:!0,statusBar:"on"}},windowId:42,windowExtData:{}})}_setWindowState(e,t){const n=e.id;if("number"!=typeof n)return;const i=(0,m.Z)(e.vivExtData);i.ext_id||(i.ext_id=crypto.randomUUID(),g.Z.windows.update(n,{vivExtData:JSON.stringify(i)}));const s=e.tabs??[];let o;s.forEach((e=>{const{id:t}=e;if(t&&!e.vivExtData){const n=JSON.stringify({ext_id:crypto.randomUUID()});e.vivExtData=n,g.Z.tabs.update(t,{vivExtData:n})}})),o="popup"===e.type?i.isSettings?"settings":"popup":"normal";const r={extId:i.ext_id,active:e.focused,state:"locked-fullscreen"===e.state?"normal":e.state,restoreStateFullscreen:"maximized"===e.state?"maximized":"normal",restoreStateHtml5Fullscreen:"normal",guest:t,html5FullScreen:!1,incognito:e.incognito&&!t,minimalUI:i.minimalUI,nativeDecorations:a.Z.get(y.kWindowsUseNativeDecoration),type:o,visibleUI:p.ZP.getUIFromPrefs()};if(i.visibleUI&&(0,p.TF)(r)&&(r.visibleUI=i.visibleUI),"fullscreen"===r.state&&(a.Z.get(y.kStartupRememberFullScreen)?f.Z.windowPrivate.setState(n,"fullscreen"):r.state="normal"),u.Z.dispatch({actionType:"WINDOW_SET_STATE",windowState:r,windowId:n,windowExtData:i}),"settings"!==r.type){let e;for(let t=0;t<s.length;t++){if(i.commandline_tab?.includes(t))continue;const n=s[t];if(n.active){e=n;break}(!e||n.lastAccessed>e.lastAccessed)&&(e=n)}const t=e?.vivExtData?JSON.parse(e?.vivExtData).workspaceId:void 0;if(i.commandline_tab){for(const e of i.commandline_tab){const n=s[e];if(!n)continue;const i=(0,m.Z)(n.vivExtData);i.workspaceId=t,n.vivExtData=JSON.stringify(i),g.Z.tabs.update(n.id,{vivExtData:n.vivExtData})}delete i.commandline_tab,g.Z.windows.update(n,{vivExtData:JSON.stringify(i)})}u.Z.dispatch({actionType:"CHROME_TABS_INIT",tabs:s,windowId:n})}"object"==typeof i.tiles&&c.Z.setIntialized(n,i.tiles);const{theme:h}=l.Z.getState(),{backgroundImage:v,backgroundPosition:b}=h;d.ZP.getImageVars(v,b).then((e=>u.Z.dispatch({actionType:"THEME_WINDOW_CREATED",style:e,windowId:n})))}loadPromise=async()=>{const{isGuestSession:e}=window;f.Z.windowPrivate.onStateChanged.addListener(w),f.Z.windowPrivate.onActivated.addListener(C),f.Z.windowPrivate.onWebContentsHasWindow.addListener(A),a.Z.addListener([y.kAppearanceDisableTitleBar,y.kAddressBarVisible,y.kAddressBarPosition,y.kBookmarksBarVisible,y.kPanelsShowToggle,y.kStatusBarDisplay,y.kTabsVisible,y.kTabsBarPosition],I),g.Z.windows.onCreated.addListener((t=>{if("normal"===t.type&&(p.ZP.initializingWindowId=t.id),("normal"===t.type||"popup"===t.type)&&g.Z.extension.inIncognitoContext===t.incognito)return this._setWindowState(t,e)})),g.Z.windows.onRemoved.addListener((e=>{f.Z.devtoolsPrivate.closeDevtools(1,e,(e=>{})),u.Z.dispatch({actionType:"WINDOW_CLOSED",windowId:e})}));const t=await g.Z.windows.getAll({populate:!0,windowTypes:["normal"]});for(const n of t)this._setWindowState(n,e)}}},29104:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});var i=n(59322),s=n(96951),o=n(68247),a=n(29087),r=n(33638),l=n(15489),d=n(64387),c=n(53454),u=n(92292),p=n(89175);const h=new class{init(){u.Z.extension.inIncognitoContext||(r.Z.dispatch({actionType:"WORKSPACES_INIT",workspaces:a.Z.get(p.kWorkspacesList)}),c.Z.addListener((()=>{o.Z.set(p.kWorkspacesList,c.Z.getState())})))}addWorkspaceWithId(e,t,n,i){return r.Z.dispatch({actionType:"CREATE_WORKSPACE",id:e,name:t,icon:n,emoji:i}),e}async addWorkspace(e,t,n,s,o=!1){const a=l.ZP.getLastActiveBrowserWindowId(),d=Date.now();r.Z.dispatch({actionType:"CREATE_WORKSPACE",id:d,name:e,icon:t,emoji:n});const c=()=>o?Promise.resolve():i.ZP.setActiveWorkspace(a,d);return s&&!s.isEmpty()?(await i.ZP.moveToWorkspace(s,d),await c(),i.ZP.cycleByOrder(a,void 0)):await c(),d}setName(e,t){r.Z.dispatch({actionType:"SET_WORKSPACE_NAME",id:e,name:t})}setIcon(e,t){r.Z.dispatch({actionType:"SET_WORKSPACE_ICON",id:e,icon:t})}setEmoji(e,t){r.Z.dispatch({actionType:"SET_WORKSPACE_EMOJI",id:e,emoji:t})}async removeWorkspace(e,t){s.ZP.getActiveWorkspace(e)===t&&await i.ZP.setActiveWorkspace(e,void 0),await d.Z.removeWorkspaceRules(t),await i.ZP.closeWorkspaceTabs(t),r.Z.dispatch({actionType:"REMOVE_WORKSPACE",id:t})}activateWorkspaceByIndex(e,t){if("number"!=typeof t)i.ZP.setActiveWorkspace(e,void 0);else{const n=c.Z.getState()[t]?.id;n&&i.ZP.setActiveWorkspace(e,n)}}setOrder(e){r.Z.dispatch({actionType:"REORDER_WORKSPACES",ids:e})}_activateByOrder(e,t){const n=s.ZP.getActiveWorkspace(e),o=s.ZP.getActiveWorkspaces(),a=c.Z.getState().filter((e=>e.id===n||!o.has(e.id))).map((e=>e.id));if(!n){let n;return n="forward"===t?a[0]:a[a.length-1],void i.ZP.setActiveWorkspace(e,n)}let r;if("forward"===t){const e=a.indexOf(n)+1;r=e>=a.length?void 0:a[e]}else{const e=a.indexOf(n)-1;r=e<-1?a[a.length-1]:-1===e?void 0:a[e]}i.ZP.setActiveWorkspace(e,r)}activateNextByOrder(e){this._activateByOrder(e,"forward")}activatePreviousByOrder(e){this._activateByOrder(e,"backward")}hibernateInactive(){const e=Array.from(s.ZP.getActiveWorkspaces().keys());c.Z.getState().forEach((t=>{if(!e.includes(t.id)){s.ZP.getWorkspacePages(t.id).filter((e=>!e.active)).forEach(i.ZP.discardPage)}}))}}},64387:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var i=n(29087),s=n(33638),o=n(92),a=n(89175);function r(e,t){0===t.length&&0!==e.length&&s.Z.dispatch({actionType:"UPDATE_LINK_ROUTES_FROM_PREFS"})}const l=new class{loadPromise=async()=>{const e=i.Z.get(a.kWorkspacesLinkRoutes);s.Z.dispatch({actionType:"WORKSPACE_LINK_ROUTES_INIT",rules:e}),i.Z.addListener([a.kWorkspacesLinkRoutes],r)};async addLinkRoutingRule(e,t,n){const i=crypto.randomUUID();return s.Z.dispatch({actionType:"CREATE_WORKSPACE_LINK_ROUTE",id:i,type:e,expression:t,workspaceId:n}),i}async removeLinkRoutingRules(e){s.Z.dispatch({actionType:"REMOVE_WORKSPACE_LINK_ROUTES",ids:e})}async updateLinkRoutingRule(e,t,n,i){s.Z.dispatch({actionType:"UPDATE_WORKSPACE_LINK_ROUTE",id:e,type:t,expression:n,workspaceId:i})}async removeWorkspaceRules(e){const t=o.Z.getWorkspaceRules(e);t.length>0&&await this.removeLinkRoutingRules(t.map((e=>e.id)))}setOrder(e,t){s.Z.dispatch({actionType:"REORDER_WORKSPACE_LINK_ROUTES",ids:t})}}},22303:(e,t,n)=>{"use strict";n.d(t,{Z:()=>f});var i=n(30626),s=n(96951),o=n(29087),a=n(60331),r=n(33638),l=n(47825),d=n(56371),c=n(7064),u=n(71828),p=n(89175),h=n(44850);function g(e){r.Z.dispatch({actionType:"ZOOM_PAGE_DEFAULT",zoomData:e})}const m=new class{async setUIZoomPercentage(e){await m.setUIZoom(e/100)}async setUIZoom(e){const t=Math.min(Math.max(e,u.bI),u.OK);await c.Z.zoom.setVivaldiUIZoom(t)}async setDefaultWebPageZoom(e){const t=Math.min(Math.max(e/100,u.XF),u.qt);await c.Z.zoom.setDefaultZoom(t)}setPageZoomPercentage(e,t){m.setPageZoom(e,t/100)}setPageZoom(e,t){const n=Math.min(Math.max(t,u.XF),u.qt);(s.ZP.getActivePage(e)?.url??"").startsWith(h.jk.internals.notes)?r.Z.dispatch({actionType:"ZOOM_NOTES",zoomData:n}):r.Z.dispatch({actionType:"ZOOM_PAGE",zoomData:n});const l=i.Z.getActiveWebView(e);l&&(l.setZoom(n),"overlay"!==o.Z.get(p.kStatusBarDisplay)&&o.Z.get(p.kToolbarsStatus).includes("Zoom")||a.Z.setStatus(e,(0,d.Z)("Page Zoom $1%",[Math.round(100*n)]),2e3))}async uiZoomIn(){const e=l.Z.getUIZoom(),t=parseFloat(e+u.pL);await m.setUIZoom(t)}async uiZoomOut(){const e=l.Z.getUIZoom(),t=parseFloat(e-u.pL);await m.setUIZoom(t)}async pageZoomIn(e){const t=await m.getActiveZoom(e);m.setPageZoom(e,parseFloat((t+u.Zh).toFixed(2)))}async pageZoomOut(e){const t=await m.getActiveZoom(e);m.setPageZoom(e,parseFloat((t-u.Zh).toFixed(2)))}async pageZoomHalf(e){const t=await m.getActiveZoom(e);m.setPageZoom(e,parseFloat((t/2).toFixed(2)))}async pageZoomReset(e){const t=await c.Z.zoom.getDefaultZoom();m.setPageZoom(e,t)}async pageZoomDouble(e){const t=await m.getActiveZoom(e);m.setPageZoom(e,parseFloat((2*t).toFixed(2)))}getActiveZoom(e){return new Promise((t=>{const n=i.Z.getActiveWebView(e);n?n.getZoom((e=>{t(e)})):t(u.rM)})).then((e=>e))}dispatchZoomUI(e){r.Z.dispatch({actionType:"ZOOM_SET_UI",zoomData:e})}};c.Z.zoom.getVivaldiUIZoom((e=>{m.dispatchZoomUI(e)})),c.Z.zoom.onUIZoomChanged.addListener((e=>{m.dispatchZoomUI(e)})),c.Z.zoom.getDefaultZoom(g),c.Z.zoom.onDefaultZoomChanged.addListener(g);const f=m},75344:(e,t,n)=>{"use strict";var i=n(92292);let s;n(89907).k||(s=i.Z.extension.getViews().find((e=>e.isPortal))??window,s.isPortal||(s.isPortal=!0,s.requestAnimationFrame=e=>i.Z.extension.getViews().find((e=>e!==s))?.requestAnimationFrame(e),s.cancelAnimationFrame=e=>i.Z.extension.getViews().find((e=>e!==s))?.cancelAnimationFrame(e)));const o=s;var a=n(4660),r=n(43623),l=n(17751),d=n(99827),c=n(59322),u=n(60331),p=n(1407);const h={contact:a.Z,mail:d.Z,page:c.ZP,status:u.Z,logger:l.Z,error:r.Z};new BroadcastChannel("actions").addEventListener("message",(function(e){if(e.origin!==p.oP||!e.data||!e.data.actions)return;const{actionType:t,action:n,args:i}=e.data.actions,s=h[t];if(!s)throw new Error("Action creator not found for action type "+t);if("function"!=typeof s[n])throw new Error("Action "+s+"."+n+" not found");s[n](...i)}),!1);var g=n(59486),m=n(24602),f=n(57118),v=n(93513);class y extends m.Z{getInitialState(){return[]}reduce(e,t){switch(t.actionType){case"DASHBOARD_INIT":return t.widgets;case"DASHBOARD_SET_TIP":return(0,v.Uy)(e,(e=>{const n=e.find((e=>e.id===t.widgetId));"tip"===n?.type&&t.tipContent&&t.tipLink&&(n.tipContent=t.tipContent,n.tipLink=t.tipLink,n.tipTimestamp=t.tipTimestamp)}));case"DASHBOARD_ADD_WIDGET":{const n=function(e,t){const n={id:crypto.randomUUID(),size:f.sB[e].size};switch(e){case"email":return{...n,type:e,background:"solid",accountId:f.$c};case"calendar":return{...n,type:e,background:"solid",calendarIds:[]};case"shortcuts":return{...n,type:e,background:"semi-transparent",folderId:"",showTitle:!1,showThumbnail:!1};case"feed":return{...n,type:e,background:"solid",feedId:t?.feedId,feedDisplay:void 0};case"top-sites":return{...n,type:e,background:"semi-transparent",showTitle:void 0};case"tasks":return{...n,type:"tasks",background:"solid"};case"sticky-note":return{...n,type:"sticky-note",background:"semi-transparent",content:""};case"tip":return{...n,type:e,background:"semi-transparent",tipContent:"",tipLink:"",tipTimestamp:0};case"privacy-stats":return{...n,type:"privacy-stats",background:"semi-transparent"};case"webpage":return{...n,type:"webpage",background:"solid",url:void 0,shareTheme:!1,dashboardId:0};case"date":return{...n,type:"date",background:"semi-transparent"};case"weather":return{...n,type:"weather",background:"solid",locationId:void 0,temperatureUnit:"celsius",windspeedUnit:"ms",precipitationUnit:"mm",view:"WEEK"}}}(t.type,t.options);if(!n)return e;return(0,v.Uy)(e,(e=>{"number"==typeof t.options.index?e.splice(t.options.index,0,n):e.push(n)}))}case"DASHBOARD_SET_WIDGET_ORDER":{const n=t.widgetIds.map((t=>e.find((e=>e.id===t)))).filter(Boolean);return n.length===e.length?n:(console.error("Sanity check failed when trying to set widget order."),e)}case"DASHBOARD_REMOVE_WIDGET":return(0,v.Uy)(e,(e=>{const n=e.findIndex((e=>e.id===t.widgetId));n>-1&&e.splice(n,1)}));case"DASHBOARD_UPDATE_WIDGET":return(0,v.Uy)(e,(n=>{const i=n.find((e=>e.id===t.widgetId));if(!i)return e;if(t.size)i.size=t.size;else if(t.background)i.background=t.background;else switch(i.type){case"email":i.accountId=t.accountId;break;case"feed":t.feedId&&(i.feedId=t.feedId),t.feedDisplay&&(i.feedDisplay=t.feedDisplay);break;case"shortcuts":const e=t.shortcutConfig;void 0!==e?.folderId&&(i.folderId=e.folderId),void 0!==e?.showTitle&&(i.showTitle=e.showTitle),void 0!==e?.showThumbnail&&(i.showThumbnail=e.showThumbnail);break;case"top-sites":i.showTitle=t.showTitle;break;case"tip":const n=t.tipData;n?.tipContent&&(i.tipContent=n.tipContent),n?.tipLink&&(i.tipLink=n.tipLink),n?.tipTimestamp&&(i.tipTimestamp=n.tipTimestamp);break;case"calendar":i.calendarIds=t.calendarIds?[...t.calendarIds]:[];break;case"sticky-note":i.content=t.content??"";break;case"webpage":const s=t.webpageData;void 0!==s?.url&&(i.url=s.url),void 0!==s?.shareTheme&&(i.shareTheme=s.shareTheme);break;case"weather":const o=t.weatherData;i.locationId=o?.locationId,o?.temperatureUnit&&(i.temperatureUnit=o.temperatureUnit),o?.windspeedUnit&&(i.windspeedUnit=o.windspeedUnit),o?.precipitationUnit&&(i.precipitationUnit=o.precipitationUnit),o?.view&&(i.view=o.view)}}));default:return e}}}const b=new y;var S=n(17434),w=n(68247),C=n(29087),A=n(33638),I=n(89175);function T(){A.Z.dispatch({actionType:"DASHBOARD_INIT",widgets:C.Z.get(I.kDashboardWidgets)}),b.addListener((()=>{w.Z.set(I.kDashboardWidgets,b.getState())}))}function Z(){const e=C.Z.get(I.kDashboardEnabled);e?w.Z.set(I.kStartpageSpeedDialOrder,C.Z.get(I.kStartpageSpeedDialOrder).filter((e=>e!==f.N4))):w.Z.set(I.kStartpageSpeedDialOrder,C.Z.get(I.kStartpageSpeedDialOrder).concat([f.N4])),w.Z.set(I.kDashboardEnabled,!e)}function E(e,t){A.Z.dispatch({actionType:"DASHBOARD_UPDATE_WIDGET",widgetId:e,accountId:t})}function k(e,t){A.Z.dispatch({actionType:"DASHBOARD_UPDATE_WIDGET",widgetId:e,feedId:t})}function _(e,t){A.Z.dispatch({actionType:"DASHBOARD_UPDATE_WIDGET",widgetId:e,feedDisplay:t})}function N(e,t){A.Z.dispatch({actionType:"DASHBOARD_ADD_WIDGET",type:e,options:t})}function P(e,t){A.Z.dispatch({actionType:"DASHBOARD_UPDATE_WIDGET",widgetId:e,shortcutConfig:t})}function D(e,t){A.Z.dispatch({actionType:"DASHBOARD_UPDATE_WIDGET",widgetId:e,weatherData:t})}function M(e,t){A.Z.dispatch({actionType:"DASHBOARD_UPDATE_WIDGET",widgetId:e,size:t})}function O(e,t){A.Z.dispatch({actionType:"DASHBOARD_UPDATE_WIDGET",widgetId:e,background:t})}var x=n(54614);function L(){C.Z.get(I.kDashboardEnabled)&&A.Z.dispatch({actionType:"STICKY_NOTE_INIT",notes:C.Z.get(I.kDashboardStickyNotes)})}var R=n(19789),B=n(56371),F=n(30381),W=n.n(F),U=n(8684);const V={getTimeFormat:()=>C.Z.get(I.kClockShowSeconds)?"LTS":"LT",getDateFormat:()=>R.ZP.getShortDateFormat(),getTimeAndDateFormat:()=>V.getDateFormat()+" "+V.getTimeFormat(),completeTimer:e=>{const t=C.Z.get(I.kClockNotificationSound),n={title:V.getName(e),body:V.getTime(e),silent:!1,tag:`VIVALDI_CLOCK_TIMER_${V.getName(e)}`};if(t){new Audio(t).play()}var i;(0,U.c)(n),i=(new Date).valueOf(),A.Z.dispatch({actionType:"TIMER_REMOVE_EXPIRED",timestamp:i})},getName:e=>e.name||("alarm"===e.type?(0,B.Z)("Alarm"):(0,B.Z)("Countdown")),getTime:e=>W()(e.date).format("LTS"),getActiveLabel:(e,t)=>{const n=W()(e.date),i=W().duration(n.diff(new Date)),s=i.hours(),o=i.minutes();let a;if("alarm"===e.type)a=n.format("LT");else if(s&&o)a=(0,B.Z)("$1h $2m",[s,o]);else if(s)a=(0,B.Z)("$1h",[s]);else if(o)a=(0,B.Z)("$1m",[o]);else{const e=i.seconds();a=(0,B.Z)("$1s",[e])}if(t){return`${a} - ${V.getName(e)}`}return a},setAlarmWithPreset:e=>{const t=new Date;t.setSeconds(0),t.setHours(e.hour),t.setMinutes(e.minute);j({name:e.name,date:t.valueOf()},"alarm")},getAlarmPreset:e=>C.Z.get(I.kClockAlarmPresets).find((t=>t.id===e)),saveAlarmPreset:(e,t,n)=>{const i=crypto.randomUUID();w.Z.set(I.kClockAlarmPresets,[...C.Z.get(I.kClockAlarmPresets),{name:e,hour:t,minute:n,id:i}])},removeAlarmPreset:e=>{const t=C.Z.get(I.kClockAlarmPresets).filter((t=>t.id!==e));w.Z.set(I.kClockAlarmPresets,t)},setCountdownWithPreset:e=>{const t=new Date;j({name:e.name,date:t.setSeconds(t.getSeconds()+e.seconds).valueOf()},"countdown")},getCountdownPreset:e=>C.Z.get(I.kClockCountdownPresets).find((t=>t.id===e)),saveCountdownPreset:(e,t)=>{const n=crypto.randomUUID();w.Z.set(I.kClockCountdownPresets,[...C.Z.get(I.kClockCountdownPresets),{name:e,seconds:t,id:n}])},removeCountdownPreset:e=>{const t=C.Z.get(I.kClockCountdownPresets).filter((t=>t.id!==e));w.Z.set(I.kClockCountdownPresets,t)}},H=V;class G extends m.Z{getInitialState(){return[]}reduce(e,t){switch(t.actionType){case"TIMER_INIT":return t.timers;case"TIMER_ADD":return e.concat(t.timer);case"TIMER_REMOVE":return e.filter((e=>e.id!==t.timerId));case"TIMER_REMOVE_EXPIRED":return e.filter((e=>t.timestamp<e.date));default:return e}}}const $=new G,K=[];function z(){const e=C.Z.get(I.kClockTimers);A.Z.dispatch({actionType:"TIMER_INIT",timers:e}),Y(e),$.addListener((()=>{const e=$.getState();w.Z.set(I.kClockTimers,e),Y(e)}))}function j(e,t){const n=new Date;if(e.date<n.valueOf()){const t=new Date(e.date);t.setDate(t.getDate()+1),e.date=t.valueOf()}A.Z.dispatch({actionType:"TIMER_ADD",timer:{...e,type:t,id:crypto.randomUUID()}})}function Y(e){K.forEach(clearTimeout),K.length=0;for(const t of e){const e=t.date-Date.now();e>0&&K.push(setTimeout((()=>{H.completeTimer(t)}),e))}}function X(e,t){if(!e)return;const n=new Date(e);return n.setSeconds(n.getSeconds()+t),n}function Q(){if(!C.Z.get(I.kDashboardEnabled))for(const e of b.getState())"weather"===e.type&&e.locationId&&q(e.locationId)}function q(e){(async function(e){const t=R.ZP.UI_LANGUAGE.substring(0,2),n=await fetch(`https://weather.vivaldi.com/forecast/${e}.json.${t}`),i=await n.json(),s=Number(n.headers.get("cache-control")?.split("=")[1]);let o=[X(i.forecast.properties.meta.updated_at,21600),X(n.headers.get("last-modified"),isNaN(s)?21600:s)].filter(Boolean).sort().at(-1);if(!o){const e=new Date;e.setHours(e.getHours()+1),o=e}return o.setMinutes(o.getMinutes()+Math.floor(11*Math.random())),i.nextUpdate=o,i})(e).then((t=>{t&&A.Z.dispatch({actionType:"WEATHER_UPDATE",locationId:e,forecast:t})}))}n(44620);var J=n(39005),ee=n(48603),te=n(2934),ne=n(47995),ie=n(27033),se=n(7064),oe=n(29489);function ae(){const e=ie.Z.getScripts();re((({scripts:t})=>{const n=e.filter((e=>!t.includes(e))).map((e=>function(e){return`COMMAND_${(0,oe.gD)(e).toUpperCase()}`.replace(/\s+/g,"_")}(e)));A.Z.dispatch({actionType:"CONTENT_SCRIPTS_UPDATED",updated:n,scripts:t})}))}function re(e){se.Z.pageActions.getScripts((t=>{const n=t.map((e=>`COMMAND_${(0,oe.gD)(e)}`.toUpperCase().replace(/\s+/g,"_")));e({scriptNames:n,scripts:t})}))}const le={loadPromise:function(){return se.Z.pageActions.onScriptsChanged.addListener(ae),new Promise((e=>{re((({scriptNames:t,scripts:n})=>{A.Z.dispatch({actionType:"CONTENT_SCRIPTS_INITIALIZE",scripts:n}),e()}))}))}};var de=n(46382);function ce(e){return e.hasToken?"loggedIn":"invalid_credentials"===e.lastTokenFetchError.errorType?"loginFailed":0!==e.tokenRequestTime?"loggingIn":e.accountInfo.accountId?"credentialsMissing":"loggedOut"}class ue extends m.Z{getInitialState(){return{accountInfo:{accountId:"",username:"",pictureUrl:"",donationTier:""},hasSavedPassword:!1,hasToken:!1,accessToken:"",hasEncryptedToken:!1,tokenRequestTime:0,nextTokenRequestTime:0,lastTokenFetchError:{errorType:"no_error",serverMessage:"",errorCode:0},lastAccountInfoFetchError:{errorType:"no_error",serverMessage:"",errorCode:0},isReady:!1}}reduce(e,t){return"VIVALDI_ACCOUNT_STATE_UPDATED"===t.actionType?t.state:e}}const pe=new ue;var he=n(15489),ge=n(25372),me=n(24522),fe=n(34155);const ve=e=>"EnableMailContextDialog"===e||"EnableCalendarContextDialog"===e||"EnableSyncContextDialog"===e||"CreateWorkspaceContextDialog"===e,ye={showing:!1,seen:!1};const be=new Map([["EnableMailContextDialog",{type:"url",extraCheck:e=>!1,domainInterest:["gmail.com","mail.google.com/mail/u/0","outlook.com","outlook.live.com/mail","yahoo.com/mail","login.yahoo.com","mail.yahoo.com","icloud.com/mail","protonmail.com","mail.proton.me/u/0/inbox","account.proton.me/mail","zoho.com/mail","mail.zoho.com","aol.com","login.aol.com","gmx.com","yandex.com","mail.yandex.com","mail.com","fastmail.com","fastmail.com/mail","tutanota.com","mail.tutanota.com","hushmail.com","hushmail.com/hushmail","mailfence.com","mailfence.com/mail","posteo.de/en","posteo.de/webmail","runbox.com","runbox.com/mail","startmail.com","webmail.startmail.com","kolabnow.com","kolabnow.com/webmail","mailbox.org/en","mailbox.org/login","soverin.net","soverin.net/webmail"]}],["EnableCalendarContextDialog",{type:"url",extraCheck:e=>!1,domainInterest:["calendar.google.com","workspace.google.com","outlook.live.com/calendar","icloud.com/calendar","calendar.yahoo.com","zoho.com/calendar","any.do/calendar","desktop.any.do/#/calendar","clickup.com/features/calendar","app.clickup.com/calendar","proton.me/calendar","calendar.proton.me"]}],["EnableSyncContextDialog",{type:"action",extraCheck:e=>"loggedOut"===ce(pe.getState())&&C.Z.get(I.kStartupActiveDays).length>1,action:function(e){const t=1*me.lb;function n(){fe.nextTick((()=>{Ze.show(e)})),pe.removeListener(n),clearTimeout(i)}const i=setTimeout((()=>{n()}),t);pe.addListener(n)}}],["CreateWorkspaceContextDialog",{type:"action",extraCheck:e=>C.Z.get(I.kWorkspacesEnabled)&&0===C.Z.get(I.kWorkspacesList).length,action:e=>((e,t)=>{const n=e*me.lb;setTimeout((()=>{Ze.show(t)}),n)})(15,e)}]]);class Se extends m.Z{saveStateToPrefs(e){const t={};e.dialogs.forEach(((e,n)=>{t[n]=e.seen})),w.Z.set(I.kContextDialogsSeen,t)}constructor(){super(),C.Z.addListener(I.kStartupActiveDays,(()=>{this.executeActionDialogs()}))}getInitialState(){const e=new Map;return be.forEach(((t,n)=>{e.set(n,ye)})),{isInitialized:!1,hasUnseenDialogs:!0,dialogs:e}}hasUnseenDialogsInterestedInURL(){return!1}getOnboardingDialogToShow(){const e=this.getState();if(!e.isInitialized||!e.hasUnseenDialogs)return null;for(const[t,n]of e.dialogs){if(n.showing||n.seen)continue;const i=be.get(t);if(i&&"onboarding"===i.type&&(!i.extraCheck||i.extraCheck(e)))return t}return null}getDialogInterestedInURL(e){return null}executeActionDialogs(){const e=this.getState();if(e.isInitialized&&e.hasUnseenDialogs)for(const[t,n]of e.dialogs){if(n.showing||n.seen)continue;const e=be.get(t);e&&"action"===e.type&&e.action&&e.action(t)}}showDialog(e,t){const n=this.getState();if(!n.isInitialized)return;const i=n.dialogs.get(e),s=be.get(e);if(i&&!i.showing&&!i.seen&&s&&(!s.extraCheck||s.extraCheck(n))){const n=he.ZP.getActiveWindowId();fe.nextTick((()=>de.Z.showContextDialog(n,e,t)))}}reduce(e,t){switch(t.actionType){case"CONTEXTDIALOG_RESET":{const{id:n}=t;return(0,v.Uy)(e,(t=>{e.isInitialized&&(t.dialogs.set(n,ye),t.hasUnseenDialogs=!0,this.saveStateToPrefs(t))}))}case"CONTEXTDIALOG_RESET_ALL":return(0,v.Uy)(e,(e=>{be.forEach(((t,n)=>{e.dialogs.set(n,ye)})),e.hasUnseenDialogs=!0,this.saveStateToPrefs(e)}));case"CONTEXTDIALOG_SHOW_DIALOG":{const{id:n,force:i}=t;return(0,v.Uy)(e,(t=>{if(e.isInitialized){const e=t.dialogs.get(n)??{...ye};e.showing=!0,t.dialogs.set(n,e),this.showDialog(n,i)}}))}case"CONTEXTDIALOG_SHOWN":{const{id:n}=t;return(0,v.Uy)(e,(t=>{if(e.isInitialized){const e=t.dialogs.get(n)??{...ye};e.seen=!0,t.dialogs.set(n,e),t.hasUnseenDialogs=Array.from(t.dialogs).some((([e,t])=>!t.seen)),this.saveStateToPrefs(t)}}))}case"CONTEXTDIALOG_UPDATE_FROM_PREFS":return(0,v.Uy)(e,(e=>{const t=C.Z.get(I.kContextDialogsSeen);Object.entries(t).forEach((([t,n])=>{if(ve(t)){const i=e.dialogs.get(t);i&&"boolean"==typeof n&&(i.seen=n,e.dialogs.set(t,i))}})),e.isInitialized=!0,e.hasUnseenDialogs=Array.from(e.dialogs).some((([e,t])=>!t.seen)),this.saveStateToPrefs(e)}))}return e}}const we=new Se;var Ce=n(96951),Ae=n(16152);const Ie=(0,Ae.Z)((function(){if(we.hasUnseenDialogsInterestedInURL()){const e=he.ZP.getActiveWindowId(),t=Ce.ZP.getActivePage(e);if(t){const e=we.getDialogInterestedInURL(t.url);e&&A.Z.dispatch({actionType:"CONTEXTDIALOG_SHOW_DIALOG",id:e,force:!0})}}else Ce.ZP.removeListener(Ie)}),100);class Te{static contextDialogsBlocked=!1;init=async()=>{if(await se.Z.utilities.hasCommandLineSwitch("auto-test-mode"))return void(Te.contextDialogsBlocked=!0);Ce.ZP.addListener(Ie),this.updateFromPrefs();const e=we.getOnboardingDialogToShow();e&&this.show(e),we.executeActionDialogs()};show(e,t){Te.contextDialogsBlocked||A.Z.dispatch({actionType:"CONTEXTDIALOG_SHOW_DIALOG",id:e,force:t??!1})}shown(e){Te.contextDialogsBlocked||A.Z.dispatch({actionType:"CONTEXTDIALOG_SHOWN",id:e})}reset(e){Te.contextDialogsBlocked||A.Z.dispatch({actionType:"CONTEXTDIALOG_RESET",id:e})}resetAll(){Te.contextDialogsBlocked||A.Z.dispatch({actionType:"CONTEXTDIALOG_RESET_ALL"})}updateFromPrefs(){Te.contextDialogsBlocked||A.Z.dispatch({actionType:"CONTEXTDIALOG_UPDATE_FROM_PREFS"})}}const Ze=new Te;var Ee=n(83784);const ke=new class{loadPromise=async()=>{se.Z.extensionActionUtils.onAdded.addListener((e=>{this.onExtensionActionChanged(e)})),se.Z.extensionActionUtils.onRemoved.addListener((e=>{this.onExtensionActionRemoved(e)})),se.Z.extensionActionUtils.onUpdated.addListener((e=>{this.onExtensionActionChanged(e)})),se.Z.extensionActionUtils.onClearAllValuesForTab.addListener((function(e,t){A.Z.dispatch({actionType:"EXTENSION_ACTION_CLEAR_FOR_TAB",extensionId:e,tabId:t})}));const e=await se.Z.extensionActionUtils.getToolbarExtensions(),t=new Map,n=new Map;e.filter((e=>e.enabled)).forEach((e=>{n.set(e.tabId,e),t.set(e.id,n),this.onExtensionActionChanged(e)}))};onExtensionActionRemoved(e){A.Z.dispatch({actionType:"EXTENSION_ACTION_REMOVED",info:e})}onExtensionActionChanged(e){A.Z.dispatch({actionType:"EXTENSION_ACTION_UPDATED",info:e})}};var _e=n(87210);let Ne=!1;async function Pe(e){const t=W()().startOf("date"),n=W()().endOf("date"),i=await se.Z.historyPrivate.visitSearch({startTime:t.valueOf(),endTime:n.valueOf()});A.Z.dispatch({actionType:"HISTORY_LOAD",items:i,isToday:!0})}const De=(0,Ae.Z)(Pe,2e3);const Me=new class{loadPromise=async()=>{await Pe(),i.Z.history.onVisited.addListener(De),se.Z.importData.onImportEnded.addListener((async()=>{Ne=!1,this.loadAll()}))};#s=async(e,t)=>{const n=await se.Z.historyPrivate.visitSearch({startTime:e.from,endTime:e.to});(n.length>0||t)&&A.Z.dispatch({actionType:"HISTORY_LOAD",items:n,resetCache:t})};async loadAll(){if(Ne)return;Ne=!0;const e="month",t=W()().endOf("d");for(let n=0;n<120;n++){const i=W()(t).subtract(n,e).endOf(0===n?"d":e),s=W()(i).startOf(e);await this.#s({to:i.valueOf(),from:s.valueOf()},0===n)}const n=W()().subtract(121,e).endOf(e),i=W()("1970-01-01");await this.#s({to:n.valueOf(),from:i.valueOf()})}deleteHistoryPromise(e){return A.Z.dispatch({actionType:"HISTORY_REMOVE_VISITS",visits:e}),Promise.all(e.map((e=>new Promise((t=>{if(e.isFolder){const n=W()(e.visitTime),s={startTime:W()(n.startOf("day")).valueOf(),endTime:W()(n.endOf("day")).valueOf()};i.Z.history.deleteRange(s,(()=>{t()}))}else{const n={time:e.visitTime,url:e.url||""};se.Z.historyPrivate.deleteVisits(n,(()=>{t()}))}})))))}removeLocalHistory(e){A.Z.dispatch({actionType:"HISTORY_REMOVE_AFTER",since:e})}};var Oe=n(65792),xe=n.n(Oe);class Le extends m.Z{getInitialState(){return{lights:new Map,groups:new Map}}reduce(e,t){return"HUE_LIGHTS_UPDATE"===t.actionType?(0,v.Uy)(e,(e=>(e.groups=t.groups,e.lights=t.lights,e))):"HUE_LIGHTS_SET"===t.actionType?(0,v.Uy)(e,(t=>e||t)):e}}const Re=new Le;var Be=n(37330);async function Fe(){const e=C.Z.get(I.kHueBridgeIp),t=C.Z.get(I.kHueUsername);if(!e||!t)return void A.Z.dispatch({actionType:"HUE_LIGHTS_UPDATE",groups:new Map,lights:new Map});const n=await fetch(`http://${e}/api/${t}/lights`);n.ok||console.warn(`Unable to retrieve lights from bridge at ${e}`);const i=await n.json(),s=new Map(Object.entries(i)),o=await fetch(`http://${e}/api/${t}/groups`);o.ok||console.warn(`Unable to retrieve lights from bridge at ${e}`);const a=await o.json(),r=new Map(Object.entries(a));for(const[e,t]of r){t.lights.map((e=>s.get(e))).some((e=>e?.capabilities?.control?.colorgamuttype))||r.delete(e)}A.Z.dispatch({actionType:"HUE_LIGHTS_UPDATE",groups:r,lights:s})}let We;function Ue(){const e=C.Z.get(I.kHueBridgeIp),t=C.Z.get(I.kHueUsername),n=C.Z.get(I.kHueLights);if(!e||!t||!n)return;const i=he.ZP.getLastActiveBrowserWindowId(),s=Be.Z.getState().windowStyles.get(i)?.["--colorAccentBg"];if("string"!=typeof s)return;if(s===We)return;We=s;const o=function(e){let t=e.get("rgb.r"),n=e.get("rgb.g"),i=e.get("rgb.b");t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/13.02,i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92;const s=.664511*t+.154324*n+.162028*i,o=.283881*t+.668433*n+.047685*i,a=88e-6*t+.07231*n+.986039*i;return[s/(s+o+a),o/(s+o+a)]}(xe()(s)),a=`http://${e}/api/${t}`;for(const[e,t]of Re.getState().lights)n.includes(t.uniqueid)&&fetch(`${a}/lights/${e}/state/`,{method:"put",body:JSON.stringify({transitiontime:3,xy:o})}).catch((e=>{console.warn("Unable to set Hue light",t.name,e)}))}async function Ve(e,t,n){switch(n){case I.kHueEnabled:await Fe(),t?(Ue(),Be.Z.addListener(Ue),he.ZP.addListener(Ue)):(Be.Z.removeListener(Ue),he.ZP.removeListener(Ue));break;case I.kHueLights:A.Z.dispatch({actionType:"HUE_LIGHTS_SET",lights:t})}}const He={loadPromise:async function(){C.Z.addListener([I.kHueEnabled,I.kHueLights],Ve),C.Z.get(I.kHueEnabled)&&await Ve(!1,!0,I.kHueEnabled)},updateLights:Fe,flash:function(e){const t=C.Z.get(I.kHueBridgeIp),n=C.Z.get(I.kHueUsername);fetch(`http://${t}/api/${n}/lights/${e}/state`,{method:"put",body:JSON.stringify({alert:"select"})})}};var Ge=n(25795),$e=n(45502),Ke=n(84451),ze=n(35369);class je extends m.Z{getInitialState(){return{feature:"browser",hasActiveMessage:!1,hasMenu:!1,pageId:void 0,pages:(0,ze.aV)(),windowId:he.Ex}}getHasActiveMessage(){return this.getState().hasActiveMessage}getHasMenu(){return this.getState().hasMenu}getName(){return"mac"}getPageId(){return this.getState().pageId}getPages(){return this.getState().pages}getWindowId(){return this.getState().windowId}reduce(e,t){switch(t.actionType){case"MACMENU_INIT":case"MACMENU_SET_WINDOW_ID":return(0,v.Uy)(e,(e=>{e.windowId=t.windowId}));case"MACMENU_SET_FEATURE":return(0,v.Uy)(e,(e=>{e.feature=t.feature}));case"MACMENU_SET_HAS_ACTIVE_MESSAGE":return(0,v.Uy)(e,(e=>{e.hasActiveMessage=t.hasActiveMessage}));case"MACMENU_SET_HAS_MENU":return(0,v.Uy)(e,(e=>{e.hasMenu=t.hasMenu}));case"MACMENU_SET_PAGE":return(0,v.Uy)(e,(e=>{e.pageId=t.pageId,e.pages=t.pages}));default:return this.getState()}}}const Ye=new je(A.Z);var Xe=n(32921),Qe=n(76747),qe=n(26591);const Je=function(e,t){const n=Qe.Z.getShortcutSettings(),i=[],s=function(t){if(t.isVisible&&!t.isVisible(e,!1))return null;if(Qe.Z.isSeparator(t))return{type:"separator",name:"",action:"",withNoWindow:!0,id:-1};if("container"===t.type){const n=Qe.Z.getDisplayName(t);return t.container?{type:"container",name:n,action:t.container.content,edge:t.container.edge,withNoWindow:!0===t.withNoWindow,enabled:!t.isEnabled||t.isEnabled(e),id:-1}:null}{let o;t.url&&(o=qe.Z);const a="folder"===t.type?t.items?t.items.map(s).filter(Boolean):[]:null;if("folder"!==t.type&&!t.commandName)return console.warn("Menu element ignored. Not a folder nor a command"),null;const r=!t.isVisibleMac||t.isVisibleMac(e,!1),l=Qe.Z.getShortcut(t,n);return l.value&&!l.singleKey&&r&&(l.value.startsWith("Shift+")&&7===l.value.length||i.push(l.value.toLowerCase())),{type:t.type,name:Qe.Z.getDisplayName(t),action:t.commandName||"",withNoWindow:!0===t.withNoWindow,enabled:!t.isEnabled||t.isEnabled(e),id:-1,items:a,shortcut:l.value,checked:!(!t.checked||t.statestrings)&&t.checked,emphasized:t.emphasized,parameter:t.parameter,visible:r,url:t.url,icon:o}}};return{items:t.map(s).filter(Boolean),blockedShortcuts:i}};var et=n(34155);let tt,nt=[];function it(e){switch(e){case"menu":et.nextTick((()=>{A.Z.dispatch({actionType:"MACMENU_SET_HAS_MENU",hasMenu:!0})}));break;case"menuState":case"shortcut":ut()}}function st(){et.nextTick((()=>{const e=he.ZP.getActiveWindowId();A.Z.dispatch({actionType:"MACMENU_SET_WINDOW_ID",windowId:e})}))}function ot(){et.nextTick((()=>{const e=Ye.getWindowId();if(he.ZP.isActive(e)){const t=Ce.ZP.getActivePage(e)?.id;(Ye.getPageId()!==t||function(e,t){const n=Ce.ZP.getPages(e);return n.size!==t.size||t.some(((e,t)=>{const i=n.get(t);return e!==i&&(e.title!==i?.title||e.url!==i?.url)}))}(e,Ye.getPages()))&&A.Z.dispatch({actionType:"MACMENU_SET_PAGE",pageId:t,pages:Ce.ZP.getPages(e)})}}))}function at(){et.nextTick((()=>{const e=$e.Z.getContext(Ye.getWindowId()).feature;A.Z.dispatch({actionType:"MACMENU_SET_FEATURE",feature:e})}))}function rt(){et.nextTick((()=>{const e=Ye.getWindowId();if(he.ZP.isActive(e)&&he.ZP.isMail(e)){const e=Boolean(J.Z.getActiveMessage());A.Z.dispatch({actionType:"MACMENU_SET_HAS_ACTIVE_MESSAGE",hasActiveMessage:e})}}))}function lt(){const e=Ye.getWindowId();he.ZP.isActive(e)&&!he.ZP.isSettings(e)&&ut()}function dt(e){const t=e?e.filter(Boolean).map((e=>e.periodInMinutes)):[];nt.length===t.length&&nt.every(((e,n)=>e===t[n]))||(nt=t,he.ZP.isActive(Ye.getWindowId())&&ut())}async function ct(){await se.Z.menubar.getHasWindows()||pt(he.Ex)}function ut(){if(Ye.getHasMenu()){const e=Ye.getWindowId();e!==he.Ex&&pt(e)}}function pt(e){void 0===tt?(tt=e,setTimeout((()=>{const t=Ge.Z.getNamedMenu(e,Ye.getName(),!0);if(void 0!==tt){const e=Je(tt,t);se.Z.menubar.setup(e.items),Ke.Z.setBlockedShortcuts(e.blockedShortcuts)}tt=void 0}),100)):tt=e}new class{init(){if(!Ye.getHasMenu()){const e=he.ZP.getActiveWindowId();A.Z.dispatch({actionType:"MACMENU_INIT",windowId:e}),Ye.addListener(ut),Ge.Z.addListener(it),he.ZP.addListener(st,(e=>{const t=he.ZP.getActiveWindowId();return{windowId:t,minimalUI:he.ZP.isMinimalUI(t)}})),Ce.ZP.addListener(ot,(e=>e.get(Ye.getWindowId()))),$e.Z.addListener(at),J.Z.addListener(rt),C.Z.addListener([I.kTabsStackingMode,I.kPanelsWindowShowPinnedGroup,I.kConfirmToQuitEnabled],lt),Xe.Z.addListener(dt),i.Z.windows.onRemoved.addListener(ct),ne.Z.requestNamedMenu(Ye.getName())}}};var ht=n(98611),gt=n(54162),mt=n(81538),ft=n(97297),vt=n(78347),yt=n(71320),bt=n(10671),St=n(75401),wt=n(84283),Ct=n(89165),At=n(95752),It=n(5863),Tt=n(13248),Zt=n(19842);function Et(e){const{enabledButtons:t}=e,{isJunkSelected:n,isNonJunkSelected:i,isDeletedSelected:s,isNonDeletedSelected:o,isArchivedSelected:a,isNonArchivedSelected:r,selectionCount:l,isOutboundSelected:d,isOutboxDraftsSelected:c,isReadSelected:u,isUnreadSelected:h,isArchivableSelected:g,isJunkableSelected:m}=function(){const e={isDeletedSelected:!1,isNonDeletedSelected:!1,isJunkSelected:!1,isNonJunkSelected:!1,isJunkableSelected:!1,isArchivedSelected:!1,isNonArchivedSelected:!1,isArchivableSelected:!1,isOutboundSelected:!1,isOutboxDraftsSelected:!1,isReadSelected:!1,isUnreadSelected:!1,selectionCount:0},t=function(){const e=he.ZP.getActiveWindowId();if((0,Zt.Rr)(e)){const e=J.Z.getActiveListEntry();if(e)return[e.id]}else{const e=mt.Z.get(p.uP);if(e)return e.selectedIds.map((({id:e})=>e))}}();if(!t)return e;const n=[It.Nz,It.fZ,It.kY],i=[It.fZ,It.kY];for(const s of t){const t=ht.Z.getListEntry(s);if(!t)continue;e.selectionCount++;const{sourceFilterIds:o,sources:a,flags:r}=t;if(!e.isOutboundSelected){const t=yt.Z.getByIds(o),i=bt.Z.getFolderTypes(t);e.isOutboundSelected=n.some((e=>i.has(e)))}if(!e.isOutboxDraftsSelected){const t=yt.Z.getByIds(o),n=bt.Z.getFolderTypes(t);e.isOutboxDraftsSelected=i.some((e=>n.has(e)))}e.isDeletedSelected&&e.isNonDeletedSelected||(wt.Z.isMessageDeleted(a)?e.isDeletedSelected=!0:e.isNonDeletedSelected=!0),e.isJunkSelected&&e.isNonJunkSelected&&e.isJunkableSelected||((0,Ct.Z)(a,r)?(e.isJunkSelected=!0,e.isJunkableSelected=!0):(e.isNonJunkSelected=!0,!e.isJunkableSelected&&kt(o,It.Hd)&&(e.isJunkableSelected=!0))),e.isArchivedSelected&&e.isNonArchivedSelected&&!e.isArchivableSelected||((0,St.Z)(a)?(e.isArchivedSelected=!0,e.isArchivableSelected=!0):(e.isNonArchivedSelected=!0,!e.isArchivableSelected&&(C.Z.get(I.kMailAddArchiveFolder)?_t(o):kt(o,It.hn))&&(e.isArchivableSelected=!0))),e.isReadSelected&&e.isUnreadSelected||(At.Z.call(a)?e.isReadSelected=!0:e.isUnreadSelected=!0)}return e}();if(0===l)return void t.clear();const f=1===l&&!d;t.set("MailMsgTrash",!(s&&o)),t.set("MailMsgSpam",m&&!(n&&i)),t.set("MailMsgArchive",g&&!(a&&r)),t.set("MailMsgReply",f),t.set("MailMsgReplyToAll",f),t.set("MailMsgFlag",!c),t.set("MailMsgLabel",!c),t.set("MailMsgStatusRead",!(u&&h))}function kt(e,t){const n=yt.Z.getByIds(e);return[...new Set(n.map((({accountId:e})=>e)))].some((e=>vt.Z.getFoldersOfType(e,t).length>0))}function _t(e){const t=yt.Z.getByIds(e);return[...new Set(t.map((({accountId:e})=>e)))].some((e=>(0,Tt.ZA)(e)))}function Nt(e){const{hiddenButtons:t}=e,n=gt.Z.getSelectedFolder();if(!n)return void t.clear();const{accountId:i,path:s}=n,o=bt.Z.getFolderType(i,s),a=[It.kY,It.fZ].includes(o),r=[It.Nz,It.uT].includes(o),l=i===It.u4;t.set("MailMsgEdit",!a),t.set("MailMsgSpam",a||r||l),t.set("MailMsgArchive",a||r),t.set("MailMsgReply",a),t.set("MailMsgReplyToAll",a),t.set("MailMsgStatusRead",a||o===It.Nz),t.set("MailMsgFlag",a),t.set("MailMsgLabel",a)}class Pt extends m.Z{getInitialState(){return{enabledButtons:new Map,hiddenButtons:new Map}}reduce(e,t){switch(t.actionType){case"MAIL_SELECT_FOLDER":case"MAIL_REFRESH_ACTIVE_MESSAGE":case"MAIL_SET_ACTIVE_COMPONENT":return(0,v.Uy)(e,(e=>{Et(e),Nt(e)}));case"WINDOW_ACTIVATED":return C.Z.get(I.kMailIsTurnedOff)?e:(0,v.Uy)(e,(e=>{Et(e),Nt(e)}));case"MAIL_STOP":return(0,v.Uy)(e,(e=>{e.enabledButtons.clear(),e.hiddenButtons.clear()}));default:return e}}isEnabled(e){if(""!==ft.Z.getState())return!0;const{enabledButtons:t}=this.getState();return t.get(e)??!1}isHidden(e){if(""!==ft.Z.getState())return!1;const{hiddenButtons:t}=this.getState();return t.get(e)??!1}}const Dt=new Pt;var Mt=n(47513),Ot=n.n(Mt),xt=n(51501),Lt=n(51733);function Rt(e){return e===It.of?It.ik:It.Gf}function Bt(e,t,n){const i=ht.Z.getByFolder(e,t);i&&(n.has(e)||n.set(e,new Map),n.get(e)?.set(t,xt.ZP.getViewIntersections(i)))}function Ft(e){const t=new Map;for(const{accountId:n}of e.mailWidgets)n&&Bt(n,Rt(n),t);for(const{feedId:n}of e.feedWidgets)if(n){const e=n===It.of?It.ym:n;Bt(It.u4,e,t)}t.has(It.of)||Bt(It.of,It.ik,t);const n=C.Z.get(I.kMailStatusSelectedAccount);return n&&!t.has(n)&&Bt(n,Rt(n),t),t}function Wt(e,t){for(const n of t.values())for(const t of n.values())if(t){const n=t.findIndex((t=>t.id===e));n>=0&&t.splice(n,1)}}function Ut(e,t,n){for(const[i,s]of t)for(const[t,o]of s){const s=n.get(i)?.get(t);if(s){const t=s.findIndex((t=>t.id===e));t>=0&&(ht.Z.matchesViewIntersection(s[t].viewIds,o)||s.splice(t,1))}}}function Vt(e,t,n){const i=ht.Z.getListEntry(e);if(i)for(const[e,s]of t)for(const[t,o]of s)if(ht.Z.matchesViewIntersection(i.viewIds,o)){const s=n.get(e)?.get(t);if(s){const o=Ot()(s,i,((e,t)=>t.sentDate-e.sentDate));o<0&&s.splice(-o-1,0,i),n.get(e)?.set(t,s)}else n.has(e)||n.set(e,new Map),n.get(e)?.set(t,[i])}}function Ht(e){return e.filter((e=>"email"===e.type&&e.accountId!==f.$c))}function Gt(e){return e.filter((e=>"feed"===e.type&&!!e.feedId))}class $t extends m.Z{getInitialState(){return{isInitialized:!1,items:new Map,mailWidgets:[],feedWidgets:[]}}reduce(e,t){switch(t.actionType){case"MAIL_INIT_INDEX_BATCH":{const{viewIdsBatch:n}=t,i=Ft(e),s=structuredClone(e.items);for(const{searchListId:e}of n)Vt(e,i,s);return{...e,items:this.trimLists(s)}}case"MAIL_INIT_INDEX_FINISHED":return{...e,isInitialized:!0};case"MAIL_INDEX_UPDATE":{const{sleUpdates:n,removedSles:i}=t.updates;if(n||i){const t=structuredClone(e.items);if(i)for(const e of i)Wt(e,t);if(n){const i=Ft(e),s=new Set(n.map((({id:e})=>e)));for(const e of t.values())for(const t of e.values())for(let e=0;e<t.length;e++)if(s.has(t[e].id)){const n=ht.Z.getListEntry(t[e].id);n&&(t[e]=n)}for(const e of n){const{addedViewIds:n,removedViewIds:s}=e.updates;Array.isArray(s)&&s.length>0&&Ut(e.id,i,t),Array.isArray(n)&&n.length>0&&Vt(e.id,i,t)}}return{...e,items:this.trimLists(t)}}return e}case"DASHBOARD_INIT":return{...e,mailWidgets:Ht(t.widgets),feedWidgets:Gt(t.widgets)};case"DASHBOARD_REMOVE_WIDGET":{const t=b.getState();return{...e,mailWidgets:Ht(t),feedWidgets:Gt(t)}}case"DASHBOARD_ADD_WIDGET":{const n=b.getState(),i=Ht(n),s=Gt(n),{options:o}=t,a=o?.feedId;if(a){const t=a===It.of?It.ym:a;if(e.items.get(It.u4)?.has(t))return{...e,feedWidgets:s};{const n=ht.Z.getListEntriesByFolder(It.u4,t),i=structuredClone(e.items);return i.has(It.u4)?i.get(It.u4)?.set(t,n):i.set(It.u4,new Map([[t,n]])),{...e,items:this.trimLists(i),feedWidgets:s}}}return{...e,mailWidgets:i}}case"DASHBOARD_UPDATE_WIDGET":{const{widgetId:n,accountId:i,feedId:s}=t;if(i){const t=[...e.mailWidgets],s=e.mailWidgets.findIndex((e=>e.id===n));if(s>-1){const n=e.mailWidgets[s];"email"===n.type&&t.splice(s,1,{...n,accountId:i})}if(e.items.has(i))return{...e,mailWidgets:t};{const n=Rt(i),s=ht.Z.getListEntriesByFolder(i,n),o=structuredClone(e.items);return o.set(i,new Map([[n,s]])),{...e,items:this.trimLists(o),mailWidgets:t}}}if(s){const t=[...e.feedWidgets],i=e.feedWidgets.findIndex((e=>e.id===n));if(i>-1){const n=e.feedWidgets[i];"feed"===n.type&&t.splice(i,1,{...n,feedId:s})}const o=s===It.of?It.ym:s;if(e.items.get(It.u4)?.has(o))return{...e,feedWidgets:t};{const n=ht.Z.getListEntriesByFolder(It.u4,o),i=structuredClone(e.items);return i.has(It.u4)?i.get(It.u4)?.set(o,n):i.set(It.u4,new Map([[o,n]])),{...e,items:this.trimLists(i),feedWidgets:t}}}return e}case"MAIL_LATEST_POPULATE":{const{accountId:n,path:i}=t,s=ht.Z.getListEntriesByFolder(n,i),o=structuredClone(e.items);return o.has(n)?o.get(n)?.set(i,s):o.set(n,new Map([[i,s]])),{...e,items:this.trimLists(o)}}case"MAIL_STOP":return this.getInitialState();default:return e}}getList(e,t){return this.getState().items.get(e)?.get(t)||[]}hasList(e){return this.getState().items.has(e)}isInitialized(){return this.getState().isInitialized}trimLists(e,t=f.bb){const n=new Map;for(const[i,s]of e){n.set(i,new Map);for(const[e,o]of s)n.get(i)?.set(e,o.sort((0,Lt.g4)(Lt.rQ)).slice(0,t))}return n}}const Kt=new $t;var zt=n(39045),jt=n(2711),Yt=n(3184),Xt=n(97698),Qt=n(2431),qt=n(75459),Jt=n(82227),en=n(95095),tn=n(48868),nn=n(45660),sn=n(21285),on=n(61839);async function an(e,t){const n=(0,xt.CR)(e);if(n){const{addedSles:e,forSearchDb:i}=await(0,sn.Z)(It.u4,n.path,It.Oi,t);return(0,on.Z)(i),e}return nn.Z.error("Feeds",["Add items"],`Filter not found when adding feed items for feed ${e}`),[]}const rn=async function(e){return await tn.Z.deletedFeedItems.where("feedId").equals(e).toArray()};const ln=async function(e){return await tn.Z.searchList.where("messageId").anyOf(e).toArray()};var dn=n(24651),cn=n(5204),un=n(40382),pn=n(44850),hn=n(34155);async function gn(e,t){const n=(0,xt.CR)(t);if(!n){const n={name:e,accountId:It.u4,path:t,filterValue:{include:[[{accountId:It.u4},{path:t}]],...xt.ZP.getSearchListButtons(It.u4)}},i=await d.Z.addFilter(n,!1);return{...n,id:i[0]}}return n}function mn(e,t){const n=t.length,i=en.Z.adjustBatchSize.bind(void 0,10,100,500);let s,o=10,a=0;return new Promise(((r,l)=>{hn.nextTick((function l(){const c=t.slice(a,a+o);a+=o,a>n&&(a=n);const h=Date.now();if(0===c.length)return r(s),Promise.resolve();return async function(e,t){const n=t.map((e=>e.messageId)),i=new Set(t.map((e=>e.subject)));let s=[],o=[];await tn.Z.transaction("rw",sn.E.concat([tn.Z.deletedFeedItems]),(async()=>{let a=await ln(n);a=a.filter((e=>i.has(e.subject)));const r=await rn(e),l=new Set;for(const e of a)l.add(e.messageId);for(const e of r)l.add(e.messageId);o=t.filter((e=>!l.has(e.messageId))),0!==o.length&&(s=await an(e,o))})),d.Z.updateIndex({addedSles:s});for(const e of o){const t=s.find((t=>t.messageId===e.messageId&&t.subject===e.subject));if(!t)throw new Error(`searchListEntry and message for rss out of sync. Subject: ${e.subject}`);await(0,un.Z)(It.u4,e.sentDate,t.id,e.raw),await dn.Z.setHasRaw(It.u4,t.id)}return s[0]}(e,c).then((t=>{t&&!s?s=t:t&&u.Z.setStatus(p.A4,(0,B.Z)("Loading feed $1: $2/$3",[e,a,n]));const r=Date.now();o=i(o,r-h)})).then((()=>hn.nextTick(l)))}))}))}async function fn(e){C.Z.get(I.kMailIsTurnedOff)&&w.Z.set(I.kMailIsTurnedOff,!1);const t=C.Z.get(I.kRssSettings),n=e.filter((e=>!t.some((t=>t.url===e.url))));if(n.length){if(n.some((e=>!e.feedId)))throw new Error("RssSettingsActions.add: Expected GUID feedId");w.Z.set(I.kRssSettings,[...t,...n]);for(const e of n)await gn(e.title||e.url,e.feedId),await Pn.poll([e],!0)}return n}function vn(e){const t=C.Z.get(I.kRssSettings);try{const n=(0,xt.CR)(e);if(!n)return void console.error("Feed filter not found for feed",e);d.Z.removeAccountPath(It.u4,n.path);const i=t.findIndex((t=>t.feedId===e));if(-1===i)throw`RssSettingsActions.removeFeed: feedId ${e} not found in prefs`;{const e=[...t];e.splice(i,1),w.Z.set(I.kRssSettings,e)}}catch(e){console.error(e)}}async function yn(e,t){const n=(0,xt.CR)(e.feedId);if(!n)return void console.error("Feed filter not found for feed",e.url);if(n.name!==e.title){const t=await Jt.Z.put({...n,name:e.title});yt.Z.updateFilters(t)}const i=C.Z.get(I.kRssSettings).slice();i[t]=e,w.Z.set(I.kRssSettings,i)}function bn(e,t,n){for(const i of[e,t,n]){const e=i.filter(((e,t,n)=>e.email&&t===n.findIndex((t=>t.email===e.email))));if(e.length>0)return e.map((e=>({name:e.name?e.name:e.email,address:e.email})))}return[]}var Sn=n(77150),wn=n.n(Sn),Cn=n(4111);function An(e){let t=new Date(e);return In(t)||(t=Tn(e)),t}const In=e=>e instanceof Date&&!isNaN(e),Tn=(e="")=>new Date(e.trim().replace(/\b[a-z]+$/i,(e=>Cn.Z[e.toUpperCase()]||"+0000")));var Zn=n(76085),En=n(11472);function kn(e,t){return e.id+(t.pubDate?e.publishdate:e.updatedate)+e.links.alternate.map((e=>e.url)).join(" | ")}function _n(e,t){const n=e.url,s=e.cacheLastModified,o=e.cacheETag,a="string"==typeof s||"string"==typeof o,r=new XMLHttpRequest,l=["application/atom+xml","application/rss+xml","application/rdf+xml;q=0.8","application/xml;q=0.6","text/xml;q=0.6","text/*;q=0.4"];return new Promise(((e,i)=>{r.overrideMimeType("text/xml"),r.open("GET",n,!0),r.setRequestHeader("Accept",l.join(", ")),t?r.setRequestHeader("Cache-Control","max-age=0"):a&&("string"==typeof s&&r.setRequestHeader("If-Modified-Since",s),"string"==typeof o&&r.setRequestHeader("If-None-Match",o)),r.onload=function(){if(r.status>=400)return;const l=isNaN(Date.parse(r.getResponseHeader("Last-Modified")))?null:r.getResponseHeader("Last-Modified"),d=r.getResponseHeader("ETag");if((!t||!a)&&(304===r.status||"string"==typeof s&&"string"==typeof l&&new Date(s)===new Date(l)||"string"==typeof d&&o===d))return e({cacheRevalidated:!0});let c=r.responseURL;/^(https?|ftp|file):/i.test(c)||(c=n);try{let{responseXML:t}=r;if(null===t){if(/^\s{0,10}<(\!doctype\ )?html/i.test(r.responseText))return i((0,B.Z)("Received HTML instead of the expected XML feed."));/^\s/.test(r.responseText)&&(t=(new DOMParser).parseFromString(r.responseText.trim(),"text/xml"))}const n=(0,Zn.t5)(t,r.responseText,c);"string"==typeof n?i(n):e({parsedFeed:n,lastModified:l,eTag:d})}catch(e){i(e)}},r.onreadystatechange=()=>{r.status>=400&&i(r.status)},r.onerror=r.onabort=function(e){i(e)},r.send()})).then((t=>{const s=C.Z.get(I.kRssSettings),o=s.findIndex((t=>t.url===e.url));if(-1===o)return Promise.reject("Feed deleted");const a={...s[o]};if(t.cacheRevalidated)return a.lastChecked=(new Date).valueOf(),yn(a,o),Promise.resolve();const r=t.parsedFeed,l={pubDate:!1};/^https?:\/\/(\w+\.)?youtube\.com\//i.test(n)&&(l.pubDate=!0);const d=r.plaintitle||new URL(a.url).hostname;a.title&&!["Atom","Feed","RSS","RSS 2.0"].includes(a.title)||(a.title=d);const h=r.feeditems.map((t=>({accountId:It.u4,feedId:e.url,subject:t.plaintitle,bodyParts:(0,En.O)(t),raw:t.xmloriginal,sentDate:An(t.updatedate).getTime()||0,messageId:wn()(kn(t,l)),from:[{name:d,address:d}],replyTo:bn(t.people.author.concat(t.people.contributor),r.people.author.concat(r.people.contributor),r.people.managingeditor.concat(r.people.webmaster)),to:[],cc:[],flags:[],internal:!0})));return async function(e,t,n){const s=n.length,o=await mn(t,n);if(!o)return;const a=()=>{const e=["message",o.id].join("/"),t=pn.jk.internalUrl("mailpage",e,o.subject),n=he.ZP.getMailWindowId();c.ZP.openURL(n,t),i.Z.windows.update(n,{drawAttention:!0})};if(C.Z.get(I.kRssShowNotifications)){const t=(0,B.Z)("$1 New Feed from $2","$1 New Feeds from $2",[s,e]);(0,U.c)({title:o.subject,body:t,icon:"resources/mail_notification_icon.png",onClick:a,tag:"VIVALDI_IMPORT_RSS_FEEDS"})}u.Z.setStatus(p.A4,(0,B.Z)("Finished loading feed $2. $1 message loaded","Finished loading feed $2. $1 messages loaded",[s,e]),It.QM),cn.Z.filter()}(a.title,a.feedId,h).then((()=>{const e=(new Date).valueOf();a.lastChecked=e,a.lastParsed=e,a.errorCount="number"==typeof a.errorCount&&a.errorCount>=5?Math.round(.8*a.errorCount):0,a.cacheLastModified=t.lastModified,a.cacheETag=t.eTag,yn(a,o)}))})).catch((t=>{const i=C.Z.get(I.kRssSettings),s=i.findIndex((t=>t.url===e.url));if(s>-1){const e={...i[s]};e&&navigator.onLine&&(e.lastChecked=(new Date).valueOf(),e.errorCount="number"==typeof e.errorCount?e.errorCount+1:1,yn(e,s))}t instanceof Error?nn.Z.error("Mail",["feeds","parsing"],(0,B.Z)("Encountered an error when parsing feed $1",[n]),t):nn.Z.warn("Mail",["feeds","loading"],(0,B.Z)("Failed to load feed $1",[n]),t)}))}var Nn=n(34155);const Pn=new class{#o;async poll(e=C.Z.get(I.kRssSettings),t=!1){if(!navigator.onLine)return;const n=(new Date).valueOf(),i=e.filter((e=>{if(t)return!e.offline;let{refreshInterval:i,lastChecked:s=0,offline:o,errorCount:a=0}=e;i=Math.max(i,15);const r=Math.min(60480,0===a?i:i+15*a);return!o&&n>=6e4*r+s})),s=new Document,o=s.createElement("link");o.rel="preconnect",s.appendChild(o);const a=Date.now();for(const e of i){if(!navigator.onLine)break;const n=i.indexOf(e);let s=t;if(n<i.length-2){const e=i[n+1];o.href=e.url}if(!s&&"number"==typeof e.lastParsed&&e.lastParsed>0){const t=new Date(e.lastParsed);t.setDate(t.getDate()+14)<=a&&(s=!0)}await _n(e,s)}}forceRefreshAllRSSAccounts(){const e=C.Z.get(I.kRssSettings);e.length>0&&this.poll(e,!0)}_onPrefsChanged=(e,t)=>{0===e.length&&t.length>0?(void 0!==this.#o&&(nn.Z.warn("Feeds",["RSSStartup"],"Did not expect an existing polling interval ID"),clearInterval(this.#o)),this.#o=setInterval((()=>this.poll()),6e4),Nn.nextTick((()=>this.poll()))):e.length>0&&0===t.length&&(clearInterval(this.#o),this.#o=void 0)};start(){C.Z.addListener(I.kRssSettings,this._onPrefsChanged),this._onPrefsChanged([],C.Z.get(I.kRssSettings))}stop(){C.Z.removeListener(I.kRssSettings,this._onPrefsChanged),clearInterval(this.#o),this.#o=void 0}};var Dn=n(96098),Mn=n(54773),On=n(95538),xn=n(51370),Ln=n(32593),Rn=n(83065);async function Bn(e){for(const t of e){const e=[t,""],n=[t,"￿"],i={Inbox:[],Drafts:[],All:[],Flagged:[],Sent:[],Trash:[],Junk:[],Archive:[],Other:[]},s=(await tn.Z.filters.where("[accountId+path]").between(e,n).toArray()).map((e=>e.path));let o=".";for(const e of s){if(e===It.ym)continue;e.indexOf("/")>-1&&(o="/");let t=(0,Rn.kF)(e);if(e.indexOf(o)>-1){const n=e.split(o);t=(0,Rn.kF)(n[n.length-1])}const n=(0,Ln.C7)(e),s={path:e,name:t,type:n,delimiter:o};i[n]?i[n].push(s):i[n]=[s]}await zt.Z.add(t,i),await vt.Z.addAccounts({[t]:{folders:i}})}}var Fn=n(63164);function Wn(){const e=C.Z.get(I.kMailCheckInterval);"one_minute"===e?(Yt.Z.setCheckInterval(!0,1),qt.Z.setCheckInterval(!0,1)):"fifteen_minutes"===e?(Yt.Z.setCheckInterval(!0,15),qt.Z.setCheckInterval(!0,15)):(Yt.Z.setCheckInterval(!1),qt.Z.setCheckInterval(!1))}function Un(){d.Z.sortListEntries()}function Vn(e){d.Z.sortListEntries()}function Hn(e){const t=(0,xn.Z)(e);Qt.Z.createDraft(t)}const Gn={async startPortalLoad(){if(i.Z.extension.inIncognitoContext)return;d.Z.init(),await async function(){const{dbVersion:e,migrationNeeded:t}=await se.Z.mailPrivate.getDBVersion();if(3!==e||!t)return;function n(e,t,n){const i=0===t?0:Math.floor(e/t*100),s=0===t?"":`${(0,R.uf)(e)} / ${(0,R.uf)(t)} - ${i}%.`;nn.Z.log("Mail",["migrate search db"],`${n} ${s}`),u.Z.setPersistentStatus(p.A4,"MAIL_SEARCH_MIGRATION",`${n} ${s}`)}nn.Z.log("Mail",["migrate search db"],"Starting migration"),se.Z.mailPrivate.onUpgradeProgress.addListener(n);const i=await se.Z.mailPrivate.startMigration();if(u.Z.clearPersistentStatus(p.A4,"MAIL_SEARCH_MIGRATION"),se.Z.mailPrivate.onUpgradeProgress.removeListener(n),!i){const e="migratateSearchData: Irrecoverable failure.     Make sure there is enough disk space on your computer.     Please close Vivaldi, delete the files: MailSearchDB & MailSearchDB-journal     and MailDB & MailDB-journal     from your profile directory and start again. Click the Mail Status button     in Status Bar, click the cog wheel in the top right corner and select     Rebuild Mail Search Database.";throw u.Z.setStatus(p.A4,"Error migrating search data. Please check the logs in     Mail Status button for more info"),nn.Z.error("Mail",["migrateMailSearch"],e),new Error(e)}}(),jt.Z.startBackgroundActions(),(0,Fn.Tg)((async(e,t)=>{t.tab?.id&&"FEEDS_ADD"===e.type&&de.Z.showAddFeed(t.tab.windowId,e.feeds)}));const e=new SharedWorker("bundle-mailreader-worker.js");async function t(){nn.Z.debug("Mail",["startup"],"Starting up..."),u.Z.setPersistentStatus(p.A4,"MAIL_STARTUP",(0,B.Z)("Mail client starting...")),C.Z.addListener(I.kMailCheckInterval,Wn),C.Z.addListener(I.kMailSearchSortField,Vn),C.Z.addListener(I.kMailSearchSortFieldSent,Vn),C.Z.addListener(I.kMailSearchSortFieldPerFolder,Vn),C.Z.addListener(I.kMailSearchSortOrder,Un),se.Z.calendar.onMailtoOpened.addListener(Hn);try{try{u.Z.setPersistentStatus(p.A4,"MAIL_DB_OPEN",(0,B.Z)("Waiting for Mail to start…")),await(navigator.serviceWorker?.ready),u.Z.setPersistentStatus(p.A4,"MAIL_DB_OPEN",(0,B.Z)("Loading mail database…")),await tn.Z.open()}catch(e){return"VersionError"===e.name&&(e.message=(0,B.Z)("Your mail database was created with a newer version of Vivaldi. Please upgrade Vivaldi.")),nn.Z.error("Mail",["startup"],e),r.Z.set("INTERNAL","DATABASE",e,"MAIL_DB_OPEN_FAILED","CRITICAL"),void u.Z.setPersistentStatus(p.A4,"MAIL_DB_OPEN_FAILED",(0,B.Z)("Error: Failed to open mail database!"))}finally{u.Z.clearPersistentStatus(p.A4,"MAIL_DB_OPEN")}await Promise.all([zt.Z.getAccountsAndFolders().then((e=>Promise.all([vt.Z.initAccounts(e.accounts),bt.Z.initFolders(e.folders)]))),On.Z.initMailingLists(),yt.Z.initFilters(),jt.Z.start(),d.Z.initIndex(),a.Z.initialize()])}catch(e){return nn.Z.error("Mail",["startup"],e),n(),void u.Z.setPersistentStatus(p.A4,"MAIL_STARTUP_FAILED",(0,B.Z)("Mail client startup failed. Error: $1",[e.message||e]))}finally{u.Z.clearPersistentStatus(p.A4,"MAIL_STARTUP")}if((await tn.Z.systemTasks.toArray()).find((e=>"restore_mail_db"===e.taskName)))nn.Z.warn("Mail",["startup"],"Resume restoration of mail DB!"),(0,U.c)({title:(0,B.Z)("Resuming restoration of Mail DB"),tag:"MAIL_DB_RESTORATION"}),await jt.Z.runSystemTasks();else if(C.Z.get(I.kMailAccounts).length>Object.keys(vt.Z.accounts).length){if(0===await tn.Z.messages.count())return nn.Z.warn("Mail",["startup"],"No mail accounts and no messages found in DB but accounts exist in Prefs. Restore mail DB!"),(0,U.c)({title:(0,B.Z)("Mail DB missing! Starting restoration!"),tag:"MAIL_DB_RESTORATION"}),await tn.Z.systemTasks.add({taskName:"restore_mail_db"}),void await jt.Z.runSystemTasks();nn.Z.warn("Mail",["startup"],"Some mail accounts missing from DB and will be restored based on info in settings"),await Bn(C.Z.get(I.kMailAccounts).map((e=>e.MAIL_EMAIL)))}Pn.start();const e=Dn.Z.getSync("FOLDER_SELECTION");d.Z.selectFolder(e),cn.Z.filter(),jt.Z.updateFlags(),jt.Z.updateThreads(),jt.Z.runSystemTasks(),Wn(),Yt.Z.startAddtoSearchDb(),window.addEventListener("online",$n,!1),u.Z.setStatus(p.A4,(0,B.Z)("Mail client started"),It.QM),nn.Z.debug("Mail",["startup"],"Startup complete")}async function n(){nn.Z.debug("Mail",["startup"],"Shutting down..."),Pn.stop(),Yt.Z.setCheckInterval(!1),qt.Z.setCheckInterval(!1),C.Z.removeListener(I.kMailCheckInterval,Wn),C.Z.removeListener(I.kMailSearchSortField,Vn),C.Z.removeListener(I.kMailSearchSortFieldSent,Vn),C.Z.removeListener(I.kMailSearchSortFieldPerFolder,Vn),C.Z.removeListener(I.kMailSearchSortOrder,Un),se.Z.calendar.onMailtoOpened.removeListener(Hn),window.removeEventListener("online",$n,!1),Qt.Z.closeMailPages(),await Yt.Z.disconnectIMAPClients(),vt.Z.clear(),On.Z.clear(),yt.Z.clear(),bt.Z.clear(),Mn.Z.clear(),d.Z.stop(),jt.Z.stop(),nn.Z.debug("Mail",["startup"],"Shutdown complete")}async function s(e,i,s){switch(s){case I.kMailIsTurnedOff:(C.Z.get(I.kMailAccounts).length>0||C.Z.get(I.kRssSettings).length>0)&&(i?n():(await t(),navigator.onLine&&$n()));break;case I.kMailAccounts:if(C.Z.get(I.kMailIsTurnedOff))break;e.length>0&&0===i.length?(0===C.Z.get(I.kRssSettings).length&&n(),w.Z.set(I.kMailMailtoInVivaldi,!1)):0===e.length&&i.length>0&&(await t(),w.Z.set(I.kMailMailtoInVivaldi,!0));break;case I.kRssSettings:C.Z.get(I.kMailIsTurnedOff)||0!==C.Z.get(I.kMailAccounts).length||(e.length>0&&0===i.length?n():0===e.length&&i.length>0&&await t())}}return e.onerror=console.error,navigator.serviceWorker?.ready.then((t=>{t.active?.postMessage({setupMailreaderOnBackground:!0},[e.port])})),C.Z.addListener([I.kMailIsTurnedOff,I.kMailAccounts,I.kRssSettings],s),C.Z.get(I.kMailIsTurnedOff)?void 0:s(!0,!1,I.kMailIsTurnedOff)}};async function $n(){nn.Z.info("Mail",["startup"],"onOnline event fired");const e=he.ZP.getMailWindowId();e!==p.Ex&&Xt.Z.sendAll(e,!1),await Promise.all([Yt.Z.connectIMAPClients(),qt.Z.checkForMail()]),jt.Z.flushBuffer()}const Kn=Gn;var zn=n(21838),jn=n(18350),Yn=n(15285),Xn=n(14481);let Qn=!1;const qn="#000000";let Jn,ei=qn,ti=qn;const ni={_onPrefsCacheChanged:function(e,t,n){n===I.kRazerChromaEnabled&&!0===t&&ni.init()},isInitialized:function(){return Qn},setInitCallback:function(e){Jn=e},onChromaReady:function(){Qn||(Qn=!0,ti!==qn&&(ni.setColor(ti),ti=qn),Jn&&Jn(),se.Z.utilities.onRazerChromaReady.removeListener(this.onChromaReady),Be.Z.addListener(this.onColorUpdated),he.ZP.addListener(this.onColorUpdated))},init:function(){Qn=!1,C.Z.addListener([I.kRazerChromaEnabled],this._onPrefsCacheChanged),se.Z.utilities.onRazerChromaReady.addListener(this.onChromaReady),se.Z.utilities.isRazerChromaReady((e=>{e&&this.onChromaReady()}))},onColorUpdated:function(){const e=he.ZP.getLastActiveBrowserWindowId(),t=Be.Z.getState().windowStyles.get(e)?.["--colorAccentBg"];"string"==typeof t&&ni.setColor(t)},setColor:function(e){if(!Qn)return void(ti=e);if(ei===e)return;ei=e;let t=xe()(e);const[,,n]=t.hsl();n<.1&&(t=t.brighten(1));const i=[],s=xe().bezier([ei,t.toString()]);for(let e=1;e<11;e++){const[t,n,o]=s(e/10).rgb();i.push({red:t,green:n,blue:o})}se.Z.utilities.setRazerChromaColor(i,(e=>{e||console.warn("Error setting Razer Chroma color")}))}},ii=ni;var si=n(92413);const oi=new class{resetRssFeeds(e){A.Z.dispatch({actionType:"RSS_CLEAR_FEEDS",tabId:e})}initPortalDocument(){(0,Fn.Tg)(((t,n,i)=>{if(!n.tab?.id)return;const s=n.tab.id;switch(t.type){case"FEEDS_REMOVE_THIS_PREVIEW":(0,Fn.VN)(s,{type:"FEEDS_REMOVE_PREVIEW"});break;case"FEEDS_GET_TAB_URL":i(n.tab.url);break;case"FEEDS_GET_CONTENT_TYPE":i(e.get(s)??"");break;case"FEEDS_ADD_DETECTED":A.Z.dispatch({actionType:"RSS_FEEDS_FOUND",tabId:s,feeds:t.feeds});break;case"FEEDS_ADD":const o=t.feeds.reduce(((e,t)=>(t.url&&e.push({url:t.url,title:t.title??t.url,type:"RSS"}),e)),[]);A.Z.dispatch({actionType:"RSS_FEEDS_FOUND",tabId:s,feeds:o})}}));const e=new Map;i.Z.webRequest.onResponseStarted.addListener((t=>{if(-1===t.tabId)return void console.warn("RssDetectActions:","Should this be a chrome.runtime.lastError check instead?");const n=(t.responseHeaders||[]).reverse().find((e=>"content-type"===e.name.toLowerCase()));e.set(t.tabId,n?.value)}),{types:["main_frame"],urls:["http://*/*","https://*/*"]},["responseHeaders"]),i.Z.tabs.onRemoved.addListener((t=>e.delete(t)))}};var ai=n(39206),ri=n(39840),li=n(66971);class di extends m.Z{getInitialState(){return{elements:[],changeReason:""}}getElements(){return this.getState().elements}reduce(e,t){if("SHARED_LINKS_ADD"===t.actionType){return(0,v.Uy)(e,(e=>{e.elements=t.elements,e.elements.sort(((e,t)=>e.sharedTime<t.sharedTime?1:e.sharedTime>t.sharedTime?-1:0)),e.changeReason=t.fromEvent?"event":"poll"}))}return e}}const ci=new di(A.Z);async function ui(e,t){const n=await se.Z.tabsPrivate.getSendTabToSelfEntries(t);return A.Z.dispatch({actionType:"SHARED_LINKS_ADD",elements:n,fromEvent:e}),Promise.resolve()}const pi=new class{loadPromise=async()=>(se.Z.tabsPrivate.onSendTabToSelfAdded.addListener(this.onAdded),se.Z.tabsPrivate.onSendTabToSelfDismissed.addListener(this.onDismissed),ui(!1,!0));onAdded=async e=>ui(!0,!1);onDismissed=e=>{const t=ci.getElements().filter((t=>!e.find((e=>e===t.guid))));A.Z.dispatch({actionType:"SHARED_LINKS_ADD",elements:t,fromEvent:!0})};onActivate=(e,t)=>{let n=!1;t.forEach((t=>{const i=ci.getElements().find((e=>e.guid===t));i&&(c.ZP.openURL(e,i.url,{inCurrent:!1,inBackground:n}),n=!0)})),this.onDismiss(t)};onDelete=e=>{se.Z.tabsPrivate.execSendTabToSelfAction("delete",e,(()=>{ui(!1,!1)}))};onDismiss=e=>{se.Z.tabsPrivate.execSendTabToSelfAction("delete",e,(()=>{ui(!1,!1)}))}},hi={intro:(0,B.Z)("Welcome to Vivaldi!"),control:(0,B.Z)("Get the most from Vivaldi"),import_data:(0,B.Z)("Bring your favorites to Vivaldi"),tracker_and_ad:(0,B.Z)("browser","We care about your privacy!"),personalize:(0,B.Z)("Make Vivaldi yours!"),tabs:(0,B.Z)("Where do you want your tabs?"),welcome_feature_amount:(0,B.Z)("One more thing")},gi={intro:[(0,B.Z)("With everything you want and more, built-in, the only browser powerful enough to match you."),(0,B.Z)("Allow Vivaldi to Send Automatic Crash Reports"),(0,B.Z)("Crash reports include the most recently visited webpage. It may send more personal information which is promptly deleted."),(0,B.Z)("Privacy policy")],control:[(0,B.Z)("Unlock the full potential of Vivaldi from day one by importing your data from your old browser and setting Vivaldi as default."),(0,B.Z)("mac","Keep Vivaldi in Dock"),(0,B.Z)("win_linux","Keep Vivaldi in Taskbar"),(0,B.Z)("Set Vivaldi as Default Browser"),(0,B.Z)("Import from Other Browsers")],tracker_and_ad:[(0,B.Z)("Vivaldi comes with a built-in tracker and ad blocker to protect your browsing. You’re in control, block as much or as little as you want. You can adjust the global and site-specific blocking preferences from settings.")],import_data:[(0,B.Z)("Select your old web browsers to import bookmarks, history, passwords, tabs, and other data."),(0,B.Z)("Import your bookmarks, browser history, passwords, notes, and other data using the “File: Import From Applications or Files” menu.")],personalize:[(0,B.Z)("Vivaldi looks better when you put your personal touch to it. Choose a theme from the options below. You can personalize your theme or find others from settings later."),(0,B.Z)("Follow Operating System Theme Color")],tabs:[(0,B.Z)("Personalization is not just about the colors you choose, Vivaldi is packed with ways to make the browser adapt to you. A unique feature is the ability to place tabs wherever you like.")],welcome_feature_amount:[(0,B.Z)("Vivaldi is not only a browser, it has a mail client, calendar, and feed reader, all built-in. Choose the full package or start simple and add features as you go. You can always enable Mail, Calendar, and Feeds from settings later."),(0,B.Z)("Browser"),(0,B.Z)("Enable Mail, Calendar and Feeds"),(0,B.Z)("Start Browsing"),(0,B.Z)("Set up Vivaldi Mail")]},mi={getUnreadPageKeys:()=>Object.keys(hi).filter((e=>!C.Z.get(I.kWelcomeReadPages).includes(e))),isFirstStart:()=>0===C.Z.get(I.kWelcomeReadPages).length,hasUnreadPages:()=>mi.getUnreadPageKeys().length>0},fi=mi;var vi=n(39180);const yi=new class{init=async()=>{const e=fi.isFirstStart(),t=[];if(!e){if(C.Z.get(I.kStartupCheckIsDefault)&&!he.ZP.isGuest()){if(!await se.Z.utilities.isVivaldiDefaultBrowser()){(await i.Z.history.search({startTime:Date.now()-2592e5,endTime:Date.now(),text:""})).length>=10&&t.push("DIALOG_DEFAULT_BROWSER")}}await se.Z.utilities.isRazerChromaAvailable()&&!C.Z.get(I.kRazerChromaHasShownPromotion)&&t.push("DIALOG_RAZER_CHROMA_FOUND"),"win"===vi.Z.call()&&C.Z.get(I.kStartupShowMediaAvailableInformation)&&(await se.Z.utilities.getMediaAvailableState()||t.push("DIALOG_INFORM_MEDIA_WIN_N")),""!==C.Z.get(I.kStartupShowGitDirectoryWarning)&&t.push("DIALOG_INFORM_GIT_DIRECTORY_FOUND"),(await se.Z.extensionActionUtils.triggerGlobalErrors()).length&&t.push("DIALOG_EXTENSION_INSTALL_ERROR")}const n=await se.Z.searchEngines.getSwitchPromptData();!e&&n.shouldPrompt?t.push("DIALOG_SEARCH_ENGINE_SWITCH"):se.Z.searchEngines.acknowledgeSwitchPrompt(!1),0!==t.length&&A.Z.dispatch({actionType:"STARTUP_DIALOGS_INIT",state:t})};closeDialog(e){A.Z.dispatch({actionType:"STARTUP_DIALOG_CLOSE",dialog:e})}};function bi(e){A.Z.dispatch({actionType:"SYNC_ENGINE_STATE_CHANGED",engineData:e})}function Si(e){A.Z.dispatch({actionType:"SYNC_CYCLE_COMPLETED",cycleData:e})}const wi=new class{start(){se.Z.sync.start()}clearData(){se.Z.sync.clearData()}setEncryptionPassword(e,t){se.Z.sync.setEncryptionPassword(e,(e=>t(e)))}loadPromise=async()=>{if(i.Z.extension.inIncognitoContext)return;const e=new Promise((e=>se.Z.sync.getEngineState((t=>{bi(t),se.Z.sync.onEngineStateChanged.addListener((e=>bi(e))),e()})))),t=new Promise((e=>se.Z.sync.getLastCycleState((t=>{Si(t),se.Z.sync.onCycleCompleted.addListener((e=>Si(e))),e()}))));await Promise.all([e,t])}};class Ci extends m.Z{getInitialState(){return{devices:[],loggedIn:!1}}hasSupport(){return!window.isGuestSession&&!i.Z.extension.inIncognitoContext}getDevices(){return this.getState().devices}getLoggedIn(){return this.getState().loggedIn}getDeviceTree(){const e=(e,t)=>{const n={id:e.sessionId??"",name:e.title??"",url:e.url??"",windowId:t,tab:e,workspaceId:void 0,stackId:void 0,panelId:void 0,fixedTitle:void 0,fixedGroupTitle:void 0};if(!e.vivExtData||String(e.vivExtData).length<2)return n;try{const t=JSON.parse(String(e.vivExtData));n.workspaceId=t.workspaceId,n.stackId=t.group,n.panelId=t.panelId,n.fixedTitle=t.fixedTitle,n.fixedGroupTitle=t.fixedGroupTitle}catch(e){console.log("invalid tab ext data")}return n};return this.getState().devices.map(((t,n)=>{let i=[],s=[],o="device_"+n;1===t.sessions.length?t.sessions[0].window?.tabs&&t.sessions[0].window?.sessionId&&(o=t.sessions[0].window.sessionId,s=t.sessions[0].window.tabs.map((t=>e(t,o)))):i=t.sessions.map(((t,n)=>{if(t.window&&t.window.sessionId){const i=t.window.sessionId;return{id:i,name:(0,B.Z)("$1",[n+1]),tabs:(t.window?.tabs??[]).map((t=>e(t,i)))}}})).filter(Boolean);const a={id:o,name:t.deviceName,windows:i,tabs:s,workspaceNames:void 0,panels:void 0,deviceType:t.deviceType};return t.vivaldiSpecific?.workspaces&&(a.workspaceNames=t.vivaldiSpecific.workspaces.reduce(((e,t)=>(t.workspaceId&&t.name&&e.set(t.workspaceId,{name:t.name,icon:t.icon,iconId:t.iconId,emoji:t.emoji}),e)),new Map)),t.vivaldiSpecific?.panels&&(a.panels=t.vivaldiSpecific.panels.map((e=>({url:e.url,title:e.title,initialFaviconUrl:e.initialFaviconUrl,id:e.panelId})))),a}))}reduce(e,t){switch(t.actionType){case"SYNCED_TABS_INIT":return{devices:[...t.devices],loggedIn:t.loggedIn};case"SYNCED_TABS_SET_DEVICES":return{devices:[...t.devices],loggedIn:e.loggedIn};case"SYNCED_TABS_SET_LOGGED_IN":return{devices:[...e.devices],loggedIn:t.loggedIn};default:return e}}}const Ai=new Ci(A.Z);var Ii=n(34155);async function Ti(){const e=await i.Z.sessions.getDevices();A.Z.dispatch({actionType:"SYNCED_TABS_SET_DEVICES",devices:e})}function Zi(){Ii.nextTick((()=>{A.Z.dispatch({actionType:"SYNCED_TABS_SET_LOGGED_IN",loggedIn:"loggedIn"===ce(pe.getState())})}))}const Ei=new class{loadPromise=()=>(Ai.hasSupport()&&(pe.addListener(Zi),se.Z.sync.onCycleCompleted.addListener(Ti),async function(){const e=await i.Z.sessions.getDevices(),t="loggedIn"===ce(pe.getState());A.Z.dispatch({actionType:"SYNCED_TABS_INIT",devices:e,loggedIn:t})}()),Promise.resolve());openTabs=e=>{e.forEach((e=>{i.Z.sessions.restore(e,(t=>{i.Z.runtime.lastError&&console.warn("Error restoring tab: ",e,i.Z.runtime.lastError)}))}))};openWindows=e=>{e.forEach((e=>{i.Z.sessions.restore(e,(t=>{i.Z.runtime.lastError&&console.warn("Error restoring window: ",e,i.Z.runtime.lastError)}))}))}};var ki=n(2699),_i=n(54058),Ni=n(76501);function Pi(e){A.Z.dispatch({actionType:"VIVALDI_ACCOUNT_STATE_UPDATED",state:e})}const Di=new class{login(e,t,n){se.Z.vivaldiAccount.login(e,t,n),se.Z.sync.start()}logout(){se.Z.vivaldiAccount.logout()}loadPromise=async()=>{if(i.Z.extension.inIncognitoContext)return;Pi(await se.Z.vivaldiAccount.getState()),se.Z.vivaldiAccount.onAccountStateChanged.addListener(Pi)}};var Mi,Oi=n(16716),xi=n(63153),Li=n(67294),Ri=n(97009),Bi=n(94184),Fi=n.n(Bi),Wi=n(86088);function Ui(e,t,n,i){Mi||(Mi="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Mi,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var Vi=Ui("circle",{cx:"10.5",cy:"10.5",r:"5"}),Hi=Ui("text",{x:"7.5",y:"14",fontSize:"10px"},void 0,"~"),Gi=Ui("text",{x:"9.5",y:"14",fontSize:"10px"},void 0,"!");class $i extends Li.PureComponent{getImageSet=()=>this.props.trash?Wi.nre:this.props.speeddial?this.props.open?Wi.g0V:Wi.$II:this.props.open?Wi.fHR:Wi._TQ;render(){return Ui("svg",{width:"16",height:"16",viewBox:"0 0 16 16",className:Fi()("folder-icon",this.props.className,{sd:this.props.speeddial}),style:{marginLeft:this.props.leftMargin?this.props.leftMargin:null,marginRight:this.props.rightMargin?this.props.rightMargin:null}},void 0,this.props.icon?this.props.icon:Ui("g",{className:"fill-override",dangerouslySetInnerHTML:{__html:(this.props.imageSet||this.getImageSet()).small}}),(this.props.isConnecting||this.props.disconnected)&&Ui("g",{className:this.props.isConnecting?"folder-evaluating":"folder-error",onClick:this.props.onClickStatusIcon},void 0,Vi,this.props.isConnecting?Hi:Gi))}}const Ki=$i;var zi=n(27770),ji=n(72882),Yi=n(26395);const Xi=class{constructor(e=!0){this.selectedIds_=[],this.anchorIndex_=-1,this.leadIndex_=-1,this.multiSelect_=e}isSelected(e){for(const t of this.selectedIds_)if(t.id===e)return t.selected;return!1}get length(){return this.selectedIds_.length}get isSingleItemSelected(){return 1===this.selectedIds_.length}get FirstSingleItemSelected(){return this.isSingleItemSelected?this.selectedIds_[0].id:-1}get selectedIds(){return this.selectedIds_}resetSelectionModel(){this.selectedIds_=[],this.anchorIndex_=-1,this.leadIndex_=-1}getData(){return{selectedIds_:this.selectedIds_,anchorIndex_:this.anchorIndex_,leadIndex_:this.leadIndex_}}setData(e){this.anchorIndex_=e.anchorIndex_,this.leadIndex_=e.leadIndex_,this.selectedIds_=e.selectedIds_}unSelectAll(){this.selectedIds_=[]}selectAll(e){this.multiSelect&&(e.forEach((e=>{this.selectedIds_.push({id:e,selected:!0})})),e.length>0&&(-1===this.anchorIndex_&&(this.anchorIndex_=e[0]),-1===this.leadIndex_&&(this.leadIndex_=e[0])))}setSelectedIds(e){this.multiSelect?this.selectedIds_=e.map((e=>({id:e,selected:!0}))):this.setIndexSelected(this.leadIndex,!0)}setLeadIndex(e){this.leadIndex=e}setIndexSelected(e,t){var n=this.selectedIds_.map((e=>e.id)).indexOf(e),i=this.selectedIds_[n];if((!i||i.selected!==t)&&(this.multiSelect||this.resetSelectionModel(),this.leadIndex=e,this.anchorIndex=e,-1!==e))if(t)this.selectedIds_.push({id:e,selected:t});else{var s=this.selectedIds_.map((e=>e.id)).indexOf(e);-1!==s&&this.selectedIds_.splice(s,1)}}get leadIndex(){return this.leadIndex_}set leadIndex(e){this.leadIndex_=e}get anchorIndex(){return this.anchorIndex_}set anchorIndex(e){this.anchorIndex_=e}get multiSelect(){return this.multiSelect_}set multiSelect(e){this.multiSelect_=e}};var Qi=n(34155);const qi={throttleSync:function(e,t={}){return function(){if(!t.isRunning){t.isRunning=!0;try{e.apply(this,arguments)}finally{Qi.nextTick((()=>{t.isRunning=!1}))}}}}};var Ji,es=n(4027),ts=n(94283),ns=n(51877),is=n(52373),ss=n(48521);function os(e,t,n,i){Ji||(Ji="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Ji,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function as(e,t,n){switch(e){case"style":case"componentProps":return(0,ns.Z)(t[e],n[e])}return(0,is.Z)(t[e],n[e])}class rs extends Li.Component{static contextType=ts.Z;#a={available:!1,onto:!1,edge:"none"};#r;shouldComponentUpdate(e){return!(0,ns.Z)(this.props,e,as)}isFolder=()=>this.props.isFolder(this.props.treeItem);hasChildren=()=>this.props.hasChildren(this.props.treeItem);onClick=e=>{this.props.onItemClick(this.props.treeItem,e),e.stopPropagation()};onDoubleClick=e=>{if(void 0===this.props.inlineEditText){if(this.isFolder()){this.props.overrideDoubleClick&&this.props.overrideDoubleClick(this.props.treeItem)||this.onExpandClick(e)}this.props.onItemDoubleClick(this.props.treeItem,e)}};onDragStart=e=>{const{inlineEditText:t,validateForDrag:n,getAllSelectedItems:i,mimeType:s,disableMousePointersOverride:o,setCustomEventBehavior:a}=this.props;if(!n||void 0!==t)return;let r=i().map((e=>e.id));r=n(r),0!==r.length&&(s&&e.dataTransfer.setData(s,JSON.stringify(r)),e.dataTransfer.setData("text/uri-list",this.props.getDragData?.("text/uri-list",r)),e.dataTransfer.setData("vivaldi/x-uri-list",this.props.getDragData?.("vivaldi/x-uri-list",r)),e.dataTransfer.setData("text/plain",this.props.getDragData?.("text/plain",r)),e.dataTransfer.setData("vivaldi/x-title",this.props.getDragData?.("vivaldi/x-title",r)),e.dataTransfer.effectAllowed="all",a&&a(e,r),this.props.onDragStart(r),this.#r=!0,o||es.Z.setWebviewPointerEvents(!1,this.context.document))};onDragEnd=e=>{this.#r=!1,this.props.disableMousePointersOverride||es.Z.setWebviewPointerEvents(!0,this.context.document),this.props.onDragEnd()};onDragEnter=e=>{this.props.supportDrop&&(this.#a=this.props.supportDrop(this.props.treeItem,e))};onDrop=e=>{e.preventDefault(),e.stopPropagation(),!0===this.#a.available&&this.props.onDrop(this.props.treeItem,this.#a,e)};onDragOver=e=>{const{onDragOver:t,treeItem:n,index:i}=this.props;e.stopPropagation(),!0===this.#a.available&&t&&(e.preventDefault(),e.nativeEvent.dataTransfer.dropEffect="move",t(n,i,this.#a,e))};onDragLeave=e=>{e.preventDefault(),e.stopPropagation(),this.props.onDragLeave&&!0===this.#a.available&&this.props.onDragLeave(this.props.treeItem,e)};onMouseDown=e=>{const t=!this.props.isDraggable&&void 0===this.props.inlineEditText;this.props.onMouseDown(this.props.treeItem,t,e)};onMouseUp=e=>{this.props.onMouseUp(this.props.treeItem,e),0===e.buttons&&this.#r&&this.onDragEnd(e)};onExpandClick=e=>{if(this.props.treeItem.children&&this.props.treeItem.children.length>0){const t=e.altKey;this.props.toggleExpandModel(this.props.treeItem,t),e.preventDefault(),e.stopPropagation()}};render(){const{Component:e,componentProps:t}=this.props,n=!!this.props.isSeparator&&this.props.isSeparator(this.props.treeItem),i=this.props.selected,s=this.props.dragOverObj.id===this.props.treeItem.id,o=this.props.dragOverObj.position,a=!!this.props.validateForDrag&&0!==this.props.validateForDrag([this.props.treeItem.id]).length;return os("div",{style:this.props.style,"data-id":this.props.treeItem.id,className:"tree-item","data-selected":i?"":null,"data-lead":this.props.lead?"":null,"data-cut":this.props.isCut?"":null,"data-expanded":this.props.isExpanded?"":null,onDragEnter:this.props.enableDragAndDrop?this.onDragEnter:null,onDragOver:this.props.enableDragAndDrop?this.onDragOver:null,onDragLeave:this.props.enableDragAndDrop?this.onDragLeave:null,onDrop:this.props.enableDragAndDrop?this.onDrop:null,onContextMenu:this.props.onContextMenu},void 0,os("div",{className:Fi()("tree-row",{folder:this.isFolder(),"tree-row-selected":i,"tree-row-selected--first":this.props.isFirstSelected,"tree-row-selected--last":this.props.isLastSelected,dragover:s&&"on"===o,dragoverAbove:s&&"above"===o,dragoverBelow:s&&"below"===o,"speeddial-folder":this.isFolder()&&this.props.treeItem.speeddial}),"data-separator":n?"":null,"data-selected":i?"":null,"data-nofocus":i&&!this.props.hasFocus?"":null,onClick:this.onClick,onDoubleClick:this.onDoubleClick,onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,draggable:a,onDragStart:this.props.enableDragAndDrop?this.onDragStart:null,onDragEnd:this.props.enableDragAndDrop?this.onDragEnd:null},void 0,(0,ss.jsx)(e,{...t})))}}const ls=rs;var ds=n(93974),cs=n(47380),us=n(26036),ps=n(84847),hs=n(42568),gs=n.n(hs),ms=n(81157);const fs=(e,t)=>{const n={...C.Z.get(I.kAppearanceTreeColumnsEntries),[t]:e};w.Z.set(I.kAppearanceTreeColumnsEntries,n)},vs=()=>C.Z.get(I.kAppearanceTreeColumnsEntries),ys=e=>e.filter((e=>e.visible)).reduce(((e,t)=>(e.push({id:t.value,width:t.width||100,key:t.key}),e)),[]),bs=e=>e.map((e=>e.key?`minmax(${Math.min(e.width/2,100)}px, 1fr)`:`minmax(36px, ${e.width}px)`)).join(" ");var Ss,ws=n(67720),Cs=n(9304),As=n(721),Is=n(34155);function Ts(e,t,n,i){Ss||(Ss="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Ss,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function Zs(){return 24+((0,Cs.mM)()?4:0)}const Es="F2",ks=16;function _s(e){e.target.select()}class Ns extends Li.PureComponent{static contextType=ts.Z;static defaultProps={enableDragAndDrop:!0,supportsCollapseAll:!0};emptyDragOverObj={id:-1,position:""};refTreeListEntries=Li.createRef();constructor(e){super(e);const t=this.setupExpandModel(e),{multiSelect:n}=e;this.selectionModel=new Xi(n),this.state={dragOverObj:this.emptyDragOverObj,hasFocus:!1,expandModel:t,renderArray:this.makeRenderArray(e.nodes,t,e.sorting),inlineEditId:-1,inlineEditText:"",width:0,height:("number"==typeof e.rowHeight?e.rowHeight:Zs())*e.nodes.length}}_dropSupport={available:!1,onto:!1,edge:"none"};_leftMouseTimeStamp=0;#l;_isMounted=!1;_hasCutCopyPasteListeners=!1;_isComposing=!1;_scrollTopNeedsUpdate=!1;_canCutCopyPaste=!1;resetSelectionModel=()=>{this.selectionModel.resetSelectionModel(),this.updateSelectionState()};updateSelectionState=e=>{this.forceUpdate(e)};SelectionMixinSelectAll=()=>{this.selectionModel.selectAll(this.getAllIds()),this.updateSelectionState()};SelectionMixinSetLead=e=>{this.selectionModel.setLeadIndex(e),this.updateSelectionState()};SelectionMixinSelectItem=(e,t,n,i,s)=>{this.selectionModel.setLeadIndex(e);const o=t;let a=this.selectionModel.isSelected(e);if(o||n)a=s||!a;else{if(s&&this.selectionModel.length>1)return;this.selectionModel.unSelectAll(),a=!0}if(n&&-1!==this.selectionModel.anchorIndex){const t=this.getSelectedIdsFromIdToAnchor(e);this.selectionModel.setSelectedIds(t)}else this.selectionModel.setIndexSelected(e,a);this.updateSelectionState()};getHeight=()=>this.state.height;getSelectedIdsFromIdToAnchor=e=>{const t=this.selectionModel.anchorIndex;return this.getIdsBetween(t,e)};_initializeSettings=e=>{e.settings&&(this._scrollTopSettings="SCROLL_TOP_"+e.settings,this._scrollTopNeedsUpdate=!0,this._searchStyleSettings="SEARCH_STYLE_"+e.settings,this._onRowsRenderedOptions="ON_ROWS_RENDERED_OPTIONS_"+e.settings)};_updateSelectionStateIfNeeded=e=>{if(e.settings){this._selectionSettings="SELECTION_"+e.settings;const t=Dn.Z.getSync(this._selectionSettings);if(t){const n=this.getSelectedItem();this.selectionModel.setData(t),this.updateSelectionState((()=>{const{onSelect:t}=e;if(t){const e=this.getSelectedItem();let i=-1;!e||n&&e.id===n.id?n&&(i=n.id):(i=e.id,t(e)),Is.nextTick((()=>{-1!==i&&this.scrollToId(i)}))}}))}else if(e.autoFocus&&e.nodes.length>0){const t=e.nodes[0];-1!==t.id&&Is.nextTick((()=>this.selectByNode(t)))}else this.resetSelectionModel()}};componentDidMount(){const{selectionStoreKey:e}=this.props;if(e){if(mt.Z.has(e))throw new Error(`Key ${e} has already been set in\n          SelectionStore. VivaldiTreeList expects instances using\n          selectionStoreKey props to be singleton.`);mt.Z.set(e,this.selectionModel)}this._initializeSettings(this.props),this._updateSelectionStateIfNeeded(this.props),this._isMounted=!0;const t=this.getWrapper();if(t){t.addEventListener("focus",this.onGotFocus,!0);const e=t.parentElement;e&&this.updateTreeSize(e.clientWidth,e.clientHeight)}}UNSAFE_componentWillReceiveProps(e){this.props.multiSelect!==e.multiSelect&&(this.selectionModel.multiSelect=Boolean(e.multiSelect));let t=this.state.expandModel;e.settings!==this.props.settings&&(this._initializeSettings(e),this._updateSelectionStateIfNeeded(e),this.updateScrollTop(),t=this.setupExpandModel(e)),e.nodes===this.props.nodes&&e.sorting===this.props.sorting||this.prepareDataForRender(e.nodes,t,e.sorting)}componentDidUpdate(e,t){if(this.state.renderArray.length===t.renderArray.length)this.rerenderVisibleTreeItems();else if(e.columns!==this.props.columns){(e.columns&&e.columns.flatMap((e=>e.id)).join())!==(this.props.columns&&this.props.columns.flatMap((e=>e.id)).join())&&this.rerenderVisibleTreeItems()}e.sorting?.sortOrder===this.props.sorting?.sortOrder&&e.sorting?.sortField===this.props.sorting?.sortField||this._scrollLeadNodeIntoView()}componentWillUnmount(){this.enableCutCopyPasteListeners(!1),this.stopInlineEditTimer(),this.resetAutoExpandTimer(),this._isMounted=!1;const e=this.getWrapper();e&&e.removeEventListener("focus",this.onGotFocus,!0);const{selectionStoreKey:t}=this.props;t&&mt.Z.get(t)===this.selectionModel&&mt.Z.delete(t)}getWrapper(){return this.refTreeListEntries.current?.Grid._scrollingContainer}focusTree=()=>{const e=this.getWrapper();e instanceof this.context.HTMLElement&&e.focus()};prepareDataForRender=(e,t,n)=>{const i=this.makeRenderArray(e,t,n);this.setState({renderArray:i,expandModel:t}),"function"==typeof this.props.rowHeight&&this.rerenderVisibleTreeItems()};setCutIds=e=>{this.props.setCutIds&&this.props.setCutIds(e)};onCut=e=>{if(e.preventDefault(),!this._canCutCopyPaste)return;const t=this.getAllSelectedItems();this.props.onCut?this.props.onCut(e,t):(this.setCutIds(t.map((e=>e.id))),this.setClipboard(e,t,!0))};onCopy=e=>{const{onCopy:t}=this.props;if(!this._canCutCopyPaste)return;const n=this.getAllSelectedItems();t?t(e,n):this.setClipboard(e,n,!1)};toggleSelectedExpansion=(e,t=!1)=>{this.stopInlineEditTimer();const n=e||this.selectionModel.leadIndex;if(-1===n)return;if(this.state.inlineEditId===n)return;const i=this.findTreeItem(n);i&&this.props.isFolder(i)&&this.toggleExpandModel(i,t&&this.props.hasChildren(i))};expand=e=>{const t=this.findTreeItem(e);t&&this.props.isFolder(t)&&this._setExpandState(t,!0)};pruneExpandModel=()=>{this.setState((e=>{const t={...e.expandModel},n=e=>{e.children&&(0===e.children.length&&this._isModelExpanded(e.id,t)&&this._setExpandModelElement(t,e.id,!1),e.children.forEach(n))};return this.props.nodes.forEach(n),{expandModel:t}}))};toggleExpandModel=(e,t)=>{const n=!this.isExpanded(e.id),i={...this.state.expandModel};if(t){const t=e=>this.props.isFolder(e)&&this.props.hasChildren(e)?e.children.flatMap(t).concat(e.id):[];t(e).forEach((e=>this._setExpandModelElement(i,e,n)))}else this._setExpandModelElement(i,e.id,n);this.saveExpandModel(i),this.prepareDataForRender(this.props.nodes,i,this.props.sorting)};_setExpandModelElement=(e,t,n)=>{if("expand"===this.props.folderMode)n?delete e[t]:e[t]=!1;else n?e[t]=!0:delete e[t]};saveExpandModel=e=>{if(this.props.settings){const t={};t["EXPAND_"+this.props.settings]=e,Dn.Z.set(t)}};saveSelectionModel=()=>{if(this.props.settings){const e={[this._selectionSettings]:this.selectionModel.getData()};Dn.Z.set(e)}};_getRenderIndex=e=>this.state.renderArray.findIndex((t=>t.node.id===e));_scrollLeadNodeIntoView=()=>{const e=this._getRenderIndex(this.selectionModel.leadIndex);e>=0&&this.scrollIntoView(e)};resetExpandModel=(e,t)=>{const n={},i=e=>{this.props.isFolder(e)&&(n[e.id]=t),this.props.hasChildren(e)&&e.children.forEach(i)};return"expand"===this.props.folderMode?t||e.forEach(i):t&&e.forEach(i),n};collapseAll=()=>{const e=this.findTreeItem(this.selectionModel.leadIndex);let t=e;for(;t&&void 0!==t.parentId&&t.parentId!==this.props.rootId;)t=this.findTreeItem(t.parentId);const n=this.resetExpandModel(this.props.nodes,!1);this.saveExpandModel(n),this.prepareDataForRender(this.props.nodes,n,this.props.sorting),t&&t!==e?this.selectByNode(t):this._scrollLeadNodeIntoView()};setupExpandModel=e=>{const{nodes:t,settings:n}=e,i=this.resetExpandModel(t,"expand"===this.props.folderMode);return n&&Object.assign(i,Dn.Z.getSync("EXPAND_"+n)),i};getExpandModel=()=>this.state.expandModel;expandWithModel=e=>{this.saveExpandModel(e),this.prepareDataForRender(this.props.nodes,e,this.props.sorting),this._scrollLeadNodeIntoView()};expandAll=()=>{this.expandAllExcept([])};expandAllExcept=e=>{const t=this.resetExpandModel(this.props.nodes,!0);e.forEach((e=>{this._setExpandModelElement(t,e,!1)})),this.saveExpandModel(t),this.prepareDataForRender(this.props.nodes,t,this.props.sorting),this._scrollLeadNodeIntoView()};isExpanded=e=>this._isModelExpanded(e,this.state.expandModel);onImport=()=>{this.props.onImport&&this.props.onImport()};setClipboard=(e,t,n)=>{const{clipboardData:i}=e,{getDragData:s,mimeType:o}=this.props;if(!o||!s||!i||this.props.disableClipboard)return;const a=t.map((e=>e.id));i.setData("vivaldi/x-cut",n.toString()),i.setData(o,JSON.stringify(a)),i.setData("text/plain",s("text/plain",a));const r=this.selectionModel.leadIndex;-1!==r&&i.setData("text/html",s("text/html",[r])),(0,ms.ZP)(e)};contextMenuSpy=e=>{this._canCutCopyPaste=!1;const t=this.getWrapper();let n=e.target;for(;n;){if(n===t){this._canCutCopyPaste=!0;break}n=n.parentNode}};keyDownSpy=e=>{this._canCutCopyPaste=!0};onPaste=e=>{if(e.preventDefault(),!this._canCutCopyPaste)return;const{mimeType:t,onPaste:n}=this.props;if(n){const t=this.getSelectedItem();return void(t&&n(e,t))}if(!t)return;const i=this.getTargetFromSelection(),s=e.clipboardData;if(!s)return;const o=-1!==s.types.findIndex((e=>e===t))?JSON.parse(s.getData(t)):[];if(0===o.length)return;if("true"===s.getData("vivaldi/x-cut")){if(!(this.props.cutIds&&this.props.cutIds.length>0)||!this.props.onMove)return;this.props.onMove(o,i,"on").then((e=>{const t=e??[];this.setCutIds([]),this.selectionModel.setSelectedIds(t);const{onSelect:n}=this.props;if(t.length>0&&n){const e=this.findTreeItem(t[0]);e&&n(e)}this.rerenderVisibleTreeItems()}))}else{const e=structuredClone(o.map((e=>this.findTreeItem(e))));this.props.onCreate&&this.props.onCreate(e,i.parentId,i.index,!1).then((e=>{const t=Array.isArray(e)?e:e?.items||[];Boolean(t)&&t.length>0&&(this.selectionModel.setSelectedIds(t.map((e=>e.id))),this.SelectionMixinSetLead(t[0].id),this.rerenderVisibleTreeItems())}))}};moveNode=(e,t)=>{const{onMove:n}=this.props;if(n&&this.canMoveUpDown(e,t)){const i={parentId:e.parentId,index:t?e.index-1:e.index+2,pageIndex:void 0},s=t?"above":"below";n([e.id],i,s)}};canMoveUpDown=(e,t)=>{if(!0===t&&0===e.index)return!1;if(!1===t){let t=0;if(e.parentId===this.props.rootId)t=this.props.nodes.length,t>0&&this._isTrashFolder(this.props.nodes[t-1])&&t--;else{const n=this.findTreeItem(e.parentId);n&&n.children&&(t=n.children.length)}if(e.index+1>=t)return!1}const n=!!this.props.sorting&&this.props.sorting.sortOrder!==ds.Z.NO_SORTING,i=!this.props.supportsUpDownMove||this.props.supportsUpDownMove(e,t);return!n&&i};getKeyEventMap=()=>({esc:this.onKeyEscUp,up:this.onKeyArrowUp,down:this.onKeyArrowDown,"alt+up":this.onKeyArrowUp,"alt+down":this.onKeyArrowDown,left:this._collapseFolderOrSelectParent,right:this._expandFolder,del:this.onKeyDelete,home:this.onKeyHome,end:this.onKeyEnd,pageup:this.onKeyPageUp,pagedown:this.onKeyPageDown,"shift+del":this.onKeyShiftDelete,"shift+up":this.onKeyArrowUp,"shift+down":this.onKeyArrowDown,"shift+home":this.onKeyHome,"shift+end":this.onKeyEnd,"shift+pageup":this.onKeyPageUp,"shift+pagedown":this.onKeyPageDown,"ctrl+a":this.onKeySelectAll,"ctrl+left":this._collapseFolderOrSelectParent,"ctrl+right":this._expandFolder,"ctrl+space":this.onKeyCtrlSpace,"ctrl+up":this.onKeyCtrlUp,"ctrl+down":this.onKeyCtrlDown});enableCutCopyPasteListeners=e=>{if(this._canCutCopyPaste=e,this._hasCutCopyPasteListeners!==e){this._hasCutCopyPasteListeners=e;const{document:t}=this.context;this._hasCutCopyPasteListeners?(t.addEventListener("cut",this.onCut),t.addEventListener("copy",this.onCopy),t.addEventListener("paste",this.onPaste),t.addEventListener("contextmenu",this.contextMenuSpy),t.addEventListener("keydown",this.keyDownSpy)):(t.removeEventListener("cut",this.onCut),t.removeEventListener("copy",this.onCopy),t.removeEventListener("paste",this.onPaste),t.removeEventListener("contextmenu",this.contextMenuSpy),t.removeEventListener("keydown",this.keyDownSpy))}};onLostFocus=()=>{this.stopInlineEditTimer(),this.enableCutCopyPasteListeners(!1),this.setState({hasFocus:!1})};onGotFocus=()=>{if(-1===this.state.inlineEditId){let e=this.getSelectedItem();e&&-1===this._getRenderIndex(e.id)&&(e=void 0),this.props.autoFocus&&!e&&this.state.renderArray.length>0&&this.selectByNode(this.state.renderArray[0].node),this.enableCutCopyPasteListeners(!0),this.setState({hasFocus:!0})}};scrollIntoView=e=>{this.refTreeListEntries.current?.scrollToRow(e)};setSelectedIds=e=>{this.selectionModel.resetSelectionModel(),this.selectionModel.selectAll(e),this.saveSelectionModel(),this.updateSelectionState()};selectByIndex=e=>{this.state.renderArray.length>e&&this.selectByNode(this.state.renderArray[e].node)};selectById=(e,t,n)=>{const i=this.props.onSelect?this.findTreeItem(e):{id:e};this.selectByNode(i,t,n)};selectByNode=(e,t,n)=>{const i=e?e.id:-1;this.props.onSelect&&(e&&this.selectionModel.FirstSingleItemSelected===e.id||this.props.onSelect(e)),n||(n=this._getRenderIndex(i)),-1!==n&&this.scrollIntoView(n),t?this.SelectionMixinSelectItem(i,t.ctrlKey,t.shiftKey,t.metaKey,"contextmenu"===t.type):this.SelectionMixinSelectItem(i),this.saveSelectionModel()};scrollToId=e=>{this.scrollIntoView(this._getRenderIndex(e))};onItemClick=(e,t)=>{t.stopPropagation(),this.props.onItemClick&&this.props.onItemClick(t,e)};onItemDoubleClick=(e,t)=>{const{onItemDoubleClick:n,overrideDoubleClick:i,isFolder:s}=this.props;if(this.stopInlineEditTimer(),n){!(i&&i(e))&&s(e)||n(t,e)}};onItemMouseDown=(e,t,n)=>{if(es.Z.isNavigationButton(n.button))return;const i=this.selectionModel.selectedIds;let s=!1;for(const t of i)if(t.id===e.id){s=!0;break}this.state.hasFocus&&s&&1===i.length&&n.button===es.Z.kLeft&&!(0,ps.Z)(n)&&n.target instanceof this.context.HTMLElement&&"title"===n.target.className&&n.timeStamp-this._leftMouseTimeStamp>300?this.startInlineEditTimerForId(e.id):this.stopInlineEditTimer();const o=n.ctrlKey;s&&!o||(s&&o&&1===i.length?this.unSelectAll():this.selectByNode(e,n)),"function"==typeof this.props.onItemMouseDown&&this.props.onItemMouseDown(e,n),n.button===es.Z.kLeft&&(this._leftMouseTimeStamp=n.timeStamp),t&&this.focusTree()};onItemMouseUp=(e,t)=>{if(es.Z.isNavigationButton(t.button))return;const n=this.selectionModel.selectedIds,i=t.ctrlKey;n.length>1&&t.button!==es.Z.kRight&&!i&&this.selectByNode(e,t),this.props.onItemMouseUp?.(e,t)};onContextMenuOpen=(e,t)=>{t&&this.scrollIntoView(this._getRenderIndex(t.id))};rerenderVisibleTreeItems=()=>{this.refTreeListEntries.current?.recomputeRowHeights()};getParentAndIndex=(e,t)=>{let n,i;if(e)if(this.props.isFolder(e))n=e.id,!this.isExpanded(e.id)&&t&&this.toggleExpandModel(e);else{n=e.parentId;const{id:t}=e;if(n===this.props.rootId)this.props.nodes&&(i=this.props.nodes.findIndex((e=>e.id===t))+1);else{const e=this.findTreeItem(n);e&&e.children&&(i=e.children.findIndex((e=>e.id===t))+1)}}else n=this.props.rootId;return{parentId:n,index:i,pageIndex:void 0}};getTargetFromSelection=()=>{const e=this.selectionModel.FirstSingleItemSelected;let t;return e&&-1!==e&&(t=this.findTreeItem(e),this.props.isValidAddTarget&&!this.props.isValidAddTarget(t)&&(t=void 0)),this.getParentAndIndex(t,!0)};onAdd=async(e,t)=>{const n=this.props.buildItem?this.props.buildItem(e,t):{...t,children:"folder"===e?[]:void 0,separator:"separator"===e},{parentId:i,index:s}=this.getTargetFromSelection();if(!this.props.onCreate)return;const o=await this.props.onCreate([n],i,s,!0);if(!o)return;const a=Array.isArray(o)?o:o.items,r=Boolean(!Array.isArray(o)&&o.props?.edit);if(1!==a.length)return;const[l]=a;this.getSelectedId()!==l.id&&this.selectByNode(l),r&&this.startInlineEdit(l.id)};onSave=()=>{const{onSave:e}=this.props;e&&e(this.getAllSelectedItems().map((e=>e.id)))};onSaveAll=()=>{this.props.onSave&&this.props.onSave([])};onExport=()=>{const{onExport:e}=this.props;e&&e(this.getAllSelectedItems().map((e=>e.id)))};onExportAll=()=>{this.props.onExport&&this.props.onExport([])};onDelete=e=>{let t=this.getAllSelectedItems().map((e=>e.id));if(this.props.validateForDeletion&&(t=this.props.validateForDeletion(t)),t.length>0){if(!this.props.confirmDelete)return this.onDeleteItems(t,e);this.props.confirmDelete(t).then((n=>{if(n)return this.onDeleteItems(t,e)}))}return Promise.resolve()};onDeleteItems=async(e,t)=>{const n=this.props.delete;if(!n||!e.length)return;let i;for(const e of this.selectionModel.selectedIds){const t=this._getRenderIndex(e.id);(!i||t<i)&&(i=t)}i=i??0;const s=this.state.renderArray[i].node;let o=void 0!==s.parentId?this.findTreeItem(s.parentId):void 0;const a=e=>{this.selectByNode(e),e&&this.props.activateAfterDelete&&this.props.activateAfterDelete(e)};try{await n(e,t)}catch{}if(this.props.disableSelectAfterDelete)return;const r=this.state.renderArray.filter((t=>!e.includes(t.node.id)));if(0===r.length)a(void 0);else if(o){if(this.props.hasChildren(o)&&o?.children){let t=o.children;t=t.filter((t=>!e.includes(t.id))),t=this.sortItems(t,this.props.sorting),o={...o,children:t}}if(this.props.hasChildren(o)&&o?.children){const e=o.children;if(1===e.length)a(e[0]);else{const t=e[0],n=e[e.length-1],s=this._getRenderIndex(t.id),o=this._getRenderIndex(n.id);if(i<=s)a(t);else if(i>=o)a(n);else{let t=0;if(o-s+1>e.length){const e=i-s;for(let n=0;n<e;n++){const e=r[s+n].node;this.props.hasChildren(e)&&this.isExpanded(e.id)&&(t-=e.children.length)}}a(e[i-s+t])}}}else a(o)}else{let e=this.state.renderArray.filter((e=>e.node.parentId===this.props.rootId||this._isTrashFolder(e.node)));const t=e.findIndex((e=>e.node.id===s.id));if(t>=0){e=r.filter((e=>e.node.parentId===this.props.rootId||this._isTrashFolder(e.node)));const n=e.length-1;a(e[Math.min(t,n)].node)}else{const e=r.length-1;a(r[Math.min(i,e)].node)}}};onKeyCtrlUp=qi.throttleSync((e=>{const t=this.selectionModel.leadIndex,n=this._getRenderIndex(t);if(0===n)return;const i=-1===n?this.state.renderArray.length-1:n-1;if(i<0)return;const s=this.state.renderArray[i].node;this.SelectionMixinSetLead(s.id),this.scrollIntoView(i)}));onKeyCtrlDown=qi.throttleSync((e=>{const t=this.selectionModel.leadIndex,n=this._getRenderIndex(t);if(n===this.state.renderArray.length-1)return;const i=n+1,s=this.state.renderArray[i].node;this.SelectionMixinSetLead(s.id),this.scrollIntoView(i)}));onKeyArrowDown=qi.throttleSync((e=>{const t=this.selectionModel.leadIndex,n=this._getRenderIndex(t);if(n!==this.state.renderArray.length-1){if(!0===e.altKey)this.moveNode(this.state.renderArray[n].node,!1);else{const t=n+1,i=this.state.renderArray[t].node;this.selectByNode(i,e,t)}e.preventDefault(),e.stopPropagation()}}));onKeyArrowUp=qi.throttleSync((e=>{const t=this.selectionModel.leadIndex,n=this._getRenderIndex(t);if(0!==n){if(!0===e.altKey)this.moveNode(this.state.renderArray[n].node,!0);else{const t=-1===n?this.state.renderArray.length-1:n-1;if(t<0)return;const i=this.state.renderArray[t].node;this.selectByNode(i,e,t)}e.preventDefault(),e.stopPropagation()}}));onKeyEscUp=e=>{this.selectionModel.setSelectedIds([])};onKeyHome=e=>{const t=this.state.renderArray[0].node;this.selectByNode(t,e,0),e.preventDefault(),e.stopPropagation()};onKeyEnd=e=>{const t=this.state.renderArray.length,n=this.state.renderArray[t-1].node;this.selectByNode(n,e,t-1),e.preventDefault(),e.stopPropagation()};onKeyPageDown=qi.throttleSync((e=>{const t=this.selectionModel.leadIndex,n=this._getRenderIndex(t),i=this.state.renderArray.length;let s=this.state.height,o=n;for(;o<i-1;){const e="function"==typeof this.props.rowHeight?this.props.rowHeight({index:o}):this.props.rowHeight||24;if(!(s>=e))break;s-=e,o++}if(o===n)return;const a=this.state.renderArray[o].node;this.selectByNode(a,e,o),e.preventDefault(),e.stopPropagation()}));onKeyPageUp=qi.throttleSync((e=>{const t=this.selectionModel.leadIndex,n=this._getRenderIndex(t);let i=this.state.height,s=n;for(;s>0;){const e="function"==typeof this.props.rowHeight?this.props.rowHeight({index:s}):this.props.rowHeight||24;if(!(i>=e))break;i-=e,s--}if(s===n)return;const o=this.state.renderArray[s].node;this.selectByNode(o,e,s),e.preventDefault(),e.stopPropagation()}));handleKeyDelete=(e,t)=>{this.onDelete(t),e.preventDefault(),e.stopPropagation()};onKeyShiftDelete=e=>{this.handleKeyDelete(e,!0)};onKeyDelete=e=>{this.handleKeyDelete(e,!1)};onKeySelectAll=()=>{this.SelectionMixinSelectAll(),this.saveSelectionModel()};onKeyCtrlSpace=e=>{const t=this.selectionModel.leadIndex;this.SelectionMixinSelectItem(t,e.ctrlKey,e.shiftKey,e.metaKey,"contextmenu"===e.type)};_setExpandState=(e,t)=>{t!==this.isExpanded(e.id)&&this.toggleExpandModel(e)};_collapseFolderOrSelectParent=e=>{const t=this.findTreeItem(this.getSelectedId());if(t)if(this._isFolderWithChildren(t)&&this.isExpanded(t.id))this._setExpandState(t,!1);else{const e=this.findTreeItem(t.parentId);e&&this.selectByNode(e)}e.preventDefault(),e.stopPropagation()};expandToId=e=>{let t=this.findTreeItem(e);for(;t;)t=this.findTreeItem(t.parentId),t&&this.isFolder(t)&&this._setExpandState(t,!0)};_expandFolder=e=>{const t=this.findTreeItem(this.getSelectedId());t&&this._isFolderWithChildren(t)&&this._setExpandState(t,!0),e.preventDefault(),e.stopPropagation()};unSelectAll=()=>{this.selectByNode(void 0)};isItemLead=e=>e===this.selectionModel.leadIndex;isItemSelected=e=>this.selectionModel.isSelected(e);supportDropForItem=(e,t)=>this.props.getDropSupport?this.props.getDropSupport(e,t):{available:!1,onto:!1,edge:"none"};onDragLeaveItem=(e,t)=>{this.cancelDragOverObject(),this.resetAutoExpandTimer()};onDragOverItem=(e,t,n,i)=>{const s=i.currentTarget;if(!this.supportDropForItem(e,i).available)return;const o=s.getBoundingClientRect(),a="function"==typeof this.props.rowHeight?this.props.rowHeight({index:t}):this.props.rowHeight||24,r=(i.clientY-o.top)/a;let l="";const d="both"===n.edge||"above"===n.edge,c="both"===n.edge||"below"===n.edge;!0===n.onto?l=r<=.25?d?"above":"on":r>.75&&c?"below":"on":r<=.5&&d?l="above":r>.5&&c&&(l="below"),(this.state.dragOverObj.id!==e.id||this.state.dragOverObj.id===e.id&&this.state.dragOverObj.position!==l)&&this.setState({dragOverObj:{id:e.id,position:l}},this.initAutoExpandTimer(e,l))};initAutoExpandTimer=(e,t)=>{this.isExpanded(e.id)||!this.props.isFolder(e)||"on"!==t?this.resetAutoExpandTimer():this.#l?.id!==e.id&&(this.resetAutoExpandTimer(),this.#l=e,this.expandTimer=setTimeout(this.onAutoExpandTimer,1200))};resetAutoExpandTimer=()=>{this.expandTimer&&(clearTimeout(this.expandTimer),delete this.expandTimer,this.#l=void 0)};onAutoExpandTimer=()=>{void 0!==this.#l&&(this.state.dragOverObj.id===this.#l&&"on"===this.state.dragOverObj.position&&this.toggleExpandModel(this.#l),this.resetAutoExpandTimer())};onDragEmptyArea=e=>{if(this.state.renderArray.length>0){const t=this.state.renderArray[this.state.renderArray.length-1].node;this._dropSupport=this.supportDropForItem(t,e),this._dropSupport.available&&"none"!==this._dropSupport.edge&&(e.preventDefault(),e.nativeEvent.dataTransfer.dropEffect="move",this.state.dragOverObj.id!==t.id&&"below"!==this.state.dragOverObj.position&&this.setState({dragOverObj:{id:t.id,position:"below"}}))}e.stopPropagation()};onDropEmptyArea=e=>{if(this.resetAutoExpandTimer(),this.state.renderArray.length>0&&this._dropSupport.available){const t=this.state.renderArray[this.state.renderArray.length-1].node;this.onDrop(t,this._dropSupport,e),this._dropSupport={available:!1,onto:!1,edge:"none"}}e.preventDefault(),e.stopPropagation()};onDrop=(e,t,n)=>{this.resetAutoExpandTimer();const i=zi.ZP.isCopyModifierPressed(n),s=this.state.dragOverObj.position,{mimeType:o}=this.props;switch(s){case"above":if("both"!==t.edge&&"above"!==t.edge)return void this.cancelDragOverObject();break;case"below":if("both"!==t.edge&&"below"!==t.edge)return void this.cancelDragOverObject();break;case"on":if(!1===t.onto)return void this.cancelDragOverObject();break;default:return void this.cancelDragOverObject()}let a;if(o&&n.dataTransfer&&-1!==n.dataTransfer.types.findIndex((e=>e===o))?a=JSON.parse(n.dataTransfer.getData(o)):this.props.onDrop&&this.props.onDrop(n,e,s).then((e=>{this.cancelDragOverObject(),e&&e.length>0&&this.selectByNode(e[0])})),!a||a.length<=0)return void this.cancelDragOverObject();const r=this.props.isFolder(e);let l=!1,d={index:0,parentId:void 0,pageIndex:void 0};this.props.getTargetSpec?d=this.props.getTargetSpec(e,s):"above"===s?(d.index=parseInt(e.index),d.parentId=e.parentId):"on"===s?d.parentId=r?e.id:e.parentId:"below"===s&&(r&&this.isExpanded(e.id)?d.parentId=e.id:(d.index=parseInt(e.index)+1,d.parentId=e.parentId));const c=a.map((t=>{if(t===e.id)return void(l=!0);const n=this.findTreeItem(t);if(i||!this.props.isFolder(n)||!n||!this.findItemInFolder(n,e.id))return n;l=!0})).filter((e=>null!==e));if(l||c.length<=0)this.cancelDragOverObject();else if(i){const e=structuredClone(c);this.props.onCreate&&this.props.onCreate(e,d.parentId,d.index,!1).then(this.cancelDragOverObject())}else{const e=c.map((e=>e.id));this.props.onMove?.(e,d,s).then((()=>{this.cancelDragOverObject()}))}};cancelDragOverObject=()=>{this.setState({dragOverObj:this.emptyDragOverObj})};onDragEndItem=()=>{this.cancelDragOverObject()};onItemDragStart=e=>{this.stopInlineEditTimer(),this.props.onItemDragStart&&this.props.enableDragAndDrop&&this.props.onItemDragStart(e)};onCompositionStart=()=>{this._isComposing=!0};onCompositionEnd=()=>{this._isComposing=!1};onKeyDown=async e=>{const{ctrlKey:t,altKey:n,shiftKey:i,metaKey:s}=e,o={ctrlKey:t,altKey:n,shiftKey:i,metaKey:s},a=(0,As.VV)(o);if(this.stopInlineEditTimer(),-1!==this.state.inlineEditId)return void("Escape"===e.key&&a?(e.preventDefault(),await this.cancelInlineEdit(),this.focusTree()):"Enter"!==e.key||this._isComposing?e.key===Es&&e.preventDefault():(e.preventDefault(),await this.saveInlineEdit(),this.focusTree()));if("Escape"===e.key&&a)this.setCutIds([]),e.preventDefault();else if("\\"===e.key&&a&&this.props.supportsCollapseAll)this.collapseAll();else if(this.props.supportsInlineEdit&&e.key===Es){const t=!0===this.props.supportsInlineEdit?this.getSelectedItem():void 0;if(t){return void(this.startInlineEdit(t.id)&&e.preventDefault())}}let r=!1;if(this.props.onItemsActivated&&"Enter"===e.key){if(!1===e.repeat){const t=this.getAllSelectedItems();t&&this.props.onItemsActivated&&this.props.onItemsActivated(e,t,!0)}r=!0,e.preventDefault()}const l=Ke.Z.keyComboFromEvent(e.nativeEvent),d=this.getKeyEventMap()[l];d&&d(e.nativeEvent),!r&&this.props.onKeyDown&&this.props.onKeyDown(e)};startInlineEditTimerForId=e=>{this.stopInlineEditTimer(),!0===this.props.supportsInlineEdit&&(this.inlineEditTimeoutId=setTimeout(this.startInlineEdit.bind(this,e),700))};stopInlineEditTimer=()=>{clearTimeout(this.inlineEditTimeoutId),delete this.inlineEditTimeoutId};startInlineEditForSelectedItem=()=>{const e=this.selectionModel.FirstSingleItemSelected;-1!==e&&this.startInlineEdit(e)};startInlineEdit=e=>{const t=this.selectionModel.selectedIds;if(1===t.length&&t[0].id===e){const t=this.state.renderArray.filter((t=>t.node.id===e));if(1===t.length&&this.props.isValidToEdit?.(t[0].node.id))return this.setState({inlineEditId:e,inlineEditText:this.props.getTitle?this.props.getTitle(e):""}),!0}return!1};getInlineEditId=()=>-1===this.state.inlineEditId?void 0:this.state.inlineEditId;setInlineEditText=e=>{const t=e.target.value;this.setState({inlineEditText:t})};cancelInlineEdit=()=>new Promise((e=>{this.setState({inlineEditId:-1,inlineEditText:""},e)}));saveInlineEdit=()=>new Promise(((e,t)=>{if(-1===this.state.inlineEditId||!this.props.saveTitle)return t();this.props.saveTitle(this.state.inlineEditId,this.state.inlineEditText),this.setState({inlineEditId:-1,inlineEditText:""},e)}));onRowsRendered=e=>{this._onRowsRenderedOptions&&Dn.Z.set({[this._onRowsRenderedOptions]:e}),this.props.onRowsRendered&&this.props.onRowsRendered(e),this.updateScrollTop()};updateScrollTop=()=>{if(this._scrollTopNeedsUpdate){this._scrollTopNeedsUpdate=!1;const e=Dn.Z.getSync(this._scrollTopSettings);this.refTreeListEntries.current?.scrollToPosition(e)}};onScroll=(0,Ae.Z)((e=>{if(!this._isMounted)return;const{scrollTop:t}=e;this._scrollTopSettings&&Dn.Z.set({[this._scrollTopSettings]:t}),this.props.onScroll&&this.props.onScroll(e)}),200);getVisibleNodes=()=>{const e=Dn.Z.getSync(this._onRowsRenderedOptions);if(e){const{overscanStartIndex:t,overscanStopIndex:n}=e;return this.state.renderArray.slice(t,n+1)}return[]};getSelectedItem=()=>this.findTreeItem(this.selectionModel.leadIndex);getSelectedId=()=>this.selectionModel.FirstSingleItemSelected;isFolder=e=>Boolean(e&&this.props.isFolder(e));_isTrashFolder=e=>this.props.isTrashFolder?this.props.isTrashFolder(e):!0===e.trash;_isFolderWithChildren=e=>e.children&&e.children.length>0;_isModelExpanded=(e,t)=>"0"===e||!0===t[e]||"expand"===this.props.folderMode&&void 0===t[e];makeRenderArray=(e,t,n)=>{let i=[];if(!e||0===e.length)return i;e=this.sortItems(e,n);const s=n&&n.sortOrder!==ds.Z.NO_SORTING,o=(e,n,a)=>{if(!(s&&this.props.isSeparator&&this.props.isSeparator(e)))if(a&&i.some((t=>t.node===e)))console.error("Trees should be acyclic",{node:e});else if(i.push({node:e,level:n}),this.props.hasChildren(e)&&this._isModelExpanded(e.id,t))for(const t of e.children)o(t,n+1,a)};try{for(const t of e)o(t,0,!1)}catch(t){i=[];for(const t of e)o(t,0,!0)}return i};canSort=e=>Boolean(e&&e.sortOrder&&e.sortOrder!==ds.Z.NO_SORTING);sortItems=(e,t)=>{if(!t||!this.canSort(t)||t?.onlyScroll)return e;!1!==this.props.supportsDeepCopy&&(e=structuredClone(e));const n=t.comparator||ds.Z.getDefaultComparator(t.sortOrder,t.sortField);return ds.Z.treeSort(e,n),e};getSelectedFromTree=()=>{const e=[],t=this,n=function(i){for(let s=0;s<i.length;s++){const o=i[s];t.selectionModel.isSelected(o.id)?e.push(o):o.children&&n(o.children)}};return n(this.props.nodes),e};getAllSelectedItems=()=>{const e=this.selectionModel.selectedIds;if(0===e.length)return e;if(e.length>1&&!this.canSort(this.props.sorting))return this.getSelectedFromTree();const t=function(e,n){for(let i=0;i<e.length;i++){let s=e[i];if(s.id===n)return s;if(s.children&&(s=t(s.children,n),s))return s}},n=e.map((e=>t(this.props.nodes,e.id))).filter((e=>void 0!==e));return this.sortItems(n,this.props.sorting)};getSelectedCount=()=>this.selectionModel.selectedIds.length;findTreeItem=e=>{function t(n){if(n.id===e)return n;if(n.children)for(let e=0;e<n.children.length;e++){const i=t(n.children[e]);if(i)return i}}for(let e=0;e<this.props.nodes.length;e++){const n=t(this.props.nodes[e]);if(n)return n}return null};findItemInFolder=(e,t)=>{let n=null;const i=e=>{if(e.id===t)return n=e;e.children&&e.children.forEach(i)};return e.children.forEach(i),n};getIdsBetween=(e,t)=>{const n=this._getRenderIndex(e),i=this._getRenderIndex(t);let s=[];return s=n>i?this.state.renderArray.slice(i,n+1):this.state.renderArray.slice(n,i+1),s.map((e=>e.node.id))};getAllIds=()=>this.state.renderArray.map(((e,t)=>e.node.id||t));getRenderArray=()=>this.state.renderArray;getId=e=>this.state.renderArray[e].node.id||e;getSearchStyle=()=>"flat"===Dn.Z.getSync(this._searchStyleSettings)?"flat":"tree";setSearchStyle=e=>{const t={};t[this._searchStyleSettings]=e,Dn.Z.set(t,(()=>{this.props.onSearchStyleChanged&&this.props.onSearchStyleChanged(e)}))};getNamedContextMenuItems=(e,t)=>{const n=this.context.vivaldiWindowId,i=ji.Z.getOptionFunction(e.name),{document:s}=this.context,o={selectedCount:this.getSelectedCount(),...e.getState?e.getState(t):{}};return ji.Z.getNamedMenu(n,e.name,(async a=>{switch(a.action){case"CONTEXT_EXPAND_ALL":return{handler:this.expandAll,isVisible:()=>e.getVisibility(a,t),...i(n,a,o)};case"CONTEXT_COLLAPSE_ALL":return{handler:this.collapseAll,...i(n,a,o),isVisible:()=>e.getVisibility(a,t)};case"CONTEXT_NEW_ITEM":return{handler:()=>{this.onAdd("item")},isVisible:()=>e.getVisibility(a,t),...i(n,a,o)};case"CONTEXT_NEW_FOLDER":return{handler:()=>{this.onAdd("folder")},isVisible:()=>e.getVisibility(a,t),...i(n,a,o)};case"CONTEXT_NEW_SEPARATOR":return{handler:()=>{this.onAdd("separator")},isVisible:()=>e.getVisibility(a,t),...i(n,a,o)};case"CONTEXT_EDIT":return{handler:()=>{this.props.onEdit?.()},isVisible:()=>e.getVisibility(a,t)&&"function"==typeof this.props.onEdit,...i(n,a,o)};case"CONTEXT_RENAME":return{handler:()=>{this.startInlineEditForSelectedItem()},isVisible:()=>e.getVisibility(a,t),...i(n,a,o),shortcuts:[Es]};case"CONTEXT_CUT":return{handler:()=>{s.execCommand("cut")},isVisible:()=>e.getVisibility(a,t),...i(n,a,o),shortcuts:["ctrl+x"]};case"CONTEXT_COPY":return{handler:()=>{s.execCommand("copy")},isVisible:()=>e.getVisibility(a,t),...i(n,a,o),shortcuts:["ctrl+c"]};case"CONTEXT_PASTE":return{handler:()=>{s.execCommand("paste")},isVisible:()=>e.getVisibility(a,t),...i(n,a,o),shortcuts:["ctrl+v"]};case"CONTEXT_SAVE":return{handler:()=>{this.onSave()},isVisible:()=>e.getVisibility(a,t),...i(n,a,o)};case"CONTEXT_SAVE_ALL":return{handler:()=>{this.onSaveAll()},isVisible:()=>e.getVisibility(a,t),...i(n,a,o)};case"CONTEXT_EXPORT":return{handler:()=>{this.onExport()},isVisible:()=>e.getVisibility(a,t),...i(n,a,o)};case"CONTEXT_EXPORT_ALL":return{handler:()=>{this.onExportAll()},isVisible:()=>e.getVisibility(a,t),...i(n,a,o)};case"CONTEXT_DELETE":return{handler:()=>{this.onDelete(!1)},isVisible:()=>e.getVisibility(a,t),...i(n,a,o),shortcuts:["delete"]};case"CONTEXT_IMPORT":return{handler:()=>{this.onImport()},isVisible:()=>e.getVisibility(a,t),...i(n,a,o)};case"CONTEXT_CONTAINER_SEARCH":{const s=this.getSearchStyle();return{items:[{type:"radio",radiogroup:1,checked:"flat"===s,handler:this.setSearchStyle.bind(this,"flat"),...(0,us.Z)("Flat Search")},{type:"radio",radiogroup:1,checked:"tree"===s,handler:this.setSearchStyle.bind(this,"tree"),...(0,us.Z)("Tree Search")}],isVisible:()=>e.getVisibility(a,t),...i(n,a,o)}}default:return e.getCapability(a,i,t,o)}}))};getContextMenuItemsPromise=e=>this.props.getContextMenuItemsPromise?this.props.getContextMenuItemsPromise(e).then((t=>this.appendStandardMenuItems(e,t))):Promise.resolve([]);getContextMenuItems=e=>{if(!0===this.props.appendContextItems){let t=this.appendStandardMenuItems(e,[]);const n=this.props.getContextMenuItems?this.props.getContextMenuItems(e):[];return t.length>0&&n.length>0&&(t=t.concat([Qe.Z.separatorItem]),t=t.concat(n)),t}{const t=this.props.getContextMenuItems?this.props.getContextMenuItems(e):[];return this.appendStandardMenuItems(e,t)}};appendStandardMenuItems=(e,t)=>{const n=this.props.getContextMenuItemProps?this.props.getContextMenuItemProps(e):{},i=()=>{t.length>0&&t.push(Qe.Z.separatorItem)};if((n.showNewItem||n.showNewFolder||n.showNewSeparator||n.showEdit||n.showMoveUp||n.showMoveDown||n.showRename)&&(i(),n.showNewItem&&t.push({handler:()=>{this.onAdd("item")},isVisible:()=>n.showNewItem,...this.props.getContextMenuNewItemString?this.props.getContextMenuNewItemString():Qe.Z.makeLabelPair("")}),n.showNewFolder&&t.push({handler:()=>{this.onAdd("folder")},isVisible:()=>n.showNewFolder,...(0,us.Z)("command","New Folder")}),n.showNewSeparator&&t.push({handler:()=>{this.onAdd("separator")},isVisible:()=>n.showNewSeparator,...(0,us.Z)("New Separator")}),(n.showEdit||n.showRename)&&i(),n.showEdit&&t.push({handler:()=>{this.props.onEdit&&this.props.onEdit()},isVisible:()=>n.showEdit,...(0,us.Z)("verb","Edit")}),n.showRename&&t.push({handler:()=>this.startInlineEditForSelectedItem(),isVisible:()=>n.showRename,shortcuts:[Es],...(0,us.Z)("Rename")}),(n.showMoveUp||n.showMoveDown)&&(i(),t.push({handler:()=>{const e=this.getSelectedItem();e&&this.moveNode(e,!0)},isVisible:()=>n.showMoveUp,shortcuts:["alt+up"],...(0,us.Z)("Move Up")}),t.push({handler:()=>{const e=this.getSelectedItem();e&&this.moveNode(e,!1)},isVisible:()=>n.showMoveDown,shortcuts:["alt+down"],...(0,us.Z)("Move Down")}))),n.showCut||n.showCopy||n.showPaste){i();const{document:e}=this.context,s=[{handler:()=>{e.execCommand("cut")},isVisible:()=>!0===n.showCut,shortcuts:["ctrl+x"],...(0,us.Z)("verb","Cut")},{handler:()=>{e.execCommand("copy")},isVisible:()=>!0===n.showCopy,shortcuts:["ctrl+c"],...this.props.getContextMenuCopyString?this.props.getContextMenuCopyString():(0,us.Z)("verb","Copy")},{handler:()=>{e.execCommand("paste")},shortcuts:["ctrl+v"],isVisible:()=>!0===n.showPaste,...(0,us.Z)("verb","Paste")}];t=t.concat(s)}if((n.showSave||n.showSaveAll)&&(i(),n.showSave&&(t=t.concat([{handler:()=>{this.onSave()},...this.props.getContextMenuSaveString?this.props.getContextMenuSaveString():(0,us.Z)("verb","Save")}])),n.showSaveAll&&(t=t.concat([{handler:()=>{this.onSaveAll()},...this.props.getContextMenuSaveAllString?this.props.getContextMenuSaveAllString():(0,us.Z)("verb","Save All")}]))),(n.showExport||n.showExportAll)&&(i(),n.showExport&&(t=t.concat([{handler:()=>{this.onExport()},...this.props.getContextMenuExportString?this.props.getContextMenuExportString():(0,us.Z)("verb","Export")}])),n.showExportAll&&(t=t.concat([{handler:()=>{this.onExportAll()},...this.props.getContextMenuExportAllString?this.props.getContextMenuExportAllString():(0,us.Z)("verb","Export All")}]))),n.showDelete&&(i(),t.push({handler:()=>{this.onDelete(!1)},shortcuts:["delete"],...this.props.getContextMenuDeleteString?this.props.getContextMenuDeleteString():(0,us.Z)("verb","Delete")})),n.showExpandCollapse){i();const e=[{handler:this.expandAll,...(0,us.Z)("Expand All Folders")},{handler:this.collapseAll,...(0,us.Z)("Collapse All Folders")}];t=t.concat(e)}if(n.showImport&&(i(),t.push({handler:this.onImport,ellipsis:!0,...this.props.getContextMenuImportString?this.props.getContextMenuImportString():(0,us.Z)("Import")})),n.showSettings){i();const e=this.getSearchStyle(),n=[{type:"checkbox",checked:"flat"===e,handler:this.setSearchStyle.bind(this,"flat"),...(0,us.Z)("Flat Search")},{type:"checkbox",checked:"tree"===e,handler:this.setSearchStyle.bind(this,"tree"),...(0,us.Z)("Tree Search")}];t=t.concat([{items:n,...(0,us.Z)("Settings")}])}if(n.showCustomSettings&&(i(),this.props.addCustomSettingMenu&&(t=t.concat([this.props.addCustomSettingMenu()]))),n.showFullscreen){i();const e=[{handler:()=>xi.Z.toggleFullscreen(this.context.vivaldiWindowId),...(0,us.Z)("Fullscreen")}];t=t.concat(e)}return t};onResize=e=>{const t=e[0].contentRect;this.updateTreeSize(Math.ceil(t.width),Math.ceil(t.height))};updateTreeSize=(e,t)=>{this._isMounted&&this.setState({width:e,height:t})};onContextMenu=async e=>{let t;if(e?.button>0&&e.currentTarget?.className?.includes("vivaldi-tree")||(t=this.getSelectedItem()),this.props.menu)return e.persist(),e.preventDefault(),e.stopPropagation(),void(this.props.menu&&this.getNamedContextMenuItems(this.props.menu,t).then((n=>{(0,cs.Z)(this.context,n,(n=>{n&&this.onContextMenuOpen(e,t)}))(e)})));let n;e.preventDefault(),e.stopPropagation(),this.props.getContextMenuItemsPromise?(e.persist(),n=await this.getContextMenuItemsPromise(t)):n=this.getContextMenuItems(t),(0,cs.Z)(this.context,n,(n=>{n&&this.onContextMenuOpen(e,t)}))(e)};renderTreeItem=e=>{const{index:t,style:n}=e,i=this.state.renderArray[t].node;void 0===i.id&&(i.id=t);const s=this.selectionModel.isSelected(i.id),o=this.state.renderArray[t-1]?.node.id,a=this.state.renderArray[t+1]?.node.id,r=t>=0&&o&&this.selectionModel.isSelected(o),l=a&&this.selectionModel.isSelected(a),d=this.selectionModel.leadIndex===i.id,c=this.props.cutIds&&this.props.cutIds.indexOf(i.id)>-1,u=!!i.children?.length&&this.isExpanded(i.id);let p=!1;!0===s&&(p=this.state.hasFocus||i.id===this.state.inlineEditId);let h=this.props.enableDragAndDrop&&this.state.inlineEditId!==i.id;h&&this.props.isValidDragSource&&(h=this.props.isValidDragSource(i));const g=this.state.inlineEditId===i.id?this.state.inlineEditText:void 0,m=this.state.renderArray[t].level,f=this.state.renderArray[t+1]?.level??0,v={node:i,level:m,isExpanded:u,isSelected:s,inlineEditText:g,onChange:this.setInlineEditText,isLastChild:m>0&&0===f||this.isFolder(i)&&0===m&&!u,onFocus:_s,onBlur:this.saveInlineEdit},{rowComponent:y,getRowComponentProps:b}=this.props,S=b?b(v):v;return Ts(ls,{index:t,Component:y,componentProps:S,treeItem:i,style:n,overrideDoubleClick:this.props.overrideDoubleClick,isExpanded:u,isSeparator:this.props.isSeparator,toggleExpandModel:this.toggleExpandModel,onContextMenu:this.onContextMenu,onMouseDown:this.onItemMouseDown,onMouseUp:this.onItemMouseUp,selected:s,isFirstSelected:s&&!r,isLastSelected:s&&!l,hasFocus:p,lead:d,isCut:c,validateForDrag:this.props.validateForDrag,onDragStart:this.onItemDragStart,supportDrop:this.props.enableDragAndDrop?this.supportDropForItem:null,onDragLeave:this.props.enableDragAndDrop?this.onDragLeaveItem:null,onDragOver:this.props.enableDragAndDrop?this.onDragOverItem:null,onDragEnd:this.onDragEndItem,onDrop:this.onDrop,mimeType:this.props.mimeType,getDragData:this.props.getDragData,setCustomEventBehavior:this.props.setCustomEventBehavior,dragover:this.state.dragOverObj.id===i.id,dragOverObj:this.state.dragOverObj,inlineEditText:g,getAllSelectedItems:this.getAllSelectedItems,isFolder:this.props.isFolder,isDraggable:h,hasChildren:this.props.hasChildren,onItemClick:this.onItemClick,onItemDoubleClick:this.onItemDoubleClick,enableDragAndDrop:this.props.enableDragAndDrop,disableMousePointersOverride:this.props.disableMousePointersOverride},t)};getStyle=gs()((e=>({"--gridColumns":e&&bs(e)})));render(){const e=Fi()(this.props.className,{"vivaldi-tree":!this.props.className,"no-selection":-1===this.selectionModel.anchorIndex}),t=Zs();return Ts(Yi.Z,{style:this.getStyle(this.props.columns),className:e,onBlur:this.onLostFocus,onKeyDown:this.onKeyDown,onDragOver:this.props.enableDragAndDrop?this.onDragEmptyArea:void 0,onDragLeave:this.props.enableDragAndDrop?this.cancelDragOverObject:void 0,onDrop:this.props.enableDragAndDrop?this.onDropEmptyArea:void 0,onClick:this.unSelectAll,onCompositionStart:this.onCompositionStart,onCompositionUpdate:this.onCompositionStart,onCompositionEnd:this.onCompositionEnd,onContextMenu:this.onContextMenu,onResize:this.onResize},void 0,(0,ss.jsx)(ws.aV,{ref:this.refTreeListEntries,onRowsRendered:this.onRowsRendered,onScroll:this.onScroll,width:this.state.width,height:this.state.height,rowHeight:this.props.rowHeight||t,rowRenderer:this.renderTreeItem,rowCount:this.state.renderArray.length,overscanRowCount:12,onScrollbarPresenceChange:this.props.onScrollbarPresenceChange,scrollToAlignment:this.props.scrollToAlignment,containerStyle:{pointerEvents:"auto"}}))}}const Ps=Ns;var Ds;function Ms(e,t,n,i){Ds||(Ds="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Ds,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function Os({onExpandClick:e,inManager:t,fullView:n,node:i,level:s,isExpanded:o,inlineEditText:a,onChange:r,onBlur:l,onFocus:d,showBadge:c,onMouseEnter:u,onMouseLeave:p}){const h=(s+1)*ks+"px",m=s*ks+"px",f=Boolean(i.children),v=Boolean(f&&i.children.length),{favIconUrl:y,favIconLoadType:b}=pn.jk.getBookmarkFavicon(i.url,i.faviconUrl);return Ms("label",{"data-parent":i.parentId,onMouseEnter:u,onMouseLeave:p},"0",f&&v&&Ms("span",{className:"expand-icon",style:{marginLeft:m},onMouseUp:t=>{const n=t.altKey;e(i.id,n)},onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},dangerouslySetInnerHTML:{__html:Wi.nfH}}),f&&i.trash&&Ms(Ki,{speeddial:i.speeddial,open:o,trash:!0,leftMargin:v?0:h}),f&&!i.trash&&Ms(Ki,{speeddial:i.speeddial,open:o,trash:!1,leftMargin:v?0:h}),!f&&Ms(Ri.ZP,{url:y,loadType:b,style:{marginLeft:h},className:"tree-row-image bookmark-icon"}),void 0!==a&&Ms("input",{type:"text",value:a,onChange:r,onFocus:d,onBlur:l,autoFocus:!0}),void 0===a&&Ms("span",{className:"title"},void 0,i.title?i.title:g.Z.isBookmark(i)&&!t?i.url:""),c&&v&&!n&&Ms("span",{className:"item-count"},void 0,i.children.filter((e=>!g.Z.isSeparator(e))).length))}var xs,Ls,Rs=n(34155);function Bs(e,t,n,i){xs||(xs="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:xs,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function Fs({node:e,inlineEditText:t,isExpanded:n,level:i,onFocus:s,onChange:o,onBlur:a,onExpandClick:r}){return Bs(Os,{node:e,inlineEditText:t,isExpanded:n,level:i,inManager:!1,fullView:!1,showBadge:!1,onExpandClick:r,onFocus:s,onChange:o,onBlur:a},e.id)}class Ws extends Li.PureComponent{refTreeList=Li.createRef();componentDidMount(){this.setFolderTreeView()}componentDidUpdate(e){const t=this.refTreeList.current?.getSelectedId();e.selectedId===this.props.selectedId||t===this.props.selectedId||this.props.isEditing||this.setFolderTreeView()}async setFolderTreeView(){const{selectedId:e}=this.props,t=this.refTreeList.current?.getSelectedId();if(t!==e&&this.setSelectedId(e),this.props.expandAll)this.refTreeList.current?.expandAll();else{this.refTreeList.current?.collapseAll(),await new Promise((e=>Rs.nextTick(e)));const t=g.Z.getRootId();void 0!==t&&(e&&e!==t?this.refTreeList.current?.expandToId(e):this.refTreeList.current?.expand(t))}await new Promise((e=>Rs.nextTick(e)));e&&"1"!==e&&this.refTreeList.current?.scrollToId(e)}setSelectedId=e=>{this.refTreeList.current?.setSelectedIds([e])};scrollToId=e=>{this.refTreeList.current?.scrollToId(e)};expand=e=>{this.refTreeList.current?.expand(e)};expandAll=()=>{this.refTreeList.current?.expandAll()};toggleSelectedExpansion=(e,t)=>{this.refTreeList.current?.toggleSelectedExpansion(e,t)};startInlineEdit=e=>{this.setSelectedId(e),this.scrollToId(e),this.focus(),this.refTreeList.current?.startInlineEdit(e)};focus=()=>{this.refTreeList.current?.focusTree()};render(){const{folders:e,onSelect:t}=this.props;return(0,ss.jsx)(Ps,{ref:this.refTreeList,className:Fi()(this.props.className,"vivaldi-tree"),nodes:e,hasChildren:e=>e.children?.length,isFolder:e=>Boolean(e.children?.length&&!e.url),onSelect:e=>e&&t(e.id),rowComponent:e=>(0,ss.jsx)(Fs,{...e,onExpandClick:this.toggleSelectedExpansion}),saveTitle:this.props.onFolderTitleChange,isValidToEdit:()=>!0,getTitle:()=>this.props.defaultEditFolderText,enableDragAndDrop:!1})}}function Us(e,t,n,i){Ls||(Ls="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Ls,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function Vs(e,t){return t?t>16?e.large:t<16?e.small:e.medium:e.medium}function Hs({icon:e,size:t,className:n}){return Us("span",{style:t&&{"--IconSize":t},className:Fi()("VivaldiSvgIcon",n),dangerouslySetInnerHTML:{__html:e}})}function Gs({size:e,className:t}){return Us(Hs,{icon:Vs(Wi.GtN,e),size:e,className:t})}function $s({size:e,className:t}){return Us(Hs,{icon:Vs(Wi.nre,e),size:e,className:t})}function Ks({size:e,className:t}){return Us(Hs,{icon:Wi.oJy,size:e,className:t})}function zs({size:e,className:t}){return Us(Hs,{icon:Wi.u0H,size:e,className:t})}function js({size:e,className:t}){return Us(Hs,{icon:Wi.V_c,size:e,className:t})}function Ys({size:e,className:t}){return Us(Hs,{size:e,className:t,icon:'\n<svg width="8" height="12" viewBox="0 0 8 12" xmlns="http://www.w3.org/2000/svg">\n  <path d="M7.06006 1.60666L6.1134 0.666656L4.00006 2.77999L1.88673 0.666656L0.940063 1.60666L4.00006 4.66666L7.06006 1.60666ZM0.940063 10.3933L1.88673 11.3333L4.00006 9.21999L6.1134 11.3333L7.0534 10.3933L4.00006 7.33332L0.940063 10.3933Z"/>\n</svg>\n'})}function Xs({size:e,className:t}){return Us(Hs,{size:e,className:t,icon:'\n<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none">\n  <path fill="#EF3939" d="M8 3.874C6.84.929 1 1.366 1 5.82 1 8.039 2.785 10.99 8 14c5.215-3.009 7-5.961 7-8.18C15 1.392 9.167.91 8 3.874Z"/>\n</svg>\n'})}function Qs({size:e,className:t}){return Us(Hs,{icon:Vs(Wi._TQ,e),size:e,className:t})}function qs({size:e,className:t}){return Us(Hs,{icon:Vs(Wi.fph,e),size:e,className:t})}function Js({size:e,className:t}){return Us(Hs,{icon:Vs(Wi.$II,e),size:e,className:t})}function eo({size:e,className:t}){return Us(Hs,{size:e,className:t,icon:'\n<svg width="18" height="18" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg">\n  <rect x="1" y="1" width="7" height="7" rx="2"/>\n  <rect x="1" y="10" width="7" height="7" rx="2"/>\n  <rect x="10" y="10" width="7" height="7" rx="2"/>\n  <rect x="10" y="1" width="7" height="7" rx="2"/>\n</svg>\n'})}function to({size:e,className:t}){return Us(Hs,{icon:Vs(Wi.YvR,e),size:e,className:t})}function no({size:e,className:t}){return Us(Hs,{icon:Wi.AXs,size:e,className:t})}function io({size:e,className:t}){return Us(Hs,{icon:Wi.uw2,size:e,className:t})}function so({size:e,className:t}){return Us(Hs,{icon:Vs(Wi.bqs,e),size:e,className:t})}function oo({size:e,className:t}){return Us(Hs,{icon:Wi.kze,size:e,className:t})}function ao({size:e,className:t}){return Us(Hs,{icon:Wi.D7r.medium,size:e,className:t})}function ro({size:e,className:t}){return Us(Hs,{icon:Wi.Tu3,size:e,className:t})}function lo({size:e,className:t}){return Us(Hs,{icon:Wi.GH$,size:e,className:t})}function co({size:e,className:t,type:n}){switch(n){case"account":return Us(Gs,{className:t,size:e});case"trash":return Us($s,{className:t,size:e});case"bookmark":return Us(Ks,{className:t,size:e});case"caret":case"chevron":return Us(zs,{className:t,size:e});case"time":return Us(js,{className:t,size:e});case"contract":return Us(Ys,{className:t,size:e});case"folder":return Us(Qs,{className:t,size:e});case"folder-arrow":return Us(qs,{className:t,size:e});case"heart":return Us(Xs,{className:t,size:e});case"speed-dial-folder":return Us(Js,{className:t,size:e});case"speed-dial":return Us(eo,{className:t,size:e});case"search":return Us(to,{className:t,size:e});case"download-speed":return Us(no,{className:t,size:e});case"download-placeholder":return Us(io,{className:t,size:e});case"settings":return Us(so,{className:t,size:e});case"close":return Us(oo,{className:t,size:e});case"checkmark":return Us(ao,{className:t,size:e});case"reorder":return Us(Hs,{size:e,className:"reorder",icon:'\n<svg width="12" height="4" viewBox="0 0 12 4" xmlns="http://www.w3.org/2000/svg">\n  <line x1="0" y1="0" x2="12" y2="0" stroke="currentColor" />\n  <line x1="0" y1="4" x2="12" y2="4" stroke="currentColor" />\n</svg>\n'});case"credit-card":return Us(Hs,{size:e,icon:Wi.rur,className:t});case"blocker-shield":return Us(ro,{className:t,size:e});case"info":return Us(lo,{className:t,size:e})}}var uo,po=n(98102),ho=n(34155);function go(e,t,n,i){uo||(uo="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:uo,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function mo(e){return e.children?e.children.reduce(((e,t)=>{if(t.speeddial)return e.push(t),e;if(t.children?.length){const n=mo(t);(n?.length||t.speeddial)&&e.push({...t,children:n})}return e}),[]):[]}var fo=go(co,{type:"search",size:18,className:"BookmarkLocationSelector-SearchInput-Icon"});function vo({onValueChange:e,value:t,placeholder:n}){return go("div",{className:"BookmarkLocationSelector-SearchInput"},void 0,go("input",{placeholder:n,className:"BookmarkLocationSelector-SearchInput-Input",type:"search",value:t,onChange:({currentTarget:t})=>e(t.value)}),fo)}const yo=Object.freeze({folders:!0,bookmarks:!1});class bo extends Li.PureComponent{refFolderList=Li.createRef();state={nodes:g.Z.getFilteredTree("",{...yo,root:"bookmarks"===this.props.mode}).nodes,filter:"",isEditing:!1};componentDidMount(){g.Z.addListener(this.handleBookmarkStoreChange)}componentWillUnmount(){g.Z.removeListener(this.handleBookmarkStoreChange)}handleBookmarkStoreChange=()=>{this.setState((e=>({nodes:[...g.Z.getFilteredTree(e.filter,{...yo,root:"bookmarks"===this.props.mode}).nodes]})))};handleNewFolderButtonClick=async()=>{this.setState({isEditing:!0});const e=this.state.filter||(0,B.Z)("command","New Folder"),t=this.state.filter?"1":this.props.parentId,n="speeddial"===this.props.mode&&t===g.Z.getRootId(),s=await i.Z.bookmarks.create({parentId:t,title:e,speeddial:n});this.refFolderList.current?.expand(t),await this.props.onParentIdChange(s.id),this.refFolderList.current?.startInlineEdit(s.id),this.setState({filter:""})};setParentOnSelect=async e=>{await this.props.onParentIdChange(e)};scrollToId=async e=>{await new Promise((e=>ho.nextTick(e))),this.refFolderList.current?.scrollToId(e),await new Promise((e=>ho.nextTick(e)))};toggleFolderChange=async()=>{const e="bookmarks"===this.props.mode?"speeddial":"bookmarks";await this.props.onModeChange(e),this.handleBookmarkStoreChange(),this.refFolderList.current?.focus()};handleFolderTitleChange=(e,t)=>{this.setState({isEditing:!1}),this.props.onFolderTitleChange(e,t)};handleFilterChange=e=>{const t=[...g.Z.getFilteredTree(e,{...yo,root:"bookmarks"===this.props.mode}).nodes];this.setState({filter:e,nodes:t},(()=>this.refFolderList.current?.expandAll()))};render(){const{className:e}=this.props,t="1"===this.props.parentId,n=this.state.nodes,i="speeddial"===this.props.mode?mo({children:n}):n;return go("div",{className:Fi()("BookmarkLocationSelector",e)},void 0,go("p",{className:"BookmarkLocationSelector-Header"},void 0,(0,B.Z)("bookmarkeditor","Location")),go("div",{className:"BookmarkLocationSelector-SpeedDialCheckbox"},void 0,go("label",{},void 0,go("input",{type:"checkbox",checked:"speeddial"===this.props.mode,onChange:this.toggleFolderChange}),go("span",{},void 0,(0,B.Z)("Show only Speed Dial folders")))),go(vo,{value:this.state.filter,onValueChange:this.handleFilterChange,placeholder:"speeddial"===this.props.mode?(0,B.Z)("Find in Speed Dial Folders"):(0,B.Z)("Find in All Folders")}),(0,ss.jsx)(Ws,{ref:this.refFolderList,folders:i,onSelect:this.setParentOnSelect,selectedId:this.props.parentId,isEditing:this.state.isEditing,expandAll:!t,onFolderTitleChange:this.handleFolderTitleChange,className:"BookmarkLocationSelector-FolderList",defaultEditFolderText:this.state.filter||(0,B.Z)("command","New Folder")}),go(po.ZP,{image:Wi.md4.small,title:"bookmarks"===this.props.mode?(0,B.Z)("Add a new folder in bookmarks","New Folder"):(0,B.Z)("New Speed Dial Group"),size:"medium",className:"BookmarkLocationSelector-AddFolderButton",onClick:this.handleNewFolderButtonClick}))}}var So;function wo(e,t,n,i){So||(So="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:So,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function Co(e){switch(e){case"error":case"warning":return"alert";default:return"status"}}function Ao(e){switch(e){case"error":return Wi.viW;case"warning":return Wi.h6;case"success":return Wi.JLz;default:return Wi.GH$}}class Io extends Li.Component{_refFeedback=Li.createRef();componentDidMount(){this._refFeedback.current?.scrollIntoViewIfNeeded()}componentDidUpdate(){this._refFeedback.current?.scrollIntoViewIfNeeded()}render(){const{type:e="info",children:t}=this.props;return(0,ss.jsxs)("div",{ref:this._refFeedback,className:`FormFeedback FormFeedback--${e}`,role:Co(e),children:[wo("span",{className:"FormFeedback-Icon",dangerouslySetInnerHTML:{__html:Ao(e)}}),t]})}}const To=Io;var Zo;function Eo(e,t,n,i){Zo||(Zo="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Zo,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function ko({value:e,title:t,onChange:n,autoFocus:i}){return Eo("label",{className:"BookmarkInputField"},void 0,Eo("span",{className:"BookmarkInputField-Title",id:"dialog-bookmark-title"},void 0,t),Eo("input",{className:"BookmarkInputField-Input",type:"text",value:e,onChange:n,autoFocus:i}))}class _o extends Li.PureComponent{refLocationSelector=Li.createRef();scrollToId=async e=>{await(this.refLocationSelector.current?.scrollToId(e))};render(){const{title:e,onTitleChange:t,autoFocus:n,url:i,onUrlChange:s,nickname:o,onNicknameChange:a,description:r,onDescriptionChange:l,onParentIdChange:d,parentId:c,onFolderTitleChange:u,locationSelectMode:p,onDeleteBookmarkClick:h,onClosePopupClick:m,onLocationSelectModeChange:f}=this.props,v=(y=c,g.Z.getItemById(y)?.title);var y;return Eo("form",{className:"BookmarkPopup",onSubmit:m},void 0,Eo("header",{className:"dialog-header"},void 0,Eo("h1",{className:"DialogHeader-HeaderText"},void 0,(0,B.Z)("Added Bookmark")),v&&Eo("p",{},void 0,(0,B.Z)("to $1",[v]))),Eo("div",{className:"dialog-content"},void 0,Eo("div",{className:"BookmarkPopup-TextInputWrapper"},void 0,Eo(ko,{title:(0,B.Z)("bookmarkeditor","Name"),value:e,onChange:({currentTarget:e})=>{t(e.value)},autoFocus:"title"===n}),Eo(ko,{title:(0,B.Z)("URL"),value:i,onChange:({currentTarget:e})=>s(e.value),autoFocus:"url"===n}),Eo(ko,{title:(0,B.Z)("Nickname"),value:o,onChange:({currentTarget:e})=>a(e.value),autoFocus:"nickname"===n}),this.props.nickError&&Eo(To,{type:"warning"},void 0,(0,B.Z)("This nickname is already in use.")),Eo(ko,{title:(0,B.Z)("Description"),value:r,onChange:({currentTarget:e})=>l(e.value),autoFocus:"description"===n})),(0,ss.jsx)(bo,{ref:this.refLocationSelector,className:"BookmarkPopup-LocationSelector",onParentIdChange:d,parentId:c,onFolderTitleChange:u,mode:p,onModeChange:f})),Eo("footer",{className:"dialog-footer"},void 0,Eo("input",{type:"submit",value:(0,B.Z)("bookmarkeditor","Done")}),Eo("input",{type:"button",className:"danger",onClick:h,value:(0,B.Z)("bookmarkeditor","Remove")})))}}var No=n(57904);const Po=new class{setBackgroundTasks(e){A.Z.dispatch({actionType:"BACKGROUND_TASKS_SET",tasks:e})}};const Do=function(e,t,n,i,s,o){this.id=e,this.title=n,this.description=s,this.menuItems=o,this.progress=0,this.text=t},Mo="thumbnailCapture";const Oo=new class{pendingEntries=[];activeEntries=[];tasks=[];add=(e,t,n)=>{this.pendingEntries.push({id:e,url:t,callback:n})};run=()=>{for(;;){if(this.activeEntries.length>=1)return;if(0===this.pendingEntries.length)return void(0===this.activeEntries.length&&(this.removeFromArrayById(Mo,this.tasks),Po.setBackgroundTasks(this.tasks)));const e=this.pendingEntries.shift();this.activeEntries.push(e);let t=this.getFromArrayById(Mo,this.tasks);t||(t=new Do(Mo,"","Thumbnail Capture","",[{name:(0,B.Z)("Cancel"),handler:()=>{this.pendingEntries=[]}}]),this.tasks.push(t)),t.title=(0,B.Z)("Updating thumbnail for $1",[e.url]),t.description=(0,B.Z)("$1 bookmark waiting for update.","$1 bookmarks waiting for update.",[this.pendingEntries.length]),t.text=this.pendingEntries.length+this.activeEntries.length,Po.setBackgroundTasks(this.tasks),e.callback.call(null,e.id,e.url)}};onLoaded=e=>{this.removeFromArrayById(e,this.activeEntries),this.run()};contains=e=>this.isInArrayById(e,this.pendingEntries)||this.isInArrayById(e,this.activeEntries);getFromArrayById=(e,t)=>t.find((t=>t.id===e));isInArrayById=(e,t)=>t.length>0&&void 0!==this.getFromArrayById(e,t);removeFromArrayById=(e,t)=>{const n=t.findIndex((t=>t.id===e));-1!==n&&t.splice(n,1)}},xo=440,Lo=360;let Ro=0;const Bo=new Map,Fo={getPageThumbnail(e,t,n){Ro>4||(Ro++,e.getThumbnail(Wo(t),(e=>{Ro--,i.Z.runtime.lastError?n(void 0):n(e||void 0)})))},updateForBookmark(e,t){Fo.updateForBookmarks([{id:e,url:t}])},updateForBookmarks(e){for(const t of e){const e=t.url;e&&!Oo.contains(t.id)&&(Oo.add(t.id,pn.jk.getUrl(e),Uo),Vo(t.id))}Oo.run()},linkAndQueryUpdatingBookmark:(e,t)=>t?(Bo.set(e,t),Oo.contains(t)):(Bo.delete(e),!1),unlinkBookmarkComponent(e){Bo.delete(e)}},Wo=e=>e.compact?{width:330,height:270}:{width:xo,height:Lo},Uo=(e,t)=>{const n={bookmarkId:e,url:t};se.Z.thumbnails.captureBookmark(n).then((t=>{Oo.onLoaded(e),Vo(e)}))};function Vo(e){for(const[t,n]of Bo)n===e&&t.forceUpdate()}const Ho=Fo;async function Go(e){try{const t=await(0,Fn.VN)(e,{type:"BOOKMARKS_FETCH_METADATA"});if("bookmarkData"===t.type){const{url:n,description:i,imageUrl:s}=t.data,o=Ce.ZP.getPageById(e)?.vivExtData.fixedTitle??t.data.title;let a;if(s)try{const e=n?new URL(s,n).toString():s;a=await async function(e,t,n){return new Promise(((i,s)=>{const o=new Image;o.crossOrigin="anonymous",o.onload=()=>{let e=o.naturalWidth,s=o.naturalHeight;n&&(e>xo&&(s*=xo/e,e=xo),s>Lo&&(e*=Lo/s,s=Lo));const a=document.createElement("canvas"),r=a.getContext("2d");a.width=e,a.height=s,r.drawImage(o,0,0,e,s),a.toBlob((e=>{a.remove(),i(e)}),t)},o.onerror=s,o.src=e}))}(e,"image/png",!0)}catch{}return{title:o,url:n,description:i,thumbnail_blob:a,thumbnail_content_type:"image/png"}}}catch(e){console.error(e)}}var $o;function Ko(e,t,n,i){$o||($o="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:$o,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function zo(e){return C.Z.get(I.kBookmarksFetchPageMetadata)&&!(0,pn.cw)(e)}async function jo(e){return new Promise(((t,n)=>{const i={url:e?.url||"",title:e?(0,pn.d6)(e.url,e.title):"",description:"",thumbnail_blob:null,thumbnail_content_type:""};e?.vivExtData.thumbnail?fetch(e?.vivExtData.thumbnail).then((e=>e.blob())).then((e=>{i.thumbnail_blob=e,i.thumbnail_content_type=e.type})).catch((e=>{console.log(e)})).finally((()=>{t(i)})):t(i)}))}class Yo extends Li.PureComponent{static contextType=ts.Z;state={status:"standby",buttonTitleIsStatus:!1,isBookmarkPopupOpen:!1,nickError:!1,title:this.props.bookmarkData?.title||"",url:this.props.bookmarkData?.url||"",description:this.props.bookmarkData?.description||"",thumbnail:this.props.bookmarkData?.thumbnail||"",nickname:this.props.bookmarkData?.nickname||"",parentId:this.props.bookmarkData?.parentId||"",popupLocationSelectMode:"bookmarks"};componentDidMount(){No.Z.addListener(this.onWebpageviewStoreChanged)}componentWillUnmount(){No.Z.removeListener(this.onWebpageviewStoreChanged)}onWebpageviewStoreChanged=async e=>{if(e.winId!==this.context.vivaldiWindowId||"WEBPAGEVIEW_ACTIONS"!==e.type||"addBookmark"!==e.action)return;const t=Ce.ZP.getPageInWindow(e.winId,e.pageId);if(!t)return;if(g.Z.findByUrl(t.url))return void this.setIsBookmarkPopupOpen(!0);const n=zo(t.url)&&await Go(t.id)||await jo(t);await this.bookmarkPage(n),C.Z.get(I.kBookmarksConfirmAdding)&&this.setIsBookmarkPopupOpen(!0)};componentDidUpdate(e,t){if(t.isBookmarkPopupOpen&&!this.state.isBookmarkPopupOpen&&this.props.bookmarkData){const{title:e,url:n,description:i,nickname:s}=this.state;this.#d(this.props.bookmarkData.id,{title:e,url:n,description:i,nickname:t.nickError?"":s})}else e.bookmarkData&&!this.props.bookmarkData&&this.setState({title:"",url:"",description:"",thumbnail:"",nickname:"",parentId:""}),!e.bookmarkData&&this.props.bookmarkData&&this.setState({title:this.props.bookmarkData.title,url:this.props.bookmarkData.url,description:this.props.bookmarkData.description,thumbnail:this.props.bookmarkData.thumbnail,nickname:this.props.bookmarkData.nickname,parentId:this.props.bookmarkData.parentId,status:"bookmarked",buttonTitleIsStatus:!0}),"bookmarked"!==t.status&&"bookmarked"===this.state.status&&setTimeout((()=>{this.state.isBookmarkPopupOpen||this.setState({status:"standby",buttonTitleIsStatus:!1})}),4e3)}#d(e,t){return i.Z.bookmarks.update(e,t).catch((e=>u.Z.setStatus(this.context.vivaldiWindowId,`Error: ${e.message}`)))}setIsBookmarkPopupOpen(e){e?this.setState({isBookmarkPopupOpen:e}):this.setState((t=>({isBookmarkPopupOpen:e,status:"standby",nickname:t.nickError?"":t.nickname,nickError:!1}))),this.props.onBookmarkPopupVisibilityChange?.(e)}bookmarkPage=async e=>{let t=C.Z.get(I.kBookmarksSaveFolder);const n=g.Z.getItemById(t);n&&!g.Z.isTrashed(n)||(t=g.Z.getRootId());const i={parentId:t,title:e.title,url:e.url,description:e.description,thumbnail:""};if(e.thumbnail_blob)try{i.thumbnail=await se.Z.utilities.storeImage({data:await e.thumbnail_blob.arrayBuffer(),mimeType:e.thumbnail_content_type})}catch(e){console.error(e)}const s=await this.props.setBookmarked(i);s.parentId&&this.refBookmarkPopup.current?.scrollToId(s.parentId)};onDeleteBookmarkClick=async()=>{this.setState({status:"standby"}),this.props.bookmarkData&&(await ee.Z.remove([this.props.bookmarkData.id]),this.setIsBookmarkPopupOpen(!1))};onBookmarkButtonClicked=async()=>{if(this.setState((e=>this.props.bookmarkData||e.isBookmarkPopupOpen||C.Z.get(I.kBookmarksConfirmAdding)?(this.props.onBookmarkPopupVisibilityChange&&this.props.onBookmarkPopupVisibilityChange(!e.isBookmarkPopupOpen),{isBookmarkPopupOpen:!e.isBookmarkPopupOpen}):e)),!this.props.bookmarkData){const e=Ce.ZP.getPageById(this.props.pageId);if(!e)return;const t=zo(e.url)&&await Go(this.props.pageId)||await jo(e);await this.bookmarkPage(t)}};handleParentIdChange=async e=>{const t=g.Z.getItemById(e);if(t&&!g.Z.isFolder(t)){console.info("handleParentIdChange: parentId is not a folder.");const t=g.Z.getRootId();if(void 0===t)return;e=t}this.props.bookmarkData&&(await ee.Z.move([this.props.bookmarkData.id],e),w.Z.set(I.kBookmarksSaveFolder,e),this.setState({parentId:e}))};handleTitleChange=e=>{this.setState({title:e})};handleUrlChange=e=>{this.setState({url:e})};handleNicknameChange=e=>{this.setState({nickname:e,nickError:g.Z.hasNickname(e)})};handleDescriptionChange=e=>{this.setState({description:e})};handleFolderTitleChange=(e,t)=>{this.#d(e,{title:t})};hidePopup=()=>{this.setIsBookmarkPopupOpen(!1)};onLocationSelectModeChange=e=>{this.setState({popupLocationSelectMode:e})};refBookmarkPopup=Li.createRef();render(){const{title:e,url:t,nickname:n,nickError:i,description:s,thumbnail:o,parentId:a}=this.state,r="bookmarked"===this.state.status||this.state.isBookmarkPopupOpen,l="bookmarked"===this.state.status&&!this.state.isBookmarkPopupOpen||this.props.isBookmarkPopup?(0,B.Z)("Added bookmark"):"",d=C.Z.get(I.kAddressBarVisible)&&!he.ZP.isMinimalUI(this.context.vivaldiWindowId);return Ko("div",{className:Fi()("BookmarkButton",{"BookmarkButton--Active":r})},void 0,Ko(po.ZP,{onClick:this.onBookmarkButtonClicked,tooltip:(0,B.Z)("tooltip","Bookmark Page"),image:Wi.oJy,hidePopup:this.hidePopup,popupPosition:d?this.props.popupPosition:"below",isPopupVisible:this.state.isBookmarkPopupOpen,popupWidth:356,className:"BookmarkButton-Button",isOn:Boolean(this.props.bookmarkData),title:l,titleIsStatus:this.state.buttonTitleIsStatus,popupLabelledBy:"dialog-bookmark-title",commandId:"COMMAND_ADD_BOOKMARK"},void 0,(0,ss.jsx)(_o,{ref:this.refBookmarkPopup,onDeleteBookmarkClick:this.onDeleteBookmarkClick,onClosePopupClick:this.hidePopup,onParentIdChange:this.handleParentIdChange,onTitleChange:this.handleTitleChange,onUrlChange:this.handleUrlChange,onNicknameChange:this.handleNicknameChange,onDescriptionChange:this.handleDescriptionChange,onFolderTitleChange:this.handleFolderTitleChange,title:e,url:t,nickname:n,nickError:i,description:s,image:o,parentId:a,autoFocus:"title",locationSelectMode:this.state.popupLocationSelectMode,onLocationSelectModeChange:this.onLocationSelectModeChange})))}}var Xo;function Qo(e,t,n,i){Xo||(Xo="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Xo,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class qo extends Li.PureComponent{static contextType=ts.Z;#c;state={isBookmarkButtonOpen:!1};componentDidMount(){this.setExpireTimeout(5e3)}componentWillUnmount(){clearTimeout(this.#c)}setExpireTimeout(e){this.#c=setTimeout((()=>{this.props.onClose()}),e)}onSetBookmarked=e=>i.Z.bookmarks.create(e).then((t=>(de.Z.showBookmarkAddedPopup(this.context.vivaldiWindowId,{pageId:this.props.options.pageId,url:e.url??"",isActive:!0}),t)));handleBookmarkButtonVisibility(e){this.setState({isBookmarkButtonOpen:e}),clearTimeout(this.#c),e||this.setExpireTimeout(500)}render(){const e=g.Z.findByUrl(this.props.options.url),t="top"===C.Z.get(I.kAddressBarPosition)?"below":"above";return Qo(Yo,{pageId:this.props.options.pageId,bookmarkData:e,setBookmarked:this.onSetBookmarked,popupPosition:t,isBookmarkPopup:!0,onBookmarkPopupVisibilityChange:e=>this.handleBookmarkButtonVisibility(e)})}}const Jo=qo;var ea,ta=n(33349);function na(e,t,n,i){ea||(ea="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:ea,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function ia(){return void 0!==g.Z.getRootId()?{nodes:g.Z.getFoldersWithin(g.Z.getTopNodes(),0),bookmarksBarFolderId:g.Z.getBookmarkBarFolderId()}:{nodes:void 0,bookmarksBarFolderId:void 0}}class sa extends Li.Component{state=ia();_onStoreChange=()=>{this.setState(ia())};componentDidMount(){g.Z.addListener(this._onStoreChange)}componentWillUnmount(){g.Z.removeListener(this._onStoreChange)}getFolderId=e=>{if(this.props.selectedItemID){const t=e.find((e=>e.id===this.props.selectedItemID));if(t)return t.id;console.warn("Bookmark folder not found")}return this.state.bookmarksBarFolderId};render(){const{nodes:e}=this.state;if(!e)return null;const t=this.getFolderId(e),n=e.find((e=>e.id===t))?.title||g.E,i=e.map((e=>na("option",{value:e.id},"dir_"+e.id," ".repeat(3*e.level),e.title)));return na("span",{className:"bookmark-folder-picker"},void 0,na("input",{type:"text",value:n,tabIndex:"-1",readOnly:!0}),na(ta.Z,{className:"bookmark-folders",value:t,onChange:this.props.onChange},void 0,i))}}const oa=sa;var aa,ra=n(64473);function la(e,t,n,i){aa||(aa="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:aa,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const da={title:"",url:"",description:"",nickname:"",thumbnail:"",isFolder:!1,parentId:"",nickError:!1};class ca extends Li.PureComponent{static contextType=ts.Z;_parentId="";_index=0;state=da;constructor(e,t){super(e);const n=g.Z.getItemById(e.options.id);let i=da;switch(e.options.mode){case"edit":n&&(i={...i,title:n.title,url:n.url||"",thumbnail:n.thumbnail,description:n.description,nickname:n.nickname,isFolder:g.Z.isFolder(n),parentId:n.parentId||""});break;case"addbookmark":case"addfolder":if(n?g.Z.isFolder(n)?(this._parentId=n.id,this._index=0):(this._parentId=n.parentId??g.Z.getRootId()??"",this._index="number"==typeof n.index?n.index+1:0):(this._parentId=g.Z.getRootId()??"",this._index=0),i={...i,parentId:this._parentId,isFolder:"addfolder"===e.options.mode},!i.isFolder){const e=Ce.ZP.getActivePage(t.vivaldiWindowId);e&&(i={...i,title:e.title,url:e.url,thumbnail:e.vivExtData.thumbnail??""})}}this.state=i}onCancel=()=>{this.props.onClose()};onSave=()=>{switch(this.props.options.mode){case"edit":{const e=this.props.options.id,t=zi.ZP.verifyForUpdate({title:this.state.title,url:this.state.url,thumbnail:this.state.thumbnail,nickname:this.state.nickError?"":this.state.nickname,description:this.state.description},this.state.isFolder),n=g.Z.getItemById(e);n&&n.parentId!==this.state.parentId?ee.Z.move([n.id],this.state.parentId,0).then((()=>{i.Z.bookmarks.update(e,t).then((()=>this.props.onClose()))})):i.Z.bookmarks.update(e,t).then((()=>this.props.onClose()));break}case"addbookmark":case"addfolder":{const e=zi.ZP.verifyForCreate({parentId:this.state.parentId,index:this.state.parentId===this._parentId?this._index:0,title:this.state.title,url:this.state.url,nickname:this.state.nickError?"":this.state.nickname,description:this.state.description},this.state.isFolder);i.Z.bookmarks.create(e).then((()=>this.props.onClose()));break}default:this.props.onClose()}};changeValue=(e,t)=>{const n={},{value:i}=t.target;n[e]=i,this.setState(n),"nickname"===e&&(g.Z.hasNickname(i)?this.setState({nickError:!0}):this.setState({nickError:!1}))};render(){let e;switch(this.props.options.mode){case"edit":e=this.state.isFolder?(0,B.Z)("Edit Folder"):(0,B.Z)("Edit Bookmark");break;case"addbookmark":e=(0,B.Z)("New Bookmark");break;case"addfolder":e=(0,B.Z)("title","New Folder")}if(void 0===e)return null;const t=this.state.isFolder?(0,B.Z)("Folder Name"):(0,B.Z)("Bookmark Name");return la(ra.Z,{onRequestClose:this.onCancel,title:e},void 0,la("div",{className:"edit-bookmark"},void 0,la("form",{onSubmit:this.onSave},void 0,false,la("div",{className:"dialog-content"},void 0,la("input",{className:"title",type:"text",value:this.state.title,onChange:this.changeValue.bind(this,"title"),title:t,placeholder:t,autoFocus:!0}),!1===this.state.isFolder&&la("input",{className:"address",type:"text",value:this.state.url,onChange:this.changeValue.bind(this,"url"),title:(0,B.Z)("Address"),placeholder:(0,B.Z)("Address")}),void 0!==this.state.parentId&&la(oa,{selectedItemID:this.state.parentId,onChange:this.changeValue.bind(this,"parentId")}),!1===this.state.isFolder&&la("input",{className:"nickname",type:"text",value:this.state.nickname,onChange:this.changeValue.bind(this,"nickname"),title:(0,B.Z)("Nickname"),placeholder:(0,B.Z)("Nickname")}),this.state.nickError&&la(To,{type:"warning"},void 0,(0,B.Z)("This nickname is already in use.")),!1===this.state.isFolder&&la("textarea",{className:"description",type:"text",value:this.state.description,onChange:this.changeValue.bind(this,"description"),title:(0,B.Z)("Description"),placeholder:(0,B.Z)("Description")})),la("footer",{className:"dialog-footer"},void 0,la("input",{type:"submit",className:"primary",value:(0,B.Z)("Save")}),la("input",{type:"button",onClick:this.onCancel,value:(0,B.Z)("Cancel")})))))}}const ua=ca;class pa extends Li.PureComponent{static contextType=ts.Z;refButton=Li.createRef();componentDidMount(){this._reportSize()}componentDidUpdate(){this._reportSize()}_reportSize=()=>{const{HTMLElement:e}=this.context,t=this.refButton.current;t instanceof e&&this.props.onRendered(t.offsetWidth,t.offsetHeight)};_handleKeyDown=e=>{switch(e.key){case"ArrowUp":case"ArrowDown":case"Enter":this.props.onItemActivated(this.props.id,"Enter"===e.key,!0);break;case"ArrowLeft":this.props.moveFocus(this.props.id,"left",!1);break;case"ArrowRight":this.props.moveFocus(this.props.id,"right",!1);break;case"Escape":if(this.props.menuOpen)return;this.props.onLeaveBar();break;default:return}e.preventDefault(),e.stopPropagation()};_handleMouseDown=e=>{e.preventDefault()};_handleItemMouseUp=e=>{e.button===es.Z.kCenter&&e.preventDefault()};_handleClick=e=>{this.props.onItemActivated(this.props.id,!0,!0,e),e.preventDefault(),e.stopPropagation()};_handleBlur=()=>{this.props.onItemBlur(this.props.id)};_handleFocus=()=>{this.props.highlighted||this.props.onItemHighlightMissing(this.props.id)};_handleMouseEnter=e=>{this.props.onItemEnter(this.props.id)};_handleMouseLeave=e=>{this.props.onItemLeave(this.props.id)};render(){return(0,ss.jsx)("button",{ref:this.refButton,className:Fi()({bookmarkbarItem:!0,chevron:!0,highlighted:this.props.highlighted}),"data-id":this.props.id,"data-offset":this.props.offset,tabIndex:this.props.keyAccess,title:(0,B.Z)("More bookmarks"),dangerouslySetInnerHTML:{__html:Wi.zwh},onKeyDown:this._handleKeyDown,onClick:this._handleClick,onMouseDown:this._handleMouseDown,onMouseUp:this._handleItemMouseUp,onBlur:this._handleBlur,onFocus:this._handleFocus,onMouseEnter:this._handleMouseEnter,onMouseLeave:this._handleMouseLeave})}}const ha=pa;var ga=n(44147),ma=n(62077),fa=n(72536),va=n(86635),ya=n(68551),ba=n(13253),Sa=n(89661),wa=n(34155);let Ca=!1;const Aa={show:function(e,t,n,i,s,o,a){const r=e.vivaldiWindowId;let l=!0;const d=function(e,t){l=!1,ga.Z.onOpen(e,t)},c=function(e){a(e,!1)},u=function(){wa.nextTick((()=>{a("",l)}))};Ca||(Ca=!0,function(e,t){return new Promise((e=>{se.Z.zoom.getVivaldiUIZoom((n=>{t.forEach((e=>{e.rect.x=parseInt((e.rect.x+1)*n),e.rect.y=parseInt((e.rect.y+0)*n),e.rect.width=parseInt(e.rect.width*n),e.rect.height=parseInt(e.rect.height*n)})),e()}))}))}(0,n).then((()=>{se.Z.menubarMenu.onOpenBookmark.addListener(d),se.Z.menubarMenu.onBookmarkAction.addListener(ga.Z.onAction),se.Z.menubarMenu.onHover.addListener(ga.Z.onHover),se.Z.bookmarkContextMenu.onOpen.addListener(c),se.Z.bookmarkContextMenu.onClose.addListener(u),se.Z.bookmarkContextMenu.show({windowId:r,id:t,siblings:n,sortField:i,sortOrder:s,edge:Ge.Z.getBookmarkExtrasEdge(),icons:[qe.Z,va.Z,ya.Z,ba.Z,Sa.Z,ma.Z,fa.Z]},(()=>{ga.Z.onHover(r,""),se.Z.menubarMenu.onOpenBookmark.removeListener(d),se.Z.menubarMenu.onBookmarkAction.removeListener(ga.Z.onAction),se.Z.menubarMenu.onHover.removeListener(ga.Z.onHover),se.Z.bookmarkContextMenu.onOpen.removeListener(c),se.Z.bookmarkContextMenu.onClose.removeListener(u),setTimeout((()=>{Ca=!1}),100)}))})))}},Ia={getMenu:async(e,t,n)=>{const s=[];for(const[o,a]of he.ZP.getState()){if(o===e||"normal"!==a.type)continue;const r=(await i.Z.windows.get(o,{populate:!0})).tabs||[],l=r.find((e=>e.active)),d=l&&l.url?pn.jk.getDisplayTitleByUrl(l.url,l.title||l.url):String(s.length+1),c=a.incognito?(0,B.Z)("Private Window with $1 Active Tab ($2)","Private Window with $1 Active Tabs ($2)",[r.length,d]):(0,B.Z)("Window with $1 Active Tab ($2)","Window with $1 Active Tabs ($2)",[r.length,d]);s.push({handler:()=>{const e={inCurrent:!1,inBackground:C.Z.get(I.kTabsOpenNewInBackground),inNewWindow:!1,allowOverride:!1,incognito:!1};zi.ZP.openUrls(o,n,e,t)},...Qe.Z.makeNumberMnemonic(c,s.length)})}return s}},Ta=Ia,Za=(e,t,n)=>(e.dataTransfer.setData("text/uri-list",t),e.dataTransfer.setData("text/plain",t),e.dataTransfer.SetURLAndTitle(t,n),e.dataTransfer.setData("vivaldi/x-title",n),e);var Ea;function ka(e,t,n,i){Ea||(Ea="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Ea,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var _a=ka("span",{className:"separator"}),Na=ka(co,{type:"chevron",size:10});class Pa extends Li.Component{static contextType=ts.Z;refButton=Li.createRef();refTitleInput=Li.createRef();dropMode={support:!1,copy:!1};centerButtonPressed=!1;regularWidth=-1;canHandleClick=!0;constructor(e){super(e),this.state={dragging:!1,title:e.node.title}}componentDidUpdate(){const{HTMLElement:e}=this.context,t=this.refButton.current;t instanceof e&&(this.props.onRendered(this.props.node.id,t.offsetWidth),this.props.editTitle||(this.regularWidth=t.offsetWidth))}componentDidMount(){const{HTMLElement:e}=this.context,t=this.refButton.current;t instanceof e&&this.props.onRendered(this.props.node.id,t.offsetWidth)}_edit=()=>{de.Z.showBookmarkDialog(this.context.vivaldiWindowId,{mode:"edit",id:this.props.node.id,index:-1})};_rename=()=>{this.setState({title:this.props.node.title}),this.props.onEditChanged(this.props.node.id)};_handleEditChange=e=>{this.setState({title:e.target.value})};_handleEditKeyDown=e=>{switch(e.key){case"Enter":this._saveTitle(e.currentTarget.value),this.refTitleInput.current?.blur();break;case"Escape":this._cancelEdit(),this.refTitleInput.current?.blur()}};_killEvent=e=>{e.preventDefault(),e.stopPropagation()};_cancelEdit=()=>{this.setState({title:this.props.node.title}),this.props.onEditChanged("")};_saveTitle=e=>{i.Z.bookmarks.update(this.props.node.id,{title:e})};_handleFocus=e=>{e.currentTarget.select()};_handleEditBlur=e=>{this.state.title||this._cancelEdit(),this.props.onEditChanged(""),this.props.onRendered(this.props.node.id,this.regularWidth)};_delete=()=>{ee.Z.remove([this.props.node.id])};_handleItemMouseDown=e=>{e.button!==es.Z.kLeft&&(this.centerButtonPressed=e.button===es.Z.kCenter,e.preventDefault()),this.canHandleClick=!this.props.menuOpen};_handleItemMouseUp=e=>{e.button===es.Z.kCenter&&(e.preventDefault(),!0===this.centerButtonPressed&&0===e.buttons&&this.props.onItemActivated(this.props.node.id,!0,!1,e))};_handleClick=e=>{this.canHandleClick&&this.props.onItemActivated(this.props.node.id,!0,!0,e),e.preventDefault(),e.stopPropagation()};_handleKeyDown=e=>{switch("Enter"===e.key&&!0===e.repeat&&e.preventDefault(),e.key){case"ArrowUp":case"ArrowDown":case"Enter":this.props.onItemActivated(this.props.node.id,"Enter"===e.key,!0,e);break;case"ArrowLeft":this.props.moveFocus(this.props.node.id,"left",!1);break;case"ArrowRight":this.props.moveFocus(this.props.node.id,"right",!1);break;case"Escape":if(this.props.menuOpen)return;this.props.onLeaveBar();break;default:return}e.preventDefault(),e.stopPropagation()};_handleDrop=e=>{if(e.preventDefault(),e.stopPropagation(),this.dropMode.support&&""!==this.props.dragover.position){const t="on"===this.props.dragover.position?this.props.node.id:this.props.node.parentId,n="on"===this.props.dragover.position?0:this.props.dragover.index+("right"===this.props.dragover.position?1:0);t&&ee.Z.onDropEvent(e,t,n)}this.props.resetDragover()};_handleDragStart=e=>{this.props.onDragStart(this.props.node.id),this.setState({dragging:!0});const t=JSON.stringify([this.props.node.id.toString()]);e.dataTransfer.setData(zi.yR,t);const n=pn.jk.getHoverUrl(g.Z.getUrlByNode(this.props.node));Za(e,n,this.props.node.title),e.dataTransfer.effectAllowed="all"};_handleDragEnd=e=>{this.setState({dragging:!1}),this.props.onDragEnd()};_handleDragLeave=e=>{};_handleDragEnter=e=>{this.dropMode=this.props.getDropModeForEvent(e)};_handleDragOver=e=>{e.preventDefault(),e.stopPropagation(),this.dropMode.support?(e.dataTransfer.dropEffect=this.dropMode.copy?"copy":"move",this.props.onDragOver(this.props.node,e)):e.dataTransfer.dropEffect="none"};_handleBlur=()=>{this.props.onItemBlur(this.props.node.id)};_handleMouseEnter=e=>{if(!this.props.statusOff){const e=g.Z.getUrlByNode(this.props.node);u.Z.setStatus(this.context.vivaldiWindowId,e||this.props.node.title)}this.props.onItemEnter(this.props.node.id)};_handleMouseLeave=e=>{this.props.statusOff||u.Z.clearStatus(this.context.vivaldiWindowId),this.centerButtonPressed=!1,this.props.onItemLeave(this.props.node.id)};_openInNewWindow=(e,t)=>{const n={inCurrent:!1,inBackground:!1,inNewWindow:!0,allowOverride:!1,incognito:t};zi.ZP.open(this.context.vivaldiWindowId,zi.ZP.getBookmarksByNode(e),n,!0)};_openInNewTab=(e,t)=>{const n={inCurrent:!1,inBackground:t||C.Z.get(I.kTabsOpenNewInBackground),inNewWindow:!1,allowOverride:!1,incognito:!1};zi.ZP.open(this.context.vivaldiWindowId,zi.ZP.getBookmarksByNode(e),n,!0)};_open=e=>{zi.ZP.open(this.context.vivaldiWindowId,zi.ZP.getBookmarksByNode(e),{inCurrent:!0,inBackground:!1,inNewWindow:!1,allowOverride:!1,incognito:!1},!0)};_getContextMenuItems=(e,t)=>{const n=this.context.vivaldiWindowId,i=ji.Z.getOptionFunction(e),s=g.Z.isSeparator(t);return ji.Z.getNamedMenu(n,e,(async e=>{switch(e.action){case"CONTEXT_OPEN_IN_NEW_TAB":return{handler:()=>this._openInNewTab(t,!1),isVisible:()=>!s,...i(n,e,{})};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{handler:()=>this._openInNewTab(t,!0),isVisible:()=>!s&&!C.Z.get(I.kTabsOpenNewInBackground),...i(n,e,{})};case"CONTEXT_OPEN_IN_TAB":return{handler:()=>this._open(t),isVisible:()=>!s,...i(n,e,{})};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{handler:()=>this._openInNewWindow(t,!1),isVisible:()=>!s,...i(n,e,{})};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{handler:()=>this._openInNewWindow(t,!0),isVisible:()=>!s,...i(n,e,{})};case"CONTEXT_CONTAINER_OPEN_IN_WINDOW":{const o=await Ta.getMenu(n,!0,zi.ZP.getUrlsByNodes([t]));return{isVisible:()=>!s&&o.length>0,items:o,...i(n,e,{})}}case"CONTEXT_BOOKMARK":return{handler:this.props.addActiveTab,isVisible:()=>!s,...i(n,e,{})};case"CONTEXT_NEW_BOOKMARK":return{handler:this.props.createNewBookmark,...i(n,e,{})};case"CONTEXT_NEW_FOLDER":return{handler:this.props.createNewFolder,...i(n,e,{})};case"CONTEXT_NEW_SEPARATOR":return{handler:this.props.createNewSeparator,isVisible:()=>!this.props.isSorted,...i(n,e,{})};case"CONTEXT_EDIT":return{handler:this._edit,isVisible:()=>!s,...i(n,e,{})};case"CONTEXT_RENAME":return{handler:this._rename,isVisible:()=>!s,...i(n,e,{})};case"CONTEXT_CUT":return{handler:this.props.onCut,isVisible:()=>!s,...i(n,e,{})};case"CONTEXT_COPY":return{handler:this.props.onCopy,isVisible:()=>!s,...i(n,e,{})};case"CONTEXT_PASTE":return{handler:this.props.onPaste,isVisible:()=>!s,...i(n,e,{})};case"CONTEXT_DELETE":return{handler:this._delete,...i(n,e,{})};default:return{...i(n,e,{})}}}))};_onContextMenu=e=>{this.props.editTitle?e.stopPropagation():(e.persist(),e.preventDefault(),e.stopPropagation(),this._getContextMenuItems("bookmarkbaritem",this.props.node).then((t=>{(0,cs.Z)(this.context,t)(e)})))};_onFocus=()=>{this.props.highlighted||this.props.onItemHighlightMissing(this.props.node.id)};render(){const e=this.props.node,t=g.Z.getUrlByNode(e),n=g.Z.isSeparator(e),i=g.Z.isFolder(e);let s;i&&"icon"!==this.props.display?s=(0,B.Z)("Show folder contents"):(s=e.title,t&&(s=s+"\n"+t));let o=!1;"icon"!==this.props.display&&(o="iconexceptfolders"!==this.props.display||!t);const{favIconUrl:a,favIconLoadType:r}=pn.jk.getBookmarkFavicon(e.url,e.faviconUrl);return(0,ss.jsxs)("button",{ref:this.refButton,"data-id":e.id,"data-offset":0,title:s,tabIndex:this.props.keyAccess,className:Fi()({uifocusstop:this.props.uiFocus,bookmarkbarItem:!0,highlighted:this.props.highlighted||this.props.menuOpen,folder:!n&&!e.url,"data-cut":this.props.isCut,dragging:this.state.dragging,dragover:this.props.dragover.id===e.id&&"on"===this.props.dragover.position,dragoverLeft:this.props.dragover.id===e.id&&"left"===this.props.dragover.position,dragoverRight:this.props.dragover.id===e.id&&"right"===this.props.dragover.position}),draggable:!this.props.editTitle,onDragStart:this._handleDragStart,onDragEnd:this._handleDragEnd,onDragEnter:this._handleDragEnter,onDragOver:this._handleDragOver,onDrop:this._handleDrop,onBlur:this._handleBlur,onMouseEnter:this._handleMouseEnter,onMouseLeave:this._handleMouseLeave,onClick:this.props.editTitle?void 0:this._handleClick,onMouseDown:this.props.editTitle?void 0:this._handleItemMouseDown,onMouseUp:this.props.editTitle?void 0:this._handleItemMouseUp,onKeyDown:this.props.editTitle?void 0:this._handleKeyDown,onContextMenu:this._onContextMenu,onFocus:this._onFocus,onKeyUp:this._killEvent,children:[n&&_a,!n&&a&&"text"!==this.props.display&&ka(Ri.ZP,{url:a,loadType:r}),!n&&!e.url&&"text"!==this.props.display&&ka(Ki,{speeddial:e.speeddial}),!n&&!this.props.editTitle&&o&&e.title&&(0,ss.jsxs)(ss.Fragment,{children:["text"===this.props.display&&i&&Na,ka("span",{className:"title"},void 0,e.title)]}),this.props.editTitle&&(0,ss.jsx)("input",{ref:this.refTitleInput,type:"text",value:this.state.title,onFocus:this._handleFocus,onBlur:this._handleEditBlur,onClick:this._killEvent,onKeyDown:this._handleEditKeyDown,onChange:this._handleEditChange,autoFocus:!0})]},e.id)}}const Da=Pa;var Ma,Oa=n(57082),xa=n(5298),La=n(45454),Ra=n(81814),Ba=n(34155);function Fa(e,t,n,i){Ma||(Ma="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Ma,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class Wa extends Li.PureComponent{static contextType=ts.Z;acceptEnterId="";draggedId="";dropMode={support:!1,copy:!1};clipboardId="";timer=null;nodeRef=Li.createRef();constructor(e,t){super(e);const{document:n}=t;this.state={nodes:g.Z.getBookmarksBarNodes(),map:new Map,dragover:{id:"",position:"",index:0},maxWidth:n.documentElement?n.documentElement.clientWidth:0,extenderWidth:0,sorting:{sortOrder:ds.Z.NO_SORTING,sortField:"manually"},cutIds:g.Z.getCutIds(),editId:"",newItemAdded:!1,renderedArray:[],openMenuId:"",highlightedId:""}}componentDidMount(){const e=C.Z.get(I.kBookmarksBarSorting);this._onSortChange(e.sortOrder,e.sortField),g.Z.addListener(this._onStoreChange),Oa.Z.addListener("COMMAND_FOCUS_BOOKMARKBAR",this._onCommandSpy)}componentWillUnmount(){this.timer&&clearTimeout(this.timer),g.Z.removeListener(this._onStoreChange),Oa.Z.removeListener("COMMAND_FOCUS_BOOKMARKBAR",this._onCommandSpy)}_onStoreChange=()=>{const e=g.Z.getBookmarksBarNodes();this.setState((t=>{const n=this._getRenderedItems(e,t.sorting,!0===t.newItemAdded?t.editId:"");return{nodes:e,map:new Map,renderedArray:n,cutIds:g.Z.getCutIds()}}))};_hasFocus=()=>{const{document:e,HTMLElement:t}=this.context,n=this.nodeRef.current;return n instanceof t&&(0,Ra.sT)(e,n)};_onCommandSpy=e=>{e===this.context.vivaldiWindowId&&(this._hasFocus()||this.state.renderedArray.length>0&&this._moveFocus(this.state.renderedArray[0].id,"current",!0))};_getRenderedItems=(e,t,n)=>{const i=structuredClone(e);if(i.length>0&&t&&t.sortOrder>=ds.Z.ASCENDING_SORT){const e=(e,n)=>g.Z.treeSortComparator(e,n,{sortOrder:t.sortOrder,sortField:t.sortField});if(ds.Z.treeSort(i,e),""!==n){const e=i.findIndex((e=>e.id===n));-1!==e&&i.splice(0,0,i.splice(e,1)[0])}}return i};_handleKeyDown=e=>{e.keyCode===xa.Z.KEY_ESCAPE&&this._resetDragover()};_onButtonRendered=(e,t)=>{this.state.map.get(e)!==t&&this.setState((n=>{const i=new Map(n.map);return i.set(e,t),{map:i}}))};_onExtenderRendered=(e,t)=>{this.setState({extenderWidth:e})};_onResize=e=>{const t=e[0].target;this.setState({maxWidth:Math.floor(t.clientWidth)})};_addActiveTab=()=>{const e=g.Z.getBookmarkBarFolderId();if(void 0!==e){const t=Ce.ZP.getActivePage(this.context.vivaldiWindowId);t&&ee.Z.bookmarkPageInFolder(t,e,0)}};_getItemInsertIndex=e=>{const t=this.state.renderedArray.length;return"number"!=typeof e||t<e?t:e};_createNewBookmark=()=>{const e=g.Z.getBookmarkBarFolderId();void 0!==e&&de.Z.showBookmarkDialog(this.context.vivaldiWindowId,{mode:"addbookmark",id:e,index:0})};_createNewFolder=()=>{const e=g.Z.getBookmarkBarFolderId();void 0!==e&&de.Z.showBookmarkDialog(this.context.vivaldiWindowId,{mode:"addfolder",id:e,index:0})};_createNewSeparator=e=>{const t=g.Z.getBookmarkBarFolderId();t&&ee.Z.createSeparator(t,this._getItemInsertIndex(e))};_resetDragover=()=>{this.setState({dragover:{id:"",position:"",index:0}})};_onEditChanged=e=>{""===e?this.setState((e=>({renderedArray:this._getRenderedItems(e.nodes,e.sorting,""),newItemAdded:!1,editId:""}))):this.setState({editId:e})};_onDragEndBookmark=()=>{this.draggedId="",this._resetDragover()};_onDropBar=e=>{if(e.preventDefault(),e.stopPropagation(),this.dropMode.support){const t=g.Z.getBookmarkBarFolderId();if(void 0!==t){const n=g.Z.getBookmarksBarNodes().length;ee.Z.onDropEvent(e,t,n)}}this._resetDragover()};_onDragEnter=e=>{this.dropMode=this._getDropModeForEvent(e)};_onDragOverBar=e=>{e.preventDefault(),e.stopPropagation(),this.dropMode.support?e.dataTransfer.dropEffect=this.dropMode.copy?"copy":"move":e.dataTransfer.dropEffect="none"};_onDragOver=(e,t)=>{const{id:n,index:i}=e;if(n!==this.draggedId&&void 0!==i){var s="";if(this.state.sorting.sortOrder===ds.Z.NO_SORTING){const n=t.currentTarget.getBoundingClientRect(),i=(t.clientX-n.left)/n.width;s=g.Z.isFolder(e)?i<=.33?"left":i>.66?"right":"on":i<=.5?"left":"right"}else g.Z.isFolder(e)&&(s="on");(this.state.dragover.id!==n||this.state.dragover.id===n&&this.state.dragover.position!==s)&&this.setState({dragover:{id:n,position:s,index:i}})}};_onDragStart=e=>{this.draggedId=e};_getDropModeForEvent=e=>{const t={support:!1,copy:!1};return t.support=e.dataTransfer.types.some((e=>zi.ZP.isUriListType(e)||"text/plain"===e||e===zi.yR)),t.support&&(e.dataTransfer.types.some((e=>e===p.Up))?t.copy=!1:t.copy=t.support&&(zi.ZP.isCopyModifierPressed(e)||!e.dataTransfer.types.some((e=>e===zi.yR)))),t};_onCut=e=>{ee.Z.cut(e,[this.clipboardId]),e.stopPropagation(),e.preventDefault()};_onCopy=e=>{ee.Z.copy(e,[this.clipboardId]),e.stopPropagation(),e.preventDefault()};_onPaste=e=>{const t=this.clipboardId===g.Z.getBookmarkBarFolderId();ee.Z.paste(e,this.clipboardId,t),e.preventDefault(),e.stopPropagation()};_onCutContextMenu=e=>{this.clipboardId=e;const{document:t}=this.context;t.addEventListener("cut",this._onCut),t.execCommand("cut"),t.removeEventListener("cut",this._onCut)};_onCopyContextMenu=e=>{this.clipboardId=e;const{document:t}=this.context;t.addEventListener("copy",this._onCopy),t.execCommand("copy"),t.removeEventListener("copy",this._onCopy)};_onPasteContextMenu=e=>{this.clipboardId=e;const{document:t}=this.context;t.addEventListener("paste",this._onPaste),t.execCommand("paste"),t.removeEventListener("paste",this._onPaste)};_onSortOrderChange=()=>{const e=this.state.sorting.sortOrder===ds.Z.DESCENDING_SORT?ds.Z.ASCENDING_SORT:ds.Z.DESCENDING_SORT;this._onSortChange(e,this.state.sorting.sortField)};_onTitleSortChange=e=>{let t=this.state.sorting.sortOrder;"manually"!==e&&t===ds.Z.NO_SORTING?t=ds.Z.ASCENDING_SORT:"manually"===e&&(t=ds.Z.NO_SORTING),this._onSortChange(t,e)};_onSortChange=(e,t)=>{this.setState({sorting:{sortOrder:e,sortField:t}});const n={sortOrder:e,sortField:t};w.Z.set(I.kBookmarksBarSorting,n),this.setState((e=>({renderedArray:this._getRenderedItems(e.nodes,n,!0===e.newItemAdded?e.editId:"")})))};_getContextMenuItems=e=>{const t=this.context.vivaldiWindowId,n=this.state.sorting.sortOrder!==ds.Z.NO_SORTING,i=ji.Z.getOptionFunction(e),s=()=>[{handler:this._onTitleSortChange.bind(this,"manually"),type:"checkbox",checked:"manually"===this.state.sorting.sortField,...(0,us.Z)("radio","Manually")},{handler:this._onTitleSortChange.bind(this,"title"),type:"checkbox",checked:"title"===this.state.sorting.sortField,...(0,us.Z)("by Title")},{handler:this._onTitleSortChange.bind(this,"url"),type:"checkbox",checked:"url"===this.state.sorting.sortField,...(0,us.Z)("by Address")},{handler:this._onTitleSortChange.bind(this,"nickname"),type:"checkbox",checked:"nickname"===this.state.sorting.sortField,...(0,us.Z)("by Nickname")},{handler:this._onTitleSortChange.bind(this,"description"),type:"checkbox",checked:"description"===this.state.sorting.sortField,...(0,us.Z)("by Description")},{handler:this._onTitleSortChange.bind(this,"dateAdded"),type:"checkbox",checked:"dateAdded"===this.state.sorting.sortField,...(0,us.Z)("by Date Created")},Qe.Z.separatorItem,{handler:this._onSortOrderChange,isVisible:()=>this.state.sorting.sortOrder!==ds.Z.NO_SORTING&&this.state.sorting.sortOrder===ds.Z.ASCENDING_SORT,...(0,us.Z)("Descending")},{handler:this._onSortOrderChange,isVisible:()=>this.state.sorting.sortOrder!==ds.Z.NO_SORTING&&this.state.sorting.sortOrder!==ds.Z.ASCENDING_SORT,...(0,us.Z)("Ascending")}];return ji.Z.getNamedMenu(t,e,(async e=>{switch(e.action){case"CONTEXT_BOOKMARK":return{handler:this._addActiveTab,...i(t,e,{})};case"CONTEXT_NEW_BOOKMARK":return{handler:this._createNewBookmark,...i(t,e,{})};case"CONTEXT_NEW_FOLDER":return{handler:this._createNewFolder,...i(t,e,{})};case"CONTEXT_NEW_SEPARATOR":return{handler:()=>{this._createNewSeparator(void 0)},isVisible:()=>!n,...i(t,e,{})};case"CONTEXT_PASTE":return{handler:()=>{const e=g.Z.getBookmarkBarFolderId();void 0!==e&&this._onPasteContextMenu(e)},...i(t,e,{})};case"CONTEXT_CONTAINER_SORT":return{items:s(),...i(t,e,{})};default:return{...i(t,e,{})}}}))};_moveFocus=(e,t,n)=>{if(!0===n||this._hasFocus()){const{document:n,HTMLButtonElement:i}=this.context,s=Array.from(n.querySelectorAll("button.bookmarkbarItem")).map((e=>e.getAttribute("data-id"))).filter(Boolean);if("current"===t){const t=parseInt(e)<0?0:s.indexOf(e);if(-1===t)return;e=s[t]}else if("right"===t||"left"===t){if(1===s.length)return;let n=s.indexOf(e);n="right"===t?n+1>=s.length?0:n+1:n<=0?s.length-1:n-1,e=s[n]}const o=n.querySelector(`button.bookmarkbarItem[data-id="${e}"]`);o&&o instanceof i&&this.setState({highlightedId:e},(()=>o.focus()))}};_handleItemActivated=(e,t,n,i)=>{const s=g.Z.getItemById(e);if(s)if(g.Z.isFolder(s)&&n){const e=this._getMenuSorting(),t="top"===C.Z.get(I.kBookmarksBarPosition)?"bottom":"top";Aa.show(this.context,s.id,this._getFolderSiblings(),e.field,e.order,t,this._onMenuVisibilityChanged)}else if(t&&i){const e=this.context.vivaldiWindowId,t=(0,La.ZP)(e,{ctrlKey:i.ctrlKey,altKey:i.altKey,shiftKey:i.shiftKey,metaKey:i.metaKey,button:"number"==typeof i.button?i.button:-1});zi.ZP.open(e,zi.ZP.getBookmarksByNode(s),t,!0),de.Z.setPaneFocus(this.context.vivaldiWindowId,!1)}};_handleItemEnter=e=>{""!==this.acceptEnterId&&this.acceptEnterId!==e||this.state.editId||(this._hasFocus()&&this._moveFocus(e,"current",!0),this.setState({highlightedId:e}))};_handleItemLeave=e=>{""===this.state.openMenuId&&this.setState({highlightedId:""})};_handleItemBlur=e=>{Ba.nextTick((()=>{this._hasFocus()||this.setState({highlightedId:""})}))};_handleItemHighlightMissing=e=>{this.setState({highlightedId:e})};_handleLeaveBar=()=>{de.Z.setPaneFocus(this.context.vivaldiWindowId,!1),ne.Z.executeActions("event",this.context,"COMMAND_FOCUS_WEBVIEW")};_getMenuSorting=()=>ds.Z.toMenuSorting(this.state.sorting.sortOrder,this.state.sorting.sortField);_getFolderSiblings=()=>{const{document:e}=this.context;return Array.from(e.querySelectorAll("button.bookmarkbarItem")).filter((e=>e.classList.contains("folder")||e.classList.contains("chevron"))).map((e=>{const t=e.getBoundingClientRect();return{id:e.dataset.id,offset:Number(e.dataset.offset),folderGroup:Boolean(e.classList.contains("folder")||e.classList.contains("chevron")),rect:{x:parseInt(t.left),y:parseInt(t.top),width:parseInt(t.width),height:parseInt(t.height)}}}))};_onMenuVisibilityChanged=(e,t)=>{""===e?(this.acceptEnterId=this.state.openMenuId,this.timer=setTimeout((()=>{this.acceptEnterId="",this.timer=null}),100),this._hasFocus()&&t?this._moveFocus(this.state.openMenuId,"current",!0):this.setState({highlightedId:""})):(this.setState({highlightedId:e}),this._moveFocus(e,"current",!1)),this.setState({openMenuId:e})};_isSorted=()=>"manually"!==this.state.sorting.sortField;_onContextMenu=e=>{e.persist(),e.preventDefault(),e.stopPropagation(),this._getContextMenuItems("bookmarkbar").then((t=>{(0,cs.Z)(this.context,t)(e)}))};_renderBookmarkBarButton=(e,t)=>(0,ss.jsx)(Da,{ref:e.id,node:e,editTitle:this.state.editId===e.id,isCut:-1!==this.state.cutIds.indexOf(e.id),menuOpen:this.state.openMenuId===e.id,display:this.props.display,statusOff:this.props.statusOff,dragover:this.state.dragover,highlighted:this.state.highlightedId===e.id,keyAccess:0===t?this.props.keyAccess:-1,uiFocus:0===t,moveFocus:this._moveFocus,onItemActivated:this._handleItemActivated,onItemEnter:this._handleItemEnter,onItemLeave:this._handleItemLeave,onItemBlur:this._handleItemBlur,onItemHighlightMissing:this._handleItemHighlightMissing,onLeaveBar:this._handleLeaveBar,onEditChanged:this._onEditChanged,onDragStart:this._onDragStart,onDragEnd:this._onDragEndBookmark,onDragOver:this._onDragOver,getDropModeForEvent:this._getDropModeForEvent,addActiveTab:this._addActiveTab,createNewBookmark:this._createNewBookmark,createNewFolder:this._createNewFolder,createNewSeparator:()=>this._createNewSeparator(t),isSorted:this._isSorted(),resetDragover:this._resetDragover,onRendered:this._onButtonRendered,onCut:this._onCutContextMenu.bind(this,e.id),onCopy:this._onCopyContextMenu.bind(this,e.id),onPaste:this._onPasteContextMenu.bind(this,e.id)},e.id);render(){let e=0;const t=[];let n=0,i="",s=0;for(let o=0;o<this.state.renderedArray.length;o++){const a=this.state.renderedArray[o];if(!this._isSorted()||!g.Z.isSeparator(a)){const r=this.state.map.get(a.id),l=e+("number"==typeof r?r:28);if(l>this.state.maxWidth||l+this.state.extenderWidth>this.state.maxWidth&&o+1<this.state.renderedArray.length){n=o,""===this.state.editId&&this.state.renderedArray[0].parentId&&(i=this.state.renderedArray[0].parentId);break}t.push(this._renderBookmarkBarButton(a,s)),s++,e=l}}const o=""!==i?Fa(ha,{id:i,offset:n,keyAccess:-1,menuOpen:this.state.openMenuId===i,highlighted:this.state.highlightedId===i,moveFocus:this._moveFocus,onRendered:this._onExtenderRendered,onItemActivated:this._handleItemActivated,onItemEnter:this._handleItemEnter,onItemLeave:this._handleItemLeave,onItemBlur:this._handleItemBlur,onItemHighlightMissing:this._handleItemHighlightMissing,onLeaveBar:this._handleLeaveBar}):null;return(0,ss.jsx)("div",{ref:this.nodeRef,role:"toolbar","aria-label":(0,B.Z)("toolbar label","Bookmarks"),inert:this.props.inert?"inert":null,className:`bookmark-bar ${this.props.display}`,onDragEnter:this._onDragEnter,onDragOver:this._onDragOverBar,onDragLeave:this._resetDragover,onDrop:this._onDropBar,onContextMenu:this._onContextMenu,children:Fa(Yi.Z,{className:"observer",onKeyDown:this._handleKeyDown,onResize:this._onResize},void 0,t,o)})}}const Ua=Wa;var Va,Ha=n(15590),Ga=n(27508),$a=n(84675),Ka=n(29717),za=n(63377),ja=n(4949),Ya=n(14507);function Xa(e,t,n,i){Va||(Va="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Va,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Qa=[{icon:Wi.oa7,mode:"area",label:(0,B.Z)("capture","Selection")},{icon:Wi.$O3,mode:"fullpage",label:(0,B.Z)("Full Page")}],qa=[{value:"png",label:(0,B.Z)("Save as PNG")},{value:"jpg",label:(0,B.Z)("Save as JPEG")},{value:"clipboard",label:(0,B.Z)("panel","Copy to Clipboard")},{value:"note",label:(0,B.Z)("Create Note with...")}],Ja=12;const er=e=>{const t=Li.useContext(ts.Z),{innerWidth:n}=t,{isOffScreenBelow:i,isOffScreenLeft:s,isOffScreenTopAndBottom:o}=function(e){const t=Li.useContext(ts.Z);let n=!1,i=!1,s=!1,o=!1;if(!e)return{isOffScreenTopAndBottom:s,isOffScreenBelow:n,isOffScreenLeft:o};const{top:a,height:r,left:l,width:d}=e,{innerHeight:c}=t;return i=a<46,o=l+d<300,n=c>a+r+34+17,s=!n&&i,{isOffScreenBelow:n,isOffScreenLeft:o,isOffScreenTopAndBottom:s}}(e);if(!e)return null;const{top:a,height:r,left:l}=e;return o?{left:l+Ja,top:a+r-34-Ja}:e?{top:i?e.top+e.height+Ja:e.top-34-Ja,...s?{left:e.left}:{right:n-(e.left+e.width)}}:null},tr=[I.kWebpagesCaptureSaveLocation,I.kWebpagesCaptureCompressionFormat,I.kKeyboardTabToAll];function nr({winId:e,captureSquare:t,mode:n,setMode:i,inProgress:s,isInternalUrl:o,setFormat:a,doScreenshot:r}){const l=(0,Ya.Z)(tr),d=er(t),c=l[I.kWebpagesCaptureSaveLocation],u="clipboard"===c||"note"===c?c:l[I.kWebpagesCaptureCompressionFormat];return Xa("form",{className:Fi()("ControlPanel",{Default:!d,InProgress:s}),style:d,onKeyDown:t=>function(e,t){e.keyCode===xa.Z.KEY_ESCAPE&&$a.Z.cancelCallback(t)}(t,e),onSubmit:r,role:"dialog","aria-modal":"true","aria-label":(0,B.Z)("Capture Page Screenshot")},void 0," ",s?(0,ss.jsxs)(ss.Fragment,{children:[Xa("span",{dangerouslySetInnerHTML:{__html:Wi.GO5.medium}}),Xa("span",{role:"status"},void 0,(0,B.Z)("Capturing Screenshot…"))]}):Xa(za.Z,{focusName:"focus-capture-dialog",forceTrap:!0},void 0,!t&&Xa(ja.Z,{name:"modePicker",className:"ControlPanel-ModeSelector",onChange:i,disabled:o,value:n},void 0,Qa.map((e=>{if(e.mode.includes("fullpage")&&o)return null;return Xa("label",{className:Fi()("ControlPanel-ModeSelector--Option",{Active:e.mode.includes(n)})},e.mode,Xa("span",{dangerouslySetInnerHTML:{__html:e.icon}}),Xa("input",{type:"radio",value:e.mode,tabIndex:o?-1:l[I.kKeyboardTabToAll]}),Xa("span",{},void 0,e.label))}))),Xa("div",{className:"ControlPanel-Output"},void 0,Xa("label",{className:"ControlPanel-Output--Description",htmlFor:"capture:format"},void 0,(0,B.Z)("format","Output")),Xa(ta.Z,{id:"capture:format",className:"ControlPanel-Output--Select",onChange:a,value:u},void 0,qa.map((e=>Xa("option",{value:e.value},e.value,e.label)))),Xa("input",{className:"ControlPanel-Output--CaptureButton primary",type:"submit",onMouseDown:ms.ZP,onTouchStart:ms.ZP,disabled:"fullpage"!==n&&!("area"===n&&void 0!==t),value:(0,B.Z)("image","Capture")}))))}var ir;function sr(e,t,n,i){ir||(ir="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:ir,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const or=10,ar=[I.kWebpagesCaptureCaptureMode,I.kWebpagesCaptureCompressionFormat,I.kWebpagesCaptureSaveLocation],rr=["TopLeft","TopMid","TopRight","BottomLeft","BottomMid","BottomRight","MidLeft","MidRight"],lr=e=>{const t=Ce.ZP.getActivePage(e);return!(!t?.id||!t?.url)&&pn.jk.isInternalUrl(t?.url)};function dr(e){const t=(0,Ya.Z)(ar),n=(0,Li.useRef)(null),i=(0,Li.useRef)(null),s=(0,Li.useRef)(0),o=(0,Li.useRef)(0),a=(0,Li.useRef)(0),r=(0,Li.useRef)(0),l=(0,Li.useRef)({}),[d,c]=(0,Li.useState)(lr(e.winId)),u=d?"area":t[I.kWebpagesCaptureCaptureMode],p=(0,Li.useContext)(ts.Z),[h,g]=(0,Li.useState)(null),[m,f]=(0,Li.useState)(!1),[v,y]=(0,Li.useState)(!1);(0,Li.useEffect)((()=>{n.current?.focus()}),[]);const{winId:b}=e;(0,Li.useEffect)((()=>{const e=()=>{c(lr(b))};return Ce.ZP.addListener(e,p.selectWindow),()=>{Ce.ZP.removeListener(e)}}),[p.selectWindow,b]);const S=()=>{const{x3:e,x4:t,y3:n,y4:i}={x3:Math.round(Math.min(s.current,o.current)),x4:Math.round(Math.max(s.current,o.current)),y3:Math.round(Math.min(a.current,r.current)),y4:Math.round(Math.max(a.current,r.current))},l=p.innerWidth,d=p.innerHeight;g({rectStyle:{left:e,top:n,width:t-e,height:i-n},areaStyle:{background:"transparent",borderWidth:`${n}px ${l-t}px ${d-i}px ${e}px`}})},C=e=>{f(!0),S();const t=Math.round(e.clientX),n=Math.round(e.clientY),i=Math.abs(t-s.current)<=8,d=Math.abs(t-o.current)<=8,c=Math.abs(n-a.current)<=8,u=Math.abs(n-r.current)<=8;l.current={x1:i,x2:d,y1:c,y2:u};const{HTMLElement:h}=p;e.target instanceof h&&e.target.setPointerCapture(e.pointerId)},A=e=>{m&&(l.current.x1&&(s.current=e.clientX),l.current.x2&&(o.current=e.clientX),l.current.y1&&(a.current=e.clientY),l.current.y2&&(r.current=e.clientY),T(),S())},T=()=>{const e=s.current,t=o.current,n=a.current,i=r.current,{innerWidth:l,innerHeight:d}=p;e>l?s.current=l:t>e?(l-t<or&&(o.current=l),e<or&&(s.current=0)):t<or&&(o.current=0),n>d?a.current=d:i>n?(d-i<or&&(r.current=d),n<or&&(a.current=0)):i<or&&(r.current=0)},Z=t=>{if(m){const{HTMLElement:n}=p;t.target instanceof n&&t.target.releasePointerCapture(t.pointerId),f(!1);const{current:s}=i;if(!s)return;const{width:o,height:a}=s.getBoundingClientRect();(o<=3||a<=3)&&$a.Z.cancelCallback(e.winId)}},E=()=>{const{current:e}=i,{current:t}=n;if(e&&t)if("area"===u){g({areaStyle:{borderColor:"rgba(0,0,0,0)",visibility:"hidden"},rectStyle:void 0}),f(!0),t.addEventListener("transitionend",k,!0)}else y(!0),_()},k=()=>{n.current?.removeEventListener("transitionend",k);const t={x:Math.min(s.current,o.current),y:Math.min(a.current,r.current),width:Math.max(o.current,s.current)-Math.min(s.current,o.current),height:Math.max(r.current,a.current)-Math.min(r.current,a.current)};$a.Z.performCapture({windowId:p.vivaldiWindowId,mode:u,opts:t,noteId:e.capturing.noteId})},_=async()=>{const n=t[I.kWebpagesCaptureSaveLocation],i=t[I.kWebpagesCaptureCompressionFormat],s=Ce.ZP.getActivePage(e.winId)?.id;if(!s)return;const{image:o}=await $a.Z.captureFullpage(s,i,n);y(!1),Ka.Z.disableCapture(e.winId),$a.Z.handleCaptureLocation({windowId:e.winId,mode:u,base64:o,noteId:e.capturing.noteId})},N=Fi()("CaptureArea","PreserveTransitions",{Area:"area"===u,FullPage:"area"!==u}),P=Fi()("CaptureRect",{Hidden:!h?.rectStyle});return(0,ss.jsxs)(ss.Fragment,{children:[(0,ss.jsx)("div",{ref:n,style:h?.areaStyle,id:"capture-area",className:N,tabIndex:0,onKeyDown:t=>{const{keyCode:n}=t;n===xa.Z.KEY_ESCAPE?($a.Z.cancelCallback(e.winId),m&&f(!1)):n!==xa.Z.KEY_ENTER&&n!==xa.Z.KEY_RETURN||E()},onPointerDown:e=>{if(!u.includes("area"))return;f(!0),s.current=o.current=e.clientX,a.current=r.current=e.clientY,S();const{HTMLElement:t}=p;e.target instanceof t&&e.target.setPointerCapture(e.pointerId),(0,ms.ZP)(e)},onPointerMove:e=>{m&&(o.current=e.clientX,r.current=e.clientY,T(),S())},onPointerUp:Z}),!m&&sr(nr,{winId:e.winId,captureSquare:h?.rectStyle,isInternalUrl:d,inProgress:v,mode:u,setMode:e=>{const{value:t}=e.target;"area"!==t&&"fullpage"!==t||w.Z.set(I.kWebpagesCaptureCaptureMode,t)},setFormat:e=>{const{value:t}=e.target;"png"===t||"jpg"===t?(w.Z.set(I.kWebpagesCaptureSaveLocation,"file"),w.Z.set(I.kWebpagesCaptureCompressionFormat,t)):w.Z.set(I.kWebpagesCaptureSaveLocation,t)},doScreenshot:E}),(0,ss.jsx)("div",{ref:i,style:h?.rectStyle,className:P,children:rr.map((e=>sr("div",{className:`CaptureRect-Corner ${e}`,onPointerDown:C,onPointerMove:A,onPointerUp:Z},e)))})]})}var cr=n(48588);class ur extends m.Z{getInitialState(){return new Map}reduce(e,t){switch(t.actionType){case"CAPTURE_ENABLE":const{noteId:n}=t;return new Map(e).set(t.winId,{capturing:!0,noteId:n});case"CAPTURE_DISABLE":return(0,cr.u4)(e,t.winId)}return e}getCapturingState(e){return this.getState().get(e)}}const pr=new ur;var hr=n(65398);class gr extends hr.Z{_storeState=new Map;getUtilityWebView(e){return this._storeState.get(e)}dispatchAction(e){if("UTILITY_WEBVIEW_SET_VIEW"===e.actionType)this._storeState.set(e.windowId,e.webview),this.emitChange()}}const mr=new gr(A.Z);var fr,vr=n(70864),yr=n(67074);function br(e,t,n,i){fr||(fr="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:fr,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Sr=1e6,wr=[{text:(0,B.Z)("Past Hour"),value:"past_hour",format:"h",difference:-1},{text:(0,B.Z)("Past Day"),value:"past_day",format:"d",difference:-1},{text:(0,B.Z)("Past Week"),value:"past_week",format:"d",difference:-7},{text:(0,B.Z)("Past 4 Weeks"),value:"past_4_weeks",format:"d",difference:-28},{text:(0,B.Z)("All Time"),value:"everything",format:"",difference:0}],Cr=[{value:"history",category:"history",text:(0,B.Z)("Browsing History")},{value:"typedHistory",category:"history",text:(0,B.Z)("Typed History")},{value:"siteUsageData",category:"history",text:(0,B.Z)("Site Usage Data")},{value:"translateHistory",category:"history",text:(0,B.Z)("Translation History")},{value:"downloads",category:"downloads",text:(0,B.Z)("Downloads")},{value:"cookies",category:"sitedata",text:(0,B.Z)("Cookies")},{value:"sessionCookies",category:"sitedata",text:(0,B.Z)("Cookies")},{value:"persistentCookies",category:"sitedata",text:(0,B.Z)("Cookies")},{value:"pluginData",category:"sitedata",text:(0,B.Z)("Plugin Data")},{value:"localStorage",category:"storage",text:(0,B.Z)("Storage (including Extension Storage)")},{value:"fileSystems",category:"storage",text:(0,B.Z)("File Systems")},{value:"webSQL",category:"storage",text:(0,B.Z)("Web SQL")},{value:"serverBoundCertificates",category:"storage",text:(0,B.Z)("Server Bound Certificates")},{value:"indexedDB",category:"storage",text:(0,B.Z)("Indexed DB")},{value:"serviceWorkers",category:"storage",text:(0,B.Z)("Service Workers")},{value:"cache",category:"caches",text:(0,B.Z)("Cache")},{value:"cacheStorage",category:"caches",text:(0,B.Z)("Cache Storage")},{value:"discardUserData",category:"caches",text:(0,B.Z)("Discard User Data")},{value:"passwords",category:"passwords",text:(0,B.Z)("Passwords (including your Sync login password)")},{value:"formData",category:"forms",text:(0,B.Z)("Form Autofill Data")},{value:"appcache",category:"appcache",text:(0,B.Z)("Applications Cache")},{value:"siteSettings",category:"sitesettings",text:(0,B.Z)("Site Settings")}];var Ar=br("p",{className:"in-progress"});class Ir extends Li.PureComponent{static contextType=ts.Z;constructor(e){super(e);const t=Cr.reduce(((e,t)=>(e[t.value]=!1,e)),{}),n=C.Z.get(I.kClearPrivateDataEntries);n&&Object.entries(n).forEach((([e,i])=>{void 0===t[e]&&delete n[e]})),Object.assign(t,n);const i=new Map;Cr.forEach((e=>{const t=i.get(e.category);t?t.push(e):i.set(e.category,[e])})),i.forEach((e=>{if(e.length>1){let n=0;e.forEach((e=>{t[e.value]&&n++})),0!==n&&n!==e.length&&e.forEach((e=>{t[e.value]=!0}))}}));const s={};let o=!0;Object.keys(t).forEach((e=>{s[e]=0,t[e]||(o=!1)})),this.state={all:o,inProgress:!1,deleteHistoryFrom:C.Z.get(I.kClearPrivateDataRange),dataToRemove:t,dataToRemoveCounters:s}}componentDidMount(){this.updateClearDownloadsCounters(),this.updateClearBrowsingHistoryCounters()}selectChanged=e=>{this.updateClearDownloadsCounters({deleteHistoryFrom:e.target.value}),this.updateClearBrowsingHistoryCounters({deleteHistoryFrom:e.target.value}),this.setState({deleteHistoryFrom:e.target.value})};_onYes=e=>{const{dataToRemove:t,deleteHistoryFrom:n}=this.state;w.Z.set(I.kClearPrivateDataEntries,t),w.Z.set(I.kClearPrivateDataRange,n),this.setState({inProgress:!0}),e={deleteHistoryFrom:n,...e};const s=wr.find((e=>n===e.value)),o=s&&"everything"!==n?W()().add(s.difference,s.format).startOf(s.format).valueOf():0,a=mr.getUtilityWebView(this.context.vivaldiWindowId);if(!a)return;const{downloads:r,formData:l,history:d,serverBoundCertificates:c,serviceWorkers:u,siteUsageData:p,pluginData:h,passwords:g,typedHistory:m,translateHistory:f,siteSettings:v,discardUserData:y,...b}=t;a.clearData({since:o},b,(()=>{i.Z.runtime.lastError&&console.warn("Error clearing data: ",i.Z.runtime.lastError.message);const{typedHistory:e,translateHistory:n,sessionCookies:s,persistentCookies:a,discardUserData:r,...l}=t;i.Z.browsingData.remove({since:o},l).catch((e=>{console.warn("Error clearing data: ",e.message)})),t.history&&(Me.removeLocalHistory(o),se.Z.contentBlocking.clearBlockedCounters()),t.translateHistory&&se.Z.translateHistory.reset(o),t.discardUserData&&(ee.Z.emptyTrash(),zn.Z.emptyTrash(),vr.Z.emptyTrash());!Oi.Z.isEnabled("omnibox")&&t.typedHistory&&ri.Z.deleteTypedHistoryPeriod(o),se.Z.utilities.cleanUnusedImages(0),this.props.onYes?.()}))};_onNo=()=>{this.props.onNo&&this.props.onNo()};updateClearDownloadsCounters=e=>{if("everything"===(e={deleteHistoryFrom:this.state.deleteHistoryFrom,downloads:this.state.dataToRemove.downloads,...e}).deleteHistoryFrom)i.Z.downloads.search({},(e=>{this.setState((t=>({dataToRemoveCounters:{...t.dataToRemoveCounters,downloads:e.length}})))}));else{const t=this.getSelectedStartTime(e.deleteHistoryFrom);i.Z.downloads.search({},(e=>{const n=e.filter((e=>W()(e.startTime).valueOf()>t));this.setState((e=>({dataToRemoveCounters:{...e.dataToRemoveCounters,downloads:n.length}})))}))}};getSelectedStartTime=e=>{const t=wr.find((t=>e===t.value));let n;return n=t?W()().add(t.difference,t.format).startOf(t.format).valueOf():W()().add(-1,"h").startOf("h").valueOf(),n};updateClearBrowsingHistoryCounters=e=>{if("everything"===(e={deleteHistoryFrom:this.state.deleteHistoryFrom,history:this.state.dataToRemove.history,...e}).deleteHistoryFrom)i.Z.history.search({text:"",startTime:0,maxResults:Sr},(e=>{this.setState((t=>({dataToRemoveCounters:{...t.dataToRemoveCounters,history:e.length}})))}));else{const t=this.getSelectedStartTime(e.deleteHistoryFrom);i.Z.history.search({text:"",maxResults:Sr,startTime:t},(e=>{this.setState((t=>({dataToRemoveCounters:{...t.dataToRemoveCounters,history:e.length}})))}))}};toggleAll=()=>{this.setState((e=>{const t=!e.all,n={};return Object.keys(e.dataToRemove).forEach((e=>{n[e]=t})),{all:t,dataToRemove:n}}))};toggleOne=(e,t)=>{"history"===e&&this.updateClearBrowsingHistoryCounters({history:t.target.checked}),"downloads"===e&&this.updateClearDownloadsCounters({downloads:t.target.checked});const n=Cr.reduce(((n,i)=>(i.category===e&&(n[i.value]=t.target.checked),n)),{});this.setState((e=>{const t={...e.dataToRemove,...n};return{dataToRemove:t,all:Boolean(!Object.keys(t).find((e=>!1===t[e])))}}))};render(){if(he.ZP.isGuest())return br("header",{className:"dialog-header"},void 0,br("p",{className:"error"},void 0,(0,B.Z)("Delete Browsing Data not available from guest windows.")));const e=wr.map((e=>br("option",{value:e.value},e.value,e.text))),t=Boolean(!Object.keys(this.state.dataToRemove).find((e=>!0===this.state.dataToRemove[e]))),n=Cr.map(((e,t,n)=>{if(!n[t-1]||e.category!==n[t-1].category)return br("li",{style:{paddingLeft:"18px"}},e.value,br("label",{},void 0,br("input",{type:"checkbox",checked:this.state.dataToRemove[e.value],onChange:t=>this.toggleOne(e.category,t)}),br("span",{},void 0,e.text),this.state.dataToRemoveCounters[e.value]>0&&this.state.dataToRemove[e.value]&&br("span",{className:"item-count"},void 0,this.state.dataToRemoveCounters[e.value])))}));var i=br("div",{className:"dialog-clear-data"},void 0,br("form",{className:"dialog-clear-data",onSubmit:this._onYes},void 0,br("div",{className:"dialog-content"},void 0,br("div",{className:"setting-single"},void 0,br("label",{},void 0,br("span",{},void 0,(0,B.Z)("Delete Data for:")),br(ta.Z,{onChange:this.selectChanged,value:this.state.deleteHistoryFrom,autoFocus:!0},void 0,e))),br("div",{className:"setting-single pad-top"},void 0,br("ul",{},void 0,br("li",{style:{paddingBottom:"6px"}},void 0,br("label",{},void 0,br("input",{type:"checkbox",checked:this.state.all,onChange:this.toggleAll}),br("span",{},void 0,(0,B.Z)("browser","All")))),n))),br("footer",{className:"dialog-footer"},void 0,br("input",{type:"submit",disabled:this.state.inProgress||t,value:(0,B.Z)("title","Delete")}),br("input",{type:"button",onClick:this._onNo,disabled:this.state.inProgress,value:(0,B.Z)("Cancel")}),this.state.inProgress&&Ar)));return(0,yr.ZP)(i,this.props.filter)}}const Tr=Ir;var Zr,Er,kr;function _r(e,t,n,i){Zr||(Zr="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Zr,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function Nr(e){return _r(ra.Z,{onRequestClose:e.onClose,title:(0,B.Z)("title","Delete Browsing Data")},void 0,_r(Tr,{onNo:e.onClose,onYes:e.onClose}))}function Pr(e,t,n,i){Er||(Er="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Er,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class Dr extends Li.Component{static contextType=ts.Z;context;state={doNotShowAgain:!1};_onNo=()=>{this.props.onRequestClose()};_onYes=()=>{w.Z.set(I.kTabsConfirmClosingTabs,!this.state.doNotShowAgain),this.props.onRequestClose(),c.ZP.closePage(this.props.options.pages,{bypassConfirm:!0})};_toggleDoNotShowAgain=()=>{this.setState((e=>({doNotShowAgain:!e.doNotShowAgain})))};render(){return Pr(ra.Z,{onRequestClose:this._onNo,title:(0,B.Z)("title","Close Tabs")},void 0,Pr("form",{onSubmit:this._onYes},void 0,Pr("div",{className:"dialog-content"},void 0,Pr("p",{},void 0,(0,B.Z)("Do you want to close $1 tab?","Do you want to close $1 tabs?",[this.props.options.pages.size])),Pr("label",{className:"dialog-checkbox"},void 0,Pr("input",{type:"checkbox",checked:this.state.doNotShowAgain,onChange:this._toggleDoNotShowAgain}),Pr("span",{},void 0,(0,B.Z)("Do not ask again")))),Pr("footer",{className:"dialog-footer"},void 0,Pr("input",{type:"submit",onClick:this._onYes,value:(0,B.Z)("command","Close Tabs"),autoFocus:!0}),Pr("input",{type:"button",onClick:this._onNo,value:(0,B.Z)("Cancel")}))))}}function Mr(e,t,n,i){kr||(kr="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:kr,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class Or extends Li.Component{static contextType=ts.Z;context;state={doNotShowAgain:!1};_onNo=()=>{this.props.onRequestClose()};_onYes=()=>{w.Z.set(I.kBookmarksConfirmOpening,!this.state.doNotShowAgain),this.props.onRequestClose(),c.ZP.openUrls(this.context.vivaldiWindowId,this.props.options.urls,{...this.props.options.openOptions})};_toggleDoNotShowAgain=()=>{this.setState((e=>({doNotShowAgain:!e.doNotShowAgain})))};render(){return Mr(ra.Z,{onRequestClose:this._onNo,title:(0,B.Z)("Open Multiple Links")},void 0,Mr("form",{onSubmit:this._onYes},void 0,Mr("div",{className:"dialog-content"},void 0,Mr("p",{},void 0,(0,B.Z)("Do you want to open $1 link?","Do you want to open $1 links?",[this.props.options.urls.length])),Mr("label",{className:"dialog-checkbox"},void 0,Mr("input",{type:"checkbox",checked:this.state.doNotShowAgain,onChange:this._toggleDoNotShowAgain}),Mr("span",{},void 0,(0,B.Z)("Do not ask again")))),Mr("footer",{className:"dialog-footer"},void 0,Mr("input",{type:"submit",onClick:this._onYes,value:(0,B.Z)("Open All Links"),autoFocus:!0}),Mr("input",{type:"button",onClick:this._onNo,value:(0,B.Z)("Cancel")}))))}}var xr,Lr=n(89555);function Rr(e,t,n,i){xr||(xr="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:xr,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Br={width:400,minWidth:"unset"};var Fr=Rr(co,{type:"close",size:16});class Wr extends Li.Component{state={updated:!1};render(){const{extraClassName:e,header:t,renderBody:n,acceptButtonName:i,onAccept:s,onAcceptText:o,secondaryButtonName:a,onSecondaryButtonClick:r,onDismiss:l}=this.props;return Rr(ra.Z,{onRequestClose:Lr.Z,style:Br,className:Fi()("context-anchor",e,{updated:this.state.updated})},void 0,Rr("div",{className:"dialog-header"},void 0,Rr("h1",{className:"dialog-title"},void 0,t&&Rr("span",{},void 0,t),Rr("button",{className:"close transparent",onClick:l,title:(0,B.Z)("Close")},void 0,Fr))),Rr("div",{className:"dialog-content"},void 0,n()),Rr("footer",{className:"dialog-footer tips"},void 0,a&&r&&Rr("input",{type:"button",value:a,onClick:r}),this.state.updated&&o?Rr("p",{className:"update-text"},void 0,o):Rr("input",{type:"button",className:"primary",value:i,onClick:o?()=>{this.setState({updated:!0}),setTimeout(s,2e3)}:s})))}}const Ur=Wr;var Vr,Hr=n(25051);function Gr(e,t,n,i){Vr||(Vr="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Vr,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var $r=Gr("img",{src:"resources/tip-img-mail.png",className:"tip-image-light"}),Kr=Gr("img",{src:"resources/tip-img-mail-dark.png",className:"tip-image-dark"});const zr=()=>(0,ss.jsxs)(ss.Fragment,{children:[$r,Kr,Gr("p",{},void 0,(0,B.Z)("Manage all your inboxes in one place with Vivaldi Mail – private, powerful, and fully integrated."))]});var jr=Gr("img",{src:"resources/tip-img-calendar.png",className:"tip-image-light"}),Yr=Gr("img",{src:"resources/tip-img-calendar-dark.png",className:"tip-image-dark"});const Xr=()=>(0,ss.jsxs)(ss.Fragment,{children:[jr,Yr,Gr("p",{},void 0,(0,B.Z)("All your calendars, in one place. Get organized with a flexible calendar – fully integrated into Vivaldi."))]});var Qr=Gr("img",{src:"resources/tip-img-sync.png",className:"tip-image-light"}),qr=Gr("img",{src:"resources/tip-img-sync-dark.png",className:"tip-image-dark"});const Jr=()=>(0,ss.jsxs)(ss.Fragment,{children:[Qr,qr,Gr("p",{},void 0,(0,B.Z)("Keep your data encrypted and secure across all your devices. Pick up right where you left off."))]});var el=Gr("img",{src:"resources/tip-img-workspaces.png",className:"tip-image-light"}),tl=Gr("img",{src:"resources/tip-img-workspaces-dark.png",className:"tip-image-dark"});const nl=()=>(0,ss.jsxs)(ss.Fragment,{children:[el,tl,Gr("p",{},void 0,(0,B.Z)("Organize your tabs into Workspaces – work projects, shopping, social media – all in one window."))]}),il=({winId:e,onClose:t,dialogId:n})=>{const i=(0,Li.useCallback)((()=>{Ze.shown(n),t()}),[n,t]),s=(0,Li.useCallback)((t=>{Hr.QJ.openURL(e,t),i()}),[i,e]),o=()=>{w.Z.set(I.kMailIsTurnedOff,!1)},a=(0,Li.useCallback)(((t,n)=>{de.Z.showSettings(e,t,n),i()}),[i,e]);if(null==n)return null;switch(n){case"EnableMailContextDialog":return Gr(Ur,{extraClassName:"anchored-to-urlfield float",header:(0,B.Z)("Discover Vivaldi Mail"),renderBody:zr,acceptButtonName:(0,B.Z)("Get started"),onAccept:()=>{o(),de.Z.showMailAccountDialog(e),i()},onDismiss:i,secondaryButtonName:(0,B.Z)("Close"),onSecondaryButtonClick:i});case"EnableCalendarContextDialog":return Gr(Ur,{extraClassName:"anchored-to-urlfield float",header:(0,B.Z)("Plan with Vivaldi Calendar"),renderBody:Xr,acceptButtonName:(0,B.Z)("Add accounts"),onAccept:()=>{o(),de.Z.showCalendarAccountDialog(e),i()},onDismiss:i,secondaryButtonName:(0,B.Z)("Close"),onSecondaryButtonClick:i});case"EnableSyncContextDialog":{const e=C.Z.get(I.kToolbarsNavigation).some((e=>"AccountButton"===e))?"anchored-to-sync":"anchored-to-urlfield";return Gr(Ur,{extraClassName:e+" slide",header:(0,B.Z)("Sync Vivaldi across devices"),renderBody:Jr,acceptButtonName:(0,B.Z)("Set up Sync"),onAccept:()=>a("sync",{view:"register"}),onDismiss:i,secondaryButtonName:(0,B.Z)("Close"),onSecondaryButtonClick:i})}case"CreateWorkspaceContextDialog":return Gr(Ur,{extraClassName:"anchored-to-workspace slide",header:(0,B.Z)("Create a Workspace"),renderBody:nl,acceptButtonName:(0,B.Z)("Create Workspace"),onAccept:()=>{de.Z.showWorkspaceDialog(e,{createInBackground:!1,withPages:void 0}),i()},onDismiss:i,secondaryButtonName:(0,B.Z)("Learn More"),onSecondaryButtonClick:()=>{s("https://vivaldi.com/features/workspaces/")}});default:return null}};const sl=()=>{let e=1;const t={guid:"",extensionId:"",readOnly:!1,name:"New Engine",keyword:"new",faviconUrl:"",url:"https://example.com/search?q=%s",postParams:"",suggestUrl:"",suggestPostParams:"",imageUrl:"",imagePostParams:"",prepopulateId:0};for(;ai.Z.getByKeyword(t.keyword);)t.keyword=`new${e}`,e++;return t};var ol,al=n(57458),rl=n(36436);function ll(e,t,n,i){ol||(ol="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:ol,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class dl extends Li.Component{static contextType=ts.Z;constructor(e){super(e),this.state={name:this.props.name?this.props.name:"",url:this.props.url?this.props.url.replace("{searchTerms}","%s"):"",nickname:this.props.name?this.props.name:"",nicknameTaken:!1,default:!1},this.faviconUrl=""}componentDidMount(){this.constructFavicon(this.props.url)}getDataUri=(e,t)=>{const{document:n}=this.context,i=new Image;i.onload=function(){const i=n.createElement("canvas");i.width=this.naturalWidth,i.height=this.naturalHeight,i.getContext("2d").drawImage(this,0,0),t(i.toDataURL(e))},i.src=e};constructFavicon=e=>{const{document:t}=this.context;if(e){const n=(0,rl.q9)(e.trim()),i=t.createElement("a");i.href=n;const s=i.protocol+"//"+i.host+"/favicon.ico";this.getDataUri(s,(e=>{this.faviconUrl=e}))}};updateFavicon=e=>{if("string"==typeof e.target.value){const t=e.target.value.trim();if(t)return void this.constructFavicon(t)}this.faviconUrl=""};canCreate=()=>Boolean(this.state.name.trim()&&this.state.url.trim()&&this.state.nickname.trim()&&!1===this.state.nicknameTaken);create=async()=>{if(this.canCreate()){const e=sl();e.name=this.state.name.trim(),e.keyword=this.state.nickname,e.url=(0,al.encode)(this.state.url.trim()),e.faviconUrl=this.faviconUrl;const t=await se.Z.searchEngines.addTemplateUrl(e);t&&this.state.default&&se.Z.searchEngines.setDefault("defaultSearch",t),"function"==typeof this.props.onClose&&this.props.onClose()}};nameChange=e=>{"string"==typeof e.target.value&&this.setState({name:e.target.value})};defaultChange=e=>{"boolean"==typeof e.target.checked&&this.setState({default:e.target.checked})};urlChange=e=>{"string"==typeof e.target.value&&this.setState({url:e.target.value})};nicknameChange=e=>{if("string"==typeof e.target.value){const t=e.target.value.trim();this.setState({nickname:t,nicknameTaken:t.length>0&&void 0!==ai.Z.getByKeyword(t)})}};render(){const e=this.state.nicknameTaken?ai.Z.getByKeyword(this.state.nickname):null,t=e?e.name:"";return ll("form",{onSubmit:this.create},void 0,ll("div",{className:"dialog-content"},void 0,ll("label",{className:"fieldset"},void 0,ll("input",{className:"searchengine_url setting-single-flex",type:"text",placeholder:(0,B.Z)("URL"),value:this.state.url,onChange:this.urlChange,onBlur:this.updateFavicon})),ll("label",{className:"fieldset"},void 0,ll("input",{className:"setting-single-flex",type:"text",value:this.state.name,placeholder:(0,B.Z)("Description"),onChange:this.nameChange,autoFocus:!0}),ll("input",{className:"searchengine_keyword setting-single-noflex",type:"text",value:this.state.nickname,placeholder:(0,B.Z)("Nickname"),onChange:this.nicknameChange})),this.state.nicknameTaken&&ll("p",{className:"info",style:{textAlign:"right"}},void 0,(0,B.Z)("Nickname in use by $1 search engine",[t])),ll("label",{className:"fieldset"},void 0,ll("input",{type:"checkbox",checked:this.state.default,onChange:this.defaultChange}),ll("span",{},void 0,(0,B.Z)("Set as Default Search")))),ll("footer",{className:"dialog-footer"},void 0,ll("input",{type:"submit",disabled:!this.canCreate(),value:(0,B.Z)("Add")}),ll("input",{type:"button",onClick:this.props.onClose,value:(0,B.Z)("Cancel")})))}}const cl=dl;var ul;function pl(e,t,n,i){ul||(ul="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:ul,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const hl=function(e){return pl(ra.Z,{onRequestClose:e.onClose,title:(0,B.Z)("Add Search Engine")},void 0,pl("div",{className:"dialog-addsearch"},void 0,pl(cl,{onClose:e.onClose,name:e.name,url:e.url})))};var gl,ml=n(80837);function fl(e,t,n,i){gl||(gl="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:gl,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class vl extends Li.PureComponent{static contextType=ts.Z;clickOnExtensionError(e){se.Z.extensionActionUtils.showGlobalError(e,this.context.vivaldiWindowId),1===this.props.errors.length&&this.props.onClose()}render(){return fl(ra.Z,{style:{width:400},onRequestClose:this.props.onClose,ignoreClickOutside:!0,className:"disabledExtensionsPopup slide",title:(0,B.Z)("Extension Changed","Extensions Changed",[this.props.errors.length])},void 0,fl("div",{className:"dialog-content"},void 0,fl("p",{className:"new-extension"},void 0,fl("span",{dangerouslySetInnerHTML:{__html:Wi.Si$.medium}}),(0,B.Z)("An extension was automatically disabled.","Extensions were automatically disabled.",[this.props.errors.length])),this.props.errors.map((e=>fl("div",{className:"list-item"},e.id,fl("button",{onClick:()=>this.clickOnExtensionError(e.commandId)},void 0,(0,B.Z)("Review")),e.name," ","installed"===e.errorType?(0,B.Z)("extensions","(New)"):(0,B.Z)("extensions","(Updated)"))))),fl("footer",{className:"dialog-footer"},void 0,fl("input",{type:"button",value:(0,B.Z)("Show All Extensions"),onClick:()=>{de.Z.showExtensions(this.context.vivaldiWindowId),this.props.onClose()}}),fl("input",{type:"button",value:(0,B.Z)("Close"),onClick:this.props.onClose})))}}const yl=vl;var bl;function Sl(e,t,n,i){bl||(bl="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:bl,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class wl extends Li.Component{constructor(e){super(e),this.state={hover:!1,show:!0}}componentDidMount(){this.hideSelf(4e3)}componentWillUnmount(){this._timeoutID&&clearTimeout(this._timeoutID)}startHover=e=>{this.setState({hover:!0})};endHover=e=>{this.setState({hover:!1})};showSelf=()=>{this._timeoutID&&clearTimeout(this._timeoutID),this.setState({show:!0}),this.props.onVisibilityChanged&&this.props.onVisibilityChanged(!0)};hideSelf=e=>{this._timeoutID&&clearTimeout(this._timeoutID),this._timeoutID=setTimeout(this.onClose,e)};onClose=()=>{this.setState({show:!1,hover:!1}),this.props.onClose&&this.props.onClose(),this.props.onVisibilityChanged&&this.props.onVisibilityChanged(!1)};onContextMenu=e=>{this._timeoutID&&clearTimeout(this._timeoutID),this.props.onContextMenu&&this.props.onContextMenu(e)};show=()=>{this.showSelf(),this.hideSelf(4e3)};render(){var e=Fi()({overlayinfobubble:!0,show:this.state.hover||this.state.show});return Sl("div",{onMouseEnter:this.startHover,onMouseLeave:this.endHover},void 0,Sl("div",{className:e,onContextMenu:this.onContextMenu,onClick:this.hideSelf.bind(this,0)},void 0,this.props.overlayText))}}const Cl=wl;class Al extends Li.Component{static contextType=ts.Z;overlayRef=null;overlayVisible=!0;constructor(e){super(e),this.state={contextOpen:!1,show:!0}}showSelf=()=>{this.setState({show:!0}),this.overlayRef&&this.overlayRef.show()};hideSelf=()=>{this.setState({show:!1,contextOpen:!1})};alwaysHide=()=>{w.Z.set(I.kWebpagesFullScreenShowBubble,!1),this.hideSelf()};shouldShow=()=>!!C.Z.get(I.kWebpagesFullScreenShowBubble)&&(this.state.contextOpen||this.state.show);onOverlayVisibilityChanged=e=>{this.overlayVisible=e};onContextMenu=e=>{const t=[{handler:this.hideSelf.bind(this),...(0,us.Z)("Hide Fullscreen Reminder")},{handler:this.alwaysHide,...(0,us.Z)("Never Show Fullscreen Reminder")}];(0,cs.Z)(this.context,t,(e=>this.setState({contextOpen:e})))(e)};render(){let e=null;if(this.shouldShow()){const t=(0,B.Z)("Press Escape key to exit fullscreen.");e=(0,ss.jsx)(Cl,{ref:e=>this.overlayRef=e,customData:this.props.customData,onClose:this.props.closeDialog,onContextMenu:this.onContextMenu,onVisibilityChanged:this.onOverlayVisibilityChanged,overlayText:t})}return e}}const Il=Al;var Tl,Zl=n(15800),El=n(50522),kl=n(1712),_l=n(22616),Nl=n(34006);function Pl(e,t,n,i){Tl||(Tl="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Tl,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const{ensureHttpsForWebcal:Dl}=Zl.ZP;function Ml(e,t){const n=[];for(const i of e)"ical"!==i.account_type&&n.push({account:i,calendars:t.filter((e=>e.accountId===i.id))});return n.sort(((e,t)=>"local"===e.account.account_type?1:"local"===t.account.account_type?-1:0))}const Ol="CREATE_CALENDAR";class xl extends Li.PureComponent{#u=[];#p=[];constructor(e){super(e);const t="string"==typeof e.file?e.file.split("\\").pop().split("/").pop():e.file.name;this.#u=El.Z.getAccounts(),this.#p=El.Z.getCalendars();const n=kl.Z.getLocalAccount();this.state={calendarGroups:Ml(this.#u,this.#p),importOption:{file:e.file,calendarId:n?"":this.#p[0]?.id??"",createNew:!!n||0===this.#p.length,newCalendarName:t,importId:t},calendarName:"",eventCount:0,host:""}}componentDidMount(){El.Z.addListener(this.#h),this.probeiCal()}componentWillUnmount(){El.Z.removeListener(this.#h)}componentDidUpdate(e){this.props.file!==e.file&&this.probeiCal(),this.props.import&&!e.import&&async function(e){try{await(0,Nl.PU)(e)}catch(t){_l.Z.addImportError("Calendar",e.importId,t.message)}}(this.state.importOption)}probeiCal=async()=>{const{message:e,eventCount:t,error:n,calendarName:i}=await(0,Nl.ig)(this.state.importOption);this.props.onStatus(e,t,n);const s={eventCount:t,calendarName:i},{file:o}=this.props;if("string"==typeof o){if(this.props.standAlone&&!o.startsWith("webcal")&&1===t&&El.Z.getWritableCalendars().length>0){const e=this.props.windowId??he.ZP.getLastActiveBrowserWindowId();(0,Nl.BC)(this.state.importOption,e)}o.startsWith("webcal")||o.startsWith("http")?s.host=se.Z.utilities.getUrlFragments(Dl(o))?.host??"":s.host=""}this.setState(s)};#h=()=>{const{accounts:e,calendars:t}=El.Z.getState();e===this.#u&&t===this.#p||(this.setState({calendarGroups:Ml(e,t)}),this.#u=e,this.#p=t)};onNameChange=e=>{const{importOption:t}=this.state,n=e.target.value===Ol?{createNew:!0,calendarId:""}:{calendarId:e.target.value,createNew:!1};this.setState((e=>({importOption:{...t,...n}})))};setCreateNewName=e=>{const{importOption:t}=this.state;this.setState((n=>({importOption:{...t,newCalendarName:e.target.value}})))};render(){const{importOption:e,calendarName:t}=this.state,{importId:n,createNew:i,calendarId:s,newCalendarName:o}=e,a=`<strong>${this.state.host||o}</strong>`,r=this.state.host||o?(0,B.Z)("Add $1 event from $2 to","Add $1 events from $2 to",[this.state.eventCount,a]):(0,B.Z)("Add $1 event to","Add $1 events to",[this.state.eventCount]),l=this.#u.some((e=>"local"===e.account_type));return(0,ss.jsxs)(ss.Fragment,{children:[this.props.standAlone&&Pl("p",{dangerouslySetInnerHTML:{__html:r}}),Pl("div",{className:"import-calendar-target"},void 0,n&&!this.props.standAlone&&Pl("label",{className:"import-calendar-name"},void 0,(0,B.Z)("$1 to",[n])),Pl(ta.Z,{onChange:this.onNameChange,name:"calendarId",value:i?Ol:s},void 0,this.state.calendarGroups.map((({account:e,calendars:t})=>Pl("optgroup",{label:"local"===e.account_type?(0,B.Z)("Local Calendars"):e.name||e.url},e.id,(0,ss.jsxs)(ss.Fragment,{children:[t.map((e=>Pl("option",{value:e.id},e.id,e.description||e.name))),"local"===e.account_type&&Pl("option",{value:Ol},void 0,(0,B.Z)("New Calendar..."))]})))),!l&&Pl("optgroup",{label:(0,B.Z)("Local Calendars")},void 0,Pl("option",{value:Ol},void 0,(0,B.Z)("New Calendar...")))),i&&Pl("label",{className:"import-calendar-new-name"},void 0,Pl("input",{type:"text",value:t||o,onChange:this.setCreateNewName})))]})}}const Ll=xl;var Rl;function Bl(e,t,n,i){Rl||(Rl="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Rl,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class Fl extends Li.PureComponent{static contextType=ts.Z;displayName="ImportCalendarDialog";state={fileHandles:[],calendarId:Zl.ZP.getDefaultCalendar()?.id||"",calendarName:"",doImport:!1};componentDidMount(){this.props.setStartImport(this.startImport),this.props.setChooseFile(this.loadImport)}loadImport=async()=>{try{const e=await this.context.showOpenFilePicker({multiple:!0,types:[{description:"iCalendar",accept:{"text/calendar":[".ics",".txt"]}}]});this.setState({fileHandles:e}),this.props.readyToStart(!0)}catch(e){"AbortError"!==e.name&&_l.Z.addImportError("Calendar","File",e.message)}};reportStatus=(e,t,n=!1)=>{n&&_l.Z.addImportError("Calendar","File",e)};startImport=async()=>{C.Z.get(I.kMailIsTurnedOff)&&(nn.Z.log("Calendar",["import"],"Calendar is turned off - turning it on for importing"),w.Z.set(I.kMailIsTurnedOff,!1),jn.Z.showContent(this.context.vivaldiWindowId,"PanelCalendar")),this.setState({doImport:!0}),this.props.readyToStart(!1)};render(){return Bl("div",{className:"import-calendar-files"},void 0,!!this.state.fileHandles.length&&Bl("div",{className:"import-calendar-targets"},void 0,this.state.fileHandles.map((e=>Bl(Ll,{file:e,import:this.state.doImport,onStatus:Lr.Z},e.name)))))}}const Wl=Fl;var Ul,Vl=n(69417),Hl=n(79706);function Gl(e,t,n,i){Ul||(Ul="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Ul,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const{ensureHttpsForWebcal:$l}=Zl.ZP;const Kl=function(e){const{subscribe:t,url:n,onStatus:i}=e,[s,o]=(0,Li.useState)(),[a,r]=(0,Li.useState)(),[l,d]=(0,Li.useState)((0,B.Z)("noun","New Calendar")),c=(0,Li.useRef)(l);c.current=l,(0,Li.useEffect)((()=>{if((0,rl.C3)(n))try{o(se.Z.utilities.getUrlFragments($l(n))?.host),async function(){i((0,B.Z)("Fetching iCal..."),-1);try{const e=await Hl.Z.probeWebCalendar({id:"",account_type:"ical",username:"",name:c.current,url:$l(n)},"");if(e.foundService){const t=e.calendars[0];t.description&&d(t.description),r(t);const n=t.description?(0,B.Z)("Found calendar ‘$2’ containing $1 event","Found calendar ‘$2’ containing $1 events",[e.eventCount,t.description]):(0,B.Z)("Found a calendar containing $1 event","Found a calendar containing $1 events",[e.eventCount]);i(n,e.eventCount)}else i(e.statusMessage,0,!0)}catch(e){i(e.message,0,!0)}}()}catch(e){i(e.message,0,!0)}else o(void 0),n&&i((0,B.Z)("Invalid URL: $1",[n]),0,!0)}),[n,i]),(0,Li.useEffect)((()=>{a&&t&&async function(){try{await te.ZP.createAccount({account_type:"ical",username:"",name:c.current,url:$l(n)}),i((0,B.Z)("Successfully subscribed to web calendar"),0)}catch(e){i(e.message,0,!0)}}()}),[a,t,n,i]);const u=s?(0,B.Z)("Add new calendar subscription from $1?",[`<strong>${s}</strong>`]):(0,B.Z)("Add new calendar subscription?");return Gl("div",{className:"import-webcal"},void 0,e.showBody&&Gl("p",{dangerouslySetInnerHTML:{__html:u}}),Gl(Vl.Z,{label:(0,B.Z)("Calendar Name"),type:"text",value:l,onChange:function(e){d(e.target.value)},disabled:!a}))};var zl;function jl(e,t,n,i){zl||(zl="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:zl,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Yl=/^(\s*\w+:\/\/)?(.+?)\/?(\?.+?)\/*\s*$/;class Xl extends Li.PureComponent{state={url:"",urlField:"",subscribe:!1,status:"info",message:""};#g=!1;componentDidMount(){this.props.setStartImport(this.startImport)}setUrlDebounced=(0,Ae.Z)((e=>{this.state.url!==e&&(this.props.readyToStart(!1),this.setState({url:e,status:"info",message:""},(()=>{const e=this.state.url.replace(Yl,"$2$3");this.#g=El.Z.getAccounts().some((t=>"ical"===t.account_type&&t.url.replace(Yl,"$2$3")===e))})))}),1e3);onUrlChange=e=>{const t=e.target.value.trim();(0,rl.C3)(t)?this.setUrlDebounced(t):this.state.url&&this.setUrlDebounced(""),this.setState({urlField:t})};onFetch=e=>{const t=this.state.urlField;this.state.url!==t&&(0,rl.C3)(t)&&this.setState({url:t})};reportStatus=(e,t,n=!1)=>{this.setState({status:n?"error":"info",message:e});const i=t>=0&&!n;this.props.readyToStart(i),n&&_l.Z.addImportError("Calendar",this.state.url,e)};startImport=async()=>{_l.Z.clearImportProgress("Calendar",this.state.url);const e={subscribe:!0};this.state.url!==this.state.urlField&&(e.url=this.state.urlField),this.setState(e)};render(){return(0,ss.jsxs)(ss.Fragment,{children:[jl("div",{className:"import-calendar-file"},void 0,jl("form",{onSubmit:this.onFetch},void 0,jl("label",{className:"floating-label"},void 0,jl("span",{},void 0,(0,B.Z)("Remote ICS Address")),jl("div",{className:"toolbar toolbar-default"},void 0,jl("input",{className:"floating-input",type:"text",onChange:this.onUrlChange,value:this.state.urlField}),jl("input",{type:"submit",value:(0,B.Z)("Fetch"),disabled:!this.state.urlField})))),jl(Kl,{url:this.state.url,subscribe:this.state.subscribe,onStatus:this.reportStatus})),jl("div",{},void 0,this.state.message&&jl(To,{type:this.state.status},void 0,this.state.message),this.#g&&jl(To,{type:"warning"},void 0,(0,B.Z)("You are already subscribed to this calendar")))]})}}const Ql=Xl;var ql,Jl=n(90864),ed=n(26219);function td(e,t,n,i){ql||(ql="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:ql,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var nd=td("br",{}),id=td("br",{});class sd extends Li.PureComponent{static contextType=ts.Z;accountIdToPaths=new Map;constructor(e,t){super(e);const n=vt.Z.getAccounts(),i=Object.keys(n);for(const e of i){const t=Jl.Z.getFoldersFlat(e,{folders:n[e].folders},!1).map((e=>e.path));this.accountIdToPaths.set(e,t)}const s=this.accountIdToPaths.entries().next().value,[o,a]=s||["",[]],r=a[0]||"";this.state={upload:!1,fileEntries:[],accountId:o,path:r}}componentDidMount(){this.props.setStartImport(this.startImport),this.props.setChooseFiles(this.chooseFiles)}chooseFiles=async()=>{const e=await(0,ed.Z)(this.context,["eml","mbs","mbox"]);this.setState({fileEntries:e}),this.props.readyToStart(!!this.state.accountId&&!!this.state.path)};startImport=async()=>{C.Z.get(I.kMailIsTurnedOff)&&(nn.Z.log("Calendar",["import"],"Calendar is turned off - turning it on for importing"),w.Z.set(I.kMailIsTurnedOff,!1)),d.Z.importMailFiles(this.context.vivaldiWindowId,this.state.fileEntries,this.state.accountId,this.state.path)};accountSelected=e=>{const t=e.target.value,n=this.accountIdToPaths.get(t),i=n?n[0]:"";this.setState({accountId:t,path:i}),this.props.readyToStart(this.state.fileEntries.length>0&&!!this.state.path)};pathSelected=e=>{this.setState({path:e.target.value}),this.props.readyToStart(this.state.fileEntries.length>0&&!!this.state.accountId)};render(){return td("div",{className:"import-data"},void 0,td("fieldset",{},void 0,td("div",{className:"import-pathname"},void 0,(0,B.Z)("Source Files:"),nd,this.state.fileEntries.length>0&&td("input",{type:"text",value:this.state.fileEntries.map((e=>e.name)).join(", "),readOnly:!0}),0===this.state.fileEntries.length&&td("input",{type:"text",value:(0,B.Z)("No files selected yet"),readOnly:!0})),td("label",{htmlFor:"accountSel",className:"from"},void 0,(0,B.Z)("import","Destination Account")),td(ta.Z,{id:"accountSel",value:this.state.accountId,onChange:this.accountSelected},void 0,Array.from(this.accountIdToPaths.keys()).map((e=>td("option",{value:e},e,e)))),td("label",{htmlFor:"pathSel",className:"from"},void 0,(0,B.Z)("import","Destination Folder")),td(ta.Z,{value:this.state.path,onChange:this.pathSelected},void 0,(this.accountIdToPaths.get(this.state.accountId)||[]).map((e=>td("option",{value:e},e,(0,Rn.kF)(e))))),td("div",{className:"import-pathname"},void 0,(0,B.Z)("Destination:"),id,td("input",{type:"text",value:`${this.state.accountId}/${(0,Rn.kF)(this.state.path)}`,readOnly:!0}))))}}const od=sd;var ad,rd=n(80225);function ld(e,t,n,i){ad||(ad="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:ad,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class dd extends Li.PureComponent{static contextType=ts.Z;componentDidMount(){this.props.setRunImporter(this.startNotesImporter)}startNotesImporter=()=>{const e=this.context.vivaldiWindowId;return(0,rd.T$)(e)};render(){return(0,ss.jsx)(ss.Fragment,{children:ld("div",{className:"import-notes"},void 0,ld("p",{},void 0,(0,B.Z)("Import a folder and its subfolders of plain-text and Markdown files (.md, .txt).")))})}}const cd=dd;var ud;function pd(e,t,n,i){ud||(ud="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:ud,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const hd=()=>[{value:15,name:(0,B.Z)("Every 15 Minutes")},{value:30,name:(0,B.Z)("Every 30 Minutes")},{value:60,name:(0,B.Z)("Every Hour")},{value:120,name:(0,B.Z)("Every 2 Hours")},{value:360,name:(0,B.Z)("Every 6 Hours")},{value:720,name:(0,B.Z)("Every 12 Hours")},{value:1440,name:(0,B.Z)("Daily")},{value:10080,name:(0,B.Z)("Weekly")},{value:-1,name:(0,B.Z)("other","Never")}].map((e=>pd("option",{value:e.value},e.value,e.name)));var gd;function md(e,t,n,i){gd||(gd="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:gd,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class fd extends Li.PureComponent{constructor(e){super(e);const t=this.mapFeeds(this.props.options);this.state={feeds:t,addToDashboard:!1,lastFetched:this.props.options.map((e=>(0,B.Z)("Checking..."))),lastFetchedTitles:this.props.options.map((e=>[]))},this.initFeedInfo(t)}initFeedInfo=e=>{const t=this.state.lastFetched,n=this.state.lastFetchedTitles;e.forEach(((i,s)=>{fetch(e[s].url).then((e=>e.ok?e.text():Promise.reject(""))).then((i=>{const o=(0,Zn.t5)(void 0,i,e[s].url);if("string"==typeof o)return;let a,r=[];o.feeditems.forEach(((e,t)=>{const n=o.feeditems[t].updatedate||o.feeditems[t].publishdate;let i;n&&(i=An(n)),i&&(!a||n>a)?(a=n,r=[o.feeditems[t].plaintitle,...r.slice(0,2)]):r.length<3&&r.push(o.feeditems[t].plaintitle)})),t[s]=a||(0,B.Z)("Date not supplied/unknown"),n[s]=r,this.setState({lastFetched:[...t],lastFetchedTitles:[...n]})})).catch((()=>{t[s]=(0,B.Z)("Could not load newsfeed"),this.setState({lastFetched:[...t]})}))}))};mapFeeds=e=>e.map((e=>({url:e.url||"",feedId:e.feedId||crypto.randomUUID(),title:e.title||"",refreshInterval:"number"==typeof e.refreshInterval?e.refreshInterval:120,offline:!1,lastChecked:0})));addFeed=async()=>{const{feeds:e}=this.state;_l.Z.setImportProgress("Feeds (OPML)","Feeds",0,e.length);const t=await fn(e);_l.Z.setImportProgress("Feeds (OPML)","Feeds",e.length,e.length),this.state.addToDashboard&&t.length>0&&t.forEach((e=>N("feed",{feedId:e.feedId}))),this.onDismiss()};onDismiss=()=>{this.props.onClose()};onChange=e=>{const{name:t,value:n,id:i}=e.target;this.setState((e=>{let s=0;return{feeds:e.feeds.map((e=>(s++,"fid"+s+"__"+t===i?{...e,[t]:n}:e)))}}))};toggleAddToDashboard=()=>{this.setState((e=>({addToDashboard:!e.addToDashboard})))};feeds=()=>{let e=0;return md("div",{className:"dialog-add-feed "+(this.props.dismissable?"dialog-content":"")},void 0,md("label",{htmlFor:"fid1__title"},void 0,(0,B.Z)("Feed Title")),md("label",{htmlFor:"fid1__url"},void 0,(0,B.Z)("Address")),md("label",{htmlFor:"fid1__refreshInterval"},void 0,(0,B.Z)("Refresh Interval")),this.state.feeds.map(((t,n)=>{e++;const i="fid"+e;return md(Li.Fragment,{},t.feedId,md("input",{type:"text",placeholder:(0,B.Z)("Title"),onChange:this.onChange,value:t.title,name:"title",id:i+"__title"}),md("input",{type:"text",placeholder:(0,B.Z)("Address"),onChange:this.onChange,value:t.url,name:"url",id:i+"__url"}),md(ta.Z,{onChange:this.onChange,value:t.refreshInterval,name:"refreshInterval",id:i+"__refreshInterval"},void 0,hd()),md("div",{className:"last-updated-date"},void 0,md("span",{className:"last-updated-date-title"},void 0,(0,B.Z)("Last updated:")),md("span",{},void 0,this.state.lastFetched[n])),this.props.dismissable&&md("div",{className:"last-updated-title"},void 0,md("h3",{},void 0,(0,B.Z)("Latest feed items (preview)")),md("ul",{},void 0,this.state.lastFetchedTitles[n].map((e=>md("li",{title:e},e,e))))))})))};footer=()=>{const e=this.state.feeds.some((e=>!!e.url));return md("footer",{className:"dialog-footer dialog-add-feed-footer "+(this.props.dismissable?"":"dialog-footer-sticky")},void 0,this.props.dismissable&&md("input",{type:"button",value:(0,B.Z)("Preview"),style:{marginRight:"auto"},onClick:()=>{this.state.feeds[0].url&&c.ZP.openURL(he.ZP.getLastActiveBrowserWindowId(),this.state.feeds[0].url),this.onDismiss()},disabled:!e}),md("label",{},void 0,md("input",{type:"checkbox",checked:this.state.addToDashboard,onChange:this.toggleAddToDashboard}),md("span",{},void 0,(0,B.Z)("Add to Dashboard"))),md("input",{type:"button",value:(0,B.Z)("Add Feed","Add Feeds",[this.state.feeds.length]),className:"primary",onClick:this.addFeed,disabled:!e}),md("input",{type:"button",onClick:this.onDismiss,value:(0,B.Z)("Cancel")}))};render(){return(0,ss.jsxs)(ss.Fragment,{children:[this.props.dismissable&&md("header",{className:"dialog-header"},void 0,md("h1",{id:ra.t},void 0,(0,B.Z)("browser","Add Feed"))),this.feeds(),this.footer()]})}}const vd=fd;var yd;function bd(e,t,n,i){yd||(yd="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:yd,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function Sd(e){let t=[];return e.forEach((e=>{e.feedurl&&t.push({title:e.plaintitle,url:e.feedurl,path:crypto.randomUUID(),supported:e.supported}),e.items.length&&(t=t.concat(Sd(e.items)))})),t}function wd(e,t){(0,U.c)({title:(0,B.Z)("Import Feeds (OPML file)"),body:t,tag:"VIVALDI_FEEDS_IMPORT_OPML_FILE"}),u.Z.setStatus(e,t)}class Cd extends Li.PureComponent{static contextType=ts.Z;#m=!1;state={listFeeds:!1,feeds:{}};componentDidMount(){this.#m=!0,this.props.setChooseFile(this.chooseAndParseFile)}componentWillUnmount(){this.#m=!1}chooseAndParseFile=async()=>{const e=this.context.vivaldiWindowId,t=await async function({showOpenFilePicker:e}){const[t]=await e({types:[{accept:{"text/*":[".opml",".txt"]},description:(0,B.Z)(".opml and .txt files")}]});return t}(this.context);C.Z.get(I.kMailIsTurnedOff)&&(nn.Z.info("Mail",["import"],"Mail is turned off - turning it on for importing an OPML file"),w.Z.set(I.kMailIsTurnedOff,!1),jn.Z.showContent(e,"PanelFeeds"));const n=await async function(e){const t=await e.getFile();return new Promise(((e,n)=>{const i=new FileReader;i.onloadend=()=>{i.result instanceof ArrayBuffer?e(i.result):n()},i.readAsArrayBuffer(t),i.onerror=e=>{console.error(i.error),n()}}))}(t),i=new Uint8Array(n);let s=new TextDecoder("utf-8").decode(i);const o=s.match(/^\<\?xml\s[^>]*\bencoding\s*=\s*"([^"]*)"[^>]*\?>/);if(o&&o[1]&&!/^\s*utf-8\s*$/i.test(o[1]))try{s=new TextDecoder(o[1]).decode(i)}catch(e){}const a=new DOMParser;try{const t=a.parseFromString(s,"application/xml"),n=(0,Zn.X7)(t,"http://localhost/");if("string"==typeof n)wd(e,(0,B.Z)("File does not appear to be of OPML format."));else{const t=Sd(n.items),i=t.filter((e=>e.supported));0===i.length?wd(e,(0,B.Z)("No items in this file are supported")):(t.length>i.length?wd(e,(0,B.Z)(t.length-i.length+" items in this file are not supported")):u.Z.clearStatus(e),this.#m&&this.setState({listFeeds:!0,feeds:i}))}}catch(t){throw wd(e,(0,B.Z)("Error parsing file - Not valid XML")),new Error(`Parsing failed: ${t}`)}};render(){return(0,ss.jsx)(ss.Fragment,{children:this.state.listFeeds&&bd(vd,{onClose:this.props.onClose,options:this.state.feeds,dismissable:!1})})}}const Ad=Cd;function Id(e,t,n,i){return e[t]=e[t]||{},e[t][n]=e[t][n]||{current:0,total:0},i&&(e[t][n].children=e[t][n].children||{},e[t][n].children&&(e[t][n].children[i]=e[t][n].children[i]||{current:0,total:0})),e}class Td extends m.Z{getInitialState(){return{}}reduce(e,t){switch(t.actionType){case"IMPORT_PROGRESS":return(0,v.Uy)(e,(e=>{const{importType:n,importItemType:i,current:s,total:o,key:a}=t;e=Id(e,n,i,a),a&&e[n][i].children?(e[n][i].children[a].current=s,e[n][i].children[a].total=o):(e[n][i].current=s,e[n][i].total=o)}));case"IMPORT_PROGRESS_WARN":return(0,v.Uy)(e,(e=>{const{importType:n,importItemType:i,message:s}=t;(e=Id(e,n,i))[n][i].warnings=e[n][i].warnings||[],e[n][i].warnings.push(s)}));case"IMPORT_PROGRESS_ERROR":return(0,v.Uy)(e,(e=>{const{importType:n,importItemType:i,message:s}=t;(e=Id(e,n,i))[n][i].errors=e[n][i].errors||[],e[n][i].errors.push(s)}));case"IMPORT_PROGRESS_CLEAR":return(0,v.Uy)(e,(e=>{delete e[t.importType]}));default:return e}}getImportProgress(){return this.getState()}numImportsInStore(){return Object.keys(this.getState()).length}isImportTypeInProgress(e){const t=this.getImportProgress();for(const n in t[e]){const i=t[e][n];if(!i.children&&(-1===i.total||i.current<i.total))return!0;if(i.children)for(const e in i.children){const t=i.children[e];if(-1===t.total||t.current<t.total)return!0}}return!1}}const Zd=new Td;var Ed=n(72010);async function kd(e,t,n){let i=0;for(let s=0;s<n.length;s++){const o=n[s];_l.Z.setImportProgress(e,t,s+1,n.length),nn.Z.log("Mail",["import"],`... importing contact ${++i}/${n.length}`);let r=!1;for(const e of o.emailAddresses){const t=Ed.Z.getContactsWithAddress(e.emailAddress);if(t){for(const e of o.emailAddresses)t.emailAddresses.includes(e.emailAddress)||(t.emailAddresses.push({id:e.id,emailAddress:e.emailAddress,type:e.type}),await a.Z.update(t.id,{name:t.name,birthday:t.birthday,note:t.note,generatedFromSentMail:t.generatedFromSentMail,avatarUrl:t.avatarUrl,separator:t.separator,trusted:t.trusted}));r=!0;break}}r||await a.Z.addContact(o)}nn.Z.log("Mail",["import"],`... compared and/or imported ${n.length} contacts`)}var _d=n(25100),Nd=n(28973);const Pd=[["is_read",It.T4.SEEN],["is_replied",It.T4.ANSWERED],["is_forwarded",It.T4.FORWARDED],["is_resent",void 0],["is_outgoing",void 0],["is_sent",void 0],["is_queued",void 0],["is_seen",void 0],["is_timequeued",void 0],["is_deleted",It.T4.DELETED],["has_attachment",void 0],["has_image_attachment",void 0],["has_audio_attachment",void 0],["has_video_attachment",void 0],["has_zip_attachment",void 0],["is_onepart_message",void 0],["currently unused bit",void 0],["is_waiting_for_indexing",void 0],["is_newsfeed_message",void 0],["partially_fetched",void 0],["is_news_message",void 0],["allow_8bit",void 0],["is_imported",void 0],["has_priority",void 0],["has_priority_low",void 0],["has_priority_max",void 0],["is_control_message",void 0],["allow_quotestring_qp",void 0],["has_keywords",void 0],["permanently_removed",void 0],["dir_forced_ltr",void 0],["dir_forced_rtl",void 0]];var Dd=n(16445),Md=n(40348),Od=n(93986),xd=n(88594);function Ld(e,t,n,i,s){_l.Z.setImportProgress(e,t,n,i,s)}async function Rd(e){const{path:t}=e;await tn.Z.importProgress.get(t)?await tn.Z.importProgress.update(t,e):await tn.Z.importProgress.add(e)}async function Bd(e){const t=await async function(e){const t=(0,Ln.NQ)(e,"accounts.ini");try{const n=await se.Z.mailPrivate.readFileToText(t);if(n)return n;nn.Z.log("Mail",["import"],`accounts.ini file not found in Opera Mail path: ${e}`)}catch(t){nn.Z.log("Mail",["import"],`Failed to read accounts.ini file for Opera Mail path: ${e} - Error: ${t.message||t}`)}}(e);return t?function(e){const t={section:/^\[(Account(s)?[0-9]+)\]$/,param:/^([^=]+?)\s*=\s*(.*?)$/,comment:/^[;#].*$/},n=new Map,i=e.split(/[\r\n]+/);let s="";return i.forEach((e=>{const i=e.trim();if(!t.comment.test(i))if(t.param.test(i)){const e=i.split("=",2),t=e[0].toLowerCase().replace(/\s+/g,"_"),o=isNaN(e[1])?e[1]:Number(e[1]);s?n.set(s,{...n.get(s),[t]:o}):n.set(t,o)}else t.section.test(i)?(s=i.substr(1,i.length-2).toLowerCase(),n.set(s,{})):0===e.length&&s?s="":nn.Z.log("Mail",["parsing","accounts"],"ignored line:",i)})),nn.Z.log("Mail",["parsing","accounts"],"parseMap:",n),(0,Nd.Z)(n).filter((([,e])=>e.account_name)).map((([e,t])=>(t.email||nn.Z.warn("Mail",["parsing","accounts"],`Account in section ${e} has no email address. Protocol: ${t.incoming_protocol}`),{section:e,MAIL_EMAIL:t.email||"",MAIL_PORT:t.incoming_port,MAIL_SERVER:t.incoming_servername||"",MAIL_USER:t.incoming_username||"",MAIL_SMTP_SERVER:t.outgoing_servername||"",MAIL_SMTP_PORT:t.outgoing_port,MAIL_SMTP_SOCKET_TYPE:587===t.outgoing_port?"starttls":"ssl",MAIL_SMTP_USER:t.outgoing_username||"",accountType:t.incoming_protocol,offline:!0,MAIL_PASSWORD:"",MAIL_SMTP_PASSWORD:"",preFetch:t.download_bodies?"all":"none"})))}(t):[]}async function Fd(e,t,n,s,o){C.Z.get(I.kMailIsTurnedOff)&&(nn.Z.log("Mail",["import"],"Mail is turned off - turning it on for importing from m2"),w.Z.set(I.kMailIsTurnedOff,!1),jn.Z.showContent(e,"PanelMail")),t&&"/"!==t[t.length-1]&&(t+="/");const a=await async function(e,t,n){nn.Z.log("Mail",["import"],"importing accounts from",e);const i=vt.Z.getAccounts(),s=(await Bd(e)).filter((e=>n.find((t=>t.accountId===e.MAIL_EMAIL&&t.accountType===e.accountType)))),o=new Map;for(let e=0;e<s.length;e++){const n=s[e];Ld(t,"MailAccounts",e+1,s.length);try{if(![It.s9.IMAP,It.s9.POP].includes(n.accountType.toUpperCase())){console.warn(`Importing accounts of type "${n.accountType}" is not supported`),_l.Z.addImportWarning(t,"MailAccounts",(0,B.Z)(`Importing accounts of type "${n.accountType}" is not supported`));continue}if(o.set(n.section,n.MAIL_EMAIL),i[n.MAIL_EMAIL])continue;if(n.accountType===It.s9.POP&&s.find((e=>e.MAIL_EMAIL===n.MAIL_EMAIL&&e.accountType===It.s9.IMAP)))continue;const e=(0,xd.Z)(n,"section"),a=(0,Ln.Gb)();await jt.Z.addAccount(e),(0,Od.ZP)(e),await a,nn.Z.log("Mail",["import"],"... imported account",n.MAIL_EMAIL)}catch(e){_l.Z.addImportError(t,"MailAccounts",(0,B.Z)("Failed importing account $1",[n.MAIL_EMAIL])),console.error(`Failed importing account ${JSON.stringify(n)}`)}}return o}(n,s,o);await async function(e,t){nn.Z.log("Mail",["import"],"importing contacts from",e);const n=await async function(e){const t=(0,Ln.NQ)(e,"contacts.adr"),n=await se.Z.mailPrivate.readFileToText(t);n||(i.Z.runtime.lastError?console.error(i.Z.runtime.lastError):console.warn(`contacts.adr file not found in Opera profile path: ${e}`));return n}(e);if(!n)return _l.Z.addImportWarning(t,"MailContacts",(0,B.Z)("No contacts found in $1",e)),void nn.Z.log("Mail",["import"],"... no contacts found in",e);const s=function(e){const t=e.split("#FOLDER")[0].split("#CONTACT");t.shift();const n=t.map((e=>e.replace(/\t/g,""))).map((e=>e.split(/[\r\n]+/g))).map((e=>{const t={};return e.forEach((e=>{const n=e.trim(),i=n.split("=")[0].toLowerCase(),s=n.split("=")[1];i.length&&(t[i]=s)})),t}));return nn.Z.log("Mail",["parsing","contacts"],"parsed:",n),n.map(((e,t)=>{const{mail:n="",postaladdress:i="",phone:s="",fax:o=""}=e,a=String.fromCharCode(2)+String.fromCharCode(2),r=n.split(a),l=i.split(a),d=r.map(((e,t)=>({emailAddress:e,id:String(t),type:""}))),c=l.map(((e,t)=>({postalAddress:e,id:String(t),type:""})));let u=0;const p=[];return s&&p.push({phoneNumber:s,id:String(u++),type:""}),o&&p.push({phoneNumber:o,id:String(u++),type:"work"}),{avatarUrl:"",birthday:0,emailAddresses:d,generatedFromSentMail:!1,id:String(t),name:e.name,note:e.description,phoneNumbers:p,postalAddresses:c,separator:!1,trusted:!0}}))}(n);await kd(t,"MailContacts",s)}(t,s),await async function(e,t,n,i){nn.Z.log("Mail",["import"],"importing messages from",n);let s=0;for(const o of t){const[t,a]=o,r=(0,Ln.NQ)(n,"store",t),l=await se.Z.mailPrivate.getFilePaths(r);s+=l.length,l.sort(),nn.Z.log("Mail",["import"],`... found ${l.length} messages to import for account ${a}`),await Hd(r,n,l,(async(t,n,s,o)=>{await Vd(e,a,t,i,n,s,o)})),nn.Z.log("Mail",["import"],"... finished importing messages for account",a),await Rd({path:r,currentIndex:0})}nn.Z.log("Mail",["import"],"... finished importing",s,"messages"),u.Z.setStatus(e,(0,B.Z)("Finished importing $1 message.","Finished importing $1 messages.",[s]),It.QM)}(e,a,n,s)}let Wd=0,Ud=0;async function Vd(e,t,n,i,s,o,a){nn.Z.log("Mail",["import"],`... importing ${a}/${o}`);const r=Date.now(),l={};for(let e=0;e<s.length;e++){const n=s[e],r=await(0,Md.Z)(n);await $d(t,r,l,n),Ld(i,"MailMessages",a+e+1,o,t)}try{await async function(e){for(const t in e)for(const n in e[t]){const{messages:i}=e[t][n];await(0,Ln.m6)(t,n,i)}cn.Z.filter(),jt.Z.updateThreads()}(l)}catch(e){_l.Z.addImportError(i,"MailMessages",(0,B.Z)("Failed importing messages. Error: $1",[e.message||e])),nn.Z.error("Mail",["import"],e)}const d=Date.now();Wd+=(d-r)/1e3,Ud+=s.length;const c=Ud/Wd;u.Z.setStatus(e,(0,B.Z)("Importing: $1/$2. Batch size: $3. Rate: $4/s",[a,o,s.length,c.toFixed(1)]))}async function Hd(e,t,n,i){const s=en.Z.adjustBatchSize.bind(void 0,25,1e3,500);let o=25;let a=(await tn.Z.importProgress.get(e))?.currentIndex||0;return new Promise(((r,l)=>{!async function d(){const c=n.slice(a,a+o);if(0===c.length)return void r();const u=Date.now();try{await i(t,c,n.length,a),a+=c.length,await Rd({path:e,currentIndex:a})}catch(e){return void l(e)}const p=Date.now();o=s(o,p-u),d()}()}))}function Gd(e,t,n,i){i[e]||(i[e]={}),i[e][t]||(i[e][t]={messages:[]}),i[e][t].messages.push(n)}async function $d(e,t,n,i){const s=Dd.Z.call(t);let o,a=!1,r=!1;if(s.received){const e=s.received.match(/\bfor\s<(.+@.+\..+)>/);e&&(o=e[1])}if(e&&o&&e===o)a=!0;else if(e){s.from.map((e=>e.address)).includes(e)&&(r=!0);s.to.map((e=>e.address)).includes(e)&&(a=!0);s.cc.map((e=>e.address)).includes(e)&&(a=!0)}const l=s.operaStatus?function(e){const t={mappedFlags:[],otherFlags:[]},n=e.substring(34,42);if(!/^[A-Fa-f0-9]{8}$/.test(n))return console.error("invalid flags hex value"),t;const i=parseInt(n,16);for(let e=0;e<Pd.length;e++){const n=Pd[e],s=i&Math.pow(2,e);s&&n[1]?t.mappedFlags.push(n[1]):s&&t.otherFlags.push(n[0])}return t}(s.operaStatus):{mappedFlags:[],otherFlags:[]};let d;if(s.operaLocation){const e=s.operaLocation.match(/^([^\s:]+):(\d+)$/);e&&(d=e[1],"inbox"===d.toLowerCase()&&(d=It.Gf))}else l.otherFlags.includes("is_sent")&&(d=It.N1);const c=await(0,_d.Z)(s,l.mappedFlags,t);if(e)(a||!a&&!r)&&(await(0,Ln.oN)(e,d||It.Gf),await(0,Ln.KJ)(e,d||It.Gf),Gd(e,d||It.Gf,c,n)),r&&(await(0,Ln.oN)(e,d||It.N1),await(0,Ln.KJ)(e,d||It.N1),Gd(e,d||It.N1,c,n));else{i.match(/\/store\/drafts\//i)?Gd(It.of,It.Wb,c,n):nn.Z.error("Mail",["import"],"Found no fitting folder for message:",i,s.operaLocation)}}function Kd(e,t){if(!e.aliases)return t;if(!t.aliases){return{...t,aliases:e.aliases}}const n=[...t.aliases];for(const i of e.aliases)t.aliases.find((e=>e.MAIL_EMAIL===i.MAIL_EMAIL))||n.push(i);return{...t,aliases:n}}const zd=[["read",It.T4.SEEN],["replied",It.T4.ANSWERED],["marked",void 0],["expunged",It.T4.DELETED],["has_re",void 0],["elided",void 0],["unused",void 0],["offline",void 0],["watched",void 0],["sender_authed",void 0],["partial",void 0],["queued",void 0],["forwarded",It.T4.FORWARDED],["priorities",void 0]];function jd(e){const t={mappedFlags:[],otherFlags:[]},n=e;if(!/^[A-Fa-f0-9]{4}$/.test(n))return console.error("invalid flags hex value"),t;const i=parseInt(n,16);for(let e=0;e<zd.length;e++){const n=zd[e],s=i&Math.pow(2,e);s&&n[1]?t.mappedFlags.push(n[1]):s&&t.otherFlags.push(n[0])}return t}var Yd,Xd=n(3664);async function Qd(e){const{path:t}=e;await tn.Z.importProgress.get(t)?await tn.Z.importProgress.update(t,e):await tn.Z.importProgress.add(e)}async function qd(e){return new Promise((t=>{se.Z.mailPrivate.readFileToText(e,(n=>i.Z.runtime.lastError?(nn.Z.warn("Mail",["import","thunderbird"],`Error reading file ${e}`,i.Z.runtime.lastError),t("")):n?void t(n):(nn.Z.warn("Mail",["import","thunderbird"],`File ${e} is empty`),t(""))))}))}async function Jd(){const e=(await new Promise((e=>{se.Z.importData.getProfiles((t=>{e(t)}))}))).find((e=>"Thunderbird"===e.name));return e?e.detectedProfilePath+"/":""}async function ec(){const e=await Jd(),t=await async function(e){const t=e+"profiles.ini";return function(e){const t={profile:/^\[(Profile[0-9]+)\]$/,name:/^Name\s*=\s*(.*?)$/,path:/^Path\s*=\s*(.*?)$/,isRelative:/^IsRelative\s*=\s*(0|1)$/,default:/^Default\s*=\s*(0|1)$/},n={},i=e.split(/[\r\n]+/);let s;for(const e of i){const i=e.trim();let o=t.profile.exec(i);o?(s=o[1],n[s]={name:"",path:"",isRelative:!1}):(o=t.name.exec(i),o&&s?n[s].name=o[1]:(o=t.path.exec(i),o&&s?n[s].path=o[1]:(o=t.isRelative.exec(i),o&&s?n[s].isRelative="1"===o[1]:(o=t.default.exec(i),o&&s&&(n[s].default="1"===o[1])))))}return n}(await qd(t))}(e),n=[];for(const i in t){const s=t[i];n.push({prefsFilePath:e+s.path+"/prefs.js",profilePath:e+s.path})}return n}async function tc(e){return new Promise((t=>{se.Z.mailPrivate.getFilePaths(e+"/",t)}))}async function nc(e){return function(e){const t={account:/^user_pref\("mail\.account\.(account[0-9]+)\.(.+)", "(.+)"\);$/,identidy:/^user_pref\("mail\.identity\.(id[0-9]+)\.(.+)", "?([^"]+)"?\);$/,server:/^user_pref\("mail\.server\.(server[0-9]+)\.(.+)", "(.+)"\);$/,smtp:/^user_pref\("mail\.smtpserver\.(smtp[0-9]+)\.(.+)", "(.+)"\);$/},n={},i=e.split(/[\r\n]+/),s=[];for(const e of i){const i=e.trim(),o=t.account.exec(i)||t.identidy.exec(i)||t.server.exec(i)||t.smtp.exec(i);o&&(n[o[1]]=n[o[1]]||{},n[o[1]][o[2]]=o[3],o[1].startsWith("account")&&s.push(o[1]))}const o={serverFolders:{},localFolders:""};for(const e of s){const{server:t,identities:i}=n[e];if(t&&i){let e;if("POP3"===n[t].type.toUpperCase())e=It.s9.POP;else{if("IMAP"!==n[t].type.toUpperCase()){nn.Z.warn("Mail",["import","thunderbird"],`Importing accounts of type "${n[t].type}" is not supported`),e=It.s9.IMAP;continue}e=It.s9.IMAP}const s=i.split(",").map((e=>e.trim())),a=s.filter((e=>"true"===n[e].valid));if(0===a.length){nn.Z.info("Mail",["import","thunderbird"],"No valid accounts found in prefs.js file");continue}const r=a[0],l=n[r].smtpServer,d={MAIL_EMAIL:n[r].useremail,MAIL_NAME:n[r].fullName,MAIL_SERVER:n[t].hostname,MAIL_PORT:e===It.s9.IMAP?993:995,MAIL_USER:n[t].userName,MAIL_SMTP_SERVER:l?n[l].hostname:"",MAIL_SMTP_PORT:465,MAIL_SMTP_SOCKET_TYPE:"ssl",MAIL_SMTP_USER:l?n[l].username:"",offline:!0,accountType:e,useOAuth:n[t].hasOwnProperty("oauth2.issuer")&&n[t]["oauth2.issuer"].endsWith(".google.com"),preFetch:"month"};if(n[r].htmlSigText&&(d.signature=n[r].htmlSigText),a.length>1){const e=a.slice(1);for(const t of e){const{useremail:e,fullName:i,htmlSigText:s}=n[t],o={MAIL_EMAIL:e};i&&(o.MAIL_NAME=i),s&&(o.signature=s),d.aliases?d.aliases.push(o):d.aliases=[o]}}const c=n[t].directory;o.serverFolders[c]=d}else t&&(o.localFolders=n[t].directory)}return o}(await qd(e))}async function ic(e){const t=e||await ec(),n=[];for(const e of t){const{serverFolders:t}=await nc(e.prefsFilePath);for(const i in t)n.push({mailAccount:{...t[i],MAIL_PASSWORD:"",MAIL_SMTP_PASSWORD:""},profilePath:e.profilePath})}return n}function sc(e){const t=[];for(const n of e)/\.(?:html|msf|dat)$/.test(n)||t.push(n);return t}function oc(e){let t="";const n=e.match(/[\\\/]([^\\\/]+)$/);if(n)return t=n[1],/inbox-[0-9]+/i.test(t)&&(t=t.slice(0,"inbox".length)),/sent-[0-9]+/i.test(t)&&(t=t.slice(0,"sent".length)),/outbox-[0-9]+/i.test(t)&&(t=t.slice(0,"outbox".length)),/trash-[0-9]+/i.test(t)&&(t=t.slice(0,"trash".length)),/junk-[0-9]+/i.test(t)&&(t=t.slice(0,"junk".length)),/spam-[0-9]+/i.test(t)&&(t=t.slice(0,"spam".length)),/drafts-[0-9]+/i.test(t)&&(t=t.slice(0,"drafts".length)),/archive-[0-9]+/i.test(t)&&(t=t.slice(0,"archive".length)),t;nn.Z.warn("Mail",["import","thunderbird"],`No mbox file found in path ${e}`)}async function ac(e,t){return new Promise((n=>{se.Z.importData.openThunderbirdMailbox(e,String(t),(e=>{n(Number(e))}))}))}async function rc(e,t){C.Z.get(I.kMailIsTurnedOff)&&(nn.Z.log("Mail",["import","thunderbird"],"Mail is turned off - turning it on for importing from Thunderbird"),w.Z.set(I.kMailIsTurnedOff,!1),jn.Z.showContent(e,"PanelMail"));const n=await ec();await async function(e,t){const n=(await ic(e)).map((e=>e.mailAccount)),i=C.Z.get(I.kMailAccounts),s=n.filter((e=>t.find((t=>t.accountId===e.MAIL_EMAIL&&t.accountType===e.accountType))));for(const e of i){const t=s.find((t=>t.MAIL_EMAIL===e.MAIL_EMAIL));if(t)try{(0,Od.ZP)(Kd(t,e))}catch(n){_l.Z.addImportError("Thunderbird","MailAccounts",(0,B.Z)("Failed updating account $1",[e.MAIL_EMAIL])),nn.Z.error("Mail",["import","thunderbird"],`Failed adding alias from ${JSON.stringify(t)}`)}}const o=s.filter((e=>!i.find((t=>t.MAIL_EMAIL===e.MAIL_EMAIL))));for(let e=0;e<o.length;e++){let t=o[e];if(t.accountType===It.s9.IMAP){const e=o.find((e=>e.MAIL_EMAIL===t.MAIL_EMAIL&&e.accountType===It.s9.POP));if(e)try{t=Kd(e,t)}catch(n){_l.Z.addImportError("Thunderbird","MailAccounts",(0,B.Z)("Failed updating account $1",[t.MAIL_EMAIL])),nn.Z.error("Mail",["import","thunderbird"],`Failed adding alias from ${JSON.stringify(e)}`)}}else if(t.accountType===It.s9.POP&&o.find((e=>e.MAIL_EMAIL===t.MAIL_EMAIL&&e.accountType===It.s9.IMAP)))continue;try{const e=(0,Ln.Gb)();await jt.Z.addAccount(t),(0,Od.ZP)(t),await e,nn.Z.log("Mail",["import","thunderbird"],"... imported account",t.MAIL_EMAIL),_l.Z.setImportProgress("Thunderbird","MailAccounts",1,1,t.MAIL_EMAIL)}catch(e){_l.Z.addImportError("Thunderbird","MailAccounts",(0,B.Z)("Failed importing account $1",[t.MAIL_EMAIL])),nn.Z.error("Mail",["import","thunderbird"],`Failed importing account ${JSON.stringify(t)}`)}}}(n,t);const i=[];for(const e of n){const{serverFolders:n,localFolders:s}=await nc(e.prefsFilePath);for(const e in n){nn.Z.log("Mail",["import","thunderbird"],"messageFolder",e);const s=n[e].MAIL_EMAIL;if(!t.find((e=>e.accountId===s)))continue;const o=await tc(e),a=sc(o);0===a.length&&nn.Z.log("Mail",["import","thunderbird"],"No thunderbird mbox files found in",o);for(const e of a){let t=oc(e);if(t){const n=e.match(/[\\\/]([^\\\/]+)\.sbd[\\\/]/);n&&(t=n[1]+"/"+t),i.push({filePath:e,accountId:s,path:t})}}}if(s){const e=await tc(s);0===e.length&&nn.Z.log("Mail",["import","thunderbird"],"No thunderbird mbox files found in",e);const t=sc(e);for(const e of t){let t=oc(e);t&&("Unsent Messages"===t&&(t=It.J8),i.push({filePath:e,accountId:It.of,path:t}))}}}for(const t of i){const{filePath:n,accountId:i}=t;let s=t.path;"inbox"===s.toLowerCase()&&(s=It.Gf);const o=(await tn.Z.importProgress.get(n))?.seekPosition||0,a=await ac(n,o);if(a<-1&&nn.Z.warn("Mail",["import","thunderbird"],`filesize overflow for ${n}`),0===o)try{if(!await(0,Ln.tP)()){nn.Z.warn("Mail",["import","thunderbird"],`File does not contain messages ${n}`),se.Z.importData.closeThunderbirdMailbox();continue}await ac(n,o)}catch(e){nn.Z.warn("Mail",["import","thunderbird"],`Error on checking file validity ${n}. Error: ${e}`),se.Z.importData.closeThunderbirdMailbox();continue}i!==It.of&&(await(0,Ln.oN)(i,s),await(0,Ln.KJ)(i,s)),_l.Z.setImportProgress("Thunderbird","MailMessages",0,-1,i+"/"+s),await lc(e,n,i,s,o,a),await Qd({path:n,seekPosition:0}),se.Z.importData.closeThunderbirdMailbox()}}async function lc(e,t,n,i,s,o){async function a(){const e=await(0,Ln.tP)();if(!e)return void(s=-1);const{message:n,seekPosition:i}=e;if(s>-1&&-1===i&&await Qd({path:t,seekPosition:s}),s=i,n.length>0){return(0,Xd.sy)(n)}}async function r(o,a,r,l){-1===r&&(r=l),await async function(e,t,n){const i=[];for(const t of e){const e=Dd.Z.call(t),n=e.mozillaStatus?jd(e.mozillaStatus):{mappedFlags:[],otherFlags:[]},s=await(0,_d.Z)(e,n.mappedFlags,t);i.push(s)}await(0,Ln.m6)(t,n,i)}(o,n,i);const d=Math.floor(r/1048576),c=Math.floor(l/1048576);u.Z.setStatus(e,`${n}/${i}: ${d}/${c} MB (${a} messages)`,5e3),_l.Z.setImportProgress("Thunderbird","MailMessages",d,c,n+"/"+i),s>-1&&await Qd({path:t,seekPosition:s})}try{let e,l=[],d=0,c=40,u=Date.now();const p=new en.Z.BatchSizeOptimizer(c,1e3);do{if(e=await a(),e){if(l.push(e),l.length===c){d+=c,await r(l,d,s,o),l=[];const e=Date.now();c=p.optimize(c,e-u),u=Date.now()}}else{if(s>-1&&0===d){nn.Z.warn("Mail",["import","thunderbird"],"File is not an mbox file",t,s);break}s>-1&&nn.Z.warn("Mail",["import","thunderbird"],"Got an empty message",t,s)}}while(s>-1);l.length>0&&(d+=l.length,await r(l,d,s,o)),0===d&&_l.Z.setImportProgress("Thunderbird","MailMessages",0,0,n+"/"+i)}catch(e){nn.Z.error("Mail",["import","thunderbird"],e),_l.Z.addImportError("Thunderbird","MailMessages",(0,B.Z)("Failed importing messages. Error: $1",[e.message||e]))}}function dc(e,t,n,i){Yd||(Yd="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Yd,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var cc=dc("br",{}),uc=dc("br",{});class pc extends Li.PureComponent{static contextType=ts.Z;#m=!1;refUserProfile=Li.createRef();constructor(e){super(e),this.state={importOptions:JSON.parse(JSON.stringify(e.profile)),selectedProfile:"",selectedProfileIndex:0,masterPassword:"",importItemStatus:(0,ze.aV)(),accountSelection:[],selectedFolder:"",selectedFile:""}}componentDidMount(){this.#m=!0,se.Z.importData.onImportItemStarted.addListener(this.onImportItemStarted),se.Z.importData.onImportItemEnded.addListener(this.onImportItemEnded),se.Z.importData.onImportItemFailed.addListener(this.onImportItemFailed),this.offerAccountSelection(this.props.profile.mailPath),this.props.setStartImport(this.startImport),this.props.setChooseFile(this.chooseFile),this.props.setSelectProfileFolder(this.selectProfileFolder)}componentWillUnmount(){this.#m=!1,se.Z.importData.onImportItemStarted.removeListener(this.onImportItemStarted),se.Z.importData.onImportItemEnded.removeListener(this.onImportItemEnded),se.Z.importData.onImportItemFailed.removeListener(this.onImportItemFailed)}componentDidUpdate(e){e.profile!==this.props.profile&&this.setState({importOptions:JSON.parse(JSON.stringify(this.props.profile))},(()=>{this.offerAccountSelection(this.props.profile.mailPath||(0,Ln.NQ)(this.state.selectedFolder,"mail"))}))}async offerAccountSelection(e){if(this.props.profile.email||this.props.profile.contacts){const t=(e,t)=>e.MAIL_EMAIL>t.MAIL_EMAIL?1:-1;if("Thunderbird"===this.props.profile.name){const e=(await ic()).sort(((e,t)=>e.mailAccount.MAIL_EMAIL>t.mailAccount.MAIL_EMAIL?1:-1)).map((e=>({accountId:e.mailAccount.MAIL_EMAIL,accountType:e.mailAccount.accountType,selected:!0,profilePath:e.profilePath})));this.#m&&this.setState({accountSelection:e,selectedProfile:[...new Set(e.map((({profilePath:e})=>e)))].join(";")})}else/^[OÓ]pera/i.test(this.props.profile.name)?Bd(e).then((e=>{const n=e.sort(t).filter((e=>e.MAIL_EMAIL&&[It.s9.IMAP,It.s9.POP].includes(e.accountType)));0===n.length?this._changeSelection("email"):this._setSelection("email",!0);const i=n.map((e=>({accountId:e.MAIL_EMAIL,accountType:e.accountType,selected:!0,profilePath:""})));this.#m&&this.setState({accountSelection:i})})):nn.Z.warn("Mail",["import"],"Mail import not supported from profile",this.props.profile.name)}}onImportItemStarted=e=>{_l.Z.setImportProgress(this.props.profile.name,e,0,1),this.setItemState(e,"IMPORT_STARTED"),this.props.onImportStarted()};onImportItemEnded=e=>{_l.Z.setImportProgress(this.props.profile.name,e,1,1),this.setItemState(e,"IMPORT_COMPLETED")};onImportItemFailed=(e,t)=>{_l.Z.addImportError(this.props.profile.name,e,t),this.setItemState(e,"IMPORT_FAILED",t)};setItemState(e,t,n){this.#m&&this.setState((i=>{let s=i.importItemStatus;const o=s.filter((t=>t.itemName===e)).first(),a={itemName:e,state:t,errorMsg:n};return s=o?s.map((t=>t.itemName===e?"IMPORT_FAILED"===t.state?t:{...a}:t)):s.push(a),{importItemStatus:s}}))}startImport=async()=>{if(Zd.isImportTypeInProgress(this.props.profile.name))return void(0,U.c)({title:(0,B.Z)("Import for this profile is currently running"),tag:"VIVALDI_IMPORT_CURRENTLY_RUNNING"});const e=this.state.importOptions,t=e.history,n=e.favorites,i=e.passwords,s=e.notes,o=e.speeddial,a=e.email,r=e.contacts,l=e.extensions,d=e.tabs,c=""===this.state.selectedProfile?this.refUserProfile?.current?.value??"":this.state.selectedProfile,u=""===this.state.selectedProfile?this.props.profile.index:this.state.selectedProfileIndex,p={history:t,favorites:n,passwords:i,notes:s,speeddial:o,extensions:l,tabs:d};let h=e.detectedProfilePath,g=e.mailPath;e.hasDefaultInstall||(h=this.state.selectedFolder||this.state.selectedFile,g=(0,Ln.NQ)(h,"mail")),h?(h.endsWith("operaprefs.ini")&&(h=h.substring(0,h.indexOf("operaprefs.ini"))),se.Z.importData.startImport(u,e.hasDefaultInstall,c,p,this.state.masterPassword,h,(()=>{if(a){const t=this.state.accountSelection.filter((e=>e.selected));if(this.setItemState("email","IMPORT_STARTED"),/^[OÓ]pera/.test(e.name))Fd(this.context.vivaldiWindowId,h,g,this.props.profile.name,t).then((()=>{this.setItemState("email","IMPORT_COMPLETED")}));else{if("Thunderbird"!==e.name)throw new Error("Unsupported mail client");rc(this.context.vivaldiWindowId,t).then((()=>{this.setItemState("email","IMPORT_COMPLETED")}))}}r&&async function(e,t){const n=(await se.Z.contacts.readThunderbirdContacts(t)).map((e=>{const t=e.emailAddresses.map((e=>{const{favorite:t,...n}=e;return{...n,emailAddress:n.emailAddress??"",isDefault:!1,type:n.type??""}})),n=e.postalAddresses.map((e=>({...e,postalAddress:e.postalAddress??"",type:e.type??""}))),i=e.phoneNumbers.map((e=>({...e,phoneNumber:e.phoneNumber??"",type:e.type??""})));return{...e,name:e.name??"",emailAddresses:t,postalAddresses:n,phoneNumbers:i}}));await kd(e,(0,B.Z)("Thunderbird Contacts"),n)}(h,c)}))):(0,U.c)({title:(0,B.Z)("Import source not specified!"),tag:"VIVALDI_IMPORT_SOURCE_NOT_SPECIFIED"})};openFolder=async()=>new Promise(((e,t)=>{this.context.chrome.fileSystem.chooseEntry({type:"openDirectory"},(n=>{i.Z.runtime.lastError||!n?t(i.Z.runtime.lastError||"Cancelled opening folder"):e(n)}))}));chooseFile=async()=>{const e=await async function(e,t){const{chrome:n}=e;return new Promise(((e,i)=>{n.fileSystem.chooseEntry({type:"openFile",accepts:[{mimeTypes:["text/*"],extensions:t,description:(0,B.Z)("files of type $1",[t.join(", ")])}]},(t=>{n.runtime.lastError||!t?i(n.runtime.lastError||"Cancelled opening file"):e(t)}))}))}(this.context,["html"]),t=await se.Z.mailPrivate.getFullPath(e.filesystem.name,e.fullPath);this.setState({selectedFile:t},this.startImport)};chooseFolder=async()=>{const e=await this.openFolder(),t=await se.Z.mailPrivate.getFullPath(e.filesystem.name,e.fullPath);this.setState({selectedFolder:t},(()=>this.offerAccountSelection((0,Ln.NQ)(t,"mail"))))};selectProfileFolder=async()=>{const e=this.props.profile;se.Z.utilities.selectFile({windowId:this.context.vivaldiWindowId,title:(0,B.Z)("Select $1 Folder",[e.name]),type:"folder",defaultPath:e.suggestedProfilePath}).then((t=>{t&&this.setState({selectedFolder:t},(()=>{e.requiresAccessPermission?this.props.refreshProfileList():this.startImport()}))}))};updateDetectedProfilePath=()=>{const e=this.props.profile;se.Z.utilities.selectFile({windowId:this.context.vivaldiWindowId,title:(0,B.Z)("Select $1 Folder",[e.name]),type:"folder",defaultPath:e.detectedProfilePath}).then((e=>{e&&this.setState((t=>{const n={...t.importOptions};return n.detectedProfilePath=e,{importOptions:n}}))}))};handlePasswordChange=e=>{const{HTMLInputElement:t}=this.context;e.target instanceof t&&this.setState({masterPassword:e.target.value.toString()})};handleUserProfileChange=e=>{const{HTMLSelectElement:t}=this.context;if(e.target instanceof t){const t=e.target.value,n=this.props.profile.UserProfiles.find((e=>e.profileName===t)),i=n?.profilePath,s=n?.index;this.setState((e=>{const n={...e.importOptions};return i&&(n.detectedProfilePath=i),{importOptions:n,selectedProfile:t,selectedProfileIndex:s||e.selectedProfileIndex}}))}};_changeSelection(e){this.setState((t=>{const n={...t.importOptions},i=t.accountSelection.slice();if("email"===e){const t=i.filter((e=>e.selected));n[e]||0!==t.length?n[e]&&i.forEach((e=>e.selected=!1)):n.detectedProfilePath||n.mailPath?i.forEach((e=>e.selected=!0)):this.chooseFolder()}return n[e]=!n[e],{accountSelection:i,importOptions:n}}))}_setSelection(e,t){this.setState((n=>{const i={...n.importOptions};return i[e]=t,{importOptions:i}}))}_getImportItemMarkup(e,t,n,i,s){return dc("div",{className:"setting-single"},void 0,dc("div",{className:"import-setting"},void 0,dc("input",{id:t,type:"checkbox",checked:i,onChange:()=>this._changeSelection(e),disabled:s}),dc("label",{htmlFor:t},void 0,n)))}_onAccountSelection=e=>{this.setState((t=>{const n={...t.importOptions},i=t.accountSelection.filter((e=>e.selected));return 1===i.length&&!0===e.selected?n.email=!1:0===i.length&&!1===e.selected&&(n.email=!0),{importOptions:n,accountSelection:t.accountSelection.map((t=>(t.accountId===e.accountId&&t.accountType===e.accountType&&(t.selected=!t.selected),t)))}}))};render(){const e=this.props.profile,t=this.state.importOptions;if(t&&e){const n=Boolean(!(t.passwords||t.history||t.notes||t.speeddial||t.email||t.contacts||t.extensions||t.tabs));let i;return e.UserProfiles&&e.UserProfiles.length>0&&(i=e.UserProfiles.map((e=>dc("option",{value:e.profileName},e.profileName,e.profileDisplayName)))),(0,ss.jsxs)(ss.Fragment,{children:[dc("fieldset",{},void 0,i&&dc("div",{className:"profile"},void 0,dc("label",{htmlFor:"userProfile"},void 0,(0,B.Z)("User Profile")),(0,ss.jsx)(ta.Z,{ref:this.refUserProfile,id:"userProfile",onChange:this.handleUserProfileChange,value:this.state.selectedProfile,children:i})),!n&&e.favorites&&this._getImportItemMarkup("favorites","f-favorites",(0,B.Z)("Bookmarks"),!!t&&t.favorites,!1),e.passwords&&this._getImportItemMarkup("passwords","f-passwords",(0,B.Z)("Passwords"),!!t&&t.passwords,!1),e.supportsMasterPassword&&dc("div",{className:"setting-single import-masterpassword"},void 0,dc("label",{htmlFor:"f-masterpassword"},void 0,(0,B.Z)("Master password, if needed:")),dc("input",{id:"f_masterpassword",type:"password",onChange:this.handlePasswordChange})),e.history&&this._getImportItemMarkup("history","f-history",(0,B.Z)("History"),!!t&&t.history,!1),e.notes&&this._getImportItemMarkup("notes","f-notes",(0,B.Z)("Notes"),!!t&&t.notes,!1),e.speeddial&&this._getImportItemMarkup("speeddial","f-speeddial",(0,B.Z)("Speed Dial"),!!t&&t.speeddial,!1),e.email&&this._getImportItemMarkup("email","f-email",(0,B.Z)("Mail"),!!t&&t.email,!1),e.email&&dc("div",{className:"import-mail-account"},void 0,this.state.accountSelection.map((e=>{const{accountId:t,accountType:n,selected:i}=e;return dc("div",{className:"imported-email"},t+n,dc("input",{id:t+n,type:"checkbox",checked:i,onChange:()=>this._onAccountSelection(e)}),dc("label",{htmlFor:t+n},void 0,t," ",n))}))),e.contacts&&this._getImportItemMarkup("contacts","f-contacts",(0,B.Z)("Contacts"),!!t&&t.contacts,!1),e.extensions&&this._getImportItemMarkup("extensions","f-extensions",(0,B.Z)("Extensions"),!!t&&t.extensions,!1),e.extensions&&this._getImportItemMarkup("tabs","f-tabs",(0,B.Z)("Open Tabs"),!!t&&t.tabs,!1)),e.hasDefaultInstall&&t.detectedProfilePath.length>0&&(0,ss.jsxs)(ss.Fragment,{children:[dc("div",{className:"import-pathname"},void 0,(0,B.Z)("Detected Profile Path:"),cc,dc("input",{type:"text",value:t.detectedProfilePath,readOnly:!0})),dc("div",{},void 0,dc("input",{type:"button",className:"primary",onClick:this.updateDetectedProfilePath,value:(0,B.Z)("Choose a Different Profile...")}))]}),e.requiresInteractiveImport&&"folder"===e.dialogType&&dc("div",{className:"import-pathname"},void 0,e.requiresAccessPermission&&(0,ss.jsxs)(ss.Fragment,{children:[(0,B.Z)("Vivaldi needs your permission to read the $1 folder.",[e.name]),uc]}),(0,B.Z)("Select the $1 folder to begin import.",[e.name])),e.requiresInteractiveImport&&"file"===e.dialogType&&n&&(0,ss.jsx)(ss.Fragment,{children:dc("div",{className:"import-pathname"},void 0,(0,B.Z)("To import your bookmarks, please follow these steps:"),dc("ol",{},void 0,dc("li",{},void 0,(0,B.Z)("Open the source application.")),dc("li",{},void 0,(0,B.Z)("Use the application menu to export Bookmarks to file. Save the file to someplace easy to find (e.g., Documents).")),dc("li",{},void 0,(0,B.Z)("Import bookmarks from the resulting file using the button below."))))})]})}return null}}const hc=pc;function gc(e){return e.map((function(e){return"string"==typeof e?e:Array.isArray(e)?`[${gc(e).join(", ")}]`:e instanceof Error?`Error: ${e.message}`:"object"==typeof e?JSON.stringify(e):String(e)}))}var mc;function fc(e,t,n,i){mc||(mc="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:mc,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function vc(e){switch(e.toLowerCase()){case"file":return{translated:!0,text:(0,B.Z)("storage","File")};case"history":return{translated:!0,text:(0,B.Z)("History")};case"favorites":return{translated:!0,text:(0,B.Z)("Favorites")};case"passwords":return{translated:!0,text:(0,B.Z)("Passwords")};case"mailaccounts":return{translated:!0,text:(0,B.Z)("Mail Accounts")};case"mailmessages":return{translated:!0,text:(0,B.Z)("Mail Messages")};case"extensions":return{translated:!0,text:(0,B.Z)("Extensions")};case"tabs":return{translated:!0,text:(0,B.Z)("Open Tabs")};default:return{translated:!1,text:e}}}class yc extends Li.PureComponent{#m=!1;constructor(e){super(e),this.state={progress:Zd.getImportProgress()}}componentDidMount(){this.#m=!0,Zd.addListener(this.onProgress)}componentWillUnmount(){this.#m=!1,Zd.removeListener(this.onProgress)}onProgress=(0,Ae.Z)((()=>{this.#m&&this.setState({progress:Zd.getImportProgress()})}),300,{leading:!0});_getImportItemStatus(e){return e.errors?fc("div",{className:"import-result"},void 0,fc(To,{type:"error"},void 0,gc(e.errors))):!e.children&&-1!==e.total&&e.current>=e.total?fc("div",{className:"import-result"},void 0,fc("div",{className:e.warnings?"import-warning":"import-success",title:e.warnings},void 0,fc("span",{className:"status-icon",dangerouslySetInnerHTML:{__html:n(75124)}}),(0,B.Z)("other","Done"))):!e.children&&(e.total>=1||-1===e.total)?fc("div",{className:"import-result numbers"},void 0,fc("div",{className:e.warnings?"import-warning":"import-success",title:e.warnings},void 0,e.total>1?e.current+"/"+e.total:"")):void 0}renderItem=(e,t)=>{const{translated:n,text:i}=vc(e);return fc("div",{className:Fi()("setting-single import-status-table",{capitalized:n})},e,fc("span",{},void 0,i),this._getImportItemStatus(t))};renderIndentedItem=(e,t)=>{const{translated:n,text:i}=vc(e);return fc("div",{className:Fi()("setting-single import-mail-account imported-email import-status-table",{capitalized:n})},e,fc("span",{},void 0,i),this._getImportItemStatus(t))};renderItems=e=>{const t=[];t.push(fc("header",{},e,fc("h4",{className:"dialog-title"},void 0,function(e){switch(e.toLowerCase()){case"calendar":return{translated:!0,text:(0,B.Z)("Calendar")};case"feeds":return{translated:!0,text:(0,B.Z)("Feeds")};default:return{translated:!1,text:e}}}(e).text)));for(const n in this.state.progress[e]){const i=this.state.progress[e][n];if(t.push(this.renderItem(n,i)),i.children)for(const e in i.children){const n=i.children[e];t.push(this.renderIndentedItem(e,n))}}return t};renderTypes=e=>{const t=[];for(const n of e)t.push(fc("div",{className:"import-data"},n,fc("div",{className:"imported-data"},void 0,this.renderItems(n))));return t};numImportsToReport=()=>Object.keys(this.state.progress).length;render(){const e=this.numImportsToReport(),t=Object.keys(this.state.progress);return 0===e?null:fc("div",{className:"import-container"},void 0,this.renderTypes(t))}}const bc=yc;var Sc,wc=n(21343);function Cc(e,t,n,i){Sc||(Sc="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Sc,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class Ac extends Li.PureComponent{static contextType=ts.Z;componentDidMount(){this.props.setRunImporter(this.chooseFile)}chooseFile=()=>{const e=this.context.vivaldiWindowId;return(0,wc.l_)(e)};render(){return Cc("div",{className:"import-readinglist"},void 0,Cc("p",{},void 0,(0,B.Z)("Import a reading list from a comma-separated values file (.csv).")))}}const Ic=Ac;var Tc;function Zc(e,t,n,i){Tc||(Tc="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Tc,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var Ec=Zc("div",{className:"import-data"},void 0,Zc(bc,{}));class kc extends Li.PureComponent{static contextType=ts.Z;#m=!1;constructor(e){super(e),this.state={offerings:{profiles:[]},selectedIndex:0,selectedPane:C.Z.get(I.kMailImportSelectedPane),numImportsInStore:0,startImport:()=>{},runImporter:()=>Promise.resolve(),chooseFile:()=>Promise.resolve(),chooseFiles:()=>Promise.resolve(),selectProfileFolder:()=>Promise.resolve(),isReadyToStart:!1}}componentDidMount(){this.#m=!0,this.refreshProfileList(),Zd.addListener(this.onProgress)}refreshProfileList=()=>{se.Z.runtimePrivate.getUserProfiles((e=>{this.refreshProfileListWithIgnorePaths(e.map((e=>e.path)))}))};refreshProfileListWithIgnorePaths=e=>{se.Z.importData.getProfiles((t=>{if(this.#m){const n=Zd.numImportsInStore(),i=t.filter((t=>!(t.detectedProfilePath&&e.some((e=>e.startsWith(t.detectedProfilePath))))));this.setState((e=>({offerings:{...e.offerings,profiles:i},numImportsInStore:n,selectedPane:0===n?"import":e.selectedPane})))}}))};clearFinishedImports=()=>{const e=Zd.getImportProgress();for(const t of Object.keys(e))for(const n of Object.keys(e[t])){const i=e[t][n];i.current===i.total&&_l.Z.clearImportProgress(t,n)}};getProfileName=()=>this.state.selectedIndex<this.state.offerings.profiles.length?this.state.offerings.profiles[this.state.selectedIndex].name:"Feeds";componentWillUnmount(){this.#m=!1,this.clearFinishedImports(),Zd.removeListener(this.onProgress)}onImportItemStarted=e=>{_l.Z.setImportProgress(this.getProfileName(),e,0,1)};onImportItemEnded=e=>{_l.Z.setImportProgress(this.getProfileName(),e,1,1),"extensions"===e&&c.ZP.openURL(this.context.vivaldiWindowId,pn.xy.extensions,{inCurrent:!0})};onImportItemFailed=(e,t)=>{_l.Z.addImportError(this.getProfileName(),e,t)};onImportStarted=()=>{se.Z.importData.onImportItemStarted.addListener(this.onImportItemStarted),se.Z.importData.onImportItemEnded.addListener(this.onImportItemEnded),se.Z.importData.onImportItemFailed.addListener(this.onImportItemFailed),se.Z.importData.onImportEnded.addListener(this.onImportEnded),se.Z.importData.onImportStarted.removeListener(this.onImportStarted),this.setState({selectedPane:"status",numImportsInStore:Zd.numImportsInStore()})};onImportEnded=e=>{se.Z.importData.onImportItemStarted.removeListener(this.onImportItemStarted),se.Z.importData.onImportItemEnded.removeListener(this.onImportItemEnded),se.Z.importData.onImportItemFailed.removeListener(this.onImportItemFailed),se.Z.importData.onImportEnded.removeListener(this.onImportEnded),this.setState({numImportsInStore:Zd.numImportsInStore()})};onProgress=()=>{const e=Zd.numImportsInStore();e!==this.state.numImportsInStore&&this.setState({numImportsInStore:e})};handleSelectionChange(e){const{HTMLSelectElement:t}=this.context;if(e.target instanceof t){const t=parseInt(e.target.value,10);this.setState({selectedIndex:t,isReadyToStart:!1})}}setStartImport=e=>{this.#m&&this.setState({startImport:()=>{e().then((()=>{this.onImportStarted()}))}})};setRunImporter=e=>{this.setState({runImporter:()=>e().then((()=>{this.setState({selectedPane:"status"})}))})};setChooseFile=e=>{this.#m&&this.setState({chooseFile:e})};newImport=()=>{this.clearFinishedImports(),this._selectPane("import")};setChooseFiles=e=>{this.#m&&this.setState({chooseFiles:e})};setSelectProfileFolder=e=>{this.#m&&this.setState({selectProfileFolder:e})};readyToStart=e=>{this.setState({isReadyToStart:e})};renderImportFooter(){const{selectedIndex:e}=this.state,t=e<this.state.offerings.profiles.length?this.state.offerings.profiles[e]:void 0,n=e===this.state.offerings.profiles.length+5,i=e===this.state.offerings.profiles.length+1,s=e===this.state.offerings.profiles.length+3,o=e===this.state.offerings.profiles.length,a=t?.hasDefaultInstall,r=s,l=!(i||r||t&&"file"!==t.dialogType),d=o?this.state.runImporter:this.state.chooseFile,c=t&&"folder"===t.dialogType,u=t?t.name:"Profile";return i?Zc("footer",{className:"dialog-footer"},void 0,Zc("input",{type:"button",className:"primary",onClick:this.state.runImporter,value:(0,B.Z)("Choose a Notes Folder...")}),Zc("input",{type:"button",onClick:this.props.onClose,value:(0,B.Z)("Cancel")})):a||this.state.isReadyToStart||n?Zc("footer",{className:"dialog-footer"},void 0,n&&!this.state.isReadyToStart?Zc("input",{type:"button",className:"primary",onClick:this.state.chooseFiles,value:(0,B.Z)("Choose One or More Files...")}):Zc("input",{type:"button",className:"primary",onClick:this.state.startImport,value:(0,B.Z)("Start Import"),disabled:n&&!this.state.isReadyToStart}),Zc("input",{type:"button",onClick:this.props.onClose,value:(0,B.Z)("Close")})):l?Zc("footer",{className:"dialog-footer"},void 0,Zc("input",{type:"button",className:"primary",onClick:d,value:(0,B.Z)("Choose a File...")}),Zc("input",{type:"button",onClick:this.props.onClose,value:(0,B.Z)("Cancel")})):r?Zc("footer",{className:"dialog-footer"},void 0,Zc("input",{type:"button",className:"primary",onClick:this.state.chooseFiles,value:(0,B.Z)("Choose One or More Files...")}),Zc("input",{type:"button",onClick:this.props.onClose,value:(0,B.Z)("Cancel")})):c?Zc("footer",{className:"dialog-footer"},void 0,Zc("input",{type:"button",className:"primary",onClick:this.state.selectProfileFolder,value:(0,B.Z)("Select $1 Folder",[u])}),Zc("input",{type:"button",onClick:this.props.onClose,value:(0,B.Z)("Cancel")})):null}renderStatusFooter(){return Zc("footer",{className:"dialog-footer"},void 0,Zc("input",{type:"button",className:"primary",onClick:this.props.onClose,value:(0,B.Z)("Close")}),Zc("input",{type:"button",onClick:this.newImport,value:(0,B.Z)("New Import...")}))}_selectPane(e){w.Z.set(I.kMailImportSelectedPane,e),this.setState({selectedPane:e})}render(){const e=this.state.offerings.profiles.map(((e,t)=>Zc("option",{value:t},t,e.name)));let t=this.state.offerings.profiles.length;if(e.push(Zc("option",{value:t++},"readinglist-import",(0,B.Z)("Reading List (CSV)"))),e.push(Zc("option",{value:t++},"notes-import",(0,B.Z)("Notes Folder"))),e.push(Zc("option",{value:t++},"opml-import",(0,B.Z)("Feeds (OPML file)"))),!C.Z.get(I.kMailIsTurnedOff)){const n=C.Z.get(I.kMailAccounts);e.push(Zc("option",{value:t++,disabled:!n||0===n.length},"mail-file-import",(0,B.Z)("Mail files"))),e.push(Zc("option",{value:t++},"calendar-import",(0,B.Z)("Calendar Events (ICS file)"))),e.push(Zc("option",{value:t++},"calendar-import-web",(0,B.Z)("Calendar Events from Remote Server (iCal)")))}const{numImportsInStore:n}=this.state,i=0===n?(0,B.Z)("Import Status"):(0,B.Z)("Import Status ($1)",[n]);return Zc(ra.Z,{onRequestClose:this.props.onClose,className:"import-data-dialog slide",title:(0,B.Z)("title","Imports")},void 0,Zc("div",{className:"dialog-content"},void 0,Zc("div",{className:"toolbar toolbar-default import"},void 0,Zc("div",{className:"toolbar-group equal-width"},void 0,Zc(po.ZP,{title:(0,B.Z)("Import"),isPressed:"import"===this.state.selectedPane,onClick:()=>this._selectPane("import")}),Zc(po.ZP,{title:i,isPressed:"status"===this.state.selectedPane,onClick:()=>this._selectPane("status"),disabled:0===this.state.numImportsInStore}))),"import"===this.state.selectedPane&&Zc("div",{className:"import-data"},void 0,Zc("fieldset",{},void 0,Zc("label",{htmlFor:"browserSel",className:"from"},void 0,(0,B.Z)("import","From")),Zc(ta.Z,{id:"browserSel",onChange:e=>this.handleSelectionChange(e),value:this.state.selectedIndex,autoFocus:!0},void 0,e)),this.state.selectedIndex<this.state.offerings.profiles.length&&Zc(hc,{profile:this.state.offerings.profiles[this.state.selectedIndex],setStartImport:this.setStartImport,setChooseFile:this.setChooseFile,setSelectProfileFolder:this.setSelectProfileFolder,onImportStarted:this.onImportStarted,refreshProfileList:this.refreshProfileList}),this.state.selectedIndex===this.state.offerings.profiles.length&&Zc(Ic,{setRunImporter:this.setRunImporter}),this.state.selectedIndex===this.state.offerings.profiles.length+1&&Zc(cd,{setRunImporter:this.setRunImporter}),this.state.selectedIndex===this.state.offerings.profiles.length+2&&Zc(Ad,{setStartImport:this.setStartImport,setChooseFile:this.setChooseFile,onClose:this.props.onClose}),this.state.selectedIndex===this.state.offerings.profiles.length+3&&Zc(od,{setStartImport:this.setStartImport,setChooseFiles:this.setChooseFiles,readyToStart:this.readyToStart}),this.state.selectedIndex===this.state.offerings.profiles.length+4&&Zc(Wl,{setStartImport:this.setStartImport,setChooseFile:this.setChooseFile,readyToStart:this.readyToStart}),this.state.selectedIndex===this.state.offerings.profiles.length+5&&Zc(Ql,{setStartImport:this.setStartImport,readyToStart:this.readyToStart})),"status"===this.state.selectedPane&&Ec),"import"===this.state.selectedPane?this.renderImportFooter():this.renderStatusFooter())}}const _c=kc;var Nc,Pc=n(10679);function Dc(e,t,n,i){Nc||(Nc="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Nc,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Mc={width:400,minWidth:"unset"};class Oc extends Li.Component{refPromptInput=Li.createRef();refOkButton=Li.createRef();_pendingAction=!0;state={promptValue:this.props.customData.defaultPromptText};handleLoadStart=e=>{e.isTopLevel&&this.onCancel()};componentDidMount(){se.Z.utilities.onDialogCanceled.addListener(this._handleDialogCanceled),this.props.customData.webview.addEventListener("loadstart",this.handleLoadStart),"prompt"!==this.props.customData.messageType?(0,Pc.Z)((()=>this.refOkButton.current?.focus()),80):(0,Pc.Z)((()=>this.refPromptInput.current?.select()),80)}componentWillUnmount(){se.Z.utilities.onDialogCanceled.removeListener(this._handleDialogCanceled),this.props.customData.webview.removeEventListener("loadstart",this.handleLoadStart)}_handleDialogCanceled=e=>{this.onCancel()};onOk=e=>{this._pendingAction&&(e.preventDefault(),this._pendingAction=!1,this.props.customData.dialog.ok(this.state.promptValue)),this.props.onClose()};onCancel=()=>{this._pendingAction&&(this._pendingAction=!1,this.props.customData.dialog.cancel()),this.props.onClose()};handlePrompt=e=>{this.setState({promptValue:e.target.value})};render(){const{messageType:e,origin:t}=this.props.customData,n=t?(0,B.Z)("JavaScript from “$1”",[t]):(0,B.Z)("JavaScript from localhost");return Dc(ra.Z,{style:Mc,onRequestClose:this.onCancel,ignoreClickOutside:!0,className:"dialog-javascript slide",title:n},void 0,Dc("form",{onSubmit:this.onOk},void 0,Dc("div",{className:"dialog-content"},void 0,Dc("p",{},void 0,this.props.customData.messageText),"prompt"===e&&(0,ss.jsx)("input",{type:"text",ref:this.refPromptInput,value:this.state.promptValue,onChange:this.handlePrompt})),Dc("footer",{className:"dialog-footer"},void 0,(0,ss.jsx)("input",{ref:this.refOkButton,type:"submit",value:(0,B.Z)("OK")}),"alert"!==e&&Dc("input",{type:"button",onClick:this.onCancel,value:(0,B.Z)("Cancel")}))))}}const xc=Oc;var Lc;function Rc(e,t,n,i){Lc||(Lc="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Lc,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Bc=function(e){const t={};for(const n of e.buffer){let e=t[n.operation]||0;e+=n.uids?n.uids.length:1,t[n.operation]=e}return(0,ss.jsx)(ss.Fragment,{children:Object.entries(t).map((([e,t])=>Rc("div",{},e,Rc("span",{className:"StatusPopup-DbInfo"},void 0,Rc("div",{},void 0,e)),Rc("span",{className:"StatusPopup-DbInfo"},void 0,Rc("div",{},void 0,t)))))})};var Fc;function Wc(e,t,n,i){Fc||(Fc="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Fc,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Uc=function(e){const t={};for(const n of e.filteringQueue){let e=t[n.type]||0;e+=n.searchListIds?n.searchListIds.length:1,t[n.type]=e}return(0,ss.jsx)(ss.Fragment,{children:Object.entries(t).map((([e,t])=>Wc("div",{},e,Wc("span",{className:"StatusPopup-DbInfo"},void 0,Wc("div",{},void 0,e)),Wc("span",{className:"StatusPopup-DbInfo"},void 0,Wc("div",{},void 0,t)))))})};var Vc;function Hc(e,t,n,i){Vc||(Vc="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Vc,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Gc={version:-1,accounts:-1,bufferSize:-1,messages:-1,imap:-1,pop:-1,filteringQueueSize:-1,threadingQueueSize:-1,flaggingQueueSize:-1,searchDbQueueSize:-1,filteringQueue:[],buffer:[]};function $c(e){return e>-1?e:"..."}const Kc=function(){const[e,t]=Li.useState(Gc),[n,i]=Li.useState(!1),[s,o]=Li.useState(0);function a(){i(!0),async function(){const e=await tn.Z._upgrades.toCollection().last(),t=await tn.Z.filteringQueue.toArray(),n=(await tn.Z.flaggingQueue.toArray()).reduce(((e,t)=>e+t.searchListIds.length),0),i=(await tn.Z.threadingQueue.toArray()).reduce(((e,t)=>e+t.threadingIds.length),0),s=await tn.Z.buffer.toArray();return{version:e.version,accounts:await tn.Z.accounts.count(),bufferSize:await tn.Z.buffer.count(),messages:await tn.Z.messages.count(),imap:await tn.Z.imap.count(),pop:await tn.Z.pop.count(),filteringQueueSize:t.length,threadingQueueSize:i,flaggingQueueSize:n,searchDbQueueSize:await tn.Z.searchDbQueue.count(),filteringQueue:t,buffer:s}}().then((e=>{t(e),i(!1)}))}return setTimeout((function(){n||(0===s?(o(5),a()):o(s-1))}),1e3),(0,ss.jsxs)(ss.Fragment,{children:[Hc("div",{className:"StatusPopup-ContentPane pad-top-bottom"},void 0,Hc("span",{className:"StatusPopup-DbInfo"},void 0,(0,B.Z)("Version:"),Hc("div",{},void 0,$c(e.version))),Hc("span",{className:"StatusPopup-DbInfo"},void 0,(0,B.Z)("Accounts:"),Hc("div",{},void 0,$c(e.accounts))),Hc("span",{className:"StatusPopup-DbInfo",title:(0,B.Z)("With duplicates resolved")},void 0,(0,B.Z)("Number of messages:"),Hc("div",{},void 0,$c(e.messages))),Hc("span",{className:"StatusPopup-DbInfo",title:(0,B.Z)("Includes duplicates")},void 0,(0,B.Z)("... from IMAP Servers:"),Hc("div",{},void 0,$c(e.imap))),Hc("span",{className:"StatusPopup-DbInfo",title:(0,B.Z)("Includes duplicates")},void 0,(0,B.Z)("... from POP3 servers:"),Hc("div",{},void 0,$c(e.pop))),Hc("span",{className:"StatusPopup-DbInfo"},void 0,(0,B.Z)("Pending IMAP actions:"),Hc("div",{},void 0,$c(e.bufferSize))),e.bufferSize>0&&Hc("span",{className:"StatusPopup-DbInfo"},void 0,Hc(Bc,{buffer:e.buffer})),Hc("span",{className:"StatusPopup-DbInfo"},void 0,(0,B.Z)("Pending filtering:"),Hc("div",{},void 0,$c(e.filteringQueueSize))),e.filteringQueueSize>0&&Hc("span",{className:"StatusPopup-DbInfo"},void 0,Hc(Uc,{filteringQueue:e.filteringQueue})),Hc("span",{className:"StatusPopup-DbInfo"},void 0,(0,B.Z)("Pending threading:"),Hc("div",{},void 0,$c(e.threadingQueueSize))),Hc("span",{className:"StatusPopup-DbInfo"},void 0,(0,B.Z)("Pending flagging:"),Hc("div",{},void 0,$c(e.flaggingQueueSize))),Hc("span",{className:"StatusPopup-DbInfo"},void 0,(0,B.Z)("Pending search indexing:"),Hc("div",{},void 0,$c(e.searchDbQueueSize)))),Hc("div",{className:"StatusPopup-Footer toolbar-default"},void 0,Hc("div",{className:"StatusPopup-AccountPoll"},void 0,n?(0,B.Z)("Refreshing ..."):(0,B.Z)("Refreshes in $1 seconds",[s])))]})};var zc=n(65093),jc=n(35874);class Yc extends m.Z{getInitialState(){return new Map}reduce(e,t){if("MAIL_ERROR_SET"===t.actionType){const{accountId:n,category:i,error:s,code:o,level:a="WARNING"}=t,r={category:i,error:s,code:o,level:a};return(0,v.Uy)(e,(e=>{const t=e.get(n);t?t.push(r):e.set(n,[r])}))}if("MAIL_ERROR_DELETE"===t.actionType){const{accountId:n,category:i}=t;return(0,v.Uy)(e,(e=>{const t=e.get(n);if(t){const s=t.filter((e=>e.category!==i));s.length>0?e.set(n,s):e.delete(n)}}))}return e}getLatestError(e){const t=this.getState().get(e);if(t)return t[t.length-1]}hasError(e){const t=this.getState().get(e);return!!t&&t.length>0}hasAccountError(e){return!!this.getState().get(e)?.some((e=>(0,jc.I)(e.code)))}}const Xc=new Yc;var Qc;function qc(e,t,n,i){Qc||(Qc="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Qc,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}eu.defaultProps={size:32};const Jc="/resources/vivaldi_mail_default.png";function eu(e){let t=e.emailAddress.split("@")[1]||"";return t="gmail.com"===t?"https://ssl.gstatic.com/ui/v1/icons/mail/images/favicon5.ico":"googleusercontent.com"===t?"https://google.com/favicon.ico":(0,Ri.rv)(t),qc(Ri.ZP,{size:e.size,className:e.className,url:t?(0,rl.q9)(t):Jc,fallbackUrl:Jc,loadType:"faviconSkipCache"})}const tu=eu;var nu,iu=n(97823);function su(e,t,n,i){nu||(nu="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:nu,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class ou extends Li.PureComponent{static contextType=ts.Z;#m=!1;constructor(e){super(e),this.state={imapStatus:zc.Z.getStatus(e.account.MAIL_EMAIL),selectedMailboxes:new Map}}componentDidMount(){this.#m=!0,zc.Z.addListener(this.onImapStoreChange),this.props.showAdvancedInfo&&this.#f()}componentWillUnmount(){this.#m=!1,zc.Z.removeListener(this.onImapStoreChange)}onImapStoreChange=e=>{e.accountId===this.props.account.MAIL_EMAIL&&this.setState({imapStatus:zc.Z.getStatus(this.props.account.MAIL_EMAIL)})};#f=async()=>{const e=await Yt.Z.getSelectedMailboxes();this.#m&&(this.setState({selectedMailboxes:e}),setTimeout(this.#f,3e3))};#v=()=>{this.props.hidePopup()};#y=async()=>{const e=await iu.Z.loadAccount(this.props.account.MAIL_EMAIL);de.Z.showMailAuthenticationDialog(this.context.vivaldiWindowId,{account:e}),this.props.hidePopup()};render(){const{account:e}=this.props,t=e.MAIL_EMAIL,n=this.state.selectedMailboxes.get(t),i=this.state.imapStatus;let s;return e.offline?s="offline":navigator.onLine?i.isConnecting||i.isDisconnected?i.isConnecting?s="connecting":Xc.hasAccountError(t)?s="needsAuth":e.accountType===It.s9.IMAP?s=Xc.hasError(t)?"hasError":"disconnected":e.accountType===It.s9.POP&&(s="connected"):s=i.isSyncing?"syncing":i.isSyncingFlags?"syncingFlags":i.isPreFetching?"preFetching":"connected":s="noNetwork",su("button",{tabIndex:C.Z.get(I.kKeyboardTabToAll),onClick:()=>this.#v(),className:"StatusPopup-Account"},void 0,su(tu,{emailAddress:t,size:16,className:"StatusPopup-AccountIcon"}),su("div",{className:"StatusPopup-AccountName"},void 0,t),su("div",{className:"StatusPopup-AccountStatus"},void 0,"offline"===s&&(0,ss.jsxs)(ss.Fragment,{children:[su("span",{className:"StatusPopup-AccountStatus--Success",title:(0,B.Z)("mail","Offline"),dangerouslySetInnerHTML:{__html:Wi.GH$}}),(0,B.Z)("mail","Offline")]}),"connected"===s&&(0,ss.jsxs)(ss.Fragment,{children:[su("span",{className:"StatusPopup-AccountStatus--Success",title:(0,B.Z)("The account should normally be connected on the inbox"),dangerouslySetInnerHTML:{__html:Wi.JLz}}),n?(0,B.Z)("Connected on $1",[n]):(0,B.Z)("Connected")]}),"syncing"===s&&(0,ss.jsxs)(ss.Fragment,{children:[su("span",{className:"StatusPopup-AccountStatus--Success",title:(0,B.Z)("Fetching Headers"),dangerouslySetInnerHTML:{__html:Wi.JLz}}),(0,B.Z)("Indexing...")]}),"syncingFlags"===s&&(0,ss.jsxs)(ss.Fragment,{children:[su("span",{className:"StatusPopup-AccountStatus--Success",title:(0,B.Z)("Fetching Mail Status"),dangerouslySetInnerHTML:{__html:Wi.JLz}}),(0,B.Z)("Flag updates...")]}),"preFetching"===s&&(0,ss.jsxs)(ss.Fragment,{children:[su("span",{className:"StatusPopup-AccountStatus--Success",title:(0,B.Z)("Fetching Bodies"),dangerouslySetInnerHTML:{__html:Wi.JLz}}),(0,B.Z)("Pre-fetching...")]}),"connecting"===s&&(0,ss.jsxs)(ss.Fragment,{children:[su("span",{className:"StatusPopup-AccountStatus--Warning",title:(0,B.Z)("Connecting..."),dangerouslySetInnerHTML:{__html:Wi.GH$}}),(0,B.Z)("Connecting...")]}),"needsAuth"===s&&(0,ss.jsxs)(ss.Fragment,{children:[su("span",{className:"StatusPopup-AccountStatus--Error",title:(0,B.Z)("Authentication Error"),dangerouslySetInnerHTML:{__html:Wi.viW}}),(0,B.Z)("Authentication Error")]}),"hasError"===s&&(0,ss.jsxs)(ss.Fragment,{children:[su("span",{className:"StatusPopup-AccountStatus--Error",title:Xc.getLatestError(t)?.error.message||(0,B.Z)("Error"),dangerouslySetInnerHTML:{__html:Wi.viW}}),(0,B.Z)("Error")]}),"noNetwork"===s&&(0,ss.jsxs)(ss.Fragment,{children:[su("span",{className:"StatusPopup-AccountStatus--Warn",title:(0,B.Z)("No Network"),dangerouslySetInnerHTML:{__html:Wi.GH$}}),(0,B.Z)("No Network")]}),"disconnected"===s&&(0,ss.jsxs)(ss.Fragment,{children:[su("span",{className:"StatusPopup-AccountStatus--Warn",title:(0,B.Z)("Disconnected"),dangerouslySetInnerHTML:{__html:Wi.GH$}}),(0,B.Z)("Disconnected")]}),!s&&(0,ss.jsxs)(ss.Fragment,{children:[su("span",{className:"StatusPopup-AccountStatus--Warn",title:(0,B.Z)("Unknown"),dangerouslySetInnerHTML:{__html:Wi.GH$}}),(0,B.Z)("Status Unknown")]}),"needsAuth"===s&&su("a",{className:"StatusPopup-AccountStatusRetry",tabIndex:C.Z.get(I.kKeyboardTabToAll),onClick:this.#y,href:""},void 0,(0,B.Z)("Retry"))))}}const au=ou;var ru;function lu(e,t,n,i){ru||(ru="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:ru,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const du=function(){const e=C.Z.get(I.kMailAccounts).filter((e=>e.accountType===It.s9.IMAP));return(0,ss.jsx)(ss.Fragment,{children:lu("div",{className:"StatusPopup-List pad-top"},void 0,e.map((e=>lu(Li.Fragment,{},e.MAIL_EMAIL,lu("div",{},void 0,lu(au,{account:e,hidePopup:()=>{},showAdvancedInfo:!0}))))))})};var cu;function uu(e,t,n,i){cu||(cu="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:cu,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var pu=uu(Kc,{}),hu=uu(du,{});var gu;function mu(e,t,n,i){gu||(gu="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:gu,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var fu=mu((function(){return(0,ss.jsx)(ss.Fragment,{children:uu("div",{},void 0,uu("div",{className:"StatusPopup-ContentPane"},void 0,uu("div",{className:"StatusPopup-Header"},void 0,uu("h2",{},void 0,(0,B.Z)("Mail DB"))),pu),uu("div",{className:"StatusPopup-ContentPane"},void 0,uu("div",{className:"StatusPopup-Header"},void 0,uu("h2",{},void 0,(0,B.Z)("IMAP Clients"))),hu))})}),{});const vu=function(e){return mu(ra.Z,{className:"float",onRequestClose:e.onClose},void 0,fu)};var yu;function bu(e,t,n,i){yu||(yu="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:yu,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Su=287;function wu(e){const t=e.length;switch(!0){case t>180&&t<Su:return 426;case t>122:return 354;case t>84:return 306;default:return 258}}class Cu extends Li.Component{#m=!1;constructor(e){super(e),this.state={qrImage:"",data:this.props.data,dataChanged:!1}}componentDidMount(){this.#m=!0,this.onGenerate("dataurl")}componentWillUnmount(){this.#m=!1}componentDidUpdate(e){this.state.dataChanged||this.props.data===e.data||this.setState({data:this.props.data},this.onGenerate.bind(this,"dataurl"))}onUrlInputChanged=e=>{const t=e.currentTarget.value;this.setState({data:t}),t&&t.length>2&&se.Z.utilities.generateQRCode(t,(e=>{this.setState({qrImage:e,dataChanged:!0})}))};onGenerate=(e,t)=>{const n=""!==this.state.data?this.state.data:this.props.data,i=(0,B.Z)("QR Code Generated");se.Z.utilities.generateQRCode(n,e,(t=>{"dataurl"===e?this.#m&&this.setState({qrImage:t,data:n}):"clipboard"===e&&(0,U.c)({title:i,body:(0,B.Z)("Image stored in the clipboard."),tag:"VIVALDI_QR_IMAGE_TO_CLIPBOARD"})})),t&&this.props.hidePopup()};onCancel=()=>{this.props.hidePopup()};renderDialogHeader=()=>bu("div",{className:"dialog-header"},void 0,bu("h3",{id:"dialog-qrshare-title"},void 0,(0,B.Z)("Page QR Code")));renderQRImage=()=>bu("div",{className:"dialog-content"},void 0,this.state.data.length>Su?bu("p",{},void 0,(0,B.Z)("Address is too long, QR code source cannot exceed $1 characters.",[Su])):bu("img",{src:this.state.qrImage,className:"qr-image"}),bu("input",{type:"url",value:this.state.data,spellCheck:"false",maxLength:Su,onChange:this.onUrlInputChanged,onFocus:e=>e.target.select()}));renderSaveCancel=()=>bu("footer",{className:"dialog-footer"},void 0,bu("input",{type:"button",onClick:this.onGenerate.bind(this,"clipboard",!0),disabled:this.state.data.length>Su,value:(0,B.Z)("verb","Copy")}),bu("input",{type:"button",onClick:this.onGenerate.bind(this,"file",!0),disabled:this.state.data.length>Su,value:(0,B.Z)("Save to Download")}));renderPopupContents=()=>bu("div",{className:"qr-share-dialog"},void 0,this.renderDialogHeader(),this.renderQRImage(),this.renderSaveCancel());render(){return this.props.useModal?bu(ra.Z,{style:{width:wu(this.state.data),minWidth:"unset"},onRequestClose:this.onCancel,labelledBy:"dialog-qrshare-title"},void 0,this.renderPopupContents()):this.renderPopupContents()}}const Au=Cu;var Iu;function Tu(e,t,n,i){Iu||(Iu="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Iu,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Zu={width:400,minWidth:"unset"};class Eu extends Li.Component{state={awaiting:30};componentDidMount(){this.props.failedPreview||(this.expireInterval=setInterval((()=>this.expirePreview()),1e3))}componentWillUnmount(){clearInterval(this.expireInterval)}expirePreview=()=>{this.setState((e=>{const t=e.awaiting-1;return t<=0&&(clearInterval(this.expireInterval),ki.Z.clearThemePreview()),{awaiting:t}}))};acceptPreview=()=>{this.props.isUpdate?ki.Z.updateTheme():ki.Z.installTheme(),this.props.onClose()};discardPreview=()=>{ki.Z.clearThemePreview(),this.props.onClose()};render(){return Tu(ra.Z,{onRequestClose:Lr.Z,style:Zu,className:"slide",ignoreClickOutside:!0,title:(0,B.Z)("Theme Preview")},void 0,this.props.failedPreview?Tu("div",{className:"dialog-content"},void 0,(0,B.Z)("Theme cannot be previewed due to format errors.")):Tu("div",{className:"dialog-content"},void 0,this.state.awaiting>0&&(0,ss.jsxs)(ss.Fragment,{children:[Tu("p",{},void 0,this.props.isUpdate?(0,B.Z)("This is a preview of the updated “$1” theme. Would you like to install this update and apply it?",[this.props.themeName]):(0,B.Z)("This is a preview of the “$1” theme. Would you like to install and apply it?",[this.props.themeName])),Tu("p",{className:"info"},void 0,(0,B.Z)("Theme preview expires in $1 second.","Theme preview expires in $1 seconds.",[this.state.awaiting]))]}),this.state.awaiting<1&&Tu("p",{},void 0,(0,B.Z)("Preview of the “$1” theme has expired, please reload the theme again if you wish to install it.",[this.props.themeName]))),Tu("footer",{className:"dialog-footer"},void 0,!this.props.failedPreview&&Tu("input",{type:"submit",value:this.props.isUpdate?(0,B.Z)("Update"):(0,B.Z)("Install"),onClick:this.acceptPreview,disabled:this.state.awaiting<1,autoFocus:!0}),Tu("input",{type:"button",value:(0,B.Z)("Cancel"),onClick:this.discardPreview})))}}const ku=Eu;var _u;function Nu(e,t,n,i){_u||(_u="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:_u,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Pu=function({customData:e,closeDialog:t}){switch(e.dialogtype){case"toast":return Nu(Cl,{customData:e,onClose:t,overlayText:e.text});case"download":return Nu(ml.Z,{customData:e,onClose:t});case"import":return Nu(_c,{onClose:t});case"createSearch":return Nu(hl,{onClose:t,name:e.Name,url:e.Url});case"javascript":return Nu("div",{className:"modal-overlay"},void 0,Nu(xc,{customData:e,onClose:t}));case"fullscreen":return Nu(Il,{customData:e,closeDialog:t});case"pointerLock":{const n=(0,B.Z)("Press Escape key to exit the pointer lock.");return Nu(Cl,{customData:e,onClose:t,overlayText:n})}case"qrcode":return Nu("div",{className:"modal-overlay"},void 0,Nu(Au,{useModal:!0,data:e.url,hidePopup:t}));case"extensionError":return Nu("div",{className:"modal-overlay"},void 0,Nu(yl,{errors:e.errors,onClose:t}));case"themePreview":return Nu("div",{className:"modal-overlay"},void 0,Nu(ku,{themeName:e.themeName,isUpdate:e.isUpdate,onClose:t}));case"themePreviewFailed":return Nu(ku,{failedPreview:!0,themeName:"",isUpdate:!1,onClose:t});case"mailInfo":return Nu(vu,{onClose:t});default:return console.error("DialogRenderWrapper.render: unknown dialogtype:"+e.dialogtype),null}};var Du;function Mu(e,t,n,i){Du||(Du="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Du,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Ou="https://vivaldi.com/bugreport/";class xu extends Li.Component{static contextType=ts.Z;state={hasError:!1,stack:"",existingChildren:this.props.children};static getDerivedStateFromProps(e,t){return e.children!==t.existingChildren?{hasError:!1,existingChildren:e.children}:null}static getDerivedStateFromError(e){return{hasError:!0,stack:e.stack}}componentDidCatch(e,t){return null}openBugReport=()=>{c.ZP.openURL(this.context.vivaldiWindowId,Ou)};render(){const{children:e,level:t}=this.props;return this.state.hasError?Mu("div",{className:"error-boundary"},void 0,Mu("h1",{},void 0,(0,B.Z)("An error occurred")),Mu("pre",{},void 0,this.state.stack),Mu("p",{},void 0,(0,B.Z)("Please consider reporting the issue at $1 to help us fix it.",[Ou])),"nothing"===t&&Mu("input",{type:"button",onClick:()=>se.Z.runtimePrivate.exit(!1),value:(0,B.Z)("verb","Exit")}),"tabs"===t&&Mu("input",{type:"button",onClick:this.openBugReport,value:(0,B.Z)("Report issue")})):e}}const Lu=xu;var Ru,Bu=n(81009);function Fu(e,t,n,i){Ru||(Ru="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Ru,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Wu=[I.kStartupShowGitDirectoryWarning],Uu={width:500,minWidth:"unset"};class Vu extends Li.Component{constructor(e){super(e)}_onClose=()=>{w.Z.set(I.kStartupShowGitDirectoryWarning,""),this.props.onClose()};render(){return Fu(ra.Z,{onRequestClose:Lr.Z,style:Uu,className:"slide",title:(0,B.Z)("Warning: Your profile folder might be inside a Git repository")},void 0,Fu("div",{className:"dialog-content selectable-content"},void 0,Fu("p",{},void 0,(0,B.Z)("A .git configuration was detected in")," ",Fu("b",{},void 0,this.props.prefValues[I.kStartupShowGitDirectoryWarning])),Fu("p",{},void 0,(0,B.Z)("This could cause you to accidentally share part of or your whole profile with a public Git repository and allow others to see your private data, such as website logins, cookies and cache files.")),Fu("p",{},void 0,(0,B.Z)("A .gitignore file has therefore been added to your profile folder to prevent accidental sharing to public Git services (e.g. GitHub). If sharing was intentional, please edit the .gitignore file to select what really should be ignored."))),Fu("footer",{className:"dialog-footer"},void 0,Fu("input",{type:"button",value:(0,B.Z)("Close"),onClick:this._onClose})))}}const Hu=(0,Bu.Z)(Vu,Wu);var Gu;function $u(e,t,n,i){Gu||(Gu="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Gu,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Ku=[I.kStartupShowMediaAvailableInformation],zu={width:400,minWidth:"unset"};class ju extends Li.Component{static contextType=ts.Z;constructor(e){super(e),this.state={doNotShowAgain:!1}}_onClose=()=>{w.Z.set(I.kStartupShowMediaAvailableInformation,!this.state.doNotShowAgain),this.props.onClose()};_onInformation=()=>{c.ZP.openURL(this.context.vivaldiWindowId,"https://www.microsoft.com/en-us/software-download/mediafeaturepack"),this._onClose()};_onCheckChanged=()=>{this.setState((e=>({doNotShowAgain:!e.doNotShowAgain})))};render(){return $u(ra.Z,{onRequestClose:Lr.Z,style:zu,className:"slide",title:(0,B.Z)("Media support")},void 0,$u("div",{className:"dialog-content"},void 0,$u("p",{},void 0,(0,B.Z)("This Windows N edition lacks the media package to play HTML5 ‘proprietary’ media (H.264/AAC).")),$u("label",{className:"dialog-checkbox"},void 0,$u("input",{type:"checkbox",checked:this.state.doNotShowAgain,onChange:this._onCheckChanged}),$u("span",{},void 0,(0,B.Z)("Do not show again")))),$u("footer",{className:"dialog-footer"},void 0,$u("input",{type:"submit",value:(0,B.Z)("More Information"),onClick:this._onInformation,autoFocus:!0}),$u("input",{type:"button",value:(0,B.Z)("Cancel"),onClick:this._onClose})))}}const Yu=(0,Bu.Z)(ju,Ku);var Xu;function Qu(e,t,n,i){Xu||(Xu="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Xu,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const qu=function(e){const t=(0,Li.useContext)(ts.Z),[i,s]=(0,Li.useState)(!0),o=function(){const e=(0,Li.useContext)(ts.Z),t=(0,Li.useRef)(null),n=(0,Li.useCallback)((()=>{const n=t.current?.getBoundingClientRect();n&&se.Z.windowPrivate.updateMaximizeButtonPosition(e.vivaldiWindowId,n.left,n.top,n.width,n.height)}),[e.vivaldiWindowId]);return(0,Li.useEffect)((()=>(e.addEventListener("resize",n),e.addEventListener("load",n),()=>{e.removeEventListener("resize",n),e.removeEventListener("load",n)})),[n,e]),(0,Li.useLayoutEffect)(n,[n]),t}(),a=n(51759),r=n(96375),l=n(9592),d=e=>{e.preventDefault()};return Qu("div",{className:Fi()({"window-buttongroup":!0,"on-mainbar":e.onMainBar,"disable-transition":i}),onMouseEnter:e=>{s(!1)}},void 0,(0,ss.jsxs)(ss.Fragment,{children:[Qu("button",{tabIndex:"-1",className:"window-minimize",onMouseDown:d,onClick:e=>{xi.Z.minimize(t.vivaldiWindowId)},dangerouslySetInnerHTML:{__html:r}}),(0,ss.jsx)("button",{ref:o,tabIndex:"-1",className:"window-maximize",onMouseDown:d,onClick:e=>{e.persist(),he.ZP.isMaximized(t.vivaldiWindowId)||he.ZP.isFullscreen(t.vivaldiWindowId)?xi.Z.restore(t.vivaldiWindowId):xi.Z.maximize(t.vivaldiWindowId)},dangerouslySetInnerHTML:{__html:l}}),Qu("button",{tabIndex:"-1",className:"window-close",onMouseDown:d,onClick:e=>{e.stopPropagation(),xi.Z.close(t.vivaldiWindowId)},dangerouslySetInnerHTML:{__html:a}})]}))};var Ju=n(34197);var ep,tp=n(32773),np=n(57654);function ip(e,t,n,i){ep||(ep="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:ep,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const sp=[I.kKeyboardTabToAll];var op=ip("br",{});class ap extends Li.Component{static contextType=ts.Z;constructor(e){super(e),this.state={hasGuestSession:!1,accountState:"none",editedName:this.getProfileName(e.activeProfile),suggestedName:"",activeImageIndex:e.activeProfile.imageIndex,activeImageUrl:this.getProfileImage(e.activeProfile),profileImages:[],profileStats:[],selectedProfilePath:"",hasDesktopShortcut:!1,createDesktopShortcut:!1,canCreateDesktopShortcut:!0,canRemoveActive:!1}}componentDidMount(){this.attachListeners(),this.onWindowUpdated(),this.getAllProfileImages(),se.Z.runtimePrivate.getProfileDefaults((e=>{this.setState({suggestedName:e})})),se.Z.runtimePrivate.hasDesktopShortcut(((e,t)=>{this.setState({hasDesktopShortcut:e,createDesktopShortcut:e,canCreateDesktopShortcut:t})}))}componentWillUnmount(){this.detachListeners()}attachListeners=()=>{i.Z.windows.onCreated.addListener(this.onWindowUpdated),i.Z.windows.onRemoved.addListener(this.onWindowUpdated)};detachListeners=()=>{i.Z.windows.onCreated.removeListener(this.onWindowUpdated),i.Z.windows.onRemoved.removeListener(this.onWindowUpdated)};onWindowUpdated=()=>{se.Z.runtimePrivate.hasGuestSession((e=>{this.state&&this.setState({hasGuestSession:e})}))};getAllProfileImages=()=>{se.Z.runtimePrivate.getUserProfileImages((e=>{this.setState({profileImages:e})}))};openNamedProfile=e=>{se.Z.runtimePrivate.openNamedProfile(e,(t=>{t||console.warn("Failed to open profile: "+e),this.props.hidePopup()}))};getProfileImage=e=>{if(e.active){const e=pe.getState().accountInfo;if(e.pictureUrl)return e.pictureUrl}return e.customAvatar?e.customAvatar:e.image};getProfileName=e=>{if(e.active){const e=pe.getState().accountInfo;if(e.accountId)return e.accountId}return e.name};toggleGuestProfile=()=>{this.state.hasGuestSession?de.Z.closeGuestSession():de.Z.openGuestWindow(),this.props.hidePopup()};managePeople=()=>{this.setState({accountState:"list"})};manageUser=()=>{this.props.isLoggedIn?(de.Z.showSettings(this.context.vivaldiWindowId,"sync"),this.props.hidePopup()):this.setState({accountState:"edit"})};exitUser=()=>{de.Z.closeActiveProfile()};getFormattedName_=()=>this.props.accountInfo.username&&this.props.isLoggedIn?ip("div",{className:"profile-name-text"},void 0,ip("div",{className:"active-sync-item-label"},void 0,(0,B.Z)("Logged in as"),op),ip("div",{},void 0,this.props.accountInfo.username)):this.props.activeProfile.name;selectActiveProfileImage=(e,t)=>{this.setState({activeImageIndex:e,activeImageUrl:t})};selectCustomProfileImage=()=>{se.Z.utilities.selectLocalImage({windowId:this.context.vivaldiWindowId,title:(0,B.Z)("Select Custom Image"),profileImage:!0})};goBack=()=>{let e="none";"info"===this.state.accountState&&(e="list"),this.state&&this.setState({accountState:e,editedName:this.props.activeProfile.name,activeImageIndex:this.props.activeProfile.imageIndex,canRemoveActive:!1})};onSave=()=>{let e=!0;if("edit"===this.state.accountState){if(this.state.editedName.length){const t=(0,np.Z)(this.state.editedName).trim();if(!t.length)return;const n=this.state.hasDesktopShortcut!==this.state.createDesktopShortcut||this.state.activeImageIndex!==this.props.activeProfile.imageIndex;se.Z.runtimePrivate.updateActiveProfile(t,this.state.activeImageIndex,n?this.state.createDesktopShortcut:void 0,(t=>{e=t}))}}else if("new"===this.state.accountState&&this.state.suggestedName.length){const t=(0,np.Z)(this.state.suggestedName).trim();if(!t.length)return;se.Z.runtimePrivate.createProfile(t,this.state.activeImageIndex,this.state.createDesktopShortcut,(t=>{e=t}))}this.props.hidePopup&&e&&this.props.hidePopup()};onCancel=()=>{this.goBack()};onSignin=()=>{de.Z.showSettings(this.context.vivaldiWindowId,"sync"),this.props.hidePopup()};onRegister=()=>{de.Z.showSettings(this.context.vivaldiWindowId,"sync",{view:"register"}),this.props.hidePopup()};createProfile=()=>{this.setState({accountState:"new",activeImageIndex:0})};showProfileInfo=(e,t)=>{this.setState({accountState:"info",selectedProfilePath:e}),t.preventDefault(),t.stopPropagation(),se.Z.runtimePrivate.getProfileStatistics(e,(e=>{e.map((e=>{switch(e.category){case"Autofill":e.category=(0,B.Z)("other","Autofill");break;case"Bookmarks":e.category=(0,B.Z)("Bookmarks");break;case"Passwords":e.category=(0,B.Z)("Passwords");break;case"BrowsingHistory":e.category=(0,B.Z)("Browsing History")}})),this.setState({profileStats:e})}))};confirmRemoval=()=>{this.setState({canRemoveActive:!0})};removeProfile=()=>{se.Z.runtimePrivate.deleteProfile(this.state.selectedProfilePath,(e=>{e&&this.goBack()}))};handleNameInput=e=>{"new"===this.state.accountState?this.setState({suggestedName:e.target.value}):this.setState({editedName:e.target.value})};changeDesktopShortcut=e=>{this.setState({createDesktopShortcut:e.currentTarget.checked})};handleFocus=e=>{e.currentTarget.select()};renderNavigationBack=()=>{const e=(0,B.Z)("profiles","Back");return ip("button",{type:"button",title:e,className:"nav-back",onClick:this.goBack,dangerouslySetInnerHTML:{__html:Wi.mgF.medium+e}})};renderDialogHeader=()=>{let e;switch(this.state.accountState){case"new":e=(0,B.Z)("Create New Profile");break;case"info":break;default:e=(0,B.Z)("Edit Profile")}return e?ip("div",{className:"profile-section-header"},void 0,e):null};renderNameEdit=()=>{const e="new"===this.state.accountState?this.state.suggestedName:this.state.editedName;return ip("label",{className:"profile-section-name"},void 0,ip("input",{type:"text",name:"name",placeholder:(0,B.Z)("profiles","Name"),onChange:this.handleNameInput,value:e,onFocus:this.handleFocus,autoFocus:!0}))};renderSaveCancel=()=>ip("footer",{className:"dialog-footer"},void 0,ip("input",{type:"submit",className:"primary",value:"new"===this.state.accountState?(0,B.Z)("Add Profile"):(0,B.Z)("Save")}),ip("input",{type:"button",onClick:this.onCancel,value:(0,B.Z)("Cancel")}));renderProfileInfo=()=>{const e=[],t=this.props.allProfiles.filter((e=>e.path===this.state.selectedProfilePath));if(t&&t[0]){const n=this.getProfileName(t[0]),i=this.getProfileImage(t[0]);e.push(ip("div",{className:"profile-details"},"apv_details",ip("div",{className:"profile-image",style:{backgroundImage:`url(${i})`}}),ip("div",{className:"profile-name"},void 0,n)))}return this.state.profileStats.forEach(((t,n)=>{e.push(ip("div",{className:"profile-stat-row"},t.category,ip("div",{className:"profile-category"},void 0,t.category),ip("div",{className:"profile-count"},void 0,t.count)))})),this.state.canRemoveActive&&e.push(ip(To,{type:"error"},"apv_alert",(0,B.Z)("All profile data will be deleted and cannot be restored. Do you still want to proceed?"))),e.push(ip("input",{type:"button",className:"danger remove-person-button",onClick:this.state.canRemoveActive?this.removeProfile:this.confirmRemoval,value:(0,B.Z)("Remove Profile")},"apv_button")),e};renderSelectableProfileImages=()=>{const e=[];e.push(ip("button",{title:(0,B.Z)("Select custom avatar image"),type:"button",className:"avatarbox avatarbox-custom",onClick:this.selectCustomProfileImage.bind(this),dangerouslySetInnerHTML:{__html:Wi.IJb}},"custom-image"));let t=this.state.profileImages.map((e=>{const t=Fi()({"avatarbox-image":!0,"avatarbox-selected":this.state.activeImageIndex===e.index});return ip("button",{title:e.name,type:"button",className:"avatarbox",onClick:this.selectActiveProfileImage.bind(this,e.index,e.image)},e.index,ip("div",{className:t,style:{backgroundImage:`url(${e.image})`}}))}));return t=e.concat(t),ip("div",{className:"avatarlist"},void 0,t)};renderCreateProfileShortcut=()=>this.state.canCreateDesktopShortcut?ip("label",{},void 0,ip("input",{className:"dialog-checkbox",checked:this.state.createDesktopShortcut,onChange:this.changeDesktopShortcut,type:"checkbox"}),ip("span",{},void 0,(0,B.Z)("Create Desktop Shortcut"))):null;renderAllProfiles=()=>{const e=[];return this.props.allProfiles.forEach((t=>{const n=this.getProfileImage(t),i=this.getProfileName(t);e.push(ip("button",{className:"account-item-large",title:i,onClick:this.showProfileInfo.bind(this,t.path),tabIndex:this.props.prefValues[I.kKeyboardTabToAll],autoFocus:-1!==this.props.prefValues[I.kKeyboardTabToAll]},t.path,ip("img",{src:n}),ip("span",{className:"profile-name"},void 0,i)))})),e};renderActiveProfileHeader=()=>{let e=this.props.accountInfo.pictureUrl;return e&&this.props.isLoggedIn||(e=this.getProfileImage(this.props.activeProfile)),(0,ss.jsxs)(ss.Fragment,{children:[ip("div",{className:"account-item active-profile",onClick:this.manageUser},void 0,ip("div",{className:"profile-name"},void 0,ip("img",{src:e}),this.getFormattedName_()),(this.props.isLoggedIn||!this.props.accountInfo.username)&&ip("span",{dangerouslySetInnerHTML:{__html:Wi.Zu.medium}})),this.props.accountInfo.username&&!this.props.isLoggedIn&&ip("input",{type:"button",onClick:this.onSignin,value:(0,B.Z)("Log in"),autoFocus:!0})]})};renderInActiveProfiles=()=>{const e=this.props.allProfiles.filter((e=>!e.active)),t=[];return e.forEach((e=>{const n=this.getProfileImage(e),i=this.getProfileName(e);t.push(ip("button",{className:"account-item",title:i,onClick:this.openNamedProfile.bind(this,e.path)},e.path,ip("img",{src:n}),ip("span",{className:"profile-name"},void 0,i)))})),t};renderGuestEntry=()=>{const e=this.state.hasGuestSession?(0,B.Z)("Exit Guest Profile"):(0,B.Z)("Open Guest Profile");return ip("button",{className:"account-item",onClick:this.toggleGuestProfile,title:e,dangerouslySetInnerHTML:{__html:Wi.CtH.medium+e}})};renderManagePeople=()=>{const e=(0,B.Z)("Manage Profiles");return ip("button",{className:"account-item",onClick:this.managePeople,title:e,dangerouslySetInnerHTML:{__html:Wi.LaO.medium+e}})};renderExitUser=()=>{const e=(0,B.Z)("Exit $1",[this.props.activeProfile.name]);return ip("button",{className:"account-item",onClick:this.exitUser,title:e,dangerouslySetInnerHTML:{__html:Wi.kze+e}})};renderSyncCTA=()=>ip("div",{className:"account-create"},void 0,ip("span",{dangerouslySetInnerHTML:{__html:n(71665)}}),ip("p",{},void 0,(0,B.Z)("Create a Vivaldi Account to access your tabs, bookmarks, and data on all your devices.")),ip("div",{className:"toolbar toolbar-wrap toolbar-space toolbar-center"},void 0,ip("input",{type:"button",className:"primary",value:(0,B.Z)("Create Account"),onClick:this.onRegister}),ip("input",{type:"button",value:(0,B.Z)("Log In"),onClick:this.onSignin})));render(){return"edit"===this.state.accountState||"new"===this.state.accountState?ip("form",{className:"account-dialog",onSubmit:this.onSave},void 0,this.renderNavigationBack(),this.renderDialogHeader(),this.renderNameEdit(),this.renderSelectableProfileImages(),this.renderCreateProfileShortcut(),this.renderSaveCancel()):"list"===this.state.accountState?ip("div",{className:"account-dialog"},void 0,this.renderNavigationBack(),ip("div",{className:"account-listing-large"},void 0,this.renderAllProfiles()),ip("footer",{className:"dialog-footer"},void 0,ip("input",{type:"submit",className:"primary",onClick:this.createProfile,value:(0,B.Z)("Add Profile")}))):"info"===this.state.accountState?ip("div",{className:"account-dialog"},void 0,this.renderNavigationBack(),this.renderDialogHeader(),ip("div",{className:"profile-stat"},void 0,this.renderProfileInfo())):this.props.activeProfile.guest?ip("div",{className:"account-dialog"},void 0,this.renderInActiveProfiles(),this.renderGuestEntry()):ip("div",{className:"account-dialog"},void 0,ip("header",{},void 0,this.renderActiveProfileHeader()),ip("div",{className:"popup-scrollarea"},void 0,!this.props.accountInfo.username&&!this.props.isLoggedIn&&this.renderSyncCTA(),this.renderInActiveProfiles(),this.renderManagePeople(),this.renderGuestEntry(),this.props.allProfiles.length>1&&this.renderExitUser()))}}const rp=(0,Bu.Z)(ap,sp);var lp,dp=n(60679);function cp(e){switch(e){case"1":return"supporter";case"2":return"patron";case"3":return"advocate";default:return""}}function up(e,t,n,i){lp||(lp="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:lp,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const pp="/resources/contact-person.png";var hp=up("div",{className:"profile-popup sync-anchor"});class gp extends Li.PureComponent{static contextType=ts.Z;state={popupVisible:!1,activeProfile:void 0,allProfiles:[],isLoggedIn:pe.getState().hasToken,accountInfo:pe.getState().accountInfo};componentDidMount(){se.Z.runtimePrivate.onProfilesUpdated.addListener(this.profilesUpdated),this.profilesUpdated(),pe.addListener(this.onVivaldiAccountChange),this.onVivaldiAccountChange()}componentWillUnmount(){se.Z.runtimePrivate.onProfilesUpdated.removeListener(this.profilesUpdated),pe.removeListener(this.onVivaldiAccountChange)}profilesUpdated=()=>{se.Z.runtimePrivate.getUserProfiles((e=>{const t=e.find((e=>!0===e.active));this.setState({allProfiles:e}),t&&this.setState({activeProfile:t})}))};onVivaldiAccountChange=()=>{const e=pe.getState();this.setState({isLoggedIn:e.hasToken&&e.isReady,accountInfo:e.accountInfo})};togglePopup=()=>{this.setState((e=>({popupVisible:!e.popupVisible})))};hidePopup=()=>{this.setState({popupVisible:!1})};render(){if(!this.props.preview&&he.ZP.isIncognito(this.context.vivaldiWindowId))return null;let e=this.state.accountInfo.username,t=this.state.accountInfo.pictureUrl;const n=cp(this.state.accountInfo.donationTier),i=this.state.activeProfile;return i?(i.guest?(i.image=t=pp,i.name=e=(0,B.Z)("Guest User")):this.state.isLoggedIn||(e=i.name,t=i.customAvatar?i.customAvatar:i.image),t||(t=pp),up(po.ZP,{imagePath:t,tooltip:e||(0,B.Z)("Account"),onClick:this.togglePopup,customizeMenu:this.props.customizeMenu,menuOrigin:this.props.menuOrigin,popupPosition:this.props.popupPosition,hidePopup:this.hidePopup,isPopupVisible:this.state.popupVisible,className:"button-circularimage button-cropimage profile-popup sync-anchor",popupClassName:"ToolbarButtonPopup-DefaultStyles",popupLabel:(0,B.Z)("dialog title","Accounts"),popupWidth:260,size:this.props.size,draggable:this.props.draggable||!1,onDragStart:this.props.onDragStart??Lr.Z,onDragEnd:this.props.onDragEnd??Lr.Z,onDrop:this.props.onDrop??Lr.Z,onDragEnter:this.props.onDragEnter??Lr.Z,onDragLeave:this.props.onDragLeave??Lr.Z,onDragOver:this.props.onDragOver??Lr.Z,mimeType:this.props.mimeType,name:this.props.name??"",badgeText:n},void 0,up(rp,{activeProfile:i,allProfiles:this.state.allProfiles,hidePopup:this.hidePopup,isLoggedIn:this.state.isLoggedIn,accountInfo:this.state.accountInfo}))):hp}}const mp=(0,dp.ZP)(gp);var fp,vp=n(13302);function yp(e,t,n,i){fp||(fp="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:fp,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const bp=(e,t)=>Ke.Z.isSingleKeyShortcut(e)?t?"singlefeatures":"single":"",Sp=["shift+tab","tab","space","enter","left","right","up","down","pageup","pagedown","numlock","home","end","insert","del"],wp=["alt+shift+f4","alt+f4","shift+insert","ctrl+insert","shift+f10"];class Cp extends Li.Component{static contextType=ts.Z;refComboInput=Li.createRef();state={keyValue:this.props.command.shortcuts||[],selectedCombo:"",active:!1,duplicateCombo:null,systemReservedCombo:"",singleKeyWarning:!1};findExistingShortcut=(e,t="browser")=>this.props.commandArray.filter((e=>e.shortcuts)).find((n=>n.shortcuts?.includes(e)&&n.feature===t));isTweakedShortcut=e=>(!this.props.command.shortcuts||!this.props.command.shortcuts.includes(e))&&Boolean(this.props.command.tweakedShortcut&&this.props.command.tweakedShortcut===e);restoreDefault=()=>{const e=C.Z.getDefault(I.kActions)[0][this.props.command.name];if(e?.shortcuts)for(let t=0;t<e.shortcuts.length;t++){const n=this.findExistingShortcut(e.shortcuts[t],this.props.command.feature);if(n&&this.props.command.name!==n.name&&!this.isTweakedShortcut(e.shortcuts[t]))return void this.setState({duplicateCombo:{shortcut:(0,vp.$)(e.shortcuts[t]),label:n.label},systemReservedCombo:"",singleKeyWarning:!1})}this.setState({keyValue:e?.shortcuts??[]},this.save)};onClearComboButton=()=>{const{selectedCombo:e}=this.state,t=this.props.command.shortcuts;if(!e||!t)return void this.setState({keyValue:[]},this.save);const n=t.indexOf(e);if(n<0)return void this.setState({selectedCombo:""},this.save);const i=[...t.slice(0,n),...t.slice(n+1)];this.setState({keyValue:i,selectedCombo:i[n]||""},this.save)};onClearComboButtonMouseDown=e=>{e.preventDefault()};handleKeyEvent=e=>{const t=Ke.Z.keyComboFromEvent(e.nativeEvent);if(!t)return;"tab"!==t&&"shift+tab"!==t&&e.preventDefault();const n=this.findExistingShortcut(t,this.props.command.feature);if("PageUp"!==e.nativeEvent.key&&"PageDown"!==e.nativeEvent.key||!e.nativeEvent.ctrlKey||e.preventDefault(),e.getModifierState("AltGraph"))return;const i=["calendar","mail"].includes(this.props.command.feature)?this.props.prefValues[I.kKeyboardShortcutsEnableSingleKeyForMail]:this.props.prefValues[I.kKeyboardShortcutsEnableSingleKey],{selectedCombo:s}=this.state;if("backspace"===t||s&&"del"===t){let e=(this.props.command.shortcuts??[]).slice();if(s&&e)e.splice(e.indexOf(s),1);else if(e)if(i)e=e.slice(0,e.length-1);else for(let t=e.length-1;t>=0;t--)if(!Ke.Z.isSingleKeyShortcut(e[t])){e.splice(t,1);break}this.setState({keyValue:e||[],duplicateCombo:null,systemReservedCombo:"",singleKeyWarning:!1},this.save),this.refComboInput.current?.focus()}else if(Ke.Z.isSingleKeyShortcut(t)&&!i)this.setState({duplicateCombo:null,systemReservedCombo:"",singleKeyWarning:!0});else if(n&&!this.isTweakedShortcut(t))this.setState({duplicateCombo:{shortcut:(0,vp.$)(t),label:n.label},systemReservedCombo:"",singleKeyWarning:!1});else if(-1!==wp.indexOf(t))this.setState({systemReservedCombo:(0,vp.$)(t),duplicateCombo:null,singleKeyWarning:!1});else if(-1===Sp.indexOf(t)){const e=this.props.command.shortcuts||[];this.setState({keyValue:e.slice().concat(t),duplicateCombo:null,systemReservedCombo:"",singleKeyWarning:!1},this.save)}else this.navigateWithArrowKeys(e)};navigateWithArrowKeys=e=>{let t=null;if(!this.state.keyValue||0===this.state.keyValue.length)return;const n=Ke.Z.keyComboFromEvent(e.nativeEvent),{document:i,HTMLElement:s}=this.context,o=i.activeElement;switch(n){case"left":o&&(t=o.previousElementSibling);break;case"right":o&&(t=o.nextElementSibling);break;case"up":o&&o.parentNode&&(t=o.parentNode.firstChild);break;case"down":o&&o.parentNode&&(t=o.parentNode.lastChild)}t instanceof s&&(e.preventDefault(),e.stopPropagation(),t.focus())};save=()=>{ne.Z.setShortcuts(this.props.command.name,this.state.keyValue)};onTextFocus=()=>{this.setState({active:!0})};onTextBlur=e=>{e.preventDefault(),e.stopPropagation(),this.setState({active:!1,duplicateCombo:null,systemReservedCombo:"",singleKeyWarning:!1}),this.save()};onButtonFocus=()=>{this.setState({active:!0})};onButtonBlur=e=>{e.preventDefault(),e.stopPropagation(),this.setState({active:!1,duplicateCombo:null,systemReservedCombo:"",singleKeyWarning:!1}),this.save()};onComboFocus=e=>{this.setState({selectedCombo:e.currentTarget.dataset.raw,active:!0})};onComboBlur=()=>{this.setState({selectedCombo:"",active:!1})};renderCombos=()=>{const e=this.props.command.shortcuts;if(Array.isArray(e)&&e.length>0){const t=["mail","calendar"].includes(this.props.command.feature);return e.map(((e,n)=>yp("button",{className:`multiinput-item ${bp(e,t)}`,"data-raw":e,onFocus:this.onComboFocus,onBlur:this.onComboBlur,onKeyDown:this.handleKeyEvent},n,(0,vp.$)(e))))}return null};renderKeyboardShortcutEditSetting=()=>yp("div",{className:Fi()({controls:!0,active:this.state.active})},void 0,yp("div",{className:"multiinput"},void 0,yp("div",{className:"multiinput-group"},void 0,this.renderCombos(),(0,ss.jsx)("input",{type:"text",ref:this.refComboInput,id:this.props.id,defaultValue:"",onKeyDown:this.handleKeyEvent,onFocus:this.onTextFocus,onBlur:this.onTextBlur}))),yp("input",{type:"button",className:"circular restorekey",title:(0,B.Z)("Restore default shortcut"),onClick:this.restoreDefault,onFocus:this.onButtonFocus,onBlur:this.onButtonBlur}),yp("input",{type:"button",className:"circular clearkey",title:(0,B.Z)("Clear shortcut"),onMouseDown:this.onClearComboButtonMouseDown,onClick:this.onClearComboButton,onFocus:this.onButtonFocus,onBlur:this.onButtonBlur}),this.state.duplicateCombo&&yp("p",{className:"info",role:"alert"},void 0,(0,B.Z)("Shortcut $1 is already assigned to “$2” command.",[this.state.duplicateCombo.shortcut.toUpperCase(),this.state.duplicateCombo?.label??""])),this.state.systemReservedCombo&&yp("p",{className:"info",role:"alert"},void 0,(0,B.Z)("Shortcut $1 is reserved by the system.",[this.state.systemReservedCombo.toUpperCase()])),this.state.singleKeyWarning&&yp("p",{className:"info",role:"alert"},void 0,(0,B.Z)("Single Key Shortcuts are currently disabled.")));render(){return this.renderKeyboardShortcutEditSetting()}}const Ap=Cp;var Ip;function Tp(e,t,n,i){Ip||(Ip="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Ip,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class Zp extends Li.PureComponent{static contextType=ts.Z;refComboInput=Li.createRef();state={commands:[],error:null};componentDidMount=()=>{this._initialSetup(),Ge.Z.addListener(this.onStoreChange)};componentWillUnmount=()=>{Ge.Z.removeListener(this.onStoreChange)};_initialSetup=()=>{this.setState({commands:Ge.Z.getSettingsList(!1)})};onStoreChange=()=>{this._initialSetup()};getCommand=()=>this.state.commands.find((e=>e.name===this.props.name));findExistingShortcut=e=>this.state.commands.filter((e=>e.shortcuts)).find((t=>t.shortcuts?.includes(e)));isDefault=()=>{const e=this.getCommand()?.shortcuts;if(void 0===e)return!0;const t=C.Z.getDefault(I.kActions)[0][this.props.name]?.shortcuts;return!!t?.every(((t,n)=>t===e[n]))||void 0===t&&0===e.length};restoreDefault=()=>{const e=C.Z.getDefault(I.kActions)[0][this.props.name];if(e.shortcuts)for(let t=0;t<e.shortcuts.length;t++){const n=e.shortcuts[t],i=this.findExistingShortcut(n);if(i&&i.name!==this.props.name)return void this.setState({error:(0,B.Z)("Shortcut $1 is already assigned to “$2” command.",[(0,vp.$)(n).toUpperCase(),i.label])})}const t=this.getCommand();t&&this.save(t,e.shortcuts||[])};handleKeyEvent=e=>{const t=this.getCommand();if(!t||["Escape","Tab"].includes(e.key)||e.getModifierState("AltGraph"))return void this.setState({error:null});e.preventDefault(),e.stopPropagation();const n=Ke.Z.keyComboFromEvent(e.nativeEvent);if("Backspace"!==e.key){if(n){const e=this.findExistingShortcut(n);if(!C.Z.get(I.kKeyboardShortcutsEnableSingleKey)&&Ke.Z.isSingleKeyShortcut(n))this.setState({error:(0,B.Z)("Single Key Shortcuts are currently disabled.")});else if(e)this.setState({error:(0,B.Z)("Shortcut $1 is already assigned to “$2” command.",[(0,vp.$)(n).toUpperCase(),e.label])});else if(-1!==wp.indexOf(n)){const e=(0,vp.$)(n);this.setState({error:(0,B.Z)("Shortcut $1 is reserved by the system.",[e.toUpperCase()])})}else-1===Sp.indexOf(n)&&this.setState({error:null},(()=>{const e=(t.shortcuts||[]).concat(n);this.save(t,e,(()=>{this.refComboInput.current?.focus()}))}))}}else{const e=t.shortcuts?.slice(0,t.shortcuts.length-1);e&&this.setState({error:null},(()=>{this.save(t,e)}))}};deleteCombo=(e,t,n,i)=>{const{HTMLElement:s}=this.context,o=n.filter(((e,t)=>t!==i));if("Delete"===e.key){const n=e.currentTarget.nextElementSibling;this.save(t,o,(()=>{n instanceof s&&n.focus()}))}else if("Backspace"===e.key&&n){const n=e.currentTarget.previousElementSibling||e.currentTarget.nextElementSibling;this.save(t,o,(()=>{n instanceof s&&n.focus()}))}else this.handleKeyEvent(e)};save=(e,t,n)=>{const{name:i}=e;this.setState({error:null},(()=>{ne.Z.setShortcuts(i,t),n&&n()}))};render(){const e=this.getCommand(),t=e&&Array.isArray(e.shortcuts)&&e.shortcuts;return(0,ss.jsxs)(ss.Fragment,{children:[Tp("div",{className:"SingleShortcut-Toolbar toolbar toolbar-default"},void 0,Tp("div",{className:"multiinput"},void 0,Tp("div",{className:"multiinput-group"},void 0,e&&t&&t.map(((n,i)=>Tp("button",{style:{textTransform:"capitalize"},className:"multiinput-item",onKeyDown:n=>{this.deleteCombo(n,e,t,i)}},n,(0,vp.$)(n)))),(0,ss.jsx)("input",{type:"text",ref:this.refComboInput,placeholder:t&&0===t.length&&this.props.placeholder||null,onKeyDown:this.handleKeyEvent}))),Tp(po.ZP,{onClick:this.restoreDefault,image:Wi.GO5.medium,disabled:void 0!==e&&this.isDefault(),tooltip:(0,B.Z)("Restore default shortcut")})),this.state.error&&Tp("p",{className:"SingleShortcut-Error",dangerouslySetInnerHTML:{__html:Wi.Si$.small+this.state.error}})]})}}const Ep=Zp;var kp;function _p(e,t,n,i){kp||(kp="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:kp,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Np=[I.kPrivacyBreakModeIntroductionShow];class Pp extends Li.PureComponent{render(){return _p("div",{className:"popup-scrollarea"},void 0,_p("div",{className:"BreakModePopup--Graphic",dangerouslySetInnerHTML:{__html:Wi.Gvk.large}}),_p("h1",{id:"popout-breakmode-title"},void 0,(0,B.Z)("Take a Break")),_p("p",{className:"BreakModePopup-Intro"},void 0,(0,B.Z)("Vivaldi is fading content and pausing media. Focus elsewhere for a while.")),_p("h3",{},void 0,(0,B.Z)("Keyboard Shortcut")),_p(Ep,{name:"COMMAND_BREAKMODE_TOGGLE",placeholder:(0,B.Z)("No shortcut assigned")}),_p("label",{},void 0,_p("input",{type:"checkbox",checked:!this.props.prefValues[I.kPrivacyBreakModeIntroductionShow],onChange:()=>{w.Z.toggle(I.kPrivacyBreakModeIntroductionShow,!0,!1)}}),_p("span",{},void 0,(0,B.Z)("Do not show again"))))}}const Dp=(0,Bu.Z)(Pp,Np);var Mp;function Op(e,t,n,i){Mp||(Mp="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Mp,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const xp=[I.kPrivacyBreakModeIntroductionShow];var Lp=Op(Dp,{});class Rp extends Li.PureComponent{state={shouldShowPopup:Ga.Z.getState().isActive&&this.props.prefValues[I.kPrivacyBreakModeIntroductionShow],isInBreakMode:Ga.Z.getState().isActive};componentDidMount=()=>{this.props.inEditor||Ga.Z.addListener(this.onBreakModeChanged)};componentWillUnmount=()=>{this.props.inEditor||Ga.Z.removeListener(this.onBreakModeChanged)};onBreakModeChanged=()=>{const e=Ga.Z.getState().isActive,t=e&&this.props.prefValues[I.kPrivacyBreakModeIntroductionShow];this.setState({isInBreakMode:e,shouldShowPopup:t})};hidePopup=()=>{this.setState({shouldShowPopup:!1})};menu=()=>[{type:"checkbox",checked:this.props.prefValues[I.kPrivacyBreakModeIntroductionShow],handler:()=>{w.Z.toggle(I.kPrivacyBreakModeIntroductionShow,!0,!1)},...(0,us.Z)("Show Break Mode Introduction")}];render(){return Op(po.ZP,{className:"panel-clickoutside-ignore",label:(0,B.Z)("Break Mode"),tooltip:this.state.isInBreakMode?(0,B.Z)("End Break"):(0,B.Z)("Take a Break"),onClick:Ha.Z.toggleBreakMode,customizeMenu:this.props.customizeMenu,menuOrigin:this.props.menuOrigin,image:this.state.isInBreakMode?Wi._qK[this.props.size]:Wi.Gvk[this.props.size],draggable:this.props.draggable,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,onDrop:this.props.onDrop,onDragEnter:this.props.onDragEnter,mimeType:this.props.mimeType,name:this.props.name,hidePopup:this.hidePopup,popupPosition:this.props.popupPosition,popupClassName:"BreakModePopup ToolbarButtonPopup-DefaultStyles",popupLabelledBy:this.props.prefValues[I.kPrivacyBreakModeIntroductionShow]?"popout-breakmode-title":void 0,hasPopup:this.props.prefValues[I.kPrivacyBreakModeIntroductionShow],popupWidth:220,isPopupVisible:this.state.shouldShowPopup,menu:this.menu,size:this.props.size,style:{"--breakModeActive":this.state.isInBreakMode?1:0},commandId:"COMMAND_BREAKMODE_TOGGLE"},void 0,Lp)}}const Bp=(0,Bu.Z)(Rp,xp);var Fp=n(71636),Wp=n(6320);class Up extends m.Z{getInitialState(){return[]}getLogsByComponent(e){return this.getState().filter((t=>e.includes(t.component)))}#b=(e,t,n,i)=>{let s=e;return n&&(s=s.filter((e=>!t.some((t=>t===e.component))||!e.tags.some((e=>n.includes(e)))))),i&&(s=s.filter((e=>!t.some((t=>t===e.component))||!i.includes(e.level)))),n||i||(s=s.filter((e=>!t.some((t=>t===e.component))))),s};reduce(e,t){switch(t.actionType){case"COMPONENT_LOGGER_LOG":{let n;return e.length>=1e3?(n=e.slice(1),n.push(t.entry)):n=e.concat(t.entry),n}case"COMPONENT_LOGGER_PRUNE":{const{components:n,tags:i,levels:s}=t;return this.#b(e,n,i,s)}}return e}}const Vp=new Up;var Hp,Gp=n(21788);function $p(e,t,n,i){Hp||(Hp="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Hp,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function Kp(e){switch(e){case"warn":return"warning";case"log":return"info";default:return e}}function zp(e){for(const t of e)if(t instanceof Error)return t}function jp(e){const{component:t,tags:n,level:i,timestamp:s,args:o}=e,a=W()(s).format("HH:mm:ss.SSS"),r=gc(o).join(" "),l=`${a} ${i} [${t} - ${n.join(", ")}] ${r}\r\n`,d=zp(o);return d?`${l}${d.stack}\r\n`:l}var Yp=$p("br",{});function Xp(e){const t=Li.useContext(ts.Z);function n(){Gp.Z.copyTextToClipboard(jp(e.entry))}const{args:i,level:s,tags:o,timestamp:a}=e.entry,r=zp(i);return $p(To,{type:Kp(s)},void 0,$p("div",{className:"StatusPopup-LogEntryMessage","data-index":e.index,onContextMenu:function(e){(0,cs.Z)(t,[{handler:n,...(0,us.Z)("verb","Copy")}])(e)}},void 0,$p("span",{className:"StatusPopup-LogEntryTags"},void 0,"[",o.join(", "),"]"),gc(i).join(" ").split("\n").map(((t,n)=>$p(Li.Fragment,{},`line-${e.index}-${n}`,t,Yp))),$p("span",{className:"StatusPopup-LogEntryTimestamp"},void 0,!!r&&$p("span",{className:"StatusPopup-LogEntryStacktrace",title:r.stack,dangerouslySetInnerHTML:{__html:Wi.AE4.small}}),W()(a).format("HH:mm:ss.SSS"))))}var Qp=$p("option",{value:It.of},It.of,It.of);const qp=function(e){const{document:t}=Li.useContext(ts.Z),[n,i]=Li.useState(It.of),[s,o]=Li.useState("info"),a=C.Z.get(I.kMailAccounts);let r=n===It.of?e.logs:e.logs.filter((e=>e.tags.includes(n)));return"warn"===s?r=r.filter((e=>["error","warn"].includes(e.level))):"error"===s&&(r=r.filter((e=>"error"===e.level))),(0,ss.jsxs)(ss.Fragment,{children:[$p("div",{className:"StatusPopupViewFilterSelect"},void 0,$p(ta.Z,{value:s,onChange:function(e){const t=e.currentTarget.value;o(t)}},void 0,$p("option",{value:"info"},void 0,(0,B.Z)("Log","Info")),$p("option",{value:"warn"},void 0,(0,B.Z)("Log","Warn")),$p("option",{value:"error"},void 0,(0,B.Z)("Log","Error"))),"Mail"===e.component&&$p(ta.Z,{value:n,onChange:function(e){const{value:t}=e.currentTarget;i(t)}},void 0,Qp,a.map((e=>$p("option",{value:e.MAIL_EMAIL},e.MAIL_EMAIL,e.MAIL_EMAIL))))),0===r.length&&$p("div",{className:"StatusPopup-ContentPane StatusPopup-ContentPane--Empty"},void 0,$p("span",{dangerouslySetInnerHTML:{__html:Wi.RXs}}),$p("h1",{},void 0,(0,B.Z)("No Logs")),$p("p",{className:"faded-text"},void 0,(0,B.Z)("No logs to show yet."))),r.length>0&&$p("div",{className:"StatusPopup-List",tabIndex:r.length?"-1":"0"},void 0,r.map(((e,t)=>$p(Xp,{entry:e,index:t},e.timestamp+"__"+t)))),!e.hideButtons&&$p("div",{className:"StatusPopup-Footer toolbar-default"},void 0,$p(po.ZP,{onClick:function(){const n=t.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(r.map(jp).join(""))),n.download=`Vivaldi_${e.component}_log.txt`,n.click()},disabled:0===r.length,title:(0,B.Z)("Save to File")}),$p(po.ZP,{onClick:function(){const e=r.map(jp).join("");Gp.Z.copyTextToClipboard(e)},disabled:0===r.length,title:(0,B.Z)("mail","Copy to Clipboard")}),$p(po.ZP,{onClick:()=>l.Z.prune(["oAuth",e.component],n===It.of?void 0:[n],"info"===s?void 0:[s]),disabled:0===r.length,title:(0,B.Z)("Clear")}))]})};var Jp,eh=n(25765),th=n(51540),nh=n(81723),ih=n(58821),sh=n(27856);function oh(e,t,n,i){Jp||(Jp="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Jp,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const ah=new DOMParser;function rh(e){const{start:t,end:n}=(0,ih.aE)(e,!0);let i,s,o="";return e.allDay?(i=W().localeData().longDateFormat("LL"),s=W().localeData().longDateFormat("LL")):(i=(0,ih.KC)(new Date,new Date(t.valueOf()||n.valueOf()))?"LT":R.ZP.getShortDateFormat()+" LT",s="LT"),e.start&&e.end&&t.valueOf()===n.valueOf()?o=`${t.format(i)}`:e.start&&e.end?o=`${t.format(i)}-${n.format(s)}`:e.end&&(o=`${n.format(i)}`),o}function lh(e){let t="";if(void 0!==e){t=`${W()(e).format("LT")}`}return t}const dh=new Set(["a","b","br","div","del","em","h1","h2","h3","h4","h5","h6","hr","i","ins","mark","p","s","sub","sup","span","strike","strong","u"]);function ch(e,t){let n=e;for(let e=0;e<n.length;e++)if("<"===n[e])for(let i=e+1;i<n.length;i++){const s=n[i];if("<"===s){const e=n.slice(i),{encoded:t,original:s}=ch(e,!1),o=i+s.length;n=`${n.slice(0,i)}${t}${n.slice(o)}`,i=o-1}else if(">"===s){if("/"===n[i-1]){const s=n.slice(e+1,i),o=s.match(/\w+/i)?.[0];if(o&&dh.has(o.toLowerCase())){if(e=i+1,!t){const t=n.slice(e,i);return{encoded:t,original:t}}break}if(!t)return{encoded:`&lt;${s}&gt;`,original:`<${s}>`};n=`${n.slice(0,e)}&lt;${s}&gt;${n.slice(i+1)}`,e=i+6;break}{const s=n.slice(e+1,i),o=s.match(/\w+/i)?.[0];if(o){const a=`</${o}>`,r=n.indexOf(a,i);if(-1!==r){const l=n.slice(i+1,r),d=ch(l,!0),c=d.encoded.length-d.original.length;if(dh.has(o?.toLowerCase())){if(!t){const e=`<${s}>`;return{encoded:e+d.encoded+a,original:e+l+a}}const i=r+a.length+c;n=`${n.slice(0,e)}<${s}>${d.encoded}</${o}>${n.slice(i)}`,e=i;break}if(!t)return{encoded:`&lt;${s}&gt;`,original:`<${s}>`};const u=i+d.encoded.length+a.length+1;n=`${n.slice(0,e)}&lt;${s}&gt;${d.encoded}&lt;/${o}&gt;${n.slice(u)}`,e=u+12;break}}if(!t)return{encoded:`&lt;${s}&gt;`,original:`<${s}>`};n=`${n.slice(0,e)}&lt;${s}&gt;${n.slice(i+1)}`,e=i+6;break}}if(i===n.length-1){n=`${n.slice(0,e)}&lt;${n.slice(e+1)}`;break}}else">"===n[e]&&(n=`${n.slice(0,e)}&gt;${n.slice(e+1)}`,e+=3);return{encoded:n,original:e}}function uh(e){return ch(e,!0).encoded}function ph(e,t,n,i){let s=n.trim();if(!s)return null;const o=uh(s);return function(e){return-1===e.indexOf("<")||ah.parseFromString(e,"text/html").body?.innerText===e}(o)&&(s=function(e){const t=e.match(/(\n|[^\r\n]+)/g);return t&&1!==t.length?t.map((e=>-1!==e.indexOf("\n")?"<br />":e.startsWith("-::")?`<p class="delimiter">${e}</p>`:`<p>${e}</p>`)).join(""):e}((0,th.Z)(o))),s=(0,sh.sanitize)(s),(0,ss.jsx)("span",{ref:i,className:`cal-event-${t}`,onClick:t=>function(e,t){const{vivaldiWindowId:n,HTMLAnchorElement:i,HTMLElement:s}=t,o=e.target instanceof s&&e.target.closest("a");e.ctrlKey?e.preventDefault():o instanceof i&&e.currentTarget.contains(o)&&o.href&&((0,ms.ZP)(e),c.ZP.openURL(n,o.href))}(t,e),dangerouslySetInnerHTML:{__html:s}},t)}function hh(e,t,n,i){const s=El.Z.getCalendars();if(0===s.length)return oh("div",{},void 0,(0,B.Z)("You have no calendars set up, event can not be saved"));const o=e.calendarId?s.find((t=>t.id===e.calendarId)):Zl.ZP.getDefaultCalendar(e.task);if(!o){return oh("p",{className:"info"},void 0,e.task?(0,B.Z)("No task list found. Please go to calendar settings to add one."):(0,B.Z)("No calendar found. Please go to calendar settings to add one."))}const a=El.Z.getAccounts().find((e=>e.id===o?.accountId));if(!a)return oh("p",{className:"info"},void 0,(0,B.Z)("Calendar account not found. Go to settings and add a calendar account."));if("ical"===a.account_type){const e=Zl.ZP.createCalendarIcon(o,10);return oh("div",{title:(0,B.Z)("Web Calendar: $1",[o.description||o.name])},void 0,oh("span",{className:"calendar-dot",dangerouslySetInnerHTML:{__html:e}}),o.description||o.name)}const r=El.Z.getState().accounts.filter((e=>"ical"===e.account_type)).map((e=>e.id)),l=(0,nh.Z)(El.Z.getVisibleCalendars(),r,((e,t)=>e.accountId===t)),d=e.task?l.filter((e=>e.supportedCalendarComponent?.vtodo)):l.filter((e=>e.supportedCalendarComponent?.vevent));return oh(po.ZP,{className:"CalendarSelector",title:Zl.ZP.getCalendarDisplayName(o,!0),image:Zl.ZP.createCalendarIcon(o,10),menu:()=>function(e){return e.map((e=>{const n=Zl.ZP.createCalendarIconPNG(e),i=Zl.ZP.getCalendarDisplayName(e,!0);return{handler:()=>t(e.id),label:i,labelEnglish:i,iconPNG:n,iconPNGWhite:n}}))}(d),menuOrigin:"bottomLeft",tabIndex:n})}var gh,mh=n(8336),fh=n(39980),vh=n(76259),yh=n.n(vh);function bh(e,t,n,i){gh||(gh="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:gh,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function Sh(e){return e.some((e=>"error"===e.level))}function wh(e){switch(e.account_type){case"google":return`<img src="${fh.K}" />`;case"ical":case"caldav":return Wi.eTS.small;case"vivaldi":return yh();default:return Wi.bcq.small}}function Ch(e){const[t,n]=Li.useState({}),i=El.Z.getAccounts();async function s(e){!function(e){n((t=>({...t,[e.id]:{pending:!0,state:"UNKNOWN",message:""}})))}(e);const t=await Fp.Z.pollCalDAV([e.id]),i=Zl.ZP.getPollResultText(t);let s="SUCCESS";!t.didPoll&&t.error?s="WARNING":t.error&&(s="ERROR"),function(e,t,i){n((n=>({...n,[e.id]:{pending:!1,state:t,message:i}})))}(e,s,i)}return(0,ss.jsxs)(ss.Fragment,{children:[bh("div",{className:"StatusPopup-List"},void 0,i.map((e=>{const n=El.Z.getCalendars().filter((t=>t.accountId===e.id)),i=Math.max(...n.map((e=>e.lastChecked)).filter(Boolean));return bh(Li.Fragment,{},e.id,bh("div",{className:"StatusPopup-Account"},void 0,bh("span",{className:"StatusPopup-AccountIcon",dangerouslySetInnerHTML:{__html:wh(e)}}),bh("span",{className:Fi()("StatusPopup-AccountName",{"StatusPopup-AccountName--Local":"local"===e.account_type})},void 0,e.name),"local"!==e.account_type&&bh("div",{className:"StatusPopup-AccountStatus"},void 0,t[e.id]?.pending&&bh("span",{className:"spinner",dangerouslySetInnerHTML:{__html:Wi.H0I}}),"ERROR"===t[e.id]?.state&&bh("span",{className:"StatusPopup-AccountStatus--Error",title:t[e.id].message,dangerouslySetInnerHTML:{__html:Wi.viW}}),"WARNING"===t[e.id]?.state&&bh("span",{className:"StatusPopup-AccountStatus--Warning",title:t[e.id].message,dangerouslySetInnerHTML:{__html:Wi.h6}}),"SUCCESS"===t[e.id]?.state&&bh("span",{className:"StatusPopup-AccountStatus--Success",title:t[e.id].message,dangerouslySetInnerHTML:{__html:Wi.JLz}}),bh(po.ZP,{onClick:()=>s(e),title:(0,B.Z)("Refresh")})),n.map((e=>{const t=Zl.ZP.createCalendarIcon(e,8);return bh(Li.Fragment,{},e.id,bh("span",{className:"StatusPopup-CalendarIcon",dangerouslySetInnerHTML:{__html:t}}),bh("span",{className:"StatusPopup-CalendarName"},e.id,e.description||e.name))})),"local"!==e.account_type&&bh("div",{className:"StatusPopup-AccountPoll"},void 0,(0,B.Z)("Last Checked $1",[W()(i).fromNow()]))))}))),bh("div",{className:"StatusPopup-Footer toolbar-default"},void 0,bh(po.ZP,{onClick:()=>async function(e){for(const t of e)await s(t)}(i),title:(0,B.Z)("Refresh All")}))]})}var Ah=bh("dt",{},void 0,"Id"),Ih=bh("dt",{},void 0,"Date"),Th=bh("dt",{},void 0,"UID"),Zh=bh("dt",{},void 0,"Sequence"),Eh=bh("dt",{},void 0,"Recurrence"),kh=bh("dt",{},void 0,"Exceptions"),_h=bh("div",{className:"StatusPopup-Footer"});function Nh(e){const{selectedEvent:t}=e;return(0,ss.jsxs)(ss.Fragment,{children:[0===e.events.length&&bh("div",{className:"StatusPopup-ContentPane StatusPopup-ContentPane--Empty"},void 0,bh("span",{dangerouslySetInnerHTML:{__html:Wi.g1e}}),bh("h1",{},void 0,(0,B.Z)("No Events")),bh("p",{className:"faded-text"},void 0,(0,B.Z)("Get started by creating a new event.")),bh("input",{type:"button",className:"primary",value:(0,B.Z)("New Event"),onClick:()=>te.ZP.showAddEvent(e.windowId,"","")})),e.events.length>0&&(0,ss.jsxs)(ss.Fragment,{children:[bh("h3",{},void 0,(0,B.Z)("Upcoming Events")),bh("div",{className:"StatusPopup-List"},void 0,e.events.slice(0,5).map((t=>{const n=Zl.ZP.getEventColors(t.calendarId);return bh("button",{tabIndex:C.Z.get(I.kKeyboardTabToAll),className:Fi()("StatusPopup-Event",{"StatusPopup-Event--AllDay":t.allDay}),onClick:()=>{de.Z.showCalendar(e.windowId,t.id),e.hidePopup()},style:n},Zl.ZP.generateKey(t),bh("span",{className:"StatusPopup-EventIcon",dangerouslySetInnerHTML:{__html:Zl.ZP.getEventSquircle()}}),bh("span",{className:"StatusPopup-EventDate"},void 0,rh(t)),bh("span",{className:"StatusPopup-EventTitle"},void 0,t.title||eh.gT))})))]}),t&&bh("dl",{className:"StatusPopup-EventDetail"},void 0,bh("dt",{},void 0,(0,B.Z)("Selected")),bh("dd",{},void 0,t.title),Ah,bh("dd",{},void 0,t.id),Ih,bh("dd",{},void 0,`${W()(t.start).format("l LT")} - ${W().duration(t.start-t.end).humanize()}`),Th,bh("dd",{},void 0,t.uid),Zh,bh("dd",{},void 0,t.sequence),t.rrule&&(0,ss.jsxs)(ss.Fragment,{children:[Eh,bh("dd",{},void 0,t.rrule),kh]}),!!t.recurrenceExceptions?.length&&(0,ss.jsx)(ss.Fragment,{children:bh("dd",{},void 0,t.recurrenceExceptions.map(((e,t)=>bh("p",{},t,`${W()(e.date).format("l LT")}`,` Cancel: ${e.cancelled?.toString()??"false"}`,!!e.exception_event_id&&"0"!==e.exception_event_id&&` Exc. Id: ${e.exception_event_id}`))))})),_h]})}function Ph(e){const t=El.Z.getVisibleEvents();let n;const i=Ce.ZP.getActivePage(e)?.id;if(void 0!==i){const e=Wp.Z.getStateForPage(i).selectedEvent;e&&(n=El.Z.getEvent(e),n?.trash&&(n=void 0))}return{upcomingEvents:mh.CP.call(t).sort(((e,t)=>(e.start||e.end)-(t.start||t.end))),selectedEvent:n}}class Dh extends Li.PureComponent{static contextType=ts.Z;#S;constructor(e,t){super(e);const n=Vp.getLogsByComponent(["Calendar","oAuth"]);this.state={...Ph(t.vivaldiWindowId),selectedPane:e.requestPane?e.requestPane:C.Z.get(I.kCalendarStatusSelectedPane),logs:n,hasLoggedError:Sh(n)}}componentDidMount(){El.Z.addListener(this._onStoreChange),Vp.addListener(this._onLogsUpdated),this.#S=setInterval((()=>this._onStoreChange()),me.lb)}componentWillUnmount(){Vp.removeListener(this._onLogsUpdated),this.#S&&clearInterval(this.#S),El.Z.removeListener(this._onStoreChange)}_onLogsUpdated=()=>{const e=Vp.getLogsByComponent(["Calendar","oAuth"]);this.setState({logs:e,hasLoggedError:Sh(e)})};_onStoreChange=()=>{this.setState(Ph(this.context.vivaldiWindowId))};_selectPane=e=>{w.Z.set(I.kCalendarStatusSelectedPane,e),this.setState({selectedPane:e})};_viewLog=()=>{se.Z.devtoolsPrivate.toggleDevtools(this.context.vivaldiWindowId,"console"),this.props.hidePopup()};_startChangeListeners=()=>{te.ZP.startAPIChangeListeners(),this.props.hidePopup()};openCalendarSettings=()=>{de.Z.showSettings(this.context.vivaldiWindowId,"calendar"),this.props.hidePopup()};getContextMenu=()=>[{handler:this.openCalendarSettings,...(0,us.Z)("Calendar Settings")},{handler:this._viewLog,...(0,us.Z)("View Log")},{handler:this._startChangeListeners,...(0,us.Z)("Start Calendar Change Listeners")}];render(){return(0,ss.jsxs)(ss.Fragment,{children:[bh("div",{className:"StatusPopup-Header"},void 0,bh("h2",{id:"popup-label-calendarstatus"},void 0,(0,B.Z)("Calendar Status")),bh("div",{className:"toolbar button-popup-header-toolbar toolbar-default"},void 0,bh(po.ZP,{onClick:()=>{de.Z.showCalendar(this.context.vivaldiWindowId),this.props.hidePopup()},menuOrigin:"bottomLeft",title:(0,B.Z)("Show Calendar")}),bh(po.ZP,{menuOrigin:"bottomLeft",image:Wi.bqs.small,menu:this.getContextMenu,tooltip:(0,B.Z)("Settings")}))),bh("div",{className:"toolbar toolbar-default"},void 0,bh("div",{className:"toolbar-group equal-width"},void 0,bh(po.ZP,{title:(0,B.Z)("Events"),isPressed:"events"===this.state.selectedPane,onClick:()=>this._selectPane("events")}),bh(po.ZP,{title:(0,B.Z)("Accounts"),isPressed:"accounts"===this.state.selectedPane,onClick:()=>this._selectPane("accounts")}),bh(po.ZP,{title:(0,B.Z)("Logs"),isPressed:"logs"===this.state.selectedPane,onClick:()=>this._selectPane("logs"),badgeText:this.state.hasLoggedError?"!":""}))),bh("div",{className:"StatusPopup-Content"},void 0,bh("div",{className:"StatusPopup-ContentPane"},void 0,"accounts"===this.state.selectedPane&&bh(Ch,{windowId:this.context.vivaldiWindowId}),"events"===this.state.selectedPane&&bh(Nh,{windowId:this.context.vivaldiWindowId,events:this.state.upcomingEvents,selectedEvent:this.state.selectedEvent,hidePopup:this.props.hidePopup}),"logs"===this.state.selectedPane&&bh(qp,{logs:this.state.logs,component:"Calendar"})))]})}}const Mh=Dh;const Oh=new class{open(e,t){A.Z.dispatch({actionType:"STATUS_POPUP_OPEN",component:e,pane:t})}close(e){A.Z.dispatch({actionType:"STATUS_POPUP_CLOSE",component:e})}},xh={calendarPopupOpen:!1,mailPopupOpen:!1};class Lh extends m.Z{getInitialState(){return xh}isOpen(e){switch(e){case"Calendar":return this.getState().calendarPopupOpen;case"Mail":return this.getState().mailPopupOpen}}reduce(e,t){switch(t.actionType){case"STATUS_POPUP_OPEN":return t.pane&&("Mail"===t.component?w.Z.set(I.kMailStatusSelectedPane,t.pane):"Calendar"===t.component&&w.Z.set(I.kCalendarStatusSelectedPane,t.pane)),{mailPopupOpen:"Mail"===t.component,calendarPopupOpen:"Calendar"===t.component};case"STATUS_POPUP_CLOSE":if(this.isOpen(t.component))return xh}return e}}const Rh=new Lh;var Bh;function Fh(e,t,n,i){Bh||(Bh="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Bh,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Wh=[I.kCalendarStatusButtonStyle,I.kMailIsTurnedOff];class Uh extends Li.PureComponent{static contextType=ts.Z;state={isPopupOpen:!1,lastPoll:0,hasErrors:!1};componentDidMount=()=>{this.props.inEditor||(Rh.addListener(this.popupStateChanged),Vp.addListener(this.handleLogStoreChange))};componentWillUnmount=()=>{this.props.inEditor||(Rh.removeListener(this.popupStateChanged),Vp.removeListener(this.handleLogStoreChange))};popupStateChanged=()=>{const e=Rh.getState().calendarPopupOpen;this.setState({isPopupOpen:e})};hidePopup=()=>{this.setState({isPopupOpen:!1}),Oh.close("Calendar")};togglePopup=()=>{this.setState((e=>({isPopupOpen:!e.isPopupOpen})))};openCalendarSettings=()=>{de.Z.showSettings(this.context.vivaldiWindowId,"calendar")};getTooltip=()=>(0,B.Z)("Calendar Status");calendarHasErrors=()=>Vp.getLogsByComponent(["Calendar","oAuth"]).some((e=>"error"===e.level));handleLogStoreChange=()=>{this.setState({hasErrors:this.calendarHasErrors()})};menu=()=>{const e=this.props.prefValues[I.kCalendarStatusButtonStyle];return[{handler:this.openCalendarSettings,...(0,us.Z)("Calendar Settings")},{items:[{type:"checkbox",checked:"imageandtext"===e,handler:()=>w.Z.set(I.kCalendarStatusButtonStyle,"imageandtext"),...(0,us.Z)("Image and Text")},{type:"checkbox",checked:"image"===e,handler:()=>w.Z.set(I.kCalendarStatusButtonStyle,"image"),...(0,us.Z)("Image Only")},{type:"checkbox",checked:"text"===e,handler:()=>w.Z.set(I.kCalendarStatusButtonStyle,"text"),...(0,us.Z)("title","Text Only")}],...(0,us.Z)("Button Style")}]};render(){const e=this.props.preview||this.props.inEditor||!this.props.prefValues[I.kMailIsTurnedOff]&&this.props.isMailWindow,t=this.props.prefValues[I.kCalendarStatusButtonStyle],n=!this.props.isMailWindow;return Fh(po.ZP,{badgeText:this.state.hasErrors?"!":"",className:Fi()(this.state.hasErrors?"StatusButton--HasError":"StatusButton"),popupLabelledBy:"popup-label-calendarstatus",disabled:n,onClick:this.togglePopup,customizeMenu:this.props.customizeMenu,menuOrigin:this.props.menuOrigin,tooltip:this.getTooltip(),title:"image"!==t?(0,B.Z)("Calendar Status"):void 0,image:"text"!==t?Wi.bcq[this.props.size]:void 0,draggable:this.props.draggable,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,onDrop:this.props.onDrop,onDragEnter:this.props.onDragEnter,mimeType:this.props.mimeType,name:this.props.name,hidePopup:this.hidePopup,popupPosition:this.props.popupPosition,popupClassName:"StatusPopup",popupWidth:400,isPopupVisible:this.state.isPopupOpen,menu:this.menu,size:this.props.size,style:e?void 0:{display:"none"}},void 0,Fh(Mh,{hidePopup:this.hidePopup,requestPane:this.state.hasErrors?"logs":void 0}))}}const Vh=(0,Bu.Z)(Uh,Wh);var Hh,Gh=n(34155);function $h(e,t,n,i){Hh||(Hh="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Hh,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Kh=["hour","minute","meridiem"],zh=function(e){return 1===e.length?`0${e}`:e.length>2?e.slice(e.length-2):e};class jh extends Li.PureComponent{static contextType=ts.Z;#w=!1;hidden=Li.createRef();fieldRefs={hour:Li.createRef(),minute:Li.createRef(),meridiem:Li.createRef()};hr12="";constructor(e){super(e);const t=this.getFormat(),n=t.match(/a/i)?.[0];n&&(this.hr12=n),this.separator=t.match(/h+([^m]*)m+/i)?.[1]??":";const[i="",s=""]=this.props.value.split(":");this.state={hour:i,minute:s,dateCache:W()(`2010-10-20 ${this.props.value}`)}}componentDidUpdate(e){e.value!==this.props.value&&this.setCache()}getFormat=()=>this.props.format||W()().localeData().longDateFormat("LT");setCache=()=>{const[e="",t=""]=this.props.value.split(":");this.setState({hour:e,minute:t,dateCache:W()(`2010-10-20 ${this.props.value}`)})};processChange=e=>{1!==this.state.hour.length&&1!==this.state.minute.length&&this.props.onChange(e)};select=e=>{e.target instanceof this.context.HTMLInputElement&&(e.preventDefault(),e.target.select())};focus=()=>{this.fieldRefs.hour.current?.focus()};onKeyDown=e=>{const{key:t,target:n}=e,i=n.dataset.type;if(t){const n=Kh.indexOf(i);switch(t){case"ArrowRight":e.preventDefault();const t=n+1===Kh.length?n:n+1;return void this.fieldRefs[Kh.slice(t,t+1)[0]].current?.select();case"ArrowLeft":e.preventDefault();const i=0===n?n:n-1;return void this.fieldRefs[Kh.slice(i,i+1)[0]].current?.select();case"ArrowDown":return void(e.altKey&&(e.preventDefault(),this.hidden.current?.showPicker()))}}isNaN(Number(t))&&Gh.nextTick((()=>{const{document:e,HTMLInputElement:t}=this.context;e.activeElement instanceof t&&e.activeElement.select()}))};skipToNextField(e){const{document:t}=this.context,n=this.hr12?3:2,i=Kh.indexOf(e)+1;i===n&&C.Z.get(I.kCalendarAutoTabDatetime)?Gh.nextTick((()=>(0,Ra.pf)(t))):Gh.nextTick((()=>{const e=Kh[Math.min(i,n-1)];this.fieldRefs[e].current?.select()}))}switchMeridiem=e=>{const{document:t}=this.context,{target:n}=e,i="string"==typeof e.key?e.key:"",s=this.state.dateCache.set("minute",parseInt(this.state.minute)).add(12,"hour"),{type:o}=e.target.dataset;"meridiem"===o&&("ArrowUp"===i||"ArrowDown"===i||"wheel"===e.type&&n===t.activeElement||i.toLowerCase()===s.format("a")[0].toLowerCase())&&(e.preventDefault(),this.setInput(s),this.setState({dateCache:s})),"a"!==i.toLowerCase()&&"p"!==i.toLowerCase()?this.onKeyDown(e):this.skipToNextField("meridiem")};onChangeTime=e=>{const{type:t}=e.target.dataset;let n=parseInt(e.target.value);const i=!e.nativeEvent.inputType,s=i&&this.props.step?parseInt(this.props.step):1;let o=!1;if(i&&"minute"===t&&n%s!=0){const e=parseInt(this.state.minute);o=!0,n<e?n=e-n%s:n-=n%s}const a="minute"===t?59:this.hr12?12:23,r="minute"===t?60:this.hr12?12:24;n>a?i?n%=r:this.hr12&&"hour"===t?(n%=r,this.state.dateCache.hour(n+12)):n=a:n<0&&(n=i?(n+r)%r:0);let l=n.toString();i&&(l=zh(l)),o&&e.target.setAttribute("value",l),!i&&(10*n>a||e.target.value.length>=2)&&(l=zh(l),this.skipToNextField(t)),this.setState({[t]:l},(()=>{let{hour:e}=this.state;this.hr12&&parseInt(e)<12&&"pm"===this.state.dateCache.format(this.hr12).toLowerCase()&&(e=String(parseInt(e)+12));const t=W()(this.state.dateCache).set("hour",parseInt(e)).set("minute",parseInt(this.state.minute));t.isValid()&&this.setInput(t)}))};setInput=e=>{const t=this.hidden.current,n=(Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value")||{}).set;t&&n&&(n.call(t,(0,R.mr)(e)),t.dispatchEvent(new Event("input",{bubbles:!0})))};onFocus=e=>{e.persist(),e.preventDefault();const{document:t,HTMLElement:n}=this.context;if(this.#w||!(e.target instanceof n))return;const i=e.target.closest(".dateInput");Gh.nextTick((()=>{const{onFocus:s}=this.props;s&&i instanceof n&&(0,Ra.sT)(t,i)&&(this.#w=!0,s(e))}))};onBlur=e=>{const{hour:t,minute:n}=this.state;(t.length<2||n.length<2)&&this.setState({hour:zh(t),minute:zh(n)}),e.preventDefault(),e.persist();const i=e.target.closest(".dateInput");Gh.nextTick((()=>{const{onBlur:t}=this.props,{document:n,HTMLElement:s}=this.context;t&&i instanceof s&&!(0,Ra.sT)(n,i)&&(this.#w=!1,t(e))}))};keepFocusWithin=e=>{e.preventDefault(),(0,Ra.sT)(this.context.document,e.currentTarget.nextElementSibling)||this.focus()};forceTimePicker=e=>{e.preventDefault(),this.hidden.current?.showPicker()};renderFields=()=>{const e=this.getFormat().replace(/[hma:]/gi,""),t={onFocus:this.select,onMouseDown:this.select,onMouseUp:e=>e.preventDefault(),onKeyDown:this.onKeyDown,onChange:this.onChangeTime,disabled:this.props.disabled};let n=this.state.hour;return 1!==n.length&&(n=this.hr12?zh(((parseInt(this.state.hour)+11)%12+1).toString()):this.state.hour),$h("span",{className:"faux time"},void 0,(0,ss.jsx)("input",{...t,className:"dateInputHour",tabIndex:this.props.tabIndex,type:"number",ref:this.fieldRefs.hour,"data-type":"hour",placeholder:(0,B.Z)("hh"),value:n}),$h("span",{className:"dateInputSeparator"},void 0,this.separator),(0,ss.jsx)("input",{...t,className:"dateInputMinute",type:"number",ref:this.fieldRefs.minute,"data-type":"minute",tabIndex:this.props.tabIndex,step:this.props.step,placeholder:(0,B.Z)("time","mm"),value:this.state.minute}),this.hr12&&$h("span",{},void 0,e),this.hr12&&(0,ss.jsx)("input",{...t,type:"text",ref:this.fieldRefs.meridiem,"data-type":"meridiem",className:"dateInputAmPm",tabIndex:this.props.tabIndex,placeholder:"--",value:this.state.dateCache.format(this.hr12).trim(),onKeyDown:this.switchMeridiem,onWheel:this.switchMeridiem,onChange:this.select}))};render(){return $h("span",{className:"dateInput time",title:this.props.title,onBlur:this.onBlur,onFocus:this.onFocus},void 0,(0,ss.jsx)("input",{type:"time",ref:this.hidden,tabIndex:"-1",className:"dateInputHidden",value:this.props.value,disabled:this.props.disabled,onMouseDown:this.keepFocusWithin,onMouseUp:this.forceTimePicker,onChange:this.processChange}),this.renderFields(),$h("span",{className:"arrowDown",dangerouslySetInnerHTML:{__html:Wi.yaZ.medium}}))}}const Yh=jh;var Xh;function Qh(e,t,n,i){Xh||(Xh="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Xh,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const qh=[I.kKeyboardTabToAll,I.kClockAlarmPresets,I.kClockTimers];class Jh extends Li.PureComponent{state={selectedPresetId:null,name:""};isPresetSelected=e=>e.id===this.state.selectedPresetId&&e.name===this.state.name&&this.props.minute===e.minute&&this.props.hour===e.hour;setAlarm=()=>{const e=this.state.name,t=new Date;t.setHours(this.props.hour),t.setMinutes(this.props.minute),t.setSeconds(0),this.setState({selectedPresetId:null,name:""},(()=>{this.props.hidePopup({name:e,date:t.valueOf()},"alarm")}))};setName=e=>{this.setState({name:e.currentTarget.value})};selectPreset=e=>{const t=e.name,n=e.id;this.props.setHour(e.hour),this.props.setMinute(e.minute),this.setState({name:t,selectedPresetId:n})};timeChange=e=>{const t=e.currentTarget.value.split(":"),n=parseInt(t[0]),i=parseInt(t[1]);this.props.setHour(n),this.props.setMinute(i)};savePreset=()=>{H.saveAlarmPreset(this.state.name,this.props.hour,this.props.minute)};setPreview=()=>{this.props.setMode("alarm")};render(){const e=this.props.prefValues[I.kClockAlarmPresets],t=this.state.selectedPresetId&&H.getAlarmPreset(this.state.selectedPresetId),n=this.props.alarms,i=new Date;i.setHours(this.props.hour),i.setMinutes(this.props.minute);const s=[],o=[];return n.forEach((e=>{this.props.now.valueOf()<e.date?s.push(e):o.push(e)})),Qh("div",{className:"ClockPopup-Alarms"},void 0,Qh("div",{className:"ClockPopup-Presets"},void 0,e.map((e=>{const n=t&&this.isPresetSelected(e);return Qh("div",{className:"ClockPopup-PresetWrapper"},e.id,Qh("button",{className:Fi()("ClockPopup-Preset",{"ClockPopup-Preset--selected":n}),tabIndex:this.props.prefValues[I.kKeyboardTabToAll],onClick:()=>this.selectPreset(e)},void 0,e.name),Qh("button",{className:Fi()("ClockPopup-Preset-Clear",{"ClockPopup-Preset-Clear--selected":n}),tabIndex:this.props.prefValues[I.kKeyboardTabToAll],onClick:()=>H.removeAlarmPreset(e.id),dangerouslySetInnerHTML:{__html:Wi.kze}}))}))),Qh("form",{className:"ClockPopup-Custom",onSubmit:this.setAlarm},void 0,Qh("div",{className:"ClockPopup-Custom-Line"},void 0,Qh("label",{className:"ClockPopup-TimeField"},void 0,Qh("h3",{},void 0,(0,B.Z)("Time")),Qh(Yh,{className:"ClockPopup-DateInputField",onChange:this.timeChange,step:"5",title:(0,B.Z)("Alarm time"),onFocus:this.setPreview,value:W()(i).format("HH:mm"),noValidate:!0})),Qh("label",{className:"ClockPopup-TimeField"},void 0,Qh("h3",{},void 0,(0,B.Z)("Alarm preset","Name")),Qh("input",{className:"ClockPopup-Name",type:"text",onFocus:this.setPreview,placeholder:(0,B.Z)("Alarm preset","Name"),onChange:this.setName,value:this.state.name}))),Qh("div",{className:"ClockPopup-Custom-Line ClockPopup-Custom-Line--wrap"},void 0,Qh("input",{disabled:this.state.name.length<2||t&&t.name===this.state.name,className:"ClockPopup-SavePreset",type:"button",onClick:this.savePreset,value:(0,B.Z)("Save Preset")}),Qh("input",{className:"ClockPopup-Start",type:"submit",value:(0,B.Z)("verb","Set")}))))}}const eg=(0,Bu.Z)(Jh,qh);var tg;function ng(e,t,n,i){tg||(tg="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:tg,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const ig=[I.kKeyboardTabToAll,I.kClockCountdownPresets,I.kClockTimers];class sg extends Li.PureComponent{state={selectedPresetId:null,name:""};isPresetSelected=e=>{const t=60*this.props.minute+3600*this.props.hour;return e.id===this.state.selectedPresetId&&e.name===this.state.name&&t===e.seconds};setCountdown=()=>{const e=this.state.name,t=W()().add(this.props.hour,"hours").add(this.props.minute,"minutes").valueOf();this.setState({selectedPresetId:null,name:""},(()=>{this.props.hidePopup({name:e,date:t},"countdown")}))};setMinute=e=>{const{value:t}=e.currentTarget,n=Math.min(Math.max(parseInt(t),0),59);this.props.setMinute(n)};setHour=e=>{const{value:t}=e.currentTarget,n=Math.min(Math.max(parseInt(t),0),23);this.props.setHour(n)};decrementHour=()=>{this.props.setHour(this.props.hour-1)};incrementHour=()=>{this.props.setHour(this.props.hour+1)};decrementMinute=()=>{this.props.setMinute(this.props.minute-1)};incrementMinute=()=>{this.props.setMinute(this.props.minute+1)};setName=e=>{this.setState({name:e.currentTarget.value})};setPreview=()=>{this.props.setMode("countdown")};handleFocus=e=>{this.setPreview(),e.target.select()};selectPreset=e=>{const t=W().duration(e.seconds,"seconds"),n=e.name,i=t.hours(),s=t.minutes();this.props.setHour(i),this.props.setMinute(s),this.setState({name:n,selectedPresetId:e.id})};savePreset=()=>{const e=60*this.props.hour*60+60*this.props.minute;H.saveCountdownPreset(this.state.name,e)};render(){const e=this.props.prefValues[I.kClockCountdownPresets],t=this.state.selectedPresetId&&H.getCountdownPreset(this.state.selectedPresetId),n=this.props.countdowns,i=[],s=[];return n.forEach((e=>{this.props.now.valueOf()<e.date?i.push(e):s.push(e)})),ng("div",{className:"ClockPopup-Countdowns"},void 0,ng("div",{className:"ClockPopup-Presets"},void 0,e.map((e=>{const n=t&&this.isPresetSelected(e);return ng("div",{className:"ClockPopup-PresetWrapper"},e.id,ng("button",{className:Fi()("ClockPopup-Preset",{"ClockPopup-Preset--selected":n}),tabIndex:this.props.prefValues[I.kKeyboardTabToAll],onClick:()=>this.selectPreset(e)},void 0,e.name),ng("button",{className:Fi()("ClockPopup-Preset-Clear",{"ClockPopup-Preset-Clear--selected":n}),tabIndex:this.props.prefValues[I.kKeyboardTabToAll],onClick:()=>H.removeCountdownPreset(e.id),dangerouslySetInnerHTML:{__html:Wi.kze}}))}))),ng("form",{className:"ClockPopup-Custom",onSubmit:this.setCountdown},void 0,ng("div",{className:"ClockPopup-Custom-Line"},void 0,ng("label",{className:"ClockPopup-TimeField"},void 0,ng("h3",{},void 0,(0,B.Z)("Hours")),ng("input",{className:"ClockPopup-DateInputField",type:"number","data-type":"hour",step:1,min:0,max:23,onFocus:this.handleFocus,placeholder:(0,B.Z)("hh"),onChange:this.setHour,value:this.props.hour}),ng("div",{className:"ClockPopup-Spinner-Wrapper"},void 0,ng("button",{tabIndex:this.props.prefValues[I.kKeyboardTabToAll],disabled:23===this.props.hour,onClick:this.incrementHour,type:"button",className:"ClockPopup-Spinner ClockPopup-Spinner--up"}),ng("button",{tabIndex:this.props.prefValues[I.kKeyboardTabToAll],disabled:0===this.props.hour,type:"button",onClick:this.decrementHour,className:"ClockPopup-Spinner ClockPopup-Spinner--down"}))),ng("label",{className:"ClockPopup-TimeField"},void 0,ng("h3",{},void 0,(0,B.Z)("Minutes")),ng("input",{className:"ClockPopup-DateInputField",type:"number","data-type":"minute",step:1,min:0,max:59,placeholder:(0,B.Z)("time","mm"),onChange:this.setMinute,onFocus:this.handleFocus,value:this.props.minute}),ng("div",{className:"ClockPopup-Spinner-Wrapper"},void 0,ng("button",{tabIndex:this.props.prefValues[I.kKeyboardTabToAll],disabled:59===this.props.minute,onClick:this.incrementMinute,type:"button",className:"ClockPopup-Spinner ClockPopup-Spinner--up"}),ng("button",{tabIndex:this.props.prefValues[I.kKeyboardTabToAll],disabled:0===this.props.minute,onClick:this.decrementMinute,type:"button",className:"ClockPopup-Spinner ClockPopup-Spinner--down"}))),ng("label",{className:"ClockPopup-TimeField"},void 0,ng("h3",{},void 0,(0,B.Z)("Countdown preset","Name")),ng("input",{className:"ClockPopup-Name",type:"text",placeholder:(0,B.Z)("Countdown preset","Name"),onChange:this.setName,onFocus:this.handleFocus,value:this.state.name}))),ng("div",{className:"ClockPopup-Custom-Line ClockPopup-Custom-Line--wrap"},void 0,ng("input",{disabled:this.state.name.length<2||t&&t.name===this.state.name,className:"ClockPopup-SavePreset",type:"button",onClick:this.savePreset,value:(0,B.Z)("Save Preset")}),ng("input",{disabled:0===this.props.hour&&0===this.props.minute,className:"ClockPopup-Start",type:"submit",value:(0,B.Z)("Start")}))))}}const og=(0,Bu.Z)(sg,ig);var ag;function rg(e,t,n,i){ag||(ag="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:ag,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const lg=[I.kKeyboardTabToAll,I.kClockShowSeconds,I.kClockMode,I.kClockTimers];class dg extends Li.PureComponent{constructor(e){super(e),this.state={alarmHour:13,alarmMinute:37,countdownHour:0,countdownMinute:0,previewMode:"alarm"===this.props.prefValues[I.kClockMode]?"alarm":"countdown"}}setAlarmHour=e=>{this.setState({alarmHour:e})};setAlarmMinute=e=>{this.setState({alarmMinute:e})};setCountdownHour=e=>{this.setState({countdownHour:e})};setCountdownMinute=e=>{this.setState({countdownMinute:e})};setMode=e=>{w.Z.set(I.kClockMode,e),this.setState({previewMode:e})};setPreviewMode=e=>{this.setState({previewMode:e})};getClockStyle=()=>{const e=this.props.now.getHours(),t=this.props.prefValues[I.kClockShowSeconds]?this.props.now.getSeconds():0,n=this.props.now.getMinutes(),i=n/60,s={"--hourDeg":(e+i)%12*30-90+"deg","--minuteDeg":6*n+"deg","--secondDeg":this.props.prefValues[I.kClockShowSeconds]?6*t+360*n+60*e*360+"deg":"0deg"};if("countdown"===this.state.previewMode&&(s["--hourPercent"]=this.state.countdownHour<12?this.state.countdownHour/.12:100,s["--minutePercent"]=this.state.countdownMinute/.6),"alarm"===this.state.previewMode){const t=this.state.alarmHour>e?this.state.alarmHour-e:this.state.alarmHour===e&&this.state.alarmMinute>n?0:this.state.alarmHour-e+24,o=t>0?t-i:0,a=this.state.alarmMinute>n?this.state.alarmMinute-n:this.state.alarmMinute-n+60;s["--hourPercent"]=o<12?o/.12:100,s["--minutePercent"]=a/.6}return s};getInfoText=e=>{const t=e.filter((e=>"alarm"===e.type)),n=e.filter((e=>"countdown"===e.type));return t.length>0&&n.length>0?(0,B.Z)("$1 alarm","$1 alarms",[t.length])+", "+(0,B.Z)("$1 countdown","$1 countdowns",[n.length]):t.length>0?(0,B.Z)("$1 alarm","$1 alarms",[t.length]):n.length>0?(0,B.Z)("$1 countdown","$1 countdowns",[n.length]):W()().format(H.getTimeAndDateFormat())};render(){const e=$.getState(),t=e.filter((e=>this.props.now.valueOf()<e.date));return(0,ss.jsxs)(ss.Fragment,{children:[rg("div",{className:"ClockPopup-Header"},void 0,rg("h2",{id:"popup-label-clockpopup"},void 0,(0,B.Z)("Clock")),rg("div",{className:"info"},void 0,this.getInfoText(t))),rg("div",{className:"popup-scrollarea"},void 0,rg("div",{style:this.getClockStyle(),className:Fi()("ClockPopup-BigClock",{"ClockPopup-BigClock--ShowSeconds":this.props.prefValues[I.kClockShowSeconds]}),dangerouslySetInnerHTML:{__html:Wi.gep}}),rg("div",{className:"ClockPopup-Active"},void 0,t.map(((e,t)=>rg("div",{className:"ClockPopup-Timer ClockPopup-Timer--Active"},e.id,rg("button",{className:"ClockPopup-Timer-Name"},void 0,H.getActiveLabel(e,!0)),rg("button",{className:"ClockPopup-Timer-Clear",tabIndex:this.props.prefValues[I.kKeyboardTabToAll],onClick:()=>{return t=e.id,void A.Z.dispatch({actionType:"TIMER_REMOVE",timerId:t});var t},dangerouslySetInnerHTML:{__html:Wi.kze}}))))),rg("div",{className:"toolbar toolbar-default"},void 0,rg("div",{className:"toolbar-group"},void 0,rg(po.ZP,{title:(0,B.Z)("Countdown"),isPressed:"countdown"===this.props.prefValues[I.kClockMode],onClick:()=>this.setMode("countdown")}),rg(po.ZP,{title:(0,B.Z)("Alarm"),isPressed:"alarm"===this.props.prefValues[I.kClockMode],onClick:()=>this.setMode("alarm")}))),"countdown"===this.props.prefValues[I.kClockMode]&&rg(og,{now:this.props.now,hour:this.state.countdownHour,minute:this.state.countdownMinute,hidePopup:this.props.hidePopup,setHour:this.setCountdownHour,setMinute:this.setCountdownMinute,setMode:this.setPreviewMode,countdowns:e.filter((e=>"countdown"===e.type))}),"alarm"===this.props.prefValues[I.kClockMode]&&rg(eg,{now:this.props.now,alarms:e.filter((e=>"alarm"===e.type)),hidePopup:this.props.hidePopup,hour:this.state.alarmHour,minute:this.state.alarmMinute,setHour:this.setAlarmHour,setMode:this.setPreviewMode,setMinute:this.setAlarmMinute}))]})}}const cg=(0,Bu.Z)(dg,lg);const ug=new class{#C;#A=[];#I=[];#T=-1;addListener(e,t){"minutes"===e?this.#A.push(t):this.#I.push(t),clearTimeout(this.#C),this.#Z()}removeListener(e){this.#A=this.#A.filter((t=>t!==e)),this.#I=this.#I.filter((t=>t!==e)),this.#A.length+this.#I.length===0&&(clearTimeout(this.#C),this.#C=null)}#E(e){for(const t of this.#I)t(e)}#k(e){for(const t of this.#A)t(e)}#Z(){let e=0;const t=new Date,n=t.getMinutes();this.#E(t),this.#T!==n&&(this.#k(t),this.#T=n),e=this.#I.length>0?1e3-t.getMilliseconds():1e3*(60-t.getSeconds())-t.getMilliseconds(),this.#C=setTimeout((()=>this.#Z()),e)}};var pg;function hg(e,t,n,i){pg||(pg="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:pg,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const gg=[I.kClockButtonShowDate,I.kClockButtonShowName,I.kClockButtonStyle,I.kClockAlarmPresets,I.kClockCountdownPresets,I.kClockNotificationSound,I.kClockShowSeconds],mg={"":(0,B.Z)("other","None"),"../../resources/notification_ding.opus":(0,B.Z)("Ding"),"../../resources/notification_rooster.opus":(0,B.Z)("Rooster"),"../../resources/notification_tada.opus":(0,B.Z)("Tada")};class fg extends Li.PureComponent{buttonRef=Li.createRef();constructor(e){super(e),this.now=new Date,this.state={isPopupOpen:!1,hour:this.now.getHours(),minute:this.now.getMinutes(),width:34,leadingTimer:this.getActiveTimers()[0]},this.isVertical="left"===e.popupPosition||"right"===e.popupPosition}componentDidMount(){this.props.inEditor||(this.isVertical&&this.recalculateWidth(),ug.addListener(this.hasTimerSecondsPrecision?"seconds":"minutes",this.onTick),$.addListener(this.#_))}componentDidUpdate(e){this.isVertical&&e.prefValues!==this.props.prefValues&&this.recalculateWidth(),e.prefValues[I.kClockShowSeconds]!==this.props.prefValues[I.kClockShowSeconds]&&this.updateTimerPrecision()}componentWillUnmount(){this.props.inEditor||(ug.removeListener(this.onTick),$.removeListener(this.#_))}#N(){return $.getState().slice().sort(((e,t)=>e.date-t.date))}#_=()=>{this.setState({leadingTimer:this.getActiveTimers()[0]},(()=>this.updateTimerPrecision()))};recalculateWidth=()=>{const e=this.buttonRef.current?.buttonRef?.getBoundingClientRect();e?.height&&this.setState({width:Math.round(Math.min(Math.max(34,e.height),160))})};updateTimerPrecision=()=>{const e=this.hasTimerSecondsPrecision,t=this.props.prefValues[I.kClockShowSeconds]||"countdown"===this.getActiveMode();e!==t&&(this.hasTimerSecondsPrecision=t,ug.removeListener(this.onTick),ug.addListener(this.hasTimerSecondsPrecision?"seconds":"minutes",this.onTick))};onTick=e=>{this.now=e;const t=this.now.getMinutes(),n=this.now.getHours(),i=this.now.getSeconds();let s=!1;this.props.prefValues[I.kClockShowSeconds]&&(this.state.isPopupOpen||"image"!==this.props.prefValues[I.kClockButtonStyle])||"countdown"===this.state.leadingTimer?.type?(this.setState({minute:t+i/60}),s=!0):t===this.state.minute&&n===this.state.hour||(this.setState({hour:n,minute:t}),s=!0),$.getState().forEach((e=>{Math.round(e.date/1e3)===Math.round(this.now.valueOf()/1e3)&&(this.setState({leadingTimer:this.getActiveTimers()[1],...s?{}:{minute:t+i/60}}),this.updateTimerPrecision())}))};getActiveTimers=()=>$.getState().filter((e=>this.now.valueOf()<e.date));getActiveMode=()=>this.state.leadingTimer?.type??"time";hidePopup=(e,t)=>{this.state.isPopupOpen&&this.setState({isPopupOpen:!1},(()=>{e&&t&&j(e,t)}))};togglePopup=()=>{this.setState((e=>({isPopupOpen:!e.isPopupOpen})))};#P(){const{leadingTimer:e}=this.state,t=this.now.getHours(),n=this.now.getMinutes(),i={"--hourDeg":30*(t+n/60)+"deg","--minuteDeg":`${6*n+360*t}deg`,"--clockWidth":`${this.state.width}px`};if(e&&"countdown"===e.type){const t=W()(e.date).diff(this.now,"seconds"),n=W().duration(t,"seconds"),s=n.hours()%12/.12,o=0===n.minutes()&&0===s;i["--countdownHourPercent"]=s,i["--countdownMinutePercent"]=o?n.seconds()/.6:n.minutes()/.6,o&&(i["--countdownSeconds"]="rotate(calc(var(--minuteDeg) + 90deg)) scaleX(-1)")}return this.getActiveTimers().some((e=>"alarm"===e.type))?i["--clockAlarmSet"]=1:i["--clockAlarmSet"]=0,i}getButtonText=()=>{const e="image"!==this.props.prefValues[I.kClockButtonStyle],t=this.props.prefValues[I.kClockButtonShowDate],n=this.props.prefValues[I.kClockButtonShowName],{leadingTimer:i}=this.state;let s="";return"countdown"!==i?.type&&(e&&t?s=W()(this.now).format(H.getTimeAndDateFormat()):e?s=W()(this.now).format(H.getTimeFormat()):t&&(s=W()(this.now).format(H.getDateFormat()))),e&&i?"countdown"===i.type?H.getActiveLabel(i,n):(s?s+" – ":"")+H.getName(i):s};getTooltip=()=>{const e=this.getActiveTimers();let t=W()(this.now).format("LL LT");if(e.length>0){const n=e.filter((e=>"countdown"===e.type)),i=e.filter((e=>"alarm"===e.type));n.length>0&&(t+="\n\n"+(0,B.Z)("Countdowns"),n.forEach((e=>{t+="\n"+H.getActiveLabel(e,!0)}))),i.length>0&&(t+="\n\n"+(0,B.Z)("Alarms"),i.forEach((e=>{t+="\n"+H.getActiveLabel(e,!0)})))}return t};menu=()=>{const e=this.props.prefValues[I.kClockButtonStyle];return[{isVisible:()=>this.props.prefValues[I.kClockCountdownPresets].length>0,items:this.props.prefValues[I.kClockCountdownPresets].map((e=>({handler:()=>H.setCountdownWithPreset(e),...(0,us.Z)(e.name)}))),...(0,us.Z)("New Countdown")},{isVisible:()=>this.props.prefValues[I.kClockAlarmPresets].length>0,items:this.props.prefValues[I.kClockAlarmPresets].map((e=>({handler:()=>H.setAlarmWithPreset(e),...(0,us.Z)(e.name)}))),...(0,us.Z)("New Alarm")},{items:[{type:"checkbox",checked:"imageandtext"===e,handler:()=>w.Z.set(I.kClockButtonStyle,"imageandtext"),...(0,us.Z)("Image and Text")},{type:"checkbox",checked:"image"===e,handler:()=>w.Z.set(I.kClockButtonStyle,"image"),...(0,us.Z)("Image Only")},{type:"checkbox",checked:"text"===e,handler:()=>w.Z.set(I.kClockButtonStyle,"text"),...(0,us.Z)("title","Text Only")}],...(0,us.Z)("Button Style")},{items:[{type:"checkbox",checked:this.props.prefValues[I.kClockButtonShowName],handler:()=>w.Z.set(I.kClockButtonShowName,!0),...(0,us.Z)("Show Name")},{type:"checkbox",checked:!this.props.prefValues[I.kClockButtonShowName],handler:()=>w.Z.set(I.kClockButtonShowName,!1),...(0,us.Z)("Time Only")}],...(0,us.Z)("Button Label")},{items:Object.keys(mg).map((e=>{const t=mg[e];return{type:"checkbox",checked:this.props.prefValues[I.kClockNotificationSound]===e,handler:()=>w.Z.set(I.kClockNotificationSound,e),...(0,us.Z)(t)}})),...(0,us.Z)("Notification Sound")},{type:"checkbox",checked:this.props.prefValues[I.kClockShowSeconds],handler:()=>w.Z.set(I.kClockShowSeconds,!this.props.prefValues[I.kClockShowSeconds]),...(0,us.Z)("Show Seconds")},{type:"checkbox",checked:this.props.prefValues[I.kClockButtonShowDate],handler:()=>w.Z.set(I.kClockButtonShowDate,!this.props.prefValues[I.kClockButtonShowDate]),...(0,us.Z)("Show Date")}]};render(){const e=this.getActiveMode(),t=this.props.prefValues[I.kClockButtonStyle];return(0,ss.jsx)(po.ZP,{className:`ClockButton ClockButton--${e}`,isOn:"time"!==e,onClick:this.togglePopup,customizeMenu:this.props.customizeMenu,menuOrigin:this.props.menuOrigin,ref:this.buttonRef,tooltip:this.getTooltip(),title:this.getButtonText(),image:"text"!==t||this.props.preview?Wi.kY4[this.props.size]:void 0,draggable:this.props.draggable,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,onDrop:this.props.onDrop,onDragEnter:this.props.onDragEnter,mimeType:this.props.mimeType,name:this.props.name,popupWidth:210,hidePopup:this.hidePopup,popupPosition:this.props.popupPosition,popupClassName:"ClockPopup",popupLabelledBy:"popup-label-clockpopup",isPopupVisible:this.state.isPopupOpen,menu:this.menu,style:this.#P(),size:this.props.size,children:hg(cg,{now:this.now,firstTimer:this.state.leadingTimer,hidePopup:this.hidePopup})})}}const vg=(0,Bu.Z)(fg,gg);var yg,bg=n(15908),Sg=n(33466),wg=n(61667),Cg=n(64477),Ag=n(49777);function Ig(e,t,n,i){yg||(yg="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:yg,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Tg={top:0,right:0,bottom:0,left:0},Zg={data:{fill:"var(--colorHighlightBg)",fillOpacity:.2,stroke:"var(--colorHighlightBg)",strokeWidth:2}},Eg={grid:{stroke:"var(--colorFgAlpha)"}};var kg=Ig(bg._,{preserveAspectRatio:"none"}),_g=Ig(Sg.E,{standalone:!1,style:Eg,offsetY:-10}),Ng=Ig(Sg.E,{dependentAxis:!0,standalone:!1,style:Eg,offsetX:-10});function Pg({downloadId:e,speed:t}){const[n,i]=Li.useState(Ag.mb.get(e).reduce(((e,t)=>Math.max(e,t)),.1)),[s,o]=Li.useState(Ag.mb.get(e).map(((e,t)=>({x:t,y:e}))));return Li.useEffect((()=>{t>n&&i(1.1*t),o((e=>{const n=(e.at(-1)?.x??-1)+1;return e.push({x:n,y:t}),e.length>300&&e.splice(0,1),e}))}),[n,t]),s.length<=1?null:Ig(wg.k,{height:50,padding:Tg,domain:{x:[s[0].x,Math.max(s.at(-1)?.x??0,5)],y:[0,n]},domainPadding:{x:[Math.abs(Math.min(300,s.length-300)),0]},scale:"linear",containerComponent:kg},void 0,_g,Ng,Ig(Cg.b,{data:s,interpolation:"natural",standalone:!1,style:Zg}))}var Dg,Mg=n(82313);function Og(e,t,n,i){Dg||(Dg="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Dg,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var xg=Og(co,{type:"download-speed"});class Lg extends Li.PureComponent{static contextType=ts.Z;pathButtonTitle=(0,B.Z)("Show in File Manager");_openUrl=()=>{this.props.url&&c.ZP.openURL(this.context.vivaldiWindowId,(0,rl.q9)(this.props.url))};render(){const{node:e}=this.props,t="complete"===e?.state?e.totalBytes:e?.bytesReceived||0,n=e?(0,Mg.Z)(t):"",i=e?e.currentSpeed:0,s=W()(e?.endTime),o=W()(e?.startTime),a="complete"===e?.state&&s.isValid()&&o.isValid()?e?.bytesReceived/W().duration(s.diff(o)).asSeconds():i,r=e?(0,B.Z)("$1/s",[(0,Mg.Z)(a)]):"",l="in_progress"===e?.state;return Og("div",{className:"container"},void 0,Og("div",{className:"completed"},void 0,n),Og("div",{className:"speed"},void 0,r?(0,ss.jsxs)(ss.Fragment,{children:[xg,r]}):(0,B.Z)("Download Speed")),Og("div",{className:"chart"},void 0,e&&Og(Pg,{downloadId:e.id,speed:i},this.props.finalName)),Og("div",{className:"actionbuttons"},void 0,this.props.canResumeDownload&&this.props.hasPausedTransfersSelected?Og("input",{type:"button",className:"action-button",value:(0,B.Z)("navigation","Resume"),tabIndex:this.props.tabIndex,onClick:this.props.onDownloadResume}):Og("input",{type:"button",className:"action-button",disabled:l,value:(0,B.Z)("navigation","Restart"),tabIndex:this.props.tabIndex,onClick:this._openUrl}),Og("input",{id:"show-in-folder-button",type:"button",className:"action-button",tabIndex:this.props.tabIndex,disabled:l,onClick:this.props.openFile,value:this.pathButtonTitle,title:this.pathButtonTitle})))}}const Rg=Lg;var Bg;function Fg(e,t,n,i){Bg||(Bg="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Bg,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Wg="in_progress",Ug="complete",Vg="interrupted";function Hg({item:e}){const t=e.state===Wg,n=e.paused||e.state===Vg,i=e.bytesReceived/e.totalBytes,s=e.totalBytes&&e.state!==Ug?100*i:100;return Fg("progress",{style:{"--duration":Math.min(e.totalBytes/100,500)+"ms","--progress":i.toFixed(2)},className:Fi()("DownloadItem-ProgressBar",{"unknown-filesize":!e.totalBytes,visible:t,loading:!n}),value:s,max:100})}var Gg;function $g(e,t,n,i){Gg||(Gg="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Gg,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function Kg({node:e}){const{bytesReceived:t=0,fileSize:n=1,startTime:i="",endTime:s=""}=e||{},o=(t/n*100).toFixed(0),a=!isNaN(parseInt(o)),r=W()(i),l=W()(s),d=r.isSame(l,"day");return $g("div",{className:"panel-timefield"},void 0,$g("div",{className:"container"},void 0,$g("div",{className:"started"},void 0,(0,B.Z)("Started:")),$g("div",{className:"started-time"},void 0,r.isValid()?r.format("l, LTS"):""),$g("div",{className:"completed"},void 0,s?(0,B.Z)("Finished:"):a&&(0,B.Z)("Completed:")),$g("div",{className:"progress"},void 0,l.isValid()?l.format(d?"LTS":"l, LTS"):e&&a&&(0,ss.jsxs)(ss.Fragment,{children:[o+"%",$g(Hg,{item:e})]}))))}var zg,jg=n(86662);function Yg(e,t,n,i){zg||(zg="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:zg,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Xg=(0,B.Z)("File Name");class Qg extends Li.Component{render(){const e=this.props.downloadItem,t=e?.filename||"",n=e?.url||"",{filename:i,extension:s}=(0,jg.QQ)(t),o=i+s,a=e&&e?.bytesReceived>0?this.props.getItemPath(e.id):"";return Yg("div",{className:Fi()({data:!0,"downloads-cardwrapper":!0,cardview:!0,disabled:!e})},void 0,Yg("div",{className:"downloads-panel-actions"},void 0,Yg("span",{className:"download-panel title",title:o},void 0,i.length?(0,ss.jsxs)(ss.Fragment,{children:[Yg("span",{className:"DownloadItem-FileName-Name"},void 0,i),Yg("span",{className:"DownloadItem-FileName-Extension"},void 0,s)]}):Xg),Yg("input",{type:"text",className:"cardview url downloads",tabIndex:this.props.keyAccess,placeholder:(0,B.Z)("File URL"),disabled:!e,value:n,title:n,readOnly:!0}),Yg("input",{type:"text",className:"cardview url downloads",tabIndex:this.props.keyAccess,placeholder:(0,B.Z)("Local File"),disabled:!e,value:a,title:a,readOnly:!0})),Yg(Kg,{node:e}),Yg("div",{className:"panel-pathfield"},void 0,e&&Yg(Rg,{node:e,finalName:o,url:n,tabIndex:this.props.keyAccess,openFile:this.props.onShow,canResumeDownload:this.props.canResumeDownload,hasPausedTransfersSelected:this.props.hasPausedTransfersSelected,onDownloadResume:this.props.onDownloadResume})))}}const qg=Qg;var Jg;function em(e,t,n,i){Jg||(Jg="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Jg,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const tm=[I.kKeyboardTabToAll];var nm=em(co,{type:"close",size:16});const im=function({title:e,showCloseButton:t}){const n=(0,Ya.Z)(tm),i=(0,Li.useContext)(ts.Z);return em("h1",{},void 0,em("span",{id:"ui-region-panel-title"},void 0,e),t&&em("button",{className:"close transparent",onClick:()=>jn.Z.closePanel(i.vivaldiWindowId),title:(0,B.Z)("Close Panel"),tabIndex:n[I.kKeyboardTabToAll]},void 0,nm))};var sm,om;function am(e,t,n,i){sm||(sm="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:sm,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function rm({downloadItem:e,canResumeDownload:t,filter:n,hasActiveTransfersSelected:i,hasCompletedTransfers:s,hasCompletedTransfersSelected:o,hasPausedTransfersSelected:a,hasDownload:r,keyAccess:l,onDownloadResume:d,onFilterChange:c,onRemoveAllFinished:u,onRemoveSelected:p,onRestartSelectedDownload:h,onStopSelectedDownload:g,title:m,showCloseButton:f}){const{document:v}=(0,Li.useContext)(ts.Z),y=(0,Li.useRef)(),[b,S]=(0,Li.useState)(n),[,w]=(0,Li.useTransition)();(0,Li.useEffect)((()=>{v.activeElement!==y.current&&S(n)}),[v.activeElement,n]);return am("header",{},void 0,am(im,{title:m,showCloseButton:f}),am("div",{className:"toolbar toolbar-default toolbar-wrap",role:"toolbar","aria-label":(0,B.Z)("toolbar label","Downloads")},void 0,(0,ss.jsx)("input",{ref:y,type:"search",placeholder:(0,B.Z)("verb","Search"),value:b,disabled:!r&&!n,onChange:e=>{const{value:t}=e.target;S(t),w((()=>{c(t)}))}}),am("div",{className:"toolbar"},void 0,am("div",{className:"toolbar-group"},void 0,am(po.ZP,a||t?{tooltip:(0,B.Z)("Resume Download"),onClick:d,image:Wi.sxZ.small}:{tooltip:(0,B.Z)("verb","Pause"),onClick:g,disabled:!i,image:Wi.Q9E.small}),am(po.ZP,{tooltip:(0,B.Z)("command","Restart"),disabled:!e,onClick:h,image:Wi.Ibx.small}),am(po.ZP,{tooltip:(0,B.Z)("verb","Remove"),disabled:!(o||a||e&&"interrupted"===e.state),onClick:p,image:Wi.M2k.small}),am(po.ZP,{tooltip:(0,B.Z)("Remove all finished"),disabled:!s,onClick:u,image:Wi.DwE.small})))))}function lm(e,t,n,i){om||(om="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:om,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function dm(){return lm("div",{className:"download-placeholder"},void 0,lm("div",{className:"download-empty-state"},void 0,lm("span",{dangerouslySetInnerHTML:{__html:Wi.ZsG}}),lm("h1",{},void 0,(0,B.Z)("Your download list is empty")),lm("p",{className:"faded-text"},void 0,(0,B.Z)("As soon as you download something, it will appear here."))))}var cm,um,pm=n(8874);function hm(e,t,n,i){cm||(cm="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:cm,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function gm({onClick:e}){return hm("button",{onClick:e,title:(0,B.Z)("verb","Pause"),className:"ActionButton circular",tabIndex:"-1",dangerouslySetInnerHTML:{__html:Wi.Q9E.small}})}function mm({onClick:e}){return hm("button",{onClick:e,title:(0,B.Z)("Resume Download"),className:"ActionButton circular resume",tabIndex:"-1",dangerouslySetInnerHTML:{__html:Wi.sxZ.small}})}function fm({onClick:e}){return hm("button",{onClick:e,title:(0,B.Z)("Show in File Manager"),className:"ActionButton circular reveal",tabIndex:"-1",dangerouslySetInnerHTML:{__html:Wi._TQ.small}})}function vm({onClick:e}){return hm("button",{onClick:e,title:(0,B.Z)("verb","Remove"),className:"ActionButton circular remove",tabIndex:"-1",dangerouslySetInnerHTML:{__html:Wi.M2k.small}})}function ym(e){return new Promise(((t,n)=>{i.Z.downloads.getFileIcon(e,{size:32},(e=>{t(e)}))}))}function bm(e,t,n,i){um||(um="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:um,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Sm="in_progress",wm="complete";function Cm(e){const t=e.state===Sm;return e.url+p.YV+(0,B.Z)("Added: $1",[W()(e.startTime).format("l, LTS")])+(t&&e.paused?p.YV+(0,B.Z)("Download stopped"):"")+(e.endTime?p.YV+(0,B.Z)("Complete: $1",[W()(e.endTime).format("l, LTS")]):"")}class Am extends Li.PureComponent{static contextType=ts.Z;#m=!1;constructor(e){super(e),W().relativeTimeThreshold("ss",2)}state={icon:void 0};componentDidMount(){this.#m=!0,ym(this.props.item.id).then((e=>{this.#m&&this.setState({icon:e})}))}componentWillUnmount(){this.#m=!1}componentDidUpdate(e,t){this.state.icon||e.item.state===this.props.item.state||ym(this.props.item.id).then((e=>{this.#m&&this.setState({icon:e})}))}handleMouseEnter=e=>{u.Z.setStatus(e,this.props.item.url)};handleMouseLeave=e=>{u.Z.clearStatus(e)};renderDownloadButton=()=>{const{item:e,onPause:t,onResume:n,onShow:i,onErase:s}=this.props;return e.state!==Sm||e.paused?e.canResume?bm(mm,{onClick:n.bind(null,e.id)}):e.state===wm&&e.exists?bm(fm,{onClick:i.bind(null,e.id)}):bm(vm,{onClick:s.bind(null,e.id)}):bm(gm,{onClick:t.bind(null,e.id)})};render(){const{item:e}=this.props,t=e.filename||e.finalUrl,{filename:n,extension:i}=(0,jg.QQ)(t),s=this.context.vivaldiWindowId,{icon:o}=this.state;return bm("div",{className:Fi()("DownloadItem",{"DownloadItem--Unavailable":!1===e.exists}),onMouseEnter:()=>this.handleMouseEnter(s),onMouseLeave:()=>this.handleMouseLeave(s),title:Cm(e)},void 0,o&&bm("img",{src:o,className:"DownloadItem-Icon"}),bm("div",{className:"DownloadItem-FileName"},void 0,bm("span",{className:"DownloadItem-FileName-Name"},void 0,n),bm("span",{className:"DownloadItem-FileName-Extension"},void 0,i)),bm(Hg,{item:e}),bm(pm.Z,{item:e}),this.renderDownloadButton())}}const Im=Am;var Tm,Zm=n(69697),Em=n(34155);function km(e,t,n,i){Tm||(Tm="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Tm,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const _m="vivaldi/x-sortfield",Nm=ds.Z.ASCENDING_SORT,Pm="100dvh";class Dm extends Li.PureComponent{static contextType=ts.Z;nodeRef=Li.createRef();constructor(e){super(e),this.state={columns:e.columns||[],maxWidth:0,maxHeight:e.fullsize&&e.columns?this.getColumnHeight():Pm,dataKey:"",dragOverField:void 0}}componentDidUpdate(){this.props.fullsize&&this.props.columns&&this.setState({maxHeight:this.getColumnHeight()})}getWidth=e=>{const t=this.nodeRef.current?.getBoundingClientRect();t?.width&&this.setState({maxWidth:t.width,dataKey:e})};saveColumnsToSettings=()=>{this.dragged="",this.props.onSaveRow&&this.props.onSaveRow()};resizeRow=(e,t,n)=>{const{dataKey:i}=this.state;this.setState((t=>{const s=t.columns?[...t.columns]:[],o=s.flatMap((e=>e.id)).indexOf(i),a=n.target.parentElement,r=Math.round(e-a.getClientRects()[0].left),l=o+1,d=a.nextSibling,c=Math.round(a.clientWidth+d.clientWidth)-r;return r<0||c<0||(s[l].key||0===o&&!s[o].key?s[o]={...s[o],width:r}:s[l]={...s[l],width:c},this.props.onUpdateRow&&this.props.onUpdateRow(s)),{columns:s}}))};updateField=e=>{const t=e.target.value;let n;n="manually"===t?ds.Z.NO_SORTING:this.props.sortOrder===ds.Z.NO_SORTING?Nm:this.props.sortOrder,this.props.onSortChange(n,t)};updateSort=(e,t)=>{let n;if(t.preventDefault(),e===this.props.sortField)switch(this.props.sortOrder){case ds.Z.ASCENDING_SORT:n=ds.Z.DESCENDING_SORT;break;case ds.Z.DESCENDING_SORT:n=!1!==this.props.manualSorting?ds.Z.NO_SORTING:ds.Z.ASCENDING_SORT;break;case ds.Z.NO_SORTING:n=Nm}else n=this.props.sortOrder;n&&this.props.onSortChange(n,e)};updateOrder=()=>{const e=this.props.sortOrder===ds.Z.DESCENDING_SORT?ds.Z.ASCENDING_SORT:ds.Z.DESCENDING_SORT;this.props.onSortChange(e,this.props.sortField)};onDragStart=(e,t)=>{this.dragged=e,t.dataTransfer.setData(_m,!0),t.stopPropagation()};onDragOver=(e,t)=>{const{HTMLElement:n}=this.context;if(t.dataTransfer&&!t.dataTransfer.types.includes(_m))return;if(t.preventDefault(),t.stopPropagation(),e===this.dragged||!(t.currentTarget instanceof n))return;const i=t.currentTarget.getBoundingClientRect(),s=(t.clientX-i.left)/i.width<=.5?"left":"right";this.setState({dragOverField:{id:e,position:s}})};onDrop=e=>{if(this.state.columns&&void 0!==this.state.dragOverField&&this.state.columns.length>1&&e.dataTransfer.getData(_m)){const{columns:t,dragOverField:n}=this.state,i=t.findIndex((e=>e.id===this.dragged)),s=Math.max(0,t.findIndex((e=>e.id===n?.id))+("right"===n?.position?1:0)),o=i-s;if(0===o||!this.state.columns)return;e.preventDefault(),e.stopPropagation(),this.setState((e=>{if(e.columns){const t=[...e.columns];return t.splice(Math.max(0,s-(o<0?1:0)),0,t.splice(i,1)[0]),this.props.onUpdateRow&&this.props.onUpdateRow(t),{columns:t,dragOverField:void 0}}})),Em.nextTick((()=>this.saveColumnsToSettings()))}};resetDragOverField=()=>{this.setState({dragOverField:void 0})};resetColumns=()=>{const e=ys(this.props.fields);e&&(this.setState({columns:e}),this.props.onUpdateRow&&this.props.onUpdateRow(e),Em.nextTick((()=>this.saveColumnsToSettings())))};onContextMenu=e=>{if(!this.state.columns)return;const t=this.state.columns.flatMap((e=>e.id)),n=this.props.fields.filter((e=>!e.key)).map((e=>({handler:this.toggleColumn.bind(this,e.value),type:"checkbox",checked:t.includes(e.value),...Qe.Z.makeLabelPair(e.text)})),[]);this.props.columns&&(n.push(Qe.Z.separatorItem),n.push({handler:this.resetColumns,...(0,us.Z)("Reset Columns")})),(0,cs.Z)(this.context,n)(e)};toggleColumn=e=>{if(!this.state.columns)return;const t=this.state.columns.flatMap((e=>e.id));t.includes(e)?this.setState((n=>{const i=n.columns||[];if(i){const n=t.indexOf(e),s=[...i.slice(0,n),...i.slice(n+1)];return this.props.onUpdateRow&&this.props.onUpdateRow(s),{columns:s}}})):this.setState((t=>{const n=t.columns||[],i=this.props.fields.find((t=>t.value===e));if(i&&n.length>0){const t=this.props.fields.indexOf(i),s=[...n.slice(0,t),{id:e,width:i.width||20},...n.slice(t)];return this.props.onUpdateRow&&this.props.onUpdateRow(s),{columns:s}}})),Em.nextTick((()=>this.saveColumnsToSettings()))};_getSortLabel=e=>{const t=e.text,n=e.value,i=e.isSortField??!0,s=this.props.sortField===n,o=e.fullScreenTitle,{dragOverField:a}=this.state,r=a&&a.id===e.value,l=a&&a.position||"",d=Fi()({"sortselector-button":!0,"sortselector-button-active":s&&this.props.sortOrder!==ds.Z.NO_SORTING,"direction-ascending":s&&this.props.sortOrder===ds.Z.ASCENDING_SORT,"direction-descending":s&&this.props.sortOrder===ds.Z.DESCENDING_SORT,"over-left":r&&"left"===l,"over-right":r&&"right"===l,"drag-over":r}),{columns:c}=this.state,u=c.findIndex((e=>e.id===n)),p=c[u];return km("div",{onContextMenu:this.onContextMenu},"key_"+n+t+o,km("button",{draggable:1!==this.props.fields.length,onDragStart:this.onDragStart.bind(this,n),onDragOver:this.onDragOver.bind(this,n),onDragLeave:this.resetDragOverField,onDrop:this.onDrop,className:d,onClick:this.updateSort.bind(this,n),title:o||(0,B.Z)("Toggle Sort Order"),disabled:!i,tabIndex:this.props.keyAccess},void 0,p&&p.width<80?km("span",{className:"column-icon",dangerouslySetInnerHTML:{__html:e.icon?e.icon:Wi.NNg.small}}):km("span",{className:"column-label"},void 0,t),km("span",{className:"column-sort-order",dangerouslySetInnerHTML:{__html:Wi.u0H}})),c&&u>-1&&u<c.length-1&&km(Zm.Z,{onSlidebarPosition:this.resizeRow,onStart:()=>this.getWidth(n),onStop:this.saveColumnsToSettings,style:this.props.style,position:"right"}))};getColumnHeight(){const e=this.nodeRef.current?.nextElementSibling?.clientHeight,t=this.nodeRef.current?.clientHeight;return e&&t?`${e+t}px`:Pm}getFullOptions(){const{columns:e=[]}=this.state,{fields:t}=this.props;return e.length>0?e.map((e=>t.find((t=>t.value===e.id)))).filter(Boolean).map(this._getSortLabel):t.map(this._getSortLabel)}getCompactOptions(){const e=this.props.fields.filter((({isSortField:e})=>e??!0)).map((e=>km("option",{value:e.value},e.value,e.fullScreenTitle)));return!1!==this.props.manualSorting&&e.unshift(km("option",{value:"manually"},"manually",(0,B.Z)("Sort Manually"))),e}render(){const{columns:e,fullsize:t}=this.props,n=this.props.sortOrder===ds.Z.NO_SORTING,i=t&&e?bs(e):void 0,s=t&&e?{"--columnHeight":this.state.maxHeight}:void 0,o=1===this.props.fields.length&&!this.props.compact,a=!(t||o);return(0,ss.jsx)("div",{ref:this.nodeRef,className:Fi()("sortselector",{"sortselector-tableheader":!a,"tableheader-add-scrollbar-spacing":t&&!!this.props.alignHeaderWithScrollbar,"sortselector-compact":a,single:o}),style:{gridTemplateColumns:i,...s},children:a?(0,ss.jsxs)(ss.Fragment,{children:[km("div",{className:"sortselector-area"},void 0,km("select",{className:"sortselector-dropdown",title:(0,B.Z)("Sort by..."),value:this.props.sortField,tabIndex:this.props.keyAccess,onChange:this.updateField},void 0,this.getCompactOptions())),km("button",{className:Fi()({"sortselector-button":!0,"direction-ascending":this.props.sortOrder===ds.Z.ASCENDING_SORT,"direction-descending":this.props.sortOrder===ds.Z.DESCENDING_SORT}),onClick:this.updateOrder,title:this.props.sortOrder===ds.Z.ASCENDING_SORT?(0,B.Z)("Sort Descending"):(0,B.Z)("Sort Ascending"),tabIndex:n?-1:this.props.keyAccess,disabled:n,dangerouslySetInnerHTML:{__html:Wi.u0H}})]}):this.getFullOptions()})}}const Mm=Dm;var Om;function xm(e,t,n,i){Om||(Om="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Om,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Lm=[{text:(0,B.Z)("title","Name"),value:"filename",fullScreenTitle:(0,B.Z)("Sort by Name")},{text:(0,B.Z)("Type"),value:"extension",fullScreenTitle:(0,B.Z)("Sort by Type")},{text:(0,B.Z)("Size"),value:"bytesReceived",fullScreenTitle:(0,B.Z)("Sort by Size")},{text:(0,B.Z)("Date"),value:"startTime",fullScreenTitle:(0,B.Z)("Sort by Date")},{text:(0,B.Z)("Address"),value:"url",fullScreenTitle:(0,B.Z)("Sort by Address")}];class Rm extends Li.PureComponent{refTreeList=Li.createRef();static contextType=ts.Z;winId=this.context.vivaldiWindowId;getExtension=e=>{const t=e?e.lastIndexOf("."):-1;return-1!==t?e.substring(t+1):""};sortForExtension=(e,t)=>{const{sortOrder:n}=this.props;if(n<=ds.Z.NO_SORTING)return 0;const i=e,s=t;let o=this.getExtension(i.filename),a=this.getExtension(s.filename);if(!o&&!a)return 0;if(!o)return n===ds.Z.ASCENDING_SORT?1:-1;if(!a)return n===ds.Z.ASCENDING_SORT?-1:1;if("number"==typeof o&&"number"==typeof a)return n===ds.Z.ASCENDING_SORT?o-a:a-o;if(o=o.toString().toLowerCase(),a=a.toString().toLowerCase(),o>a)return n===ds.Z.ASCENDING_SORT?1:-1;if(o<a)return n===ds.Z.ASCENDING_SORT?-1:1;return ds.Z.getDefaultComparator(n,"filename")(e,t)};returnFalse=()=>!1;selectByIds=e=>{e.forEach((e=>{this.refTreeList.current?.selectById(e,{ctrlKey:!0,metaKey:!0})}))};selectByNode=e=>{this.refTreeList.current?.selectByNode(e)};selectByIndex=e=>{this.refTreeList.current?.selectByIndex(e)};scrollToId=e=>{this.refTreeList.current?.scrollToId(e)};isSelected=e=>this.refTreeList.current?.isItemSelected(e);getSelectedNodes=()=>this.refTreeList.current?.selectionModel.selectedIds||[];getSelectedNode=()=>this.refTreeList.current?.getSelectedItem();onNodeMouseDown=()=>{this.refTreeList.current?.focusTree()};onNodeSelected=e=>{e?this.props.onSelected(parseInt(e.id)<0?void 0:e):this.props.onSelected(void 0)};onNodeDoubleClick=(e,t)=>{this.props.onOpen(t.id)};onNodesActivated=(e,t)=>{t.forEach((e=>{this.props.onOpen(e.id)}))};onNodeDragStart=e=>{this.refTreeList.current?.setSelectedIds(e),this.props.onDrag(e)};validateForDrag=e=>{const t=this.props.nodes.filter((e=>e.exists&&"complete"===e.state));return e.filter((e=>t.some((t=>t.id===e))))};setCustomEventBehavior=(e,t)=>{e.preventDefault(),e.stopPropagation()};handleErase=e=>(this.props.nodes.filter((t=>e.includes(t.id))).forEach((({id:e})=>this.props.onErase(e))),Promise.resolve());rowComponent=e=>{const t=e.node;return xm(Im,{item:t,onErase:this.props.onErase,onShow:this.props.onShow,onPause:this.props.onPause,onResume:this.props.onResume},t.id)};render(){const e=he.ZP.isIncognito(this.winId),t={sortOrder:this.props.sortOrder,sortField:this.props.sortField,comparator:this.sortForExtension,onlyScroll:"extension"!==this.props.sortField};return(0,ss.jsxs)(ss.Fragment,{children:[Ag.ZP.hasDownloads({isIncognitoWindow:e})&&xm(Mm,{fields:Lm,manualSorting:!1,onSortChange:this.props.onSortChange,keyAccess:this.props.keyAccess,sortField:this.props.sortField,sortOrder:this.props.sortOrder}),xm("section",{className:"outerScrollbar"},void 0,(0,ss.jsx)(Ps,{ref:this.refTreeList,settings:"DOWNLOADS_TREE",rowComponent:this.rowComponent,nodes:this.props.nodes,menu:this.props.menu,isFolder:this.returnFalse,hasChildren:this.returnFalse,delete:this.handleErase,onSelect:this.onNodeSelected,enableDragAndDrop:!0,onItemMouseDown:this.onNodeMouseDown,onItemDoubleClick:this.onNodeDoubleClick,onItemsActivated:this.onNodesActivated,rowHeight:52,sorting:t,onItemDragStart:this.onNodeDragStart,validateForDrag:this.validateForDrag,disableMousePointersOverride:!0,setCustomEventBehavior:this.setCustomEventBehavior}))]})}}const Bm=Rm;var Fm,Wm=n(34155);function Um(e,t,n,i){Fm||(Fm="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Fm,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function Vm(e,t){const n="startTime";if("extension"===e)return n;if(t===ds.Z.ASCENDING_SORT)return e;switch(e){case"bytesReceived":return"-bytesReceived";case"endTime":return"-endTime";case"filename":return"-filename";case"startTime":return"-startTime";case"url":return"-url"}return n}const Hm=[I.kDownloadsPanelEditorHeight];function Gm(e){return"complete"===e.state&&e.mime.startsWith("image/")}var $m=Um(dm,{});class Km extends Li.PureComponent{static contextType=ts.Z;winId=this.context.vivaldiWindowId;nodeRef=Li.createRef();refTree=Li.createRef();defaultHeight=C.Z.getDefault(I.kDownloadsPanelEditorHeight);state={downloadItems:[],hasActiveDownloadItemsSelected:!1,hasPausedDownloadItemsSelected:!1,hasCompletedDownloadItemsSelected:!1,hasCompletedDownloadItems:!1,selectedDownloadItem:void 0,filter:Ag.ZP.getFilter(),editorHeight:C.Z.get(I.kDownloadsPanelEditorHeight),...C.Z.get(I.kDownloadsPanelSorting)};componentDidMount(){const{selectWindow:e}=this.context;Yn.ZP.addListener(this.onPanelStoreChange),Ag.ZP.addListener(this.onDownloadStoreChange),Ee.Z.setOrderBy(Vm(this.state.sortField,this.state.sortOrder)),Ee.Z.setSearchFilter(this.state.filter),he.ZP.addListener(this._onWindowStoreChange,e),this.fetchDownloadItemsAndUpdateState()}componentDidUpdate(e,t){return t.filter!==this.state.filter?this.fetchDownloadItemsAndUpdateState():"extension"===this.state.sortField||t.sortField===this.state.sortField&&t.sortOrder===this.state.sortOrder?(t.selectedDownloadItem!==this.state.selectedDownloadItem&&this.updateActiveProgressState(),void(!e.open&&this.props.open&&Wm.nextTick((()=>{this.focusTree(),0===this.refTree.current?.getSelectedNodes().length&&this.refTree.current?.selectByIndex(0)})))):this.fetchDownloadItemsAndUpdateState()}componentWillUnmount(){Ag.ZP.removeListener(this.onDownloadStoreChange),Yn.ZP.removeListener(this.onPanelStoreChange),he.ZP.removeListener(this._onWindowStoreChange)}fetchDownloadItemsAndUpdateState=()=>new Promise((e=>{const t=he.ZP.isIncognito(this.winId),n=Ag.ZP.getItems({isIncognitoWindow:t});let i;this.state.selectedDownloadItem&&(i=n.find((e=>{if(this.state.selectedDownloadItem)return e.id===this.state.selectedDownloadItem.id})),this.updateActiveProgressState());const s=n;this.setState({filter:Ag.ZP.getFilter(),selectedDownloadItem:i,downloadItems:s,hasCompletedDownloadItems:n.some((e=>"complete"===e.state)),...C.Z.get(I.kDownloadsPanelSorting)},e)}));scrollDownloadItemIntoView=e=>{this.refTree.current?.scrollToId(e.id)};selectDownloadItem=e=>{this.refTree.current?.selectByNode(e)};onDownloadStoreChange=e=>{switch(e.reason){case"download_stopped":case"download_completed":{const{downloadItem:t}=e;return void this.onTransferFinished(t)}case"download_started":{const{downloadItem:t}=e;return void this.fetchDownloadItemsAndUpdateState().then((()=>{this.scrollDownloadItemIntoView(t),this.selectDownloadItem(t)}))}case"download_panel_updated":return void this.fetchDownloadItemsAndUpdateState()}};onPanelStoreChange=()=>{const e=Yn.ZP.getChangeReason();this.props.open&&"setFocus"===e&&!(0,Ra.sT)(this.context.document,this.nodeRef.current)&&this.focusTree()};_onWindowStoreChange=()=>{this.props.open&&he.ZP.isActive(this.winId)&&Ee.Z.forceUpdate()};onTransferFinished=e=>{this.updateActiveProgressState()};getMenuState=()=>{const e=this.updateActiveProgressState();return{numAddresses:this.getNumSelectedAddresses(),numFiles:this.getNumSelectedFiles(),numImages:this.getNumSelectedImages(),hasPaused:e.hasPausedDownloadItemsSelected,hasCompleted:e.hasCompletedDownloadItemsSelected,hasActive:e.hasActiveDownloadItemsSelected}};getMenuCapability=async(e,t,n,i)=>{const s=this.winId;switch(e.action){case"CONTEXT_OPEN_FILE":return{handler:this.openSelected,isVisible:()=>Boolean(n)&&i.hasCompleted&&i.numFiles>0,...t(s,e,i)};case"CONTEXT_OPEN_IN":return{isVisible:()=>Boolean(n)&&i.numImages>0&&i.numFiles>0,...t(s,e,i)};case"CONTEXT_OPEN_IN_NEW_TAB":return{handler:()=>{this.openSelectedInTab(!1,C.Z.get(I.kTabsOpenNewInBackground))},isVisible:()=>Boolean(n)&&i.numImages>0&&i.numFiles>0,...t(s,e,i)};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{handler:()=>{this.openSelectedInTab(!1,!0)},isVisible:()=>Boolean(n)&&!C.Z.get(I.kTabsOpenNewInBackground)&&i.numImages>0&&i.numFiles>0,...t(s,e,i)};case"CONTEXT_OPEN_IN_TAB":return{handler:()=>{this.openSelectedInTab(!0,!1)},isVisible:()=>Boolean(n)&&i.numImages>0&&i.numFiles>0,...t(s,e,i)};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{handler:()=>{this.openSelectedInWindow(!1)},isVisible:()=>Boolean(n)&&i.numImages>0&&i.numFiles>0,...t(s,e,i)};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{handler:()=>{this.openSelectedInWindow(!0)},isVisible:()=>Boolean(n)&&i.numImages>0&&i.numFiles>0,...t(s,e,i)};case"CONTEXT_FILEMANAGER":return{handler:()=>{this.showSelectedInFilemanager()},isVisible:()=>Boolean(n)&&i.numFiles>0,...t(s,e,i)};case"CONTEXT_COPY_ADDRESS":return{handler:()=>{this.copySelectedAddress()},isVisible:()=>Boolean(n),...t(s,e,i)};case"CONTEXT_COPY_PATH":return{handler:()=>{this.copySelectedPath()},isVisible:()=>Boolean(n)&&i.hasCompleted&&i.numFiles>0,...t(s,e,i)};case"CONTEXT_RESTART":return{handler:()=>{this.restartSelected()},isVisible:()=>Boolean(n)&&(i.hasCompleted||this.fileErrors()),...t(s,e,i)};case"CONTEXT_STOP":return{handler:()=>{this.stopSelected()},isVisible:()=>Boolean(n)&&i.hasActive,...t(s,e,i)};case"CONTEXT_RESUME":return{handler:()=>{this.resumeSelected()},isVisible:()=>Boolean(n)&&i.hasPaused,...t(s,e,i)};case"CONTEXT_REMOVE":return{handler:()=>{this.removeSelected()},isVisible:()=>Boolean(n),...t(s,e,i)};case"CONTEXT_REMOVE_ALL_FINISHED":return{handler:()=>{this.removeAllFinished()},isVisible:()=>Boolean(n)&&i.hasCompleted,...t(s,e,i)};default:return{...t(s,e,i)}}};getSelectedDownloadItems=()=>{const e=this.refTree.current?.getSelectedNodes().map((e=>e.id))||[];return this.state.downloadItems.filter((t=>-1!==e.findIndex((e=>e===t.id))))};getNumSelectedImages=()=>this.getSelectedDownloadItems().filter(Gm).length;getNumSelectedAddresses=()=>this.getSelectedDownloadItems().filter((e=>Boolean(e.url))).length;getNumSelectedFiles=()=>{let e=0;const t=this.getSelectedDownloadItems();for(let n=0;n<t.length;n++){const i=t[n];i.exists&&!i.error&&e++}return e};fileErrors=()=>{const e=this.getSelectedDownloadItems().map((e=>e.error));if(e.length)return!e.includes(void 0)};getActiveProgressStateForSelectedDownloadItems=()=>{const e=this.getSelectedDownloadItems(),t=this.state.downloadItems;let n=!1,i=!1,s=!1,o=!1;for(let t=0;t<e.length;t++){const a=e[t];if("in_progress"===a.state?a.paused?i=!0:n=!0:"complete"===a.state&&(s=o=!0),n&&i&&s)break}return o=o||!!t.find((e=>"complete"===e.state)),{hasActiveDownloadItemsSelected:n,hasPausedDownloadItemsSelected:i,hasCompletedDownloadItemsSelected:s,hasCompletedDownloadItems:o}};updateActiveProgressState=()=>{const e=this.getActiveProgressStateForSelectedDownloadItems();return this.setState(e),e};canResumeSelected=()=>{const e=this.getSelectedDownloadItems();if(1===e.length){return e[0].canResume}return!1};stopSelected=()=>{this.getSelectedDownloadItems().filter((e=>!e.paused)).forEach((({id:e})=>Ee.Z.pauseDownload(e)))};resumeSelected=()=>{this.getSelectedDownloadItems().filter((e=>e.canResume)).forEach((({id:e})=>Ee.Z.resumeDownload(e)))};restartSelected=()=>{this.getSelectedDownloadItems().forEach((({id:e})=>Ee.Z.restartDownload(e)))};showSelectedInFilemanager=()=>{this.getSelectedDownloadItems().forEach((({id:e})=>Ee.Z.showDownload(e)))};onSortChange=(e,t)=>{w.Z.set(I.kDownloadsPanelSorting,{sortOrder:e,sortField:t});const n=Vm(t,e);Ee.Z.setOrderBy(n),"extension"===t&&this.setState({sortField:t,sortOrder:e})};openSelected=()=>{this.getSelectedDownloadItems().forEach((e=>{"complete"===e.state&&Ee.Z.openDownload(e.id)}))};openSelectedInTab=(e,t)=>{const n=this.getSelectedDownloadItems().filter((e=>"complete"===e.state&&e.mime.startsWith("image/"))).map((e=>"file://"+e.filename));if(n.length>0){const i=n[n.length-1];n.forEach((n=>{const s={inCurrent:e,inBackground:t};!1===t&&(s.inBackground=n!==i),c.ZP.openURL(this.context.vivaldiWindowId,n,s),e=!1}))}};openSelectedInWindow=e=>{const t=this.getSelectedDownloadItems().filter((e=>"complete"===e.state&&e.mime.startsWith("image/"))).map((e=>"file://"+e.filename)),n={inNewWindow:!0,incognito:e};t.forEach((e=>{c.ZP.openURL(this.context.vivaldiWindowId,e,n)}))};onSelected=e=>{this.setState({selectedDownloadItem:e},(()=>{Ee.Z.forceUpdate(),this.updateActiveProgressState()}))};removeAllFinished=()=>{this.state.downloadItems.filter((e=>"complete"===e.state)).forEach((({id:e})=>Ee.Z.eraseDownload(e)))};removeSelected=()=>{this.getSelectedDownloadItems().forEach((({id:e})=>Ee.Z.eraseDownload(e)))};copySelectedAddress=()=>{const e=this.getSelectedDownloadItems().map((e=>e.finalUrl));0!==e.length&&this.context.navigator.clipboard.writeText(e.join("\n"))};copySelectedPath=()=>{const e=this.getSelectedDownloadItems().filter((e=>"complete"===e.state)).map((e=>e.filename));0!==e.length&&this.context.navigator.clipboard.writeText(e.join("\n"))};getItemPath=gs()((e=>this.getSelectedDownloadItems().find((t=>t.id===e))?.filename??""));handleFilterChange=e=>new Promise((t=>this.setState({filter:e},(()=>{Ee.Z.setSearchFilter(e).then(t)}))));onSlidebarPosition=(e,t)=>{this.setState((e=>({editorHeight:Math.max(Math.min(e.editorHeight-t,250),p.mT)})))};onSlideBarStop=()=>{this.setState((e=>{const t=e.editorHeight<p.Cn?p.mT:e.editorHeight;return w.Z.set(I.kDownloadsPanelEditorHeight,parseInt(t)),{editorHeight:t}}))};onSlidebarToggle=()=>{this.setState((e=>{let t=e.editorHeight;return t>p.Cn?(t=p.mT,w.Z.set(I.kDownloadsPanelEditorHeight,t)):(t=250,w.Z.reset(I.kDownloadsPanelEditorHeight)),{editorHeight:parseInt(t)}}))};focusTree=()=>{this.refTree.current?.refTreeList.current?.focusTree()};showSelectedDownloadItem=()=>{this.state.selectedDownloadItem&&Ee.Z.showDownload(this.state.selectedDownloadItem.id)};menu={name:"downloadlist",getState:this.getMenuState,getCapability:this.getMenuCapability,getVisibility:()=>!1};render(){if(!this.props.open)return null;const e=this.canResumeSelected(),t=he.ZP.isIncognito(this.winId),n=!Ag.ZP.hasDownloads({isIncognitoWindow:t})&&!this.state.filter;return(0,ss.jsxs)("div",{ref:this.nodeRef,className:Fi()("panel","downloads",{isEmpty:n}),children:[Um(rm,{title:this.props.title,filter:this.state.filter,onFilterChange:this.handleFilterChange,keyAccess:this.props.keyAccess,canResumeDownload:e,onDownloadResume:this.resumeSelected,hasPausedTransfersSelected:this.state.hasPausedDownloadItemsSelected,hasActiveTransfersSelected:this.state.hasActiveDownloadItemsSelected,hasCompletedTransfersSelected:this.state.hasCompletedDownloadItemsSelected,hasCompletedTransfers:this.state.hasCompletedDownloadItems,hasDownload:0!==this.state.downloadItems.length,onStopSelectedDownload:this.stopSelected,onRestartSelectedDownload:this.restartSelected,downloadItem:this.state.selectedDownloadItem?this.state.selectedDownloadItem:void 0,onRemoveSelected:this.removeSelected,onRemoveAllFinished:this.removeAllFinished,showCloseButton:this.props.showCloseButton}),(0,ss.jsx)(Bm,{ref:this.refTree,keyAccess:this.props.keyAccess,menu:this.menu,nodes:this.state.downloadItems,onSelected:this.onSelected,onSortChange:this.onSortChange,sortField:this.state.sortField,sortOrder:this.state.sortOrder,onErase:Ee.Z.eraseDownload,onResume:Ee.Z.resumeDownload,onPause:Ee.Z.pauseDownload,onShow:Ee.Z.showDownload,onOpen:Ee.Z.openDownload,onDrag:Ee.Z.dragDownloads}),n?$m:Um("section",{className:Fi()("download-editor",{collapsed:this.state.editorHeight===p.mT}),style:{flexBasis:this.state.editorHeight}},void 0,Um(Zm.Z,{onSlidebarPosition:this.onSlidebarPosition,onStop:this.onSlideBarStop,onDoubleClick:this.onSlidebarToggle,position:"bottom",returnOffset:!0}),this.state.editorHeight>p.mT&&Um(qg,{downloadItem:this.state.selectedDownloadItem,keyAccess:this.props.keyAccess,onShow:this.showSelectedDownloadItem,canResumeDownload:e,hasPausedTransfersSelected:this.state.hasPausedDownloadItemsSelected,onDownloadResume:this.resumeSelected,getItemPath:this.getItemPath}))]})}}const zm=(0,Bu.Z)(Km,Hm);var jm;function Ym(e,t,n,i){jm||(jm="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:jm,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class Xm extends Li.PureComponent{static contextType=ts.Z;state={downloadProgress:0,isPopupVisible:!1};componentDidMount(){this.props.inEditor||(Ag.ZP.addListener(this._onDownloadStoreChange),Oa.Z.addListener("COMMAND_SHOW_DOWNLOADS_POPOUT",this.onCommandSpy))}componentWillUnmount(){this.props.inEditor||(Ag.ZP.removeListener(this._onDownloadStoreChange),Oa.Z.removeListener("COMMAND_SHOW_DOWNLOADS_POPOUT",this.onCommandSpy))}_onDownloadStoreChange=()=>{this.setState({downloadProgress:Ag.ZP.getTotalProgress()})};onCommandSpy=(e,t)=>{e===this.context.vivaldiWindowId&&(this.state.isPopupVisible||this.setState({isPopupVisible:!0}))};hidePopup=()=>{this.setState({isPopupVisible:!1})};togglePopup=()=>{this.setState((e=>({isPopupVisible:!e.isPopupVisible})))};render(){return Ym(po.ZP,{id:"downloads",popupClassName:"download-popout",popupLabel:(0,B.Z)("dialog title","Downloads"),tooltip:(0,B.Z)("Downloads"),alwaysMenu:!0,onClick:this.togglePopup,customizeMenu:this.props.customizeMenu,menuOrigin:this.props.menuOrigin,popupPosition:this.props.popupPosition,hidePopup:this.hidePopup,isPopupVisible:this.state.isPopupVisible,popupWidth:360,image:Wi.izi[this.props.size],progress:this.state.downloadProgress,isPopupResizable:!0,draggable:this.props.draggable,onDragStart:this.props.onDragStart??Lr.Z,onDragEnd:this.props.onDragEnd??Lr.Z,onDrop:this.props.onDrop??Lr.Z,onDragEnter:this.props.onDragEnter??Lr.Z,onDragLeave:this.props.onDragLeave??Lr.Z,onDragOver:this.props.onDragOver??Lr.Z,mimeType:this.props.mimeType,name:this.props.name,size:this.props.size,style:{"--downloadInProgress":this.state.downloadProgress?1:0},commandId:"COMMAND_SHOW_DOWNLOADS_POPOUT"},void 0,Ym(zm,{keyAccess:-1,title:(0,B.Z)("Downloads"),panelId:"PanelDownloads",open:!0,onOpenDialog:Lr.Z,showCloseButton:!0}))}}const Qm=(0,dp.ZP)(Xm);var qm,Jm=n(20743);function ef(e,t,n,i){qm||(qm="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:qm,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var tf=ef("img",{className:"GamePreviewPopup-PreviewImage",src:"resources/game_screenshot.png"});function nf(e){return ef("div",{className:"GamePreviewPopup"},void 0,ef("h2",{className:"GamePreviewPopup-HeaderText",id:"popup-label-vivaldiagame"},void 0,(0,B.Z)("Vivaldia Game")),ef("button",{className:"GamePreviewPopup-SettingsButton",title:(0,B.Z)("Settings"),dangerouslySetInnerHTML:{__html:Wi.bqs.large},onClick:()=>{return t=e.winId,void c.ZP.openURL(t,"vivaldi://settings/startpage/",{inBackground:!1});var t}}),tf,ef("button",{onClick:()=>{return t=e.winId,void c.ZP.openURL(t,"vivaldi://game/",{inCurrent:!1,inBackground:!1});var t},className:"GamePreviewPopup-StartButton FormButton primary",title:(0,B.Z)("Click to Play")},void 0,(0,B.Z)("Click to Play")))}class sf extends Li.PureComponent{static contextType=ts.Z;state={isPopupOpen:!1,isIconHovered:!1};hidePopup=()=>{this.setState({isPopupOpen:!1})};togglePopup=()=>{this.setState((e=>({isPopupOpen:!e.isPopupOpen})))};menu=()=>[{type:"checkbox",handler:()=>{w.Z.toggle(I.kStartpageSpeedDialGameButtonShow,!0,!1)},checked:C.Z.get(I.kStartpageSpeedDialGameButtonShow),...(0,us.Z)("Show Game on Speed Dial")}];render(){const{isStartPage:e}=this.props,t=this.state.isPopupOpen||this.state.isIconHovered&&e?"resources/game_icon_alternate.png":"resources/game_icon.png";return ef(po.ZP,{className:"GameButton",tooltip:(0,B.Z)("Vivaldia the game"),name:this.props.name||"Game",image:Wi.rNG[this.props.size||"large"],imagePath:e?t:void 0,mimeType:this.props.mimeType||"vivaldi/x-button-toolbar",hidePopup:this.hidePopup,popupPosition:this.props.popupPosition||"above",popupWidth:180,isPopupVisible:this.state.isPopupOpen,popupClassName:"extensionIconPopupMenu ToolbarButtonPopup-DefaultStyles",popupLabelledBy:"popup-label-vivaldiagame",menu:this.menu,customizeMenu:this.props.customizeMenu||void 0,menuOrigin:this.props.menuOrigin||void 0,draggable:this.props.draggable||!1,onClick:this.togglePopup,onDragStart:this.props.onDragStart||Lr.Z,onDragEnd:this.props.onDragEnd||void 0,onDrop:this.props.onDrop||void 0,onDragEnter:this.props.onDragEnter||void 0,onPointerEnter:()=>this.setState({isIconHovered:!0}),onPointerLeave:()=>this.setState({isIconHovered:!1})},void 0,ef(nf,{winId:this.context.vivaldiWindowId}))}}var of,af=n(83526);function rf(e,t,n,i){of||(of="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:of,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const lf={header:`${(0,B.Z)("sender","From")} / ${(0,B.Z)("To")} / ${(0,B.Z)("Cc")} / ${(0,B.Z)("Subject")}`,body:(0,B.Z)("Body"),anywhere:(0,B.Z)("Anywhere")};class df extends Li.PureComponent{static contextType=ts.Z;updateQuery=()=>{const e=gt.Z.getOptions(),t=gt.Z.getSelectedFolder()?.accountId===It.u4,n=gt.Z.getQuery(),i=this.state?.queryType??"anywhere";if(e.forSender||e.forContact){return{query:n,contactQuery:e.contactQuery||"",isFeed:t,options:e,queryType:i}}return{query:n,contactQuery:"",isFeed:t,options:e,queryType:i}};refSearchInput=Li.createRef();state=this.updateQuery();doDebounceSearch=(0,Ae.Z)((()=>{this.doSearch()}),200);componentDidMount(){gt.Z.addListener(this.queryListener),No.Z.addListener(this._onWebpageviewChanged)}componentWillUnmount(){No.Z.removeListener(this._onWebpageviewChanged),gt.Z.removeListener(this.queryListener)}_onWebpageviewChanged=e=>{e.winId===this.context.vivaldiWindowId&&"WEBPAGEVIEW_ACTIONS"===e.type&&"focusSearchField"===e.action&&this.refSearchInput.current?.select()};queryListener=()=>{this.setState({options:gt.Z.getOptions(),...this.updateQuery()})};doSearch=()=>{const{query:e,contactQuery:t}=this.state,n={...gt.Z.getOptions(),query:e,contactQuery:t,queryType:this.state.queryType};xt.ZP.isValidSearch(n)||e.length>0?d.Z.addSearchToHistory(n):e||(u.Z.clearStatus(p.A4),d.Z.clearSearch())};onKeyDown=e=>{switch(e.key){case"Enter":case"Return":C.Z.get(I.kMailSearchOnEnter)&&this.doSearch();break;case"Escape":if(!this.state.query){(0,ms.ZP)(e);const t=Ce.ZP.getActivePage(this.context.vivaldiWindowId);t&&af.Z.doAction(this.context.vivaldiWindowId,t.id,"focusWebView")}}};onQueryTypeChange=e=>{this.setState({queryType:e},(()=>{this.state.query&&this.doSearch()}))};onQueryChange=()=>{const e=this.refSearchInput.current?.value,t=C.Z.get(I.kMailSearchOnEnter)&&e?void 0:this.doDebounceSearch;this.setState({query:e},t)};render(){const e=!this.state.query&&!xt.ZP.isValidSearch(this.state.options),t=[{type:"checkbox",checked:"anywhere"===this.state.queryType,handler:()=>this.onQueryTypeChange("anywhere"),label:lf.anywhere,labelEnglish:"Anywhere",iconPNG:"iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAARGVYSWZNTQAqAAAACAABh2kABAAAAAEAAAAaAAAAAAADoAEAAwAAAAEAAQAAoAIABAAAAAEAAAAgoAMABAAAAAEAAAAgAAAAAKyGYvMAAAGbaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA2LjAuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIj4KICAgICAgICAgPGV4aWY6UGl4ZWxYRGltZW5zaW9uPjMyPC9leGlmOlBpeGVsWERpbWVuc2lvbj4KICAgICAgICAgPGV4aWY6UGl4ZWxZRGltZW5zaW9uPjMyPC9leGlmOlBpeGVsWURpbWVuc2lvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CizMyv0AAAB4SURBVFjD7ZbRCcAgDEQdxT29g2xkN3CkjGC/CkKVfpkWegf3/R5BQ1JSlCFmlgE0kg6gb2g1s7yEbwSP9akEyRoAv9puAoHwDsBnE/BIidkEWhS8lHK89ghJ+tNPqLvAANoSrmgTahMGC3QJSOB7AroHdA8ov80Jm4++6PcLeWoAAAAASUVORK5CYII=",iconPNGWhite:"iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAARGVYSWZNTQAqAAAACAABh2kABAAAAAEAAAAaAAAAAAADoAEAAwAAAAEAAQAAoAIABAAAAAEAAAAgoAMABAAAAAEAAAAgAAAAAKyGYvMAAAGbaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA2LjAuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIj4KICAgICAgICAgPGV4aWY6UGl4ZWxYRGltZW5zaW9uPjMyPC9leGlmOlBpeGVsWERpbWVuc2lvbj4KICAgICAgICAgPGV4aWY6UGl4ZWxZRGltZW5zaW9uPjMyPC9leGlmOlBpeGVsWURpbWVuc2lvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CizMyv0AAACESURBVFjD7ZbRCcAgDAUdxW0DeZGMYjdwJEewX4VCtX+GQt9Bvu8IKEmJkBvungFrQOmqNjZMdff8It8mvk+fRqiWGiAfqjYAa5OAGPm1hUcAYD0yYhbQ4gJwPAJEPEdsAShdZPESRDyrWt0lBqwt5YQ/IX/C4IDBAAZ8L4D3AO8B8ltObSwnDfe6D9wAAAAASUVORK5CYII="},{type:"checkbox",checked:"header"===this.state.queryType,handler:()=>this.onQueryTypeChange("header"),label:lf.header,labelEnglish:"From / To / Cc / Subject",iconPNG:"iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAARGVYSWZNTQAqAAAACAABh2kABAAAAAEAAAAaAAAAAAADoAEAAwAAAAEAAQAAoAIABAAAAAEAAAAgoAMABAAAAAEAAAAgAAAAAKyGYvMAAAGbaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA2LjAuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIj4KICAgICAgICAgPGV4aWY6UGl4ZWxYRGltZW5zaW9uPjMyPC9leGlmOlBpeGVsWERpbWVuc2lvbj4KICAgICAgICAgPGV4aWY6UGl4ZWxZRGltZW5zaW9uPjMyPC9leGlmOlBpeGVsWURpbWVuc2lvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CizMyv0AAACnSURBVFjD7ZbBCcUwDEM7QkbonpJBm7Qb5G+QkTJC/ylQ+pP28p1eLPBZwtgPLUsodJKklWQxs0rycJgsaR2aOxqfp3ZDmFmeYN6m/ASYaH6QrL0N1Jkhehsos8wBfF47QjOrT5+QvYxJlqF5KEjYjg/ALil5bBfA/khCzyuVlIYkHBLqz7ojYQSIAO8GaBDyYMCFtPd9wMw2DxZISgC26APRB0JXfQHxH4gC/xH2dgAAAABJRU5ErkJggg==",iconPNGWhite:"iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAARGVYSWZNTQAqAAAACAABh2kABAAAAAEAAAAaAAAAAAADoAEAAwAAAAEAAQAAoAIABAAAAAEAAAAgoAMABAAAAAEAAAAgAAAAAKyGYvMAAAGbaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA2LjAuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIj4KICAgICAgICAgPGV4aWY6UGl4ZWxYRGltZW5zaW9uPjMyPC9leGlmOlBpeGVsWERpbWVuc2lvbj4KICAgICAgICAgPGV4aWY6UGl4ZWxZRGltZW5zaW9uPjMyPC9leGlmOlBpeGVsWURpbWVuc2lvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CizMyv0AAAC6SURBVFjD7ZbBDcMgEARdgkugVP+Qbg9tCXYHpANKogTyiSUrhvgRgz+3Eu8dnWC4abJYDiHpAE1AyCJaOpxI0v0o71Z8PLkKIRLigPIiogXQVAEYU75P4QQAaB4JUQNI4wDwOgF4TzdiCkDI3jdegvd0Ihp7FQOamuUWM+FuQkC3ZeF893Q/r2y7NGHPW0pybpqwaaib0+wxAAN4HGD/Ccn7HXCU3eU+oBrWpi7/dIBqWG0fsH3A8p03Jb3IxrXtLGAAAAAASUVORK5CYII="},{type:"checkbox",checked:"body"===this.state.queryType,handler:()=>this.onQueryTypeChange("body"),label:lf.body,labelEnglish:"Body",iconPNG:"iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAARGVYSWZNTQAqAAAACAABh2kABAAAAAEAAAAaAAAAAAADoAEAAwAAAAEAAQAAoAIABAAAAAEAAAAgoAMABAAAAAEAAAAgAAAAAKyGYvMAAAGbaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA2LjAuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIj4KICAgICAgICAgPGV4aWY6UGl4ZWxYRGltZW5zaW9uPjMyPC9leGlmOlBpeGVsWERpbWVuc2lvbj4KICAgICAgICAgPGV4aWY6UGl4ZWxZRGltZW5zaW9uPjMyPC9leGlmOlBpeGVsWURpbWVuc2lvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CizMyv0AAACKSURBVEjH7VTBDYAgEHMERnBPSsImuAFuwEg3Qn1IVPThgT5M5PojaWl6zQ1Dnzx+RHICqhH9WNCryCvkIOEiaCdv9H7tBCJtDyBYWLqXMCBkdyCg/v+cGcHdQQJd0HvwxgbQzo9CdHLeQ6whI9Vl9pMmNqBsYgPkqQC7wJsCDTXi5R7Uo9+D78wCGg7sK59OVUMAAAAASUVORK5CYII=",iconPNGWhite:"iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAARGVYSWZNTQAqAAAACAABh2kABAAAAAEAAAAaAAAAAAADoAEAAwAAAAEAAQAAoAIABAAAAAEAAAAgoAMABAAAAAEAAAAgAAAAAKyGYvMAAAGbaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA2LjAuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIj4KICAgICAgICAgPGV4aWY6UGl4ZWxYRGltZW5zaW9uPjMyPC9leGlmOlBpeGVsWERpbWVuc2lvbj4KICAgICAgICAgPGV4aWY6UGl4ZWxZRGltZW5zaW9uPjMyPC9leGlmOlBpeGVsWURpbWVuc2lvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CizMyv0AAAC3SURBVFjD7ZbNCYAwDIUdwREc1ZvQtHQE3UA36EgdQX3+oGCrB00VyYOcGszXlxjNMpFoJ2ttQaQdkfFK6Z4hWtQ4Kc5WeB8+CKGUaZEwOtCUpc2fdreqJnebpYYLAMyESGRscb66cDgcqSb7kcQ5Y+tFQwAOB1qbOjooN2+PZ88A1MV6xD6EGPRom3GAV4WrMFzmnDHZhD/ZhCnidBMmCv82QC8AAvA9gBRfwisAlw5A/gdEok0DezdCVCjzVHkAAAAASUVORK5CYII="}];let n=Wi.ch_;return"body"===this.state.queryType?n=Wi.JXf:"header"===this.state.queryType&&(n=Wi.J8U),(0,ss.jsxs)(ss.Fragment,{children:[rf("div",{className:"MailSearchField-Inner"},void 0,(0,ss.jsx)("input",{ref:this.refSearchInput,className:"searchfield-input",type:"search",placeholder:this.state.isFeed?(0,B.Z)("Search Feeds"):(0,B.Z)("Mail Search"),value:this.state.query,onChange:this.onQueryChange,onKeyDown:this.onKeyDown}),e&&rf("button",{className:"MailSearchField-advancedSearchIcon",tooltip:(0,B.Z)("Open advanced mail search"),dangerouslySetInnerHTML:{__html:Wi.uZ2},onClick:e=>d.Z.showMailSearchOptions()})),rf(po.ZP,{image:n,popupPosition:"below",tooltip:(0,B.Z)("Search in"),isMenuIndicatorVisible:!0,openMenuOnClick:!0,menu:()=>t,menuOrigin:"bottomLeft"})]})}}const cf=df;var uf;function pf(e,t,n,i){uf||(uf="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:uf,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const hf=[I.kPanelsAsOverlayEnabled,I.kPanelsPosition,I.kMailViewDimensions,I.kMailViewLayout,I.kToolbarsMail,I.kToolbarsMailComposer,I.kToolbarsMailMessage];var gf=pf(cf,{});class mf extends Li.Component{static contextType=ts.Z;winId=this.context.vivaldiWindowId;state={searchInput:"",panelWidth:Yn.ZP.getWidth(this.winId),folder:"",width:0,margin:0};componentDidMount(){this.props.inEditor||(this.getFieldStyle(),Yn.ZP.addListener(this.panelStoreChanged,(e=>e.windowData.get(this.context.vivaldiWindowId))),gt.Z.addListener(this.selectedFolderChanged),this.selectedFolderChanged())}componentDidUpdate(e){e.prefValues[I.kMailViewDimensions]===this.props.prefValues[I.kMailViewDimensions]&&e.prefValues[I.kMailViewLayout]===this.props.prefValues[I.kMailViewLayout]||this.context.requestAnimationFrame((()=>this.getFieldStyle()))}componentWillUnmount(){this.props.inEditor||(Yn.ZP.removeListener(this.panelStoreChanged),gt.Z.removeListener(this.selectedFolderChanged))}panelStoreChanged=()=>{this.context.requestAnimationFrame((()=>{this.setState({panelWidth:Yn.ZP.getWidth(this.winId)},(()=>this.getFieldStyle()))}))};selectedFolderChanged=()=>{let e,t;const n=gt.Z.getSelectedFolder();n&&(e=n.accountId,t=n.path,this.setState({folder:e+t}))};getView=()=>{const e=Ce.ZP.getActivePage(this.context.vivaldiWindowId)?.url??"";let t="list";return(0,Zt.vE)(e)?t="composer":(0,Zt.Ds)(e)&&(t="message"),t};getFieldStyle=()=>{const{prefValues:e}=this.props,t=this.getView(),n="list"!==t?0:6;"horizontal"===e[I.kMailViewLayout]&&this.setState({width:260,margin:6});const{document:i,HTMLDivElement:s}=this.context,o=Yn.ZP.getSelected(this.context.vivaldiWindowId),a=o&&!Yn.ZP.getSeparateFloating(o,this.context.vivaldiWindowId)&&!e[I.kPanelsAsOverlayEnabled]&&"left"===e[I.kPanelsPosition],r=i.querySelector(".mainbar .toolbar-mailbar .toolbar-spacer-panel:has(~ .SearchField)"),l=i.querySelector(".mainbar .toolbar-mailbar .SearchField"),d=Boolean(i.querySelector("#panels-container.overlay.minimized"));if("list"===t&&r instanceof s){const{panelWidth:t}=this.state,i=r.getClientRects()[0];if(i){const s=l?.getClientRects()[0]?.left||6,o=a?i.right>t?i.right-t+(s-i.right):-2:i.right,r=e[I.kMailViewDimensions],c="vertical_wide"===e[I.kMailViewLayout],u="left"===e[I.kPanelsPosition]&&d?34:0;return void this.setState({width:Math.min((c?r.widthWide:r.width)-o+u,800),margin:n})}}this.setState((e=>({width:e.width||260,margin:e.margin||6})))};render(){const e=(0,dp.uu)({draggable:this.props.draggable,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,onDragEnter:this.props.onDragEnter,onDragOver:this.props.onDragOver,onDragLeave:this.props.onDragLeave,onDrop:this.props.onDrop});if(this.props.inEditor)return(0,ss.jsx)("input",{type:"text",value:(0,B.Z)("Mail Search"),name:"MailSearch",readOnly:!0,...e});const t=this.props.buttonClasses;return(0,ss.jsx)("div",{className:Fi()("SearchField MailSearchField",t),name:"MailSearch",style:"horizontal"!==this.props.prefValues[I.kMailViewLayout]?{flexBasis:this.state.width,marginRight:this.state.margin}:{},...e,children:gf})}}const ff=(0,Bu.Z)((0,dp.ZP)(mf),hf);async function vf(){await Promise.all([Yt.Z.checkForMail(),qt.Z.checkForMail(),new Promise((e=>setTimeout(e,1e3)))])}var yf=n(56887);const bf=[I.kMailIsTurnedOff,I.kMailSearchSortField,I.kMailSearchSortFieldPerFolder,I.kMailSearchSortFieldSent,I.kMailShowQuickReply,I.kMailPreferredRendering,I.kMailViewLayout];class Sf extends Li.PureComponent{static contextType=ts.Z;state={canGoBack:!1,canGoForward:!1,isCheckingMail:!1,folder:gt.Z.getSelectedFolder()};_isMounted=!1;componentDidMount(){this._isMounted=!0,gt.Z.addListener(this._onSelectedFolderStoreChange)}componentWillUnmount(){this._isMounted=!1,gt.Z.removeListener(this._onSelectedFolderStoreChange)}_onSelectedFolderStoreChange=()=>{this.setState({canGoBack:gt.Z.canGoBack(),canGoForward:gt.Z.canGoForward(),folder:gt.Z.getSelectedFolder()})};checkForMail=async()=>{this.setState({isCheckingMail:!0}),await vf(),this.setState({isCheckingMail:!1})};_onHistorySelection=e=>{d.Z.selectFolderFromHistory(this.context.vivaldiWindowId,e)};_getHistoryMenuPromise=e=>()=>{const t=gt.Z.getHistoryIndex(),n=Ce.ZP.getActivePage(this.context.vivaldiWindowId)?.url??"",i=gt.Z.getSelectionHistory(),s="backward"===e?i.slice(0,t).reverse():i.slice(t+1),o="backward"===e?(e,t)=>e-t-1:(e,t)=>e+t+1,a=s.map(((e,i)=>({url:n,handler:()=>this._onHistorySelection(o(t,i)),...Qe.Z.makeNumberMnemonic(e.name,i)})));return Promise.resolve(a)};mailBackMenu=this._getHistoryMenuPromise("backward");mailForwardMenu=this._getHistoryMenuPromise("forward");selectHistoryItem=e=>{d.Z.selectFolderFromHistory(this.context.vivaldiWindowId,e)};rewindFolderSelection=()=>{d.Z.selectFolderFromHistory(this.context.vivaldiWindowId,0)};forwardToEndOfFolderSelection=()=>{d.Z.selectFolderFromHistory(this.context.vivaldiWindowId,gt.Z.getSelectionHistory().length-1)};navigate=e=>{const t=Ce.ZP.getActivePage(this.context.vivaldiWindowId);t&&(e?af.Z.forward(this.context.vivaldiWindowId,t.id):af.Z.back(this.context.vivaldiWindowId,t.id))};toggleLayout=()=>{const e=["horizontal","vertical","vertical_wide"],t=e.indexOf(this.props.prefValues[I.kMailViewLayout]),n=e[(t+1)%3];w.Z.set(I.kMailViewLayout,n)};render(){const{name:e,size:t,customizeMenu:n,menuOrigin:i,draggable:s,onDragStart:o,onDragEnd:a,onDrop:r,onDragEnter:l,mimeType:d}=this.props,c={name:e,size:t,customizeMenu:n,menuOrigin:i,draggable:s,onDragStart:o,onDragEnd:a,onDrop:r,onDragEnter:l,mimeType:d};switch(e){case"MailBack":return(0,ss.jsx)(po.ZP,{...c,disabled:!this.state.canGoBack,onClick:()=>this.navigate(!1),label:(0,B.Z)("Previous Page"),tooltip:(0,B.Z)("Go to previous page"),tooltipExtra:(0,B.Z)("Hold for history list"),menu:this.mailBackMenu,image:Wi.mgF[this.props.size]});case"MailForward":return(0,ss.jsx)(po.ZP,{...c,disabled:!this.state.canGoForward,onClick:()=>this.navigate(!0),label:(0,B.Z)("Next Page"),tooltip:(0,B.Z)("Go to next page"),tooltipExtra:(0,B.Z)("Hold for forward history list"),menu:this.mailForwardMenu,image:Wi.Zu[this.props.size]});case"MailReload":return(0,ss.jsx)(po.ZP,{...c,className:this.state.isCheckingMail?"btn-toolbar-spinner":"",disabled:this.props.disabled||this.state.isCheckingMail,tooltip:(0,B.Z)("Check for mail"),onClick:this.checkForMail,image:Wi.QPh[this.props.size]});case"MailViewQuickResponse":const n="show",i="hide";return(0,ss.jsx)(po.ZP,{...c,tooltip:this.props.prefValues[I.kMailShowQuickReply]===n?(0,B.Z)("Hide Quick Reply Editor"):(0,B.Z)("Show Quick Reply Editor"),onClick:()=>w.Z.set(I.kMailShowQuickReply,this.props.prefValues[I.kMailShowQuickReply]===n?i:n),image:Wi.IWS[t],imageOverride:"MailViewQuickResponse",style:{"--displayQuickReply":this.props.prefValues[I.kMailShowQuickReply]===n?1:0}});case"MailRenderingMethod":case"MailRenderingMethodText":{const n=(this.props.preview||"prefer_html"===this.props.prefValues[I.kMailPreferredRendering])&&"MailRenderingMethodText"!==e,i=n?(0,B.Z)("Show Messages as Text"):(0,B.Z)("Show Messages as HTML");return(0,ss.jsx)(po.ZP,{...c,tooltip:i,onClick:()=>w.Z.toggle(I.kMailPreferredRendering,"prefer_html","plaintext"),image:n?Wi.lOb[t]:Wi.dYD[t],imageOverride:n?"MailRenderingMethod":"MailRenderingMethodText"})}case"MailViewLayout":const s=this.props.prefValues[I.kMailViewLayout];return(0,ss.jsx)(po.ZP,{...c,tooltip:(0,B.Z)("Toggle View"),onClick:this.toggleLayout,disabled:this.props.prefValues[I.kMailIsTurnedOff],image:Wi.EVi[t],style:this.props.preview?{}:{"--modeHorizontal":"horizontal"===s?1:0,"--modeVertical":"vertical"===s?1:0,"--modeVerticalWide":"vertical_wide"===s?1:0}});case"MailViewThreading":case"MailViewThreadingFlat":const o=(this.props.preview||"threads"===(0,yf.U)(this.state.folder))&&"MailViewThreadingFlat"!==e;return(0,ss.jsx)(po.ZP,{...c,tooltip:o?(0,B.Z)("Hide Message Threads"):(0,B.Z)("Show Message Threads"),onClick:()=>this.state.folder&&(0,yf.O)(this.state.folder,o?"sentDate":"threads"),disabled:!this.state.folder,image:o?Wi.AE4[t]:Wi.eCP[t],imageOverride:o?"MailViewThreading":"MailViewThreadingFlat"});default:return console.warn(`ToolbarButton “${e}” not found`),null}}}const wf=(0,Bu.Z)(Sf,bf);var Cf=n(36943),Af=n(45709);function If(e,t,n,i,s){const o=ji.Z.getOptionFunction(e),a={};return ji.Z.getNamedMenu(t,e,(async function(e){const r=await tn.Z.messages.get(n.id);switch(r||u.Z.setStatus(t,(0,B.Z)("Could not find message")),e.action){case"CONTEXT_OPEN_IN_NEW_TAB":return{handler:()=>r&&s(r,{inCurrent:!1}),isEnabled:()=>Boolean(r),...o(t,e,a)};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{handler:()=>r&&s(r,{inCurrent:!1,inBackground:!0}),isEnabled:()=>Boolean(r),...o(t,e,a)};case"CONTEXT_MAIL_REPLY":return{handler:()=>r&&Qt.Z.reply(r),isEnabled:()=>Boolean(r),...o(t,e,a)};case"CONTEXT_MAIL_REPLY_ALL":return{handler:()=>r&&Qt.Z.replyToAll(r),isEnabled:()=>Boolean(r),...o(t,e,a)};case"CONTEXT_MAIL_REPLY_LIST":return{handler:()=>r&&Qt.Z.replyToList(r),isEnabled:()=>Boolean(r),...o(t,e,a)};case"CONTEXT_MAIL_FORWARD":return{handler:()=>r&&Qt.Z.forward(r),isEnabled:()=>Boolean(r),...o(t,e,a)};case"CONTEXT_MAIL_MARK_READ":return{handler:()=>Af.Z.setRead([n],!0),isEnabled:()=>!At.Z.call(n.sources),...o(t,e,a)};case"CONTEXT_MAIL_MARK_UNREAD":return{handler:()=>Af.Z.setRead([n],!1),isEnabled:()=>At.Z.call(n.sources),...o(t,e,a)};case"CONTEXT_MAIL_MARK_JUNK":return{handler:()=>Cf.Z.moveToJunk([n]),isVisible:()=>!i,...o(t,e,a)};default:return{...o(t,e,a)}}}))}var Tf,Zf=n(307),Ef=n(59275);function kf(e,t,n,i){Tf||(Tf="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Tf,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const _f=[I.kKeyboardTabToAll];function Nf(e){return e.some((e=>"error"===e.level))}function Pf(e){let t=Vp.getLogsByComponent(["Mail","oAuth"]);return e!==It.of&&(t=t.filter((t=>t.tags.includes(e)))),t}var Df=kf("br",{});class Mf extends Li.PureComponent{static contextType=ts.Z;constructor(e,t){super(e);const n=Pf(e.accountId);this.state={activeListEntry:J.Z.getActiveListEntry(),isMailTabActive:Boolean(Ce.ZP.getActivePage(t.vivaldiWindowId)?.isMailPage),selectedPane:e.requestPane?e.requestPane:C.Z.get(I.kMailStatusSelectedPane),logs:n,hasLoggedError:Nf(n),isCheckingMail:!1}}componentDidMount(){const{selectWindow:e}=this.context;J.Z.addListener(this.handleActiveMessageStoreChange),Ce.ZP.addListener(this.checkIfMailTabActive,e),Vp.addListener(this.handleLogStoreChange)}componentWillUnmount(){J.Z.removeListener(this.handleActiveMessageStoreChange),Ce.ZP.removeListener(this.checkIfMailTabActive),Vp.removeListener(this.handleLogStoreChange)}componentDidUpdate(e){if(e.accountId!==this.props.accountId){const e=Pf(this.props.accountId);this.setState({logs:e,hasLoggedError:Nf(e)})}}checkIfMailTabActive=()=>{const e=Boolean(Ce.ZP.getActivePage(this.context.vivaldiWindowId)?.isMailPage);this.setState({isMailTabActive:e})};handleActiveMessageStoreChange=()=>{this.updateCurrentMessageDebounced()};handleLogStoreChange=()=>{const e=Pf(this.props.accountId);this.setState({logs:e,hasLoggedError:Nf(e)})};updateCurrentMessageDebounced=(0,Ae.Z)((()=>{this.setState({activeListEntry:J.Z.getActiveListEntry()})}));_selectPane=e=>{w.Z.set(I.kMailStatusSelectedPane,e),this.setState({selectedPane:e})};#D=async(e,t)=>{this.props.hidePopup(),(0,Zf.Z)(this.context.vivaldiWindowId,e,t)};_viewLog=()=>{se.Z.devtoolsPrivate.toggleDevtools(this.context.vivaldiWindowId,"console"),this.props.hidePopup()};_restoreFullTextSearchDb=async()=>{const e={title:(0,B.Z)("title","Rebuild Mail Search Database"),body:(0,B.Z)("Note: This task could take several minutes."),actions:[{title:(0,B.Z)("Rebuild"),action:"confirm"}],cancelAction:{title:(0,B.Z)("Cancel"),action:"cancel",default:!0}},{action:t}=await de.Z.showModal(this.context.vivaldiWindowId,{modal:e});"cancel"!==t&&(await se.Z.mailPrivate.deleteMailSearchDB(),await tn.Z.systemTasks.add({taskName:"restore_full_text_search_db",currentPosition:0}),jt.Z.runSystemTasks())};openMailSettings=()=>{de.Z.showSettings(this.context.vivaldiWindowId,"mail"),this.props.hidePopup()};#M=e=>{this.props.switchAccount(e)};#O=()=>{de.Z.showMailInfoDialog(this.context.vivaldiWindowId),this.props.hidePopup()};getContextMenu=()=>{const e=C.Z.get(I.kMailAccounts),t=[It.of].concat(e.map((e=>e.MAIL_EMAIL)));return[{handler:this.openMailSettings,...(0,us.Z)("Mail Settings")},{handler:this.#O,...(0,us.Z)("Advanced Mail Info")},{handler:this._viewLog,...(0,us.Z)("View Log")},{handler:this._restoreFullTextSearchDb,...(0,us.Z)("command","Rebuild Mail Search Database")},{...(0,us.Z)("Select Folder"),items:t.map((e=>({type:"checkbox",checked:this.props.accountId===e,handler:()=>this.#M(e),label:e,labelEnglish:e})))}]};checkForMail=async()=>{this.setState({isCheckingMail:!0}),await vf(),this.setState({isCheckingMail:!1})};#x=(e,t)=>{e.persist(),(0,ms.ZP)(e),If("mailandfeeds",this.context.vivaldiWindowId,t,!1,this.#D).then((t=>{(0,cs.Z)(this.context,t)(e)}))};render(){const e=C.Z.get(I.kMailAccounts),t=this.state.activeListEntry;return(0,ss.jsxs)(ss.Fragment,{children:[kf("div",{className:"StatusPopup-Header"},void 0,kf("h2",{id:"popup-label-mailstatus"},void 0,(0,B.Z)("Mail Status")),kf("div",{className:"toolbar button-popup-header-toolbar toolbar-default"},void 0,kf(po.ZP,{onClick:()=>{de.Z.showMail(this.context.vivaldiWindowId),this.props.hidePopup()},disabled:this.state.isMailTabActive,menuOrigin:"bottomLeft",title:(0,B.Z)("Show Mail")}),kf(po.ZP,{menuOrigin:"bottomLeft",image:Wi.bqs.small,menu:this.getContextMenu,tooltip:(0,B.Z)("Mail status tools")}))),kf("div",{className:"toolbar toolbar-default"},void 0,kf("div",{className:"toolbar-group equal-width"},void 0,kf(po.ZP,{title:(0,B.Z)("Messages"),isPressed:"messages"===this.state.selectedPane,onClick:()=>this._selectPane("messages")}),kf(po.ZP,{title:(0,B.Z)("Accounts"),isPressed:"accounts"===this.state.selectedPane,onClick:()=>this._selectPane("accounts")}),kf(po.ZP,{title:(0,B.Z)("Logs"),isPressed:"logs"===this.state.selectedPane,onClick:()=>this._selectPane("logs"),badgeText:this.state.hasLoggedError?"!":""}))),kf("div",{className:"StatusPopup-Content"},void 0,"accounts"===this.state.selectedPane&&kf("div",{className:"StatusPopup-ContentPane"},void 0,kf("div",{className:"StatusPopup-List"},void 0,e.map((e=>kf(au,{account:e,hidePopup:this.props.hidePopup,showAdvancedInfo:!1},e.MAIL_EMAIL)))),kf("div",{className:"StatusPopup-Footer"})),"messages"===this.state.selectedPane&&kf("div",{className:"StatusPopup-ContentPane"},void 0,(0,ss.jsxs)(ss.Fragment,{children:[this.props.recentMessages.length>0&&kf("h3",{},void 0,this.props.accountId===It.of?(0,B.Z)("All Recent Messages"):(0,B.Z)("Recent in $1",[(0,B.Z)(this.props.accountId)])),kf("div",{className:"StatusPopup-List"},void 0,this.props.recentMessages.map((e=>{const t=Mn.Z.get(e.toIds),n=t.length>0?t[0].address:"",i=Mn.Z.get(e.fromIds),s=i.length>0?i[0].address:"";return kf("button",{tabIndex:this.props.prefValues[I.kKeyboardTabToAll],className:Fi()("StatusPopup-Mail",{"StatusPopup-Mail--Unread":!At.Z.call(e.sources)}),onClick:async()=>{const t=await tn.Z.messages.get(e.id);t&&this.#D(t)},onContextMenu:t=>this.#x(t,e)},e.id,kf(tu,{emailAddress:n,size:16,className:"StatusPopup-MailIcon"}),kf("div",{className:"StatusPopup-MailTitle"},void 0,e.subject),kf("div",{className:"StatusPopup-MailReceiver"},void 0,s," ➝ ",n),kf("div",{className:"StatusPopup-MailDate"},void 0,W()(e.sentDate).fromNow()))}))),t&&(0,ss.jsx)(ss.Fragment,{children:kf("dl",{className:"StatusPopup-MailDetail"},void 0,kf("dt",{},void 0,(0,B.Z)("Current Message")),kf("dd",{},void 0,t.subject),kf("dt",{},void 0,(0,B.Z)("Internal ID")),kf("dd",{},void 0,t.id),kf("dt",{},void 0,(0,B.Z)("Thread ID")),kf("dd",{},void 0,t.threadKey),kf("dt",{},void 0,(0,B.Z)("Flags")),kf("dd",{},void 0," ",t.flags.join(", ")),[...t.sources.entries()].map((([e,t])=>{const n=yt.Z.get(e);if(n)return kf(Li.Fragment,{},e,kf("dt",{},void 0,(0,B.Z)("Filter ID: $1",[e])),kf("dd",{},void 0,kf("span",{},void 0,t.read?(0,B.Z)("Read"):(0,B.Z)("Unread")),", ",kf("span",{},void 0,t.deleted?(0,B.Z)("Deleted"):(0,B.Z)("Not deleted")),", ",kf("span",{},void 0,t.internal?(0,B.Z)("Internal"):(0,B.Z)("External")),Df,kf("span",{},void 0,`${n.accountId} ${(0,Ef.e)(n.name)}`)))})))})]}),kf("div",{className:"StatusPopup-Footer toolbar-default"},void 0,kf(po.ZP,{className:this.state.isCheckingMail?"btn-toolbar-spinner":"",disabled:this.state.isCheckingMail,onClick:()=>this.checkForMail(),title:(0,B.Z)("Check for New Messages"),image:this.state.isCheckingMail?Wi.QPh.small:void 0}))),"logs"===this.state.selectedPane&&kf("div",{className:"StatusPopup-ContentPane"},void 0,kf(qp,{logs:this.state.logs,component:"Mail"})))]})}}const Of=(0,Bu.Z)(Mf,_f);function xf(e){return e>0?e>9999?(0,B.Z)("$1 K",[Math.round(e/1e3)]):e.toString():""}var Lf;function Rf(e,t,n,i){Lf||(Lf="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Lf,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Bf=[I.kMailAccounts,I.kMailCountersPanelUnseenEnabled,I.kMailCountersStatusButtonEnabled,I.kMailIsTurnedOff,I.kMailStatusButtonStyle,I.kMailStatusSelectedAccount,I.kRssSettings];function Ff(){const e=ht.Z.getCounters("All Messages","Unread");return{unseen:e?.unseen||0,unread:e?.unread||0}}function Wf(e){const t=Ff(),n=e||It.of,i=n===It.of?It.ik:It.Gf;return{accountId:n,isPopupOpen:!1,recentMessages:Kt.getList(n,i),hasErrors:!1,...t}}class Uf extends Li.PureComponent{static contextType=ts.Z;constructor(e){super(e),this.state={...Wf(e.prefValues[I.kMailStatusSelectedAccount])}}componentDidMount(){Kt.addListener(this.onLatestStoreChange),Rh.addListener(this.popupStateChanged),Vp.addListener(this.handleLogStoreChange)}componentWillUnmount(){Kt.removeListener(this.onLatestStoreChange),Rh.removeListener(this.popupStateChanged),Vp.removeListener(this.handleLogStoreChange)}static getDerivedStateFromError(){return Wf()}popupStateChanged=()=>{const e=Rh.getState().mailPopupOpen;this.setState({isPopupOpen:e})};getMessageCount=()=>this.props.prefValues[I.kMailCountersPanelUnseenEnabled]?this.state.unseen:this.state.unread;onLatestStoreChange=()=>{const{accountId:e}=this.state,t=Kt.getList(e,e===It.of?It.ik:It.Gf),n=Ff();t&&this.setState({recentMessages:t,...n})};hidePopup=()=>{this.setState({isPopupOpen:!1}),Oh.close("Mail")};togglePopup=()=>{this.setState((e=>({isPopupOpen:!e.isPopupOpen})))};openMailAccountSheet=()=>{de.Z.showMailAccountDialog(this.context.vivaldiWindowId)};openMailSettings=()=>{de.Z.showSettings(this.context.vivaldiWindowId,"mail")};mailHasErrors=()=>Vp.getLogsByComponent(["Mail","oAuth"]).some((e=>"error"===e.level));handleLogStoreChange=()=>{this.setState({hasErrors:this.mailHasErrors()})};switchAccount=e=>{if(w.Z.set(I.kMailStatusSelectedAccount,e),e===It.of){const t=Kt.getList(It.of,It.ik);this.setState({accountId:e,recentMessages:t})}else if(Kt.hasList(e)){const t=Kt.getList(e,It.Gf);this.setState({accountId:e,recentMessages:t})}else!function(e,t){A.Z.dispatch({actionType:"MAIL_LATEST_POPULATE",accountId:e,path:t})}(e,It.Gf),this.setState({accountId:e})};getTooltip=()=>{const e=this.props.prefValues[I.kMailIsTurnedOff],t=this.props.prefValues[I.kMailAccounts].length+this.props.prefValues[I.kRssSettings].length>0;return e||!t?(0,B.Z)("Mail"):(0,B.Z)("Mail Status")};getTooltipExtras=()=>{const e=this.props.prefValues[I.kMailCountersPanelUnseenEnabled],t=this.getMessageCount();let n="";return t>0&&(n+=e?(0,B.Z)("($1 unseen)","($1 unseen)",[t]):(0,B.Z)("($1 unread)","($1 unread)",[t])),this.state.recentMessages.length>0&&(n+="\n\n"),this.state.recentMessages.forEach(((e,t)=>{t>0&&(n+="\n\n"),n+=e.subject;const i=Mn.Z.get(e.fromIds);i.length>0&&(n+="\n"+i[0].address)})),n};menu=()=>{const e=this.props.prefValues[I.kMailStatusButtonStyle],t=this.props.prefValues[I.kMailCountersStatusButtonEnabled];return[{handler:this.openMailSettings,...(0,us.Z)("Mail Settings")},{items:[{type:"checkbox",checked:"imageandtext"===e,handler:()=>w.Z.set(I.kMailStatusButtonStyle,"imageandtext"),...(0,us.Z)("Image and Text")},{type:"checkbox",checked:"image"===e,handler:()=>w.Z.set(I.kMailStatusButtonStyle,"image"),...(0,us.Z)("Image Only")},{type:"checkbox",checked:"text"===e,handler:()=>w.Z.set(I.kMailStatusButtonStyle,"text"),...(0,us.Z)("title","Text Only")}],...(0,us.Z)("Button Style")},{type:"checkbox",checked:t,handler:()=>w.Z.set(I.kMailCountersStatusButtonEnabled,!t),...(0,us.Z)("Show Message Counter")}]};render(){const e=this.props.prefValues[I.kMailStatusButtonStyle],t=this.props.preview||this.props.inEditor||!this.props.prefValues[I.kMailIsTurnedOff]&&this.props.isMailWindow,n=this.props.prefValues[I.kMailCountersStatusButtonEnabled],i=!this.props.isMailWindow,s=this.props.prefValues[I.kMailAccounts].length+this.props.prefValues[I.kRssSettings].length>0,o=this.props.prefValues[I.kMailCountersPanelUnseenEnabled];let a="";return this.state.hasErrors?a="!":n&&(a=xf(this.getMessageCount())),Rf(po.ZP,{badgeText:a??"",className:Fi()(this.state.hasErrors?"StatusButton--HasError":"StatusButton",{unseen:o}),disabled:i,onClick:s?this.togglePopup:this.openMailAccountSheet,customizeMenu:this.props.customizeMenu,menuOrigin:this.props.menuOrigin,tooltip:this.getTooltip(),tooltipExtra:this.getTooltipExtras(),title:"image"!==e?(0,B.Z)("Mail Status"):void 0,image:"text"!==e?Wi.lvj[this.props.size]:void 0,draggable:this.props.draggable,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,onDrop:this.props.onDrop,onDragEnter:this.props.onDragEnter,mimeType:this.props.mimeType,name:this.props.name,hidePopup:this.hidePopup,popupPosition:this.props.popupPosition,popupClassName:"StatusPopup",popupLabelledBy:"popup-label-mailstatus",popupWidth:400,isPopupVisible:this.state.isPopupOpen,menu:this.menu,size:this.props.size,style:t?void 0:{display:"none"}},void 0,!i&&Rf(Of,{switchAccount:this.switchAccount,recentMessages:this.state.recentMessages,accountId:this.state.accountId,hidePopup:this.hidePopup,requestPane:this.state.hasErrors?"logs":void 0}))}}const Vf=(0,Bu.Z)(Uf,Bf);var Hf=n(43630);const Gf={getItems:function(e,t){const n=[],i="read"===t?C.Z.get(I.kMailReadHeadersHidden):C.Z.get(I.kMailComposeHeadersHidden);return e.map((e=>{n.push({type:"checkbox",checked:!i.includes(e.ref),handler:this._setField.bind(this,e.ref,t),...e.labels})})),n},_setField:function(e,t){const n="read"===t?I.kMailReadHeadersHidden:I.kMailComposeHeadersHidden;let i=C.Z.get(n).slice();i.includes(e)?i=i.filter((t=>t!==e)):i.push(e),w.Z.set(n,i)}};var $f,Kf=n(49168);function zf(e,t,n,i){$f||($f="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:$f,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class jf extends Li.Component{_isIMEOpen=!1;state={newLabel:""};onSave=async()=>{if(this._isIMEOpen||!this.state.newLabel||this.doesLabelExist(this.state.newLabel))return;const e=(0,Kf.A4)(this.state.newLabel),t=J.Z.getActiveListEntry(),n=t?(0,Kf.Q3)(t.flags):[];await d.Z.addLabelsFilter(e),Hf.Z.toggleLabel(this.props.windowId,e,n)(),this.props.onClose()};onCancel=()=>{this.props.onClose()};doesLabelExist=e=>{const t=ht.Z.getByAccountId(It.ut).map((e=>e.name.toLowerCase()));return t.includes(It.ow+e.toLowerCase())||t.includes(e.toLowerCase())};newLabelChanged=e=>{if(this._isIMEOpen)return void this.setState({newLabel:e.target.value});const t=(0,Kf.Tv)(e.target.value);t!==this.state.newLabel&&this.setState({newLabel:t})};render(){const{newLabel:e}=this.state,t=this.doesLabelExist(e);return zf(ra.Z,{onRequestClose:this.onCancel,className:this.props.viewMode,labelledBy:"popup-label-addmaillabel"},void 0,zf("header",{className:"dialog-header"},void 0,zf("h1",{className:"dialog-title",id:"popup-label-addmaillabel"},void 0,(0,B.Z)("Add a New Label"))),zf("form",{onSubmit:this.onSave},void 0,zf("div",{className:"dialog-content"},void 0,zf("input",{type:"text",className:"new-label",maxLength:Kf.Ws,onChange:this.newLabelChanged,onCompositionStart:()=>this._isIMEOpen=!0,onCompositionEnd:e=>{this._isIMEOpen=!1,this.newLabelChanged(e)},value:(0,Rn.kF)(e),autoFocus:!0}),t&&zf(To,{type:"info"},void 0,(0,B.Z)("Label “$1” already exists.",[(0,Rn.kF)(e)]))),zf("footer",{className:"dialog-footer"},void 0,zf("input",{type:"submit",className:"primary",value:(0,B.Z)("Save"),disabled:""===e||t}),zf("input",{type:"button",value:(0,B.Z)("Cancel"),onClick:this.onCancel}))))}}const Yf=jf;var Xf=n(98484),Qf=n(86461);const qf=(0,B.Z)("All Messages"),Jf=(0,B.Z)("Custom Folders"),ev=(0,B.Z)("Mailing Lists"),tv=(0,B.Z)("Filters"),nv=(0,B.Z)("Flags"),iv=(0,B.Z)("Labels"),sv=(0,B.Z)("Feeds");function ov(e){return{name:Jf,accountId:It.Ry,path:It.ym,id:It.Ry,children:e}}function av(e){return{name:ev,accountId:It.wC,path:It.ym,id:It.jT,children:e}}function rv(e){return{name:tv,accountId:It.Kz,path:It.ym,id:It.rQ,children:e}}function lv(e){return{name:nv,accountId:It.MN,path:It.ym,id:It.q0,children:e}}function dv(e){return{name:iv,accountId:It.ut,path:It.ym,id:It.pz,children:e}}function cv(e){return{name:sv,accountId:It.u4,path:It.ym,id:It.sM,children:e}}const uv=new Map([[It.of,qf],[It.Ry,Jf],[It.wC,ev],[It.Kz,tv],[It.MN,nv],[It.ut,iv],[It.u4,sv]]);var pv;function hv(e,t,n,i){pv||(pv="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:pv,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class gv extends Li.PureComponent{state={isOpen:!1,disableUndo:!0,undoActions:[]};componentDidMount(){this.getUndoState(),Xf.Z.addListener(this.getUndoState)}componentWillUnmount(){Xf.Z.removeListener(this.getUndoState)}toggleOpen=()=>{this.setState((e=>({isOpen:!e.isOpen})))};getUndoState=()=>{const e=Xf.Z.getUndoActions();this.setState((t=>({undoActions:[...e],disableUndo:0===e.size,isOpen:0!==e.size&&t.isOpen})))};onRequestClose=()=>{this.setState({isOpen:!1})};getLabel=e=>{switch(e.operation){case"delete":return(0,B.Z)("Restore $1 message from Trash","Restore $1 messages from Trash",[e.searchListIds.size]);case"setFlags":if(0===e.sourcesPerSle.size)throw new Error("Empty setFlags undo item");return[...[...e.sourcesPerSle.values()][0].values()][0].read?(0,B.Z)("Mark $1 message as read","Mark $1 messages as read",[e.searchListIds.size]):(0,B.Z)("Mark $1 message as unread","Mark $1 messages as unread",[e.searchListIds.size]);default:throw new Error("Invalid undo item with operation "+e.operation)}};getDetails=e=>{const{undoItem:t,folder:n}=e,{searchListIds:i,operation:s}=t;if(1===i.size){const e=ht.Z.getListEntry([...i][0]);if(e)return e.subject}if(n){const{accountId:e,name:t}=n;if(vt.Z.isMailAccount(e))return"delete"===s?(0,B.Z)("Deleted from '$1' ($2)",[t,e]):(0,B.Z)("Marked in '$1' ($2)",[t,e]);{const n=uv.get(e)||e;return"delete"===s?(0,B.Z)("Deleted from '$1' ($2)",[t,n]):(0,B.Z)("Marked in '$1' ($2)",[t,n])}}return""};getIcon=e=>{switch(e.operation){case"delete":return Wi.nre.small;case"setFlags":if(0===e.sourcesPerSle.size)throw new Error("Empty setFlags undo item");return[...[...e.sourcesPerSle.values()][0].values()][0].read?Wi.LDV.small:Wi.aAJ.small;default:throw new Error("Invalid undo item with operation "+e.operation)}};renderUndoActions=()=>{const e=[];let t=0;for(const n of this.state.undoActions){const{undoItem:i,created:s}=n;e.unshift(hv(Li.Fragment,{},t++,hv("button",{onClick:e=>d.Z.undo(n)},void 0,hv("div",{className:"undo-item"},void 0,hv("span",{className:"button-icon",dangerouslySetInnerHTML:{__html:this.getIcon(i)}}),hv("div",{className:"undo-text"},void 0,hv("div",{className:"action-timestamp"},void 0,hv("span",{className:"label"},void 0,this.getLabel(i)),hv("span",{className:"timestamp"},void 0,W()(s).format("L"))),hv("div",{className:"subject"},void 0,hv("span",{},void 0,this.getDetails(n))))))))}return e};render(){const{draggable:e,onDragStart:t,onDragEnd:n,onDrop:i,onDragEnter:s,mimeType:o,name:a,size:r,customizeMenu:l,menuOrigin:d}=this.props,c={draggable:e,customizeMenu:l,onDragStart:t,onDragEnd:n,onDrop:i,onDragEnter:s,mimeType:o,name:a,size:r,menuOrigin:d};return(0,ss.jsx)(po.ZP,{...c,tooltip:(0,Qf.wY)("MailUndo"),image:Wi.ERx[r],isPressed:this.state.isOpen,disabled:this.state.disableUndo,onClick:this.toggleOpen,popupWidth:320,isPopupVisible:this.state.isOpen,hidePopup:this.onRequestClose,popupPosition:this.props.popupPosition,children:this.state.isOpen&&hv("div",{className:"undo-wrapper"},void 0,this.renderUndoActions())})}}const mv=gv;const fv=function(e,t){const n=[];return t?(n.push({handler:()=>Hf.Z.undelete(e),...(0,us.Z)("mail","Undelete")}),n.push({handler:()=>Hf.Z.prepareDelete(e,!0),...(0,us.Z)("mail","Delete Permanently")})):n.push({handler:()=>Hf.Z.prepareDelete(e,!1),...(0,us.Z)("mail","Move to Trash")}),n};var vv;function yv(e,t,n,i){vv||(vv="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:vv,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const bv=[{ref:"from",labels:(0,us.Z)("sender","From")},{ref:"cc",labels:(0,us.Z)("Carbon Copy")},{ref:"bcc",labels:(0,us.Z)("Blind Carbon Copy")}],Sv=[I.kMailSendOrQueue];class wv extends Li.PureComponent{static contextType=ts.Z;state={standardFlag:"",customLabels:[],unread:!1,messageSelected:!1,showLabel:!1,disableTrash:!0,disableJunk:!0,disableArchive:!0,disableMarkRead:!0,disableUndo:!0};componentDidMount(){this.props.inEditor||(J.Z.addListener(this.activeMessageStoreChanged),Dt.addListener(this.updateButtonStatus),this.activeMessageStoreChanged(),this.updateButtonStatus())}activeMessageStoreChanged=()=>{const e=J.Z.getActiveListEntry();if(e){const t=ht.Z.getListEntry(e.id);if(t){const e=gt.Z.getSelectedFolder(),n=e&&ht.Z.getByFolder(e.accountId,e.path);this.setState({messageSelected:!0,unread:!At.Z.call(t.sources,n),standardFlag:(0,Kf.Zr)(t.flags),customLabels:(0,Kf.Q3)(t.flags)})}else this.setState({messageSelected:!1})}else this.setState({messageSelected:!1})};updateButtonStatus=()=>{this.setState({disableTrash:!Dt.isEnabled("MailMsgTrash"),disableJunk:!Dt.isEnabled("MailMsgSpam"),disableArchive:!Dt.isEnabled("MailMsgArchive"),disableMarkRead:!Dt.isEnabled("MailMsgStatusRead")})};componentWillUnmount(){this.props.inEditor||(J.Z.removeListener(this.activeMessageStoreChanged),Dt.removeListener(this.updateButtonStatus))}createCustomLabel=()=>{this.setState({showLabel:!0})};closeCustomFlagDlg=()=>{this.setState({showLabel:!1})};getSendQueueMenu=()=>[{type:"checkbox",checked:"send"===this.props.prefValues[I.kMailSendOrQueue],handler:this.sendAndSetSendAsDefault,...(0,us.Z)("Send")},{type:"checkbox",checked:"queue"===this.props.prefValues[I.kMailSendOrQueue],handler:this.queueAndSetQueueAsDefault,...(0,us.Z)("Queue")}];sendAndSetSendAsDefault=()=>{"send"!==this.props.prefValues[I.kMailSendOrQueue]&&w.Z.set(I.kMailSendOrQueue,"send")};queueAndSetQueueAsDefault=()=>{"queue"!==this.props.prefValues[I.kMailSendOrQueue]&&w.Z.set(I.kMailSendOrQueue,"queue")};deleteDraftMessage=()=>{Oa.Z.onCommand(this.context.vivaldiWindowId,"COMMAND_MAIL_COMPOSER_DELETE_DRAFT")};customLabelsMenuData=()=>{const e=Hf.Z.getCustomLabelsMenu(this.context.vivaldiWindowId,this.state.customLabels);return e.push(Qe.Z.separatorItem,{handler:this.createCustomLabel,ellipsis:!0,...(0,us.Z)("Add New Label")}),this.state.customLabels.length>0&&e.push(Qe.Z.separatorItem,{handler:()=>Hf.Z.clearAllLabels(this.context.vivaldiWindowId,this.state.customLabels),...(0,us.Z)("Clear All Labels")}),e};render(){let e=J.Z.isTrash(),t=J.Z.isJunk(),n=J.Z.isArchived();const i=this.props.size,s=this.context.vivaldiWindowId,o=J.Z.getActiveListEntry()?.flags,a=o?"flag-color "+(0,Kf.Zr)(o).toLowerCase():void 0,{draggable:r,onDragStart:l,onDragEnd:d,onDrop:c,onDragEnter:u,mimeType:p,name:h,size:g,customizeMenu:m,menuOrigin:f}=this.props,v={draggable:r,customizeMenu:m,onDragStart:l,onDragEnd:d,onDrop:c,onDragEnter:u,mimeType:p,name:h,size:g,menuOrigin:f,style:!this.props.preview&&Dt.isHidden(this.props.name)?{display:"none"}:void 0};switch(this.props.name){case"MailMsgEdit":return(0,ss.jsx)(po.ZP,{...v,tooltip:(0,Qf.wY)(h),onClick:()=>Hf.Z.openMessage(s),disabled:!this.state.messageSelected||!gt.Z.isFolderAnEditMailFolder(),image:Wi.NNg[i]});case"MailMsgReply":return(0,ss.jsx)(po.ZP,{...v,tooltip:(0,Qf.wY)(h),onClick:()=>Hf.Z.reply(),disabled:!this.state.messageSelected,image:Wi.hGk[i],commandId:"COMMAND_MAIL_REPLY"});case"MailMsgReplyToAll":const o=J.Z.isListPost();return(0,ss.jsx)(po.ZP,{...v,tooltip:o?(0,B.Z)("Reply to Mailing List"):(0,Qf.wY)(h),onClick:o?()=>Hf.Z.replyList():()=>Hf.Z.replyAll(),disabled:!this.state.messageSelected,image:Wi.Sap[i],isMenuIndicatorVisible:o,menu:o?()=>Hf.Z.getReplyMenu():void 0,commandId:o?"COMMAND_MAIL_REPLY_LIST":"COMMAND_MAIL_REPLY_ALL"});case"MailMsgForward":return(0,ss.jsx)(po.ZP,{...v,tooltip:(0,Qf.wY)(h),onClick:()=>Hf.Z.forward(),disabled:!this.state.messageSelected,image:Wi.upG[i],commandId:"COMMAND_MAIL_FORWARD"});case"MailMsgStatusRead":case"MailMsgStatusUnread":const r=gt.Z.getGoToMenuItems(this.context.vivaldiWindowId,It.AF.toolbar),l=this.state.unread||"MailMsgStatusUnread"===this.props.name;return(0,ss.jsx)(po.ZP,{...v,tooltip:l?(0,Qf.wY)("MailMsgStatusUnread"):(0,Qf.wY)("MailMsgStatusRead"),onClick:l?()=>Hf.Z.markRead(s):()=>Hf.Z.markUnread(s),disabled:!this.state.messageSelected||this.state.disableMarkRead,isMenuIndicatorVisible:!0,isMenuIndicatorDisabled:!this.state.unread,menu:()=>r,image:l?Wi.aAJ[i]:Wi.LDV[i],imageOverride:l?"MailMsgStatusUnread":"MailMsgStatusRead",commandId:l?"COMMAND_MAIL_MARK_READ":"COMMAND_MAIL_MARK_UNREAD"});case"MailMsgFlag":return(0,ss.jsx)(po.ZP,{...v,tooltip:(0,Qf.wY)(h),onClick:()=>Hf.Z.toggleStandardFlag(this.context.vivaldiWindowId,this.state.standardFlag?this.state.standardFlag:It.T4.RED,this.state.standardFlag),buttonClasses:a,disabled:!this.state.messageSelected,image:Wi.nyn[i],isMenuIndicatorVisible:!0,menu:()=>Hf.Z.getStandardFlagsMenu(this.context.vivaldiWindowId,this.state.standardFlag)});case"MailMsgLabel":return(0,ss.jsx)(po.ZP,{...v,tooltip:(0,Qf.wY)(h),disabled:!this.state.messageSelected,image:Wi.rpm[i],isMenuIndicatorVisible:!0,menu:this.customLabelsMenuData,size:i,hidePopup:this.closeCustomFlagDlg,hasLightArrow:!0,popupClassName:"ToolbarButtonPopup-DefaultStyles",popupLabelledBy:"popup-label-addmaillabel",popupPosition:this.props.popupPosition,isPopupVisible:this.state.showLabel,children:yv(Yf,{onClose:()=>Promise.resolve(this.closeCustomFlagDlg()),windowId:s,viewMode:"slide"})});case"MailMsgTrash":case"MailMsgTrashRestore":"MailMsgTrashRestore"===this.props.name?e=!0:this.props.preview&&(e=!1);const d=fv(s,e);return(0,ss.jsx)(po.ZP,{...v,tooltip:e?(0,Qf.wY)("MailMsgTrashRestore"):(0,Qf.wY)("MailMsgTrash"),onClick:e?()=>Hf.Z.undelete(s):()=>Hf.Z.prepareDelete(s,!1),disabled:!this.state.messageSelected||this.state.disableTrash,image:e?Wi.zpg[i]:Wi.nre[i],imageOverride:e?"MailMsgTrashRestore":"MailMsgTrash",isMenuIndicatorVisible:d.length>0,menu:()=>d});case"MailMsgMove":return(0,ss.jsx)(po.ZP,{...v,tooltip:(0,Qf.wY)(h),disabled:!this.state.messageSelected,image:Wi.Kt8[i],isMenuIndicatorVisible:!0,menu:()=>Hf.Z.getMoveToFolderMenu(s)});case"MailMsgSend":const c="send"===this.props.prefValues[I.kMailSendOrQueue];return(0,ss.jsx)(po.ZP,{...v,tooltip:c?(0,B.Z)("Send"):(0,B.Z)("Queue"),onClick:c?()=>Oa.Z.onCommand(this.context.vivaldiWindowId,"COMMAND_MAIL_SEND_MESSAGE"):()=>Oa.Z.onCommand(this.context.vivaldiWindowId,"COMMAND_MAIL_QUEUE_MESSAGE"),title:c?(0,B.Z)("Send"):(0,B.Z)("Queue"),image:Wi.zLp[i],menu:this.getSendQueueMenu,isMenuIndicatorVisible:!0,commandId:c?"COMMAND_MAIL_SEND_MESSAGE":"COMMAND_MAIL_QUEUE_MESSAGE"});case"MailMsgDiscard":return(0,ss.jsx)(po.ZP,{...v,tooltip:(0,Qf.wY)(h),onClick:()=>this.deleteDraftMessage(),image:Wi.GqE[i],isMenuIndicatorVisible:!1});case"MailMsgAttach":return(0,ss.jsx)(po.ZP,{...v,tooltip:(0,Qf.wY)(h),onClick:()=>Oa.Z.onCommand(this.context.vivaldiWindowId,"COMMAND_MAIL_COMPOSER_CHOOSE_ATTACHMENTS"),image:Wi.UEH[i],isMenuIndicatorVisible:!1,hasPopup:!0});case"MailMsgSpam":case"MailMsgSpamRestore":return"MailMsgSpamRestore"===this.props.name?t=!0:this.props.preview&&(t=!1),(0,ss.jsx)(po.ZP,{...v,tooltip:t?(0,Qf.wY)("MailMsgSpamRestore"):(0,Qf.wY)("MailMsgSpam"),onClick:t?()=>Hf.Z.markAsNotJunk(s):()=>Hf.Z.markAsJunk(s),disabled:!this.state.messageSelected||this.state.disableJunk,image:t?Wi.och[i]:Wi.Qwh[i],imageOverride:t?"MailMsgSpamRestore":"MailMsgSpam",isMenuIndicatorVisible:!1,commandId:t?"COMMAND_MAIL_MARK_NOT_JUNK":"COMMAND_MAIL_MARK_JUNK"});case"MailMsgArchive":case"MailMsgArchiveRestore":return"MailMsgArchiveRestore"===this.props.name?n=!0:this.props.preview&&(n=!1),(0,ss.jsx)(po.ZP,{...v,tooltip:n?(0,Qf.wY)("MailMsgArchiveRestore"):(0,Qf.wY)("MailMsgArchive"),onClick:n?()=>Hf.Z.restoreFromArchive(s):()=>Hf.Z.moveToArchive(s),disabled:!this.state.messageSelected||this.state.disableArchive,image:n?Wi.RaS[i]:Wi._w1[i],imageOverride:n?"MailMsgArchiveRestore":"MailMsgArchive",isMenuIndicatorVisible:!1,commandId:n?"COMMAND_MAIL_RESTORE_FROM_ARCHIVE":"COMMAND_MAIL_MOVE_TO_ARCHIVE"});case"MailMsgShowHeaders":return(0,ss.jsx)(po.ZP,{...v,tooltip:(0,Qf.wY)(h),isMenuIndicatorVisible:!1,image:Wi.x6W[this.props.size],menu:()=>Gf.getItems(bv,"composer")});case"MailCompose":return(0,ss.jsx)(po.ZP,{...v,tooltip:(0,Qf.wY)(h),isMenuIndicatorVisible:!1,image:Wi.XTV[this.props.size],onClick:Qt.Z.createDraft.bind(null,void 0),commandId:"COMMAND_MAIL_COMPOSE_NEW_MESSAGE"});case"MailUndo":return(0,ss.jsx)(mv,{...v,popupPosition:this.props.popupPosition});default:return console.warn(`ToolbarButton “${this.props.name}” not found`),null}}}const Cv=(0,Bu.Z)(wv,Sv);var Av=n(16875);const Iv=(0,v.vV)({blockedPageContents:[],blockedPopups:new Set,navigationInfo:{canGoBack:!1,canGoForward:!1,isLoading:!1,reason:void 0,trigger:"stop"},permissionInfo:new Map,sslInfo:{state:"none",issuer:void 0}},!0);class Tv extends m.Z{getInitialState(){return new Map}getStateForTab(e){return this.getState().get(e)??Iv}getNavigationInfo(e){return this.getStateForTab(e).navigationInfo}getSSLInfo(e){return this.getStateForTab(e).sslInfo}getBlockedPopupsById(e){return this.getStateForTab(e).blockedPopups}getPermissionsById(e){return this.getStateForTab(e).permissionInfo}getblockedPageContents(e){return this.getStateForTab(e).blockedPageContents}reduce(e,t){switch(t.actionType){case"CHROME_TABS_REMOVED":return(0,cr.u4)(e,t.tabId);case"NAVIGATION_SET_STATE":return function(e,t,n){return Zv(e,t,"navigationInfo",(e=>{Object.assign(e,n)}))}(e,t.pageId,t.navigationState);case"PAGE_SET_SSL_STATE":return function(e,t,n){return Zv(e,t,"sslInfo",(e=>{Object.assign(e,n)}))}(e,t.pageId,t.info);case"NAVIGATION_ADD_POPUP":return function(e,t,n){return Zv(e,t,"blockedPopups",(e=>{e.add(n)}))}(e,t.pageId,t.popupEvent);case"NAVIGATION_REMOVE_POPUP":return function(e,t,n){return Zv(e,t,"blockedPopups",(e=>{e.forEach((t=>{t.targetUrl===n&&e.delete(t)}))}))}(e,t.pageId,t.targetUrl);case"NAVIGATION_RESET_BLOCKED_POPUPS":return function(e,t){return Zv(e,t,"blockedPopups",(e=>{e.forEach((t=>{e.clear()}))}))}(e,t.pageId);case"NAVIGATION_SET_PERMISSION":return function(e,t,n,i,s,o,a,r){return Zv(e,t,"permissionInfo",(e=>{switch(i){case"audiocapture":i="microphone";break;case"videocapture":i="camera"}const t=e.get(n)??new Map;e.set(n,t);const l={requestEvent:s,state:o,promptPermission:a,suppressedPrompt:r};t.set(i,l)}))}(e,t.pageId,t.origin,t.permission,t.requestEvent,t.state,t.promptPermission,t.suppressedPrompt);case"NAVIGATION_RESET_PERMISSIONS":return function(e,t){return Zv(e,t,"permissionInfo",(e=>{e.clear()}))}(e,t.pageId);case"NAVIGATION_SET_BLOCKED_CONTENT":return function(e,t,n){return Zv(e,t,"blockedPageContents",(e=>{e.push(n)}))}(e,t.pageId,t.contentType);case"NAVIGATION_RESET_BLOCKED_CONTENT":return function(e,t){return Zv(e,t,"blockedPageContents",(e=>{e.length=0}))}(e,t.pageId);default:return e}}}function Zv(e,t,n,i){const s=e.get(t)??Iv,o=(0,v.Uy)(s[n],i);return s[n]===o?e:new Map(e).set(t,{...s,[n]:o})}const Ev=new Tv;var kv=n(69046);class _v extends Li.PureComponent{static contextType=ts.Z;constructor(e,t){super(e);const n=Ce.ZP.unsafeGetActivePage(t.vivaldiWindowId);this.state={activePageId:n.id,isInternalPage:pn.jk.isInternalPage(n),navigationInfo:Ev.getNavigationInfo(n.id),pageHistoryIndex:-1,...this.getFastForwardStoreState(n.id)}}_isMounted=!1;componentDidMount(){const{selectWindow:e}=this.context;this._isMounted=!0,this.props.inEditor||("FastForward"!==this.props.name&&"Rewind"!==this.props.name||Av.Z.addListener(this.fastForwardStoreChanged),Ev.addListener(this.navigationStoreChanged,(e=>e.get(this.state.activePageId)?.navigationInfo)),Ce.ZP.addListener(this.pageStoreChanged,e))}componentDidUpdate(e,t){e.name!==this.props.name&&console.error("NavButton: Can't reuse component for a different button")}componentWillUnmount(){this._isMounted=!1,this.props.inEditor||("FastForward"!==this.props.name&&"Rewind"!==this.props.name||Av.Z.removeListener(this.fastForwardStoreChanged),Ev.removeListener(this.navigationStoreChanged),Ce.ZP.removeListener(this.pageStoreChanged))}fastForwardStoreChanged=()=>{this.setState((e=>this.getFastForwardStoreState(e.activePageId)))};getFastForwardStoreState=e=>({forwardUrl:Av.Z.getFastForwardUrl(e),rewindRelativeIndex:Av.Z.getRewindRelativeIndex(e)});navigationStoreChanged=()=>{this.setState((e=>({navigationInfo:Ev.getNavigationInfo(e.activePageId)})))};pageStoreChanged=()=>{if(!this._isMounted)return;const e=Ce.ZP.unsafeGetActivePage(this.context.vivaldiWindowId),t=pn.jk.isInternalPage(e)&&!e.url.startsWith(pn.jk.internals.startpage);e.id!==this.state.activePageId?this.setState({activePageId:e.id,isInternalPage:t,navigationInfo:Ev.getNavigationInfo(e.id),...this.getFastForwardStoreState(e.id)}):t!==this.state.isInternalPage&&this.setState({isInternalPage:t})};reload=({shiftKey:e})=>{this.state.navigationInfo&&(this.state.navigationInfo.isLoading?af.Z.stop(this.context.vivaldiWindowId,this.state.activePageId):af.Z.reload(this.context.vivaldiWindowId,this.state.activePageId,e))};cloneSelectedTabs=()=>{Ce.ZP.isSelecting(this.context.vivaldiWindowId)?c.ZP.clonePages(Ce.ZP.getSelectedPages(this.context.vivaldiWindowId)):c.ZP.clonePages(ze.aV.of(Ce.ZP.unsafeGetActivePage(this.context.vivaldiWindowId)))};back=e=>{af.Z.back(this.context.vivaldiWindowId,this.state.activePageId)};backInBackground=()=>{this.openURLFromHistory(-1)};forward=()=>{af.Z.forward(this.context.vivaldiWindowId,this.state.activePageId)};forwardInBackground=()=>{this.openURLFromHistory(1)};isSubstripVisible(e){return"substrip"===C.Z.get(I.kTabsStackingMode)&&(!!C.Z.get(I.kTabsStackingSubstripLocked)||Ce.ZP.getGroup(e,this.context.vivaldiWindowId).size>1)}openURLFromHistory=e=>{const t=this.context.vivaldiWindowId;af.Z.getPageHistory(t,this.state.activePageId,((n,i)=>{const s=n+e;if(s>=0||s<i.length){const e=Ce.ZP.getPageInWindow(t,this.state.activePageId),n=e?(0,kv.av)(e):null;c.ZP.openURL(t,i[s].url,{inCurrent:!1,inBackground:!0,transition:se.Z.historyPrivate.TransitionType.RELOAD,groupId:n&&this.isSubstripVisible(n)?n:void 0})}}))};rewind=()=>{af.Z.go(this.context.vivaldiWindowId,this.state.activePageId,-1*this.state.rewindRelativeIndex)};rewindInBackground=()=>{const e=this.context.vivaldiWindowId;if(this.state.rewindRelativeIndex>0){const t=Ce.ZP.getActivePage(e);if(t){const n=Av.Z.getRewindHistory(t);n.length>0&&c.ZP.openURL(e,n[0].url,{inBackground:!0,transition:se.Z.historyPrivate.TransitionType.RELOAD})}}};goHome=e=>{c.ZP.showHomepage(this.context.vivaldiWindowId,{inCurrent:!e.shiftKey})};goHomeInNewTab=()=>{c.ZP.showHomepage(this.context.vivaldiWindowId,{inCurrent:!1})};getHistory=()=>new Promise((e=>af.Z.getPageHistory(this.context.vivaldiWindowId,this.state.activePageId,((t,n)=>this.setState({pageHistoryIndex:t},(()=>e(n)))))));_onHistorySelection=(e,t,n,i)=>{const{ctrlKey:s,shiftKey:o,altKey:a,metaKey:r}=n,l=void 0===i?0:i,d=this.context.vivaldiWindowId;if(t&&(s||o||a||r||0!==l)){const e=(0,La.ZP)(d,{button:l,ctrlKey:Boolean(s),altKey:Boolean(a),shiftKey:Boolean(o),metaKey:Boolean(r)});c.ZP.openURL(d,t,{...e})}else af.Z.go(d,this.state.activePageId,e-this.state.pageHistoryIndex)};getHistoryMenuPromise=e=>()=>this.getHistory().then((t=>{const n="backward"===e?t.slice(0,this.state.pageHistoryIndex).reverse():t.slice(this.state.pageHistoryIndex+1),i="backward"===e?(e,t)=>e-t-1:(e,t)=>e+t+1;return n.map(((e,t)=>{let n=e.name;return pn.jk.isInternalUrl(n)&&(n=pn.jk.getDisplayTitleByUrl(n,"")),{...Qe.Z.makeNumberMnemonic(n,t),url:e.url,handler:n=>{this._onHistorySelection(i(this.state.pageHistoryIndex,t),e.url,n.keyState,n.button)}}}))}));getContextMenuPromise=e=>{const t=this.context.vivaldiWindowId,n=ji.Z.getOptionFunction(e);return ji.Z.getNamedMenu(t,e,(async e=>{switch(e.action){case"CONTEXT_CONTAINER_CUSTOMIZE_TOOLBAR":return{items:this.props.customizeMenu?.(this.props.name),...n(t,e,{})};case"CONTEXT_CONTAINER_FORWARD_HISTORY":return this.getHistoryMenuPromise("forward")().then((i=>({items:i,...n(t,e,{})})));case"CONTEXT_CONTAINER_BACKWARD_HISTORY":return this.getHistoryMenuPromise("backward")().then((i=>({items:i,...n(t,e,{})})));default:return{...n(t,e,{})}}}))};getbackwardbuttonContextMenu=()=>this.getContextMenuPromise("backwardbutton");getforwardbuttonContextMenu=()=>this.getContextMenuPromise("forwardbutton");getrewindbuttonContextMenu=()=>this.getContextMenuPromise("rewindbutton");getfastforwardbuttonContextMenu=()=>this.getContextMenuPromise("fastforwardbutton");getreloadbuttonContextMenu=()=>this.getContextMenuPromise("reloadbutton");gethomebuttonContextMenu=()=>this.getContextMenuPromise("homebutton");render(){const{isInternalPage:e,navigationInfo:t}=this.state,n=this.context.vivaldiWindowId,{draggable:i,onDragStart:s,onDragEnd:o,onDrop:a,onDragEnter:r,mimeType:l,name:d,menuOrigin:c,size:u}=this.props,p={draggable:i,onDragStart:s,onDragEnd:o,onDrop:a,onDragEnter:r,mimeType:l,name:d,menuOrigin:c,size:u};switch(this.props.name){case"Back":return(0,ss.jsx)(po.ZP,{...p,disabled:!t||!t.canGoBack,onClick:this.back,onMiddleClick:this.backInBackground,modifier:"ctrlCmd",label:(0,B.Z)("Previous Page"),tooltip:(0,B.Z)("Go to previous page"),tooltipExtra:(0,B.Z)("Hold for history list"),menu:this.getbackwardbuttonContextMenu,alwaysMenu:!0,image:Wi.mgF[this.props.size],commandId:"COMMAND_PAGE_BACK"});case"Forward":return(0,ss.jsx)(po.ZP,{...p,disabled:!t||!t.canGoForward,onClick:this.forward,onMiddleClick:this.forwardInBackground,modifier:"ctrlCmd",label:(0,B.Z)("Next Page"),tooltip:(0,B.Z)("Go to next page"),tooltipExtra:(0,B.Z)("Hold for forward history list"),menu:this.getforwardbuttonContextMenu,alwaysMenu:!0,image:Wi.Zu[this.props.size],commandId:"COMMAND_PAGE_FORWARD"});case"Rewind":return(0,ss.jsx)(po.ZP,{...p,className:"button-narrow",disabled:!(Number.isInteger(this.state.rewindRelativeIndex)&&this.state.rewindRelativeIndex>0),onClick:this.rewind,onMiddleClick:this.rewindInBackground,label:(0,B.Z)("verb","Rewind"),tooltip:"Rewind by visited domain",tooltipExtra:(0,B.Z)("Hold for history domain list"),menu:this.getrewindbuttonContextMenu,alwaysMenu:!0,image:Wi.jtA[this.props.size],commandId:"COMMAND_PAGE_REWIND"});case"FastForward":return(0,ss.jsx)(po.ZP,{...p,className:"button-narrow",label:(0,B.Z)("verb","Fast Forward"),tooltip:this.state.forwardUrl?(0,B.Z)("Fast Forward - $1",[this.state.forwardUrl]):(0,B.Z)("Fast Forward"),onClick:()=>_e.Z.navigateFastforward(n),disabled:!this.state.forwardUrl,menu:this.getfastforwardbuttonContextMenu,alwaysMenu:!0,image:Wi.Wmx[this.props.size],commandId:"COMMAND_PAGE_FAST_FORWARD"});case"Reload":case"Stop":case"COMMAND_PAGE_REFRESH":const i=!!t&&t.isLoading;return(0,ss.jsx)(po.ZP,{...p,disabled:e,menu:this.getreloadbuttonContextMenu,alwaysMenu:!0,label:i&&!e?(0,B.Z)("verb","Stop"):(0,B.Z)("verb","Reload"),tooltip:i&&!e?(0,B.Z)("verb","Stop"):(0,B.Z)("Reload current page"),onClick:this.reload,onMiddleClick:this.cloneSelectedTabs,image:i&&!e||"Stop"===this.props.name?Wi.YVA[this.props.size]:Wi.GO5[this.props.size],imageOverride:i&&!e||"Stop"===this.props.name?"Stop":"Reload",commandId:i&&!e?"COMMAND_STOP_PAGE":"COMMAND_PAGE_REFRESH"});case"Home":case"COMMAND_SHOW_HOMEPAGE":return(0,ss.jsx)(po.ZP,{...p,label:(0,B.Z)("noun","Homepage"),tooltip:(0,B.Z)("Go to homepage"),menu:this.gethomebuttonContextMenu,alwaysMenu:!0,onClick:this.goHome,onMiddleClick:this.goHomeInNewTab,image:Wi.PaK[this.props.size],commandId:"COMMAND_SHOW_HOMEPAGE"});default:return null}}}const Nv=_v;var Pv=n(57049),Dv=n(751);class Mv extends Li.PureComponent{static contextType=ts.Z;#L=!1;#R=!1;#B=this.props.autocompleteValue;#F=!1;inputField=Li.createRef();componentDidMount(){this.context.addEventListener("drop",this.windowDropHandler)}componentDidUnMount(){this.context.removeEventListener("drop",this.windowDropHandler)}componentDidUpdate(e){if((e.autocompleteValue!==this.props.autocompleteValue||e.typedValue!==this.props.typedValue)&&this.inputField.current){const e=this.inputField.current,{selectionStart:t,selectionEnd:n}=this.#F&&this.props.autocompleteValue===this.props.typedValue?e:function(e,t){if(!e||!t)return{selectionStart:-1,selectionEnd:-1};const n=t.length,i=e.length;return n===i?{selectionStart:-1,selectionEnd:-1}:e.toLowerCase().startsWith(t.toLowerCase())?{selectionStart:n,selectionEnd:i}:{selectionStart:-1,selectionEnd:-1}}(this.props.autocompleteValue,this.props.typedValue);this.props.navigationMode||-1===t||(e.selectionStart!==t&&(e.selectionStart=t,t!==n&&(e.selectionDirection="backward")),e.selectionEnd!==n&&(e.selectionEnd=n))}}setSelection=(e,t="none")=>{const n=this.inputField.current;n&&n.setSelectionRange(e.selectionStart,e.selectionEnd,t)};onValueChange=e=>{this.props.onValueChange(e)};onKeyPress=e=>{this.props.onKeyPress(e),this.props.typedValue+e.key===e.currentTarget.value&&this.onValueChange(e.currentTarget.value)};onChange=e=>{const{currentTarget:t,nativeEvent:n}=e;let i;this.#F="historyUndo"===n?.inputType,i=this.#L&&this.#R&&!1!==this.props.readOnlyDnD?this.#B:t.value,this.onValueChange(i??"")};onDragStart=e=>{this.#L=!0,this.props.onDragStart(e)};windowDropHandler=e=>{this.#R=this.#L,this.#B=this.props.autocompleteValue};onDragEnd=e=>{this.#L=!1,this.#R=!1,this.props.onDragEnd(e)};render(){return(0,ss.jsx)("input",{id:this.props.inputId??Dv.IY,ref:this.inputField,value:this.props.autocompleteValue,autoComplete:"off",spellCheck:"false",type:"text",autoFocus:this.props.autoFocus,className:this.props.className,disabled:this.props.disabled,placeholder:this.props.placeholder,title:this.props.title,readOnly:this.props.readOnly,onChange:this.onChange,onKeyPress:this.onKeyPress,onBlur:this.props.onBlur,onFocus:this.props.onFocus,onSelect:this.props.onSelect,onCompositionStart:this.props.onCompositionStart,onCompositionUpdate:this.props.onCompositionUpdate,onCompositionEnd:this.props.onCompositionEnd,onClick:this.props.onClick,onContextMenu:this.props.onClick,onDragStart:this.onDragStart,onDragEnter:this.props.onDragEnter,onDragOver:this.props.onDragOver,onDragLeave:this.props.onDragLeave,onDragEnd:this.onDragEnd,onDrop:this.props.onDrop,onMouseDown:this.props.onMouseDown,onMouseUp:this.props.onMouseUp,onKeyDown:this.props.onKeyDown,onCut:this.props.onCut,onCopy:this.props.onCopy,onPaste:this.props.onPaste})}}var Ov=n(67975);const xv=Object.freeze({selectedItem:void 0,autocompleteValue:"",typedUrl:void 0});class Lv extends m.Z{getInitialState(){return new Map}getUrlfieldState(e){return this.getState().get(e)??xv}reduce(e,t){switch(t.actionType){case"CHROME_TABS_REMOVED":case"URLFIELD_RESET":{const n=void 0===t.tabId?t.pageId:t.tabId;return void 0===n?this.getInitialState():(0,cr.u4)(e,n)}case"URLFIELD_UPDATE_STATE":return(0,cr.cR)(e,t.pageId,(e=>{Object.assign(e,t.state)}),xv);case"PAGE_CLOSE":{const n=t.pages;return n.some((t=>e.has(t.id)))&&(e=new Map(e),n.forEach((t=>e.delete(t.id)))),e}}return e}}const Rv=new Lv;class Bv extends Li.PureComponent{static contextType=ts.Z;context;#W=!1;#U=!1;#V=!1;_shouldAutocompleteValue=!0;refUrlInput=Li.createRef();get isIMEOpen(){return this.#U}componentDidUpdate(e){e.displayUrl!==this.props.displayUrl&&(this._shouldAutocompleteValue=!1),e.autocompleteValue!==this.props.autocompleteValue&&(this.props.autocompleteValue?this._shouldAutocompleteValue&&this.props.onAutocompleteValueChange(this.props.autocompleteValue):this._shouldAutocompleteValue=!1)}_makeSubmit=e=>{const t={ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,metaKey:e.metaKey};this._shouldAutocompleteValue=!1,this.props.onSubmit(t)};onKeyDown=e=>{if(this.props.onKeyDown(e),"Escape"===e.key&&(this._shouldAutocompleteValue=!1),"Enter"===e.key&&(e.altKey||e.ctrlKey||e.metaKey))return this._makeSubmit(e),void(this._shouldAutocompleteValue=!1);"Backspace"===e.key&&this.#U&&(this.#W=!0)};onKeyPress=e=>{this.props.onKeyPress(e),"Enter"!==e.key&&13!==e.which||e.altKey||e.ctrlKey||this._makeSubmit(e)};onValueChange=e=>{const{autocompleteValue:t}=Rv.getUrlfieldState(this.props.pageId),n=this.props.typedUrl,i=e===this.props.displayUrl?void 0:e;Ov.Z.updateState(this.props.pageId,{typedUrl:i});const s=e.endsWith(" "),o=!this.props.navigationMode&&void 0!==i&&(void 0===n||i.length>n.length),a=this.props.navigationMode&&Boolean(t)&&e.length>=t.length,r=n&&i&&n.length>i.length,l=!(this.#U||s||this.#V||r);this._shouldAutocompleteValue=l&&(o||a),this.#V=!1,this.props.onValueChange(e)};onSelect=e=>{this.props.onSelect(e)};onCompositionStart=()=>{this.#U=!0};onCompositionUpdate=()=>{this.#U=!0};onCompositionEnd=e=>{const t=e.currentTarget.value,n=this.props.typedUrl??this.props.displayUrl;this._shouldAutocompleteValue=!this.#W&&t.length>=n.length,this.#W=!1,this.#U=!1};onCut=e=>{this._shouldAutocompleteValue=!1,this.props.onCut(e)};onPaste=e=>{this.#V=!0,this.props.onPaste(e)};render(){const{typedUrl:e,displayUrl:t}=this.props;return(0,ss.jsx)(Mv,{ref:this.refUrlInput,autocompleteValue:this.props.autocompleteValue,typedValue:e??t,autoFocus:this.props.autoFocus,className:this.props.className,disabled:this.props.disabled,placeholder:this.props.placeholder,title:this.props.title,readOnly:this.props.readOnly,readOnlyDnD:this.props.readOnlyDnD,inputId:this.props.inputId,navigationMode:this.props.navigationMode,onBlur:this.props.onBlur,onFocus:this.props.onFocus,onSelect:this.onSelect,onCompositionStart:this.onCompositionStart,onCompositionUpdate:this.onCompositionUpdate,onCompositionEnd:this.onCompositionEnd,onClick:this.props.onClick,onContextMenu:this.props.onClick,onDragStart:this.props.onDragStart,onDragEnter:this.props.onDragEnter,onDragOver:this.props.onDragOver,onDragLeave:this.props.onDragLeave,onDragEnd:this.props.onDragEnd,onDrop:this.props.onDrop,onMouseDown:this.props.onMouseDown,onMouseUp:this.props.onMouseUp,onCut:this.onCut,onCopy:this.props.onCopy,onPaste:this.onPaste,onKeyDown:this.onKeyDown,onValueChange:this.onValueChange,onKeyPress:this.onKeyPress})}}var Fv=n(74117);const Wv=function(e){return e.length>=32e3};var Uv;function Vv(e,t,n,i){Uv||(Uv="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Uv,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Hv=function(e,t,n,i){if(Wv(e)||Wv(t)||t.startsWith("data:"))return t;const s=e.toLowerCase().split(" ");let o;try{o=new RegExp((n?"\\b":"")+"("+s.map((e=>(0,Fv.Z)(e.toLowerCase()))).filter((e=>e.trim().length>0)).join("|")+")","i")}catch(e){return t}let a=t.split(o);const r=e.toLowerCase(),l=a.findIndex((e=>e.toLowerCase()===r));if(n&&-1!==l){const e=a.slice(0,l).join(""),t=a.slice(l+1).join("");a=[e,a[l],t]}return Vv("span",{className:i},void 0,a.reduce(((e,t,i)=>(!n||l===i)&&o.test(t)?e.concat(Vv("b",{},i,t)):e.concat(Vv("span",{},i,t))),[]))};var Gv;function $v(e,t,n,i){Gv||(Gv="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Gv,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Kv="omni_option_";function zv(e,t,n){return e?t?Hv(t,e,!0,n):$v("span",{className:n},void 0,e):""}var jv=$v("span",{},void 0,"-");const Yv=Li.forwardRef(((e,t)=>{if("function"==typeof t)throw Error("Callback refs not supported");const n=Li.useContext(ts.Z),i=(0,Li.useRef)(!1),s=(0,Li.useRef)(null),o=t??s;(0,Li.useEffect)((()=>{function t(t){const n=o.current;e.isHighlighted&&n&&(0,ps.Z)(t)&&n.classList.add("modifier-pressed")}function i(){o.current?.classList.remove("modifier-pressed")}return e.item.hasTabMatch&&(n.document.addEventListener("keydown",t),n.document.addEventListener("keyup",i)),()=>{n.document.removeEventListener("keydown",t),n.document.removeEventListener("keyup",i)}}),[n.document,e.isHighlighted,e.item,o]),(0,Li.useEffect)((()=>{!i.current&&e.isHighlighted&&o.current?.scrollIntoViewIfNeeded(),i.current=e.isHighlighted}),[e.isHighlighted,o]);const{item:a,displayText:r,index:l,isHighlighted:d,onMouseOver:c,pattern:u,displayUrl:p,badge:h,isOnlyTextCategory:g,faviconUrl:m}=e,f=Fi()({"omni-clickable":!0,OmniLinkItem:!0,"OmniLinkItem--Highlighted":d,"OmniLinkItem--TabSwitch":a.hasTabMatch,"OmniLinkItem--DisplayTextOnly-CanDelete":g&&a.deletable,"OmniLinkItem--DisplayTextOnly-NoDelete":g&&!a.deletable});return(0,ss.jsxs)("li",{"data-index":l,"data-url":p||"",ref:o,className:f,onClick:t=>{const{item:n}=e;e.onClick(n,t)},onMouseUp:t=>{const{item:n}=e;t.button===es.Z.kCenter&&e.onMiddleClick(n)},onMouseOver:c,role:"option","aria-selected":d,id:Kv+l,children:[m&&$v("div",{className:"OmniLinkItem-Favicon"},void 0,(()=>{const{faviconUrl:t,faviconType:n}=e;return t?$v(Ri.ZP,{url:t,loadType:"url"===n?"faviconSkipCache":"img"===n?"faviconFromCache":"page"}):null})()),$v("div",{className:"OmniLinkItem-DisplayText"},void 0,zv(r,u,"displayTitle"),r&&p&&jv,zv(p,u,"displayUrl")),a.hasTabMatch&&!e.fromSearchField&&$v("span",{className:"OmniLinkItem-TabSwitchLabel",dangerouslySetInnerHTML:{__html:Wi.P$T+(0,B.Z)("Switch to this tab")}}),h&&$v("span",{className:"OmniLinkItem-Badge"},void 0,h),a.deletable&&$v("span",{className:"OmniLinkItem-EraseButton",title:(0,B.Z)("Delete history item"),onClick:t=>{if(!e.onDelete)return;const{item:n}=e;e.onDelete(n),t.stopPropagation()},dangerouslySetInnerHTML:{__html:Wi.kze}})]})})),Xv=Li.memo(Yv);var Qv;function qv(e,t,n,i){Qv||(Qv="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Qv,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Jv=[I.kAddressBarShowSearchSuggestionsWarning,I.kSearchSuggestEnabled];function ey(){return-1===C.Z.get(I.kAddressBarShowSearchSuggestionsWarning)}function ty(){const e=Li.useContext(ts.Z),t=(0,Ya.Z)(Jv),n=t[I.kAddressBarShowSearchSuggestionsWarning];return-1!==n&&n>=0&&n<2&&!t[I.kSearchSuggestEnabled]&&(0,Dv.RT)(e)&&ai.Z.getDefault(!1)?.suggestUrl?qv("div",{className:"search-suggestion-warning"},void 0,qv("button",{className:"close",dangerouslySetInnerHTML:{__html:Wi.kze},onClick:()=>{w.Z.set(I.kAddressBarShowSearchSuggestionsWarning,-1),(0,Dv.x0)(e)}}),qv("h2",{},void 0,(0,B.Z)("Opt-In To Get Search Suggestions")),qv("p",{className:"faded-text"},void 0,(0,B.Z)("Share what you type into this field with search providers to see suggested searches.")),qv("p",{className:"faded-text"},void 0,(0,B.Z)("Disabled by default to protect your privacy.")),qv("label",{className:"checkbox-container"},void 0,qv("input",{type:"checkbox",checked:t[I.kSearchSuggestEnabled],onChange:()=>{w.Z.set(I.kSearchSuggestEnabled,!0),(0,Dv.x0)(e)}}),qv("p",{},void 0,(0,B.Z)("Enable Search Suggestions")))):null}const ny=Li.memo(ty);var iy,sy=n(52250),oy=n(2004);function ay(e,t,n){oy.Z.go(t,[e],{...n,transition:se.Z.historyPrivate.TransitionType.GENERATED})}function ry(e,t){return function(e){const t=document.createElement("canvas").getContext("2d");return t.font="13px system-ui, -apple-system, HelveticaNeue, sans-serif",t.measureText(e).width}(e.description)<t/1.5?e.description:e.contents}function ly(e){return new Promise((t=>{se.Z.omniboxPrivate.onOmniboxResultChanged.addListener((function e(n){se.Z.omniboxPrivate.onOmniboxResultChanged.removeListener(e);const{combinedResults:i}=n,s=i.filter((e=>""!==e.destinationUrl));t(s)})),se.Z.omniboxPrivate.startOmnibox(e)}))}function dy(e){return"direct-match"===e.category}function cy(e){return"history"===e.category}function uy(e){return"search"===e.category}function py(e,t,n,i){iy||(iy="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:iy,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function hy(e,t,n){return"typedText"===e||(0,is.Z)(t[e],n[e])}var gy=py(ny,{});class my extends Li.Component{static contextType=ts.Z;nodeRef=Li.createRef();state={searchEngineKeyword:"",searchEngineName:""};static getDerivedStateFromProps(e){const t=(e.typedSearchEngine||e.defaultSearchEngine||{name:""}).name;return{searchEngineKeyword:!e.typedSearchEngine&&e.defaultSearchEngine&&e.defaultSearchEngine.keyword&&e.defaultSearchEngine.keyword+" "||"",searchEngineName:t}}shouldComponentUpdate(e,t){return!(0,ns.Z)(this.props,e,hy)||!(0,ns.Z)(this.state,t)}getNode(){return this.nodeRef.current}handleClickOutside=()=>{this.props.onMenuClosed?.()};onLinkItemClicked=(e,t)=>{const n={ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,button:t.button};this.props.onLinkItemClicked(e,(0,La.ZP)(this.context.vivaldiWindowId,n))};onDeleteItem=e=>{this.props.onDeleteItem(e)};onLinkItemMiddleClicked=e=>{const t=La.ke.openInBackgroundTab;this.props.onLinkItemClicked(e,t)};getBadge=e=>{const t=function(e){switch(e.category){case"search":return(0,B.Z)("verb","Search");case"history":return(0,B.Z)("History");case"search-suggestion":return(0,B.Z)("Search Suggestion");case"direct-match":return(0,B.Z)("Direct Match");case"bookmark":return(0,B.Z)("Bookmark");case"nickname":return(0,B.Z)("Nickname");case"open-tab":return(0,B.Z)("Open Tab");case"top-sites":return(0,B.Z)("Top Sites");case"clipboard":return(0,B.Z)("Clipboard");case"calculator":return(0,B.Z)("Calculator");default:return""}}(e);return this.props.fromSearchField?dy(e)?t:"":e.hasTabMatch?"":t};getDisplayText=e=>uy(e)?e.contents:dy(e)&&this.props.getOffsetWidth?ry(e,this.props.getOffsetWidth()):e.description;getDisplayUrl=e=>this.props.fromSearchField||dy(e)?"":uy(e)?e.description:e.contents;getHighlightText=e=>(this.props.fromSearchField||uy(e))&&e.inlineAutocompletion.length>0?e.inlineAutocompletion:this.props.typedText;renderLinkItem=(e,t)=>{const n=t===this.props.selectionIndex,i=void 0!==this.props.autocompleteHighlight&&this.props.autocompleteHighlight===e.destinationUrl&&-1===this.props.selectionIndex,s=this.getDisplayText(e),o=this.getDisplayUrl(e),a=this.getHighlightText(e);return py(Xv,{item:e,index:t,displayText:s,displayUrl:o,pattern:a,isOnlyTextCategory:!1,isHighlighted:n||i,badge:this.getBadge(e),onClick:this.onLinkItemClicked,onMiddleClick:this.onLinkItemMiddleClicked,onDelete:e.deletable?this.onDeleteItem:null,hideIcons:Boolean(this.props.hideIcons),faviconUrl:void 0,faviconType:void 0,fromSearchField:this.props.fromSearchField},e.providerName+"-"+e.destinationUrl)};render(){const{items:e}=this.props;return(0,ss.jsxs)("div",{ref:this.nodeRef,className:"OmniDropdown",children:[gy,py("ul",{className:"OmniDropdown-Collection",role:"listbox","aria-activedescendant":Kv+this.props.selectionIndex,id:this.props.id},void 0,e.map(((e,t)=>this.renderLinkItem(e,t))))]})}}const fy=(0,sy.Z)(my);var vy;function yy(e,t,n,i){vy||(vy="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:vy,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var by=yy("bdo",{},void 0,"."),Sy=yy("bdo",{},void 0,"."),wy=yy("bdo",{},void 0,":"),Cy=yy("bdo",{},void 0,":");class Ay extends Li.Component{static contextType=ts.Z;refComponent=Li.createRef();componentDidMount(){if(!this.refComponent.current)return;const e=this.refComponent.current;this._intersectionObserver=new IntersectionObserver((([e])=>{this.onIntersectionChange(e.intersectionRatio)}),{threshold:1}),this._intersectionObserver.observe(e)}componentWillUnmount=()=>{this.props.onBaseDomainObscured(!1),this._intersectionObserver?.disconnect()};onIntersectionChange=e=>{const t=e<1;this.props.onBaseDomainObscured(t)};renderBdoSubDomain=e=>-1===e.indexOf(".")?(0,ss.jsxs)(ss.Fragment,{children:[yy("bdi",{},void 0,e),by]}):e.split(".").map(((e,t)=>yy("span",{},t,yy("bdi",{},void 0,e),Sy)));render(){const{urlFragment:e,onGoToPath:t,tld:n,basedomain:i,subdomain:s,port:o,scheme:a}=this.props,r=(a?`${a}://`:"")+(e||"")+(o?`:${o}`:""),l=this.context.vivaldiWindowId,d=function(e,t){let n=0;for(let i=e.lastIndexOf(t)-1;i>0&&"."===e[i];i--)n++;return n}(r,n||"");return yy(ky,{windowId:l,url:r,rawDisplay:this.props.rawDisplay,onGoToPath:t},void 0,i?(0,ss.jsxs)("span",{ref:this.refComponent,children:[s&&yy("span",{className:"UrlFragment--Lowlight UrlFragment-HostFragment-Subdomain"},void 0,this.renderBdoSubDomain(s)),yy("span",{className:"UrlFragment--Highlight UrlFragment-HostFragment-Basedomain"},void 0,yy("bdi",{},void 0,i)),n&&yy("span",{className:"UrlFragment--Highlight UrlFragment-HostFragment-TLD"},void 0,yy("bdo",{},void 0,".".repeat(d)),yy("bdi",{},void 0,n)),o&&yy("span",{className:"UrlFragment--Lowlight UrlFragment-HostFragment-Port"},void 0,Cy,yy("bdi",{},void 0,o))]}):(0,ss.jsxs)("span",{ref:this.refComponent,children:[yy("span",{className:"UrlFragment--Highlight"},void 0,e),o&&yy("span",{className:"UrlFragment--Lowlight"},void 0,wy,o)]}))}}var Iy,Ty=n(50503),Zy=n(10373);function Ey(e,t,n,i){Iy||(Iy="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Iy,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function ky({windowId:e,url:t,className:n,children:i,onGoToPath:s,rawDisplay:o}){return Ey("span",{className:Fi()(n,{"UrlFragment-Link":!o}),onClick:()=>s(t),onMouseOver:()=>!o&&u.Z.setStatus(e,t),onMouseOut:()=>!o&&u.Z.clearStatus(e)},void 0,i)}var _y=Ey("bdo",{},void 0,"/");function Ny({windowId:e,urlFragment:t,onGoToPath:n,host:i,scheme:s,port:o,rawDisplay:a,shouldDisplayPostfix:r}){return t?t.split("/").slice(1).map(((t,l,d)=>{if(!t&&r)return null;const c=(s?`${s}://`:"")+(i||"")+(o?`:${o}`:"")+"/"+d.slice(0,l+1).join("/");return Ey(ky,{windowId:e,className:"UrlFragment--Lowlight",rawDisplay:a,onGoToPath:n,url:c},c,_y,Ey("bdi",{},void 0,t))})):null}var Py=Ey("bdo",{},void 0,"&"),Dy=Ey("bdo",{},void 0,"=");function My({urlFragment:e}){if(!e)return null;return e.split("&").map(((e,t)=>{const n=e.split("="),i=n[0];n.shift();const s=n.join("="),o=n.length>0;return Ey("span",{},i,0!==t&&Py,i&&Ey("bdi",{},void 0,i),o&&Dy,s&&Ey("bdi",{},void 0,s))}))}var Oy=Ey("bdo",{},void 0,"/"),xy=Ey("bdo",{},void 0,"?"),Ly=Ey("bdo",{},void 0,"#");function Ry({urlFragment:e,path:t}){if(!e)return null;const n=e.indexOf("#"),i=-1!==n?e.substring(n+1,e.length):"",s="?"===e.charAt(0)?e.substring(1,-1===n?e.length:n):"";return Ey("span",{className:"UrlFragment--Lowlight"},void 0,(!t||"/"===t||"/"===t.slice(-1))&&Oy,s&&(0,ss.jsxs)(ss.Fragment,{children:[xy,Ey(My,{urlFragment:s})]}),i&&(0,ss.jsxs)(ss.Fragment,{children:[Ly,Ey("bdi",{},void 0,i)]}))}var By=Ey("bdo",{},void 0,"://");function Fy({urlFragment:e}){return Ey("span",{className:"UrlFragment--Lowlight"},void 0,Ey("bdi",{},void 0,e),By)}var Wy=Ey("span",{className:"UrlFragment--Highlight"},void 0,"data:");function Uy({urlFragment:e}){return e?(0,ss.jsxs)(ss.Fragment,{children:[Wy,Ey("span",{className:"UrlFragment--Lowlight"},void 0,e.substring("data:".length,p.RL))]}):null}function Vy({windowId:e,displayUrl:t,shouldShowFullUrl:n,onGoToPath:i,shouldHighlightBaseDomain:s,onBaseDomainObscured:o,urlFragments:a,rawDisplay:r}){const l=function(){const{selectWindow:e,vivaldiWindowId:t}=Li.useContext(ts.Z),[n,i]=Li.useState(!1);return Li.useEffect((()=>{function n(e,n,s,o){e===t&&o===xa.Z.KEY_CONTROL&&i(n)}function s(){i(!1)}return se.Z.tabsPrivate.onKeyboardChanged.addListener(n),he.ZP.addListener(s,e),()=>{se.Z.tabsPrivate.onKeyboardChanged.removeListener(n),he.ZP.removeListener(s)}}),[e,t]),n}();if(!t)return null;const d=t;if(!["http","https","ftp","data"].includes(d.substring(0,d.indexOf(":"))))return Ey("div",{className:Fi()({"UrlFragment-Wrapper":!r})},void 0,Ey("span",{className:"UrlFragment--Highlight"},void 0,t.substring(0,p.RL)));const{schema:c}=(0,Zy.C)(t);if("data:"===c)return Ey("div",{className:Fi()({"UrlFragment-Wrapper":!r,"UrlFragment-Wrapper--ShouldHighlight":s})},void 0,Ey(Uy,{urlFragment:d}),";");const u=function(e){return(e.scheme?.length||0)+(e.username?.length||0)+(e.password?.length||0)+(e.host?.length||0)+(e.path?.length||0)+(e.ref?.length||0)+(e.query?.length||0)+(e.port?.length||0)+(e.tld?.length||0)>=p.RL}(a);if(u)return Ey("div",{className:Fi()({"UrlFragment-Wrapper":!r})},void 0,Ey("span",{className:"UrlFragment--Highlight"},void 0,t.substring(0,p.RL)));const{host:h,tld:g,port:m,scheme:f,path:v,query:y,ref:b}=a,S=("string"==typeof y?`?${y}`:"")+("string"==typeof b?`#${b}`:""),{subdomain:w,basedomain:C,hostTld:A}=(0,Ty.gC)(h,g)||{subdomain:"",basedomain:"",hostTld:""},I=n&&S.length>0;return Ey("div",{className:Fi()("UrlFragments",{"UrlFragment-Wrapper":!r,"UrlFragment-Wrapper--Clickable":!r&&l,"UrlFragment-Wrapper--ShouldHighlight":!r&&s})},void 0,n&&f&&Ey(Fy,{urlFragment:f}),Ey("span",{className:"UrlFragment-LinkWrapper"},void 0,Ey(Ay,{urlFragment:h,scheme:f||"",tld:0!==A.length?A:g,port:m,basedomain:C,subdomain:w,rawDisplay:r,onGoToPath:i,onBaseDomainObscured:e=>o&&o(e)}),(n||!n&&"/"!==v)&&Ey(Ny,{windowId:e,urlFragment:v,onGoToPath:i,host:h,port:a.port,scheme:f||"",rawDisplay:r,shouldDisplayPostfix:I})),I&&Ey(Ry,{urlFragment:S,path:v}))}var Hy=n(68079),Gy=n.n(Hy),$y=n(94595);async function Ky(e,t){const n=Ce.ZP.findRecentPageInAllWindows((t=>t.url===e.destinationUrl));if(!n||n.url.length>2048)return;const i=n.vivExtData?.workspaceId,s=n.windowId,o=Ce.ZP.getActivePage(t);o&&(0,pn.Rf)(o.url)&&await c.ZP.closePage(o,{bypassConfirm:!0,forceClosePinned:!1}),s!==t&&await xi.Z.focus(s),await c.ZP.setActiveWorkspace(s,i),c.ZP.activateTab(n.id,s)}var zy,jy=n(34155);function Yy(e,t,n,i){zy||(zy="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:zy,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Xy=!1,Qy="text/plain",qy=[I.kAddressBarAutocompleteSuffixExpansionValue,I.kAddressBarAutocompleteSuffixExpansionEnabled,I.kAddressBarInlineSearchEnabled,I.kSearchSuggestEnabled,I.kAddressBarInlineSearchSuggestOnNickname,I.kAddressBarOmniboxCutcopyEncoded,I.kAddressBarOmniboxEnabled,I.kAddressBarSelectOnClick,I.kAddressBarShowFullUrl,I.kAddressBarUrlOpenShortcut,I.kAddressBarStripJavascriptOnPaste,I.kAddressBarHighlightBaseDomain,I.kAddressBarAutocompleteEnabled,I.kAddressBarShowSearchSuggestionsWarning],Jy=/\r\n|\r|\n/g;function eb(e){return e.dropdownSelectionIndex>0}function tb(e){return{isOmniDropdownOpen:!1,dropdownSelectionIndex:0,value:"",pageId:e,omniboxResults:[]}}class nb extends Li.PureComponent{static contextType=ts.Z;#m=!1;#H=!1;#G=!1;#$=-1;#K="";#z=!1;#j=!1;#Y=0;#X=!1;#Q=!1;_omniDropdownElement=Li.createRef();_urlInput=Li.createRef();state=tb(this.props.pageId);static defaultProps={urlFragments:(0,Ty.kG)()};setUrlfieldState=e=>{Ov.Z.updateState(this.props.pageId,e)};componentDidMount(){this.#m=!0}componentWillUnmount(){this.#m=!1,this._tearDownComponentEventListeners()}static getDerivedStateFromProps(e,t){const n=e.typedUrl??e.displayUrl;if(e.pageId!==t.pageId)return{pageId:e.pageId,value:n};if(e.selectedItem&&eb(t)){return{value:e.selectedItem?.destinationUrl||""}}return{value:n}}blur(){(0,Dv.gR)(this.context,this.props.inputId)}updateDropdown(){if(!this.#H&&this.props.showDropdown){if(!this.props.prefValues[I.kAddressBarOmniboxEnabled])return;if(!this.props.pageContext.isUrlFieldFocused)return;this.#G=!0,this.setState({isOmniDropdownOpen:!0})}}onClick=async e=>{if(!this.props.prefValues[I.kAddressBarSelectOnClick])return;const{button:t,currentTarget:n}=e,{selectionStart:i,selectionEnd:s,value:o}=n;if(0===t&&Date.now()-this.#Y<350)return;this.#Y=Date.now();const a=0===i&&s===o.length;if(i===s||a){if(this.isUrlInputFocusedOnMouseDown())return void this.handleInputSelect(n);0===t&&await new Promise((e=>jy.nextTick(e))),n.select(),this._focusedOnMouseDown=null}};onMouseDown=e=>{this._focusedOnMouseDown=this.context.document.activeElement,1===e.buttons&&0===this.state.dropdownSelectionIndex&&this.validateAutocomplete(e)};onValueChange=(e,t=-1)=>{const{dropdownSelectionIndex:n}=this.state,i=e.endsWith(" ");this.#X||this.state.value.length>=e.length&&this.state.value!==this.props.displayUrl||i||this.#j?(this.#Q=!0,this.setUrlfieldState({selectedItem:void 0,autocompleteValue:""})):this.#Q=!1;const{autocompleteValue:s}=Rv.getUrlfieldState(this.props.pageId);s.startsWith(e)||this.setUrlfieldState({selectedItem:void 0});const o=!!this.props.prefValues[I.kAddressBarAutocompleteEnabled]&&s.toLowerCase().startsWith(e.toLowerCase());this.#X=!1,this.setState({dropdownSelectionIndex:o&&!this.#j?n:0},(()=>{e&&-1!==t&&this._urlInput.current?.refUrlInput.current?.setSelection({selectionStart:t,selectionEnd:t})})),e?this.performSearch(e):this.hideDropdown()};onAutocompleteValueChange=e=>{this.setUrlfieldState({autocompleteValue:e})};handleInputSelect=e=>{this.#G?this.#G=!1:""!==e.value.trim()&&"none"===e.selectionDirection&&(e.selectionDirection="forward")};onSelected=e=>{const{currentTarget:t,nativeEvent:n}=e;"mouseup"!==n.type&&this.handleInputSelect(t)};_handleUndo=e=>{const t=e.currentTarget,{value:n,dropdownSelectionIndex:i}=this.state,{selectedItem:s}=this.props;if(0!==i)return e.preventDefault(),this.revertUrl(""),void this.hideDropdown();const{selectionStart:o,selectionEnd:a}=e.currentTarget;if(o!==a&&a===t.value.length&&s){e.preventDefault();const t=o-1;if(t>0){const e=n.substring(0,t);this.setUrlfieldState({typedUrl:e}),this.performSearch(e)}else this.setUrlfieldState({typedUrl:"",selectedItem:void 0}),this.setState({omniboxResults:[]}),this.hideDropdown()}""!==n||Ce.ZP.isActiveInternal(this.context.vivaldiWindowId)||(e.preventDefault(),this.revertUrl())};_cleanupState=()=>{this.#z=!1};_searchDropdownItems=async(e,t)=>{if(-1!==this.#$&&this.#$===e)return void(this.#K=t);this.#$=e;const n=()=>{if(this.#K){this.#$=-1;const t=this.#K;return this.#K="",this.props.pageId===e&&this._searchDropdownItems(this.props.pageId,t),!0}return!1};try{if(this._cleanupState(),this.updateDropdown(),this.#j=!1,!this.#m)return;if(n())return;const e=await ly(t);if(n())return;this.#$=-1,this.setUrlfieldState({selectedItem:e[0]}),this.setState({omniboxResults:e,dropdownSelectionIndex:0})}catch(e){throw n()||(this.#$=-1),e}};performSearch=e=>{""===e.trim()||Wv(e)||!this.props.prefValues[I.kAddressBarAutocompleteEnabled]&&!this.props.prefValues[I.kAddressBarOmniboxEnabled]||(this.#H=!1,this._searchDropdownItems(this.props.pageId,e))};revertUrl=e=>{if(!this.#m)return;this.setUrlfieldState({typedUrl:e,autocompleteValue:"",selectedItem:void 0});const{value:t}=tb(this.props.pageId);this.setState({value:t})};_onEscPressed=()=>{if(this._urlInput.current?.isIMEOpen)return;this.hideDropdown();const{displayUrl:e,typedUrl:t}=this.props;"string"==typeof t&&t!==e?(this.revertUrl(),(0,Dv.i6)(this.context,this.props.inputId)):(this.blur(),ne.Z.executeActions("shortcut",this.context,"COMMAND_FOCUS_WEBVIEW"))};hideDropdown=e=>{this.setState({isOmniDropdownOpen:!1,dropdownSelectionIndex:0},e)};onPaste=e=>{const{clipboardData:t}=e,n=t.getData(Qy);n.trim()||e.preventDefault();const{value:i}=this.state,s=this.context.document.activeElement?.classList.toString()===e.currentTarget?.classList.toString()?e.currentTarget.selectionStart:0,o=e.currentTarget.selectionEnd,a=(0,Zy.i)(i,n,s,o);if(C.Z.get(I.kAddressBarStripJavascriptOnPaste)&&(0,$y.M)(a)){e.preventDefault();const t=(0,$y.Z)({textToStrip:n,caretPosition:s,selectionEnd:o,currentValue:i}),a=n.length-n.indexOf(":")-1;return this.setUrlfieldState({typedUrl:t}),void this.onValueChange(t,a)}if(Jy.test(n)){e.preventDefault();const t=n.replace(Jy,""),a=(0,Zy.i)(i,t,s,o);return this.setUrlfieldState({typedUrl:a}),void this.onValueChange(a,s+t.length)}this.#j=!0,this.setUrlfieldState({selectedItem:void 0})};onClipboardEvent=e=>{const{clipboardData:t,type:n,currentTarget:i}=e,{HTMLInputElement:s}=this.context;if(!(i instanceof s&&t))return;if(0!==i.selectionStart||i.selectionEnd!==i.value.length)return;let o=i.value;i.selectionEnd&&i.selectionEnd!==i.value.length&&(o=i.value.substring(0,i.selectionEnd));const a=this.props.displayUrl!==o;if(this.props.prefValues[I.kAddressBarOmniboxCutcopyEncoded]&&!a){const e=(0,Ty.dO)(o).host??"";o=encodeURI(o).replace(/%25/g,"%");const t=encodeURI(e),n=o.indexOf(t);o=o.slice(0,n)+e+o.slice(n+t.length)}if(o.length>=p.RL&&o.endsWith("...")&&this.props.displayUrl.startsWith(o.substring(0,p.RL))&&(o=this.props.displayUrl),(0,rl.Zj)(o)&&/[\.\/]/.test(o)&&this.state.value===this.props.displayUrl){const e=(0,ge.Z)(this.props.displayUrl);if(e?.protocol){o=(rl.JQ.find((t=>t.startsWith(e.protocol)))||e.protocol)+o}}if(t.setData("text",o),"cut"===n){const e=i.value.slice(i.selectionEnd);this.setUrlfieldState({typedUrl:e}),i.setSelectionRange(0,0),this.setUrlfieldState({selectedItem:void 0})}e.preventDefault()};validateAutocomplete=({currentTarget:e})=>{const t=e.value===this.props.displayUrl?void 0:e.value;t!==this.props.typedUrl&&(this.setUrlfieldState({typedUrl:t,selectedItem:void 0}),t&&this.performSearch(t))};_shortcutListener=(e,t,n,i)=>{if(t&&i===xa.Z.KEY_ESCAPE)this._onEscPressed()};_setUpComponentEventListeners=()=>{se.Z.tabsPrivate.onKeyboardChanged.addListener(this._shortcutListener)};_tearDownComponentEventListeners=()=>{se.Z.tabsPrivate.onKeyboardChanged.removeListener(this._shortcutListener)};onFocus=e=>{this.props.pageContext.isUrlFieldFocused=!0,this.props.onFocus&&this.props.onFocus(e),this.props.showDropdown&&this._setUpComponentEventListeners()};onBlur=e=>{this.props.pageContext.isUrlFieldFocused=!1;const{document:t,getSelection:n,Element:i}=this.context,s=n();s&&s.focusNode instanceof i&&s.focusNode.classList.contains("UrlField")&&s.removeAllRanges(),this.props.onBlur&&this.props.onBlur(),this.props.showDropdown&&this._tearDownComponentEventListeners(),jy.nextTick((()=>{t.activeElement?.classList.contains("uifocusstop")||de.Z.setPaneFocus(this.context.vivaldiWindowId,!1)}))};moveNavigation=e=>{this.setState((t=>{const{dropdownSelectionIndex:n,omniboxResults:i}=t;let s=n;switch(e){case"up":s=0===n?i.length-1:n-1;break;case"down":s=n===i.length-1?0:n+1;break;case"top":s=0;break;case"bottom":s=i.length-1}return this.setUrlfieldState({selectedItem:i[s]}),{dropdownSelectionIndex:s}}))};onKeyDown=e=>{if(!this._urlInput.current?.isIMEOpen){if(this.state.isOmniDropdownOpen)switch(e.key){case"Escape":e.preventDefault(),e.stopPropagation();break;case"ArrowUp":e.preventDefault(),e.stopPropagation(),this.moveNavigation("up");break;case"Tab":(0,As.VV)(e)?(e.preventDefault(),e.stopPropagation(),this.moveNavigation("down")):(0,As.Mr)(e)&&(e.preventDefault(),e.stopPropagation(),this.moveNavigation("up"));break;case"ArrowDown":e.preventDefault(),e.stopPropagation(),this.moveNavigation("down");break;case"PageUp":this.moveNavigation("top");break;case"PageDown":this.moveNavigation("bottom");break;case"Delete":const{selectedItem:t}=this.props;(0,As.Mr)(e)&&t&&(e.preventDefault(),this._deleteHistoryItem(t))}switch(e.key){case"ArrowRight":case"ArrowLeft":case"End":case"Home":this.validateAutocomplete(e);break;case"z":!e.shiftKey&&e.ctrlKey&&this._handleUndo(e);break;case"Backspace":case"Delete":const t=(0,As.Np)(e)||Xy;((0,As.VV)(e)||t)&&this.state.value.length>0&&(this.#X=!0)}}};_urlFieldGo=async(e,t)=>{this.props.onSubmit&&""!==e&&(this.cleanupUrl(e),await(this.props.onSubmit?.({url:e,...t?{options:t}:null})),this.#H=!0)};onKeyPress=e=>{this.props.onKeyPress&&this.props.onKeyPress(e)};onDragStart=e=>{if((0,dp.W$)(e))return;const{getSelection:t}=this.context;this.#z=!0;const n=t();n&&e.currentTarget.value===n.toString()&&Gy()(e.currentTarget.value)&&this.props.onUrlDrag?.(e)};onDragEnd=()=>{this.#z=!1};onDragEnter=e=>{if(e.stopPropagation(),!this.#z&&this.isDropAllowed(e)){e.preventDefault();const t=e.currentTarget,{HTMLInputElement:n}=this.context;t instanceof n&&t.classList.add("pseudo-selected")}};onDragOver=e=>{this.isDropAllowed(e)&&e.preventDefault()};onDragLeave=e=>{if(this.#z)return;const t=e.target,{HTMLInputElement:n}=this.context;t instanceof n&&t.classList.remove("pseudo-selected")};onDrop=e=>{if(!this.isDropAllowed(e))return;const t=e.target,{HTMLInputElement:n}=this.context;if(t instanceof n&&t.classList.remove("pseudo-selected"),"function"==typeof this.props.onDrop)this.#z||(this.props.onDrop(e),e.stopPropagation(),e.preventDefault());else if(this.props.handleDrop){e.stopPropagation(),e.preventDefault();let t="";const n=e.dataTransfer?zi.ZP.extractUriListFromEvent(e):"";if(n.length>0){const e=n.split("\n");e.length>0&&(t=e[0])}else t=e.dataTransfer?e.dataTransfer.getData(Qy):"";this.setUrlfieldState({typedUrl:t}),(0,Dv.x0)(this.context,this.props.inputId)}};isDropAllowed=e=>{if(!e?.dataTransfer||e.dataTransfer.types.includes("vivaldi/x-button-toolbar"))return!1;return e.dataTransfer.types.some((e=>e===zi.yR||e===Qy||zi.ZP.isUriListType(e)))};onOmniDropdownItemClicked=(e,t)=>{this.revertUrl(),this.blur();const n=this.context.vivaldiWindowId;e.destinationUrl&&(uy(e)&&!(0,rl.C3)(e.destinationUrl)?oy.Z.goSearchUrl(n,e.destinationUrl,{...t,incognito:t.incognito||he.ZP.isGuest()}):dy(e)?ay(e.destinationUrl,n,{...t,incognito:t.incognito||he.ZP.isGuest()}):e.hasTabMatch?Ky(e,n):oy.Z.go(n,[e.destinationUrl],{...t,enableSearch:!0})),this.hideDropdown()};_deleteHistoryItem=e=>{const{typedUrl:t}=this.props;i.Z.history.deleteUrl({url:e.destinationUrl}).then((()=>{t&&jy.nextTick((()=>{this.performSearch(t)}))}))};onOmniDropdownItemDelete=e=>{cy(e)||uy(e)?this._deleteHistoryItem(e):dy(e)&&se.Z.directMatch.hide(e.destinationUrl).then((()=>{const{typedUrl:e}=this.props;e&&jy.nextTick((()=>{this.performSearch(e)}))}))};isUrlInputFocusedOnMouseDown=()=>{if(!this._urlInput.current)return!1;const e=this._urlInput.current?.refUrlInput.current?.inputField.current;return e===this._focusedOnMouseDown};componentDidUpdate(e,t){if(this.props.pageId!==e.pageId&&this._cleanupState(),this.props.displayUrl&&this.props.displayUrl!==e.displayUrl&&void 0===this.props.typedUrl){const e=this._urlInput?.current?.refUrlInput?.current,t=e?.inputField?.current;e&&t&&e.setSelection({selectionStart:0,selectionEnd:t.value.length},"forward")}}renderDropdown=e=>this.props.prefValues[I.kAddressBarOmniboxEnabled]&&this.state.isOmniDropdownOpen?(0,ss.jsx)(fy,{ref:this._omniDropdownElement,onLinkItemClicked:this.onOmniDropdownItemClicked,items:e,selectionIndex:this.state.dropdownSelectionIndex,typedSearchEngine:this.props.typedSearchEngine,defaultSearchEngine:this.props.defaultSearchEngine,onDeleteItem:this.onOmniDropdownItemDelete,typedText:this.props.typedUrl??"",onMenuClosed:this.hideDropdown,outsideClickIgnoreClass:"UrlField",fromSearchField:!1,getOffsetWidth:this.props.getOffsetWidth}):null;updateSearchSuggestionWarning(){ey()||w.Z.set(I.kAddressBarShowSearchSuggestionsWarning,this.props.prefValues[I.kAddressBarShowSearchSuggestionsWarning]+1)}runBookmark=(e,t,n,i)=>{const{transition:s,fromUrlField:o,...a}=i;a.allowOverride=!1,zi.ZP.open(e,[n],a,!1),this.cleanupUrl(t),this.#H=!0};handleSubmit=async e=>{const{selectedItem:t}=this.props,n=this.context.vivaldiWindowId,i=this.props.typedUrl??this.props.displayUrl,s=e.shiftKey&&"shift"===this.props.prefValues[I.kAddressBarUrlOpenShortcut]||e.altKey&&"alt"===this.props.prefValues[I.kAddressBarUrlOpenShortcut]||Xy,o=s&&e.ctrlKey,a={...(0,La.ZP)(n,{ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,metaKey:e.metaKey}),inCurrent:!s,inBackground:o,transition:se.Z.historyPrivate.TransitionType.GENERATED,fromUrlField:!0,incognito:he.ZP.isIncognitoOrGuest(n)};if(this.updateSearchSuggestionWarning(),-1!==this.#$){if(g.Z.hasNickname(i)){const e=g.Z.getNicknamed(i,!0)[0];return void(e&&this.runBookmark(n,i,e,a))}if((0,rl.C3)(i))return this.cleanupUrl(i),a.transition=se.Z.historyPrivate.TransitionType.TYPED,void await this._urlFieldGo(i,a)}if(e.ctrlKey&&this.props.prefValues[I.kAddressBarAutocompleteSuffixExpansionEnabled]&&this.props.prefValues[I.kAddressBarAutocompleteSuffixExpansionValue])await this._urlFieldGo((0,rl.Ei)(i,this.props.prefValues[I.kAddressBarAutocompleteSuffixExpansionValue]),a);else{if(t){if(a.transition=t.transition,t.hasTabMatch&&!s&&!o)return Ky(t,n),void this.cleanupUrl(this.props.displayUrl);const e="nickname"===t.category,r=function(e){return"bookmark"===e.category}(t),l=e?g.Z.getNicknamed(t.fillIntoEdit,!0)[0]:g.Z.getItemByUrl(t.destinationUrl);if(e||r)return void(l?this.runBookmark(n,i,l,a):(a.transition=se.Z.historyPrivate.TransitionType.AUTO_BOOKMARK,await this._urlFieldGo(t.destinationUrl,a)));this.cleanupUrl(t.destinationUrl);const d=uy(t),c=(0,rl.C3)(i);return d&&!c?void oy.Z.goSearchUrl(n,t.fillIntoEdit,{inBackground:a.inBackground,inCurrent:a.inCurrent,inNewWindow:a.inNewWindow,incognito:a.incognito||he.ZP.isGuest(),allowOverride:a.allowOverride,transition:a.transition,fromUrlField:!0}):((d&&c||cy(t))&&(a.transition=se.Z.historyPrivate.TransitionType.TYPED),dy(t)?(ay(t.destinationUrl,n,a),void(this.#H=!0)):void await this._urlFieldGo(t.destinationUrl,a))}i===this.props.displayUrl&&(a.transition=se.Z.historyPrivate.TransitionType.RELOAD),await this._urlFieldGo(i,a)}};cleanupUrl=e=>{this.revertUrl(e),this.blur(),this.hideDropdown()};onMouseUp=e=>{const{getSelection:t}=this.context,{button:n,currentTarget:i}=e};getAutocompleteValue=(e,t)=>{const{typedUrl:n}=this.props,{dropdownSelectionIndex:i,value:s}=this.state;if(e){if(n&&e.allowedToBeDefaultMatch&&0===i){const{autocompleteValue:i}=Rv.getUrlfieldState(this.props.pageId);if(t){return n+(-1!==this.#$&&i.toLowerCase().startsWith(s.toLowerCase())?e.inlineAutocompletion.slice(1):e.inlineAutocompletion)}return n}return e.fillIntoEdit}return n??s};render(){const{omniboxResults:e}=this.state,{typedUrl:t}=this.props,n=t&&t.length>0?e:[],i=n,s=this.props.prefValues[I.kAddressBarShowFullUrl],o=this.props.prefValues[I.kAddressBarHighlightBaseDomain],a=this.props.urlFragments?(0,Ty.gG)(this.props.urlFragments):void 0,r=eb(this.state),l=Rv.getUrlfieldState(this.props.pageId).selectedItem,d=this.getAutocompleteValue(l,this.props.autocompletionEnabled&&(this._urlInput.current?._shouldAutocompleteValue??!0)),c=t&&t.length>0;return(0,ss.jsxs)(ss.Fragment,{children:[Yy("div",{className:Fi()("UrlField",{"UrlField--HasEditText":Boolean(t),"UrlField--IsEmpty":""===this.state.value})},void 0,(0,ss.jsx)(Bv,{ref:this._urlInput,autoFocus:this.props.autoFocus,className:this.props.className||"",displayUrl:this.props.displayUrl,typedUrl:this.props.typedUrl,onSubmit:this.handleSubmit,autocompleteData:i,autocompleteValue:d,onValueChange:this.onValueChange,onAutocompleteValueChange:this.onAutocompleteValueChange,disabled:this.props.disabled?this.props.disabled:void 0,placeholder:this.props.placeholder?this.props.placeholder:void 0,title:this.props.title?this.props.title:void 0,pageId:this.props.pageId,readOnly:this.props.readonly,isOmniDropdownOpen:this.state.isOmniDropdownOpen,inputId:this.props.inputId,navigationMode:r,onBlur:this.onBlur,onFocus:this.onFocus,onSelect:this.onSelected,onClick:this.onClick,onContextMenu:this.onClick,onDragStart:this.onDragStart,onDragEnter:this.onDragEnter,onDragOver:this.onDragOver,onDragLeave:this.onDragLeave,onDragEnd:this.onDragEnd,onDrop:this.onDrop,onKeyPress:this.onKeyPress,onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onKeyDown:this.onKeyDown,onCut:this.onClipboardEvent,onCopy:this.onClipboardEvent,onPaste:this.onPaste}),a&&!c&&Yy(Vy,{windowId:this.context.vivaldiWindowId,urlFragments:a,displayUrl:this.props.displayUrl,shouldShowFullUrl:s,onGoToPath:this._urlFieldGo,onBaseDomainObscured:this.props.onBaseDomainObscured,shouldHighlightBaseDomain:o,rawDisplay:!1})),this.renderDropdown(n)]})}}const ib=(0,Bu.Z)(nb,qy);const sb=new class{updateState(e,t){A.Z.dispatch({actionType:"URLFIELD_UPDATE_STATE_DEPRECATED",pageId:e,state:t})}reset(e){A.Z.dispatch({actionType:"URLFIELD_RESET",pageId:e})}},ob=Object.freeze({selectedItem:void 0,autocompleteValue:"",typedUrl:void 0});class ab extends m.Z{getInitialState(){return new Map}getUrlfieldState(e){return this.getState().get(e)??ob}reduce(e,t){switch(t.actionType){case"CHROME_TABS_REMOVED":case"URLFIELD_RESET":{const n=void 0===t.tabId?t.pageId:t.tabId;return void 0===n?this.getInitialState():(0,cr.u4)(e,n)}case"URLFIELD_UPDATE_STATE_DEPRECATED":return(0,cr.cR)(e,t.pageId,(e=>{Object.assign(e,t.state)}),ob);case"PAGE_CLOSE":{const n=t.pages;return n.some((t=>e.has(t.id)))&&(e=new Map(e),n.forEach((t=>e.delete(t.id)))),e}}return e}}const rb=new ab;const lb=function(e,t){return 0===(t=t.replace(/^https?\:\/\/(www+\.)?/,"")).indexOf(e)};function db({nickname:e,children:t,url:n,title:i,description:s},o){const a=o.join(" ");let r=[];return o[0].startsWith("data:")||(r=o.map((e=>new RegExp((0,Fv.Z)(e),"i")))),function(e,t){return!(!t||!e)&&t.toLowerCase().startsWith(e.toLowerCase())}(a,e)?t?"OMNI_RESULT_FOLDER_NICKNAME":"OMNI_RESULT_BOOKMARK_NICKNAME":t||"string"!=typeof n?void 0:lb(a,n)||cb(a,n)?"OMNI_RESULT_BOOKMARK_URL_HOST":i&&i.toLowerCase().startsWith(a.toLowerCase())?"OMNI_RESULT_BOOKMARK_TITLE_EXACT":n&&r.every((e=>n.match(e)))?n.endsWith("/")?"OMNI_RESULT_BOOKMARK_PROMOTED":"OMNI_RESULT_BOOKMARK_URL":i&&r.every((e=>i.match(e)))?"OMNI_RESULT_BOOKMARK_TITLE":s&&r.every((e=>s.match(e)))?"OMNI_RESULT_BOOKMARK_DESCRIPTION":void 0}function cb(e,t){return 0===(t=t.replace("https://vivaldi.com/bk/","")).indexOf("sd-")&&(t=t.replace("sd-","")),0===t.indexOf(e)}function ub(e,t){let n;switch(e){case"OMNI_RESULT_FOLDER_NICKNAME":case"OMNI_RESULT_BOOKMARK_NICKNAME":n=500;break;case"OMNI_RESULT_BOOKMARK_TITLE_EXACT":n=400;break;case"OMNI_RESULT_BOOKMARK_URL_HOST":n=300;break;case"OMNI_RESULT_BOOKMARK_TITLE":n=200;break;case"OMNI_RESULT_BOOKMARK_PROMOTED":n=100;break;default:n=0}const i=(0,rl.Df)(t),s=t.slice(i,t.length).length;return n+(s>=100||0===s?0:100-s)}class pb{search=e=>{const t={bookmarkResults:[],nicknameResults:[]};if(!e)return Promise.resolve(t);const n=e.startsWith("data:")?[]:e.replace(/\s+/g," ").split(" ");return 0===n.length?Promise.resolve(t):function(e){const t=[],n=[],i=C.Z.get(I.kAddressBarOmniboxNumberOfBookmarkResults),s=C.Z.get(I.kAddressBarOmniboxNumberOfBookmarkResults),o=C.Z.get(I.kAddressBarOmniboxShowBookmarks),a=e.join("");for(const r of g.Z.iterateTree()){const l=db(r,e);if(!l)continue;const{id:d,title:c,nickname:u,description:p}=r,h=ub(l,r.url??"");if(g.Z.isBookmark(r)&&r.url){const e=pn.jk.getDisplayUrlFromMapping(r.url);if("OMNI_RESULT_BOOKMARK_NICKNAME"===l&&n.length<s){const t={id:d,title:c,nickname:u,description:"",url:e,type:l,score:h,isDeleteDisabled:!0,faviconType:e?"favicon":"img",faviconUrl:e??"/resources/folder@2x.png"};n.push(t)}else if(o){if((0,rl.xl)(e)&&!a.startsWith("vivaldi:"))continue;const n={id:d,title:c,nickname:u,description:p,url:e,type:l,score:h,isDeleteDisabled:!0,faviconType:"favicon",faviconUrl:e};let s=Ot()(t,h,(function(e,t){return t-e.score}));s=s>=0?s:-s-1,s<i&&(t.splice(s,0,n),t.length>i&&t.pop())}}else if("OMNI_RESULT_FOLDER_NICKNAME"===l&&n.length<s){const e={id:d,title:c,nickname:u,description:"",url:c,type:l,score:h,isDeleteDisabled:!0,faviconType:"img",faviconUrl:"/resources/folder@2x.png"};n.push(e)}}return Promise.resolve({bookmarkResults:t,nicknameResults:n})}(n)}}function hb(e){return"OMNI_RESULT_BOOKMARK_NICKNAME"===e.type||gb(e)}function gb(e){return"OMNI_RESULT_FOLDER_NICKNAME"===e.type}function mb(e){return hb(e)||"OMNI_RESULT_BOOKMARK_DESCRIPTION"===e.type||"OMNI_RESULT_BOOKMARK_NICKNAME"===e.type||"OMNI_RESULT_FOLDER_NICKNAME"===e.type||"OMNI_RESULT_BOOKMARK_PROMOTED"===e.type||"OMNI_RESULT_BOOKMARK_TITLE"===e.type||"OMNI_RESULT_BOOKMARK_TITLE_EXACT"===e.type||"OMNI_RESULT_BOOKMARK_UNKNOWN"===e.type||"OMNI_RESULT_BOOKMARK_URL"===e.type||"OMNI_RESULT_BOOKMARK_URL_HOST"===e.type}function fb(e){return"OMNI_RESULT_HISTORY_URL"===e.type||"OMNI_RESULT_HISTORY_PROMOTED"===e.type||"OMNI_RESULT_HISTORY_TITLE"===e.type}function vb(e){return"OMNI_RESULT_TYPED_HISTORY"===e.type}function yb(e){return"OMNI_RESULT_DIRECT_MATCH"===e.type}function bb(e){return"OMNI_RESULT_SYNCED_TABS"===e.type}function Sb(e){return"OMNI_RESULT_SUGGEST"===e.type}function wb(e){return"OMNI_RESULT_OPEN_TAB"===e.type}function Cb(e){return"OMNI_TYPE_SEARCH"===e.type}function Ab(e){return"OMNI_RESULT_TYPED_HISTORY_SEARCH"===e.type}function Ib(e){return"OMNI_DOMAIN_AUTOCOMPLETE"===e.type}function Tb(e,t,n){oy.Z.go(t,[e.url],{...n,transition:se.Z.historyPrivate.TransitionType.GENERATED})}async function Zb(e,t){if(!C.Z.get(I.kAddressBarSearchDirectMatchEnabled))return[];const n=await se.Z.directMatch.get(e);return n?[Eb(n,t)]:[]}function Eb(e,t){const n=function(e){const t=document.createElement("canvas").getContext("2d");return t.font="13px system-ui, -apple-system, HelveticaNeue, sans-serif",t.measureText(e).width}(e.title)<t/2?e.title:e.name;return{id:e.redirect_url,url:e.redirect_url,title:n,type:"OMNI_RESULT_DIRECT_MATCH",faviconUrl:e.image_path,faviconType:"url",isDeleteDisabled:!0,allowedToBeDefaultMatch:e.allowed_to_be_default_match}}function kb(e,t,n,i){return 0!==e.length&&!Wv(i)&&t&&C.Z.get(I.kAddressBarAutocompleteEnabled)?Pb(e,t,i,n)?function(e,t){const n=(new URL(e.url).origin??"")+"/";return Mb(t,n)}(t,i):function(e,t,n){if(!e||!C.Z.get(I.kAddressBarAutocompleteEnabled))return t;const{url:i}=e;if(!n){const n=e.nickname;if(n&&Nb(t,n))return _b(t,n);const s=function(e,t){const n=e.title??"";if(n&&Db(e.url,t,n)&&Nb(t,n))return _b(t,n);if(vb(e)){const i=e.text??"";return i&&Nb(t,i)?_b(t,i):n&&Nb(t,n)?_b(t,n):t}return null}(e,t);if(s)return s;const o=Mb(t,i);if(o!==t)return o;const a=e.title??"";if(a&&Nb(t,a))return _b(t,a);const r=e.text??"";return r&&Nb(t,r)?_b(t,r):t}switch(n){case"url":return Mb(t,i);case"nickname":if(e?.nickname)return _b(t,e.nickname);break;case"text":if(e?.text)return _b(t,e.text);break;case"title":if(e?.title)return _b(t,e.title)}return t}(t,i,n):i}function _b(e,t){return e+t.slice(e.length)}function Nb(e,t){return t.toLowerCase().startsWith(e.toLowerCase())}function Pb(e,t,n,i){const{origin:s,host:o}=(0,ge.Z)(t.url)??{origin:"",host:""},a=s+"/",r=o+"/",l=r.replace("www.",""),d=n.toLowerCase();return C.Z.get(I.kAddressBarAutocompleteAutocompleteOnDomainFirst)&&"url"===i&&(0,rl.K2)(t.url)&&!vb(t)&&!mb(t)&&!yb(t)&&!function(e,t){const n=e.filter((e=>yb(e))),i=(0,ge.Z)(t);return!(!n||!i)&&n.some((e=>(0,ge.Z)(e?.url)?.host===i.host))}(e,t.url)&&!(0,rl.xl)(t.url)&&!wb(t)&&(a.startsWith(d)&&d.length<=a.length||r.startsWith(d)&&d.length<=r.length||l.startsWith(d)&&d.length<=l.length)}function Db(e,t,n){const i=e?.indexOf("vivaldi.com/bk/");return"string"==typeof e&&-1!==i&&"string"==typeof n&&Nb(t,n)}function Mb(e,t){const n=e.toLowerCase(),i=(0,rl.Df)(t),s=t.toLowerCase(),o=(0,Ty.dO)(s),{host:a,path:r,tld:l,scheme:d,port:c}=o,u=(d??"")+(d?"://":"")+(a??"")+(c?":":"")+(c??""),p=s.startsWith(n)?0:s.slice(i).indexOf(n)+i;let h="";if(!(a&&u&&(0,rl.K2)(t))||n.startsWith(u)||n.startsWith(a)||r){const o=t.slice(i);if(t.includes("vivaldi.com/bk/")&&cb(e,t))return _b(e,o);if(Nb(e,o))return _b(e,o);const r=((0,Ty.gC)(a,l)?.subdomain??"")+".",d=r.length>1,c=t.slice(t.indexOf(r)+r.length);return d&&Nb(e,c)?_b(e,c):_b(e,t.slice(s.indexOf(n)))}{const n=t.slice(p+e.length,u.length);h=t.slice(0,p)+e+n+(n&&n.endsWith("/")?"":"/")}return h.slice(p)}class Ob extends Li.PureComponent{static contextType=ts.Z;context;#W=!1;#U=!1;#q="";#V=!1;_shouldAutocompleteValue=!0;get isIMEOpen(){return this.#U}refUrlInput=Li.createRef();componentDidUpdate(e){e.displayUrl!==this.props.displayUrl&&(this._shouldAutocompleteValue=!1),e.autocompleteValue!==this.props.autocompleteValue&&(this.props.autocompleteValue?this._shouldAutocompleteValue&&this.props.onAutocompleteValueChange(this.props.autocompleteValue):this._shouldAutocompleteValue=!1)}_makeSubmit=e=>{const t={ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,metaKey:e.metaKey},n=C.Z.get(I.kAddressBarOmniboxShowBestResult)&&this.props.autocompleteData[0]?this.props.autocompleteData[0].url:this.props.autocompleteValue;this._shouldAutocompleteValue=!1,this.props.onSubmit({autocompletedValue:n,typedValue:this.props.typedUrl??this.props.displayUrl},t)};onKeyDown=e=>{if(this.props.onKeyDown(e),"Escape"===e.key&&(this._shouldAutocompleteValue=!1),"Enter"===e.key&&(e.altKey||e.ctrlKey||e.metaKey))return this._makeSubmit(e),void(this._shouldAutocompleteValue=!1);"Backspace"===e.key&&this.#U&&(this.#W=!0)};onKeyPress=e=>{this.props.onKeyPress(e),"Enter"!==e.key&&13!==e.which||e.altKey||e.ctrlKey||this._makeSubmit(e)};onValueChange=e=>{const{autocompleteValue:t}=rb.getUrlfieldState(this.props.pageId),n=this.props.typedUrl,i=e===this.props.displayUrl?void 0:e;sb.updateState(this.props.pageId,{typedUrl:i});const s=e.endsWith(" "),o=!this.props.navigationMode&&void 0!==i&&(void 0===n||i.length>n.length),a=this.props.navigationMode&&Boolean(t)&&e.length>=t.length,r=n&&i&&n.length>i.length,l=!(this.#U||s||this.#V||r);this._shouldAutocompleteValue=l&&(o||a),this.#V=!1,this.props.onValueChange(e)};onSelect=e=>{const{selectionStart:t,selectionEnd:n,value:i}=e.currentTarget;this.props.onSelect(e),this.#q=i.substring(t,n)};onCompositionStart=()=>{this.#U=!0};onCompositionUpdate=()=>{this.#U=!0};onCompositionEnd=e=>{const t=e.currentTarget.value,n=this.props.typedUrl??this.props.displayUrl;this._shouldAutocompleteValue=!this.#W&&t.length>=n.length,this.#W=!1,this.#U=!1};onCut=e=>{this._shouldAutocompleteValue=!1,this.props.onCut(e)};onPaste=e=>{this.#V=!0,this.props.onPaste(e)};render(){const{typedUrl:e,displayUrl:t}=this.props;return(0,ss.jsx)(Mv,{ref:this.refUrlInput,autocompleteValue:this.props.autocompleteValue,typedValue:e??t,autoFocus:this.props.autoFocus,className:this.props.className,disabled:this.props.disabled,placeholder:this.props.placeholder,title:this.props.title,readOnly:this.props.readOnly,readOnlyDnD:this.props.readOnlyDnD,inputId:this.props.inputId,navigationMode:this.props.navigationMode,onBlur:this.props.onBlur,onFocus:this.props.onFocus,onSelect:this.onSelect,onCompositionStart:this.onCompositionStart,onCompositionUpdate:this.onCompositionUpdate,onCompositionEnd:this.onCompositionEnd,onClick:this.props.onClick,onContextMenu:this.props.onClick,onDragStart:this.props.onDragStart,onDragEnter:this.props.onDragEnter,onDragOver:this.props.onDragOver,onDragLeave:this.props.onDragLeave,onDragEnd:this.props.onDragEnd,onDrop:this.props.onDrop,onMouseDown:this.props.onMouseDown,onMouseUp:this.props.onMouseUp,onCut:this.onCut,onCopy:this.props.onCopy,onPaste:this.onPaste,onKeyDown:this.onKeyDown,onValueChange:this.onValueChange,onKeyPress:this.onKeyPress})}}class xb{search=async(e,t)=>{if(!e)return[];const n=e.replace(/\s+/g," ").trim().split(" ").slice(1);return(await se.Z.historyPrivate.getDetailedHistory(e,t.count)).map((e=>{const t=function(e,t){const n=t.map((e=>new RegExp((0,Fv.Z)(e),"i"))),{url:i,title:s}=e;return i&&n.every((e=>i.toLowerCase().match(e)))?"/"===i.charAt(i.length-1)?"OMNI_RESULT_HISTORY_PROMOTED":"OMNI_RESULT_HISTORY_URL":s&&n.every((e=>s.toLowerCase().match(e)))?"OMNI_RESULT_HISTORY_TITLE":"OMNI_RESULT_HISTORY_UNKNOWN"}(e,n);return((e,t)=>{const{id:n,title:i,typedCount:s,url:o,score:a}=e,r={type:t,id:n,score:a,title:i||"",typed:Boolean(s&&s>0),url:pn.jk.getDisplayUrlFromMapping(o||""),isDeleteDisabled:!1,faviconUrl:o,faviconType:"favicon"};return e.lastVisitTime&&(r.lastVisitTime=e.lastVisitTime),e.visitCount&&(r.visitCount=e.visitCount),r})(e,t)}))}}var Lb;function Rb(e,t,n,i){Lb||(Lb="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Lb,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Bb="omni_option_";function Fb(e,t,n){return e?t?Hv(t,e,!0,n):Rb("span",{className:n},void 0,e):""}const Wb=Li.forwardRef(((e,t)=>{if("function"==typeof t)throw Error("Callback refs not supported");const n=Li.useContext(ts.Z),i=(0,Li.useRef)(!1),s=(0,Li.useRef)(null),o=t??s;(0,Li.useEffect)((()=>{function t(t){const n=o.current;e.isHighlighted&&n&&(0,ps.Z)(t)&&n.classList.add("modifier-pressed")}function i(){o.current?.classList.remove("modifier-pressed")}return"OMNI_RESULT_OPEN_TAB"===e.type&&(n.document.addEventListener("keydown",t),n.document.addEventListener("keyup",i)),()=>{n.document.removeEventListener("keydown",t),n.document.removeEventListener("keyup",i)}}),[n.document,e.isHighlighted,e.type,o]),(0,Li.useEffect)((()=>{!i.current&&e.isHighlighted&&o.current?.scrollIntoViewIfNeeded(),i.current=e.isHighlighted}),[e.isHighlighted,o]);const{displayText:a,index:r,isHighlighted:l,onMouseOver:d,pattern:c,nickname:u,type:p,displayUrl:h,badge:g,isOnlyTextCategory:m,onDelete:f,faviconUrl:v}=e,y=Fi()({"omni-clickable":!0,OmniLinkItemDeprecated:!0,"OmniLinkItemDeprecated-NoDelete":!f,"OmniLinkItemDeprecated--Highlighted":l,"OmniLinkItemDeprecated--TabSwitch":"OMNI_RESULT_OPEN_TAB"===p,"OmniLinkItemDeprecated--DisplayTextOnly-CanDelete":m&&f,"OmniLinkItemDeprecated--DisplayTextOnly-NoDelete":m&&!f});return(0,ss.jsxs)("li",{"data-index":r,"data-url":u||h||"",ref:o,className:y,onClick:t=>{const{type:n,id:i,index:s}=e;e.onClick(n,i,s,t)},onMouseUp:t=>{const{type:n,id:i,index:s}=e;t.button===es.Z.kCenter&&e.onMiddleClick(n,i,s)},onMouseOver:d,role:"option","aria-selected":l,id:Bb+r,children:[v&&Rb("div",{className:"OmniLinkItemDeprecated-Favicon"},void 0,(()=>{const{faviconUrl:t,faviconType:n}=e;return t?Rb(Ri.ZP,{url:t,loadType:"url"===n?"faviconSkipCache":"img"===n?"faviconFromCache":"page"}):null})()),Fb(a,c,"OmniLinkItemDeprecated-DisplayText"),Fb(h,c,"OmniLinkItemDeprecated-DisplayUrl"),"OMNI_RESULT_OPEN_TAB"===p&&Rb("span",{className:"OmniLinkItemDeprecated-TabSwitchLabel",dangerouslySetInnerHTML:{__html:Wi.P$T+(0,B.Z)("Switch to this tab")}}),g&&Rb("span",{className:"OmniLinkItemDeprecated-Badge"},void 0,g),f&&Rb("span",{className:"OmniLinkItemDeprecated-EraseButton",title:(0,B.Z)("Delete history item"),onClick:t=>{if(!e.onDelete)return;const{type:n,id:i,index:s}=e;e.onDelete(n,i,s),t.stopPropagation()},dangerouslySetInnerHTML:{__html:Wi.kze}})]})})),Ub=Li.memo(Wb);var Vb;function Hb(e,t,n,i){Vb||(Vb="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Vb,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function Gb(e){return Cb(e)||Sb(e)||yb(e)||vb(e)||Ab(e)||Ib(e)}var $b=Hb(ny,{});class Kb extends Li.PureComponent{static contextType=ts.Z;nodeRef=Li.createRef();state={searchEngineKeyword:"",searchEngineName:""};static getDerivedStateFromProps(e){const t=(e.typedSearchEngine||e.defaultSearchEngine||{name:""}).name;return{searchEngineKeyword:!e.typedSearchEngine&&e.defaultSearchEngine&&e.defaultSearchEngine.keyword&&e.defaultSearchEngine.keyword+" "||"",searchEngineName:t}}getNode(){return this.nodeRef.current}handleClickOutside=()=>{this.props.onMenuClosed?.()};getNumberOfItems=()=>this.props.items.reduce(((e,{items:t})=>e+t.length),0);componentDidUpdate(e,t){const n=this.getNumberOfItems();this.props.onNumberOfSelectableItemsChanged&&this.props.onNumberOfSelectableItemsChanged(n)}onLinkItemClicked=(e,t,n,i)=>{const s={ctrlKey:i.ctrlKey,altKey:i.altKey,shiftKey:i.shiftKey,metaKey:i.metaKey,button:i.button},o=this.findLinkItem(e,t,n);o&&this.props.onLinkItemClicked(o,(0,La.ZP)(this.context.vivaldiWindowId,s))};onDeleteItem=(e,t,n)=>{const i=this.findLinkItem(e,t,n);i&&!i.isDeleteDisabled&&this.props.onDeleteItem(i)};onLinkItemMiddleClicked=(e,t,n)=>{const i=La.ke.openInBackgroundTab,s=this.findLinkItem(e,t,n);s&&this.props.onLinkItemClicked(s,i)};findLinkItem=(e,t,n)=>{const i=this.props.items.find((n=>n.items.some((n=>n.type===e&&n.id===t))))?.items[n];if(i)return i;console.error("linkItem id doesn't match",t)};getBadge=e=>yb(e)?(0,B.Z)("Direct Match"):bb(e)?(0,B.Z)(e.deviceName):"";renderLinkItem=(e,t,n,i)=>{const s=n-(i-t)===this.props.selectionIndex,o=void 0!==this.props.autocompleteHighlight&&this.props.autocompleteHighlight===e.id&&-1===this.props.selectionIndex,a=Sb(e)||Cb(e)||Ab(e),r=Gb(e),l=function(e,t){if("OMNI_RESULT_BOOKMARK_DESCRIPTION"===e.type&&e.description&&t&&(!e.url.includes(t)||!e?.title.includes(t))){const{description:n}=e,i=n.indexOf(t),s=Math.max(0,i-10);return(0!==s?"...":"")+n.slice(s)}return hb(e)&&e.nickname?e.nickname:Ib(e)?e.url:vb(e)||Ab(e)?e.text||e.url:e.title?e.title:e.text?e.text:""}(e,this.props.pattern),d=function(e){return!e.url||Gb(e)?"":e.url}(e);return Hb(Ub,{id:e.id,index:t,displayText:l,displayUrl:d,pattern:a?void 0:this.props.pattern,type:e.type,isOnlyTextCategory:r,isHighlighted:s||o,badge:this.getBadge(e),onClick:this.onLinkItemClicked,onMiddleClick:this.onLinkItemMiddleClicked,onDelete:e.isDeleteDisabled?null:this.onDeleteItem,hideIcons:Boolean(this.props.hideIcons),nickname:e.nickname||"",faviconUrl:e.faviconUrl||void 0,faviconType:e.faviconType||void 0},e.type+"-"+e.id)};renderCollection=({items:e,title:t,type:n},i)=>{if(!e||0===e.length)return null;const s=`${n}-${t||""}`;return Hb("ul",{className:"OmniDropdown-Collection",role:"listbox","aria-activedescendant":Bb+this.props.selectionIndex,id:this.props.id},s,t&&Hb("label",{className:"OmniDropdown-Label",role:"option"},void 0,(0,B.Z)(t)),e.map(((t,n)=>this.renderLinkItem(t,n,i,e.length))))};render(){const{items:e}=this.props;let t=0;return(0,ss.jsxs)("div",{ref:this.nodeRef,className:"OmniDropdown",children:[$b,e.map(((e,n)=>(t+=e.items.length,this.renderCollection(e,t))))]})}}const zb=(0,sy.Z)(Kb);function jb(e){return e.reduce(((e,t)=>{const{url:n,title:i,visitCount:s,terms:o}=t;return e.push({text:""!==o?o:void 0,url:n,title:i,visitCount:s,type:"OMNI_RESULT_TYPED_HISTORY",id:n,isDeleteDisabled:!1,faviconUrl:t.url,faviconType:"favicon"}),e}),[])}class Yb{search=async(e,t)=>{if(!e)return[];return jb(await se.Z.historyPrivate.getTypedHistory(e,t.count))}}const Xb=async e=>{const{windowId:t,query:n,searchEngine:i,typedSearchEngine:s,abortController:o}=e;if(n.length<2||he.ZP.isIncognito(t)||!i.suggestUrl)return Promise.resolve([]);const{url:a,contentType:r,postParams:l}=await se.Z.searchEngines.getSuggestRequest(i.guid,n);return new Promise((e=>{const t=""!==l,n={signal:o?.signal,headers:t?{"Content-Type":r}:void 0,method:t?"POST":"GET",body:t?l:void 0},d=setTimeout((()=>{o?.abort(),e([])}),3e3);fetch(a,n).then((async t=>{clearTimeout(d);const n=(await t.json())[1].filter((e=>"string"==typeof e));e(function(e,t,n){const i=C.Z.get(I.kAddressBarOmniboxNumberOfSearchSuggestions);return n.slice(0,i).map((n=>{const i=function(e,t){return e&&e.keyword&&!t.startsWith(e.keyword+" ")?e.keyword+" "+t:t}(t,n);return{id:n,type:"OMNI_RESULT_SUGGEST",isDeleteDisabled:!0,url:i,title:t?vS(i,t):i,faviconUrl:e?.faviconUrl??"",faviconType:"img"}}))}(i,s,n))})).catch((t=>{clearTimeout(d),"AbortError"!==t.name&&console.warn(t),e([])}))}))};var Qb=n(58379),qb=n(34155);class Jb{_numberOfSelectableItems=0;_selectionIndex=0;constructor(e){this._inputComponent=e}setNumberOfSelectableItems=e=>{this._numberOfSelectableItems=e};getNumberOfSelectableItems=()=>this._numberOfSelectableItems;setSelectionIndex=e=>{this._selectionIndex=e};getSelectionIndex=()=>this._selectionIndex;_moveHighlight=(e,t)=>{const{HTMLElement:n}=this._inputComponent.context,i=this._inputComponent.getDropdown(),s=i?.nodeRef.current;if(!(s instanceof n))return Promise.reject();let o=-1;const a=Array.from(s.getElementsByClassName("omni-clickable")),r=this.getSelectionIndex(),l=this.getNumberOfSelectableItems(),d=a[r];if(r<0||void 0===d)o=l-1;else{const n=0===r||parseInt(s.scrollTop)+10>d.offsetTop;switch(t){case"page":if(e)n?o=a.findIndex((e=>e.offsetTop+e.offsetHeight>s.offsetHeight)):(s.scrollTop=d.offsetTop,o=a.findIndex((e=>e.offsetTop>s.offsetHeight+s.scrollTop))),-1===o&&(o+=l);else if(n)s.scrollTop-=s.offsetHeight;else{let e=a.length-1;for(;e>0&&!(a[e].offsetTop-a[e].offsetHeight<s.scrollTop);e--);o=e}break;case"section":if(e){let e=this._getSectionIndex(!0,r+1,a);-1===e&&(e=this._getSectionIndex(!0,0,a)),-1!==e&&(o=e)}else{let e=this._getSectionIndex(!1,r-1,a);-1===e&&(e=this._getSectionIndex(!1,a.length-1,a)),-1!==e&&(o=e)}break;case"line":o=r+(e?1:-1),e?o>=l&&(o=0):o<0&&(o=l-1)}}return Number.isInteger(o)?(this._inputComponent.setAutocompleteHighlight(o,!0),this._setSelectedItem(i,o),new Promise((e=>{qb.nextTick(e)}))):Promise.reject()};_setSelectedItem=(e,t)=>{const n=this._inputComponent.setSelectedItem;if(!e||1===e.getNumberOfItems()||!n)return;n(e.props.items.flatMap((e=>e.items??[]))[t])};_getSectionIndex=(e,t,n)=>{if(e)for(let e=t;e<n.length;e++){if("0"===n[e].dataset.index)return e}else for(let e=t;e>=0;e--){if("0"===n[e].dataset.index)return e}return-1};up=()=>this._moveHighlight(!1,"line");down=()=>this._moveHighlight(!0,"line");pageUp=()=>this._moveHighlight(!1,"page");pageDown=()=>this._moveHighlight(!0,"page");sectionUp=()=>this._moveHighlight(!1,"section");sectionDown=()=>this._moveHighlight(!0,"section")}function eS(e,t,n){const i=e.toLowerCase(),s=function(e,t){const n=t.find((t=>t.nickname&&t.nickname===e));if(n&&C.Z.get(I.kAddressBarOmniboxShowNicknames))return{item:n,keyMatch:"nickname",override:!0,categoryTitle:(0,B.Z)("Nickname")};const i=t.find((e=>yb(e)&&e.allowedToBeDefaultMatch));return i?{item:i,keyMatch:"title",override:!0,categoryTitle:(0,B.Z)("Direct Match")}:void 0}(i,t);if(s)return s;const o=function(e,t,n){let i,s,o;t.forEach((t=>{if("OMNI_TYPE_SEARCH"===t.type||"OMNI_DIRECT_TYPED_URL"===t.type||yb(t)||Sb(t)||wb(t)||"OMNI_DOMAIN_AUTOCOMPLETE"===t.type)return;const a=iS(t,i,"nickname"),r=iS(t,s,"url"),l=iS(t,o,"title"),d=vb(t);(!i||a)&&t.nickname&&t.nickname.length>0&&Nb(e,t.nickname)&&(i=t),s&&!r||!sS(e,t)||(s=t);const c=t.title?.toLowerCase(),u=(!o||l)&&c&&Nb(e,c)&&!d,p=(!o||l)&&d&&t.text&&t.text.length>0&&Nb(e,t.text);(n&&u||p)&&(o=t)}));const a=i||s||o;let r=a?i?"nickname":s?"url":o?"title":null:null;if(a&&vb(a))return function(e,t){let n,i;if(e.forEach((e=>{!vb(e)||i&&n||(e.text&&e.text.startsWith(t)&&!i?i=e:sS(t,e)&&!n&&(n=e))})),n&&n.visitCount&&i&&i.visitCount){const e=n.visitCount>=i.visitCount,t=e?n:i;return{item:t,keyMatch:e?"url":"text",override:!1,categoryTitle:tS(t)}}const s=n??i;return{item:s,keyMatch:n?"url":"text",override:!1,categoryTitle:tS(s)}}(t,e);"url"===r&&Db(a?.url,e,a?.title)&&(r="title");if(a&&Pb(t,a,e,r))return{item:oS(a),keyMatch:"url",override:!0,categoryTitle:(0,B.Z)("Domain Result")};return{item:a,keyMatch:r,override:!1,categoryTitle:tS(a)}}(i,t,n);return C.Z.get(I.kAddressBarOmniboxShowBestResult)||o.override?o:{item:null,keyMatch:null,override:!1,categoryTitle:""}}function tS(e){const t=(0,B.Z)("Best Result");return e?hb(e)?(0,B.Z)("Best Result (Nickname)"):mb(e)?(0,B.Z)("Best Result (Bookmark)"):vb(e)?(0,B.Z)("Best Result (Typed History)"):fb(e)?(0,B.Z)("Best Result (History)"):Sb(e)?(0,B.Z)("Best Result (Search Suggestion)"):function(e){return"OMNI_RESULT_TOPSITE"===e.type}(e)?(0,B.Z)("Best Result (Frequently Visited Page)"):yb(e)?(0,B.Z)("Best Result (Direct Match)"):bb(e)?(0,B.Z)("Best Result (Synced Tab)"):function(e){return"OMNI_RESULT_INTERNAL"===e.type}(e)?(0,B.Z)("Best Result (Vivaldi Page)"):(0,B.Z)("Best Result"):t}function nS(e){return"number"==typeof e.score&&"OMNI_RESULT_HISTORY_TITLE"!==e.type&&"OMNI_RESULT_TYPED_HISTORY"!==e.type&&"OMNI_TYPE_SEARCH"!==e.type&&"OMNI_DOMAIN_AUTOCOMPLETE"!==e.type?e.score:-1}function iS(e,t,n){if(!e||!t||!function(e,t){return!(!e?.type||!t.type)&&(mb(e)&&mb(t)||fb(e)&&fb(t)||vb(e)&&vb(t))}(e,t))return!1;const i=nS(e),s=nS(t);return-1===i||-1===s||i===s?"title"===n&&e.title&&t.title?e.title.length<t.title.length:"nickname"===n&&e.nickname&&t.nickname?e.nickname.length<t.nickname.length:(0,rl.Ph)(e.url).length<(0,rl.Ph)(t.url).length:i>s}function sS(e,t){const n=(0,rl.Df)(t.url),i=function(e,t,n){let i=t.url.toLowerCase().indexOf(e.toLowerCase());0!==i&&(i=t.url.substring(n).toLowerCase().indexOf(e.toLowerCase()),i>-1&&(i+=n));return i}(e,t,n);return 0===i||i===n||i===n+4&&"www."===t.url.substring(n,n+4)}function oS(e){const t=(new URL(e.url).origin??"")+"/",n=e.faviconUrl?e.faviconUrl:t,i=e.faviconType?e.faviconType:"img";return{id:e.id+"-d",type:"OMNI_DOMAIN_AUTOCOMPLETE",url:t,isDeleteDisabled:!0,faviconUrl:n,faviconType:i}}var aS=n(98010);const rS=/[^a-zA-Z0-9\s]/g;async function lS(e,t){const n=e.workspaceId,i=e.windowId,s=Ce.ZP.getActivePage(t);s&&(0,pn.Rf)(s.url)&&await c.ZP.closePage(s,{bypassConfirm:!0,forceClosePinned:!1}),i!==t&&await xi.Z.focus(i),await c.ZP.setActiveWorkspace(i,n),c.ZP.activateTab(e.pageId,i)}async function dS(){try{const e=await i.Z.sessions.getDevices();if(!e)return[];const t=[];return e.forEach((e=>{e.sessions.forEach((n=>{const i=n.window?.tabs?.map((e=>e))??[];i&&t.push(...i.map((t=>function(e,t){let n=0;try{if(e.vivExtData){n=JSON.parse(e.vivExtData).workspaceId}}catch(e){console.warn(e)}return{id:e.sessionId??`sync-${crypto.randomUUID()}`,type:"OMNI_RESULT_SYNCED_TABS",title:e.title??"",url:e.url??"",faviconUrl:e.favIconUrl??"",faviconType:"url",isDeleteDisabled:!0,deviceName:t,workspaceId:n}}(t,e.deviceName))))}))})),t}catch(e){return console.warn(e),[]}}const cS=gs()((function(e,t){if(!e)return t;let n=!1;return t.reduce(((t,i)=>{if("BEST_RESULT"===i.type||n)return t.push(i),t;const s=i.items.findIndex((t=>t?.id===e?.id&&t.type===e.type));if(-1!==s){const e=C.Z.get(I.kAddressBarOmniboxDropdownPriority).findIndex((e=>e===i.type));return C.Z.get(I.kAddressBarOmniboxDropdownPriority).findIndex((e=>"BEST_RESULT"===e))<e?t.push({...i,items:[...i.items.slice(0,s),...i.items.slice(s+1)]}):t.push(i),n=!0,t}return t.push(i),t}),[])}),{maxSize:2});var uS,pS=n(34155);function hS(e,t,n,i){uS||(uS="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:uS,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const gS=!1,mS="text/plain",fS=[I.kAddressBarAutocompleteSuffixExpansionValue,I.kAddressBarAutocompleteSuffixExpansionEnabled,I.kAddressBarInlineSearchEnabled,I.kSearchSuggestEnabled,I.kAddressBarInlineSearchSuggestOnNickname,I.kAddressBarOmniboxCutcopyEncoded,I.kAddressBarOmniboxEnabled,I.kAddressBarOmniboxShowBookmarks,I.kAddressBarOmniboxShowBrowserHistory,I.kAddressBarOmniboxShowSearchHistory,I.kAddressBarOmniboxShowTopSites,I.kAddressBarOmniboxShowTypedHistory,I.kAddressBarSelectOnClick,I.kAddressBarShowFullUrl,I.kAddressBarUrlOpenShortcut,I.kAddressBarOmniboxNumberOfBookmarkResults,I.kAddressBarOmniboxNumberOfHistoryResults,I.kAddressBarOmniboxNumberOfTypedHistoryResults,I.kAddressBarOmniboxNumberOfSearchSuggestions,I.kAddressBarStripJavascriptOnPaste,I.kAddressBarHighlightBaseDomain,I.kAddressBarOmniboxDropdownPriority,I.kAddressBarOmniboxShowNicknames,I.kAddressBarOmniboxShowBestResult,I.kAddressBarOmniboxShowSearchOrGoTo,I.kAddressBarOmniboxShowInternalUrls,I.kAddressBarSearchDirectMatchEnabled,I.kAddressBarOmniboxShowSyncTabs,I.kAddressBarAutocompleteEnabled,I.kAddressBarOmniboxShowOpenTab,I.kAddressBarShowSearchSuggestionsWarning];function vS(e,t){return t&&e.startsWith(t.keyword+" ")?e.slice(t.keyword.length+1):e}const yS=[["vivaldi://version/",(0,B.Z)("Vivaldi Version")],["vivaldi://help/",(0,B.Z)("Help Pages")],["vivaldi://about/",(0,B.Z)("About")],["vivaldi://welcome/",(0,B.Z)("Vivaldi Welcome Tour")],["vivaldi://notes/",(0,B.Z)("Notes")],["vivaldi://bookmarks/",(0,B.Z)("Bookmarks")],["vivaldi://history/",(0,B.Z)("History")],["vivaldi://settings/",(0,B.Z)("Settings")],["vivaldi://extensions/",(0,B.Z)("Extensions")],["vivaldi://experiments/",(0,B.Z)("Experiments")],["vivaldi://game/",(0,B.Z)("Vivaldia Game")]].map((([e,t],n)=>({url:e,score:n,title:t,isDeleteDisabled:!0,id:e,type:"OMNI_RESULT_INTERNAL",faviconUrl:e,faviconType:"favicon"}))),bS=yS.map((e=>({...e,url:e.url.replace(/\//g,"")}))),SS=/\r\n|\r|\n/g;function wS(e){return(0,rl.C3)(e)&&!e.endsWith("/")&&!(0,Ty.Lk)(e)}function CS(e){return e.dropdownSelectionIndex>0||e.isDefaultTypedHistoryOpen}function AS(e,t){if(!Array.isArray(t))return[];const n=e.map((e=>(0,rl.Ph)(e.url)));return t.filter((e=>!n.includes((0,rl.Ph)(e.url))))}function IS(e){return{isOmniDropdownOpen:!1,isDefaultTypedHistoryOpen:!1,bookmarkResults:[],historyResults:[],typedHistoryResults:[],nicknameResults:[],suggestResults:[],directMatchResults:[],syncedTabsResults:[],openTabResult:[],bestResultData:{item:null,keyMatch:null,override:!1,categoryTitle:""},dropdownSelectionIndex:0,value:"",pageId:e,topSitesResults:[]}}class TS extends Li.PureComponent{static contextType=ts.Z;#m=!1;#H=!1;#G=!1;#$=-1;#K="";#z=!1;#j=!1;#Y=0;#X=!1;#Q=!1;_nav=new Jb(this);_omniDropdownElement=Li.createRef();_urlInput=Li.createRef();bookmarkSearch=new pb;historySearch=new xb;typedHistorySearch=new Yb;state=IS(this.props.pageId);static defaultProps={urlFragments:(0,Ty.kG)()};setUrlfieldState=e=>{sb.updateState(this.props.pageId,e)};componentDidMount(){this.#m=!0}componentWillUnmount(){this.#m=!1,this._tearDownComponentEventListeners()}static getDerivedStateFromProps(e,t){const n=e.typedUrl??e.displayUrl;if(e.pageId!==t.pageId)return{pageId:e.pageId,value:n};if(e.selectedItem&&CS(t)){let t=e.selectedItem?.url||"";const n=e.selectedItem;return n.text&&"OMNI_RESULT_TYPED_HISTORY"===n.type&&(t=n.text),{value:t}}return{value:n}}_isSuggestEnabled=()=>{const{prefValues:e}=this.props,t=Boolean(this.props.typedSearchEngine);return!!e[I.kSearchSuggestEnabled]&&e[I.kAddressBarOmniboxEnabled]&&(!e[I.kAddressBarInlineSearchSuggestOnNickname]||t)};blur(){(0,Dv.gR)(this.context,this.props.inputId)}updateDropdown(){if(!this.#H&&this.props.showDropdown){if(!this.props.prefValues[I.kAddressBarOmniboxEnabled])return;if(!this.props.pageContext.isUrlFieldFocused)return;this.#G=!0,this.setState({isOmniDropdownOpen:!0,isDefaultTypedHistoryOpen:!1})}}searchTopSites=async e=>{let t=[];if(this.props.prefValues[I.kAddressBarOmniboxShowTopSites]&&!he.ZP.isIncognitoOrGuest(this.context.vivaldiWindowId)){t=(await(0,Qb.Z)()).reduce(((t,n,i)=>(i>5||!n.title.includes(e)&&!n.url.includes(e)||t.push({...n,id:n.url,faviconUrl:n.url,faviconType:"favicon",type:"OMNI_RESULT_TOPSITE"}),t)),[])}return t};runSearchSuggestion=(e,t,n)=>(this._abortController&&this._abortController.abort(),this._abortController=new AbortController,Xb({windowId:e,query:t,searchEngine:n,typedSearchEngine:this.props.typedSearchEngine,abortController:this._abortController}));onClick=async e=>{if(!this.props.prefValues[I.kAddressBarSelectOnClick])return;const{button:t,currentTarget:n}=e,{selectionStart:i,selectionEnd:s,value:o}=n;if(0===t&&Date.now()-this.#Y<350)return;this.#Y=Date.now();const a=0===i&&s===o.length;if(i===s||a){if(this.isUrlInputFocusedOnMouseDown())return void this.handleInputSelect(n);0===t&&await new Promise((e=>pS.nextTick(e))),n.select(),this._focusedOnMouseDown=null}};onMouseDown=e=>{this._focusedOnMouseDown=this.context.document.activeElement,1===e.buttons&&this.validateAutocomplete(e)};onValueChange=(e,t=-1)=>{const{dropdownSelectionIndex:n,bestResultData:i}=this.state;let{selectedItem:s}=this.props;const o=e.endsWith(" ");this.#X||this.state.value.length>=e.length&&this.state.value!==this.props.displayUrl||o||this.#j?(this.#Q=!0,this.setUrlfieldState({selectedItem:void 0,autocompleteValue:""}),s=void 0):this.#Q=!1;const{autocompleteValue:a}=rb.getUrlfieldState(this.props.pageId);a.startsWith(e)||(this.setUrlfieldState({selectedItem:void 0}),s=void 0);const r=this.props.prefValues[I.kAddressBarAutocompleteEnabled]?a.toLowerCase().startsWith(e.toLowerCase()):i.item===s;this.#X=!1,this.setState((t=>({dropdownSelectionIndex:r&&!this.#j?n:0,bestResultData:!t.bestResultData.item||this.#Q||wS(e)?{item:null,keyMatch:null,override:!1,categoryTitle:""}:eS(e,[t.bestResultData.item],Boolean(this.props.autocompleteOnTitle))})),(()=>{e&&-1!==t&&this._urlInput.current?.refUrlInput.current?.setSelection({selectionStart:t,selectionEnd:t})})),e?this.performSearch(e):this.hideDropdown()};getDropdownItems=e=>{const{bookmark:t,topSites:n,suggest:i,nickname:s,typedHistory:o,history:a,directMatch:r,syncedTabs:l,openTab:d,bestResultData:c}=this.getDropdownResults(e),u=this.props.typedUrl||"",p=this.getSearchEngine(),h=function(e){if(e)return{title:e.categoryTitle,type:"BEST_RESULT",items:e.item?[e.item]:[]}}(c),m={title:(0,B.Z)("Vivaldi Pages"),type:"INTERNAL_URLS",items:(f=u,f.startsWith("vivaldi:/")?yS.filter((e=>e.url.startsWith(f))):f.startsWith("vivaldi:")?bS.filter((e=>e.url.startsWith(f))):[])};var f;const v=this.getDirectTypedUrlItem(),y={title:(0,B.Z)("Nickname"),type:"NICKNAMES",items:s},b={title:(0,B.Z)("Bookmarks"),type:"BOOKMARKS",items:t},S={title:(0,B.Z)("Frequently Visited Pages"),type:"FREQ_VISIT",items:n},w={title:(0,B.Z)("Suggestions"),type:"SUGGESTIONS",items:i},C={title:(0,B.Z)("Typed History"),type:"TYPED_HISTORY",items:o},A={title:(0,B.Z)("Browser History"),type:"HISTORY",items:a},T={title:(0,B.Z)("Direct Match"),type:"DIRECT_MATCH",items:r},Z={title:(0,B.Z)("Synced Tabs"),type:"SYNCED_TABS",items:l},E={title:(0,B.Z)("Open Tab"),type:"OPEN_TAB",items:d};if(!this.props.prefValues[I.kAddressBarAutocompleteEnabled]&&!this.props.prefValues[I.kAddressBarOmniboxEnabled])return this.props.prefValues[I.kAddressBarInlineSearchEnabled]?p?[p]:[]:v?[v]:[];const k=this.props.prefValues[I.kAddressBarOmniboxDropdownPriority].reduce(((e,t)=>{switch(t){case"BEST_RESULT":(this.props.prefValues[I.kAddressBarOmniboxShowBestResult]||c?.override)&&h&&(c?.override?e.splice(0,0,h):e.push(h));break;case"INTERNAL_URLS":this.props.prefValues[I.kAddressBarOmniboxShowInternalUrls]&&e.push(m);break;case"SEARCH":if(!this.props.prefValues[I.kAddressBarOmniboxShowSearchOrGoTo])break;this.props.prefValues[I.kAddressBarInlineSearchEnabled]?e.push(...p?[p]:[]):e.push(...v?[v]:[]);break;case"DIRECT_MATCH":this.props.prefValues[I.kAddressBarSearchDirectMatchEnabled]&&e.push(T);break;case"NICKNAMES":this.props.prefValues[I.kAddressBarOmniboxShowNicknames]&&e.push(y);break;case"BOOKMARKS":this.props.prefValues[I.kAddressBarOmniboxShowBookmarks]&&e.push(b);break;case"FREQ_VISIT":this.props.prefValues[I.kAddressBarOmniboxShowTopSites]&&e.push(S);break;case"TYPED_HISTORY":this.props.prefValues[I.kAddressBarOmniboxShowTypedHistory]&&e.push(C);break;case"SUGGESTIONS":this.props.prefValues[I.kSearchSuggestEnabled]&&e.push(w);break;case"HISTORY":this.props.prefValues[I.kAddressBarOmniboxShowBrowserHistory]&&e.push(A);break;case"SYNCED_TABS":this.props.prefValues[I.kAddressBarOmniboxShowSyncTabs]&&e.push(Z);break;case"OPEN_TAB":this.props.prefValues[I.kAddressBarOmniboxShowOpenTab]&&e.push(E)}return e}),[]);if(this.#Q){const e=k.findIndex((e=>"SEARCH"===e.type));-1===e&&p?k.splice(0,0,p):-1!==e&&k.splice(0,0,k.splice(e,1)[0])}else if(!this.#Q&&c?.item&&hb(c?.item)&&g.Z.hasNickname(u)){const e=k.findIndex((e=>"BEST_RESULT"===e.type));-1!==e&&k.splice(0,0,k.splice(e,1)[0])}return k};getDropdownResults=e=>{const{nicknameResults:t,bookmarkResults:n,historyResults:i,typedHistoryResults:s,suggestResults:o,topSitesResults:a,directMatchResults:r,syncedTabsResults:l,openTabResult:d,bestResultData:c}=this.state,u=e?.nickname??t,p=e?.bookmark??n,h=e?.history??i,g=e?.typedHistory??s,m=e?.topSites??a,f=e?.directMatch??r,v=e?.syncedTabs??l;return{nickname:u,bookmark:p,history:h,typedHistory:g,topSites:m,suggest:C.Z.get(I.kSearchSuggestEnabled)?e?.suggest??o:[],directMatch:f,syncedTabs:v,openTab:e?.openTab??d,bestResultData:e?.bestResultData??c}};onAutocompleteValueChange=e=>{this.setUrlfieldState({autocompleteValue:e})};handleInputSelect=e=>{this.#G?this.#G=!1:""!==e.value.trim()&&"none"===e.selectionDirection&&(e.selectionDirection="forward")};onSelected=e=>{const{currentTarget:t,nativeEvent:n}=e;"mouseup"!==n.type&&this.handleInputSelect(t)};_handleUndo=e=>{const t=e.currentTarget,{value:n}=this.state,{selectedItem:i}=this.props,{selectionStart:s,selectionEnd:o}=e.currentTarget;if(s!==o&&o===t.value.length&&i&&!Cb(i)){e.preventDefault();const t=s-1;t>0?this.setUrlfieldState({typedUrl:n.substring(0,t)}):(this.setUrlfieldState({typedUrl:"",selectedItem:void 0}),this.setState({bookmarkResults:[],nicknameResults:[],historyResults:[],typedHistoryResults:[],topSitesResults:[],directMatchResults:[],syncedTabsResults:[],suggestResults:[],openTabResult:[],bestResultData:{item:null,keyMatch:null,override:!1,categoryTitle:""}}),this.hideDropdown())}""!==n||Ce.ZP.isActiveInternal(this.context.vivaldiWindowId)||(e.preventDefault(),this.revertUrl())};_cleanupState=()=>{this.#z=!1};_constructSearchSuggestion=e=>{const{typedSearchEngine:t,defaultSearchEngine:n}=this.props,i=t||n;if(!i)return Promise.resolve([]);const s=this._isSuggestEnabled(),o=!!t&&t.hasOwnProperty("suggestUrl"),a=!t&&!!n&&n.hasOwnProperty("suggestUrl");if(!(s&&(o||a)))return Promise.resolve([]);const r=t?vS(e,t):e;return r.trim()?this.runSearchSuggestion(this.context.vivaldiWindowId,r.trim(),i):Promise.resolve([])};_searchDropdownItems=async(e,t)=>{if(-1!==this.#$&&this.#$===e)return void(this.#K=t);this.#$=e;const n=()=>{if(this.#K){this.#$=-1;const t=this.#K;return this.#K="",this.props.pageId===e&&this._searchDropdownItems(this.props.pageId,t),!0}return!1};try{this._cleanupState();const{typedSearchEngine:e,syncedTabs:i}=this.props,s=this.props.prefValues[I.kAddressBarOmniboxShowBrowserHistory]&&!e,o=this.props.typedHistoryEnabled&&this.props.prefValues[I.kAddressBarOmniboxShowTypedHistory]&&!e,a=!e&&(this.props.prefValues[I.kAddressBarOmniboxShowBookmarks]||this.props.prefValues[I.kAddressBarOmniboxShowNicknames]),r=!e&&this.props.prefValues[I.kAddressBarOmniboxShowTopSites],l=!e&&this.props.prefValues[I.kAddressBarSearchDirectMatchEnabled],d=!e&&this.props.prefValues[I.kAddressBarOmniboxShowSyncTabs]&&Array.isArray(i),c=!this.#Q&&!wS(t),u=!e&&this.props.prefValues[I.kAddressBarOmniboxShowOpenTab],p=this._constructSearchSuggestion(t),h=s?this.historySearch.search(t,{count:this.props.prefValues[I.kAddressBarOmniboxNumberOfHistoryResults]}).catch((()=>[])):Promise.resolve([]),g=o?this.typedHistorySearch.search(t,{count:this.props.prefValues[I.kAddressBarOmniboxNumberOfTypedHistoryResults]}).catch((()=>[])):Promise.resolve([]),m={nicknameResults:[],bookmarkResults:[]},f=a?this.bookmarkSearch.search(t).catch((()=>m)):Promise.resolve(m),v=r?this.searchTopSites(t).catch((()=>[])):Promise.resolve([]),y=l?Zb(t,this.props.getOffsetWidth?this.props.getOffsetWidth():0).catch((()=>[])):Promise.resolve([]),b=d?function(e,t,n){t=t.toLowerCase();const i=[];return e.reduce(((e,n)=>{const s=n.url??"",o=n.title??"",a=new URL(s).host.toLowerCase().indexOf(t),r=o.toLowerCase().indexOf(t);return i.some(((t,s)=>{const o=t.urlIdx,l=t.titleIdx;return(-1!==a&&-1!==o&&a<o||-1!==r&&-1!==l&&r<l)&&(i.splice(s,0,{...n,urlIdx:a,titleIdx:r}),e.splice(s,0,n),!0)}))||-1===a&&-1===r||(0,rl.xl)(s)||(i.push({...n,urlIdx:a,titleIdx:r}),e.push(n)),e}),[]).slice(0,n)}(i??[],t,C.Z.get(I.kAddressBarOmniboxNumberOfSyncedTabs)):[],S=u?function(e,t){let n="",i="";const s=Ce.ZP.getActivePage(t)?.id??-1,o=Ce.ZP.findRecentPageInAllWindows((t=>{if(t.id===s||t.url.length>2048)return!1;const o=(0,pn.pM)(t.url);n=o?(0,aS.gC)((0,Ty.dO)(t.url)):t.url,i=o?(0,pn.D1)(t):t.title;const a=(0,rl.Ph)(n).toLowerCase(),r=e.toLowerCase(),l=(0,rl.Ph)(r).toLowerCase();if(o)return!(0,pn.$0)(t.url)&&(a.includes(r)||i.toLowerCase().includes(r));const d=r.replace(rS,""),c=new RegExp("\\b"+d).test(i.toLowerCase()),u=(0,ge.Z)(n)?.host?.includes(l)||!1;return l.length>0&&(u||c)}));return o?[{id:`opened-tab-${o.id}`,type:"OMNI_RESULT_OPEN_TAB",title:i,url:n,windowId:o.windowId,workspaceId:o.vivExtData?.workspaceId,pageId:o.id,faviconUrl:o.favIconUrl,faviconType:"url",isDeleteDisabled:!0}]:[]}(t,this.context.vivaldiWindowId):[];this.updateDropdown(),this.#j=!1;const[w,A,T,Z,E,k]=await Promise.all([f,h,g,v,p,y]);if(!this.#m)return;if(n())return;const _=function(e){let{nicknameResults:t,bookmarkResults:n,historyResults:i,typedHistoryResults:s,topSitesResults:o,directMatchResults:a,syncedTabsResults:r,suggestResults:l,openTabResult:d}=e;return C.Z.get(I.kAddressBarOmniboxDropdownPriority).reduce(((e,t)=>{switch(t){case"DIRECT_MATCH":a=AS(e,a),e.push(...a);break;case"BOOKMARKS":n=AS(e,n),e.push(...n);break;case"FREQ_VISIT":o=AS(e,o),e.push(...o);break;case"TYPED_HISTORY":s=AS(e,s),e.push(...s);break;case"SUGGESTIONS":l=AS(e,l),e.push(...l);break;case"HISTORY":i=AS(e,i),e.push(...i);break;case"SYNCED_TABS":r=AS(e,r),e.push(...r);break;case"OPEN_TAB":d=AS(e,d),e.push(...d)}return e}),[]),{nicknameResults:t,bookmarkResults:n,historyResults:i,typedHistoryResults:s,topSitesResults:o,directMatchResults:a,syncedTabsResults:r,suggestResults:l,openTabResult:d}}({nicknameResults:w.nicknameResults,bookmarkResults:w.bookmarkResults,historyResults:A,typedHistoryResults:T,topSitesResults:Z,directMatchResults:k,syncedTabsResults:b,suggestResults:E,openTabResult:S});let N=this.getRawDropdown(this._getFormattedTypedHistoryItems(),this.getDropdownItems({nickname:_.nicknameResults,bookmark:_.bookmarkResults,history:_.historyResults,typedHistory:_.typedHistoryResults,topSites:_.topSitesResults,directMatch:_.directMatchResults,syncedTabs:_.syncedTabsResults,suggest:_.suggestResults,openTab:_.openTabResult,bestResultData:{item:null,keyMatch:null,override:!1,categoryTitle:""}}),!0);_.bestResultData=c?eS(t,N,Boolean(this.props.autocompleteOnTitle)):{item:null,keyMatch:null,override:!1,categoryTitle:""},_.bestResultData.item&&(this.props.prefValues[I.kAddressBarOmniboxShowBestResult]||_.bestResultData.override)&&(N=this.getRawDropdown(this._getFormattedTypedHistoryItems(),cS(_.bestResultData.item,this.getDropdownItems({nickname:_.nicknameResults,bookmark:_.bookmarkResults,history:_.historyResults,typedHistory:_.typedHistoryResults,topSites:_.topSitesResults,directMatch:_.directMatchResults,syncedTabs:_.syncedTabsResults,suggest:_.suggestResults,openTab:_.openTabResult,bestResultData:_.bestResultData})),!0)),this.setUrlfieldState({selectedItem:N[0]}),this.setState(_,(()=>{n()||(this.#$=-1)}))}catch(e){throw n()||(this.#$=-1),e}};performSearch=e=>{""===e.trim()||Wv(e)||!this.props.prefValues[I.kAddressBarAutocompleteEnabled]&&!this.props.prefValues[I.kAddressBarOmniboxEnabled]||(this.#H=!1,this._searchDropdownItems(this.props.pageId,e))};revertUrl=e=>{if(!this.#m)return;this.setUrlfieldState({typedUrl:e,autocompleteValue:"",selectedItem:void 0});const{value:t}=IS(this.props.pageId);this.setState({value:t})};_openTypedHistoryOmniDropDown=()=>{this.props.typedHistoryEnabled&&!this.state.isDefaultTypedHistoryOpen&&(this.selectFirstDefaultTypedHistoryDropdownItem(),this.setState({isDefaultTypedHistoryOpen:!0,isOmniDropdownOpen:!1}))};toggleTypedHistory=e=>{e.preventDefault(),this.setState((e=>{const t=!e.isDefaultTypedHistoryOpen;return t&&this.selectFirstDefaultTypedHistoryDropdownItem(),{isDefaultTypedHistoryOpen:t,isOmniDropdownOpen:!t}}))};selectFirstDefaultTypedHistoryDropdownItem=()=>{const e=this.props?.defaultTypedHistory;e?.length&&(this.setUrlfieldState({selectedItem:e[0]}),this.setState({dropdownSelectionIndex:0}),this._nav.setNumberOfSelectableItems(e.length))};_onEscPressed=()=>{if(this._urlInput.current?.isIMEOpen)return;this.hideDropdown();const{displayUrl:e,typedUrl:t}=this.props;"string"==typeof t&&t!==e?(this.revertUrl(),(0,Dv.i6)(this.context,this.props.inputId)):(this.blur(),ne.Z.executeActions("shortcut",this.context,"COMMAND_FOCUS_WEBVIEW"))};hideDropdown=e=>{this.setState({isOmniDropdownOpen:!1,isDefaultTypedHistoryOpen:!1,dropdownSelectionIndex:0},e)};getDropdown=()=>this._omniDropdownElement.current;onPaste=e=>{const{clipboardData:t}=e,n=t.getData(mS);n.trim()||e.preventDefault();const{value:i}=this.state,s=this.context.document.activeElement?.classList.toString()===e.currentTarget?.classList.toString()?e.currentTarget.selectionStart:0,o=e.currentTarget.selectionEnd,a=(0,Zy.i)(i,n,s,o);if(C.Z.get(I.kAddressBarStripJavascriptOnPaste)&&(0,$y.M)(a)){e.preventDefault();const t=(0,$y.Z)({textToStrip:n,caretPosition:s,selectionEnd:o,currentValue:i}),a=n.length-n.indexOf(":")-1;return this.setUrlfieldState({typedUrl:t}),void this.onValueChange(t,a)}if(SS.test(n)){e.preventDefault();const t=n.replace(SS,""),a=(0,Zy.i)(i,t,s,o);return this.setUrlfieldState({typedUrl:a}),void this.onValueChange(a,s+t.length)}this.#j=!0,this.setUrlfieldState({selectedItem:void 0}),this.setState({bestResultData:{item:null,keyMatch:null,override:!1,categoryTitle:""}})};onClipboardEvent=e=>{const{clipboardData:t,type:n,currentTarget:i}=e,{HTMLInputElement:s}=this.context;if(!(i instanceof s&&t))return;if(0!==i.selectionStart||i.selectionEnd!==i.value.length)return;let o=i.value;i.selectionEnd&&i.selectionEnd!==i.value.length&&(o=i.value.substring(0,i.selectionEnd));const a=this.props.displayUrl!==o;if(this.props.prefValues[I.kAddressBarOmniboxCutcopyEncoded]&&!a){const e=(0,Ty.dO)(o).host??"";o=encodeURI(o).replace(/%25/g,"%");const t=encodeURI(e),n=o.indexOf(t);o=o.slice(0,n)+e+o.slice(n+t.length)}if(o.length>=p.RL&&o.endsWith("...")&&this.props.displayUrl.startsWith(o.substring(0,p.RL))&&(o=this.props.displayUrl),(0,rl.Zj)(o)&&/[\.\/]/.test(o)&&this.state.value===this.props.displayUrl){const e=(0,ge.Z)(this.props.displayUrl);if(e?.protocol){o=(rl.JQ.find((t=>t.startsWith(e.protocol)))||e.protocol)+o}}if(t.setData("text",o),"cut"===n){const e=i.value.slice(i.selectionEnd);this.setUrlfieldState({typedUrl:e}),i.setSelectionRange(0,0),this.setUrlfieldState({selectedItem:void 0})}e.preventDefault()};validateAutocomplete=({currentTarget:e})=>{const t=e.value===this.props.displayUrl?void 0:e.value;t!==this.props.typedUrl&&(this.setUrlfieldState({typedUrl:t,selectedItem:void 0}),this.setState({bookmarkResults:[],nicknameResults:[],historyResults:[],typedHistoryResults:[],topSitesResults:[],directMatchResults:[],syncedTabsResults:[],suggestResults:[],openTabResult:[],bestResultData:{item:null,keyMatch:null,override:!1,categoryTitle:""}}))};_shortcutListener=(e,t,n,i)=>{if(t&&i===xa.Z.KEY_ESCAPE)this._onEscPressed()};_setUpComponentEventListeners=()=>{se.Z.tabsPrivate.onKeyboardChanged.addListener(this._shortcutListener)};_tearDownComponentEventListeners=()=>{se.Z.tabsPrivate.onKeyboardChanged.removeListener(this._shortcutListener)};onFocus=e=>{this.props.pageContext.isUrlFieldFocused=!0,this.props.onFocus&&this.props.onFocus(e),this.props.showDropdown&&this._setUpComponentEventListeners()};onBlur=e=>{this.props.pageContext.isUrlFieldFocused=!1;const{document:t,getSelection:n,Element:i}=this.context,s=n();s&&s.focusNode instanceof i&&s.focusNode.classList.contains("UrlField")&&s.removeAllRanges(),this.props.onBlur&&this.props.onBlur(),this.props.showDropdown&&this._tearDownComponentEventListeners(),pS.nextTick((()=>{t.activeElement?.classList.contains("uifocusstop")||de.Z.setPaneFocus(this.context.vivaldiWindowId,!1)}))};onKeyDown=e=>{if(!this._urlInput.current?.isIMEOpen){if(this.state.isOmniDropdownOpen||this.state.isDefaultTypedHistoryOpen)switch(e.key){case"Escape":e.preventDefault(),e.stopPropagation();break;case"ArrowUp":e.preventDefault(),e.stopPropagation(),(0,As.S2)(e)?this._nav.sectionUp():this._nav.up(!1);break;case"Tab":(0,As.VV)(e)?(e.preventDefault(),e.stopPropagation(),this._nav.down(!0)):(0,As.Mr)(e)&&(e.preventDefault(),e.stopPropagation(),this._nav.up(!0));break;case"ArrowDown":e.preventDefault(),e.stopPropagation(),(0,As.S2)(e)?this._nav.sectionDown():this._nav.down(!1);break;case"PageUp":this._nav.pageUp();break;case"PageDown":this._nav.pageDown();break;case"Delete":const{selectedItem:t}=this.props;(0,As.Mr)(e)&&t&&(e.preventDefault(),this.onOmniDropdownItemDelete(t))}switch(e.key){case"ArrowRight":case"ArrowLeft":case"End":case"Home":this.validateAutocomplete(e);break;case"z":!e.shiftKey&&e.ctrlKey&&this._handleUndo(e);break;case"ArrowDown":(0,ps.Z)(e)||this.state.isOmniDropdownOpen||this._openTypedHistoryOmniDropDown();break;case"ArrowUp":0===e.currentTarget.selectionStart&&(e.preventDefault(),this._openTypedHistoryOmniDropDown());break;case"Backspace":case"Delete":const t=(0,As.Np)(e)||gS;((0,As.VV)(e)||t)&&this.state.value.length>0&&(this.#X=!0)}}};_urlFieldGo=async(e,t)=>{this.props.onSubmit&&""!==e&&(this.cleanupUrl(e),await(this.props.onSubmit?.({url:e,...t?{options:t}:null})),this.#H=!0)};onKeyPress=e=>{this.props.onKeyPress&&this.props.onKeyPress(e)};onDragStart=e=>{if((0,dp.W$)(e))return;const{getSelection:t}=this.context;this.#z=!0;const n=t();n&&e.currentTarget.value===n.toString()&&Gy()(e.currentTarget.value)&&this.props.onUrlDrag?.(e)};onDragEnd=()=>{this.#z=!1};onDragEnter=e=>{if(e.stopPropagation(),!this.#z&&this.isDropAllowed(e)){e.preventDefault();const t=e.currentTarget,{HTMLInputElement:n}=this.context;t instanceof n&&t.classList.add("pseudo-selected")}};onDragOver=e=>{this.isDropAllowed(e)&&e.preventDefault()};onDragLeave=e=>{if(this.#z)return;const t=e.target,{HTMLInputElement:n}=this.context;t instanceof n&&t.classList.remove("pseudo-selected")};onDrop=e=>{if(!this.isDropAllowed(e))return;const t=e.target,{HTMLInputElement:n}=this.context;if(t instanceof n&&t.classList.remove("pseudo-selected"),"function"==typeof this.props.onDrop)this.#z||(this.props.onDrop(e),e.stopPropagation(),e.preventDefault());else if(this.props.handleDrop){e.stopPropagation(),e.preventDefault();let t="";const n=e.dataTransfer?zi.ZP.extractUriListFromEvent(e):"";if(n.length>0){const e=n.split("\n");e.length>0&&(t=e[0])}else t=e.dataTransfer?e.dataTransfer.getData(mS):"";this.setUrlfieldState({typedUrl:t}),(0,Dv.x0)(this.context,this.props.inputId)}};isDropAllowed=e=>{if(!e?.dataTransfer||e.dataTransfer.types.includes("vivaldi/x-button-toolbar"))return!1;return e.dataTransfer.types.some((e=>e===zi.yR||e===mS||zi.ZP.isUriListType(e)))};setDropdownSelectionIndex=e=>{this.setState({dropdownSelectionIndex:e})};setAutocompleteHighlight=this.setDropdownSelectionIndex;onOmniDropdownItemClicked=(e,t)=>{this.revertUrl(),this.blur();const n=this.context.vivaldiWindowId;e.url&&("OMNI_TYPE_SEARCH"!==e.type||(0,rl.C3)(e.url)?yb(e)?Tb(e,n,{...t,incognito:t.incognito||he.ZP.isGuest()}):wb(e)?lS(e,n):oy.Z.go(n,[e.url],{...t,enableSearch:!0}):oy.Z.goSearchUrl(n,e.url,{...t,incognito:t.incognito||he.ZP.isGuest()})),this.hideDropdown()};_deleteHistoryItem=e=>{const t=(0,rl.K2)(e.url)?e.url:e.id;i.Z.history.deleteUrl({url:t});const{historyResults:n,dropdownSelectionIndex:s,typedHistoryResults:o,bestResultData:a}=this.state,r=n.filter((t=>t.url!==e.url)),l=o.filter((t=>t.url!==e.url)),d=this.getRawDropdown(this._getFormattedTypedHistoryItems(),cS(a.item,this.getDropdownItems({history:r,typedHistory:l}))),c=e.id===a.item?.id&&0===s;c&&d.splice(0,1);const u=s>=d.length?d.length>0?d.length-1:0:s,p=d[u];this.setUrlfieldState({selectedItem:p}),this.setState({historyResults:r,typedHistoryResults:l,dropdownSelectionIndex:u,bestResultData:c?{item:null,keyMatch:null,override:!1,categoryTitle:""}:a})};onOmniDropdownItemDelete=e=>{if("OMNI_TYPE_SEARCH"===e.type)return;const t=e;this._deleteHistoryItem(t)};isUrlInputFocusedOnMouseDown=()=>{if(!this._urlInput.current)return!1;const e=this._urlInput.current?.refUrlInput.current?.inputField.current;return e===this._focusedOnMouseDown};componentDidUpdate(e,t){if(t.dropdownSelectionIndex!==this.state.dropdownSelectionIndex&&this._nav.setSelectionIndex(this.state.dropdownSelectionIndex),e.typedSearchEngine!==this.props.typedSearchEngine){const{bestResultData:e}=this.state;this.setState({bestResultData:this.props.typedSearchEngine?{item:null,keyMatch:null,override:!1,categoryTitle:""}:e})}if(this.state.isDefaultTypedHistoryOpen&&!t.isDefaultTypedHistoryOpen&&(0,Dv.x0)(this.context,this.props.inputId),this.props.pageId!==e.pageId&&this._cleanupState(),this.props.displayUrl&&this.props.displayUrl!==e.displayUrl&&void 0===this.props.typedUrl){const e=this._urlInput?.current?.refUrlInput?.current,t=e?.inputField?.current;e&&t&&e.setSelection({selectionStart:0,selectionEnd:t.value.length},"forward")}}getSearchEngine=()=>{const e=this.props.typedSearchEngine||this.props.defaultSearchEngine;if(!e)return;const t=this.props.typedUrl||"",n=ai.Z.systemDefaultEngineChanged()?(0,B.Z)("Search $1 [NEW]",[e.name]):(0,B.Z)("Search $1",[e.name]),i=(0,B.Z)("Go To");return{title:(0,rl.C3)(t)?i:n,type:"SEARCH",items:[{id:e.guid,type:"OMNI_TYPE_SEARCH",text:t,url:t,isDeleteDisabled:!0,faviconUrl:Wi.YvR.medium,faviconType:"img"}]}};getDirectTypedUrlItem=()=>{if(!this.props.prefValues[I.kAddressBarOmniboxShowSearchOrGoTo]||this.props.prefValues[I.kAddressBarInlineSearchEnabled])return;const e=this.props.typedUrl||"";return{title:(0,B.Z)("Go to"),type:"SEARCH",items:[{id:e,type:"OMNI_DIRECT_TYPED_URL",text:e,url:e,isDeleteDisabled:!0,faviconUrl:Wi.YvR.medium,faviconType:"img"}]}};_getFormattedTypedHistoryItems=()=>[{type:"TYPED_HISTORY",title:(0,B.Z)("Typed History"),items:this.state.isDefaultTypedHistoryOpen?this.props?.defaultTypedHistory??[]:[]}];onTypedHistoryItemDelete=e=>{i.Z.history.deleteUrl({url:e.url})};setSelectedItem=e=>{this.setUrlfieldState({selectedItem:e})};renderDropdown=({typedHistoryItems:e,omniDropdownItems:t})=>{if(this.state.isDefaultTypedHistoryOpen)return(0,ss.jsx)(zb,{ref:this._omniDropdownElement,onNumberOfSelectableItemsChanged:this._nav.setNumberOfSelectableItems,onLinkItemClicked:this.onOmniDropdownItemClicked,items:e,selectionIndex:this.state.dropdownSelectionIndex,onDeleteItem:this.onTypedHistoryItemDelete,onMenuClosed:this.hideDropdown,outsideClickIgnoreClass:"drop-down-menu"});if(!this.props.prefValues[I.kAddressBarOmniboxEnabled]||!this.state.isOmniDropdownOpen)return null;const{bestResultData:n}=this.state;return(0,ss.jsx)(zb,{ref:this._omniDropdownElement,onNumberOfSelectableItemsChanged:this._nav.setNumberOfSelectableItems,onLinkItemClicked:this.onOmniDropdownItemClicked,items:t,selectionIndex:this.state.dropdownSelectionIndex,typedSearchEngine:this.props.typedSearchEngine,defaultSearchEngine:this.props.defaultSearchEngine,onDeleteItem:this.onOmniDropdownItemDelete,pattern:this.props.typedUrl,onMenuClosed:this.hideDropdown,outsideClickIgnoreClass:"drop-down-menu",bestResult:n.item})};updateSearchSuggestionWarning(){ey()||w.Z.set(I.kAddressBarShowSearchSuggestionsWarning,this.props.prefValues[I.kAddressBarShowSearchSuggestionsWarning]+1)}runNicknameAndBookmark=({id:e,nickname:t,typedValue:n,openOptions:i,winId:s})=>{const{transition:o,fromUrlField:a,...r}=i;r.allowOverride=!1;const l=e?g.Z.getItemById(e):void 0,d=t?g.Z.getNicknamed(t,!0):l?[l]:[];zi.ZP.open(s,d,r,!0),this.cleanupUrl(n),this.#H=!0};handleSubmit=async({autocompletedValue:e,typedValue:t},n)=>{const i=this.context.vivaldiWindowId,s=e,o=n.shiftKey&&"shift"===this.props.prefValues[I.kAddressBarUrlOpenShortcut]||n.altKey&&"alt"===this.props.prefValues[I.kAddressBarUrlOpenShortcut]||gS,a=o&&n.ctrlKey,r={...(0,La.ZP)(i,{ctrlKey:n.ctrlKey,altKey:n.altKey,shiftKey:n.shiftKey,metaKey:n.metaKey}),inCurrent:!o,inBackground:a,transition:se.Z.historyPrivate.TransitionType.GENERATED,fromUrlField:!0,incognito:he.ZP.isIncognitoOrGuest(i)};this.updateSearchSuggestionWarning();const{selectedItem:l}=this.props;if(-1!==this.#$){if(g.Z.hasNickname(t))return void this.runNicknameAndBookmark({nickname:t,typedValue:t,openOptions:r,winId:i});if((0,rl.C3)(t))return this.cleanupUrl(t),void await this._urlFieldGo(t,r)}if(n.ctrlKey&&this.props.prefValues[I.kAddressBarAutocompleteSuffixExpansionEnabled]&&this.props.prefValues[I.kAddressBarAutocompleteSuffixExpansionValue]){const n=(0,rl.K2)(e);await this._urlFieldGo((0,rl.Ei)(n?t:e,this.props.prefValues[I.kAddressBarAutocompleteSuffixExpansionValue]),r)}else{if(l){if(wb(l)&&!o&&!a)return lS(l,i),void this.cleanupUrl(this.props.displayUrl);const e=gb(l),n=hb(l),s=mb(l),d=n&&"string"==typeof l.nickname?l.nickname:"";if(g.Z.hasNickname(d))return e&&(r.inCurrent=!o&&!C.Z.get(I.kBookmarksOpenInNewTab)),void this.runNicknameAndBookmark({nickname:d,typedValue:t,openOptions:r,winId:i});if(s)return void this.runNicknameAndBookmark({id:l.id,typedValue:t,openOptions:r,winId:i});this.cleanupUrl(l.url);const c="OMNI_TYPE_SEARCH"===l.type,u=(0,rl.C3)(t);return c&&!u?void oy.Z.goSearchUrl(i,l.url,{inBackground:r.inBackground,inCurrent:r.inCurrent,inNewWindow:r.inNewWindow,incognito:r.incognito||he.ZP.isGuest(),allowOverride:r.allowOverride,transition:r.transition,fromUrlField:!0}):(((c||"OMNI_DIRECT_TYPED_URL"===l.type)&&u||vb(l)&&!l.text)&&(r.transition=se.Z.historyPrivate.TransitionType.TYPED),yb(l)?(Tb(l,i,r),void(this.#H=!0)):void await this._urlFieldGo(l.url,r))}s===this.props.displayUrl&&(r.transition=se.Z.historyPrivate.TransitionType.RELOAD),await this._urlFieldGo(s,r)}};cleanupUrl=e=>{this.revertUrl(e),this.blur(),this.hideDropdown()};onMouseUp=e=>{const{getSelection:t}=this.context,{button:n,currentTarget:i}=e};getRawDropdown=(e,t)=>this.state.isDefaultTypedHistoryOpen?e.flatMap((e=>e.items)):t.flatMap((e=>e.items??[]));render(){const{bestResultData:e,value:t}=this.state,{typedUrl:n}=this.props,i={typedHistoryItems:this._getFormattedTypedHistoryItems(),omniDropdownItems:n&&n.length>0?cS(e.item,this.getDropdownItems()):[]},s=this.getRawDropdown(i.typedHistoryItems,i.omniDropdownItems),o=this.props.prefValues[I.kAddressBarShowFullUrl],a=this.props.prefValues[I.kAddressBarHighlightBaseDomain],r=this.props.urlFragments?(0,Ty.gG)(this.props.urlFragments):void 0,l=CS(this.state),d=function(e,t,n,i,s,o){if(!o||!e)return o;if("OMNI_TYPE_SEARCH"===i?.type||s)return o;const a=t[0]?.url===n.item?.url?n.keyMatch:null;return kb(t,t[0],a,o)}(this.props.autocompletionEnabled&&(this._urlInput.current?._shouldAutocompleteValue??!0),s,e,this.props.selectedItem,l,t);return(0,ss.jsxs)(ss.Fragment,{children:[hS("div",{className:Fi()("UrlField",{"UrlField--HasEditText":Boolean(n),"UrlField--IsEmpty":""===this.state.value})},void 0,(0,ss.jsx)(Ob,{ref:this._urlInput,autoFocus:this.props.autoFocus,className:this.props.className||"",displayUrl:this.props.displayUrl,typedUrl:this.props.typedUrl,onSubmit:this.handleSubmit,autocompleteData:s,autocompleteValue:d,onValueChange:this.onValueChange,onAutocompleteValueChange:this.onAutocompleteValueChange,disabled:this.props.disabled?this.props.disabled:void 0,placeholder:this.props.placeholder?this.props.placeholder:void 0,title:this.props.title?this.props.title:void 0,pageId:this.props.pageId,readOnly:this.props.readonly,isOmniDropdownOpen:this.state.isOmniDropdownOpen,inputId:this.props.inputId,navigationMode:l,onBlur:this.onBlur,onFocus:this.onFocus,onSelect:this.onSelected,onClick:this.onClick,onContextMenu:this.onClick,onDragStart:this.onDragStart,onDragEnter:this.onDragEnter,onDragOver:this.onDragOver,onDragLeave:this.onDragLeave,onDragEnd:this.onDragEnd,onDrop:this.onDrop,onKeyPress:this.onKeyPress,onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onKeyDown:this.onKeyDown,onCut:this.onClipboardEvent,onCopy:this.onClipboardEvent,onPaste:this.onPaste}),r&&hS(Vy,{windowId:this.context.vivaldiWindowId,urlFragments:r,displayUrl:this.props.displayUrl,shouldShowFullUrl:o,onGoToPath:this._urlFieldGo,onBaseDomainObscured:this.props.onBaseDomainObscured,shouldHighlightBaseDomain:a,rawDisplay:!1})),this.renderDropdown(i)]})}}const ZS=(0,Bu.Z)(TS,fS);var ES;function kS(e,t,n,i){ES||(ES="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:ES,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const _S=Pv.t;function NS(e){return{url:e.url,title:e.title}}class PS extends Li.PureComponent{static contextType=ts.Z;dropMode={support:!1,copy:!1};nodeRef=Li.createRef();_id=crypto.randomUUID();_pageContext={};_useOmni=Oi.Z.isEnabled("omnibox");state={drawerOpen:!1,suggestions:[],url:"",editUrl:void 0};componentDidMount(){this._useOmni?Rv.addListener(this._onUrlFieldStoreChanged,(e=>e.get(this._id))):rb.addListener(this._onUrlFieldStoreChanged,(e=>e.get(this._id)))}getNode(){return this.nodeRef.current}async updateSuggestedSites(){if(he.ZP.isIncognitoOrGuest(this.context.vivaldiWindowId))return;const e=(await(0,Qb.Z)()).map(NS).filter((e=>!vr.Z.hasPanelUrl(e.url))),t=_S.filter((e=>!vr.Z.hasPanelUrl(e.url))),n=await se.Z.extensionActionUtils.getToolbarExtensions(),i=[];n.forEach((e=>{if(!e.enabled)return;const t=vr.Z.getExtPanelId(e);t&&e.sidePanel&&!vr.Z.hasPanelId(t)&&i.push({title:e.name,faviconUrl:e.badgeIcon,url:e.sidePanel.url,extensionId:t,extension:e})}));const s=i.concat(e.concat(t));s.splice(12),this.setState({suggestions:s})}componentWillUnmount(){this._useOmni?(Rv.removeListener(this._onUrlFieldStoreChanged),Ov.Z.reset(this._id)):(rb.removeListener(this._onUrlFieldStoreChanged),sb.reset(this._id))}_onUrlFieldStoreChanged=()=>{const{typedUrl:e}=this._useOmni?Rv.getUrlfieldState(this._id):rb.getUrlfieldState(this._id);this.setState({editUrl:e})};onDragEnter=e=>{this.dropMode=this.supportDropForEvent(e)};onDragOver=e=>{e.preventDefault(),e.stopPropagation(),this.dropMode.support?e.dataTransfer.dropEffect=this.dropMode.copy?"copy":"move":e.dataTransfer.dropEffect="none"};onDrop=e=>{e.preventDefault(),e.stopPropagation(),this.dropMode.support&&zi.ZP.getUrlsFromEventPromise(e,!0).then((e=>{e.forEach((e=>{vr.Z.addByUrl(this.context.vivaldiWindowId,e.url,!0)}))}))};supportDropForEvent=e=>{const t=e.dataTransfer.types.some((e=>zi.ZP.isUriListType(e)||"text/plain"===e));return{support:t,copy:t&&!e.dataTransfer.types.some((e=>e===p.Up))}};handleClickOutside=()=>{this.state.drawerOpen&&this.closeDrawer()};handleKeyDown=(e,t,n)=>{if("start"===e);else if("suggestion"===e){switch(n.key){case"ArrowLeft":this.moveFocus(t,"left",!1);break;case"ArrowRight":this.moveFocus(t,"right",!1);break;case"ArrowUp":this.moveFocus(t,"up",!1);break;case"ArrowDown":this.moveFocus(t,"down",!1);break;default:return}n.preventDefault(),n.stopPropagation()}};moveFocus=(e,t,n)=>{const{document:i,HTMLElement:s}=this.context,o=this.nodeRef.current;if(o instanceof s&&(!0===n||(0,Ra.sT)(i,o))){const n=Array.from(o.querySelectorAll("button.webpanel-suggestion")),i=n.map((e=>e.getAttribute("data-id"))).filter(Boolean);if(0===i.length||i.length!==n.length)return!1;let s,a=0,r=-1;switch(n.forEach((e=>{const t=e.getBoundingClientRect();r<t.left&&(a++,r=t.left)})),t){case"current":if(""===e||"first"===e?e=i[0]:"last"===e&&(e=i[0===this.props.keyAccess?i.length-1:0]),s=i.indexOf(e),-1===s)return!1;break;case"right":case"left":if(1===i.length)return!1;if(s=i.indexOf(e),-1===s)return!1;if("right"===t){if((s+1)%a==0)return!1;if(s+=1,s>=i.length)return!1}else{if(s%a==0)return!1;if(s-=1,s>=i.length)return!1}break;case"up":case"down":if(1===i.length)return!1;if(s=i.indexOf(e),-1===s)return!1;if("up"===t){if(s-=a,s<0)return!1;e=i[s]}else if(s+=a,s>=i.length)return!1;break;default:return!1}e=i[s];const l=o.querySelector(`button.webpanel-suggestion[data-id="${e}"]`);if(l)return l.focus(),!0}return!1};onHideCallout=()=>{this.state.drawerOpen&&this.onToggleCallout()};onToggleCallout=()=>{this.state.drawerOpen?this.closeDrawer():this.updateSuggestedSites().then((()=>{const e=Ce.ZP.getActivePage(this.context.vivaldiWindowId)?.url??"",t={drawerOpen:!0,url:pn.jk.getDisplayUrlFromMapping(e)};this._useOmni?Ov.Z.updateState(this._id,{typedUrl:e,autocompleteValue:""}):sb.updateState(this._id,{typedUrl:e,autocompleteValue:""}),this.setState(t),Ke.Z.bind("esc",this.closeDrawer)}))};onAddWebpanel=()=>{const{autocompleteValue:e}=this._useOmni?Rv.getUrlfieldState(this._id):rb.getUrlfieldState(this._id);let t=(e||this.state.editUrl||this.state.url||"").trim();0!==t.length&&(t=(0,rl.q9)(t),vr.Z.addByUrl(this.context.vivaldiWindowId,t,!0),this.closeDrawer())};onClickSuggested=e=>{let t,n="",i="";if(e.extension){const s=e.extension.sidePanel;if(!s)return;t=vr.Z.getExtPanelId(e.extension),n=s.url,i=s.activeUrl}else{if(0===e.url.length)return;n=(0,rl.q9)(e.url),i=n}const s={url:n??"",activeUrl:i??"",id:t};vr.Z.addBySpec(this.context.vivaldiWindowId,s),this.closeDrawer()};closeDrawer=()=>{Ke.Z.unbind("esc",this.closeDrawer),this.setState({drawerOpen:!1,url:"",editUrl:void 0})};preventContextMenu=e=>{e.stopPropagation()};render(){return kS(po.ZP,{id:"downloads",tooltip:(0,B.Z)("Add Web Panel"),image:Wi.ebB[this.props.size],alwaysMenu:!0,onClick:this.onToggleCallout,menu:this.props.menu,customizeMenu:this.props.customizeMenu,menuOrigin:this.props.menuOrigin,hidePopup:this.onHideCallout,popupClassName:"addwebpanel-wrapper",popupLabelledBy:"popup-label-addwebpanel",popupPosition:this.props.popupPosition,popupWidth:246,isPopupVisible:this.state.drawerOpen,draggable:this.props.draggable,onDragStart:this.props.onDragStart??Lr.Z,onDragEnd:this.props.onDragEnd??Lr.Z,onDrop:this.props.onDrop??Lr.Z,onDragEnter:this.props.onDragEnter??Lr.Z,onDragLeave:this.props.onDragLeave??Lr.Z,onDragOver:this.props.onDragOver??Lr.Z,mimeType:this.props.mimeType,name:this.props.name,size:this.props.size},void 0,(0,ss.jsx)("div",{ref:this.nodeRef,className:"addwebpanelcallout",onContextMenu:this.preventContextMenu,children:kS("form",{},void 0,kS("header",{},void 0,kS("h1",{id:"popup-label-addwebpanel"},void 0,(0,B.Z)("Add Web Panel"))),kS("div",{className:"webpanel-input"},void 0,this._useOmni?kS(ib,{className:"address",title:(0,B.Z)("Enter webpage address"),placeholder:"vivaldi.net",displayUrl:this.state.url,typedUrl:this.state.editUrl,autocompletionEnabled:!0,typedHistoryEnabled:!1,showDropdown:!1,pageId:this._id,pageContext:this._pageContext,inputId:this._id,autoFocus:!0}):kS(ZS,{className:"address",title:(0,B.Z)("Enter webpage address"),placeholder:"vivaldi.net",displayUrl:this.state.url,typedUrl:this.state.editUrl,autocompletionEnabled:!0,typedHistoryEnabled:!1,showDropdown:!1,pageId:this._id,pageContext:this._pageContext,inputId:this._id,autoFocus:!0}),kS("button",{className:"webpanel-suggestion add",tabIndex:0,onClick:this.onAddWebpanel,dangerouslySetInnerHTML:{__html:Wi.md4.small},tooltip:(0,B.Z)("Add Web Panel")})),this.state.suggestions&&this.state.suggestions.length>0&&kS("div",{className:"webpanel-suggestions"},void 0,kS("div",{className:"suggestions-list"},"list",this.state.suggestions.map(((e,t)=>{const{favIconUrl:n,favIconLoadType:i}=pn.jk.getBookmarkFavicon(e.url,e.faviconUrl),s=t.toString();return kS("button",{className:"webpanel-suggestion",tabIndex:0===t?0:this.props.keyAccess,"data-id":s,title:e.title+"\n"+e.url,onKeyDown:this.handleKeyDown.bind(this,"suggestion",s),onClick:()=>this.onClickSuggested(e)},t,kS(Ri.ZP,{url:n,loadType:i}))})))),kS("button",{className:"FormButton",onClick:()=>{this.closeDrawer(),tp.Z.edit(I.kToolbarsPanel)}},void 0,(0,B.Z)("Customize Panel...")))}))}}const DS=(0,dp.ZP)(PS);var MS=n(20676);const OS={getWebPanelBarMenu:function(){const e=C.Z.get(I.kPanelsWebToolbar);return[{handler:()=>vr.Z.setUIContent({showToolbar:!0}),isVisible:()=>!(!0===e.showToolbar),...(0,us.Z)("command","Show")},{handler:()=>vr.Z.setUIContent({showToolbar:!1}),isVisible:()=>!0===e.showToolbar,...(0,us.Z)("other","Hide")},{handler:()=>vr.Z.setUIContent({allControls:!e.allControls,showToolbar:e.showToolbar||!e.allControls}),type:"checkbox",checked:e.allControls,isVisible:()=>!0===e.showToolbar,...(0,us.Z)("Display Navigation Controls")},{handler:()=>vr.Z.setUIContent({deviceControl:!e.deviceControl,showToolbar:e.showToolbar||!e.allControls}),type:"checkbox",checked:e.deviceControl,isVisible:()=>!0===e.showToolbar,...(0,us.Z)("Display Device Control")},{handler:()=>vr.Z.setUIContent({zoomControls:!e.zoomControls,showToolbar:e.showToolbar||!e.allControls}),type:"checkbox",checked:e.zoomControls,isVisible:()=>!0===e.showToolbar,...(0,us.Z)("Display Zoom Controls")}]},getPromise:function(e,t,n){const i="panelbaritem",s=ji.Z.getOptionFunction(i),o=Ju.ZP.isWebPanel(t),a=o||Ju.ZP.isRegPanel(t),r=e=>{if(o)return vr.Z.getUrlById(e);switch(e){case"PanelBookmarks":return"vivaldi://bookmarks";case"PanelHistory":return"vivaldi://history";case"PanelDownloads":case"PanelWindow":case"PanelReadingList":case"PanelTranslate":case"PanelMail":case"PanelFeeds":case"PanelContacts":default:return"";case"PanelNotes":return"vivaldi://notes";case"PanelTasks":case"PanelCalendar":return"vivaldi://calendar"}},l=(t,n,i)=>{const s=r(t);s&&c.ZP.openURL(e,s,{inCurrent:n,inBackground:i})};return ji.Z.getNamedMenu(e,i,(async i=>{switch(i.action){case"CONTEXT_MENU_OPEN":return{isVisible:()=>r(t).length>0,...s(e,i,{})};case"CONTEXT_OPEN_IN_TAB":case"CONTEXT_OPEN_IN_NEW_TAB":return{handler:()=>l(t,"CONTEXT_OPEN_IN_TAB"===i.action,!1),isVisible:()=>r(t).length>0,...s(e,i,{})};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{handler:()=>l(t,!1,!0),isVisible:()=>r(t).length>0&&!C.Z.get(I.kTabsOpenNewInBackground),...s(e,i,{})};case"CONTEXT_OPEN_IN_NEW_WINDOW":case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":{const n=he.ZP.isGuest(),o="CONTEXT_OPEN_IN_NEW_WINDOW"===i.action;return{handler:()=>((t,n)=>{const i=r(t);i&&c.ZP.openURL(e,i,{inNewWindow:!0,incognito:n})})(t,!o),isVisible:()=>r(t).length>0&&!(o&&n),...s(e,i,{})}}case"CONTAINER_PERIODIC_RELOAD":case"CONTEXT_CONTAINER_PERIODIC_TIMER":return{...s(e,i,{}),items:MS.Z.getMenu(t,"panel",e),isVisible:()=>o};case"CONTEXT_COPY_ADDRESS":return{handler:()=>{const e=r(t);e&&Gp.Z.copyUrlToClipboard(e)},isVisible:()=>r(t).length>0,...s(e,i,{})};case"CONTEXT_DESKTOP_VERSION":return{handler:()=>vr.Z.setMobileMode(t,!1),isVisible:()=>o&&Boolean(n?.mobileMode),...s(e,i,{})};case"CONTEXT_MOBILE_VERSION":return{handler:()=>vr.Z.setMobileMode(t,!0),isVisible:()=>o&&!n?.mobileMode,...s(e,i,{})};case"CONTEXT_MUTE_PANEL":return{handler:e=>{jn.Z.setMuted(e.windowId,t,!Yn.ZP.getIsMuted(e.windowId,t))},isVisible:()=>o&&Yn.ZP.getSelected(e)===t,checked:Boolean(n?.muted),type:"checkbox",...s(e,i,{})};case"CONTEXT_SEPARATE_WIDTH":return{handler:()=>jn.Z.setPanelResizable(t,!Yn.ZP.getResizableByPanel(t)),checked:Yn.ZP.getResizableByPanel(t),isVisible:()=>a,...s(e,i,{})};case"CONTEXT_CONTAINER_FLOATING":{const n=C.Z.get(I.kPanelsAsOverlayEnabled);return{items:[{handler:()=>{const n=Yn.ZP.getSeparateFloating(t,e),i=C.Z.get(I.kPanelsAsOverlayEnabled);void 0===n&&i?jn.Z.setSeparateFloating(t,!1):jn.Z.setSeparateFloating(t,!n)},type:"checkbox",checked:Boolean(Yn.ZP.getSeparateFloating(t,e)),...(0,us.Z)("This Panel")},{handler:()=>w.Z.toggle(I.kPanelsAsOverlayEnabled,!0,!1),type:"checkbox",checked:Boolean(n),...(0,us.Z)("All Panels")},Qe.Z.separatorItem,{handler:()=>jn.Z.setSeparateFloating(t,void 0),...(0,us.Z)("Reset Panel Floating")}],isVisible:()=>a,...s(e,i,{})}}case"CONTEXT_CONTAINER_TOOLBAR":return{items:this.getWebPanelBarMenu(),isVisible:()=>o,...s(e,i,{})};case"CONTAINER_CLOSED_WEBPANEL":{const t={...s(e,i,{})};return 0===t.items?.length&&(t.isVisible=()=>!1),t}default:return{...s(e,i,{})}}}))}},xS=OS;var LS=n(80342);function RS(e,t){if(!e||!t||!/\d/.test(e))return{displayTitle:e,badgeText:""};let n=e.match(/^\((?<matchNumber>\d+)\D*?\)\s+(?<matchTitle>.*$)/);if(n?.groups?.matchNumber||(t.startsWith("https://mail.google.com/")?n=e.match(/^(?<matchTitle>.*[\(\[\{](?<matchNumber>\d+)[\}\]\)].*)$/):t.startsWith("https://app.fastmail.com/")&&(n=e.match(/^(?<matchNumber>[0-9]+)\u2009\u2022\u2009(?<matchTitle>.*)$/))),!n||!n.groups||n.length<2)return{displayTitle:e,badgeText:""};const i=parseInt(n.groups.matchNumber)||0,s=n.groups.matchTitle;return 0===i?{displayTitle:s,badgeText:""}:i.toString().length>2?{displayTitle:e,badgeText:"+"}:{displayTitle:s,badgeText:i.toString()}}const BS=[I.kMailCountersPanelSwitcherEnabled,I.kMailCountersPanelUnseenEnabled,I.kMailIsTurnedOff,I.kPanelsAsOverlayEnabled,I.kPanelsWebToolbar,I.kPanelsWindowShowUnread,I.kReadingListShowCounter,I.kTabsCounterDetection,I.kToolbarsPanel],FS={"--activeButton":1},WS={"--activeButton":0};class US extends Li.PureComponent{static contextType=ts.Z;_isWebPanel=!1;_isExtensionPanel=!1;_isDraggingOverButton=!1;_iconChecks=0;constructor(e,t){super(e),this._isWebPanel=Ju.ZP.isWebPanel(e.name),this._isExtensionPanel=vr.Z.isExtPanel(e.name);const n=[],i=this._isWebPanel&&!this._isExtensionPanel?US.#J(t.vivaldiWindowId,e,n):void 0;let s=0;if(this._isWebPanel&&!e.inEditor){const t=Xe.Z.getAlarmFromReloadId(e.name);t&&(s=60*t.periodInMinutes)}const o=Ce.ZP.unsafeGetActivePage(t.vivaldiWindowId);this.state={activePageId:o.id,isInternalPage:pn.jk.isInternalPage(o),openPanel:Yn.ZP.getIsContentVisible(t.vivaldiWindowId)?Yn.ZP.getSelected(t.vivaldiWindowId):null,counter:0,mailCounterState:{unseen:0,unread:0},progress:s,webPanelContent:i,panelExtensions:n}}componentDidMount(){if(this._isExtensionPanel&&se.Z.extensionActionUtils.getToolbarExtensions((e=>{const t=e.filter((e=>e.enabled&&e.sidePanel));this.setState({panelExtensions:t})})),!this.props.inEditor){switch(Yn.ZP.addListener(this._onPanelStoreChange,(e=>({windowData:e.windowData.get(this.context.vivaldiWindowId),webPanelList:e.webPanelList}))),this._isWebPanel&&Xe.Z.addListener(this._onPeriodicReloadStoreChanged),this.props.name){case"PanelDownloads":this._onDownloadStoreChange(),Ag.ZP.addListener(this._onDownloadStoreChange);break;case"PanelWindow":this._onPageStoreChange(),Ce.ZP.addListener(this._onPageStoreChange,this.context.selectWindow);break;case"PanelReadingList":this._onReadingStoreChange(),LS.Z.addListener(this._onReadingStoreChange);break;case"PanelMail":case"PanelFeeds":this._onMailCounterChange(),ht.Z.addListener(this._onMailCounterChange)}this._onPanelStoreChange(),this._isWebPanel&&this.state.webPanelContent?.faviconUrl===qe.Z&&this.context.requestAnimationFrame(this.checkIconLoaded)}}componentDidUpdate(e){if(this.props.name!==e.name||this.props.inEditor!==e.inEditor)throw new Error("PanelButton: Invalid props change")}componentWillUnmount(){if(!this.props.inEditor)switch(Yn.ZP.removeListener(this._onPanelStoreChange),this._isWebPanel&&Xe.Z.removeListener(this._onPeriodicReloadStoreChanged),this.props.name){case"PanelDownloads":Ag.ZP.removeListener(this._onDownloadStoreChange);break;case"PanelWindow":Ce.ZP.removeListener(this._onPageStoreChange);break;case"PanelReadingList":LS.Z.removeListener(this._onReadingStoreChange);break;case"PanelMail":case"PanelFeeds":ht.Z.removeListener(this._onMailCounterChange)}}checkIconLoaded=()=>{this._iconChecks++;const e=US.#J(this.context.vivaldiWindowId,this.props,this.state.panelExtensions);e?.faviconUrl!==qe.Z?this.setState({webPanelContent:e}):this._iconChecks<5&&this.context.requestAnimationFrame((()=>{setTimeout(this.checkIconLoaded,2e3)}))};_onPanelStoreChange=()=>{this._isWebPanel&&this.setState((e=>({webPanelContent:US.#J(this.context.vivaldiWindowId,this.props,e.panelExtensions)}))),this.setState({openPanel:Yn.ZP.getIsContentVisible(this.context.vivaldiWindowId)?Yn.ZP.getSelected(this.context.vivaldiWindowId):null})};static#J=(e,t,n)=>{const i=Yn.ZP.getWebPanel(e,t.name);if(i){const n=Yn.ZP.getMutedMap(e)?.get(t.name);return{title:i.title,url:i.url,activeUrl:i.activeUrl,muted:n,faviconUrl:i.faviconUrl,mobileMode:i.mobileMode}}let s=C.Z.get(I.kPanelsWebElements).find((e=>e.id===t.name));if(s||(s=C.Z.getDefault(I.kPanelsWebElements).find((e=>e.id===t.name))),t.inEditor||s||console.warn("Missing web panel, no fallback:",t.name),s)return{title:s.title??"",url:s.url,activeUrl:s.activeUrl,faviconUrl:s.faviconUrl,mobileMode:s.mobileMode};const o=n.find((e=>e.id===vr.Z.getExtIdFromPanel(t.name)));return o?.sidePanel?{title:o.name,url:o.sidePanel?.url,activeUrl:o.sidePanel?.activeUrl,faviconUrl:o.badgeIcon??qe.Z,mobileMode:!1}:void 0};_onPeriodicReloadStoreChanged=e=>{if(e)for(let t=0;t<e.length;t++){const n=e[t];if("panel"===n?.from&&this.props.name===n.id)return void this.setState({progress:n?.remainingTime})}Xe.Z.getAlarmFromReloadId(this.props.name)||this.setState({progress:0})};_onDownloadStoreChange=()=>{this.setState({counter:Ag.ZP.getTotalNumberOfDownloads(),progress:Ag.ZP.getTotalProgress()})};_onReadingStoreChange=()=>{this.setState({counter:LS.Z.getUnreadCount()})};_onPageStoreChange=()=>{this.setState({counter:Ce.ZP.getUnreadCount(this.context.vivaldiWindowId)})};_onMailCounterChange=()=>{const e="PanelMail"===this.props.name,t=ht.Z.getCounters(e?It.of:It.u4,e?It.tB:It.ym);this.setState({mailCounterState:{unseen:t?.unseen??0,unread:t?.unread??0}})};getTitleExtra=()=>{if(this._isWebPanel){const e=this.state.webPanelContent;if(e&&e.title)return e.url}return""};getTitle=()=>{if(this._isWebPanel){const e=this.state.webPanelContent;return e?e.title?e.title:e.url:""}return"PanelDownloads"===this.props.name&&this.state.progress>0?(0,B.Z)("Downloads")+" "+(0,B.Z)("($1 active transfer)","($1 active transfers)",[this.state.counter]):(0,Qf.wY)(this.props.name)};handleUp=e=>{e.preventDefault(),e.buttons&&(0!==e.buttons||(0,dp.W$)(e)&&he.ZP.isActive(this.context.vivaldiWindowId))||this.handleClick(e)};setSelected=e=>{jn.Z.toggleContent(this.context.vivaldiWindowId,e)};toggleMuted=e=>{jn.Z.setMuted(this.context.vivaldiWindowId,e,!Yn.ZP.getIsMuted(this.context.vivaldiWindowId,e))};handleClick=e=>{const t=this.context.vivaldiWindowId,n=this.props.name,{altKey:i,ctrlKey:s,shiftKey:o,metaKey:a}=e,r={altKey:i,ctrlKey:s,shiftKey:o,metaKey:a};if(e.button===es.Z.kCenter||e.button===es.Z.kLeft&&(0,As.S2)(r))switch(n){case"PanelBookmarks":de.Z.showBookmarks(t);break;case"PanelHistory":de.Z.showHistory(t);break;case"PanelNotes":de.Z.showNotes(t);break;case"PanelTasks":case"PanelCalendar":de.Z.showCalendar(t);break;case"PanelMail":de.Z.showMail(t);break;default:this._isWebPanel&&vr.Z.openInTab(t,n,!1,!0)}else(0,dp.W$)(e)&&he.ZP.isActive(this.context.vivaldiWindowId)||this.setSelected(n);de.Z.setPaneFocus(t,!1)};debounceOpeningPanel=(0,Ae.Z)((()=>{if(!this._isDraggingOverButton)return!1;this.setSelected(this.props.name)}),1500);_onPanelButtonDragEnter=(e,t)=>{(0,ms.ZP)(e),this._isDraggingOverButton=!0,this.debounceOpeningPanel()};_onPanelButtonDragLeave=()=>{this._isDraggingOverButton=!1};getPanelProps=()=>{let e=null,t="",n=!1;switch(this.props.name){case"PanelBookmarks":e="COMMAND_SHOW_BOOKMARK_PANEL",t=Wi.CLf[this.props.size];break;case"PanelHistory":e="COMMAND_SHOW_HISTORY_PANEL",t=Wi.hcy[this.props.size];break;case"PanelDownloads":e="COMMAND_SHOW_DOWNLOADS_PANEL",t=Wi.izi[this.props.size];break;case"PanelNotes":e="COMMAND_SHOW_NOTES_PANEL",t=Wi.cyI[this.props.size];break;case"PanelWindow":e="COMMAND_SHOW_WINDOW_PANEL",t=Wi.NxY[this.props.size],n=this.props.prefValues[I.kPanelsWindowShowUnread];break;case"PanelReadingList":e="COMMAND_SHOW_READING_LIST_PANEL",t=Wi.R_e[this.props.size],n=this.props.prefValues[I.kReadingListShowCounter];break;case"PanelTranslate":e="COMMAND_SHOW_TRANSLATE_PANEL",t=Wi.U_X[this.props.size];break;case"PanelMail":e="COMMAND_SHOW_MAIL_PANEL",n=this.props.prefValues[I.kMailCountersPanelSwitcherEnabled],t=Wi.lvj[this.props.size];break;case"PanelCalendar":e="COMMAND_SHOW_CALENDAR_PANEL",t=Wi.bcq[this.props.size];break;case"PanelTasks":e="COMMAND_SHOW_TASKS_PANEL",t=Wi.wo7[this.props.size];break;case"PanelFeeds":e="COMMAND_SHOW_FEEDS_PANEL",t=Wi.ZU_[this.props.size],n=this.props.prefValues[I.kMailCountersPanelSwitcherEnabled];break;case"PanelContacts":e="COMMAND_SHOW_CONTACTS_PANEL",t=Wi.LaO[this.props.size];break;case"PanelChat":t=Wi.yt5[this.props.size];break;case"PanelSession":e="COMMAND_SHOW_SESSION_PANEL",t=Wi.CnO[this.props.size]}return{commandId:e,showCounter:n,image:t}};getBadgeText=()=>{if(this._isWebPanel){const e=US.#J(this.context.vivaldiWindowId,this.props,this.state.panelExtensions)||this.state.webPanelContent;if(!e)return"";const t=this.props.prefValues[I.kTabsCounterDetection]?RS(e.title,e.activeUrl).badgeText:"";return 0!==this.state.counter?xf(this.state.counter):t}const{showCounter:e}=this.getPanelProps(),t=this.props.prefValues[I.kMailCountersPanelUnseenEnabled],{counter:n,mailCounterState:i}=this.state,s=i?.unread||i?.unseen?t?i.unseen:i.unread:n;return e&&0!==s?xf(s)??"":""};getWebPanelProps=e=>{if(!e)return null;const t=this.state.webPanelContent;return t?{mediaState:t.muted,faviconPath:t.faviconUrl}:null};menu=e=>{const t=this.context.vivaldiWindowId,{inEditor:n,name:i}=this.props;if(n)return Promise.resolve([]);if(e)return xS.getPromise(t,i);{const e=US.#J(t,this.props,this.state.panelExtensions);return xS.getPromise(t,i,e)}};buttonMenu=()=>this.menu(!1);addWebPanelButtonMenu=()=>this.menu(!0);renderToolbarButton=(e,t)=>{const{commandId:n,image:i}=this.getPanelProps();let s=this.getTitle();const o=this.getTitleExtra();let a,r,l,d;if(t){if(this._isExtensionPanel){const e=this.state.panelExtensions.find((e=>e.id===vr.Z.getExtIdFromPanel(this.props.name)));l=e?.badgeIcon??qe.Z,s=e?.name??s}else l=void 0;a="panel",r=this.toggleMuted}else l=i;"PanelDownloads"===e.name&&(d={"--downloadInProgress":this.state.progress?1:0});const c=this.state.openPanel===this.props.name,u=Fi()("panel-clickoutside-ignore",{"button-toolbar-webpanel":t,active:c});return(0,ss.jsx)(po.ZP,{...e,className:u,buttonClasses:Yn.ZP.getIsBarVisible(this.context.vivaldiWindowId)&&(c||!this.state.openPanel&&this.props.prefValues[I.kToolbarsPanel][0]===this.props.name)?"uifocusstop":void 0,onPanelButtonDragEnter:this._onPanelButtonDragEnter,onPanelButtonDragLeave:this._onPanelButtonDragLeave,buttonStyle:c?FS:WS,style:d,progress:null!==this.state.progress?Number(this.state.progress.toPrecision(2)):void 0,tooltip:s,tooltipExtra:o,roles:"tab",ariaControls:"ui-region-panel",onClick:this.handleUp,onMiddleClick:this.handleClick,menu:this.buttonMenu,image:l,badgeText:this.getBadgeText(),mediaStateType:a,toggleMuted:r,...this.getWebPanelProps(t),commandId:n})};render(){const e=this.context.vivaldiWindowId,{draggable:t,onDragStart:n,onDragEnd:i,onDrop:s,onDragEnter:o,mimeType:a,name:r,customizeMenu:l,popupPosition:d,menuOrigin:c,size:u}=this.props,p={draggable:t,onDragStart:n,onDragEnd:i,onDrop:s,onDragEnter:o,mimeType:a,name:r,customizeMenu:l,popupPosition:d,menuOrigin:c,size:u};return"PanelWeb"===this.props.name?(0,ss.jsx)(DS,{...p,id:"addwebpanel",menu:this.addWebPanelButtonMenu,keyAccess:-1}):this._isWebPanel?this.renderToolbarButton(p,!0):(this.props.inEditor||Yn.ZP.canRender({winId:e,panelId:this.props.name}))&&(this.props.inEditor||this.props.isMailWindow&&!this.props.prefValues[I.kMailIsTurnedOff]||!Yn.jM.includes(this.props.name))?!this.props.inEditor&&this.props.prefValues[I.kMailIsTurnedOff]&&Yn.ut.includes(this.props.name)?null:this.renderToolbarButton(p,!1):null}}const VS=(0,Bu.Z)(US,BS);var HS;function GS(e,t,n,i){HS||(HS="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:HS,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class $S extends Li.PureComponent{render(){const{entry:e}=this.props,t=(0,ge.Z)(this.props.entry.url)?.host||"";return(0,ss.jsxs)(ss.Fragment,{children:[GS(Ri.ZP,{size:32,style:e.read?{filter:"saturate(0) opacity(0.7)"}:{},url:e.url,title:e.url,loadType:"page"}),GS("div",{className:"readinglist-name",title:e.title.length>80?e.title:null,style:e.read?{filter:"opacity(0.7)"}:{}},void 0,GS("p",{className:"title"},void 0,e.title||t),e.title&&GS("p",{className:"info"},void 0,t)),GS("button",{type:"button",className:"ActionButton circular",onClick:t=>this.props.onClickMark(e.url,!e.read,t),title:e.read?(0,B.Z)("Mark as unread"):(0,B.Z)("command","Mark as read"),tabIndex:-1,dangerouslySetInnerHTML:{__html:e.read?Wi.sgm.small:Wi.D7r.small}}),GS("button",{type:"button",className:"ActionButton circular",onClick:t=>this.props.onClickRemove(e.url,t),title:(0,B.Z)("verb","Remove"),tabIndex:-1,dangerouslySetInnerHTML:{__html:Wi.M2k.small}})]})}}const KS=$S;var zS;function jS(e,t,n,i){zS||(zS="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:zS,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const YS=[I.kKeyboardTabToAll];class XS extends Li.PureComponent{static contextType=ts.Z;constructor(e){super(e),this.state={entries:LS.Z.getList()||[],urlValid:x.MT(this.props.url)}}componentDidMount(){LS.Z.addListener(this._onStoreChanged)}componentDidUpdate(e){e.url!==this.props.url&&this.setState({urlValid:x.MT(this.props.url)})}componentWillUnmount(){LS.Z.removeListener(this._onStoreChanged)}_onStoreChanged=()=>{this.setState({entries:LS.Z.getList()||[]})};onClickUrl=e=>{c.ZP.openURL(this.context.vivaldiWindowId,e,{singleton:!0}),x.Bz(e,!0),this.props.hidePopup()};onClickRemove=(e,t)=>{x.Od(e),(0,ms.ZP)(t)};onClickMark=(e,t,n)=>{x.Bz(e,t),(0,ms.ZP)(n)};onSave=e=>{const t=this.context.vivaldiWindowId,n=Ce.ZP.getActivePage(t);n&&x.IH(t,n.url,n.title),this.props.hidePopup(),(0,ms.ZP)(e)};onKeyDown=(e,t)=>{switch(t.key){case"Escape":(0,ms.ZP)(t),this.props.hidePopup();break;case"Enter":case" ":this.onClickUrl(e);break;case"Delete":case"Backspace":this.onClickRemove(e,t)}};renderDialogHeader=()=>jS("div",{className:"dialog-header",id:"popup-label-readinglist"},void 0,(0,B.Z)("Reading List"));renderEntry=(e,t)=>jS("div",{tabIndex:0,className:"readinglist-item-large",onClick:this.onClickUrl.bind(this,e.url),onKeyDown:this.onKeyDown.bind(this,e.url)},e.url,jS(KS,{onClickMark:this.onClickMark,onClickRemove:this.onClickRemove,entry:e}));renderReadingList=()=>{const e=this.state.entries.filter((e=>!e.read)),t=this.state.entries.filter((e=>e.read)),n=[];return e.length?n.push(jS("header",{},"header1",(0,B.Z)("Unread Articles"))):t.length&&n.push(jS("p",{className:"comment"},"all-done",(0,B.Z)("All articles read."))),e.forEach((e=>{n.push(this.renderEntry(e,!1))})),t.length&&n.push(jS("header",{},"header2",(0,B.Z)("Read Articles"))),t.forEach((e=>{n.push(this.renderEntry(e,!0))})),!e.length&&!t.length&&n.push(jS("p",{className:"comment"},"empty",(0,B.Z)("No articles in your reading list."))),n};renderAddCurrent=()=>jS("footer",{className:"dialog-footer"},void 0,jS("input",{className:"primary",type:"button",onClick:this.onSave,value:(0,B.Z)("Add Current Page"),disabled:!this.state.urlValid,autoFocus:!0}));render(){return jS("div",{className:"reading-list-dialog"},void 0,this.renderDialogHeader(),jS("div",{className:"readinglist-listing-large"},void 0,this.renderReadingList()),this.renderAddCurrent())}}const QS=(0,Bu.Z)(XS,YS);var qS;function JS(e,t,n,i){qS||(qS="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:qS,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const ew=[I.kReadingListShowCounter];class tw extends Li.PureComponent{static contextType=ts.Z;state={popupVisible:!1,readingListItems:LS.Z.getUnreadCount(),url:Ce.ZP.getActivePage(this.context.vivaldiWindowId)?.url??""};componentDidMount(){if(this.props.inEditor)return;const{selectWindow:e}=this.context;LS.Z.addListener(this._onReadingStoreChange),Ce.ZP.addListener(this._onPageStoreChange,e)}componentWillUnmount(){this.props.inEditor||(LS.Z.removeListener(this._onReadingStoreChange),Ce.ZP.removeListener(this._onPageStoreChange))}_onReadingStoreChange=()=>{const e=LS.Z.getUnreadCount();this.setState({readingListItems:e})};_onPageStoreChange=()=>{const e=Ce.ZP.getActivePage(this.context.vivaldiWindowId)?.url??"";this.setState({url:e})};togglePopup=()=>{this.setState((e=>({popupVisible:!e.popupVisible})))};hidePopup=()=>{this.setState({popupVisible:!1})};render(){const{readingListItems:e}=this.state,t=this.props.prefValues[I.kReadingListShowCounter]&&e>0?e>1e3?"999+":e.toString():void 0;return JS(po.ZP,{image:Wi.R_e[this.props.size],label:(0,B.Z)("Reading List"),tooltip:(0,B.Z)("Show the Reading List"),onClick:this.togglePopup,customizeMenu:this.props.customizeMenu,menuOrigin:this.props.menuOrigin,popupPosition:this.props.popupPosition,hidePopup:this.hidePopup,isPopupVisible:this.state.popupVisible,popupClassName:"ToolbarButtonPopup-DefaultStyles",popupLabelledBy:"popup-label-readinglist",popupWidth:350,size:this.props.size,badgeText:t,draggable:this.props.draggable,onDragStart:this.props.onDragStart??Lr.Z,onDragEnd:this.props.onDragEnd??Lr.Z,onDrop:this.props.onDrop??Lr.Z,onDragEnter:this.props.onDragEnter??Lr.Z,mimeType:this.props.mimeType,name:this.props.name??""},void 0,JS(QS,{hidePopup:this.hidePopup,url:this.state.url}))}}const nw=(0,Bu.Z)((0,dp.ZP)(tw),ew);var iw;function sw(e,t,n,i){iw||(iw="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:iw,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const ow=e=>{const{winId:t}=e,n=Li.useCallback((async function(e){const n=Ce.ZP.getActivePage(t);if(!n)return;const{ctrlKey:i,altKey:s,shiftKey:o,metaKey:a}=e,r={ctrlKey:i,altKey:s,shiftKey:o,metaKey:a},l=(0,As.S2)(r),d=pn.jk.isInternalUrl(n.url);if(!l||d)return void Ka.Z.enableCapture(t);const c=C.Z.get(I.kWebpagesCaptureSaveLocation),u=C.Z.get(I.kWebpagesCaptureCompressionFormat),{image:p}=await $a.Z.captureFullpage(n.id,u,c);$a.Z.handleCaptureLocation({windowId:t,mode:"fullpage",base64:p})}),[t]);return sw(po.ZP,{tooltip:(0,B.Z)("title","Capture Page"),onClick:n,image:Wi.z8c[e.size],size:e.size,customizeMenu:e.customizeMenu,draggable:e.draggable,menuOrigin:e.menuOrigin,onDragStart:e.onDragStart,onDragEnd:e.onDragEnd,onDrop:e.onDrop,onDragEnter:e.onDragEnter,mimeType:e.mimeType,popupClassName:"ToolbarButtonPopup-DefaultStyles",name:e.name})};function aw(e,t,n,i){const s=n.map((e=>e.getAttribute("data-id"))).filter(Boolean);if(s.length<=1)return!1;""===e&&(e=s[0]);let o=s.indexOf(e);if(-1===o)return!1;switch(t){case"current":break;case"right":o+=1;break;case"left":o-=1;break;case"down":o+=i;break;case"up":o-=i;break;default:return!1}if(o<0||o>=s.length)return!1;const a=n[o];return!!a&&(a.focus(),!0)}var rw;function lw(e,t,n,i){rw||(rw="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:rw,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class dw extends Li.PureComponent{refActionList=Li.createRef();state={pageactionFiles:[],drawerOpen:!1,currentTarget:null,scriptOverrides:[],contentScripts:ie.Z.getState()};componentDidMount(){se.Z.pageActions.onOverridesChanged.addListener(this.onOverridesChanged),ie.Z.addListener(this.newScriptUpdateList),this.updateScriptOverrides()}componentWillUnmount(){ie.Z.removeListener(this.newScriptUpdateList),se.Z.pageActions.onOverridesChanged.removeListener(this.onOverridesChanged)}componentDidUpdate(e){this.props.pageId!==e.pageId&&this.updateScriptOverrides()}newScriptUpdateList=()=>{const e=ie.Z.getScripts();this.setState({contentScripts:e})};onOverridesChanged=e=>{e===this.props.pageId&&this.updateScriptOverrides()};updateScriptOverrides=()=>{se.Z.pageActions.getScriptOverridesForTab(this.props.pageId,(e=>{this.setState({scriptOverrides:e})}))};togglePopup=()=>{this.setState((e=>({drawerOpen:!e.drawerOpen})))};hidePopup=()=>{this.state.drawerOpen&&this.setState({drawerOpen:!1})};onItemClicked=(e,t)=>{this.isScriptEnabled(e)?se.Z.pageActions.setScriptOverrideForTab(e,this.props.pageId,"no_override",(()=>{})):se.Z.pageActions.setScriptOverrideForTab(e,this.props.pageId,"enabled",(()=>{}))};hasScriptOverrides=()=>0!==this.state.scriptOverrides.length;isScriptEnabled=e=>{const t=this.state.scriptOverrides.find((t=>t.script===e));return!!t&&"enabled"===t.override};keyDownHandler=(e,t)=>{switch(t.key){case"ArrowUp":this.moveFocus(e,"up");break;case"ArrowDown":this.moveFocus(e,"down");break;default:return}t.preventDefault(),t.stopPropagation()};moveFocus=(e,t)=>{const n=this.refActionList.current;if(n){aw(e,t,Array.from(n.querySelectorAll(".item")),1)}};render(){return lw(po.ZP,{tooltip:(0,B.Z)("Page Actions"),disabled:this.props.disabled,isPopupVisible:this.state.drawerOpen,isOn:this.hasScriptOverrides(),onClick:this.togglePopup,hidePopup:this.hidePopup,image:Wi.jVs[this.props.size],size:this.props.size,customizeMenu:this.props.customizeMenu,menuOrigin:this.props.menuOrigin,popupPosition:this.props.popupPosition,hasLightArrow:"above"===this.props.popupPosition,popupWidth:225,draggable:this.props.draggable,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,onDrop:this.props.onDrop,onDragEnter:this.props.onDragEnter,mimeType:this.props.mimeType,popupClassName:"ToolbarButtonPopup-DefaultStyles",popupLabelledBy:"popup-label-pageactions",name:this.props.name,style:{"--pageActionActive":this.hasScriptOverrides()?1:0}},void 0,lw("h2",{id:"popup-label-pageactions"},void 0,(0,B.Z)("Page Actions")),(0,ss.jsx)("div",{className:"popup-scrollarea",ref:this.refActionList,children:this.state.contentScripts.map(((e,t)=>{const n=t.toString();return lw("label",{"data-id":n,className:"item",onKeyDown:this.keyDownHandler.bind(this,n)},t,lw("input",{autoFocus:0===t,type:"checkbox",onChange:this.onItemClicked.bind(this,e),checked:this.isScriptEnabled(e)}),lw("span",{},void 0,(0,oe.gD)(e)))}))}))}}const cw=dw;var uw,pw=n(30626),hw=n(22303),gw=n(37646),mw=n(47825),fw=n(71828);function vw(e,t,n,i){uw||(uw="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:uw,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var yw=vw("input",{type:"range",min:"0",max:"2",value:"1",readOnly:!0});class bw extends Li.PureComponent{static contextType=ts.Z;state={disabled:!pw.Z.getActiveWebView(this.context.vivaldiWindowId),defaultPageZoom:mw.Z.getDefaultPageZoom(),zoom:mw.Z.getZoom(),notesZoom:mw.Z.getNotesZoom(),isNoteWebView:!1};componentDidMount(){mw.Z.addListener(this._onZoomStoreChanged),i.Z.tabs.onZoomChange.addListener(this._onTabZoomChange),se.Z.tabsPrivate.onPageZoom.addListener(this._onPageZoom),pw.Z.addListener(this._onActiveWebViewStoreChanged),this._onActiveWebViewStoreChanged()}componentWillUnmount(){pw.Z.removeListener(this._onActiveWebViewStoreChanged),i.Z.tabs.onZoomChange.removeListener(this._onTabZoomChange),se.Z.tabsPrivate.onPageZoom.removeListener(this._onPageZoom),mw.Z.removeListener(this._onZoomStoreChanged)}_onActiveWebViewStoreChanged=()=>{const e=pw.Z.getActiveWebView(this.context.vivaldiWindowId);e&&e.getZoom((t=>{this._updateZoomState(this.rangeCheck(t),e.name)}));const t={disabled:!e};e||(t.zoom=1),this.setState(t)};_onZoomStoreChanged=()=>{const{defaultPageZoom:e,zoom:t,notesZoom:n}=mw.Z.getState();this.setState({defaultPageZoom:e,zoom:t,notesZoom:n})};_onTabZoomChange=e=>{const t=pw.Z.getActiveWebView(this.context.vivaldiWindowId);t&&t.getZoom((n=>{n===e.oldZoomFactor&&e.tabId===this.props.pageId&&this._updateZoomState(e.newZoomFactor,t.name)}))};_onPageZoom=(e,t)=>{if(e!==this.context.vivaldiWindowId)return;const n=pw.Z.getActiveWebView(e);n&&n.getZoom((e=>{e+=.1*t,this._updateZoomState(e,n.name)}))};_updateZoomState=(e,t)=>{"markdowneditor"===t||"richtexteditor"===t?this.setState({notesZoom:e,isNoteWebView:!0}):this.setState({zoom:e,isNoteWebView:!1})};setZoomLevel=e=>{hw.Z.setPageZoom(this.context.vivaldiWindowId,this.rangeCheck(e))};rangeCheck=e=>Math.min(Math.max(e,fw.XF),fw.qt);render(){const{disabled:e,zoom:t,notesZoom:n,isNoteWebView:i,defaultPageZoom:s}=this.state,o=this.props.draggable,a=this.props.onDrop&&this.props.onDragEnter;return(0,ss.jsxs)("div",{...(0,dp.uu)({draggable:this.props.draggable,onDragStart:o?this.props.onDragStart:null,onDragEnd:o?this.props.onDragEnd:null,onDragEnter:a?this.props.onDragEnter:void 0,onDragOver:a?this.props.onDragOver:null,onDragLeave:a?this.props.onDragLeave:null,onDrop:a?this.props.onDrop:null}),className:this.props.buttonClasses,name:"Zoom",onContextMenu:e=>(0,cs.Z)(this.context,this.props.customizeMenu??[])(e),children:[this.props.preview&&yw,!this.props.preview&&vw(gw.Z,{zoom:i?n:t,scrolling:!0,inFooter:!0,defaultZoomLevel:s,maxLevel:fw.qt,minLevel:fw.XF,step:fw.Zh,disabled:e,customizeMenu:this.props.customizeMenu,onZoomUpdated:this.setZoomLevel},"zoomslider")]})}}const Sw=(0,dp.ZP)(bw);var ww;function Cw(e,t,n,i){ww||(ww="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:ww,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var Aw=Cw("li",{className:"divider"});class Iw extends Li.PureComponent{static contextType=ts.Z;nodeRef=Li.createRef();componentDidUpdate(e){if(this.props.isSelected&&!e.isSelected){const{HTMLElement:e}=this.context,t=this.nodeRef.current;t instanceof e&&t.scrollIntoViewIfNeeded(!1)}}#ee=e=>{e.button!==es.Z.kLeft?e.stopPropagation():this.props.onItemActivated(this.props.item,e)};#te=()=>{this.props.setSelected(this.props.index)};#ne=()=>Cw("span",{},void 0,this.props.item.name);#ie=()=>{if(this.props.item.shortcut&&!1!==this.props.showShortcut){return Cw("span",{"aria-hidden":!0,className:"shortcut"},void 0,this.props.item.noPrettifying?this.props.item.shortcut:(0,vp.$)(this.props.item.shortcut))}return null};#se=()=>{if(this.props.item.iconSVG)return Cw("span",{dangerouslySetInnerHTML:{__html:this.props.item.iconSVG}});if(this.props.item.faviconUrl)return Cw(Ri.ZP,{url:this.props.item.faviconUrl,loadType:"faviconFromCache"});return Cw("img",{src:this.props.item.icon?this.props.item.icon:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"})};#oe=()=>{const e=this.props.item.type||"Normal";return(0,ss.jsxs)("li",{ref:this.nodeRef,className:Fi()({selectedItem:this.props.isSelected}),onMouseOver:this.#te,onMouseDown:ms.ZP,onMouseUp:this.#ee,role:"menuitem","aria-selected":this.props.isSelected,id:"dm_"+this.props.index,children:["Normal"===e&&Cw("a",{tabIndex:"0"},void 0,Cw("label",{className:"menu-icon"},void 0,this.#se()),Cw("label",{className:"menu-label"},void 0,this.#ne(),this.#ie())),"Description"===e&&Cw("a",{tabIndex:"0",className:"menu-item-description-container"},void 0,Cw("label",{className:"menu-icon"},void 0,this.#se()),Cw("label",{className:"menu-label"},void 0,this.#ne(),this.#ie()),Cw("label",{className:"menu-description"},void 0,this.props.item.description)),"Checkbox"===e&&Cw("a",{tabIndx:"0"},void 0,Cw("label",{},void 0,Cw("span",{className:"menu-icon"},void 0,Cw("input",{type:"checkbox",checked:this.props.item.checked,readOnly:!0})),Cw("span",{className:"menu-label"},void 0,this.#ne()))),"Radio"===e&&Cw("a",{tabIndex:"0"},void 0,Cw("label",{},void 0,Cw("span",{className:"menu-icon"},void 0,Cw("input",{className:"menu-icon",type:"radio",name:"radiomenu",checked:this.props.item.checked,readOnly:!0})),Cw("span",{className:"menu-label"},void 0,this.#ne())))]})};render(){return"Separator"===this.props.item.type?Aw:this.#oe()}}const Tw=Iw;var Zw,Ew=n(34155);function kw(e,t,n,i){Zw||(Zw="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Zw,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class _w extends Li.PureComponent{static contextType=ts.Z;nodeRef=Li.createRef();state={selectedItemIndex:this.props.items.findIndex((e=>e.id===this.props.selectedItem?.id))};componentDidMount(){this.context.requestAnimationFrame((()=>this.#ae()))}getNode(){return this.nodeRef.current}#ae=()=>this.getNode()?.focus();#re=()=>{Ew.nextTick((()=>{const{HTMLElement:e}=this.context,t=this.getNode();t instanceof e&&t.addEventListener("keydown",this.#le)}))};#le=e=>{switch(e.preventDefault(),e.which){case xa.Z.KEY_SPACE:case xa.Z.KEY_RETURN:const t=this.state.selectedItemIndex;t>=0&&t<=this.#de()&&this.#ce(this.props.items[t],e);break;case xa.Z.KEY_ESCAPE:this.props.onClose?.();break;case xa.Z.KEY_UP:this.#ue(!1);break;case xa.Z.KEY_DOWN:this.#ue(!0);break;default:e.stopPropagation()}};#ue=e=>{let t=this.state.selectedItemIndex;if(0!==this.props.items.filter((e=>"Separator"!==e.type)).length){do{t+=e?1:-1,t=(t+this.props.items.length)%this.props.items.length}while("Separator"===this.props.items[t].type);this.#pe(t)}};#de=()=>this.props.items.length-1;#pe=e=>{"Separator"===this.props.items[e].type||e>this.#de()||this.setState({selectedItemIndex:e})};#he=e=>{e.preventDefault(),e.stopPropagation();const{HTMLElement:t}=this.context,n=e.nativeEvent.target;n&&n instanceof t&&n.focus()};#ce=(e,t)=>{t.stopPropagation(),this.props.onItemActivated(e)};handleClickOutside=e=>{this.props.onClose?.()};render(){return kw("div",{className:Fi()("menu",this.props.className)},void 0,(0,ss.jsx)("ul",{ref:this.nodeRef,onMouseEnter:this.#ae,onMouseDown:this.#he,onMouseUp:this.#he,tabIndex:"0",onFocus:this.#re,id:this.props.id,role:"menu","aria-labelledby":this.props.id?this.props.id+"_button":void 0,"aria-activedescendant":"dm_"+this.state.selectedItemIndex,children:this.props.items.map(((e,t)=>kw(Tw,{index:t,item:e,showShortcut:this.props.showShortcuts,isSelected:this.state.selectedItemIndex===t,setSelected:this.#pe,onItemActivated:this.#ce},t)))}))}}const Nw=(0,sy.Z)(_w);var Pw;function Dw(e,t,n,i){Pw||(Pw="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Pw,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Mw="select-engine";function Ow({onClick:e,icon:t,isOpen:n}){return Dw(po.ZP,{onClick:e,tooltip:(0,B.Z)("Change search engine"),faviconPath:t,faviconLoadType:"faviconFromCache",ariaHaspopup:"true",ariaExpanded:n,ariaControls:Mw,id:Mw+"_button"})}function xw({onClick:e,isOpen:t}){return Dw(po.ZP,{onClick:e,tooltip:(0,B.Z)("Change search engine"),image:Wi.L$F,ariaHaspopup:"true",ariaExpanded:t,ariaControls:Mw})}class Lw extends Li.PureComponent{onItemClicked=({id:e})=>{this.props.onItemClicked(e)};render(){return Dw(Li.Fragment,{},void 0,Dw("div",{className:"toolbar-insideinput SearchEngineSelect-Icon"},void 0,this.props.useFavicon?Dw(Ow,{onClick:this.props.toggleOpen,icon:this.props.icon,isOpen:this.props.isOpen}):Dw(xw,{onClick:this.props.toggleOpen,isOpen:this.props.isOpen})),this.props.isOpen&&Dw(Nw,{items:this.props.items,onClose:this.props.onClose,onItemActivated:this.onItemClicked,showShortcuts:this.props.showKeywords,id:Mw}))}}const Rw=Lw;const Bw=new class{setText(e,t){const n=Ce.ZP.getActivePage(e);n&&A.Z.dispatch({actionType:"SEARCH_FIELD_SET_TEXT",tabId:n.id,text:t})}},Fw={};class Ww extends hr.Z{getText(e){const t=Ce.ZP.getActivePage(e);return t?Fw[t.id]??"":""}dispatchAction(e){switch(e.actionType){case"SEARCH_FIELD_SET_TEXT":t=e.tabId,n=e.text,Fw[t]=n,Uw.emitChange();break;case"CHROME_TABS_REMOVED":!function(e){delete Fw[e]}(e.tabId)}var t,n}}const Uw=new Ww(A.Z),Vw=Uw;var Hw,Gw=n(36246),$w=n(34155);function Kw(e,t,n,i){Hw||(Hw="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Hw,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const zw="select-search-history",jw=[I.kAddressBarSearchDisplay,I.kAddressBarSearchFieldWidth,I.kAddressBarSearchInNewTab,I.kAddressBarSearchKeepSelected,I.kAddressBarSearchShowFavicon,I.kAddressBarSearchShowKeyword,I.kAddressBarSearchSuggestEnabled,I.kAddressBarSearchTypedHistoryEnabled,I.kAddressBarVisible,I.kKeyboardTabToAll,I.kStartpageSpeedDialTrackerSuggestionShow,I.kAddressBarSearchKeepTypedText,I.kAddressBarSearchDirectMatchEnabled];function Yw({onClick:e,tabIndex:t}){return Kw("div",{className:"toolbar toolbar-insideinput"},void 0,Kw("div",{className:"button-toolbar drop-down-menu"},void 0,Kw("button",{type:"submit",onMouseDown:e=>e.preventDefault(),tabIndex:t,title:(0,B.Z)("verb","Search"),className:"SearchField-ExecuteSearchButton ignore-react-onclickoutside",onClick:e,dangerouslySetInnerHTML:{__html:Wi.S$A.small}})))}class Xw extends Li.PureComponent{static contextType=ts.Z;_isPasting=!1;_isIMEOpen=!1;_justClosedIME=!1;_isOnSpeedDial="speed_dial_view"===this.props.origin;_refSearchField=Li.createRef();_omniDropdownRef=Li.createRef();_suppressReplace=!1;state={dropdownSelectionIndex:0,editText:Vw.getText(this.context.vivaldiWindowId),typedValue:"",isOmniDropdownOpen:!1,showAll:!1,showPopup:!1,searchEngineSelectItems:[],currentSearchEngine:void 0,selectedItem:void 0,numberOfSelectableItems:0,isSearchEngineSelectOpen:!1,dropdownItems:[]};componentDidMount(){this._onSearchEngineCacheChanged(),this._onSearchFieldStoreChanged(),ai.Z.addListener(this._onSearchEngineCacheChanged),Vw.addListener(this._onSearchFieldStoreChanged),No.Z.addListener(this._onWebpageviewStoreChanged)}componentWillUnmount(){ai.Z.removeListener(this._onSearchEngineCacheChanged),Vw.removeListener(this._onSearchFieldStoreChanged),No.Z.removeListener(this._onWebpageviewStoreChanged)}_onWebpageviewStoreChanged=e=>{e.winId===this.context.vivaldiWindowId&&"WEBPAGEVIEW_ACTIONS"===e.type&&("searchPasteAndGo"===e.action?e.payload&&this.context.document.activeElement===this._refSearch&&$w.nextTick((()=>this._pasteAndGo(e.payload))):"focusSearchField"===e.action&&("button"===this.props.prefValues[I.kAddressBarSearchDisplay]&&this.toggleHiddenSearchFieldPopup(),$w.nextTick(this.focusField)))};_pasteAndGo=({openOptions:e,clipboardText:t})=>{this._search({value:t,openOptions:e})};_onSearchEngineCacheChanged=()=>{this.setState(((e,t)=>{const n=ai.Z.get().map((e=>({name:e.name,faviconUrl:e.faviconUrl,shortcut:e.keyword,noPrettifying:!0,guid:e.guid}))),i=t.prefValues[I.kAddressBarSearchKeepSelected],s=he.ZP.isIncognito(this.context.vivaldiWindowId);let o;return o=this._isOnSpeedDial&&i?ai.Z.getSpeeddialsSearch(s):ai.Z.getSearchField(s),{currentSearchEngine:o,searchEngineSelectItems:n}}))};_onSearchFieldStoreChanged=()=>{const{document:e}=this.context,t={};e.activeElement===this._refSearch&&(t.editText=Vw.getText(this.context.vivaldiWindowId)),this.setState(t)};_onCompositionStart=()=>{this._isIMEOpen=!0};_onCompositionEnd=()=>{this._isIMEOpen=!1,this._justClosedIME=!0};_updateCurrentEngine=e=>{this.setState({currentSearchEngine:e},(()=>{if(this.props.prefValues[I.kAddressBarSearchKeepSelected]){const t=he.ZP.isIncognitoOrGuest(this.context.vivaldiWindowId),n=this._isOnSpeedDial?t?"defaultSpeeddialsPrivate":"defaultSpeeddials":t?"defaultSearchFieldPrivate":"defaultSearchField";se.Z.searchEngines.setDefault(n,e.guid)}}))};_search=({value:e,openOptions:t})=>{const{document:n}=this.context;this._abortController&&this._abortController.abort(),this._refSearch&&n.activeElement===this._refSearch&&this._refSearch.blur();const{typedValue:i,selectedItem:s}=this.state,o=this.props.prefValues[I.kAddressBarSearchKeepTypedText],a=e,r={editText:a};o||(r.editText="",r.typedValue=""),this.setState(r),Bw.setText(this.context.vivaldiWindowId,o?a:"");let l=!t||!1!==t.inCurrent;this.props.prefValues[I.kAddressBarSearchInNewTab]&&(this._isOnSpeedDial||(l=!1));const d={...t,inCurrent:l,addTypedSearchHistory:!0};if(s&&dy(s)&&t)return ay(s.destinationUrl,this.context.vivaldiWindowId,{...t,fromUrlField:!1}),void this._hideDropdown();const c=ai.Z.getByQuery(i);var u,p;if(u=e,e=(p=c)&&u.startsWith(p.keyword+" ")?u.slice(p.keyword.length+1):u,c&&this._updateCurrentEngine(c),e.length>0&&this.state.currentSearchEngine){this.onSearch(e,this.state.currentSearchEngine,d);const t=he.ZP.isIncognito(this.context.vivaldiWindowId),n=ai.Z.getSearchField(t);!this.props.prefValues[I.kAddressBarSearchKeepSelected]&&n&&this._updateCurrentEngine(n)}};onSearch=(e,t,n={})=>{oy.Z.goSearchUrl(this.context.vivaldiWindowId,e.trim(),{useSearchEngine:t,...n}),this._hideDropdown()};moveNavigation=e=>{const{dropdownSelectionIndex:t,dropdownItems:n}=this.state;let i=t;"up"===e?i=0===t?n.length-1:t-1:"down"===e&&(i=t===n.length-1?0:t+1),this.setSelectedItemFromDropdown(n[i]),this.setState({dropdownSelectionIndex:i})};onKeyDowned=e=>{this._justClosedIME=!1;const t=e.shiftKey&&!e.ctrlKey&&!e.altKey&&!e.metaKey,n=!(0,ps.Z)(e),{isOmniDropdownOpen:i}=this.state;switch(e.key){case"ArrowUp":return void(i&&(0,ms.ZP)(e));case"ArrowDown":return void(t&&this.onKeyPressed(e));case"Tab":if(!i)return;return n&&((0,ms.ZP)(e),$w.nextTick((()=>this.moveNavigation("down")))),void(t&&((0,ms.ZP)(e),$w.nextTick((()=>this.moveNavigation("up")))));case"Escape":return(0,ms.ZP)(e),"button"===this.props.prefValues[I.kAddressBarSearchDisplay]&&this.props.prefValues[I.kAddressBarVisible]||this.setState((e=>({editText:e.typedValue}))),void this._esc();case"Enter":return void(n||this.onKeyPressed(e))}};onExecuteSearchButtonClick=e=>{const t={ctrlKey:e.ctrlKey,altKey:!1,shiftKey:e.shiftKey||e.altKey,metaKey:e.metaKey},n=(0,La.ZP)(this.context.vivaldiWindowId,t),i=this.state.selectedItem?this.state.selectedItem.destinationUrl||"":this.state.typedValue;this._search({value:i,openOptions:n})};onKeyPressed=e=>{const{key:t,shiftKey:n,currentTarget:i}=e;switch(t){case"Enter":{this._justClosedIME=!1,this._abortController&&this._abortController.abort();const t={ctrlKey:e.ctrlKey,altKey:!1,shiftKey:e.shiftKey||e.altKey,metaKey:e.metaKey},n=(0,La.ZP)(this.context.vivaldiWindowId,t);return void this._search({value:i.value,openOptions:n})}case"ArrowDown":return void 0;case"Tab":return void this._hideDropdown()}};onSearchEngineChanged=e=>{const t=this._refSearch?this._refSearch.value:"";this._refSearch&&""===t&&this._refSearch.focus();const n=ai.Z.getByGuid(e);if(t.length>0&&n){const e={addTypedSearchHistory:!0,inCurrent:!0!==this.props.prefValues[I.kAddressBarSearchInNewTab]};this.onSearch(t,n,e)}n&&this._updateCurrentEngine(n),this.setState({isSearchEngineSelectOpen:!1})};onDeleteItem=e=>{};_showDropdown=e=>{if(!0===this._isPasting)return;const{document:t}=this.context;let n=e?.showAll;if("boolean"!=typeof n&&(n=!1),this.setState({showAll:n}),!this.state.isOmniDropdownOpen){const{dropdownItems:e}=this.state;this._refSearch&&t.activeElement!==this._refSearch&&this._refSearch.focus(),this.setState({isOmniDropdownOpen:!0,selectedItem:e[0]},(()=>{this.setAutocompleteHighlight(0,!0)}))}};_hideDropdown=()=>{this.state.isOmniDropdownOpen&&this.setState({selectedItem:void 0,isOmniDropdownOpen:!1,showAll:!1})};setAutocompleteHighlight=(e,t)=>{this.setState({dropdownSelectionIndex:e}),t&&this.setState((e=>({editText:this.getEditText(e.selectedItem)})))};_esc=()=>{if(this._isIMEOpen||this._justClosedIME)this._justClosedIME=!1;else{if(this.state.isOmniDropdownOpen)this._hideDropdown();else if(this.state.isSearchEngineSelectOpen)this.closeSearchEngineSelect();else if(this.state.editText)this.setState({typedValue:""}),Bw.setText(this.context.vivaldiWindowId,"");else{this.state.showPopup&&this.hideSearchField(),this.onBlur();const e=Ce.ZP.getActivePage(this.context.vivaldiWindowId);e&&af.Z.doAction(this.context.vivaldiWindowId,e.id,"focusWebView")}this._justClosedIME=!1}};_onDelete=()=>{this.state.selectedItem};_onKeyboardChanged=(e,t,n,i)=>{if(t&&0===n)switch(i){case xa.Z.KEY_DOWN:if(this._isIMEOpen)return;!0===this.state.isOmniDropdownOpen?this.moveNavigation("down"):this.setState({isSearchEngineSelectOpen:!0});break;case xa.Z.KEY_UP:this._isIMEOpen||this.moveNavigation("up");break;case xa.Z.KEY_END:this.setAutocompleteHighlight(this.state.numberOfSelectableItems-1,!0);break;case xa.Z.KEY_ESCAPE:"button"===this.props.prefValues[I.kAddressBarSearchDisplay]&&this.props.prefValues[I.kAddressBarVisible]||this.context.document.activeElement===this._refSearch||this._esc();break;case xa.Z.KEY_HOME:this.setAutocompleteHighlight(0,!0);break;case xa.Z.KEY_PAGE_DOWN:this.moveNavigation("down");break;case xa.Z.KEY_PAGE_UP:this.moveNavigation("up");break;case xa.Z.KEY_DELETE:this._onDelete()}};onFocus=()=>{se.Z.tabsPrivate.onKeyboardChanged.addListener(this._onKeyboardChanged)};onBlur=()=>{const{getSelection:e}=this.context,t=e();t&&t.empty(),se.Z.tabsPrivate.onKeyboardChanged.removeListener(this._onKeyboardChanged)};onMouseDown=e=>{const{document:t}=this.context;this._focusedOnMouseDown=t.activeElement};onMouseUp=({currentTarget:e})=>{const{document:t}=this.context;t.activeElement===e&&(this._focusedOnMouseDown!==this._refSearch&&e.selectionStart===e.selectionEnd&&e.select(),this._focusedOnMouseDown=void 0)};onDoubleClick=e=>{(0,ms.ZP)(e)};onPaste=e=>{this._isPasting=!0,setTimeout((()=>this._isPasting=!1),5)};onChange=({currentTarget:{value:e}})=>{Bw.setText(this.context.vivaldiWindowId,e);const t=e.length>0&&e.indexOf(" ")>=1?ai.Z.getByQuery(e):null;if(t)return this.setState({currentSearchEngine:t,typedValue:"",editText:"",dropdownItems:[],dropdownSelectionIndex:0,selectedItem:void 0,isOmniDropdownOpen:!1}),void this._updateCurrentEngine(t);e.trim().length>1?this.performSearch(e):this.setState({dropdownSelectionIndex:0,typedValue:e,selectedItem:void 0,dropdownItems:[]})};onDragStart=e=>{this._suppressReplace=!0};onDragOver=e=>{e.stopPropagation()};onDragEnter=e=>{if(e.stopPropagation(),this._suppressReplace)return;e.preventDefault();const{HTMLInputElement:t}=this.context,n=e.target;n instanceof t&&""!==n.value&&n.classList.add("pseudo-selected")};onDragLeave=e=>{if(!this._suppressReplace){const{HTMLInputElement:t}=this.context,n=e.target;n instanceof t&&n.classList.remove("pseudo-selected")}};onDropped=e=>{if(this._suppressReplace)this._suppressReplace=!1;else{const t=e.dataTransfer.getData("text/plain");""!==t&&(e.preventDefault(),this.setState({editText:t}),Bw.setText(this.context.vivaldiWindowId,t));const{HTMLInputElement:n}=this.context,i=e.target;i instanceof n&&i.classList.remove("pseudo-selected")}};onToggleDropdownClicked=e=>{e.preventDefault(),"click"===e.type&&0!==e.clientX&&0!==e.clientY||(this.state.isOmniDropdownOpen?this._hideDropdown():(this._onSearchFieldStoreChanged(),this._showDropdown({showAll:!0})))};onSlidebarPosition=(e,t)=>{if(this._refSearchField.current){const t=this._refSearchField.current.getBoundingClientRect();w.Z.set(I.kAddressBarSearchFieldWidth,Math.floor(t.right-e))}};performSearch=e=>{ly(e).then((t=>{const n=this.props.prefValues[I.kAddressBarSearchDirectMatchEnabled];let i=t.filter((e=>uy(e)||n&&dy(e)));n&&(i=this.moveDirectMatch(i));const s=i.findIndex((t=>t.contents===e));if(0!==s){const e=i[s];i.splice(s,1),i.splice(0,0,e)}this.setState({dropdownItems:i,selectedItem:i[0],dropdownSelectionIndex:0,typedValue:e,showAll:!1},(()=>this._showDropdown()))}))};moveDirectMatch=e=>{const t=e.findIndex((e=>dy(e)));if(0===t){const n=e[t];e.splice(t,1),e.splice(1,0,n)}return e};getWidth=()=>(0,Gw.Z)(this.props.prefValues[I.kAddressBarSearchFieldWidth],175,800);focusField=()=>{this._refSearch?.select()};onOmniDropdownItemClicked=(e,t)=>{this.setState({selectedItem:e},(()=>this._search({value:e.contents,openOptions:t})))};onContextMenu=e=>{e.stopPropagation()};setSelectedItemFromDropdown=e=>{const t=this.getEditText(e);this.setState({selectedItem:e,editText:t})};getEditText=e=>e&&e.destinationUrl?dy(e)?e.description:e.contents:"";getDropdownItems=e=>this.state.dropdownItems;renderDropdown=()=>{const e=this.getDropdownItems(this.state.showAll);return 0===e.length?null:(0,ss.jsx)(fy,{hideIcons:!0,defaultSearchEngine:this.state.currentSearchEngine,onDeleteItem:this.onDeleteItem,onLinkItemClicked:this.onOmniDropdownItemClicked,typedText:this.state.typedValue,ref:this._omniDropdownRef,selectionIndex:this.state.dropdownSelectionIndex,items:e,onMenuClosed:this._hideDropdown,id:zw,fromSearchField:!0,getOffsetWidth:()=>this._refSearchField.current?.offsetWidth??0})};toggleSearchEngineSelectOpen=()=>{this.setState((e=>({isSearchEngineSelectOpen:!e.isSearchEngineSelectOpen,isOmniDropdownOpen:!1})))};closeSearchEngineSelect=()=>{this.setState({isSearchEngineSelectOpen:!1}),"button"!==this.props.prefValues[I.kAddressBarSearchDisplay]&&this.focusField()};hideSearchField=()=>{this.setState({showPopup:!1})};toggleHiddenSearchFieldPopup=()=>{this.setState((e=>({showPopup:!e.showPopup})))};renderSearchField(){const{inEditor:e=!1}=this.props;if(e)return(0,ss.jsx)("input",{type:"text",value:(0,B.Z)("verb","Search"),name:"SearchField",...(0,dp.uu)({draggable:this.props.draggable,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,onDragEnter:this.props.onDragEnter,onDragOver:this.props.onDragOver,onDragLeave:this.props.onDragLeave,onDrop:this.props.onDrop}),readOnly:!0});const t=this.state.currentSearchEngine,n=t&&t.name?ai.Z.systemDefaultEngineChanged()?(0,B.Z)("Search $1 [NEW]",[t.name]):(0,B.Z)("Search $1",[t.name]):"",i=Boolean(this.state.typedValue),s=!1,o=this.props.popupPosition||"below";return(0,ss.jsxs)("div",{ref:this._refSearchField,className:Fi()(this.props.buttonClasses,this.props.className,"iconmenu-container","SearchField",o),name:"SearchField",...(0,dp.uu)({draggable:this.props.draggable,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,onDragEnter:this.props.onDragEnter,onDragOver:this.props.onDragOver,onDragLeave:this.props.onDragLeave,onDrop:this.props.onDrop}),onContextMenu:this.onContextMenu,style:{"--SearchFieldWidth":this.getWidth()},children:[!this._isOnSpeedDial&&"button"!==this.props.prefValues[I.kAddressBarSearchDisplay]&&Kw(Zm.Z,{className:"SearchField-SlideBar",onSlidebarPosition:this.onSlidebarPosition,offset:2,position:"left"}),Kw(Rw,{onItemClicked:this.onSearchEngineChanged,items:this.state.searchEngineSelectItems,isOpen:this.state.isSearchEngineSelectOpen,onClose:this.closeSearchEngineSelect,toggleOpen:this.toggleSearchEngineSelectOpen,icon:this.state.currentSearchEngine?this.state.currentSearchEngine.faviconUrl:"",useFavicon:this.props.prefValues[I.kAddressBarSearchShowFavicon],showKeywords:this.props.prefValues[I.kAddressBarSearchShowKeyword]}),(0,ss.jsx)("input",{role:"searchbox","aria-autocomplete":void 0,"aria-controls":zw,"aria-expanded":this.state.isOmniDropdownOpen,"aria-activedescendant":Kv+this.state.dropdownSelectionIndex,ref:e=>this._refSearch=e,className:"vivaldi-searchfield searchfield-input",onBlur:this.onBlur,onChange:this.onChange,autoFocus:!this._isOnSpeedDial&&"button"===this.props.prefValues[I.kAddressBarSearchDisplay],onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onDoubleClick:this.onDoubleClick,onDragEnter:this.onDragEnter,onDragStart:this.onDragStart,onDragOver:this.onDragOver,onDragLeave:this.onDragLeave,onDrop:this.onDropped,onFocus:this.onFocus,onKeyDown:this.onKeyDowned,onKeyPress:this.onKeyPressed,onCompositionStart:this._onCompositionStart,onCompositionUpdate:this._onCompositionStart,onCompositionEnd:this._onCompositionEnd,onPaste:this.onPaste,placeholder:n,tabIndex:this._isOnSpeedDial?0:null,type:"search",value:this.state.editText}),this.state.isOmniDropdownOpen&&this.renderDropdown(),i&&Kw(Yw,{onClick:this.onExecuteSearchButtonClick,tabIndex:this.props.prefValues[I.kKeyboardTabToAll]}),s]})}render(){if("button"===this.props.prefValues[I.kAddressBarSearchDisplay]&&!this._isOnSpeedDial||this.props.forceIcon){const{size:e="large"}=this.props;return Kw(po.ZP,{image:Wi.YvR[e],label:(0,B.Z)("Search Field"),tooltip:(0,B.Z)("Show Search Field"),onClick:this.toggleHiddenSearchFieldPopup,customizeMenu:this.props.customizeMenu,menuOrigin:this.props.menuOrigin,popupPosition:this.props.popupPosition,draggable:this.props.draggable,onDragStart:this.props.onDragStart??Lr.Z,onDragEnd:this.props.onDragEnd??Lr.Z,onDragEnter:this.props.onDragEnter,onDragOver:this.props.onDragOver,onDragLeave:this.props.onDragLeave,onDrop:this.props.onDrop??Lr.Z,hidePopup:this.hideSearchField,isPopupVisible:this.state.showPopup,popupWidth:210,hasLightArrow:!0,size:e,popupClassName:"SearchField-Popup",popupLabel:(0,B.Z)("dialog title","Search Field"),mimeType:this.props.mimeType,name:this.props.name},void 0,this.renderSearchField())}return this.renderSearchField()}}const Qw=(0,Bu.Z)((0,dp.ZP)(Xw),jw);var qw=n(25776);const Jw={};let eC=[];class tC extends hr.Z{getText(e){const t=Ce.ZP.getActivePage(e);return t?Jw[t.id]??"":""}getTypedHistory(){return eC}dispatchAction(e){switch(e.actionType){case"SEARCH_FIELD_ADD_TYPED_HISTORY_DEPRECATED":!function(e){const t=C.Z.get(I.kHistoryDaysToKeepVisits)>0?C.Z.get(I.kAddressBarSearchTypedHistory):eC;eC=[{type:"OMNI_RESULT_TYPED_HISTORY_SEARCH",id:e,url:e,when:Date.now()}].concat(function(e,t){const n=e.length>=30?(0,qw.Z)(e,30):e;return t?n.filter((({url:e})=>e!==t)):n}(t,e)),C.Z.get(I.kHistoryDaysToKeepVisits)>0&&nC();iC.emitChange()}(e.query);break;case"SEARCH_FIELD_DELETE_TYPED_HISTORY_DEPRECATED":!function(e,t){eC=e.length>0?eC.filter((({url:t})=>e!==t)):eC.filter((({when:e})=>t!==e)),C.Z.get(I.kHistoryDaysToKeepVisits)>0&&nC();iC.emitChange()}(e.query,e.when);break;case"SEARCH_FIELD_DELETE_TYPED_HISTORY_FROM_DATABASE_DEPRECATED":i=!1,w.Z.reset(I.kAddressBarSearchTypedHistory),i&&(eC=[],iC.emitChange());break;case"SEARCH_FIELD_INIT_TYPED_HISTORY_DEPRECATED":eC=C.Z.get(I.kAddressBarSearchTypedHistory),iC.emitChange();break;case"SEARCH_FIELD_SET_TEXT":t=e.tabId,n=e.text,Jw[t]=n,iC.emitChange();break;case"SEARCH_FIELD_WRITE_TYPED_HISTORY_TO_DATABASE_DEPRECATED":nC();break;case"SEARCH_FIELD_DELETE_TYPED_HISTORY_PERIOD_DEPRECATED":!function(e){eC=eC.filter((({when:t})=>e-t>0)),C.Z.get(I.kHistoryDaysToKeepVisits)>0&&nC();iC.emitChange()}(e.since);break;case"CHROME_TABS_REMOVED":!function(e){delete Jw[e]}(e.tabId)}var t,n,i}}function nC(){w.Z.set(I.kAddressBarSearchTypedHistory,eC)}const iC=new tC(A.Z),sC=iC;var oC,aC=n(58848),rC=n(8074);function lC(e,t,n,i){oC||(oC="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:oC,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class dC extends Li.PureComponent{static contextType=ts.Z;loadBlockedContent=()=>{const e=pw.Z.getActiveWebView(this.context.vivaldiWindowId);e&&e.allowBlockedInsecureContent(),rC.Z.resetPageHasBlockedContent(this.props.pageId)};allowCookiesContent=()=>{const e=new URL(this.props.url).origin;se.Z.utilities.setContentSettings({type:"cookies",primaryPattern:"*",secondaryPattern:e,value:"allow",incognito:!1}),rC.Z.resetPageHasBlockedContent(this.props.pageId)};openManageCookies=()=>{de.Z.showSettings(this.context.vivaldiWindowId,"privacy",{scroll:"cookies"})};render(){const e=new URL(this.props.url).origin;return lC("div",{tabIndex:"0",className:"addressfield-popup"},void 0,lC("header",{className:"addressfield-popup-header blocked-content"},void 0,lC("span",{dangerouslySetInnerHTML:{__html:Wi.W4h.small}}),lC("h1",{id:"popup-label-contentblocker2"},void 0,(0,B.Z)("Blocked Content"))),lC("div",{className:"addressfield-popup-content blocked-content"},void 0,(()=>{let t=(0,ze.D5)();this.props.blockedPageContent.map((e=>{let n=t.get(e);t=n?t.set(e,++n):t.set(e,1)}));const n=[];for(const[i,s]of t)switch(i){case"ads":n.push(lC("div",{className:"blocked-section"},i,(0,B.Z)("Advertisements on this page are flagged as abusive and blocked.")));break;case"cookies":n.push(lC("div",{className:"blocked-section"},i,(0,B.Z)("$1 cookie is blocked","$1 cookies are blocked",[s]),lC("div",{className:"clickable",onClick:this.allowCookiesContent},void 0,(0,B.Z)("Allow third-party cookies for “$1”",[e]))));break;case"javascript":n.push(lC("div",{className:"blocked-section"},i,(0,B.Z)("JavaScript has been blocked.")));break;case"mixed-script":n.push(lC("div",{className:"blocked-section"},i,(0,B.Z)("$1 unsafe resource is blocked","$1 unsafe resources are blocked",[s]),lC("div",{className:"clickable",onClick:this.loadBlockedContent},void 0,(0,B.Z)("Load the unsafe resource","Load the unsafe resources",[s]))));break;case"autoplay":n.push(lC("div",{className:"blocked-section"},i,(0,B.Z)("Autoplay of video content has been blocked.")));break;case"images":n.push(lC("div",{className:"blocked-section"},i,(0,B.Z)("Image loading has been blocked.")));break;default:console.warn("Unhandled blocked content $1",i)}return n})()),lC("footer",{className:"dialog-footer"},void 0,this.props.blockedPageContent.includes("cookies")&&lC("input",{type:"button",onClick:this.openManageCookies,value:(0,B.Z)("Manage Cookies")}),lC("input",{type:"button",onClick:this.props.onPopupClosed,value:(0,B.Z)("Close")})))}}const cC=dC;var uC;function pC(e,t,n,i){uC||(uC="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:uC,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class hC extends Li.Component{state={popupVisible:!1};onTogglePopupOpen=e=>{e.preventDefault(),this.setState((e=>({popupVisible:!e.popupVisible})))};onClosePopup=()=>{this.setState({popupVisible:!1})};render(){return pC(po.ZP,{image:Wi.W4h.small,label:(0,B.Z)("Content Blocker"),tooltip:(0,B.Z)("Content has been blocked."),onClick:this.onTogglePopupOpen,popupPosition:this.props.position,className:"button-toolbar button-addressfield permission-popup is-blocking",hidePopup:this.onClosePopup,isPopupVisible:this.state.popupVisible,popupClassName:"addressfield-popup-container",popupLabelledBy:"popup-label-contentblocker2",popupWidth:240},void 0,pC(cC,{pageId:this.props.pageId,url:this.props.url,onPopupClosed:this.onClosePopup,blockedPageContent:this.props.blockedPageContent}))}}const gC=hC;var mC;function fC(e,t,n,i){mC||(mC="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:mC,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function vC(e){const t=Li.useContext(ts.Z);return(0,ss.jsxs)(ss.Fragment,{children:[fC("div",{className:"ContentBlocker-Field info"},void 0,fC("p",{},void 0,(0,B.Z)("Vivaldi allows a minimal selection of trackers to load, for a limited time after clicking an ad in a partner search engine results. This is to ensure correct ad attribution so that Vivaldi earns revenue from our partnerships.")),fC("p",{},void 0,fC("a",{tabIndex:e.tabIndex,href:"",onClick:()=>{c.ZP.openURL(t.vivaldiWindowId,"https://vvld.in/ad-attribution-description-dialog"),e.hidePopup()}},void 0,(0,B.Z)("More about Ad Attribution")))),fC("div",{className:"ContentBlocker-Blocked"},void 0,fC("h3",{},void 0,(0,B.Z)("Blocking Exceptions")),fC("ul",{className:"domain-wrapper"},void 0,e.domains.map(((e,t)=>fC("li",{title:e},`ad-attribution-${t}`,fC("span",{},void 0,e)))))),fC("div",{className:"ContentBlocker-Field"},void 0,fC("input",{type:"button",value:(0,B.Z)("verb","Back"),onClick:()=>e.hideAdAttribution()}))]})}const yC=Li.memo(vC);var bC,SC=n(19626);function wC(e,t,n,i){bC||(bC="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:bC,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const CC=" "+(0,B.Z)("(Default)"),AC=["tracking","ad_blocking"],IC="https://vivaldi.com/blog/vivaldi-business-model/",TC="https://vivaldi.com/bugreport/",ZC=["vivaldi.com","vivaldi.net"];var EC=wC("br",{}),kC=wC("span",{className:"keep-ea-words"},void 0,CC),_C=wC("span",{className:"keep-ea-words"},void 0,CC),NC=wC("span",{className:"keep-ea-words"},void 0,CC),PC=wC(co,{type:"close"});class DC extends Li.PureComponent{static contextType=ts.Z;buttonStyle={"--no-blocking":0,"--trackers":0,"--blocking":0,"--ads":0,"--base":1};state={adBlockingEnabled:!1,trackerBlockingEnabled:!1,isBlockingAds:!1,isBlockingTrackers:!1,isExemptByPartnerURL:!1,partnerName:"",blockedTrackerList:void 0,blockedAdList:void 0,showBlockedTrackers:!1,showBlockedAds:!1,popupOpen:!1,ruleSourceReady:!1,animateBlocking:!1,adAttributionTrackers:[],showAdAttributionView:!1};constructor(e){super(e),this.state={adBlockingEnabled:!1,trackerBlockingEnabled:!1,isBlockingAds:!1,isBlockingTrackers:!1,isExemptByPartnerURL:!1,partnerName:"",blockedTrackerList:void 0,blockedAdList:void 0,showBlockedTrackers:!1,showBlockedAds:!1,popupOpen:!1,ruleSourceReady:!1,animateBlocking:!1,adAttributionTrackers:[],showAdAttributionView:!1}}componentDidMount(){this._isMounted=!0,this.getRules(),this.updateSources(),this.updateBlockingState(),se.Z.contentBlocking.onStateChanged.addListener(this.getRules),se.Z.contentBlocking.onUrlsBlocked.addListener(this.updateBlocked),se.Z.contentBlocking.onExceptionsChanged.addListener(this.getRules),se.Z.contentBlocking.onRuleSourceUpdated.addListener(this.updateSources),se.Z.contentBlocking.onRuleSourceEnabled.addListener(this.updateSources),se.Z.contentBlocking.onRuleSourceDisabled.addListener(this.updateSources),se.Z.contentBlocking.onAdAttributionDomainChanged.addListener(this.getAdAttributionDomain),se.Z.contentBlocking.onAdAttributionTrackersAllowed.addListener(this.getAdAttributionTrackers),i.Z.webNavigation.onCommitted.addListener(this.updateBlockingState)}componentDidUpdate(e){this.props.url!==e.url&&(this.setState({blockedTrackerList:void 0,blockedAdList:void 0}),this.updateBlockingState())}componentWillUnmount(){this._isMounted=!1,se.Z.contentBlocking.onStateChanged.removeListener(this.getRules),se.Z.contentBlocking.onUrlsBlocked.removeListener(this.updateBlocked),se.Z.contentBlocking.onExceptionsChanged.removeListener(this.getRules),se.Z.contentBlocking.onRuleSourceUpdated.removeListener(this.updateSources),se.Z.contentBlocking.onRuleSourceEnabled.removeListener(this.updateSources),se.Z.contentBlocking.onRuleSourceDisabled.removeListener(this.updateSources),se.Z.contentBlocking.onAdAttributionDomainChanged.removeListener(this.getAdAttributionDomain),se.Z.contentBlocking.onAdAttributionTrackersAllowed.removeListener(this.getAdAttributionTrackers),i.Z.webNavigation.onCommitted.removeListener(this.updateBlockingState)}getAdAttributionDomain=e=>{this.getAdAttributionTrackers([e])};getAdAttributionTrackers=e=>{se.Z.contentBlocking.getAdAttributionAllowedTrackers(e,(e=>{const t=e[0]?.tracker_urls??[];this.setState({adAttributionTrackers:t})}))};getRules=()=>AC.forEach((e=>(0,SC.pg)(e,(t=>{this.setState(t,(()=>this.updateException(e)))}))));getHostname=e=>{let t="";try{t=new URL(e||this.props.url).hostname}catch(e){}return t.startsWith("www.")?t.substring(4):t};getIconUrl=()=>{const{url:e}=this.props;return pn.jk.getFavicon(e)??e};getRootDomain=e=>{const t=this.getHostname(e).split(".");return t.length>=2?`${t[t.length-2]}.${t[t.length-1]}`:""};isOnVivaldiDomain=e=>{const t=this.getRootDomain(this.props.url);return ZC.includes(t)};togglePopup=()=>this.setState((e=>({popupOpen:!e.popupOpen})));hidePopup=()=>this.setState({popupOpen:!1,showAdAttributionView:!1});showSettings=()=>{const e=this.context.vivaldiWindowId;this.togglePopup(),de.Z.showSettings(e,"privacy",{scroll:"tracker_and_ad_blocking"})};getActiveExceptionList=e=>{const t="tracking"===e?"trackerBlockingEnabled":"adBlockingEnabled";return this.state[t]?"exempt_list":"process_list"};updateBlockingState=()=>{AC.forEach((e=>{this.updateException(e),this.updateBlocked(e,[this.props.pageId])})),this.getAdAttributionTrackers([this.props.pageId])};updateException=e=>{se.Z.contentBlocking.isExemptOfFiltering(e,this.props.url,(t=>{this._isMounted&&("tracking"===e?this.setState({isBlockingTrackers:!t}):this.setState({isBlockingAds:!t}))})),this.isOnVivaldiDomain()?this.setState({isExemptByPartnerURL:!1,partnerName:""}):se.Z.contentBlocking.isExemptByPartnerURL(this.props.url,this.props.pageId,(e=>{this._isMounted&&this.setState({isExemptByPartnerURL:e.status,partnerName:e.name})}))};updateSources=()=>AC.forEach((e=>{se.Z.contentBlocking.getRuleSources(e,(e=>{this._isMounted&&(e.find((e=>""!==e.rules_list_checksum))?this.setState({ruleSourceReady:!0}):this.setState({ruleSourceReady:!1}))}))}));updateBlocked=(e,t)=>{const{trigger:n}=Ev.getNavigationInfo(this.props.pageId);this.setState({animateBlocking:"stop"!==n});const i="tracking"===e?"blockedTrackerList":"blockedAdList";t.includes(this.props.pageId)&&se.Z.contentBlocking.getBlockedUrlsInfo(e,[this.props.pageId],(e=>{this._isMounted&&this.setState({[i]:e[0]})}))};setPageBlocking=e=>{const t=e.currentTarget.value,n=0+(this.state.trackerBlockingEnabled?1:0)+(this.state.adBlockingEnabled?1:0),i=this.getHostname();(0,SC.fs)(i,t,this.props.pageId,n)};handleHidePartnerInfo=e=>{const t=(new Date).valueOf();w.Z.set(I.kPrivacyPartnersExceptionsDismissed,t)};handlePartnerExceptionURLClick=e=>{c.ZP.openURL(this.context.vivaldiWindowId,p.e9),this.setState({popupOpen:!1})};handleExpandClick=(e,t)=>{t.preventDefault(),"tracking"===e?this.setState((e=>({showBlockedTrackers:!e.showBlockedTrackers}))):this.setState((e=>({showBlockedAds:!e.showBlockedAds})))};renderBlocked=e=>{if(!this.props.blockerVisible)return null;if(!(this.state.showBlockedTrackers&&"tracking"===e||this.state.showBlockedAds&&"ad_blocking"===e))return null;const t="tracking"===e?this.state.blockedTrackerList:this.state.blockedAdList;if(!t)return null;const n=t.blocked_urls_info.slice(0).reduce(((e,t)=>{const n=this.getHostname(t.url);return e[n]=(e[n]||0)+t.blocked_count,e}),{});for(const e of t.blocked_trackers_info){const t=e.domain;n[t]=(n[t]||0)+e.blocked_count}return(0,ss.jsxs)(ss.Fragment,{children:[wC("h3",{},void 0,"tracking"===e?(0,B.Z)("Tracker detail","Tracker details",[t.total_blocked_count]):(0,B.Z)("Ad detail","Ad details",[t.total_blocked_count])),wC("ul",{},void 0,Object.keys(n).sort(((e,t)=>n[e]>n[t]?-1:1)).map((e=>wC("li",{},e,wC("span",{},void 0,e),wC("span",{},void 0,n[e])))))]})};getButtonStyle=(e,t,n,i,s,o)=>({"--base":t&&0===n?0:1,"--no-blocking":!e&&t&&0===n?1:0,"--trackers":t&&1===n&&!o?1:0,"--ads":t&&2===n&&!o?1:0,"--blocking":o?1:0,"--total":o});openPrivacyStatisticsDialog(){this.hidePopup(),de.Z.showPrivacyStatsDialog(this.context.vivaldiWindowId)}getCurrentLevel=()=>{const{isBlockingTrackers:e,isBlockingAds:t}=this.state;return(e?1:0)+(t?1:0)};handleReportButton=()=>{const e=this.getCurrentLevel()?"AdBlock":"TrackerBlock",t=encodeURIComponent(this.getHostname()),n=[`${TC}?project=VB&&type=normal`,`&bugUrl=${t}`,`&summary=%5B${e}%5D+Site+issue+on+${t}`].join("");c.ZP.openURL(this.context.vivaldiWindowId,n,{singleton:!0}),this.hidePopup()};openExceptionHelp=()=>{c.ZP.openURL(this.context.vivaldiWindowId,IC,{singleton:!0}),this.hidePopup()};render(){const{ruleSourceReady:e,trackerBlockingEnabled:t,isBlockingTrackers:n,isExemptByPartnerURL:i,partnerName:s,blockedTrackerList:o,adBlockingEnabled:a,isBlockingAds:r,blockedAdList:l,animateBlocking:d}=this.state,{blockerVisible:c,tabIndex:u}=this.props,h=0+(t?1:0)+(a?1:0),g=this.getCurrentLevel(),m=o||l,f=o?.total_blocked_count??0,v=l?.total_blocked_count??0,y=f+v,b=!this.props.exceptionDismissed,S=[];return e?(n&&S.push(p.YV+(0,B.Z)("Tracker Blocking Active ($1)",[f])),r&&S.push(p.YV+(0,B.Z)("Ad Blocking Active ($1)",[v]))):S.push((0,B.Z)("Blocking is inactive due to missing or disabled rule lists")),wC(po.ZP,{buttonStyle:this.getButtonStyle(Boolean(m),c,g,n,r,y),label:(0,B.Z)("Content Blocker"),tooltip:y?(0,B.Z)("Blocked $1 Items",[y]):(0,B.Z)("Content Blocker"),tooltipExtra:S.join("\n"),onClick:this.togglePopup,image:Wi.Tu3,hidePopup:this.hidePopup,popupPosition:this.props.position,popupWidth:300,popupClassName:"ContentBlocker ToolbarButtonPopup-DefaultStyles",popupLabelledBy:"popup-label-contentblocker",className:Fi()("ContentBlocker-Control",{"ContentBlocker-Control--Active":d}),isPopupVisible:this.state.popupOpen},void 0,wC("div",{className:"ContentBlocker-Header"},void 0,wC("div",{className:"favicon"},void 0,wC(Ri.ZP,{url:this.getIconUrl(),loadType:"page"})),wC("div",{id:"popup-label-contentblocker"},void 0,c?(0,B.Z)("Blocking Level on"):(0,B.Z)("Content Blocker"),EC,c?wC("strong",{},void 0,this.getHostname()):null)),wC("div",{className:"content-wrapper"},void 0,wC("div",{className:"dialog-content",style:{transform:`translateX(${this.state.showAdAttributionView?-300:0}px)`,maxHeight:this.state.showAdAttributionView?0:"unset",visibility:this.state.showAdAttributionView?"hidden":"unset"}},void 0,c&&wC("div",{className:"ContentBlocker-Field"},void 0,wC("button",{tabIndex:u,className:Fi()({"ContentBlocker-Label":!0,"ContentBlocker-Label--Active":0===g}),value:"0",onClick:this.setPageBlocking},void 0,wC("span",{className:"ContentBlocker-Label-Icon",dangerouslySetInnerHTML:{__html:Wi.Tu3},style:{"--no-blocking":1,"--base":0}}),wC("span",{className:"ContentBlocker-Label-Text"},void 0,(0,B.Z)("No Blocking"),0===h&&kC)),wC("button",{tabIndex:u,className:Fi()({"ContentBlocker-Label":!0,"ContentBlocker-Label--Active":1===g}),value:"1",onClick:this.setPageBlocking},void 0,wC("span",{className:"ContentBlocker-Label-Icon",style:{"--trackers":"1"},dangerouslySetInnerHTML:{__html:Wi.Tu3}}),wC("span",{className:"ContentBlocker-Label-Text"},void 0,(0,B.Z)("Block Trackers"),1===h&&_C)),wC("button",{tabIndex:u,className:Fi()({"ContentBlocker-Label":!0,"ContentBlocker-Label--Active":2===g}),value:"2",onClick:this.setPageBlocking},void 0,wC("span",{className:"ContentBlocker-Label-Icon",style:{"--ads":"1"},dangerouslySetInnerHTML:{__html:Wi.Tu3}}),wC("span",{className:"ContentBlocker-Label-Text"},void 0,(0,B.Z)("Block Trackers and Ads"),2===h&&NC))),m&&(0,ss.jsxs)(ss.Fragment,{children:[wC("div",{className:"ContentBlocker-Counter"},void 0,n&&wC("div",{className:"ContentBlocker-Counter--Block",onClick:this.handleExpandClick.bind(null,"tracking")},void 0,wC("div",{className:"ContentBlocker-Counter--Number"},void 0,f),wC("p",{},void 0,(0,B.Z)("Tracker Blocked","Trackers Blocked",[f]))),r&&wC("div",{className:"ContentBlocker-Counter--Block",onClick:this.handleExpandClick.bind(null,"ad_blocking")},void 0,wC("div",{className:"ContentBlocker-Counter--Number"},void 0,v),wC("p",{},void 0,(0,B.Z)("Ad Blocked","Ads Blocked",[v])))),wC("div",{className:"ContentBlocker-Blocked"},void 0,o&&this.renderBlocked("tracking"),l&&this.renderBlocked("ad_blocking"))]}),this.state.adAttributionTrackers.length>0&&wC("div",{className:"blocking-exception-wrapper",onClick:()=>this.setState({showAdAttributionView:!0})},void 0,wC("p",{},void 0,(0,B.Z)("$1 Blocking Exception","$1 Blocking Exceptions",[this.state.adAttributionTrackers.length]))),b&&i&&g>0&&wC("div",{className:"ContentBlocker-Info"},void 0,wC("h3",{},void 0,(0,B.Z)("Ads in Search Results")),wC("p",{},void 0,s?(0,B.Z)("Vivaldi has partnered with $1 to not block ads on this page. These ads help fund the development of Vivaldi.",[s]):(0,B.Z)("We have a partnership with this site and exempt ads in the search result from being blocked by default. These ads generate revenue for Vivaldi if you interact with them.")),wC("p",{},void 0,wC("a",{href:"",title:IC,onClick:this.openExceptionHelp},void 0,(0,B.Z)("Read more about Blocking Exceptions"))),wC("button",{className:"ContentBlocker-Close",onClick:this.handleHidePartnerInfo},void 0,wC("span",{dangerouslySetInnerHTML:{__html:Wi.kze}}))),C.Z.get(I.kAddressBarShowBlockerWarning)&&c&&m&&(n||r)&&wC("div",{className:"ContentBlocker-Info"},void 0,wC("p",{},void 0,(0,B.Z)("If the page appears broken, try turning off blocking and extensions.")),wC("p",{},void 0,wC("a",{href:"",title:TC,onClick:this.handleReportButton},void 0,(0,B.Z)("Report a page problem."))),wC("button",{className:"ContentBlocker-Close",onClick:()=>{w.Z.set(I.kAddressBarShowBlockerWarning,!1),this.forceUpdate()}},void 0,PC)),wC("div",{className:"ContentBlocker-Field"},void 0,wC("button",{className:"privacy-btn-icon",onClick:()=>this.openPrivacyStatisticsDialog(),title:(0,B.Z)("Show Privacy Statistics"),dangerouslySetInnerHTML:{__html:Wi.vh3+(0,B.Z)("Show privacy Statistics")}}),wC("input",{type:"button",onClick:this.showSettings,value:(0,B.Z)("Manage Default Settings"),autoFocus:0===u}))),this.state.adAttributionTrackers.length>0&&wC("div",{className:"dialog-content",style:{transform:`translateX(${this.state.showAdAttributionView?-300:0}px)`,maxHeight:this.state.showAdAttributionView?"unset":0,visibility:this.state.showAdAttributionView?"unset":"hidden"}},void 0,wC(yC,{domains:this.state.adAttributionTrackers,hideAdAttribution:()=>this.setState({showAdAttributionView:!1}),hidePopup:this.hidePopup,tabIndex:u}))))}}const MC=DC,OC={loadedBytes:1,loadedElements:1,progress:1,totalElements:1,url:"",isFetching:!1};class xC extends hr.Z{_progressInfo=new ze.D5;getProgressInfo(e){const t=this._progressInfo.get(e);return t||OC}emitChange=(0,aC.Z)((()=>{super.emitChange()}),250);dispatchAction(e){switch(e.actionType){case"NAVIGATION_SET_STATE":{const{pageId:t,navigationState:n}=e;switch(n.trigger){case"start":{const e=this._progressInfo.get(t);e&&this._setProgressState({...e,isFetching:!0},t)}break;case"stop":case"abort":this._setProgressState(OC,t);break;case"commit":{const e=this._progressInfo.get(t);e&&this._setProgressState({...e,isFetching:!1},t)}}break}case"PAGE_SET_PROGRESS":{const{pageId:t,progressState:n}=e;this._setProgressState(n,t);break}case"PAGE_CLOSE":this._removeProgressState(e.pages)}}_setProgressState(e,t){const n=this._progressInfo.get(t);e!==n&&(n?(e.progress<n.progress&&(e={...e,progress:n.progress}),void 0===e.totalElements&&(e={...e,totalElements:n.totalElements}),void 0===e.loadedElements&&(e={...e,loadedElements:n.loadedElements})):e={...e,isFetching:!0},e.totalElements<1&&(e={...e,totalElements:1}),this._progressInfo=this._progressInfo.set(t,e),this.emitChange())}_removeProgressState(e){e.forEach((e=>{this._progressInfo.has(e.id)&&(this._progressInfo=this._progressInfo.remove(e.id),this.emitChange())}))}}const LC=new xC(A.Z);var RC;function BC(e,t,n,i){RC||(RC="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:RC,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const FC={bytes:0,bytesDisplayed:0,currentPageId:null,elLoaded:0,elLoadedDisplayed:0,elTotal:1,isProgressing:!1,isStarted:!1,progress:0,stopped:!1,pageloadTicker:""},WC=[I.kAddressBarShowProgress,I.kThemeUseAnimation];class UC extends Li.PureComponent{static contextType=ts.Z;_isMounted=!1;state=FC;componentDidMount(){this._isMounted=!0,Ev.addListener(this._onNavigationStoreChanged,(e=>e.get(this.props.pageId)?.navigationInfo.trigger)),LC.addListener(this._onProgressStateStoreChanged),No.Z.addListener(this._onWebpageviewStoreChanged)}componentWillUnmount(){clearTimeout(this._updateTimer),this._isMounted=!1,Ev.removeListener(this._onNavigationStoreChanged),LC.removeListener(this._onProgressStateStoreChanged),No.Z.removeListener(this._onWebpageviewStoreChanged)}componentDidUpdate(e,t){const n=this.props.pageId;if(n!==t.currentPageId){const e=LC.getProgressInfo(this.props.pageId),{progress:t=0,loadedBytes:i=0,loadedElements:s=0,totalElements:o=1}=e||{};let a={};a=0===t||1===t||void 0===t?{...FC,currentPageId:n}:{...FC,currentPageId:n,progress:t,bytes:i,elLoaded:s,elTotal:o},this._onUpdateProgressState(a)}}_onUpdateProgressState=e=>{this.setState(e)};_onNavigationStoreChanged=()=>{this._onProgressStateStoreChanged()};_onProgressStateStoreChanged=()=>{const e=this.props.pageId,t=Ce.ZP.getPageById(e);if(t){const e=t.url;if((0,rl.xl)(e))return}const n=LC.getProgressInfo(e),{trigger:i}=Ev.getNavigationInfo(e),{progress:s=0,loadedBytes:o=0,loadedElements:a=0,totalElements:r=1}=n||{};"start"===i?this.setState({...FC,currentPageId:e,isProgressing:!0,isStarted:!0}):"stop"===i?this.setState((e=>({isProgressing:!1,...e.stopped&&{}||{progress:1}}))):"commit"!==i||this.state.stopped||(this.setState({bytes:o,elLoaded:a,elTotal:r,isProgressing:!0,isStarted:!0,progress:s}),this.updateCount())};_onWebpageviewStoreChanged=e=>{e.pageId===this.props.pageId&&"WEBPAGEVIEW_STOP"===e.type&&1!==this.state.progress&&this.setState({isProgressing:!1,stopped:!0})};getIncrement=(e,t)=>{const n=t-e;let i=0;return n>10?i=Math.floor(n/5):n>4?i=2:n>0&&(i=1),e+i};updateCount=()=>{if(clearTimeout(this._updateTimer),!this._isMounted)return;const e=this.state.bytes,t=this.state.bytesDisplayed,n=this.state.elLoadedDisplayed;let i=this.state.elLoaded;1===this.state.progress&&i<this.state.elTotal&&(i=this.state.elTotal);const s=this.getIncrement(t,e),o=this.getIncrement(n,i);!1===this.props.prefValues[I.kThemeUseAnimation]?this.setState({elLoadedDisplayed:i,bytesDisplayed:e}):(i>n&&this.setState({elLoadedDisplayed:o}),e>t&&this.setState({bytesDisplayed:s}),!this.state.stopped&&(i>o||e>s)&&(this._updateTimer=setTimeout(this.updateCount,80)));const a=e>1048576?1:0,r=(0,Mg.Z)(e,a);e>0&&this.setState({pageloadTicker:r})};render(){if(!this.props.open||isNaN(this.state.progress))return null;const e=this.state.progress,t=this.state.elLoadedDisplayed,n=this.state.elTotal,i=this.state.isProgressing,s=this.state.isStarted,o=!0===this.state.stopped;return BC("div",{className:Fi()({pageload:!0,unstarted:!s,progressing:i,"progress-done":1===e||o,stopped:o})},void 0,this.props.prefValues[I.kAddressBarShowProgress]&&BC("progress",{className:"pageload-indicator",value:100*this.state.progress,max:100}),BC("div",{className:"pageload-ticker"},void 0,this.state.pageloadTicker),BC("div",{className:"pageload-ticker"},void 0,t+"/"+n))}}const VC=(0,Bu.Z)(UC,WC);var HC;function GC(e,t,n,i){HC||(HC="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:HC,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class $C extends Li.PureComponent{openSettings=()=>{se.Z.utilities.openOSGeolocationSettings(),this.props.onDialogClosed()};render(){return GC("section",{className:"addressfield-popup system-location-service"},void 0,GC("section",{className:"dialog-content"},void 0,GC("h1",{},void 0,(0,B.Z)("Location Services")),GC("p",{},void 0,(0,B.Z)("Vivaldi needs your permission to access system Location Services."))),GC("section",{className:"dialog-footer"},void 0,GC("input",{type:"button",className:"primary",onClick:this.openSettings,value:(0,B.Z)("Open System Settings"),autoFocus:!0})))}}const KC=$C;var zC;function jC(e,t,n,i){zC||(zC="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:zC,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const YC=({onDialogClosed:e,onChange:t})=>(0,ss.jsxs)(ss.Fragment,{children:[jC("input",{type:"button",className:"primary",onClick:e,value:(0,B.Z)("OK"),autoFocus:!0}),jC("input",{type:"button",onClick:t,value:(0,B.Z)("Change")})]});var XC,QC=n(1068);function qC(e,t,n,i){XC||(XC="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:XC,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const JC=(0,QC.Z)("input");class eA extends Li.PureComponent{allow=()=>{this.props.onPermissionClicked(!1)};deny=()=>{this.props.onPermissionClicked(!0)};renderAllowDenyQuery=()=>{const e=this.props.renderNotice?this.props.renderNotice():null;return(0,ss.jsxs)(ss.Fragment,{children:[e,qC(JC,{type:"button",onClick:this.allow,value:(0,B.Z)("command","Allow")}),qC("input",{type:"button",className:"primary",onClick:this.deny,value:(0,B.Z)("Deny"),autoFocus:!0})]})};render(){return qC("section",{className:"addressfield-popup"},void 0,qC("header",{className:"addressfield-popup-header"},void 0,this.props.image&&qC("span",{dangerouslySetInnerHTML:{__html:this.props.image}}),qC("h1",{id:"popup-label-permissionprompt"},void 0,this.props.message)),qC("section",{className:"dialog-footer"},void 0,!1===this.props.isDecided?this.renderAllowDenyQuery():qC(YC,{onDialogClosed:this.props.onDialogClosed,onChange:this.props.onSettingsClicked})))}}const tA=eA;var nA,iA=n(60203),sA=n(63608);function oA(e,t,n,i){nA||(nA="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:nA,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function aA(e){const t=Object.keys(sA._).find((t=>sA._[t].path===e));return t?sA._[t].icon:""}class rA extends Li.PureComponent{changePermission=async e=>{const{name:t,value:n}=e.target;await se.Z.utilities.setDefaultContentSettings(t,n),this.props.reloadPermissions()};resetToDefaults=()=>{Object.keys(sA._).forEach((e=>{se.Z.utilities.setDefaultContentSettings(e,sA._[e].default,Lr.Z)})),this.props.reloadPermissions()};render(){const{filter:e,permissionList:t}=this.props;return oA(iA.Z,{filter:e},void 0,oA("div",{className:"detail"},void 0,oA("div",{className:"detail-content"},void 0,oA("h3",{},void 0,sA.w["Global Website Permissions"]),Object.keys(t).map((e=>oA("label",{tooltip:sA._[e].description??void 0},e,oA("span",{className:"icon",dangerouslySetInnerHTML:{__html:sA._[e].icon}}),oA("span",{},void 0,sA._[e].label),oA(ta.Z,{value:t[e],onChange:this.changePermission,name:e},void 0,!sA._[e].exceptions?.allow&&oA("option",{value:"allow"},void 0,sA.w.Allow),!sA._[e].exceptions?.ask&&"cookies"!==e&&oA("option",{value:"ask"},void 0,sA.w.Ask),"cookies"===e&&oA("option",{value:"session_only"},void 0,sA.w["Session Only"]),oA("option",{value:"block"},void 0,sA.w.Block)))))),oA("div",{className:"setting-single"},void 0,oA("input",{type:"button",value:sA.w["Reset Global Permissions"],onClick:this.resetToDefaults}))))}}const lA=rA;var dA;function cA(e,t,n,i){dA||(dA="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:dA,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const uA=["protocol_handling","durablestorage"];function pA(e){switch(e){case"camera":case"microphone_and_camera":case"videocapture":return aA("media_stream_camera");case"geolocation":return aA("geolocation");case"audiocapture":case"microphone":return aA("media_stream_mic");case"backgroundsync":return aA("background_sync");case"midi":case"midi-sysex":return aA("midi_sysex");case"idle_detection":return aA("idle_detection");case"javascript":return aA("javascript");case"pushmessaging":return aA("notifications");case"protocol_handling":return Wi.mU8.small;default:return aA(e)}}class hA extends Li.PureComponent{static contextType=ts.Z;state={isDialogOpen:"undecided"===this.props.permission.state&&!this.props.permission?.suppressedPrompt,icon:pA(this.props.permissionType),requestOSSettings:!1};async componentDidUpdate(e,t){const{permissionType:n,permission:i}=this.props;"geolocation"===n&&"allowed"!==e.permission.state&&"allowed"===i.state&&await this.maybeShowOSGeolocationHelp()}onNotificatorClicked=async()=>{const{permissionType:e,permission:t}=this.props;if("allowed"===t.state&&"geolocation"===e){if(await this.maybeShowOSGeolocationHelp())return Promise.resolve()}return this.setState((e=>({isDialogOpen:!e.isDialogOpen,requestOSSettings:!1}))),Promise.resolve()};maybeShowOSGeolocationHelp=async()=>(this.state.isDialogOpen,!1);onDialogClosed=()=>{if(this.state.requestOSSettings);else{const{permissionType:e,permission:t}=this.props;"protocol_handling"===e&&"undecided"===t.state&&this.onPermissionClicked(!0)}this.setState({isDialogOpen:!1,requestOSSettings:!1})};onPermissionClicked=e=>{const t=this.props.permission.requestEvent;if(t){!1===e?t.allow():t.deny();const n=this.props.permissionType;n&&rC.Z.setPermission(this.props.pageId,this.props.origin,n,t,e?"blocked":"allowed")}this.onDialogClosed()};onSettingsClicked=()=>{de.Z.showSettings(this.context.vivaldiWindowId,"privacy",{scroll:"permissions"}),this.onDialogClosed()};getMessageText=()=>{const e="blocked"===this.props.permission.state,t="undecided"!==this.props.permission.state,n=this.props.origin,i=this.props.permission?.promptPermission,s=this.props.permissionType;if(!s)return"";if(t)if(e)switch(s){case"geolocation":return(0,B.Z)("Website “$1” has been denied location access.",[n]);case"notifications":return(0,B.Z)("Website “$1” has been denied showing notifications.",[n]);case"clipboard":return(0,B.Z)("Website “$1” has been denied accessing your clipboard.",[n]);case"camera":case"videocapture":return(0,B.Z)("Website “$1” has been denied access to your camera.",[n]);case"audiocapture":case"microphone":return(0,B.Z)("Website “$1” has been denied access to your microphone.",[n]);case"microphone_and_camera":return(0,B.Z)("Website “$1” has been denied access to your microphone and camera.",[n]);case"sensors":return(0,B.Z)("Website “$1” has been denied access to motion sensors.",[n]);case"idle_detection":return(0,B.Z)("Website “$1” has been denied access to idle detection.",[n]);case"javascript":return(0,B.Z)("Website “$1” has been denied running JavaScript.",[n]);case"midi":case"midi-sysex":return(0,B.Z)("Website “$1” has been denied access to MIDI devices.",[n]);case"protocol_handling":return(0,B.Z)("Website “$1” has been denied access to protocol handling.",[n])}else switch(s){case"geolocation":return(0,B.Z)("Website “$1” is accessing your location.",[n]);case"notifications":return(0,B.Z)("Website “$1” is authorized to show notifications.",[n]);case"clipboard":return(0,B.Z)("Website “$1” is accessing your clipboard.",[n]);case"camera":case"videocapture":return(0,B.Z)("Website “$1” is using your camera.",[n]);case"audiocapture":case"microphone":return(0,B.Z)("Website “$1” is recording with your microphone.",[n]);case"microphone_and_camera":return(0,B.Z)("Website “$1” is using your microphone and camera.",[n]);case"sensors":return(0,B.Z)("Website “$1” is using your motion sensors.",[n]);case"idle_detection":return(0,B.Z)("Website “$1” uses idle detection.",[n]);case"javascript":return(0,B.Z)("Website “$1” runs JavaScript.",[n]);case"midi":return(0,B.Z)("Website “$1” is using your MIDI devices.",[n]);case"midi-sysex":return(0,B.Z)("Website “$1” is using your MIDI devices (including SYSEX access).",[n]);case"protocol_handling":return(0,B.Z)("Website  “$1” is registered for protocol handling.",[n])}else switch(s){case"geolocation":return(0,B.Z)("Website “$1” would like to access your location.",[n]);case"notifications":return(0,B.Z)("Website “$1” would like to show notifications.",[n]);case"clipboard":return(0,B.Z)("Website “$1” would like to access your clipboard.",[n]);case"camera":case"videocapture":return(0,B.Z)("Website “$1” would like to use your camera.",[n]);case"audiocapture":case"microphone":return(0,B.Z)("Website “$1” would like to use your microphone.",[n]);case"microphone_and_camera":return(0,B.Z)("Website “$1” would like to use your microphone and camera.",[n]);case"sensors":return(0,B.Z)("Website “$1” would like to use motion sensors.",[n]);case"idle_detection":return(0,B.Z)("Website “$1” would like to use idle detection.",[n]);case"javascript":return(0,B.Z)("Website “$1” would like to use JavaScript.",[n]);case"midi":return(0,B.Z)("Website “$1” would like to use MIDI devices.",[n]);case"midi-sysex":return(0,B.Z)("Website “$1” would like to use MIDI devices, including SYSEX access.",[n]);case"protocol_handling":return(0,B.Z)("Allow “$1” to open all “$2” links?",[n,i??""])}return console.warn("Unknown permissiontype: "+s),s};_privacyNotice(){c.ZP.openURL(this.context.vivaldiWindowId,"https://vivaldi.com/privacy/browser/")}renderNotice=()=>"geolocation"===this.props.permissionType?cA("div",{className:"geo-notice"},void 0,cA("a",{href:"",title:(0,B.Z)("Vivaldi Browser Privacy Policy"),onClick:e=>this._privacyNotice()},void 0,(0,B.Z)("Privacy Notice"))):null;render(){const e="blocked"===this.props.permission.state,t="undecided"!==this.props.permission.state,{permissionType:n}=this.props;if(t&&uA.includes(n))return null;const i={"button-addressfield":!0,"permission-popup":!0,"is-allowing":!e&&t,"is-dialog-open":this.state.isDialogOpen};return cA(po.ZP,{tooltip:this.getMessageText(),onClick:this.onNotificatorClicked,image:this.state.icon,popupPosition:this.props.popupPosition,hidePopup:this.onDialogClosed,isPopupVisible:this.state.isDialogOpen,className:Fi()(i),popupClassName:"addressfield-popup-container",popupLabelledBy:"popup-label-permissionprompt",popupWidth:400},void 0,this.state.requestOSSettings&&cA(KC,{onDialogClosed:this.onDialogClosed}),!this.state.requestOSSettings&&cA(tA,{onPermissionClicked:this.onPermissionClicked,isDecided:t,onDialogClosed:this.onDialogClosed,onSettingsClicked:this.onSettingsClicked,image:this.state.icon,renderNotice:this.renderNotice,message:this.getMessageText()}))}}const gA=hA;var mA,fA;function vA(e,t,n,i){mA||(mA="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:mA,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class yA extends Li.PureComponent{_isPermissionUsage=e=>!e.requestEvent&&"undecided"!==e.state;mergeSortMicCamPermissions(e){const t=new Map(Array.from(e).sort((([e],[t])=>e>t?1:-1))),n=t.get("microphone"),i=t.get("camera"),s=t.get("microphone_and_camera");return n&&i&&this._isPermissionUsage(n)&&this._isPermissionUsage(i)&&!s?(t.delete("microphone"),t.delete("camera"),t.set("microphone_and_camera",n)):s&&this._isPermissionUsage(s)&&(n&&this._isPermissionUsage(n)&&t.delete("microphone"),i&&this._isPermissionUsage(i)&&t.delete("camera")),t}render(){if(!this.props.pagePermissions.size)return null;const e=[];return this.props.pagePermissions.forEach(((t,n)=>{this.mergeSortMicCamPermissions(t).forEach(((t,i)=>{e.push(vA(gA,{pageId:this.props.pageId,permission:t,origin:n,permissionType:i,popupPosition:this.props.popupPosition},i))}))})),e}}function bA(e,t,n,i){fA||(fA="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:fA,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class SA extends Li.Component{onBlockedPopupUrlClicked=(e,t)=>{t.preventDefault(),this.props.onPopupAllowed(e)};renderItem=e=>bA("a",{className:"popupblocker-blocked-page",onClick:this.onBlockedPopupUrlClicked.bind(this,e),title:e.targetUrl,href:e.targetUrl},e.targetUrl+e.timeStamp,e.targetUrl);renderItems=e=>bA("div",{className:"popupblocker-blocked-pages"},void 0,Array.from(e,(e=>this.renderItem(e))));onShouldBlockClicked=e=>{this.props.onShouldBlockClicked(e)};renderAlwaysBlockQuery=()=>bA("section",{className:"dialog-footer"},void 0,bA("label",{},void 0,bA("input",{type:"radio",name:"blocked",value:"false",defaultChecked:!1!==this.props.shouldBlockPopups,onChange:this.onShouldBlockClicked.bind(this,!0)}),(0,B.Z)("Block Popups")),bA("label",{},void 0,bA("input",{type:"radio",name:"blocked",value:"true",defaultChecked:!1===this.props.shouldBlockPopups,onChange:this.onShouldBlockClicked.bind(this,!1)}),(0,B.Z)("Always Allow")));render(){return this.props.blockedPopups.size>0?bA("div",{tabIndex:"0",className:"addressfield-popup"},void 0,bA("header",{className:"addressfield-popup-header"},void 0,this.props.image&&bA("span",{dangerouslySetInnerHTML:{__html:this.props.image}}),bA("h1",{id:"popup-label-popupblocker"},void 0,(0,B.Z)("Blocked Popups"))),bA("div",{className:"addressfield-popup-content"},void 0,this.renderItems(this.props.blockedPopups)),this.renderAlwaysBlockQuery()):null}}const wA=SA;var CA;function AA(e,t,n,i){CA||(CA="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:CA,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class IA extends Li.Component{state={isDialogOpen:!1,shouldBlockPopups:!0};componentDidMount(){this.props.url&&i.Z.contentSettings.popups.get({primaryUrl:this.props.url},(e=>{i.Z.runtime.lastError&&i.Z.runtime.lastError.message&&console.warn("ERROR getting content settings for popups. Original message:\n"+i.Z.runtime.lastError.message)}))}onNotificatorClicked=()=>{this.setState((e=>({isDialogOpen:!e.isDialogOpen})))};onDialogClosed=()=>{this.setState({isDialogOpen:!1})};onShouldBlockClicked=e=>{const t={primary_pattern:this.props.url,secondary_pattern:this.props.url,type:"popups",setting:e?"block":"allow"};se.Z.settings.setContentSetting(t),this.setState({shouldBlockPopups:e})};render(){var e={"button-addressfield":!0,"permission-popup":!0,"is-blocking":!0===this.state.shouldBlockPopups,"is-allowing":!1===this.state.shouldBlockPopups,"is-dialog-open":this.state.isDialogOpen};return AA("div",{className:"button-toolbar"},void 0,AA(po.ZP,{tooltip:(0,B.Z)("Blocked Popup Pages"),onClick:this.onNotificatorClicked,image:Wi.nY6.small,popupPosition:this.props.popupPosition,hidePopup:this.onDialogClosed,isPopupVisible:this.state.isDialogOpen,className:Fi()(e),popupClassName:"addressfield-popup-container",popupLabelledBy:"popup-label-popupblocker",popupWidth:300},void 0,AA(wA,{image:Wi.nY6.medium,shouldBlockPopups:this.state.shouldBlockPopups,onShouldBlockClicked:this.onShouldBlockClicked,blockedPopups:this.props.blockedPopups,onPopupAllowed:this.props.onPopupAllowed})))}}const TA=IA;var ZA;function EA(e,t,n,i){ZA||(ZA="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:ZA,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class kA extends Li.PureComponent{state={popupVisible:!1};togglePopup=()=>{this.setState((e=>({popupVisible:!e.popupVisible})))};hidePopup=()=>{this.setState({popupVisible:!1})};render(){return EA(po.ZP,{className:"create-qr-code",image:Wi.ERJ,label:(0,B.Z)("Page QR Code"),tooltip:(0,B.Z)("Share Page with QR Code"),onClick:this.togglePopup,popupPosition:this.props.popupPosition,hidePopup:this.hidePopup,isPopupVisible:this.state.popupVisible,popupClassName:"ToolbarButtonPopup-DefaultStyles",popupLabelledBy:"dialog-qrshare-title",popupWidth:wu(this.props.data),size:this.props.size,commandId:"COMMAND_PAGE_QR_CODE"},void 0,EA(Au,{hidePopup:this.hidePopup,data:this.props.data}))}}const _A=kA;class NA extends Li.PureComponent{state={remapLoading:!1};clickRef=Li.createRef();getMenuItems=()=>this.props.feeds.map((e=>{let t;return t=e.remap?{...Qe.Z.makeLabelPair((0,B.Z)("Feed information could not be loaded")),isEnabled:()=>!1}:{...Qe.Z.makeLabelPair(`${e.title} - ${e.type}`),items:[{handler:t=>c.ZP.openURL(t.windowId,e.url),...(0,us.Z)("rss","Preview")},{handler:t=>{this.openFeed(e)},...(0,us.Z)("Subscribe")}]},t}));remapFeeds=()=>{this.state.remapLoading||(this.props.feeds.some((e=>e.remap))?(this.setState({remapLoading:!0}),Promise.allSettled(this.props.feeds.map((e=>e.remap?fetch(e.url).then((e=>e.ok?e.text():Promise.reject(""))).then((t=>{const n=(new DOMParser).parseFromString(t,"text/html").querySelector('link[type="application/rss+xml"][href], link[type="application/atom+xml"][href], link[type="text/x-opml"][href], a[type="application/rss+xml"][href], a[type="application/atom+xml"][href], a[type="text/x-opml"][href]');if(!(n&&(n instanceof window.HTMLLinkElement||n instanceof window.HTMLAnchorElement)&&n.href))return Promise.reject();e.url=n.href,e.remap=!1})):Promise.resolve()))).finally((()=>{this.setState({remapLoading:!1},(()=>{1!==this.props.feeds.length||this.props.feeds[0].remap?this.clickRef.current?.showMenu:this.openFeed(this.props.feeds[0])}))}))):1!==this.props.feeds.length||this.props.feeds[0].remap?this.clickRef.current?.showMenu():this.openFeed(this.props.feeds[0]))};openFeed=e=>{const t=[{url:e.url,title:e.title??e.url}];de.Z.showAddFeed(he.ZP.getLastActiveBrowserWindowId(),t)};render=()=>this.props.feeds.length?(0,ss.jsx)(po.ZP,{ref:this.clickRef,image:this.state.remapLoading?Wi.H0I:Wi.ZU_.small,onClick:this.remapFeeds,tooltip:(0,B.Z)("Page offers feeds"),menu:this.getMenuItems,menuOrigin:"bottomLeft"}):null}const PA=NA,DA=[];class MA extends m.Z{getInitialState(){return new Map}getFeeds(e){return this.getState().get(e)??DA}reduce(e,t){switch(t.actionType){case"RSS_FEEDS_FOUND":{const{tabId:n,feeds:i}=t;return new Map(e).set(n,i)}case"RSS_CLEAR_FEEDS":case"CHROME_TABS_REMOVED":return(0,cr.u4)(e,t.tabId);default:return e}}}const OA=new MA;var xA;function LA(e,t,n,i){xA||(xA="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:xA,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var RA=LA("svg",{viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"},void 0,LA("g",{},void 0,LA("path",{d:"M7 8C7 7.44772 7.44772 7 8 7C8.55228 7 9 7.44772 9 8V11C9 11.5523 8.55228 12 8 12C7.44772 12 7 11.5523 7 11V8Z"}),LA("path",{d:"M8 6C8.55228 6 9 5.55228 9 5C9 4.44772 8.55228 4 8 4C7.44772 4 7 4.44772 7 5C7 5.55228 7.44772 6 8 6Z"}),LA("path",{fillRule:"evenodd",d:"M15 8C15 11.866 11.866 15 8 15C4.13401 15 1 11.866 1 8C1 4.13401 4.13401 1 8 1C11.866 1 15 4.13401 15 8ZM14 8C14 11.3137 11.3137 14 8 14C4.68629 14 2 11.3137 2 8C2 4.68629 4.68629 2 8 2C11.3137 2 14 4.68629 14 8Z"}))),BA=LA("svg",{width:"16",height:"16",xmlns:"http://www.w3.org/2000/svg"},void 0,LA("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8 2c1.694 0 3 1.31 3 2.846V6H5V4.846C5 3.311 6.306 2 8 2ZM4 6.085V4.846C4 2.722 5.79 1 8 1s4 1.722 4 3.846V6.085A1.5 1.5 0 0 1 13 7.5v5a1.5 1.5 0 0 1-1.5 1.5h-7A1.5 1.5 0 0 1 3 12.5v-5a1.5 1.5 0 0 1 1-1.415ZM4.5 7a.5.5 0 0 0-.5.5v5a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 .5-.5v-5a.5.5 0 0 0-.5-.5h-7Z",fill:"currentColor"}),LA("path",{opacity:".1",d:"M8 7h3.5a.5.5 0 0 1 .5.5v5a.5.5 0 0 1-.5.5H8V7Z",fill:"#000"})),FA=LA("svg",{width:"16",height:"16",xmlns:"http://www.w3.org/2000/svg"},void 0,LA("path",{d:"M7.118 1.654a1 1 0 0 1 1.764 0l6.334 11.875A1 1 0 0 1 14.333 15H1.667a1 1 0 0 1-.883-1.47L7.118 1.653Z",fill:"var(--colorErrorBg)"}),LA("path",{d:"M8 5a1 1 0 0 0-1 1v3a1 1 0 0 0 2 0V6a1 1 0 0 0-1-1ZM8 11a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z",fill:"var(--colorErrorFg)"})),WA=LA("svg",{viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"},void 0,LA("path",{d:"M10.4 5c-.4-.8 0-1.8 1-2 .7 0 1.5.4 1.6 1.2a1.4 1.4 0 0 1-.2 1l-4 7c-.3.5-.7.8-1.2.8-.6 0-1-.2-1.3-.7L3.8 7.8 2.2 5c-.5-.8 0-2 1-2 .7 0 1 .2 1.4.7l1 2 1 1.4a2 2 0 0 0 1.7 1.5 2.2 2.2 0 0 0 2.3-2V6c0-.3 0-.6-.2-1z"}));function UA({pageSecurity:e,isUrlEmpty:t}){if(t)return LA(Ri.ZP,{url:C.Z.get(I.kAddressBarInlineSearchEnabled)?Wi.YvR.medium:Wi.ZuY,loadType:"faviconFromCache"});switch(e){case"web":case"warning":return RA;case"secure":return BA;case"insecure":return FA;case"internal":return WA;default:return null}}class VA extends Li.PureComponent{static contextType=ts.Z;refSiteInfoButton=Li.createRef();_popupVisible=!1;_popupVisibleOnMouseDown=!1;componentDidMount(){se.Z.windowPrivate.onPageInfoPopupChanged.addListener(this.popupChanged)}componentWillUnmount(){se.Z.windowPrivate.onPageInfoPopupChanged.removeListener(this.popupChanged),clearTimeout(this._timeoutId)}popupChanged=(e,t)=>{e===this.context.vivaldiWindowId&&(t?this._popupVisible=!0:this._timeoutId=setTimeout((()=>{this._popupVisible=!1}),1))};doActionShowPageInfo=e=>{if(e)return this.props.fieldGo();pw.Z.getActiveWebView(this.context.vivaldiWindowId)&&i.Z.windows.getCurrent({},(e=>{se.Z.zoom.getVivaldiUIZoom((t=>{const n=this.refSiteInfoButton.current;if(!n)return;const i=n.getBoundingClientRect(),{left:s=0,top:o=0}=e,a=i.left*t+s-1,r=this.props.isInternal?60:360,{screen:l}=this.context,d=(l.availHeight-(i.bottom+o)*t>r?i.bottom+6:i.top-6)*t+o,c=pw.Z.getActiveWebView(this.context.vivaldiWindowId);c&&c.showPageInfo({top:Math.round(d),left:Math.round(a)})}))}))};getFavIconData(e,t,n,i){return{favIconUrl:e||!t?C.Z.get(I.kAddressBarInlineSearchEnabled)?Wi.YvR.medium:Wi.ZuY:t,favIconType:e||!t||"img"===n?"faviconFromCache":i?"faviconSkipCache":"page"}}render(){const{vivaldiWindowId:e}=this.context,{displayUrl:t,selectedItem:n,typedUrl:i,isInternal:s,isLocal:o,sslState:a,isLoading:r}=this.props,{favIconType:l,favIconUrl:d}=function(e,t){const n=use(e);return n?{favIconUrl:n.faviconUrl,favIconType:"img"}:{favIconUrl:t?.faviconUrl||"",favIconType:t?.faviconType||"favicon"}}(i,n),c="string"==typeof i&&0===i.length||"string"!=typeof i&&0===t.length,u="string"==typeof i&&i!==t,p=!(null==n)&&yb(n);const h=u||s||o?"internal":function(e,t){return"security_error"===e?"insecure":"warning"===e||"none"===e&&!t?"warning":"secure"===e?"secure":"web"}(a,r),g=this.getFavIconData(c,d,l,p),m=Ce.ZP.isActiveInternal(e)?null:(0,B.Z)("View Site Info"),f=Ce.ZP.isActiveInternal(e)?null:"warning"===h?(0,B.Z)("Page Not Secure, Site Info"):(0,B.Z)("Site Info");return LA("div",{className:"button-toolbar"},void 0,(0,ss.jsxs)("button",{ref:this.refSiteInfoButton,className:`button-addressfield SiteInfoButton ${h}`,title:m,"aria-label":f,onMouseDown:()=>{this._popupVisibleOnMouseDown=this._popupVisible},onClick:()=>{this._popupVisibleOnMouseDown||this.doActionShowPageInfo(u),this._popupVisibleOnMouseDown=!1},draggable:this.props.draggable,onDragStart:this.props.onDragStart,disabled:this.props.isInternal&&!u,tabIndex:this.props.tabIndex,"aria-haspopup":!this.props.isInternal&&"dialog","aria-expanded":this._popupVisible,children:[u?LA(Ri.ZP,{className:"SiteInfoButton-Favicon",url:g.favIconUrl,loadType:g.favIconType}):LA("div",{className:"SiteInfoButton-SecurityBadge"},void 0,LA(UA,{pageSecurity:h,isUrlEmpty:c})),"warning"===h&&LA("span",{className:"siteinfo-text"},void 0,(0,B.Z)("Not Secure"))]}))}}const HA=VA;var GA,$A=n(5198);function KA(e){return e.local!==e.value?e.value+" ("+e.local+")":e.value}function zA(e,t,n,i){GA||(GA="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:GA,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const jA=[I.kTranslateEnabled,I.kVivaldiTranslateLanguageList];class YA extends Li.Component{static contextType=ts.Z;constructor(e,t){super(e),this.state={languages:this._getLanguages(),sourceLang:$A.Z.getTranslationCode(this.props.pageLanguage),targetLang:$A.Z.getTranslationCode(this.props.targetLang),settings:{isLanguagePairOnAlwaysTranslateList:!1,isLanguageInNeverTranslateList:!1,isSiteOnNeverTranslateList:!1,shouldShowNeverTranslateShortcut:!1,shouldShowAlwaysTranslateShortcut:!0}}}componentDidMount(){this.actionPerformed_=!1,this.updateLanguageTranslateSettings()}componentDidUpdate(e){e.translateStep!==this.props.translateStep&&"after_translate"===this.props.translateStep&&this.onCancel(),e.prefValues[I.kVivaldiTranslateLanguageList]!==this.props.prefValues[I.kVivaldiTranslateLanguageList]&&this.setState({languages:this._getLanguages()}),e.targetLang!==this.props.targetLang&&this.setState({targetLang:$A.Z.getTranslationCode(this.props.targetLang)})}componentWillUnmount(){}isLanguageSupported=()=>this.props.prefValues[I.kVivaldiTranslateLanguageList].includes(this.state.sourceLang);_getLanguages=()=>$A.Z.getTranslationLocales().map((e=>({id:$A.Z.getTranslationCode(e.key),name:KA(e)})));reportDialogClosing(e){this.isLanguageSupported()&&!this.props.isTranslated&&!1===this.actionPerformed_&&(se.Z.prefs.setTranslationDeclined(this.props.tabId,e,this.state.sourceLang,this.state.targetLang,(()=>{})),this.setActionPerformed())}setActionPerformed(){this.actionPerformed_=!0}updateLanguageTranslateSettings(){this.state.sourceLang&&this.state.targetLang&&se.Z.prefs.getTranslateSettings(this.props.tabId,this.state.sourceLang,this.state.targetLang,(e=>{this.setState({settings:e})}))}shouldShowAlwaysTranslateShortcut=()=>{if(!this.state.sourceLang||this.state.settings.shouldShowNeverTranslateShortcut)return!1;const e=Ce.ZP.getPageById(this.props.tabId);return Boolean(e&&!e.incognito)};shouldShowNeverTranslateShortcut=()=>!(!this.state.sourceLang||this.state.settings.isLanguagePairOnAlwaysTranslateList)&&this.state.settings.shouldShowNeverTranslateShortcut;isTranslationInProgress=()=>"translating"===this.props.translateStep;onCancel=()=>{this.props.hidePopup()};onTranslate=()=>{const e=$A.Z.getTranslationCode(this.state.targetLang),t=this.state.sourceLang?$A.Z.getTranslationCode(this.state.sourceLang):"auto";se.Z.tabsPrivate.translatePage(this.props.tabId,t,e,(e=>{})),this.setActionPerformed()};onRevert=()=>{se.Z.tabsPrivate.revertTranslatePage(this.props.tabId,(e=>{})),this.setActionPerformed()};onTargetLanguageSelected=e=>{const{value:t}=e.currentTarget;t!==this.state.targetLang&&($A.Z.setTargetTranslationCode(t),this.setState({targetLang:t}))};setAlwaysTranslate=e=>{se.Z.prefs.setLanguagePairToAlwaysTranslate(this.props.tabId,e,this.state.sourceLang,this.state.targetLang,(t=>{t&&(this.updateLanguageTranslateSettings(),e&&!this.props.isTranslated&&this.onTranslate())})),this.setActionPerformed()};setNeverTranslate=e=>{se.Z.prefs.setLanguageToNeverTranslate(this.props.tabId,e,this.state.sourceLang,this.state.targetLang,(e=>{e&&this.updateLanguageTranslateSettings()})),this.setActionPerformed()};setNeverTranslateSite=e=>{se.Z.prefs.setSiteToNeverTranslate(this.props.tabId,e,this.state.sourceLang,this.state.targetLang,(t=>{t&&(this.updateLanguageTranslateSettings(),e&&this.props.isTranslated&&this.onRevert())})),this.setActionPerformed()};toggleOfferToTranslate=()=>{w.Z.set(I.kTranslateEnabled,!this.props.prefValues[I.kTranslateEnabled]),this.setActionPerformed()};_onAlwaysTranslate=e=>{const t=e.target.checked;this.setAlwaysTranslate(t),this.setActionPerformed()};_onNeverTranslate=e=>{const t=e.target.checked;this.setNeverTranslate(t),this.setActionPerformed()};openTranslatePage=()=>{c.ZP.openURL(this.context.vivaldiWindowId,"https://www.vivaldi.com/translate/")};isError=()=>this.props.error&&"no_error"!==this.props.error;handleCloseClick=e=>{this.reportDialogClosing(!0),this.onCancel()};handleMenuClick=e=>{const t=[];t.push({...(0,us.Z)("Always Translate $1",[$A.Z.getHumanReadableLanguageFromCode(this.state.sourceLang)]),type:"checkbox",handler:this.setAlwaysTranslate.bind(this,!this.state.settings.isLanguagePairOnAlwaysTranslateList),checked:this.state.settings.isLanguagePairOnAlwaysTranslateList}),t.push({...(0,us.Z)("Never Translate $1",[$A.Z.getHumanReadableLanguageFromCode(this.state.sourceLang)]),type:"checkbox",handler:this.setNeverTranslate.bind(this,!this.state.settings.isLanguageInNeverTranslateList),checked:this.state.settings.isLanguageInNeverTranslateList}),t.push({...(0,us.Z)("Never Translate This Site"),handler:this.setNeverTranslateSite.bind(this,!this.state.settings.isSiteOnNeverTranslateList),type:"checkbox",checked:this.state.settings.isSiteOnNeverTranslateList}),t.push({...(0,us.Z)("Offer to Translate Pages"),type:"checkbox",handler:this.toggleOfferToTranslate.bind(this),checked:this.props.prefValues[I.kTranslateEnabled]}),(0,cs.Z)(this.context,t)(e),e.preventDefault(),e.stopPropagation()};renderDialogHeader(){return zA("div",{className:"TranslatePopup-Header"},void 0,zA("h3",{id:"popup-label-translate"},void 0,(0,B.Z)("browser","Translate Page")),this.isLanguageSupported()&&(0,ss.jsx)(ss.Fragment,{children:zA("button",{className:Fi()({"TranslatePopup-Header-CloseButton":!0}),title:(0,B.Z)("Close Dialog"),dangerouslySetInnerHTML:{__html:Wi.kze},onClick:this.handleCloseClick})}))}renderContent(){if(this.isTranslationInProgress())return null;if(!1===this.isLanguageSupported())return zA("div",{className:"dialog-content"},void 0,(0,B.Z)("Vivaldi Translate does not currently support $1 ($2).",[$A.Z.getHumanReadableLanguageFromCode(this.state.sourceLang),this.state.sourceLang]));if(this.state.languages&&this.state.languages.length>0&&!this.props.isTranslated){const e=this.state.languages.map((e=>e.id===this.state.targetLang?zA("option",{value:e.id,defaultValue:!0},e.id,e.name):e.id!==this.state.sourceLang?zA("option",{value:e.id},e.id,e.name):void 0));return zA("div",{className:"dialog-content"},void 0,zA("label",{className:"TranslatePopup-SelectLabel"},"select",(0,B.Z)("To:")),zA(ta.Z,{onChange:this.onTargetLanguageSelected,disabled:!1,value:this.state.targetLang},void 0,e))}return null}renderButtons(){const e=[];if(this.isLanguageSupported()){const t=this.isTranslationInProgress();this.isError()?e.push(zA(To,{type:"error"},"error",(0,B.Z)("Error translating page."))):t&&e.push(zA("label",{className:"TranslatePopup-Status"},"progress",(0,B.Z)("Translating..."))),this.props.isTranslated&&!t?(e.push(zA("label",{className:"TranslatePopup-Status"},"status",(0,B.Z)("This page has been translated to $1 ($2).",[$A.Z.getHumanReadableLanguageFromCode(this.state.targetLang),this.state.targetLang]))),e.push(zA("div",{className:"TranslatePopup-Buttons"},"translate-buttons",zA("input",{type:"button",className:"TranslatePopup-Buttons-Revert",onClick:this.onRevert,disabled:!1,autoFocus:!0,value:(0,B.Z)("Revert to $1",[$A.Z.getHumanReadableLanguageFromCode(this.state.sourceLang)])},"translate-revert")))):t||(this.shouldShowAlwaysTranslateShortcut()&&e.push(zA("label",{className:"TranslatePopup-Checkbox"},"alwaysTranslate",zA("input",{type:"checkbox",checked:this.state.settings.isLanguagePairOnAlwaysTranslateList,onChange:this._onAlwaysTranslate}),zA("span",{},void 0,(0,B.Z)("Always translate $1",[$A.Z.getHumanReadableLanguageFromCode(this.state.sourceLang)])))),this.shouldShowNeverTranslateShortcut()&&e.push(zA("label",{className:"TranslatePopup-Checkbox"},"neverTranslate",zA("input",{type:"checkbox",checked:this.state.settings.isLanguageInNeverTranslateList,onChange:this._onNeverTranslate}),zA("span",{},void 0,(0,B.Z)("Never translate $1",[$A.Z.getHumanReadableLanguageFromCode(this.state.sourceLang)])))),e.push(zA("div",{className:"TranslatePopup-Buttons"},"translate-buttons",zA("input",{type:"button",className:"TranslatePopup-Buttons-Translate primary",onClick:this.onTranslate,disabled:!1,value:(0,B.Z)("verb","Translate"),autoFocus:!0},"translate-button"),zA("button",{className:"TranslatePopup-Buttons-MenuButton",onClick:this.handleMenuClick},void 0,zA("span",{className:"TranslatePopup-Buttons-MenuButton-Span",value:"options",dangerouslySetInnerHTML:{__html:Wi.bqs.small}},"translate-menu"),zA("label",{className:"TranslatePopup-Buttons-MenuButton-Label"},void 0,(0,B.Z)("Options"))))))}return e}renderFooter(){return zA("footer",{className:"dialog-footer"},void 0,zA("div",{className:"TranslatePopup-FooterText"},void 0,(0,B.Z)("Powered by Lingvanex, hosted by Vivaldi."),zA("a",{href:"",className:"TranslatePopup-ReadMoreLink",onClick:this.openTranslatePage,title:(0,B.Z)("Read more about Vivaldi Translate")},void 0,(0,B.Z)("Learn More"))))}render(){return zA("div",{className:"TranslatePopup"},void 0,this.renderDialogHeader(),this.renderContent(),this.renderButtons(),this.renderFooter())}}const XA=(0,Bu.Z)(YA,jA);var QA,qA=n(85374);function JA(e,t,n,i){QA||(QA="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:QA,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class eI extends Li.PureComponent{constructor(e){super(e);const t=this.getStateFromStore();this.state={popupVisible:!1,pageLanguage:t.pageLanguage,isTranslated:t.isTranslated,translateStep:t.translateStep,error:"no_error",targetLang:$A.Z.getTargetTranslationCode(),autoTranslate:!1}}componentDidMount(){qA.ZP.addListener(this._onTranslationStateStoreChanged,(e=>e.get(this.props.tabId))),C.Z.addListener([I.kTranslateTargetLanguage],this._onPrefChanged)}componentWillUnmount(){qA.ZP.removeListener(this._onTranslationStateStoreChanged),C.Z.removeListener([I.kTranslateTargetLanguage],this._onPrefChanged)}static getDerivedStateFromProps(e){const{tabId:t}=e,n=qA.ZP.getPageState(t);if(n){const e=n.pageLanguage?n.pageLanguage:"",t=Boolean(n.isTranslated),i={pageLanguage:e,isTranslated:t,error:n.error,translateStep:n.translateStep,autoTranslate:n.autoTranslate};return t&&(i.targetLang=n.translatedLang,n.originalLang&&(i.pageLanguage=n.originalLang)),i}return null}_onPrefChanged=(e,t,n)=>{if(n===I.kTranslateTargetLanguage)this.setState({targetLang:String(t)})};getStateFromStore=()=>{const e=qA.ZP.getPageState(this.props.tabId);return{pageLanguage:e.pageLanguage?e.pageLanguage:"",isTranslated:Boolean(e.isTranslated),error:e.error,translateStep:e.translateStep,autoTranslate:e.autoTranslate}};_onTranslationStateStoreChanged=()=>{const e=this.getStateFromStore();"translating"!==e.translateStep&&"before_translate"!==e.translateStep||this.state.popupVisible||e.autoTranslate?"idle"===e.translateStep&&this.hidePopup():this.showPopup(),this.setState(e)};showPopup=()=>{this.setState({popupVisible:!0})};hidePopup=()=>{this.setState({popupVisible:!1})};togglePopup=()=>{this.setState((e=>({popupVisible:!e.popupVisible})))};render(){if(!this.state.pageLanguage||this.state.targetLang===this.state.pageLanguage)return null;const e=this.state.isTranslated;return JA(po.ZP,{isPressed:e,isOn:e,image:Wi.IeE,label:(0,B.Z)("verb","Translate Page"),tooltip:e?(0,B.Z)("Revert Page Translation"):(0,B.Z)("title","Translate Page"),onClick:this.togglePopup,popupPosition:this.props.popupPosition,hidePopup:this.hidePopup,isPopupVisible:this.state.popupVisible,size:this.props.size,popupClassName:"ToolbarButtonPopup-DefaultStyles",popupLabelledBy:"popup-label-translate",popupWidth:300,commandId:"COMMAND_TAB_TRANSLATE_PAGE"},void 0,JA(XA,{hidePopup:this.hidePopup,tabId:this.props.tabId,isTranslated:this.state.isTranslated,pageLanguage:this.state.pageLanguage,error:this.state.error,targetLang:this.state.targetLang,translateStep:this.state.translateStep}))}}const tI=eI;const nI=function(e){if(!e)return"";const t=(0,ge.Z)(e);return t?(t.hostname&&(e=t.hostname),0===e.indexOf("www.")&&(e=e.split("www.")[1]),e.includes("/")&&(e=e.split("/")[0]),e):e};var iI,sI=n(59720);function oI(e,t,n,i){iI||(iI="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:iI,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class aI extends Li.PureComponent{constructor(e){super(e)}onCloseClicked=()=>{se.Z.infobars.sendButtonAction(this.props.infoBar.tabId,this.props.infoBar.identifier,"dismiss")};onActionClicked=(e,t)=>{t.stopPropagation(),t.preventDefault(),se.Z.infobars.sendButtonAction(this.props.infoBar.tabId,this.props.infoBar.identifier,e)};render(){return oI("div",{className:"page-confirm-info-bar"},void 0,oI("label",{},void 0,this.props.infoBar.messageText),oI("div",{className:"infobar-controls"},void 0,this.props.infoBar.buttons.map((e=>oI("input",{type:"button",value:e.text,title:(0,B.Z)("Select action"),onClick:this.onActionClicked.bind(this,e.action)},e.action))),this.props.infoBar.isCloseable&&oI("button",{type:"button",title:(0,B.Z)("Close infobar"),className:"close",onMouseUp:this.onCloseClicked,dangerouslySetInnerHTML:{__html:Wi.kze}})))}}const rI=aI;var lI;function dI(e,t,n,i){lI||(lI="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:lI,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class cI extends Li.PureComponent{constructor(e){super(e),this.state={infoBars:(0,ze.aV)()}}componentDidMount(){se.Z.infobars.onInfobarCreated.addListener(this._onInfobarCreated),se.Z.infobars.onInfobarRemoved.addListener(this._onInfobarRemoved)}componentWillUnmount(){se.Z.infobars.onInfobarRemoved.removeListener(this._onInfobarRemoved),se.Z.infobars.onInfobarCreated.removeListener(this._onInfobarCreated)}_onInfobarCreated=e=>{this.props.tabId===e.tabId&&this.setState((t=>({infoBars:t.infoBars.insert(0,e)})))};_onInfobarRemoved=(e,t)=>{this.props.tabId===e&&this.setState((e=>({infoBars:e.infoBars.filter((e=>{e.tabId}))})))};render(){return dI(Li.Fragment,{},void 0,this.state.infoBars.map((e=>dI(rI,{infoBar:e},e.tabId))))}}const uI=cI;var pI;function hI(e,t,n,i){pI||(pI="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:pI,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const gI={dialog:"handleOnJavascriptDialog"};class mI extends Li.PureComponent{refWebviewDiv=Li.createRef();refDevTools=Li.createRef();state={dialogParentElement:void 0,customData:void 0};componentDidMount(){this.webview=this.refWebviewDiv.current?.firstChild,this.attachWebviewHandlers()}componentWillUnmount(){this.removeWebviewHandlers()}handleOnJavascriptDialog=e=>{e.preventDefault(),e.dialogtype="javascript",this.showDialog(e)};showDialog=e=>{e.webview=this.webview,this.setState({dialogParentElement:this.refDevTools.current,customData:e})};handleOnCloseDialog=()=>{this.setState({dialogParentElement:null})};attachWebviewHandlers=()=>{Object.keys(gI).forEach((e=>{this.webview&&this.webview.addEventListener(e,this[gI[e]])}))};removeWebviewHandlers=()=>{Object.keys(gI).forEach((e=>{this.webview&&this.webview.removeEventListener(e,this[gI[e]])}))};render(){if("off"===this.props.dockingState)return null;const e="undocked"===this.props.dockingState||!1===this.props.undockedIsUnmounted;return hI("div",{},void 0,(0,ss.jsx)("div",{ref:this.refDevTools,className:"devtools-content",children:(0,ss.jsx)("div",{ref:this.refWebviewDiv,dangerouslySetInnerHTML:{__html:`<webview name="${String(e?"vivaldi-devtools-undocked":"vivaldi-devtools-main")}"\n                inspect_tab_id="${String(this.props.tabId)}" />`}})}),this.props.active&&this.state.dialogParentElement&&this.state.customData&&hI(Pu,{customData:this.state.customData,closeDialog:this.handleOnCloseDialog}))}}const fI=mI;var vI;function yI(e,t,n,i){vI||(vI="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:vI,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class bI extends Li.PureComponent{static contextType=ts.Z;constructor(e,t){super(e),this.state={show:C.Z.get(I.kShowExtensionsBanner)}}onGoClicked=()=>{c.ZP.openURL(this.context.vivaldiWindowId,"https://vvld.in/chrome-web-store")};onCloseClicked=()=>{this.setState({show:!1}),w.Z.set(I.kShowExtensionsBanner,!1)};render(){return!this.state.show||this.props.url.indexOf("chrome://extensions")<0?null:yI("div",{className:"vivaldi-extension-banner"},void 0,yI("label",{},void 0,(0,B.Z)("You can install any extension from the Chrome Web Store directly to Vivaldi. Just open the web store and click “Add to Chrome” on your extension of choice.")),yI("div",{className:"controls"},void 0,yI("input",{type:"button",value:(0,B.Z)("Chrome Web Store"),title:(0,B.Z)("Open Chrome Web Store"),onClick:this.onGoClicked}),yI("span",{className:"close",value:"close",title:(0,B.Z)("Close"),onMouseUp:this.onCloseClicked,dangerouslySetInnerHTML:{__html:Wi.kze}})))}}const SI=bI;var wI,CI=n(12666);function AI(e,t,n,i){wI||(wI="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:wI,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class II extends Li.PureComponent{static contextType=ts.Z;nodeRef=Li.createRef();constructor(e){super(e),this.state={hitImage:null,justFound:!1,uiZoom:1},this._updateUIZoom()}componentDidUpdate(e){(this.props.selectionRect.top!==e.selectionRect.top||this.props.selectionRect.left!==e.selectionRect.left||this.props.selectionRect.width!==e.selectionRect.width||this.props.selectionRect.height!==e.selectionRect.height)&&this.props.selectionRect.width&&this.props.selectionRect.height&&(this._updateUIZoom(),this.setState({hitImage:null,justFound:!1}),this._getNewSelectionImage(this.props.selectionRect,this.props.tabId))}_updateUIZoom=()=>{se.Z.zoom.getVivaldiUIZoom((e=>{this.setState({uiZoom:e})}))};_getNewSelectionImage=(e,t)=>{const n=pw.Z.getActiveWebView(this.context.vivaldiWindowId);if(!n)return;const{uiZoom:i}=this.state,s=n.getBoundingClientRect(),o={left:parseInt(s.left+e.left/i),top:parseInt(s.top+e.top/i),width:parseInt(e.width/i),height:parseInt(e.height/i)},a={windowId:this.context.vivaldiWindowId,posX:o.left,posY:o.top,width:o.width,height:o.height,saveToDisk:!1};se.Z.thumbnails.captureUI(a,((e,t)=>{e?this.setState({hitImage:t,justFound:!0}):this.resetJustFound()}))};resetJustFound=()=>{this.setState({justFound:!1})};render(){if(!this.state.hitImage)return null;const{selectionRect:e,hitOffset:t}=this.props,{uiZoom:n}=this.state,i={position:"absolute",top:parseInt(e.top/n+t),left:parseInt(e.left/n),width:parseInt(e.width),height:parseInt(e.height)};return AI(CI.ZP,{in:this.state.justFound,appear:!0,enter:!0,exit:!0,unmountOnExit:!0,onEntered:(e,t)=>this.resetJustFound(),timeout:{appear:200,enter:200,exit:200},nodeRef:this.nodeRef},void 0,(e=>(0,ss.jsx)("img",{ref:this.nodeRef,src:this.state.hitImage,style:i,className:`fip-active-hit ${e}`})))}}const TI=II;var ZI,EI=n(29697),kI=n(34155);function _I(e,t,n,i){ZI||(ZI="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:ZI,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class NI extends Li.PureComponent{static contextType=ts.Z;_isIMEOpen=!1;refFipToolbar=Li.createRef();refInputText=Li.createRef();constructor(e){super(e),this.state=this._getStateFromStores(!1)}componentDidMount(){this.props.isActive&&No.Z.addListener(this.onWebpageviewStoreChanged)}componentWillUnmount(){this.props.isActive&&No.Z.removeListener(this.onWebpageviewStoreChanged)}componentDidUpdate(e){e.isActive!==this.props.isActive&&(this.props.isActive?No.Z.addListener(this.onWebpageviewStoreChanged):No.Z.removeListener(this.onWebpageviewStoreChanged))}onCompositionStart=()=>{this._isIMEOpen=!0};onCompositionEnd=()=>{this._isIMEOpen=!1,this.onFindInPageTextChanged()};onWebpageviewStoreChanged=e=>{if(e.pageId!==this.props.pageId)return;if("WEBPAGEVIEW_CLOSE_FIND_IN_PAGE"===e.type)return void this.setState(this._getStateFromStores(!1));const t=pw.Z.getActiveWebView(this.context.vivaldiWindowId);if(t){switch(e.type){case"WEBPAGEVIEW_RESULTS_FROM_FIND_IN_PAGE":this.setState(this._getStateFromStores(!0));break;case"WEBPAGEVIEW_ACTIONS":"findInPage"===e.action?this.setState(this._getStateFromStores(!1),this.populateWithPageSelection):"findNextInPage"===e.action?(this.focusFindInPageInput(),this.onNextClicked()):"findPreviousInPage"===e.action&&(this.focusFindInPageInput(),this.onPreviousClicked());break;case"WEBPAGEVIEW_FOCUS_FIND_IN_PAGE":this.focusFindInPageInput()}if(this.refFipToolbar.current){const e=this.refFipToolbar.current.getBoundingClientRect().height;let n;n="richtexteditor"===t.name||"markdowneditor"===t.name?this.refFipToolbar.current?.parentElement?.parentElement?.getBoundingClientRect()?.height??e:e,this.setState({hitOffset:n})}}};populateWithPageSelection=()=>{se.Z.utilities.getSelectedText(this.props.pageId,(e=>{if(e.length>0){const t=this.refInputText.current;t&&(t.value=e.substring(0,128)),this.onFindInPageTextChanged()}this.focusFindInPageInput()}))};scrollBy=e=>{let t;t=C.Z.get(I.kWebpagesSmoothScrollingEnabled)?e?()=>window.scrollBy({top:window.innerHeight,behavior:"smooth"}):()=>window.scrollBy({top:-window.innerHeight,behavior:"smooth"}):e?()=>window.scrollBy({top:window.innerHeight,behavior:"auto"}):()=>window.scrollBy({top:-window.innerHeight,behavior:"auto"}),i.Z.scripting.executeScript({target:{tabId:this.props.pageId},function:t},(()=>{i.Z.runtime.lastError}))};onKeyDown=e=>{const{ctrlKey:t,altKey:n,shiftKey:i,metaKey:s}=e,o={ctrlKey:t,altKey:n,shiftKey:i,metaKey:s};if(!(0,As.Mr)(o))switch(e.key){case"PageDown":return void this.scrollBy(!0);case"PageUp":return void this.scrollBy(!1)}"m"===e.key&&(0,As.Np)(o)&&this.onMatchCaseClicked(),"Enter"===e.key&&(this.focusFindInPageInput(),(0,As.Mr)(o)?this.onPreviousClicked():(0,As.Np)(o)?this.closeAndActivate():this.onNextClicked())};focusFindInPageInput=()=>{const e=this.refInputText.current;e&&(e.focus(),e.value&&e.select())};_getFindInPageText=()=>{const e=this.refInputText.current;return e?e.value:""};onMatchCaseClicked=()=>{this.props.onFindInPage(this._getFindInPageText(),!this.state.matchCase),this.setState((e=>({matchCase:!e.matchCase})))};focusWebview=()=>{af.Z.doAction(this.context.vivaldiWindowId,this.props.pageId,"focusWebView")};matchWord=e=>{const t=Ce.ZP.getActivePage(this.context.vivaldiWindowId)?.id;t!==this.props.pageId&&this.focusWebview(),kI.nextTick((()=>{this.props.onFindNextInPage(this._getFindInPageText(),e,this.state.matchCase)}))};onPreviousClicked=()=>this.matchWord(!0);onNextClicked=()=>this.matchWord(!1);onCloseClicked=()=>{af.Z.closeFindInPageToolbar(this.context.vivaldiWindowId,this.props.pageId)};closeAndActivate=()=>{this.onCloseClicked();const e=pw.Z.getActiveWebView(this.context.vivaldiWindowId);e&&e.stopFinding("activate")};onFindInPageTextChanged=()=>{if(this._isIMEOpen)return;const e=this._getFindInPageText();this.state.findInPageText!==e&&(this.setState({findInPageText:e}),this.props.onFindInPage(e,this.state.matchCase))};_getStateFromStores=e=>{const t=No.Z.getFindResultsForPage(this.props.pageId);let n={};return n=e?{...this.state,activeMatchOrdinal:t.activeMatchOrdinal,matchCase:t.matchCase||!1,numberOfMatches:t.numberOfMatches,selectionRect:t.selectionRect}:{activeMatchOrdinal:t.activeMatchOrdinal,findInPageText:t.searchText,hitOffset:0,isFindInPageToolbarOpen:t.isFindInPageToolbarOpen,matchCase:t.matchCase,numberOfMatches:t.numberOfMatches,selectionRect:t.selectionRect},n};render(){if(C.Z.get(I.kThemeUseAnimation)){const e=pw.Z.getActiveWebView(this.context.vivaldiWindowId);e&&Number(e.id)===this.props.pageId&&(0!==this.state.numberOfMatches&&this.state.isFindInPageToolbarOpen?(e.style.transition="filter 100ms",e.style.filter="brightness(95%)"):e.style.filter="brightness(100%)")}return _I("div",{className:"find-in-page-wrapper"},void 0,_I(EI.Z,{classNames:"find-in-page",in:this.state.isFindInPageToolbarOpen,mountOnEnter:!0,unmountOnExit:!0,timeout:{enter:300,exit:150},nodeRef:this.refFipToolbar},void 0,(0,ss.jsxs)("div",{ref:this.refFipToolbar,onKeyDown:this.onKeyDown,className:Fi()("find-in-page","toolbar","toolbar-default",{"fip-nomatches":0===this.state.numberOfMatches&&this.state.findInPageText.length>0}),tabIndex:"-1",children:[_I("span",{className:"fip-input-label"},void 0,(0,B.Z)("Find in Page:")),_I("div",{className:"fip-input-container toolbar toolbar-default"},void 0,(0,ss.jsx)("input",{ref:this.refInputText,type:"search",onChange:this.onFindInPageTextChanged,onCompositionStart:this.onCompositionStart,onCompositionUpdate:this.onCompositionStart,onCompositionEnd:this.onCompositionEnd,defaultValue:this.state.findInPageText}),_I("span",{className:"fip-results",style:{display:this.state.findInPageText.length>0?"inline":"none"}},void 0,(0,B.Z)("$1 of $2",[this.state.activeMatchOrdinal,this.state.numberOfMatches]))),_I("div",{className:"toolbar-group"},void 0,_I("div",{className:"button-toolbar button-narrow"},void 0,_I("button",{className:"button-narrow",onMouseDown:e=>e.preventDefault(),onMouseUp:this.onPreviousClicked,dangerouslySetInnerHTML:{__html:Wi.eFz.small},tooltip:(0,B.Z)("Previous match")})),_I("div",{className:"button-toolbar button-narrow"},void 0,_I("button",{className:"button-narrow",onMouseDown:e=>e.preventDefault(),onMouseUp:this.onNextClicked,tooltip:(0,B.Z)("Next match"),dangerouslySetInnerHTML:{__html:Wi.S$A.small}}))),_I("div",{className:"button-toolbar button-narrow"},void 0,_I("button",{onClick:this.onCloseClicked,tooltip:(0,B.Z)("Cancel search"),dangerouslySetInnerHTML:{__html:Wi.kze}})),_I("label",{className:"toolbar-group"},void 0,_I("input",{type:"checkbox",checked:this.state.matchCase,onChange:this.onMatchCaseClicked}),_I("span",{className:"fip-checkbox-label"},void 0,(0,B.Z)("Match Case")))]})),C.Z.get(I.kThemeUseAnimation)&&0!==this.state.numberOfMatches&&_I(TI,{tabId:this.props.pageId,selectionRect:this.state.selectionRect,hitOffset:this.state.hitOffset,hitText:this.state.findInPageText}))}}const PI=NI;var DI=n(93197);const MI=!1,OI={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},xI={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},LI={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},RI={256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",296:"ResolutionUnit",513:"JpegIFOffset",514:"JpegIFByteCount",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite"},BI={ColorSpace:{0:"Unknown",1:"sRGB",65535:"Adobe RGB / ProPhoto RGB"},ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}};function FI(e){return!!e.exifdata}function WI(e,t){function n(n){var i=function(e){var t=new DataView(e);MI;if(255!==t.getUint8(0)||216!==t.getUint8(1))return!1;var n=2,i=e.byteLength;for(;n<i;){if(255!==t.getUint8(n))return!1;if(225===t.getUint8(n+1))return KI(t,n+4,t.getUint16(n+2));n+=2+t.getUint16(n+2)}}(n),s=function(e){var t=new DataView(e);MI;if(255!==t.getUint8(0)||216!==t.getUint8(1))return!1;var n=2,i=e.byteLength,s=function(e,t){return 56===e.getUint8(t)&&66===e.getUint8(t+1)&&73===e.getUint8(t+2)&&77===e.getUint8(t+3)&&4===e.getUint8(t+4)&&4===e.getUint8(t+5)};for(;n<i;){if(s(t,n)){var o=t.getUint8(n+7);return o%2!=0&&(o+=1),0===o&&(o=4),VI(e,n+8+o,t.getUint16(n+6+o))}n++}}(n),o=function(e){if(!("DOMParser"in self))return;var t=new DataView(e);MI;if(255!==t.getUint8(0)||216!==t.getUint8(1))return!1;var n=2,i=e.byteLength,s=new DOMParser;for(;n<i-4;){if("http"===$I(t,n,4)){var o=n-1,a=t.getUint16(n-2)-1,r=$I(t,o,a),l=r.indexOf("xmpmeta>")+8,d=(r=r.substring(r.indexOf("<x:xmpmeta"),l)).indexOf("x:xmpmeta")+10;return r=r.slice(0,d)+'xmlns:Iptc4xmpCore="http://iptc.org/std/Iptc4xmpCore/1.0/xmlns/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:tiff="http://ns.adobe.com/tiff/1.0/" xmlns:plus="http://schemas.android.com/apk/lib/com.google.android.gms.plus" xmlns:ext="http://www.gettyimages.com/xsltExtension/1.0" xmlns:exif="http://ns.adobe.com/exif/1.0/" xmlns:stEvt="http://ns.adobe.com/xap/1.0/sType/ResourceEvent#" xmlns:stRef="http://ns.adobe.com/xap/1.0/sType/ResourceRef#" xmlns:crs="http://ns.adobe.com/camera-raw-settings/1.0/" xmlns:xapGImg="http://ns.adobe.com/xap/1.0/g/img/" xmlns:Iptc4xmpExt="http://iptc.org/std/Iptc4xmpExt/2008-02-29/" '+r.slice(d),jI(s.parseFromString(r,"text/xml"))}n++}}(n);e.exifdata=i||{},e.iptcdata=s||{},e.xmpdata=o||{},t&&t.call(e)}if(e.src)if(/^data\:/i.test(e.src))n(function(e,t){t=t||e.match(/^data\:([^\;]+)\;base64,/im)[1]||"",e=e.replace(/^data\:([^\;]+)\;base64,/gim,"");for(var n=atob(e),i=n.length,s=new ArrayBuffer(i),o=new Uint8Array(s),a=0;a<i;a++)o[a]=n.charCodeAt(a);return s}(e.src));else if(/^blob\:/i.test(e.src)){const t=new FileReader;t.onload=function(e){n(e.target.result)},function(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="blob",n.onload=function(e){200!==this.status&&0!==this.status||t(this.response)},n.send()}(e.src,(e=>{t.readAsArrayBuffer(e)}))}else{var i=new XMLHttpRequest;i.onload=function(){if(200!==this.status&&0!==this.status)throw"Could not load image";n(i.response),i=null},i.open("GET",e.src,!0),i.responseType="arraybuffer",i.send(null)}else if(self.FileReader&&(e instanceof self.Blob||e instanceof self.File)){const t=new FileReader;t.onload=function(e){n(e.target.result)},t.readAsArrayBuffer(e)}}const UI={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};function VI(e,t,n){for(var i,s,o,a,r=new DataView(e),l={},d=t;d<t+n;)28===r.getUint8(d)&&2===r.getUint8(d+1)&&(a=r.getUint8(d+2))in UI&&(o=r.getInt16(d+3),s=UI[a],i=$I(r,d+5,o),l.hasOwnProperty(s)?l[s]instanceof Array?l[s].push(i):l[s]=[l[s],i]:l[s]=i),d++;return l}function HI(e,t,n,i,s){var o,a=e.getUint16(n,!s),r={};for(let l=0;l<a;l++)o=n+12*l+2,r[i[e.getUint16(o,!s)]]=GI(e,o,t,n,s);return r}function GI(e,t,n,i,s){var o,a,r,l,d,c,u=e.getUint16(t+2,!s),p=e.getUint32(t+4,!s),h=e.getUint32(t+8,!s)+n;switch(u){case 1:case 7:if(1===p)return e.getUint8(t+8,!s);o=p>4?h:t+8,a=[];for(let t=0;t<p;t++)a[t]=e.getUint8(o+t);return a;case 2:return $I(e,o=p>4?h:t+8,p-1);case 3:if(1===p)return e.getUint16(t+8,!s);o=p>2?h:t+8,a=[];for(let t=0;t<p;t++)a[t]=e.getUint16(o+2*t,!s);return a;case 4:if(1===p)return e.getUint32(t+8,!s);for(a=[],l=0;l<p;l++)a[l]=e.getUint32(h+4*l,!s);return a;case 5:if(1===p)return d=e.getUint32(h,!s),c=e.getUint32(h+4,!s),(r=new Number(d/c)).numerator=d,r.denominator=c,r;a=[];for(let t=0;t<p;t++)d=e.getUint32(h+8*t,!s),c=e.getUint32(h+4+8*t,!s),a[t]=new Number(d/c),a[t].numerator=d,a[t].denominator=c;return a;case 9:if(1===p)return e.getInt32(t+8,!s);a=[];for(let t=0;t<p;t++)a[t]=e.getInt32(h+4*t,!s);return a;case 10:if(1===p)return e.getInt32(h,!s)/e.getInt32(h+4,!s);a=[];for(let t=0;t<p;t++)a[t]=e.getInt32(h+8*t,!s)/e.getInt32(h+4+8*t,!s);return a}}function $I(e,t,n){var i="";for(let s=t;s<t+n;s++)i+=String.fromCharCode(e.getUint8(s));return i}function KI(e,t){if("Exif"!==$I(e,t,4))return!1;var n,i,s,o,a,r=t+6;if(18761===e.getUint16(r))n=!1;else{if(19789!==e.getUint16(r))return!1;n=!0}if(42!==e.getUint16(r+2,!n))return!1;var l=e.getUint32(r+4,!n);if(l<8)return!1;if((i=HI(e,r,r+l,xI,n)).ExifIFDPointer)for(s in o=HI(e,r,r+i.ExifIFDPointer,OI,n)){switch(s){case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"ColorSpace":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":o[s]=BI[s][o[s]];break;case"LightSource":const e={1:5500,2:3500,3:2700,4:5e3,9:6e3,10:6e3,11:6500,12:7100,13:5400,14:4500,15:3700};i.kelvin=e[o[s]],o[s]=BI[s][o[s]];break;case"ExifVersion":case"FlashpixVersion":o[s]=String.fromCharCode(o[s][0],o[s][1],o[s][2],o[s][3]);break;case"ComponentsConfiguration":o[s]=BI.Components[o[s][0]]+BI.Components[o[s][1]]+BI.Components[o[s][2]]+BI.Components[o[s][3]]}i[s]=o[s]}if(i.GPSInfoIFDPointer)for(s in a=HI(e,r,r+i.GPSInfoIFDPointer,LI,n)){if("GPSVersionID"===s)a[s]=a[s][0]+"."+a[s][1]+"."+a[s][2]+"."+a[s][3];i[s]=a[s]}return i.thumbnail=function(e,t,n,i){var s=function(e,t,n){var i=e.getUint16(t,!n);return e.getUint32(t+2+12*i,!n)}(e,t+n,i);if(!s)return{};if(s>e.byteLength)return{};var o=HI(e,t,t+s,RI,i);if(o.Compression)switch(o.Compression){case 6:if(o.JpegIFOffset&&o.JpegIFByteCount){var a=t+o.JpegIFOffset,r=o.JpegIFByteCount;o.blob=new Blob([new Uint8Array(e.buffer,a,r)],{type:"image/jpeg"})}break;case 1:console.log("Thumbnail image format is TIFF, which is not implemented.");break;default:console.log("Unknown thumbnail image format '%s'",o.Compression)}else 2===o.PhotometricInterpretation&&console.log("Thumbnail image format is RGB, which is not implemented.");return o}(e,r,l,n),i}function zI(e){var t={};if(1===e.nodeType){if(e.attributes.length>0){t["@attributes"]={};for(var n=0;n<e.attributes.length;n++){var i=e.attributes.item(n);t["@attributes"][i.nodeName]=i.nodeValue}}}else if(3===e.nodeType)return e.nodeValue;if(e.hasChildNodes())for(var s=0;s<e.childNodes.length;s++){var o=e.childNodes.item(s),a=o.nodeName;if(t[a]){if(!t[a].push){var r=t[a];t[a]=[],t[a].push(r)}t[a].push(zI(o))}else t[a]=zI(o)}return t}function jI(e){try{var t={};if(e.children.length>0)for(var n=0;n<e.children.length;n++){var i=e.children.item(n),s=i.attributes;for(var o in s){var a=s[o],r=a.nodeName,l=a.nodeValue;void 0!==r&&(t[r]=l)}var d=i.nodeName;if(void 0===t[d])t[d]=zI(i);else{if(void 0===t[d].push){var c=t[d];t[d]=[],t[d].push(c)}t[d].push(zI(i))}}else t=e.textContent;return t}catch(e){console.log(e.message)}}const YI={getData:function(e,t){return!1!==e.complete&&(FI(e)?t&&t.call(e):WI(e,t),!0)},getTag:function(e,t){if(FI(e))return e.exifdata[t]},getAllTags:function(e){if(!FI(e))return{};var t,n=e.exifdata,i={};for(t in n)n.hasOwnProperty(t)&&(i[t]=n[t]);return i},pretty:function(e){if(!FI(e))return"";var t,n=e.exifdata,i="";for(t in n)n.hasOwnProperty(t)&&("object"==typeof n[t]?n[t]instanceof Number?i+=t+" : "+n[t]+" ["+n[t].numerator+"/"+n[t].denominator+"]\r\n":i+=t+" : ["+n[t].length+" values]\r\n":i+=t+" : "+n[t]+"\r\n");return i}};var XI;function QI(e,t,n,i){XI||(XI="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:XI,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function qI(e){return`${e[0]}° ${e[1]}' ${e[2]}"`}const JI=function({windowId:e,GPSLatitude:t,GPSLatitudeRef:n,GPSLongitude:i,GPSLongitudeRef:s}){const o=`http://tools.wmflabs.org/geohack/geohack.php?language=en&params=${t.join("_")}_${n}_${i&&i.join("_")}_${s}_`,a=`${qI(t)} ${n},\n            ${qI(i)} ${s}`;return QI("div",{className:"image-metadata-generic"},void 0,QI("h3",{},void 0,(0,B.Z)("other","Location")),QI("div",{},void 0,QI("a",{onClick:()=>function(e,t){c.ZP.openURL(e,t)}(e,o),href:o,title:(0,B.Z)("Open in GeoHack")},void 0,a)))};var eT;function tT(e,t,n,i){eT||(eT="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:eT,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const nT=function({value:e,name:t}){return tT("div",{className:"image-metadata-generic"},void 0,tT("h3",{},void 0,t),tT("div",{},void 0,e))};var iT;function sT(e,t,n,i){iT||(iT="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:iT,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const oT=[I.kKeyboardTabToAll],aT=["0°",(0,B.Z)("Vertical Mirror"),"180°",(0,B.Z)("Horizontal Mirror"),(0,B.Z)("90° Horizontal Mirror"),"270°",(0,B.Z)("270° Vertical Mirror"),"90°"],rT=document.createElement("canvas"),lT=rT.getContext("2d"),dT=document.createElement("canvas"),cT=dT.getContext("2d");class uT extends Li.Component{static contextType=ts.Z;refButtonForTests=Li.createRef();style=Cs.ZP.convertColorsToVariables(DI.ZP.forTheme(Cs.ZP.getThemeWithFallback("Vivaldi2")));constructor(e){super(e),this.state={histogramChannels:[],histogramStyle:3,histogramImage:null,height:0,width:0,size:0,data:{},status:0},dT.width=768,dT.height=300,cT.globalCompositeOperation="lighter",cT.lineWidth=1.5,rT.width=600,rT.height=400}componentDidMount(){this.props.open&&this.loadPhoto()}componentDidUpdate(e){this.props.open&&0===this.state.status&&this.loadPhoto()}loadPhoto=()=>{const{document:e}=this.context;this.props.url?this.setState({status:1},(()=>{const t=this.props.url,n=e.createElement("img"),i=[{fill:xe()("#f00"),data:[]},{fill:xe()("#0f0"),data:[]},{fill:xe()("#00f"),data:[]},{fill:xe()("#999"),data:[]}],s=i[0],o=i[1],a=i[2],r=i[3];let l,d=0;n.onload=()=>YI.getData(n,(()=>{l&&URL.revokeObjectURL(l);const e=n.width/n.height;let t=rT.width,c=t/e,u=0,p=0;c>rT.height?(c=rT.height,t=c*e,u=(rT.width-t)/2):p=(rT.height-c)/2,lT.clearRect(0,0,rT.width,rT.height),lT.drawImage(n,u,p,t,c);const h=lT.getImageData(0,0,rT.width,rT.height);for(let e=0;e<256;e+=1)s.data[e]=0,o.data[e]=0,a.data[e]=0,r.data[e]=0;const g=h.data.length/256;for(let e=0,t=h.data.length;e<t;e+=4)if(h.data[e+3]>0){const t=h.data[e],n=h.data[e+1],i=h.data[e+2];s.data[t]+=1/g,o.data[n]+=1/g,a.data[i]+=1/g}for(let e=0;e<256;e+=1)r.data[e]=.2126*s.data[e]+.7152*o.data[e]+.0722*a.data[e];const m=YI.getAllTags(n);for(const e in m)"string"==typeof m[e]&&(m[e]=m[e].replace(/\0/g,""));this.setState({data:m,histogramChannels:i,height:n.naturalHeight,width:n.naturalWidth,size:d,status:2},this.updateHistogram)})),t.startsWith("file:/")?se.Z.utilities.readImage(t).then((e=>{const t=new Uint8Array(e.data),i=new Blob([t],{type:e.type});d=i.size,l=URL.createObjectURL(i),n.src=l})).catch((e=>{this.setState({status:3})})):fetch(t).then((e=>e.blob())).then((e=>{d=e.size,l=URL.createObjectURL(e),n.src=l})).catch((e=>{this.setState({status:3})}))})):this.setState({status:0})};updateHistogram=()=>{let e=[];switch(this.state.histogramStyle){case 0:e=[this.state.histogramChannels[0]];break;case 1:e=[this.state.histogramChannels[1]];break;case 2:e=[this.state.histogramChannels[2]];break;case 4:e=[this.state.histogramChannels[3]];break;case 3:e=[this.state.histogramChannels[0],this.state.histogramChannels[1],this.state.histogramChannels[2]]}cT.clearRect(0,0,dT.width,dT.height),e.forEach((e=>{cT.beginPath(),cT.moveTo(0,dT.height);for(let t=0;t<e.data.length+1;t+=1){const n=Math.round(e.data[t]*dT.height);cT.lineTo(3*t,dT.height-n)}cT.lineTo(dT.width,dT.height),cT.strokeStyle=e.fill.css(),cT.fillStyle=e.fill.alpha(.3).css(),cT.fill(),cT.stroke(),cT.closePath()})),this.setState({histogramImage:dT.toDataURL()})};setHistogramStyle(e){this.setState({histogramStyle:e},this.updateHistogram)}_createClipboardData=()=>this.props.url+"\n\n"+this.state.width+" × "+this.state.height+"\n"+(0,Mg.Z)(this.state.size)+"\n\n"+JSON.stringify(this.state.data,null,2);copyToClipboard=e=>{if(!(this.state.size&&this.state.width&&this.state.height))return;const t=this._createClipboardData();this.context.navigator.clipboard.writeText(t)};render(){if(!this.props.open)return null;const e=this.state.data,t=Object.keys(e).length>0&&e.DateTimeOriginal,n=decodeURI(this.props.url.split("/").pop().split("#")[0].split("?")[0].toString()),i=e.ExposureTime?e.ExposureTime.valueOf():void 0,s=e.Copyright??"";return sT("div",{className:"image-inspector",style:this.style},void 0,sT("header",{},void 0,sT("h1",{},void 0,n),sT("button",{className:"close no-stroke",title:(0,B.Z)("Close inspector"),onClick:this.props.toggleImageInspector,dangerouslySetInnerHTML:{__html:Wi.kze}})),sT("div",{className:"image-inspector-container"},void 0,1===this.state.status&&sT("p",{className:"in-progress"},void 0,(0,B.Z)("Analyzing image...")),3===this.state.status&&sT("p",{},void 0,(0,B.Z)("Unable to analyze image.")),2===this.state.status&&sT("div",{className:"image-inspector-metadata"},void 0,sT("div",{className:"image-histogram"},void 0,sT("img",{className:"histogram",title:(0,B.Z)("Histogram"),src:this.state.histogramImage}),sT("div",{className:"toolbar text"},void 0,sT("button",{tabIndex:this.props.prefValues[I.kKeyboardTabToAll],className:"button-toolbar "+(4===this.state.histogramStyle?"button-selected":""),onClick:()=>this.setHistogramStyle(4)},void 0,(0,B.Z)("Brightness")),sT("button",{tabIndex:this.props.prefValues[I.kKeyboardTabToAll],className:"button-toolbar "+(3===this.state.histogramStyle?"button-selected":""),onClick:()=>this.setHistogramStyle(3)},void 0,"RGB"),sT("span",{},void 0,sT("button",{tabIndex:this.props.prefValues[I.kKeyboardTabToAll],className:"button-toolbar "+(0===this.state.histogramStyle?"button-selected":""),onClick:()=>this.setHistogramStyle(0)},void 0,"R"),sT("button",{tabIndex:this.props.prefValues[I.kKeyboardTabToAll],className:"button-toolbar "+(1===this.state.histogramStyle?"button-selected":""),onClick:()=>this.setHistogramStyle(1)},void 0,"G"),sT("button",{tabIndex:this.props.prefValues[I.kKeyboardTabToAll],className:"button-toolbar "+(2===this.state.histogramStyle?"button-selected":""),onClick:()=>this.setHistogramStyle(2)},void 0,"B")))),t&&sT("div",{className:"image-metadata-device"},void 0,sT("span",{className:"image-camera",dangerouslySetInnerHTML:{__html:Wi.b0l}}),sT("h3",{},void 0,"Canon"===e.Make?"":e.Make," ",e.Model)),t&&sT("div",{className:"image-metadata-core"},void 0,sT("div",{title:(0,B.Z)("Aperture")},void 0,sT("span",{dangerouslySetInnerHTML:{__html:Wi.S1h}}),e.FNumber&&`f/${e.FNumber.valueOf()}`),sT("div",{title:(0,B.Z)("ISO Speed")},void 0,sT("span",{dangerouslySetInnerHTML:{__html:Wi.KyY}}),e.ISOSpeedRatings&&e.ISOSpeedRatings),sT("div",{title:(0,B.Z)("Exposure time")},void 0,sT("span",{dangerouslySetInnerHTML:{__html:Wi.CKA}}),i&&i<1&&(0,B.Z)("1/$1 second","1/$1 seconds",[Math.round(1/i*100)/100]),i&&i>=1&&(0,B.Z)("$1 second","$1 seconds",[i])),sT("div",{title:(0,B.Z)("Focal length")},void 0,sT("span",{dangerouslySetInnerHTML:{__html:Wi.heI}}),(e.FocalLengthIn35mmFilm||e.FocalLength)&&`${e.FocalLengthIn35mmFilm?.valueOf()||e.FocalLength?.valueOf()||0} mm`)),e.WhiteBalance&&sT("div",{className:"image-white-balance"},void 0,sT("h3",{},void 0,(0,B.Z)("White Balance")),e.LightSource&&"Unknown"!==e.LightSource?e.LightSource:e.WhiteBalance,e.kelvin&&sT("div",{className:"image-kelvinscale"},void 0,sT("span",{className:"kelvin-indicator",style:{left:(e.kelvin-2e3)/70+"%"}},void 0,e.kelvin,"K"))),this.state.width&&this.state.height&&sT(nT,{value:this.state.width+" × "+this.state.height+" ("+Math.round(this.state.height*this.state.width/1e5)/10+"MP)",name:(0,B.Z)("Dimensions")}),this.state.size&&sT(nT,{value:(0,Mg.Z)(this.state.size),name:(0,B.Z)("Size")}),e.ColorSpace&&sT(nT,{value:`${e.ColorSpace}`,name:(0,B.Z)("Color Space")}),e.GPSLatitude&&e.GPSLatitudeRef&&e.GPSLongitude&&e.GPSLongitudeRef&&sT(JI,{windowId:this.context.vivaldiWindowId,GPSLatitude:e.GPSLatitude,GPSLatitudeRef:e.GPSLatitudeRef,GPSLongitude:e.GPSLongitude,GPSLongitudeRef:e.GPSLongitudeRef}),""!==s.trim()&&sT(nT,{value:s,name:(0,B.Z)("Copyright")}),e.DateTimeOriginal&&sT(nT,{value:e.DateTimeOriginal,name:(0,B.Z)("Captured at")}),e.Orientation&&sT(nT,{value:aT[e.Orientation-1],name:(0,B.Z)("Orientation")}),e.Software&&sT(nT,{value:e.Software,name:(0,B.Z)("Software")}),sT("div",{className:"toolbar text alldata-toolbar"},void 0,(0,ss.jsx)("button",{ref:this.refButtonForTests,className:"button-toolbar",tabIndex:this.props.prefValues[I.kKeyboardTabToAll],onClick:this.copyToClipboard,children:(0,B.Z)("Copy Data to Clipboard")})))))}}const pT=(0,Bu.Z)(uT,oT);var hT;function gT(e,t,n,i){hT||(hT="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:hT,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class mT extends Li.PureComponent{static contextType=ts.Z;state={actionLog:[]};_actionLoggerChanged=e=>{const{actionType:t,...n}=e;let i=`${(new Date).toLocaleString()}: ${t.padEnd(35)}`;if(Object.keys(n).length>0){let e=!1;for(const t in n)try{let s=JSON.stringify(n[t]);if(void 0===s&&(s="undefined"),i.length+s.length>160){e=!0;continue}i+=`${t}: ${s}, `}catch(t){e=!0}e&&(i+="...")}this.setState((e=>{const t=e.actionLog.concat(i);return t.length>500&&t.splice(0,1),{actionLog:t}}))};componentDidMount(){A.Z.setLogCallback(this._actionLoggerChanged)}componentWillUnmount(){A.Z.setLogCallback(void 0)}getContextMenuItems=()=>[{handler:()=>this.setState({actionLog:[]}),...(0,us.Z)("Clear")}];onContextMenu=e=>{(0,cs.Z)(this.context,this.getContextMenuItems())(e)};render(){return gT("div",{className:"actionlog",id:"action_logger",tabIndex:"0",onContextMenu:this.onContextMenu},void 0,gT("textarea",{className:"actionlogs",readOnly:!0,value:this.state.actionLog.join("\n")}))}}const fT=mT;var vT,yT;function bT(e,t,n,i){vT||(vT="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:vT,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function ST({enabled:e,locked:t,fullName:n,description:i,onValueChange:s}){return bT("div",{className:"setting-single"},void 0,bT("label",{},void 0,bT("input",{type:"checkbox",checked:e,disabled:t,onChange:({currentTarget:e})=>s(e.checked)}),bT("span",{},void 0,n)),bT("p",{className:"info"},void 0,i))}function wT(e,t,n,i){yT||(yT="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:yT,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var CT=wT("br",{});function AT(){return wT("div",{className:"Experiments-Caution"},void 0,(0,B.Z)("These experimental features may change, break, disappear, not work as intended or at all."),CT,(0,B.Z)("Please proceed with caution."))}var IT,TT=wT(AT,{});class ZT extends Li.PureComponent{constructor(e){super(e),this.state={experiments:this.getFeatureFlags()}}getFeatureFlags=()=>Oi.Z.getFlags().filter((e=>!("chat"===e.name)));_handleChange=(e,t)=>{Oi.Z.enableFeature(e,t).then((()=>this.setState({experiments:this.getFeatureFlags()})))};render(){return wT("div",{className:"Experiments vivaldi-settings",tabIndex:"0"},void 0,wT("h2",{className:"Experiments-Header"},void 0,(0,B.Z)("Experimental features")),TT,wT("div",{className:"setting-subgroup"},void 0,this.state.experiments.map((e=>wT(ST,{fullName:e.friendlyName,description:e.description,locked:e.locked,enabled:e.value,onValueChange:this._handleChange.bind(null,e.name)},e.name)))))}}function ET(e,t,n,i){IT||(IT="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:IT,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const kT="https://vvld.in/guest";function _T(e,t){t.preventDefault(),c.ZP.openURL(e,kT,{inCurrent:!1,inBackground:!1})}var NT=ET("svg",{className:"guest-intro-background",viewBox:"0 0 1244 860"},void 0,ET("path",{fill:"url(#guest-intro-bg-gradient)",d:"M0 0h153.513c16.141 27.93 32.15 55.734 47.912 83.11 16.086 27.94 32.722 56.832 49.076 85.128 11.01 19.031 22.079 38.316 32.781 56.967 25.186 43.883 51.228 89.259 77.402 132.848 33.382 55.651 75.894 82.121 137.77 85.829 3.205.192 6.454.288 9.655.288 39.673 0 78.14-14.461 108.316-40.722 21.644-18.834 48.687-52.291 54.604-104.667.749-6.654 1.357-13.708 1.855-19.573-1.07-29.74-6.476-52.92-17.294-74.518C622.935 139.46 612.708 67.99 625.087 0h136.676C747.1 44.93 749.845 96.364 774.32 145.251c20.839 41.6 30.654 85.7 31.485 138.023-.568 6.192-1.472 18.273-2.83 30.356-17.572 155.524-149.172 263.318-294.866 263.318-5.816 0-11.67-.173-17.526-.521C382.84 569.97 301.9 518.174 246.822 426.358c-38.015-63.313-74.255-127.68-111.253-191.634C90.359 156.507 45.49 78.062 0 0zm1113.47 0H1244v140.1c-7.496 27.86-18.849 54.995-34.031 81.275a1299530.57 1299530.57 0 0 1-170.255 294.799A1223193.145 1223193.145 0 0 0 841.018 860.24H687.72c135.675-235.123 271.527-470.147 407.26-705.25 22.311-38.621 31.22-79.696 25.368-124.548A170.12 170.12 0 0 0 1113.471 0z"}));class PT extends Li.Component{static contextType=ts.Z;render(){return ET("div",{className:"guest-intro"},void 0,NT,ET("div",{className:"guest-intro-content"},void 0,ET("h1",{},void 0,(0,B.Z)("title","Guest Profile")),ET("span",{className:"guest-intro-icon",dangerouslySetInnerHTML:{__html:Wi.CtH.large}}),ET("p",{},void 0,(0,B.Z)("Browsing with a Guest profile means that searches, sites visited, cookies, and temporary files won’t be stored by Vivaldi. It does not encrypt or otherwise modify your connection.")),ET("p",{},void 0,ET("a",{tabIndex:0,href:kT,onClick:e=>_T(this.context.vivaldiWindowId,e)},void 0,(0,B.Z)("Learn more about Guest Profiles")))))}}const DT=PT;var MT=n(36964);class OT extends hr.Z{dispatchAction(e){this.emitChange(e)}}const xT=new OT(A.Z);var LT;function RT(e,t,n,i){LT||(LT="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:LT,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class BT extends Li.Component{onRequestClose=()=>{this.props.onRequestClose?this.props.onRequestClose():this.props.onClose(!1)};onClose=()=>{this.props.onClose(!1)};onConfirmed=()=>{this.props.onClose(!0)};renderDialog=()=>(0,ss.jsxs)(ss.Fragment,{children:[RT("div",{className:"dialog-content"},void 0,this.props.prompt.map((e=>RT("p",{},e,e)))),RT("footer",{className:"dialog-footer"},void 0,RT("input",{type:"submit",className:this.props.danger?"danger":null,value:this.props.positive,onClick:this.onConfirmed,autoFocus:!this.props.danger}),!this.props.hideNegative&&RT("input",{type:"button",value:this.props.negative,onClick:this.onClose,autoFocus:this.props.danger}))]});render(){return this.props.preventInnerModal?(0,ss.jsxs)(ss.Fragment,{children:[RT("div",{className:"dialog-header"},void 0,RT("h1",{className:"dialog-title"},void 0,this.props.title)),this.renderDialog()]}):RT(ra.Z,{className:"slide",style:{width:this.props.dialogWidth||400,minWidth:"unset"},onRequestClose:this.onRequestClose,title:this.props.title},void 0,this.renderDialog())}}const FT=BT;var WT,UT=n(13933);function VT(e,t,n,i){WT||(WT="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:WT,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const HT="https://",GT={width:400,minWidth:"unset"};function $T({onCreateLink:e,onCancelCreateLink:t,anchorOrSelection:n,isAnchor:i,useAddress:s}){const o=Li.useRef(),a=s?n?(0,B.Z)("Edit Address"):(0,B.Z)("Add Address"):i&&n?(0,B.Z)("Edit Link"):(0,B.Z)("Create Link");let r;return r=i||n.startsWith("http")?n:HT+n,VT(ra.Z,{style:GT,onRequestClose:t,title:a},void 0,VT("form",{onSubmit:()=>{e(o.current?(0,rl.q9)(o.current.value):HT)}},void 0,VT("div",{className:"dialog-content"},void 0,(0,ss.jsx)("input",{ref:o,defaultValue:r,type:"text",autoFocus:!0,onFocus:e=>e.currentTarget.select()})),VT("footer",{className:"dialog-footer"},void 0,VT("input",{type:"submit",className:"primary",value:(0,B.Z)("Save Link")}),VT("input",{type:"button",onClick:t,value:(0,B.Z)("Cancel")}))))}var KT;function zT(e,t,n,i){KT||(KT="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:KT,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const jT=[[{command:"bold",text:(0,B.Z)("Bold"),icon:Wi.q7H},{command:"italic",text:(0,B.Z)("Italic"),icon:Wi.znb},{command:"underline",text:(0,B.Z)("Underline"),icon:Wi.slH},{command:"strikeThrough",text:(0,B.Z)("Strike through"),icon:Wi._QD}],[{command:"justifyLeft",text:(0,B.Z)("Left align"),icon:Wi.W_c},{command:"justifyCenter",text:(0,B.Z)("Center align"),icon:Wi.vxN},{command:"justifyRight",text:(0,B.Z)("Right align"),icon:Wi.JUc},{command:"justifyFull",text:(0,B.Z)("Justify"),icon:Wi.FsT}],[{command:"insertOrderedList",text:(0,B.Z)("Numbered list"),icon:Wi.o_D},{command:"insertUnorderedList",text:(0,B.Z)("Bullet list"),icon:Wi.rr$}],[{command:"outdent",text:(0,B.Z)("Remove indentation"),icon:Wi.XKb},{command:"indent",text:(0,B.Z)("Indent"),icon:Wi.b2r}],[{command:"createLink",text:(0,B.Z)("Create Link"),icon:Wi.v2I},{command:"insertImage",text:(0,B.Z)("Insert Image"),icon:Wi.kkq}],[{command:"undo",text:(0,B.Z)("win_linux","Undo"),icon:Wi.LwO},{command:"redo",text:(0,B.Z)("win_linux","Redo"),icon:Wi.W9w}],[{command:"removeFormat",text:(0,B.Z)("Remove formatting"),icon:Wi.mHT}]];class YT extends Li.Component{isAnchor=!1;anchorOrSelection="";state={buttonState:[],createLinkModalOpen:!1,formatBlock:"p",fontName:"sans-serif",fontSize:"2",foreColor:"#111111",backColor:"#f6f6f6",minimizeToolbar:!!this.props.isSignature};updateButtonState=e=>{const t=jT.flat().map((e=>e.command)).indexOf("createLink"),n=e&&e[0]||[];n[t]=Boolean(this.isAnchor&&this.anchorOrSelection),this.setState({buttonState:n})};updateDropdownAndColorState=e=>{if(Array.isArray(e)&&1===e.length&&Array.isArray(e[0])){const[t,n,i,s,o]=e[0];this.setState({formatBlock:""===t||"div"===t?"p":t,fontName:n.startsWith('"')&&n.endsWith('"')?n.substring(1,n.length-1):n,fontSize:i,foreColor:"rgb(0, 0, 0)"===s?"#111111":xe()(s).hex(),backColor:"rgba(0, 0, 0, 0)"===o?"#f6f6f6":xe()(o).hex()})}};updateLinkState=e=>{this.isAnchor=e.isAnchor,this.anchorOrSelection=e.anchorOrSelection};onCreateLink=e=>{this.setState({createLinkModalOpen:!1}),this.props.onCreateLink(e)};onCancelCreateLink=()=>{this.setState({createLinkModalOpen:!1}),this.props.onCancelCreateLink()};showCreateLinkModal=()=>this.setState({createLinkModalOpen:!0});render(){let e=0;return(0,ss.jsxs)(ss.Fragment,{children:[this.state.createLinkModalOpen&&zT($T,{onCreateLink:this.onCreateLink,onCancelCreateLink:this.onCancelCreateLink,isAnchor:this.isAnchor,anchorOrSelection:this.anchorOrSelection}),zT("div",{className:"editor-html-toolbar"},void 0,!this.state.minimizeToolbar&&zT(ta.Z,{onChange:e=>this.props.onChange("formatBlock",e),value:this.state.formatBlock,title:(0,B.Z)("Paragraph Format"),tabIndex:"-1"},void 0,zT("option",{value:"h1"},void 0,(0,B.Z)("Heading 1")),zT("option",{value:"h2"},void 0,(0,B.Z)("Heading 2")),zT("option",{value:"h3"},void 0,(0,B.Z)("Heading 3")),zT("option",{value:"h4"},void 0,(0,B.Z)("Heading 4")),zT("option",{value:"p"},void 0,(0,B.Z)("Paragraph")),zT("option",{value:"pre"},void 0,(0,B.Z)("Preformatted")),zT("option",{value:"blockquote"},void 0,(0,B.Z)("Quote"))),zT(ta.Z,{onChange:e=>this.props.onChange("fontName",e),value:this.state.fontName,title:(0,B.Z)("Font"),tabIndex:"-1"},void 0,zT("option",{value:"serif"},void 0,(0,B.Z)("Serif")),zT("option",{value:"sans-serif"},void 0,(0,B.Z)("Sans-Serif")),zT("option",{value:"monospace"},void 0,(0,B.Z)("Fixed Width"))),!this.state.minimizeToolbar&&zT(ta.Z,{onChange:e=>this.props.onChange("fontSize",e),value:this.state.fontSize,title:(0,B.Z)("Font Size"),tabIndex:"-1"},void 0,zT("option",{value:"1"},void 0,(0,B.Z)("Extra Small")),zT("option",{value:"2"},void 0,(0,B.Z)("mail","Small")),zT("option",{value:"3"},void 0,(0,B.Z)("Normal")),zT("option",{value:"4"},void 0,(0,B.Z)("mail","Large")),zT("option",{value:"5"},void 0,(0,B.Z)("Larger")),zT("option",{value:"6"},void 0,(0,B.Z)("Extra Large"))),jT.map(((t,n)=>{n>0&&(e+=jT[n-1].length);const i=this.props.isSignature?t.filter((e=>"insertImage"!==e.command&&(!this.state.minimizeToolbar||!["insertOrderedList","insertUnorderedList","outdent","indent","undo","redo","removeFormat"].includes(e.command)))):t;if(0!==i.length)return zT("span",{className:"editor-button-group"},n,i.map(((t,n)=>zT("button",{tabIndex:"-1",onClick:()=>this.props.onClick(t.command),title:t.text,className:this.state.buttonState[e+n]?"active":null,dangerouslySetInnerHTML:{__html:t.icon}},t.command))))})),zT("input",{type:"color",tabIndex:"-1",className:"text-color",title:(0,B.Z)("Text Color"),value:this.state.foreColor,onChange:e=>this.props.onChangeColor("foreColor",e)}),!this.state.minimizeToolbar&&zT("input",{type:"color",tabIndex:"-1",className:"text-bg-color",title:(0,B.Z)("Text Background Color"),value:this.state.backColor,onChange:e=>this.props.onChangeColor("backColor",e)}),this.props.isSignature&&zT("span",{className:"editor-button-group"},void 0,zT("button",{tabIndex:"-1",style:{float:"right"},onClick:()=>this.setState((e=>({minimizeToolbar:!e.minimizeToolbar}))),title:this.state.minimizeToolbar?(0,B.Z)("Show more"):(0,B.Z)("Show less"),dangerouslySetInnerHTML:{__html:this.state.minimizeToolbar?Wi.yaZ.small:Wi.OCp.small}})))]})}}const XT=["colorFg","colorFgAlpha","colorFgIntense","colorBg","colorBgIntense","colorBgDark","colorBorder","colorHighlightBg","colorHighlightBgAlpha","colorBorder","radiusRounded"];var QT=n(65741),qT=n(97781);const JT=[...XT,"colorBgLighter","colorFgFadedMore"];class eZ extends Li.Component{static contextType=ts.Z;refWebview=Li.createRef();#ge=[];constructor(e,t){super(e);const n=Be.Z.getBaseStylesByWindowId(t.vivaldiWindowId,JT);this.state={windowStyle:n}}componentDidMount(){Be.Z.addListener(this.onThemeStoreChanged),this.refWebview.current?.addEventListener("consolemessage",this.handleConsoleMessage),this.refWebview.current?.addEventListener("contentload",this.handleContentLoad),this.refWebview.current?.addEventListener("newwindow",this.handleLinkClicked),se.Z.tabsPrivate.onKeyboardChanged.addListener(this.keyEventListener)}componentWillUnmount(){this.#ge.forEach((e=>URL.revokeObjectURL(e))),Be.Z.removeListener(this.onThemeStoreChanged),this.refWebview.current?.removeEventListener("consolemessage",this.handleConsoleMessage),this.refWebview.current?.removeEventListener("contentload",this.handleContentLoad),this.refWebview.current?.removeEventListener("newwindow",this.handleLinkClicked),se.Z.tabsPrivate.onKeyboardChanged.removeListener(this.keyEventListener)}onThemeStoreChanged=()=>{const e=Be.Z.getBaseStylesByWindowId(this.context.vivaldiWindowId,JT);(0,QT.Z)(e,this.state.windowStyle)||this.setState({windowStyle:e},this.setStyle)};static defaultProps={hidden:!1};focus(){return this.refWebview.current?.focus()}blur(){return this.refWebview.current?.blur()}hasFocus(){const{document:e}=this.context;return!!this.refWebview.current&&this.refWebview.current===e.activeElement}getContentAsBodyParts=()=>{const e=this.refWebview.current;return e?new Promise(((t,n)=>{e.executeScript({code:"document.body.innerHTML"},(e=>{e&&Array.isArray(e)&&"string"==typeof e[0]?t([{type:"html",content:e[0]}]):n("RichTextEdit.getContentAsBodyParts: Couldn't get content from Webview")}))})):Promise.reject("RichTextEdit.getContentAsBodyParts: Webview doesn't exist")};getWebview=()=>{const e=this.refWebview.current;if(!e)throw new Error("RichTextEdit.getContentAsBodyParts: Webview doesn't exist");return e};postMessage=e=>{this.refWebview.current?.contentWindow?.postMessage?.(e,"*")};setContent=e=>{this.postMessage({type:"SET_CONTENT",content:e})};setStyle=()=>{let e=Cs.ZP.createStyleRoot(this.state.windowStyle);e+=this.props.isNote?"\n    html, body, iframe {\n      background-color: var(--colorBg);\n      padding: 0;\n      margin: 0;\n      font-family: sans-serif;\n      overflow: initial;\n    }\n    body[contenteditable=\"plaintext-only\"] {\n      font-family: monospace;\n    }\n    body {\n      --EditorPadding: 12px;\n      --MaxWidth: 700px;\n      margin-left: var(--EditorPadding);\n      padding-left: calc(calc(50% - calc(var(--MaxWidth) / 2) - var(--EditorPadding))) !important;\n      padding-right: calc(50% - calc(var(--MaxWidth) / 2)) !important;\n      padding-top: var(--EditorPadding);\n      padding-bottom: calc(var(--EditorPadding) * 3);\n      color: var(--colorFgIntense);\n      font-size: 100%;\n      cursor: text;\n    }\n    img {\n      display: inline-block;\n      vertical-align: top;\n      max-width: 100%;\n      height: auto;\n    }\n    a:-webkit-any-link {\n      color: var(--colorHighlightBg);\n      cursor: pointer;\n    }\n  \n    html {\n      width: calc(100% - 12px);\n    }\n    html, body, iframe {\n      font-size: 100%;\n    }\n    input[type=checkbox] {\n      appearance: none;\n      position: relative;\n      width: 16px;\n      height: 16px;\n      min-width: 16px;\n      min-height: 16px;\n      vertical-align: middle;\n      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1) inset;\n      margin: unset;\n      border-width: 1px;\n      border-style: solid;\n      border-color: rgba(0,0,0,0.2);\n      background-color: var(--colorBgIntense);\n    }\n    input[type='checkbox']:disabled {\n      opacity: 1;\n      filter: grayscale(1);\n    }\n    input[type=checkbox]:before,\n    input[type=checkbox]:after {\n      content: '';\n      position: absolute;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background-color: var(--colorHighlightBg);\n      transform-origin: 0 0;\n    }\n    input[type=checkbox]:before {\n      transform: rotate(-45deg) translateY(45%) translateX(-30%) scaleX(0.25) scaleY(0);\n    }\n    input[type=checkbox]:checked:before {\n      transform: rotate(-45deg) translateY(45%) translateX(-30%) scaleX(0.25) scaleY(0.4);\n    }\n    input[type=checkbox]:after {\n      transform: rotate(225deg) translateY(-30%) translateX(-95%) scaleX(0.25) scaleY(0);\n    }\n    input[type=checkbox]:checked:after {\n      transform: rotate(225deg) translateY(-30%) translateX(-95%) scaleX(0.25) scaleY(1.2);\n    }\n    \n    .tooltip {\n      --TipWidth: 480px;\n      position: relative;\n    }\n    .tooltip .tooltip-text * {\n      user-select: none;\n    }\n    .tooltip-text input {\n      margin-left: 3px;\n      border: 1px solid var(--colorBorder);\n      border-radius: 2px;\n      font-size: 13px;\n      opacity: 0.8;\n      color: var(--colorFg);\n      background-color: var(--colorBg);\n    }\n    .tooltip-text input:active {\n      background-color: var(--colorBgDark);\n    }\n    .tooltip-text input:first-of-type {\n      margin-left: 12px;\n    }\n    .tooltip-text a {\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      color: var(--colorFg);\n    }\n    .tooltip .tooltip-text {\n      cursor: default;\n      position: absolute;\n      z-index: 1;\n      display: flex;\n      align-items: center;\n      top: 100%;\n      left: -6px;\n      max-width: var(--TipWidth);\n      padding: 6px 6px 6px 12px;\n      color:var(--colorFg);\n      background-color: var(--colorBg);\n      border: 1px solid var(--colorBgDark);\n      box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.1), 0 3px 10px rgba(0, 0, 0, 0.3);\n      border-radius: 3px;\n    }\n  \n  ":function(e=!1){const t="black_on_white"===C.Z.get(I.kMailComposerColors);return`html, body {\n      overflow: initial;\n    }\n    body {\n      margin: ${e?"6px":"12px 24px 24px"};\n      font-family: sans-serif;\n      font-size: 100%;\n      color: ${t?"black;":"var(--colorFgIntense)"};\n      background-color: ${t?"white;":"var(--colorBgIntense)"};\n    }\n    img {\n      display: inline-block;\n      vertical-align: top;\n      max-width: 100%;\n      height: auto;\n    }\n    [contenteditable] {\n      cursor: text;\n    }\n    blockquote {\n      padding-inline-start: 18px;\n      border-left: 3px solid inherit;\n      margin: 0;\n      opacity: 0.85;\n    }\n    pre {\n      white-space: pre-wrap;\n    }\n    \n    .tooltip {\n      --TipWidth: 480px;\n      position: relative;\n    }\n    .tooltip .tooltip-text * {\n      user-select: none;\n    }\n    .tooltip-text input {\n      margin-left: 3px;\n      border: 1px solid var(--colorBorder);\n      border-radius: 2px;\n      font-size: 13px;\n      opacity: 0.8;\n      color: var(--colorFg);\n      background-color: var(--colorBg);\n    }\n    .tooltip-text input:active {\n      background-color: var(--colorBgDark);\n    }\n    .tooltip-text input:first-of-type {\n      margin-left: 12px;\n    }\n    .tooltip-text a {\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      color: var(--colorFg);\n    }\n    .tooltip .tooltip-text {\n      cursor: default;\n      position: absolute;\n      z-index: 1;\n      display: flex;\n      align-items: center;\n      top: 100%;\n      left: -6px;\n      max-width: var(--TipWidth);\n      padding: 6px 6px 6px 12px;\n      color:var(--colorFg);\n      background-color: var(--colorBg);\n      border: 1px solid var(--colorBgDark);\n      box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.1), 0 3px 10px rgba(0, 0, 0, 0.3);\n      border-radius: 3px;\n    }\n  `}(this.props.isSignature),this.postMessage({type:"SET_STYLE",isNote:this.props.isNote,style:e})};debouncedUpdateState=(0,Ae.Z)((()=>{this.props.updateButtonState(),this.props.updateDropdownAndColorState()}),100);handleConsoleMessage=e=>{let t,n;const i=e.message.indexOf(" ");switch(-1===i?(t=e.message,n=""):(t=e.message.substring(0,i),n=e.message.substring(i+1)),t){case"selectionchange":this.debouncedUpdateState();const i=n.startsWith("anchor"),s=n.substring(7);this.props.handleLinkEvent({type:t,isAnchor:i,anchorOrSelection:s});break;case"input":this.debouncedUpdateState(),this.props.onChange(e);break;case"createLink":case"editLink":case"copyLink":case"unlink":this.props.handleLinkEvent({type:t});break;case"dragover":{const e={dataTransfer:{types:n?n.split(","):[]}};this.props.onDragOver?.(e);break}default:throw new Error(e.message)}};handleLinkClicked=e=>{e.targetUrl.startsWith("#")||(c.ZP.openURL(this.context.vivaldiWindowId,e.targetUrl),e.preventDefault())};handleContentLoad=()=>{this.setStyle(),this.props.onContentLoad?.(),this.postMessage({type:"CONTENT_LOAD_REPLY",translatedStrings:{copyValue:(0,B.Z)("link","Copy"),copyTitle:(0,B.Z)("Copy Link Address"),editValue:(0,B.Z)("link","Edit"),editTitle:(0,B.Z)("Edit Link Address"),unlinkValue:(0,B.Z)("link","Remove"),unlinkTitle:(0,B.Z)("Remove Link")}})};keyEventListener=(e,t,n,i,s)=>{const{document:o}=this.context;1===n&&t&&i===xa.Z.KEY_TAB&&o.activeElement&&o.activeElement===this.refWebview.current&&this.props.focusPreviousElement()};execCommand=(e,t,n=!0)=>{this.postMessage({type:"EXEC_COMMAND",command:e,value:t}),n&&setTimeout((()=>this.refWebview.current?.focus()),0)};onChange=(e,t)=>{this.execCommand(e,t.currentTarget.value),this.props.updateDropdownAndColorState()};onClick=e=>{switch(e){case"createLink":this.props.handleLinkEvent({type:"createLinkClicked"});break;case"insertImage":this.insertImage();break;default:this.execCommand(e,""),this.props.updateButtonState()}};insertImage=async()=>{const{showOpenFilePicker:e}=this.context,[t]=await e({types:[{description:"Images",accept:{"image/*":[".png",".gif",".jpeg",".jpg"]}}]}),n=await t.getFile(),i=URL.createObjectURL(n);this.#ge.push(i),this.execCommand("insertHTML",`<img src="${i}" ${qT.ZR}="${n.type}" ${qT.Gx}="${t.name}" />`)};unlink=()=>{this.execCommand("unlink",!1)};selectSurrounding=()=>{this.postMessage({type:"SELECT_SURROUNDING"})};setZoomLevel=e=>{const t=this.refWebview.current;t&&(t.setZoomMode("per-view"),t.setZoom(e))};executeScript=e=>new Promise(((t,n)=>{this.refWebview.current?this.refWebview.current.executeScript(e,t):n()}));render(){return(0,ss.jsx)("webview",{className:"editor-webview",name:"richtexteditor",ref:this.refWebview,style:this.props.hidden||this.props.disabled?{display:"none"}:{},allowtransparency:"on",src:'data:text/html,<html id="content" tabindex="-1">\n  <head>\n    <style id="richtextstyle"></style>\n    <link id="stylesheet"></link>\n    <script src="chrome-extension://mpognobbkildjkofajifpdfhcoklimli/richtexteditor-bundle.js"><\/script>\n  </head>\n  <body class="MarkdownRender" contenteditable="true">\n  </body>\n</html>\n'})}}function tZ(e,t){const[n,i]=(0,Li.useState)(!1),s=(0,Li.useCallback)((e=>{e.dataTransfer.types.includes("Files")&&i(!0)}),[]),o=(0,Li.useCallback)((e=>{e.target===e.currentTarget&&(e.preventDefault(),i(!1))}),[]),a=(0,Li.useCallback)((t=>{i(!1);const n=[...t.dataTransfer.items].filter((e=>"file"===e.kind)).map((e=>e.getAsFile()));n.length>0&&(t.preventDefault(),e(n))}),[e]);return(0,Li.useEffect)((()=>{const e=t?.current;n?e?.style.setProperty("pointer-events","none"):e?.style.removeProperty("pointer-events")}),[t,n]),{canDropFile:n,onDragLeave:o,onDragOver:s,onDrop:a}}async function nZ(e){const t=["attached-pending"],n=crypto.randomUUID();try{return await se.Z.mailPrivate.writeBufferToMessageFile(t,n,e),n}catch(e){throw new Error(`Failed to write attachment buffer (${n}) to disk: ${e}`)}}var iZ;function sZ(e,t,n,i){iZ||(iZ="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:iZ,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const oZ=(0,Li.forwardRef)(((e,t)=>{const n=(0,Li.useRef)(null),i=(0,Li.useRef)(null);function s(){const e=n.current?.refWebview.current;e&&e.executeScript({code:"['formatBlock', 'fontName', 'fontSize', 'foreColor', 'backColor'].map(\n         command => document.queryCommandValue(command));"},(e=>{i.current&&i.current.updateDropdownAndColorState(e)}))}(0,Li.useImperativeHandle)(t,(()=>({focus:()=>{n.current&&n.current.focus()},getContentAsBodyParts:()=>{if(!n.current)throw new Error("MailComposer: Building body parts after body is gone");return n.current.getContentAsBodyParts()},getWebview:()=>{if(!n.current)throw new Error("MailComposer: Getting webview body is gone");return n.current.getWebview()},setContent:e=>{n.current?.setContent(e)}})),[]);const{canDropFile:o,onDragLeave:a,onDragOver:r,onDrop:l}=e.onSignatureAttachmentDrop?(d=n.current?.refWebview,c=e.onSignatureAttachmentDrop,tZ((0,Li.useCallback)((async e=>{for(const t of e){if(t.size>2e6){nn.Z.warn("Mail",["signature"],`Image ${t.name} is too large (over 2MB) to add to signature`);continue}const e=await new Promise(((e,n)=>{const i=new FileReader;i.onloadend=({currentTarget:t})=>{const{result:i}=t;i.startsWith("data:image/")?e(i):n("Not an image")},i.readAsDataURL(t)}));await new Promise(((t,n)=>{if(d&&d.current){let i="";d.current.executeScript({code:"document.body.innerHTML"},(s=>{s&&Array.isArray(s)&&"string"==typeof s[0]?(i=String(s[0])+`<div><img alt="" src="${e}"></div>`,i&&(d.current?.executeScript({code:`document.body.innerHTML = unescape('${escape(i)}');`}),c(i)),t()):n("RichTextEdit.getContentAsBodyParts: Couldn't get contet from Webview")}))}}))}}),[c,d]),d)):function(e,t){return tZ((0,Li.useCallback)((async t=>{const n=[];for(const i of t){if(i.size>It.gh&&"cancel"===await de.Z.showLargeAttachmentWarning(i.name,i.size))continue;let t;try{t=await i.arrayBuffer()}catch(t){console.error("useAttachmentDrop: "+t.toString()),u.Z.setStatus(e,t.toString());continue}const s=await nZ(t);n.push({type:"attachment",content:s,filename:i.name,mimeType:i.type,fileSize:t.byteLength})}MT.Z.addAttachments(n)}),[e]),t)}(e.windowId,n.current?.refWebview);var d,c;const p=!!e.onSignatureAttachmentDrop;return sZ("div",{className:"editor-html"},void 0,(0,ss.jsx)(YT,{ref:i,onClick:function(e){n.current&&n.current.onClick(e)},onCreateLink:function(e){const t=n.current;t&&(""===e?t.execCommand("unlink"):"https://"!==e&&t.execCommand("createLink",e),t.focus())},onCancelCreateLink:function(){n.current&&n.current.focus()},onChange:function(e,t){n.current&&n.current.execCommand(e,t.currentTarget.value),s()},onChangeColor:function(e,t){const i=n.current;i&&i.execCommand(e,t.currentTarget.value,!1)},isSignature:p}),o&&sZ("div",{className:"file-dropzone",onDragLeave:a,onDrop:l,onDragOver:e=>e.preventDefault()},void 0,sZ("h1",{},void 0,(0,B.Z)("Drop file(s) here"))),(0,ss.jsx)(eZ,{ref:n,isSignature:p,onChange:e.onBodyChange,onDragOver:r,onContentLoad:e.onContentLoad,focusPreviousElement:e.focusPreviousElement,updateDropdownAndColorState:s,updateButtonState:function(){const e=n.current?.refWebview.current,t='"'+jT.flat().map((e=>e.command)).join('","')+'"';e&&e.executeScript({code:`[${t}].map(command => document.queryCommandState(command));`},(e=>{i.current&&i.current.updateButtonState(e)}))},handleLinkEvent:function(e){const t=i.current;if(!t)return;const{isAnchor:s,anchorOrSelection:o}=t;switch(e.type){case"selectionchange":t.updateLinkState(e);break;case"createLink":case"editLink":t.showCreateLinkModal();break;case"copyLink":break;case"unlink":s&&o&&n.current?.unlink();break;case"createLinkClicked":s&&o&&n.current?.selectSurrounding(),t.showCreateLinkModal()}}}))})),aZ=oZ,rZ=(e,t)=>{for(const n of e){let e=!1;for(const i of t)0!==i.indexOf(n)||(e=!0);if(!e)return!1}return!0};var lZ,dZ=n(78614);function cZ(e,t,n,i){lZ||(lZ="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:lZ,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function uZ(e,t){const n=/[\S]+/g;let i=[];if(e&&(i=i.concat(e.match(n)||[])),t){const e=t.match(/[^@.+]+/g)||[];i=i.concat([...e,...t.split("@"),t])}return new Set(i.map((e=>e.toLowerCase())))}function pZ(e,t,n=[],i,s){const o=gs()(((e,t)=>{const n=new Map(e);return t.forEach((({address:e,name:t})=>{n.has(e)&&n.delete(e)})),n}))(t,n);return gs()(((e,t)=>{const n=s?[{address:e}]:[];for(const[i,s]of t){(0===s.size?new Set([""]):s).forEach((t=>{if(e.length>0){const s=uZ(e),o=uZ(t,i);rZ(s,o)&&n.push({address:i,name:t})}else n.push({address:i,name:t})}))}return i?.resetSelectionModel(),i?.setIndexSelected(0,!0),n}))(e,o)}class hZ extends Li.Component{refMultiInputOptions={};selectionModel=new Xi;constructor(e){super(e),this.state={filteredList:[],inputValue:"",dropDownVisible:!1,isEditing:!1,selectedIndex:-1}}isMetaKeyPressed=!1;onKeyArrowUp=()=>{const e=this.selectionModel.leadIndex;if(e>0){this.selectionModel.resetSelectionModel(),this.selectionModel.setIndexSelected(e-1,!0);const t=this.refMultiInputOptions["option_"+(e-1)];t&&t.scrollIntoViewIfNeeded(),this.forceUpdate()}};onKeyArrowDown=()=>{const e=this.selectionModel.leadIndex;if(e<this.state.filteredList.length-1){this.selectionModel.resetSelectionModel(),this.selectionModel.setIndexSelected(e+1,!0);const t=this.refMultiInputOptions["option_"+(e+1)];t&&t.scrollIntoViewIfNeeded(),this.forceUpdate()}};inputChanged=e=>{const t=this.refInputField?this.refInputField.value:"";this.props.onChange&&this.props.onChange(e);const n=pZ(t,this.props.allItems,this.props.selectedItems,this.selectionModel,this.props.showTypedTextAsOption);let i=!0;0!==t.length&&0!==n.length||(i=!1);const s=this.props.setIsValidInput;if(s){let e=!1;if(t.trim().length>0){const n=(0,dZ.D$)(t);if(n.length>0){const t=n[0];(0,dZ.HZ)(t.address)&&(e=!0)}}s(e)}this.setState({inputValue:t,filteredList:n,dropDownVisible:i})};onOptionClick=e=>{this.selectOption(e)};onItemClick=e=>{this.removeOption(e,!0)};removeOption=(0,Ae.Z)(((e,t)=>{const n=this.props.selectedItems,[i]=n.splice(e,1),s=t?e:Math.max(e-1,0);this.setState(((e,o)=>(o.itemSelectionCallback(n),{isEditing:t,selectedIndex:n.length>0?s:-1,inputValue:t?(0,dZ.li)(i):""})),(()=>{this.state.isEditing||-1===this.state.selectedIndex?this.focusInput():this.focusItem(s)}))}));inputConfirmed=e=>{let t=!1;if(e&&e.value&&e.value.trim().length>0){let n="";const i=this.props.selectedItems,s=(0,dZ.D$)(e.value);for(;s.length>0;){const e=s.shift();if(!(0,dZ.HZ)(e.address)){s.unshift(e),n=(0,dZ.Rz)(s);break}-1===this.state.selectedIndex?i.push(e):i.splice(this.state.selectedIndex,0,e),t=!0}t&&(this.setState((e=>({isEditing:!1,inputValue:n,dropDownVisible:!1})),(()=>this.focusItem(this.state.selectedIndex))),this.props.itemSelectionCallback(i))}return t};selectAll=()=>{this.selectionModel.resetSelectionModel(),this.setState(((e,t)=>(t.itemSelectionCallback([]),{inputValue:t.selectedItems.map((e=>(0,dZ.li)(e))).join(", "),dropDownVisible:!1})),(()=>this.refInputField&&this.refInputField.select()))};selectOption=e=>{e.address.length<3||(this.selectionModel.resetSelectionModel(),this.setState(((t,n)=>{const i=n.selectedItems;return-1===t.selectedIndex?i.push(e):i.splice(t.selectedIndex,0,e),n.itemSelectionCallback(i),{isEditing:!1,inputValue:"",dropDownVisible:!1}}),(()=>this.focusItem(this.state.selectedIndex))))};inputKeyUp=()=>{this.isMetaKeyPressed=!1};inputKeyDown=e=>{const t=e.keyCode;t===xa.Z.KEY_CONTROL&&(this.isMetaKeyPressed=!0);const n=!this.refInputField||0===this.refInputField.value.trim().length,i=this.state.filteredList[this.selectionModel.leadIndex],s=t===xa.Z.KEY_TAB||t===xa.Z.KEY_RETURN;if(n&&this.isMetaKeyPressed&&"a"===e.key)return this.selectAll(),e.preventDefault(),void e.stopPropagation();this.state.dropDownVisible&&void 0!==i&&s?(this.selectOption(i),e.preventDefault(),e.stopPropagation()):s||","===e.key?(this.inputConfirmed(this.refInputField)&&e.preventDefault(),e.stopPropagation()):t===xa.Z.KEY_ESCAPE?this.state.dropDownVisible?this.setState({dropDownVisible:!1}):this.inputConfirmed(this.refInputField)?e.preventDefault():(this.onKeyArrowLeft(),e.preventDefault(),e.stopPropagation()):this.state.dropDownVisible&&t===xa.Z.KEY_DOWN?(this.onKeyArrowDown(),e.preventDefault()):this.state.dropDownVisible&&t===xa.Z.KEY_UP?(this.onKeyArrowUp(),e.preventDefault()):!n||t!==xa.Z.KEY_LEFT&&t!==xa.Z.KEY_BACK_SPACE?n&&t===xa.Z.KEY_RIGHT&&(this.onKeyArrowRight(),e.preventDefault(),e.stopPropagation()):(this.onKeyArrowLeft(),e.preventDefault(),e.stopPropagation())};onKeyArrowLeft=()=>{let e;const t=-1===this.state.selectedIndex;e=this.state.isEditing?this.state.selectedIndex-1:t?this.props.selectedItems.length-1:Math.max(this.state.selectedIndex-1,-1),this.setState({selectedIndex:e,isEditing:!1,inputValue:"",dropDownVisible:!1},(()=>{e<0?this.focusInput():this.focusItem(e)}))};onKeyArrowRight=()=>{const e=this.state.selectedIndex+1;e===this.props.selectedItems.length?this.setState({isEditing:!1,selectedIndex:-1},(()=>this.focusInput())):this.setState((t=>({isEditing:!1,selectedIndex:e})),(()=>this.focusItem(e)))};inputLostFocus=e=>{this.props.clearInputOnBlur&&this.inputConfirmed(this.refInputField),this.setState({dropDownVisible:!1})};itemKeyDown=(e,t)=>{const n=t.keyCode;if(this.state.dropDownVisible&&e===this.props.selectedItems.length-1&&this.focusInput(),n===xa.Z.KEY_LEFT)this.onKeyArrowLeft(),t.preventDefault(),t.stopPropagation();else if(n===xa.Z.KEY_RIGHT)this.onKeyArrowRight(),t.preventDefault(),t.stopPropagation();else if(n===xa.Z.KEY_BACK_SPACE||n===xa.Z.KEY_DELETE)this.removeOption(e),t.preventDefault(),t.stopPropagation();else if(n===xa.Z.KEY_RETURN){const t=!0;this.removeOption(e,t)}else n===xa.Z.KEY_ESCAPE&&this.setState({isEditing:!1,selectedIndex:-1},(()=>this.focusInput()))};onClose=(e,t)=>{this.removeOption(e),t.stopPropagation()};onFocus=e=>{this.setState({selectedIndex:e})};renderSelectedItem=(e,t)=>{let n="";return e.address?n=e.address:"string"==typeof e&&(n=e),(0,ss.jsxs)("div",{title:n,onKeyDown:this.itemKeyDown.bind(this,t),onFocus:()=>this.onFocus(t),ref:e=>this.refMultiInputOptions["item_"+t]=e,onClick:this.onItemClick.bind(this,t),className:Fi()("multiinput-item",this.props.className),tabIndex:this.state.selectedIndex===t||0===this.props.tabIndex?0:-1,children:[e.name&&cZ("span",{className:"multiinput-item-primary"},void 0,e.name),e.name&&e.address&&cZ("span",{className:"multiinput-item-secondary"},void 0,"<"+e.address+">"),!e.name&&e.address&&cZ("span",{className:"multiinput-item-primary"},void 0,e.address),cZ("button",{type:"button",className:"close",dangerouslySetInnerHTML:{__html:Wi.kze},onClick:e=>this.onClose(t,e),tabIndex:this.props.tabIndex})]},"selected_item_"+t)};focusInput=()=>{this.refInputField&&this.refInputField.focus()};focusItem=e=>{this.refMultiInputOptions["item_"+e]?.focus()};renderMailAddressForOption=e=>cZ("div",{},void 0,e.name?cZ(Li.Fragment,{},void 0,cZ("div",{className:"multiinput-option-primary",title:e.name},void 0,e.name),cZ("div",{className:"multiinput-option-secondary",title:e.address},void 0,"<"+this.shortenEmail(e.address,42)+">")):cZ("div",{className:"multiinput-option-primary-single",title:e.address},void 0,this.shortenEmail(e.address,60)));shortenEmail(e,t){if(e.length>t){let n="";const[i,s]=e.split("@");return s?(n+=t/3<i.length?i.slice(0,t/3)+"…":i,n+="@",n+=t/2<s.length?"…"+s.slice(t/2*-1):s):n=i.slice(0,t),n}return e}renderInputField=()=>(0,ss.jsx)("input",{type:"text",ref:e=>this.refInputField=e,value:this.state.inputValue,onChange:this.inputChanged,onBlur:this.inputLostFocus,onKeyDown:this.inputKeyDown,onKeyUp:this.inputKeyUp,autoComplete:"false",spellCheck:"false",placeholder:this.props.placeholder});renderOption=(e,t)=>{const n=this.selectionModel.isSelected(t),i=(0,ss.jsxs)("div",{className:Fi()("multiinput-option",e.address.length<3&&"multiinput-option-disabled"),ref:e=>this.refMultiInputOptions["option_"+t]=e,role:"option","data-id":t,"data-selected":n?"":null,onClick:this.onOptionClick.bind(this,e),children:[this.props.showTypedTextAsOption&&0===t&&cZ("span",{dangerouslySetInnerHTML:{__html:Wi.YvR.medium}}),this.renderMailAddressForOption(e)]},"option_"+t);return this.props.showTypedTextAsOption&&0===t?cZ("div",{className:Fi()("multiinput-leading",1===this.state.filteredList.length&&"multiinput-leading-only")},"option_first_item",i):i};renderDropDown=()=>cZ("div",{role:"listbox",className:"multiinput-select"},void 0,this.state.filteredList.map(this.renderOption));getInput=()=>cZ("div",{className:"multiinput-group"},"input_"+this.state.selectedIndex,this.renderInputField(),this.state.dropDownVisible?this.renderDropDown():"");render(){const e=this.props.selectedItems.map(this.renderSelectedItem);return this.state.isEditing?e.splice(this.state.selectedIndex,0,this.getInput()):e.push(this.getInput()),(0,ss.jsx)("div",{ref:e=>this.refMultiInputEnvelope=e,className:"multiinput",children:e})}}const gZ=hZ;var mZ=n(5267),fZ=n(88951);var vZ=n(55346),yZ=n(93818),bZ=n(89846),SZ=n(93043);var wZ=n(57357);var CZ,AZ=n(77312),IZ=n(13519),TZ=n(27569),ZZ=n(16888),EZ=n(34155);function kZ(e,t,n,i){CZ||(CZ="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:CZ,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const _Z=[I.kKeyboardTabToAll,I.kMailAccounts,I.kMailComposeHeadersHidden];class NZ extends Li.PureComponent{static contextType=ts.Z;refTo=Li.createRef();refFrom=Li.createRef();signature="";draftCreated=!1;fromDraft=!0;fetchDraftFromDBAfterMount=!1;refBody=Li.createRef();refSubject=Li.createRef();messageId=(0,fZ.Z)();draftIsPlaintext=!1;cidAttachments=[];focusOnBody=!1;constructor(e){super(e),this.state=this._initDraft()}_initDraft=()=>{const e=iu.Z.getAccountsAndAliases(),t={from:e.length>0?[{address:e[0].MAIL_EMAIL}]:[],to:[],cc:[],bcc:[],subject:"",attachments:[],mailAddresses:Ed.Z.getMailAddresses(),showModal:!1,replyAllPossible:!1,replyScope:""},n=this.props.mailto&&!this.props.searchListId?(0,Qt.J)(this.props.mailto):UT.Z.getAndClear();return n?(this.sentDate=n.sentDate,this.threadKey=n.threadKey,this.references=n.references,this.messageId=n.messageId,this.cidAttachments=n.cidAttachments||[],this.listId=n.listId,this.listPost=n.listPost,this.inReplyTo=n.inReplyTo,this.forwarded=n.forwarded,this.replied=n.replied,this._setReplyAllPossible(),this.draftIsPlaintext=n.plaintext,this.focusOnBody=n.focusOnBody,this.selectedAccount=n.selectedAccount,t.attachments=n.attachments,t.bcc=n.bcc,t.cc=n.cc,t.from=n.from,t.subject=n.subject,t.to=n.to,t.replyScope=n.replyScope,this.bodyDraft=n.body,this.fromDraft=n.fromDraft??!0,this.fromDraft||(this.signature=(0,TZ.SG)((0,TZ.o$)(t.from,e,!!n.replied,!!n.forwarded),this.getSignaturePosition())),t):(this.fetchDraftFromDBAfterMount=!0,this.sentDate=Date.now(),this.draftIsPlaintext=!1,this.bodyDraft="",t)};_setReplyAllPossible=async()=>{if(this.replied){const e=await vZ.Z.call(this.replied);if(e&&this._isMounted){const{uniqueTo:t,uniqueCc:n}=Qt.Z.getUniqueReceivers(e);this.setState({replyAllPossible:t.length+n.length>1})}}};_setIfActive=e=>{const{searchListId:t}=e;e.isActive&&t?EZ.nextTick((()=>MT.Z.setSearchListId(t))):e.isActive||this.flushPendingChanges()};_contactsChanged=()=>{const e=Ed.Z.getMailAddresses();this.setState({mailAddresses:e})};_moveFromDraftsToOutbox=async(e,t)=>{const n={filteringPriority:It.Un.HIGH,addedProperties:t?{}:{searchList:{queued:!0}}},{sleUpdate:i,updatedSle:s}=await(0,bZ.Z)(e,It.of,It.Wb,It.of,It.J8,n);return d.Z.updateIndex({sleUpdates:[i]}),cn.Z.filter(),s};_queueMessage=async e=>{const{to:t,cc:n,bcc:i}=this.state;if([t,n,i].every((e=>0===e.length)))return void this.setState({showModal:!0});const{searchListId:s}=this.props;let o;if(s){if(await this.flushPendingChanges(),o=await(0,yZ.Z)(s),o){ht.Z.getByIds(o.sourceFilterIds).some((e=>e.accountId===It.of&&e.path===It.Wb))&&(o=await this._moveFromDraftsToOutbox(s,e))}}else this.cancelPendingChanges();if(!o){const t=await this.buildMessage();o=await Xt.Z.storeMessage(t,e)}e&&Xt.Z.sendSelected(this.context.vivaldiWindowId,[o]),c.ZP.close(this.context.vivaldiWindowId)};_addAttachments=e=>{this.setState((t=>({attachments:[...t.attachments,...e]})),(()=>this.updateAttribute(this.onBodyChange)))};_chooseAttachments=async()=>{const{showOpenFilePicker:e}=this.context,t=await e({multiple:!0}),n=[];for(const e of t){const t=await e.getFile();if(t.size>It.gh){if("cancel"===await de.Z.showLargeAttachmentWarning(t.name,t.size))continue}const i=await t.arrayBuffer(),s=await nZ(i);n.push({type:"attachment",content:s,filename:e.name,fileSize:t.size,mimeType:t.type})}this._addAttachments(n)};_deleteDraftMessage=async()=>{this.cancelPendingChanges();const{searchListId:e}=this.props;if(e)if(ht.Z.isInDraftOrOutbox(e)){await(0,AZ.fN)(e);const t=[e];SZ.Z.call(t),mZ.Z.deleteMessages(t),d.Z.updateIndex({removedSles:[e]}),nn.Z.log("Mail",["composer","discard draft"],"Message deleted!")}else nn.Z.warn("Mail",["composer","discard draft"],"Message is not a draft - probably has already been sent!");c.ZP.close(this.context.vivaldiWindowId)};_reactIfActive=e=>{this.props.isActive&&"MAIL_ACTIVE_COMPOSER_ADD_ATTACHMENTS"===e.actionType&&this._addAttachments(e.newAttachments)};onCommandSpy=(e,t)=>{if(this.props.isActive&&e===this.context.vivaldiWindowId)switch(t){case"COMMAND_MAIL_SEND_MESSAGE":this._queueMessage(!0);break;case"COMMAND_MAIL_QUEUE_MESSAGE":this._queueMessage(!1);break;case"COMMAND_MAIL_COMPOSER_CHOOSE_ATTACHMENTS":this._chooseAttachments();break;case"COMMAND_MAIL_COMPOSER_DELETE_DRAFT":this._deleteDraftMessage()}};_hideModal=()=>{this.setState({showModal:!1})};componentDidMount(){this._isMounted=!0,this._setIfActive(this.props),Oa.Z.addListeners(["COMMAND_MAIL_SEND_MESSAGE","COMMAND_MAIL_QUEUE_MESSAGE","COMMAND_MAIL_COMPOSER_CHOOSE_ATTACHMENTS","COMMAND_MAIL_COMPOSER_DELETE_DRAFT"],this.onCommandSpy),xT.addListener(this._reactIfActive),Ed.Z.addListener(this._contactsChanged),this.focusOnBody&&this.refBody.current?this.refBody.current.focus():this.refTo.current&&this.refTo.current.focusInput();const{searchListId:e}=this.props;e&&this.fetchDraftFromDBAfterMount&&(async()=>{await Qt.Z.prepareDraft(e)&&this._isMounted&&this.setState(this._initDraft(),this.onContentLoad)})()}onContentLoad=()=>{if(!this.bodyDraft&&!this.signature)return;const e=[],t=this.getSignaturePosition();""!==this.bodyDraft&&"above"!==t||e.push({content:"<br>",isPlainText:!1}),(this.replied||this.forwarded)&&("above"===t?e.push({content:this.signature,isPlainText:!1}):e.push({content:(0,TZ.SG)("","above"),isPlainText:!1})),""!==this.bodyDraft&&e.push({content:this.bodyDraft,isPlainText:this.draftIsPlaintext}),"below"===t&&this.draftIsPlaintext&&this.bodyDraft&&e.push({content:"<br>",isPlainText:!1}),"below"!==t&&this.bodyDraft?e.push({content:(0,TZ.SG)("","below"),isPlainText:!1}):e.push({content:this.signature,isPlainText:!1}),e.length>0&&this.refBody.current?.setContent(e),this.signature="",this.bodyDraft="",this.draftIsPlaintext=!1};componentDidUpdate(e){e.isActive!==this.props.isActive&&this._setIfActive(this.props)}componentWillUnmount(){this._isMounted=!1,Oa.Z.removeListeners(["COMMAND_MAIL_SEND_MESSAGE","COMMAND_MAIL_QUEUE_MESSAGE","COMMAND_MAIL_COMPOSER_CHOOSE_ATTACHMENTS","COMMAND_MAIL_COMPOSER_DELETE_DRAFT"],this.onCommandSpy),xT.removeListener(this._reactIfActive),Ed.Z.removeListener(this._contactsChanged),this.flushPendingChanges()}getSignaturePosition=()=>(!!this.replied||!!this.forwarded)&&this.selectedAccount?.signaturePosition||"below";_updateSignature=e=>{const t=iu.Z.getAccountsAndAliases(),n=(0,TZ.o$)(e,t,!!this.replied,!!this.forwarded),i=this.getSignaturePosition(),s=this.refBody.current;if(!s)return;const o="below"===i?".viv-signature-below":".viv-signature",a=".viv-signature-below"===o?".viv-signature":".viv-signature-below";s.getWebview().executeScript({code:`\n      if (document.body.querySelector(':scope > ${a}') instanceof HTMLSpanElement) {\n        document.body.querySelector(':scope > ${a}').innerHTML = unescape('${escape("")}');\n      }\n      if (document.body.querySelector(':scope > ${o}') instanceof HTMLSpanElement) {\n        document.body.querySelector(':scope > ${o}').innerHTML = unescape('${escape(n)}');\n      }\n    `})};buildMessage=()=>this.refBody.current?this.refBody.current.getContentAsBodyParts().then(this.processBodyParts).then((e=>({from:this.state.from,to:this.state.to,cc:this.state.cc,bcc:this.state.bcc,subject:this.state.subject,sentDate:this.sentDate,threadKey:this.threadKey,bodyParts:e,flags:["\\Seen"],listId:this.listId,listPost:this.listPost,inReplyTo:this.inReplyTo,replied:this.replied,forwarded:this.forwarded,...this.references?{references:this.references}:null,internal:!0,messageId:this.messageId,queued:!1}))):Promise.reject();_createDraftMessage=async e=>{const t=await async function(e){const{addedSles:t,forSearchDb:n}=await(0,sn.Z)(It.of,It.Wb,It.kY,[e],{filteringPriority:It.Un.HIGH});(0,on.Z)(n);const[i]=t;if(!i)throw new Error("Failed to store message in drafts folder");return i}(e),{id:n,threadKey:s}=t;if(await dn.Z.setHasRaw(It.of,n),this.threadKey=s,this._isMounted){const e=`${this.props.url}&query={"id":${n}}`;i.Z.tabs.update(this.props.pageId,{url:e})}d.Z.updateIndex({addedSles:[t]}),cn.Z.filter(),jt.Z.updateThreads()};updateAttribute=e=>this.props.searchListId?e(this.props.searchListId):this.draftCreated?Promise.resolve():(this.draftCreated=!0,this.buildMessage().then(this._createDraftMessage));updateBody=(0,aC.Z)((e=>this.updateAttribute((async t=>{await function(e,t){let n=0;return t?.forEach((e=>{e.fileSize?n+=e.fileSize:n+=e.content.length})),tn.Z.messages.update(e,{bodyParts:t,size:n})}(t,e);const n=(0,IZ.H)(e);await(0,ZZ.K)(t,this.state,n);const i=(0,IZ.Q)(e);await(0,wZ.Z)(t,i),this.updateIndex(t,{attachment:(0,TZ.tZ)(e),preview:i})}))),5e3,{leading:!1});processBodyParts=async e=>{if("html"===e[0].type){const{blobFreeHTML:t,cidsInUse:n,newImages:i}=(0,qT.o6)(e[0].content),s=this.cidAttachments.filter((e=>e.id&&n.includes("cid:"+e.id)));e[0].content=t;const o=i.map((async({dataOrBlobUrl:e,cid:t,mimeType:n,filename:i})=>{const s=await fetch(e),o=await s.arrayBuffer();return{type:"attachment",content:new Uint8Array(o),filename:i,id:t,mimeType:n,fileSize:o.byteLength}})),a=await Promise.all(o);return e.concat(this.state.attachments,s,a)}return Promise.resolve(e.concat(this.state.attachments))};onBodyChange=()=>this._isMounted&&this.refBody.current?.getContentAsBodyParts?this.refBody.current.getContentAsBodyParts().then(this.processBodyParts).then(this.updateBody):Promise.reject();flushPendingChanges=async()=>{await this.toSelected.flush(),await this.ccSelected.flush(),await this.bccSelected.flush(),await this.subjectChange.flush(),await this.updateBody.flush()};cancelPendingChanges=()=>{this.toSelected.cancel(),this.ccSelected.cancel(),this.bccSelected.cancel(),this.subjectChange.cancel(),this.updateBody.cancel()};updateIndex=(e,t)=>{if(!this.threadKey)throw new Error("MailComposer: Trying to update an unsaved draft");const n=[{id:e,updates:t}];d.Z.updateIndex({sleUpdates:n})};fromChange=e=>{this.selectedAccount=iu.Z.getAccountOrAlias(e.target.value),this.setState({from:this.selectedAccount?[{name:this.selectedAccount.MAIL_NAME,address:this.selectedAccount.MAIL_EMAIL}]:[]},(()=>(this._updateSignature(this.state.from),this.updateAttribute((async e=>{await function(e,t){return tn.Z.transaction("rw",[tn.Z.messages,tn.Z.searchList],(()=>{tn.Z.searchList.update(e,{from:t}),tn.Z.messages.update(e,{from:t})}))}(e,this.state.from),this.updateIndex(e,{from:this.state.from})}))))),this.selectedAccount&&(this.messageId=(0,fZ.Z)(this.selectedAccount.MAIL_EMAIL))};toSelected=(0,aC.Z)((()=>this.updateAttribute((async e=>{await function(e,t){return tn.Z.transaction("rw",[tn.Z.messages,tn.Z.searchList],(()=>{tn.Z.searchList.update(e,{to:t}),tn.Z.messages.update(e,{to:t})}))}(e,this.state.to),this.updateIndex(e,{to:this.state.to})}))),5e3,{leading:!1});onToSelected=e=>{this.setState({to:[...e]},(()=>this.toSelected()))};ccSelected=(0,aC.Z)((()=>this.updateAttribute((e=>function(e,t){return tn.Z.transaction("rw",[tn.Z.messages,tn.Z.searchList],(()=>{tn.Z.searchList.update(e,{cc:t}),tn.Z.messages.update(e,{cc:t})}))}(e,this.state.cc)))),5e3,{leading:!1});onCcSelected=e=>{this.setState({cc:[...e]},(()=>this.ccSelected()))};bccSelected=(0,aC.Z)((()=>this.updateAttribute((e=>function(e,t){return tn.Z.messages.update(e,{bcc:t})}(e,this.state.bcc)))),5e3,{leading:!1});onBccSelected=e=>{this.setState({bcc:[...e]},(()=>this.bccSelected()))};subjectChange=(0,aC.Z)((()=>this.updateAttribute((async e=>{await function(e,t){return tn.Z.transaction("rw",[tn.Z.messages,tn.Z.searchList],(()=>{tn.Z.searchList.update(e,{subject:t}),tn.Z.messages.update(e,{subject:t})}))}(e,this.state.subject),this.updateIndex(e,{subject:this.state.subject})}))),5e3,{leading:!1});onSubjectChange=e=>{this.setState({subject:e.target.value},(()=>this.subjectChange()))};focusSubject=()=>{this.refSubject.current&&this.refSubject.current.focus()};removeAttachment=e=>{const t=this.state.attachments[e];this.setState((t=>({attachments:t.attachments.filter(((t,n)=>n!==e))})),(()=>this.updateAttribute(this.onBodyChange).then((()=>{"string"==typeof t.content&&(0,AZ.MT)(t.content)}))))};_onContextMenu=(e,t)=>{const n=[{handler:this.removeAttachment.bind(this,e),...(0,us.Z)("mail","Remove")}];(0,cs.Z)(this.context,n)(t)};_onChangeReplyScope=async e=>{if(this.replied){const t=e.target.value,n=await vZ.Z.call(this.replied);if(n&&this._isMounted){let e=[],i=[];const s=[];if("sender"===t)e=Qt.Z.getTo(n);else if("all"===t){const t=Qt.Z.getUniqueReceivers(n);e=t.uniqueTo,i=t.uniqueCc}else"list"===t&&(e=Qt.Z.getListPostAddress(n));this.setState({to:e,cc:i,bcc:s,replyScope:t},(()=>{this.toSelected(),this.ccSelected(),this.bccSelected(),this.flushPendingChanges()}))}}};render(){const{from:e,to:t,cc:n,bcc:i,subject:s,attachments:o}=this.state,a=this.props.prefValues[I.kMailComposeHeadersHidden];return kZ("div",{id:"mail_composer"},void 0,kZ("header",{},void 0,!a.includes("from")&&kZ("div",{},void 0,kZ("label",{htmlFor:"from"},void 0,(0,B.Z)("sender","From")),kZ("div",{className:"headerItemWrapper"},void 0,(0,ss.jsx)(ta.Z,{ref:this.refFrom,id:"from",onChange:this.fromChange,value:e.length>0?e[0].address:"",children:iu.Z.getAccountsAndAliases().filter((e=>!e.offline)).map(((e,t)=>kZ("option",{value:e.MAIL_EMAIL},t,(e.MAIL_NAME?e.MAIL_NAME:"")+" ("+e.MAIL_EMAIL+")")))}))),kZ("div",{className:"composer_reply_field"},void 0,kZ("label",{htmlFor:"to"},void 0,(0,B.Z)("To")),kZ("div",{className:"headerItemWrapper"},void 0,this.replied&&(this.state.replyAllPossible||this.listPost)&&kZ(ta.Z,{onChange:this._onChangeReplyScope,value:this.state.replyScope,title:(0,B.Z)("Whom to reply to")},void 0,kZ("option",{value:"sender"},void 0,(0,B.Z)("Reply")),this.state.replyAllPossible&&kZ("option",{value:"all"},void 0,(0,B.Z)("Reply All")),this.listPost&&kZ("option",{value:"list"},void 0,(0,B.Z)("Reply List"))),(0,ss.jsx)(gZ,{ref:this.refTo,id:"to",tabIndex:0===this.props.prefValues[I.kKeyboardTabToAll]?0:-1,selectedItems:t,allItems:this.state.mailAddresses,itemSelectionCallback:this.onToSelected,clearInputOnBlur:!0}))),(n.length>0||!a.includes("cc"))&&kZ("div",{},void 0,kZ("label",{htmlFor:"cc",title:(0,B.Z)("Carbon copy")},void 0,(0,B.Z)("Cc")),kZ("div",{className:"headerItemWrapper"},void 0,kZ(gZ,{id:"cc",tabIndex:0===this.props.prefValues[I.kKeyboardTabToAll]?0:-1,selectedItems:n,allItems:this.state.mailAddresses,itemSelectionCallback:this.onCcSelected,clearInputOnBlur:!0}))),(i.length>0||!a.includes("bcc"))&&kZ("div",{},void 0,kZ("label",{htmlFor:"bcc",title:(0,B.Z)("Blind carbon copy")},void 0,(0,B.Z)("Bcc")),kZ("div",{className:"headerItemWrapper"},void 0,kZ(gZ,{id:"bcc",tabIndex:0===this.props.prefValues[I.kKeyboardTabToAll]?0:-1,selectedItems:i,allItems:this.state.mailAddresses,itemSelectionCallback:this.onBccSelected,clearInputOnBlur:!0}))),kZ("div",{},void 0,kZ("label",{htmlFor:"subject"},void 0,(0,B.Z)("Subject")),kZ("div",{className:"headerItemWrapper"},void 0,(0,ss.jsx)("input",{type:"text",ref:this.refSubject,id:"subject",value:s,onChange:this.onSubjectChange}))),o.length>0&&kZ("div",{},void 0,kZ("label",{},void 0,(0,B.Z)("Attachments")),kZ("div",{className:"composer-attachments"},void 0,o.map(((e,t)=>kZ("div",{onContextMenu:this._onContextMenu.bind(this,t),className:"attachment",title:e.filename},`attachment${t}`,kZ("span",{className:"attachment-title"},void 0,e.filename),kZ("button",{className:"attachment-remove",tabIndex:0===this.props.prefValues[I.kKeyboardTabToAll]?0:-1,onClick:this.removeAttachment.bind(this,t),dangerouslySetInnerHTML:{__html:Wi.kze}}))))))),kZ("main",{},void 0,this.state.showModal&&kZ(FT,{title:(0,B.Z)("Missing Recipients"),prompt:[(0,B.Z)("At least one address must be added to the To, Cc, or Bcc fields in order to send this email.")],positive:(0,B.Z)("OK"),onClose:this._hideModal,hideNegative:!0}),(0,ss.jsx)(aZ,{ref:this.refBody,windowId:this.context.vivaldiWindowId,focusPreviousElement:this.focusSubject,onBodyChange:this.onBodyChange,onContentLoad:this.onContentLoad})))}}const PZ=(0,Bu.Z)(NZ,_Z);var DZ;function MZ(e,t,n,i){DZ||(DZ="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:DZ,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const OZ=function(e){return MZ("div",{className:"MailDisabled"},void 0,MZ("h1",{},void 0,(0,B.Z)("Mail, Calendar and Feeds are Turned Off")),MZ("p",{},void 0,(0,B.Z)("Vivaldi email client is turned off. Go to Settings\n        to enable it, set up accounts or change preferences.")),MZ("input",{type:"button",onClick:()=>de.Z.showSettings(e.windowId,"general",{scroll:"features"}),tabIndex:0,value:(0,B.Z)("Go to Settings")}))};var xZ,LZ=n(72494);function RZ(e,t,n,i){xZ||(xZ="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:xZ,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class BZ extends Li.PureComponent{state={listEntry:void 0};componentDidMount(){ht.Z.isInitialized()?this.getListEntry():ht.Z.addListener(this.onMailFilterStoreChange)}componentWillUnmount(){ht.Z.ensureRemovedListener(this.onMailFilterStoreChange)}onMailFilterStoreChange=e=>{"finishIndexProgress"===e.target&&(this.getListEntry(),ht.Z.ensureRemovedListener(this.onMailFilterStoreChange))};getListEntry(){const e=ht.Z.getListEntry(this.props.id);this.setState({listEntry:e})}render(){return RZ("div",{id:"mail_view",className:"top"},void 0,RZ(LZ.Z,{pageId:this.props.id,hasNoListEntries:!0,listEntry:this.state.listEntry,pageIsActive:this.props.isActive}))}}const FZ=BZ;var WZ;function UZ(e,t,n,i){WZ||(WZ="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:WZ,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const VZ=[I.kPanelsAsOverlayEnabled,I.kPanelsPosition,I.kMailListButtons,I.kMailViewDimensions,I.kMailViewLayout,I.kToolbarsMail,I.kToolbarsMailComposer,I.kToolbarsMailMessage];class HZ extends Li.Component{static contextType=ts.Z;_isMounted=!1;_isConfirmationDialogVisible=!1;constructor(e,t){super(e),this.windowId=t.vivaldiWindowId,this.state={searchInput:"",showMailingLists:!0,showMailingListsButton:!1,showRead:!0,showReadButton:!1,showDeleted:!1,showDeletedButton:!1,showCustomFolder:!0,showCustomFolderButton:!1,showJunk:!1,showJunkButton:!1,showFeeds:!1,showFeedsButton:!1,showArchived:!1,showArchivedButton:!1,showSubFolders:!1,total:0,accountId:"",path:"",isPopupVisible:!1,defaultFilterOptions:void 0,hasQuery:!1,queryTotal:0},e.settingsFilter&&(this.state={...this.state,accountId:e.settingsFilter.accountId,path:e.settingsFilter.path,defaultFilterOptions:e.settingsFilter?.defaultFilterOptions,...this.updateShowButtons(e.settingsFilter.filterValue),...this.getUpdatedViews(e.settingsFilter)})}componentDidMount(){this._isMounted=!0,this.props.settingsFilter||(gt.Z.addListener(this.selectedFolderChanged),ht.Z.addListener(this.onCountersChanged),this.selectedFolderChanged(),this._updateCounters())}componentWillUnmount(){this._isMounted=!1,this.props.settingsFilter||(gt.Z.removeListener(this.selectedFolderChanged),ht.Z.removeListener(this.onCountersChanged))}_updateCounters=()=>{const e=ht.Z.getListEntries().length,t=ht.Z.getQueryNumFound()||0;this.setState({total:e,queryTotal:t})};onCountersChanged=e=>{this._isMounted&&"listEntries"===e.target&&this._updateCounters()};selectedFolderChanged=()=>{if(!this._isMounted)return;let e,t;const n=gt.Z.getSelectedFolder(),i=gt.Z.getOptions(),s=i.queryFolder;if(s&&xt.ZP.isMailSearching(i))e=s.accountId,t=s.path;else{if(!n)return;e=n.accountId,t=n.path}const o=ht.Z.getByFolder(e,t||It.ym),a=o?o.filterValue:{...xt.ZP.getSearchListButtons("")};this.setState({accountId:e,path:t,hasQuery:Boolean(i.query||i.queryAddition||i.attachments||i.sentDate||i.sentDateEnd),defaultFilterOptions:o?.defaultFilterOptions,...this.updateShowButtons(a),...!!o&&this.getUpdatedViews({...o,filterValue:{...o.filterValue,...i.queryOptions}})},(()=>this._updateCounters()))};getUpdatedViews=e=>e?xt.ZP.getFilterOptions(e):{};toggleShow=e=>{const t=gt.Z.getOptions();if(this.props.settingsFilterCallback)this.props.settingsFilterCallback(e,!this.state[e]),this.setState((t=>({[e]:!t[e]})));else{if(xt.ZP.isValidSearch(t)){const n=!this.state[e];return t.queryOptions={...t.queryOptions,[e]:n},d.Z.setSearchOptions(t),void d.Z.updateQueryResults(t)}{const t=gt.Z.getSelectedFolder(),n=t&&this.getOldFilter(t);if(!n)return;n.triggers&&n.triggers?.length>0?(this._isConfirmationDialogVisible=!0,de.Z.showMailFilterViewConfirmation(this.context.vivaldiWindowId,n.name,(t=>{this._isConfirmationDialogVisible=!1,t&&this.updateSavedFilter(e,n,!0)}))):this.updateSavedFilter(e,n)}}};updateSavedFilter=(e,t,n)=>{this.setState((i=>{const s=!i[e],o=(0,v.Uy)(t,(t=>{t.filterValue[e]=s}));return d.Z.putFilter(o,t,!!n),{[e]:s}}))};togglePopup=()=>{this.setState((e=>({isPopupVisible:!e.isPopupVisible})))};getOldFilter=e=>ht.Z.getByFolder(e.accountId,e.path||It.ym);updateShowButtons=e=>Object.fromEntries(xt.ZP.getOptionNames().map((t=>[t+"Button",this._updateShowButton(e,t+"Button")])));_updateShowButton=(e,t)=>!e.hasOwnProperty(t)||e[t];getContextMenuItems=()=>{const e=[];return xt.ZP.getOptionNames().forEach((t=>{this.state[t+"Button"]&&e.push({type:"checkbox",checked:this.state[t],handler:()=>this.toggleShow(t),...(0,us.Z)(this.convertOptionToTranslatableString(t))})})),e};onContextMenu=e=>{const{document:t,HTMLElement:n}=this.context,i=e.target instanceof n&&e.target.closest(".calendar-grid");i&&i!==t.activeElement&&i instanceof n&&i.focus(),(0,cs.Z)(this.context,this.getContextMenuItems())(e)};getViewFilterIcon=(e,t)=>{const n="vertical"===this.props.prefValues[I.kMailViewLayout],i="text_menu"===C.Z.get(I.kMailListButtons),s=this.props.settingsFilter;if((!n||s)&&i&&!t)return"";switch(e){case"showRead":return this.state[e]?Wi.tD0:Wi.LDV.small;case"showCustomFolder":return this.state[e]?Wi.Hj9:Wi.dMx.small;case"showMailingLists":return this.state[e]?Wi.ibx:Wi.GAD.small;case"showFeeds":return this.state[e]?Wi.hCY:Wi.ZU_.small;case"showJunk":return this.state[e]?Wi.K30:Wi.Qwh.small;case"showDeleted":return this.state[e]?Wi.Y41:Wi.nre.small;case"showArchived":return this.state[e]?Wi.sBl:Wi._w1.small}};getTitleAndTooltip=(e,t)=>{const n=!!this.props.settingsFilter;return{title:"text_menu"===C.Z.get(I.kMailListButtons)||t||n?this.convertOptionToTranslatableString(e):void 0,tooltip:this.convertOptionToTranslatableString(e,!0)}};getButtonOrCheckbox=(e,t)=>{const n=!!this.props.settingsFilter,i="text_menu"===C.Z.get(I.kMailListButtons),s="vertical"===this.props.prefValues[I.kMailViewLayout],o=i&&s&&!n||t,a=this.getTitleAndTooltip(e,t),r=a?.title;return o?UZ("label",{className:Fi()("MailListButtons-CheckboxWrapper",this.state[e]&&"MailListButtons-CheckboxWrapper--active")},e,UZ("span",{className:Fi()("MailListButtons-CheckboxIcon",this.state[e]&&"MailListButtons-CheckboxIcon--active"),dangerouslySetInnerHTML:{__html:this.getViewFilterIcon(e,t)}}),r,(0,ss.jsx)("input",{...a,className:"MailListButtons-Checkbox",onChange:()=>this.toggleShow(e),checked:this.state[e],type:"checkbox"})):(0,Li.createElement)(po.ZP,{...a,key:e,isOn:this.state[e],onClick:()=>this.toggleShow(e),image:this.getViewFilterIcon(e)})};renderButtons(e){const t=[];return xt.ZP.getOptionNames().forEach((n=>{this.state[n+"Button"]&&t.push(this.getButtonOrCheckbox(n,e))})),t}getNewDefaultOptions=()=>{const e={};return xt.ZP.getOptionNames().forEach((t=>{this.state[t+"Button"]&&(e[t]=!!this.state[t])})),e};convertOptionToTranslatableString=(e,t)=>{switch(e){case"showMailingLists":return t?(0,B.Z)("Show Mailing Lists"):(0,B.Z)("Mailing Lists");case"showRead":return t?(0,B.Z)("Show Read"):(0,B.Z)("Read");case"showDeleted":return t?(0,B.Z)("Show Trash"):(0,B.Z)("Trash");case"showCustomFolder":return t?(0,B.Z)("Show Custom Folders"):(0,B.Z)("Custom Folders");case"showJunk":return t?(0,B.Z)("Show Spam"):(0,B.Z)("Spam");case"showFeeds":return t?(0,B.Z)("Show Feeds"):(0,B.Z)("Feeds");case"showArchived":return t?(0,B.Z)("Show Archived"):(0,B.Z)("Archived");default:return""}};resetToDefault=()=>{const e=bt.Z.getFolderType(this.state.accountId,this.state.path),t=xt.ZP.getDefaultFilterForPath(this.state.accountId,this.state.path,e),n=this.state.defaultFilterOptions||xt.ZP.getFilterOptions(t),i=gt.Z.getSelectedFolder(),s=i&&this.getOldFilter(i);if(!s)return;const o=(0,v.Uy)(s,(e=>{for(const t of Object.keys(n))this.state[t+"Button"]&&(e.filterValue[t]=n[t])}));this.setState((e=>(d.Z.putFilter(o,s),n)))};menu=()=>[{handler:this.resetToDefault,...(0,us.Z)("Reset")},{handler:this.setAsNewDefault,...(0,us.Z)("Set as New Default")}];isDifferent=()=>{const e=bt.Z.getFolderType(this.state.accountId,this.state.path),t=xt.ZP.getDefaultFilterForPath(this.state.accountId,this.state.path,e),n=this.state.defaultFilterOptions||xt.ZP.getFilterOptions(t);return xt.ZP.getOptionNames().some((e=>this.state[e+"Button"]&&this.state[e]!==!!n[e]))};isSearching=()=>{const e=gt.Z.getOptions();return xt.ZP.isValidSearch(e)};setAsNewDefault=()=>{const e=gt.Z.getSelectedFolder(),t=e&&this.getOldFilter(e);if(!t)return;const n=this.getNewDefaultOptions(),i={...t,defaultFilterOptions:n};this.setState((e=>(d.Z.putFilter(i,t),{defaultFilterOptions:n})))};renderViewFilterButton=()=>{const e=vt.Z.getFolderName(this.state.accountId,this.state.path),t=this.renderButtons(!0),n=this.isDifferent(),i=this.isSearching();return UZ(po.ZP,{tooltip:(0,B.Z)("View Filters"),popupPosition:"below",image:Wi.EnF.small,hidePopup:()=>{this._isConfirmationDialogVisible||this.setState({isPopupVisible:!1})},onClick:this.togglePopup,isPopupVisible:this.state.isPopupVisible,popupWidth:240,className:Fi()("MailListButtons-FilterIcon",{"MailListButtons-FilterIcon--active":n}),popupClassName:"MailListButtons-Popup",outsideClickIgnoreClass:"MailListButtons-TextMenuTitle",popupLabelledBy:"popout-maillist-filterbutton-title"},void 0,UZ("span",{id:"popout-maillist-filterbutton-title",className:"MailListButtons-Label"},void 0,(0,B.Z)('Show the following types of messages in "$1"',[e]),":"),t,n&&UZ("div",{className:"MailListButtons-PopupButtonsWrapper"},void 0,UZ("input",{type:"button",className:"MailListButtons-PopupButtons",onClick:this.resetToDefault,value:(0,B.Z)("Reset")}),!i&&UZ("input",{type:"button",className:"MailListButtons-PopupButtons",onClick:this.setAsNewDefault,value:(0,B.Z)("Set as New Default")})))};render(){const e=!!this.props.settingsFilter,t=this.renderButtons(),n="icons_only"===C.Z.get(I.kMailListButtons);if(0===t.length)return null;const i="vertical"===this.props.prefValues[I.kMailViewLayout],s=this.isDifferent(),o=(0,R.uf)(this.state.total);let a=(0,B.Z)("$2 message","$2 messages",[this.state.total,o]);return this.state.hasQuery&&(a=(0,B.Z)("Found $2 message","Found $2 messages",[this.state.total,o])),n||!i||e?UZ("div",{className:Fi()("MailListButtons",{"MailListButtons--textMenu":!n||e,"MailListButtons--settings":e}),onContextMenu:this.onContextMenu},void 0,this.state.hasQuery&&UZ("div",{title:(0,B.Z)("Found in all folders: $1. Found in current folder: $2",[this.state.queryTotal,this.state.total]),className:Fi()("MailListButtons-MessageCount",{"MailListButtons-MessageCount--hasQuery":this.state.hasQuery})},void 0,a),e?UZ("span",{},void 0,(0,B.Z)("mail","Include messages from:")):UZ("span",{className:"MailListButtons-Label"},void 0,(0,B.Z)("mail","Show"),":"),UZ("div",{className:"toolbar toolbar-insideinput"},void 0,t),!e&&this.renderViewFilterButton()):UZ("div",{className:"MailListButtons MailListButtons--popUp",onContextMenu:this.onContextMenu},void 0,UZ("div",{title:(0,B.Z)("Found in all folders: $1. Found in current folder: $2",[this.state.queryTotal,this.state.total]),className:"MailListButtons-MessageCount"},void 0,a),UZ("div",{className:Fi()("MailListButtons-TextMenuTitle",{"MailListButtons-TextMenuTitle--active":s})},void 0,UZ("div",{onClick:this.togglePopup},void 0,(0,B.Z)("View Filters")),this.renderViewFilterButton()),s&&UZ("div",{className:"MailListButtons-NonDefaultStateMessage"},void 0,UZ("strong",{},void 0,(0,B.Z)("mail","Show"),": "),xt.ZP.getOptionNames().filter((e=>this.state[e+"Button"]&&this.state[e])).map((e=>this.convertOptionToTranslatableString(e))).join(", ")))}}const GZ=(0,Bu.Z)(HZ,VZ);var $Z,KZ=n(95032);function zZ(e,t,n,i){$Z||($Z="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:$Z,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class jZ extends Li.PureComponent{renderSubjectLine=()=>(0,ss.jsxs)(ss.Fragment,{children:[this.props.isParent&&zZ("div",{className:"status-indicators"},void 0,zZ("span",{className:"expand-icon",onClick:this.props.handleExpandClick,dangerouslySetInnerHTML:{__html:n(4103)}})),zZ("div",{className:"subject"},void 0,this.props.queued&&zZ("span",{className:"mail-queued",dangerouslySetInnerHTML:{__html:n(48783)}}),zZ("div",{className:"subject-title"},void 0,this.props.variables.subject)),zZ(KZ.Z,{className:"labels",flags:this.props.flags})]});renderPreviewLine=()=>zZ("div",{className:`mail_entry_row body_preview body_preview_${this.props.previewLinesCount}`},void 0,this.props.variables.preview??zZ("i",{},void 0,(0,B.Z)("No preview available")));getIndentation=()=>{const e=void 0!==this.props.level&&this.props.level>0&&!this.props.isParent?16:0;let t=0;return"number"==typeof this.props.level&&(t=16*Math.min(this.props.level-1,5)),{paddingLeft:this.props.level?`${t+e}px`:0,minWidth:this.props.level?`${50+t+e}px`:0}};renderDataLine=()=>{const e=void 0!==this.props.level&&this.props.level>0,t=this.props.variables;return(0,ss.jsxs)(ss.Fragment,{children:[zZ("div",{className:"status-indicators"},void 0,this.props.renderStatusIndicator()),zZ("div",{className:"from",style:this.getIndentation()},void 0,this.props.isParent&&e&&zZ("div",{className:"status-indicators"},void 0,zZ("span",{className:"expand-icon",onClick:this.props.handleExpandClick,dangerouslySetInnerHTML:{__html:n(4103)}})),zZ("div",{className:"mail-contact-name"},void 0,t.contactString),0!==this.props.attachment&&zZ("span",{className:"mail-status-indicator mail-attachment-indicator",title:(0,B.Z)("Attachment"),dangerouslySetInnerHTML:{__html:n(51843)}})),e&&zZ(KZ.Z,{className:"labels",flags:this.props.flags}),t.flagColor&&zZ("span",{className:`mail-status-indicator ${t.flagColor}`,dangerouslySetInnerHTML:{__html:Wi.nyn.small}}),zZ("div",{className:"maildate"},void 0,zZ("div",{className:"mailDateInfo"},void 0,t.datetime))]})};getTitle=()=>{const e=gt.Z.getSelectedFolder(),t=e&&ht.Z.getByFolder(e.accountId,e.path),n=this.props.variables,i=At.Z.call(this.props.sources,t)?"":` (${this.props.unseen?(0,B.Z)("Unseen"):(0,B.Z)("Unread")})`;return`${n.subject}${i}\n`+n.contactTooltip+"\n"+(0,B.Z)("Sent: $1",[n.datetime])};render(){const e=0===this.props.level,t=0!==this.props.level;return zZ("div",{className:this.props.variables.classes,style:this.props.variables.style,"data-id":this.props.id,title:this.getTitle()},void 0,e&&(0,ss.jsxs)(ss.Fragment,{children:[zZ("div",{className:"mail_entry_row data_row"},void 0,this.renderDataLine()),zZ("div",{className:"mail_entry_row subject_row"},void 0,this.renderSubjectLine())]}),t&&zZ("div",{className:"mail_entry_row data_row"},void 0,this.renderDataLine()),!!this.props.previewLinesCount&&zZ("div",{style:this.getIndentation()},void 0,this.renderPreviewLine()))}}const YZ=jZ;var XZ;function QZ(e,t,n,i){XZ||(XZ="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:XZ,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const qZ=[I.kCalendarRelativeDates,I.kMailCountersPanelUnseenEnabled,I.kMailMessageListPreview,I.kMailMessageListPreviewVerticalOnly],JZ={sameDay:(0,B.Z)("[Today] $1",["LT"]),lastDay:(0,B.Z)("[Yesterday] $1",["LT"]),nextDay:(0,B.Z)("[Tomorrow]",["LT"]),nextWeek:(0,B.Z)("[Next] $1",["dddd"]),lastWeek:"dddd LT",sameElse:"LL LT"},eE={...JZ,lastWeek:"dddd LT",sameElse:"ll LT"},tE={...JZ,lastWeek:"ddd LT",sameElse:"L LT"},nE=[145,170,205];function iE(e,t,n=!1){const i=e>0,s=n?16:16*e,o=Zs();return!t||n?i?s+30:o:i?s+54:2*o}var sE=QZ("span",{className:"mail-status-indicator"}),oE=QZ("span",{});class aE extends Li.Component{renderStatusIndicator=()=>{const e=sE,{selectedFilter:t,sources:i,flags:s}=this.props,o=(0,Ct.Z)(i,s),a=!!t&&bt.Z.getFolderType(t.accountId,t.path)===It.Nz,r=t?wt.Z.isMessageDeleted(i,t,a):wt.Z.isMessageDeleted(i),l=At.Z.call(i,t),d=this.props.isParent&&this.props.unreadInThread&&l,c=(0,St.Z)(i);switch(!0){case o:return QZ("span",{className:"mail-status-indicator read-status spam",dangerouslySetInnerHTML:{__html:Wi.Qwh.small}});case r:return QZ("span",{className:"mail-status-indicator read-status trash",dangerouslySetInnerHTML:{__html:Wi.nre.small}});case c:return QZ("span",{className:"mail-status-indicator read-status",dangerouslySetInnerHTML:{__html:Wi._w1.small}});case(0,Kf.B_)(this.props):return QZ("span",{className:"mail-status-indicator",dangerouslySetInnerHTML:{__html:Wi.hGk.small}});case(0,Kf.XN)(this.props):return QZ("span",{className:"mail-status-indicator",dangerouslySetInnerHTML:{__html:Wi.upG.small}});case!l:case d:return QZ("span",{className:"mail-status-indicator read-status",dangerouslySetInnerHTML:{__html:n(d?85382:88826)}});default:return e}};renderFlags=(e,t,n)=>QZ("span",{className:`mail-status-indicator ${t.flagColor}`,dangerouslySetInnerHTML:{__html:Wi.nyn[n]}});renderMailEntryHorizontal=e=>{const{columns:t}=this.props;if(!t)return null;const i=this.props.level&&!this.props.isParent?16:0;let s=0;"number"==typeof this.props.level&&(s=16*Math.min(this.props.level,5));const o=W()(this.props.sentDate).format("LT"),a=W()().isSame(this.props.sentDate,"day");var r=QZ("span",{},void 0,o),l=QZ("span",{},void 0,o);return QZ("div",{className:e.classes,style:e.style,"data-id":this.props.id},void 0,t.map((d=>{switch(d.id){case"unread":return QZ("label",{},d.id,this.renderStatusIndicator());case"sender":return QZ("label",{className:"from"},d.id,QZ("span",{},void 0,e.contactString));case"subject":return QZ("label",{className:"subject",style:{width:t?"var(--subjectWidth)":null,marginLeft:this.props.level?`${s+i}px`:0}},d.id,QZ("div",{className:"subject-title-container"},void 0,this.props.isParent&&QZ("span",{className:"expand-icon",onClick:this.props.handleExpandClick,dangerouslySetInnerHTML:{__html:n(4103)}}),this.props.queued&&QZ("span",{className:"mail-queued",dangerouslySetInnerHTML:{__html:n(48783)}}),QZ("span",{},void 0,e.subject)),!!this.props.prefValues[I.kMailMessageListPreview]&&!("vertical"!==this.props.direction&&this.props.prefValues[I.kMailMessageListPreviewVerticalOnly])&&QZ("div",{className:Fi()("body_preview",`body_preview_${this.props.prefValues[I.kMailMessageListPreview]}`)},d.id,e.preview??QZ("i",{},void 0,(0,B.Z)("No preview available"))));case"label":return QZ("label",{className:"labels"},d.id,QZ("div",{className:"adjustment-mail-labels"},void 0,QZ(KZ.Z,{flags:this.props.flags})));case"flag":return QZ("label",{},d.id,e.messageIsFlagged&&this.renderFlags(this.props,e,"small"));case"attachment":return QZ("label",{className:"mail-status-indicator mailattachment"},d.id,this.props.attachment>0&&2048!==this.props.attachment&&QZ("span",{},void 0,(0,B.Z)("$1 item","$1 items",[this.props.attachment])),2048===this.props.attachment&&QZ("span",{},void 0,(0,B.Z)("1+ items")));case"size":return QZ("label",{className:"mailsize"},d.id,QZ("span",{},void 0,(0,Mg.Z)(this.props.size,1,!1)));case"sentDate":return QZ("label",{className:"maildate"},d.id,a&&d.width<=nE[0]?r:(0,ss.jsxs)(ss.Fragment,{children:[QZ("span",{},void 0,e.datetime.split(o)[0]),d.width>nE[0]&&l]}));case"threads":return QZ("label",{},d.id,oE);default:console.warn("Unknown column:",d.id)}})))};render(){const e={mail_entry:!0,"mail-parent":this.props.isParent,"mail-child":this.props.isChild,"last-mail-child":this.props.isLastChild};let t={classes:Fi()(e,"loading"),contactString:"",contactTooltip:"",contactColumnTitle:"",datetime:"",flagColor:"",messageIsFlagged:!1,subject:"",preview:"",style:{"--mailEntryRowHeight":`${iE(this.props.prefValues[I.kMailMessageListPreview],"vertical"===this.props.direction,!1)}px`,"--mailEntryRowHeightChild":`${iE(this.props.prefValues[I.kMailMessageListPreview],"vertical"===this.props.direction,!0)}px`}};const n=this.props.prefValues[I.kMailCountersPanelUnseenEnabled]&&this.props.unseen;t.subject=this.props.subject||"(no subject)",t.preview=this.props.preview,t.messageIsFlagged=(0,Kf.u9)(this.props),t.classes=Fi()(e,{unread:!n&&!At.Z.call(this.props.sources,this.props.selectedFilter),unseen:n});const i=gt.Z.getSelectedFolder(),s=i&&(i.type||i.path);[It.Nz,It.kY,It.fZ].includes(s)?(t={...t,...(0,dZ.Qb)(this.props.toIds,!0)},t.contactColumnTitle=(0,B.Z)("mail","To")):(t={...t,...(0,dZ.Qb)(this.props.fromIds)},t.contactColumnTitle=(0,B.Z)("mail","From")),t.messageIsFlagged&&(t.flagColor=`flag-color flag-${(0,Kf.Zr)(this.props.flags).toLowerCase()}`);const o=(this.props.columns||[]).find((e=>"sentDate"===e.id)),a=o&&o.width>nE[1]&&"vertical"!==this.props.direction?o.width>nE[2]?JZ:eE:tE;return t.datetime=this.props.prefValues[I.kCalendarRelativeDates]?W()(this.props.sentDate).calendar(null,a):W()(this.props.sentDate).format(a.sameElse),"horizontal"===this.props.direction||"vertical_wide"===this.props.direction?this.renderMailEntryHorizontal(t):QZ(YZ,{variables:t,handleExpandClick:this.props.handleExpandClick,unseen:this.props.unseen,id:this.props.id,queued:this.props.queued,flags:this.props.flags,sources:this.props.sources,isParent:this.props.isParent,level:this.props.level,attachment:this.props.attachment,renderStatusIndicator:this.renderStatusIndicator,previewLinesCount:this.props.prefValues[I.kMailMessageListPreview]})}}const rE=(0,Bu.Z)(aE,qZ);var lE=n(75995);const dE=function(e,t){return!!e.isParent&&!!e.unreadInThread&&!t(e)},cE=function(e,t,n,i){for(let s=t+1;s<e.length;s++){const t=e[s];if(!At.Z.call(t.sources,n)||dE(t,i))return s}return-1},uE=function(e,t,n,i){for(let s=t-1;s>=0;s--){const t=e[s];if(!At.Z.call(t.sources,n)||dE(t,i))return s}return-1},pE=function(e,t,n,i,s,o="undefined"){if("undefined"===o){if(n){const n=cE(e,t,i,s);return n>-1?n:uE(e,t,i,s)}{const n=uE(e,t,i,s);return n>-1?n:cE(e,t,i,s)}}return"previous"===o?n?uE(e,t,i,s):cE(e,t,i,s):n?("next"!==o&&console.warn("Direction to look for unread mail is not correct"),cE(e,t,i,s)):uE(e,t,i,s)};var hE,gE=n(6826);function mE(e,t,n,i){hE||(hE="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:hE,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const fE=[I.kMailMessageListPreview,I.kMailMessageListPreviewVerticalOnly,I.kMailPrefetchOnDemand,I.kMailMessageListJumpToLatest];var vE=mE(co,{type:"chevron",size:9}),yE=mE(co,{type:"close"});class bE extends Li.PureComponent{refTree=Li.createRef();scrollLatestDismissed=!1;static contextType=ts.Z;winId=this.context.vivaldiWindowId;state={list:ht.Z.getListEntries(),sorting:{sortField:(0,yf.U)(gt.Z.getSelectedFolder()),sortOrder:C.Z.get(I.kMailSearchSortOrder),comparator:void 0,onlyScroll:!0},autoFocusEntry:!0,previewLines:C.Z.get(I.kMailMessageListPreview),previewVerticalOnly:C.Z.get(I.kMailMessageListPreviewVerticalOnly),prefetchOnDemand:C.Z.get(I.kMailPrefetchOnDemand),showScrollLatest:!1};componentDidMount(){ht.Z.addListener(this.messageListChanged),C.Z.addListener(fE,this.onPrefsCacheChanged)}componentWillUnmount(){this._unbind(),ht.Z.removeListener(this.messageListChanged),C.Z.removeListener(fE,this.onPrefsCacheChanged)}onPrefsCacheChanged=()=>{this.setState({previewLines:C.Z.get(I.kMailMessageListPreview),previewVerticalOnly:C.Z.get(I.kMailMessageListPreviewVerticalOnly),prefetchOnDemand:C.Z.get(I.kMailPrefetchOnDemand)},(async()=>{await this.fetchMissingPreviews()}))};messageListChanged=e=>{switch(this.setState({autoFocusEntry:!0}),e.target){case"gotoUnread":return void this._gotoUnreadFiltered();case"gotoNextUnread":return void this._gotoNextUnread();case"gotoPreviousUnread":return void this._gotoPreviousUnread();case"listEntries":return this.scrollLatestDismissed=!1,void this.updateListEntriesDebounced(e)}};updateListEntriesDebounced=(0,Ae.Z)((e=>{const{isLoading:t,updateSelection:n,updateScrollPosition:i}=e,s={sortField:(0,yf.U)(gt.Z.getSelectedFolder()),sortOrder:C.Z.get(I.kMailSearchSortOrder),onlyScroll:!0},o=t?{isLoading:!0}:{isLoading:!1,sorting:s,list:ht.Z.getListEntries()};this.setState(o,(()=>{if(n)this.updateMessageSelection(i);else if(i)if("ascending"===this.state.sorting.sortOrder){const e=this.refTree.current;e?.scrollIntoView(e.getRenderArray().length)}else{this.refTree.current?.scrollIntoView(0)}}))}),100,{maxWait:200});delete=(e,t)=>{const n=this.context.vivaldiWindowId;return gt.Z.isTrashFolderSelected()||t?Hf.Z.prepareDelete(n,!0):Hf.Z.prepareDelete(n,!1)};isValidAddTarget=gE.Z;hasChildren=e=>Boolean(e.children&&e.children.length);isFolder=e=>this.hasChildren(e);getSelectedNodes=()=>{const e=this.refTree.current;if(!e)return[];const t=e.selectionModel.selectedIds,n=e.getRenderArray().map((e=>e.node));return t.map((e=>n.find((t=>t.id===e.id)))).filter(Boolean)};getNumSelected=()=>this.refTree.current?this.refTree.current.selectionModel.selectedIds.length:0;_findIndex=(e,t,n)=>{if(-1===e)return 0===t.length||"ascending"===this.state.sorting.sortOrder?-1:-t.length-1;let i=ht.Z.getListEntry(e);if(i||this.selectedEntry?.id!==e||(i=this.selectedEntry),!i)return-1;if("threads"===this.state.sorting.sortField&&"descending"===this.state.sorting.sortOrder){const e=(e,t)=>e.threadKey[0]===t.threadKey[0]?t.threadKey[1]-e.threadKey[1]:t.threadKey[0]-e.threadKey[0];let n=Ot()(t,i,e);if(n>=0){for(;n>0&&0===e(t[n-1],i)&&(0,Lt.HT)(t[n],i)>0;)n--;for(;n<t.length-1&&0===e(t[n],i)&&(0,Lt.HT)(t[n],i)<0;)n++;i!==t[n]&&(n=-n-1)}return n}return Ot()(t,i,n)};setMessageSelection=(e,t,n)=>{const i=this.refTree.current;if(!i)return;const s=t?t.id:-1,o=n?n.id:-1;i.selectionModel.setSelectedIds(e??[]),i.selectionModel.anchorIndex=s,i.selectionModel.leadIndex=o,i.updateSelectionState(),i.saveSelectionModel(),this.onSelect(n)};updateMessageSelection=(e=!1)=>{const t=this.refTree.current;if(!t)return this.onSelect();const n=t.getRenderArray().map((e=>e.node));if(0===n.length)return this.setMessageSelection();const i=ht.Z.getListEntryComparator(),s=t.selectionModel.selectedIds.map((e=>e.id)).filter((e=>this._findIndex(e,n,i)>=0));let o=t.selectionModel.leadIndex;if(-1===o&&(o=t.selectionModel.anchorIndex),-1===o)return this.setMessageSelection();let a=this._findIndex(o,n,i);a<0&&(a=-a-1);let r=this._findIndex(t.selectionModel.anchorIndex,n,i);r<0&&(r=-r-1);const l=a>r;if(0===s.length){const e=Math.min(a,n.length-1),t=n[e];s.push(t.id)}const d=s[l?0:s.length-1],c=this._findIndex(d,n,i),u=n[c],p=s[l?s.length-1:0],h=this._findIndex(p,n,i),g=n[h];this.setMessageSelection(s,u,g),e&&t.scrollIntoView(h)};_markSelectedRead=()=>{Hf.Z.markRead(this.winId)};_markSelectedFlagged=()=>{Hf.Z.markFlagged(this.winId)};_toggleSenderAsMailingList=()=>{this.getSelectedNodes().forEach((e=>{const t=Mn.Z.get(e.fromIds);d.Z.toggleSenderAsMailingList(this.winId,t[0].address)}))};_markSelectedUnflagged=()=>{Hf.Z.markUnflagged(this.winId)};_goToNext=()=>{const e=this.refTree.current;if(!e)return;const t=e.selectionModel.leadIndex,n=e.getRenderArray().map((e=>e.node));let i=this._findIndex(t,n,ht.Z.getListEntryComparator());if(i<0&&(i=-i-1),i<n.length-1){const t=n[i+1];t.isParent&&!e.isExpanded(t.id)?(e.toggleExpandModel(t),this._goToNext()):t&&e.selectByNode(t)}};_goToNextUnread=e=>{const t=this.refTree.current;if(!t)return;const n=t.selectionModel.leadIndex,i=t.getRenderArray().map((e=>e.node));let s=this._findIndex(n,i,ht.Z.getListEntryComparator());s<0&&(s=-s-1);const o=gt.Z.getSelectedFolder(),a=o?.accountId===It.tQ?xt.ZP.getFilterForSingleThreadView():o&&ht.Z.getByFolder(o.accountId,o.path);if(!a)throw new Error("Filter not found");const r=pE(i,s,"ascending"===this.state.sorting.sortOrder,a,(e=>t.isExpanded(e.id)),e);if(r>-1){const n=i[r];n.isParent&&!t.isExpanded(n.id)?(t.toggleExpandModel(n),this._goToNextUnread(e)):t.selectByNode(n)}};_markAndGotoNextUnread=qi.throttleSync((()=>{this._markSelectedRead(),this._gotoUnreadFiltered("undefined")}));_gotoNextUnread=qi.throttleSync((()=>{this._gotoUnreadFiltered("next")}));_gotoPreviousUnread=qi.throttleSync((()=>{this._gotoUnreadFiltered("previous")}));_gotoUnreadFiltered=(e="undefined")=>{const t=gt.Z.getSelectedFolder();if(!t)return;const n=ht.Z.getByFolder(t.accountId,t.path);xt.ZP.getFilterOptions(n).showRead&&this._goToNextUnread(e)};getLabelMenuItems=()=>{const e=J.Z.getActiveListEntry(),t=e?(0,Kf.Q3)(e.flags):[],n=Hf.Z.getCustomLabelsMenu(this.winId,t);return n.push(Qe.Z.separatorItem,{handler:()=>de.Z.showAddCustomLabel(this.winId),ellipsis:!0,...(0,us.Z)("Add New Label")}),t.length>0&&n.push(Qe.Z.separatorItem,{handler:()=>Hf.Z.clearAllLabels(this.winId,t),...(0,us.Z)("Clear All Labels")}),n};getJumpToLatestMenuItems=()=>{const e=[];return e.push(Qe.Z.separatorItem,{type:"checkbox",checked:C.Z.get(I.kMailMessageListJumpToLatest)||!0,handler:()=>{w.Z.set(I.kMailMessageListJumpToLatest,!1),this.setState({showScrollLatest:!1})},...(0,us.Z)("Show Jump to Latest")}),e};_scrollOrMarkAndGotoNext=e=>{const{document:t,HTMLElement:n}=this.context,i=t.querySelector("#mail_view .mail_body webview");i instanceof n&&"function"==typeof i.executeScript&&i.executeScript({code:this._injectCode(e.shiftKey)},(e=>{e&&!1===e[0]&&(this._markSelectedRead(),this._goToNext())}))};_injectCode=e=>e?"b__ = document.documentElement.querySelector('body');\n      if (b__.scrollTop !== 0) {\n        b__.scrollBy({\n          top: - b__.clientHeight - 30,\n          left: 0,\n          behavior: 'smooth'\n        });\n        true;\n      }":"b__ = document.documentElement.querySelector('body');\n      if (b__.scrollHeight - b__.scrollTop > b__.clientHeight) {\n        b__.scrollBy({\n          top: b__.clientHeight - 30,\n          left: 0,\n          behavior: 'smooth'\n        });\n        true;\n      } else {\n        false;\n      }";_sendSelected=()=>{Xt.Z.sendSelected(this.context.vivaldiWindowId,this.getSelectedNodes())};standardFlagMenuData=()=>{const e=J.Z.getActiveListEntry(),t=e?(0,Kf.Zr)(e.flags):"";return Hf.Z.getStandardFlagsMenu(this.winId,t)};getMenuCapability=(e,t,n)=>{const i=this.winId,s=Dt.isEnabled("MailMsgSpam"),o=Dt.isEnabled("MailMsgArchive"),a=e=>{const t=gt.Z.getSelectedFolder(),n=t&&ht.Z.getByFolder(t.accountId,t.path);return Boolean(e)&&At.Z.call(e.sources,n)},r=e=>{const t=gt.Z.getSelectedFolder();if(t&&ht.Z.getByFolder(t.accountId,t.path))return(0,St.Z)(e.sources)},l=e=>{const t=gt.Z.getSelectedFolder();if(t&&ht.Z.getByFolder(t.accountId,t.path))return(0,Ct.Z)(e.sources,e.flags)},d=e=>"threads"===this.state.sorting.sortField&&1===this.getNumSelected()&&Boolean(e)&&Boolean(e.children),c=e=>1===this.getNumSelected()&&Boolean(e)&&e.fromIds.length>0?Mn.Z.get(e.fromIds)[0].address:"",u=()=>ht.Z.getByIds(n.sourceFilterIds).some((e=>e.accountId===It.of&&e.path===It.J8)),p=()=>{const e=gt.Z.getSelectedFolder(),t=e&&ht.Z.getByFolder(e.accountId,e.path);return!!t&&bt.Z.getFolderType(t.accountId,t.path)===It.Nz};switch(e.action){case"COMMAND_MAIL_COMPOSE_NEW_MESSAGE":return Promise.resolve({handler:Qt.Z.createDraft.bind(null,void 0),...t(i,e,{})});case"CONTEXT_SEND":return Promise.resolve({handler:this._sendSelected,isVisible:()=>Boolean(n)&&u(),...t(i,e,{})});case"COMMAND_MAIL_REPLY":return Promise.resolve({isVisible:()=>Boolean(n)&&Dt.isEnabled("MailMsgReply"),...t(i,e,{})});case"COMMAND_MAIL_REPLY_ALL":return Promise.resolve({handler:()=>Hf.Z.replyAll(),isVisible:()=>Boolean(n)&&Dt.isEnabled("MailMsgReplyToAll"),...t(i,e,{})});case"COMMAND_MAIL_REPLY_LIST":return Promise.resolve({handler:()=>Hf.Z.replyList(),isVisible:()=>Boolean(n)&&J.Z.isListPost(),...t(i,e,{})});case"COMMAND_MAIL_FORWARD":return Promise.resolve({isVisible:()=>Boolean(n)&&!u(),...t(i,e,{})});case"COMMAND_MAIL_MARK_READ":return Promise.resolve({isVisible:()=>Boolean(n)&&Dt.isEnabled("MailMsgStatusRead")&&!a(n),...t(i,e,{})});case"COMMAND_MAIL_MARK_UNREAD":return Promise.resolve({isVisible:()=>Boolean(n)&&Dt.isEnabled("MailMsgStatusRead")&&a(n),...t(i,e,{})});case"CONTEXT_GOTO":case"COMMAND_MAIL_MARK_READ_AND_GOTO_NEXT_UNREAD":case"CONTEXT_THREAD":return Promise.resolve({isVisible:()=>Boolean(n),...t(i,e,{})});case"COMMAND_MAIL_GOTO_NEXT_UNREAD":case"COMMAND_MAIL_GOTO_PREVIOUS_UNREAD":return Promise.resolve({isVisible:()=>Boolean(n)&&!(()=>{const e=gt.Z.getSelectedFolder();return!!e&&bt.Z.getFolderType(e.accountId,e.path)===It.tB})(),...t(i,e,{})});case"CONTEXT_CONTAINER_MOVE":return Promise.resolve({items:Hf.Z.getMoveToFolderMenu(i),isVisible:()=>Boolean(n),...t(i,e,{})});case"CONTEXT_ADD_FLAG":return Promise.resolve({handler:this._markSelectedFlagged,isVisible:()=>Boolean(n)&&Dt.isEnabled("MailMsgFlag")&&!(0,Kf.u9)(n),...t(i,e,{})});case"CONTEXT_REMOVE_FLAG":return Promise.resolve({handler:this._markSelectedUnflagged,isVisible:()=>Boolean(n)&&Dt.isEnabled("MailMsgFlag")&&(0,Kf.u9)(n),...t(i,e,{})});case"CONTEXT_CONTAINER_FLAGS":return Promise.resolve({items:this.standardFlagMenuData(),isVisible:()=>Boolean(n)&&Dt.isEnabled("MailMsgFlag"),...t(i,e,{})});case"CONTEXT_CONTAINER_LABELS":return Promise.resolve({items:this.getLabelMenuItems(),isVisible:()=>Boolean(n)&&Dt.isEnabled("MailMsgLabel"),...t(i,e,{})});case"CONTEXT_EDIT":return Promise.resolve({handler:()=>Hf.Z.openMessage(i),isVisible:()=>Boolean(n)&&gt.Z.isFolderAnEditMailFolder(),...t(i,e,{})});case"COMMAND_MAIL_MARK_JUNK":return Promise.resolve({isVisible:()=>Boolean(n)&&s&&!1===l(n),...t(i,e,{})});case"COMMAND_MAIL_MARK_NOT_JUNK":return Promise.resolve({isVisible:()=>Boolean(n)&&s&&!0===l(n),...t(i,e,{})});case"COMMAND_MAIL_MOVE_TO_ARCHIVE":return Promise.resolve({handler:()=>Hf.Z.moveToArchive(i),isVisible:()=>Boolean(n)&&o&&!1===r(n),...t(i,e,{})});case"COMMAND_MAIL_RESTORE_FROM_ARCHIVE":return Promise.resolve({handler:()=>Hf.Z.restoreFromArchive(i),isVisible:()=>Boolean(n)&&o&&!0===r(n),...t(i,e,{})});case"CONTEXT_CONTAINER_TRASH":const h=(e=>{const t=gt.Z.getSelectedFolder(),n=t&&ht.Z.getByFolder(t.accountId,t.path);if(Boolean(e)&&n){const t=bt.Z.getFolderType(n.accountId,n.path)===It.Nz;return wt.Z.isMessageDeleted(e.sources,n,t)}})(n);return Promise.resolve({items:null!=h&&Dt.isEnabled("MailMsgTrash")?fv(i,h):[],isVisible:()=>Boolean(n)&&void 0!==h,...t(i,e,{})});case"CONTEXT_RECEIVER":return Promise.resolve({handler:()=>Hf.Z.enableCorrespondentView(i),isVisible:()=>Boolean(n)&&p(),...t(i,e,{})});case"CONTEXT_SENDER":return Promise.resolve({isVisible:()=>Boolean(n)&&!p(),...t(i,e,{})});case"COMMAND_MAIL_ENABLE_SENDER_VIEW":{const s=c(n);return Promise.resolve({isVisible:()=>Boolean(n)&&1===this.getNumSelected()&&s.length>0,...t(i,e,{})})}case"CONTEXT_SENDER_IS_MAILING_LIST":{const s=c(n);return Promise.resolve({handler:this._toggleSenderAsMailingList,checked:ht.Z.isSenderMailingList(s),isVisible:()=>Boolean(n)&&1===this.getNumSelected()&&s.length>0,...t(i,e,{})})}case"COMMAND_MAIL_ENABLE_THREADED_VIEW":return Promise.resolve({isVisible:()=>Boolean(n)&&1===this.getNumSelected(),...t(i,e,{})});case"COMMAND_MAIL_MARK_THREAD_READ":return Promise.resolve({isVisible:()=>Boolean(n)&&d(n)&&!a(n),...t(i,e,{})});case"COMMAND_MAIL_MARK_THREAD_UNREAD":return Promise.resolve({isVisible:()=>Boolean(n)&&d(n)&&a(n),...t(i,e,{})});default:return Promise.resolve({...t(i,e,{})})}};getMenuVisibility=e=>{switch(e.action){case"CONTEXT_EXPAND_ALL":case"CONTEXT_COLLAPSE_ALL":return"threads"===this.state.sorting.sortField;default:return!1}};handleExpandClick=()=>{this.refTree.current&&this.refTree.current.toggleSelectedExpansion()};onItemDoubleClick=()=>{Hf.Z.openMessage(this.context.vivaldiWindowId)};onItemMouseDown=(e,t)=>{1===t.button&&(t.preventDefault(),t.stopPropagation())};onItemMouseUp=(e,t)=>{1===t.button&&(Hf.Z.openMessage(this.context.vivaldiWindowId),t.preventDefault(),t.stopPropagation())};fetchMissingPreviews=(0,Ae.Z)((()=>{if(this.state.prefetchOnDemand&&this.state.previewLines&&("vertical"===this.props.position||!this.state.previewVerticalOnly)){const e=this.refTree.current?.getVisibleNodes(),t=e?e.filter((({node:e})=>!e.preview)).map((({node:e})=>e.id)):[];t.length>0&&d.Z.fetchPreviews(t)}}),200);onScroll=e=>{if(!this.scrollLatestDismissed&&C.Z.get(I.kMailMessageListJumpToLatest)){const t=100;"ascending"===this.state.sorting.sortOrder&&e.scrollTop<e.scrollHeight-e.clientHeight-t||"descending"===this.state.sorting.sortOrder&&e.scrollTop>t?this.setState({showScrollLatest:!0}):this.setState({showScrollLatest:!1})}this.fetchMissingPreviews()};getRowComponentProps=e=>{const{node:t,level:n,isLastChild:i}=e,s=gt.Z.getSelectedFolder();let o;if(s){const{accountId:e,path:t}=s;o=ht.Z.getByFolder(e,t)}else console.warn("No folder selected");return{...t,level:n,direction:"horizontal"===this.props.position||"vertical_wide"===this.props.position?"horizontal":"vertical",handleExpandClick:this.handleExpandClick,selectedFilter:o,columns:this.props.columns,isLastChild:i}};getHeight=({index:e})=>{const t="vertical"===this.props.position;return iE(!t&&this.state.previewVerticalOnly?0:this.state.previewLines,t,!("threads"===!this.state.sorting.sortField||!this.refTree.current||!this.refTree.current.state.renderArray[e].node.isChild))};onSelect=e=>{this.selectedEntry=e,this.setState({autoFocusEntry:!!this.selectedEntry}),this.props.onSelect(e)};openMessage=e=>{Hf.Z.openMessage(e.windowId)};onFocus=()=>{Ke.Z.bind("enter",this.openMessage)};_unbind=()=>{Ke.Z.unbind("enter",this.openMessage)};onBlur=()=>{this._unbind()};onKeyDown=e=>{const t=!!e.ctrlKey;switch(e.key){case"z":!t||e.shiftKey||e.altKey||(d.Z.undo(),e.preventDefault(),e.stopPropagation());break;case" ":e.preventDefault(),e.repeat||this._scrollOrMarkAndGotoNext(e)}};getDragData=(e,t)=>t;menu={name:"mailsearchlist",getCapability:this.getMenuCapability,getVisibility:this.getMenuVisibility};scrollToLatest=()=>{const e=this.refTree.current;if(e){if("ascending"===this.state.sorting.sortOrder){const t=e.getRenderArray().length-1;e.scrollIntoView(t),e.selectByIndex(t)}else e.scrollIntoView(0),e.selectByIndex(0);this.setState({showScrollLatest:!1})}};onContextMenu=e=>{(0,cs.Z)(this.context,this.getJumpToLatestMenuItems())(e)};render(){const e=gt.Z.getSelectedFolder(),t=this.state.sorting.sortField,n=this.state.sorting.sortOrder,i="threads"===t?lE.Z.getThreadsAsTree(this.state.list.slice(),"ascending"===n):this.state.list;let s,o=!1;e&&(s="MAIL_SEARCH_"+e.accountId+e.path,Jl.Z.isSubscribable(e)&&(o=!e.subscribed));const a=this.getHeight;return mE("div",{className:"list-wrapper",onFocus:this.onFocus,onBlur:this.onBlur,onKeyDown:this.onKeyDown},void 0,!o&&this.state.isLoading&&mE("span",{className:"mail-loading"},void 0,(0,B.Z)("Loading selected view...")),!o&&!this.state.isLoading&&this.state.list.length>0&&(0,ss.jsxs)(ss.Fragment,{children:[this.state.showScrollLatest&&C.Z.get(I.kMailMessageListJumpToLatest)&&mE("div",{className:Fi()("jump-to-latest-container","ascending"===this.state.sorting.sortOrder&&"jump-to-latest-container-ascending")},void 0,mE("button",{onClick:this.scrollToLatest,className:"jump-to-latest",onContextMenu:this.onContextMenu},void 0,vE,(0,B.Z)("Jump to Latest"),mE("span",{className:"closeContainer",onClick:e=>{e.preventDefault(),e.stopPropagation(),this.scrollLatestDismissed=!0,this.setState({showScrollLatest:!1})}},void 0,yE))),(0,ss.jsx)(Ps,{ref:this.refTree,rowComponent:rE,getRowComponentProps:this.getRowComponentProps,nodes:i,onSelect:this.onSelect,onItemDoubleClick:this.onItemDoubleClick,onItemMouseDown:this.onItemMouseDown,onItemMouseUp:this.onItemMouseUp,onScroll:this.onScroll,delete:this.delete,disableSelectAfterDelete:!0,isFolder:this.isFolder,menu:this.menu,hasChildren:this.hasChildren,settings:s,rootId:0,isValidAddTarget:this.isValidAddTarget,disableClipboard:!0,rowHeight:a,folderMode:"expand",selectionStoreKey:p.uP,getDragData:this.getDragData,mimeType:"vivaldi/x-mail-message",validateForDrag:e=>e,columns:this.props.columns,autoFocus:this.state.autoFocusEntry,sorting:this.state.sorting})]}),!o&&!this.state.isLoading&&0===this.state.list.length&&mE("span",{className:"mail-loading"},void 0,mE("div",{dangerouslySetInnerHTML:{__html:Wi.Fii}}),(0,B.Z)("No messages in selected view")),e&&o&&mE("div",{className:"mail-folder-subscribe"},void 0,mE("h2",{},void 0,(0,B.Z)("Subscribe to Folder")),mE("p",{},void 0,(0,B.Z)("You are currently not subscribed to the folder $2 of $1.",[e.accountId,vt.Z.getFolderName(e.accountId,e.path)])),mE("input",{type:"button",className:"primary",value:(0,B.Z)("Subscribe"),onClick:()=>d.Z.subscribeMailbox(this.context.vivaldiWindowId,e)})))}}const SE=bE;var wE;function CE(e,t,n,i){wE||(wE="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:wE,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class AE extends Li.PureComponent{rules={from:(0,B.Z)("sender","From"),to:(0,B.Z)("To"),cc:(0,B.Z)("Cc"),subject:(0,B.Z)("Subject"),body:(0,B.Z)("Body"),...this.props.isSettings&&{anywhere:(0,B.Z)("Anywhere")}};state={rule:"",conjunction:this.props.type||this.props.isSettings?this.props.isEmpty?"":"AND":"NOT",ruleName:this.props.type||(this.props.isSettings?"anywhere":"from"),allMailAddresses:Ed.Z.getMailAddresses(),isValidInput:!1,condition:"include"};_allMailAddressesChanged=()=>{this.setState({allMailAddresses:Ed.Z.getMailAddresses()})};componentDidMount(){Ed.Z.addListener(this._allMailAddressesChanged)}componentWillUnmount(){Ed.Z.removeListener(this._allMailAddressesChanged)}onChangeRuleName=e=>{const t=e.target.value;switch(t){case"subject":case"body":case"to":case"from":case"cc":case"anywhere":this.setState({ruleName:t},(()=>{this.props.isSettings||this.onSubmit()}))}};onChange=e=>{this.setState({rule:e.target.value,isValidInput:e.target.value.trim().length>0},(()=>{this.props.isSettings||C.Z.get(I.kMailSearchOnEnter)||(0,Ae.Z)(this.onSubmit,100)()}))};onChangeConjunction=e=>{switch(e.target.value){case"NOT":case"AND":case"OR":this.setState({conjunction:e.target.value},(()=>{this.props.isSettings||this.onSubmit()}));break;case"from":case"to":case"cc":case"subject":case"body":this.setState({conjunction:"AND",ruleName:e.target.value},(()=>{this.props.isSettings||this.onSubmit()}))}};onSubmit=(e,t)=>{const{ruleName:n,condition:i,conjunction:s,rule:o}=this.state;this.props.onSubmit({ruleName:n,rule:o,condition:i,conjunction:s,mailAddresses:t},e),this.props.isSettings&&this.setState({rule:""})};onBeforeAddMailFilter=()=>{if(this.state.rule)return this.setState({showDialog:!0}),!0};addAddressToRuleGroup=e=>{if(this.props.isSettings){if(e.length>0){const t=e[0].address,n="equal",i=this.state.conjunction;this.props.onSubmit({ruleName:this.state.ruleName,rule:t,condition:n,conjunction:i})}}else this.onSubmit(!1,e)};setIsValidInput=e=>{this.state.isValidInput!==e&&this.setState({isValidInput:e})};onChangeCondition=e=>{const t=e.target.value;switch(t){case"equal":case"include":case"starts_with":this.setState({condition:t})}};onClose=e=>{if(e){const e=!0;this.onSubmit(e)}else this.setState({showDialog:!1})};render(){const e=[];for(const t in this.rules)e.push(CE("option",{value:t},t,this.rules[t]));const t="AND"===this.state.conjunction;let n=[...this.props.isSettings?["AND","OR"]:[],"NOT"].map((e=>CE("option",{value:e},e,(0,B.Z)(e))));return this.props.isSettings||(n=[...e,!this.props.isEmpty&&CE("optgroup",{label:(0,B.Z)("Conjunction")},"conjunction",n)]),(0,ss.jsxs)(ss.Fragment,{children:[this.props.type&&CE("span",{className:this.props.className},void 0,"from"===this.props.type?(0,B.Z)("mail","From"):"to"===this.props.type?(0,B.Z)("To"):(0,B.Z)("Cc")),!this.props.type&&(!this.props.isEmpty||!this.props.isSettings)&&CE(ta.Z,{onChange:this.onChangeConjunction,value:this.props.isSettings||"AND"!==this.state.conjunction?this.state.conjunction:this.state.ruleName,className:Fi()("MailFilterSelector-conjunctionContainer",this.props.className)},void 0,n),CE("form",{onSubmit:this.onSubmit,className:Fi()("MailFilterSelector",!this.props.isSettings&&"MailFilterSelector--mailList",this.props.isSettings&&"MailFilterSelector--isSettings",!t&&"MailFilterSelector--multipleSelect",this.props.className)},void 0,(this.props.isSettings||!t)&&CE(ta.Z,{onChange:this.onChangeRuleName,value:this.state.ruleName},void 0,this.rules&&e),this.props.isSettings&&CE(ta.Z,{onChange:this.onChangeCondition,value:this.state.condition},void 0,["from","cc","to"].includes(this.state.ruleName)&&(0,ss.jsx)(ss.Fragment,{children:CE("option",{value:"equal"},void 0,(0,B.Z)("equals"))}),CE("option",{value:"include"},void 0,(0,B.Z)("includes")),CE("option",{value:"starts_with"},void 0,(0,B.Z)("starts with")),["subject","body","anywhere"].includes(this.state.ruleName)&&(0,ss.jsx)(ss.Fragment,{children:CE("option",{value:"equal"},void 0,(0,B.Z)("equals"))})),CE("div",{className:"MailFilterSelector-inputContainer"},void 0,["from","to","cc"].includes(this.state.ruleName)?CE(gZ,{id:this.state.ruleName,selectedItems:this.props.selectedMailAddresses,allItems:this.state.allMailAddresses||new Map,itemSelectionCallback:this.addAddressToRuleGroup,setIsValidInput:this.setIsValidInput,onChange:this.onChange,clearInputOnBlur:this.props.isSettings,className:"MailFilterSelector-input",showTypedTextAsOption:!0}):CE("input",{type:"text",onChange:this.onChange,value:this.state.rule,className:"MailFilterSelector-input"}),this.props.isSettings&&CE("input",{type:"button",disabled:!this.state.isValidInput,onClick:this.onSubmit,value:(0,B.Z)("Add to Search")})),this.state.showDialog&&CE(FT,{title:(0,B.Z)("Forgot to add to search"),prompt:[(0,B.Z)("We noticed you wrote something and didn't add it to the search. Would you like to add '$1' to the search?",[this.state.rule])],positive:(0,B.Z)("Add to Search"),negative:(0,B.Z)("Cancel"),onRequestClose:()=>this.setState({showDialog:!1}),onClose:this.onClose}))]})}}const IE=AE;var TE;function ZE(e,t,n,i){TE||(TE="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:TE,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const EE=function(e){return ZE("label",{className:e.className,title:(0,B.Z)("Select whether the message can include attachments or not.")},void 0,ZE("input",{type:"checkbox",checked:!!e.attachments,onChange:t=>{const n=t.currentTarget.checked?1:0;e.selectAttachments(n)}}),ZE("span",{},void 0,(0,B.Z)("Has Attachments")))};function kE(e){const{unseen:t,unread:n,total:i}=e;return t>0?t===n&&n===i?(0,B.Z)("$1 new message","$1 new messages",[t]):t===n?(0,B.Z)("$1 new message of $2 messages","$1 new messages of $2 messages",[t,i]):(0,B.Z)("$1 new in $2 unread of $3 messages","$1 new in $2 unread of $3 messages",[t,n,i]):n>0?n===i?(0,B.Z)("$1 unread message","$1 unread messages",[n]):(0,B.Z)("$1 unread of $2 messages","$1 unread of $2 messages",[n,i]):(0,B.Z)("$1 message","$1 messages",[i])}var _E;function NE(e,t,n,i){_E||(_E="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:_E,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const PE=[I.kMailCountersPanelUnseenEnabled];class DE extends Li.Component{_isMounted=!1;state={unseen:0,unread:0,total:0};componentDidMount(){this._isMounted=!0,this._updateCounters(),ht.Z.addListener(this.onCountersChanged)}componentWillUnmount(){ht.Z.removeListener(this.onCountersChanged)}_updateCounters=(e=this.props)=>{const{accountId:t,path:n}=e;if(this._isMounted){const e=ht.Z.getCounters(t,n);this.setStateIfNeeded({unread:e&&e.unread||0,unseen:e&&e.unseen||0,total:e&&e.total||0})}};setStateIfNeeded=e=>{Object.getOwnPropertyNames(e).some((t=>e[t]!==this.state[t]))&&this.setState(e)};onCountersChanged=e=>{"counters"===e.target&&this._updateCounters()};handleMouseUp=e=>{const t=e.altKey;this.props.handleExpandClick(this.props.id,t)};render(){const e=this.state.unseen>0&&this.props.prefValues[I.kMailCountersPanelUnseenEnabled],{unseen:t,unread:i,total:s}=this.state,o=this.props.label+" "+kE({unseen:t,unread:i,total:s});return NE("div",{className:"mail-panel-category-container"},void 0,NE("label",{className:"mail-panel-category"+(this.props.hasChildren?"":" empty"),title:o},void 0,NE("span",{onClick:this.props.onClick,className:"title"},void 0,this.props.label),!this.props.isExpanded&&NE("div",{className:"counter-container"},void 0,e&&NE("span",{className:"item-count counter-unseen"},void 0,this.state.unseen),this.state.unread>0&&NE("span",{className:"item-count counter-unread"},void 0,this.state.unread)),this.props.hasChildren&&NE("span",{className:"expand-icon display-hint",onMouseDown:ms.ZP,onMouseUp:this.handleMouseUp,dangerouslySetInnerHTML:{__html:n(4103)}})))}}const ME=(0,Bu.Z)(DE,PE),OE={},xE={};class LE extends hr.Z{getAccountIndicator(e){let t,n=Object.keys(It.NB).length;if(OE[e]){const i=Object.keys(OE[e]);for(const s of i)OE[e][s].priority<n&&(n=OE[e][s].priority,t=OE[e][s])}if(xE[e])for(const i in xE[e])xE[e][i].priority<n&&(n=xE[e][i].priority,t=xE[e][i]);return t}getPrefetchProgress(){let e=0,t=0;for(const n in OE){const i=OE[n].INDICATOR_TYPE_PRE_FETCHING;i&&(e+=i.current,t+=i.total)}return{current:e,total:t}}getPathIndicator(e,t){if(xE[e]&&xE[e][t])return xE[e][t]}reset=()=>{for(const e in OE)delete OE[e];for(const e in xE)delete xE[e]};dispatchAction(e){switch(e.actionType){case"MAIL_INDICATOR_ADD_ACCOUNT":{const{accountId:t,indicatorType:n,priority:i,current:s,total:o}=e;!function(e,t,n,i,s){OE[e]||(OE[e]={});OE[e][t]={indicatorType:t,priority:n,current:i,total:s},RE.emitChange()}(t,n,i,s,o);break}case"MAIL_INDICATOR_ADD_PATH":{const{accountId:t,path:n,indicatorType:i,priority:s,current:o,total:a}=e;!function(e,t,n,i,s,o){xE[e]||(xE[e]={});xE[e][t]={indicatorType:n,priority:i,current:s,total:o},RE.emitChange()}(t,n,i,s,o,a);break}case"MAIL_INDICATOR_REMOVE_ACCOUNT":{const{accountId:t,indicatorType:n}=e;!function(e,t){OE[e]&&OE[e][t]&&(delete OE[e][t],RE.emitChange())}(t,n);break}case"MAIL_INDICATOR_REMOVE_PATH":{const{accountId:t,path:n}=e;!function(e,t){xE[e]&&xE[e][t]&&(delete xE[e][t],RE.emitChange())}(t,n);break}case"MAIL_INDICATOR_REMOVE_ALL":t=e.accountId,delete OE[t],delete xE[t],RE.emitChange()}var t}}const RE=new LE(A.Z);const BE=RE;var FE,WE=n(34198),UE=n(81744);function VE(e,t,n,i){FE||(FE="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:FE,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const HE=[I.kMailAccounts,I.kMailCountersPanelArchiveEnabled,I.kMailCountersPanelDraftsEnabled,I.kMailCountersPanelJunkEnabled,I.kMailCountersPanelTrashEnabled,I.kMailCountersPanelUnseenEnabled,I.kMailPanelActivityIndicatorsEnabled];function GE(e){const t={disconnected:!1,isConnecting:!1,error:void 0},{isImap:n,isAccount:i,accountId:s,isOnline:o}=e;if(i){const e=iu.Z.getAccountOrAlias(s);if(o)if(n){t.disconnected=!!e&&!e.offline&&zc.Z.isDisconnected(s),t.isConnecting=zc.Z.isConnecting(s);const n=Xc.getLatestError(s);n&&(t.error=n.error.message)}else t.disconnected=!1;else t.disconnected=!!e&&!e.offline}return t}class $E extends Li.Component{static contextType=ts.Z;_isMounted=!1;state=function(e){return{unread:0,unseen:0,total:0,...GE(e)}}(this.props);componentDidMount(){this._isMounted=!0,this._updateCounters(),ht.Z.addListener(this.onCountersChanged),zc.Z.addListener(this.onConnectionChanged),BE.addListener(this.onIndicatorsChanged)}componentWillUnmount(){this._isMounted=!1,ht.Z.removeListener(this.onCountersChanged),zc.Z.removeListener(this.onConnectionChanged),BE.removeListener(this.onIndicatorsChanged)}componentDidUpdate(e){e.isOnline!==this.props.isOnline&&this.setStateIfNeeded(GE(this.props))}onCountersChanged=e=>{"counters"===e.target&&this._updateCounters()};onConnectionChanged=()=>{this.setStateIfNeeded(GE(this.props))};onIndicatorsChanged=()=>{const e=this.props.path===It.ym?BE.getAccountIndicator(this.props.accountId):BE.getPathIndicator(this.props.accountId,this.props.path),t={indicator:""},n=this.props.isExpanded&&this.props.path===It.ym;if(e&&!n){const{indicatorType:n,current:i,total:s}=e,o=this.getIndicatorText(n);t.indicator=s>0?`${o} ${i}/${s}`:o}this.setState(t)};_updateCounters=(e=this.props)=>{if(this._isMounted){let{accountId:t,path:n}=e;t===It.Ry&&n!==It.ym&&([t,n]=xt.ZP.fromCustomFolderPath(e.path));const i=ht.Z.getCounters(t,n);this.setStateIfNeeded({unread:i&&i.unread||0,unseen:i&&i.unseen||0,total:i&&i.total||0})}};setStateIfNeeded=e=>{Object.getOwnPropertyNames(e).some((t=>e[t]!==this.state[t]))&&this.setState(e)};getIndicatorText=e=>{switch(e){case"INDICATOR_TYPE_FLAGS":return(0,B.Z)("Updating Flags");case"INDICATOR_TYPE_THREADING":return(0,B.Z)("Threading");case"INDICATOR_TYPE_FLUSHING":return(0,B.Z)("Flushing");case"INDICATOR_TYPE_CONNECTING":return(0,B.Z)("Connecting");case"INDICATOR_TYPE_FETCHING":return(0,B.Z)("Fetching");case"INDICATOR_TYPE_PRE_FETCHING":return(0,B.Z)("Prefetching");default:return""}};isDrafts=()=>this.props.path===It.Wb||this.props.type===It.kY;isOutbox=()=>this.props.path===It.J8||this.props.type===It.fZ;isTrash=()=>this.props.path===It.cm||this.props.type===It.uT;isUnread=()=>this.props.path===It.tB;isSent=()=>this.props.path===It.N1||this.props.type===It.Nz;isJunk=()=>this.props.path===It.rp||this.props.type===It.Hd;isArchive=()=>this.props.path===It.$T||this.props.type===It.hn;isFeeds=()=>this.props.accountId===It.u4&&It.pG.test(this.props.path);isFeedsFolder=()=>this.props.accountId===It.u4&&!It.pG.test(this.props.path);isLabels=()=>this.props.accountId===It.ut;isFilters=()=>this.props.accountId===It.Kz;isFlags=()=>this.props.accountId===It.MN;isReceived=()=>this.props.path===It.ik||this.props.type===It.e9;isMailingList=()=>this.props.accountId===It.wC&&WE.ZP.isMailingListPath(this.props.path);getImageSet=()=>this.props.isAccount?Wi.GtN:this.isSent()?Wi.zLp:this.isJunk()?Wi.Qwh:this.isArchive()?Wi._w1:this.isFeedsFolder()?Wi._TQ:this.isFeeds()?Wi.ZU_:this.isUnread()?Wi.aAJ:this.isReceived()?Wi.LDV:this.isDrafts()?Wi.XTV:this.isFilters()?Wi.EnF:this.isLabels()?Wi.rpm:this.isFlags()?Wi.nyn:this.isMailingList()?Wi.GAD:void 0;_onError=e=>{const t=Xc.getLatestError(this.props.name);t&&(0,jc.I)(t.code)?de.Z.showMailAuthenticationDialog(this.context.vivaldiWindowId,{account:e}):de.Z.showSettings(this.context.vivaldiWindowId,"mail")};_handleStatusIconClick=async()=>{if(this.state.disconnected&&!zc.Z.isConnecting(this.props.name)){const e=await iu.Z.loadAccount(this.props.name);this._onError(e)}else de.Z.showSettings(this.context.vivaldiWindowId,"mail")};handleMouseUp=e=>{(0,ms.ZP)(e);const t=e.altKey;this.props.handleExpandClick(this.props.id,t)};render(){const e=this.props.prefValues[I.kMailPanelActivityIndicatorsEnabled]&&this.state.indicator,t=this.state.unread>0&&!(this.isDrafts()||this.isOutbox()||this.isTrash()||this.isJunk()||this.isArchive()),n=t&&this.state.unseen>0&&this.props.prefValues[I.kMailCountersPanelUnseenEnabled],i=this.state.total>0&&this.isOutbox(),s=this.state.total>0&&this.props.prefValues[I.kMailCountersPanelTrashEnabled]&&this.isTrash(),o=this.state.unread>0&&this.props.prefValues[I.kMailCountersPanelJunkEnabled]&&this.isJunk(),a=this.state.unread>0&&this.props.prefValues[I.kMailCountersPanelArchiveEnabled]&&this.isArchive(),r=this.state.total>0&&this.props.prefValues[I.kMailCountersPanelDraftsEnabled]&&this.isDrafts();let l;if(this.state.error)l=this.state.error;else if(this.props.isAccount&&!this.props.isOnline)l=(0,B.Z)("No network connection");else if(this.state.disconnected)l=(0,B.Z)("Disconnected");else{const{unseen:e,unread:t,total:n}=this.state;l=(this.isLabels()?(0,UE.X)(this.props.name):(0,Ef.e)(this.props.name))+"\n"+kE({unseen:e,unread:t,total:n})}const d=this.props.level*ks;let c;return c=this.props.hasChildren?0:this.props.level>1?d+ks:d,VE("label",{className:Fi()("mail_panel_node",{disabled:this.props.subscribable||this.props.internal}),title:l,onClick:this.props.onClick},void 0,this.props.hasChildren&&0!==this.props.level&&VE("span",{className:"expand-icon",style:{marginLeft:d},onMouseDown:ms.ZP,onClick:this.handleMouseUp,dangerouslySetInnerHTML:{__html:Wi.nfH}}),VE(Ki,{imageSet:this.getImageSet(),open:this.props.isExpanded,trash:this.isTrash(),disconnected:this.state.disconnected,isConnecting:this.state.isConnecting,leftMargin:c,onClickStatusIcon:this._handleStatusIconClick}),void 0!==this.props.inlineEditText&&VE("input",{type:"text",value:this.props.inlineEditText,onChange:this.props.onChange,onFocus:this.props.onFocus,onBlur:this.props.onBlur,autoFocus:!0}),void 0===this.props.inlineEditText&&VE(Li.Fragment,{},void 0,VE("span",{className:"title"},void 0,this.isLabels()?(0,UE.X)(this.props.name):(0,Ef.e)(this.props.name)),e&&VE("span",{className:"item-count counter-indicator"},void 0,this.state.indicator),n&&VE("span",{className:"item-count counter-unseen"},void 0,this.state.unseen),t&&VE("span",{className:"item-count counter-unread"},void 0,this.state.unread),o&&VE("span",{className:"item-count counter-unread"},void 0,this.state.unread),a&&VE("span",{className:"item-count counter-unread"},void 0,this.state.unread),(i||s||r)&&VE("span",{className:"item-count counter-total"},void 0,this.state.total)))}}const KE=(0,Bu.Z)($E,HE);var zE;function jE(e,t,n,i){zE||(zE="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:zE,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class YE extends Li.PureComponent{state={isSyncing:zc.Z.isSyncingAny()||zc.Z.isSyncingFlagsAny(),isPrefetching:zc.Z.isPreFetchingAny(),isPrefetchPaused:zc.Z.isPrefetchPaused(),prefetchProgress:BE.getPrefetchProgress()};componentDidMount(){zc.Z.addListener(this.#me),BE.addListener(this.#fe)}componentWillUnmount(){zc.Z.removeListener(this.#me),BE.removeListener(this.#fe)}#ve=()=>{d.Z.pausePrefetching("userRequest",!this.state.isPrefetchPaused)};#me=e=>{const t={};void 0!==e.isPreFetching&&(t.isPrefetching=zc.Z.isPreFetchingAny()),void 0!==e.isPrefetchPaused&&(t.isPrefetchPaused=zc.Z.isPrefetchPaused()),void 0===e.isSyncing&&void 0===e.isSyncingFlags||(t.isSyncing=zc.Z.isSyncingAny()||zc.Z.isSyncingFlagsAny()),this.setState(t)};#fe=()=>{this.setState({prefetchProgress:BE.getPrefetchProgress()})};render(){const{isSyncing:e,isPrefetching:t,isPrefetchPaused:n,prefetchProgress:i}=this.state;return t||n?jE("div",{},void 0,jE("div",{className:"StatusPopup-Footer PrefetchProgress toolbar-default"},void 0,jE("h2",{},void 0,(0,B.Z)("Downloading messages")),jE("p",{className:"info"},void 0,e?(0,B.Z)("Downloading messages put on hold while indexing headers and flags."):(0,B.Z)("Messages are being downloaded for offline viewing, and better search results.")),jE("div",{className:"progress-wrapper"},void 0,jE("progress",{style:{"--duration":"500ms","--progress":i.current/i.total},className:Fi()("DownloadItem-ProgressBar",{visible:!0,loading:!this.state.isPrefetchPaused}),value:0===i.total?0:i.current/i.total*100,max:100}),!n&&!e&&jE("span",{className:"prefetch-details"},void 0,(0,B.Z)("$1 of $2",[i.current,i.total])),n&&jE("span",{className:"prefetch-details"},void 0,(0,B.Z)("Paused")),e&&!n&&jE("span",{className:"prefetch-details"},void 0,(0,B.Z)("Waiting"))),jE(po.ZP,{disabled:e||n&&!zc.Z.canResumePrefetch("userRequest"),tooltip:n?(0,B.Z)("verb","Resume downloading"):(0,B.Z)("verb","Pause downloading"),title:n?(0,B.Z)("verb","Resume"):(0,B.Z)("verb","Pause"),onClick:this.#ve,image:n?Wi.sxZ.small:Wi.Q9E.small}))):null}}const XE=YE;var QE=n(74652),qE=n(59552),JE=n(30628),ek=n(68906);async function tk(e,t){return tn.Z.searchList.update(e,t)}var nk=n(26067);async function ik(){const e=C.Z.get(I.kRssSettings)||[];if(0===e.length)return void nn.Z.error("Feeds",["restore"],"No settings found for Feeds and hence unable to restore");u.Z.setStatus(p.A4,(0,B.Z)("Restoring filters for feeds ..."));const t=yt.Z.getByAccountId(It.u4).filter((e=>It.pG.test(e.path))),n=[];for(const i of e){if(!t.find((e=>e.path.endsWith(i.feedId)))){nn.Z.warn("Feeds",["restore"],`adding missing filter for ${i.title}`);const e=await gn(i.title||i.url,i.feedId);t.push(e),n.push(e.id)}}const s=wn()(It.u4).substring(0,6),o=await se.Z.mailPrivate.getFileDirectory(s);if(!o)return nn.Z.error("Feeds",["restore"],"Root path for feeds not found on disk"),void Pn.forceRefreshAllRSSAccounts();const a=await se.Z.mailPrivate.getFilePaths(o);if(0===a.length)return nn.Z.error("Feeds",["restore"],"No feed files found"),void Pn.forceRefreshAllRSSAccounts();const r=[],l=[],c=new Map;for(const e of a){const t=(0,nk.BB)(It.u4),n=RegExp(`${t}/([0-9]{4})/([0-9]{2})/([0-9]{2})/([0-9]+).eml`).exec(e);if(!n){nn.Z.error("Feeds",["restore"],`File path does not fit expected format for a feed file: ${e}`);continue}const[,i,s,o,a]=n;c.set(Number(a),{feedsRootFolder:t,filePath:e,year:i,month:s,day:o})}const h=[...c.keys()];u.Z.setStatus(p.A4,(0,B.Z)("Restoring filters for feeds - files found on disk: $1",[h.length]));const g=await tn.Z.searchList.where("id").anyOf(h).toArray();for(const[i,s]of c){const{feedsRootFolder:o,filePath:a,year:c,month:h,day:m}=s;u.Z.setStatus(p.A4,(0,B.Z)("Restoring filters for feeds - restoring file: $1",[a]));const f=await se.Z.mailPrivate.readFileToText(a),v=f.match(/xml:base="([^"]+)"/);if(!v){nn.Z.error("Feeds",["restore"],`No url found in file ${a}`);continue}const y=v[1].replaceAll("&amp;","&");if(r.includes(y))continue;const b=e.find((e=>e.url===y));if(!b){r.push(y),nn.Z.error("Feeds",["restore"],`settings for ${y} missing from prefs and hence unable to restore`);continue}const S=t.find((e=>e.path.endsWith(b.feedId))),w=g.find((e=>e.id===i));let C;if(S)C=S.id;else{nn.Z.warn("Feeds",["restore"],`adding missing filter for ${y}`);const e=await gn(b.title||b.url,b.feedId);if(!e){nn.Z.error("Feeds",["restore"],`failed to add new filter for ${y}`);continue}C=e.id,n.push(C)}if(w){const e=w.sourceFilterIds[0];if(e!==C){nn.Z.warn("Feeds",["restore"],`Re-assigning filter ${e} to ${C} for entry ${w.id}`);const t=w.sources.get(e),n={deleted:!1,internal:!0,read:!1},i=new Map,s=t?{...t}:{...n};i.set(C,s);const o={sourceFilterIds:[C],sources:i};await tk(w.id,o);const a=t?{...t}:{...n},r=new Map;r.set(C,a),r.set(e,void 0);const c={sourceFilterIds:[C],sources:r},u={id:w.id,updates:c};d.Z.updateIndex({sleUpdates:[u]}),l.push(w.id)}}else{nn.Z.warn("Feeds",["restore"],`adding missing entry for ${i}`);const e=(0,Zn.ho)(f);if("string"==typeof e){nn.Z.error("Feeds",["restore"],e);continue}const t={pubDate:/^https?:\/\/(\w+\.)?youtube\.com\//i.test(y)},n=e.feeditems.map((e=>({accountId:It.u4,feedId:b.feedId,subject:e.plaintitle,bodyParts:(0,En.O)(e),raw:f,sentDate:new Date(Number(c),Number(h)-1,Number(m)).getTime(),messageId:wn()(kn(e,t)),from:[{name:b.title,address:b.title}],replyTo:[],to:[],cc:[],flags:[],internal:!0}))),s=await an(b.feedId,n);1!==s.length&&nn.Z.error("Feeds",["restore"],"Expected one-to-one between sle and file for feeds"),d.Z.updateIndex({addedSles:s});const a=s[0].id,r=[o,c,h,m];nn.Z.warn("Feeds",["restore"],`writing raw message to new file: ${r.join("/")}/${a}.eml`);const l=`${i}.eml`,u=`_${a}.eml`;try{await se.Z.mailPrivate.renameMessageFile(r,l,u)}catch(e){console.error(e)}}}const m=await se.Z.mailPrivate.getFilePaths(o);for(const e of m){const t=e.split("/"),n=t[t.length-1];if("_"===n[0]){const e=t.slice(t.length-5,t.length-1),s=n.substr(1);u.Z.setStatus(p.A4,(0,B.Z)("Restoring filters for feeds - renaming file:",[s])),await se.Z.mailPrivate.renameMessageFile(e,n,s),i.Z.runtime.lastError&&nn.Z.error("Feeds",["restoreLostFeeds","renameMessageFile",n,s],i.Z.runtime.lastError)}}n.length>0&&await ek.Z.call({type:"RUN_FILTERS",priority:It.Un.LOW,filterIds:n}),l.length>0&&await ek.Z.call({type:"RE_RUN_SLES",priority:It.Un.LOW,searchListIds:l}),n.length+l.length>0&&cn.Z.filter(),Pn.forceRefreshAllRSSAccounts(),u.Z.setStatus(p.A4,(0,B.Z)("Restoring filters for feeds - Finished!"),It.QM)}var sk=n(95064),ok=n(6977);var ak,rk=n(70752),lk=n(56551);function dk(e,t,n,i){ak||(ak="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:ak,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const ck=[I.kMailPanelItemsOrder,I.kMailPanelItemsShowAccounts,I.kMailPanelItemsShowAllMessages,I.kMailPanelItemsShowCustomFolders,I.kMailPanelItemsShowFeeds,I.kMailPanelItemsShowFilters,I.kMailPanelItemsShowFlags,I.kMailPanelItemsShowLabels,I.kMailPanelItemsShowMailingLists],uk=new Map([["ALL_MESSAGES",{key:"ALL_MESSAGES",name:(0,B.Z)("All Messages"),showPref:I.kMailPanelItemsShowAllMessages}],["CUSTOM_FOLDERS",{key:"CUSTOM_FOLDERS",name:(0,B.Z)("Custom Folders"),showPref:I.kMailPanelItemsShowCustomFolders}],["MAILING_LISTS",{key:"MAILING_LISTS",name:(0,B.Z)("Mailing Lists"),showPref:I.kMailPanelItemsShowMailingLists}],["FILTERS",{key:"FILTERS",name:(0,B.Z)("Filters"),showPref:I.kMailPanelItemsShowFilters}],["FLAGS",{key:"FLAGS",name:(0,B.Z)("Flags"),showPref:I.kMailPanelItemsShowFlags}],["LABELS",{key:"LABELS",name:(0,B.Z)("Labels"),showPref:I.kMailPanelItemsShowLabels}],["FEEDS",{key:"FEEDS",name:(0,B.Z)("Feeds"),showPref:I.kMailPanelItemsShowFeeds}],["ACCOUNTS",{key:"ACCOUNTS",name:(0,B.Z)("All Accounts"),showPref:I.kMailPanelItemsShowAccounts}]]);class pk extends Li.PureComponent{constructor(e){super(e)}moveItem=(e,t)=>{const n=this.props.prefValues[I.kMailPanelItemsOrder].slice(),[i]=n.splice(e,1);n.splice(t,0,i),w.Z.set(I.kMailPanelItemsOrder,n)};toggleShow=e=>{w.Z.toggle(e,!0,!1)};renderListItem=(e,t)=>{const{key:n,name:i,showPref:s}=t,o=this.props.prefValues[s];return(0,ss.jsxs)(ss.Fragment,{children:[dk("input",{type:"checkbox",value:n,checked:o,onChange:this.toggleShow.bind(this,s)}),i]})};render(){const e=[];for(const t of this.props.prefValues[I.kMailPanelItemsOrder]){const n=uk.get(t);n&&e.push(n)}return dk("div",{className:"setting-single"},void 0,dk("h3",{},void 0,(0,B.Z)("Mail Panel Order and Visibility")),dk("p",{className:"info"},void 0,(0,B.Z)("Hide, show and re-order folders in the Mail Panel.")),dk(lk.Z,{filter:this.props.filter,items:e,moveItem:this.moveItem,renderListItem:this.renderListItem,supportDragAndDrop:!0,mimeType:"vivaldi/x-settings-quick-command-type"}))}}const hk=(0,Bu.Z)(pk,ck);var gk,mk=n(34155);function fk(e,t,n,i){gk||(gk="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:gk,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const vk="vivaldi/x-mail-message",yk=[It.W4,It.cs],bk=[It.T4.RED,It.T4.ORANGE,It.T4.YELLOW,It.T4.GREEN,It.T4.BLUE,It.T4.PURPLE,It.T4.GRAY],Sk=[It.w1+"_"+It.Sp,It.w1,It.rQ,It.q0,It.pz,It.sM,It.Ry,It.jT];const wk=()=>{const e=C.Z.get(I.kMailPanelItemsOrder),t=Lk(),n=[];for(const s of e)switch(s){case"ALL_MESSAGES":if(t.showAllMessages){const e=(i=Ok(),{name:qf,accountId:It.of,path:It.ym,id:It.w1,children:i});n.push(e)}break;case"CUSTOM_FOLDERS":if(t.showCustomFolders){const e=!t.showUnsubscribed,i=ov(xk(e));n.push(i)}break;case"MAILING_LISTS":if(t.showMailingLists){const e=Mk(ht.Z.getByAccountId(It.wC),It.jT),t=e.find((e=>e.path===It.cs));t&&(t.name=(0,B.Z)("Mailing Lists","Other"));const i=e.find((e=>e.path===It.W4));i&&(i.name=(0,B.Z)("Mailing Lists","Important"));const s=av(e.sort(_k));n.push(s)}break;case"FILTERS":if(t.showFilters){const e=rv(Mk(ht.Z.getByAccountId(It.Kz),It.rQ).sort(Lt.JM));n.push(e)}break;case"FLAGS":if(t.showFlags){const e=lv(Mk(ht.Z.getByAccountId(It.MN),It.q0).sort(Nk));n.push(e)}break;case"LABELS":if(t.showLabels){let e=C.Z.get(I.kMailLabelItemsOrder);const t=new Set(C.Z.get(I.kMailLabelItemsHide));e.length<1&&(e=ht.Z.getByAccountId(It.ut).sort(Kf.jp).map((e=>e.path)));const i=[];e.forEach((e=>{const n=yt.Z.getByFolderId([It.ut,e]);n&&!t.has(e)&&i.push(n)}));const s=dv(Mk(i,It.pz));n.push(s)}break;case"FEEDS":if(t.showFeeds){const e=cv(Mk(ht.Z.getByAccountId(It.u4),It.sM).sort(Lt.JM));n.push(e)}break;case"ACCOUNTS":if(t.showAccounts){const e=vt.Z.getAccounts(),i=[],s=Jl.Z.getFolders(e,t.showUnsubscribed);for(const e of s)e.accountId!==It.u4&&i.push({...e,type:"All",subscribed:!0});const o={name:(0,B.Z)("All Accounts"),path:It.ym,accountId:It.Sp,id:It.w1+"_"+It.Sp,children:i};n.push(o)}break;default:throw Error("Invalid mail panel item key: "+s)}var i;return n},Ck=()=>[cv(Mk(ht.Z.getByAccountId(It.u4),It.sM).sort(Lt.JM))];var Ak=fk("hr",{}),Ik=fk("progress",{}),Tk=fk("hr",{}),Zk=fk("progress",{}),Ek=fk(XE,{});class kk extends Li.PureComponent{refTreeList=Li.createRef();static contextType=ts.Z;winId=this.context.vivaldiWindowId;_isMounted=!1;#ye=()=>"PanelFeeds"===this.props.panelId;#be=()=>"PanelMail"===this.props.panelId;state={mailFolders:this.#ye()?Ck():wk(),mailAccounts:vt.Z.getAccounts(),online:navigator.onLine,showHiddenMailingLists:!1,indexProgress:ht.Z.isInitialized()?100:0,showErrors:C.Z.get(I.kMailPanelShowErrorMessages),isCheckingMail:!1,waitingForAccountCache:!vt.Z.hasLoadedFolders()&&(C.Z.get(I.kMailAccounts).length>0||C.Z.get(I.kRssSettings).length>0),isRestoringFeeds:!1,errorMessages:[],hasCriticalError:!1,clearFeedsConfirmation:!1};componentDidMount(){this._isMounted=!0,vt.Z.addListener(this.gotFolders),ht.Z.addListener(this.#Se),zc.Z.addListener(this.#me),Yn.ZP.addListener(this.#we),gt.Z.addListener(this.#Ce),this.context.addEventListener("online",this.#Ae),this.context.addEventListener("offline",this.#Ie),this.#be()&&(C.Z.addListener([I.kMailShowUnsubscribed],Yt.Z.reconnectIMAPClients),C.Z.addListener([I.kMailPanelItemsOrder,I.kMailPanelItemsShowAccounts,I.kMailPanelItemsShowAllMessages,I.kMailPanelItemsShowCustomFolders,I.kMailPanelItemsShowFeeds,I.kMailPanelItemsShowFilters,I.kMailPanelItemsShowFlags,I.kMailPanelItemsShowLabels,I.kMailPanelItemsShowMailingLists,I.kMailShowUnsubscribed,I.kMailLabelItemsOrder,I.kMailLabelItemsHide],this.#Te),C.Z.addListener(I.kMailAccounts,this.#Ze)),C.Z.addListener([I.kMailPanelShowErrorMessages],this.#Ee),Xc.addListener(this.#ke),this.#ke()}componentDidUpdate(e){!e.open&&this.props.open&&this.props.focusContent&&mk.nextTick((()=>{this.refTreeList.current?.focusTree()}))}componentWillUnmount(){this._isMounted=!1,this.context.removeEventListener("online",this.#Ae),this.context.removeEventListener("offline",this.#Ie),vt.Z.removeListener(this.gotFolders),ht.Z.removeListener(this.#Se),zc.Z.removeListener(this.#me),Yn.ZP.removeListener(this.#we),gt.Z.removeListener(this.#Ce),C.Z.removeListener([I.kMailPanelShowErrorMessages],this.#Ee),this.#be()&&(C.Z.removeListener([I.kMailShowUnsubscribed],Yt.Z.reconnectIMAPClients),C.Z.removeListener([I.kMailPanelItemsOrder,I.kMailPanelItemsShowAccounts,I.kMailPanelItemsShowAllMessages,I.kMailPanelItemsShowCustomFolders,I.kMailPanelItemsShowFeeds,I.kMailPanelItemsShowFilters,I.kMailPanelItemsShowFlags,I.kMailPanelItemsShowLabels,I.kMailPanelItemsShowMailingLists,I.kMailShowUnsubscribed,I.kMailLabelItemsOrder,I.kMailLabelItemsHide],this.#Te),C.Z.removeListener(I.kMailAccounts,this.#Ze)),Xc.removeListener(this.#ke)}#ke=()=>{const e=[];let t=!1;for(const[n,i]of Xc.getState())for(let s=i.length-1;s>=0;s--){const{category:o,error:a,code:r,level:l}=i[s];let d;if("CRITICAL"===l&&(t=!0),"DATABASE"===o||"SMTP"===o?d=a.message:(0,jc.I)(r)&&(d=(0,B.Z)("Authentication failed. Check username and password")),d){e.push({accountId:n,category:o,message:d,level:l});break}}this.setState({errorMessages:e,hasCriticalError:t})};#_e=(e,t,n)=>{this.openTabForMailbox(t[0]),n&&setTimeout((()=>{this.context.document.querySelector(".webpageview.active #mail_search .ReactVirtualized__Grid.ReactVirtualized__List")?.focus()}),200)};#Ne=e=>{this.openTabForMailbox(e)};#me=()=>{navigator.onLine?this.#Ae():this.#Ie()};#Ce=()=>{mk.nextTick((()=>{const e=gt.Z.getSelectedFolder();e&&this.refTreeList.current?.selectByNode(e)}))};#Ae=()=>{this.setState({online:!0})};#Ie=()=>{this.setState({online:!1})};#Se=e=>{if("mailingLists"===e.target){const e=this.#ye()?Ck():wk();this.setState({mailFolders:e})}else if("filters"===e.target){let t;const{filterIds:n}=e;if(n){const e=ht.Z.getByIds(n),i=[It.Kz,It.MN,It.ut,It.u4,It.of,It.Ry,It.wC];t=n.length>e.length||e.some((e=>i.includes(e.accountId)))}else t=!0;if(t){const e=this.#ye()?Ck():wk();this.setState({mailFolders:e})}}else if("updateIndexProgress"===e.target){const t=Math.floor(e.indexCount/e.total*100)||0;this.setState({indexProgress:t})}else if("finishIndexProgress"===e.target){const e=this.#ye()?Ck():wk();this.setState({mailFolders:e,indexProgress:100})}};#we=()=>{const e=this.refTreeList.current?.getWrapper(),t=Yn.ZP.getChangeReason();this.props.open&&"setFocus"===t&&e instanceof this.context.HTMLElement&&!(0,Ra.sT)(this.context.document,e)&&this.refTreeList.current?.focusTree()};gotFolders=()=>{const e=this.#ye()?Ck():wk();this.setState({mailFolders:e,mailAccounts:vt.Z.getAccounts(),waitingForAccountCache:!1})};getAllAccountMailboxes=e=>{const t=[];let n;switch(e.path){case It.N1:n=It.Nz;break;case It.rp:n=It.Hd;break;case It.cm:n=It.uT;break;case It.$T:n=It.hn}if(n){const e=vt.Z.getAccounts();for(const i in e){e[i].folders[n]?.forEach((({type:e,path:s,subscribed:o})=>{e===n&&t.push({accountId:i,path:s,subscribed:o})}))}}return t};openTabForMailbox=e=>{this.#Pe(e)&&mk.nextTick((()=>{(e.accountId===It.of?this.getAllAccountMailboxes(e):[e]).forEach((({accountId:e,path:t,subscribed:n})=>{t!==It.ym&&((0,Tt.mq)(e)&&n?Yt.Z.checkNewDeletedModified(e,t):(0,Tt.Vd)(e)&&qt.Z.checkForMail(e))})),c.ZP.openURL(this.context.vivaldiWindowId,pn.jk.internals.mailpage,{singleton:!0}),d.Z.selectFolder(e)}))};handleMailboxClick=(0,Ae.Z)((e=>{if(e.accountId===It.Ry&&e.path!==It.ym){const[t,n]=xt.ZP.fromCustomFolderPath(e.path);this.openTabForMailbox({...e,accountId:t,path:n})}else this.openTabForMailbox(e)}),200,{leading:!0,trailing:!1});#De=(e,t)=>{this.refTreeList.current?.toggleSelectedExpansion(e,t)};#Me=e=>{const{node:t,level:n}=e;if(0===n)return fk(ME,{id:t.id,name:t.name,label:t.name,handleExpandClick:this.#De,hasChildren:this.#Oe(t),onClick:this.handleMailboxClick.bind(this,t),isExpanded:e.isExpanded,accountId:t.accountId,path:t.path},t.id);let{name:i}=t;const s=Jl.Z.isAccountRootFolder(t);let o=!1;if(s){const e=iu.Z.getAccountOrAlias(t.accountId);e?.displayName&&(i=e?.displayName),o=this.state.online}return fk(KE,{name:i,accountId:t.accountId,id:t.id,type:t.type,path:t.path,isAccount:s,isImap:(0,Tt.ZA)(t.accountId),isOnline:o,level:n,onClick:this.handleMailboxClick.bind(this,t),isExpanded:e.isExpanded,onChange:e.onChange,onFocus:e.onFocus,onBlur:e.onBlur,inlineEditText:e.inlineEditText,handleExpandClick:this.#De,hasChildren:this.#Oe(t),subscribable:Jl.Z.isSubscribable(t)&&!t.subscribed,internal:vt.Z.isInternal(t.accountId,t.path)},t.id)};#xe=()=>!0;#Le=()=>{const e=[];for(const t of C.Z.get(I.kMailPanelItemsOrder)){const n=uk.get(t);n&&e.push({handler:this.#Re.bind(this,n.showPref),type:"checkbox",checked:C.Z.get(n.showPref),label:n.name,labelEnglish:n.name})}return e};#Re=e=>{w.Z.toggle(e,!0,!1)};#Oe=e=>Boolean(e.children&&e.children.length>0);#Pe=e=>!0;#Be=()=>{de.Z.showMailAccountDialog(this.context.vivaldiWindowId)};#Fe=()=>{Xt.Z.sendAll(this.context.vivaldiWindowId)};#We=e=>{Xt.Z.sendForAccount(this.context.vivaldiWindowId,e)};#Ue=(e,t)=>{Yt.Z.rescanUnreadFlags(e,t)};#Ve=(e,t)=>{de.Z.showAddMailFolder(this.context.vivaldiWindowId,{accountId:e,path:t})};#He=(e,t)=>{de.Z.showDeleteMailFolder(this.context.vivaldiWindowId,{accountId:e,path:t})};#Ge=e=>{e||(e=It.ym),de.Z.showAddFeedFolder(this.context.vivaldiWindowId,{path:e})};#$e=e=>{de.Z.showDeleteFeedFolder(this.context.vivaldiWindowId,{path:e})};#Ke=async(e,t,n)=>{const i=this.winId;switch(e.action){case"CONTEXT_VIEW_ALL_MESSAGES":return{handler:()=>this.openTabForMailbox(n),isVisible:()=>Boolean(n),...t(i,e,{})};case"CONTEXT_RERUN_FILTER":return{handler:()=>d.Z.rerunFilter(n.accountId,n.path||It.ym),isVisible:()=>Boolean(n),...t(i,e,{})};case"CONTEXT_RESYNC_FOLDER":return{handler:()=>d.Z.reSyncFolder(n.accountId,n.path),isVisible:()=>Boolean(n)&&Boolean(n.path)&&!n.internal&&(0,Tt.mq)(n.accountId)&&n.path!==It.ym,...t(i,e,{})};case"CONTEXT_RESYNC_ACCOUNT":return{handler:()=>d.Z.reSyncAccount(n.accountId),isVisible:()=>Boolean(n)&&(0,Tt.mq)(n.accountId)&&n.path===It.ym,...t(i,e,{})};case"CONTEXT_RECONNECT_ACCOUNT":return{handler:()=>d.Z.reconnectAccount(n.accountId),isVisible:()=>Boolean(n)&&(0,Tt.mq)(n.accountId)&&n.path===It.ym,...t(i,e,{})};case"CONTEXT_MARK_ALL_AS_READ":{const s=n?bt.Z.getFolderType(n.accountId,n.path):"";return{handler:()=>d.Z.markAllRead(n.accountId,n.path),isVisible:()=>Boolean(n)&&s!==It.Nz&&s!==It.kY&&s!==It.hn&&s!==It.fZ,...t(i,e,{})}}case"CONTEXT_MOVE_ALL_TO_TRASH":{const s=n?bt.Z.getFolderType(n.accountId,n.path):"";return{handler:()=>function(e,t,n,i){const s=ht.Z.getListEntriesByFolder(t,n);Hf.Z.prepareDelete(e,!1,s,i)}(i,n.accountId,n.path,!0),isVisible:()=>Boolean(n)&&(s===It.Hd||s===It.kY||s===It.fZ),...t(i,e,{})}}case"CONTEXT_EMPTY_TRASH":{const s=n?bt.Z.getFolderType(n.accountId,n.path):"";return{handler:()=>async function(e,t,n){if(bt.Z.getFolderType(t,n)!==It.uT)throw new Error("Non-Trash folder can not be emptied");const i=ht.Z.getListEntriesByFolder(t,n);await Hf.Z.prepareDelete(e,!0,i)}(i,n.accountId,n.path),isVisible:()=>Boolean(n)&&s===It.uT,...t(i,e,{})}}case"CONTEXT_CHECK_FOR_MAIL":return{handler:()=>this.#ze(n.accountId),isVisible:()=>Boolean(n)&&Jl.Z.isAccountRootFolder(n)&&!(0,Tt.S9)(n.accountId),...t(i,e,{})};case"CONTEXT_CREATE_FOLDER":return{handler:()=>this.#Ve(n.accountId,n.path),isVisible:()=>Boolean(n)&&(0,Tt.ZA)(n.accountId)&&!n.internal&&!(0,Tt.S9)(n.accountId),...t(i,e,{})};case"CONTEXT_DELETE_FOLDER":return{handler:()=>this.#He(n.accountId,n.path),isVisible:()=>Boolean(n)&&(0,Tt.ZA)(n.accountId)&&Jl.Z.isAccountSubFolder(n)&&"inbox"!==n.path.toLowerCase(),...t(i,e,{})};case"CONTEXT_CREATE_FEED_FOLDER":return{handler:()=>this.#Ge(It.pG.test(n.path)?"":n.path),isVisible:()=>Boolean(n)&&n.accountId===It.u4,...t(i,e,{})};case"CONTEXT_DELETE_FEED_FOLDER":return{handler:()=>this.#$e(n.path),isVisible:()=>Boolean(n)&&n.accountId===It.u4&&!It.pG.test(n.path)&&n.path!==It.ym,...t(i,e,{})};case"CONTEXT_TOGGLE_MAIL_VIEWS":return{isVisible:()=>Boolean(n)&&this.#be(),...t(i,e,{})};case"CONTEXT_MAIL_FOLDER":return{items:this.#Le(),...t(i,e,{})};case"CONTEXT_SEND":return{handler:()=>this.#We(n.accountId),isVisible:()=>Boolean(n)&&Jl.Z.isAccountRootFolder(n),...t(i,e,{})};case"CONTEXT_RESCAN_UNREAD":return{handler:()=>this.#Ue(n.accountId,n.path),isVisible:()=>Boolean(n)&&!n.internal&&Jl.Z.isAccountSubFolder(n)&&(0,Tt.ZA)(n.accountId)&&!(0,Tt.S9)(n.accountId),...t(i,e,{})};case"CONTEXT_IMPORT_MAIL_FILES":return{handler:()=>d.Z.selectAndImportMailFiles(this.context,n),isVisible:()=>Boolean(n)&&Jl.Z.isAccountSubFolder(n),...t(i,e,{})};case"CONTEXT_SUBSCRIBE":return{handler:()=>d.Z.subscribeMailbox(i,n),isVisible:()=>Boolean(n)&&Jl.Z.isSubscribable(n)&&!n.subscribed&&!n.internal,...t(i,e,{})};case"CONTEXT_UNSUBSCRIBE":return{handler:()=>de.Z.showMailUnsubscribeDialog(i,{folder:n}),isVisible:()=>Boolean(n)&&Jl.Z.isUnsubscribable(n)&&n.subscribed&&!n.internal,...t(i,e,{})};case"CONTEXT_RERUN_THREADING":return{handler:()=>d.Z.rerunThreading(n.accountId,n.path),isVisible:()=>Boolean(n)&&Jl.Z.isAccountSubFolder(n),...t(i,e,{})};case"CONTEXT_MOVE_INTO_IMPORTANT":{const s=Boolean(n)&&n.accountId===It.wC&&n.path!==It.ym?ht.Z.getByFolder(n.accountId,n.path):null,o=s&&s.path!==It.cs&&s.path!==It.W4&&s.path.startsWith(It.cs);return{handler:()=>d.Z.toggleMoveToOther(n),isVisible:()=>Boolean(o),...t(i,e,{})}}case"CONTEXT_MOVE_INTO_OTHER":{const s=Boolean(n)&&n.accountId===It.wC&&n.path!==It.ym?ht.Z.getByFolder(n.accountId,n.path):null,o=s&&s.path!==It.cs&&s.path!==It.W4&&s.path.startsWith(It.W4);return{handler:()=>d.Z.toggleMoveToOther(n),isVisible:()=>Boolean(o),...t(i,e,{})}}case"CONTEXT_DELETE_ALL":return{handler:()=>{this.setState({clearFeedsConfirmation:!0})},isVisible:()=>Boolean(n)&&n.id===It.sM&&n.children&&this.#Oe(n),...t(i,e,{})};case"CONTEXT_CREATE_LABEL":return{handler:()=>de.Z.showAddCustomLabel(i),isVisible:()=>Boolean(n)&&n.accountId===It.ut,...t(i,e,{})};case"CONTEXT_FILTER_EDIT":return{handler:()=>de.Z.showSettings(this.context.vivaldiWindowId,"mail",{scroll:"mail_filters_and_actions"}),isVisible:()=>Boolean(n)&&n.accountId===It.Kz,...t(i,e,{})};case"CONTEXT_ADD_NEW_ACCOUNT":return{handler:()=>de.Z.showMailAccountDialog(i),isVisible:()=>Boolean(n)&&n.accountId===It.Sp,...t(i,e,{})};case"CONTEXT_REGENERATE":return{handler:d.Z.regenerateAllMailingLists,isVisible:()=>Boolean(n)&&n.accountId===It.wC&&n.path===It.ym,...t(i,e,{})};case"CONTEXT_ADVANCED":return{isVisible:()=>Boolean(n),...t(i,e,{})};default:return{...t(i,e,{})}}};#je=(e,t)=>{if(!t)return!1;switch(e.action){case"CONTEXT_RENAME":return this.#Ye(t.id);case"CONTEXT_DELETE":return 1===this.#Xe([t.id]).length;case"CONTEXT_FILTER_EDIT":return t.id.startsWith(It.rQ);default:return!1}};#Qe=e=>{if(1!==e.length)return Promise.resolve(!1);const t=this.refTreeList.current?.findTreeItem(e[0]);return t?t.accountId===It.ut?new Promise((e=>{de.Z.showDeleteCustomLabelConfirmation(this.context.vivaldiWindowId,t.name,e)})):t.accountId===It.Kz?new Promise((e=>{de.Z.showDeleteFilterConfirmation(this.context.vivaldiWindowId,t.name,e)})):t.accountId===It.u4?new Promise((e=>{de.Z.showDeleteFeedConfirmation(this.context.vivaldiWindowId,t.name,e)})):Promise.resolve(!0):Promise.resolve(!1)};#Xe=e=>{if(e.length>1)return[];const t=[];return e.forEach((e=>{const n=this.refTreeList.current?.findTreeItem(e);if(n){let i=!1;switch(n.accountId){case It.Kz:case It.ut:i=void 0!==n.path&&Boolean(ht.Z.getByFolder(n.accountId,n.path));break;case It.wC:i=n.path!==It.ym&&(!n.children||0===n.children.length);break;case It.u4:i=It.pG.test(n.path)}i&&t.push(e)}})),t};#qe=e=>Promise.all(this.#Xe(e).map((e=>{const t=this.refTreeList.current?.findTreeItem(e);if(t)switch(t.accountId){case It.ut:!async function(e,t){const n=ht.Z.getByFolder(e,t);if(!n)throw new Error(`Filter not found for ${e} and ${t}`);if(!n.filterValue.include)throw new Error(`Filter for flag does not have any include rules: ${n.path}`);const i=n.filterValue.include.find((e=>e.some((e=>e.hasOwnProperty("flag")))));if(!i)throw new Error(`Filter for flag does not have flag include rule: ${n.path}`);const s=i.find((e=>e.hasOwnProperty("flag")));if(void 0===s?.flag)throw new Error(`flag not found in include rule for label ${n.path}`);const o=s.flag,a=ht.Z.getIndex(),r=[];for(const e of a)e.flags.includes(o)&&r.push(e.id);const l=[];await tn.Z.transaction("rw",[tn.Z.buffer,tn.Z.filters,tn.Z.filteringQueue,tn.Z.viewIds,tn.Z.imap,tn.Z.searchList],(async()=>{await Jt.Z.remove([n.id]),await tn.Z.searchList.where("id").anyOf(r).modify((e=>{const t=e.flags.indexOf(o);t>-1&&(e.flags.splice(t,1),l.push({id:e.id,updates:{flags:e.flags}}))})),await ok.Z.addImapFlags(r,{[o]:!1})})),await yt.Z.updateFilters([n.id]),d.Z.updateIndex({sleUpdates:l}),cn.Z.filter(),jt.Z.flushBuffer()}(t.accountId,t.path);break;case It.Kz:case It.wC:{const e=ht.Z.getByFolder(t.accountId,t.path);if(e)return t.accountId===It.wC?d.Z.removeMailingListFilter(this.context.vivaldiWindowId,e):d.Z.removeFilter(e.id);console.warn("No filter",t.accountId,t.path);break}case It.u4:const e=t.path.match(It.pG);if(e)return vn(e[0]);break;default:console.warn("Unknown account",t.accountId)}else console.warn("No match",e);return Promise.resolve()}))).then((()=>Promise.resolve()));#Je=e=>{e.nativeEvent.buttons>0&&this.refTreeList.current?.unSelectAll(),this.refTreeList.current?.onContextMenu(e)};#et=({index:e})=>{const t=this.refTreeList.current?.getId(e),n=(0,Cs.mM)(),i=Zs();return void 0===t?i:Sk.includes(t)?30+n:i};#tt={name:"mailpanellist",getCapability:this.#Ke,getVisibility:this.#je};#nt=(e,t)=>{const{accountId:n,path:i}=e,s=n===It.u4?!t.dataTransfer.types.some((e=>e===vk)):t.dataTransfer.types.some((e=>e===vk)),o=bt.Z.getFolderType(n,i);return{available:s,onto:(n===It.u4&&!It.pG.test(i)||n===It.MN&&i!==It.ym||n===It.ut&&i!==It.ym||n===It.Ry&&i!==It.ym||n===It.of&&i===It.tB||n===It.of&&i===It.rp||n===It.of&&i===It.$T||n===It.of&&i===It.cm||o===It.uT||o===It.Hd||o===It.hn||o===It.Oi||o===It.e9)&&s,edge:"none"}};#it=async(e,t,n,i)=>{const s=await Jt.Z.move(e,t,n,i);yt.Z.updateFilters(s)};#st=(e,t,n)=>{const i=bt.Z.getFolderType(t.accountId,t.path),s=gt.Z.getSelectedFolder();switch(!0){case t.accountId===It.MN:Hf.Z.setStandardFlag(this.winId,t.path);break;case t.accountId===It.ut:s&&s.accountId===It.ut?Hf.Z.setLabels(this.winId,{[s.path]:!1,[t.path]:!0}):Hf.Z.setLabel(this.winId,t.path);break;case t.accountId===It.of&&t.path===It.tB:Hf.Z.markUnread(this.winId);break;case t.accountId===It.of&&t.path===It.rp||i===It.Hd:Hf.Z.markAsJunk(this.winId);break;case t.accountId===It.of&&t.path===It.$T||i===It.hn:Hf.Z.moveToArchive(this.winId);break;case t.accountId===It.of&&t.path===It.cm||i===It.uT:{const t=JSON.parse(e.dataTransfer.getData(vk)).map((e=>ht.Z.getListEntry(e)));Hf.Z.prepareDelete(this.winId,!1,t,!0);break}case t.accountId===It.Ry||i===It.Oi||i===It.e9:{const n=JSON.parse(e.dataTransfer.getData(vk)).map((e=>ht.Z.getListEntry(e))),[i,s]=t.accountId===It.Ry?xt.ZP.fromCustomFolderPath(t.path):[t.accountId,t.path];this.#ot(n,i,s);break}case t.accountId===It.Sp:t.path===It.tB&&Hf.Z.markUnread(this.winId);break;case t.accountId===It.wC:break;case t.accountId===It.u4:const n=e.dataTransfer.getData("vivaldi/x-title").split("FEEDS_LABELS_")[1];if(It.pG.test(n)){const{ancestorPath:e,feedPath:i}=xt.ZP.parseFeedFolderPath(n),s=t.path.split("/").filter((e=>e!==It.ym)).join("/");this.#it(It.u4,e,s,i)}break;case t.accountId===It.Kz:break;default:if(t.path===It.ym)break}return e.preventDefault(),e.stopPropagation(),Promise.resolve([])};#ot=(e,t,n)=>{const i=new Set,s=gt.Z.getSelectedFolder();if(s){const e=s?.type;e&&i.add(e);const t=yt.Z.getByFolderId([s.accountId,s.path]);if(t){const{showDeleted:e,showJunk:n,showCustomFolder:s,showArchived:o}=xt.ZP.getFilterOptions(t);switch(s&&i.add(It.Oi),o&&i.add(It.hn),e&&i.add(It.uT),n&&i.add(It.Hd),t.accountId){case It.of:t.path!==It.tB&&t.path!==It.ik&&t.path!==It.ym||i.add(It.e9);break;case It.wC:case It.Kz:case It.MN:case It.ut:case It.Sp:i.add(It.e9)}}}const o=e.flatMap((e=>e.sourceFilterIds)).reduce(((e,t)=>{const n=yt.Z.get(t);return n?e.push(n):nn.Z.error("Mail",["move"],`Can not find any filter for id: ${t} when moving messages`),e}),[]),a=new Map,r=s&&vt.Z.get(s.accountId),l=o.filter((e=>{const t=bt.Z.getFolderType(e.accountId,e.path);if(r){if(s?.accountId!==e.accountId)return!1;if(![It.Hd,It.uT].includes(t)&&s?.path!==e.path)return!1}return i.has(t)})).map((e=>(a.set(e.id,{accountId:e.accountId,path:e.path}),{accountId:e.accountId,path:e.path})));if(0===l.length)nn.Z.error("Mail",["move"],`Can not find any source filter to move from when moving ${e.length} message(s)`);else{const i=new Set;let s=0,o=0;e.forEach((e=>{let n=0,r=!1;e.sources.forEach(((e,s)=>{if(a.has(s)){const o=a.get(s)?.accountId;e.internal||++n,o&&o!==t&&(i.add(o),r=!0)}})),n>1&&++o,r&&++s}));const r=()=>(0,qE.Z)(this.context.vivaldiWindowId,e,l,t,n);s&&o?this.#at((e=>{e&&r()}),(0,B.Z)("Move message from different account and in multiple folders?","Move messages from different account and in multiple folders?",[s]),(0,B.Z)("Are you sure you want to move $1 message from $2 to $3? (Note: Messages in multiple folders will move to to a single folder)","Are you sure you want to move $1 messages from $2 to $3? (Note: Messages in multiple folders will move to to a single folder)",[s,[...i].join(", "),t])):s?this.#at((e=>{e&&r()}),(0,B.Z)("Move message to different account?","Move messages to different account?",[s]),(0,B.Z)("Are you sure you want to move $1 message from $2 to $3?","Are you sure you want to move $1 messages from $2 to $3?",[s,[...i].join(", "),t])):o?this.#at((e=>{e&&r()}),(0,B.Z)("Move message in multiple folders?","Move messages in multiple folders?",[o]),(0,B.Z)("Are you sure you want to move $1 message in multiple folders to a single folder?","Are you sure you want to move $1 messages in multiple folders to a single folder?",[o])):r()}};#rt=(e,t)=>t;#lt=()=>{const e=this.#ye()?"FEEDS_PANEL":"MAIL_PANEL";return(0,ss.jsx)(Ps,{ref:this.refTreeList,rowComponent:this.#Me,getDropSupport:this.#nt,onDrop:this.#st,nodes:this.state.mailFolders,menu:this.#tt,onItemsActivated:this.#_e,isFolder:this.#xe,hasChildren:this.#Oe,settings:e,multiSelect:!1,supportsInlineEdit:!0,supportsCollapseAll:!1,isValidToEdit:this.#Ye,validateForDeletion:this.#Xe,confirmDelete:this.#Qe,activateAfterDelete:this.#Ne,delete:this.#qe,saveTitle:this.#dt,getTitle:this.#ct,rowHeight:e=>this.#et(e),folderMode:"expand",getDragData:this.#rt,validateForDrag:e=>e})};#ut=(e,t)=>{const n=t.match(It.pG);return n?e.findIndex((e=>e.feedId===n[0])):-1};#ct=e=>{let t="",n="";if(e.startsWith(It.jT))t=It.wC,n=It.jT;else if(e.startsWith(It.rQ))t=It.Kz,n=It.rQ;else if(e.startsWith(It.q0))t=It.MN,n=It.q0;else{const t=C.Z.get(I.kRssSettings);if(e){const n=this.#ut(t,e);if(n>-1)return t[n].title||"";{const t=this.refTreeList.current?.findTreeItem(e);if(t)return t.name}}}const i=e.replace(n+"_",""),s=ht.Z.getByFolder(t,i);return s?s.name:""};#Ye=e=>!(!e.startsWith(It.sM)||e===It.sM)||(e.startsWith(It.jT)&&e.split("/").length>1||e.startsWith(It.rQ)||e.startsWith(It.q0));#pt=e=>e.substring(It.sM.length+1);#dt=async(e,t)=>{if(e.startsWith(It.sM)){if(!It.pG.test(e)){const n=this.#pt(e),i=n.split("/"),s=i.length-1,o=ht.Z.getByAccountId(It.u4),a=[];for(const e of o)if(e.path===n){i[s]=t;const n=await Jt.Z.put({...e,path:i.join("/"),name:t});a.push(...n)}else if(e.path.startsWith(n)){const n=e.path.split("/");n[s]=t;const i=await Jt.Z.put({...e,path:n.join("/")});a.push(...i)}return void(a.length>0&&yt.Z.updateFilters(a))}{const n=C.Z.get(I.kRssSettings),i=this.#ut(n,e);if(-1===i)return void nn.Z.debug("Expected to find rss account matching id",e);const s=n[i];if(s.title!==t){yn({...s,title:t},i);const n=ht.Z.getByFolder(It.u4,this.#pt(e));if(n){const e=await Jt.Z.put({...n,name:t});yt.Z.updateFilters(e)}return}}}let n,i="";if(e.startsWith(It.jT))i=It.wC,n=It.jT;else if(e.startsWith(It.rQ))i=It.Kz,n=It.rQ;else{if(!e.startsWith(It.q0))return;i=It.MN,n=It.q0}const s=e.replace(n+"_",""),o=ht.Z.getByFolder(i,s);o&&t&&Jt.Z.put({...o,name:t}).then((e=>{yt.Z.updateFilters(e)}))};#ht=()=>{const e=[];return JE.Z.m3GetAll().then((t=>{const n={};t.forEach((e=>{if(e.from){const t=e.from[0].address;n[t]||(n[t]=[]),n[t].push(e)}}));for(const t in n){const i=n[t].length;i>0&&e.push({handler:this.#We.bind(null,t),...(0,us.Z)("Send from $1 ($2)",[t,i])})}return e}))};#gt=()=>{const e=[],t=Object.keys(this.state.mailAccounts);for(const n of t)e.push({handler:this.#ze.bind(null,n),...(0,us.Z)("Check $1",[n])});return e};#ze=e=>{(0,Tt.mq)(e)?Yt.Z.checkForMail(e):(0,Tt.Vd)(e)&&qt.Z.checkForMail(e)};#mt=async()=>{this.setState({isCheckingMail:!0}),await vf(),this._isMounted&&this.setState({isCheckingMail:!1})};#ft=()=>{Pn.forceRefreshAllRSSAccounts()};#vt=()=>{de.Z.showAddFeed(this.context.vivaldiWindowId,[{url:"",path:crypto.randomUUID(),title:"",refreshInterval:0}])};#at=(e,t,n)=>{de.Z.showMessageMoveConfirmation(this.context.vivaldiWindowId,e,t,n)};#Ee=()=>{this.setState({showErrors:C.Z.get(I.kMailPanelShowErrorMessages)})};#Ze=(e,t)=>{e.some((e=>t.some((t=>t.MAIL_EMAIL===e.MAIL_EMAIL&&t.displayName!==e.displayName))))&&this.forceUpdate()};#Te=()=>{const e=this.#ye()?Ck():wk();this.setState({mailFolders:e})};#yt=async()=>{this.setState({isRestoringFeeds:!0}),await ik(),this._isMounted&&this.setState({isRestoringFeeds:!1})};#bt=e=>{e&&async function(){const e=yt.Z.getByAccountId(It.u4);try{for(const t of e)await d.Z.removeAccountPath(It.u4,t.path);w.Z.set(I.kRssSettings,[])}catch(e){console.error(e)}}()};#St=()=>{de.Z.showDeleteFeedConfirmation(this.context.vivaldiWindowId,"",this.#bt),this.setState({clearFeedsConfirmation:!1})};render(){if(!this.props.open)return null;const e=yt.Z.getByAccountId(It.u4).filter((e=>It.pG.test(e.path))),t=C.Z.get(I.kRssSettings),n=t.length>0;if(this.state.clearFeedsConfirmation&&this.#St(),this.#ye()){const i=ht.Z.isInitialized()&&(this.state.isRestoringFeeds||t.length>e.length);return fk("div",{className:"panel",id:"mail_panel"},void 0,!i&&fk("header",{},void 0,fk(im,{title:this.state.online?this.props.title:(0,B.Z)("$1 – Offline",[this.props.title]),showCloseButton:this.props.showCloseButton}),fk("div",{className:"toolbar toolbar-default",role:"toolbar","aria-label":(0,B.Z)("toolbar-label","Feeds")},void 0,fk("div",{className:"toolbar toolbar-group"},void 0,fk(po.ZP,{tooltip:(0,B.Z)("Check all feeds"),image:Wi.GO5.small,disabled:!n,onClick:this.#ft}),Ak,fk(po.ZP,{tooltip:(0,B.Z)("Add a feed"),onClick:this.#vt,image:Wi.md4.small})),n&&fk(po.ZP,{onClick:()=>this.#Ge(),tooltip:(0,B.Z)("command","New Folder"),image:Wi._TQ.small}))),n||i?this.state.hasCriticalError?fk("span",{className:"mail-loading"},void 0,fk("span",{className:"critical-error-ocon",dangerouslySetInnerHTML:{__html:Wi.viW}})):this.state.indexProgress<100?fk("span",{className:"mail-loading"},void 0,0===this.state.indexProgress?Ik:fk("progress",{max:"100",value:this.state.indexProgress})):fk("section",{onContextMenu:this.#Je},void 0,this.#lt()):fk("div",{className:"mail-onboarding"},void 0,fk("span",{dangerouslySetInnerHTML:{__html:Wi.Us1}}),fk("h1",{},void 0,(0,B.Z)("Add your first feed")),fk("p",{className:"faded-text"},void 0,(0,B.Z)("Click the “+” button to add a new feed."))),i&&fk("header",{},void 0,fk(im,{title:(0,B.Z)("Database Error Detected"),showCloseButton:this.props.showCloseButton}),fk("div",{className:"toolbar toolbar-default"},void 0,fk("label",{role:"alert",title:(0,B.Z)("Filters for feeds are missing from DB and need to be restored!")},void 0,fk("input",{type:"button",onClick:this.#yt,disabled:this.state.isRestoringFeeds,value:this.state.isRestoringFeeds?(0,B.Z)("Restoring Feeds ..."):(0,B.Z)("Restore Feeds")})))),this.state.showErrors&&this.state.errorMessages.length>0&&fk("div",{},void 0,this.state.errorMessages.filter((e=>"DATABASE"===e.category)).map((({accountId:e,category:t,message:n,level:i})=>fk(To,{type:["CRITICAL","ERROR"].includes(i)?"error":"warning"},e,fk("div",{},void 0,n))))))}{const e=Object.keys(this.state.mailAccounts).length,t=C.Z.get(I.kMailPanelItemsShowFeeds);return this.state.waitingForAccountCache||0!==e||t&&n?fk("div",{className:"panel",id:"mail_panel"},void 0,fk("header",{},void 0,fk(im,{title:this.state.online?this.props.title:(0,B.Z)("$1 – Offline",[this.props.title]),showCloseButton:this.props.showCloseButton}),fk("div",{className:"toolbar toolbar-default",role:"toolbar","aria-label":(0,B.Z)("toolbar label","Mail")},void 0,fk("div",{className:"toolbar toolbar-group"},void 0,fk(po.ZP,{className:this.state.isCheckingMail?"btn-toolbar-spinner":"",disabled:this.state.isCheckingMail||this.state.hasCriticalError,tooltip:(0,B.Z)("Check all accounts"),label:(0,B.Z)("Fetch New Mail"),onClick:this.#mt,isMenuIndicatorVisible:e>1,image:Wi.GO5.small,menu:this.#gt,menuOrigin:"bottomLeft"}),Tk,fk(po.ZP,{tooltip:(0,B.Z)("Send from all accounts"),label:(0,B.Z)("Send Queued"),onClick:this.#Fe,disabled:100!==this.state.indexProgress,isMenuIndicatorVisible:e>1,image:Wi.zLp.small,menu:this.#ht,menuOrigin:"bottomLeft"})),fk(po.ZP,{title:(0,B.Z)("Compose"),label:(0,B.Z)("Compose Mail"),tooltip:(0,B.Z)("Compose new mail"),onClick:Qt.Z.createDraft.bind(null,void 0),image:Wi.XTV.small,className:"button-mail-compose",commandId:"COMMAND_MAIL_COMPOSE_NEW_MESSAGE"}))),fk("section",{className:"outerScrollbar",onContextMenu:this.#Je},void 0,this.state.hasCriticalError?fk("span",{className:"mail-loading"},void 0,fk("span",{className:"critical-error-icon",dangerouslySetInnerHTML:{__html:Wi.viW}})):this.state.indexProgress<100?fk("span",{className:"mail-loading"},void 0,0===this.state.indexProgress?Zk:fk("progress",{max:"100",value:this.state.indexProgress})):this.#lt()),Ek,this.state.showErrors&&this.state.errorMessages.length>0&&fk("div",{},void 0,this.state.errorMessages.map((({accountId:e,category:t,message:n,level:i})=>fk(To,{type:["CRITICAL","ERROR"].includes(i)?"error":"warning"},e,"DATABASE"!==t&&fk("div",{},void 0,e," (",t,")"),fk("div",{},void 0,n)))))):fk("div",{className:"panel",id:"mail_panel"},void 0,fk("header",{},void 0,fk(im,{title:(0,B.Z)("Mail"),showCloseButton:this.props.showCloseButton})),fk("div",{className:"mail-onboarding-wrapper"},void 0,fk("div",{className:"mail-onboarding"},void 0,fk("span",{dangerouslySetInnerHTML:{__html:Wi.Rx8}}),fk("h1",{},void 0,(0,B.Z)("Add your first mail account")),fk("p",{className:"faded-text"},void 0,(0,B.Z)("You can add any IMAP or POP account to Vivaldi Mail.")),fk("input",{type:"button",onClick:this.#Be,value:(0,B.Z)("Add Mail Account")}))))}}}const _k=function(e,t){return yk.indexOf(e.path)-yk.indexOf(t.path)},Nk=function(e,t){return bk.indexOf(e.path)-bk.indexOf(t.path)},Pk=function(e,t,n,i,s,o,a){i.sort(Lt.JM).forEach((i=>{(0,QE.Z)(i.path,n)?Dk(e,t,n+"/",i.children??[],s,o,a):i.children&&i.children.length>0&&Pk(e,t,n,i.children,s,o,a)}))},Dk=function(e,t,n,i,s,o,a){const r=t.indexOf("/");if(-1===r)s[n+=t]||(i.push({name:a||t,path:n,accountId:e,id:o+"_"+n,children:[]}),s[n]=!0);else{const l=t.substr(r+1),d=t.substr(0,r);if(s[n+=d])Pk(e,l,n,i,s,o,a);else{const t={accountId:e,path:n,children:[],id:o+"_"+n,name:yt.Z.getByFolderId([e,n])?.name||d};Dk(e,l,n+"/",t.children??[],s,o,a),i.push(t),s[n]=!0}}},Mk=(e,t)=>{const n=[],i={};for(let s=0;s<e.length;s++){const o=e[s],a=o.accountId===It.MN?(0,rk.M)(o.path):o.accountId===It.ut?(0,UE.X)(o.path):o.name;Dk(o.accountId,o.path,"",n,i,t,a)}return n},Ok=()=>{const e=ht.Z.getByAccountId(It.of);return 0===e.length?[]:e.map((e=>({name:(0,Ef.W)(e.path),path:e.path,accountId:It.of,id:It.w1+"_"+e.path,children:[]}))).sort(sk.m)},xk=e=>{const t=[],n=vt.Z.getAccounts(),i=new Set,s=new Set;for(const o in n){const a=Jl.Z.getFoldersFlat(o,{folders:n[o].folders},e);for(const e of a)if(e.type===It.Oi){i.has(e.name)?s.add(e.name):i.add(e.name);const n=xt.ZP.toFolderPath(o,e.path);t.push({...e,id:It.Ry+"_"+n,accountId:It.Ry,path:n})}}return t.forEach((e=>{if(s.has(e.name)){const t=e.path.substring(0,e.path.indexOf("/"));e.name=e.name+" ("+t+")"}})),t.sort(Lt.JM)},Lk=()=>({showAccounts:C.Z.get(I.kMailPanelItemsShowAccounts),showAllMessages:C.Z.get(I.kMailPanelItemsShowAllMessages),showCustomFolders:C.Z.get(I.kMailPanelItemsShowCustomFolders),showFeeds:C.Z.get(I.kMailPanelItemsShowFeeds),showFilters:C.Z.get(I.kMailPanelItemsShowFilters),showFlags:C.Z.get(I.kMailPanelItemsShowFlags),showLabels:C.Z.get(I.kMailPanelItemsShowLabels),showMailingLists:C.Z.get(I.kMailPanelItemsShowMailingLists),showUnsubscribed:C.Z.get(I.kMailShowUnsubscribed)}),Rk=kk;var Bk;function Fk(e,t,n,i){Bk||(Bk="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Bk,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Wk=function(e){function t(e){return Fk("option",{title:e.name,value:JSON.stringify(e)},e.id,e.name)}const n=e.originalSelectedFolder?.accountId===It.u4,i=n?It.u4:It.of;let s=(0,B.Z)("Selected");return e.originalSelectedFolder&&(s=e.originalSelectedFolder.accountId===It.Kz?e.originalSelectedFolder.name:vt.Z.getFolderName(e.originalSelectedFolder.accountId,e.originalSelectedFolder.path)),(0,ss.jsxs)(ss.Fragment,{children:[Fk("span",{},void 0,(0,B.Z)("Search in")),Fk("div",{className:"MailSearchOptionsSelectedFolder"},void 0,Fk(ta.Z,{value:e.selectedFolderString,onChange:function(t){const n=t.currentTarget.value;let i;try{i=JSON.parse(n)}catch(e){nn.Z.error("Mail",["search"],e)}i&&e.selectSearchFolder(i,n)},title:(0,B.Z)("Select which view to search in")},void 0,Fk("option",{value:JSON.stringify({name:i,accountId:i,path:It.ym,id:It.i4+"_"+i}),title:n?(0,B.Z)("All Feeds"):(0,B.Z)("All Messages")},void 0,n?(0,B.Z)("All Feeds"):(0,B.Z)("All Messages")),e.originalSelectedFolder&&Fk("optgroup",{label:(0,B.Z)("Current Folder")},void 0,Fk("option",{title:s,value:JSON.stringify(e.originalSelectedFolder)},void 0,s)),(n?Ck():wk()).flatMap((i=>i.path===It.ym&&(i.accountId===It.of||i.accountId===It.Sp||n&&It.u4)?Fk("optgroup",{label:i.name},i.id,i.children?.map((e=>t(e)))):i.accountId!==It.Kz&&e.isFilterManager&&xt.ZP.canSaveAsFilter(i.accountId,i.path)?t(i):void 0))))]})};var Uk,Vk=n(22529);function Hk(e,t,n,i){Uk||(Uk="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Uk,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Gk=function(e){return Hk(Vk.Z,{onChange:t=>{const{value:n}=t.currentTarget;let i;i=e.isEndDate?W()(n).endOf("day").valueOf():W()(n).valueOf(),e.selectSentDate(i)},onKeyDown:t=>{"Escape"!==t.key||e.selectSentDate(void 0)},title:e.isEndDate?(0,B.Z)("End Date"):(0,B.Z)("Start Date"),value:e.sentDate?W()(e.sentDate).format("YYYY-MM-DD"):"",placeholder:e.isEndDate?(0,B.Z)("End Date"):(0,B.Z)("Start Date")})};var $k,Kk=n(73132);function zk(e,t,n,i){$k||($k="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:$k,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const jk=[I.kKeyboardTabToAll,I.kMailSearchOnEnter,I.kMailSearchFolder,I.kMailViewLayout];class Yk extends Li.Component{static contextType=ts.Z;_isMounted=!1;refAllButton=Li.createRef();constructor(e){super(e);const t=gt.Z.getOptions(),n=ht.Z.getByFolder(this.props.currentAccountId,this.props.currentPath);let i;t.queryFolder?i=JSON.stringify(t.queryFolder):n?.selectedAccountId&&n.selectedName?i=JSON.stringify({name:n.selectedName,accountId:n.accountId,path:n.selectedName,id:xt.ZP.toFolderPath(n.accountId,n.path)}):"current"===this.props.prefValues[I.kMailSearchFolder]&&(i=JSON.stringify(gt.Z.getSelectedFolder())),this.state={recipientTypes:this.getRecipientTypes(t),forSender:t.forSender,forContact:t.forContact,attachments:t.attachments,sentDate:t.sentDate,sentDateEnd:t.sentDateEnd,selectedFolderString:i,mailAddresses:{queryAddition:[],from:[],to:[],cc:[]}}}componentDidMount(){gt.Z.addListener(this.updateSearchOptions),this._isMounted=!0}componentWillUnmount(){this._isMounted=!1,gt.Z.removeListener(this.updateSearchOptions)}selectAttachments=e=>{const t={...gt.Z.getOptions()};"number"==typeof e?t.attachments=e:delete t.attachments,d.Z.addSearchToHistory(t)};selectsentDateEnd=e=>{this.selectSentDate(e,!0)};selectSentDate=(e,t=!1)=>{const n={...gt.Z.getOptions()};"number"==typeof e?n[t?"sentDateEnd":"sentDate"]=e:delete n[t?"sentDateEnd":"sentDate"],d.Z.addSearchToHistory(n)};changeRecipientTypes=(e,t)=>{const{checked:n}=e.target;n?this.addRecipientTypes(t):this.removeRecipientTypes(t)};doSearch=e=>{d.Z.updateQueryResults(e)};addRecipientTypes=e=>{this.setState((t=>{let n=[];if(t.forContact&&!t.forSender?n=Ed.Z.getAddressesById(t.forContact)||[]:t.forSender&&(n=[t.forSender]),n.length>0){const i=t.recipientTypes||new Set;i.add(e);const s=xt.ZP.getContactQuery(n,i),o={...gt.Z.getOptions(),contactQuery:s};return gt.Z.setOptions(o),this.doSearch(o),{recipientTypes:i}}}))};removeRecipientTypes=e=>{this.setState((t=>{const{recipientTypes:n,forSender:i,forContact:s}=t;let o=[];if(s&&!i?o=Ed.Z.getAddressesById(s)??[]:i&&(o=[i]),n&&o.length>0){n.delete(e);const t=xt.ZP.getContactQuery(o,n),i={...gt.Z.getOptions(),contactQuery:t};return gt.Z.setOptions(i),this.doSearch(i),{recipientTypes:n}}}))};updateSearchOptions=e=>{const t=gt.Z.getOptions();if(this._isMounted&&"setOptions"===e){const e=t.queryFolder?JSON.stringify(t.queryFolder):void 0;this.setState({selectedFolderString:e,sentDate:t.sentDate,sentDateEnd:t.sentDateEnd,attachments:t.attachments})}else"selectFolder"===e&&this.setState({forSender:t.forSender,forContact:t.forContact,recipientTypes:this.getRecipientTypes(t),...xt.ZP.isMailSearching(t)?{}:{mailAddresses:{queryAddition:[],from:[],to:[],cc:[]}}})};getRecipientTypes(e){let t="";if(e.forSender)t=e.forSender;else if(e.forContact){const n=Ed.Z.getAddressesById(e.forContact||"");n&&n.length>0&&(t=n[0])}const n=new Set,i=e.contactQuery||"";return t?(i&&(i.includes(xt.ZP.getEqualsAddressQuery(t,"from"))&&n.add("from"),i.includes(xt.ZP.getEqualsAddressQuery(t,"to"))&&n.add("to"),i.includes(xt.ZP.getEqualsAddressQuery(t,"cc"))&&n.add("cc")),n):n}editFilter=()=>{de.Z.showSettings(this.context.vivaldiWindowId,"mail",{scroll:"mail_filters_and_actions"})};updateMailFilterSelector=(e,t)=>{e.mailAddresses?e.rule="":e.mailAddresses=this.state.mailAddresses[t],this.setState((n=>{if(e.mailAddresses)return n.mailAddresses[t]=e.mailAddresses,{mailAddresses:{...n.mailAddresses}}}),(()=>{const n=xt.ZP.getAddedQuery(e)||"";if(n!==(gt.Z.getOptions()[t]||"")){let e={queryAddition:n};switch(t){case"from":e={from:n};break;case"to":e={to:n};break;case"cc":e={cc:n}}d.Z.addSearchToHistory({...gt.Z.getOptions(),...e})}}))};selectSearchFolder=e=>{const t={...gt.Z.getOptions(),queryFolder:e,queryOptions:e.accountId===It.of&&e.path===It.ym?xt.ZP.getFilterOptions(xt.ZP.getDefaultFilterForPath(It.of,It.ym)):xt.ZP.getFilterOptions(yt.Z.getByFolderId([e.accountId,e.path]))};d.Z.addSearchToHistory(t)};renderMailFilterSelectors=()=>{const e=e=>(this.props.showMore?["from","to","cc"]:["from"]).map((t=>zk(IE,{className:e,type:t,saveFilter:()=>{},isEmpty:!1,onSubmit:(e,n)=>this.updateMailFilterSelector(e,t),selectedMailAddresses:this.state.mailAddresses[t],isSettings:!1},t))),t=gt.Z.getOptions().queryFolder,n=ht.Z.getByFolder(t?t.accountId:this.props.currentAccountId,t?t.path:this.props.currentPath);return n?(0,ss.jsxs)(ss.Fragment,{children:[e("MailSearchOptions--narrowOnly"),zk("div",{className:Fi()("MailSearchOptions-FromToCc MailSearchOptions--wideOnly",!this.props.showMore&&"MailSearchOptions-FromToCc--showLess")},void 0,e()),this.props.showMore&&(0,ss.jsxs)(ss.Fragment,{children:[zk(IE,{saveFilter:()=>{},isEmpty:!1,onSubmit:(e,t)=>this.updateMailFilterSelector(e,"queryAddition"),selectedMailAddresses:this.state.mailAddresses.queryAddition,isSettings:!1}),this.renderShowMoreAndMenuButtons(n,!0,"MailSearchOptions--wideOnly")]})]}):null};renderShowMoreAndMenuButtons=(e,t,n)=>zk("div",{className:Fi()("MailSearchOptions-SaveButtonContainer",n)},void 0,!this.props.showMore&&zk(po.ZP,{className:"MailSearchOptions-Menu MailSearchOptions--wideOnly",image:Wi.VZO,menu:this.getMenu,menuOrigin:"bottomLeft",tooltip:(0,B.Z)("Open menu")}),t&&zk("a",{className:"MailSearchOption-ShowMore",tabIndex:this.props.prefValues[I.kKeyboardTabToAll],onClick:()=>this.props.setShowMore(!this.props.showMore)},void 0,zk("span",{},void 0,this.props.showMore?(0,B.Z)("Show less"):(0,B.Z)("Show more")),zk(co,{type:"chevron",size:10,className:this.props.showMore?"ascending":"descending"})));renderSingleThread=()=>zk("div",{className:"toolbar toolbar-default mail-search MailSearchOptions"},void 0,zk("h2",{className:"MailSearchOptions-Title"},void 0,(0,B.Z)("Displaying a single thread")),this.renderShowMoreAndMenuButtons());renderContactOrSender=()=>{const e=Ed.Z.getAddressesById(this.state.forContact||""),t=this.state.forContact,n=t?Ed.Z.getNodeById(t):void 0;return zk("div",{className:Fi()("toolbar toolbar-default mail-search MailSearchOptions",this.state.forContact&&"MailSearchOptions--contact")},void 0,t&&1!==e?.length?zk("div",{className:"MailSearchOptions-TitleWrapper"},void 0,zk("h2",{className:"MailSearchOptions-Title"},void 0,(0,B.Z)("Displaying mails for")),zk("div",{className:"MailSearchOptions-ContactWrapper"},void 0,zk("img",{className:"MailSearchOptions-Image",src:n?.avatarUrl?n.avatarUrl:Kk.g,alt:""}),zk(ta.Z,{value:this.state.forSender||"all",className:"MailSearchOptions-Dropdown",onChange:e=>{const n=e.currentTarget.value;Hf.Z.enableContactView(this.context.vivaldiWindowId,t,"all"!==n?n:void 0)}},void 0,zk("option",{value:"all"},"all",n?.name?(0,B.Z)("$1 (All)",[n?.name||""]):(0,B.Z)("$1 addresses",[e?.length??""])),e?.map((e=>zk("option",{value:e},e,e)))))):zk("h2",{className:"MailSearchOptions-Title"},void 0,(0,B.Z)("Displaying mails for"),zk("span",{className:"MailSearchOptions-ContactWrapper"},void 0,t&&zk("img",{className:"MailSearchOptions-Image",src:n?.avatarUrl?n.avatarUrl:Kk.g,alt:""}),zk("span",{className:"MailSearchOptions-Contact"},void 0,e&&1===e.length?e[0]:this.state.forSender))),zk("div",{className:"MailSearchOptions-RecipientTypes"},void 0,zk("label",{className:"MailSearchOptions-RecipientType"},void 0,zk("input",{type:"checkbox",checked:this.state.recipientTypes.has("from"),onChange:e=>this.changeRecipientTypes(e,"from")}),(0,B.Z)("mail","from")),zk("label",{className:"MailSearchOptions-RecipientType"},void 0,zk("input",{type:"checkbox",checked:this.state.recipientTypes.has("to"),onChange:e=>this.changeRecipientTypes(e,"to")}),(0,B.Z)("to")),zk("label",{className:"MailSearchOptions-RecipientType"},void 0,zk("input",{type:"checkbox",checked:this.state.recipientTypes.has("cc"),onChange:e=>this.changeRecipientTypes(e,"cc")}),(0,B.Z)("cc"))),this.renderShowMoreAndMenuButtons())};renderFilterFolder=()=>{const e=ht.Z.getByFolder(this.props.currentAccountId,this.props.currentPath);if(!e)return null;const{selectedAccountId:t,selectedName:n}=e;let i=(0,B.Z)("Selected");return t&&n&&(i=t===n?(0,B.Z)(t):(0,B.Z)(t)+"/"+(0,B.Z)(n)),zk("div",{className:"toolbar toolbar-default mail-search MailSearchOptions"},void 0,zk("span",{},void 0,(0,B.Z)("Searching in: $1",[i])),zk(po.ZP,{onClick:this.editFilter,title:(0,B.Z)("mail_filter","Edit Filter"),tooltip:(0,B.Z)("mail_filter","Edit Filter"),className:Fi()("MailSearchOptions-Save")}))};getMenu=e=>{const t=gt.Z.getOptions(),n=xt.ZP.isValidSearch(t),i=this.props.currentAccountId===It.tQ,s=!this.state.forSender&&!this.state.forContact&&!i,o=[{type:"command",handler:()=>this.props.saveSearch(),isEnabled:()=>n,label:(0,B.Z)("Save as Filter"),labelEnglish:"Save as Filter"},{type:"command",handler:()=>d.Z.clearSearch(),label:s?(0,B.Z)("Clear Search"):(0,B.Z)("Navigation","Back"),labelEnglish:s?"Clear Search":"Back"}];return s&&(o.push(Qe.Z.separatorItem),o.push({...(0,us.Z)("Default Search Folder"),items:[{type:"radio",radiogroup:1,...(0,us.Z)("All Messages"),checked:"all"===this.props.prefValues[I.kMailSearchFolder],handler:e=>w.Z.set(I.kMailSearchFolder,"all")},{type:"radio",radiogroup:1,...(0,us.Z)("Current Folder"),checked:"current"===this.props.prefValues[I.kMailSearchFolder],handler:e=>w.Z.set(I.kMailSearchFolder,"current")}]}),o.push({type:"checkbox",checked:this.props.prefValues[I.kMailSearchOnEnter],handler:()=>w.Z.set(I.kMailSearchOnEnter,!this.props.prefValues[I.kMailSearchOnEnter]),label:(0,B.Z)("Start Search Using Enter Key"),labelEnglish:"Start Search Using Enter Key"})),o};render(){const e=gt.Z.getOptions(),t=e.queryFolder;if(!t&&this.props.currentAccountId===It.tQ)return this.renderSingleThread();if(this.state.forContact||this.state.forSender)return this.renderContactOrSender();this.props.currentAccountId!==It.Kz||xt.ZP.isValidSearch(e)||this.renderFilterFolder();const n=ht.Z.getByFolder(t?t.accountId:this.props.currentAccountId,t?t.path:this.props.currentPath);return n?zk("div",{className:"toolbar toolbar-default mail-search MailSearchOptions"},void 0,zk("div",{className:"MailSearchOptions--search"},void 0,zk(Wk,{filter:n,selectedFolderString:this.state.selectedFolderString,selectSearchFolder:this.selectSearchFolder,originalSelectedFolder:gt.Z.getSelectedFolder()}),zk(po.ZP,{className:"MailSearchOptions-Menu MailSearchOptions--narrowOnly",image:Wi.VZO,menu:this.getMenu,menuOrigin:"bottomLeft",tooltip:(0,B.Z)("Open menu")}),zk("span",{className:"MailSearchOptions--narrowOnly"},void 0,(0,B.Z)("Date Range")),zk("div",{className:"MailSearchOptions-DropdownContainer"},void 0,zk("span",{className:"MailSearchOptions--wideOnly"},void 0,(0,B.Z)("Date Range")),zk(Gk,{className:"MailSearchOptions-Dropdown",title:(0,B.Z)("Start Date"),selectSentDate:this.selectSentDate,sentDate:this.state.sentDate}),zk(Gk,{className:"MailSearchOptions-Dropdown",title:(0,B.Z)("End Date"),isEndDate:!0,selectSentDate:this.selectsentDateEnd,sentDate:this.state.sentDateEnd})),this.props.showMore&&(0,ss.jsxs)(ss.Fragment,{children:[zk(EE,{className:"MailSearchOptions-Attachments MailSearchOptions-Attachments--showMore MailSearchOptions--wideOnly",selectAttachments:this.selectAttachments,attachments:this.state.attachments}),zk(po.ZP,{className:"MailSearchOptions-Menu MailSearchOptions--wideOnly",image:Wi.VZO,menu:this.getMenu,menuOrigin:"bottomLeft",tooltip:(0,B.Z)("Open menu")})]}),this.renderMailFilterSelectors()),!this.props.showMore&&(0,ss.jsx)(ss.Fragment,{children:zk(EE,{className:"MailSearchOptions-Attachments MailSearchOptions--wideOnly",selectAttachments:this.selectAttachments,attachments:this.state.attachments})}),this.props.showMore&&(0,ss.jsx)(ss.Fragment,{children:zk(EE,{className:"MailSearchOptions-Attachments MailSearchOptions--narrowOnly",selectAttachments:this.selectAttachments,attachments:this.state.attachments})}),this.renderShowMoreAndMenuButtons(n,!0,"MailSearchOptions--narrowOnly"),!this.props.showMore&&this.renderShowMoreAndMenuButtons(n,!0,"MailSearchOptions--wideOnly")):null}}const Xk=(0,Bu.Z)(Yk,jk);var Qk;function qk(e,t,n,i){Qk||(Qk="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Qk,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Jk=[I.kKeyboardTabToAll,I.kMailSearchSortField,I.kMailSearchSortFieldPerFolder,I.kMailSearchSortFieldSent,I.kMailSearchSortOrder,I.kMailViewLayout];var e_=qk(GZ,{});class t_ extends Li.Component{nodeRef=Li.createRef();constructor(e){super(e),this.state={columns:vs()["vertical_wide"===this.props.prefValues[I.kMailViewLayout]?"mail_vertical":"mail_horizontal"]||ys(this.getMailSortFields(e.prefValues[I.kMailViewLayout])),slideBarStyle:ht.Z.hasNoListEntries()?{backgroundColor:"unset"}:{},mailSearchOptionsShowMore:!1}}componentDidUpdate(e){const t=this.props.prefValues[I.kMailViewLayout];t!==e.prefValues[I.kMailViewLayout]&&this.setState({columns:vs()["vertical_wide"===t?"mail_vertical":"mail_horizontal"]||ys(this.getMailSortFields(t))}),this.props.hasNoListEntries!==e.hasNoListEntries&&this.setSlideBarStyle()}setSlideBarStyle=()=>{ht.Z.hasNoListEntries()?this.setState({slideBarStyle:{backgroundColor:"unset"}}):this.setState({slideBarStyle:{}})};getMailSortFields=e=>{const t=this.props.selectedFolder&&[It.Nz,It.kY,It.fZ].includes(bt.Z.getFolderType(this.props.selectedFolder.accountId,this.props.selectedFolder.path));return[{value:"unread",text:(0,B.Z)("Unread"),icon:Wi.XQw.small,fullScreenTitle:(0,B.Z)("Sort by Unread Status"),width:36,visible:"vertical"!==e},{value:"flag",text:(0,B.Z)("Flag"),icon:Wi.nyn.small,fullScreenTitle:(0,B.Z)("Sort by Flag"),width:36,visible:"vertical"!==e},{value:"sender",text:t?(0,B.Z)("Recipient"):(0,B.Z)("Sender"),icon:Wi.HXY,fullScreenTitle:t?(0,B.Z)("Sort by Message Recipient"):(0,B.Z)("Sort by Message Sender"),width:150,visible:"vertical"!==e},{value:"subject",text:(0,B.Z)("Subject"),fullScreenTitle:(0,B.Z)("Sort by Subject"),width:300,visible:"vertical"!==e,key:!0},{value:"label",text:(0,B.Z)("Labels"),icon:Wi.rpm.small,fullScreenTitle:(0,B.Z)("Sort by Label"),width:"vertical_wide"===e?36:140,visible:"vertical"!==e},{value:"attachment",text:(0,B.Z)("Attachment"),icon:Wi.onv,fullScreenTitle:(0,B.Z)("Sort by Attachments"),width:36,visible:"vertical"!==e},{value:"size",text:(0,B.Z)("Size"),icon:Wi.W9U,fullScreenTitle:(0,B.Z)("Sort by Size"),width:100,visible:"horizontal"===e},{value:"sentDate",text:(0,B.Z)("Date"),icon:Wi.V_c,fullScreenTitle:t?(0,B.Z)("Sort by Date Sent"):(0,B.Z)("Sort by Date Received"),width:150,visible:"vertical"!==e},{value:"threads",text:(0,B.Z)("Date (Threaded)"),icon:Wi.V_c,fullScreenTitle:(0,B.Z)("Sort by Date (Threaded)"),width:150,visible:!1}]};onSortChange=(e,t)=>{const n=this.props.prefValues[I.kMailSearchSortOrder],i=(0,yf.U)(this.props.selectedFolder);("ascending"===n&&e!==ds.Z.ASCENDING_SORT||"descending"===n&&e!==ds.Z.DESCENDING_SORT)&&w.Z.set(I.kMailSearchSortOrder,this.getMailSortOrder(e)),i!==t&&this.props.selectedFolder&&(0,yf.O)(this.props.selectedFolder,t)};saveSearch=()=>{const{queryFolder:e,queryAddition:t,queryOptions:n={},attachments:i,sentDate:s,sentDateEnd:o}=gt.Z.getOptions(),{accountId:a,path:r}=e||(this.props.selectedFolder||{}),l=void 0!==a&&ht.Z.getByFolder(a,r)||{},c=xt.ZP.joinQueries(gt.Z.getQuery(),t),u={...l.filterValue,...n,attachments:i,sentDate:s,sentDateEnd:o,query:c},p={name:c||xt.ZP.generateFilterName(),accountId:It.Kz,path:Math.random().toString(36).substring(2),filterValue:{...u},selectedAccountId:a,selectedName:l.name};d.Z.addFilter(p)};onUpdateRow=e=>{this.setState({columns:e})};onSaveRow=()=>{fs(this.state.columns,"vertical_wide"===this.props.prefValues[I.kMailViewLayout]?"mail_vertical":"mail_horizontal")};getSortOrder(){return"ascending"===this.props.prefValues[I.kMailSearchSortOrder]?ds.Z.ASCENDING_SORT:ds.Z.DESCENDING_SORT}getMailSortOrder(e){switch(e){case ds.Z.ASCENDING_SORT:return"ascending";case ds.Z.DESCENDING_SORT:return"descending";default:throw new Error("Non existent mail sort order "+e)}}setShowMore=e=>{this.setState({mailSearchOptionsShowMore:e})};render(){const e=this.getMailSortFields(this.props.prefValues[I.kMailViewLayout]),t=this.props.selectedFolder,n=this.getSortOrder(),i=t?(0,yf.U)(t):"threads",s=gt.Z.getOptions(),o="horizontal"===this.props.position?"top":"left";return(0,ss.jsxs)("div",{ref:this.nodeRef,id:"mail_search",style:this.props.style,children:[(this.props.showMailSearchOptions||s.forSender||this.props.selectedFolder?.accountId===It.tQ||s.forContact)&&qk(Xk,{saveSearch:this.saveSearch,currentPath:this.props.selectedFolder?.path||"",currentName:this.props.selectedFolder?.name||"",currentAccountId:this.props.selectedFolder?.accountId||"",showMore:this.state.mailSearchOptionsShowMore,setShowMore:this.setShowMore}),e_,qk(Mm,{fields:e,columns:this.state.columns,onSortChange:this.onSortChange,sortField:i,sortOrder:n,manualSorting:!1,keyAccess:this.props.prefValues[I.kKeyboardTabToAll],fullsize:"horizontal"===this.props.prefValues[I.kMailViewLayout]||"vertical_wide"===this.props.prefValues[I.kMailViewLayout],onUpdateRow:this.onUpdateRow,onSaveRow:this.onSaveRow,style:this.state.slideBarStyle},this.state.columns.flatMap((e=>e.id)).join()||"sortfield"),qk(SE,{position:this.props.position,onSelect:this.props.onSelect,columns:this.state.columns}),qk(Zm.Z,{onSlidebarPosition:this.props.onSlidebarPosition,position:o})]})}}const n_=(0,Bu.Z)(t_,Jk);var i_,s_=n(34155);function o_(e,t,n,i){i_||(i_="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:i_,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const a_=[I.kMailViewLayout,I.kMailViewDimensions];function r_(e,t){const n=Ce.ZP.getPagesByUrl(e,pn.xy.mailpage).sort(((e,t)=>e.id-t.id));return n.size>1&&n.first().id!==t}class l_ extends Li.PureComponent{static contextType=ts.Z;mailSearchRef=Li.createRef();state={listEntry:void 0,hasNoListEntries:ht.Z.hasNoListEntries(),showMailSearchOptions:xt.ZP.isValidSearch(gt.Z.getOptions()),showSearchOptionsPersistent:!1,isDuplicateTab:r_(this.context.vivaldiWindowId,this.props.id)};onSlidebarPosition=(e,t)=>{const n=this.mailSearchRef.current?.nodeRef.current;if(!(n instanceof this.context.Element))return;var i=n.getBoundingClientRect(),s=t-i.top,o=e-i.left;const a={...this.props.prefValues[I.kMailViewDimensions]};"horizontal"===this.props.prefValues[I.kMailViewLayout]?(s>2e3?s=2e3:s<120&&(s=120),a.height=Math.floor(s)):(o>2e3?o=2e3:o<200&&(o=200),"vertical_wide"===this.props.prefValues[I.kMailViewLayout]?a.widthWide=Math.floor(o):a.width=Math.floor(o)),w.Z.set(I.kMailViewDimensions,a)};componentDidMount(){gt.Z.addListener(this._folderChanged),ht.Z.addListener(this._onFiltersChanged),Ce.ZP.addListener(this._onPageStoreChange)}componentWillUnmount(){gt.Z.removeListener(this._folderChanged),ht.Z.removeListener(this._onFiltersChanged),Ce.ZP.removeListener(this._onPageStoreChange)}_onPageStoreChange=()=>{if(this.state.isDuplicateTab){const e=r_(this.context.vivaldiWindowId,this.props.id);e||this.setState({isDuplicateTab:e})}};_onFiltersChanged=()=>{this.state.hasNoListEntries!==ht.Z.hasNoListEntries()&&this.setState({hasNoListEntries:ht.Z.hasNoListEntries()})};_folderChanged=e=>{if("toggleShowMailSearchOptions"===e)return void this.setState((e=>({showMailSearchOptions:!e.showMailSearchOptions,showSearchOptionsPersistent:!e.showSearchOptionsPersistent})));const t=gt.Z.getOptions();"selectFolder"===e&&this.setState({showSearchOptionsPersistent:xt.ZP.isMailSearching(t)});const n=gt.Z.getSelectedFolder();if(!n)return;this.setState((e=>({showMailSearchOptions:e.showSearchOptionsPersistent||!!t.query||xt.ZP.isValidSearch(t)})));const i=(0,B.Z)(n.name),s=(0,B.Z)(n.accountId);let o="Labels"===s?(0,UE.X)(i):i;i!==s&&(o+=" ("+s+")"),s_.nextTick((()=>c.ZP.setTitle(this.props.id,this.context.vivaldiWindowId,o)))};handleSelection=(0,Ae.Z)((e=>{this.setState({listEntry:e})}),200,{leading:!0,trailing:!0});render(){if(!he.ZP.isMail(this.context.vivaldiWindowId))return o_("div",{className:"mail-single-window-error"},"mailview",o_("div",{},void 0,o_("span",{dangerouslySetInnerHTML:{__html:Wi.Rx8}}),o_("h1",{},void 0,(0,B.Z)("Mail is in Another Window")),o_("p",{className:"faded-text"},void 0,(0,B.Z)("The Vivaldi email client runs in a single window at a time.")),o_("input",{type:"button",className:"primary",onClick:()=>{const e=he.ZP.getMailWindowId();de.Z.showMail(e),i.Z.windows.update(e,{focused:!0})},value:(0,B.Z)("Go to Mail")})));if(this.state.isDuplicateTab)return o_("div",{className:"mail-onboarding-wrapper"},"mailview",o_("div",{className:"mail-onboarding"},void 0,o_("h1",{},void 0,(0,B.Z)("Mail is in Another Tab")),o_("p",{},void 0,(0,B.Z)("The Vivaldi email client runs in a single tab at a time."))));const e="vertical_wide"===this.props.prefValues[I.kMailViewLayout],t="horizontal"===this.props.prefValues[I.kMailViewLayout]?{height:this.props.prefValues[I.kMailViewDimensions].height}:{width:this.props.prefValues[I.kMailViewDimensions][e?"widthWide":"width"]};return o_("div",{id:"mail_view",className:this.props.prefValues[I.kMailViewLayout]},void 0,(0,ss.jsx)(n_,{ref:this.mailSearchRef,selectedFolder:gt.Z.getSelectedFolder(),showMailSearchOptions:this.state.showMailSearchOptions,onSlidebarPosition:this.onSlidebarPosition,position:this.props.prefValues[I.kMailViewLayout],style:t,hasNoListEntries:this.state.hasNoListEntries,onSelect:this.handleSelection}),o_(LZ.Z,{pageId:this.props.id,listEntry:this.state.listEntry,prefValues:this.props.prefValues,hasNoListEntries:this.state.hasNoListEntries,pageIsActive:this.props.isActive}))}}const d_=(0,Bu.Z)(l_,a_);var c_;function u_(e,t,n,i){c_||(c_="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:c_,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const p_=[I.kIncognitoShowIntro],h_=w.Z.getEventHandler,g_="https://vvld.in/privacy-and-security";var m_=u_("svg",{className:"private-window-background",viewBox:"0 0 1244 860"},void 0,u_("defs",{},void 0,u_("linearGradient",{x1:"0.15",y1:"0.3",x2:"0.3",y2:"0.5",id:"private-intro-bg-gradient"},void 0,u_("stop",{offset:"0",stopColor:"var(--colorFg)",stopOpacity:"0.03"}),u_("stop",{offset:"1",stopColor:"var(--colorFg)",stopOpacity:"0.003"})),u_("linearGradient",{x1:"1",y1:"0",x2:"0",y2:"1",id:"private-intro-accent-gradient"},void 0,u_("stop",{offset:"0",stopColor:"var(--colorAccentBg)",stopOpacity:"0"}),u_("stop",{offset:"0.5",stopColor:"var(--colorAccentBg)",stopOpacity:"1"}),u_("stop",{offset:"1",stopColor:"var(--colorAccentBg)",stopOpacity:"0"}))),u_("path",{fill:"url(#private-intro-bg-gradient)",d:"M0 0h153.513c16.141 27.93 32.15 55.734 47.912 83.11 16.086 27.94 32.722 56.832 49.076 85.128 11.01 19.031 22.079 38.316 32.781 56.967 25.186 43.883 51.228 89.259 77.402 132.848 33.382 55.651 75.894 82.121 137.77 85.829 3.205.192 6.454.288 9.655.288 39.673 0 78.14-14.461 108.316-40.722 21.644-18.834 48.687-52.291 54.604-104.667.749-6.654 1.357-13.708 1.855-19.573-1.07-29.74-6.476-52.92-17.294-74.518C622.935 139.46 612.708 67.99 625.087 0h136.676C747.1 44.93 749.845 96.364 774.32 145.251c20.839 41.6 30.654 85.7 31.485 138.023-.568 6.192-1.472 18.273-2.83 30.356-17.572 155.524-149.172 263.318-294.866 263.318-5.816 0-11.67-.173-17.526-.521C382.84 569.97 301.9 518.174 246.822 426.358c-38.015-63.313-74.255-127.68-111.253-191.634C90.359 156.507 45.49 78.062 0 0zm1113.47 0H1244v140.1c-7.496 27.86-18.849 54.995-34.031 81.275a1299530.57 1299530.57 0 0 1-170.255 294.799A1223193.145 1223193.145 0 0 0 841.018 860.24H687.72c135.675-235.123 271.527-470.147 407.26-705.25 22.311-38.621 31.22-79.696 25.368-124.548A170.12 170.12 0 0 0 1113.471 0z"}),u_("path",{stroke:"url(#private-intro-accent-gradient)",strokeWidth:"2",d:"M854 839.979L1103.98 407"}),u_("path",{stroke:"url(#private-intro-accent-gradient)",d:"M951 649.979L1200.98 217"}),u_("path",{stroke:"url(#private-intro-accent-gradient)",d:"M969 628.452L1126.86 356"}),u_("path",{stroke:"url(#private-intro-accent-gradient)",d:"M802 686.452L959.86 414"}),u_("path",{stroke:"url(#private-intro-accent-gradient)",opacity:".5",d:"M735 790.452L892.86 518"}));class f_ extends Li.Component{static contextType=ts.Z;state={searchEngines:ai.Z.get()};componentDidMount(){ai.Z.addListener(this.#wt)}componentWillUnmount(){ai.Z.removeListener(this.#wt)}#wt=()=>{this.setState({searchEngines:ai.Z.get()})};#Ct=e=>{e.preventDefault(),c.ZP.openURL(this.context.vivaldiWindowId,g_,{inCurrent:!1,inBackground:!1})};#At=()=>{c.ZP.openURL(this.context.vivaldiWindowId,"https://store.vivaldi.com/shop/privacy-ghost-unisex-t-shirt/?pk_campaign=private-window",{inCurrent:!1,inBackground:!1})};#It=e=>{se.Z.searchEngines.setDefault("defaultPrivate",e.currentTarget.value)};#Tt=e=>{const t=[{handler:this.#At,...(0,us.Z)("Get the T-Shirt")}];(0,cs.Z)(this.context,t)(e)};render(){const e=ai.Z.getDefault(!0);return u_("div",{className:"private-intro"},void 0,m_,u_("div",{className:"private-intro-content"},void 0,u_("h1",{},void 0,(0,B.Z)("title","Private Window")),u_("span",{className:"private-intro-ghost",dangerouslySetInnerHTML:{__html:n(51491)},onContextMenu:this.#Tt,onDoubleClick:this.#At}),u_("p",{},void 0,(0,B.Z)("Browsing in a Private Window means that searches, sites visited, cookies, and temporary files won’t be stored by Vivaldi. It does not encrypt or otherwise modify your connection.")),u_("p",{},void 0,u_("a",{tabIndex:0,href:g_,onClick:this.#Ct},void 0,(0,B.Z)("Learn more about Privacy & Security"))),u_("h2",{},void 0,(0,B.Z)("Default Search")),u_("p",{className:"private-intro-blurb"},void 0,u_("span",{},void 0,(0,B.Z)("While in a Private Window, Vivaldi will use $1 to answer your searches.",[e?.name??""])),u_("span",{},void 0,"DuckDuckGo"===e?.name&&" "+(0,B.Z)("DuckDuckGo is a search engine that does not track your search history, enabling you to search privately."))),u_("h3",{},void 0,(0,B.Z)("Search with")),u_("label",{className:"private-intro-select-searchengine"},void 0,e&&u_(Ri.ZP,{className:"private-intro-favicon",url:e.faviconUrl,loadType:"faviconFromCache"}),u_(ta.Z,{value:e?.guid,onChange:this.#It},void 0,this.state.searchEngines.map((e=>u_("option",{value:e.guid},e.guid,e.name))))),u_("label",{className:"private-intro-disable"},void 0,u_("input",{type:"checkbox",checked:!this.props.prefValues[I.kIncognitoShowIntro],onChange:h_(I.kIncognitoShowIntro,"inverse")}),u_("span",{},void 0,(0,B.Z)("Do Not Show Introduction Again")))))}}const v_=(0,Bu.Z)(f_,p_);var y_;function b_(e,t,n,i){y_||(y_="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:y_,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function S_(){return b_("webview",{src:`${p.oP}/saga/saga.html`})}const w_={SpeedDial:"speeddial",Bookmarks:"bookmarks",History:"history",Calendar:"calendar",Mail:"mailpage",NotesManager:"notes",Dashboard:"dashboard"};var C_,A_=n(90718);function I_(e,t,n,i){C_||(C_="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:C_,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const T_=[I.kVivaldiCrashReportingConsentGranted];const Z_=function(){const e=Li.useContext(ts.Z),t=(0,Ya.Z)(T_),[n,i]=Li.useState(!1),s=Li.useRef(n),[o,a]=Li.useState(!0),[r,l]=Li.useState(!1);Li.useEffect((()=>{s.current=n,se.Z.extensionActionUtils.getToolbarExtensions().then((e=>{l(!!e.length)}))}),[n,l]);const d=Li.useCallback((async()=>{const t=Ce.ZP.getActivePage(e.vivaldiWindowId);t&&Ce.ZP.isLastPage(t)&&await c.ZP.openURL(e.vivaldiWindowId,"",{inCurrent:!1,singleton:!0}),t&&c.ZP.closePage(t)}),[e.vivaldiWindowId]),u=Li.useCallback(((t,n)=>{if(!s.current){i(!0);const s=()=>{se.Z.utilities.onSessionRecoveryDone.removeListener(o),clearTimeout(a)},o=()=>{d(),s()},a=setTimeout(o,1e4);se.Z.utilities.onSessionRecoveryDone.addListener(o),se.Z.utilities.acknowledgeCrashedSession(e.vivaldiWindowId,t,n)}}),[e.vivaldiWindowId,d]);Li.useEffect((()=>()=>{s.current?o||c.ZP.openURL(e.vivaldiWindowId,pn.xy.extensions,{inBackground:!0,singleton:!0}):se.Z.utilities.acknowledgeCrashedSession(e.vivaldiWindowId,!1,!0)}),[e.vivaldiWindowId,s,o]);const h=e=>{u(e,o)};return I_("div",{className:"guest-intro crash-recovery"},void 0,I_("div",{className:"guest-intro-content"},void 0,I_("h1",{},void 0,(0,B.Z)("title","Whoa, that was unexpected")),I_("div",{className:"crash-recovery-info"},void 0,I_("p",{},void 0,(0,B.Z)("Vivaldi could not start up as normal. We had to unload your tabs and extensions to get the browser running again.")),I_("p",{},void 0,(0,B.Z)("Select Recover Tabs to try again or Discard Tabs."))),r&&I_("div",{className:"crash-recovery-option"},void 0,I_("label",{},void 0,I_("input",{type:"checkbox",checked:!o,onChange:()=>{a(!o)}}),I_("span",{},void 0,(0,B.Z)("Keep Extensions Disabled"))),I_("p",{className:"info"},void 0,(0,B.Z)("If your session keeps crashing, you can try disabling your extensions. You can re-enable them in")," ",I_(A_.Z,{title:pn.xy.extensions,onClick:()=>{c.ZP.openURL(e.vivaldiWindowId,pn.xy.extensions,{inBackground:!0,singleton:!0})}},void 0,pn.jk.getDisplayUrlFromMapping(pn.xy.extensions)))),I_("div",{className:"crash-recovery-option"},void 0,I_("label",{},void 0,I_("input",{type:"checkbox",checked:t[I.kVivaldiCrashReportingConsentGranted],onChange:()=>{w.Z.set(I.kVivaldiCrashReportingConsentGranted,!C.Z.get(I.kVivaldiCrashReportingConsentGranted))}}),I_("span",{},void 0,(0,B.Z)("Allow Vivaldi to Send Automatic Crash Reports"))),I_("p",{className:"info"},void 0,(0,B.Z)("Crash reports can help us fix problems and avoid them in the future.")," ",I_(A_.Z,{title:p.fg,onClick:()=>{c.ZP.openURL(e.vivaldiWindowId,p.fg)}},void 0,(0,B.Z)("Privacy policy")))),I_("div",{className:"crash-recovery-footer"},void 0,I_("input",{type:"button",className:"primary",value:(0,B.Z)("Recover Tabs"),onClick:()=>{h(!0)},autoFocus:!0}),I_("input",{type:"button",className:"danger",value:(0,B.Z)("Discard Tabs"),onClick:()=>{h(!1)}}))))};var E_,k_=n(66777);function __(e,t,n,i){E_||(E_="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:E_,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const N_=[I.kAddressBarOmniboxEnabled,I.kAddressBarOmniboxShowNicknames,I.kAddressBarOmniboxShowBookmarks,I.kAddressBarSearchDirectMatchEnabled],P_=w.Z.getEventHandler;class D_ extends Li.Component{render(){const{prefValues:e}=this.props;return __(k_.j,{className:"setting-group setting-group-double",filter:this.props.filter},void 0,__("h3",{},void 0,(0,B.Z)("Drop-Down Menu")),__(k_.C,{text:(0,B.Z)("Show Drop-Down when Typing")},void 0,__("input",{type:"checkbox",checked:e[I.kAddressBarOmniboxEnabled],onChange:P_(I.kAddressBarOmniboxEnabled)})),__(k_.C,{text:(0,B.Z)("Prioritize Bookmarks")},void 0,__("input",{type:"checkbox",checked:e[I.kAddressBarOmniboxShowBookmarks],onChange:P_(I.kAddressBarOmniboxShowBookmarks)})),__(k_.C,{text:(0,B.Z)("Prioritize Bookmark Nicknames")},void 0,__("input",{type:"checkbox",checked:e[I.kAddressBarOmniboxShowNicknames],onChange:P_(I.kAddressBarOmniboxShowNicknames)})),__(k_.C,{text:(0,B.Z)("Enable Direct Match")},void 0,__("input",{type:"checkbox",checked:e[I.kAddressBarSearchDirectMatchEnabled],onChange:P_(I.kAddressBarSearchDirectMatchEnabled)})),__(k_.C,{text:(0,B.Z)("Prioritize Direct Match"),className:"pad-left"},void 0,__("input",{type:"checkbox",checked:e[I.kAddressBarSearchDirectMatchBoosted],onChange:P_(I.kAddressBarSearchDirectMatchBoosted),disabled:!e[I.kAddressBarSearchDirectMatchEnabled]})))}}const M_=(0,Bu.Z)(D_,N_);var O_;function x_(e,t,n,i){O_||(O_="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:O_,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const L_="HintTooltip",R_={show:100,hide:300};class B_ extends Li.PureComponent{static contextType=ts.Z;#Zt=crypto.randomUUID();state={visible:!1};componentWillUnmount(){clearTimeout(this._timeout)}showHint=()=>{const{show:e}=this.props.delay||R_;clearTimeout(this._timeout),this._timeout=setTimeout((()=>this.setState({visible:!0})),e)};hideHint=()=>{const{hide:e}=this.props.delay||R_;clearTimeout(this._timeout),this._timeout=setTimeout((()=>this.setState({visible:!1})),e)};toggleHint=()=>{const{show:e,hide:t}=this.props.delay||R_,n=this.state.visible;clearTimeout(this._timeout),this._timeout=setTimeout((()=>this.setState({visible:n})),n?t:e)};render(){const{label:e,className:t,position:n}=this.props,i=`--${this.#Zt}-anchor`;return(0,ss.jsxs)(ss.Fragment,{children:[x_("div",{style:{anchorName:i},className:Fi()(t,L_,[`HintTooltip--${n||"top"}`]),role:"tooltip",onFocus:this.showHint,onBlur:this.hideHint,onMouseEnter:this.showHint,onMouseLeave:this.hideHint,onTouchEnd:this.toggleHint},void 0,this.props.children),this.state.visible&&x_("div",{style:{"--anchor-name":i},className:"HintTooltip__content"},void 0,e)]})}}var F_;function W_(e,t,n,i){F_||(F_="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:F_,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const U_=[I.kAddressBarOmniboxEnabled,I.kAddressBarOmniboxDropdownPriority,I.kAddressBarInlineSearchEnabled,I.kAddressBarOmniboxShowBestResult,I.kAddressBarOmniboxShowSearchHistory,I.kAddressBarOmniboxShowNicknames,I.kAddressBarOmniboxShowBookmarks,I.kAddressBarOmniboxShowTypedHistory,I.kAddressBarOmniboxShowTopSites,I.kSearchSuggestEnabled,I.kAddressBarOmniboxShowBrowserHistory,I.kAddressBarOmniboxShowInternalUrls,I.kAddressBarOmniboxShowSearchOrGoTo,I.kAddressBarSearchDirectMatchEnabled,I.kAddressBarOmniboxShowSyncTabs,I.kAddressBarOmniboxShowOpenTab],V_=w.Z.getEventHandler,H_=[{key:"BEST_RESULT",name:(0,B.Z)("Best Result"),pref:I.kAddressBarOmniboxShowBestResult,hint:(0,B.Z)("Most relevant suggestion found across all categories")},{key:"INTERNAL_URLS",name:(0,B.Z)("Vivaldi Pages"),pref:I.kAddressBarOmniboxShowInternalUrls,hint:(0,B.Z)("Vivaldi components and tools")},{key:"SEARCH",name:(0,B.Z)("Search / Go To"),pref:I.kAddressBarOmniboxShowSearchOrGoTo,hint:(0,B.Z)("Initiate a search or directly enter a web address")},{key:"NICKNAMES",name:(0,B.Z)("Bookmarks Nicknames"),pref:I.kAddressBarOmniboxShowNicknames,hint:(0,B.Z)("Bookmarks labeled with custom shortcut nicknames")},{key:"BOOKMARKS",name:(0,B.Z)("Bookmarks"),pref:I.kAddressBarOmniboxShowBookmarks,hint:(0,B.Z)("All saved bookmarks")},{key:"TYPED_HISTORY",name:(0,B.Z)("Typed History"),pref:I.kAddressBarOmniboxShowTypedHistory,hint:(0,B.Z)("Manually entered URLs and search queries")},{key:"FREQ_VISIT",name:(0,B.Z)("Frequently Visited Pages"),pref:I.kAddressBarOmniboxShowTopSites,hint:(0,B.Z)("Websites visited frequently in recent days")},{key:"SUGGESTIONS",name:(0,B.Z)("Search Suggestions"),pref:I.kSearchSuggestEnabled,hint:(0,B.Z)("Recommendations provided by the search engine based on your current query")},{key:"HISTORY",name:(0,B.Z)("Browser History"),pref:I.kAddressBarOmniboxShowBrowserHistory,hint:(0,B.Z)("All recorded visits to pages and URLs")},{key:"DIRECT_MATCH",name:(0,B.Z)("Direct Match"),pref:I.kAddressBarSearchDirectMatchEnabled,hint:(0,B.Z)("Shortcut to known brand website")},{key:"SYNCED_TABS",name:(0,B.Z)("Sync Tabs"),pref:I.kAddressBarOmniboxShowSyncTabs,hint:(0,B.Z)("Pages on your other devices")},{key:"OPEN_TAB",name:(0,B.Z)("Open Tab"),pref:I.kAddressBarOmniboxShowOpenTab,hint:(0,B.Z)("Pages open in other tabs")}];class G_ extends Li.Component{renderListItem=(e,t)=>{const n=H_.find((e=>e.key===t.key)),i=n&&this.props.prefValues[n.pref];return n?(0,ss.jsxs)(ss.Fragment,{children:[W_("input",{type:"checkbox",disabled:Oi.Z.isEnabled("omnibox")||!this.props.prefValues[I.kAddressBarOmniboxEnabled],value:t.key,checked:i,onChange:()=>{w.Z.toggle(n.pref,!0,!1);const e=C.Z.get(n.pref);n!==I.kAddressBarOmniboxShowBestResult||e||w.Z.set(I.kAddressBarAutocompleteEnabled,!1)}}),t.name,W_(B_,{className:"hint-position",label:n.hint},void 0," ")]}):null};moveItem=(e,t)=>{const n=this.props.prefValues[I.kAddressBarOmniboxDropdownPriority].map((e=>e)),i=n.splice(e,1)[0];n.splice(t,0,i),w.Z.set(I.kAddressBarOmniboxDropdownPriority,n)};resetList=()=>{w.Z.reset(I.kAddressBarOmniboxDropdownPriority),H_.forEach((e=>{e.pref&&w.Z.reset(e.pref)}))};render(){const{prefValues:e}=this.props,t=Oi.Z.isEnabled("omnibox");return W_(k_.j,{className:"setting-group setting-group-double",filter:this.props.filter},void 0,W_("h3",{},void 0,(0,B.Z)("Drop-Down Menu")),W_(k_.C,{text:(0,B.Z)("Show Drop-Down when Typing")},void 0,W_("input",{type:"checkbox",checked:e[I.kAddressBarOmniboxEnabled],onChange:V_(I.kAddressBarOmniboxEnabled)})),t?(0,ss.jsxs)(ss.Fragment,{children:[W_(k_.C,{text:(0,B.Z)("Prioritize Bookmarks")},void 0,W_("input",{type:"checkbox",checked:e[I.kAddressBarOmniboxShowBookmarks],onChange:V_(I.kAddressBarOmniboxShowBookmarks)})),W_(k_.C,{text:(0,B.Z)("Prioritize Bookmark Nicknames")},void 0,W_("input",{type:"checkbox",checked:e[I.kAddressBarOmniboxShowNicknames],onChange:V_(I.kAddressBarOmniboxShowNicknames)})),W_(k_.C,{text:(0,B.Z)("Enable Direct Match")},void 0,W_("input",{type:"checkbox",checked:e[I.kAddressBarSearchDirectMatchEnabled],onChange:V_(I.kAddressBarSearchDirectMatchEnabled)})),W_(k_.C,{text:(0,B.Z)("Prioritize Direct Match"),className:"pad-left"},void 0,W_("input",{type:"checkbox",checked:e[I.kAddressBarSearchDirectMatchBoosted],onChange:V_(I.kAddressBarSearchDirectMatchBoosted),disabled:!e[I.kAddressBarSearchDirectMatchEnabled]}))]}):(0,ss.jsxs)(ss.Fragment,{children:[W_(k_.C,{text:(0,B.Z)("Show Search Queries in Typed History"),className:"pad-left"},void 0,W_("input",{type:"checkbox",disabled:!e[I.kAddressBarOmniboxEnabled],checked:e[I.kAddressBarOmniboxShowSearchHistory],onChange:V_(I.kAddressBarOmniboxShowSearchHistory)})),W_("div",{className:"setting-single list-priority pad-top"},void 0,W_("h3",{},void 0,(0,B.Z)("Drop-Down Menu Priority")),W_("p",{className:"info"},void 0,(0,B.Z)("Select the order and which category to display. The autocomplete will prioritize categories by their order.")),W_(lk.Z,{filter:this.props.filter,items:(n=e[I.kAddressBarOmniboxDropdownPriority],n.map((e=>{const t=H_.find((t=>t.key===e));return{key:e,name:t?.name||""}}))),moveItem:this.moveItem,renderListItem:this.renderListItem,supportDragAndDrop:!0,mimeType:"vivaldi/x-settings-dropdown-type"}),W_("input",{type:"button",onClick:this.resetList,value:(0,B.Z)("Reset to Default")}))]}));var n}}const $_=(0,Bu.Z)(G_,U_);var K_;function z_(e,t,n,i){K_||(K_="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:K_,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const j_=w.Z.getEventHandler,Y_=[I.kAddressBarUrlOpenShortcut];var X_=z_("input",{type:"radio",value:"alt"}),Q_=z_("div",{className:"setting-single"},void 0,z_("label",{},void 0,z_("input",{type:"radio",value:"shift"}),z_("span",{},void 0,"Shift + Enter")));class q_ extends Li.Component{render(){return z_(iA.Z,{filter:this.props.filter},void 0,z_("div",{className:"setting-group"},void 0,z_("h3",{},void 0,(0,B.Z)("Open Address in New Tab")),z_(ja.Z,{name:"urlfieldShortcut",className:"setting-single",value:this.props.value,onChange:j_(I.kAddressBarUrlOpenShortcut)},void 0,z_("div",{className:"setting-single"},void 0,z_("label",{},void 0,X_,z_("span",{},void 0,"Alt + Enter"))),Q_)))}}const J_=q_;var eN,tN=n(72046);function nN(e,t,n,i){eN||(eN="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:eN,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const iN={width:400,minWidth:"unset"};function sN(e){const[t,n]=Li.useState(!1),{onReset:i,prefPaths:s}=e,o=Li.useCallback((async()=>(i&&await i(),s?.length>0&&s.forEach((e=>{w.Z.reset(e)})),n(!1),Promise.resolve())),[s,i]),a=()=>{n(!1)},r=()=>{n(!0)},l=Li.useCallback((e=>nN(ra.Z,{style:iN,className:"float",onRequestClose:a,title:(0,B.Z)("Reset $1 Settings to Default?",[e])},void 0,nN("div",{className:"dialog-restore-settings"},void 0,nN("div",{className:"dialog-content"},void 0,nN("p",{},void 0,(0,B.Z)("All settings in the “$1” section will be reset to default values.",[e]))),nN("footer",{className:"dialog-footer"},void 0,nN("input",{type:"button",className:"danger",onClick:o,value:(0,B.Z)("command","Reset Settings")}),nN("input",{type:"button",onClick:a,value:(0,B.Z)("Cancel"),autoFocus:!0}))))),[o]),d=Li.useMemo((()=>nN(tN.Z,{categoryTitle:(0,B.Z)("title","Reset Settings"),filter:e.filter},void 0,t&&l(e.name),nN("div",{className:"setting-group"},void 0,nN("div",{className:"setting-single"},void 0,nN("input",{type:"button",value:(0,B.Z)("Reset $1 Settings to Default",[e.name]),onClick:r}),nN("p",{className:"info"},void 0,(0,B.Z)("This will reset the settings in this section to default values.")))))),[t,e.filter,e.name,l]);return e.prefPaths?.length?d:null}var oN;function aN(e,t,n,i){oN||(oN="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:oN,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const rN=[I.kAddressBarAutocompleteEnabled,I.kAddressBarAutocompleteAutocompleteOnTitle,I.kAddressBarAutocompleteSuffixExpansionEnabled,I.kAddressBarAutocompleteSuffixExpansionValue,I.kAddressBarExtensionsRenderInDropdown,I.kAddressBarExtensionsShowAllToggle,I.kAddressBarHighlightBaseDomain,I.kAddressBarOmniboxCutcopyEncoded,I.kAddressBarPosition,I.kAddressBarSelectOnClick,I.kAddressBarShowFullUrl,I.kAddressBarShowProgress,I.kAddressBarShowQrGenerator,I.kAddressBarStripJavascriptOnPaste,I.kAddressBarUrlOpenShortcut,I.kAddressBarVisible,I.kAddressBarAutocompleteAutocompleteOnDomainFirst,I.kHttpsOnlyModeEnabled],lN=[...rN,...N_,...Y_],dN=w.Z.getEventHandler;var cN=aN("input",{type:"radio",value:"top"}),uN=aN("input",{type:"radio",value:"bottom"}),pN=aN("input",{type:"radio",value:"false"}),hN=aN("input",{type:"radio",value:"true"});function gN(e){const t=(0,Ya.Z)(rN),n=sN({filter:e.filter,prefPaths:lN,name:e.category.title});return(0,ss.jsxs)(ss.Fragment,{children:[aN("section",{className:"setting-section"},void 0,aN(tN.Z,{categoryTitle:(0,B.Z)("title","Address Bar"),filter:e.filter},void 0,aN(k_.j,{filter:e.filter,className:"unlimited"},void 0,aN(k_.C,{text:(0,B.Z)("Show Address Bar")},void 0,aN("input",{type:"checkbox",checked:t[I.kAddressBarVisible],onChange:dN(I.kAddressBarVisible)}))),aN(k_.j,{filter:e.filter,heading:(0,B.Z)("Address Bar Position")},void 0,aN(ja.Z,{name:"addressbar-position",value:t[I.kAddressBarPosition],onChange:dN(I.kAddressBarPosition),className:"group"},void 0,aN(k_.C,{text:(0,B.Z)("Top")},void 0,cN),aN(k_.C,{text:(0,B.Z)("Bottom")},void 0,uN))),aN(k_.j,{filter:e.filter,heading:(0,B.Z)("Address Field Options")},void 0,aN(k_.C,{text:(0,B.Z)("Show Full Address")},void 0,aN("input",{type:"checkbox",checked:t[I.kAddressBarShowFullUrl],onChange:dN(I.kAddressBarShowFullUrl)})),aN(k_.C,{text:(0,B.Z)("Select Address on Activation")},void 0,aN("input",{type:"checkbox",checked:t[I.kAddressBarSelectOnClick],onChange:dN(I.kAddressBarSelectOnClick)})),aN(k_.C,{text:(0,B.Z)("Copy and Cut Encoded Address")},void 0,aN("input",{type:"checkbox",checked:t[I.kAddressBarOmniboxCutcopyEncoded],onChange:dN(I.kAddressBarOmniboxCutcopyEncoded)})),aN(k_.C,{text:(0,B.Z)("Page Load Progress Bar")},void 0,aN("input",{type:"checkbox",checked:t[I.kAddressBarShowProgress],onChange:dN(I.kAddressBarShowProgress)})),aN(k_.C,{text:(0,B.Z)("QR Code Generator")},void 0,aN("input",{type:"checkbox",checked:t[I.kAddressBarShowQrGenerator],onChange:dN(I.kAddressBarShowQrGenerator)}))),aN(J_,{value:t[I.kAddressBarUrlOpenShortcut],filter:e.filter}),function(){const n=Oi.Z.isEnabled("omnibox");return aN(k_.j,{filter:e.filter,heading:(0,B.Z)("Address Auto-Complete")},void 0,aN(k_.C,{text:(0,B.Z)("radio","Enabled")},void 0,aN("input",{type:"checkbox",checked:t[I.kAddressBarAutocompleteEnabled],onChange:dN(I.kAddressBarAutocompleteEnabled)})),!n&&(0,ss.jsxs)(ss.Fragment,{children:[aN(k_.C,{className:"pad-left",text:(0,B.Z)("Autocomplete On Item Title")},void 0,aN("input",{type:"checkbox",checked:t[I.kAddressBarAutocompleteAutocompleteOnTitle],disabled:!t[I.kAddressBarAutocompleteEnabled],onChange:dN(I.kAddressBarAutocompleteAutocompleteOnTitle)})),aN(k_.C,{className:"pad-left",text:(0,B.Z)("Autocomplete On Domain First")},void 0,aN("input",{type:"checkbox",checked:t[I.kAddressBarAutocompleteAutocompleteOnDomainFirst],disabled:!t[I.kAddressBarAutocompleteEnabled],onChange:dN(I.kAddressBarAutocompleteAutocompleteOnDomainFirst)}))]}))}(),Oi.Z.isEnabled("omnibox")?aN(M_,{filter:e.filter}):aN($_,{filter:e.filter}),aN(k_.j,{filter:e.filter,heading:(0,B.Z)("Domain Expansion")},void 0,aN("p",{className:"info pad-top"},void 0,(0,B.Z)("Expand top level domains with Ctrl + Enter. This shortcut takes precedence over tab opening modifiers")),aN(k_.C,{text:(0,B.Z)("radio","Enabled")},void 0,aN("input",{type:"checkbox",checked:t[I.kAddressBarAutocompleteSuffixExpansionEnabled],onChange:dN(I.kAddressBarAutocompleteSuffixExpansionEnabled)})),aN(k_.C,{className:"pad-left",text:(0,B.Z)("Suffix")},void 0,aN("input",{disabled:!t[I.kAddressBarAutocompleteSuffixExpansionEnabled],type:"text",defaultValue:t[I.kAddressBarAutocompleteSuffixExpansionValue],maxLength:"256",onChange:dN(I.kAddressBarAutocompleteSuffixExpansionValue)}))),aN(k_.j,{filter:e.filter,heading:(0,B.Z)("Profile Management")},void 0,aN("input",{type:"button",onClick:e=>de.Z.managePeople(),value:(0,B.Z)("Manage Profiles")})),aN(k_.j,{filter:e.filter,heading:(0,B.Z)("Extension Visibility")},void 0,aN(ja.Z,{name:"extension-toolbar-expansion",value:t[I.kAddressBarExtensionsShowAllToggle],onChange:dN(I.kAddressBarExtensionsShowAllToggle,"convert"),className:"group"},void 0,aN(k_.C,{label:(0,B.Z)("Show and hide only hidden extensions"),text:(0,B.Z)("Toggle Only Hidden Extensions")},void 0,pN),aN(k_.C,{label:(0,B.Z)("Show and hide all extensions"),text:(0,B.Z)("Toggle All Extensions")},void 0,hN)),aN(k_.C,{label:(0,B.Z)("Enable the drop-down menu for hidden extensions"),text:(0,B.Z)("Expand Hidden Extensions to Drop-Down Menu")},void 0,aN("input",{type:"checkbox",checked:t[I.kAddressBarExtensionsRenderInDropdown],onChange:dN(I.kAddressBarExtensionsRenderInDropdown)}))),aN(k_.j,{filter:e.filter,heading:(0,B.Z)("Security Features")},void 0,aN(k_.C,{text:(0,B.Z)("Always Use Secure Connection (HTTPS)")},void 0,aN("input",{type:"checkbox",checked:t[I.kHttpsOnlyModeEnabled],onChange:dN(I.kHttpsOnlyModeEnabled)})),aN(k_.C,{text:(0,B.Z)("Strip JavaScript from Pasted Text")},void 0,aN("input",{type:"checkbox",checked:t[I.kAddressBarStripJavascriptOnPaste],onChange:dN(I.kAddressBarStripJavascriptOnPaste)})),aN(k_.C,{text:(0,B.Z)("Highlight Base Domain in Address")},void 0,aN("input",{type:"checkbox",checked:t[I.kAddressBarHighlightBaseDomain],onChange:dN(I.kAddressBarHighlightBaseDomain)}))))),n]})}const mN=Li.memo(gN);var fN=n(37182),vN=n(63305);const yN="vivaldi/x-commanditem",bN="vivaldi/x-commandfolder",SN="vivaldi/x-commandmixed",wN="vivaldi/x-menuitem",CN="vivaldi/x-menudefaulttopfolder",AN="vivaldi/x-menufolder",IN="vivaldi/x-menumixed",TN="vivaldi/x-bookmarkcontainer";function ZN(e){return(0,vp.$)(e)}var EN;function kN(e,t,n,i){EN||(EN="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:EN,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var _N=kN("hr",{className:"separator-left"}),NN=kN("hr",{className:"separator-right"});class PN extends Li.Component{static contextType=ts.Z;refTreeList=Li.createRef();_searchKey="";_appendToSearch=!1;_isIMEOpen=!1;constructor(e,t){super(e),this.state={commandItems:[],searchFilter:"",darkBackground:Be.Z.hasDarkBackground(t.vivaldiWindowId)}}componentDidMount(){this._isMounted=!0,this._initialSetup(),Ge.Z.addListener(this._onCommandStoreChanged),Be.Z.addListener(this._onThemeStoreChanged)}_initialSetup=(0,Ae.Z)((async(e="")=>{if(!this._isMounted)return!1;const{commandItems:t,searchFilter:n}=await this._getStateWithSearchFilter(e);this.setState({commandItems:t,searchFilter:n})}),200);componentWillUnmount(){this._isMounted=!1,clearTimeout(this._timeout),Ge.Z.removeListener(this._onCommandStoreChanged),Be.Z.removeListener(this._onThemeStoreChanged)}componentDidUpdate(e,t){0===t.commandItems?.length&&this.state.commandItems.length>0&&this.refTreeList.current?.selectByNode(this.state.commandItems[0]),this.props.menu!==e.menu&&this._initialSetup(this.state.searchFilter)}_onCommandStoreChanged=e=>{if("menu"===e){const e=this.state.searchFilter;this._initialSetup(e)}};_onThemeStoreChanged=()=>{this.setState({darkBackground:Be.Z.hasDarkBackground(this.context.vivaldiWindowId)})};_getStateWithSearchFilter=async e=>{const t="contextfolder",n="chainfolder",i="appfolder",s="mailfolder",o="calendarfolder",a=e=>e.sort(((e,t)=>{if("container"===e.type&&"container"===t.type){const n=e.settingsLabel||"",i=t.settingsLabel||"";return n<i?-1:n>i?1:0}return"container"===e.type&&"container"!==t.type?"separator"===t.type?1:-1:"container"!==e.type&&"container"===t.type?"separator"===e.type?-1:1:"separator"===e.type||"separator"===t.type||e.label<t.label?-1:e.label>t.label?1:0})),r=(e,t)=>({parentId:e,id:t.id||"",type:t.type,label:t.settingsLabel||t.label,action:"",iconPNG:t.iconPNG||"",iconPNGWhite:t.iconPNGWhite||"",shortcuts:t.shortcuts}),l=e=>a(Ge.Z.makeCommandList(this.context.vivaldiWindowId).filter((t=>{if(void 0===t.id||t.id.startsWith("COMMAND_MAIL")||t.id.startsWith("COMMAND_CALENDAR"))return!1;return-1!==(t.settingsLabel||t.label||"").toLowerCase().indexOf(e)}))),d=e=>a(Ge.Z.makeCommandList(this.context.vivaldiWindowId).filter((t=>{if(void 0===t.id||!t.id.startsWith("COMMAND_MAIL"))return!1;return-1!==(t.settingsLabel||t.label||"").toLowerCase().indexOf(e)}))),c=e=>a(Ge.Z.makeCommandList(this.context.vivaldiWindowId).filter((t=>{if(void 0===t.id||!t.id.startsWith("COMMAND_CALENDAR"))return!1;return-1!==(t.settingsLabel||t.label||"").toLowerCase().indexOf(e)}))),u=(e,t)=>a(ji.Z.makeCommandList(this.context.vivaldiWindowId,e).filter((e=>{const n=e.settingsLabel||e.label;return void 0===n?(console.warn("Action ignored for command list",e.commandName),!1):-1!==n.toLowerCase().indexOf(t)}))),p=async e=>{const t=d(e).map((e=>r(i,e))),u=c(e).map((e=>r(i,e))),p=[{id:s,parentId:i,type:"folder",label:(0,B.Z)("Mail Commands"),action:"",iconPNG:"",iconPNGWhite:"",children:t},{id:o,parentId:i,type:"folder",label:(0,B.Z)("Calendar Commands"),action:"",iconPNG:"",iconPNGWhite:"",children:u}].sort(((e,t)=>e.label<t.label?-1:e.label>t.label?1:0)).concat(l(e).map((e=>r(i,e)))),h=await(async e=>{const t=await Ge.Z.getChainCommandsShortcuts();return a(C.Z.get(I.kChainedCommandsCommandList).map((e=>{const n=t.find((t=>t.name===e.name));return{type:"command",action:e.name,id:e.name,...Qe.Z.makeLabelPair(e.label),shortcuts:n?.shortcuts}})).filter((t=>-1!==(t.label||"").toLowerCase().indexOf(e))))})(e).then((e=>e.map((e=>r(n,e)))));return[{id:i,parentId:"",type:"folder",label:(0,B.Z)("Application Commands"),action:"",iconPNG:"",iconPNGWhite:"",children:p},{id:n,parentId:"",type:"folder",label:(0,B.Z)("Command Chains"),action:"",iconPNG:"",iconPNGWhite:"",children:h}]};let h=[];if(!ji.Z.isSection(this.props.menu)){const i=e.toLowerCase();h=ji.Z.getKeys().includes(this.props.menu)?await(async(e,i)=>p(i).then((s=>{const o=u(e,i).map((e=>r(n,e)));return[{id:t,parentId:"",type:"folder",label:(0,B.Z)("Context Commands"),action:"",iconPNG:"",iconPNGWhite:"",children:o}].concat(s)})))(this.props.menu,i):await p(i);const s={parentId:"",id:"separator",type:"separator",action:"",iconPNG:"",iconPNGWhite:"",label:""};h.splice(0,0,s);const o=Ge.Z.makeCommandList(this.context.vivaldiWindowId,Ge.Z.getOpenLinkName());o&&1===o.length&&o[0].id&&h.splice(0,0,r("",o[0]))}return{searchFilter:e,commandItems:h,darkBackground:this.state.darkBackground}};_hasChildren=e=>Boolean(e.children?.length);_isFolder=e=>Boolean(e.children);_isSeparator=e=>"separator"===e.type;_isValidDragSource=e=>!this._isFolder(e);_validateForDrag=vN.Z;_getDragData=(e,t)=>"";_getNodeById=e=>{const t=n=>{if(n)for(let i=0;i<n.length;i++){const s=n[i];if(s.id===e)return s;if(s.children){const e=t(s.children);if(e)return e}}};return t(this.state.commandItems)};_getMimeData=e=>{let t="";const n=[];return e.forEach((e=>{const i=this._getNodeById(e);if(i&&void 0!==i.type){t="folder"===i.type?""===t||t===bN?bN:SN:""===t||t===yN?yN:SN;const e={id:"",type:i.type,action:i.id};"folder"===i.type&&(e.title=i.label);const s=Ge.Z.getCommandParameter(e.action);if(s&&(e.parameter=s),Ge.Z.getOpenLinkName()===e.action){const t=Ge.Z.getCommandLabel(e.action);t&&(e.title=t)}const o={menu:"contextfolder"===i.parentId?this.props.menu:"",node:e};n.push(o)}})),{mimeType:t,payload:JSON.stringify(n)}};_setEventBehavior=(e,t)=>{const n=this._getMimeData(t);e.dataTransfer.setData(n.mimeType,n.payload)};_copy=(e,t)=>{const n=e.clipboardData;if(n){const e=t.filter(this._isValidForClipboard).map((e=>e.id)),i=this._getMimeData(e);n.setData(i.mimeType,i.payload)}(0,ms.ZP)(e)};_onKeyDown=e=>{const t=(e,t,n)=>{for(let i=t;i<n.length;i++){const t=n[i];if(t.label&&t.label.toUpperCase().startsWith(e))return t}};switch(e.key){case"ArrowUp":case"ArrowDown":case"PageUp":case"PageDown":break;default:const{ctrlKey:n,altKey:i,shiftKey:s,metaKey:o}=e,a={ctrlKey:n,altKey:i,shiftKey:s,metaKey:o};if((0,As.VV)(a)){const n=this.refTreeList.current?.getSelectedItem(),i=n?this._getNodeById(n.parentId):void 0,s=i?i.children||[]:this.state.commandItems,o=(n?s.findIndex((e=>e.id===n.id)):-1)+1,a=this._searchKey.length;if("ArrowLeft"===e.key||"ArrowRight"===e.key){if(0===a)break}else if(this._appendToSearch&&!1===e.repeat){const t=e.key.toUpperCase();1===a&&this._searchKey[0]===t||(this._searchKey+=t)}else this._searchKey=e.key.toUpperCase();let r=t(this._searchKey,o,s);r||0===o||(r=t(this._searchKey,0,s)),r&&(this.refTreeList.current?.selectByNode(r),e.preventDefault()),clearTimeout(this._timeout),this._appendToSearch=!0,this._timeout=setTimeout((()=>{this._appendToSearch=!1}),400)}}};_onSearchFilterChange=async e=>{if(this._isIMEOpen)this.setState({searchFilter:e.target.value});else{const t=await this._getStateWithSearchFilter(e.target.value);this.setState(t)}};_handleExpandClick=(e,t)=>{const n=e.altKey;this.refTreeList.current?.toggleSelectedExpansion(t,n)};_getContextMenuItems=e=>e?[{isVisible:()=>{const e=this.refTreeList.current?.getAllSelectedItems().filter((e=>this._isValidForClipboard(e))).map((e=>e.id));return Boolean(e&&e.length>0&&this.props.canAddToTree())},handler:()=>{const e=this.refTreeList.current?.getAllSelectedItems().filter((e=>this._isValidForClipboard(e))).map((e=>e.id));if(e){const t=this._getMimeData(e);this.props.addToTree(t.mimeType,t.payload)}},...(0,us.Z)("Add to Content")}]:[];_getContextMenuItemProps=e=>({showCopy:this._isValidForClipboard(e)});_isValidForClipboard=e=>!this._isFolder(e);rowComponent=e=>{const t=e.node,n=e.level,i=n*ks+"px",s=(n+1)*ks+"px";if(this._isSeparator(t))return kN("label",{style:{marginLeft:s}},"0",_N,(0,B.Z)("Menu Separator"),NN);let o=t.label;t.ellipsis&&(o+=Qe.Z.ellipsisString()),"container"===t.type&&t.settingsLabel&&(o=t.settingsLabel);const a=this._isFolder(t)&&this._hasChildren(t);let r=C.Z.get(I.kKeyboardShortcutsEnable);t.shortcuts?.length>0&&1===t.shortcuts[0].length&&r&&(r=Qe.Z.hasBrowserFeature(t)?C.Z.get(I.kKeyboardShortcutsEnableSingleKey):C.Z.get(I.kKeyboardShortcutsEnableSingleKeyForMail));const l=this.state.darkBackground?t.iconPNGWhite:t.iconPNG;return kN("label",{style:a?null:{marginLeft:s}},"0",a&&kN("span",{className:"expand-icon",style:{marginLeft:i},onMouseDown:ms.ZP,onMouseUp:e=>this._handleExpandClick(e,t.id),dangerouslySetInnerHTML:{__html:Wi.nfH}}),l&&kN("img",{src:"data:image/png; base64, "+l}),kN("span",{className:"title"},void 0,o),t.shortcuts&&t.shortcuts.length>0&&kN("span",{className:"nickname"},void 0,ZN(t.shortcuts[0])))};render(){return(0,ss.jsxs)(ss.Fragment,{children:[(0,ss.jsx)(Ps,{ref:this.refTreeList,rowComponent:this.rowComponent,nodes:this.state.commandItems,enableDragAndDrop:!0,validateForDrag:this._validateForDrag,isValidDragSource:this._isValidDragSource,getDragData:this._getDragData,setCustomEventBehavior:this._setEventBehavior,hasChildren:this._hasChildren,isFolder:this._isFolder,onCopy:this._copy,getContextMenuItems:this._getContextMenuItems,getContextMenuItemProps:this._getContextMenuItemProps,onKeyDown:this._onKeyDown}),kN("div",{className:"setting-single"},void 0,kN("input",{type:"search",className:"menu-search",value:this.state.searchFilter,placeholder:(0,B.Z)("Filter Commands"),onCompositionStart:()=>this._isIMEOpen=!0,onCompositionEnd:e=>{this._isIMEOpen=!1,this._onSearchFilterChange(e)},onChange:this._onSearchFilterChange}))]})}}const DN=PN;var MN,ON=n(34155);function xN(e,t,n,i){MN||(MN="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:MN,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const LN="MenuCutIds";class RN extends Li.Component{refTreeList=Li.createRef();static contextType=ts.Z;winId=-1;_isMounted=!1;_isMac=!1;_editHasFocus=!1;_id=crypto.randomUUID();_pageContext={};_useOmni=Oi.Z.isEnabled("omnibox");constructor(e,t){super(e),this.winId=t.vivaldiWindowId,this.state={rootId:"",role:void 0,menuItems:[],editId:"",editTitle:"",editUrl:"",url:"",cutIds:[],darkBackground:Be.Z.hasDarkBackground(t.vivaldiWindowId)}}componentDidMount(){this._isMounted=!0,se.Z.menuContent.onChanged.addListener(this._onMenuChanged),se.Z.menuContent.onResetAll.addListener(this._onMenuResetAll),se.Z.utilities.onSharedDataUpdated.addListener(this._onSharedDataChanged),Be.Z.addListener(this._onThemeStoreChanged),this._useOmni?Rv.addListener(this._onUrlFieldStoreChanged,(e=>e.get(this._id))):rb.addListener(this._onUrlFieldStoreChanged,(e=>e.get(this._id))),this._loadMenu()}componentWillUnmount(){this._isMounted=!1,se.Z.menuContent.onChanged.removeListener(this._onMenuChanged),se.Z.menuContent.onResetAll.removeListener(this._onMenuResetAll),se.Z.utilities.onSharedDataUpdated.removeListener(this._onSharedDataChanged),Be.Z.removeListener(this._onThemeStoreChanged),this._useOmni?Rv.removeListener(this._onUrlFieldStoreChanged):rb.removeListener(this._onUrlFieldStoreChanged)}componentDidUpdate(e,t){this.props.menu!==e.menu&&(this._cancelEdit(),this._loadMenu())}_onThemeStoreChanged=()=>{this.setState({darkBackground:Be.Z.hasDarkBackground(this.context.vivaldiWindowId)})};_onUrlFieldStoreChanged=()=>{const{typedUrl:e}=this._useOmni?Rv.getUrlfieldState(this._id):rb.getUrlfieldState(this._id);this.setState({editUrl:e})};getSelectedItem=()=>this.refTreeList.current?.getSelectedItem();_onMenuChanged=(e,t,n,i,s)=>{e===this.props.menu&&this._setMenu(this.props.menu,t,n,i,s,!1)};_onMenuResetAll=e=>{e===ji.Z.hasName(this.props.menu)&&this._loadMenu()};_loadMenu=()=>{const e=this.props.menu;ji.Z.isSection(e)?this._isMounted&&this.setState({rootId:"",role:void 0,menuItems:[]}):se.Z.menuContent.get(e,((t,n,s)=>{i.Z.runtime.lastError?(this.setState({rootId:"",role:void 0,menuItems:[]}),console.warn("Failed to read menu spec. Attempting fallback for menu key:",e),se.Z.menuContent.reset(e,ji.Z.hasName(e),void 0,Lr.Z)):this._setMenu(e,t,n,"",s,!0)}))};_setMenu=(e,t,n,i,s,o)=>{const a=(e,t,n)=>{const i={...e,index:n,parentId:t},s=e.id;return e.items&&void 0!==s&&(i.children=e.items.map(((e,t)=>a(e,s,t)))),i};((e,t,n)=>{const i={expandContainers:!1,inSettings:!0,updateCallbacks:!1};return"context"===t?ji.Z.makeMenuWithContent(this.winId,e,n,i):Promise.resolve(Ge.Z.makeMenuWithContent(this.winId,n,i))})(e,n,s).then((e=>{const s=e.map(((e,n)=>a(e,t,n)));this._isMounted&&this.setState({rootId:t,role:n,menuItems:s},(()=>{if(o&&this.state.menuItems.length>0)this.refTreeList.current?.selectByNode(this.state.menuItems[0]);else{const e=this._getNodeById(i);e&&this.refTreeList.current?.selectByNode(e)}}))}))};_getNodeById=e=>{const t=n=>{if(n)for(let i=0;i<n.length;i++){const s=n[i];if(s.id===e)return s;if(s.children){const e=t(s.children);if(e)return e}}};return t(this.state.menuItems)};_hasChildren=e=>Boolean(e.children)&&e.children.length>0;_isFolder=e=>Boolean(e.children);_isContainer=e=>"container"===e.type;_isBookmarkContainer=e=>"CONTAINER_BOOKMARK"===e.container?.content;_isSeparator=e=>"separator"===e.type;_isLink=e=>e.commandName===Ge.Z.getOpenLinkName();_isDefaultTopFolder=e=>!this._isContextMenu()&&(!!this._isMac&&["MENU_APPLE_APP","MENU_FILE","MENU_EDIT","MENU_VIEW","MENU_BOOKMARKS","MENU_WINDOW","MENU_HELP"].includes(e.commandName));_isPersistent=e=>!this._isContextMenu()&&(!!this._isMac&&["MENU_APPLE_APP","MENU_BOOKMARKS","MENU_WINDOW","MENU_HELP"].includes(e.commandName));_canDeleteNode=e=>!!this._isContextMenu()||(!this._isMac||!this._isPersistent(e)&&!this._isBookmarkContainer(e));_isValidForClipboard=e=>this._isValidDragSource(e);_isValidDragSource=e=>!!this._isContextMenu()||(!this._isMac||!["MENU_APPLE_APP"].includes(e.commandName));_validateForDrag=e=>e.map(this._getNodeById).filter(Boolean).filter(this._isValidDragSource).map((e=>e.id));_validateForDeletion=e=>e.map(this._getNodeById).filter(Boolean).filter(this._canDeleteNode).map((e=>e.id));_validateForRename=e=>{const t=this._getNodeById(e);return!!t&&(!this._isSeparator(t)&&!1!==t.settingsRename)};_validateForEdit=e=>{const t=this._getNodeById(e);return!!t&&this._isLink(t)};_reset=e=>{se.Z.menuContent.reset(this.props.menu,ji.Z.hasName(this.props.menu),[e],Lr.Z)};_setContainerMode=(e,t)=>{se.Z.menuContent.update(this.props.menu,e,{containerMode:t},Lr.Z)};_setShowShorcut=(e,t)=>{se.Z.menuContent.update(this.props.menu,e,{showshortcut:t},Lr.Z)};_setContainerEdge=(e,t)=>{se.Z.menuContent.update(this.props.menu,e,{containerEdge:t},Lr.Z)};_onEdit=()=>{const e=this.getSelectedItem();if(e){const t=e.url||"https://www.vivaldi.com";this._useOmni?sb.updateState(this._id,{typedUrl:t,autocompleteValue:""}):Ov.Z.updateState(this._id,{typedUrl:t,autocompleteValue:""}),this.setState({editId:e.id,editTitle:e.label,url:t})}};_onTitleChanged=e=>{const t=e.target.value;this.setState({editTitle:t})};_onEditFocus=()=>{this._editHasFocus=!0};_onEditBlur=()=>{this._editHasFocus=!1,ON.nextTick((()=>{this._saveEdit(!this._editHasFocus,!1)}))};_cancelEdit=()=>{this.setState({editId:"",editTitle:"",editUrl:""})};_saveEdit=(e,t)=>{const n=this.state.editId,{autocompleteValue:i}=this._useOmni?Rv.getUrlfieldState(this._id):rb.getUrlfieldState(this._id);let s=(i||this.state.editUrl||this.state.url||"").trim();void 0===se.Z.utilities.getUrlFragments(s).scheme&&(s="http://"+s),se.Z.menuContent.update(this.props.menu,n,{title:this.state.editTitle,parameter:s},(()=>{e&&this.setState({editId:"",editTitle:"",editUrl:""},(()=>{const e=this._getNodeById(n);e&&(t&&this.refTreeList.current?.focusTree(),this.refTreeList.current?.expandToId(n),this.refTreeList.current?.selectByNode(e))}))}))};_handleEditKeyPress=e=>{"Escape"===e.key&&(e.preventDefault(),this._cancelEdit()),"Enter"===e.key&&(e.preventDefault(),this._saveEdit(!0,!0))};_getTitle=e=>{const t=this._getNodeById(e);if(t){let e=t.label;return t.ellipsis&&(e+=Qe.Z.ellipsisString()),e}return""};_saveTitle=(e,t)=>{se.Z.menuContent.update(this.props.menu,e,{title:t},Lr.Z)};_isMenubarMenu=()=>"mac"===this.state.role||"horizontal"===this.state.role;_isContextMenu=()=>"context"===this.state.role;_getDragData=(e,t)=>"";_getMimeData=e=>{let t="",n=!1,i=!1;e.forEach((e=>{const s=this._getNodeById(e);s&&(this._isFolder(s)?(this._isDefaultTopFolder(s)&&(n=!0),t=""===t||t===AN?AN:IN):(this._isBookmarkContainer(s)&&(i=!0),t=""===t||t===wN?wN:IN))}));const s=[];return s.push({mimeType:t,payload:JSON.stringify(e)}),n&&s.push({mimeType:CN,payload:JSON.stringify(e)}),i&&s.push({mimeType:TN,payload:JSON.stringify(e)}),s};_setEventBehavior=(e,t)=>{this._getMimeData(t).forEach((t=>{e.dataTransfer.setData(t.mimeType,t.payload)}))};_getDropSupport=(e,t)=>{const n={available:!1,onto:!1,edge:"none"};return n.available=t.dataTransfer.types.some((e=>e===wN||e===AN||e===IN||e===yN||e===bN||e===SN)),n.available&&(n.onto=this._canDropOnto(e,t),n.edge=this._canDropOnEdge(e,t)?"both":"none"),n};_canDropOnto=(e,t)=>{if(this._isFolder(e)){if(this._isMac){if(t.dataTransfer.types.some((e=>e===TN)))return!1;if(t.dataTransfer.types.some((e=>e===AN))&&t.dataTransfer.types.some((e=>e===CN)))return!1}return!0}return!1};_canDropOnEdge=(e,t)=>e.parentId!==this.state.rootId||!this._isMenubarMenu()||(!this._isMac||0!==e.index)&&t.dataTransfer.types.some((e=>e===AN||e===IN||e===bN||e===SN));_getTargetSpec=(e,t)=>{const n={id:e.id,index:0,parentId:""};return this._isFolder(e)&&"on"===t?n.parentId=e.id:(n.parentId=e.parentId,n.index=e.index+("below"===t?1:0)),n};_canAddToTopLevel=e=>{let t=!0;return this._isMenubarMenu()&&e.forEach((e=>{"folder"!==e.type&&(t=!1)})),t};_handleMimeData=(e,t,n,i,s)=>{const o={type:""};if(this._hasCommandMimeType(i,o)){const n=JSON.parse(s(o.type)).map((e=>{if(!e.menu||e.menu===this.props.menu)return e.node})).filter(Boolean);return this._add(e,t,n,!0).then((()=>Promise.resolve([])))}if(this._hasMenuMimeType(i,o)){const i=s(o.type),a=JSON.parse(i);if(n){const n=[];return this._getContentTree(n,a),this._add(e,t,n,!1).then((()=>Promise.resolve([])))}return this._onMove(a,{parentId:e,index:t,pageIndex:void 0}).then((e=>{if(e&&e.length>0){const t=e[0];this.refTreeList.current?.expandToId(t),this.refTreeList.current?.setSelectedIds(e),this._setCutIds([])}return Promise.resolve([])}))}return Promise.resolve([])};_onDrop=(e,t,n)=>{const i="on"===n?t.id:t.parentId,s="on"===n?0:t.index+("below"===n?1:0),o=zi.ZP.isCopyModifierPressed(e);return this._handleMimeData(i,s,o,e.dataTransfer.types,(t=>e.dataTransfer.getData(t)))};addToNode=(e,t,n)=>{const i=this._isFolder(e)?e.id:e.parentId,s=this._isFolder(e)?0:e.index+1,o=JSON.parse(t).map((e=>{if(!e.menu||e.menu===this.props.menu)return e.node})).filter(Boolean);return this._add(i,s,o,n)};_add=(e,t,n,i,s)=>this._addAtPosition(e,t,n,i).then((e=>{e?.length>0&&(this.refTreeList.current?.expandToId(e[0]),this.refTreeList.current?.setSelectedIds(e))}));_addAtPosition=(e,t,n,i)=>{const s=(e,t,n)=>Promise.all(e.map((e=>new Promise((i=>{se.Z.menuContent.create(this.props.menu,t,n++,[e],((t,n)=>{e.children?s(e.children,n[0],0).then((()=>{i(n[0])})):i(n[0])}))}))))),o=i&&1===n.length&&n[0].action===Ge.Z.getOpenLinkName();return s(n,e,t).then((e=>(o&&ON.nextTick(this._onEdit),e)))};_supportsUpDownMove=(e,t)=>!!this._isValidDragSource(e)&&!(e.parentId===this.state.rootId&&t&&e.index<1);_onMove=(e,t)=>{const{parentId:n="",index:i=0}=t;return new Promise((t=>{se.Z.menuContent.move(this.props.menu,e,n,i,(n=>{t(e)}))}))};_onKeyPressed=e=>{"Escape"===e.key&&this._setCutIds([])};_setCutIds=e=>{se.Z.utilities.setSharedData({key:LN,value:e.length>0?e.join():""})};_onSharedDataChanged=(e,t)=>{if(e===LN){const e=t.length>0?t.split(","):[];e.length>0?this.context.addEventListener("keydown",this._onKeyPressed,!0):this.context.removeEventListener("keydown",this._onKeyPressed,!0),this.setState({cutIds:e})}};_cut=(e,t)=>{const n=t.filter(this._isValidForClipboard).map((e=>e.id));this._setCutIds(n);const i=e.clipboardData;if(i){i.setData("vivaldi/x-cut","true");this._getMimeData(n).forEach((e=>{i.setData(e.mimeType,e.payload)}))}(0,ms.ZP)(e)};_copy=(e,t)=>{const n=e.clipboardData;if(n){const e=t.filter(this._isValidForClipboard).map((e=>e.id));this._getMimeData(e).forEach((e=>{n.setData(e.mimeType,e.payload)}))}(0,ms.ZP)(e)};_getContentTree=(e,t)=>{t.forEach((t=>{const n=this._getNodeById(t);if(n){const t={id:"",action:n.commandName||"",type:n.type};if(t.action===Ge.Z.getOpenLinkName()&&(t.parameter=n.url,t.title=n.label),"folder"===t.type&&(t.title=n.label,t.children=[],n.children)){const e=n.children.map((e=>e.id)),i=[];this._getContentTree(i,e),t.children=i}e.push(t)}}))};_hasCommandMimeType=(e,t)=>{for(let n=0;n<e.length;n++){const i=e[n];switch(i){case yN:case bN:case SN:return t.type=i,!0}}return t.type="",!1};_hasMenuMimeType=(e,t)=>{for(let n=0;n<e.length;n++){const i=e[n];switch(i){case wN:case AN:case IN:return t.type=i,!0}}return t.type="",!1};_paste=(e,t)=>{const n=e.clipboardData;if(!n)return Promise.resolve([]);const i="true"===n.getData("vivaldi/x-cut");if(i&&0===this.state.cutIds.length)return Promise.resolve([]);const s=this._isFolder(t)?t.id:t.parentId,o=this._isFolder(t)?0:t.index+1;return this._handleMimeData(s,o,!i,n.types,(e=>n.getData(e))).then((e=>(i&&this._setCutIds([]),e)))};_onCreate=(e,t,n,i)=>i?new Promise((i=>{const s=[];let o=!1,a=!1;e.forEach(((e,t)=>{if(e.children)o=0===t,s.push({id:"",type:"folder",action:"",title:(0,B.Z)("command","New Folder")});else if(e.separator)s.push({id:"",type:"separator",action:""});else{a=0===t;const e=Ge.Z.getOpenLinkName();s.push({id:"",type:"command",action:e,title:Ge.Z.getCommandLabel(e)||"",parameter:Ge.Z.getCommandParameter(e)||""})}})),se.Z.menuContent.create(this.props.menu,t||"",n??-1,s,((e,t)=>{a&&ON.nextTick(this._onEdit);const n={items:t.map((e=>({id:e}))),props:{edit:o}};i(n)}))})):Promise.resolve({items:[]});_onRemove=e=>new Promise((t=>{se.Z.menuContent.remove(this.props.menu,e,(e=>{t(e)}))}));_handleExpandClick=(e,t)=>{const n=e.altKey;this.refTreeList.current?.toggleSelectedExpansion(t,n)};_getContextMenuItemProps=e=>ji.Z.isSection(this.props.menu)?{}:e?{showMoveUp:this.refTreeList.current?.canMoveUpDown(e,!0)??!1,showMoveDown:this.refTreeList.current?.canMoveUpDown(e,!1)??!1,showRename:this._validateForRename(e.id),showEdit:this._validateForEdit(e.id),showDelete:this._canDeleteNode(e),showNewItem:!0,showNewSeparator:!0,showNewFolder:!0,showCut:this._canDeleteNode(e),showCopy:!0,showPaste:!0}:{showNewSeparator:!this._isMenubarMenu(),showNewFolder:!0,showPaste:!0};_getContextMenuNewItemString=()=>(0,us.Z)("New Link");_getNodeMenuItems=e=>[{handler:()=>this._reset(e.id),isVisible:()=>this._isFolder(e)&&!e.custom,...(0,us.Z)("Restore Default Folder")},{isVisible:()=>this._isContainer(e)&&!this._isBookmarkContainer(e),...(0,us.Z)("Show as Subfolder"),type:"checkbox",checked:"folder"===e.container?.mode,handler:()=>this._setContainerMode(e.id,"folder"===e.container?.mode?"inline":"folder")},{isVisible:()=>this._isBookmarkContainer(e),...(0,us.Z)("Show 'Add Active Tab'"),items:[{type:"radio",checked:"above"===e.container?.edge,radiogroup:2,handler:this._setContainerEdge.bind(this,e.id,"above"),...(0,us.Z)("Above List")},{type:"radio",checked:"below"===e.container?.edge,radiogroup:2,handler:this._setContainerEdge.bind(this,e.id,"below"),...(0,us.Z)("Below List")},{type:"separator",label:"",labelEnglish:""},{type:"radio",checked:"off"===e.container?.edge,handler:this._setContainerEdge.bind(this,e.id,"off"),radiogroup:2,...(0,us.Z)("radio","Hide")}]},{isVisible:()=>!0,...(0,us.Z)("Show Shortcuts in Menu"),type:"checkbox",isEnabled:()=>C.Z.get(I.kKeyboardShortcutsEnable),checked:!1!==e.showshortcut,handler:()=>this._setShowShorcut(e.id,!(!1!==e.showshortcut))}];_getContextMenuItems=e=>e?this._getNodeMenuItems(e):[];rowComponent=e=>{const{inlineEditText:t,node:n,onBlur:i,onChange:s,onFocus:o,level:a}=e,r=a*ks+"px",l=(a+1)*ks+"px";if(this._isSeparator(n))return xN("label",{},"0",xN("hr",{style:{marginLeft:l},className:"separator"}));let d=n.label;n.ellipsis&&(d+=Qe.Z.ellipsisString()),"container"===n.type&&(n.settingsLabel?d="inline"===n.container?.mode||this._isBookmarkContainer(n)?n.settingsLabel:(0,B.Z)("$1 (as Subfolder)",[n.settingsLabel]):"folder"===n.container?.mode&&(d=(0,B.Z)("$1 (as Subfolder)",[d])));const c=this._isFolder(n)&&this._hasChildren(n);let u=C.Z.get(I.kKeyboardShortcutsEnable);n.shortcuts?.length>0&&1===n.shortcuts[0].length&&u&&(u=Qe.Z.hasBrowserFeature(n)?C.Z.get(I.kKeyboardShortcutsEnableSingleKey):C.Z.get(I.kKeyboardShortcutsEnableSingleKeyForMail));const p=!1!==n.showshortcut,h=this._isMenubarMenu()&&this._isMac?void 0:this.state.darkBackground?n.iconPNGWhite:n.iconPNG;return xN("label",{style:c?null:{marginLeft:l}},"0",c&&xN("span",{className:"expand-icon",style:{marginLeft:r},onMouseDown:ms.ZP,onMouseUp:e=>this._handleExpandClick(e,n.id),dangerouslySetInnerHTML:{__html:Wi.nfH}}),void 0!==t&&xN("input",{type:"text",value:t,onChange:s,onFocus:o,onBlur:i,autoFocus:!0}),h&&xN("img",{src:"data:image/png; base64, "+h}),void 0===t&&xN("span",{className:"title"},void 0,d),n.shortcuts?.length>0&&!p&&u&&xN("span",{style:{textDecoration:"line-through"},className:"nickname"},void 0,ZN(n.shortcuts[0])),n.shortcuts?.length>0&&p&&u&&xN("span",{className:"nickname"},void 0,ZN(n.shortcuts[0])))};render(){return this.state?this.state.editId?xN("div",{onKeyDown:this._handleEditKeyPress},void 0,xN("div",{className:"UrlField"},void 0,xN("input",{type:"text",placeholder:(0,B.Z)("Title"),value:this.state.editTitle,onChange:this._onTitleChanged,onBlur:this._onEditBlur,onFocus:this._onEditFocus})),this._useOmni?xN(ib,{placeholder:(0,B.Z)("Address"),title:(0,B.Z)("Enter webpage address"),pageId:this._id,pageContext:this._pageContext,autocompletionEnabled:!0,typedHistoryEnabled:!1,autoFocus:!1,displayUrl:this.state.url,typedUrl:this.state.editUrl,handleDrop:!0,onBlur:this._onEditBlur,onFocus:this._onEditFocus,inputId:this._id,autoFocus:!0}):xN(ZS,{placeholder:(0,B.Z)("Address"),title:(0,B.Z)("Enter webpage address"),pageId:this._id,pageContext:this._pageContext,autocompletionEnabled:!0,typedHistoryEnabled:!1,autoFocus:!1,displayUrl:this.state.url,typedUrl:this.state.editUrl,handleDrop:!0,onBlur:this._onEditBlur,onFocus:this._onEditFocus,inputId:this._id,autoFocus:!0})):(0,ss.jsxs)(ss.Fragment,{children:[(0,ss.jsx)(Ps,{ref:this.refTreeList,rowComponent:this.rowComponent,nodes:this.state.menuItems,rootId:this.state.rootId,cutIds:this.state.cutIds,enableDragAndDrop:!ji.Z.isSection(this.props.menu),validateForDrag:this._validateForDrag,validateForDeletion:this._validateForDeletion,isValidDragSource:this._isValidDragSource,getDragData:this._getDragData,setCustomEventBehavior:this._setEventBehavior,getDropSupport:this._getDropSupport,onDrop:this._onDrop,onMove:this._onMove,onCreate:this._onCreate,onEdit:this._onEdit,delete:this._onRemove,onCut:this._cut,onCopy:this._copy,onPaste:this._paste,hasChildren:this._hasChildren,isFolder:this._isFolder,appendContextItems:!0,getContextMenuItems:this._getContextMenuItems,getContextMenuItemProps:this._getContextMenuItemProps,getContextMenuNewItemString:this._getContextMenuNewItemString,getTitle:this._getTitle,saveTitle:this._saveTitle,supportsInlineEdit:!0,supportsUpDownMove:this._supportsUpDownMove,isValidToEdit:this._validateForRename}),xN("div",{className:"setting-single"},void 0,xN("input",{type:"button",onClick:this.props.confirmReset,value:(0,B.Z)("Restore Default Menu")}))]}):null}}const BN=RN;var FN;function WN(e,t,n,i){FN||(FN="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:FN,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const UN={width:400,minWidth:"unset"};class VN extends Li.Component{refMenuTree=Li.createRef();constructor(e){super(e);const t="top"===this.props.menuDisplay?"menubar":"vivaldi";this.state={menu:t,confirmation:!1}}_onMenuChange=e=>{this.setState({menu:e.target.value})};_handleResetMenu=()=>{se.Z.menuContent.reset(this.state.menu,ji.Z.hasName(this.state.menu),void 0,(()=>{})),this.closeConfirmation()};_canAddToTree=()=>Boolean(this.refMenuTree.current?.getSelectedItem());_addToTree=(e,t)=>{const n=this.refMenuTree.current,i=n?.getSelectedItem();n&&i&&n.addToNode(i,t,!0)};confirmReset=()=>this.setState({confirmation:!0});closeConfirmation=()=>this.setState({confirmation:!1});getMenuName=e=>{if(e||(e=this.state.menu),ji.Z.hasName(e))return ji.Z.getName(e);switch(e){case"vivaldi":return(0,B.Z)("Vivaldi Button Menu");case"menubar":return(0,B.Z)("Horizontal Menu");case"mac":return(0,B.Z)("Application Menu");default:return e}};renderModal=()=>{const e=this.getMenuName();return WN(ra.Z,{style:UN,onRequestClose:this.closeConfirmation,className:"anchor slide",title:(0,B.Z)("Reset $1?",[e])},void 0,WN("div",{className:"dialog-content"},void 0,WN("p",{},void 0,(0,B.Z)("$1 will be reset to its default state.",[e]))),WN("footer",{className:"dialog-footer"},void 0,WN("input",{type:"button",className:"primary",onClick:this._handleResetMenu,value:(0,B.Z)("Reset to Default"),autoFocus:!0}),WN("input",{type:"button",onClick:this.closeConfirmation,value:(0,B.Z)("Cancel")})))};_getOptionItems=()=>[...["vivaldi","menubar"].map((e=>({key:e,indent:1,name:this.getMenuName(e)}))),...ji.Z.getSettingsList()];render(){const e=this._getOptionItems().map((e=>0===e.indent?WN("optgroup",{label:e.name},e.key):WN("option",{value:e.key},e.key," ".repeat(2*e.indent),e.name)));return WN(iA.Z,{filter:this.props.filter},void 0,this.state.confirmation&&this.renderModal(),WN("div",{className:"setting-single pad-top"},void 0,WN("h3",{},void 0,(0,B.Z)("Menu Customization")),WN(ta.Z,{className:"menu-list",value:this.state.menu,onChange:this._onMenuChange},void 0,e)),WN("div",{className:"menu-lists"},void 0,WN("div",{className:"setting-single menu-commands"},void 0,WN("h3",{},void 0,(0,B.Z)("Content"))),WN("div",{className:"setting-single menu-commands"},void 0,WN("h3",{},void 0,(0,B.Z)("Commands"))),WN("div",{className:"setting-single menu-items"},void 0,(0,ss.jsx)(BN,{ref:this.refMenuTree,menu:this.state.menu,confirmReset:this.confirmReset,filter:this.props.filter})),WN("div",{className:"setting-single menu-commands"},void 0,WN(DN,{canAddToTree:this._canAddToTree,addToTree:this._addToTree,menu:this.state.menu,filter:this.props.filter}))))}}const HN=VN;var GN;function $N(e,t,n,i){GN||(GN="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:GN,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const KN=[I.kMenuDisplay,I.kMenuIconType],zN=w.Z.getEventHandler;var jN=$N("input",{type:"radio",value:"vivaldi"}),YN=$N("input",{type:"radio",value:"top"}),XN=$N("input",{type:"radio",value:"icon"}),QN=$N("input",{type:"radio",value:"burger"});function qN(e){const t=(0,Ya.Z)(KN);return $N(tN.Z,{categoryTitle:(0,B.Z)("Menu"),filter:e.filter},void 0,$N("div",{className:"setting-group"},void 0,$N("h3",{},void 0,(0,B.Z)("title","Menu Position")),$N(ja.Z,{name:"menuPosition",value:t[I.kMenuDisplay],onChange:zN(I.kMenuDisplay),className:"group"},void 0,$N("div",{className:"setting-single"},void 0,$N("label",{},void 0,jN,$N("span",{},void 0,(0,B.Z)("menu","Vivaldi Button")))),$N("div",{className:"setting-single"},void 0,$N("label",{},void 0,YN,$N("span",{},void 0,(0,B.Z)("menu","Horizontal")))))),$N("div",{className:"setting-group"},void 0,$N("h3",{},void 0,(0,B.Z)("Menu Icon Style")),$N(ja.Z,{name:"menuStyle",value:t[I.kMenuIconType],onChange:zN(I.kMenuIconType),className:"group"},void 0,$N("div",{className:"setting-single"},void 0,$N("label",{},void 0,XN,$N("span",{},void 0,(0,B.Z)("Vivaldi Icon")))),$N("div",{className:"setting-single"},void 0,$N("label",{},void 0,QN,$N("span",{},void 0,(0,B.Z)("Menu Icon")))))),$N(HN,{menuDisplay:"vivaldi",filter:e.filter}))}const JN=Li.memo(qN);var eP;function tP(e,t,n,i){eP||(eP="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:eP,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const nP=[...KN,...fN.FI],iP=async()=>(await se.Z.menuContent.resetAll(!1),await se.Z.menuContent.resetAll(!0),Promise.resolve());function sP({filter:e,category:t}){const n=sN({filter:e,prefPaths:nP,name:t.title,onReset:iP});return(0,ss.jsxs)(ss.Fragment,{children:[tP("section",{className:"setting-section"},void 0,tP(fN.ZP,{filter:e})),tP("section",{className:"setting-section"},void 0,tP(JN,{filter:e})),n]})}const oP=Li.memo(sP);var aP;function rP(e,t,n,i){aP||(aP="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:aP,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const lP=[I.kWelcomeReadPages];class dP extends Li.Component{resetSeen=()=>{w.Z.set(I.kWelcomeReadPages,[])};render(){const e=this.props.prefValues[I.kWelcomeReadPages].length>0;return rP(iA.Z,{filter:this.props.filter},void 0,rP("div",{className:"setting-group"},void 0,rP("h3",{},void 0,(0,B.Z)("Welcome Page")),rP("div",{className:"setting-single"},void 0,rP("label",{},void 0,rP("input",{type:"button",disabled:!e,value:(0,B.Z)("Reset Welcome Page"),onClick:this.resetSeen})))))}}const cP=(0,Bu.Z)(dP,lP);var uP;function pP(e,t,n,i){uP||(uP="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:uP,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const hP=[I.kBiscuitLoadBookmarks,I.kBiscuitLogLevel,I.kBiscuitLogRockerGestures,I.kBiscuitVersion,I.kStartpageSpeedDialTrackerSuggestionShow,I.kBiscuitLogComponents,I.kBiscuitPromote],gP=w.Z.getEventHandler;var mP=pP("h2",{},void 0,"Biscuit Area 🐶"),fP=pP("h3",{},void 0,"Biscuit Mode"),vP=pP("span",{},void 0,"Show Browser Version on Status Bar"),yP=pP("span",{},void 0,"Upgrade Bookmarks Every Startup"),bP=pP("span",{},void 0,"Show “Support Us” Search Dialog"),SP=pP("span",{},void 0,"Log Rocker Gestures"),wP=pP("span",{},void 0,"Show Promote Button"),CP=pP("h3",{},void 0,"Logging"),AP=pP("div",{},void 0,"Log Level"),IP=pP("option",{value:"debug"},void 0,"Debug"),TP=pP("option",{value:"info"},void 0,"Info"),ZP=pP("option",{value:"warn"},void 0,"Warn"),EP=pP("option",{value:"error"},void 0,"Error"),kP=pP("option",{value:"none"},void 0,"None"),_P=pP("h3",{},void 0,"Log Components"),NP=pP("h3",{},void 0,"Show Context Dialog"),PP=pP("option",{value:"EnableMailContextDialog"},void 0,"Mail"),DP=pP("option",{value:"EnableCalendarContextDialog"},void 0,"Calendar"),MP=pP("option",{value:"EnableSyncContextDialog"},void 0,"Sync"),OP=pP("option",{value:"CreateWorkspaceContextDialog"},void 0,"Workspace"),xP=pP("h3",{},void 0,"Reset All Context Dialogs"),LP=pP("div",{className:"setting-single"},void 0,pP("input",{type:"button",onClick:function(){Ze.resetAll()},value:"Reset All Context Dialogs"})),RP=pP(cP,{filter:""});function BP(e){const t=(0,Ya.Z)(hP),[n,i]=Li.useState("EnableMailContextDialog");return"🐶"!==e.filter&&"biscuit"!==e.filter?null:(0,ss.jsxs)(ss.Fragment,{children:[mP,pP("div",{className:"setting-group-double"},void 0,fP,pP("div",{className:"setting-single"},void 0,pP("label",{},void 0,pP("input",{type:"checkbox",checked:t[I.kBiscuitVersion],onChange:gP(I.kBiscuitVersion)}),vP)),pP("div",{className:"setting-single"},void 0,pP("label",{},void 0,pP("input",{type:"checkbox",checked:t[I.kBiscuitLoadBookmarks],onChange:gP(I.kBiscuitLoadBookmarks)}),yP)),pP("div",{className:"setting-single"},void 0,pP("label",{},void 0,pP("input",{type:"checkbox",checked:t[I.kStartpageSpeedDialTrackerSuggestionShow],onChange:gP(I.kStartpageSpeedDialTrackerSuggestionShow)}),bP)),pP("div",{className:"setting-single"},void 0,pP("label",{},void 0,pP("input",{type:"checkbox",checked:t[I.kBiscuitLogRockerGestures],onChange:gP(I.kBiscuitLogRockerGestures)}),SP)),pP("div",{className:"setting-single"},void 0,pP("label",{},void 0,pP("input",{type:"checkbox",checked:t[I.kBiscuitPromote],onChange:gP(I.kBiscuitPromote)}),wP)),CP,pP("div",{className:"setting-single"},void 0,pP("label",{style:{alignItems:"center"}},void 0,AP,pP(ta.Z,{value:t[I.kBiscuitLogLevel],onChange:gP(I.kBiscuitLogLevel)},void 0,IP,TP,ZP,EP,kP))),_P,pP("div",{className:"setting-single"},void 0,Object.entries(t[I.kBiscuitLogComponents]).map((e=>{const[n,i]=e;return pP("div",{className:"setting-single"},n,pP("label",{},void 0,pP("input",{type:"checkbox",checked:i,onChange:e=>{const i={...t[I.kBiscuitLogComponents],[n]:e.target.checked};w.Z.set(I.kBiscuitLogComponents,i)}}),pP("span",{},void 0,n)))}))),NP,pP("div",{className:"setting-single"},void 0,pP(ta.Z,{value:n,onChange:e=>{ve(e.target.value)&&i(e.target.value)}},void 0,PP,DP,MP,OP),pP("input",{type:"button",onClick:()=>Ze.show(n,!0),value:"Trigger Context Dialog"})),xP,LP),RP]})}const FP=Li.memo(BP);var WP;function UP(e,t,n,i){WP||(WP="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:WP,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const VP=[I.kBookmarksBarDisplay,I.kBookmarksBarPosition,I.kBookmarksBarVisible],HP=w.Z.getEventHandler;var GP=UP("input",{type:"radio",value:"top"}),$P=UP("input",{type:"radio",value:"bottom"}),KP=UP("input",{type:"radio",value:"default"}),zP=UP("input",{type:"radio",value:"text"}),jP=UP("input",{type:"radio",value:"icon"}),YP=UP("input",{type:"radio",value:"iconexceptfolders"});function XP(e){const t=(0,Ya.Z)(VP);return UP(tN.Z,{categoryTitle:(0,B.Z)("Bookmark Bar"),filter:e.filter},void 0,UP("div",{className:"setting-group unlimited"},void 0,UP("div",{className:"setting-single"},void 0,UP("label",{},void 0,UP("input",{type:"checkbox",checked:t[I.kBookmarksBarVisible],onChange:HP(I.kBookmarksBarVisible)}),UP("span",{},void 0,(0,B.Z)("Show Bookmark Bar"))))),UP("div",{className:"setting-group"},void 0,UP("h3",{},void 0,(0,B.Z)("Select Bookmark Bar Folder")),UP("div",{className:"setting-single"},void 0,UP(oa,{onChange:e=>{ee.Z.setBookmarkBarFolder(e.target.value)}}))),UP("div",{className:"setting-group"},void 0,UP("h3",{},void 0,(0,B.Z)("Bookmark Bar Position")),UP(ja.Z,{name:"bookmark-position",value:t[I.kBookmarksBarPosition],onChange:HP(I.kBookmarksBarPosition)},void 0,UP("div",{className:"setting-single"},void 0,UP("label",{},void 0,GP,UP("span",{},void 0,(0,B.Z)("Top")))),UP("div",{className:"setting-single"},void 0,UP("label",{},void 0,$P,UP("span",{},void 0,(0,B.Z)("Bottom")))))),UP("div",{className:"setting-group"},void 0,UP("h3",{},void 0,(0,B.Z)("Bookmark Bar Display")),UP(ja.Z,{name:"bookmark_bar_display",value:t[I.kBookmarksBarDisplay],onChange:HP(I.kBookmarksBarDisplay)},void 0,UP("div",{className:"setting-single"},void 0,UP("label",{},void 0,KP,UP("span",{},void 0,(0,B.Z)("Text and Icon")))),UP("div",{className:"setting-single"},void 0,UP("label",{},void 0,zP,UP("span",{},void 0,(0,B.Z)("radio","Text Only")))),UP("div",{className:"setting-single"},void 0,UP("label",{},void 0,jP,UP("span",{},void 0,(0,B.Z)("Icon Only")))),UP("div",{className:"setting-single"},void 0,UP("label",{},void 0,YP,UP("span",{},void 0,(0,B.Z)("Bookmark Icon Only")))))))}const QP=Li.memo(XP);var qP;function JP(e,t,n,i){qP||(qP="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:qP,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const eD=[I.kBookmarksConfirmAdding,I.kBookmarksConfirmOpening,I.kBookmarksConfirmOpeningThreshold,I.kBookmarksFetchPageMetadata,I.kBookmarksOpenInNewTab,I.kBookmarksSingleClickOpens,I.kBookmarksUnderlineMenuLetter],tD=w.Z.getEventHandler;function nD(e){const t=(0,Ya.Z)(eD);return JP(tN.Z,{categoryTitle:(0,B.Z)("Bookmarks"),filter:e.filter},void 0,JP("div",{className:"setting-group unlimited"},void 0,JP("div",{className:"setting-single"},void 0,JP("label",{},void 0,JP("input",{type:"checkbox",checked:t[I.kBookmarksOpenInNewTab],onChange:tD(I.kBookmarksOpenInNewTab)}),JP("span",{},void 0,(0,B.Z)("Open Bookmarks in New Tab")))),JP("div",{className:"setting-single"},void 0,JP("label",{},void 0,JP("input",{type:"checkbox",checked:t[I.kBookmarksSingleClickOpens],onChange:tD(I.kBookmarksSingleClickOpens)}),JP("span",{},void 0,(0,B.Z)("Open Bookmark Panel Items with Single Click")))),JP("div",{className:"setting-single"},void 0,JP("label",{},void 0,JP("input",{type:"checkbox",checked:t[I.kBookmarksUnderlineMenuLetter],onChange:tD(I.kBookmarksUnderlineMenuLetter)}),JP("span",{},void 0,(0,B.Z)("Use “&” in Title to Underline Next Letter in Menus")))),JP("div",{className:"setting-single max-bookmarks"},void 0,JP("label",{},void 0,JP("input",{type:"checkbox",checked:t[I.kBookmarksConfirmOpening],onChange:tD(I.kBookmarksConfirmOpening)}),JP("span",{},void 0,(0,B.Z)("Confirm Opening Bookmarks over Maximum of"))),JP("input",{type:"number",size:"2",disabled:!t[I.kBookmarksConfirmOpening],value:t[I.kBookmarksConfirmOpeningThreshold],onChange:tD(I.kBookmarksConfirmOpeningThreshold),min:1,max:99})),JP("div",{className:"setting-single"},void 0,JP(k_.C,{text:(0,B.Z)("Fetch Bookmark Data from Page Metadata")},void 0,JP("input",{type:"checkbox",checked:t[I.kBookmarksFetchPageMetadata],onChange:tD(I.kBookmarksFetchPageMetadata)}))),JP("div",{className:"setting-single"},void 0,JP(k_.C,{text:(0,B.Z)("Always Open Bookmark Dialog")},void 0,JP("input",{type:"checkbox",checked:t[I.kBookmarksConfirmAdding],onChange:tD(I.kBookmarksConfirmAdding)})))))}const iD=Li.memo(nD);var sD;function oD(e,t,n,i){sD||(sD="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:sD,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const aD=[...VP,...eD];function rD({filter:e,category:t}){const n=sN({filter:e,prefPaths:aD,name:t.title});return(0,ss.jsxs)(ss.Fragment,{children:[oD("section",{className:"setting-section"},void 0,oD(iD,{filter:e}),oD(QP,{filter:e})),n]})}const lD=Li.memo(rD);var dD;function cD(e,t,n,i){dD||(dD="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:dD,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const uD=w.Z.getEventHandler,pD=[I.kMailIsTurnedOff];function hD(e){const t=(0,Ya.Z)(pD);return cD(tN.Z,{categoryTitle:e.categoryTitle||(0,B.Z)("Productivity Features"),filter:e.filter,"data-anchor":"features"},void 0,cD(iA.Z,{filter:e.filter},void 0,cD("div",{className:"setting-group unlimited"},void 0,cD("div",{className:"setting-single"},void 0,e.inform&&t[I.kMailIsTurnedOff]&&cD("h3",{},void 0,(0,B.Z)("Mail, Calendar and Feeds are Turned Off")),cD("label",{},void 0,cD("input",{type:"checkbox",checked:!t[I.kMailIsTurnedOff],onChange:uD(I.kMailIsTurnedOff,"inverse")}),cD("span",{},void 0,(0,B.Z)("Enable Mail, Calendar and Feeds")))))))}const gD=Li.memo(hD);var mD,fD=n(25201),vD=n(88545);function yD(e,t,n,i){mD||(mD="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:mD,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const{isCalDAV:bD,isOAuthProvider:SD}=Zl.ZP,{UNKNOWN:wD,VERIFYING:CD,OK:AD,ERROR:ID}=me.LB;class TD extends Li.Component{constructor(e){super(e),this.state={status:wD,statusText:"",password:"",passwordChanged:!1,name:e.account.name,username:e.account.username,url:e.account.url,refreshing:!1}}componentDidMount=()=>{const{url:e,username:t}=this.state;e&&t&&(0,fD.Ij)({url:e,username:t}).then((e=>{e.found&&this.setState({password:e.password})}))};probeAccounts=async()=>{const{account:e}=this.props,{account_type:t}=e,{password:n}=this.state;let i={foundService:!1,statusMessage:"",calendars:[],eventCount:0};if(this.logStatus((0,B.Z)("Verifying..."),CD),"ical"===t){i=await Hl.Z.probeWebCalendar(this.getAccount(),n);const{foundService:e,eventCount:t}=i;if(e)return this.logStatus((0,B.Z)("Connected to Web Calendar. Found $1 Event(s)",[t]),AD),e}else if(SD(t))i=await(0,vD.P)(this.getAccount(),n);else{if(!this.state.password)return this.logStatus((0,B.Z)("Password Missing..."),ID),!1;i=await(0,vD.P)(this.getAccount(),n)}return i.foundService?(this.logStatus((0,B.Z)("Connected to CalDAV. Found $1 Calendar(s)",[i.calendars.length]),AD),Fp.Z.resetStatus(this.props.account.name)):this.logStatus((0,B.Z)("Not connected. $1",[i.statusMessage||""]),ID),i.foundService};savePasswordIfNeeded=e=>{const{account_type:t}=this.props.account,{username:n,password:i,url:s}=this.state,{urlValid:o}=se.Z.utilities.isUrlValid(s);if(e&&(0,fD.QN)({url:s,username:n}),o){if(["caldav","vivaldi"].includes(t)||"ical"===t&&n.trim())try{this.logStatus("",wD),(0,fD.vW)({url:s,username:n},i)}catch(e){this.logStatus(e.message,ID)}}else this.logStatus((0,B.Z)("Invalid URL"),CD)};isAccountChanged=()=>this.state.name!==this.props.account.name||this.state.username!==this.props.account.username||this.state.url!==this.props.account.url||this.state.passwordChanged;onChangeCredentials=e=>{const t=e.target.value;this.setState({password:t,passwordChanged:!0,status:wD},(()=>this.savePasswordIfNeeded(!1)))};getAccount=()=>({id:this.props.account.id,name:this.state.name,username:this.state.username,url:this.state.url,account_type:this.props.account.account_type});logStatus=(e,t)=>{this.setState({status:t,statusText:e})};saveAccount=async()=>{let e=!0;const{account_type:t}=this.props.account;"local"!==t&&(e=await this.probeAccounts()),this.setState({passwordChanged:!1},(()=>{e&&this.props.saveAccount(this.getAccount())}))};changeName=e=>{const t=e.target.value;this.setState({name:t})};changeUrl=e=>{const t=e.target.value;t!==this.state.url&&this.setState({url:t},(()=>this.savePasswordIfNeeded(!0)))};changeUsername=e=>{const t=e.target.value;if(t!==this.state.username){const{url:e,username:n}=this.state;(0,fD.QN)({url:e,username:n}),this.setState({username:t},(()=>this.savePasswordIfNeeded(!0)))}};render(){const{name:e,url:t,account_type:n,username:i}=this.getAccount(),{password:s}=this.state,o=this.state.status===ID?"error":this.state.status===AD?"success":"info",a=["caldav","ical"].includes(n)||"vivaldi"===n&&s;return yD("form",{className:"detail",onSubmit:this.saveAccount},void 0,yD("div",{className:"detail-content"},void 0,yD("div",{className:"setting-group"},void 0,yD("div",{className:"setting-single"},void 0,yD(Vl.Z,{type:"text",onChange:this.changeName,label:this.props.searchableStrings["Display Name"],value:e}))),"local"!==n&&yD("div",{className:"setting-group"},void 0,yD("div",{className:"setting-single"},void 0,yD(Vl.Z,{type:"text",onChange:this.changeUrl,label:this.props.searchableStrings.URL,value:t}))),(bD(n)||"ical"===n)&&yD("div",{className:"setting-group"},void 0,yD("div",{className:"setting-single"},void 0,yD(Vl.Z,{type:"text",onChange:this.changeUsername,name:"username",label:this.props.searchableStrings.Username,value:i}))),a&&yD("div",{className:"setting-group"},void 0,yD("div",{className:"setting-single"},void 0,yD(Vl.Z,{type:"password",onChange:this.onChangeCredentials,name:"password",label:this.props.searchableStrings.Password,value:s}))),this.state.statusText&&yD("div",{className:"setting-group-double"},void 0,yD(To,{type:o},void 0,this.state.statusText))),yD("div",{className:"detail-toolbar"},void 0,yD("input",{type:"submit",value:(0,B.Z)("Save"),disabled:!this.isAccountChanged()}),"local"!==n&&yD("input",{type:"button",onClick:this.probeAccounts,value:(0,B.Z)("Test")})))}}const ZD=TD;var ED;function kD(e,t,n,i){ED||(ED="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:ED,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const{startDeletingAccount:_D}=kl.Z,{prepareForDeleteAccount:ND}=Fp.Z;const PD=function(e){const[t,n]=Li.useState(""),[i,s]=Li.useState([]),[o,a]=Li.useState(!1),{item:r,onClose:l,onDeleteInProgress:d}=e,c=async e=>{try{await _D(e)}catch(e){s(gc([e]))}finally{n(""),d(!1)}},u=t===r.id,p="local"===r?.account_type;return kD("div",{},void 0,kD("header",{className:"dialog-header"},void 0,kD("h1",{className:"dialog-title"},void 0,(0,B.Z)("Are you sure you want to remove the account ‘$1’ and its events?",[r.name]))),kD("div",{className:"dialog-content"},void 0,"local"===r.account_type&&kD("p",{className:"faded-text"},void 0,(0,B.Z)("This will permanently delete your local calendars and associated events. It can not be undone.")),"local"!==r.account_type&&kD("p",{className:"faded-text"},void 0,(0,B.Z)("This will not delete any data on the remote server. You can set it up again if you later want to use it in Vivaldi.")),p&&kD("label",{},void 0,kD("input",{type:"checkbox",checked:o,onChange:e=>a(e.target.checked)}),(0,B.Z)("I understand that this will delete data permanently")),i&&kD(To,{type:"error"},void 0,i)),kD("footer",{className:"dialog-footer"},void 0,kD("input",{type:"button",className:"danger",disabled:u||p&&!o,onClick:async()=>{d(!0),n(r.id);try{"local"===r.account_type?c(r.id):await ND({accountId:r.id,onRemoval:c})}catch(e){s(gc([e]))}finally{n(""),d(!1)}},value:u?(0,B.Z)("Removing Account"):(0,B.Z)("verb","Remove"),autoFocus:!0}),kD("input",{type:"button",onClick:l,disabled:u,value:(0,B.Z)("Cancel")})))};var DD=n(74487);const MD=function(e){return Li.forwardRef((function(t,n){const i=(0,DD.Z)(El.Z);return(0,ss.jsx)(e,{...t,ref:n,...i})}))};var OD;function xD(e,t,n,i){OD||(OD="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:OD,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const{createLocalAccountAndCalendar:LD}=kl.Z,{ensureAccountType:RD,isCalDAV:BD,ensureHttpsForWebcal:FD}=Zl.ZP,{UNKNOWN:WD,VERIFYING:UD,OK:VD,ERROR:HD}=me.LB;function GD(e){switch(e){case"vivaldi":return(0,B.Z)("user@vivaldi.net");case"google":return(0,B.Z)("user@gmail.com");case"fastmail":return(0,B.Z)("user@fastmail.com");case"icloud":return(0,B.Z)("user@icloud.com");default:return""}}function $D(e,t="vivaldi"){return{status:WD,statusText:"",name:Zl.ZP.suggestNewCalendarDisplayName(t),url:"",account_type:t,username:"",password:"",step:"accountType",initial:e,requestPending:!1,calendars:[]}}var KD=xD("img",{src:"/resources/vivaldi_calendar_default.png",alt:"",width:"64",height:"64"}),zD=xD("span",{className:"info"},void 0,"App specific password is required to connect to iCloud calendars.");class jD extends Li.Component{static contextType=ts.Z;state=$D(!0,this.props.onboarding?"local":"vivaldi");account=null;changeType=e=>{const t="icloud"===e?(0,me.Hv)():"",n="icloud"===e?"icloud":RD(e),i=Zl.ZP.suggestNewCalendarDisplayName(n);n!==this.state.account_type?this.setState({name:i,account_type:n,url:t,username:"",password:""}):this.setState({name:i,account_type:n})};handleChange=e=>{const{target:{name:t,value:n}}=e;this.setState({[t]:n})};toggleCalendarState=(e,t,n)=>{this.setState((i=>{const s=[...i.calendars];return s[t]={...s[t],[n]:e.target.checked},{calendars:s}}))};selectAccountType=()=>{"local"===this.state.account_type?this.createAccount():this.setState({step:"accountInfo"})};goBack=()=>{"accountInfo"===this.state.step?this.setState({step:"accountType",statusText:"",status:WD}):"accountSummary"===this.state.step&&(this.account=null,this.setState({step:"accountInfo",calendars:[]}))};addAnother=()=>{this.account=null,this.setState($D(!1))};createAccount=async()=>{const{name:e,account_type:t,username:n}=this.state;let i;if(BD(RD(t)))i=await this.createCalDAVAccount();else if("ical"===t)i=await this.createWebCalendar();else if("local"===t)try{({account:i}=await LD({name:e,url:"",account_type:t,username:n},null)),this.setState({step:"done"})}catch(e){this.log((0,B.Z)("Error creating local calendar.")+String(e?.message||e),HD)}i&&(this.account=i)};log=(e,t,n)=>{const i=n?{username:n.username,name:n.name}:{};this.setState({...i,statusText:e,status:t})};createWebCalendar=async()=>{this.log((0,B.Z)("Verifying..."),UD),this.setState({requestPending:!0});const{name:e,account_type:t,username:n,password:i}=this.state;let{url:s}=this.state;s.startsWith("webcal")&&(s=FD(s),this.setState({url:s}));const o={id:"",name:e,url:s,account_type:RD(t),username:n,interval:me.jC},{foundService:a,statusMessage:r,eventCount:l,calendars:d}=await Hl.Z.probeWebCalendar(o,i);return!a&&r?(this.log(r,HD),this.setState({requestPending:!1})):(this.log((0,B.Z)("Connected to Web Calendar, found $1 event(s).",[l]),VD),this.setState({step:"accountSummary",calendars:d,requestPending:!1})),o};createCalDAVAccount=async()=>{this.log((0,B.Z)("Verifying..."),UD),this.setState({requestPending:!0});const{name:e,url:t,account_type:n,username:i,password:s}=this.state;try{const{account:o,calendars:a}=await Fp.Z.getCalDAVAccountDetails({name:e,url:t,account_type:RD(n),username:i,password:s},this.log);if(this.state.status!==HD){for(const e of a)e.active=!0;this.account=o,this.setState({step:"accountSummary",calendars:a,requestPending:!1})}else this.setState({requestPending:!1})}catch(e){this.setState({requestPending:!1})}};saveAccount=async()=>{const e=this.account;if(e&&"local"!==e.account_type){"icloud"===e.account_type&&(e.account_type="caldav"),this.setState({requestPending:!0});try{await Fp.Z.saveCalendarAccount({account:e,calendars:this.state.calendars,password:this.state.password},this.log),this.setState({requestPending:!0,step:"done"})}catch(e){this.setState({requestPending:!1}),this.log(e.message,HD)}}};render(){const{name:e,url:t,account_type:n,username:i}=this.state,{password:s}=this.state,o=["vivaldi","fastmail","google","icloud","caldav","ical"];(!kl.Z.getLocalAccount()||this.props.onboarding&&this.state.initial)&&o.unshift("local");const a=this.state.status===HD?"error":this.state.status===VD?"success":"info";let r;if("accountInfo"===this.state.step)switch(this.state.account_type){case"vivaldi":r=(0,B.Z)("Vivaldi.net account, OK - now enter your login details below and let us fetch your calendars.");break;case"icloud":r=(0,B.Z)("iCloud account, OK - now enter your username and app specific password below and let us fetch your calendars.");break;case"caldav":r=(0,B.Z)("CalDAV account, OK - now enter the server URL and your login details below and let us fetch your calendars.");break;case"google":r=(0,B.Z)("Google account, OK - now enter your username below and then log in using the google dialog shown.");break;case"ical":r=(0,B.Z)("Web calendar, OK - now enter the calendar URL below and let us fetch your events.")}return(0,ss.jsxs)(ss.Fragment,{children:["accountType"===this.state.step&&xD("form",{className:"detail",onSubmit:this.selectAccountType},void 0,xD("div",{className:"detail-content"},void 0,this.props.onboarding&&(0,ss.jsxs)(ss.Fragment,{children:[KD,this.state.initial&&(0,ss.jsxs)(ss.Fragment,{children:[xD("h1",{},void 0,(0,B.Z)("Welcome to Vivaldi Calendar")),xD("p",{},void 0,(0,B.Z)("Let’s get you going by adding your first account."))]}),!this.state.initial&&(0,ss.jsxs)(ss.Fragment,{children:[xD("h1",{},void 0,(0,B.Z)("Vivaldi Calendar")),xD("p",{},void 0,(0,B.Z)("Great, let’s add another account."))]})]}),!this.props.onboarding&&xD("p",{},void 0,(0,B.Z)("Select account type to add.")),xD("div",{className:"toolbar toolbar-pills toolbar-wrap"},void 0,o.map((e=>xD(po.ZP,{isPressed:e===this.state.account_type,title:this.props.searchableStrings[e],onClick:()=>this.changeType(e)},e))))),xD("div",{className:"detail-toolbar"},void 0,xD("input",{type:"submit",value:(0,B.Z)("Continue"),autoFocus:!0}))),"accountInfo"===this.state.step&&xD("form",{className:"detail",onSubmit:this.createAccount},void 0,xD("div",{className:"detail-content"},void 0,this.props.onboarding&&(0,ss.jsxs)(ss.Fragment,{children:[xD("h1",{},void 0,(0,B.Z)("Add Your First Calendar Account")),xD("p",{},void 0,r)]}),xD("div",{className:"setting-group unlimited"},void 0,xD("div",{className:"setting-group"},void 0,xD("div",{className:"setting-single"},void 0,xD(Vl.Z,{type:"text",name:"name",onChange:this.handleChange,label:this.props.searchableStrings["Display Name"],value:e,autoFocus:!0}))),["caldav","ical"].includes(n)&&xD("div",{className:"setting-group"},void 0,xD("div",{className:"setting-single"},void 0,xD(Vl.Z,{type:"text",name:"url",onChange:this.handleChange,label:this.props.searchableStrings.URL,value:t})))),(BD(RD(n))||"ical"===n)&&xD("div",{className:"setting-group unlimited"},void 0,xD("div",{className:"setting-group"},void 0,xD("div",{className:"setting-single"},void 0,xD(Vl.Z,{type:"text",name:"username",onChange:this.handleChange,label:this.props.searchableStrings.Username,value:i,placeholder:GD(n)}))),["caldav","ical","icloud"].includes(n)&&xD("div",{className:"setting-group"},void 0,xD("div",{className:"setting-single"},void 0,xD(Vl.Z,{type:"password",name:"password",onChange:this.handleChange,label:this.props.searchableStrings.Password,value:s})),"icloud"===n&&zD)),this.state.statusText&&xD("div",{className:"setting-group-double"},void 0,xD(To,{type:a},void 0,this.state.statusText))),xD("div",{className:"detail-toolbar"},void 0,xD("input",{type:"submit",disabled:BD(RD(n))&&!i||this.state.requestPending,value:(0,B.Z)("Add Account")}),xD("input",{type:"button",disabled:this.state.requestPending,onClick:this.goBack,value:(0,B.Z)("navigation","Back")}))),"accountSummary"===this.state.step&&xD("form",{className:"detail",onSubmit:this.saveAccount},void 0,xD("div",{className:"detail-content"},void 0,this.state.calendars.length>0&&(0,ss.jsxs)(ss.Fragment,{children:[this.props.onboarding&&(0,ss.jsx)(ss.Fragment,{children:xD("h1",{},void 0,(0,B.Z)("Calendar Visibility and Syncing"))}),xD("p",{},void 0,(0,B.Z)("We found the following calendars:")),xD("table",{},void 0,xD("thead",{},void 0,xD("tr",{},void 0,xD("td",{},void 0,(0,B.Z)("Calendar")),xD("td",{},void 0,(0,B.Z)("Sync")),xD("td",{},void 0,(0,B.Z)("show","Hide")))),xD("tbody",{},void 0,this.state.calendars.map(((e,t)=>xD("tr",{},e.name||e.description||e.ctag,xD("td",{},void 0,e.description||e.name),xD("td",{},void 0,xD("input",{type:"checkbox",onChange:e=>this.toggleCalendarState(e,t,"active"),checked:e.active})),xD("td",{},void 0,xD("input",{type:"checkbox",onChange:e=>this.toggleCalendarState(e,t,"hidden"),checked:e.hidden})))))))]}),0===this.state.calendars.length&&xD("p",{},void 0,(0,B.Z)("No calendars found. Check that your credentials are correct and your calendar service has calendars configured.")),this.state.statusText&&this.state.status===HD&&xD("div",{className:"setting-group-double"},void 0,xD(To,{type:a},void 0,this.state.statusText))),xD("div",{className:"detail-toolbar"},void 0,xD("input",{type:"submit",disabled:this.state.requestPending,value:(0,B.Z)("Save Account")}),xD("input",{type:"button",disabled:this.state.requestPending,onClick:this.goBack,value:(0,B.Z)("navigation","Back")}))),"done"===this.state.step&&xD("form",{className:"detail",onSubmit:this.props.showTips},void 0,xD("div",{className:"detail-content"},void 0,this.props.onboarding&&(0,ss.jsx)(ss.Fragment,{children:xD("span",{className:"ShowMailTipsAndTricks-allSetIcon",dangerouslySetInnerHTML:{__html:Wi.mXV}})}),xD("h1",{},void 0,(0,B.Z)("Great, You’re All Set!")),"local"===this.account?.account_type&&xD("p",{},void 0,(0,B.Z)("If you want to add more local calendars use the calendar list in settings.")),this.props.onboarding&&xD("p",{},void 0,(0,B.Z)("Where to next?"))),xD("div",{className:"detail-toolbar"},void 0,xD("input",{type:"submit",value:(0,B.Z)("Show Tips and Tricks")}),xD("input",{type:"button",onClick:this.addAnother,value:(0,B.Z)("Add Another Account")}),this.props.onboarding&&xD("input",{type:"button",value:(0,B.Z)("Open Vivaldi Calendar"),onClick:()=>{de.Z.showCalendar(this.context.vivaldiWindowId),this.props.done?.()}}),!this.props.onboarding&&xD("input",{type:"button",value:(0,B.Z)("calendar","Done"),onClick:()=>{this.props.done?.()}})))]})}}const YD=jD;var XD,QD=n(76632);function qD(e,t,n,i){XD||(XD="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:XD,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class JD extends Li.PureComponent{faviconStyle=this.props.isCreating?{opacity:.3}:{};render(){let e=this.props.iconPath;return"gmail.com"===e?e="https://ssl.gstatic.com/ui/v1/icons/mail/images/favicon5.ico":"googleusercontent.com"===e?e="https://google.com/favicon.ico":"fastmail.com"===e?e="https://www.fastmail.com/favicon.svg":e&&(e=(0,Ri.rv)(e)),(0,ss.jsxs)(ss.Fragment,{children:[qD(Ri.ZP,{size:32,className:"item-icon",url:e?(0,rl.q9)(e):this.props.iconFallbackPath,fallbackUrl:this.props.iconFallbackPath,loadType:"faviconSkipCache",style:this.faviconStyle}),qD("div",{className:"item-title"},void 0,this.props.title),qD("div",{className:"item-meta"},void 0,this.props.meta)]})}}const eM=JD;var tM;function nM(e,t,n,i){tM||(tM="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:tM,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const iM=["editor","density","help"];function sM(e){const[t,i]=Li.useState(C.Z.get(I.kCalendarEditMode));return(0,ss.jsxs)(ss.Fragment,{children:[e.onboarding&&nM("h3",{},void 0,(0,B.Z)("Calendar Settings")),nM("h1",{},void 0,(0,B.Z)("Adding Events")),nM("p",{},void 0,(0,B.Z)("We’re all about choice. By default, we add and edit events inline, right inside the calendar without any popups.")),nM("div",{className:"ShowCalendarTipsAndTricks-Selectbox"},void 0,nM("button",{className:Fi()("selectbox",{"selectbox-selected":"inline"===t}),onClick:function(){i("inline"),w.Z.set(I.kCalendarEditMode,"inline")},type:"button"},void 0,nM("div",{className:"selectbox-image"},void 0,nM("span",{className:"onboarding-iillustration",dangerouslySetInnerHTML:{__html:n(36502)}}),nM("div",{dangerouslySetInnerHTML:{__html:Wi.D7r.medium}})),nM("div",{className:"selectbox-title"},void 0,(0,B.Z)("Inline Editor"))),nM("button",{className:Fi()("selectbox",{"selectbox-selected":"popup"===t}),onClick:function(){i("popup"),w.Z.set(I.kCalendarEditMode,"popup")},type:"button"},void 0,nM("div",{className:"selectbox-image"},void 0,nM("span",{className:"onboarding-iillustration",dangerouslySetInnerHTML:{__html:n(46647)}}),nM("div",{dangerouslySetInnerHTML:{__html:Wi.D7r.medium}})),nM("div",{className:"selectbox-title"},void 0,(0,B.Z)("Dialog Editor"))))]})}function oM(e){const[t,i]=Li.useState(C.Z.get(I.kCalendarDisplayDensity));return(0,ss.jsxs)(ss.Fragment,{children:[e.onboarding&&nM("h3",{},void 0,(0,B.Z)("Calendar Settings")),nM("h1",{},void 0,(0,B.Z)("Calendar Density")),nM("p",{},void 0,(0,B.Z)("We can show you all the details from an event right in the calendar, or just the title. It’s up to you.")),nM("div",{className:"ShowCalendarTipsAndTricks-Selectbox"},void 0,nM("button",{className:Fi()("selectbox",{"selectbox-selected":"full"===t}),onClick:function(){i("full"),w.Z.set(I.kCalendarDisplayDensity,"full")},type:"button"},void 0,nM("div",{className:"selectbox-image"},void 0,nM("span",{className:"onboarding-iillustration",dangerouslySetInnerHTML:{__html:n(87922)}}),nM("div",{dangerouslySetInnerHTML:{__html:Wi.D7r.medium}})),nM("div",{className:"selectbox-title"},void 0,(0,B.Z)("Full Details"))),nM("button",{className:Fi()("selectbox",{"selectbox-selected":"minimal"===t}),onClick:function(){i("minimal"),w.Z.set(I.kCalendarDisplayDensity,"minimal")},type:"button"},void 0,nM("div",{className:"selectbox-image"},void 0,nM("span",{className:"onboarding-iillustration",dangerouslySetInnerHTML:{__html:n(18767)}}),nM("div",{dangerouslySetInnerHTML:{__html:Wi.D7r.medium}})),nM("div",{className:"selectbox-title"},void 0,(0,B.Z)("Title Only"))))]})}function aM(e){return(0,ss.jsxs)(ss.Fragment,{children:[e.onboarding&&nM("h3",{},void 0,(0,B.Z)("Calendar Help")),nM("h1",{},void 0,(0,B.Z)("Get All the Help You Need")),nM("div",{className:"ShowCalendarTipsAndTricks-WithImage"},void 0,nM("span",{className:"onboarding-iillustration",dangerouslySetInnerHTML:{__html:Wi.Kuf}}),nM("div",{className:"ShowCalendarTipsAndTricks-TextBlock"},void 0,nM("p",{},void 0,(0,B.Z)("Want more tips and tricks? Our Help pages contain all the documentation you need.")),nM("p",{},void 0,nM("a",{onClick:()=>c.ZP.openURL(e.windowId,"https://help.vivaldi.com/calendar/")},void 0,(0,B.Z)("Visit our Help pages for Calendar.")))))]})}function rM(e){const[t,n]=Li.useState(iM[0]);const i=t===iM[iM.length-1];return nM("div",{className:"ShowCalendarTipsAndTricks"},void 0,nM("form",{className:"detail",onSubmit:function(){n(iM[iM.indexOf(t)+1])}},void 0,nM("div",{className:"detail-content"},void 0,"editor"===t&&nM(sM,{windowId:e.windowId,onboarding:e.onboarding}),"density"===t&&nM(oM,{windowId:e.windowId,onboarding:e.onboarding}),"help"===t&&nM(aM,{windowId:e.windowId,onboarding:e.onboarding})),nM("div",{className:"detail-toolbar"},void 0,!i&&nM("input",{type:"submit",value:(0,B.Z)("Next tip")}),nM("input",{type:i?"submit":"button",value:(0,B.Z)("Open Vivaldi Calendar"),onClick:()=>{de.Z.showCalendar(e.windowId),e?.onClose?.()}}),e.onClose&&nM("input",{type:"button",value:(0,B.Z)("calendar","Done"),onClick:()=>{e?.onClose?.()}}))))}var lM;function dM(e,t,n,i){lM||(lM="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:lM,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const{isOAuthProvider:cM,ensureAccountType:uM}=Zl.ZP,pM="/resources/vivaldi_calendar_default.png",hM=n(28888),gM={"Add your First Calendar Account":(0,B.Z)("Add your First Calendar Account"),"Press the “Add” button to the left to add a new Account.":(0,B.Z)("Press the “Add” button to the left to add a new Account.")},mM={...eh.d3,icloud:(0,B.Z)("iCloud Calendar"),"Calendar Type":(0,B.Z)("Calendar Type"),"Display Name":(0,B.Z)("Display Name"),URL:(0,B.Z)("Address"),Password:(0,B.Z)("Password"),Username:(0,B.Z)("Username"),Timezone:(0,B.Z)("Timezone"),Description:(0,B.Z)("Description")};class fM extends Li.Component{static contextType=ts.Z;state={deletingAccount:"",isCreating:!1,setupStep:"setup"};#Et=!1;onCreateItem=()=>{this.#Et=!0,this.setState({isCreating:!0,setupStep:"setup"})};onCancelCreateItem=()=>{"setup"===this.state.setupStep?this.setState({isCreating:!1}):this.setState({isCreating:!1,setupStep:"setup"})};showTips=()=>{this.setState({setupStep:"tips"})};done=()=>{this.setState({setupStep:"setup"})};saveAccount=e=>{te.ZP.updateAccount(e)};getFallbackIcon=e=>"caldav"===e?"/resources/calendar_caldav.png":"ical"===e?"/resources/calendar_web.png":pM;renderListItem=(e,t)=>{const n=uM(t.account_type);let i="";if(cM(n)){i=((0,ge.Z)(t.url)?.hostname||"").split(".").slice(-2).join(".")}return dM(eM,{title:t.name,meta:eh.d3[n],iconPath:i,iconFallbackPath:this.getFallbackIcon(n)})};renderCreateListItem=()=>dM(eM,{title:(0,B.Z)("New Account"),meta:(0,B.Z)("Setup in progress..."),iconFallbackPath:pM,isCreating:!0});renderContent=(e,t)=>{const n=this.props.accounts[e],i=wn()(Object.values(n).reduce(((e,t)=>e+t)));return(0,ss.jsxs)(ss.Fragment,{children:["setup"===this.state.setupStep&&dM(ZD,{filter:this.props.filter,searchableStrings:t,account:n,saveAccount:this.saveAccount},i),"tips"===this.state.setupStep&&dM(rM,{windowId:this.context.vivaldiWindowId,onClose:this.done,onboarding:!1})]})};remapAccounts=()=>this.props.accounts.map((e=>({...e,key:e.id})));renderCreate=e=>dM(YD,{done:this.onCancelCreateItem,filter:this.props.filter,searchableStrings:e});renderEmpty=e=>dM("div",{className:"detail"},void 0,dM("div",{className:"detail-content"},void 0,dM("h3",{},void 0,gM["Add your First Calendar Account"]),dM("p",{},void 0,gM["Press the “Add” button to the left to add a new Account."])));deleteAccountDialog=e=>(0,ss.jsx)(PD,{...e});render(){return dM(QD.Z,{title:(0,B.Z)("Calendar Accounts"),subtitle:(0,B.Z)("Add accounts such as Google, Outlook, Vivaldi.net, etc., to access your online calendars."),className:"account-settings",deleteDialog:this.deleteAccountDialog,addTipString:(0,B.Z)("Add Account"),deleteTipString:(0,B.Z)("tooltip","Remove Account"),emptyListGraphic:hM,emptyListString:(0,B.Z)("No accounts added"),filter:this.props.filter,items:this.remapAccounts(),masterLayout:0,renderListItem:this.renderListItem,renderCreateListItem:this.renderCreateListItem,renderContent:this.renderContent,isCreating:this.state.isCreating,onCreateItem:this.onCreateItem,onCancelCreateItem:this.onCancelCreateItem,renderCreate:this.renderCreate,renderEmpty:this.renderEmpty,contentStrings:mM,emptyStrings:gM,createStrings:mM,onRemove:Lr.Z})}}const vM=MD(fM),yM=Li.createContext({pageId:NaN,displayDensity:"full",isPanel:!1,isEditing:!1,isWidget:!1,handler:{selectDate:Lr.Z,selectEvent:Lr.Z,selectCalendars:Lr.Z,toggleShowCompleted:Lr.Z,editEvent:Lr.Z,saveEventEdit:Lr.Z,updateEventEdit:Lr.Z,endEventEdit:Lr.Z,cancelEventEdit:Lr.Z}});var bM;function SM(e,t,n,i){bM||(bM="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:bM,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const wM=function(e){const{event:t,updateEvent:n}=e,{start:i,end:s,allDay:o=!1}=t,a=Li.useRef(""),r=function(e,t,n){let i=t-e;return i<0&&(i+=me.hd),{days:Math.floor(i/me.hd)+(n?1:0),hours:n?0:Math.floor(i%me.hd/me.QI),minutes:n?0:Math.floor(i%me.QI/me.lb)}}(i,s,o);function l(){const{days:t,hours:i,minutes:s}=r;e.event.end=o?e.event.start+(t||0)*me.hd:e.event.start+(t||0)*me.hd+(i||0)*me.QI+(s||0)*me.lb,n(e.event)}function d(e){const{name:t,value:n}=e.currentTarget,i=Math.max(parseInt(n),0);switch(t){case"days":r.days=i;break;case"hours":r.hours=i;break;case"minutes":r.minutes=i}a.current=isNaN(i)?t:"",l()}function c(e){const{name:t}=e.currentTarget;e.currentTarget.value||"days"!==t&&"hours"!==t&&"minutes"!==t||(r[t]=0,a.current="",l())}const{days:u,hours:p,minutes:h}=r;return SM("div",{className:"edit-group"},void 0,SM("label",{},void 0,SM("input",{type:"number",name:"days",min:"0",value:"days"===a.current?"":u,onBlur:c,onChange:d}),SM("span",{},void 0,(0,B.Z)("Day","Days",[u]))),!o&&(0,ss.jsxs)(ss.Fragment,{children:[SM("label",{},void 0,SM("input",{type:"number",name:"hours",min:"0",value:"hours"===a.current?"":p,onBlur:c,onChange:d}),SM("span",{},void 0,(0,B.Z)("Hour","Hours",[p]))),SM("label",{},void 0,SM("input",{type:"number",name:"minutes",min:"0",value:"minutes"===a.current?"":h,onBlur:c,onChange:d}),SM("span",{},void 0,(0,B.Z)("Minute","Minutes",[h])))]}))};var CM;function AM(e,t,n,i){CM||(CM="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:CM,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const IM=60,TM=1440,ZM=10080;function EM(e,t){if(0===e)return t?(0,B.Z)("Same day"):(0,B.Z)("At event time");if(e%ZM==0){const t=e/ZM;return(0,B.Z)("$1 week before","$1 weeks before",[t])}if(e%TM==0){const t=e/TM;return(0,B.Z)("$1 day before","$1 days before",[t])}if(e%IM==0){const t=e/IM;return(0,B.Z)("$1 hour before","$1 hours before",[t])}return(0,B.Z)("$1 minute before","$1 minutes before",[e])}const kM=[[NaN,(0,B.Z)("No reminder")],[0,(0,B.Z)("At event time")],[5,EM(5,!1)],[10,EM(10,!1)],[15,EM(15,!1)],[30,EM(30,!1)],[45,EM(45,!1)],[60,EM(60,!1)],[120,EM(120,!1)],[240,EM(240,!1)],[360,EM(360,!1)],[480,EM(480,!1)],[720,EM(720,!1)],[1440,EM(1440,!1)],[2880,EM(2880,!1)],[4320,EM(4320,!1)],[5760,EM(5760,!1)],[7200,EM(7200,!1)],[8640,EM(8640,!1)],[10080,EM(10080,!1)],[20160,EM(20160,!1)],[30240,EM(30240,!1)],[40320,EM(40320,!1)]],_M=[[NaN,(0,B.Z)("No reminder")],[0,(0,B.Z)("Same day")],[1440,(0,B.Z)("$1 day before","$1 days before",[1])],[2880,(0,B.Z)("$1 day before","$1 days before",[2])],[4320,(0,B.Z)("$1 day before","$1 days before",[3])],[5760,(0,B.Z)("$1 day before","$1 days before",[4])],[7200,(0,B.Z)("$1 day before","$1 days before",[5])],[8640,(0,B.Z)("$1 day before","$1 days before",[6])],[10080,(0,B.Z)("$1 week before","$1 weeks before",[1])],[20160,(0,B.Z)("$1 week before","$1 weeks before",[2])],[30240,(0,B.Z)("$1 week before","$1 weeks before",[3])],[40320,(0,B.Z)("$1 week before","$1 weeks before",[4])]],NM=6e4;function PM(e){const t=DM(e);return`${Math.floor(t/IM%24).toString().padStart(2,"0")}:${(t%IM).toString().padStart(2,"0")}`}function DM(e){return e<0?Math.abs(e)%TM:(TM-e%TM)%TM}const MM=function(e){const t=Li.useRef(null),n=e.value/NM;function i(t){let i=parseInt(t.target.value);e.allDay&&(i-=DM(n)),e.onChange(i*NM)}const s=e.allDay?[..._M]:[...kM],o=e.allDay?Math.ceil(n/TM)*TM:n;return s.find((([e])=>e===o))||(s.push([o,EM(o,e.allDay??!1)]),s.sort((([e],[t])=>e-t))),(0,ss.jsxs)(ss.Fragment,{children:[e.create&&(0,ss.jsx)(ta.Z,{ref:t,className:e.className,tabIndex:e.tabIndex,onChange:i,value:"NaN",disabled:0===s.length,children:s.map((([e,t])=>AM("option",{value:e.toString()},e,t)))}),!e.create&&(0,ss.jsxs)(ss.Fragment,{children:[(0,ss.jsx)(ta.Z,{ref:t,className:e.className,tabIndex:e.tabIndex,onChange:i,value:o,disabled:0===s.length,children:s.map((([e,t])=>AM("option",{value:e.toString()},e,t)))}),e.allDay&&(0,ss.jsxs)(ss.Fragment,{children:[AM("span",{style:{flex:"0 0 auto"}},void 0,(0,B.Z)("at")),AM(Yh,{onChange:function(n){const i=Date.parse(`1970-01-01T${n.target.value}Z`)/NM,s=(parseInt(t.current?.value)||0)-i;e.onChange(s*NM)},value:PM(n),step:"5",autoFocusNextElement:!1})]})]})]})};var OM=n(49550);var xM;function LM(e,t,n,i){xM||(xM="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:xM,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function RM(e){"Enter"===OM.Z[e.keyCode]&&e.stopPropagation()}const BM=function(e){const t=Li.useContext(ts.Z),{document:n}=t,[i,s]=Li.useState(!1);if(Li.useEffect((()=>{if(i){const e=n.querySelectorAll(".cal-event-alarm-time");e.length&&e[e.length-1].focus(),s(!1)}}),[i,n]),e.event.task&&!e.event.end)return(0,ss.jsxs)(ss.Fragment,{children:[e.label&&LM("h2",{},void 0,e.label),LM("p",{className:"info"},void 0,(0,B.Z)("Can not set reminder for task without due time."))]});if(e.event.task&&!e.event.end)return(0,ss.jsxs)(ss.Fragment,{children:[e.label&&LM("h2",{},void 0,e.label),LM("p",{className:"info"},void 0,(0,B.Z)("Can not set reminder for task without due time."))]});const o=t=>{const n=function(e,t){let n=t;e.allDay&&t%me.hd==0&&(n-=DM(C.Z.get(I.kCalendarDefaultAlldayNotificationTime)||900)*me.lb);return{id:"",event_id:e.id,name:e.title,when:n}}(l,t??0),i=[...l.notifications||[],n];s(!0),e.updateEvent({...e.event,notifications:i})},a=()=>{o(function(e){if(e)return(C.Z.get(I.kCalendarDefaultAlldayNotificationTime)||900)*me.lb;{const e=C.Z.get(I.kCalendarDefaultNotification);return-1===e?0:e*me.lb}}(l.allDay??!1))},r=i=>{const s=[...e.event.notifications??[]];if(!s.length)return;const{HTMLElement:o}=t,a=n.activeElement instanceof o&&n.activeElement.closest(".calendar-event");if(a){const e=(0,Ra.Ng)(a);e.forEach(((t,i)=>{t===n.activeElement&&e[i-1]?.focus()}))}const r=s.indexOf(i);-1!==r&&(s.splice(r,1),e.updateEvent({...e.event,notifications:s}))},{event:l}=e;return(0,ss.jsxs)(ss.Fragment,{children:[e.label&&LM("h2",{},void 0,e.label),!!l.notifications?.length&&l.notifications.map(((t,n)=>LM("div",{className:"edit-group"},t.id||n,LM("label",{},void 0,LM(MM,{allDay:l.allDay??!1,create:!1,value:t.when,onChange:n=>((t,n)=>{const i=[...e.event.notifications??[]];if(!i.length)return;const s=i.findIndex((e=>e===t));if(-1!==s){if(-1===n||isNaN(n))return void r(t);i[s]={...i[s],when:n},e.updateEvent({...e.event,notifications:i})}})(t,n),tabIndex:e.tabIndex,className:"cal-event-alarm-time"}),!e.readOnly&&(0,ss.jsxs)(ss.Fragment,{children:[LM("button",{className:"circular",onClick:r.bind(null,t),onKeyDown:RM,tabIndex:e.tabIndex,type:"button",title:(0,B.Z)("Remove alarm"),dangerouslySetInnerHTML:{__html:Wi.M2k.small}}),LM("button",{className:"circular",onClick:a,onKeyDown:RM,tabIndex:e.tabIndex,type:"button",title:(0,B.Z)("Add another alarm"),dangerouslySetInnerHTML:{__html:Wi.md4.small}})]}))))),!l.notifications?.length&&LM("div",{className:"edit-group"},void 0,LM("label",{},void 0,LM(MM,{allDay:l.allDay??!1,create:!0,value:0,onChange:o,tabIndex:e.tabIndex,className:"cal-event-alarm-time"})))]})};var FM,WM=n(98528);function UM(e,t,n,i){FM||(FM="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:FM,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const VM={ACCEPTED:{icon:Wi.wHY,text:(0,B.Z)("Has accepted the invite")},DECLINED:{icon:Wi.dHk,text:(0,B.Z)("Has declined the invite")},TENTATIVE:{icon:Wi.owS,text:(0,B.Z)("Has tentatively accepted the invite")},"NEEDS-ACTION":{icon:Wi.DvK,text:(0,B.Z)("Has not replied to the invite")},DELEGATED:{icon:Wi.upG.large,text:(0,B.Z)("Has delegated invite to another person")}};function HM(e){const{requestAnimationFrame:t}=Li.useContext(ts.Z);return(0,ss.jsx)("p",{className:Fi()("Participants-Dropdown-Item",{"Participants-Dropdown-Item--Selected":e.selected}),onClick:e.onClick,ref:n=>{e.selected&&n&&t((()=>{n.scrollIntoViewIfNeeded()}))},children:e.contact.name?UM(Li.Fragment,{},void 0,UM("span",{className:"Participants-Dropdown-Item-Primary"},void 0,e.contact.name),UM("span",{className:"Participants-Dropdown-Item-Secondary"},void 0,"<"+e.contact.address+">")):UM("span",{className:"Participants-Dropdown-Item-Primary"},void 0,e.contact.address)})}const GM={value:"",items:[],selectedIndex:0};function $M(e){const t=Li.useContext(ts.Z),n=Li.useRef(),[i,s]=Li.useState(GM);return UM("div",{className:"Participants-Input edit-group"},void 0,(0,ss.jsx)("input",{ref:n,type:"text",tabIndex:e.tabIndex,placeholder:e.placeholder,value:i.value,onChange:function(t){const{value:n}=t.target,i=n?pZ(n,e.contacts):[];s({value:n,items:i,selectedIndex:0})},onKeyDown:function(t){const{value:n}=t.currentTarget;switch(OM.Z[t.keyCode]){case"Up":s((e=>({...e,selectedIndex:Math.max(0,e.selectedIndex-1)}))),(0,ms.ZP)(t);break;case"Down":s((e=>({...e,selectedIndex:Math.min(e.items.length-1,e.selectedIndex+1)}))),(0,ms.ZP)(t);break;case"Enter":const o=i.items[i.selectedIndex];if(o)e.onItemSelected(o);else if(n){(0,dZ.D$)(n).forEach(e.onItemSelected)}s(GM),(0,ms.ZP)(t);break;case"Escape":i.value&&(s(GM),(0,ms.ZP)(t))}}}),i.items.length>0&&n.current instanceof t.HTMLElement&&UM(WM.Z,{popupClassName:"Participants-Dropdown",buttonRef:n.current,hidePopup:()=>s(GM),isResizable:!1,popupPosition:"below",width:350,forceFocus:!1,anchorPosition:"left",label:(0,B.Z)("calendar event","Participants")},void 0,i.items.map(((t,n)=>UM(HM,{contact:t,selected:n===i.selectedIndex,onClick:t=>function(t,n){e.onItemSelected(i.items[n]),s(GM),(0,ms.ZP)(t)}(t,n)},t.address)))))}class KM extends Li.Component{static contextType=ts.Z;contacts=new Map;showNoMailWarning=!1;constructor(e){super(e),this.contacts=this.getRemainingContacts(Ed.Z.getMailAddresses())}stopEnterEvent=e=>{e.keyCode===xa.Z.KEY_RETURN&&e.stopPropagation()};contactSelected=e=>{const{event:t}=this.props,n={id:"",event_id:t.id,name:e.name,address:e.address,sent:!1},i=t.invites?[n,...t.invites]:[n];this.props.updateEvent({...t,invites:i}),this.contacts=this.getRemainingContacts(this.contacts),this.forceUpdate()};getRemainingContacts(e){const{event:t}=this.props;if(!t.invites||0===t.invites.length)return e;const n=new Set(t.invites.map((e=>e.address)));return new Map([...e.entries()].filter((([e,t])=>!n.has(e))))}removeInvite=(e,t)=>{const{event:n}=this.props;if(!n.invites||0===n.invites.length)return;const i=[...n.invites],s=i.findIndex((t=>t.address===e));if(-1===s)return;i.splice(s,1);const{HTMLElement:o}=this.context,a=t.target.closest(".calendar-event");if(a instanceof o){const e=(0,Ra.Ng)(a);e.forEach(((n,i)=>{n===t.target&&e[i-1]&&e[i-1].focus()}))}this.props.updateEvent({...n,invites:i}),this.contacts=this.getRemainingContacts(Ed.Z.getMailAddresses()),this.forceUpdate()};render(){const{event:e}=this.props,t=(e.invites||[]).filter((t=>t.address!==e.organizer));return e.task?UM("div",{className:"Participants"},void 0,UM("p",{className:"info"},void 0,(0,B.Z)("Participants not supported for Tasks"))):UM("div",{className:"Participants"},void 0,!this.props.readOnly&&UM($M,{contacts:this.contacts,onItemSelected:this.contactSelected,tabIndex:this.props.tabIndex,placeholder:this.props.label}),this.props.readOnly&&!e.invites?.length&&UM("span",{},void 0,(0,B.Z)("No participants")),!!e.invites?.length&&UM("div",{className:"Participants-List"},void 0,e.organizer&&UM("div",{className:"Participant",title:(0,B.Z)("Event Organizer")},e.organizer,UM("span",{className:"Participant-Status",dangerouslySetInnerHTML:{__html:Wi.LaO.small}}),UM("span",{className:"Participant-Address"},void 0,e.organizer),!this.props.readOnly&&UM("input",{onClick:this.removeInvite.bind(this,e.organizer||""),onKeyDown:this.stopEnterEvent,tabIndex:this.props.tabIndex,type:"button",value:(0,B.Z)("verb","Remove")})),t.map(((e,t)=>{const n=e.partstat||"NEEDS-ACTION",i=VM[n]?VM[n]:VM["NEEDS-ACTION"];return UM("div",{className:"Participant",title:this.props.readOnly?"":i.text},e.address,!this.props.readOnly&&UM("span",{className:"Participant-Status",dangerouslySetInnerHTML:{__html:i.icon}}),UM("span",{className:"Participant-Address"},void 0,e.address),!this.props.readOnly&&UM("input",{onClick:this.removeInvite.bind(this,e.address),onKeyDown:this.stopEnterEvent,tabIndex:this.props.tabIndex,type:"button",value:(0,B.Z)("verb","Remove")}))}))),!C.Z.get(I.kCalendarMailAccount)&&UM("p",{className:"info"},void 0,(0,B.Z)("In order to send invitations you will need to select a mail account in calendar settings.")))}}const zM=KM;var jM,YM=n(6142);function XM(e,t,n,i){jM||(jM="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:jM,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const QM=function(e){const{event:t,updateEvent:n}=e,i=Li.useRef(null),s=Li.useCallback((()=>{const s=i.current;"start"===e.type?t.start=s&&s<=t.end?s:t.end-C.Z.get(I.kCalendarDefaultDuration):t.end=s||(0,ih.zX)(Date.now()),n(t)}),[t,n,e.type]),o=Li.useCallback((()=>{"start"===e.type?(i.current=t.start,t.start=0):(i.current=t.end,t.start=0,t.end=0),n(t)}),[t,n,e.type]),a="start"===e.type,r="dialog"===e.view,l=!r,d=a?(0,B.Z)("Start Time"):(0,B.Z)("Due Time"),c=a?(0,B.Z)("Task Start Date"):(0,B.Z)("Task Due Date"),u=a?(0,B.Z)("Task Start Time"):(0,B.Z)("Task Due Time"),p=a?(0,B.Z)("Clear Start Time"):(0,B.Z)("Clear Due Time"),{start:h,end:g}=(0,ih.aE)(t),m=a?h:g,f=XM("button",{className:"circular",onClick:o,tabIndex:e.tabIndex,type:"button",title:p,dangerouslySetInnerHTML:{__html:Wi.YVA.small}}),v=!e.timeOnly&&XM(Vk.Z,{className:"cal-event-date-picker",onChange:e.onDateChange,tabIndex:e.tabIndex,title:c,value:m.format("YYYY-MM-DD"),autoFocus:!0}),y=!t.allDay&&XM(Yh,{className:"cal-event-time-picker",onChange:e.onTimeChange,tabIndex:e.tabIndex,step:"5",title:u,value:m.format("HH:mm")});return(0,ss.jsxs)(ss.Fragment,{children:[!m.valueOf()&&XM("button",{className:"TaskTime FormButton FormButton--WithIcon",onClick:s,dangerouslySetInnerHTML:{__html:`${Wi.hcy.small} ${d}`},tabIndex:e.tabIndex,autoFocus:!0,disabled:a&&!t.end}),!!m.valueOf()&&(0,ss.jsxs)(ss.Fragment,{children:[a&&r&&f,!a&&r&&y,v,(a||l)&&y,!(a&&r)&&f]})]})};var qM,JM=n(68172);function eO(e,t,n,i){qM||(qM="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:qM,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var tO=eO("hr",{}),nO=eO("hr",{});function iO(e){const t=(0,Li.useContext)(ts.Z),n=(0,Li.useRef)("label");const i=El.Z.getTemplates();return eO(ta.Z,{name:"template",onChange:function(i){const s=i.currentTarget.value;"create"===s?function(){const n={templateId:"",name:e.event.title,event:e.event,properties:me.rA};de.Z.showEditEventTemplate(t.vivaldiWindowId,n)}():((0,JM.tE)(s,e.event).then(e.updateEvent),n.current=s)},tabIndex:e.tabIndex,value:n.current},void 0,eO("option",{value:"label"},void 0,(0,B.Z)("Templates")),tO,i.map((e=>eO("option",{value:e.id},e.id,e.name))),!!i.length&&nO,eO("option",{value:"create"},void 0,(0,B.Z)("Create Event Template")))}class sO extends Li.Component{static contextType=ts.Z;constructor(e){super(e)}shouldComponentUpdate=()=>{const{document:e}=this.context;return!(this.element&&this.element===e.activeElement)};setRef=e=>{this.element=e,e&&this.props.setElementRef&&this.props.setElementRef(e)};updateContent=e=>{if(this.element){const e=this.element.textContent;this.props.updateContent(e||"")}};render(){const e=(this.props.className||"")+" editable",t=(0,xd.Z)(this.props,["className","content","updateContent","formatter","setElementRef"]);return(0,ss.jsx)("p",{...t,className:e,contentEditable:"plaintext-only",onBlur:this.updateContent,onInput:this.updateContent,ref:this.setRef,suppressContentEditableWarning:!0,"data-placeholder":this.props.placeholder?this.props.placeholder:"",children:this.props.formatter(this.props.content)})}}const oO=sO;var aO;function rO(e,t,n,i){aO||(aO="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:aO,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class lO extends Li.PureComponent{updateText=e=>{const{event:t,field:n}=this.props;(e&&e!==t[n]||!e&&t[n])&&this.props.updateEvent({...t,[n]:e})};onKeyDown=e=>{if("Enter"===OM.Z[e.keyCode]&&!e.shiftKey){const{saveEventEdit:t}=this.props;t&&(t(),(0,ms.ZP)(e))}};render(){return this.props.readOnly?rO("p",{className:`field cal-event-${this.props.field}`},void 0,this.props.event[this.props.field]):rO(oO,{setElementRef:e=>{this.props.focusRef&&e&&(this.props.focusRef.current=e)},tabIndex:this.props.tabIndex,title:this.props.label,placeholder:this.props.label,className:`field cal-event-${this.props.field}`,content:this.props.event[this.props.field],formatter:e=>e,updateContent:this.updateText,onKeyDown:this.onKeyDown})}}const dO=lO;var cO,uO=n(92571),pO=n(80008),hO=n.n(pO);function gO(e,t,n,i){cO||(cO="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:cO,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const mO=[{value:me.ad,label:(0,B.Z)("Current ($1)",[(0,ih.EP)()])},{value:me.$T,label:(0,B.Z)("Always in Local Time")}].concat(hO().tz.names().filter((e=>-1!==e.indexOf("/"))).map((e=>({value:e,label:e})))),fO=gs()((function(e,t){return t?mO[1]:mO.find((t=>t.value===e))??vO()[0]}));function vO(){return mO[0]={value:me.ad,label:(0,B.Z)("Current ($1)",[(0,ih.EP)()])},mO}const yO=function(e){const{event:t,setSelectedItem:n}=e,i=Li.useRef(!1);return gO(uO.Z,{commands:vO(),placeholder:"",selectedCommand:fO(t.timezone,t.allDay),setSelectedItem:n,blurInputOnSelect:!1,disabled:e.event.allDay,onKeyDown:e=>{i.current&&(0,ms.UW)(e)},tabIndex:e.tabIndex,onMenuOpen:function(){i.current=!0},onMenuClose:function(){i.current=!1}})};var bO=n(12442);const SO=e=>{const{pageId:t,handler:n}=Li.useContext(yM),i=Li.useContext(ts.Z).vivaldiWindowId,s=Li.useCallback((()=>{te.ZP.trashEvent(e.id)}),[e]),o=Li.useCallback((()=>{const t={templateId:"",name:e.title,event:e,properties:me.rA};de.Z.showEditEventTemplate(i,t)}),[e,i]),a=Li.useCallback((n=>{bO.Z.selectEvent(t,{event:e}),n?Gp.Z.cut(i):Gp.Z.copy(i)}),[e,t,i]),r=Li.useCallback((()=>[{handler:()=>n.editEvent(e),...(0,us.Z)("verb","Edit")},{type:"separator",label:"",labelEnglish:""},{handler:()=>a(!0),...(0,us.Z)("verb","Cut")},{handler:()=>a(!1),...(0,us.Z)("verb","Copy")},{handler:()=>s(),...(0,us.Z)("verb","Delete")},{handler:()=>o(),...(0,us.Z)("Create Event Template")}]),[s,a,n,e,o]);return{trashEvent:s,getContextMenu:r}};var wO;function CO(e,t,n,i){wO||(wO="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:wO,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function AO(e,t,n){const i=(0,ih.Yu)(e),s=hO().tz(e[t],i).format("YYYY-MM-DD");return TO(t,e,hO().tz(`${s} ${n}`,i).valueOf())}function IO(e,t,n){const i=(0,ih.Yu)(e),s=hO().tz(e[t],i).format("HH:mm"),o=hO().tz(`${n} ${s}`,i);return e.allDay&&!e.task&&"end"===t&&o.add(1,"day"),TO(t,e,o.valueOf())}function TO(e,t,n){if(!isNaN(n)){const i=C.Z.get(I.kCalendarAutoAdjustEnd);if("start"===e&&("always"===i||"timed_only"===i&&!t.allDay)){const e=t.end-t.start;t.start=n,t.end=n+e}else t[e]=n}return t}class ZO extends Li.Component{createTimeHandler=e=>t=>{const{value:n}=t.currentTarget;this.props.updateEvent(AO(this.props.event,e,n))};createDateHandler=e=>t=>{const{value:n}=t.currentTarget;this.props.updateEvent(IO(this.props.event,e,n))};setTimezone=e=>{this.props.updateEvent((0,ih.bn)(this.props.event,e.value))};setAllDay=e=>{const{checked:t}=e.currentTarget;this.props.event.allDay=t,this.props.updateEvent(this.props.event)};render(){const{event:e}=this.props,{start:t,end:n}=(0,ih.aE)(e);return CO("div",{},void 0,!e.task&&(0,ss.jsxs)(ss.Fragment,{children:[CO("div",{className:"edit-group large-gap"},void 0,CO(Vk.Z,{className:"cal-event-date-picker",onChange:this.createDateHandler("start"),tabIndex:this.props.tabIndex,title:(0,B.Z)("Event Start Date"),value:t.format("YYYY-MM-DD")}),!e.allDay&&(0,ss.jsx)(Yh,{className:"cal-event-time-picker",onChange:this.createTimeHandler("start"),ref:this.props.focusRef,tabIndex:this.props.tabIndex,step:"5",title:(0,B.Z)("Event Start Time"),value:t.format("HH:mm")})),CO("div",{className:"edit-group large-gap"},void 0,CO(Vk.Z,{className:"cal-event-date-picker",onChange:this.createDateHandler("end"),tabIndex:this.props.tabIndex,title:(0,B.Z)("Event End Date"),value:n.format("YYYY-MM-DD")}),!e.allDay&&CO(Yh,{className:"cal-event-time-picker",onChange:this.createTimeHandler("end"),tabIndex:this.props.tabIndex,step:"5",title:(0,B.Z)("Event End Time"),value:n.format("HH:mm")}))]}),e.task&&(0,ss.jsxs)(ss.Fragment,{children:[!!e.end&&CO("div",{className:"edit-group large-gap"},void 0,CO(QM,{type:"start",view:"inline",event:e,updateEvent:this.props.updateEvent,onDateChange:this.createDateHandler("start"),onTimeChange:this.createTimeHandler("start"),tabIndex:this.props.tabIndex})),CO("div",{className:"edit-group large-gap"},void 0,CO(QM,{type:"due",view:"inline",event:e,onDateChange:this.createDateHandler("end"),onTimeChange:this.createTimeHandler("end"),updateEvent:this.props.updateEvent,tabIndex:this.props.tabIndex}))]}),CO("div",{className:"edit-group large-gap"},void 0,CO("label",{},void 0,CO("input",{type:"checkbox",checked:!!e.allDay,onChange:this.setAllDay,tabIndex:this.props.tabIndex}),CO("span",{},void 0,(0,B.Z)("All Day"))),CO(yO,{event:e,setSelectedItem:this.setTimezone,tabIndex:this.props.tabIndex})),CO(BM,{event:e,tabIndex:this.props.tabIndex,updateEvent:this.props.updateEvent,label:(0,B.Z)("Reminders")}))}}const EO=ZO;var kO;function _O(e,t,n,i){kO||(kO="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:kO,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var NO=_O("span",{},void 0,"-"),PO=_O("span",{},void 0,"-");class DO extends Li.Component{createTimeHandler=e=>t=>{const{value:n}=t.currentTarget;this.props.updateEvent(AO(this.props.event,e,n))};createDateHandler=e=>t=>{const{value:n}=t.currentTarget;this.props.updateEvent(IO(this.props.event,e,n))};changeField=(e,t)=>{this.props.event[e]=t.currentTarget.checked,this.props.updateEvent(this.props.event)};onCalendarChange=e=>{this.props.event.calendarId=e.target.value,this.props.updateEvent(this.props.event)};onCalendarSelected=e=>{te.ZP.setDefaultCalendarId(e,this.props.event.task??!1),this.props.event.calendarId=e,this.props.updateEvent(this.props.event)};render(){const{event:e}=this.props,{start:t,end:n}=(0,ih.aE)(e);return(0,ss.jsxs)(ss.Fragment,{children:[_O("div",{className:"edit-group large-gap"},void 0,(0,ss.jsx)(dO,{...this.props,label:(0,B.Z)("Title"),field:"title"})),_O("div",{className:"edit-group large-gap"},void 0,!e.task&&e.allDay&&(0,ss.jsxs)(ss.Fragment,{children:[_O(Vk.Z,{className:"cal-event-date-picker",onChange:this.createDateHandler("start"),tabIndex:this.props.tabIndex,title:(0,B.Z)("Event Start Date"),value:t.format("YYYY-MM-DD")}),NO,_O(Vk.Z,{className:"cal-event-date-picker",onChange:this.createDateHandler("end"),tabIndex:this.props.tabIndex,title:(0,B.Z)("Event End Date"),value:n.format("YYYY-MM-DD")})]}),!e.task&&!e.allDay&&(0,ss.jsxs)(ss.Fragment,{children:[_O(Yh,{className:"cal-event-time-picker",onChange:this.createTimeHandler("start"),tabIndex:this.props.tabIndex,step:"5",title:(0,B.Z)("Event Start Time"),value:t.format("HH:mm")}),PO,_O(Yh,{className:"cal-event-time-picker",onChange:this.createTimeHandler("end"),tabIndex:this.props.tabIndex,step:"5",title:(0,B.Z)("Event End Time"),value:n.format("HH:mm")})]}),e.task&&_O(QM,{type:"due",view:"inline",event:e,updateEvent:this.props.updateEvent,onDateChange:this.createDateHandler("end"),onTimeChange:this.createTimeHandler("end"),tabIndex:this.props.tabIndex})),_O("div",{className:"edit-group inline large-gap"},void 0,_O("label",{},void 0,_O("input",{type:"checkbox",checked:!!e.task,onChange:this.changeField.bind(null,"task"),tabIndex:this.props.tabIndex}),_O("span",{},void 0,(0,B.Z)("Is a Task"))),_O("label",{},void 0,_O("input",{disabled:!e.task,type:"checkbox",checked:!!e.complete,onChange:this.changeField.bind(null,"complete"),tabIndex:e.task?this.props.tabIndex:-1}),_O("span",{},void 0,(0,B.Z)("Complete")))),e&&_O("div",{className:"edit-group large-gap capped-width"},void 0,hh(e,this.onCalendarSelected,this.props.tabIndex)),e&&_O("div",{className:"edit-group capped-width"},void 0,_O(iO,{event:e,tabIndex:this.props.tabIndex,updateEvent:this.props.updateEvent}))]})}}const MO=DO;var OO;function xO(e,t,n,i){OO||(OO="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:OO,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var LO=xO("div",{className:"CalendarEventBubble-Arrow"});const RO=function(e){const t=Li.useContext(ts.Z),n=Li.useContext(yM),i=t.vivaldiWindowId,s=Li.useRef(Li.createRef().current),o=Li.useRef();(0,DD.Z)(Ce.ZP,t.selectWindow);let a=!1;Ce.ZP.isActivePage(i,n.pageId)||n.isPanel||(a=!0);const r=Li.useCallback(((e,n)=>{o.current||(o.current=t.requestAnimationFrame((()=>{!function(e,t){const n=e.current,i=t.current;if(!n||!i)return;const s=n.parentElement?.getBoundingClientRect()||{left:0,top:0,bottom:0,width:0,height:0},o=n.getBoundingClientRect(),a=i.getBoundingClientRect(),r=a.left-s.left,l=s.width-a.right;l>=o.width?(n.style.left=a.right-s.left+"px",n.style.right="auto",n.classList.remove("CalendarEventBubble--RightArrow"),n.classList.add("CalendarEventBubble--LeftArrow")):r>=o.width?(n.style.right=s.width-a.left+"px",n.style.left="auto",n.classList.remove("CalendarEventBubble--LeftArrow"),n.classList.add("CalendarEventBubble--RightArrow")):r>l?(n.style.left="0px",n.style.right="auto",n.classList.remove("CalendarEventBubble--LeftArrow"),n.classList.add("CalendarEventBubble--RightArrow")):(n.style.right="0px",n.style.left="auto",n.classList.remove("CalendarEventBubble--RightArrow"),n.classList.add("CalendarEventBubble--LeftArrow"));const d=n.querySelector(".CalendarEventBubble-Arrow"),c=a.top-s.top,u=s.height-a.bottom,p=(o.height-a.height)/2;if(c>p&&u>p){if(n.style.top=a.top-s.top-p+"px",n.style.bottom="auto",d){const e=p+a.height/2;d.style.top=`${e}px`}}else if(u<p){if(n.style.bottom="0px",n.style.top="auto",d){const e=s.bottom-o.height,t=Math.min(o.height-20,a.top-e+a.height/2);d.style.top=`${t}px`}}else if(n.style.top="0px",n.style.bottom="auto",d){const e=Math.max(20,a.top-o.top+a.height/2);d.style.top=`${e}px`}}(e,n),o.current=null})))}),[o,t]);Li.useEffect((()=>{function n(){r(s,e.eventRef)}const i=new t.ResizeObserver(n),o=e.eventRef.current?.closest(".calendar-viewport");return o&&o.addEventListener("scroll",n),t.addEventListener("resize",n),e.eventRef.current&&i.observe(e.eventRef.current),r(s,e.eventRef),()=>{o&&o.removeEventListener("scroll",n),e.eventRef.current&&i.unobserve(e.eventRef.current),t.removeEventListener("resize",n)}}),[e.eventRef,r,t]);const{saveEvent:l,trashEvent:d}=e,c=Li.useCallback((function(e){(0,ms.ZP)(e),l()}),[l]),u=Li.useCallback((function(e){(0,ms.ZP)(e),d()}),[d]),p=!!e.event.id,h=!!e.event.task;return(0,ss.jsx)("div",{className:"CalendarEventBubble panel-clickoutside-ignore",ref:s,"data-top":"225px",style:a?{display:"none"}:null,children:xO(za.Z,{focusName:"calendar_event",forceTrap:!0},void 0,LO,xO("div",{className:"CalendarEventBubble-Inner",role:"dialog","aria-modal":"true","aria-label":p?h?(0,B.Z)("Edit Task"):(0,B.Z)("Edit Event"):h?(0,B.Z)("New Task"):(0,B.Z)("New Event")},void 0,xO("form",{onSubmit:c},void 0,xO(xL,{event:e.event}),xO("div",{className:"CalendarEventBubble-Buttons"},void 0,xO("input",{type:"submit",disabled:!e.event.calendarId,value:p?(0,B.Z)("calendar","Done"):h?(0,B.Z)("Add Task"):(0,B.Z)("Add Event"),onClick:c}),xO("input",{type:"button",value:(0,B.Z)("calendar","Cancel"),onClick:()=>e.discardChanges()}),p&&xO("input",{type:"button",value:(0,B.Z)("verb","Delete"),onClick:u})))))})};var BO;function FO(e,t,n,i){BO||(BO="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:BO,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class WO extends Li.Component{static contextType=ts.Z;render(){const{event:e}=this.props;return(0,ss.jsxs)(ss.Fragment,{children:[FO("div",{className:"edit-group large-gap"},void 0,(0,ss.jsx)(dO,{...this.props,label:(0,B.Z)("Description"),field:"description"})),FO("div",{className:"edit-group"},void 0,(0,ss.jsx)(dO,{...this.props,label:(0,B.Z)("URL"),field:"url"})),e.attachment&&e.attachment.length>0&&FO("div",{className:"cal-event-attchments"},void 0,e.attachment.map((e=>FO("div",{className:"cal-event-attachment"},e.url,FO("span",{dangerouslySetInnerHTML:{__html:Wi.UEH.small}}),FO("a",{onClick:()=>c.ZP.openURL(this.context.vivaldiWindowId,e.url),title:e.url},void 0,e.filename||e.url)))))]})}}const UO=WO;var VO;function HO(e,t,n,i){VO||(VO="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:VO,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class GO extends Li.PureComponent{render(){return HO("div",{className:"cal-edit-tabs"},void 0,this.props.tabs.map((e=>{const{id:t,label:n,icon:i}=e;return HO("button",{className:Fi()("cal-edit-tab",{selected:this.props.currentTabId===t}),dangerouslySetInnerHTML:{__html:i},onClick:this.props.onSelectTab.bind(null,t),tabIndex:"-1",title:n},`tab-${t}`)})))}}const $O=GO;var KO=n(73935);const zO="basics";const jO=function(e,t,n,i){const s=Li.useContext(ts.Z),[o,a]=Li.useState({tabId:zO,toFocus:""}),r=Li.useRef(!1),l=Li.useRef(null),d=i?.[0].current,c=i?.[1].current,u=o.tabId,p=Li.useCallback(((t,n="")=>{if(!e.get(t)||t===u)return;const i=u?e.get(u):void 0,o=i&&i.containerRef.current,r=s.getSelection(),{document:l}=s;if(o?.contains(l.activeElement)){const e=[];if(r)for(let t=0;t<r.rangeCount;t++)e.push(r.getRangeAt(t));const t={element:l.activeElement,ranges:e};i&&(i.storedFocus=t)}l.activeElement?.blur(),a({tabId:t,toFocus:n})}),[e,s,u]);return Li.useEffect((()=>{const n=(t,n="first")=>{if(!e)return;const i=u?e.get(u):void 0;let s;"next"===t?(s=i&&i.index+1||0,s=s<e.size?s:0):(s=i&&i.index-1||0,s=s<0?e.size-1:s);const o=[...e.values()].find((e=>e.index===s));p(o&&o.id||zO,n)},i=n.bind(null,"next","first"),o=n.bind(null,"previous","last"),a=e=>{const{changeTab:t,direction:i,toFocus:s}=(e=>{const t=OM.Z[e.keyCode];return"PageUp"===t||"Tab"===t&&e.altKey&&e.shiftKey?{changeTab:!0,direction:"previous",toFocus:"first"}:"PageDown"===t||"Tab"===t&&e.altKey?{changeTab:!0,direction:"next",toFocus:"first"}:{changeTab:!1,direction:"next",toFocus:"first"}})(e);t&&(e.preventDefault(),n(i,s))},r=t=>{let n;e?.forEach((e=>{const i=e.containerRef.current;t.target instanceof s.HTMLElement&&i?.contains(t.target)&&(n=e.id)})),n&&n!==u&&p(n)};d&&d.addEventListener("focusin",o),c&&c.addEventListener("focusin",i);const l=t.current;return l&&(l.addEventListener("keydown",a),l.addEventListener("focusin",r)),()=>{l&&(l.removeEventListener("keydown",a),l.removeEventListener("focusin",r)),d&&d.removeEventListener("focusin",o),c&&c.removeEventListener("focusin",i)}}),[u,e,n,t,p,d,c,s]),Li.useEffect((function(){function i(e,t){s.requestAnimationFrame((()=>function(e,t,n){if(t.tabIndex<0){const e=t.tabIndex;t.tabIndex=0,t.focus(),t.tabIndex=e}else t.focus();const i=e.document.getSelection();if(!i)return;const{HTMLInputElement:s,HTMLElement:o}=e;if(t instanceof s&&"number"===t.type)t.select();else{if(i.focusNode&&i.focusNode.childNodes[i.focusOffset]===t)return;{const s=e.document.createRange();if(!(s&&t instanceof o))return;s.selectNodeContents(t);const a=t.hasChildNodes()?t.childNodes[0]:null;if(n&&a)try{s.setStart(a,n.start),s.setEnd(a,n.end)}catch(e){s.collapse(!1),nn.Z.error("Calendar","Setting caret position failed!",e)}else s.collapse(!1);i.removeAllRanges(),e.document.contains(s.commonAncestorContainer)&&i.addRange(s)}}}(s,e,t)))}const a=n&&!1===r.current;if(r.current=n,!n)return;const u=t.current,p=s.getSelection(),h=e.get(o.tabId);if(u&&h)if(a){e.forEach((e=>e.storedFocus=null)),s.requestAnimationFrame((()=>{u.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})}));const t=h.focusRef?.current;t&&i(t,l.current)}else{const e=!(!d||!c);if(e&&["first","last"].includes(o.toFocus)){let t=[];if(u instanceof s.HTMLElement&&(t=Array.from((0,Ra.Ng)(u))),e&&(t=t.slice(1,-1)),t=t.filter((e=>!e.parentElement?.className.includes("cal-event-body-buttons"))),t.length)"first"===o.toFocus?i(t[0]):i(t[t.length-1]);else{const e=h.focusRef&&h.focusRef.current;e&&i(e)}}else if(h.storedFocus){const e=h.storedFocus;e.element?.focus(),p&&(p.removeAllRanges(),e.ranges.forEach((e=>p.addRange(e))))}else if(!u.contains(s.document.activeElement)){const e=h.focusRef&&h.focusRef.current;e&&i(e)}}}),[o,n,t,e,d,c,s]),[o.tabId,e=>p(e,"first")]};var YO;function XO(e,t,n,i){YO||(YO="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:YO,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const QO=[I.kCalendarEditMode,I.kCalendarDisplayEventIcons,I.kCalendarDisplayDimPastEvents],qO=[["basics",(0,B.Z)("Basic Event Info"),Wi.qHs],["time",(0,B.Z)("Date and Time"),Wi.zTz],["recurrence",(0,B.Z)("Recurrence"),Wi.Eki],["location",(0,B.Z)("other","Location"),Wi.GF3],["description",(0,B.Z)("Description"),Wi.wTH],["participants",(0,B.Z)("Type to add Participants"),Wi.Rs2]],JO=[["basics",(0,B.Z)("Basic Task Info"),Wi.qHs],["time",(0,B.Z)("Date and Time"),Wi.zTz],["recurrence",(0,B.Z)("Recurrence"),Wi.Eki],["location",(0,B.Z)("other","Location"),Wi.GF3],["description",(0,B.Z)("Description"),Wi.wTH]],ex=e=>{const t=rh(e);let n=`${e.title||eh.gT}`;return t&&(n+=` (${t})`),e.location&&(n+=`\n${e.location}`),e.description&&(n+=`\n${e.description}`),n};function tx(e){["Space","Enter"].includes(OM.Z[e.keyCode])&&e.stopPropagation()}function nx(e){const t=Li.useContext(yM),n=Li.useContext(ts.Z),i=Li.useRef(new Map((e.event.task?JO:qO).map(((e,t)=>{const[n,i,s]=e;return[n,{id:n,label:i,icon:s,index:t,focusRef:Li.createRef(),containerRef:Li.createRef(),storedFocus:null}]})))),{event:s,isSelected:o,isEditing:a,isMultiDay:r,isFiltering:l,multiDayContinues:d,multiDayContinuing:c,dayOutOfTotalDays:u}=e,p=Li.useRef(null),h=Li.useRef(null),g=Li.useRef(null),m=(0,Ya.Z)(QO),[f,y]=jO(i.current,p,a,[h,g]),{trashEvent:b,getContextMenu:S}=SO(s),w=i.current.get("title"),C=i.current.get("time"),A=""===s.id,T=t.isWidget?"popup":m[I.kCalendarEditMode],Z=Li.useCallback((e=>{"Enter"!==OM.Z[e.keyCode]||e.shiftKey||(e.preventDefault(),e.stopPropagation(),t.handler.saveEventEdit())}),[t.handler]);Li.useEffect((()=>{a||y("basics")}),[a,y]);const E=Li.useCallback((()=>{A||b(),t.handler.cancelEventEdit()}),[t.handler,b,A]);let k;if(a&&"popup"===T){const e=n.document.querySelector("#main > .inner");e&&(k=KO.createPortal(XO(RO,{event:s,eventRef:p,saveEvent:t.handler.saveEventEdit,trashEvent:b,discardChanges:t.handler.cancelEventEdit}),e))}const _=Li.useCallback((()=>{if(!u||s.allDay||!e.isMultiDay)return"";const t=u.startOf("day").valueOf(),n=864e5,i=new Date(s.start).setHours(0,0,0,0),o=new Date(s.end).setHours(0,0,0,0),a=Math.trunc((o-i)/n)+1,r=Math.trunc((t-i)/n)+1;return(0,B.Z)("(day $1)",[`${r}/${a}`])}),[u,s.allDay,s.start,s.end,e.isMultiDay]),N=m[I.kCalendarDisplayDimPastEvents],P=s.end&&s.end<Date.now(),D=s.task&&!s.complete;return(0,ss.jsxs)(ss.Fragment,{children:[(0,ss.jsxs)("div",{className:Fi()(`calendar-event calendar${s.calendarId}`,e.className,{selected:o||a,editing:a&&"inline"===T,"all-day":r,solid:"solid"===e.displayStyle,"filtered-out":s.filteredOut&&!a,"task-completed":s.task&&s.complete,minimal:"minimal"===t.displayDensity,compact:"compact"===t.displayDensity,"event-passed":P&&N&&!l&&!a&&!D,"task-overdue":P&&!l&&!a&&D,"multiday-continuing":e.multiDayContinuing&&!a,"multiday-continues":e.multiDayContinues&&!a}),style:e.style,ref:p,onContextMenu:function(e){PL(n,e.target)?e.stopPropagation():(t.handler.selectEvent({event:s}),(0,cs.Z)(n,S())(e))},title:ex(s),"data-event-id":s.id,onClick:n=>{e.onClick?e.onClick(n):a||t.handler.editEvent(s),n.stopPropagation()},onKeyDown:Z,children:[a&&"inline"===T&&XO(za.Z,{focusName:"calendar_event_inline_edit",preventTrap:!0},void 0,XO($O,{tabs:Array.from(i.current.values()),currentTabId:f,onSelectTab:y}),XO("div",{className:"cal-event-body"},void 0,(0,ss.jsxs)(ss.Fragment,{children:[(0,ss.jsx)("span",{className:"sentry",tabIndex:"0",ref:h}),Array.from(i.current.values(),(e=>{const{id:n,label:i,focusRef:o}=e,a=f===n,r=a?0:-1,l={event:s,updateEvent:t.handler.updateEventEdit,field:n,label:i,focusRef:o,tabIndex:r};let d;switch(n){case"basics":d=(0,ss.jsx)(MO,{...l});break;case"recurrence":d=(0,ss.jsx)(YM.Z,{...l});break;case"description":d=(0,ss.jsx)(UO,{...l});break;case"time":d=(0,ss.jsx)(EO,{...l});break;case"participants":d=(0,ss.jsx)(zM,{...l});break;default:d=XO("div",{className:"edit-group"},void 0,(0,ss.jsx)(dO,{...l}))}return(0,ss.jsxs)("div",{ref:e.containerRef,className:Fi()("cal-event-body-edit",{selected:a}),children:[d,XO("div",{className:"cal-event-body-buttons"},void 0,""===s.id&&s.filteredOut&&XO("span",{className:"cal-event-body-filtered-warning",dangerouslySetInnerHTML:{__html:Wi.h6},title:s.task?(0,B.Z)("Once saved this task will be hidden by current search"):(0,B.Z)("Once saved this event will be hidden by current search")}),t.isTaskList&&!s.task&&XO("span",{className:"cal-event-body-filtered-warning",dangerouslySetInnerHTML:{__html:Wi.h6},title:(0,B.Z)("Once saved this event will not show in the task list")}),XO("input",{onClick:t.handler.saveEventEdit,onKeyDown:tx,tabIndex:r,type:"submit",disabled:!s.calendarId,value:(0,B.Z)("calendar","Done")}),XO("input",{onClick:E,onKeyDown:tx,tabIndex:r,type:"button",value:A?(0,B.Z)("Cancel"):(0,B.Z)("verb","Delete")}))]},e.id)})),(0,ss.jsx)("span",{className:"sentry",tabIndex:"0",ref:g})]}))),(!a||"popup"===T)&&XO("div",{className:"cal-event-body"},void 0,XO("div",{className:"cal-event-header"},void 0,!r&&"transparent"===e.displayStyle&&!s.task&&XO("span",{className:"cal-event-dot",dangerouslySetInnerHTML:{__html:Zl.ZP.getEventSquircle()}}),s.task&&XO("input",{type:"checkbox",checked:s.complete,onChange:e.onCompleteChanged??function(n){const{checked:i}=n.target,s=(0,v.Uy)(e.event,(e=>{e.complete=i}));te.ZP.updateEvent(s,"single",!0,t.pageId)},onMouseDown:ms.ZP,onClick:ms.ZP,tabIndex:"-1"}),!r&&(s.start||s.task)&&!!s.end&&!c&&(0,ss.jsx)("span",{className:"cal-event-time",ref:C?.focusRef,children:lh(s.start||s.end)}),!r&&!!s.end&&!d&&c&&(0,ss.jsx)("span",{className:"cal-event-time",ref:C?.focusRef,children:lh(s.end)}),ph(n,"title",s.title||eh.gT,w?.focusRef),u&&XO("span",{},void 0,_()),m[I.kCalendarDisplayEventIcons]&&XO("div",{className:"cal-event-icons"},void 0,s.url&&XO("span",{dangerouslySetInnerHTML:{__html:Wi.wTH},className:"cal-event-icon-link",onClick:e=>{Hr.QJ.openURL(n.vivaldiWindowId,s.url),(0,ms.ZP)(e)}}),s.location&&XO("span",{dangerouslySetInnerHTML:{__html:Wi.GF3},onClick:()=>y("location")}),!(!s.notifications||!s.notifications.length)&&XO("span",{dangerouslySetInnerHTML:{__html:Wi.PPL},onClick:()=>y("time")}),Zl.ZP.isRecurringEvent(s)&&XO("span",{dangerouslySetInnerHTML:{__html:Wi.Eki},onClick:()=>y("recurrence")}),s.attachment&&s.attachment.length>0&&XO("span",{dangerouslySetInnerHTML:{__html:Wi.UEH.small},onClick:()=>y("description")}))),"minimal"!==t.displayDensity&&XO("div",{className:"cal-event-body-content"},void 0,ph(n,"description",s.description||""),ph(n,"location",s.location||""),ph(n,"url",s.url||""))),e.resizeHandler&&!c&&XO("div",{className:"calendar-event-resizer pre "+e.resizeHandler}),e.resizeHandler&&!d&&XO("div",{className:"calendar-event-resizer post "+e.resizeHandler})]}),k]})}function ix(e,t){var n,i;return!e.isEditing&&!t.isEditing&&(e.event===t.event&&e.isSelected===t.isSelected&&e.isMultiDay===t.isMultiDay&&e.isFiltering===t.isFiltering&&(n=e.style,i=t.style,!n&&!i||!!n&&!!i&&n.gridRowStart===i.gridRowStart&&n.gridRowEnd===i.gridRowEnd&&n.gridColumnStart===i.gridColumnStart&&n.gridColumnEnd===i.gridColumnEnd))}const sx=Li.memo(nx,ix),ox="vivaldi/x-calendar-event",ax="vivaldi/x-calendar-create-event",{minimalCreateEvent:rx}=Zl.ZP,lx={dragging:!1,cancelled:!1,currentX:null,currentY:null,xOffset:0,yOffset:0,initialTime:0,initialEndTime:0,initialStartRow:0,initialEndRow:0,initialLeftCol:0,initialRightCol:0,resizeEvent:null,draggingFrom:"start",isAllDay:!1};function dx(e,t,n,i,s){const[o,a]=Li.useState(null),[r,l]=Li.useState(null),d=Li.useRef(null),c=Li.useRef(null),u=Li.useRef(i);u.current=i;const p=Li.useContext(ts.Z),{document:h,getComputedStyle:g}=p,{handler:m}=Li.useContext(yM),f=Li.useRef(),v=Li.useRef({...lx});Li.useEffect((()=>{const e=h.createElement("div");return e.classList.add("calendar-drag-image"),f.current=e,h.body?.append(e),()=>{e.remove()}}),[h]);const y=Li.useCallback((()=>{e&&a({gridTemplateColumns:g(e).gridTemplateColumns,gridTemplateRows:g(e).gridTemplateRows})}),[e,g]),b=Li.useCallback((()=>{a(null)}),[]),S=Li.useCallback((()=>{d.current=null,l(d.current),v.current={...lx},s(!1),b()}),[b,s]);function w(){const{resizeEvent:s}=v.current;if(v.current.dragging){if(s){const t=n(e,v.current,d.current,i);if(!t)return void S();if(t&&!(0,QT.Z)(t,c.current)){const e=s.dataset.eventId,n=u.current;if(n&&n.id===e)n.start=t.startTime,n.end=t.endTime,m.updateEventEdit(n);else{const n=El.Z.getEvent(e);n&&m.editEvent({...n,start:t.startTime,end:t.endTime})}c.current=t}}else{const n=t(e,v.current,d.current);if(!n)return void S();(0,QT.Z)(d.current,n)||l(n),d.current=n}p.requestAnimationFrame(w)}else if(v.current.cancelled)s&&m.cancelEventEdit(),S();else{const e=d.current;e?m.editEvent(null,rx({start:e.startTime,end:e.endTime,allDay:e.isAllDay})).then(S):s&&m.saveEventEdit().then(S)}}return{gridFrozen:o,handlers:{onDragStart:e=>{if(!e.dataTransfer.items.length){const t=h.elementFromPoint(e.clientX,e.clientY),n=t?.closest(".calendar-event");if(t instanceof p.HTMLElement&&t.classList.contains("calendar-event-resizer"))v.current.resizeEvent=t.parentElement instanceof p.HTMLElement&&t.parentElement||null,t.classList.contains("pre")?v.current.draggingFrom="start":v.current.draggingFrom="end",s(!0);else if(n instanceof p.HTMLElement){const o=n.dataset.eventId;if(i&&"DIV"!==t?.tagName)return void(0,ms.ZP)(e);e.dataTransfer&&o&&(e.dataTransfer.setData(ox,JSON.stringify({id:o})),e.dataTransfer.effectAllowed="copyMove",e.stopPropagation());const a=n.getBoundingClientRect(),r=Math.round(a.width/2),l=Math.round(e.clientX-a.left),d=Math.round(e.clientY-a.top);return v.current.xOffset=l-r,v.current.yOffset=d,e.dataTransfer.setDragImage(n,l,d),void s(!0)}f.current&&e.dataTransfer.setDragImage(f.current,0,0),e.dataTransfer.setData(ax,!0),v.current.dragging=!0,v.current.currentX=e.clientX,v.current.currentY=e.clientY,v.current.resizeEvent||y(),e.stopPropagation(),p.requestAnimationFrame(w)}},onDragOver:e=>{e.dataTransfer.types.some((e=>e===ax))&&(v.current.currentX=e.clientX,v.current.currentY=e.clientY,(0,ms.ZP)(e))},onDragEnd:e=>{v.current.resizeEvent||s(!1),e.dataTransfer.types.some((e=>e===ox))&&e.stopPropagation(),"none"===e.dataTransfer.dropEffect&&(v.current.dragging=!1,v.current.cancelled=!0,(0,ms.ZP)(e))},onDrop:e=>{v.current.resizeEvent||s(!1),e.dataTransfer.types.some((e=>e===ax))&&(v.current.currentX=e.clientX,v.current.currentY=e.clientY,v.current.dragging=!1,e.stopPropagation())}},overlay:r,dragOffset:{xOffset:v.current.xOffset,yOffset:v.current.yOffset}}}const cx=function(e){const{HTMLElement:t}=Li.useContext(ts.Z),{isEditing:n,isWidget:i}=Li.useContext(yM),s=Li.useRef(0),o=Li.useRef(0);return function(a){if(n||i)return;const{deltaX:r,deltaY:l,currentTarget:d}=a;if(!(d instanceof t))return;const c=Date.now(),u=c-s.current>50;if(s.current=c,!u)return;const p=d.scrollHeight,h=d.clientHeight,g=d.scrollTop;if(Math.floor(g)>0&&Math.ceil(g)+h<p||c-o.current<200)return;if(!a.shiftKey)return;o.current=c,(0===Math.abs(l)?r:l)>0?(d.scrollHeight===d.clientHeight||d.scrollHeight<=d.clientHeight+Math.ceil(d.scrollTop))&&(a.stopPropagation(),bO.Z.viewNextPeriod(e)):Math.floor(d.scrollTop)<=0&&(a.stopPropagation(),bO.Z.viewPreviousPeriod(e))}};var ux=n(23542),px=n(90870);function hx(e){return e.task?e.start?{start:e.start,end:e.end}:{start:e.end,end:e.end?e.end+1:0}:{start:e.start,end:e.end}}function gx(e,t=!1){const n=t?Math.ceil:Math.floor,i=new Date(e);return 4*i.getHours()+n(i.getMinutes()/15)}function mx(e,t){e.items.forEach((n=>{const i=bx(e.items,n,t).sort(((e,t)=>e.stacking-t.stacking));let s=0;for(;i[s]&&s===i[s].stacking;)s++;n.stacking=s,n.adjacent=i}))}function fx(e){e.items.forEach((e=>{const t=new Set(e.adjacent.map((e=>e.stacking))).size;e.stackSize=t+1}))}const vx=(e,t)=>0===t?e:vx(t,e%t),yx=(e,t)=>e*t/vx(e,t);function bx(e,t,n){return e.filter((e=>e!==t&&("day"===n?e.startRow<t.endRow&&e.endRow>t.startRow:e.startCol<t.endCol&&e.endCol>t.startCol)))}const Sx=gs()(((e,t,n)=>{let i=function(e,t){e.sort(((e,t)=>{const{start:n,end:i}=hx(e),{start:s,end:o}=hx(t);if(n!==s)return n-s;const a=i-n,r=o-s;return a!==r?r-a:(parseInt(e.id)||1/0)-(parseInt(t.id)||1/0)}));const n=e.map((e=>{const{start:t,end:n}=hx(e),i=gx(t);let s=gx(n,!0);return 0===s&&t!==n&&(s=96),{event:e,adjacent:[],stacking:1/0,stackSize:-1,startRow:i,endRow:s>i?s:i+1,startCol:0,endCol:0}}));return{columns:-1,maxStackSize:0,items:n}}(e);return mx(i,"day"),fx(i),i=function(e){const t=[...new Set(e.items.map((e=>e.stackSize)))],n=t.reduce(((e,t)=>t>e?t:e),-1),i=Math.min(Math.max(100,n),t.reduce(((e,t)=>yx(e,t)),1)),s=i/n;return{columns:i,maxStackSize:n,items:e.items.map((e=>(e.startCol=Math.ceil(e.stacking*s),e.endCol=Math.floor((e.stacking+1)*s),e)))}}(i),function(e){e.items.sort(((e,t)=>{const n=t.stacking-e.stacking;return 0!==n?n:e.startRow-t.startRow}));const t=[];e.items.forEach((n=>{const i=bx(t,n,"day"),s=Math.min(...i.map((e=>e.startCol)),e.columns),o=s/n.endCol;n.endCol=s,n.startCol=Math.ceil(n.startCol*o),t.push(n)}))}(i),i}),{maxSize:2});const wx=gs()(((e,t,n)=>{let i=function(e,t,n){const i=t.clone().startOf("day"),s=e=>{let{start:t,end:s}=hx(e);return s===W()(s).startOf("day").valueOf()&&(s-=1),[(0,Gw.Z)(W()(t).diff(i,"day"),0,n-1),(0,Gw.Z)(W()(s).diff(i,"day")+1,1,n)]};let[o,a]=(0,px.Z)(e,(e=>{const[t,n]=s(e);return n-t>1}));const r=o.sort(((e,t)=>{const{start:n,end:i}=hx(e),{start:s,end:o}=hx(t),a=(i||p.Lc)-n,r=(o||p.Lc)-s;return a!==r?r-a:n!==s?n-s:(parseInt(e.id)||1/0)-(parseInt(t.id)||1/0)})).map((e=>{const[t,n]=s(e);return{event:e,adjacent:[],stacking:1/0,stackSize:-1,startCol:t,endCol:n,startRow:0,endRow:0}}));a=a.sort(((e,t)=>{if(!e.id||!t.id)return e.id?-1:1;const n=Zl.ZP.isMultiDayEvent(e);if(n!==Zl.ZP.isMultiDayEvent(t))return n?-1:1;const{start:i,end:s}=hx(e),{start:o,end:a}=hx(t);if(i!==o)return i-o;const r=(s||p.Lc)-i,l=(a||p.Lc)-o;return r!==l?l-r:(parseInt(e.id)||1/0)-(parseInt(t.id)||1/0)}));const l=[],d=i.clone();for(;d.diff(i,"day")<n;){const e=Zl.ZP.filterEventsByPeriod(a,d,"day"),t=(0,Gw.Z)(d.diff(i,"day"),0,n-1);l.push({events:e,adjacent:[],stacking:1/0,stackSize:-1,startCol:t,endCol:t+1,startRow:0,endRow:0,date:d.valueOf()}),d.add(1,"day")}return{rows:-1,maxStackSize:0,items:r,multiEventItems:l,startTime:i.valueOf(),endTime:d.valueOf()}}(e,t,n);return mx(i,"week"),fx(i),i=(e=>{const t=[...new Set(e.items.map((e=>e.stackSize)))].reduce(((e,t)=>t>e?t:e),0);return{...e,rows:t,maxStackSize:t,items:e.items.map((e=>(e.startRow=e.stacking,e.endRow=e.stacking+1,e)))}})(i),i=(e=>{const t=e.multiEventItems.length?e.rows+1:e.rows,n=e.multiEventItems.map((n=>{const i=bx(e.items,n,"week"),s=Math.max(0,...i.map((e=>e.endRow)));return{...n,startRow:s,endRow:t}}));return{...e,rows:t,multiEventItems:n}})(i),i}),{maxSize:10});var Cx;function Ax(e,t,n,i){Cx||(Cx="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Cx,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Ix=(0,ux.extendMoment)(W()),Tx=[I.kCalendarClickTimeSlot,I.kCalendarDisplayWeekNumber],{minimalCreateEvent:Zx,getDisplayRange:Ex}=Zl.ZP;function kx(e,t,n,i){const{resizeEvent:s}=t;if(!e||!s)return;const o=e.querySelectorAll(".calendar-drop-target"),a=!t.initialTime,r=t.currentX||1e5,l=t.currentY||1e5,d=Array.from(o).find((e=>{const t=e.getBoundingClientRect();return t.bottom>l&&t.right>r}));if(!d)return;if(a){const e=i??El.Z.getEvent(s.dataset.eventId);if(!e)return;t.initialTime=e.start,t.initialEndTime=e.allDay?e.end-me.hd:e.end,t.isAllDay=e.allDay??!1}const c=parseInt(d.dataset.date),u=c+(0,ih.oR)(t.initialTime),p=c+(0,ih.oR)(t.initialEndTime);let h,g;return"end"===t.draggingFrom&&p<=t.initialTime||"start"===t.draggingFrom&&u<t.initialEndTime?(h=u,g=t.initialEndTime):(h=t.initialTime,g=p),{startTime:h,endTime:g,isAllDay:t.isAllDay}}function _x(e,t){if(!e)return;const n=Array.from(e.querySelectorAll(".calendar-drop-target")),i=!t.initialTime,s=t.currentX||1e5,o=t.currentY||1e5,a=n.find((e=>{const t=e.getBoundingClientRect();return t.bottom>o&&t.right>s}));if(a&&i){const{resizeEvent:e}=t;if(e)return;t.initialTime=parseInt(a.dataset.date),t.initialEndTime=t.initialTime,t.initialLeftCol=parseInt(a.style.gridColumnStart),t.initialRightCol=t.initialLeftCol+1,t.initialStartRow=parseInt(a.style.gridRowStart),t.initialEndRow=t.initialStartRow+parseInt(a.style.gridRowEnd.match(/\d/)?.[0]),t.isAllDay=!0}if(a){const e=t.initialLeftCol,n=t.initialStartRow,i=parseInt(a.style.gridColumnStart),s=parseInt(a.style.gridRowStart);let o,r,l,d,c,u,p=!0,h="initialStartToCurrent";return(parseInt(a.dataset.date)<t.initialTime||t.resizeEvent&&"start"===t.draggingFrom)&&(h="initialEndToCurrent",p=!1),"initialStartToCurrent"===h?(o=e,r=parseInt(a.style.gridColumnStart)+1,l=n,d=parseInt(a.style.gridRowStart)+parseInt(a.style.gridRowEnd.match(/\d/)?.[0])):(o=i,r=t.initialRightCol,l=s,d=t.initialEndRow),p?(c=t.initialTime,u=parseInt(a.dataset.date)+(0,ih.oR)(t.initialEndTime)):(c=parseInt(a.dataset.date)+(0,ih.oR)(t.initialTime),u=t.initialEndTime),{startCol:o,endCol:r,startRow:l,endRow:d,startTime:c,endTime:u,isAllDay:t.isAllDay}}}function Nx(e){return e.reduce(((e,t)=>e=(e=e.concat(t.items.map((e=>e.event)))).concat(t.multiEventItems.reduce(((e,t)=>e.concat(t.events)),[]))),[])}function Px(e){const t=(0,Ya.Z)(Tx);if(!e.overlay)return null;const{startRow:n,endRow:i,startCol:s,endCol:o,startTime:a,endTime:r}=e.overlay,l="week"===e.displayMode?1:2,d=t[I.kCalendarDisplayWeekNumber]&&"week"!==e.displayMode?2:1,c="week"===e.displayMode?2:7;return e.grids.reduce((([t,l],u)=>{const p=u.rows+2,h=l===n,g=l+p===i,m=Fi()("calendar-drag-overlay",{left:h,right:g});if(h){const i={gridRowStart:n,gridRowEnd:l+p,gridColumnStart:s,gridColumnEnd:g?o:d+c},u=e.overlay?.isAllDay??1?"L":"LLL";t.push(Ax("div",{className:m,style:i},l,Ax("div",{className:"start-time"},void 0,h&&(0,ss.jsx)(ss.Fragment,{children:Ix(a).format(u)})),Ax("div",{className:"end-time"},void 0,g&&(0,ss.jsx)(ss.Fragment,{children:Ix(r).format(u)}))))}else if(l>n&&l<i){const n={gridRowStart:l,gridRowEnd:l+p,gridColumnStart:d,gridColumnEnd:g?o:d+c},i=e.overlay?.isAllDay??1?"L":"LLL";t.push(Ax("div",{className:m,style:n},l,Ax("div",{className:"start-time"},void 0,h&&Ax("span",{},void 0,Ix(a).format(i))),Ax("div",{className:"end-time"},void 0,g&&Ax("span",{},void 0,Ix(r).format(i)))))}return[t,l+p]}),[[],l])}function Dx(e){const t=e.showWeekNumber?2:1,n=Ix().startOf("week");return[...Array(7).keys()].map((e=>{const i=Ax(Li.Fragment,{},e,Ax("header",{style:{gridColumnStart:e+t},className:"calendar-header-date"},void 0,n.format("dddd")));return n.add(1,"days"),i}))}function Mx(e){const{requestAnimationFrame:t}=Li.useContext(ts.Z),{handler:n,pageId:i}=Li.useContext(yM),[s,o]=Li.useState(""),a=(0,Ya.Z)(Tx),{displayMode:r,editingEvent:l,grids:d,filter:c,selectedEvent:u,isActiveEditor:p}=e,h=Li.useCallback(((e,t)=>{e.dataTransfer.types.some((e=>e===ox))&&(e.preventDefault(),e.stopPropagation(),o(t))}),[]),g=Li.useCallback((e=>{e.dataTransfer.types.some((e=>e===ox))&&(e.preventDefault(),e.stopPropagation())}),[]),m=Li.useCallback((e=>{e.dataTransfer.types.some((e=>e===ox))&&(e.preventDefault(),e.stopPropagation())}),[]),f=Li.useCallback(((t,n)=>{const s=t.dataTransfer;if(s.types.some((e=>e===ox))){t.preventDefault(),t.stopPropagation();const a=JSON.parse(s.getData(ox)).id.split("-")[0];if(e.events.find((e=>e.id===a))){("copy"===s.effectAllowed?te.ZP.copyEvent:te.ZP.moveEvent)(a,{start:n,byDateOnly:!0},i),o("")}}}),[i,e.events]),v=e.displayRange.start.valueOf(),y=a[I.kCalendarDisplayWeekNumber]&&"week"!==e.displayMode,b=Li.useMemo((()=>{const i=e.filter;const o=Ix(v),r=y?2:1,l=i.anchorDate.month(),d=new Date,c="week"===e.displayMode?2:7;let u="week"===e.displayMode?2:3;return e.grids.flatMap(((p,v)=>{const b=[];return y&&b.push(Ax(Li.Fragment,{},v,Ax("div",{className:"week-number",style:{gridRowStart:u-1,gridRowEnd:`span ${p.rows+2}`}},void 0,Ax("span",{className:"week-number-value"},void 0,o.week())))),[...Array(c).keys()].forEach((c=>{if("week"===e.displayMode&&3===v&&1===c)return;const y=`${v}-${c}`,S=o.valueOf(),w=o.month()===l,C=Number(o.format("E"))>5,A="week"!==e.displayMode&&(0===v&&0===c||1===o.date()),T=o.date()===d.getDate()&&o.month()===d.getMonth()&&o.year()===d.getFullYear(),Z=i.selectedDate&&o.isSame(i.selectedDate,"day");function E(e){!function(e,t){"click"===e.type&&e.stopPropagation();const i=t+(new Date).getHours()*me.QI;"select"===a[I.kCalendarClickTimeSlot]||"contextmenu"===e.type?n.selectDate(Ix(i),!0):n.editEvent(null,Zx({start:i}))}(e,S)}b.push(Ax("div",{className:Fi()("calendar-drop-target",{current:T,"dragged-over":y===s,"out-of-view":"month"===e.displayMode&&!w,weekend:C}),"data-date":S,style:{gridRowStart:u-1,gridRowEnd:`span ${p.rows+2}`,gridColumnStart:c+r},onDragEnter:e=>h(e,y),onDragOver:m,onDragLeave:g,onDrop:e=>f(e,S),onClick:E,onContextMenu:E},y,(0,ss.jsxs)("div",{className:Fi()("day",{current:T}),ref:e=>{Z&&e&&t((()=>{e.scrollIntoView({block:"nearest",inline:"nearest"})}))},onClick:e=>{e.stopPropagation(),n.selectDate(Ix(S),!0)},children:[o.format("D"),"week"===e.displayMode&&" "+o.format("ddd"),A&&" "+o.format("MMM")]}))),o.add(1,"day")})),u+=p.rows+2,b}))}),[s,v,e.displayMode,e.grids,a,e.filter,y,t,n,h,m,g,f]),S=[...b];if(e.filter.selectedDate){const i="week"===e.displayMode?2:7,s=e.filter.selectedDate.valueOf()-v,o=Math.floor(s/(i*me.hd)),a=e.grids.slice(0,o+1).reduce(((e,t)=>e+t.rows+2),0)+("week"===e.displayMode?0:1),r=Math.floor(s/me.hd)%i+(y?2:1),l=!e.selectedEvent&&!e.editingEvent;S.push((0,ss.jsx)("div",{className:Fi()("calendar-add-event-button","selected","bottom",{active:l}),style:{gridRowStart:a,gridRowEnd:"span 1",gridColumnStart:r},ref:e=>{l&&e&&t((()=>{e.scrollIntoViewIfNeeded({block:"nearest",inline:"nearest"})}))},onClick:l?()=>function(e,t){const n=e.selectedDate?e.selectedDate.clone().startOf("day").valueOf()+(new Date).getHours()*me.QI:0;t.editEvent(null,Zx({start:n}))}(e.filter,n):Lr.Z,dangerouslySetInnerHTML:{__html:Wi.PbG}},"add-event-button"))}const w=Boolean(c.filterText),C=Li.useMemo((()=>({displayStyle:"transparent",isFiltering:w})),[w]);let A=[],T="week"===r?2:3;const Z=a[I.kCalendarDisplayWeekNumber]&&"week"!==r?1:0;return d.forEach(((t,n)=>{A=A.concat(t.items.map((n=>{const i=n.event.end,s=p&&l?.id===n.event.id&&!e.isDragging,o=n.event.id.split("-")[0]===u?.split("-")[0],a=s&&l?l:n.event,r={gridRowStart:n.startRow+T,gridColumnStart:n.startCol+Z+1,gridColumnEnd:n.endCol+Z+1};return(0,ss.jsx)(sx,{multiDayContinuing:(n.event.start||1/0)<t.startTime,multiDayContinues:i>t.endTime,event:a,style:r,...C,isMultiDay:Zl.ZP.isMultiDayEvent(n.event),isSelected:o,isEditing:s,resizeHandler:"horizontal"},`${Zl.ZP.generateKey(n.event)}-${r.gridRowStart}`)}))),A=A.concat(t.multiEventItems.map(((i,s)=>{const o=l&&i.events.some((e=>e.id===l.id)),a=new Date(i.date).toDateString(),r=`${n}-${s}`;return Ax("div",{className:Fi()("event-container",{selected:o}),style:{gridRowStart:i.startRow+T,gridRowEnd:t.rows+T,gridColumnStart:i.startCol+Z+1,gridColumnEnd:i.endCol+Z+1},onDragEnter:e=>h(e,r),onDragOver:m,onDragLeave:g,onDrop:e=>f(e,i.date),"data-date":i.date},`${a}-${T}`,i.events.map((n=>{const i=p&&l?.id===n.id&&!e.isDragging,s=n.id.split("-")[0]===u?.split("-")[0],o=i&&l?l:n;return(0,ss.jsx)(sx,{event:o,...C,multiDayContinuing:(n.start||1/0)<t.startTime,multiDayContinues:n.end>t.endTime,isMultiDay:Zl.ZP.isMultiDayEvent(n),isSelected:s,isEditing:i,resizeHandler:"horizontal"},Zl.ZP.generateKey(n))})))}))),T+=t.rows+2})),S.push(...A),S}const Ox=function(e){const t=(0,Ya.Z)(Tx),{handler:n,pageId:i}=Li.useContext(yM),s=cx(i),o=Li.useRef(null),[a,r]=Li.useState([]),[l,d]=Li.useState(Ix.range()),[c,u]=Li.useState(!1),{gridFrozen:p,handlers:h,overlay:g}=dx(o.current,_x,kx,e.editingEvent,u),m=Li.useRef({selectedEventCache:new Map,lastSelectedEvent:null,updateCreateOverlay:()=>{}}),{events:f,filter:v,displayMode:y}=e;function b(e,t,i,s){const a=o.current;if(!a)return;const r=e||m.current.lastSelectedEvent,l=r?a.querySelector(`[data-event-id="${r.id}"]`):a.querySelector(`#${i.toDate().toDateString()}`),d=i.clone();if("Left"===s?d.subtract(1,"day"):d.add(1,"day"),!l)return m.current.selectedEventCache.clear(),void n.selectDate(d,!0);const c=new IntersectionObserver((e=>{let i;const s=[];for(const n of e){const e=n.boundingClientRect;if(n.target===l)i=e;else{const i=n.target.dataset.eventId,o=t.find((e=>e.id===i));s.push({event:o,element:n.target,bounds:e})}}const o=s.filter((e=>e.bounds.bottom>i.top&&e.bounds.top<i.bottom)).sort(((e,t)=>{const n=(i.top+i.bottom)/2,s=(e.bounds.top+e.bounds.bottom)/2,o=(t.bounds.top+t.bounds.bottom)/2;return Math.abs(s-n)-Math.abs(o-n)}));if(o.length){S({event:o[0].event,date:d})}else n.selectDate(d,!0);c.disconnect()}));c.observe(l);for(const e of t){const t=a.querySelector(`[data-event-id="${e.id}"]`);t&&c.observe(t)}}function S(e){const{event:t}=e;if(t){const e=Ix(t.start).format("YYYY-MM-DD");m.current.selectedEventCache.set(e,t),m.current.lastSelectedEvent=t}else m.current.selectedEventCache=new Map,m.current.lastSelectedEvent=null;n.selectEvent({...e,allDay:!0})}Li.useMemo((()=>{let t=f;c&&e.editingEvent&&(t=f.map((t=>t.id===e.editingEvent?.id?e.editingEvent:t)).filter(Boolean));const n=function(e,t,n){const i=Ex(t,n),s=[],o=i.start.clone(),a="week"===n?2:7;for(;o<i.end;){const t=o.valueOf(),n=Zl.ZP.filterEventsByPeriod(e,o,"day",a).map((e=>(e.start||e.end)<t?{...e,id:`${e.id}-${o.dayOfYear()}`}:e)),r=o.isSame(i.end,"day")?1:a;s.push(wx(n,o,r)),o.add(a,"day")}return{grids:s,displayRange:i}}(t,v.anchorDate,y);r(n.grids),d(n.displayRange)}),[y,f,v.anchorDate,c,e.editingEvent]);let w={};if(p)w=p;else{const t="week"===e.displayMode?"":"max-content ";w.gridTemplateRows=a.reduce(((e,t)=>`${e} 1.9em ${"max-content ".repeat(Math.max(t.rows-1,0))} ${t.rows?"minmax(min-content, max-content) ":""} minmax(20px, 1fr) `),t)}const C=t[I.kCalendarDisplayWeekNumber]&&"week"!==y;return(0,ss.jsxs)("div",{className:Fi()("calendar-grid calendar-grid-days",`calendar-grid-${e.displayMode}`,{"is-dragging":c,"show-weeknumber":C}),ref:o,onKeyDown:function(t){const s=Nx(a),o=t.altKey;if(!e.editingEvent){const a="week"===e.displayMode?2:7,r=s.find((t=>t.id===e.selectedEvent)),{selectedDate:d}=e.filter;if(!d)return void console.error("Can not navigate day grid. No selected calendar date.");const c=d.weekday();switch(OM.Z[t.keyCode]){case"Left":{if(c%a==0)break;const e=d.clone().subtract(1,"day"),t=e.format("YYYY-MM-DD"),i=m.current.selectedEventCache.get(t);if(i){S({event:i,date:e});break}if(r||m.current.lastSelectedEvent){b(r,Zl.ZP.filterEventsByPeriod(s,e,"day"),d,"Left")}else n.selectDate(e,!0);break}case"Right":{if(c%a==a-1||6===c)break;const e=d.clone().add(1,"day"),t=e.format("YYYY-MM-DD"),i=m.current.selectedEventCache.get(t);if(i){S({event:i,date:e});break}if(r||m.current.lastSelectedEvent){b(r,Zl.ZP.filterEventsByPeriod(s,e,"day"),d,"Right")}else n.selectDate(e,!0);break}case"Up":{m.current.selectedEventCache=new Map,m.current.lastSelectedEvent=null;const t=Zl.ZP.filterEventsByPeriod(s,d,"day"),i=t.findIndex((t=>t.id===e.selectedEvent));if(-1===i&&t.length&&!o)S({event:t[t.length-1],date:d});else if(0===i||!t.length||o){let t=a;"week"===e.displayMode&&c<2&&(t=0===c?1:3),n.selectDate(d.clone().subtract(t,"day"),!0)}else S({event:t[i-1],date:d});break}case"Down":{m.current.selectedEventCache=new Map,m.current.lastSelectedEvent=null;let t=Zl.ZP.filterEventsByPeriod(s,d,"day");const i=t.findIndex((t=>t.id===e.selectedEvent));let r=a;if("week"===e.displayMode&&c>=5&&(r=5===c?3:1),o){const e=d.clone().add(r,"day");n.selectDate(e,!0)}else if(-1===i){const e=d.clone().add(r,"day");if(e.isAfter(l.end,"day")){const n=mh.tV.call(El.Z.getEvents(),e,"day");t=Nx([wx(n,e,1)])}else t=Zl.ZP.filterEventsByPeriod(s,e,"day");t.length?S({event:t[0],date:e}):n.selectDate(e,!0)}else i===t.length-1?S({event:null}):S({event:t[i+1],date:d});break}case"Enter":if((0,ms.ZP)(t),e.selectedEvent){const t=s.find((t=>t.id===e.selectedEvent));n.editEvent(t)}else{const e=d.clone().hours((new Date).getHours()).valueOf();n.editEvent(null,Zx({start:e}))}break;case"Space":const u=e.selectedEvent&&s.find((t=>t.id===e.selectedEvent));if(u&&u.task){(0,ms.ZP)(t);const e={...u,complete:!u.complete};te.ZP.updateEvent(e,"single",!0,i)}break;case"Escape":(0,ms.ZP)(t),e.selectedEvent&&S({event:null})}}},draggable:!0,...h,style:w,tabIndex:"0",onWheel:s,children:["week"!==e.displayMode&&Ax(Dx,{showWeekNumber:C}),Ax(Mx,{grids:a,events:f,displayRange:l,displayMode:y,editingEvent:e.editingEvent,selectedEvent:e.selectedEvent,filter:v,isActiveEditor:!!e.editingEvent,isDragging:c,setIsDragging:u}),Ax(Px,{overlay:g,displayMode:y,grids:a})]})};function xx(e){return"time"in e}function Lx(e,t,n,i){let s,o,a;const r=n||t;let l;const d=i[8];switch(e){case"Left":l=r.isAllDay?r:t,s=e=>e.navigation.right<r.navigation.right&&e.navigation.top<l.navigation.bottom&&e.navigation.bottom>l.navigation.top,o=(e,t)=>t.navigation.right-e.navigation.right,a=(e,t)=>e.navigation.top-t.navigation.top;break;case"Right":l=r.isAllDay?r:t,s=e=>e.navigation.right>r.navigation.right&&e.navigation.left>=r.navigation.left&&e.navigation.top<l.navigation.bottom&&e.navigation.bottom>l.navigation.top,o=(e,t)=>e.navigation.left-t.navigation.left,a=(e,t)=>e.navigation.top-t.navigation.top;break;case"Up":{const e=d.display.bottom-d.display.top-1;l=r.isAllDay?t:r,s=e=>e.navigation.bottom<=r.navigation.top&&e.navigation.left<l.navigation.right&&e.navigation.right>l.navigation.left,o=(t,n)=>{const i=xx(t)||t.isAllDay?t.navigation.bottom:t.navigation.bottom+e;return(xx(n)||n.isAllDay?n.navigation.bottom:n.navigation.bottom+e)-i},a=(e,t)=>e.navigation.left-t.navigation.left;break}case"Down":{const e=d.display.bottom-d.display.top-1;l=r.isAllDay?t:r,s=e=>e.navigation.top>=r.navigation.bottom&&e.navigation.left<l.navigation.right&&e.navigation.right>l.navigation.left,o=(t,n)=>(!xx(t)||t.isAllDay?t.navigation.top-e:t.navigation.top)-(!xx(n)||n.isAllDay?n.navigation.top-e:n.navigation.top),a=(e,t)=>e.navigation.left-t.navigation.left;break}default:return}const c=i.filter(s).sort(((e,t)=>{const n=o(e,t);return 0!==n?n:xx(e)!==xx(t)?xx(e)?1:-1:a(e,t)}));return c.length?c[0]:null}var Rx,Bx=n(98891),Fx=n(84584),Wx=n(34155);function Ux(e,t,n,i){Rx||(Rx="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Rx,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Vx=[I.kCalendarCollapseHours,I.kCalendarClickTimeSlot,I.kCalendarDayEnds,I.kCalendarDayStarts,I.kCalendarOnlyHourlyKeynav,I.kCalendarTimeIncrements],{minimalCreateEvent:Hx}=Zl.ZP,Gx={day:{row:2,column:2},week:{row:2,column:2},year:{row:1,column:2}},$x=96,Kx={adjacent:[],stacking:0,stackSize:0,startRow:0,endRow:1,startCol:0,endCol:1};function zx(e,t,n){const i=W()();if(e.isSame(i,t)){const e=gx(i.valueOf())+Gx[t].row,s=Math.round(i.minutes()%15/15*100);let o=0,a=n[0]+1;if("week"===t){const e=i.weekday();o=(0,Bx.Z)(n.slice(0,e))+e,a=n[e]+1}return{row:e,percentage:s,column:o,columnSpan:a}}}function jx(e,t,n,i){const s=i?(0,Bx.Z)(i.slice(0,n.startCol)):n.startCol,o=i?(0,Bx.Z)(i.slice(0,n.endCol)):n.endCol;return{left:t+s,top:e+n.startRow,right:t+o,bottom:e+n.endRow}}const Yx=gs()((function(e,t,n,i,s,o){const[a,r]=(0,px.Z)(e,Zl.ZP.isMultiDayEvent);a.sort(((e,t)=>e.start!==t.start?e.start-t.start:e.end!==t.end?e.end-t.end:(parseInt(e.id)||1/0)-(parseInt(t.id)||1/0)));const[l,d,c]=function(e,t,n,i){const s=[];if("day"===i)s.push(Sx(e,n));else if("week"===i){const t=n.clone().startOf("week");[...Array(7).keys()].forEach((n=>{const i=Zl.ZP.filterEventsByPeriod(e,t,"day");s.push(Sx(i,t)),t.add(1,"days")}))}let o;if("day"===i){const e=n.clone().startOf("day").valueOf();o={maxStackSize:1,rows:t.length,items:[],multiEventItems:t.length?[{...Kx,date:n.valueOf(),events:t}]:[],startTime:e,endTime:e+me.hd}}else o=wx(t,n.clone().startOf("week"),7);const a=s.map((e=>e.columns));return[s,o,a]}(r,a,t,n),{timeCells:u,eventCells:p}=function(e,t,n,i,s,o,a,r){function l(e){return 60*e.hour()+e.minute()}const d=W()(e).startOf(t),c=s.map((e=>e+1)),u=i?i.rows+1:1;let p,h,g=[],m=Gx[t].row,f=[];if(m=Gx[t].row,p=Gx[t].column,i){const e={start:i.startTime,end:i.startTime+me.S};f=f.concat(i.items.map((t=>{const n=jx(m,p,t,c);return{display:n,navigation:n,isAllDay:!0,event:t.event,time:e}}))),f=f.concat(i.multiEventItems.map((t=>{const n=jx(m,p,t,c);return{display:n,navigation:n,isAllDay:!0,events:t.events,time:e}})))}m+=u,p=Gx[t].column,f=f.concat(n.flatMap((e=>{const t=e.items.map((e=>({display:{...jx(m,p,e)},navigation:{...jx(m,p,e)},isAllDay:!1,event:e.event})));return p+=e.columns+1,t}))),m=Gx[t].row,p=Gx[t].column,h=d.clone(),g=g.concat(c.map((e=>{const t=h.valueOf();h.add(1,"day");const n=h.valueOf(),i=p,s=m,o=p+e,a=m+u,r=f.filter((e=>e.navigation.left<o&&e.navigation.right>i&&e.navigation.top<a&&e.navigation.bottom>s)).reduce(((e,t)=>Math.max(e,t.navigation.bottom)),s);return p+=e,{display:{left:i,top:s,right:o,bottom:a},navigation:{left:i,top:r,right:o,bottom:a},isAllDay:!0,time:{start:t,end:n}}}))),m+=u,p=Gx[t].column,h=d.clone();const v=Math.max(60*o-r,0),y=60*a;return h.add(v,"minute"),g=g.concat(c.flatMap(((e,t)=>{const n=[];for(;h.diff(d,"day")===t;){const t=p,i=l(h)===v?m:m+l(h)/15,s=p+e,o=h.valueOf();h.add(r,"minute");const a=l(h),d=a>y||0===a?m+$x:m+l(h)/15,c=h.valueOf(),u=f.filter((e=>e.navigation.left<s&&e.navigation.right>t&&e.navigation.top<d&&e.navigation.bottom>i)),g=u.reduce(((e,t)=>Math.max(e,t.navigation.right)),t),b={display:{left:t,top:i,right:s,bottom:d},navigation:{left:g,top:i,right:s,bottom:d},isAllDay:!1,time:{start:o,end:c}};l(h)>y&&(h.add(1,"day").startOf("day"),b.time.end=h.valueOf(),h.add(v,"minute")),n.push(b)}return p+=e,n}))),{timeCells:g,eventCells:f}}(t,n,l,d,c,i,s,o);return{grids:l,gridColumns:c,allDayGrid:d,timeCells:u,eventCells:p}}),{maxSize:2});function Xx(e,t,n){const i=e?.querySelectorAll(".quarter"),s=e?.querySelectorAll(".calendar-background-day");if(i&&s){let e=!1;const o=[...i].find(((t,i)=>{const s=t.getBoundingClientRect(),o=s.bottom>n;return o&&0===i&&n<s.top&&(e=!0),o})),a=[...s].find((e=>e.getBoundingClientRect().right>t));if(o&&a)return{currentRow:o,currentCol:a,isAllDayRow:e}}return{}}function Qx(e,t,n,i){const{resizeEvent:s}=t;if(!e||!s)return;const o=t.currentX??1e5,a=t.currentY??1e5,{currentRow:r,currentCol:l,isAllDayRow:d}=Xx(e,o,a);if(r&&l){const e=!t.initialTime,o=e?Boolean(d):n?.isAllDay||!1;if(e){const e=i??El.Z.getEvent(s.dataset.eventId);if(!e)return;t.initialTime=e.start,t.initialEndTime=e.allDay?e.end-me.hd:e.end}const a=o?parseInt(l.dataset.date):parseInt(l.dataset.date)+parseInt(r.dataset.starttime),c=o?parseInt(l.dataset.date)+me.hd:parseInt(l.dataset.date)+parseInt(r.dataset.endtime);let u,p;return"end"===t.draggingFrom&&c<=t.initialTime||"start"===t.draggingFrom&&a<t.initialEndTime?(u=a,p=t.initialEndTime):(u=t.initialTime,p=c),{startTime:u,endTime:p,isAllDay:o}}}function qx(e,t,n){if(!e)return;const i=t.currentX??1e5,s=t.currentY??1e5;let{currentRow:o,currentCol:a,isAllDayRow:r}=Xx(e,i,s);if(o&&a){const e=!t.initialTime,i=e?Boolean(r):n?.isAllDay||!1;if(e){if(t.resizeEvent)return;t.initialTime=parseInt(a.dataset.date)+parseInt(o.dataset.starttime),t.initialEndTime=parseInt(a.dataset.date)+parseInt(o.dataset.endtime),t.initialStartRow=parseInt(o.style.gridRowStart),t.initialEndRow=parseInt(o.style.gridRowEnd),t.initialLeftCol=parseInt(a.style.gridColumnStart),t.initialRightCol=parseInt(a.style.gridColumnEnd)}i&&(o=a);const s=t.initialLeftCol,l=t.initialStartRow,d=parseInt(a.style.gridColumnStart),c=parseInt(o.style.gridRowStart);let u,p,h,g,m,f,v=!0;return s<d?i?("start"===t.draggingFrom?(u=parseInt(a.style.gridColumnStart),p=t.initialRightCol):(u=s,p=parseInt(a.style.gridColumnEnd)),h=parseInt(o.style.gridRowStart),g=l):(u=s,p=parseInt(a.style.gridColumnEnd),h=l,g=parseInt(o.style.gridRowEnd)):s>d?(u=parseInt(a.style.gridColumnStart),p=t.initialRightCol,h=parseInt(o.style.gridRowStart),g=t.initialEndRow,v=!1):(u=s,p=t.initialRightCol,"end"===t.draggingFrom&&l<=c||"start"===t.draggingFrom&&t.initialEndRow<=c?(h=l,g=parseInt(o.style.gridRowEnd)):(h=c,g=t.initialEndRow,v=!1)),v?(m=t.initialTime,f=i?parseInt(a.dataset.date):parseInt(a.dataset.date)+parseInt(o.dataset.endtime)):(m=i?parseInt(a.dataset.date):parseInt(a.dataset.date)+parseInt(o.dataset.starttime),f=t.initialEndTime),{startCol:u,endCol:p,startRow:h,endRow:g,startTime:m,endTime:f,isAllDay:i}}}function Jx(e){if(!e.overlay)return null;const{startRow:t,endRow:n,startCol:i,endCol:s,startTime:o,endTime:a,isAllDay:r}=e.overlay,l={gridRowStart:t,gridRowEnd:n,gridColumnStart:i,gridColumnEnd:s};if(r)return Ux("div",{className:"calendar-drag-overlay start end",style:l},void 0,Ux("div",{className:"start-time"},void 0,W()(o).format("L")),Ux("div",{className:"end-time"},void 0,W()(a).format("L")));{const[t]=e.columnSizes.reduce((([t,r],d)=>{const c=d+1,u=r===i,p=s>r&&s<=r+c,h=Fi()("calendar-drag-overlay",{start:u,end:p});return u?(l.gridRowEnd=p?n:e.rowOffset+$x,l.gridColumnEnd=r+d,t.push(Ux("div",{className:h,style:{...l}},r,Ux("div",{className:"start-time"},void 0,u&&(0,ss.jsx)(ss.Fragment,{children:W()(o).format("LT")})),Ux("div",{className:"end-time"},void 0,p&&(0,ss.jsx)(ss.Fragment,{children:W()(a).format("LT")}))))):r>i&&r<s&&(l.gridRowStart=e.rowOffset,l.gridColumnStart=r,l.gridColumnEnd=r+d,l.gridRowEnd=p?n:e.rowOffset+$x,t.push(Ux("div",{className:h,style:{...l}},r,Ux("div",{className:"start-time"},void 0,u&&Ux("span",{},void 0,W()(o).format("LT"))),Ux("div",{className:"end-time"},void 0,p&&Ux("span",{},void 0,W()(a).format("LT")))))),[t,r+c]}),[[],e.colOffset]);return t}}function eL(e){const{handler:t}=Li.useContext(yM),n=(0,Ya.Z)([I.kCalendarCollapseHours,I.kCalendarDayEnds,I.kCalendarDayStarts,I.kCalendarTimeIncrements,I.kCalendarOnlyHourlyDivider]),{anchorDate:i,displayMode:s,allDayGrid:o,filter:a}=e;return Li.useMemo((function(){function e(e,n){e.stopPropagation();const i=W()(a.selectedDate).hours(n);t.selectDate(i,!1)}const r=n[I.kCalendarCollapseHours],l=r?n[I.kCalendarDayStarts]:0,d=r&&n[I.kCalendarDayEnds]||24,c=i.clone().startOf("day").hour(l),u=parseInt(n[I.kCalendarTimeIncrements]);let p=Gx[s].row;o&&(p+=o.rows+1);const h=(0,Fx.Z)(l,d);let g=[];g=15===u?[{rowOffset:0,span:1,startOffset:0,endOffset:9e5},{rowOffset:1,span:1,startOffset:9e5,endOffset:18e5},{rowOffset:2,span:1,startOffset:18e5,endOffset:27e5},{rowOffset:3,span:1,startOffset:27e5,endOffset:36e5}]:30===u?[{rowOffset:0,span:2,startOffset:0,endOffset:18e5},{rowOffset:2,span:2,startOffset:18e5,endOffset:36e5}]:[{rowOffset:0,span:4,startOffset:0,endOffset:36e5}];const m=W()().localeData().longDateFormat("LT").match(/[aA]/)?.[0],f=m?`h ${m}`:"H:mm",v=m?W()().startOf("day").format(f):"0:00";return(0,ss.jsxs)(ss.Fragment,{children:[Ux("div",{className:"hour-track",style:{gridRowEnd:$x+p}}),l>0&&(0,ss.jsxs)(ss.Fragment,{children:[Ux("div",{className:"hour",onClick:t=>e(t,l-1),style:{gridRowStart:p,gridRowEnd:"span "+4*l}},void 0,Ux("div",{className:"hour-value"},void 0,v)),Ux("div",{className:"quarter collapsed morning","data-starttime":l*me.QI-u*me.lb,"data-endtime":l*me.QI,style:{gridRowStart:p,gridRowEnd:p+4*l}}),Ux("div",{className:"hour-line",style:{gridRowStart:p}})]}),h.map(((t,i)=>{const s=p+4*t,o=Ux(Li.Fragment,{},`fr${i}`,Ux("div",{className:"hour",onClick:n=>e(n,t),style:{gridRowStart:s}},void 0,Ux("div",{className:"hour-value"},void 0,c.format(f))),g.map(((e,i)=>Ux(Li.Fragment,{},e.rowOffset,Ux("div",{className:"quarter",style:{gridRowStart:s+e.rowOffset,gridRowEnd:s+e.rowOffset+e.span},"data-starttime":t*me.QI+e.startOffset,"data-endtime":t*me.QI+e.endOffset}),0!==i&&!n[I.kCalendarOnlyHourlyDivider]&&Ux("div",{className:"quarter-line",style:{gridRowStart:s+e.rowOffset}})))),Ux("div",{className:"hour-line",style:{gridRowStart:s}}));return c.add(1,"hour"),o})),d<24&&(0,ss.jsxs)(ss.Fragment,{children:[Ux("div",{className:"hour-line",style:{gridRowStart:p+4*d}}),Ux("div",{className:"hour",onClick:t=>e(t,c.hour()),style:{gridRowStart:p+4*d},style:{gridRowStart:p+4*d,gridRowEnd:p+96}},void 0,Ux("div",{className:"hour-value"},void 0,c.format(f))),Ux("div",{className:"quarter collapsed evening","data-starttime":d*me.QI,"data-endtime":d*me.QI+u*me.lb,style:{gridRowStart:p+4*d,gridRowEnd:p+$x}})]}),Ux("div",{className:"hour hour-last",style:{gridRowStart:p+$x-1}},void 0,Ux("div",{className:"hour-value"},void 0,v))]})}),[n,o,i,s,t,a])}function tL(e){const{anchorDate:t,displayMode:n,gridColumns:i,filter:s,inPanel:o}=e,{handler:a}=Li.useContext(yM);return Li.useMemo((function(){const e=[];if("week"===n){const n=t.clone().startOf("week");let o=2;i.forEach(((t,i)=>{const r=n.format(R.ZP.getWeekdayFormat(R.ZP.getShortDateFormat())),l=n.valueOf();e.push(Ux(Li.Fragment,{},i,Ux("header",{style:{gridRowStart:1,gridColumnStart:o,gridColumnEnd:o+t+1},className:Fi()("calendar-header-date",{current:(0,ih.KC)(n.toDate(),new Date)}),onClick:e=>{e.stopPropagation();const t=W()(l).hours(s.selectedDate?.hours()??0);a.selectDate(t,s.allDaySelected)}},void 0,r),Ux("div",{style:{gridRowStart:2,gridRowEnd:"grid-bottom",gridColumnStart:o,gridColumnEnd:o+t+1},className:Fi()("calendar-background-day",{weekend:n.day()%6==0}),"data-date":n.valueOf()}))),o+=t+1,n.add(1,"days")}))}else e.push(Ux(Li.Fragment,{},"day",Ux("header",{style:{gridRowStart:1,gridColumnStart:2,gridColumnEnd:i[0]+3},className:Fi()("calendar-header-date",{current:(0,ih.KC)(t.toDate(),new Date)})},void 0,t.format(R.ZP.getWeekdayFormat(o?"ll":"LL"))),Ux("div",{style:{gridRowStart:2,gridRowEnd:"grid-bottom",gridColumnStart:2,gridColumnEnd:i[0]+3},className:Fi()("calendar-background-day",{weekend:t.day()%6==0}),"data-date":t.clone().startOf("day").valueOf()})));return e}),[t,n,i,o,a,s])}function nL(e){return e.marker?[Ux("div",{className:"current-time",style:{gridRowStart:e.marker.row,gridColumnStart:e.marker.column+2,gridColumnEnd:`span ${e.marker.columnSpan}`}},"marker",Ux("span",{className:"marker",style:{top:`${e.marker.percentage}%`}}))]:null}function iL(e){const{requestAnimationFrame:t}=Li.useContext(ts.Z),{editEvent:n}=Li.useContext(yM).handler,{cells:i,selectedEvent:s,editingEvent:o,allDaySelected:a,selectedDate:r}=e;return Li.useMemo((function(){return i.map(((e,i)=>{const{display:l,isAllDay:d,navigation:c,time:u}=e;if(!u)return null;const p=r?.valueOf(),h=p&&a===d&&u.start<=p&&u.end>p;if(!h)return null;const g=h&&!s&&!o;return(0,ss.jsx)("div",{className:Fi()("calendar-add-event-button selected",{active:g,"with-event":c.left!==l.left}),onClick:e=>{e.stopPropagation(),n(null,Hx({start:u.start,allDay:d}))},style:{gridRowStart:c.top,gridRowEnd:c.bottom,gridColumnStart:c.left,gridColumnEnd:c.right},ref:e=>e&&t((()=>{e.scrollIntoView({block:"nearest",inline:"nearest"})})),dangerouslySetInnerHTML:{__html:Wi.PbG}},`sel${i}`)}))}),[a,i,n,o,r,s,t])}function sL(e){const t=Boolean(e.filter.filterText),n=Li.useMemo((()=>({displayStyle:"solid",isFiltering:t})),[t]),{cells:i,editingEvent:s,selectedEvent:o,displayMode:a,anchorDate:r}=e;return Li.useMemo((()=>i.map(((t,i)=>{if(t.event){const i=t.event;if(!i)return null;const a=s?.id===i.id&&!e.isDragging,r=i.id.split("-")[0]===o?.split("-")[0],l=a&&s?s:i,d=Zl.ZP.generateKey(i,t.isAllDay?`${t.display.left}${t.display.right}`:`${t.display.left}${t.display.top}`),c=t.time&&i.start<t.time.start,u=t.time&&i.end>t.time.end;return(0,ss.jsx)(sx,{...n,style:{gridRowStart:t.display.top,gridRowEnd:t.display.bottom,gridColumnStart:t.display.left,gridColumnEnd:t.display.right},event:l,isMultiDay:Zl.ZP.isMultiDayEvent(i),isSelected:r,isEditing:a,resizeHandler:t.isAllDay?"horizontal":"vertical",multiDayContinuing:c,multiDayContinues:u},d)}if(t.events){const i=t.events;if(!i.length)return null;const l=Zl.ZP.generateKey(i[0]);return Ux("div",{className:Fi()("event-container",{"calendar-day-allday":t.isAllDay&&"day"===a}),style:{gridRowStart:t.display.top,gridRowEnd:t.display.bottom,gridColumnStart:t.display.left,gridColumnEnd:t.display.right}},`${l}-${t.display.top}`,i.map((i=>{const a=s?.id===i.id&&!e.isDragging,l=i.id.split("-")[0]===o?.split("-")[0],d=a&&s?s:i;return(0,ss.jsx)(sx,{...n,event:d,isMultiDay:Zl.ZP.isMultiDayEvent(i),isSelected:l,isEditing:a,resizeHandler:t.isAllDay?"horizontal":"vertical",dayOutOfTotalDays:r},`${Zl.ZP.generateKey(i,e.fromWidget?"widget":"")}`)})))}}))),[i,s,e.isDragging,e.fromWidget,o,n,a,r])}const oL=function(e){const{handler:t,pageId:n,isWidget:i}=Li.useContext(yM),{editEvent:s,selectDate:o,selectEvent:a}=t,{requestAnimationFrame:r,HTMLElement:l}=Li.useContext(ts.Z),d=cx(n),c=Li.useRef(null),[u,p]=Li.useState(null),[h,g]=Li.useState([]),[m,f]=Li.useState([]),[v,y]=Li.useState([]),[b,S]=Li.useState(!1),[w,C]=Li.useState(),[A,T]=Li.useState(),Z=(0,Ya.Z)(Vx),E=Li.useRef({updateTimer:null,updateCreateOverlay:()=>{},isResizing:!1,hover:{x:0,y:0,updateRequested:!1}});Li.useEffect((()=>(E.current.updateTimer||(E.current.updateTimer=setInterval((()=>{C(zx(e.anchorDate,e.displayMode,h))}),6e4)),()=>{E.current.updateTimer&&clearInterval(E.current.updateTimer)})));const{anchorDate:k,displayMode:_,events:N}=e,P=Z[I.kCalendarCollapseHours],D=P?Z[I.kCalendarDayStarts]:0,M=P&&Z[I.kCalendarDayEnds]||24,O=Z[I.kCalendarOnlyHourlyKeynav]?60:Z[I.kCalendarTimeIncrements];Li.useMemo((()=>{let t=N;b&&e.editingEvent&&(t=N.map((t=>t.id===e.editingEvent?.id?e.editingEvent:t)).filter(Boolean));const n=Yx(t,k,_,D,M,O);g(n.gridColumns),p(n.allDayGrid),f(n.timeCells),y(n.eventCells)}),[k,_,D,M,N,O,b,e.editingEvent]),Li.useMemo((()=>{const e=zx(k,_,h);e&&u&&(e.row=e.row+u.rows+1),C(e)}),[k,_,u,h]);const{gridFrozen:x,handlers:L,overlay:R,dragOffset:B}=dx(c.current,qx,Qx,e.editingEvent,S),F=()=>{if(E.current.hover.x&&E.current.hover.y){const{currentRow:e,currentCol:t,isAllDayRow:n}=Xx(c.current,E.current.hover.x,E.current.hover.y);e&&t?T({gridColumnStart:parseInt(t.style.gridColumnStart),gridRowStart:n?2:parseInt(e.style.gridRowStart),gridColumnEnd:parseInt(t.style.gridColumnEnd),gridRowEnd:n?parseInt(e.style.gridRowStart):parseInt(e.style.gridRowEnd)||parseInt(e.style.gridRowStart)+1}):T()}E.current.hover.updateRequested=!1},U=e=>{if(e.target!==e.currentTarget||E.current.isResizing)return;const{currentRow:n,currentCol:i,isAllDayRow:s}=Xx(c.current,e.clientX,e.clientY);if(n&&i){"click"===e.type&&e.stopPropagation();const o=parseInt(i.dataset.date)+parseInt(n.dataset.starttime);"select"===Z[I.kCalendarClickTimeSlot]||"contextmenu"===e.type?t.selectDate(W()(o),s):t.editEvent(null,Hx({start:o,allDay:s})),T()}},V={...L,onDragOver:e=>{e.dataTransfer.types.some((e=>e===ox))?(E.current.hover.x=e.clientX-(B.xOffset??0),E.current.hover.y=e.clientY-(B.yOffset??0),E.current.hover.updateRequested||(r(F),E.current.hover.updateRequested=!0),(0,ms.ZP)(e)):L.onDragOver(e)},onDrop:e=>{const t=e.dataTransfer;if(t.types.some((e=>e===ox))){(0,ms.ZP)(e);const{currentRow:i,currentCol:s,isAllDayRow:o}=Xx(c.current,e.clientX-(B.xOffset??0),e.clientY-(B.yOffset??0));if(i&&s){const e=parseInt(s.dataset.date)+parseInt(i.dataset.starttime),a=JSON.parse(t.getData(ox)).id;("copy"===t.effectAllowed?te.ZP.copyEvent:te.ZP.moveEvent)(a,{start:e,allDay:o},n)}}else L.onDrop(e)}},{allDaySelected:H,selectedDate:G}=e.filter,$=Li.useCallback((t=>{if(!(t.shiftKey||t.ctrlKey||t.metaKey))if(G){if(!e.editingEvent){const i=OM.Z[t.keyCode],r=t.altKey;switch(i){case"Up":case"Down":case"Left":case"Right":t.preventDefault();const l=r?[]:v,[d,c,u]=function(e,t,n,i,s,o=!1){const a=i.valueOf(),r=t.find((e=>e.isAllDay===o&&e.time.start<=a&&e.time.end>a));if(!r)return[null,null,!1];const l=n.find((e=>e.event&&e.event.id===s||e.events&&e.events.some((e=>e.id===s)))),d=l||r;if(d.events&&("Up"===e||"Down"===e)){const t=d.events.findIndex((e=>e.id===s));if("Up"===e&&t>0||"Down"===e&&t<d.events.length-1){const n="Up"===e?-1:1,i=d.events[t+n];return[r.time&&r.time.start,i,r.isAllDay]}}let c;switch(e){case"Up":case"Down":case"Left":case"Right":c=Lx(e,r,l,[...t,...n])}if(c){let n;if(c.time)return[c.time.start,null,c.isAllDay];if(c.event)n=c.event;else if(c.events){const t="Up"===e?c.events.length-1:0;n=c.events[t]}if(n){if(function(e,t){return e.time.start<(t.end||1/0)&&e.time.end>t.start}(r,n))return[r.time&&r.time.start,n,c.isAllDay];let i;if(i=d.isAllDay?function(e,t,n){let i;i="Left"===n?t=>t.navigation.right===e.navigation.right:t=>t.navigation.left===e.navigation.left;const s=t.filter(i).sort(((e,t)=>e.navigation.top-t.navigation.top));return s.length?s[0]:null}(c,[...t],e):Lx(e,r,null,[...t]),i&&i.time)return[i.time.start,n,c.isAllDay]}}return[null,null,!1]}(i,m,l,G,e.selectedEvent,H);if(!d){let e;switch(i){case"Left":e=G.clone().subtract(1,"day");break;case"Right":e=G.clone().add(1,"day")}return void(e&&o(e,H))}(c||e.selectedEvent)&&a({event:c,date:W()(d),allDay:u}),c||o(W()(d),u);break;case"Enter":if(t.preventDefault(),e.selectedEvent){const t=N.find((t=>t.id===e.selectedEvent));s(t)}else{const e=G.valueOf();s(null,Hx({start:e,allDay:H}))}break;case"Space":const p=e.selectedEvent&&N.find((t=>t.id===e.selectedEvent));if(p&&p.task){(0,ms.ZP)(t);const e={...p,complete:!p.complete};te.ZP.updateEvent(e,"single",!0,n)}break;case"Escape":t.preventDefault(),e.selectedEvent&&a({})}T()}}else console.error("Can not navigate hour grid. No selected calendar date.")}),[v,m,e.selectedEvent,N,e.editingEvent,H,G,s,o,a,n]);let K={};if(x)K=x;else{const t="auto ",n=h.reduce(((e,n)=>`${e} ${t.repeat(n)} 16px`),"var(--calendar-hour-column-width) ");K.gridTemplateColumns=n+" [grid-right]";let i="";Gx[e.displayMode].row-1&&(i="max-content ");const s=Z[I.kCalendarCollapseHours],o=s?Z[I.kCalendarDayStarts]:0,a=s&&Z[I.kCalendarDayEnds]||24;let r=o>0?`repeat(${4*o}, min-content) `:"";r+=`repeat(${4*(24-o-(24-a))}, auto) `,r+=a<24?`repeat(${4*(24-a)}, min-content) `:"",u?.rows&&(i+=`repeat(${u.rows}, min-content) `),i+=`1.5em ${r} [grid-bottom]`,K.gridTemplateRows=i}return(0,ss.jsxs)("div",{className:Fi()("calendar-grid calendar-grid-hours",`calendar-grid-${e.displayMode}`,{"is-dragging":b}),ref:c,onKeyDown:$,style:K,tabIndex:"0",draggable:!0,...V,onMouseDown:e=>{e.target instanceof l&&e.target.className.includes("calendar-event-resizer")&&(E.current.isResizing=!0)},onMouseUp:e=>{Wx.nextTick((()=>E.current.isResizing=!1))},onMouseMove:e=>{E.current.hover.x=e.clientX,E.current.hover.y=e.clientY,E.current.hover.updateRequested||(r(F),E.current.hover.updateRequested=!0)},onContextMenu:U,onClick:U,onWheel:d,children:[Ux(tL,{anchorDate:k,displayMode:_,gridColumns:h,filter:e.filter,inPanel:e.inPanel??!1}),Ux(eL,{allDayGrid:u,anchorDate:k,displayMode:_,filter:e.filter}),A&&Ux("div",{className:"calendar-grid-hover",style:A}),Ux(iL,{cells:m,editingEvent:e.editingEvent,allDaySelected:e.filter.allDaySelected,selectedDate:e.filter.selectedDate,selectedEvent:e.selectedEvent}),Ux(nL,{marker:w}),Ux(sL,{cells:v,editingEvent:e.editingEvent,filter:e.filter,isDragging:b,selectedEvent:e.selectedEvent,displayMode:e.filter.displayMode,anchorDate:k,fromWidget:i}),Ux(Jx,{overlay:R,rowOffset:Gx[e.displayMode].row+(u&&u.rows+1||0),colOffset:Gx[e.displayMode].column,columnSizes:h})]})};var aL;function rL(e,t,n,i){aL||(aL="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:aL,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const lL=[I.kCalendarDisplayWeekNumber];function dL(e){const t=El.Z.getCalendars().find((t=>t.id===e.event.calendarId));let n,i;e.event.end&&!e.event.start?(i=Math.max(2,Math.floor((e.event.end-e.startTime)/me.lq)),n=i-2):(n=Math.max(0,Math.floor((e.event.start-e.startTime)/me.lq)),i=Math.max(Math.min(96,Math.floor((e.event.end-e.startTime)/me.lq)),n+1));return rL("line",{stroke:"var(--colorCalendarBg)",style:Zl.ZP.getCalendarColorStyles(t),x1:110,x2:110,y1:n,y2:i})}function cL(e){const t=El.Z.getCalendars().find((t=>t.id===e.event.calendarId)),n=Math.floor(48-10*(e.count-1)-10)+20*e.index;return rL("line",{stroke:"var(--colorCalendarBg)",x1:10,x2:10,y1:n,y2:n+14,style:Zl.ZP.getCalendarColorStyles(t)},e.event.id)}function uL(e){const[t,n]=(0,px.Z)(Zl.ZP.filterEventsByPeriod(e.events,e.day,"day"),Zl.ZP.isMultiDayEvent),i=e.day.clone();return rL(Li.Fragment,{},e.day.valueOf(),rL("div",{className:Fi()("CalendarMonth-Day",{"CalendarMonth-Day--OtherMonth":!e.isSameMonth,"CalendarMonth-Day--Selected":e.isSelected,"CalendarMonth-Day--Highlighted":e.isHighlighted,"CalendarMonth-Day--Current":e.day.isSame(Date.now(),"day"),"CalendarMonth-Day--Weekend":e.day.day()%6==0}),onClick:e.renderMonthDay?Lr.Z:()=>e.onSelect(i)},void 0,e.renderMonthDay&&e.renderMonthDay(e.day),!e.renderMonthDay&&e.day.format("D"),!e.renderMonthDay&&!(!n.length&&!t.length)&&rL("svg",{viewBox:"0 0 120 96"},void 0,n.map((t=>rL(dL,{event:t,startTime:e.day.valueOf()},t.id))),t.map(((e,n)=>rL(cL,{event:e,index:n,count:t.length},e.id))))))}var pL=rL("span",{}),hL=rL("span",{});const gL=function(e){const t=(0,Ya.Z)(lL),n=e.showWeekNumber&&t[I.kCalendarDisplayWeekNumber],{events:i,month:s,style:o}=e,a=s.clone().startOf("month").startOf("week");let r;if(e.fixedHeight)r=[...Array(42).keys()].map((e=>a.clone().add(e,"day")));else{const e=Zl.ZP.getDisplayRange(s,"month");r=Array.from(e.by("day"))}const l=r.slice(0,7);return rL("div",{style:o,className:Fi()("CalendarMonth",{"CalendarMonth--ShowWeeknumber":n})},s.valueOf(),n&&pL,e.showWeekDays&&l.map((e=>rL("span",{className:"CalendarMonth-DayOfWeek"},`hdr-${e.valueOf()}`,e.format("dd")[0]))),r.map(((t,o)=>{const a=t.isSame(s,"month");return n&&o%7==0?rL(Li.Fragment,{},o,rL("span",{className:"CalendarMonth-Week"},void 0,t.week()),e.showOutOfMonthDays||a?rL(uL,{day:t,events:i,isSelected:!!e.selectedDate&&e.selectedDate.isSame(t,e.highlightMode),isHighlighted:e.highlightedDate?.isSame(t,e.highlightMode)||!1,isSameMonth:a,onSelect:e.onSelect,renderMonthDay:e.renderMonthDay}):hL):e.showOutOfMonthDays||a?rL(uL,{day:t,events:i,isSelected:!!e.selectedDate&&e.selectedDate.isSame(t,e.highlightMode),isHighlighted:e.highlightedDate?.isSame(t,e.highlightMode)||!1,isSameMonth:a,onSelect:e.onSelect,renderMonthDay:e.renderMonthDay},t.valueOf()):rL("span",{},t.valueOf())})))};var mL;function fL(e,t,n,i){mL||(mL="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:mL,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const vL=function(e){const t=Li.useContext(yM),n=cx(t.pageId),i=Li.useRef(),s=()=>{const e=i.current;if(!e)return 0;const t=!!e.childElementCount&&e.children[0];return t?Math.max(1,Math.floor(e.clientWidth/t.clientWidth)):0},{anchorDate:o,displayMode:a}=e.filter,r=Zl.ZP.getDisplayRange(o,a),l=Array.from(r.by("month"));return(0,ss.jsx)("div",{className:`calendar-grid-${e.filter.displayMode} calendar-grid`,onKeyDown:n=>{const i=e.filter.selectedDate;if(!i)return void console.error("Can not navigate month grid. No selected calendar date.");let o,a;switch(OM.Z[n.keyCode]){case"Left":if(0===i.weekday()||1===i.date()){const e=(0,ih.Xq)(i);o=(0,ih.FY)(e,6,i.clone().subtract(1,"month"),!0)}else o=i.clone().subtract(1,"day");break;case"Right":if(o=i.clone().endOf("month"),6===i.weekday()||i.isSame(o,"day")){const e=(0,ih.Xq)(i);o=(0,ih.FY)(e,0,i.clone().add(1,"month"),!0)}else o=i.clone().add(1,"day");break;case"Up":a=s(),i.date()<8?(o=i.clone().subtract(a,"month"),o=(0,ih.Ro)(i.weekday(),o)):o=i.clone().subtract(1,"week");break;case"Down":a=s(),o=i.clone().endOf("month"),o.date()-i.date()<7?(o=i.clone().add(a,"month"),o=(0,ih.PX)(i.weekday(),o)):o=i.clone().add(1,"week")}o&&(o.hour(i.hour()).minute(i.minute()),t.handler.selectDate(o))},ref:i,tabIndex:"0",onWheel:n,children:l.map((n=>{const i=Zl.ZP.filterEventsByPeriod(e.events,n,"month");return fL("div",{},n.valueOf(),fL("p",{className:"month-name"},void 0,n.format("MMMM")),fL(gL,{events:i,month:n,selectedDate:e.filter.selectedDate,showWeekNumber:!0,showWeekDays:!0,onSelect:t.handler.selectDate,fixedHeight:!1,highlightMode:"day"}))}))})};function yL(){const[,e]=Li.useReducer((e=>e+1),0);return e}var bL;function SL(e,t,n,i){bL||(bL="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:bL,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const{minimalCreateEvent:wL}=Zl.ZP,CL=[I.kCalendarClickTimeSlot],AL="YYYY-MM-DD",IL="!todos";function TL(e,t,n,i=0){const s=i>0?{...n,id:`${n.id}-${i}`}:n,o=e.get(t);Array.isArray(o)?(o.push(s),e.set(t,o)):e.set(t,[s])}const ZL=gs()((function(e,t,n){const i=Zl.ZP.getDisplayRange(t,n),s=new Map;return e.forEach((e=>{if(e.task)if(e.end){const t=W()(e.end).format(AL);TL(s,t,e)}else TL(s,IL,e);else if(e.start){const t=W()(Math.max(e.start,i.start)).startOf("day");let n=0;const o=Math.min(e.end,i.end);for(;t.valueOf()<o||t.valueOf()===e.start;){const i=t.format(AL);TL(s,i,e,n),t.add(1,"day"),n++}}})),s.forEach((e=>e.sort(((e,t)=>e.id&&t.id?e.allDay!==t.allDay?e.allDay?-1:1:e.task&&t.task?(e.end||1/0)-(t.end||1/0):e.start-t.start:e.id?-1:1)))),s}),{maxSize:2});const EL=function(e){const t=(0,Ya.Z)(CL),{handler:n,pageId:i,isTaskList:s,isWidget:o}=Li.useContext(yM),{document:a}=Li.useContext(ts.Z),r=yL(),l=cx(i),d=Li.useRef(new Map),c=Li.useRef(new Map);Li.useMemo((()=>{c.current=ZL(e.events,e.filter.anchorDate,e.displayMode)}),[e.displayMode,e.events,e.filter.anchorDate]);const u=Li.useMemo((()=>function(e,t){let n="";const i=e?.format(AL)??IL,s=[...t.keys()].sort();for(const e of s)if(!n&&i<=e){n=e;break}return!n&&s.length&&(n=s.pop()),!n&&e&&(n=e.format(AL)),n||IL}(e.filter.selectedDate,c.current)),[e.filter.selectedDate]);function p(t){let n="";if(e.filter.calendarIds.size){const t=Zl.ZP.getDefaultCalendar(s)?.id??"";e.filter.calendarIds.has(t)||(n=e.filter.calendarIds.values().next().value??"")}return s?{end:t,task:!0,calendarId:n}:{start:t,calendarId:n}}function h(e,t){"click"===e.type&&e.stopPropagation();const i=p(t?t+(new Date).getHours()*me.QI:0);n.editEvent(null,wL(i))}Li.useEffect((()=>{e.filter.showCompletedTasks&&d.current.clear()}),[e.filter.showCompletedTasks]);const g=[...c.current.keys()].sort(),m=!!e.filter.filterText,f=!!a.activeElement?.closest(".calendar-grid");return SL("div",{className:`calendar-grid calendar-grid-${e.displayMode}`,onKeyDown:function(t){const o=t.altKey;if(!e.editingEvent){const a=Zl.ZP.getDisplayRange(e.filter.anchorDate,e.displayMode),r=Array.from(c.current.keys()).sort();let l,d;switch(OM.Z[t.keyCode]){case"Up":if((0,ms.ZP)(t),l=c.current.get(u)||[],d=l.findIndex((t=>t.id===e.selectedEvent)),o||0===d||0===l.length){const e=r.findIndex((e=>u===e));if(e<=0&&u!==IL){const e=a.start.clone().subtract(1,"day");bO.Z.viewPreviousPeriod(i,e)}else if(e>0){const t=r[e-1],i=t===IL?null:W()(t);n.selectDate(i,!0)}}else if(e.selectedEvent){const e=l[d-1];n.selectEvent({event:e})}else{const e=l[l.length-1];n.selectEvent({event:e})}break;case"Down":if((0,ms.ZP)(t),l=c.current.get(u)||[],d=l.findIndex((t=>t.id===e.selectedEvent)),o||-1===d||!e.selectedEvent){const e=r.findIndex((e=>u===e));l=c.current.get(r[e+1])||[],e>=r.length-1?bO.Z.viewNextPeriod(i,a.end.clone().add(1,"day")):l.length&&!o?n.selectEvent({event:l[0]}):n.selectDate(W()(r[e+1]),!0)}else d===l.length-1?n.selectEvent({}):n.selectEvent({event:l[d+1]});break;case"Enter":if((0,ms.ZP)(t),e.selectedEvent){l=c.current.get(u)||[];const t=l.find((t=>t.id===e.selectedEvent));n.editEvent(t)}else{const e=s,t=u!==IL&&W()(u),i=t?t.hours((new Date).getHours()).valueOf():0,o=e?{end:i,task:e}:{start:i};n.editEvent(null,wL(o))}break;case"Space":const p=e.selectedEvent&&e.events.find((t=>t.id===e.selectedEvent));if(p&&p.task){(0,ms.ZP)(t);const e={...p,complete:!p.complete};te.ZP.updateEvent(e,"single",!0,i)}break;case"Escape":(0,ms.ZP)(t),e.selectedEvent&&n.selectEvent({})}}},onClick:function(i,s){if(e.editingEvent)n.endEventEdit();else if(i.target===i.currentTarget){const e=s?W()(s,AL):void 0,o=p(e?.valueOf()??0);"select"===t[I.kCalendarClickTimeSlot]||"contextmenu"===i.type?e&&n.selectDate(e,!0):n.editEvent(null,wL(o))}},tabIndex:"0",onWheel:l},void 0,0===e.events.length&&function(){const t=0===El.Z.getEvents().length,n=s?0:e.filter.anchorDate.valueOf();return SL("div",{className:"cal-tasks-row"},void 0,SL("div",{className:"cal-tasks-row-events selected"},void 0,t&&SL("h2",{},void 0,s?(0,B.Z)("Your calendar is empty. Add your first task below!"):(0,B.Z)("Your calendar is empty. Add your first event below!")),SL("div",{className:"calendar-add-event-button selected active",onClick:e=>h(e,n)},void 0,s?(0,B.Z)("Add Task"):(0,B.Z)("Add Event"))))}(),g.map((t=>{const a=c.current.get(t)||[],l=u===t,p=t!==IL?W()(t,AL):void 0;return(0,ss.jsxs)("div",{className:"cal-tasks-row",ref:e=>{l&&e&&(!o||f)&&e.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"})},children:[!!p&&SL("div",{className:Fi()("cal-tasks-row-date",{current:(0,ih.KC)(p.toDate(),new Date)})},void 0,(0,ih.KC)(p.toDate(),new Date)?SL("span",{className:"cal-tasks-row-doy"},void 0,(0,B.Z)("calendar","Today")):(0,ss.jsxs)(ss.Fragment,{children:[SL("span",{className:"cal-tasks-row-dow"},void 0,p.format("dddd")),SL("span",{className:"cal-tasks-row-doy"},void 0,p.format("ll"))]})),SL("div",{className:Fi()("cal-tasks-row-events",{selected:l})},void 0,a.map((t=>{const o=e.selectedEvent?.split("-")[0]===t.id.split("-")[0],a=!!e.editingEvent&&e.editingEvent.id===t.id;d.current.has(t.id)&&(t={...t,complete:d.current.get(t.id)});const l=a&&e.editingEvent?e.editingEvent:t;let u;return s&&!e.filter.showCompletedTasks&&(u=n=>{const s=(0,v.Uy)(t,(e=>{e.complete=n.target.checked}));d.current.set(s.id,s.complete??!1),s.complete&&setTimeout((()=>{d.current.get(s.id)&&te.ZP.updateEvent(s,"single",!0,i)}),1500);const o=e.events.map((e=>e.id===s.id?s:e)),a=ZL(o,e.filter.anchorDate,e.displayMode);setTimeout((()=>{c.current=a,r()}),0)}),SL("div",{className:Fi()("event-container",{exiting:d.current.get(t.id)}),onClick:t=>function(t,i){const{editingEvent:s}=e;(!s||s&&s.id!==i.id)&&n.editEvent(i),t.stopPropagation()}(t,l)},Zl.ZP.generateKey(l),SL(sx,{event:l,displayStyle:e.eventDisplayStyle,isSelected:o,isEditing:a,isMultiDay:Zl.ZP.isMultiDayEvent(l),isFiltering:m,multiDayContinuing:!!t.start&&t.start<(p?.valueOf()??-1/0),multiDayContinues:(t.end||0)>(p?.valueOf()??1/0)+me.hd,onCompleteChanged:u,dayOutOfTotalDays:p}))})),(0,ss.jsx)("div",{className:Fi()("calendar-add-event-button",{active:l&&!e.selectedEvent,selected:l,"task-list":s,disabled:!!e.editingEvent}),onClick:e=>h(e,s?0:Date.parse(t)),ref:t=>{l&&!e.selectedEvent&&t&&!o&&t.scrollIntoViewIfNeeded({block:"nearest",inline:"nearest",behavior:"smooth"})},children:s?(0,B.Z)("Add Task"):(0,B.Z)("Add Event")}))]},t)})))};var kL;function _L(e,t,n,i){kL||(kL="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:kL,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const{minimalCreateEvent:NL}=Zl.ZP;function PL(e,t){if(!t)return!1;const{HTMLElement:n}=e;return t instanceof n&&t.isContentEditable||"function"==typeof t.select}const DL=function(e){const t=Li.useContext(yM),n=Li.useContext(ts.Z),i=Li.useRef(),s={allDaySelected:e.filter.allDaySelected,selectedDate:e.filter.selectedDate,selectedEvent:e.filter.selectedEvent,editingEvent:e.editingEvent},o=Li.useRef(s);o.current=s;const{isPanel:a}=t,r=Li.useRef(!!e.editingEvent);Li.useEffect((()=>{r.current=!!e.editingEvent})),Li.useEffect((()=>{function e(e){if(e!==n.vivaldiWindowId)return;if(!i.current?.contains(n.document.activeElement))return;const{editingEvent:s,selectedDate:r}=o.current,{area:l}=$e.Z.getContext(e);if(s||a!==("panel"===l))return;const d=r?.valueOf()??0;t.handler.editEvent(null,NL({start:d}))}return Oa.Z.addListener("COMMAND_CALENDAR_CREATE_EVENT",e),()=>{Oa.Z.removeListener("COMMAND_CALENDAR_CREATE_EVENT",e)}}),[a,n,t.handler]);const l=Li.useCallback((()=>{const n=e.trashedEvents.sort(((e,t)=>(e.trash_time||0)-(t.trash_time||0))).slice(-1);n.length&&te.ZP.restoreEvent(t.pageId,n[0])}),[t.pageId,e.trashedEvents]),d=Li.useCallback(((e,t)=>{const s=n.document.getSelection(),a=n.document.activeElement,{selectedEvent:r,editingEvent:l}=o.current,d=r||l?.id;if(d&&(!s||s.isCollapsed)&&i.current?.contains(a)){const{clipboardData:n}=e;if(!n)throw new Error("No clipboardData on copy event");e.preventDefault();const i=El.Z.getEvent(d);if(!i)return void nn.Z.warn("Calendar",`Event to copy (id: ${d}) not found`);n.setData("text/plain",i.title),n.setData(ox,d),n.setData("vivaldi/x-cut",t)}}),[n.document]),c=Li.useCallback((e=>{d(e,"true")}),[d]),u=Li.useCallback((e=>{d(e,"false")}),[d]),{document:p}=n,h=Li.useCallback((async e=>{if(i.current?.contains(p.activeElement)){const{clipboardData:n}=e;if(!n)throw new Error("No clipboardData on paste event");const{allDaySelected:i,selectedDate:s,editingEvent:a}=o.current;if(a)return;(0,ms.ZP)(e);const r=n.getData(ox),l=s?.valueOf()??0;if(r){const e=i,s="true"===n.getData("vivaldi/x-cut")?te.ZP.moveEvent:te.ZP.copyEvent,o=await s(r,{start:l,byDateOnly:e},t.pageId);a?t.handler.editEvent(o):t.handler.selectEvent({event:o})}else{const e=n.getData("text/plain");e&&t.handler.editEvent(null,NL({title:e,start:l}))}}}),[p,t.handler,t.pageId]),g=i.current;Li.useEffect((()=>{if(g)return Ke.Z.bind("ctrl+z",l,{feature:"calendar"}),p.addEventListener("cut",c),p.addEventListener("copy",u),p.addEventListener("paste",h),()=>{Ke.Z.unbind("ctrl+z",l),p.removeEventListener("cut",c),p.removeEventListener("cut",u),p.removeEventListener("paste",h)}}),[p,g,l,c,u,h]);const m=e.displayMode||e.filter.displayMode,f=Zl.ZP.getDefaultCalendar();return(0,ss.jsxs)("div",{ref:i,className:"calendar-viewport outerScrollbar",onContextMenu:t=>{const{HTMLElement:i}=n,s=t.currentTarget.closest(".calendar-grid");s&&s!==p.activeElement&&s instanceof i&&s.focus(),(0,cs.Z)(n,(()=>{const t=[{handler:()=>Gp.Z.paste(n.vivaldiWindowId),...(0,us.Z)("verb","Paste")}];return e.trashedEvents.length&&t.push({handler:l,...(0,us.Z)("Restore Event from Trash")}),t})())(t)},onFocus:e.onFocus,onKeyDown:i=>{const{editingEvent:s,filter:o}=e,a=i.ctrlKey;if(s)switch(OM.Z[i.keyCode]){case"Escape":t.handler.cancelEventEdit();break;case"Del":case"Backspace":a&&!PL(n,i.target)&&te.ZP.trashEvent(s.id)}else switch(OM.Z[i.keyCode]){case"Del":case"Backspace":o.selectedEvent&&te.ZP.trashEvent(o.selectedEvent),i.preventDefault(),i.stopPropagation()}},style:Zl.ZP.getCalendarColorStyles(f),children:[_L("style",{},void 0,Zl.ZP.getCalendarColors()),("day"===m||"week"===m&&!a)&&_L(oL,{anchorDate:e.anchorDate||e.filter.anchorDate,filter:e.filter,events:e.events,displayMode:m,selectedEvent:e.filter.selectedEvent,editingEvent:e.editingEvent,inPanel:a}),("week"===m&&a||"multiweek"===m||"month"===m)&&_L(Ox,{filter:e.filter,events:e.events,displayMode:m,selectedEvent:e.filter.selectedEvent,editingEvent:e.editingEvent}),"year"===m&&_L(vL,{filter:e.filter,events:e.events}),"agenda"===m&&_L(EL,{filter:e.filter,events:e.events,displayMode:m,eventDisplayStyle:e.eventDisplayStyle||"transparent",selectedEvent:e.filter.selectedEvent,editingEvent:e.editingEvent})]})};var ML;function OL(e,t,n,i){ML||(ML="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:ML,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const xL=e=>{const{event:t}=e,{getContextMenu:n}=SO(t),i=Li.useRef(),s=Li.useContext(ts.Z),{document:o,getSelection:a}=s,r=Li.useContext(yM),l=r.handler.updateEventEdit,d=r.handler.saveEventEdit,u=!!e.checkboxes,p=u&&!e.editTemplate,h=e.checkboxes??{};Li.useEffect((()=>{const t=i.current,n=a();if(t&&n&&!e.checkboxes){t.focus();const e=o.createRange();e.selectNodeContents(t),e.collapse(!1),n.removeAllRanges(),n.addRange(e)}}),[o,a,e.checkboxes]);const g={updateEvent:l,saveEventEdit:d,event:t,tabIndex:0},m=t=>n=>{const{value:i}=n.currentTarget;l(AO(e.event,t,i)),e.enableProperty&&e.enableProperty("time")},f=t=>n=>{const{value:i}=n.currentTarget;l(IO(e.event,t,i)),e.enableProperty&&e.enableProperty("time")};const{start:v,end:y}=(0,ih.aE)(t),b=!(t.start||t.end||u),S=u&&t.allDay;return OL("div",{className:"CalendarEventFull",onContextMenu:e=>{PL(s,e.target)?e.stopPropagation():(0,cs.Z)(s,n())(e)},style:{backgroundImage:Wi._9b},onClick:ms.UW},void 0,(!p||h.title)&&OL("div",{className:"CalendarEventFull-Row"},void 0,OL("span",{className:"CalendarEventFull-Icon",dangerouslySetInnerHTML:{__html:Wi.qHs}}),(0,ss.jsx)(dO,{...g,field:"title",label:(0,B.Z)("Title"),focusRef:i,readOnly:p}),h.title),(!p||h.description)&&OL("div",{className:"CalendarEventFull-Row CalendarEventFull-Row--NoIcon"},void 0,(0,ss.jsx)(dO,{...g,field:"description",label:(0,B.Z)("Description"),readOnly:p}),h.description),(!p||h.time)&&!S&&!t.task&&(0,ss.jsx)(ss.Fragment,{children:OL("div",{className:"CalendarEventFull-Row"},void 0,OL("span",{className:"CalendarEventFull-Icon",dangerouslySetInnerHTML:{__html:Wi.zTz}}),OL("div",{className:"edit-group"},void 0,!u&&OL(Vk.Z,{onChange:f("start"),title:(0,B.Z)("Event Start Date"),value:v.format("YYYY-MM-DD")}),!t.allDay&&OL(Yh,{onChange:m("start"),step:"5",title:(0,B.Z)("Event Start Time"),value:v.format("HH:mm")}),"–",!t.allDay&&OL(Yh,{onChange:m("end"),step:"5",title:(0,B.Z)("Event End Time"),value:y.format("HH:mm")}),!u&&OL(Vk.Z,{onChange:f("end"),title:(0,B.Z)("Event End Date"),value:y.format("YYYY-MM-DD")})),h.time)}),(!p||h.time)&&t.task&&OL("div",{className:"CalendarEventFull-Row"},void 0,OL("span",{className:"CalendarEventFull-Icon",dangerouslySetInnerHTML:{__html:Wi.zTz}}),OL("div",{className:"CalendarEventFull-TaskTime edit-group"},void 0,OL(QM,{type:"start",view:"dialog",event:t,updateEvent:l,onDateChange:f("start"),onTimeChange:m("start")}),(!!t.start||!!t.end)&&"–",OL(QM,{type:"due",view:"dialog",event:t,updateEvent:l,onDateChange:f("end"),onTimeChange:m("end")})),h.time),h.duration&&OL("div",{className:Fi()("CalendarEventFull-Row",{"CalendarEventFull-Row--NoIcon":!S})},void 0,S&&OL("span",{className:"CalendarEventFull-Icon",dangerouslySetInnerHTML:{__html:Wi.zTz}}),OL(wM,{event:t,updateEvent:function(t){e.enableProperty&&e.enableProperty("duration"),l(t)}}),h.duration),(!p||h.allDay)&&(!t.task||!!t.end)&&OL("div",{className:"CalendarEventFull-Row CalendarEventFull-Row--NoIcon"},void 0,OL("div",{className:"edit-group"},void 0,OL("label",{},void 0,OL("input",{type:"checkbox",checked:!!t.allDay,onChange:function(t){l({...e.event,allDay:t.currentTarget.checked})}}),OL("span",{},void 0,(0,B.Z)("All Day")))),h.allDay),(!p||h.timezone)&&(!t.task||!!t.end)&&OL("div",{className:"CalendarEventFull-Row CalendarEventFull-Row--NoIcon"},void 0,OL("div",{className:"edit-group"},void 0,OL(yO,{event:t,setSelectedItem:t=>{l((0,ih.bn)({...e.event},t.value))}})),h.timezone),(!p||h.task)&&OL("div",{className:"CalendarEventFull-Row"},void 0,OL("span",{className:"CalendarEventFull-Icon",dangerouslySetInnerHTML:{__html:Wi._9b}}),OL("div",{className:"edit-group"},void 0,OL("label",{},void 0,OL("input",{type:"checkbox",checked:!!t.task,onChange:function(t){l({...e.event,task:t.currentTarget.checked})}}),OL("span",{},void 0,(0,B.Z)("Is a Task"))),!u&&OL("label",{},void 0,OL("input",{disabled:!t.task,type:"checkbox",checked:!!t.complete,onChange:function(t){l({...e.event,complete:t.currentTarget.checked})}}),OL("span",{},void 0,(0,B.Z)("Complete")))),h.task),(!p||h.location)&&OL("div",{className:"CalendarEventFull-Row"},void 0,OL("span",{className:"CalendarEventFull-Icon",dangerouslySetInnerHTML:{__html:Wi.GF3}}),(0,ss.jsx)(dO,{...g,field:"location",label:(0,B.Z)("other","Location"),readOnly:p}),h.location),(!p||h.recurrence)&&OL("div",{className:"CalendarEventFull-Row"},void 0,OL("span",{className:"CalendarEventFull-Icon CalendarEventFull-Icon--WithInput",dangerouslySetInnerHTML:{__html:Wi.Eki}}),OL("div",{className:"CalendarEventFull-RowContent"},void 0,!b&&(0,ss.jsx)(YM.Z,{...g,field:"recurrence",label:"recurrence"}),b&&OL("div",{className:"edit-group capped-width"},void 0,OL("span",{className:"info"},void 0,(0,B.Z)("Task without time can not recur.")))),h.recurrence),(!p||h.url)&&OL("div",{className:"CalendarEventFull-Row"},void 0,OL("span",{className:"CalendarEventFull-Icon",dangerouslySetInnerHTML:{__html:Wi.wTH}}),(0,ss.jsx)(dO,{...g,field:"url",label:(0,B.Z)("URL"),readOnly:p}),h.url),!p&&t.attachment&&t.attachment.length>0&&OL("div",{className:"CalendarEventFull-Row"},void 0,OL("span",{className:"CalendarEventFull-Icon",dangerouslySetInnerHTML:{__html:Wi.onv}}),t.attachment.map((e=>OL("div",{className:"CalendarEventFull-Attachment"},e.url,OL("a",{onClick:()=>c.ZP.openURL(s.vivaldiWindowId,e.url),title:e.url},void 0,e.filename||e.url))))),(!p||h.reminders)&&OL("div",{className:"CalendarEventFull-Row"},void 0,OL("span",{className:"CalendarEventFull-Icon CalendarEventFull-Icon--WithInput",dangerouslySetInnerHTML:{__html:Wi.PPL}}),OL("div",{className:"CalendarEventFull-RowContent"},void 0,OL(BM,{event:t,updateEvent:l,readOnly:p})),h.reminders),(!p||h.participants)&&!t.task&&OL("div",{className:"CalendarEventFull-Row"},void 0,OL("span",{className:"CalendarEventFull-Icon CalendarEventFull-Icon--WithInput",dangerouslySetInnerHTML:{__html:Wi.Rs2}}),OL("div",{className:"CalendarEventFull-RowContent"},void 0,(0,ss.jsx)(zM,{...g,field:"attendees",label:(0,B.Z)("Type to add Participants"),readOnly:p})),h.participants),(!p||h.calendar)&&OL("div",{className:"CalendarEventFull-Row"},void 0,OL("span",{className:"CalendarEventFull-Icon CalendarEventFull-Icon--WithInput",dangerouslySetInnerHTML:{__html:Wi.fIz}}),OL("div",{className:"CalendarEventFull-RowContent"},void 0,hh(t,(e=>{u||te.ZP.setDefaultCalendarId(e,t.task),l({...t,calendarId:e})}),0)),h.calendar),!u&&OL("div",{className:"CalendarEventFull-Row CalendarEventFull-Row--NoIcon"},void 0,OL(iO,{event:t,updateEvent:l})),""===t.id&&t.filteredOut&&!r.isWidget&&OL(To,{type:"warning"},void 0,t.task?(0,B.Z)("Once saved this task will be hidden by current search"):(0,B.Z)("Once saved this event will be hidden by current search")),r.isTaskList&&!t.task&&OL(To,{type:"warning"},void 0,(0,B.Z)("Once saved this event will not show in the task list")),t.filteredOut&&r.isWidget&&OL(To,{type:"warning"},void 0,t.task?(0,B.Z)("Once saved this task will be hidden by calendar selection."):(0,B.Z)("Once saved this event will be hidden by calendar selection.")))};var LL;function RL(e,t,n,i){LL||(LL="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:LL,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class BL extends Li.PureComponent{static contextType=ts.Z;refSwitchInput=Li.createRef();refSwitchButton=Li.createRef();OFF=0;ON=12;constructor(e){super(e),e.scale&&(this.ON=this.ON*e.scale),this.state={dragging:!1,position:e.checked?this.ON:this.OFF}}componentDidUpdate(e){e.checked!==this.props.checked&&this.updateButtonPosition()}updateButtonPosition=()=>{this.setState({position:this.props.checked?this.ON:this.OFF})};onChange=e=>{const t=e.target.checked?this.ON:this.OFF;this.setState({position:t}),this.props.onChange&&this.props.onChange(e)};onClick=e=>{this.state.dragging?(e.preventDefault(),this.setState({dragging:!1})):this.toggleSwitch()};toggleSwitch=()=>{const e=new MouseEvent("click",{bubbles:!0,cancelable:!0});this.refSwitchInput.current?.dispatchEvent(e)};cancelEvent=e=>{e.preventDefault()};releasePointerCapture=e=>{e.currentTarget.hasPointerCapture(e.pointerId.toString())&&e.currentTarget.releasePointerCapture(e.pointerId)};onPointerDown=e=>{e.currentTarget.setPointerCapture(e.pointerId)};onPointerMove=e=>{if(1===e.buttons&&this.refSwitchButton.current===this.context.document.activeElement){const{movementX:t}=e;0!==t&&this.setState((e=>({dragging:!0,position:(0,Gw.Z)(e.position+t,0,this.ON)})))}};onPointerUp=e=>{if(this.state.dragging){this.releasePointerCapture(e);const{position:t}=this.state;t>=0&&t<=this.ON/2?(this.setState({position:this.OFF}),this.props.checked&&this.toggleSwitch()):(this.setState({position:this.ON}),this.props.checked||this.toggleSwitch())}};render(){const{position:e}=this.state;return RL("div",{className:Fi()("Switch",{"Switch--Disabled":this.props.disabled,"Switch--Progress":this.props.inProgress,"Switch--Progress-Done":this.props.checked&&this.props.hasOwnProperty("inProgress")}),style:this.props.scale?{transform:`scale(${this.props.scale})`}:void 0,title:this.props.title},void 0,(0,ss.jsx)("input",{id:this.props.inputId,ref:this.refSwitchInput,className:"Switch-Input",type:"checkbox",onChange:this.onChange,checked:this.props.checked,disabled:this.props.disabled,value:this.props.value,onPointerDown:this.cancelEvent,tabIndex:this.props.tabIndex}),(0,ss.jsx)("button",{ref:this.refSwitchButton,className:Fi()({"Switch-Button":!0,dragging:this.state.dragging}),style:{transform:`translateX(${e/(this.props.scale||1)}px)`},onPointerDown:this.onPointerDown,onPointerMove:this.onPointerMove,onPointerUp:this.onPointerUp,onPointerCancel:this.releasePointerCapture,onClick:this.onClick,tabIndex:"-1"}))}}const FL=BL;var WL;function UL(e,t,n,i){WL||(WL="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:WL,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const VL={title:"title",description:"description",allDay:"allDay",timezone:"timezone",task:"task",location:"location",rrule:"recurrence",url:"url",notifications:"reminders",invites:"participants",calendarId:"calendar"},HL={selectDate:Lr.Z,selectEvent:e=>{},selectCalendars:Lr.Z,toggleShowCompleted:Lr.Z,editEvent:(e,t)=>Promise.resolve(),updateEventEdit:e=>{},saveEventEdit:()=>Promise.resolve(),endEventEdit:e=>Promise.resolve(),cancelEventEdit:Lr.Z};function GL(e){const[t,n]=(0,Li.useState)({...e.event}),[i,s]=(0,Li.useState)(e.name),[o,a]=(0,Li.useState)(e.properties),r=(0,Li.useContext)(yM),{edit:l=!0,templateId:d,setSaveTemplate:c}=e,u=(0,Li.useRef)();function p(e,n){if(o.hasOwnProperty(e)){const s={...o,[e]:n};return a(s),u.current=(0,JM.tL)(t,s),u.current.name=i,s}return o}(0,Li.useEffect)((()=>{u.current=function(e,t,n){return{...(0,JM.tL)(e,t),name:n}}(e.event,e.properties,e.name)}),[e.event,e.properties,e.name]),(0,Li.useEffect)((()=>{n({...e.event}),a({...e.properties}),s(e.name)}),[e.name,e.properties,e.event]),(0,Li.useEffect)((()=>{c((function(){if(!u.current)return;const e=u.current;if(!e.name)throw new Error((0,B.Z)("Please name the template"));if(Object.keys(e).length<=1)throw new Error((0,B.Z)("No property selected. Please select at least one to save template."));d?te.ZP.updateTemplate(d,e):te.ZP.createEventTemplate(e)}))}),[c,d]);const h={...HL,updateEventEdit:e=>{let s=o;for(const n of Object.keys(VL))t[n]!==e[n]&&(s=p(VL[n],!0));const a={...e};n(a),u.current=(0,JM.tL)(a,s),u.current.name=i}};function g(e){p(e.target.id,e.target.checked)}let m;for(const e in o){if(!l&&!o[e])continue;const n=!l||"timezone"===e&&t.allDay;m={...m,[e]:UL(FL,{inputId:e,checked:!!o[e],disabled:n,onChange:g})}}const f={...r,handler:h},v=!!d;return UL("fieldset",{className:"detail-content",disabled:!l},void 0,l&&UL("label",{className:"floating-label"},void 0,UL("span",{},void 0,(0,B.Z)("Template name")),UL("input",{value:i,name:"name",onChange:function(e){const t=e.target.value;u.current&&(u.current.name=t),s(t)},type:"text"})),!v&&UL("p",{className:"info"},void 0,(0,B.Z)("Select the properties you want to include in the template. Any changes you make will not be saved to the original event.")),UL(yM.Provider,{value:f},void 0,UL(xL,{event:t,checkboxes:m,editTemplate:l,enableProperty:e=>{p(e,!0)}})))}var $L;function KL(e,t,n,i){$L||($L="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:$L,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const zL={id:"",calendarId:"",title:"",start:0,end:0};function jL(e){const[t,n]=(0,Li.useState)(!e.templateId),[i,s]=(0,Li.useState)(""),o=(0,Li.useRef)(Lr.Z),a=(0,Li.useMemo)((()=>{const t=((0,ih.FL)(new Date).getHours()+1)*me.QI,n=t+C.Z.get(I.kCalendarDefaultDuration);return(0,JM.$u)(e.template,{...zL,start:t,end:n})}),[e.template]),r=(0,Li.useMemo)((()=>(0,JM.e$)(e.template)),[e.template]);(0,Li.useEffect)((()=>{n(!e.templateId)}),[e.templateId]);const l=(0,Li.useCallback)((e=>{o.current=e}),[]);return KL("form",{className:"detail edit-template"},void 0,KL(GL,{templateId:e.templateId,name:e.template.name,event:a,properties:r,setSaveTemplate:l,edit:t}),i&&KL(To,{type:"error"},void 0,i),KL("div",{className:"detail-toolbar"},void 0,KL("input",{type:"button",value:t?(0,B.Z)("Save"):(0,B.Z)("verb","Edit"),onClick:t?async function(){s("");try{o.current()}catch(e){s(e.message)}}:function(){n(!0)}})))}var YL,XL=n(41851);function QL(e,t,n,i){YL||(YL="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:YL,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const qL=n(28888),JL={},eR={"Add your First Event Template":(0,B.Z)("Add your First Event Template"),"Press the “Add” button to the left to add a new template.":(0,B.Z)("Press the “Add” button to the left to add a new template.")};function tR(e,t){return QL("div",{className:"item-title"},void 0,t.name)}var nR,iR=QL("div",{className:"item-meta"},void 0," ");function sR(){return(0,ss.jsxs)(ss.Fragment,{children:[QL("div",{className:"item-title"},void 0,(0,B.Z)("New Template")),iR]})}function oR(e){return QL("div",{className:"detail"},void 0,QL("div",{className:"detail-content"},void 0,QL("h3",{},void 0,eR["Add your First Event Template"]),QL("p",{},void 0,eR["Press the “Add” button to the left to add a new template."])))}function aR(e){const{templates:t}=(0,DD.Z)(El.Z),n=(0,Li.useRef)(""),[i,s]=(0,Li.useState)({id:""}),o=(0,Li.useMemo)((()=>(n.current="",t.map((e=>({...e,key:e.id}))))),[t]);return QL(tN.Z,{categoryTitle:(0,B.Z)("Event Templates"),filter:e.filter},void 0,QL(QD.Z,{className:"giant",deleteTitle:(0,B.Z)("Delete Template"),onRemove:function(e){const n=t[e]?.id;te.ZP.removeTemplate(n)},addTipString:(0,B.Z)("Add Template"),deleteTipString:(0,B.Z)("Delete Template"),emptyListGraphic:qL,emptyListString:(0,B.Z)("No Templates added"),filter:e.filter,items:o,masterLayout:1,renderListItem:tR,renderCreateListItem:sR,renderContent:function(e,o){const a=t[e]?.id;if(n.current!==a)return n.current=a,XL.Z.loadTemplate(a).then((e=>{e&&s({id:a,template:e})})),null;const{template:r}=i;return r?QL(jL,{templateId:a,template:r}):null},renderCreate:function(e){return QL(jL,{templateId:"",template:{name:(0,B.Z)("New Template")}})},renderEmpty:oR,contentStrings:JL,emptyStrings:eR,createStrings:JL}))}function rR(e,t,n,i){nR||(nR="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:nR,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const lR=function(e){const[t,n]=Li.useState(""),[i,s]=Li.useState(""),[o,a]=Li.useState(!1),{item:r,onClose:l,onDeleteInProgress:d}=e,c=t===r.id,{account:u}=Zl.ZP.getAccountAndCalendar(r.id),p="ical"!==u?.account_type;return rR("div",{},void 0,rR("header",{className:"dialog-header"},void 0,rR("h1",{className:"dialog-title"},void 0,(0,B.Z)("Are you sure you want to delete the calendar ‘$1’ and its events?",[r.description]))),rR("div",{className:"dialog-content"},void 0,"local"===u?.account_type&&rR("p",{className:"faded-text"},void 0,(0,B.Z)("This will permanently delete your local calendar and associated events. It can not be undone.")),"ical"===u?.account_type&&rR("p",{className:"faded-text"},void 0,(0,B.Z)("This will not delete any data on the remote server. You can set it up again if you later want to use it in Vivaldi.")),u&&Zl.ZP.isCalDAV(u.account_type)&&rR("p",{className:"faded-text"},void 0,(0,B.Z)("This will permanently delete the calendar on the remote server. It can not be undone. You can use the calendar settings to disable sync or hide the calendar.")),p&&rR("label",{},void 0,rR("input",{type:"checkbox",checked:o,onChange:e=>a(e.target.checked)}),(0,B.Z)("I understand that this will delete data permanently")),i&&rR(To,{type:"error"},void 0,i)),rR("footer",{className:"dialog-footer"},void 0,rR("input",{type:"button",className:"danger",disabled:c||p&&!o,onClick:async()=>{s(""),d(!0),n(r.id);const e=await te.ZP.deleteCalendar(r,!0);!1===e.status?s(e.message):d(!1),n("")},value:c?(0,B.Z)("Deleting Calendar"):(0,B.Z)("verb","Delete"),autoFocus:!0}),rR("input",{type:"button",onClick:l,disabled:c,value:(0,B.Z)("Cancel")})))};var dR;function cR(e,t,n,i){dR||(dR="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:dR,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class uR extends Li.Component{nodeRef=Li.createRef();state={originalColor:this.props.color};#kt=()=>{this.props.setColor(xe()(this.state.originalColor),this.props.name,!1)};#_t=e=>{const t=e.currentTarget.value.trim();t.length<=3&&this.props.setColor(xe()(t),this.props.name)};#Nt=e=>{"Escape"===e.key?(e.preventDefault(),this.#kt()):"Enter"===e.key&&this.#_t(e)};render(){return cR("input",{type:"color",title:(0,B.Z)("Show system color picker"),className:"colorpicker-system",value:`#${this.props.color}`,onKeyDown:this.#Nt,onChange:this.#_t})}}const pR=uR;var hR;function gR(e,t,n,i){hR||(hR="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:hR,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function mR({className:e}){return gR("span",{className:e,dangerouslySetInnerHTML:{__html:Wi.yaZ.small}})}var fR=gR(mR,{className:"VivaldiDropdown-SelectedValue-Arrow"});function vR({item:e}){return gR("span",{className:"VivaldiDropdown-SelectedValue"},void 0,e&&e.icon&&gR("img",{src:e.icon,className:"VivaldiDropdown-SelectedValue-Icon"}),e&&e.faviconUrl&&gR(Ri.ZP,{url:e.faviconUrl,className:"VivaldiDropdown-SelectedValue-Icon",loadType:"faviconFromCache"}),e&&gR("span",{className:"VivaldiDropdown-SelectedValue-Title"},void 0,e.name),fR)}var yR=gR(mR,{className:"VivaldiDropdown-SelectedValue-Arrow"}),bR=gR(mR,{className:"VivaldiDropdown-SelectedValue-Arrow"});class SR extends Li.Component{refButton=Li.createRef();state={isExpanded:!1};#ce=({id:e})=>{this.props.onValueChange(e),this.#Pt()};#Pt=()=>{this.setState({isExpanded:!1}),this.#Dt()};#Mt=e=>{(0,ms.ZP)(e),this.setState((e=>({isExpanded:!e.isExpanded})))};#Ot=e=>{switch(e.which){case xa.Z.KEY_UP:case xa.Z.KEY_DOWN:this.setState({isExpanded:!0})}};#Dt=()=>{this.refButton.current?.focus()};render(){const e=this.props.items.find((e=>e.id===this.props.value));return gR("div",{className:Fi()("VivaldiDropdown",this.props.className)},void 0,(0,ss.jsx)("button",{type:"button",ref:this.refButton,disabled:this.props.disabled,onMouseUp:this.#Mt,title:this.props.tooltip,className:Fi()("VivaldiDropdown-Button",{"VivaldiDropdown-Button--isActive":this.state.isExpanded}),onKeyDown:this.#Ot,children:this.props.hideButtonText?yR:this.props.placeholder&&!e?gR("div",{className:"VivaldiDropdown-Placeholder"},void 0,gR("p",{},void 0,this.props.placeholder),bR):gR(vR,{item:e||this.props.items[0]})}),this.state.isExpanded&&gR(Nw,{className:"VivaldiDropdown-DropdownMenu",items:this.props.items,onClose:this.#Pt,onItemActivated:this.#ce,selectedItem:e,outsideClickIgnoreClass:"VivaldiDropdown-Button"}))}}const wR=SR;var CR;function AR(e,t,n,i){CR||(CR="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:CR,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const IR=/^([0-9a-f]{3}){1,2}$/i;var TR=AR("span",{className:"ColorEditor-HexTextInput-Octothorpe"},void 0,"#");class ZR extends Li.Component{refColorToggle=Li.createRef();constructor(e){super(e),this.state={color:e.colorValue.substring(1)},this.debouncedSetColor=(0,Ae.Z)(this.props.setColor,100,{leading:!1}),e.predefinedColors&&(this.dropdownColors=e.predefinedColors.map((e=>({type:"Normal",name:e.name,iconSVG:this.createColorIcon(e.value),noPrettifying:!0,id:e.value}))))}createColorIcon=e=>`<svg width="16" height="16" viewBox="0 0 16 16">\n      <rect x="0" y="0" width="16" height="16" rx="2" ry="2" fill="${e}" />\n    </svg>`;hexInputEvents=e=>{let t=e.currentTarget.value;if("#"===t.charAt(0)&&(t=t.substring(1)),t.length>6&&(t=t.substring(0,6)),this.setState({color:t}),IR.test(t)){const e=xe()(t);e&&this.props.setColor(e,this.props.colorKey)}};onColorPicked=(e,t,n=!1)=>{this.setState({color:e.hex().substring(1)}),n?this.debouncedSetColor(e,t):this.props.setColor(e,t)};onDropdownColorSelected=e=>{const t=xe()(e);t&&(this.setState({color:t.hex().substring(1)}),this.props.setColor(t,this.props.colorKey))};render(){const e=this.props.colorKey,t=this.props.predefinedColors&&this.props.predefinedColors.length>0;let{color:n}=this.state;return IR.test(n)||(n=this.props.colorValue.replace("#","")),AR("div",{className:Fi()("ColorEditor",{"with-dropdown":t})},void 0,this.props.label&&AR("label",{htmlFor:e,className:"color-name"},void 0,this.props.label),AR("div",{className:"ColorEditor-ColorPickerContainer"},void 0,AR(pR,{name:e,color:n,setColor:this.onColorPicked},e),t&&AR(wR,{className:"ColorEditor-VivaldiDropdown",disabled:this.props.disabled,items:this.dropdownColors,onValueChange:this.onDropdownColorSelected,tooltip:(0,B.Z)("Choose a Color"),value:n,hideButtonText:!0})),AR("div",{className:"ColorEditor-HexTextInput"},void 0,TR,AR("input",{className:"ColorEditor-HexTextInput-InputField",type:"text",id:e,disabled:this.props.disabled,value:this.state.color,spellCheck:"false",size:"6",onChange:this.hexInputEvents})))}}const ER=ZR;var kR;function _R(e,t,n,i){kR||(kR="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:kR,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var NR=_R("input",{type:"radio",value:"all"}),PR=_R("input",{type:"radio",value:"vevent"}),DR=_R("input",{type:"radio",value:"vtodo"});class MR extends Li.PureComponent{static defaultProps={searchableStrings:{Events:"Events",Tasks:"Tasks"}};constructor(e){super(e)}onChangeCalendarComponent=e=>{const t={...this.props.supportedCalendarComponent},{value:n}=e.target;"all"===n?(t.vtodo=!0,t.vevent=!0):(t.vtodo="vtodo"===n,t.vevent="vevent"===n),this.props.updateCalendarComponent(t)};getSupportedComponent(){const{vevent:e,vtodo:t}=this.props.supportedCalendarComponent;return e&&t?"all":e?"vevent":"vtodo"}render(){return _R("div",{className:"setting-group"},void 0,_R("h3",{},void 0,(0,B.Z)("Allowed Calendar Items")),_R(ja.Z,{name:"calendar-density",value:this.getSupportedComponent(),onChange:this.onChangeCalendarComponent,className:"group",disabled:this.props.disabled},void 0,_R("label",{className:"setting-single"},void 0,NR,_R("span",{},void 0,(0,B.Z)("calendar","All"))),_R("label",{className:"setting-single"},void 0,PR,_R("span",{},void 0,(0,B.Z)("calendar","Events Only"))),_R("label",{className:"setting-single"},void 0,DR,_R("span",{},void 0,(0,B.Z)("Tasks Only")))))}}const OR=MR;const xR=async function(e,{showSaveFilePicker:t}){const n=El.Z.getCalendars().find((t=>t.id===e)),{description:i=(0,B.Z)("Events")}=n||{};try{!async function(e,t){if(!e)return;const n=[...El.Z.getEventsPerCalendar(t)];n.forEach((e=>{e.recurrenceExceptions?.length&&e.recurrenceExceptions.forEach((t=>{const i=n.findIndex((e=>e.id===t.exception_event_id));-1!==i&&(n[i]={...n[i],recurrenceId:t.date,sequence:e.sequence})}))}));const i=Zl.ZP.eventsToICalendar(n);try{const t=await e.createWritable();await t.write(i),await t.close()}catch(e){nn.Z.error("Calendar",["export"],"Exporting events failed.",e)}}(await t({suggestedName:`${i}.ics`,types:[{description:(0,B.Z)("iCalendar file"),accept:{"text/calendar":[".ics"]}}]}),e)}catch(e){nn.Z.error("Calendar",["export"],"Error opening filepicker",e)}};var LR;function RR(e,t,n,i){LR||(LR="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:LR,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const{isLocalCalendar:BR}=Zl.ZP,{UNKNOWN:FR,OK:WR,ERROR:UR}=me.LB;class VR extends Li.Component{static contextType=ts.Z;state={status:FR,statusText:"",calendar:this.props.calendar};isCalendarChanged=()=>{const e=this.props.calendar;if(!e)return!1;const t=this.state.calendar;return!(0,QT.Z)(t,e)};setCalendarProperty=e=>{this.setState((t=>({calendar:{...t.calendar,...e}})))};onChange=e=>{const{name:t,value:n}=e.target,i={},s="iconindex"===t?isNaN(n)?0:parseInt(n):n;i[t]=s,this.setCalendarProperty(i)};logStatus=(e,t)=>{this.setState({status:t,statusText:e})};saveCalendar=()=>{this.state.calendar.description?this.props.save(this.state.calendar):this.setState({statusText:(0,B.Z)("Calendar Name cannot be empty")})};setColor=(e,t,n=!1)=>{this.setCalendarProperty({color:e.hex()})};onChangeCheckbox=e=>{const{checked:t,name:n}=e.target;this.setCalendarProperty({[n]:t})};onChangeCalendarComponent=e=>{this.setCalendarProperty({supportedCalendarComponent:e})};exportCalendar=e=>{xR(this.state.calendar.id,this.context)};render(){const{description:e,hidden:t,active:n,id:i,supportedCalendarComponent:s}=this.state.calendar,{disabledProperties:o,searchableStrings:a}=this.props,r=Zl.ZP.getCalendarColor(this.state.calendar),l=this.state.status===UR?"error":this.state.status===WR?"success":"info";return RR("form",{className:"detail",onSubmit:this.saveCalendar},void 0,RR("div",{className:"detail-content"},void 0,RR("div",{className:"setting-group"},void 0,RR("div",{className:"setting-single"},void 0,RR(Vl.Z,{type:"text",onChange:this.onChange,name:"description",label:a["Calendar Name"],value:e,disabled:o.includes("name")})),RR("div",{className:"setting-single"},void 0,RR("label",{},void 0,RR("input",{type:"checkbox",name:"hidden",checked:t,onChange:this.onChangeCheckbox}),RR("span",{},void 0,a["Hide from Calendar View"])))),RR("div",{className:"setting-group"},void 0,RR("div",{className:"setting-single"},void 0,RR(ER,{label:a.Color,colorKey:"color",colorValue:r,setColor:this.setColor,predefinedColors:eh.hx,disabled:o.includes("color")}))),!BR(i)&&RR("div",{className:"setting-group"},void 0,RR("h3",{},void 0,(0,B.Z)("Sync Calendar")),RR("div",{className:"setting-single"},void 0,RR("label",{title:(0,B.Z)("Active")},void 0,RR("input",{type:"checkbox",name:"active",checked:n,onChange:this.onChangeCheckbox}),RR("span",{},void 0,a.Active)))),RR(OR,{supportedCalendarComponent:s,updateCalendarComponent:this.onChangeCalendarComponent,searchableStrings:this.props.searchableStrings,disabled:!BR(i)}),this.state.statusText&&RR("div",{className:"setting-group-double"},void 0,RR(To,{type:l},void 0,this.state.statusText))),RR("div",{className:"detail-toolbar"},void 0,RR("input",{type:"submit",value:(0,B.Z)("Save"),disabled:!this.isCalendarChanged()}),RR("input",{type:"button",onClick:this.exportCalendar,value:(0,B.Z)("Export Calendar")})))}}const HR=VR;var GR;function $R(e,t,n,i){GR||(GR="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:GR,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const{isCalendarValidToCreate:KR}=Zl.ZP,{getCalendarCreateParams:zR}=kl.Z;class jR extends Li.PureComponent{constructor(e){super(e);const t=Zl.ZP.getDefaultAccount();this.state=t?{calendar:zR(t),statusText:"",status:"info"}:{calendar:null,statusText:(0,B.Z)("No Account defined. Can not create calendar."),status:"error"}}setColor=(e,t,n=!1)=>this.setCalendarProperty(t,e.hex());onAccountChange=e=>{this.setCalendarProperty("accountId",e.target.value)};onCalendarChange=e=>{const{name:t,value:n}=e.target,i="iconindex"===t?isNaN(n)?0:parseInt(n):n;this.setCalendarProperty(t,i)};setCalendarProperty=(e,t)=>this.setState((n=>{let i=n.calendar?.active;if("accountId"===e){i="local"!==El.Z.getAccounts().find((e=>e.id===t))?.account_type}return{calendar:n.calendar&&{...n.calendar,active:i,[e]:t},status:"info",statusText:""}}));createCalendar=async()=>{const e=this.state.calendar;if(!e)return void this.setState({status:"error",statusText:(0,B.Z)("Calendar missing")});this.setState({status:"info",statusText:(0,B.Z)("Creating calendar")});const t=await this.props.createCalendar(e);t.result.status||this.setState({status:"error",statusText:t.result.message})};isCalendarValidToCreate=()=>!!this.state.calendar&&KR(this.state.calendar);onChangeCalendarComponents=e=>{this.setState((t=>({calendar:t.calendar&&{...t.calendar,supportedCalendarComponent:e}})))};render(){const{calendar:e}=this.state,t=El.Z.getAccounts().filter((e=>"ical"!==e.account_type));return $R("form",{className:"detail",onSubmit:this.createCalendar},void 0,!!e&&$R("div",{className:"detail-content"},void 0,t.length>1&&$R("div",{className:"setting-group"},void 0,$R("div",{className:"setting-single"},void 0,$R("label",{className:"floating-label"},void 0,$R("span",{},void 0,(0,B.Z)("Account")),$R(ta.Z,{onChange:this.onAccountChange,value:e.accountId},void 0,t.map((e=>$R("option",{value:e.id},e.id,e.name))))))),$R("div",{className:"setting-group"},void 0,$R("div",{className:"setting-single"},void 0,$R(Vl.Z,{type:"text",onChange:this.onCalendarChange,name:"description",label:this.props.searchableStrings["Calendar Name"],value:e.description??"",autoFocus:!0}))),$R("div",{className:"setting-group"},void 0,$R("div",{className:"setting-single"},void 0,$R(ER,{label:this.props.searchableStrings.Color,colorKey:"color",colorValue:e.color||Zl.ZP.getCalendarCreateColor(),setColor:this.setColor,predefinedColors:eh.hx}))),$R(OR,{supportedCalendarComponent:e.supportedCalendarComponent,updateCalendarComponent:this.onChangeCalendarComponents,searchableStrings:this.props.searchableStrings,disabled:!1})),!!this.state.statusText&&$R(To,{type:this.state.status},void 0,this.state.statusText),$R("div",{className:"detail-toolbar"},void 0,$R("input",{className:"primary",type:"submit",disabled:!this.isCalendarValidToCreate(),value:(0,B.Z)("Create Calendar")})))}}const YR=jR;var XR;function QR(e,t,n,i){XR||(XR="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:XR,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const qR=n(28888),{ensureAccountType:JR,isCalDAV:eB}=Zl.ZP,tB={"Add your First Calendar":(0,B.Z)("Add your First Calendar"),"Press the “Add” button to the left to add a new Calendar.":(0,B.Z)("Press the “Add” button to the left to add a new Calendar.")},nB={...eh.d3,"Calendar Name":(0,B.Z)("Calendar Name"),Active:(0,B.Z)("Active"),"Hide from Calendar View":(0,B.Z)("Hide from Calendar View"),"Calendar Type":(0,B.Z)("Calendar Type"),Name:(0,B.Z)("calendar","Name"),CalDav:(0,B.Z)("CalDAV"),URL:(0,B.Z)("Address"),Subscribe:(0,B.Z)("Subscribe"),Password:(0,B.Z)("Password"),Username:(0,B.Z)("Username"),Timezone:(0,B.Z)("Timezone"),Color:(0,B.Z)("calendar","Color"),Index:(0,B.Z)("Index"),Events:(0,B.Z)("Events"),Tasks:(0,B.Z)("Tasks")};var iB=QR("div",{}),sB=QR("div",{className:"item-meta"},void 0," ");class oB extends Li.PureComponent{renderListItem=(e,t)=>{const n=this.props.accounts.find((e=>e.id===t.accountId));if(n){const e=JR(n.account_type),i="local"===e?Wi.Rd:Wi.eTS.large;return(0,ss.jsxs)(ss.Fragment,{children:[QR("span",{className:"item-icon",style:{fill:Zl.ZP.getCalendarColor(t)},dangerouslySetInnerHTML:{__html:i}}),QR("div",{className:"item-title"},void 0,t.description||t.name),QR("div",{className:"item-meta"},void 0,`${n.name} (${eh.d3[e]})`)]})}return iB};renderCreateListItem=()=>(0,ss.jsxs)(ss.Fragment,{children:[QR("div",{className:"item-title"},void 0,(0,B.Z)("noun","New Calendar")),sB]});save=e=>{const{id:t,...n}=e;te.ZP.updateCalendar(t,n)};createCalendar=e=>{if(0===El.Z.getAccounts().length)return kl.Z.createLocalAccountAndCalendar(null,e);{const t=this.props.accounts.find((t=>t.id===e.accountId));return te.ZP.createCalendar(e,t,!0)}};renderContent=(e,t)=>{const{calendars:n}=this.props,i=n&&n[e];if(!i)return null;const s=wn()(Object.values(i).reduce(((e,t)=>e+t))),o=this.props.accounts.find((e=>e.id===i.accountId)),a=[];return eB(o?.account_type)&&a.push("name"),"google"===o?.account_type&&i.supportedCalendarComponent?.vtodo&&a.push("color"),QR(HR,{save:this.save,searchableStrings:t,calendar:i,disabledProperties:a},s)};renderCreate=e=>QR(YR,{searchableStrings:e,createCalendar:this.createCalendar});renderEmpty=e=>QR("div",{className:"detail"},void 0,QR("div",{className:"detail-content"},void 0,QR("h3",{},void 0,tB["Add your First Calendar"]),QR("p",{},void 0,tB["Press the “Add” button to the left to add a new Calendar."])));remapCalendars=()=>this.props.calendars.map((e=>({...e,key:e.id})));deleteCalendarDialog=e=>(0,ss.jsx)(lR,{...e});render(){return QR(tN.Z,{categoryTitle:(0,B.Z)("Calendars"),filter:this.props.filter},void 0,QR(QD.Z,{className:"tall",deleteDialog:this.deleteCalendarDialog,addTipString:(0,B.Z)("Add Calendar"),deleteTipString:(0,B.Z)("tooltip","Delete Calendar"),emptyListGraphic:qR,emptyListString:(0,B.Z)("No Calendars added"),filter:this.props.filter,items:this.remapCalendars(),masterLayout:0,onRemove:Lr.Z,renderListItem:this.renderListItem,renderCreateListItem:this.renderCreateListItem,renderContent:this.renderContent,renderCreate:this.renderCreate,renderEmpty:this.renderEmpty,contentStrings:nB,emptyStrings:tB,createStrings:nB}))}}const aB=MD(oB);var rB;function lB(e,t,n,i){rB||(rB="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:rB,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class dB extends Li.Component{_hiddenRange=Li.createRef();setValue=e=>{const t=this._hiddenRange.current,n=(Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value")||{}).set;t&&n&&(n.call(t,e.currentTarget.value),t.dispatchEvent(new Event("input",{bubbles:!0})))};render(){const{prefValues:e,className:t,label:n,minLabel:i,maxLabel:s,...o}=this.props,a=this.props.step||1,r=["RangeButtonInput",t].join(" ");return e[I.kAppearanceRangeButtons]?lB("span",{className:r},void 0,(0,ss.jsx)("input",{...o,ref:this._hiddenRange,type:"range",onChange:this.props.onChange,hidden:!0}),lB("button",{type:"button",className:"FormButton",onClick:this.setValue,title:i??(0,B.Z)("Decrease"),value:Number((this.props.value-a).toFixed(2)),disabled:this.props.disabled||this.props.value<=this.props.min,dangerouslySetInnerHTML:{__html:Wi.M2k.medium}}),n??this.props.value,lB("button",{type:"button",className:"FormButton",onClick:this.setValue,title:s??(0,B.Z)("Increase"),value:Number((this.props.value+a).toFixed(2)),disabled:this.props.disabled||this.props.value>=this.props.max,dangerouslySetInnerHTML:{__html:Wi.md4.medium}})):lB("label",{className:r},void 0,(0,ss.jsx)("input",{...o,type:"range"}),lB("span",{},void 0,n??this.props.value))}}const cB=(0,Bu.Z)(dB,[I.kAppearanceRangeButtons]);var uB;function pB(e,t,n,i){uB||(uB="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:uB,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const hB=[I.kCalendarAutoAdjustEnd,I.kCalendarAutoTabDatetime,I.kCalendarClickOutside,I.kCalendarClickTimeSlot,I.kCalendarCollapseHours,I.kCalendarDayEnds,I.kCalendarDayStarts,I.kCalendarDefaultAlldayNotification,I.kCalendarDefaultAlldayNotificationTime,I.kCalendarDefaultDuration,I.kCalendarDefaultNotification,I.kCalendarDisplayDensity,I.kCalendarDisplayDimPastEvents,I.kCalendarHandleIcsDownloads,I.kCalendarHandleWebcalLinks,I.kCalendarDisplayEventIcons,I.kCalendarDisplayWeekNumber,I.kCalendarEditMode,I.kCalendarHiddenHidesNotifications,I.kCalendarMailAccount,I.kCalendarNotificationFullscreen,I.kCalendarNotificationType,I.kCalendarNotificationSound,I.kCalendarNotificationVolume,I.kCalendarOnlyHourlyDivider,I.kCalendarOnlyHourlyKeynav,I.kCalendarSendInviteEmailAction,I.kCalendarTimeIncrements,I.kMailAccounts,I.kMailIsTurnedOff],gB=w.Z.getEventHandler,mB=[["",(0,B.Z)("other","None")],["../../../resources/notification_ding.opus",(0,B.Z)("Ding")],["../../../resources/notification_rooster.opus",(0,B.Z)("Rooster")],["../../../resources/notification_tada.opus",(0,B.Z)("Tada")]],fB=[[0,(0,B.Z)("No Duration")],[5*me.lb,(0,B.Z)("$1 minute","$1 minutes",[5])],[10*me.lb,(0,B.Z)("$1 minute","$1 minutes",[10])],[15*me.lb,(0,B.Z)("$1 minute","$1 minutes",[15])],[30*me.lb,(0,B.Z)("$1 minute","$1 minutes",[30])],[45*me.lb,(0,B.Z)("$1 minute","$1 minutes",[45])],[1*me.QI,(0,B.Z)("$1 hour","$1 hours",[1])],[2*me.QI,(0,B.Z)("$1 hour","$1 hours",[2])],[3*me.QI,(0,B.Z)("$1 hour","$1 hours",[3])],[8*me.QI,(0,B.Z)("$1 hour","$1 hours",[8])]],vB=W()().startOf("day"),yB=[];for(;vB.hour()<13;){const e=vB.hour();yB.push(pB("option",{value:e},e,vB.format("LT"))),vB.add(1,"hour")}vB.hour(12);const bB=[];for(;vB.hour()>0;){vB.add(1,"hour");const e=vB.hour()||24;bB.push(pB("option",{value:e},e,vB.format("LT")))}var SB=pB("input",{type:"radio",value:"full"}),wB=pB("input",{type:"radio",value:"compact"}),CB=pB("input",{type:"radio",value:"minimal"}),AB=pB("input",{type:"radio",value:"15"}),IB=pB("input",{type:"radio",value:"30"}),TB=pB("input",{type:"radio",value:"60"}),ZB=pB("input",{type:"radio",value:"select"}),EB=pB("input",{type:"radio",value:"create"}),kB=pB("input",{type:"radio",value:"cancel"}),_B=pB("input",{type:"radio",value:"save_and_close"}),NB=pB("input",{type:"radio",value:"inline"}),PB=pB("input",{type:"radio",value:"popup"}),DB=pB("input",{type:"radio",value:"always"}),MB=pB("input",{type:"radio",value:"never"}),OB=pB("input",{type:"radio",value:"timed_only"}),xB=pB("input",{type:"radio",value:"system"}),LB=pB("input",{type:"radio",value:"dialog"}),RB=pB("input",{type:"radio",value:"melt"}),BB=pB("input",{type:"radio",value:"burn"}),FB=pB("input",{type:"radio",value:"ask"}),WB=pB("input",{type:"radio",value:"send"}),UB=pB("input",{type:"radio",value:"cancel"});function VB(e){const t=(0,Ya.Z)(hB);return(0,ss.jsxs)(ss.Fragment,{children:[!t[I.kMailIsTurnedOff]&&(0,ss.jsxs)(ss.Fragment,{children:[pB(vM,{filter:e.filter}),pB(aB,{filter:e.filter}),pB(aR,{filter:e.filter}),pB(tN.Z,{categoryTitle:(0,B.Z)("Calendar Display"),filter:e.filter},void 0,pB("div",{className:"setting-group"},void 0,pB("div",{className:"setting-single"},void 0,pB("label",{},void 0,pB("input",{type:"checkbox",checked:t[I.kCalendarDisplayEventIcons],onChange:gB(I.kCalendarDisplayEventIcons)}),pB("span",{},void 0,(0,B.Z)("Show Event Property Icons")))),pB("div",{className:"setting-single"},void 0,pB("label",{},void 0,pB("input",{type:"checkbox",checked:t[I.kCalendarDisplayDimPastEvents],onChange:gB(I.kCalendarDisplayDimPastEvents)}),pB("span",{},void 0,(0,B.Z)("Show Past Events Faded")))),pB("div",{className:"setting-single"},void 0,pB("label",{},void 0,pB("input",{type:"checkbox",checked:t[I.kCalendarDisplayWeekNumber],onChange:gB(I.kCalendarDisplayWeekNumber)}),pB("span",{},void 0,(0,B.Z)("Show Week Number"))),pB("p",{className:"info"},void 0,(0,B.Z)("For week settings see Language under General Settings.")))),pB("div",{className:"setting-group"},void 0,pB("h3",{},void 0,(0,B.Z)("Events View")),pB(ja.Z,{name:"calendar-density",value:t[I.kCalendarDisplayDensity],onChange:gB(I.kCalendarDisplayDensity),className:"group"},void 0,pB("div",{className:"setting-single"},void 0,pB("label",{},void 0,SB,pB("span",{},void 0,(0,B.Z)("Full")))),pB("div",{className:"setting-single"},void 0,pB("label",{},void 0,wB,pB("span",{},void 0,(0,B.Z)("calendar","Compact")))),pB("div",{className:"setting-single"},void 0,pB("label",{},void 0,CB,pB("span",{},void 0,(0,B.Z)("Minimal")))))),pB("div",{className:"setting-group"},void 0,pB("h3",{},void 0,(0,B.Z)("Visible Day Hours")),pB("div",{className:"setting-single day-setting-grid"},void 0,pB("label",{},void 0,pB("span",{},void 0,(0,B.Z)("Day Starts at")),pB(ta.Z,{name:"day_starts",value:t[I.kCalendarDayStarts],onChange:gB(I.kCalendarDayStarts)},void 0,yB),pB("span",{},void 0,(0,B.Z)("Day Ends at")),pB(ta.Z,{name:"day_ends",value:t[I.kCalendarDayEnds],onChange:gB(I.kCalendarDayEnds)},void 0,bB))),pB("div",{className:"setting-single"},void 0,pB("label",{},void 0,pB("input",{type:"checkbox",checked:t[I.kCalendarCollapseHours],onChange:gB(I.kCalendarCollapseHours)}),pB("span",{},void 0,(0,B.Z)("Collapse Excluded Hours"))))),pB("div",{className:"setting-group"},void 0,pB("h3",{},void 0,(0,B.Z)("Time Increments")),pB(ja.Z,{name:"time-increments",value:t[I.kCalendarTimeIncrements],onChange:gB(I.kCalendarTimeIncrements),className:"group"},void 0,pB("div",{className:"setting-single"},void 0,pB("label",{},void 0,AB,pB("span",{},void 0,(0,B.Z)("15 Minutes")))),pB("div",{className:"setting-single"},void 0,pB("label",{},void 0,IB,pB("span",{},void 0,(0,B.Z)("30 Minutes")))),pB("div",{className:"setting-single"},void 0,pB("label",{},void 0,TB,pB("span",{},void 0,(0,B.Z)("1 Hour"))))),pB("div",{className:"setting-single"},void 0,pB("label",{},void 0,pB("input",{type:"checkbox",checked:t[I.kCalendarOnlyHourlyDivider],onChange:gB(I.kCalendarOnlyHourlyDivider)}),pB("span",{},void 0,(0,B.Z)("Show Only 1 Hour Grid Lines")))),pB("div",{className:"setting-single"},void 0,pB("label",{},void 0,pB("input",{type:"checkbox",checked:t[I.kCalendarOnlyHourlyKeynav],onChange:gB(I.kCalendarOnlyHourlyKeynav)}),pB("span",{},void 0,(0,B.Z)("Use 1 Hour Increments for Keyboard Navigation"))))),pB("div",{className:"setting-group"},void 0,pB("h3",{},void 0,(0,B.Z)("Click on Time Slot Should")),pB(ja.Z,{name:"click-timeslot",value:t[I.kCalendarClickTimeSlot],onChange:gB(I.kCalendarClickTimeSlot),className:"group"},void 0,pB("div",{className:"setting-single"},void 0,pB("label",{},void 0,ZB,pB("span",{},void 0,(0,B.Z)("Select Period")))),pB("div",{className:"setting-single"},void 0,pB("label",{},void 0,EB,pB("span",{},void 0,(0,B.Z)("calendar","Create New Event")))))),pB("div",{className:"setting-group"},void 0,pB("h3",{},void 0,(0,B.Z)("Click Outside Event Should")),pB(ja.Z,{name:"click-outside",value:t[I.kCalendarClickOutside],onChange:gB(I.kCalendarClickOutside),className:"group"},void 0,pB("div",{className:"setting-single"},void 0,pB("label",{},void 0,kB,pB("span",{},void 0,(0,B.Z)("Discard Changes")))),pB("div",{className:"setting-single"},void 0,pB("label",{},void 0,_B,pB("span",{},void 0,(0,B.Z)("Save Changes"))))))),pB(tN.Z,{categoryTitle:(0,B.Z)("Calendar Editing"),filter:e.filter},void 0,pB("div",{className:"setting-group"},void 0,pB("h3",{},void 0,(0,B.Z)("Edit Mode")),pB(ja.Z,{name:"edit-mode",value:t[I.kCalendarEditMode],onChange:gB(I.kCalendarEditMode),className:"group"},void 0,pB("div",{className:"setting-single"},void 0,pB("label",{},void 0,NB,pB("span",{},void 0,(0,B.Z)("Inline"))),pB("div",{className:Fi()("img-setting",{disabled:"popup"===t[I.kCalendarEditMode]})},void 0,pB("span",{className:"image",dangerouslySetInnerHTML:{__html:n(9371)}}))),pB("div",{className:"setting-single"},void 0,pB("label",{},void 0,PB,pB("span",{},void 0,(0,B.Z)("radio","Dialog"))),pB("div",{className:Fi()("img-setting",{disabled:"inline"===t[I.kCalendarEditMode]})},void 0,pB("span",{className:"image",dangerouslySetInnerHTML:{__html:n(97487)}}))))),pB("div",{className:"setting-group"},void 0,pB("h3",{},void 0,(0,B.Z)("Default Event Duration")),pB("div",{className:"setting-single"},void 0,pB("label",{},void 0,pB(ta.Z,{value:t[I.kCalendarDefaultDuration],onChange:gB(I.kCalendarDefaultDuration)},void 0,fB.map((([e,t])=>pB("option",{value:e},e,t)))))),pB("h3",{},void 0,(0,B.Z)("Default Event Reminder")),pB("div",{className:"setting-single"},void 0,pB("label",{},void 0,pB(ta.Z,{value:t[I.kCalendarDefaultNotification],onChange:e=>{let t=parseInt(e.target.value);isNaN(t)&&(t=-1),w.Z.set(I.kCalendarDefaultNotification,t)}},void 0,kM.map((([e,t])=>pB("option",{value:e.toString()},e,t)))))),pB("h3",{},void 0,(0,B.Z)("Default Reminder for All Day Events")),pB("div",{className:"setting-single"},void 0,pB("label",{},void 0,pB(MM,{value:t[I.kCalendarDefaultAlldayNotificationTime]*me.lb,onChange:e=>{isNaN(e)?(e=0,w.Z.set(I.kCalendarDefaultAlldayNotification,!1)):w.Z.set(I.kCalendarDefaultAlldayNotification,!0),0===t[I.kCalendarDefaultAlldayNotificationTime]&&(e-=540*me.lb),w.Z.set(I.kCalendarDefaultAlldayNotificationTime,e/me.lb)},create:!t[I.kCalendarDefaultAlldayNotification],allDay:!0})))),pB("div",{className:"setting-group"},void 0,pB("h3",{},void 0,(0,B.Z)("Auto Adjust End Time")),pB("p",{className:"info"},void 0,(0,B.Z)("Automatically update end time when editing to keep same event duration.")),pB(ja.Z,{name:"auto-adjust-end",value:t[I.kCalendarAutoAdjustEnd],onChange:gB(I.kCalendarAutoAdjustEnd),className:"group"},void 0,pB("div",{className:"setting-single"},void 0,pB("label",{},void 0,DB,pB("span",{},void 0,(0,B.Z)("Always")))),pB("div",{className:"setting-single"},void 0,pB("label",{},void 0,MB,pB("span",{},void 0,(0,B.Z)("other","Never")))),pB("div",{className:"setting-single"},void 0,pB("label",{},void 0,OB,pB("span",{},void 0,(0,B.Z)("Except for All Day Events")))))),pB("div",{className:"setting-group"},void 0,pB("h3",{},void 0,(0,B.Z)("Auto Focus Next Date/Time")),pB("div",{className:"setting-single"},void 0,pB("label",{},void 0,pB("input",{type:"checkbox",checked:t[I.kCalendarAutoTabDatetime],onChange:gB(I.kCalendarAutoTabDatetime)}),pB("span",{},void 0,(0,B.Z)("Automatically move focus to next field after typing complete date or time value")))))),pB(tN.Z,{categoryTitle:(0,B.Z)("Calendar Notifications"),filter:e.filter},void 0,pB("div",{className:"setting-group"},void 0,pB("div",{className:"setting-single"},void 0,pB("label",{},void 0,pB("input",{type:"checkbox",value:"none"!==t[I.kCalendarNotificationType]?"none":"dialog",checked:"none"!==t[I.kCalendarNotificationType],onChange:gB(I.kCalendarNotificationType)}),pB("span",{},void 0,(0,B.Z)("Enable Notifications")))),pB("div",{className:"setting-single"},void 0,pB("label",{},void 0,pB("input",{type:"checkbox",checked:t[I.kCalendarHiddenHidesNotifications],disabled:"none"===t[I.kCalendarNotificationType],onChange:gB(I.kCalendarHiddenHidesNotifications)}),pB("span",{},void 0,(0,B.Z)("Disable for Hidden Calendars"))))),pB("div",{className:"setting-group"},void 0,pB("h3",{},void 0,(0,B.Z)("Notification Style")),pB(ja.Z,{name:"calendarnotificationgroup",value:t[I.kCalendarNotificationType]||"",onChange:gB(I.kCalendarNotificationType),disabled:"none"===t[I.kCalendarNotificationType]},void 0,pB("div",{className:"setting-single"},void 0,pB("label",{},void 0,xB,pB("span",{},void 0,(0,B.Z)("System Notification")))),pB("div",{className:"setting-single"},void 0,pB("label",{},void 0,LB,pB("span",{},void 0,(0,B.Z)("calendar","Dialog")))),pB("div",{className:"setting-single"},void 0,pB("label",{},void 0,RB,pB("span",{},void 0,(0,B.Z)("Melt Browser")))),pB("div",{className:"setting-single"},void 0,pB("label",{},void 0,BB,pB("span",{},void 0,(0,B.Z)("Burn Browser"))))),pB("div",{className:"setting-single"},void 0,pB("label",{},void 0,pB("input",{type:"checkbox",checked:t[I.kCalendarNotificationFullscreen],onChange:gB(I.kCalendarNotificationFullscreen),disabled:!("melt"===t[I.kCalendarNotificationType]||"burn"===t[I.kCalendarNotificationType])}),pB("span",{},void 0,(0,B.Z)("Full Screen Notifications"))),pB("p",{className:"info"},void 0,(0,B.Z)("Applies to Melt and Burn notification type.")))),pB("div",{className:"setting-group"},void 0,pB("h3",{},void 0,(0,B.Z)("Notification Sound")),pB(ja.Z,{name:"calendarnotificationsoundgroup",value:t[I.kCalendarNotificationSound]||"",onChange:gB(I.kCalendarNotificationSound),disabled:"none"===t[I.kCalendarNotificationType]},void 0,mB.map((([e,t])=>pB("div",{className:"setting-single"},e,pB("label",{},void 0,pB("input",{type:"radio",value:e}),pB("span",{},void 0,t)))))),pB("h3",{},void 0,(0,B.Z)("Notification Volume")),pB("div",{className:"setting-single"},void 0,pB(cB,{value:t[I.kCalendarNotificationVolume],min:0,max:100,step:5,onChange:gB(I.kCalendarNotificationVolume),label:`${t[I.kCalendarNotificationVolume]} %`,title:(0,B.Z)("Minimum width of horizontally scaled active tab")})))),pB(tN.Z,{categoryTitle:(0,B.Z)("Calendar Integration"),filter:e.filter},void 0,function(){const e=t[I.kMailAccounts],n=t[I.kCalendarMailAccount],i=e.find((e=>e.MAIL_EMAIL===n));return pB("div",{className:"setting-group"},void 0,pB("div",{className:"setting-single"},void 0,pB("h3",{},void 0,(0,B.Z)("Calendar Mail Account")),pB(ta.Z,{value:n,onChange:gB(I.kCalendarMailAccount)},void 0,!i&&pB("option",{value:n,disabled:!0},void 0,(0,B.Z)("Select mail account")),e.map((e=>pB("option",{value:e.MAIL_EMAIL},e.MAIL_EMAIL,e.MAIL_EMAIL))))))}(),pB("div",{className:"setting-group"},void 0,pB("h3",{},void 0,(0,B.Z)("Send Invite Email Messages")),pB(ja.Z,{name:"calendarinviteemailsgroup",value:t[I.kCalendarSendInviteEmailAction]||"",onChange:gB(I.kCalendarSendInviteEmailAction)},void 0,pB("div",{className:"setting-single"},void 0,pB("label",{},void 0,FB,pB("span",{},void 0,(0,B.Z)("Ask Each Time")))),pB("div",{className:"setting-single"},void 0,pB("label",{},void 0,WB,pB("span",{},void 0,(0,B.Z)("Always Send Messages")))),pB("div",{className:"setting-single"},void 0,pB("label",{},void 0,UB,pB("span",{},void 0,(0,B.Z)("Never Send Messages")))))),pB("div",{className:"setting-group"},void 0,pB("div",{className:"setting-single"},void 0,pB("label",{},void 0,pB("input",{type:"checkbox",checked:t[I.kCalendarHandleIcsDownloads],onChange:gB(I.kCalendarHandleIcsDownloads)}),pB("span",{},void 0,(0,B.Z)("Open ICS files in Vivaldi")))),pB("div",{className:"setting-single"},void 0,pB("label",{},void 0,pB("input",{type:"checkbox",checked:t[I.kCalendarHandleWebcalLinks],onChange:gB(I.kCalendarHandleWebcalLinks)}),pB("span",{},void 0,(0,B.Z)("Open Webcal Links in Vivaldi"))))))," "]}),pB(gD,{categoryTitle:(0,B.Z)("Calendar"),filter:e.filter,inform:!0})]})}const HB=Li.memo(VB),GB=e=>null;var $B;function KB(e,t,n,i){$B||($B="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:$B,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function zB(){const e=(new Date).valueOf();w.Z.set(I.kSettingsDonationPromoDismissed,e)}var jB,YB=KB(co,{type:"heart",size:16}),XB=KB(co,{type:"close",size:16});function QB(){const e=Li.useContext(ts.Z),t=(0,Ya.Z)([I.kSettingsDonationPromoDismissed]),n=(0,DD.Z)(pe),i=n.isReady?Number(n.accountInfo.donationTier):1,s=Li.useCallback((()=>{const t=p._L+"#mtm_campaign=Desktop-Donate-SettingsLove";c.ZP.openURL(e.vivaldiWindowId,t)}),[e.vivaldiWindowId]);return i>0||t[I.kSettingsDonationPromoDismissed]>0?null:KB("div",{className:"settings-donation-suggestion"},void 0,KB("div",{},void 0,(0,B.Z)("Love Vivaldi?"),YB,KB("a",{href:"",className:"donate-link",onClick:s},void 0,(0,B.Z)("Donate!"))),KB("button",{className:"close transparent",onClick:zB,title:(0,B.Z)("Hide this message"),tabIndex:-1},void 0,XB))}function qB(e,t,n,i){jB||(jB="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:jB,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const JB=[I.kDownloadDefaultDirectory,I.kDownloadsAvoidTargetFilenamecollisionsWhenSavingAs,I.kDownloadsNotifyOnComplete,I.kDownloadsOpenPanelOnNew,I.kDownloadsStartAutomatically,I.kDownloadsUpdateDefaultDownloadWhenSavingAs],eF=w.Z.getEventHandler;function tF(e){const t=Li.useContext(ts.Z),n=(0,Ya.Z)(JB),i=sN({filter:e.filter,prefPaths:JB,name:e.category.title});return(0,ss.jsxs)(ss.Fragment,{children:[qB(tN.Z,{categoryTitle:(0,B.Z)("Downloads"),filter:e.filter,className:"setting-group unlimited"},void 0,qB("div",{className:"setting-subgroup"},void 0,qB("h3",{},void 0,(0,B.Z)("Download Location")),qB("div",{className:"setting-single"},void 0,qB("div",{className:"setting-single folder-selection"},void 0,qB("input",{type:"text",value:n[I.kDownloadDefaultDirectory],title:(0,B.Z)("Enter Default Download Directory Path"),onChange:eF(I.kDownloadDefaultDirectory)}),qB("input",{type:"button",value:(0,B.Z)("Select Folder..."),onClick:function(){se.Z.utilities.selectFile({windowId:t.vivaldiWindowId,title:(0,B.Z)("Select Download Folder"),type:"folder"}).then((e=>{e&&w.Z.set(I.kDownloadDefaultDirectory,e)}))}}))),qB("div",{className:"setting-single pad-top"},void 0,qB("label",{},void 0,qB("input",{type:"checkbox",checked:n[I.kDownloadsStartAutomatically],onChange:eF(I.kDownloadsStartAutomatically)}),qB("span",{},void 0,(0,B.Z)("Save Files to Default Location Without Asking")))),qB("div",{className:"setting-single"},void 0,qB("label",{},void 0,qB("input",{type:"checkbox",checked:n[I.kDownloadsUpdateDefaultDownloadWhenSavingAs],onChange:eF(I.kDownloadsUpdateDefaultDownloadWhenSavingAs)}),qB("span",{},void 0,(0,B.Z)("Update Default Location When Choosing Save as Location")))),qB("div",{className:"setting-single"},void 0,qB("label",{},void 0,qB("input",{type:"checkbox",checked:n[I.kDownloadsOpenPanelOnNew],onChange:eF(I.kDownloadsOpenPanelOnNew)}),qB("span",{},void 0,(0,B.Z)("Display Downloads Automatically")))),qB("div",{className:"setting-single"},void 0,qB("label",{},void 0,qB("input",{type:"checkbox",checked:n[I.kDownloadsNotifyOnComplete],onChange:eF(I.kDownloadsNotifyOnComplete)}),qB("span",{},void 0,(0,B.Z)("Notify on Completed Downloads"))))),qB("div",{className:"setting-single"},void 0,qB("label",{},void 0,qB("input",{type:"checkbox",checked:n[I.kDownloadsAvoidTargetFilenamecollisionsWhenSavingAs],onChange:eF(I.kDownloadsAvoidTargetFilenamecollisionsWhenSavingAs)}),qB("span",{},void 0,(0,B.Z)("Avoid Filename Collisions When Choosing Save as"))))),i]})}const nF=Li.memo(tF);var iF;function sF(e,t,n,i){iF||(iF="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:iF,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class oF extends Li.PureComponent{_isMounted=!1;_updateNotifierStatusKnown=!1;static#xt=void 0;state={showUpdateSettings:!1,updateNotifierEnabled:!1,autoInstallUpdate:!0};componentDidMount(){this._isMounted=!0,void 0===oF.#xt&&se.Z.autoUpdate.hasAutoUpdates().then((e=>{oF.#xt=e,this._isMounted&&this.forceUpdate()}))}componentWillUnmount(){this._isMounted=!1}refreshUpdateNotifierEnabled=()=>{se.Z.autoUpdate.isUpdateNotifierEnabled((e=>{this.setUpdateNotifierEnabled(e)}))};setUpdateNotifierEnabled=e=>{this._isMounted&&this.setState({updateNotifierEnabled:e})};refreshAutoInstallUpdates=()=>{se.Z.autoUpdate.getAutoInstallUpdates((e=>{this._isMounted&&this.setState({autoInstallUpdate:e})}))};toggleUpdateSettings=()=>{this._updateNotifierStatusKnown||(this._updateNotifierStatusKnown=!0,this.refreshUpdateNotifierEnabled()),this.setState((e=>({showUpdateSettings:!e.showUpdateSettings})))};toggleUpdateNotifier=e=>{e.target.checked?se.Z.autoUpdate.enableUpdateNotifier((e=>{e?this.setUpdateNotifierEnabled(!0):this.refreshUpdateNotifierEnabled()})):se.Z.autoUpdate.disableUpdateNotifier((e=>{e?this.setUpdateNotifierEnabled(!1):this.refreshUpdateNotifierEnabled()}))};toggleAutoInstallUpdate=e=>{const t=e.target.checked;se.Z.autoUpdate.setAutoInstallUpdates(t),this.refreshAutoInstallUpdates()};getUpdateLabel(){return!1===oF.#xt?(0,B.Z)("Automatically download updates and notify when they are ready to install"):(0,B.Z)("Automatically Download and Install Updates")}render(){return sF(tN.Z,{categoryTitle:(0,B.Z)("Updates"),filter:this.props.filter},void 0,sF("div",{className:"setting-group unlimited"},void 0,sF("p",{className:"info"},void 0,(0,B.Z)("Get the latest security fixes by allowing automatic updates of Vivaldi.")),sF("div",{className:"setting-single"},void 0,sF("input",{type:"button",value:this.state.showUpdateSettings?(0,B.Z)("Hide Update Settings"):(0,B.Z)("Show Update Settings"),onClick:this.toggleUpdateSettings})),this.state.showUpdateSettings&&sF("div",{className:"setting-single"},void 0,sF("label",{},void 0,sF("input",{type:"checkbox",checked:this.state.updateNotifierEnabled,onChange:this.toggleUpdateNotifier}),sF("span",{},void 0,this.getUpdateLabel()))),!1))}}const aF=oF;var rF,lF=n(9761),dF=n(1658);function cF(e,t,n,i){rF||(rF="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:rF,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const uF=[I.kTranslateEnabled],pF=[I.kAcceptLanguages,...uF],hF=w.Z.getEventHandler;class gF extends Li.PureComponent{static contextType=ts.Z;_isMounted=!1;state={language:R.ZP.UI_LANGUAGE,acceptLangs:[],acceptLangsList:[]};componentDidMount(){this._isMounted=!0,i.Z.languageSettingsPrivate.getLanguageList((e=>{if(i.Z.runtime.lastError)console.error(i.Z.runtime.lastError.message);else if(this._isMounted){const t=[];for(const n of e){if(n.code===n.nativeDisplayName){const e=lF.lE.find((e=>e.key===n.code));if(!e)continue;n.nativeDisplayName=e.local}t.push(n)}this.setState({acceptLangsList:t.sort(((e,t)=>e.code.localeCompare(t.code))).map((e=>({key:e.code,value:e.nativeDisplayName})))})}})),this.updateAcceptedList()}componentWillUnmount(){this._isMounted=!1}updateAcceptedList=()=>{i.Z.i18n.getAcceptLanguages((e=>{i.Z.runtime.lastError?(console.error(i.Z.runtime.lastError.message),this._isMounted&&this.setState({acceptLangs:[]})):this._isMounted&&this.setState({acceptLangs:e})}))};onContextMenu=(e,t)=>{const n=[];e>=0&&e<this.state.acceptLangs.length&&(n.push({...(0,us.Z)("Move to Top"),handler:this.moveItemToTop.bind(this,e),isVisible:()=>0!==e}),n.push({...(0,us.Z)("Move Up"),handler:this.moveItem.bind(this,e,e-1),isVisible:()=>e>1}),n.push({...(0,us.Z)("Move Down"),handler:this.moveItem.bind(this,e,e+1),isVisible:()=>e!==this.state.acceptLangs.length-1}),n.push({...(0,us.Z)("verb","Remove"),handler:this.removeItem.bind(this,e),isVisible:()=>this.state.acceptLangs[e]!==this.state.language&&this.state.acceptLangs.length>1})),(0,cs.Z)(this.context,n)(t)};addItem=e=>{if(e&&e.target){const t=e.target.value;i.Z.languageSettingsPrivate.enableLanguage(t),this.updateAcceptedList()}};moveItem=(e,t)=>{const n=t<e?"UP":"DOWN",s=Math.abs(e-t);(0,dF.Z)(s,(()=>{i.Z.languageSettingsPrivate.moveLanguage(this.state.acceptLangs[e],n)})),this.updateAcceptedList()};moveItemToTop=e=>{i.Z.languageSettingsPrivate.moveLanguage(this.state.acceptLangs[e],"TOP"),this.updateAcceptedList()};removeItem=e=>{this.state.acceptLangs.length<=1||(i.Z.languageSettingsPrivate.disableLanguage(this.state.acceptLangs[e]),this.updateAcceptedList())};resetToDefault=()=>{w.Z.reset(I.kAcceptLanguages),this.updateAcceptedList()};resetTranslationSettingsToDefault=()=>{se.Z.prefs.resetTranslationPrefs()};remapLangs=()=>this.state.acceptLangs.map((e=>({key:e,name:e,isDefault:Boolean(e===this.state.language||this.state.acceptLangs.length<=1)})));renderItem=(e,t)=>cF("span",{},void 0,e);render(){const e=this.state.acceptLangsList.filter((e=>!this.state.acceptLangs.includes(e.key)));return e.unshift({key:"",value:(0,B.Z)("Select Language")}),cF(iA.Z,{filter:this.props.filter},void 0,cF("div",{className:"setting-group accept-language-list"},void 0,cF("div",{className:"setting-single"},void 0,cF("h3",{},void 0,(0,B.Z)("Accept Languages")),cF("p",{className:"info"},void 0,(0,B.Z)("Preferred languages, accepted by compatible websites in given order.")),this.state.acceptLangsList.length>0?(0,ss.jsxs)(ss.Fragment,{children:[cF(lk.Z,{items:this.remapLangs(),filter:this.props.filter,onCreateItem:this.addItem,moveItem:this.moveItem,onRemove:this.removeItem,onContextMenu:this.onContextMenu,renderListItem:this.renderItem,optionsList:e,addTipString:(0,B.Z)("Add Language"),deleteTipString:(0,B.Z)("Remove Language"),supportDragAndDrop:!0,mimeType:"vivaldi/x-settings-accept-langage"}),cF("input",{type:"button",value:(0,B.Z)("Reset to Default"),onClick:this.resetToDefault})]}):cF("p",{},void 0,(0,B.Z)("Language list retrieval for “$1” failed",[this.state.language]))),cF("div",{className:"setting-single offer-translate"},void 0,cF("label",{},void 0,cF("input",{type:"checkbox",checked:this.props.prefValues[I.kTranslateEnabled],onChange:hF(I.kTranslateEnabled)}),cF("span",{},void 0,cF("h3",{},void 0,(0,B.Z)("Automatically Offer to Translate Pages")))),cF("p",{className:"info"},void 0,(0,B.Z)("When unchecked, translation popup and automatic translations will be disabled. Translation can still be manually triggered on each page.")),cF("input",{type:"button",value:(0,B.Z)("Reset Translation Settings to Default"),onClick:this.resetTranslationSettingsToDefault}))))}}const mF=(0,Bu.Z)(gF,uF);var fF;function vF(e,t,n,i){fF||(fF="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:fF,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const yF=[I.kCalendarDateFormat,I.kCalendarStartOfWeek,I.kCalendarWeekNumberRule],bF=[...pF,...yF],SF=w.Z.getEventHandler,wF={width:400,minWidth:"unset"},CF=[...lF.lE].sort(((e,t)=>e.local.localeCompare(t.local)));function AF(e){const t=(0,Ya.Z)(yF),[n,i]=Li.useState(""),[s,o]=Li.useState(""),[a,r]=Li.useState(!1),[l,d]=Li.useState(R.ZP.getLocale()),c=()=>{se.Z.utilities.getSystemDateFormat((e=>{d(R.ZP.getLocale(e))}))};Li.useEffect((()=>{se.Z.utilities.getLanguage((e=>{o(e),i(e)})),c()}),[]),Li.useEffect((()=>{c()}),[t]);const u=()=>{se.Z.utilities.setLanguage(s,(()=>{$A.Z.setTargetTranslationCode($A.Z.getTranslationCode(s)),i(s),r(!1)}))},p=()=>{o(n),r(!1)},h=W()(),{longDateFormat:g,week:m,weekdays:f}=l;return h.localeData()._week=l.week,vF(tN.Z,{categoryTitle:(0,B.Z)("Language"),"data-anchor":"language",filter:e.filter},void 0,vF("p",{className:"info"},void 0,(0,B.Z)("These settings require a restart to take full effect.")),a&&(()=>{const e=CF.find((e=>e.key===s));return e?vF(ra.Z,{className:"float",style:wF,onRequestClose:p,title:(0,B.Z)("Save New Language?")},void 0,vF("div",{className:"dialog-restore-shortcuts"},void 0,vF("div",{className:"dialog-content"},void 0,vF("p",{},void 0,(0,B.Z)("Vivaldi user interface language will be set to:")),vF("p",{},void 0,vF("strong",{},void 0,e.local+(e.value!==e.local?" – "+e.value:""))),vF("p",{},void 0,(0,B.Z)("Browser restart is required for new setting to take effect."))),vF("footer",{className:"dialog-footer"},void 0,vF("input",{type:"button",className:"danger",onClick:u,value:(0,B.Z)("Save Language")}),vF("input",{type:"button",onClick:p,value:(0,B.Z)("Cancel"),autoFocus:!0})))):null})(),vF("form",{className:"setting-group",onSubmit:()=>{r(!0)}},void 0,vF("h3",{},void 0,(0,B.Z)("User Interface Language")),vF("div",{className:"setting-single"},void 0,vF(ta.Z,{onChange:e=>{const t=e.currentTarget.selectedOptions[0].dataset.lang;o(t)},value:s.toLowerCase()},void 0,CF.map((e=>vF("option",{value:e.key.toLowerCase(),"data-lang":e.key},e.key,e.local+(e.value!==e.local?" – "+e.value:""))))),vF("input",{type:"submit",className:"primary",disabled:s===n,value:(0,B.Z)("Save Language")}))),vF("div",{className:"setting-group"},void 0,vF("div",{className:"setting-single"},void 0,vF("h3",{},void 0,(0,B.Z)("Preferred Date & Time Format")),vF("p",{className:"info"},void 0,(0,B.Z)("Affects beginning day of week, time and date display format.")),vF(ta.Z,{value:t[I.kCalendarDateFormat],onChange:e=>{const t=e.target.value;w.Z.set(I.kCalendarDateFormat,t)}},void 0,vF("option",{value:"system"},void 0,(0,B.Z)("Inherit from Operating System")),vF("option",{value:"language"},void 0,(0,B.Z)("Same as Selected Language")))),vF("div",{className:"setting-single"},void 0,vF("h3",{},void 0,(0,B.Z)("Week Starts On")),vF("label",{},void 0,vF(ta.Z,{name:"week_starts",value:t[I.kCalendarStartOfWeek],onChange:SF(I.kCalendarStartOfWeek)},void 0,vF("option",{value:"system"},void 0,(0,B.Z)("System Default")),vF("option",{value:"sunday"},void 0,(0,B.Z)("Sunday")),vF("option",{value:"monday"},void 0,(0,B.Z)("Monday")),vF("option",{value:"tuesday"},void 0,(0,B.Z)("Tuesday")),vF("option",{value:"wednesday"},void 0,(0,B.Z)("Wednesday")),vF("option",{value:"thursday"},void 0,(0,B.Z)("Thursday")),vF("option",{value:"friday"},void 0,(0,B.Z)("Friday")),vF("option",{value:"saturday"},void 0,(0,B.Z)("Saturday"))))),vF("div",{className:"setting-single"},void 0,vF("h3",{},void 0,(0,B.Z)("First Week Number")),vF("label",{},void 0,vF(ta.Z,{name:"week_number_rule",value:t[I.kCalendarWeekNumberRule],onChange:SF(I.kCalendarWeekNumberRule)},void 0,vF("option",{value:"4"},void 0,(0,B.Z)("First 4 Day Week (ISO8601)")),vF("option",{value:"1"},void 0,(0,B.Z)("First Week in Calendar Year")),vF("option",{value:"7"},void 0,(0,B.Z)("First Whole Week"))))),vF("dl",{className:"info",style:{display:"grid",gridTemplateColumns:"auto 1fr",gridGap:"2px 8px",margin:"12px 0"}},void 0,vF("dt",{},void 0,(0,B.Z)("Time Format")),vF("dd",{},void 0,h.format(g.LT)),vF("dt",{},void 0,(0,B.Z)("Short Date")),vF("dd",{},void 0,h.format(g.L)),vF("dt",{},void 0,(0,B.Z)("Long Date")),vF("dd",{},void 0,h.format(g.LLLL)),vF("dt",{},void 0,(0,B.Z)("Start of Week")),vF("dd",{},void 0,f[m.dow]),vF("dt",{},void 0,(0,B.Z)("Week Number")),vF("dd",{},void 0,h.week()))),vF(mF,{filter:e.filter}))}const IF=Li.memo(AF);var TF;function ZF(e,t,n,i){TF||(TF="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:TF,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const EF=w.Z.getEventHandler,kF=[I.kWindowsShowWindowCloseConfirmationDialog];class _F extends Li.Component{render(){return ZF(iA.Z,{filter:this.props.filter},void 0,ZF("div",{className:"setting-group"},void 0,ZF("h3",{},void 0,(0,B.Z)("Close Window Confirmation")),ZF("div",{className:"setting-single"},void 0,ZF("label",{},void 0,ZF("input",{type:"checkbox",checked:this.props.prefValues[I.kWindowsShowWindowCloseConfirmationDialog],onChange:EF(I.kWindowsShowWindowCloseConfirmationDialog)}),ZF("span",{},void 0,(0,B.Z)("Show Close Window Confirmation Dialog"))))))}}const NF=(0,Bu.Z)(_F,kF);var PF;function DF(e,t,n,i){PF||(PF="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:PF,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const MF=w.Z.getEventHandler,OF=[I.kSystemShowExitConfirmationDialog];class xF extends Li.Component{renderMacQuitConfirmation(){return DF(iA.Z,{filter:this.props.filter},void 0,DF("div",{className:"setting-group"},void 0,DF("h3",{},void 0,(0,B.Z)("Quit Confirmation")),DF("div",{className:"setting-single"},void 0,DF("label",{},void 0,DF("input",{type:"checkbox",checked:this.props.prefValues[I.kConfirmToQuitEnabled],onChange:MF(I.kConfirmToQuitEnabled)}),DF("span",{},void 0,(0,B.Z)("Warn on Quit (⌘Q)"))))))}renderExitConfirmation(){return DF(iA.Z,{filter:this.props.filter},void 0,DF("div",{className:"setting-group"},void 0,DF("h3",{},void 0,(0,B.Z)("Exit Confirmation")),DF("div",{className:"setting-single"},void 0,DF("label",{},void 0,DF("input",{type:"checkbox",checked:this.props.prefValues[I.kSystemShowExitConfirmationDialog],onChange:MF(I.kSystemShowExitConfirmationDialog)}),DF("span",{},void 0,(0,B.Z)("Show Exit Confirmation Dialog"))))))}render(){return this.renderExitConfirmation()}}const LF=(0,Bu.Z)(xF,OF);var RF;function BF(e,t,n,i){RF||(RF="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:RF,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const FF="about:blank",WF=[I.kHomepage,I.kHomepageCache];class UF extends Li.Component{state={customHomepage:this.props.prefValues[I.kHomepageCache]};saveHomePage=({currentTarget:e})=>{const t=""!==e.value?(0,rl.Rz)(e.value):e.value;w.Z.set(I.kHomepage,t||FF),t!==p.QG&&(this.setState({customHomepage:e.value}),w.Z.set(I.kHomepageCache,t))};render(){const e=(this.props.prefValues[I.kHomepage]===FF?"":this.props.prefValues[I.kHomepage])===p.QG;return BF(iA.Z,{filter:this.props.filter},void 0,BF("div",{className:"setting-group homepage"},void 0,BF("h3",{},void 0,(0,B.Z)("noun","Homepage")),BF("div",{className:"setting-single"},void 0,BF("label",{},void 0,BF("input",{type:"radio",name:"startpage_url",onChange:this.saveHomePage,checked:e,value:p.QG}),BF("span",{},void 0,(0,B.Z)("other","Start Page")))),BF("div",{className:"setting-single"},void 0,BF("label",{},void 0,BF("input",{type:"radio",name:"startpage_url",onChange:this.saveHomePage,checked:!e,value:this.props.prefValues[I.kHomepageCache]}),BF("span",{},void 0,(0,B.Z)("Specific Page")))),BF("div",{className:"setting-single"},void 0,BF("input",{type:"text",placeholder:(0,B.Z)("Address"),disabled:e,onChange:this.saveHomePage,value:this.state.customHomepage}))))}}const VF=(0,Bu.Z)(UF,WF);var HF,GF=n(53454),$F=n(34155);function KF(e,t,n,i){HF||(HF="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:HF,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const zF={width:500,minWidth:"unset"};const jF=function({from:e,onClose:t}){if(!(0,DD.Z)(GF.Z).length)return $F.nextTick((()=>t(!0))),null;const n=()=>{t(!1)};return KF(ra.Z,{onRequestClose:n,className:"slide float",style:zF,title:(0,B.Z)("Disable Workspaces")},void 0,KF("div",{className:"dialog-content"},void 0,KF("p",{className:"error"},void 0,"startup"===e&&(0,B.Z)("Workspaces currently require setting set to “Startup with Last Session”, otherwise they will be disabled.")," ",(0,B.Z)("What would you like to do with the tabs that are currently in a Workspace?"))),KF("footer",{className:"dialog-footer"},void 0,KF("input",{type:"button",className:"primary",value:(0,B.Z)("verb","Move Tabs"),onClick:async()=>{const e=he.ZP.getLastActiveBrowserWindowId();if(e===he.Ex)return console.warn("No active window found"),void t(!1);for(const t of he.ZP.getIds("normal")){await c.ZP.setActiveWorkspace(t,void 0);const n=Ce.ZP.getPages(t).filter((e=>void 0!==(0,kv.cm)(e)));n.size>0&&await c.ZP.moveToWindow(n,e)}t(!0)},autoFocus:!0}),KF("input",{type:"button",value:(0,B.Z)("verb","Close Tabs"),onClick:async()=>{for(const e of he.ZP.getIds("normal")){await c.ZP.setActiveWorkspace(e,void 0);const t=Ce.ZP.getPages(e).filter((e=>void 0!==(0,kv.cm)(e)));await c.ZP.closePage(t,{bypassConfirm:!0,forceClosePinned:!0})}t(!0)}}),KF("input",{type:"button",value:(0,B.Z)("Cancel"),onClick:n})))};var YF,XF,QF;function qF(e,t,n,i){YF||(YF="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:YF,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function JF({filter:e,onSave:t,onDelete:n,urlItem:i}){return qF(iA.Z,{filter:e},void 0,qF("div",{className:"setting-single"},void 0,qF("input",{className:"edit",type:"text",value:i.url,onChange:e=>{i.url=e.target.value,t(i)}}),qF("input",{type:"button",tabIndex:"-1",className:"circular clearkey",onClick:n,title:(0,B.Z)("Remove page")})))}function eW(e,t,n,i){XF||(XF="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:XF,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function tW(e){const t=(0,Li.createRef)(),[n,i]=(0,Li.useState)(!1),[s,o]=(0,Li.useState)((C.Z.get(I.kURLsToRestoreOnStartup)||[]).map(((e,t)=>({url:e,id:t})))),a=e=>e.includes(":")?e:"http://"+e,r=e=>{o(e);const t=e.map((e=>e.url));w.Z.set(I.kURLsToRestoreOnStartup,t)},l=()=>{const e=t.current;if(!e)return;const n=a(e.value),o=[...s];o.push({url:n,id:o.length}),e.value="",i(!1),r(o)},d=e=>{const t=[...s],n=t.find((t=>t.id===e.id));n&&(n.url=a(e.url)),r(t)};return eW(iA.Z,{filter:e.filter},void 0,eW("div",{className:"setting-group setting-startup-specific-pages"},void 0,eW("h3",{},void 0,(0,B.Z)("Startup Pages")),s.map((t=>eW(JF,{urlItem:t,onDelete:()=>(e=>{const t=[...s],n=t.find((t=>t.id===e.id));t.splice(t.indexOf(n),1),r(t)})(t),onSave:d,filter:e.filter},t.id))),eW("form",{className:"setting-flexgroup",onSubmit:l},void 0,(0,ss.jsx)("input",{type:"text",className:"setting-single-flex",ref:t,value:e.url,onKeyUp:e=>{const{keyCode:t,currentTarget:n}=e;if(n.value.length>2?i(!0):i(!1),t===xa.Z.KEY_ESCAPE)n.value="",i(!1);else{if(t!==xa.Z.KEY_RETURN&&t!==xa.Z.KEY_ENTER||!(n.value.length>2))return;l()}},placeholder:(0,B.Z)("Enter page URL")}),eW("input",{type:"submit",className:"setting-single-noflex",disabled:!n,value:(0,B.Z)("Add")}),eW("input",{type:"button",onClick:()=>{const e=[];for(const[t,n]of he.ZP.getState())"normal"===n.type&&Ce.ZP.getPages(t).forEach((({url:t},n)=>{pn.jk.isInternalUrl(t)||e.push({id:n,url:t})}));r(e)},value:(0,B.Z)("Use Current Pages")}))))}function nW(e,t,n,i){QF||(QF="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:QF,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const iW=[I.kTabsAlwaysLoadPinnedAfterRestore,I.kTabsDeferLoadingAfterRestore,I.kWorkspacesEnabled],sW=[I.kTabsAlwaysLoadPinnedAfterRestore,I.kTabsDeferLoadingAfterRestore,I.kURLsToRestoreOnStartup],oW=w.Z.getEventHandler;function aW({filter:e}){const t=(0,Ya.Z)(iW),n=nW(tW,{filter:e,prefValues:t}),[i,s]=(0,Li.useState)(!1),[o,a]=(0,Li.useState)("last"),[r,l]=(0,Li.useState)("");(0,Li.useEffect)((()=>{se.Z.utilities.getStartupAction((e=>a(e)))}),[]);const d=e=>{const n=e.target.value;if("last"!==n&&t[I.kWorkspacesEnabled])l(n),s(!0),e.preventDefault();else{const e=C.Z.get(I.kURLsToRestoreOnStartup);se.Z.utilities.setStartupAction(n,e,(e=>a(e)))}},c=(0,Li.useMemo)((()=>"urls"===o?n:null),[e,t,o]);return nW(iA.Z,{filter:e},void 0,nW("div",{className:"setting-group"},void 0,nW("h3",{},void 0,(0,B.Z)("Startup with")),nW(ja.Z,{name:"startupSettings",value:o,onChange:Lr.Z},void 0,nW("div",{className:"setting-single"},void 0,nW("label",{},void 0,nW("input",{type:"radio",value:"last",onClick:d}),nW("span",{},void 0,(0,B.Z)("Last Session"))),nW("p",{className:"info"},void 0,(0,B.Z)("Required for Workspaces feature"))),nW("div",{className:"setting-single"},void 0,nW("label",{},void 0,nW("input",{type:"radio",value:"homepage",onClick:d}),nW("span",{},void 0,(0,B.Z)("radio","Homepage")))),nW("div",{className:"setting-single"},void 0,nW("label",{},void 0,nW("input",{type:"radio",value:"speeddial",onClick:d}),nW("span",{},void 0,(0,B.Z)("radio","Start Page")))),nW("div",{className:"setting-single"},void 0,nW("label",{},void 0,nW("input",{type:"radio",value:"urls",onClick:d}),nW("span",{},void 0,(0,B.Z)("Specific Pages"))))),nW("div",{className:"setting-single pad-top"},void 0,nW("label",{title:(0,B.Z)("Wait to load restored session content until tab is activated.")},void 0,nW("input",{type:"checkbox",checked:t[I.kTabsDeferLoadingAfterRestore],onChange:oW(I.kTabsDeferLoadingAfterRestore)}),nW("span",{},void 0,(0,B.Z)("Lazy Load Restored Tabs")))),nW("div",{className:"setting-single pad-left"},void 0,nW("label",{title:(0,B.Z)("Load pinned tabs before they are activated.")},void 0,nW("input",{type:"checkbox",disabled:!t[I.kTabsDeferLoadingAfterRestore],checked:t[I.kTabsAlwaysLoadPinnedAfterRestore],onChange:oW(I.kTabsAlwaysLoadPinnedAfterRestore)}),nW("span",{},void 0,(0,B.Z)("Always Load Pinned Tabs"))))),c,i&&nW(jF,{onClose:e=>{if(s(!1),e&&r){w.Z.set(I.kWorkspacesEnabled,!1);const e=C.Z.get(I.kURLsToRestoreOnStartup);se.Z.utilities.setStartupAction(r,e,(e=>a(e)))}},from:"startup"}))}const rW=async function(){return!1};var lW;function dW(e,t,n,i){lW||(lW="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:lW,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const cW=[I.kStartupCheckIsDefault],uW=w.Z.getEventHandler;class pW extends Li.Component{_isMounted=!1;static contextType=ts.Z;state={isVivaldiDefault:!0,isRunningInContainer:!0};componentDidMount(){this.getDefaultBrowserValue(),rW().then((e=>this.setState({isRunningInContainer:e}))),this._isMounted=!0}componentWillUnmount(){this._isMounted=!1}getDefaultBrowserValue=()=>{se.Z.utilities.isVivaldiDefaultBrowser((e=>{this._isMounted&&this.setState({isVivaldiDefault:!0===e})}))};setVivaldiDefault=()=>{se.Z.utilities.setVivaldiAsDefaultBrowser((e=>{this._isMounted&&this.setState({isVivaldiDefault:!0===e})})),this.props.onClose&&this.props.onClose()};openFlatpakHelp=()=>{c.ZP.openURL(this.context.vivaldiWindowId,"https://help.vivaldi.com/?p=106242")};renderCheckbox=()=>dW("label",{title:(0,B.Z)("Check if Vivaldi is your default browser upon every startup")},void 0,dW("input",{type:"checkbox",checked:this.props.prefValues[I.kStartupCheckIsDefault],onChange:uW(I.kStartupCheckIsDefault)}),dW("span",{},void 0,(0,B.Z)("Check on Startup")));render(){return this.props.onClose?dW("form",{onSubmit:this.setVivaldiDefault,className:"SuggestDefault"},void 0,dW("span",{},void 0,(0,B.Z)("Enjoying Vivaldi? Make it your default browser.")),dW("input",{type:"submit",value:(0,B.Z)("browser","Set as Default Browser")}),this.renderCheckbox(),dW("button",{type:"button",className:"close",dangerouslySetInnerHTML:{__html:Wi.kze},onClick:this.props.onClose})):dW(iA.Z,{filter:this.props.filter},void 0,dW("div",{className:"setting-group"},void 0,!this.props.onClose&&dW("h3",{},void 0,(0,B.Z)("Default Browser")),dW("div",{className:"setting-single"},void 0,this.state.isRunningInContainer?(0,ss.jsx)(ss.Fragment,{children:dW("p",{},void 0,(0,B.Z)("To set Vivaldi for Flatpak as your default browser, please refer to the documentation.")," ",dW(A_.Z,{onClick:this.openFlatpakHelp},void 0,(0,B.Z)("Learn more.")))}):this.state.isVivaldiDefault?dW("p",{},void 0,(0,B.Z)("Vivaldi is set as your default browser.")):(0,ss.jsxs)(ss.Fragment,{children:[dW("p",{},void 0,(0,B.Z)("Vivaldi isn’t your default browser.")),dW("input",{type:"button",onClick:this.setVivaldiDefault,value:(0,B.Z)("browser","Set as Default")})]})),!this.state.isRunningInContainer&&dW("div",{className:"setting-single pad-top"},void 0,this.renderCheckbox())))}}const hW=(0,Bu.Z)(pW,cW);var gW;function mW(e,t,n,i){gW||(gW="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:gW,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const fW=[...kF,...OF,...WF,...sW,...cW];function vW(e){return(0,ss.jsxs)(ss.Fragment,{children:[mW(tN.Z,{categoryTitle:(0,B.Z)("Startup"),filter:e.filter},void 0,(0,ss.jsx)(hW,{...e}),(0,ss.jsx)(VF,{...e}),(0,ss.jsx)(aW,{...e})),mW(tN.Z,{categoryTitle:(0,B.Z)("title","Close and Exit"),filter:e.filter},"2",(0,ss.jsx)(LF,{...e}),(0,ss.jsx)(NF,{...e}))]})}const yW=Li.memo(vW);var bW;function SW(e,t,n,i){bW||(bW="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:bW,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const wW=[...bF,...fW,I.kWelcomeReadPages].concat([]);function CW({filter:e,category:t}){const n=sN({filter:e,name:t.title,prefPaths:wW});return(0,ss.jsxs)(ss.Fragment,{children:[SW("section",{className:"setting-section"},void 0,SW(yW,{filter:e})),SW("section",{className:"setting-section"},void 0,SW(aF,{filter:e})),SW("section",{className:"setting-section"},void 0,SW(IF,{filter:e})),SW("section",{className:"setting-section"},void 0,SW(gD,{filter:e})),n]})}const AW=Li.memo(CW);var IW;function TW(e,t,n,i){IW||(IW="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:IW,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const ZW=[I.kWebpagesAccessKeys],EW=w.Z.getEventHandler;class kW extends Li.Component{render(){return TW(iA.Z,{filter:this.props.filter},void 0,TW("div",{className:"setting-group"},void 0,TW("h3",{},void 0,(0,B.Z)("Access Keys")),TW("div",{className:"setting-single"},void 0,TW("label",{},void 0,TW("input",{type:"checkbox",checked:this.props.prefValues[I.kWebpagesAccessKeys],onChange:EW(I.kWebpagesAccessKeys)}),TW("span",{},void 0,(0,B.Z)("Allow Access Keys"))),TW("p",{className:"info"},void 0,(0,B.Z)("Some websites may use this accessibility feature to register shortcuts for certain elements, using $1 modifier.",["Shift+Alt"])))))}}const _W=(0,Bu.Z)(kW,ZW),NW=function(e){switch(e){case"CATEGORY_COMMAND_APPLICATION":return(0,B.Z)("win_linux","Window");case"CATEGORY_COMMAND_APPEARANCE":return(0,B.Z)("win_linux","View");case"CATEGORY_COMMAND_TAB_ACTION":return(0,B.Z)("command","Tab");case"CATEGORY_COMMAND_WEBPAGE_NAVIGATION":return(0,B.Z)("Page");case"CATEGORY_COMMAND_MAIL":return(0,B.Z)("Mail");case"CATEGORY_COMMAND_CALENDAR":return(0,B.Z)("Calendar");case"CATEGORY_COMMAND_CHAIN":return(0,B.Z)("Chains");case"CATEGORY_COMMAND_WORKSPACE_ACTION":return(0,B.Z)("Workspaces");default:return"Unknown"}};var PW;function DW(e,t,n,i){PW||(PW="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:PW,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const MW=w.Z.getEventHandler;class OW extends Li.Component{render(){return DW(iA.Z,{filter:this.props.filter},void 0,DW("div",{className:"setting-group"},void 0,DW("h3",{},void 0,(0,B.Z)("Keyboard Shortcuts")),DW("div",{className:"setting-single"},void 0,DW("label",{},void 0,DW("input",{type:"checkbox",checked:this.props.prefValues[I.kKeyboardShortcutsEnable],onChange:MW(I.kKeyboardShortcutsEnable)}),DW("span",{},void 0,(0,B.Z)("Enable Keyboard Shortcuts")))),DW("div",{className:"setting-single pad-left"},void 0,DW("label",{},void 0,DW("input",{type:"checkbox",checked:this.props.prefValues[I.kKeyboardShortcutsEnableSingleKey],onChange:MW(I.kKeyboardShortcutsEnableSingleKey),disabled:!this.props.prefValues[I.kKeyboardShortcutsEnable]}),DW("span",{},void 0,(0,B.Z)("Single Key Shortcuts")))),!this.props.prefValues[I.kMailIsTurnedOff]&&DW("div",{className:"setting-single pad-left"},void 0,DW("label",{},void 0,DW("input",{type:"checkbox",checked:this.props.prefValues[I.kKeyboardShortcutsEnableSingleKeyForMail],onChange:MW(I.kKeyboardShortcutsEnableSingleKeyForMail),disabled:!this.props.prefValues[I.kKeyboardShortcutsEnable]}),DW("span",{},void 0,(0,B.Z)("Mail and Calendar Single Key Shortcuts")))),DW("div",{className:"setting-single"},void 0,DW("label",{},void 0,DW("input",{type:"checkbox",checked:this.props.prefValues[I.kKeyboardShortcutsSpaceFastForwards],onChange:MW(I.kKeyboardShortcutsSpaceFastForwards)}),DW("span",{},void 0,(0,B.Z)("Space Key to Fast Forward")))),DW("div",{className:"setting-single"},void 0,DW("label",{},void 0,DW("input",{type:"checkbox",checked:this.props.prefValues[I.kKeyboardShortcutsAltOpensMenu],onChange:MW(I.kKeyboardShortcutsAltOpensMenu)}),DW("span",{},void 0,(0,B.Z)("Alt Key for Main Menu"))))))}}const xW=OW;var LW;function RW(e,t,n,i){LW||(LW="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:LW,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const BW=[I.kKeyboardTabToAll,I.kKeyboardTabToAllUsesSystemDefault,I.kWebpagesFocusTrap],FW=w.Z.getEventHandler;var WW=RW("input",{type:"radio",value:"0"}),UW=RW("input",{type:"radio",value:"-1"}),VW=RW("input",{type:"radio",value:"1"}),HW=RW("input",{type:"radio",value:"0"});class GW extends Li.Component{handleDarwinKeyAccess=e=>{const t=C.Z.get(I.kSystemMacKeyboardUiMode),n=e.target&&e.target.checked;n||-1===this.props.prefValues[I.kKeyboardTabToAll]?n&&2===t&&0!==this.props.prefValues[I.kKeyboardTabToAll]?w.Z.set(I.kKeyboardTabToAll,0):n&&0===t&&-1!==this.props.prefValues[I.kKeyboardTabToAll]&&w.Z.set(I.kKeyboardTabToAll,-1):w.Z.set(I.kKeyboardTabToAll,-1),w.Z.set(I.kKeyboardTabToAllUsesSystemDefault,n)};renderFullKeyboardAccess=()=>RW("div",{className:"setting-group"},void 0,RW("h3",{},void 0,(0,B.Z)("Full Keyboard Access")),!1,RW(ja.Z,{name:"keyAccessSetting",className:"setting-single",value:this.props.prefValues[I.kKeyboardTabToAll],onChange:FW(I.kKeyboardTabToAll),disabled:this.props.prefValues[I.kKeyboardTabToAllUsesSystemDefault]},void 0,RW("label",{},void 0,WW,RW("span",{},void 0,(0,B.Z)("Focus All Controls"))),RW("p",{className:"info"},void 0,(0,B.Z)("Press TAB key to focus all controls")),RW("label",{},void 0,UW,RW("span",{},void 0,(0,B.Z)("Focus Input"))),RW("p",{className:"info"},void 0,(0,B.Z)("Press TAB key to focus text boxes and lists only"))));onFocusCyclingChanged=e=>{const t="1"===e.target.value;w.Z.set(I.kWebpagesFocusTrap,t)};renderFocusCycling=()=>RW("div",{className:"setting-group"},void 0,RW("h3",{},void 0,(0,B.Z)("Focus Cycling")),RW(ja.Z,{name:"toolbarFocusCycling",className:"setting-single",value:this.props.prefValues[I.kWebpagesFocusTrap]?"1":"0",onChange:this.onFocusCyclingChanged},void 0,RW("label",{},void 0,VW,RW("span",{},void 0,(0,B.Z)("Cycle in Component"))),RW("p",{className:"info"},void 0,(0,B.Z)("TAB key focus is bound to individual toolbars or webpage")),RW("label",{},void 0,HW,RW("span",{},void 0,(0,B.Z)("Cycle All"))),RW("p",{className:"info"},void 0,(0,B.Z)("TAB key focus cycles through whole application"))));render(){return RW(iA.Z,{filter:this.props.filter},void 0,this.renderFocusCycling(),this.renderFullKeyboardAccess())}}const $W=(0,Bu.Z)(GW,BW);var KW;function zW(e,t,n,i){KW||(KW="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:KW,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const jW=[I.kKeyboardShortcutsEnableSingleKey,I.kWebpagesSpatialNavigationEnabled],YW=[I.kActions,...jW],XW=w.Z.getEventHandler;class QW extends Li.Component{isSingleKeyShortcut=(e,t)=>!!t||!Ke.Z.isSingleKeyShortcut(e);render(){const{prefValues:e}=this.props,t=e[I.kActions][0],n=e[I.kKeyboardShortcutsEnableSingleKey],i=t.COMMAND_SPATNAV_LEFT.shortcuts?.slice(0,3).filter((e=>this.isSingleKeyShortcut(e,n)))||[],s=t.COMMAND_SPATNAV_RIGHT.shortcuts?.slice(0,3).filter((e=>this.isSingleKeyShortcut(e,n)))||[],o=t.COMMAND_SPATNAV_UP.shortcuts?.slice(0,3).filter((e=>this.isSingleKeyShortcut(e,n)))||[],a=t.COMMAND_SPATNAV_DOWN.shortcuts?.slice(0,3).filter((e=>this.isSingleKeyShortcut(e,n)))||[];return zW(iA.Z,{filter:this.props.filter},void 0,zW("div",{className:"setting-group"},void 0,zW("div",{className:"setting-single"},void 0,zW("h3",{},void 0,(0,B.Z)("Spatial Navigation")),zW("label",{},void 0,zW("input",{type:"checkbox",checked:this.props.prefValues[I.kWebpagesSpatialNavigationEnabled],onChange:XW(I.kWebpagesSpatialNavigationEnabled)}),zW("span",{},void 0,(0,B.Z)("spatial navigation","Enabled"))),zW("div",{className:"info"},void 0,(0,B.Z)("Navigate between links and elements using your keyboard."),zW("div",{className:"shortcuts"},void 0,Boolean(i.length)&&(0,ss.jsxs)(ss.Fragment,{children:[zW("span",{},void 0,(0,B.Z)("spatnav","Left")),zW("span",{className:"shortcut"},void 0,i.map((e=>zW("kbd",{},e,(0,vp.$)(e)))))]}),Boolean(s.length)&&(0,ss.jsxs)(ss.Fragment,{children:[zW("span",{},void 0,(0,B.Z)("spatnav","Right")),zW("span",{className:"shortcut"},void 0,s.map((e=>zW("kbd",{},e,(0,vp.$)(e)))))]}),Boolean(o.length)&&(0,ss.jsxs)(ss.Fragment,{children:[zW("span",{},void 0,(0,B.Z)("spatnav","Up")),zW("span",{className:"shortcut"},void 0,o.map((e=>zW("kbd",{},e,(0,vp.$)(e)))))]}),Boolean(a.length)&&(0,ss.jsxs)(ss.Fragment,{children:[zW("span",{},void 0,(0,B.Z)("spatnav","Down")),zW("span",{className:"shortcut"},void 0,a.map((e=>zW("kbd",{},e,(0,vp.$)(e)))))]}))))))}}const qW=(0,Bu.Z)(QW,YW);var JW,eU=n(93196);function tU(e,t,n,i){JW||(JW="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:JW,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const nU={width:400,minWidth:"unset"},iU=[...ZW,...BW,...jW,I.kKeyboardShortcutsAltOpensMenu,I.kKeyboardShortcutsEnable,I.kKeyboardShortcutsEnableSingleKey,I.kKeyboardShortcutsEnableSingleKeyForMail,I.kKeyboardShortcutsSpaceFastForwards],sU=[I.kChainedCommandsCommandList,I.kMailIsTurnedOff,...iU];function oU(e){if(!e.name.startsWith("COMMAND_WORKSPACE_SWITCH_")&&!e.name.startsWith("COMMAND_WORKSPACE_MOVE_TABS_TO_"))return e.label;const t=e.name.startsWith("COMMAND_WORKSPACE_MOVE_TABS_TO_")?1:2,n=Number(e.name.split("_").at(-1)),i=GF.Z.getState();return n>=t&&n<i.length+t?e.label+" ("+i[n-t].name+")":e.label}function aU(e){const t=(0,Ya.Z)(sU),n=e.category?.title?e.category.title:"",i=sN({filter:e.filter,prefPaths:iU,name:n}),s=e.category?i:null,[o,a]=Li.useState(Ge.Z.getSettingsList(!1)),[r,l]=Li.useState(["CATEGORY_COMMAND_APPLICATION"]),[d,c]=Li.useState(!1),[u,p]=Li.useState("");Li.useEffect((()=>{const e=()=>{a(Ge.Z.getSettingsList(!1))};return Ge.Z.addListener(e),ie.Z.addListener(e),C.Z.addListener(I.kMailIsTurnedOff,e),()=>{Ge.Z.removeListener(e),ie.Z.removeListener(e),C.Z.removeListener(I.kMailIsTurnedOff,e)}}),[]),Li.useEffect((()=>{p("")}),[e.filter]);const h=()=>{c(!0)},g=()=>{ne.Z.restoreShortcuts(),c(!1)},m=()=>{c(!1)},f=(e,t,n)=>{const i=NW(e);return tU("div",{className:"category "+(n||r.indexOf(e)>-1?"show":"hide")},e,tU("button",{onClick:()=>{return t=e,void l((0,v.Uy)((e=>{e.indexOf(t)>-1?e.splice(e.indexOf(t),1):e.push(t)})));var t}},void 0,(0,yr.CH)(i,n)),tU("div",{className:"list"},void 0,t.map(((e,t)=>y(e,t,n)))))},y=(n,i,s)=>{const a=!t[I.kKeyboardShortcutsEnable],r=!t[I.kKeyboardShortcutsEnableSingleKey],l=!t[I.kKeyboardShortcutsEnableSingleKeyForMail];if("read-only"===e.view)return tU("div",{className:"keycombo"},i,tU("label",{},void 0,(0,yr.CH)(oU(n),s)),n.shortcuts&&n.shortcuts.map(((e,t)=>[tU("span",{title:a?(0,B.Z)("Keyboard Shortcuts are disabled"):1===e.length&&(r&&"mail"!==n.feature||l&&"mail"===n.feature)?(0,B.Z)("Single Key Shortcuts are disabled"):""},t,tU("input",{type:"button",disabled:!0,className:e.length>1?"item regular":"item single",value:(0,vp.$)(e)}))])));if(!(0,eU.os)(n.name)){const i=n.name.toLowerCase();return tU("div",{className:"keycombo"},i,tU("label",{htmlFor:"combo-"+i},void 0,(0,yr.CH)(oU(n),e.filter)),tU(Ap,{prefValues:t,id:"combo-"+i,commandArray:o,command:n},i))}return null},b=t=>{let n=[];if(n="read-only"===e.view?o.filter((e=>Boolean(e.shortcuts&&e.shortcuts.length>0))):o,t){const e=S(t);n=n.filter((n=>{if((n.label||n.name).toLowerCase().indexOf(t.toLowerCase())>-1)return!(0,eU.os)(n.name);return(n.shortcuts||[]).some((t=>{const n=S(t);return rZ(e,n)}))}))}return n.length>0?tU("div",{className:"keyboard-shortcut-list"},void 0,t&&tU("header",{},void 0,tU("h3",{},void 0,(0,B.Z)("Showing all keyboard shortcut entries matching $1.",[t]))),((t,n)=>{const i=t.reduce(((e,t)=>(e[t.category]=(e[t.category]||[]).concat(t),e)),{});let s;s=C.Z.get(I.kWorkspacesEnabled)?Object.keys(i):Object.keys(i).filter((e=>"CATEGORY_COMMAND_WORKSPACE_ACTION"!==e));const o=s.map(((e,t)=>f(e,i[e],n)));return o.length>0?tU("div",{className:"setting-single"},void 0,tU("div",{className:"keystrokes"},void 0,o),!e.filter&&"read-only"!==e.view&&tU("input",{type:"button",onClick:h,value:(0,B.Z)("Restore Default Keys")})):null})(n,t)):null},S=e=>new Set(e.match(/[^,\s\+]+/g)||[]),w=u||e.filter;return"read-only"===e.view?b(w):(0,ss.jsxs)(ss.Fragment,{children:[tU("section",{className:"setting-section"},void 0,tU(tN.Z,{categoryTitle:(0,B.Z)("Keyboard"),className:Fi()({"keyboard-shortcut-list":!0,singlekeydisabled:!t[I.kKeyboardShortcutsEnableSingleKey],singlekeydisabledfeatures:!t[I.kKeyboardShortcutsEnableSingleKeyForMail]}),filter:e.filter},void 0,d&&tU(ra.Z,{style:nU,onRequestClose:m,title:(0,B.Z)("Restore Keyboard Shortcuts?")},void 0,tU("div",{className:"dialog-restore-shortcuts"},void 0,tU("div",{className:"dialog-content"},void 0,tU("p",{},void 0,(0,B.Z)("All keyboard shortcuts will be restored to default."))),tU("footer",{className:"dialog-footer"},void 0,tU("input",{type:"button",className:"danger",onClick:g,value:(0,B.Z)("Restore")}),tU("input",{type:"button",onClick:m,value:(0,B.Z)("Cancel"),autoFocus:!0})))),tU($W,{filter:e.filter}),tU(_W,{filter:e.filter}),tU(xW,{filter:e.filter,prefValues:t}),tU(qW,{filter:e.filter}),b(w))),s]})}const rU=Li.memo(aU);var lU;function dU(e,t,n,i){lU||(lU="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:lU,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const cU={Title:(0,B.Z)("Title"),Address:(0,B.Z)("Address"),"Every 15 minutes":(0,B.Z)("Every 15 minutes"),"Every 30 minutes":(0,B.Z)("Every 30 minutes"),"Every hour":(0,B.Z)("Every hour"),"Every 2 hours":(0,B.Z)("Every 2 hours"),"Every 6 hours":(0,B.Z)("Every 6 hours"),"Every 12 hours":(0,B.Z)("Every 12 hours"),Daily:(0,B.Z)("Daily"),Weekly:(0,B.Z)("Weekly"),Never:(0,B.Z)("other","Never")};class uU extends Li.Component{constructor(e){super(e),this.state={account:this.props.account,accountIndex:this.props.accountIndex,urlValidated:!1}}isAccountChanged=()=>{const e=this.props.account;if(!e||!this.state.urlValidated)return!1;const{url:t,feedId:n,title:i,refreshInterval:s,offline:o}=this.state.account;return!(i===e.title&&t===e.url&&n===e.feedId&&s===e.refreshInterval&&o===e.offline)};isUrlValid=e=>""!==e.trim()&&(e.split(/\s/).filter((e=>e))||[e]).every((e=>(0,rl.C3)(e)));setAccountProperty=e=>{const{name:t,value:n}=e.target,i="refreshInterval"===t?"-1"===n:this.state.account.offline,s=this.isUrlValid("url"===t?n:this.state.account.url);this.setState((e=>({account:{...e.account,[t]:n,offline:i},urlValidated:s})))};saveAccount=()=>{const{url:e,feedId:t,title:n,refreshInterval:i,lastChecked:s,offline:o}=this.state.account;this.props.save({url:e,feedId:t,title:n,refreshInterval:i,lastChecked:s,offline:o},this.props.accountIndex)};render(){return dU("form",{className:"detail",onSubmit:this.saveAccount},void 0,dU("div",{className:"detail-content"},void 0,dU("div",{className:"setting-group"},void 0,dU("div",{className:"setting-single"},void 0,dU(Vl.Z,{type:"text",onChange:this.setAccountProperty,name:"title",label:this.props.searchableStrings.Title,placeholder:(0,B.Z)("Feed Title"),value:this.state.account.title,autoFocus:!this.state.account.title})),dU("div",{className:"setting-single"},void 0,dU(Vl.Z,{type:"text",onChange:this.setAccountProperty,name:"url",label:this.props.searchableStrings.Address,placeholder:(0,B.Z)("Feed Address"),isVerified:this.state.urlValidated,value:this.state.account.url})),dU("div",{className:"setting-single"},void 0,dU("label",{className:"floating-label"},void 0,dU("span",{},void 0,(0,B.Z)("Refresh Interval")),dU(ta.Z,{onChange:this.setAccountProperty,value:this.state.account.refreshInterval,name:"refreshInterval"},void 0,hd()))))),dU("div",{className:"detail-toolbar"},void 0,dU("input",{type:"submit",value:(0,B.Z)("Save"),disabled:!this.isAccountChanged()})))}}const pU=uU;function hU(e,t){se.Z.mailPrivate.getFileDirectory(t,(t=>{t&&c.ZP.openURL(e,`file://${t}`,{inCurrent:!1,inBackground:!1})}))}var gU;function mU(e,t,n,i){gU||(gU="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:gU,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const fU="/resources/vivaldi_rss_default.png",vU=n(55592),yU=[I.kMailIsTurnedOff,I.kRssDetectFeeds,I.kRssEmbedYoutubeAttachments,I.kRssShowNotifications,I.kRssSettings],bU=w.Z.getEventHandler,SU={"Add your First Newsfeed Account":(0,B.Z)("Add your First Newsfeed Account"),"Press the “Add” button to the left to add a new account.":(0,B.Z)("Press the “Add” button to the left to add a new account.")};function wU(e){const t=Li.useContext(ts.Z),n=(0,Ya.Z)(yU),i=n[I.kRssSettings],s=yt.Z.getByAccountId(It.u4),[o,a]=Li.useState(i.length>s.length),[r,l]=Li.useState(!1),d=(e,t)=>{if(t<i.length)yn(e,t);else{const t=[],n=e.url.split(/\s/).filter((e=>e));n.length>1?n.forEach((n=>{const{title:i,feedId:s}=e;t.some((e=>e.url===n))||t.push({url:n,feedId:s,title:i,refreshInterval:5,lastChecked:0,offline:!1})})):t.push(e),fn(t)}};return(0,ss.jsxs)(ss.Fragment,{children:[!n[I.kMailIsTurnedOff]&&mU(tN.Z,{filter:e.filter,categoryTitle:(0,B.Z)("Newsfeed Accounts")},void 0,o&&mU("div",{className:"setting-group"},void 0,mU("div",{className:"setting-single"},void 0,mU("h3",{},void 0,(0,B.Z)("Database Error Detected")),mU("label",{title:(0,B.Z)("Filters for feeds are missing from DB and need to be restored!")},void 0,mU("input",{type:"button",onClick:async()=>{l(!0),await ik();const e=yt.Z.getByAccountId(It.u4);a(i.length!==e.length),l(!1)},disabled:r,value:r?(0,B.Z)("Restoring Feeds ..."):(0,B.Z)("Restore Feeds")})))),mU("div",{className:"setting-group unlimited"},void 0,mU(QD.Z,{deleteTitle:(0,B.Z)("title","Delete Feed"),addTipString:(0,B.Z)("title","Add Feed"),deleteTipString:(0,B.Z)("tooltip","Delete Feed"),emptyListGraphic:vU,emptyListString:(0,B.Z)("No Feeds added"),filter:e.filter,items:i.map((e=>({...e,key:e.title,name:e.title}))),masterLayout:0,onRemove:e=>{const{feedId:t}=i[e];vn(t)},renderListItem:(e,t)=>{const n=((0,ge.Z)(t.url)?.hostname||"").split(".").slice(-2).join(".");return mU(eM,{title:t.title,meta:t.url,iconPath:n,iconFallbackPath:fU},t.url)},renderCreateListItem:()=>(0,ss.jsx)(ss.Fragment,{children:mU(eM,{title:(0,B.Z)("New Feed"),meta:(0,B.Z)("Setup in progress..."),iconFallbackPath:fU,isCreating:!0})}),renderContent:(e,t)=>{const n=i&&i[e];return n?mU(pU,{save:d,searchableStrings:t,account:n,accountIndex:e},n.url):null},renderCreate:e=>{const t={title:"",url:"",feedId:crypto.randomUUID(),lastChecked:0,refreshInterval:0,offline:!1};return mU(pU,{save:d,searchableStrings:e,account:t,accountIndex:i.length})},renderEmpty:e=>mU("div",{className:"detail"},void 0,mU("div",{className:"detail-content"},void 0,mU("h3",{},void 0,e["Add your First Newsfeed Account"]),mU("p",{},void 0,e["Press the “Add” button to the left to add a new account."]))),contentStrings:cU,emptyStrings:SU,className:"setting-rss-accounts"}),mU("div",{className:"setting-group"},void 0,mU("div",{className:"setting-single"},void 0,mU("input",{type:"button",onClick:()=>Pn.forceRefreshAllRSSAccounts(),disabled:0===i.length,value:(0,B.Z)("Update All Feeds")}))),mU("div",{className:"setting-group"},void 0,mU("div",{className:"setting-single"},void 0,mU("input",{type:"button",onClick:()=>hU(t.vivaldiWindowId,(0,nk.BB)(It.u4)),disabled:0===i.length,value:(0,B.Z)("Reveal Data Folder")}))))),mU(tN.Z,{categoryTitle:(0,B.Z)("Feed Settings"),filter:e.filter},void 0,mU(k_.j,{filter:e.filter,heading:(0,B.Z)("Feed Detection")},void 0,mU("div",{className:"setting-single"},void 0,mU("label",{title:(0,B.Z)("Use Vivaldi Feeds to detect, preview and subscribe to feeds.")},void 0,mU("input",{type:"checkbox",checked:n[I.kRssDetectFeeds],onChange:bU(I.kRssDetectFeeds)}),mU("span",{},void 0,(0,B.Z)("Detect Feeds in Web Pages"))))),!n[I.kMailIsTurnedOff]&&(0,ss.jsxs)(ss.Fragment,{children:[mU(k_.j,{filter:e.filter,heading:(0,B.Z)("Feed Notifications")},void 0,mU("div",{className:"setting-single"},void 0,mU("label",{},void 0,mU("input",{type:"checkbox",checked:n[I.kRssShowNotifications],onChange:bU(I.kRssShowNotifications)}),mU("span",{},void 0,(0,B.Z)("Show Notifications for New Feed Items"))))),mU(k_.j,{filter:e.filter,heading:(0,B.Z)("Attachments")},void 0,mU("div",{className:"setting-single"},void 0,mU("label",{},void 0,mU("input",{type:"checkbox",checked:n[I.kRssEmbedYoutubeAttachments],onChange:bU(I.kRssEmbedYoutubeAttachments)}),mU("span",{},void 0,(0,B.Z)("Embed YouTube Links in Attachments")))))]})),mU(gD,{categoryTitle:(0,B.Z)("Feeds"),filter:e.filter,inform:!0})]})}const CU=Li.memo(wU);var AU,IU=n(6271);function TU(e,t,n,i){AU||(AU="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:AU,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const ZU={Port:(0,B.Z)("Port"),"Incoming Server":(0,B.Z)("Incoming Server"),Username:(0,B.Z)("Username"),Password:(0,B.Z)("Password"),"Outgoing Server":(0,B.Z)("Outgoing Server"),"Use App Password":(0,B.Z)("Use App Password"),"Use OAuth":(0,B.Z)("Use OAuth")};var EU=TU(ta.Z,{name:"MAIL_SOCKET_TYPE",value:"ssl",disabled:!0},void 0,TU("option",{value:"ssl"},void 0,"SSL/TLS")),kU=TU("option",{value:"starttls"},void 0,"StartTLS");class _U extends Li.PureComponent{isImap(){return this.props.account.accountType===It.s9.IMAP}toggleOAuth=()=>{this.props.setAccountProperty("useOAuth",!this.props.account.useOAuth)};onChangeEvent=e=>{const{name:t,value:n}=e.target;this.props.setAccountProperty(t,n)};render(){const{MAIL_SERVER:e,MAIL_PORT:t,MAIL_USER:n,MAIL_PASSWORD:i,MAIL_SMTP_SERVER:s,MAIL_SMTP_PORT:o,MAIL_SMTP_USER:a,MAIL_SMTP_PASSWORD:r,MAIL_SMTP_SOCKET_TYPE:l}=this.props.account;return TU("div",{className:"setting-group-block setting-mail-account-form"},void 0,TU("div",{className:"setting-group"},"mail__imap",TU("div",{className:"setting-single setting-single-flex"},void 0,TU(Vl.Z,{type:"text",disabled:this.props.disabled,onChange:this.onChangeEvent,name:"MAIL_SERVER",label:this.props.searchableStrings["Incoming Server"],labelImportant:!0,placeholder:"mail.vivaldi.net",isVerified:this.props.incomingVerified,hasError:this.props.showErrors&&!e,value:e||"",className:"incoming-server-label"}),TU(Vl.Z,{type:"number",disabled:this.props.disabled,onChange:this.onChangeEvent,name:"MAIL_PORT",label:this.props.searchableStrings.Port,placeholder:this.isImap()?"993":"995",isVerified:this.props.incomingVerified,value:t||"",className:"port-label"})),TU("div",{className:"setting-single"},void 0,TU("label",{className:"floating-label",disabled:!0},void 0,(0,B.Z)("Connection Security"),EU)),TU("div",{className:"setting-single"},void 0,TU(Vl.Z,{type:"text",disabled:this.props.disabled,onChange:this.onChangeEvent,name:"MAIL_USER",label:this.props.searchableStrings.Username,placeholder:"user@vivaldi.net",isVerified:this.props.userVerified,hasError:this.props.showErrors&&!n,value:n||""})),!this.props.account.useOAuth&&TU("div",{className:"setting-single"},void 0,TU(Vl.Z,{type:"password",disabled:this.props.disabled,onChange:this.onChangeEvent,name:"MAIL_PASSWORD",label:this.props.searchableStrings.Password,placeholder:"",isVerified:this.props.userVerified,hasError:this.props.showErrors&&!i,value:i||""}))),TU("div",{className:"setting-group"},"mail__smtp",TU("div",{className:"setting-single setting-single-flex"},void 0,TU(Vl.Z,{type:"text",disabled:this.props.disabled,onChange:this.onChangeEvent,name:"MAIL_SMTP_SERVER",label:this.props.searchableStrings["Outgoing Server"],labelImportant:!0,placeholder:"mail.vivaldi.net",isVerified:this.props.smtpVerified,hasError:this.props.showErrors&&!s,value:s||"",className:"outgoing-server-label"}),TU(Vl.Z,{type:"number",disabled:this.props.disabled,onChange:this.onChangeEvent,name:"MAIL_SMTP_PORT",label:this.props.searchableStrings.Port,placeholder:"465",value:o||"",isVerified:this.props.smtpVerified,className:"port-label"})),TU("div",{className:"setting-single"},void 0,TU("label",{className:"floating-label"},void 0,(0,B.Z)("Connection Security"),TU(ta.Z,{name:"MAIL_SMTP_SOCKET_TYPE",onChange:this.onChangeEvent,value:l||"ssl"},void 0,TU("option",{value:"ssl"},void 0,(0,B.Z)("SSL/TLS (Recommended)")),kU))),TU("div",{className:"setting-single"},void 0,TU(Vl.Z,{type:"text",disabled:this.props.disabled,onChange:this.onChangeEvent,name:"MAIL_SMTP_USER",label:this.props.searchableStrings.Username,placeholder:"user@vivaldi.net",isVerified:this.props.userVerified,hasError:this.props.showErrors&&!a,value:a||""})),!this.props.account.useOAuth&&TU("div",{className:"setting-single"},void 0,TU(Vl.Z,{type:"password",disabled:this.props.disabled,onChange:this.onChangeEvent,name:"MAIL_SMTP_PASSWORD",label:this.props.searchableStrings.Password,placeholder:"",isVerified:this.props.userVerified,hasError:this.props.showErrors&&!r,value:r||""})),(0,IU.Ap)(this.props.account)&&TU("label",{className:"setting-single"},void 0,TU("input",{type:"checkbox",checked:!!this.props.account.useOAuth&&this.props.account.useOAuth,onChange:this.toggleOAuth}),TU("span",{},void 0,this.props.searchableStrings["Use OAuth"]))))}}const NU=_U;var PU;function DU(e,t,n,i){PU||(PU="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:PU,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var MU=DU("input",{type:"radio",value:It.kA,default:!0}),OU=DU("input",{type:"radio",value:It.Qp}),xU=DU("input",{type:"radio",value:It.eQ});class LU extends Li.PureComponent{onChange=e=>{let{name:t,value:n,checked:i}=e.target;n===It.qd&&i&&(n=It.kA);const s={...this.props.account.popDeletion,[t]:n};this.props.setAccountProperty("popDeletion",s)};render(){const e=this.props.account.popDeletion||{},{when:t=It.qd,howManyDays:n=It.CH}=e;return DU("div",{className:"setting-group setting-group-double"},void 0,DU(ja.Z,{name:"popdeletiongroup",value:t,onChange:this.onChange,disabled:t===It.qd,name:"when"},void 0,DU("div",{className:"setting-single"},void 0,DU("label",{},void 0,DU("input",{type:"checkbox",checked:t!==It.qd,value:It.qd,onChange:this.onChange,name:"when"}),DU("span",{},void 0,(0,B.Z)("Delete mail from server")))),DU("div",{className:"setting-single pad-left"},void 0,DU("label",{className:"pop-how-many-days"},void 0,MU,DU("input",{type:"number",min:"1",disabled:t!==It.kA,value:n,placeholder:It.CH,onChange:this.onChange,name:"howManyDays",className:"pop-how-many-days-input"}),DU("span",{},void 0,(0,B.Z)("days after receiving from server")))),DU("div",{className:"setting-single pad-left"},void 0,DU("label",{},void 0,OU,DU("span",{},void 0,(0,B.Z)("when deleting locally")))),DU("div",{className:"setting-single pad-left"},void 0,DU("label",{},void 0,xU,DU("span",{},void 0,(0,B.Z)("when received from server"))))))}}const RU=LU;var BU;function FU(e,t,n,i){BU||(BU="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:BU,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const WU={"Limit size when loading":(0,B.Z)("Limit size when loading"),"Limit (MB)":(0,B.Z)("Limit (MB)"),"Sync Options":(0,B.Z)("Sync Options")};class UU extends Li.PureComponent{onChange=e=>{const{name:t,value:n,checked:i}=e.target,s={...this.props.popMaxSize,[t]:"limited"===t?i:n};"limited"===t&&i&&!s.limit&&(s.limit=It.yX),this.props.setAccountProperty("popMaxSize",s)};render(){const{limited:e=!1,limit:t=It.yX}=this.props.popMaxSize||{};return(0,ss.jsxs)(ss.Fragment,{children:[FU("h3",{},void 0,WU["Sync Options"]),FU("label",{className:"setting-single"},void 0,FU("input",{type:"checkbox",name:"limited",checked:e,onChange:this.onChange}),FU("span",{},void 0,WU["Limit size when loading"])),FU("label",{className:"setting-single setting-single-flex"},void 0,FU("input",{type:"number",name:"limit",placeholder:It.yX,disabled:!e,onChange:this.onChange,value:t,style:{width:90}}),FU("span",{},void 0,WU["Limit (MB)"]))]})}}const VU=UU;var HU=n(87192);function GU(e){const t=(0,nk.BB)(e);return new Promise(((e,n)=>{se.Z.mailPrivate.createFileDirectory(t,(t=>{i.Z.runtime.lastError?n((0,B.Z)("Error creating data directory")):e(t)}))}))}var $U,KU=n(27950);async function zU(e,t){t?((0,KU.OM)(t,e)&&(t.offline||t.accountType!==It.s9.IMAP||await Yt.Z.disconnectIMAPClient(t.MAIL_EMAIL),e.offline||(e.accountType===It.s9.IMAP?await Yt.Z.connectIMAPClient(e):e.accountType===It.s9.POP&&qt.Z.checkForMail(e.MAIL_EMAIL))),!e.offline&&(0,KU.yN)(t,e)&&Xt.Z.sendForAccount(p.A4,e.MAIL_EMAIL)):e.offline||(e.accountType===It.s9.IMAP&&await Yt.Z.connectIMAPClient(e),e.accountType===It.s9.POP&&qt.Z.checkForMail(e.MAIL_EMAIL))}function jU(e,t,n,i){$U||($U="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:$U,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const{UNKNOWN:YU,VERIFYING:XU,OK:QU,ERROR:qU}=It.In,JU={Back:(0,B.Z)("account creation","Back"),IMAP:(0,B.Z)("IMAP"),"Manual Setup":(0,B.Z)("Manual Setup"),"Edit Servers":(0,B.Z)("Edit Servers"),Manual:(0,B.Z)("Manual"),POP:(0,B.Z)("POP"),"Email Address":(0,B.Z)("Email Address"),Password:(0,B.Z)("Password"),"Offline Account":(0,B.Z)("Offline Account"),"Download Messages for Offline Viewing and Searching":(0,B.Z)("Download Messages for Offline Viewing and Searching"),"Upload Sent Messages to Sent Folder":(0,B.Z)("Upload Sent Messages to Sent Folder"),"Add your First Account":(0,B.Z)("Add your First Account"),"Add Mail Account":(0,B.Z)("Add Mail Account"),"Enter your email address to get started.":(0,B.Z)("Enter your email address to get started."),"Enter your email address to add account.":(0,B.Z)("Enter your email address to add account."),"If you would like a new mail account, we offer a free account when you register with vivaldi.net.":(0,B.Z)("If you would like a new mail account, we offer a free account when you register with vivaldi.net."),"Please provide the password for your account":(0,B.Z)("Please provide the password for your account"),"Enter your password":(0,B.Z)("Enter your password"),...ZU,"IMAP Server":(0,B.Z)("IMAP Server"),"POP Server":(0,B.Z)("POP Server"),"SMTP Server":(0,B.Z)("SMTP Server"),"Account Type":(0,B.Z)("Account Type"),Port:(0,B.Z)("Port"),"Create Local Account":(0,B.Z)("Create Local Account")};var eV=jU("div",{className:"email-providers"},void 0,jU("img",{src:"/resources/provider_proton.png",alt:"",width:"40",height:"40"}),jU("img",{src:"/resources/provider_gmail.png",alt:"",width:"40",height:"40"})," ",jU("img",{src:"/resources/provider_fastmail.png",alt:"",width:"40",height:"40"}),jU("img",{src:"/resources/provider_outlook.png",alt:"",width:"40",height:"40"}),jU("img",{src:"/resources/provider_icloud.png",alt:"",width:"40",height:"40"}),jU("img",{src:"/resources/provider_yahoo.png",alt:"",width:"40",height:"40"}));class tV extends Li.PureComponent{static contextType=ts.Z;_isMounted=!1;constructor(e){super(e),this.state={isAdding:!0,status:YU,statusText:"",account:{MAIL_EMAIL:"",MAIL_PASSWORD:"",MAIL_SERVER:"",MAIL_PORT:993,MAIL_USER:"",MAIL_SMTP_SERVER:"",MAIL_SMTP_PORT:465,MAIL_SMTP_SOCKET_TYPE:"ssl",MAIL_SMTP_USER:"",MAIL_SMTP_PASSWORD:"",preFetch:"month",accountType:It.s9.IMAP},addressValidated:!1,incomingVerified:!1,smtpVerified:!1,userVerified:!1,isEdited:!1,showManual:!1,syncUsernames:!0,syncPasswords:!0,showConfirmOAuth:!1}}componentDidMount(){this._isMounted=!0}componentWillUnmount(){this._isMounted=!1}setAccountProperty=(e,t)=>{"MAIL_EMAIL"===e?this.setState((e=>{const n=e.syncUsernames&&e.account.MAIL_EMAIL===e.account.MAIL_USER&&e.account.MAIL_EMAIL===e.account.MAIL_SMTP_USER,i={...e.account,MAIL_EMAIL:t,MAIL_USER:n?t:e.account.MAIL_USER,MAIL_SMTP_USER:n?t:e.account.MAIL_SMTP_USER};return{addressValidated:!this.accountExists(t)&&(e.account.offline||HU.Z.isValidEmail(i)),account:i,syncUsernames:n}})):"MAIL_PASSWORD"===e?this.setState((e=>{const n=e.syncPasswords&&e.account.MAIL_PASSWORD===e.account.MAIL_SMTP_PASSWORD;return{account:{...e.account,MAIL_PASSWORD:t,MAIL_SMTP_PASSWORD:n?t:e.account.MAIL_SMTP_PASSWORD},syncPasswords:n}})):"MAIL_PORT"===e||"MAIL_SMTP_PORT"===e?this.setState((n=>({account:{...n.account,[e]:""!==t?Number(t):NaN},..."MAIL_PORT"===e?{incomingVerified:!1}:{smtpVerified:!1}}))):"MAIL_SERVER"===e||"MAIL_SMTP_SERVER"===e?this.setState((n=>({account:{...n.account,[e]:t},incomingVerified:"MAIL_SERVER"!==e&&n.incomingVerified,smtpVerified:"MAIL_SMTP_SERVER"!==e&&n.smtpVerified}))):this.setState((n=>({account:{...n.account,[e]:t}})))};accountExists(e){return(C.Z.get(I.kMailAccounts)||[]).findIndex((t=>t.MAIL_EMAIL===e))>=0}onChangeAccountProperty=e=>{const{name:t,value:n}=e.target;this.setAccountProperty(t,n)};autofill=()=>{this.state.account.offline?this.createOffline():this.setState((e=>({isEdited:e.status===qU,status:XU,statusText:(0,B.Z)("Attempting account autodiscovery...")})),(async()=>{const[e,t]=await jt.Z.autofill(this.state.account);this.autofillCallback(e,t)}))};signIn=()=>{this.setState((e=>({isAdding:!1,isEdited:e.status===qU,status:XU,statusText:(0,B.Z)("Attempting sign in...")})),(async()=>{const[e,t,n]=await jt.Z.signIn(this.state.account);this.signInCallback(e,t,n)}))};completeDiscovery=e=>{this.setState({account:e,isAdding:!1,status:QU,statusText:(0,B.Z)("Autodiscovery completed."),incomingVerified:!0,smtpVerified:!0,userVerified:!1})};onCancel=()=>{this.setState({showConfirmOAuth:!1,status:QU})};onConfirmOAuth=e=>{this.setState((t=>({account:{...t.account,useOAuth:e},showConfirmOAuth:!1}))),e?this.signIn():this.completeDiscovery(this.state.account)};autofillCallback=(e,t)=>{if(this._isMounted)if(e===QU)(0,IU.Ap)(t)?this.setState({account:{...t},showConfirmOAuth:!0}):this.completeDiscovery(t);else if(e===qU){const e=t.MAIL_SERVER&&t.MAIL_PASSWORD&&t.MAIL_SMTP_SERVER&&t.MAIL_SMTP_PASSWORD;this.setState((n=>{const i={...n.account,...t};return{status:qU,statusText:e?(0,B.Z)("This should not happen"):(0,B.Z)("Autodiscovery failed. Please enter server settings"),showManual:!e,account:i,userVerified:!1}}))}};signInCallback=(e,t,n)=>{this._isMounted&&e===QU?this.setState({account:n,isAdding:!1,status:QU,statusText:(0,B.Z)("Login completed."),incomingVerified:!0,smtpVerified:!0,userVerified:!0},this.saveAccount):this._isMounted&&e===qU&&this.setState((e=>{const i={...e.account,...n};return{status:qU,statusText:t,account:i,userVerified:!1}}))};considerAddingAccount=e=>{const t=e.target.name||"",n="BACK"===t,i="OFFLINE"===t,s="MANUAL"===t&&!this.state.isAdding||n||i;"Enter"!==e.key||s||this.onSubmit()};createOffline=async()=>{const e=this.state.account.MAIL_EMAIL;await GU(e),this.saveAccount()};createAccountBooleanHandler=e=>t=>{const{checked:n}=t.target;this.setState((t=>({account:{...t.account,[e]:n}})))};saveAccount=async()=>{const{account:e}=this.state;await jt.Z.addAccount(e),(0,Od.ZP)(e),zU(e)};setViewType=e=>{const t=e.target.name;this.setState((e=>({showManual:"MANUAL"===t})))};createLocalAccount=e=>{this.setState((e=>({account:{...e.account,offline:!0}})),this.createOffline)};onSubmit=()=>{!this.state.addressValidated||this.isCreating()||this.state.account.offline||(this.state.isAdding&&!this.state.showManual?this.autofill():this.signIn())};renderSubmitButton=()=>{const e=this.state.status!==qU&&!this.state.showManual,t=this.state.status===qU&&!this.state.showManual;let n;this.state.showManual?n=(0,B.Z)("Add Account"):this.state.isAdding?n=(0,B.Z)("Continue"):e?n=(0,B.Z)("Sign In"):t&&(n=(0,B.Z)("Retry Login"));const i=!this.state.addressValidated||this.isCreating();return jU("input",{onClick:this.onSubmit,className:"primary",disabled:i,type:"button",style:{marginRight:"auto"},value:n})};onChangeMailAccountType=e=>{const t=e.target.value===It.s9.POP?It.s9.POP:It.s9.IMAP;this.setState((e=>({account:{...e.account,accountType:t}})))};isCreating=()=>this.state.status===XU;renderStatusCheck=()=>{if(this.state.status===XU||this.state.status===qU)return jU(To,{type:this.state.status===qU?"error":"info"},void 0,this.state.statusText)};onSignUpClicked=()=>{c.ZP.openURL(this.context.vivaldiWindowId,"https://vivaldi.com/email-signup/"),this.props.onClose&&this.props.onClose()};showOAuthDialog=()=>{const e=(0,B.Z)("OAuth follows a standard login process."),t=(0,B.Z)("Alternatively use an app-specific password. They are single purpose passwords that you can generate to login permanently."),n=(0,B.Z)("More info on Vivaldi Help.");return jU(FT,{title:(0,B.Z)("Pick Authentication Type"),prompt:[e,"",t,n],negative:(0,B.Z)("Use App-Specific Password"),positive:(0,B.Z)("Use OAuth"),onRequestClose:this.onCancel,onClose:this.onConfirmOAuth})};render(){const e=this.isCreating(),t=this.state.account.accountType===It.s9.POP,n=!this.state.account.useOAuth&&this.state.showManual;return jU("div",{className:"detail"},void 0,jU("div",{className:"detail-content"},void 0,jU("div",{className:"setting-group-double"},void 0,this.state.isAdding&&!this.state.showManual&&(0,ss.jsxs)(ss.Fragment,{children:[eV,jU("h2",{},void 0,this.props.emptyAccounts?JU["Add your First Account"]:JU["Add Mail Account"]),jU("p",{className:"mail-setup-description faded-text"},void 0,this.props.emptyAccounts?JU["Enter your email address to get started."]:JU["Enter your email address to add account."])]}),!this.state.isAdding&&!this.state.showManual&&(0,ss.jsxs)(ss.Fragment,{children:[jU("h2",{},void 0,JU["Enter your password"]),jU("p",{className:"mail-setup-description no-margin"},void 0,(0,B.Z)("Please provide the password for your account")),jU("a",{className:"mail-setup-email-link",href:"mailto:"+this.state.account.MAIL_EMAIL},void 0,this.state.account.MAIL_EMAIL)]})),jU("div",{className:"setting-group-double",onKeyPress:this.considerAddingAccount},void 0,this.state.isAdding&&jU("div",{className:"setting-single mail-address"},void 0,jU(Vl.Z,{focusInput:this.props.focusInput,type:"text",disabled:e,isVerified:this.state.addressValidated,label:"",name:"MAIL_EMAIL",onChange:this.onChangeAccountProperty,placeholder:(0,B.Z)("Your email address")}),jU(ta.Z,{className:"CreateMailAccount-dropdown",onChange:this.onChangeMailAccountType,value:this.state.account.accountType},void 0,jU("option",{value:It.s9.IMAP},void 0,(0,B.Z)("IMAP")),jU("option",{value:It.s9.POP},void 0,(0,B.Z)("POP3")))),!this.state.isAdding&&!this.state.showManual&&jU("div",{className:"setting-single mail-address"},void 0,jU(Vl.Z,{type:"password",disabled:e,label:"",autoFocus:!0,placeholder:(0,B.Z)("My long safe password"),onChange:this.onChangeAccountProperty,name:"MAIL_PASSWORD"})),t&&this.state.showManual&&jU(RU,{account:this.state.account,setAccountProperty:this.setAccountProperty})&&jU(VU,{popMaxSize:this.state.account.popMaxSize,setAccountProperty:this.setAccountProperty}),this.state.showManual&&jU(NU,{account:this.state.account,incomingVerified:this.state.incomingVerified,searchableStrings:this.props.searchableStrings,showErrors:this.state.status===qU,smtpVerified:this.state.smtpVerified,userVerified:this.state.userVerified,setAccountProperty:this.setAccountProperty}),this.renderStatusCheck(),jU("div",{className:"toolbar toolbar-default toolbar-wrap"},void 0,this.renderSubmitButton(),!n&&jU("input",{onClick:this.setViewType,type:"button",name:"MANUAL",value:this.state.isAdding?this.props.searchableStrings["Manual Setup"]:this.props.searchableStrings["Edit Servers"]}),!n&&jU("input",{onClick:this.createLocalAccount,type:"button",name:"OFFLINE",value:this.props.searchableStrings["Create Local Account"],disabled:!this.state.addressValidated||this.isCreating()}),n&&jU("input",{onClick:this.setViewType,type:"button",name:"BACK",value:this.props.searchableStrings.Back})))),this.state.showConfirmOAuth&&this.showOAuthDialog())}}const nV=tV;var iV;function sV(e,t,n,i){iV||(iV="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:iV,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class oV extends Li.Component{static contextType=ts.Z;focusSender=()=>{};constructor(e){super(e),this._initDraft()}_initDraft=()=>{this.signature=this.props.signature};componentDidMount(){this._isMounted=!0,this.onContentLoad()}componentWillUnmount(){this._isMounted=!1}componentDidUpdate(e){e.emailAddress!==this.props.emailAddress&&(this.signature=this.props.signature,this.onContentLoad())}onBodyChange=()=>this._isMounted&&this.refSignature.current?.getContentAsBodyParts?this.refSignature.current.getContentAsBodyParts().then(this.updateBody):Promise.reject();updateBody=(0,aC.Z)((async e=>{const t=e[0].content;this.props.onChange(t)}),200,{leading:!1});onContentLoad=()=>{this.signature&&setTimeout((()=>{""!==this.signature&&this.refSignature.current&&this.refSignature.current.setContent([{content:this.signature,isPlainText:!1}]),this.signature=""}),150)};refSignature=Li.createRef();render(){return sV("main",{},void 0,(0,ss.jsx)(aZ,{ref:this.refSignature,windowId:this.context.vivaldiWindowId,onSignatureAttachmentDrop:this.props.onChange,focusPreviousElement:this.focusSender,onBodyChange:this.onBodyChange,onContentLoad:this.onContentLoad}))}}const aV=oV;var rV,lV=n(59938);function dV(e,t,n,i){rV||(rV="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:rV,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const cV={"Alias Address":(0,B.Z)("Alias Address"),"New Alias":(0,B.Z)("New Alias"),"Enable Rich Text and Images":(0,B.Z)("Enable Rich Text and Images"),"Replied Messages":(0,B.Z)("Replied Messages"),"Forwarded Messages":(0,B.Z)("Forwarded Messages"),Signature:(0,B.Z)("Signature"),"Sender Name":(0,B.Z)("Sender Name")};class uV extends Li.PureComponent{state={newAlias:""};autoSetAliasProperty=(e,t,n,i)=>{if((n??i)===this.props.aliases[e][t])return;const s=(0,v.Uy)(this.props.aliases,(s=>{switch(t){case"signatureReply":case"signatureForward":case"isSignatureRichText":s[e][t]=i;break;case"MAIL_EMAIL":case"MAIL_NAME":case"signature":s[e][t]=n||"";break;case"signaturePosition":"above"!==n&&"below"!==n||(s[e][t]=n);break;default:console.warn(`Unknown property "${t}"`)}}));s!==this.props.aliases&&this.props.setAliases(s)};toggleCheckboxAliasProperty=(e,t,n)=>{const{checked:i}=e.target;this.autoSetAliasProperty(t,n,void 0,i)};autoSaveAliasProperty=(e,t,n)=>{const{value:i}=e.target;this.autoSetAliasProperty(t,n,i)};changeNewAlias=e=>{this.setState({newAlias:e.target.value})};addNewAlias=()=>{const e=(0,v.Uy)(this.props.aliases,(e=>{e.push({MAIL_EMAIL:this.state.newAlias})}));this.props.setAliases(e),this.setState({newAlias:""})};removeAlias=e=>{const t=(0,v.Uy)(this.props.aliases,(t=>{t.splice(e,1)}));this.props.setAliases(t)};render(){return(0,ss.jsxs)(ss.Fragment,{children:[dV("form",{className:"setting-group"},void 0,dV("h3",{},void 0,this.props.searchableStrings["New Alias"]),dV("div",{className:"setting-single"},void 0,dV(Vl.Z,{type:"text",labelImportant:!0,isVerified:(0,dZ.HZ)(this.state.newAlias),label:"",name:"MAIL_EMAIL",onChange:this.changeNewAlias,placeholder:this.props.defaultEmail.split("@").join("+label@")}),dV("input",{type:"submit",onClick:this.addNewAlias,disabled:!(0,dZ.HZ)(this.state.newAlias),value:(0,B.Z)("Add Alias")}))),this.props.aliases?.map(((e,t)=>dV("div",{className:"MailAliasesForm-block"},t,dV("div",{className:"setting-group"},void 0,dV("div",{className:"setting-single"},void 0,dV("h3",{},void 0,this.props.searchableStrings["Alias Address"]),dV(Vl.Z,{type:"text",onChange:e=>this.autoSaveAliasProperty(e,t,"MAIL_EMAIL"),label:"",placeholder:"John Doe",value:e.MAIL_EMAIL?e.MAIL_EMAIL:""})),dV("div",{className:"setting-single"},void 0,dV("h3",{},void 0,this.props.searchableStrings["Sender Name"]),dV(Vl.Z,{type:"text",onChange:e=>this.autoSaveAliasProperty(e,t,"MAIL_NAME"),label:"",placeholder:"John Doe",value:e.MAIL_NAME?e.MAIL_NAME:""})),dV("div",{className:"setting-single"},void 0,dV("input",{type:"submit",className:"danger",onClick:()=>this.removeAlias(t),value:(0,B.Z)("Remove Alias")}))),dV("div",{className:"setting-group setting-group-double"},void 0,dV("div",{className:"setting-single"},void 0,dV("h3",{},void 0,this.props.searchableStrings.Signature),dV("div",{className:"mail-signature"},void 0,e.isSignatureRichText?dV(aV,{onChange:e=>this.autoSetAliasProperty(t,"signature",e),signature:e.signature||"",emailAddress:e.MAIL_EMAIL}):dV(Vl.Z,{type:"textarea",rows:"2",onChange:e=>this.autoSaveAliasProperty(e,t,"signature"),label:"",placeholder:void 0===e.signature?lV.F:"",value:e.signature||""}),dV("div",{className:"mail-signature-footer"},void 0,dV("div",{className:"mail-signature-footer-sidebar"},void 0,dV("h3",{},void 0,(0,B.Z)("Include Signature in:")),dV("label",{},void 0,dV("input",{type:"checkbox",checked:void 0===e.signatureReply||e.signatureReply,onChange:e=>this.toggleCheckboxAliasProperty(e,t,"signatureReply")}),dV("span",{},void 0,cV["Replied Messages"])),dV("label",{},void 0,dV("input",{type:"checkbox",checked:!!e.signatureForward,onChange:e=>this.toggleCheckboxAliasProperty(e,t,"signatureForward")}),dV("span",{},void 0,cV["Forwarded Messages"]))),dV("div",{},void 0,dV(ta.Z,{value:e.signaturePosition||"below",onChange:e=>this.autoSaveAliasProperty(e,t,"signaturePosition"),title:(0,B.Z)("Placement of signature")},void 0,dV("option",{value:"above"},void 0,(0,B.Z)("Place Signature at Top")),dV("option",{value:"below"},void 0,(0,B.Z)("Place Signature at Bottom")))),dV("div",{},void 0,dV("label",{},void 0,dV("input",{type:"checkbox",checked:!!e.isSignatureRichText,onChange:e=>this.toggleCheckboxAliasProperty(e,t,"isSignatureRichText")}),dV("span",{},void 0,cV["Enable Rich Text and Images"]))))))))))]})}}const pV=uV;var hV;function gV(e,t,n,i){hV||(hV="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:hV,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const mV=[I.kMailListButtons],fV=w.Z.getEventHandler;var vV=gV("span",{className:"ShowMailTipsAndTricks-fakeButton"},void 0,"R"),yV=gV("span",{className:"ShowMailTipsAndTricks-fakeButton"},void 0,"T"),bV=gV("span",{className:"ShowMailTipsAndTricks-fakeButton"},void 0,"F"),SV=gV("span",{className:"ShowMailTipsAndTricks-fakeButton"},void 0,"G"),wV=gV("span",{className:"ShowMailTipsAndTricks-fakeButton"},void 0,"K"),CV=gV("span",{className:"ShowMailTipsAndTricks-fakeButton"},void 0,"E"),AV=gV("span",{className:"ShowMailTipsAndTricks-fakeButton"},void 0,"M"),IV=gV("input",{type:"radio",value:"text_menu"}),TV=gV("input",{type:"radio",value:"icons_only"});class ZV extends Li.PureComponent{static contextType=ts.Z;SM=["start","singlekey","unseen","filterbuttons","feeds","final"];state={current:this.props.isSettings?"singlekey":"start"};renderState(e){switch(this.state.current){case"start":return gV("div",{className:"ShowMailTipsAndTricks-allSetContainer"},void 0,gV("span",{className:"ShowMailTipsAndTricks-allSetIcon",dangerouslySetInnerHTML:{__html:Wi.mXV}}),gV("h1",{className:"ShowMailTipsAndTricks-allSetTitle"},void 0,(0,B.Z)("Great, you’re all set!")),gV("p",{className:"ShowMailTipsAndTricks-description"},void 0,(0,B.Z)("Where to next?")));case"singlekey":const t="https://help.vivaldi.com/desktop/shortcuts/keyboard-shortcuts/";return(0,ss.jsxs)(ss.Fragment,{children:[gV("h1",{className:"ShowMailTipsAndTricks-title"},void 0,(0,B.Z)("Mail Tips & Tricks")),gV("h2",{className:"ShowMailTipsAndTricks-subtitle"},void 0,(0,B.Z)("Single key shortcuts")),gV("p",{className:"ShowMailTipsAndTricks-description"},void 0,(0,B.Z)("When you’re in Mail you can hit a single key to get common tasks done faster")),gV("div",{className:"ShowMailTipsAndTricks-shortcuts"},void 0,gV("label",{className:"ShowMailTipsAndTricks-shortcutContainer"},void 0,vV,(0,B.Z)("Reply")),gV("label",{className:"ShowMailTipsAndTricks-shortcutContainer"},void 0,yV,(0,B.Z)("Threaded View")),gV("label",{className:"ShowMailTipsAndTricks-shortcutContainer"},void 0,bV,(0,B.Z)("mail","Forward")),gV("label",{className:"ShowMailTipsAndTricks-shortcutContainer"},void 0,SV,(0,B.Z)("Mark the current e-mail as read and jump to the next unread.")),gV("label",{className:"ShowMailTipsAndTricks-shortcutContainer"},void 0,wV,(0,B.Z)("mail","Mark as Read")),gV("label",{className:"ShowMailTipsAndTricks-shortcutContainer"},void 0,CV,(0,B.Z)("Enable Sender View (only show emails to and from the sender)")),gV("label",{className:"ShowMailTipsAndTricks-shortcutContainer"},void 0,AV,(0,B.Z)("Mark Thread as Read")),gV("a",{href:t,className:"ShowMailTipsAndTricks-shortcutLink",onClick:()=>c.ZP.openURL(e,t)},void 0,(0,B.Z)("Learn more about keyboard shortcuts")))]});case"unseen":const n="https://help.vivaldi.com/mail/mail-get-started/view-and-manage-messages/#Message_read_status";return(0,ss.jsxs)(ss.Fragment,{children:[gV("h1",{className:"ShowMailTipsAndTricks-title"},void 0,(0,B.Z)("Mail Tips & Tricks")),gV("h2",{className:"ShowMailTipsAndTricks-subtitle"},void 0,(0,B.Z)("Unseen and Unread")),gV("div",{className:"ShowMailTipsAndTricks-descriptionContainer"},void 0,gV("span",{className:"ShowMailTipsAndTricks-icon",dangerouslySetInnerHTML:{__html:Wi.tG3}}),gV("div",{className:"ShowMailTipsAndTricks-descriptionSide ShowMailTipsAndTricks-descriptionSide--Unseen"},void 0,gV("p",{},void 0,(0,B.Z)("In Vivaldi Mail, we separate between emails you’ve seen and those you have read.")),gV("p",{},void 0,(0,B.Z)("Emails are not marked read until you press K or G on the keyboard (or use the toolbar buttons).")),gV("a",{href:n,onClick:()=>c.ZP.openURL(e,n)},void 0,(0,B.Z)("Learn more about Unseen emails."))))]});case"filterbuttons":const i="https://help.vivaldi.com/mail/mail-get-started/view-and-manage-messages/#Display_messages_with_view_toggles";return(0,ss.jsxs)(ss.Fragment,{children:[gV("h1",{className:"ShowMailTipsAndTricks-title"},void 0,(0,B.Z)("Mail Tips & Tricks")),gV("h2",{className:"ShowMailTipsAndTricks-subtitle"},void 0,(0,B.Z)("View Filters")),gV("div",{className:"ShowMailTipsAndTricks-descriptionContainer"},void 0,gV("div",{className:"ShowMailTipsAndTricks-descriptionSide"},void 0,gV("h3",{},void 0,(0,B.Z)("Select View Filter style:")),gV(ja.Z,{name:"maillistbuttonstips",value:this.props.prefValues[I.kMailListButtons],onChange:fV(I.kMailListButtons),className:"ShowMailTipsAndTricks-radioGroup"},void 0,gV("div",{className:"setting-single"},void 0,gV("label",{},void 0,IV,gV("span",{},void 0,(0,B.Z)("Text Menu"))),gV("div",{className:"text_menu"===this.props.prefValues[I.kMailListButtons]?"img-setting":"img-setting disabled"},void 0,gV("span",{className:"text_menu"===this.props.prefValues[I.kMailListButtons]?"mail-settings-image image alternate":"mail-settings-image image",dangerouslySetInnerHTML:{__html:Wi.yYJ}}))),gV("div",{className:"setting-single"},void 0,gV("label",{},void 0,TV,gV("span",{},void 0,(0,B.Z)("Icons Only"))),gV("div",{className:"icons_only"===this.props.prefValues[I.kMailListButtons]?"img-setting":"img-setting disabled"},void 0,gV("span",{className:"icons_only"===this.props.prefValues[I.kMailListButtons]?"mail-settings-image image alternate":"mail-settings-image image",dangerouslySetInnerHTML:{__html:Wi.EO4}}))))),gV("div",{className:"ShowMailTipsAndTricks-descriptionSide"},void 0,gV("p",{},void 0,(0,B.Z)("They are Show Read, Show Custom IMAP folders, Show Mailing Lists, Show Feeds, Show Junk, and Show Deleted.")),gV("p",{},void 0,(0,B.Z)("For global views, such as the Unread view, you can quickly filter out messages that have already been dealt with (like read messages) or sorted (like e-mail in other folders than your Inbox).")),gV("a",{href:i,onClick:()=>c.ZP.openURL(e,i)},void 0,(0,B.Z)("Learn more about View Filters"))))]});case"feeds":const s="https://help.vivaldi.com/mail/mail-feeds/feeds/";return(0,ss.jsxs)(ss.Fragment,{children:[gV("h1",{className:"ShowMailTipsAndTricks-title"},void 0,(0,B.Z)("Mail Tips & Tricks")),gV("h2",{className:"ShowMailTipsAndTricks-subtitle"},void 0,(0,B.Z)("Feeds")),gV("div",{className:"ShowMailTipsAndTricks-descriptionContainer"},void 0,gV("span",{className:"ShowMailTipsAndTricks-icon",dangerouslySetInnerHTML:{__html:Wi.ooy}}),gV("div",{className:"ShowMailTipsAndTricks-descriptionSide"},void 0,gV("p",{},void 0,(0,B.Z)("That’s right, we have a Feed reader built into our email client!")),gV("p",{},void 0,(0,B.Z)("You can add feeds directly in the Mail Panel, or use the standalone Feeds panel.")),gV("a",{href:s,onClick:()=>c.ZP.openURL(e,s)},void 0,(0,B.Z)("Learn more about the Feed reader"))))]});case"final":const o="https://help.vivaldi.com/mail/#mail-get-started";return(0,ss.jsxs)(ss.Fragment,{children:[gV("h1",{className:"ShowMailTipsAndTricks-title"},void 0,(0,B.Z)("Mail Tips & Tricks")),gV("h2",{className:"ShowMailTipsAndTricks-subtitle"},void 0,(0,B.Z)("Get all the help you need")),gV("div",{className:"ShowMailTipsAndTricks-descriptionContainer"},void 0,gV("span",{className:"ShowMailTipsAndTricks-icon",dangerouslySetInnerHTML:{__html:Wi.Kuf}}),gV("div",{className:"ShowMailTipsAndTricks-descriptionSide"},void 0,gV("p",{},void 0,(0,B.Z)("Want more tips and tricks? Our Help pages contain all the documentation you need.")),gV("p",{},void 0,(0,B.Z)("Visit our Help pages for Mail.")),gV("a",{href:o,onClick:()=>c.ZP.openURL(e,o)},void 0,(0,B.Z)("Learn more about Vivaldi Mail"))))]});default:return null}}getNextState=()=>{const e=this.SM.indexOf(this.state.current),t=this.SM[e+1];this.setState({current:t})};openMail=async()=>{const e=this.context.vivaldiWindowId;this.props.onClose&&this.props.onClose(),jn.Z.showContent(e,"PanelMail",{setFocus:!0,selectId:"",reason:""});const t=await i.Z.tabs.query({windowType:"normal"}),n=await t.find((e=>e.url?.startsWith(pn.xy.mailpage)));n?i.Z.windows.update(n.windowId,{focused:!0},(()=>{i.Z.tabs.update(n.id,{active:!0})})):de.Z.showMail(e),d.Z.selectFolder({name:(0,B.Z)("Unread"),accountId:It.of,path:It.tB,id:It.w1+"_"+It.tB})};render(){return gV("div",{className:Fi()("ShowMailTipsAndTricks",this.props.isSettings&&"ShowMailTipsAndTricks--inSettings")},void 0,this.renderState(this.context.vivaldiWindowId),gV("div",{className:Fi()("ShowMailTipsAndTricks-buttonContainer",this.props.isSettings&&"ShowMailTipsAndTricks-buttonContainer--inSettings")},void 0,gV("div",{className:"ShowMailTipsAndTricks-buttonCenter"},void 0,"final"!==this.state.current&&gV("input",{type:"submit",className:"ShowMailTipsAndTricks-button",value:"start"===this.state.current?(0,B.Z)("Show me tips and tricks"):(0,B.Z)("Next tip"),onClick:this.getNextState}),"start"===this.state.current&&gV("input",{type:"button",className:"ShowMailTipsAndTricks-button",value:(0,B.Z)("Add another account"),onClick:this.props.onCreateItem}),!this.props.isSettings&&gV("input",{type:"button",className:"ShowMailTipsAndTricks-button",value:(0,B.Z)("Open Vivaldi Mail"),onClick:this.openMail}),"final"===this.state.current&&this.props.isSettings&&gV("input",{type:"button",className:"ShowMailTipsAndTricks-button",value:(0,B.Z)("mail","Done"),onClick:()=>this.props.onClose&&this.props.onClose()}))))}}const EV=(0,Bu.Z)(ZV,mV);var kV;function _V(e,t,n,i){kV||(kV="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:kV,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class NV extends Li.PureComponent{constructor(e){if(super(e),e.children instanceof Array){const t=e.children[0];this.state={selectedTabId:e.activeTabId||t.props.id}}}componentDidUpdate(e){e.activeTabId!==this.props.activeTabId&&this.setState({selectedTabId:this.props.activeTabId})}onTabClick=e=>{this.props.onTabClick&&this.props.onTabClick(e),this.setState({selectedTabId:e})};render(){const{children:e,icons:t}=this.props,n=this.state.selectedTabId;return e instanceof Array&&e.length>1?_V("div",{className:[this.props.className,"TabbedView"].join(" ")},void 0,_V("nav",{className:"TabbedView-List",role:"tablist"},void 0,e.map(((e,i)=>{const{id:s,label:o,className:a}=e.props;return _V("button",{"aria-selected":s===n?"true":"false",type:"button",role:"tab",className:Fi()(s===n&&"active",a),onMouseDown:e=>e.preventDefault(),onClick:()=>this.onTabClick(s),dangerouslySetInnerHTML:{__html:(t?t[i]:"")+o}},s)}))),e.map((e=>{if(e.props.id===n)return _V("div",{className:"TabbedView-Content",role:"tabpanel","aria-labelledby":e.props.id},e.props.id,e.props.children)}))):(console.warn("TabbedView error: expecting multiple TabGroupEntries"),null)}}const PV=NV;var DV;function MV(e,t,n,i){DV||(DV="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:DV,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const{VERIFYING:OV,OK:xV,ERROR:LV,OFFLINE:RV}=It.In,BV={"Sender Name":(0,B.Z)("Sender Name"),"Account Display Name":(0,B.Z)("Account Display Name"),"Sync Options":(0,B.Z)("Sync Options"),Signature:(0,B.Z)("Signature"),"Download messages for offline viewing and better search results.":(0,B.Z)("Download messages for offline viewing and better search results."),"Take Account Offline":(0,B.Z)("Take Account Offline"),"Upload Sent Messages to Sent Folder":(0,B.Z)("Upload Sent Messages to Sent Folder"),"Update Account":(0,B.Z)("Update Account"),Aliases:(0,B.Z)("Aliases"),Identity:(0,B.Z)("Identity"),Servers:(0,B.Z)("Servers"),Tips:(0,B.Z)("Tips"),"Name and signature":(0,B.Z)("Name and signature"),"Add a sender name and signature for this account.":(0,B.Z)("Add a sender name and signature for this account."),"Enable Rich Text and Images":(0,B.Z)("Enable Rich Text and Images"),"Replied Messages":(0,B.Z)("Replied Messages"),"Forwarded Messages":(0,B.Z)("Forwarded Messages"),...ZU,...cV};class FV extends Li.PureComponent{_isMounted=!1;_hasVerified=!1;constructor(e){super(e),this.state={status:xV,statusText:"",accountSettings:this.props.accountSettings,incomingVerified:!1,smtpVerified:!1,userVerified:!1,view:"identity"}}static getDerivedStateFromProps(e,t){return e.accountSettings.MAIL_EMAIL!==t.accountSettings.MAIL_EMAIL?{accountSettings:e.accountSettings}:null}componentDidMount(){this._isMounted=!0}componentWillUnmount(){this._isMounted=!1}async verify(e){if(e.offline)this.setState({status:RV,statusText:(0,B.Z)("mail","Offline")});else try{this.setState({status:OV,statusText:(0,B.Z)("Verifying..."),incomingVerified:!1,smtpVerified:!1,userVerified:!1}),await jt.Z.verify(e);if(await function(e){const t=(0,nk.BB)(e);return new Promise((e=>{se.Z.mailPrivate.getFileDirectory(t,(t=>{i.Z.runtime.lastError?e():e(t)}))}))}(e.MAIL_EMAIL)||GU(e.MAIL_EMAIL),!this._isMounted)return;this.setState({status:xV,statusText:(0,B.Z)("Verified"),incomingVerified:!0,smtpVerified:!0,userVerified:!0})}catch(t){if(!this._isMounted)return void nn.Z.error("Mail",["EditMailAccount"],t);const n="string"==typeof e.MAIL_SERVER&&e.MAIL_SERVER.length>3,i="string"==typeof e.MAIL_SMTP_SERVER&&e.MAIL_SMTP_SERVER.length>3;this.setState({status:LV,statusText:t.message||t,incomingVerified:n&&!isNaN(e.MAIL_PORT),smtpVerified:i&&!isNaN(e.MAIL_SMTP_PORT),userVerified:!1})}}saveAccount=async()=>{const e=this.props.accountSettings,t=this.state.accountSettings;e&&((0,Od.ZP)(t,e),(0,KU.q1)(e,t)&&(await this.verify(t),zU(t,e)))};setAccountProperty=(e,t)=>{"MAIL_PORT"===e||"MAIL_SMTP_PORT"===e?this.setState((n=>({accountSettings:{...n.accountSettings,[e]:Number(t)}}))):this.setState((n=>({accountSettings:{...n.accountSettings,[e]:t}})))};autoSetAccountProperty=(e,t)=>{t!==this.props.accountSettings[e]&&this.setState((n=>({accountSettings:{...n.accountSettings,[e]:t}})),(()=>{(0,Od.ZP)(this.state.accountSettings,this.props.accountSettings),"preFetch"===e&&"none"!==t&&setTimeout((()=>Yt.Z.preFetch(this.state.accountSettings.MAIL_EMAIL)),200)}))};autoSaveAccountProperty=e=>{const{name:t,value:n}=e.target;this.autoSetAccountProperty(t,n)};autoSaveCheckboxAccountProperty=e=>{const{name:t,checked:n}=e.target;this.autoSetAccountProperty(t,n)};areNonAutosavedPropertiesSame=()=>{const e=this.props.accountSettings,t=this.state.accountSettings;return t.MAIL_EMAIL===e.MAIL_EMAIL&&t.MAIL_PASSWORD===e.MAIL_PASSWORD&&t.MAIL_PORT===e.MAIL_PORT&&t.MAIL_SERVER===e.MAIL_SERVER&&t.MAIL_SMTP_PASSWORD===e.MAIL_SMTP_PASSWORD&&t.MAIL_SMTP_PORT===e.MAIL_SMTP_PORT&&t.MAIL_SMTP_SERVER===e.MAIL_SMTP_SERVER&&t.MAIL_SMTP_USER===e.MAIL_SMTP_USER&&t.MAIL_USER===e.MAIL_USER&&t.popDeletion===e.popDeletion&&t.useOAuth===e.useOAuth&&t.MAIL_SMTP_SOCKET_TYPE===e.MAIL_SMTP_SOCKET_TYPE};toggleOffline=e=>{const{checked:t}=e.target,{offline:n}=this.state.accountSettings;this.setState((e=>({accountSettings:{...e.accountSettings,offline:t}})),(()=>{(0,Od.HV)(this.state.accountSettings),n&&!t?(this._hasVerified=!1,this.setViewType("servers")):!n&&t&&this.setState({status:RV,statusText:(0,B.Z)("mail","Offline")})}))};toggleUploadSent=e=>{const{checked:t}=e.target;this.setState((e=>({accountSettings:{...e.accountSettings,uploadSent:t}})),(()=>{(0,Od.HV)(this.state.accountSettings)}))};toggleSignatureRichText=e=>{const{checked:t}=e.target;this.setState((e=>({accountSettings:{...e.accountSettings,isSignatureRichText:t}})),(()=>{(0,Od.HV)(this.state.accountSettings)}))};setViewType=e=>{"servers"!==e||this._hasVerified||(this._hasVerified=!0,this.verify(this.state.accountSettings)),this.setState({view:e})};render(){const e=this.props.showTips,t=this.state.accountSettings,n=t.accountType===It.s9.POP,i=this.state.status===LV?"error":this.state.status===xV?"success":"info";return MV("div",{className:"detail"},void 0,e&&MV("div",{className:"tips"},void 0,MV("h2",{},void 0,BV["Name and signature"]),MV("p",{className:"mail-setup-description"},void 0,BV["Add a sender name and signature for this account."])),MV(PV,{icons:["",this.state.status===LV?Wi.viW:"","",""],onTabClick:this.setViewType,activeTabId:this.state.view,className:e?"hide-navigation":""},void 0,MV("div",{id:"identity",label:BV.Identity},void 0,MV("div",{className:"setting-group"},void 0,MV("div",{className:"setting-single"},void 0,MV("h3",{},void 0,BV["Sender Name"]),MV(Vl.Z,{type:"text",onChange:this.autoSaveAccountProperty,name:"MAIL_NAME",label:"",placeholder:"John Doe",value:t.MAIL_NAME?t.MAIL_NAME:""})),MV("div",{className:"setting-single"},void 0,MV("h3",{},void 0,BV["Account Display Name"]),MV(Vl.Z,{type:"text",onChange:this.autoSaveAccountProperty,name:"displayName",label:"",placeholder:"My Home Mail Account",value:t.displayName?t.displayName:""}))),MV("div",{className:"setting-group"},void 0,!n&&(0,ss.jsxs)(ss.Fragment,{children:[MV("h3",{},void 0,BV["Sync Options"]),MV("div",{className:"setting-single info"},void 0,BV["Download messages for offline viewing and better search results."]),MV("div",{className:"setting-single"},void 0,MV("label",{className:"setting-single",title:(0,B.Z)("Full messages are not downloaded and stored locally until they are selected and opened or if they were sent within the time limit set here. More locally stored messages mean more accurate search results.")},void 0,MV("div",{className:"setting-single"},void 0,MV(ta.Z,{name:"preFetch",value:t.preFetch,onChange:this.autoSaveAccountProperty,disabled:t.offline},void 0,MV("option",{value:"none"},void 0,(0,B.Z)("Opened messages")),MV("option",{value:"day"},void 0,(0,B.Z)("A day")),MV("option",{value:"week"},void 0,(0,B.Z)("A week")),MV("option",{value:"month"},void 0,(0,B.Z)("A month")),MV("option",{value:"year"},void 0,(0,B.Z)("A year")),MV("option",{value:"all"},void 0,(0,B.Z)("All messages"))))))]}),!n&&MV("label",{className:"setting-single",title:(0,B.Z)("Some mail servers (e.g. Outlook), will create a copy of the sent message in its Sent folder. It is only for such cases that this should be unchecked")},void 0,MV("input",{type:"checkbox",checked:t.uploadSent??!0,onChange:this.toggleUploadSent,disabled:t.offline}),MV("span",{},void 0,BV["Upload Sent Messages to Sent Folder"])),n&&MV(VU,{popMaxSize:t.popMaxSize,setAccountProperty:this.autoSetAccountProperty}),MV("label",{className:"setting-single",title:(0,B.Z)("Account will no longer try connecting to a server to fetch new messages")},void 0,MV("input",{type:"checkbox",checked:!!t.offline&&t.offline,onChange:this.toggleOffline}),MV("span",{},void 0,BV["Take Account Offline"]))),MV("div",{className:"setting-group-double"},void 0,MV("h3",{},void 0,BV.Signature),MV("div",{className:"mail-signature"},void 0,t.isSignatureRichText?MV(aV,{onChange:e=>this.autoSetAccountProperty("signature",e),signature:t.signature||"",emailAddress:t.MAIL_EMAIL}):MV(Vl.Z,{type:"textarea",rows:"4",onChange:this.autoSaveAccountProperty,name:"signature",label:"",placeholder:void 0===t.signature?lV.F:"",value:t.signature||""}),MV("div",{className:"mail-signature-footer"},void 0,MV("div",{className:"mail-signature-footer-sidebar"},void 0,MV("h3",{},void 0,(0,B.Z)("Include Signature in:")),MV("label",{},void 0,MV("input",{type:"checkbox",name:"signatureReply",checked:void 0===t.signatureReply||t.signatureReply,onChange:this.autoSaveCheckboxAccountProperty}),MV("span",{},void 0,BV["Replied Messages"])),MV("label",{},void 0,MV("input",{type:"checkbox",name:"signatureForward",checked:!!t.signatureForward,onChange:this.autoSaveCheckboxAccountProperty}),MV("span",{},void 0,BV["Forwarded Messages"]))),MV("div",{},void 0,MV(ta.Z,{value:t.signaturePosition||"below",onChange:this.autoSaveAccountProperty,name:"signaturePosition",title:(0,B.Z)("Placement of signature")},void 0,MV("option",{value:"above"},void 0,(0,B.Z)("Place Signature at Top")),MV("option",{value:"below"},void 0,(0,B.Z)("Place Signature at Bottom")))),MV("div",{},void 0,MV("label",{},void 0,MV("input",{type:"checkbox",checked:!!t.isSignatureRichText,onChange:this.toggleSignatureRichText}),MV("span",{},void 0,BV["Enable Rich Text and Images"])))))),e&&MV("div",{className:"setting-group setting-group-double pad-top"},void 0,MV("input",{type:"submit",value:(0,B.Z)("Continue"),onClick:()=>e()}))),MV("div",{id:"servers",label:BV.Servers,className:this.state.status===LV?"error":""},void 0,MV("form",{onSubmit:this.saveAccount},void 0,MV(NU,{disabled:t.useOAuth,account:t,incomingVerified:this.state.incomingVerified,showErrors:this.state.status===LV,smtpVerified:this.state.smtpVerified,userVerified:this.state.userVerified,setAccountProperty:this.setAccountProperty,searchableStrings:BV}),n&&MV(RU,{account:t,setAccountProperty:this.setAccountProperty}),MV("div",{className:"setting-group-double"},void 0,this.state.statusText&&MV(To,{type:i},void 0,this.state.statusText),MV("input",{type:"submit",value:(0,B.Z)("Update Account"),disabled:this.areNonAutosavedPropertiesSame()||this.state.status===OV})))),MV("div",{id:"aliases",label:BV.Aliases},void 0,MV(pV,{aliases:t.aliases||[],setAliases:this.autoSetAccountProperty.bind(this,"aliases"),searchableStrings:BV,defaultSignature:t.signature,defaultName:t.MAIL_NAME,defaultEmail:t.MAIL_EMAIL})),MV("div",{id:"tips",label:BV.Tips},void 0,MV(EV,{onCreateItem:()=>{},onClose:()=>this.setState({view:"identity"}),isSettings:this.props.isSettings}))))}}const WV=FV;var UV;function VV(e,t,n,i){UV||(UV="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:UV,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class HV extends Li.PureComponent{state={deleteFiles:!1,deletePasswords:!0};_isMounted=!1;_isSyncingPasswords=!1;componentDidMount(){this._isMounted=!0,this.getSyncStateForPasswords()}componentWillUnmount(){this._isMounted=!1}getSyncStateForPasswords(){se.Z.sync.getEngineState((e=>{const t=e.dataTypes.find((e=>"passwords"===e.dataType));this._isSyncingPasswords=t?.enabled||!1,this._isMounted&&this.setState({deletePasswords:!1})}))}async onSubmit(e){const t=this.props.item,{MAIL_EMAIL:n,accountType:i}=t;e.preventDefault(),(0,Od.HV)({...t,isDeleted:!0}),d.Z.removeAccount(n,this.state.deleteFiles,this.state.deletePasswords,i),this.props.onClose()}onChangeFileDeletion(){this.setState((e=>({deleteFiles:!e.deleteFiles})))}onChangePasswordDeletion(){this.setState((e=>({deletePasswords:!e.deletePasswords})))}render(){const{MAIL_EMAIL:e,useOAuth:t}=this.props.item;return VV("form",{onSubmit:e=>this.onSubmit(e)},void 0,VV("header",{className:"dialog-double-header"},void 0,VV("div",{className:"header-icon",dangerouslySetInnerHTML:{__html:Wi.Si$.large}}),VV("h1",{className:"dialog-title"},void 0,(0,B.Z)("Delete Account $1",[e]))),!t&&this._isSyncingPasswords&&VV("div",{className:"dialog-content"},void 0,VV("label",{},void 0,VV("input",{autoFocus:!0,type:"checkbox",checked:this.state.deletePasswords,onChange:e=>this.onChangePasswordDeletion()}),(0,B.Z)("Delete email passwords from settings")),VV("p",{className:"info"},void 0,(0,B.Z)("If checked, other instances and devices using the same sync account and Vivaldi Mail will sign out from this account."))),VV("div",{className:"dialog-content"},void 0,VV("label",{},void 0,VV("input",{autoFocus:!0,type:"checkbox",checked:this.state.deleteFiles,onChange:e=>this.onChangeFileDeletion()}),(0,B.Z)("Also delete message files from disk")),VV("p",{className:"info"},void 0,(0,B.Z)("If checked, all message files for $1 will be deleted. Otherwise they will remain on disk.",[e]))),VV("footer",{className:"dialog-footer"},void 0,VV("input",{type:"submit",className:"danger",value:(0,B.Z)("verb","Delete"),autoFocus:!0}),VV("input",{type:"button",onClick:this.props.onClose,value:(0,B.Z)("Cancel")})))}}const GV=HV;var $V;function KV(e,t,n,i){$V||($V="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:$V,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const zV="/resources/vivaldi_mail_default.png",jV=n(89182);class YV extends Li.PureComponent{static contextType=ts.Z;_isMounted=!1;state={isCreating:!1,accounts:[],setupStep:"setup",missingAccountIds:[],isRestoringAccounts:!1};loadAccountsAndCapabilities=async e=>{const t=await iu.Z.loadAllAccounts();if(!this._isMounted)return;const n=function(e,t){let n=[];const i=Object.keys(t);return e.length>i.length&&(n=e.filter((e=>e.offline&&!e.isDeleted&&!i.some((t=>t===e.MAIL_EMAIL)))).map((e=>e.MAIL_EMAIL))),n}(t,vt.Z.getAccounts());if(t.length<this.state.accounts.length)this.setState({accounts:t,missingAccountIds:n});else{let i;e&&t.length>this.state.accounts.length&&(i="signature"),i?this.setState({accounts:t,setupStep:i,isCreating:!1,missingAccountIds:n}):this.setState({accounts:t,missingAccountIds:n})}};componentDidMount(){this._isMounted=!0,this.loadAccountsAndCapabilities()}componentWillUnmount(){this._isMounted=!1}componentDidUpdate(e){if(e.prefValues[I.kMailAccounts]!==this.props.prefValues[I.kMailAccounts]){const e=!0;this.loadAccountsAndCapabilities(e)}}renderListItem=(e,t)=>{const{name:n,displayName:i}=t;let s="";"string"!=typeof t.MAIL_EMAIL?nn.Z.warn("Mail",["Account Settings"],"Invalid mail address",JSON.stringify(t.MAIL_EMAIL)):s=t.MAIL_EMAIL.split("@")[1]??"";const o=t.isDeleted?(0,B.Z)("Deleting..."):t.displayName?t.MAIL_EMAIL:s;return KV(eM,{title:i||n,meta:o,iconPath:s,iconFallbackPath:zV})};onContextMenu=(e,t)=>{const n=this.state.accounts[e],i=n&&n.MAIL_EMAIL,s=(0,nk.BB)(i),o=[{handler:()=>hU(this.context.vivaldiWindowId,s),...(0,us.Z)("Reveal Data Folder")}];(0,cs.Z)(this.context,o)(t)};renderCreateListItem=()=>KV(eM,{title:(0,B.Z)("New Account"),meta:(0,B.Z)("Setup in progress..."),iconFallbackPath:zV,isCreating:!0});renderContent=(e,t)=>{const n=this.state.accounts[e];return KV(WV,{accountSettings:n,searchableStrings:t,isSettings:!0})};renderCreate=e=>KV(nV,{focusInput:!0,emptyAccounts:0===this.state.accounts.length,searchableStrings:e},"create");renderEmpty=e=>KV(nV,{emptyAccounts:!0,searchableStrings:e},"empty");remapAccounts=()=>this.state.accounts.map((e=>({...e,key:e.MAIL_EMAIL,name:e.MAIL_EMAIL})));deleteDialog=e=>(0,ss.jsx)(GV,{...e});onCreateItem=()=>{this.setState({isCreating:!0,setupStep:"setup"})};onCancelCreateItem=()=>{this.setState({isCreating:!1})};_restoreLostAccounts=async()=>{this.setState({isRestoringAccounts:!0}),await Bn(this.state.missingAccountIds),await this.loadAccountsAndCapabilities(),this._isMounted&&this.setState({isRestoringAccounts:!1})};render(){return this.state.missingAccountIds.length>0?KV("div",{className:"setting-group"},void 0,KV("div",{className:"setting-single"},void 0,KV("h3",{},void 0,(0,B.Z)("Database Error Detected")),KV("label",{title:(0,B.Z)("Offline accounts are missing from DB and need to be restored!")},void 0,KV("input",{type:"button",onClick:this._restoreLostAccounts,disabled:this.state.isRestoringAccounts,value:this.state.isRestoringAccounts?(0,B.Z)("Restoring Accounts ..."):(0,B.Z)("Restore Accounts")})))):KV(QD.Z,{title:(0,B.Z)("Mail Accounts"),addTipString:(0,B.Z)("Add account"),items:this.remapAccounts(),masterLayout:0,onRemove:Lr.Z,deleteDialog:this.deleteDialog,onContextMenu:this.onContextMenu,emptyListGraphic:jV,emptyListString:(0,B.Z)("No accounts added"),renderListItem:this.renderListItem,renderCreateListItem:this.renderCreateListItem,renderContent:this.renderContent,contentStrings:BV,isCreating:this.state.isCreating,onCreateItem:this.onCreateItem,onCancelCreateItem:this.onCancelCreateItem,renderCreate:this.renderCreate,className:"setting-mail-account",createStrings:JU,renderEmpty:this.renderEmpty,emptyStrings:JU,filter:this.props.filter})}}const XV=(0,Bu.Z)(YV,[I.kMailAccounts]);var QV;function qV(e,t,n,i){QV||(QV="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:QV,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const JV=new Map([["SET_FLAG",(0,B.Z)("Flag")],["ADD_LABEL",(0,B.Z)("Add label")],["REMOVE_LABEL",(0,B.Z)("Remove label")],["MARK_READ",(0,B.Z)("mail","Mark as read")],["MARK_AS_SPAM",(0,B.Z)("Mark as spam")],["ARCHIVE",(0,B.Z)("Move to Archive")]]);var eH=qV("hr",{},"separator"),tH=qV("hr",{},"separator");class nH extends Li.PureComponent{state={showCreateLabel:!1,showArchivingNotification:!1};onChangeType=e=>{const t=e.target.value;let n;"ADD_LABEL"===t?n={type:"ADD_LABEL",label:(0,Kf.A4)(this.props.trigger.label||"")}:"REMOVE_LABEL"===t?n={type:"REMOVE_LABEL",label:(0,Kf.A4)(this.props.trigger.label||"")}:"MARK_READ"===t?n={type:"MARK_READ"}:"SET_FLAG"===t?n={type:"SET_FLAG",flag:this.props.trigger.flag||It.T4.RED}:"MARK_AS_SPAM"===t?n={type:"MARK_AS_SPAM"}:"ARCHIVE"===t&&(C.Z.get(I.kMailAddArchiveFolder)||this.setState({showArchivingNotification:!0}),n={type:"ARCHIVE"}),n&&this.props.editTrigger(this.props.triggerIndex,n)};onChangeLabel=e=>{const t=e.target.value;if("addlabel"===t)return void this.setState({showCreateLabel:!0});switch(this.props.trigger.type){case"ADD_LABEL":const e={type:"ADD_LABEL",label:t};this.props.editTrigger(this.props.triggerIndex,e);break;case"REMOVE_LABEL":const n={type:"REMOVE_LABEL",label:t};this.props.editTrigger(this.props.triggerIndex,n)}};onChangeFlag=e=>{const t=e.target.value;if("SET_FLAG"===this.props.trigger.type){const e={type:"SET_FLAG",flag:t};this.props.editTrigger(this.props.triggerIndex,e)}};renderAction=()=>{switch(this.props.trigger.type){case"ADD_LABEL":case"REMOVE_LABEL":return this.renderLabel();case"SET_FLAG":return this.renderFlag();case"MARK_READ":case"MARK_AS_SPAM":case"ARCHIVE":return}};renderLabel=()=>{const e=yt.Z.getByAccountId(It.ut).sort(Kf.jp).map((e=>qV("option",{value:e.path},e.path,(0,UE.X)(e.path))));return e.push([eH,qV("option",{value:"addlabel"},"addlabel",(0,B.Z)("Add New Label"))]),qV(ta.Z,{className:"MailTriggerSelector-select",onChange:this.onChangeLabel,value:this.props.trigger.label||""},void 0,e)};renderFlag=()=>{const e=Af.Z.getStandardFlagList().map((e=>qV("option",{value:e},e,(0,rk.M)(e))));return e.push([tH,qV("option",{value:It.T4.CLEAR_FLAGS},It.T4.CLEAR_FLAGS,(0,rk.M)(It.T4.CLEAR_FLAGS))]),qV(ta.Z,{className:"MailTriggerSelector-select",onChange:this.onChangeFlag,value:this.props.trigger.flag||It.T4.RED},void 0,e)};onCustomLabelDlgClose=()=>(this.setState({showCreateLabel:!1}),Promise.resolve());onSetArchivingOption=e=>{e&&w.Z.set(I.kMailAddArchiveFolder,!0),this.setState({showArchivingNotification:!1})};render(){return(0,ss.jsxs)(ss.Fragment,{children:[qV("form",{className:"MailTriggerSelector"},void 0,qV(ta.Z,{className:"MailTriggerSelector-select",onChange:this.onChangeType,value:this.props.trigger.type},void 0,[...JV.keys()].map((e=>qV("option",{value:e},e,JV.get(e))))),this.renderAction(),!this.props.lastTrigger&&qV("input",{type:"button",onClick:this.props.removeTrigger.bind(this,this.props.triggerIndex),className:"MailTriggerSelector-button circular remove"}),qV("input",{type:"button",onClick:this.props.addTrigger,className:"MailTriggerSelector-button circular add"})),this.state.showCreateLabel&&qV(Yf,{onClose:this.onCustomLabelDlgClose,windowId:this.props.windowId,viewMode:"float"}),this.state.showArchivingNotification&&qV(FT,{title:(0,B.Z)("Move to Archive"),prompt:[(0,B.Z)("The setting 'Add Archive Folder if Missing' is currently turned off. Do you want to turn it on?")],positive:(0,B.Z)("Yes"),negative:(0,B.Z)("No"),onClose:this.onSetArchivingOption})]})}}const iH=nH;var sH;function oH(e,t,n,i){sH||(sH="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:sH,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const aH={"Mail Filter":(0,B.Z)("Mail Filter"),Search:(0,B.Z)("mail filters","Search"),Actions:(0,B.Z)("mail filters","Actions"),Save:(0,B.Z)("Save"),Name:(0,B.Z)("mail filters","Filter Name")};var rH=oH("span",{className:"MailSearchOptions-Dash"},void 0,"-");class lH extends Li.Component{refButton=Li.createRef();constructor(e){super(e);const{accountId:t,path:n,selectedName:i,name:s}=this.props.filter,o={accountId:t,path:n,name:i||s,id:xt.ZP.toFolderPath(this.props.filter.accountId,this.props.filter.path)};this.state={filter:this.props.filter,showDialog:!1,originalSelectedFolder:o,selectedFolderString:JSON.stringify(o)}}componentDidUpdate(e){e.filter!==this.props.filter&&this.setState({filter:this.props.filter})}updateName=e=>{const t=e.target.value;this.setState((0,v.Uy)((({filter:e})=>{e.name=t})))};updateFilter=e=>{const t=e.target.value;this.setState((0,v.Uy)((({filter:e})=>{e.name&&e.name!==e.filterValue.query||(e.name=t),e.filterValue.query=t})))};updateFilterCallback=(e,t)=>{this.setState((0,v.Uy)((({filter:n})=>{n.filterValue[e]=t})))};addQuery=(e,t)=>{this.setState((0,v.Uy)((({filter:t})=>{const n=xt.ZP.getAddedQuery(e),i=t.filterValue.query,s=i?i+" "+n:n;t.name&&t.name!==i||(t.name=s),t.filterValue.query=s})),(()=>t&&this.saveFilter()))};validate=e=>!(!e.filterValue||0===Object.keys(e.filterValue).length)||(this.setState({showDialog:!0}),!1);onClose=e=>{if(this.setState({showDialog:!1}),e){const e=!0;this.saveFilter(e)}};saveFilter=e=>{if(this.refButton.current?.onBeforeAddMailFilter())return;const t=function(e){const t={...e};if(t.filterValue){const e={...t.filterValue};""===e.query&&(delete e.query,t.filterValue=e)}if(t.triggers){const e=t.triggers.filter((e=>!Object.values(e).some((e=>!e))));0===e.length?delete t.triggers:t.triggers=e}return t}(this.state.filter);(e||this.validate(t))&&(t.name||(t.name=xt.ZP.generateFilterName()),void 0===t.id?d.Z.addFilter(t):t.id&&this.props.filter.id&&d.Z.putFilter(t,this.props.filter,!0))};getNewTrigger=()=>({type:"ADD_LABEL",label:""});addTrigger=()=>{const e=this.getNewTrigger();this.setState((0,v.Uy)((({filter:t})=>{t.triggers?t.triggers.push(e):t.triggers=[e]})))};removeTrigger=e=>{this.setState((0,v.Uy)((({filter:t})=>{const{triggers:n}=t;n&&(n.splice(e,1),0===n.length&&delete t.triggers)})))};editTrigger=(e,t)=>{this.setState((0,v.Uy)((({filter:n})=>{const{triggers:i}=n;i&&(i[e]=t)})))};selectSearchFolder=(e,t)=>{const n=yt.Z.getByFolderId([e.accountId,e.path]);n&&this.setState((0,v.Uy)((i=>{i.filter.selectedName=e.name,i.filter.selectedAccountId=e.accountId,i.filter.filterValue={...n.filterValue,attachments:i.filter.filterValue.attachments,sentDate:i.filter.filterValue.sentDate,sentDateEnd:i.filter.filterValue.sentDateEnd,query:i.filter.filterValue.query},i.selectedFolderString=t})))};selectSentDateEnd=e=>{this.selectSentDate(e,!0)};selectSentDate=(e,t=!1)=>{this.setState((0,v.Uy)((({filter:n})=>{"number"==typeof e?n.filterValue[t?"sentDateEnd":"sentDate"]=e:delete n.filterValue[t?"sentDateEnd":"sentDate"]})))};selectAttachments=e=>{this.setState((0,v.Uy)((({filter:t})=>{"number"==typeof e?t.filterValue.attachments=e:delete t.filterValue.attachments})))};render(){return oH("div",{className:"detail"},void 0,oH("div",{className:"detail-content"},void 0,oH("div",{className:"setting-group-double"},void 0,oH("div",{className:"setting-single"},void 0,oH(Vl.Z,{type:"text",onChange:this.updateName,label:this.props.searchableStrings.Name,value:this.state.filter.name||"",labelImportant:!0})),oH("div",{className:"setting-single"},void 0,oH(Wk,{filter:this.state.filter,selectedFolderString:this.state.selectedFolderString,selectSearchFolder:this.selectSearchFolder,originalSelectedFolder:this.state.originalSelectedFolder,isFilterManager:!0},this.state.filter.id)),oH("div",{className:"setting-flexgroup"},void 0,oH("div",{className:"setting-single-noflex"},void 0,oH(Gk,{title:(0,B.Z)("Start Date"),selectSentDate:this.selectSentDate,sentDate:this.state.filter.filterValue.sentDate},this.state.filter.filterValue.sentDate),rH,oH(Gk,{title:(0,B.Z)("End Date"),isEndDate:!0,selectSentDate:this.selectSentDateEnd,sentDate:this.state.filter.filterValue.sentDateEnd},this.state.filter.filterValue.sentDateEnd)),oH("div",{className:"setting-single-noflex"},void 0,oH(EE,{className:"MailSearchOptions-Attachments",attachments:this.state.filter.filterValue.attachments,selectAttachments:this.selectAttachments},this.state.filter.filterValue.attachments))),oH("div",{className:"setting-single"},void 0,oH(GZ,{settingsFilter:this.state.filter,settingsFilterCallback:this.updateFilterCallback},this.state.selectedFolderString||"new")),this.state.filter.filterValue.query&&oH("div",{className:"setting-single"},void 0,oH(Vl.Z,{type:"textarea",rows:"3",onChange:this.updateFilter,label:this.props.searchableStrings.Search,title:(0,B.Z)("Tokenized search through content, recipients, and subject field"),value:this.state.filter.filterValue.query||""})),oH("div",{className:"setting-single"},void 0,(0,ss.jsx)(IE,{ref:this.refButton,saveFilter:this.saveFilter,isEmpty:!this.state.filter.filterValue.query,onSubmit:this.addQuery,isSettings:!0,selectedMailAddresses:[]},this.state.filter.filterValue.query)),oH("div",{className:"setting-single"},void 0,oH("div",{className:"MailActionManagerEditor-mailTriggerSelectors"},void 0,this.state.filter.triggers?(0,ss.jsxs)(ss.Fragment,{children:[oH("h3",{},void 0,this.props.searchableStrings.Actions),this.state.filter.triggers.map(((e,t)=>oH(iH,{trigger:e,triggerIndex:t,removeTrigger:this.removeTrigger,addTrigger:this.addTrigger,editTrigger:this.editTrigger,lastTrigger:!1,windowId:this.props.windowId},t)))]}):oH("input",{type:"button",value:(0,B.Z)("Add Action"),onClick:this.addTrigger}))))),oH("div",{className:"detail-toolbar"},void 0,!this.state.filter.id&&oH("input",{type:"button",className:"primary",onClick:()=>this.saveFilter(),disabled:this.props.filter===this.state.filter,value:(0,B.Z)("Add Mail Filter")}),this.state.filter.id&&oH("input",{type:"button",className:"primary",onClick:()=>this.saveFilter(),disabled:this.props.filter===this.state.filter,value:(0,B.Z)("Update Mail Filter")}),oH("input",{type:"button",disabled:this.props.filter===this.state.filter,onClick:()=>{this.setState((e=>({filter:this.props.filter,selectedFolderString:JSON.stringify(e.originalSelectedFolder)})))},value:(0,B.Z)("Cancel")})),this.state.showDialog&&oH(FT,{title:(0,B.Z)("Missing search"),prompt:[(0,B.Z)("By not specifying any search parameters you are about to apply an action to all your messages. Would you like to proceed?")],positive:(0,B.Z)("Apply to All"),negative:(0,B.Z)("Cancel"),danger:!0,onRequestClose:()=>this.setState({showDialog:!1}),onClose:this.onClose}))}}const dH=lH;var cH;function uH(e,t,n,i){cH||(cH="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:cH,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const pH=[I.kMailAccounts,I.kMailIsTurnedOff],hH={"Filters added in the mail panel will appear here.":(0,B.Z)("Filters added in the mail panel will appear here.")};class gH extends Li.PureComponent{constructor(e){super(e),this.state={mailFilters:this.loadMailFilters()}}componentDidMount(){yt.Z.addListener(this.mailFiltersChanged)}componentWillUnmount(){yt.Z.removeListener(this.mailFiltersChanged)}mailFiltersChanged=()=>{const e=this.loadMailFilters();this.state.mailFilters.length===e.length&&this.state.mailFilters.every(((t,n)=>t===e[n]))||this.setState({mailFilters:e})};loadMailFilters=()=>yt.Z.getAll().filter((e=>e.accountId===It.Kz&&e.path!==It.ym)).map((e=>structuredClone(e)));remapMailFilters=e=>e.map(((e,t)=>({...e,key:String(t)})));renderListItem=e=>(0,ss.jsxs)(ss.Fragment,{children:[uH("span",{className:"item-icon",dangerouslySetInnerHTML:{__html:Wi.EnF.small}}),uH("div",{className:"item-title"},void 0,e)]});renderContent=(e,t)=>uH(dH,{searchableStrings:t,windowId:this.props.windowId,filter:this.state.mailFilters[e]},this.state.mailFilters[e].id);renderCreateListItem=()=>uH("div",{className:"item-title"},void 0,(0,B.Z)("New Filter"));renderCreate=e=>{const t=xt.ZP.getDefaultFilterForPath(It.of,It.ym),n={name:"",accountId:It.Kz,path:Math.random().toString(36).substring(2),selectedAccountId:t.accountId,selectedName:t.name,filterValue:{}};return uH(dH,{searchableStrings:e,windowId:this.props.windowId,filter:n},"new")};renderEmpty=e=>uH("div",{className:"detail"},void 0,uH("div",{className:"detail-content"},void 0,uH("p",{},void 0,e["Filters added in the mail panel will appear here."])));removeAt=e=>{const t=this.state.mailFilters[e];d.Z.removeFilter(t.id)};render(){return 0===this.props.prefValues[I.kMailAccounts].length||this.props.prefValues[I.kMailIsTurnedOff]?null:uH(QD.Z,{title:(0,B.Z)("Mail Filters and Actions"),dataAnchor:"mail_filters_and_actions",deleteTitle:(0,B.Z)("Delete Filter"),addTipString:(0,B.Z)("Add Mail Filter"),deleteTipString:(0,B.Z)("Delete Mail Filter"),masterLayout:1,items:this.remapMailFilters(this.state.mailFilters),onRemove:this.removeAt,renderListItem:this.renderListItem,renderContent:this.renderContent,contentStrings:aH,renderCreate:this.renderCreate,renderCreateListItem:this.renderCreateListItem,renderEmpty:this.renderEmpty,emptyStrings:hH,filter:this.props.filter,className:"setting-mail-filters"})}}const mH=(0,Bu.Z)(gH,pH);var fH;function vH(e,t,n,i){fH||(fH="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:fH,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const yH=[I.kMailLabelItemsOrder,I.kMailLabelItemsHide];class bH extends Li.PureComponent{constructor(e){super(e)}#Lt=()=>{let e=this.props.prefValues[I.kMailLabelItemsOrder];const t=yt.Z.getByAccountId(It.ut);if(e.length<1)e=ht.Z.getByAccountId(It.ut).sort(Kf.jp).map((e=>e.path)),w.Z.set(I.kMailLabelItemsOrder,e);else if(t.length!==e.length){const n=[...e];t.forEach((t=>{e.includes(t.path)||n.push(t.path)})),w.Z.set(I.kMailLabelItemsOrder,n)}const n=[];return e.forEach((e=>{const t=yt.Z.getByFolderId([It.ut,e]);t&&n.push(t)})),n.map((e=>({key:e.path,name:(0,UE.X)(e.path),...(0,us.Z)((0,UE.X)(e.path))})))};#Rt=(e,t)=>{const n=this.props.prefValues[I.kMailLabelItemsOrder].slice(),[i]=n.splice(e,1);n.splice(t,0,i),w.Z.set(I.kMailLabelItemsOrder,n)};#Re=e=>{const t=new Set(C.Z.get(I.kMailLabelItemsHide));t.has(e)?t.delete(e):t.add(e),w.Z.set(I.kMailLabelItemsHide,[...t])};#Bt=(e,t)=>{const{key:n,name:i}=t,s=!new Set(C.Z.get(I.kMailLabelItemsHide)).has(n);return(0,ss.jsxs)(ss.Fragment,{children:[vH("input",{type:"checkbox",value:n,checked:s,onChange:this.#Re.bind(this,n)}),i]})};render(){const e=this.#Lt();return vH("div",{className:"setting-single","data-anchor":"labels"},void 0,vH("h3",{},void 0,(0,B.Z)("Mail Label Order and Visibility")),vH("p",{className:"info"},void 0,(0,B.Z)("Hide, show and re-order Mail Labels.")),vH(lk.Z,{filter:this.props.filter,items:e,moveItem:this.#Rt,renderListItem:this.#Bt,supportDragAndDrop:!0,mimeType:"vivaldi/x-settings-quick-command-type"}))}}const SH=(0,Bu.Z)(bH,yH);var wH;function CH(e,t,n,i){wH||(wH="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:wH,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var AH=CH("input",{type:"radio",value:!0}),IH=CH("input",{type:"radio",value:!1});class TH extends Li.PureComponent{state={ignoredMailingLists:On.Z.getIgnored()};componentDidMount(){ht.Z.addListener(this.mailingListsChanged)}componentWillUnmount(){ht.Z.removeListener(this.mailingListsChanged)}mailingListsChanged=e=>{if("mailingLists"===e.target){const e=On.Z.getIgnored();if(this.state.ignoredMailingLists.length===e.length&&this.state.ignoredMailingLists.every(((t,n)=>t===e[n])))return;this.setState({ignoredMailingLists:e})}};remap=e=>e.map(((e,t)=>({name:e.listId,key:String(t)})));renderListItem=(e,t)=>CH("span",{title:t.listId},void 0,e);onRemove=e=>{d.Z.removeIgnoredMailingList(this.state.ignoredMailingLists[e])};onChangeIgnoreAll=e=>{const{value:t}=e.target,n="true"===t,i=On.Z.get(It.ZW);i&&i.isIgnored!==n&&(i.isIgnored=!i.isIgnored,d.Z.updateMailingListGroup(i))};render(){return CH("div",{className:"detail"},void 0,CH("div",{className:"detail-content"},void 0,CH("div",{className:"setting-group unlimited"},void 0,CH("h3",{},void 0,(0,B.Z)("Uncategorized mailing lists")),CH("p",{className:"info"},void 0,(0,B.Z)("Manage the rest of the mailing lists that have been automatically generated using the list-id attribute"))),CH(ja.Z,{name:"subFolderType",value:On.Z.areUncategorizedMailingListsIgnored(),onChange:this.onChangeIgnoreAll,className:"setting-group unlimited"},void 0,CH("div",{className:"setting-single"},void 0,CH("label",{},void 0,AH,CH("span",{},void 0,(0,B.Z)("mailinglist subfolder","Ignore All")))),CH("div",{className:"setting-single"},void 0,CH("label",{},void 0,IH,CH("span",{},void 0,(0,B.Z)("Ignore Selected"))))),CH("div",{className:"setting-single"},void 0,CH(lk.Z,{items:this.remap(this.state.ignoredMailingLists),renderListItem:this.renderListItem,filter:this.props.filter,deleteTipString:(0,B.Z)("Stop ignoring uncategorized mailing list"),supportDragAndDrop:!1,onRemove:this.onRemove}))))}}const ZH=TH;var EH;function kH(e,t,n,i){EH||(EH="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:EH,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const _H={Sender:(0,B.Z)("Sender"),"List ID":(0,B.Z)("List ID")};var NH=kH("input",{type:"radio",value:"true"}),PH=kH("input",{type:"radio",value:"false"}),DH=kH("hr",{});class MH extends Li.Component{state={mailingList:this.props.mailingList,updating:!1};componentDidUpdate(e){e.mailingList!==this.props.mailingList&&this.setState({mailingList:this.props.mailingList,updating:!1})}updateListId=e=>{const t=e.target.value;this.setState((0,v.Uy)((({mailingList:e})=>{e.listId===e.name&&(e.name=t),e.listId=t})))};updateName=e=>{const t=e.target.value;this.setState((0,v.Uy)((({mailingList:e})=>{e.name=t})))};onlyPathChanged=()=>Object.keys(this.state.mailingList).every((e=>"name"===e?this.state.mailingList[e]!==this.props.mailingList[e]:this.state.mailingList[e]===this.props.mailingList[e]));saveMailingList=async()=>{this.setState({updating:!0}),this.onlyPathChanged()?await d.Z.updateMailingListGroupName(this.state.mailingList):await d.Z.updateMailingListGroup(this.state.mailingList)};hasChanged=()=>this.state.mailingList!==this.props.mailingList;isIgnoredChanged=e=>{const t=e.target.value;this.setState((0,v.Uy)((({mailingList:e})=>{e.isIgnored="true"===t})))};onChangeSubfolderType=e=>{const t=e.target.value;this.setState((0,v.Uy)((({mailingList:e})=>{e.subFolderType=t})))};onChangeParentFolder=e=>{const t=e.target.value;this.setState((0,v.Uy)((({mailingList:e})=>{e.parentFolderType=t})))};cancel=()=>{this.setState({mailingList:this.props.mailingList})};render(){const e=this.state.mailingList;return kH("form",{className:"detail",style:{overflowY:"scroll"}},void 0,kH("div",{className:"detail-content"},void 0,kH("div",{className:"setting-group unlimited"},void 0,kH("h3",{},void 0,(0,B.Z)("Mailing List Group")),kH("p",{className:"info"},void 0,(0,B.Z)("Group your autogenerated mailing lists. When a match is found, the whole list ID is used to group messages."))),kH("div",{className:"setting-group unlimited"},void 0,kH("div",{className:"setting-single"},void 0,kH("label",{},void 0,this.props.searchableStrings["List ID"],kH(ta.Z,{name:"parentFolderType",value:e.parentFolderType,onChange:this.onChangeParentFolder},void 0,kH("option",{value:"endsWith"},void 0,(0,B.Z)("Ends with")),kH("option",{value:"startsWith"},void 0,(0,B.Z)("Starts with"))),kH("input",{type:"text",onChange:this.updateListId,value:e.listId,disabled:!this.props.isCreating}))),kH(ja.Z,{name:"mailcheckintervalgroup",value:e.isIgnored,onChange:this.isIgnoredChanged,className:"setting-single"},void 0,kH("div",{className:"setting-single"},void 0,kH("label",{},void 0,NH,kH("span",{},void 0,(0,B.Z)("Not a Mailing List")))),kH("div",{className:"setting-single"},void 0,kH("label",{},void 0,PH,kH("span",{},void 0,(0,B.Z)("A Mailing List"))))),kH("div",{className:"setting-single"},void 0,kH("label",{},void 0,kH("span",{},void 0,(0,B.Z)("Folder Name")),kH("input",{type:"text",onChange:this.updateName,disabled:e.isIgnored,value:e.name}))),kH("div",{className:"setting-single"},void 0,kH("label",{},void 0,kH("span",{},void 0,(0,B.Z)("Subfolder Grouping")),kH(ta.Z,{disabled:e.isIgnored,name:"subFolderType",value:e.subFolderType,onChange:this.onChangeSubfolderType},void 0,kH("option",{value:"none"},void 0,(0,B.Z)("mailinglist subfolder","None")),DH,kH("option",{value:"title"},void 0,(0,B.Z)("mailinglist subfolder","Subject (square brackets)")),kH("option",{value:"host"},void 0,(0,B.Z)("mailinglist subfolder","Sender Domain")),kH("option",{value:"senderName"},void 0,(0,B.Z)("mailinglist subfolder","Sender Name"))))),this.state.updating&&kH(To,{type:"info"},void 0,(0,B.Z)("Updating")))),kH("div",{className:"detail-toolbar"},void 0,!this.props.isCreating&&(0,ss.jsxs)(ss.Fragment,{children:[kH("input",{type:"submit",className:"primary",disabled:!this.hasChanged()||this.state.updating,onClick:this.saveMailingList,value:(0,B.Z)("Update Mailing List Group")}),kH("input",{type:"button",disabled:!this.hasChanged(),onClick:this.cancel,value:(0,B.Z)("Cancel")})]}),this.props.isCreating&&kH("input",{type:"submit",className:"primary",disabled:this.props.mailingList===this.state.mailingList||this.state.updating,onClick:this.saveMailingList,value:(0,B.Z)("Add Mailing List Group")})))}}const OH=MH;var xH;function LH(e,t,n,i){xH||(xH="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:xH,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const RH=[I.kMailAccounts,I.kMailIsTurnedOff],BH={"Mailing lists added in the mail panel will appear here.":(0,B.Z)("Mailing lists added in the mail panel will appear here.")};var FH=LH("svg",{className:"item-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16"},0,LH("path",{opacity:".35",d:"M0 3h8v1H0zM0 5h3v1H0zM0 7h3v1H0z"}),LH("path",{d:"M15 5H5a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1zm-1 4l-4 2-4-2V7l4 2 4-2z"}));class WH extends Li.PureComponent{constructor(e){super(e),this.state={mailingListGroups:this.getMailingLists()}}componentDidMount(){On.Z.addListener(this.mailingListGroupsChanged)}componentWillUnmount(){On.Z.removeListener(this.mailingListGroupsChanged)}mailingListGroupsChanged=()=>{const e=this.getMailingLists();this.state.mailingListGroups.length===e.length&&this.state.mailingListGroups.every(((t,n)=>t===e[n]))||this.setState({mailingListGroups:e})};getMailingLists=()=>On.Z.getGroups();remapMailingListGroups=e=>[...e,{name:"Uncategorized mailing lists",isDefault:!0}].map(((e,t)=>{let n=e.name;return e.listId&&n!==e.listId&&(n+=" ("+e.listId+")"),{...e,name:n,key:String(t)}}));getFavicon=e=>{if(e){const t=e.split("@");if(t&&2===t.length){const e=t[1].split(".");if(e&&e[1]&&e[1].length>1)return LH(Ri.ZP,{className:"item-icon",url:`${t[1]}`,loadType:"page"},0)}}return FH};renderListItem=(e,t)=>(0,ss.jsxs)(ss.Fragment,{children:["matches"!==t.parentFolderType&&this.getFavicon(t.listId),LH("div",{className:"item-title"},void 0,e)]});renderContent=(e,t)=>this.state.mailingListGroups.length===e?LH(ZH,{filter:this.props.filter}):LH(OH,{searchableStrings:t,mailingList:this.state.mailingListGroups[e]});renderEmpty=e=>LH("div",{className:"detail"},void 0,LH("div",{className:"detail-content"},void 0,LH("p",{},void 0,e["Mailing lists added in the mail panel will appear here."])));renderCreateListItem=()=>LH("div",{className:"item-title"},void 0,(0,B.Z)("New Mailing List Group"));renderCreate=e=>LH(OH,{isCreating:!0,searchableStrings:e,mailingList:{name:"",isIgnored:!1,subFolderType:"host",parentFolderType:"endsWith",listId:""}});removeAt=e=>{this.setState((t=>{const n=[...t.mailingListGroups],[i]=n.splice(e,1);return d.Z.removeMailingListGroup(i),{mailingListGroups:n}}))};render(){if(0===this.props.prefValues[I.kMailAccounts].length||this.props.prefValues[I.kMailIsTurnedOff])return null;const e=this.remapMailingListGroups(this.state.mailingListGroups);return LH(QD.Z,{title:(0,B.Z)("Mailing Lists"),className:"setting-mailing-lists",deleteTitle:(0,B.Z)("Delete List"),addTipString:(0,B.Z)("Add Mailing List"),deleteTipString:(0,B.Z)("Delete Mailing List"),items:e,onRemove:this.removeAt,masterLayout:1,renderListItem:this.renderListItem,renderContent:this.renderContent,contentStrings:_H,renderCreate:this.renderCreate,renderCreateListItem:this.renderCreateListItem,renderEmpty:this.renderEmpty,emptyStrings:BH,filter:this.props.filter},e.length)}}const UH=(0,Bu.Z)(WH,RH);var VH;function HH(e,t,n,i){VH||(VH="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:VH,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const GH=[I.kCalendarRelativeDates,I.kMailAccounts,I.kMailAddArchiveFolder,I.kMailAutoGenerateContacts,I.kMailAutoMarkAsRead,I.kMailCheckInterval,I.kMailComposerColors,I.kMailColorQuotedText,I.kMailIsTurnedOff,I.kMailMailtoInVivaldi,I.kMailCountersPanelArchiveEnabled,I.kMailCountersPanelDraftsEnabled,I.kMailCountersPanelJunkEnabled,I.kMailCountersPanelSwitcherEnabled,I.kMailCountersPanelTrashEnabled,I.kMailCountersPanelUnseenEnabled,I.kMailCountersStatusButtonEnabled,I.kMailDefaultAccount,I.kMailDeleteInOtherLocations,I.kMailImapLogsOn,I.kMailIncludeIdentifyingHeaders,I.kMailListButtons,I.kMailMarkDeleteInOtherLocations,I.kMailNotifications,I.kMailNotificationsOnSuccessfullySent,I.kMailNotificationsSoundOn,I.kMailPreferredRendering,I.kMailPanelActivityIndicatorsEnabled,I.kMailPanelShowErrorMessages,I.kMailShowUnsubscribed,I.kMailSingleClickTabs,I.kMailSmtpLogsOn,I.kMailSearchOnEnter,I.kMailSearchFolder,I.kMailSearchSortField,I.kMailSearchSortFieldSent,I.kMailShowQuickReply,I.kMailQuickReplyQuote,I.kMailMessageListPreview,I.kMailMessageListPreviewVerticalOnly,I.kMailMessageListJumpToLatest,I.kMailViewLayout,I.kMailDisplayMailPanelViewingMail,I.kMailOpenPanelAutomaticallyViewingMail,I.kMailPrefetchOnDemand],$H=w.Z.getEventHandler;var KH=HH("input",{type:"radio",value:"horizontal"}),zH=HH("input",{type:"radio",value:"vertical"}),jH=HH("input",{type:"radio",value:"vertical_wide"}),YH=HH("input",{type:"radio",value:"text_menu"}),XH=HH("input",{type:"radio",value:"icons_only"}),QH=HH("input",{type:"radio",value:"one_minute"}),qH=HH("input",{type:"radio",value:"fifteen_minutes"}),JH=HH("input",{type:"radio",value:"manual"}),eG=HH("input",{type:"radio",value:"prefer_html"}),tG=HH("input",{type:"radio",value:"plaintext"}),nG=HH("input",{type:"radio",value:"hide"}),iG=HH("input",{type:"radio",value:"minimize"}),sG=HH("input",{type:"radio",value:"show"}),oG=HH("input",{type:"radio",value:It.Y6}),aG=HH("input",{type:"radio",value:"black_on_white"}),rG=HH("input",{type:"radio",value:"inherit_themes"});function lG(e){const t=Li.useContext(ts.Z),n=(0,Ya.Z)(GH),[i,s]=Li.useState(!1);Li.useEffect((()=>{!async function e(){const t=(await tn.Z.systemTasks.toArray()).some((e=>"restore_mail_db"===e.taskName));s(t),t&&setTimeout(e,1e4)}()}),[]);if(i)return HH("div",{},void 0,HH("h1",{},void 0,(0,B.Z)("Mail Settings Unavailable")),HH("p",{},void 0,(0,B.Z)("Database being restored. See progress in Mail Status or Status Bar.")));const o=n[I.kMailAccounts].filter((e=>!e.offline));return(0,ss.jsxs)(ss.Fragment,{children:[!n[I.kMailIsTurnedOff]&&(0,ss.jsxs)(ss.Fragment,{children:[HH("section",{className:"setting-section"},void 0,HH(XV,{filter:e.filter})),HH(tN.Z,{categoryTitle:(0,B.Z)("Mail Settings"),filter:e.filter},void 0,HH("div",{className:"setting-group"},void 0,HH("div",{className:"setting-single"},void 0,HH("h3",{},void 0,(0,B.Z)("Message List Preview")),HH(ta.Z,{name:"messagelistpreview",value:n[I.kMailMessageListPreview],onChange:$H(I.kMailMessageListPreview)},void 0,HH("option",{value:"0"},void 0,(0,B.Z)("mail preview","None")),HH("option",{value:"1"},void 0,(0,B.Z)("1 line")),HH("option",{value:"2"},void 0,(0,B.Z)("2 lines")),HH("option",{value:"3"},void 0,(0,B.Z)("3 lines")))),HH("div",{className:"setting-single pad-top"},void 0,HH("label",{},void 0,HH("input",{type:"checkbox",checked:n[I.kMailMessageListPreviewVerticalOnly],onChange:$H(I.kMailMessageListPreviewVerticalOnly)}),HH("span",{},void 0,(0,B.Z)("Only Show Message Preview in Vertical View")))),HH("div",{className:"setting-single pad-top"},void 0,HH("label",{},void 0,HH("input",{type:"checkbox",checked:n[I.kMailPrefetchOnDemand],onChange:$H(I.kMailPrefetchOnDemand)}),HH("span",{},void 0,(0,B.Z)("Download Messages to Generate Previews on Demand"))))),HH("div",{className:"setting-group"},void 0,HH("h3",{},void 0,(0,B.Z)("Mail View Layout")),HH(ja.Z,{name:"mailviewgroup",value:n[I.kMailViewLayout],onChange:$H(I.kMailViewLayout)},void 0,HH("div",{className:"setting-single"},void 0,HH("label",{},void 0,KH,HH("span",{},void 0,(0,B.Z)("mail","Horizontal")))),HH("div",{className:"setting-single"},void 0,HH("label",{},void 0,zH,HH("span",{},void 0,(0,B.Z)("mail","Vertical")))),HH("div",{className:"setting-single"},void 0,HH("label",{},void 0,jH,HH("span",{},void 0,(0,B.Z)("Vertical Wide"))))),HH("div",{className:"setting-single pad-top"},void 0,HH("label",{},void 0,HH("input",{type:"checkbox",checked:n[I.kCalendarRelativeDates],onChange:$H(I.kCalendarRelativeDates)}),HH("span",{},void 0,(0,B.Z)("Use Relative Dates"))))),HH("div",{className:"setting-group"},void 0,HH("h3",{},void 0,(0,B.Z)("Message List Sorting")),HH("div",{},void 0,HH("p",{className:"info"},void 0,(0,B.Z)("Default order for sent folders")),HH("label",{},void 0,HH(ta.Z,{name:"mailsortfieldsent",value:n[I.kMailSearchSortFieldSent],onChange:$H(I.kMailSearchSortFieldSent)},void 0,HH("option",{value:"sender"},void 0,(0,B.Z)("mail","Sort by Recipient")),HH("option",{value:"subject"},void 0,(0,B.Z)("mail","Sort by Subject")),HH("option",{value:"sentDate"},void 0,(0,B.Z)("mail","Sort by Date Sent")),HH("option",{value:"threads"},void 0,(0,B.Z)("mail","Sort by Date (Threaded)"))))),HH("div",{},void 0,HH("p",{className:"info"},void 0,(0,B.Z)("Default order for other folders")),HH("label",{},void 0,HH(ta.Z,{name:"mailsortfield",value:n[I.kMailSearchSortField],onChange:$H(I.kMailSearchSortField)},void 0,HH("option",{value:"sender"},void 0,(0,B.Z)("mail","Sort by Sender")),HH("option",{value:"subject"},void 0,(0,B.Z)("mail","Sort by Subject")),HH("option",{value:"sentDate"},void 0,(0,B.Z)("mail","Sort by Date Received")),HH("option",{value:"threads"},void 0,(0,B.Z)("mail","Sort by Date (Threaded)"))))),HH("div",{className:"setting-single pad-top"},void 0,HH("label",{},void 0,HH("input",{type:"checkbox",checked:n[I.kMailMessageListJumpToLatest],onChange:$H(I.kMailMessageListJumpToLatest)}),HH("span",{},void 0,(0,B.Z)("Show Jump to Latest"))))),HH("div",{className:"setting-group"},void 0,HH("h3",{},void 0,(0,B.Z)("Mail Notifications")),HH("div",{className:"setting-single"},void 0,HH("label",{},void 0,HH("input",{type:"checkbox",checked:n[I.kMailNotifications],onChange:$H(I.kMailNotifications)}),HH("span",{},void 0,(0,B.Z)("mail","Enabled")))),HH("div",{className:"setting-single pad-left"},void 0,HH("label",{},void 0,HH("input",{type:"checkbox",checked:n[I.kMailNotificationsSoundOn],disabled:!n[I.kMailNotifications],onChange:$H(I.kMailNotificationsSoundOn)}),HH("span",{},void 0,(0,B.Z)("mail","Play Sound")))),HH("div",{className:"setting-single"},void 0,HH("label",{},void 0,HH("input",{type:"checkbox",checked:n[I.kMailNotificationsOnSuccessfullySent],disabled:!n[I.kMailNotifications],onChange:$H(I.kMailNotificationsOnSuccessfullySent)}),HH("span",{},void 0,(0,B.Z)("Notify on Successfully Sent"))))),HH("div",{className:"setting-group"},void 0,HH("h3",{},void 0,(0,B.Z)("Unseen Messages")),HH("p",{className:"info"},void 0,(0,B.Z)("Highlight unread messages that have not been seen since the last check.")),HH("div",{className:"setting-single"},void 0,HH("label",{},void 0,HH("input",{type:"checkbox",checked:n[I.kMailCountersPanelUnseenEnabled],onChange:$H(I.kMailCountersPanelUnseenEnabled)}),HH("span",{},void 0,(0,B.Z)("Highlight and Count Unseen Messages"))))),HH("div",{className:"setting-group"},void 0,HH("h3",{},void 0,(0,B.Z)("Unread Messages")),HH("div",{className:"setting-single"},void 0,HH("label",{},void 0,HH("input",{type:"checkbox",checked:n[I.kMailAutoMarkAsRead],onChange:$H(I.kMailAutoMarkAsRead)}),HH("span",{},void 0,(0,B.Z)("Automatically Mark as Read"))))),HH("div",{className:"setting-group"},void 0,HH("h3",{},void 0,(0,B.Z)("Filter View Buttons")),HH(ja.Z,{name:"maillistbuttons",value:n[I.kMailListButtons],onChange:$H(I.kMailListButtons)},void 0,HH("div",{className:"setting-single"},void 0,HH("label",{},void 0,YH,HH("span",{},void 0,(0,B.Z)("Text Menu"))),HH("div",{className:"text_menu"===n[I.kMailListButtons]?"img-setting":"img-setting disabled"},void 0,HH("span",{className:"text_menu"===n[I.kMailListButtons]?"mail-settings-image image alternate":"mail-settings-image image",dangerouslySetInnerHTML:{__html:Wi.yYJ}}))),HH("div",{className:"setting-single"},void 0,HH("label",{},void 0,XH,HH("span",{},void 0,(0,B.Z)("Icons Only"))),HH("div",{className:"icons_only"===n[I.kMailListButtons]?"img-setting":"img-setting disabled"},void 0,HH("span",{className:"icons_only"===n[I.kMailListButtons]?"mail-settings-image image alternate":"mail-settings-image image",dangerouslySetInnerHTML:{__html:Wi.EO4}}))))),HH("div",{className:"setting-group"},void 0,HH("div",{className:"setting-single"},void 0,HH("h3",{},void 0,(0,B.Z)("Mail Search")),HH("label",{},void 0,HH("input",{type:"checkbox",checked:n[I.kMailSearchOnEnter],onChange:$H(I.kMailSearchOnEnter)}),HH("span",{},void 0,(0,B.Z)("Start Search Using Enter Key")))),HH("div",{className:"setting-single pad-top"},void 0,HH("h3",{},void 0,(0,B.Z)("Default Search Folder")),HH(ta.Z,{name:"mailsearchfoldergroup",value:n[I.kMailSearchFolder],onChange:$H(I.kMailSearchFolder)},void 0,HH("option",{value:"all"},void 0,(0,B.Z)("All Messages")),HH("option",{value:"current"},void 0,(0,B.Z)("Current Folder"))))),HH("div",{className:"setting-group"},void 0,HH("h3",{},void 0,(0,B.Z)("Mailto Links")),HH("div",{className:"setting-single"},void 0,HH("label",{},void 0,HH("input",{type:"checkbox",checked:n[I.kMailMailtoInVivaldi],onChange:$H(I.kMailMailtoInVivaldi)}),HH("span",{},void 0,(0,B.Z)("Handle Mailto Links in Vivaldi Mail"))))),HH("div",{className:"setting-group"},void 0,HH("h3",{},void 0,(0,B.Z)("Mail Counters")),HH("div",{className:"setting-single"},void 0,HH("label",{},void 0,HH("input",{type:"checkbox",checked:n[I.kMailCountersStatusButtonEnabled],onChange:$H(I.kMailCountersStatusButtonEnabled)}),HH("span",{},void 0,(0,B.Z)("Show on Status Button")))),HH("div",{className:"setting-single"},void 0,HH("label",{},void 0,HH("input",{type:"checkbox",checked:n[I.kMailCountersPanelSwitcherEnabled],onChange:$H(I.kMailCountersPanelSwitcherEnabled)}),HH("span",{},void 0,(0,B.Z)("Show on Panel Button")))),HH("div",{className:"setting-single"},void 0,HH("label",{},void 0,HH("input",{type:"checkbox",checked:n[I.kMailCountersPanelTrashEnabled],onChange:$H(I.kMailCountersPanelTrashEnabled)}),HH("span",{},void 0,(0,B.Z)("Include Trash Messages")))),HH("div",{className:"setting-single"},void 0,HH("label",{},void 0,HH("input",{type:"checkbox",checked:n[I.kMailCountersPanelJunkEnabled],onChange:$H(I.kMailCountersPanelJunkEnabled)}),HH("span",{},void 0,(0,B.Z)("Include Spam Messages")))),HH("div",{className:"setting-single"},void 0,HH("label",{},void 0,HH("input",{type:"checkbox",checked:n[I.kMailCountersPanelArchiveEnabled],onChange:$H(I.kMailCountersPanelArchiveEnabled)}),HH("span",{},void 0,(0,B.Z)("Include Archive Messages")))),HH("div",{className:"setting-single"},void 0,HH("label",{},void 0,HH("input",{type:"checkbox",checked:n[I.kMailCountersPanelDraftsEnabled],onChange:$H(I.kMailCountersPanelDraftsEnabled)}),HH("span",{},void 0,(0,B.Z)("Include Draft Messages"))))),HH("div",{className:"setting-group"},void 0,HH("h3",{},void 0,(0,B.Z)("mail","Panel")),HH("div",{className:"setting-single"},void 0,HH("label",{},void 0,HH("input",{type:"checkbox",checked:n[I.kMailDisplayMailPanelViewingMail],onChange:$H(I.kMailDisplayMailPanelViewingMail)}),HH("span",{},void 0,(0,B.Z)("Display Mail Panel when Viewing Mail")))),HH("div",{className:"setting-single pad-left"},void 0,HH("label",{},void 0,HH("input",{type:"checkbox",checked:n[I.kMailOpenPanelAutomaticallyViewingMail],disabled:!n[I.kMailDisplayMailPanelViewingMail],onChange:$H(I.kMailOpenPanelAutomaticallyViewingMail)}),HH("span",{},void 0,(0,B.Z)("Open Panel Automatically")))),HH("div",{className:"setting-single"},void 0,HH("label",{},void 0,HH("input",{type:"checkbox",checked:n[I.kMailSingleClickTabs],onChange:$H(I.kMailSingleClickTabs)}),HH("span",{},void 0,(0,B.Z)("Open Mail Tabs with Single Click")))),HH("div",{className:"setting-single"},void 0,HH("label",{},void 0,HH("input",{type:"checkbox",checked:n[I.kMailPanelActivityIndicatorsEnabled],onChange:$H(I.kMailPanelActivityIndicatorsEnabled)}),HH("span",{},void 0,(0,B.Z)("Show Activity Indicators"))),HH("p",{className:"info"},void 0,(0,B.Z)("Briefly display status next to folders when updating."))),HH("div",{className:"setting-single"},void 0,HH("label",{},void 0,HH("input",{type:"checkbox",checked:n[I.kMailPanelShowErrorMessages],onChange:$H(I.kMailPanelShowErrorMessages)}),HH("span",{},void 0,(0,B.Z)("Error Messages"))),HH("p",{className:"info"},void 0,(0,B.Z)("Display errors in Mail Panel. They are also accessible via Mail Status Button."))),HH("div",{className:"setting-single"},void 0,HH("label",{},void 0,HH("input",{type:"checkbox",checked:n[I.kMailShowUnsubscribed],onChange:$H(I.kMailShowUnsubscribed)}),HH("span",{},void 0,(0,B.Z)("Show Unsubscribed Mailboxes"))))),HH("div",{className:"setting-group"},void 0,HH(hk,{filter:e.filter})),HH("div",{className:"setting-group"},void 0,HH(SH,{filter:e.filter})),HH("div",{className:"setting-group"},void 0,HH("h3",{},void 0,(0,B.Z)("Check For New Mail")),HH(ja.Z,{name:"mailcheckintervalgroup",value:n[I.kMailCheckInterval],onChange:$H(I.kMailCheckInterval)},void 0,HH("div",{className:"setting-single"},void 0,HH("label",{},void 0,QH,HH("span",{},void 0,(0,B.Z)("Every Minute")))),HH("div",{className:"setting-single"},void 0,HH("label",{},void 0,qH,HH("span",{},void 0,(0,B.Z)("Every 15 Minutes")))),HH("div",{className:"setting-single"},void 0,HH("label",{},void 0,JH,HH("span",{},void 0,(0,B.Z)("mail","Manually")))))),HH("div",{className:"setting-group"},void 0,HH("h3",{},void 0,(0,B.Z)("Mail Rendering")),HH(ja.Z,{name:"mailpreferredrendering",value:n[I.kMailPreferredRendering],onChange:$H(I.kMailPreferredRendering)},void 0,HH("div",{className:"setting-single"},void 0,HH("label",{},void 0,eG,HH("span",{},void 0,(0,B.Z)("Prefer HTML over Text")))),HH("div",{className:"setting-single"},void 0,HH("label",{},void 0,tG,HH("span",{},void 0,(0,B.Z)("format","Text Only"))))),HH("div",{className:"setting-single"},void 0,HH("label",{},void 0,HH("input",{type:"checkbox",checked:n[I.kMailColorQuotedText],onChange:$H(I.kMailColorQuotedText)}),HH("span",{},void 0,(0,B.Z)("Color Quoted Text"))))),HH("div",{className:"setting-group"},void 0,HH("h3",{},void 0,(0,B.Z)("Quick reply")),HH(ja.Z,{name:"mailshowquickreply",value:n[I.kMailShowQuickReply],onChange:$H(I.kMailShowQuickReply)},void 0,HH("div",{className:"setting-single"},void 0,HH("label",{},void 0,nG,HH("span",{},void 0,(0,B.Z)("Hide Quick Reply")))),HH("div",{className:"setting-single"},void 0,HH("label",{},void 0,iG,HH("span",{},void 0,(0,B.Z)("Minimize Quick Reply")))),HH("div",{className:"setting-single"},void 0,HH("label",{},void 0,sG,HH("span",{},void 0,(0,B.Z)("Show Quick Reply"))))),HH("div",{className:"setting-single pad-left"},void 0,HH("label",{},void 0,HH("input",{type:"checkbox",checked:n[I.kMailQuickReplyQuote],onChange:$H(I.kMailQuickReplyQuote),disabled:!n[I.kMailShowQuickReply]}),HH("span",{},void 0,(0,B.Z)("Quote Original Message"))))),o&&HH("div",{className:"setting-group"},void 0,HH("h3",{},void 0,(0,B.Z)("Default Sender in New Messages")),HH("p",{className:"info"},void 0,(0,B.Z)("Used as fallback if no account is selected")),HH(ja.Z,{name:"maildefaultaccountgroup",value:n[I.kMailDefaultAccount]||It.Y6,onChange:$H(I.kMailDefaultAccount)},void 0,(e=>e.map(((e,t)=>HH("div",{className:"setting-single"},"default-account-"+t,HH("label",{},void 0,HH("input",{type:"radio",value:e.MAIL_EMAIL}),HH("span",{},void 0,e.MAIL_EMAIL))))))(o),HH("div",{className:"setting-single"},"default-account-mru",HH("label",{},void 0,oG,HH("span",{},void 0,(0,B.Z)("Most Recently Used")))))),HH("div",{className:"setting-group"},void 0,HH("h3",{},void 0,(0,B.Z)("Contacts")),HH("div",{className:"setting-single"},void 0,HH("label",{},void 0,HH("input",{type:"checkbox",checked:n[I.kMailAutoGenerateContacts],onChange:$H(I.kMailAutoGenerateContacts)}),HH("span",{},void 0,(0,B.Z)("Generate contacts for message recipients"))))),HH("div",{className:"setting-group"},void 0,HH("h3",{},void 0,(0,B.Z)("Composer Colors")),HH("p",{className:"info"},void 0,(0,B.Z)("Doesn’t affect the color of sent messages")),HH(ja.Z,{name:"mailcomposercolors",value:n[I.kMailComposerColors],onChange:$H(I.kMailComposerColors)},void 0,HH("div",{className:"setting-single"},"composer-background-white",HH("label",{},void 0,aG,HH("span",{},void 0,(0,B.Z)("Black on White")))),HH("div",{className:"setting-single"},"composer-background-theme",HH("label",{},void 0,rG,HH("span",{},void 0,(0,B.Z)("Inherit Theme Colors")))))),HH("div",{className:"setting-group"},void 0,HH("h3",{},void 0,(0,B.Z)("Optional Mail Headers")),HH("p",{className:"info"},void 0,(0,B.Z)("Mail headers to include when sending messages")),HH("div",{className:"setting-single"},void 0,HH("label",{},void 0,HH("input",{type:"checkbox",checked:n[I.kMailIncludeIdentifyingHeaders],onChange:$H(I.kMailIncludeIdentifyingHeaders)}),HH("span",{},void 0,(0,B.Z)("mail","Mail client identification headers"))))),HH("div",{className:"setting-group"},void 0,HH("div",{className:"setting-single"},void 0,HH("h3",{},void 0,(0,B.Z)("Delete Duplicate Messages")),HH(ta.Z,{value:n[I.kMailMarkDeleteInOtherLocations],onChange:$H(I.kMailMarkDeleteInOtherLocations)},void 0,HH("option",{value:"ask"},void 0,(0,B.Z)("Ask")),HH("option",{value:"folders"},void 0,(0,B.Z)("From All Folders on Current Account")),HH("option",{value:"accounts"},void 0,(0,B.Z)("From All Accounts and Folders")))),HH("div",{className:"setting-single pad-top"},void 0,HH("h3",{},void 0,(0,B.Z)("Permanently Delete Duplicate Messages")),HH(ta.Z,{value:n[I.kMailDeleteInOtherLocations],onChange:$H(I.kMailDeleteInOtherLocations)},void 0,HH("option",{value:"ask"},void 0,(0,B.Z)("Ask")),HH("option",{value:"selected"},void 0,(0,B.Z)("From the Current Folder Only")),HH("option",{value:"folders"},void 0,(0,B.Z)("From All Folders on Current Account")),HH("option",{value:"accounts"},void 0,(0,B.Z)("From All Accounts and Folders"))))),HH("div",{className:"setting-group"},void 0,HH("h3",{},void 0,(0,B.Z)("Archive Actions")),HH("div",{className:"setting-single"},"add-archive-folder",HH("label",{},void 0,HH("input",{type:"checkbox",checked:n[I.kMailAddArchiveFolder],onChange:$H(I.kMailAddArchiveFolder)}),HH("span",{},void 0,(0,B.Z)("Add Archive Folder if Missing")))))),HH("section",{className:"setting-section"},void 0,HH("h2",{},void 0,(0,B.Z)("Advanced Settings")),HH("div",{className:"setting-group"},void 0,HH("div",{className:"setting-single"},void 0,HH("label",{},void 0,HH("input",{type:"checkbox",checked:n[I.kMailImapLogsOn],onChange:$H(I.kMailImapLogsOn)}),HH("span",{},void 0,(0,B.Z)("Turn on IMAP Logs in Console"))),HH("p",{className:"info"},void 0,(0,B.Z)("Note that this will degrade performance of the mail client."))),HH("div",{className:"setting-single"},void 0,HH("label",{},void 0,HH("input",{type:"checkbox",checked:n[I.kMailSmtpLogsOn],onChange:$H(I.kMailSmtpLogsOn)}),HH("span",{},void 0,(0,B.Z)("Turn on SMTP Logs in Console"))),HH("p",{className:"info"},void 0,(0,B.Z)("Turn this on for debugging problems with sending mail."))))),HH("section",{className:"setting-section"},void 0,HH(UH,{filter:e.filter})),HH("section",{className:"setting-section"},void 0,HH(mH,{windowId:t.vivaldiWindowId,filter:e.filter}))]}),HH(gD,{categoryTitle:(0,B.Z)("Mail"),filter:e.filter,inform:!0})]})}const dG=Li.memo(lG),cG=40;const uG=class{points=[];points_buffer=[];stopped=!0;ctx;idx=0;timeout=0;requestId;animationId;current_point_index;constructor(e,t,n="#006ed7",i="#ffffff"){this.window=e,this.canvas=t,this.color=n,this.bgColor=i}#Ft(){const{sequence:e}=this;let t,n=0,i=0,s=0,o=0,a=0,r=0;for(t=0;t<e.length;t++)"0"===e[t]?a+=1:"4"===e[t]&&(a-=1),a>n&&(n=a),a<i&&(i=a);for(t=0;t<e.length;t++)"2"===e[t]?r-=1:"6"===e[t]&&(r+=1),r>s&&(s=r),r<o&&(o=r);return i>0&&(i=0),o>0&&(o=0),120/Math.max(Math.abs(n-i),Math.abs(s-o))}init_points=function(){this.points=[],this.points_buffer=[];const e={x:cG,y:cG};this.points.push(e);const t=this.#Ft();for(let e=0;e<this.sequence.length;e++){const n={};"0"===this.sequence[e]?(n.x=this.points[e].x+t,n.y=this.points[e].y):"2"===this.sequence[e]?(n.x=this.points[e].x,n.y=this.points[e].y+t):"4"===this.sequence[e]?(n.x=this.points[e].x-t,n.y=this.points[e].y):"6"===this.sequence[e]&&(n.x=this.points[e].x,n.y=this.points[e].y-t),this.points.push(n)}let n=this.points[0].x,i=this.points[0].y,s=this.points[0].x,o=this.points[0].y;for(let e=1;e<this.points.length;e++)this.points[e].x<n&&(n=this.points[e].x),this.points[e].x>s&&(s=this.points[e].x),this.points[e].y<i&&(i=this.points[e].y),this.points[e].y>o&&(o=this.points[e].y);if(n<cG){for(let e=0;e<this.points.length;e++)this.points[e].x+=-(n-cG);s+=-(n-cG)}if(i<cG){for(let e=0;e<this.points.length;e++)this.points[e].y+=-(i-cG);o+=-(i-cG)}for(let e=0;e<this.points.length;e++)this.points[e].x+=(160-s)/2,this.points[e].y+=(160-o-8)/2;for(let e=0;e<this.points.length;e++){const t={x:this.points[e].x,y:this.points[e].y};this.points_buffer.push(t)}};reset_points=function(){for(let e=0;e<this.points_buffer.length;e++)this.points[e].x=this.points_buffer[e].x,this.points[e].y=this.points_buffer[e].y};draw_point=function(e){this.ctx.beginPath(),this.ctx.arc(e.x,e.y,8,0,2*Math.PI,!0),this.ctx.closePath(),this.ctx.fillStyle=this.color,this.ctx.fill()};draw_segment=function(){if(!this.stopped){if(this.idx>=this.points.length)return this.timeout>=30?(this.timeout=0,this.idx=0,this.reset_points(),this.window.clearTimeout(this.requestId),void(this.requestId=setTimeout((()=>{this.animationId=this.window.requestAnimationFrame((()=>this.draw_segment()))}),1e3/60))):(this.ctx.fillStyle=xe()(this.bgColor).alpha(.15).css(),this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.timeout++,this.window.clearTimeout(this.requestId),void(this.requestId=setTimeout((()=>{this.animationId=this.window.requestAnimationFrame((()=>this.draw_segment()))}),1e3/60)));this.ctx.fillStyle=xe()(this.bgColor).alpha(.1).css(),this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.draw_point(this.points[this.idx]),!this.points[this.idx+1]||this.points[this.idx].x===this.points[this.idx+1].x&&this.points[this.idx].y===this.points[this.idx+1].y?(this.idx++,this.draw_segment()):(this.points[this.idx].x<this.points[this.idx+1].x?this.points[this.idx].x+=5:this.points[this.idx].x>this.points[this.idx+1].x&&(this.points[this.idx].x-=5),this.points[this.idx].y<this.points[this.idx+1].y?this.points[this.idx].y+=5:this.points[this.idx].y>this.points[this.idx+1].y&&(this.points[this.idx].y-=5),this.window.clearTimeout(this.requestId),this.requestId=setTimeout((()=>{this.window.requestAnimationFrame((()=>this.draw_segment()))}),1e3/60))}};clear_canvas=function(){this.ctx.fillStyle=this.bgColor,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)};start=function(e){this.sequence=e,this.ctx=this.canvas.getContext("2d"),this.ctx.lineWidth=3,this.clear_canvas(),this.init_points(),this.stopped&&(this.stopped=!1,this.animationId=this.window.requestAnimationFrame((()=>{this.draw_segment()})))};stop=function(){this.stopped=!0,this.current_point_index=0,this.timeout=0,this.idx=0,this.window.cancelAnimationFrame(this.animationId)}};var pG,hG=n(21191),gG=n(34155);function mG(e,t,n,i){pG||(pG="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:pG,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const fG={width:400,minWidth:"unset"},vG=pn.jk.settingCategories,yG=["colorHighlightBg","colorBg"],bG=[I.kMouseGesturesAltGesturesEnabled,I.kMouseGesturesDoubleClickMenuEnabled,I.kMouseGesturesEnabled,I.kMouseGesturesStrokeTolerance,I.kMouseGesturesRockerGesturesEnabled,I.kMouseGesturesRockerGesturesRightToLeft,I.kMouseGesturesRockerGesturesLeftToRight],SG=w.Z.getEventHandler;const wG=function(){const e=2*Math.PI/4,t=2*Math.PI/100,n=[];for(let i=-e/2;i<=2*Math.PI-e/2;i+=t){const t=2*Math.floor((i+e/2)/e);n.push(t)}return n}();var CG=mG("hr",{}),AG=mG("span",{className:"meter-bg"});function IG(e){const t=Li.useContext(ts.Z),n=(0,Ya.Z)(bG),i=sN({filter:e.filter,prefPaths:bG,name:e.category.title}),s=Li.useRef(),o=Li.useRef(),a=Li.useRef(),r=Li.useRef(0),l=Li.useRef(0),d=Li.useRef(),c=Li.useRef(),u=Li.useRef(),p=Li.useRef(),h=Li.useRef(),g=yL(),m=Be.Z.getBaseStylesByWindowId(t.vivaldiWindowId,yG),f=Ge.Z.getSettingsList(!0),v=e=>e.find((e=>e.gestures)),[y,b]=Li.useState(Ge.Z.getCommandsForGestures()),[S,C]=Li.useState(f),[A,T]=Li.useState(v(f)),[Z,E]=Li.useState(0),[k,_]=Li.useState(!1),[N,P]=Li.useState(!1);const[D,M]=Li.useReducer((function(e,n){const i=o.current;return(e.bg!==n.bg||e.highlightBg!==n.highlightBg)&&h.current&&i&&(F(),h.current=new uG(t.window,i,n.highlightBg,n.bg),A?.gestures&&h.current.start(A.gestures[0])),n}),{highlightBg:String(m["--colorHighlightBg"]),bg:String(m["--colorBg"])}),[O,x]=Li.useState(f.find((e=>e.guid===n[I.kMouseGesturesRockerGesturesLeftToRight]))),[L,R]=Li.useState(f.find((e=>e.guid===n[I.kMouseGesturesRockerGesturesRightToLeft]))),F=Li.useCallback((()=>{h.current?.stop(),a.current=!1,c.current=[],u.current=[],p.current=[];const e=o.current;if(e){e.getContext("2d").clearRect(0,0,e.width,e.height)}}),[]);Li.useEffect((()=>{const n=()=>{const e=Ge.Z.getSettingsList(!0),t=Ge.Z.getCommandsForGestures();let n=!1;const i=A?.name,s=Object.keys(t);for(let e=0;e<s.length&&!n;e++){n=-1!==t[s[e]].findIndex((e=>e.name===i))}C(e),b(t),E(0),n||T(v(e)),0===s.length&&F()},i=()=>{const e=Be.Z.getBaseStylesByWindowId(t.vivaldiWindowId,yG);M({highlightBg:String(e["--colorHighlightBg"]),bg:String(e["--colorBg"])})};Be.Z.addListener(i),Ge.Z.addListener(n),ie.Z.addListener(n);const o=h.current;return e.category!==vG.all&&gG.nextTick((()=>s.current?.focus())),()=>{Be.Z.removeListener(i),o?.stop(),Ge.Z.removeListener(n),ie.Z.removeListener(n)}}),[]);const W=e=>{const n=A;let i=e&&"focus"===e.type&&n&&n.gestures?n.gestures[0]:e.target.value;const s=e&&"focus"===e.type&&n?n:(a=i,S.find((e=>{if(e.gestures&&e.gestures[0]===a)return e})));var a;if(i){F();const e=o.current;e&&(h.current=new uG(t.window,e,D.highlightBg,D.bg)),0===i.indexOf("e")&&(i=i.substring(1,i.length)),h.current?.start(i),E(0),T(s)}},U=()=>{d.current=[],F();const e=S;E(0),_(!1),T(v(e))},V=()=>{const e=A;e&&(E(2),T(S.find((t=>t.name===e.name))))},H=()=>{ne.Z.restoreGestures(),P(!1)},G=()=>{P(!1)},$=(e,t,n)=>{c.current?.push(e),u.current?.push(t),n&&p.current?.push(n)},K=()=>{const e=o.current,t=e?.getContext("2d");if(!e||!t)return;t.clearRect(0,0,t.canvas.width,t.canvas.height),t.strokeStyle=D.highlightBg,t.lineJoin="round",t.lineWidth=16;const n=c.current,i=u.current;if(n&&i)for(let e=0;e<n.length;e++)t.beginPath(),p.current?.[e]&&e?t.moveTo(n[e-1],i[e-1]):t.moveTo(n[e]-1,i[e]),t.lineTo(n[e],i[e]),t.closePath(),t.stroke()},z=e=>{if(2!==Z||e.button&&0!==e.button)return;e.touches&&(e=e.touches[0]),F(),d.current=[],a.current=!0;const t=o.current?.getBoundingClientRect()??{left:0,top:0};$(e.pageX-t.left,e.pageY-t.top),K()},j=e=>{if(2===Z&&(e.touches&&(e=e.touches[0]),a.current)){const t=o.current?.getBoundingClientRect()??{left:0,top:0};if($(e.pageX-t.left,e.pageY-t.top,!0),0===r.current)return r.current=e.pageX-t.left,void(l.current=e.pageY-t.top);const n=e.pageX-t.left-(r.current??0),i=e.pageY-t.top-(l.current??0),s=10;n*n+i*i>s*s&&(r.current=e.pageX-t.left,l.current=e.pageY-t.top,((e,t)=>{const n=2*Math.PI/4;let i=Math.atan2(t,e)+n/2;i<0&&(i+=2*Math.PI);const s=Math.floor(i/(2*Math.PI)*100);Array.isArray(d.current)&&d.current.push(wG[s])})(n,i)),K()}},Y=()=>{a.current=!1;const e=d.current;if(2!==Z||!e||e.length<3)return;e.length&&(d.current=e.flatMap(((e,t,n)=>e!==n[t-1]&&e===n[t+1]?[e]:[])));let n=d.current?.join("")??"";n.length>5&&(n=n.substring(n.length-5));const i=o.current;let s;i&&(h.current=new uG(t.window,i,D.highlightBg,D.bg),h.current.start(n)),s=A&&(0,hG.jD)(A.name)?y["e"+n]:y[n],_(Boolean(s)),g()},X=()=>{a.current&&(a.current=!1,d.current=[])},Q=e=>{const t=S;let i="LTR"===e?O:L;const s=n[I.kMouseGesturesRockerGesturesLeftToRight],o=n[I.kMouseGesturesRockerGesturesRightToLeft];return"LTR"===e&&i&&s!==i.guid?i=t.find((e=>e.guid===s)):"RTL"===e&&i&&o!==i.guid&&(i=t.find((e=>e.guid===o))),mG(uO.Z,{placeholder:(0,B.Z)("Filter commands..."),isClearable:!1,autoFocus:!1,selectedCommand:i,openMenuOnFocus:!0,isMulti:!1,setSelectedItem:t=>q(t,e),commands:t})},q=(e,t)=>{"LTR"===t?(w.Z.set(I.kMouseGesturesRockerGesturesLeftToRight,e.guid),x(e)):(w.Z.set(I.kMouseGesturesRockerGesturesRightToLeft,e.guid),R(e))},J=A,ee=J&&J.gestures?J.gestures[0]:void 0,te=!d.current||0===d.current.length,se=k&&!te?S.find((e=>e.gestures&&e.gestures.includes(d.current?.join("")))):void 0,oe=" "+(0,B.Z)("This setting requires a restart to take full effect.");return(0,ss.jsxs)(ss.Fragment,{children:[mG("section",{className:"setting-section"},void 0,mG(tN.Z,{categoryTitle:(0,B.Z)("Mouse"),filter:e.filter},void 0,N&&mG(ra.Z,{style:fG,onRequestClose:G,title:(0,B.Z)("Restore Gestures?")},void 0,mG("div",{className:"dialog-restore-shortcuts"},void 0,mG("div",{className:"dialog-content"},void 0,mG("p",{},void 0,(0,B.Z)("All command gestures will be restored to default settings."))),mG("footer",{className:"dialog-footer"},void 0,mG("input",{type:"button",className:"danger",onClick:H,value:(0,B.Z)("Restore")}),mG("input",{type:"button",onClick:G,value:(0,B.Z)("Cancel"),autoFocus:!0})))),mG("div",{className:"setting-group unlimited"},void 0,mG("h3",{},void 0,(0,B.Z)("Gestures")),mG("div",{className:"setting-single"},void 0,mG("label",{},void 0,mG("input",{type:"checkbox",checked:n[I.kMouseGesturesEnabled],onChange:SG(I.kMouseGesturesEnabled)}),mG("span",{},void 0,(0,B.Z)("Allow Gestures"))),mG("p",{className:"info"},void 0,(0,B.Z)("Hold down right mouse button and perform a gesture to issue related command.")+oe)),mG("div",{className:"setting-single"},void 0,mG("label",{},void 0,mG("input",{type:"checkbox",checked:n[I.kMouseGesturesAltGesturesEnabled],onChange:SG(I.kMouseGesturesAltGesturesEnabled)}),mG("span",{},void 0,(0,B.Z)("win_linux","Perform Gestures with Alt Key"))),mG("p",{className:"info"},void 0,(0,B.Z)("Use gestures with trackpad or other input device.")))),mG("div",{className:"setting-group unlimited gestures"},void 0,mG("div",{className:"setting-single pad-top"},void 0,mG("h3",{},void 0,(0,B.Z)("Gesture Mapping")),mG("div",{className:"gesture-map setting-single"},void 0,(0,ss.jsx)("select",{ref:s,className:"gesture-list",value:ee,onChange:W,onFocus:W,onBlur:F,size:"9",children:S.map((e=>{const{gestures:t}=e;return t?mG("option",{value:t[0]},`id-gesture-${e.label.split(" ").join("_")}`,e.label):null}))}),mG("div",{className:2===Z?"active gesture":"gesture"},void 0,(0,ss.jsx)("canvas",{ref:o,width:"200",height:"200",onTouchStart:z,onTouchMove:j,onTouchEnd:Y,onTouchCancel:X,onMouseDown:z,onMouseMove:j,onMouseUp:Y,onMouseLeave:X}))),mG("div",{className:"setting-single record-gesture"},void 0,0===Z&&mG("div",{className:"toolbar toolbar-default"},void 0,mG("div",{className:"toolbar toolbar-group"},void 0,mG(po.ZP,{tooltip:(0,B.Z)("New gesture"),onClick:()=>{E(1)},image:Wi.md4.medium}),CG,mG(po.ZP,{tooltip:(0,B.Z)("Remove gesture"),onClick:()=>{const e=(()=>{const e=S.filter((e=>e.gestures));if(e&&A){const t=e.findIndex((e=>e.name===A.name));return t<e.length-1?e[t+1]:e[t-1]}})(),t=A;t&&(ne.Z.setGestures(t.name),T(e),h.current&&e?.gestures&&h.current?.start(e.gestures[0]))},disabled:!J,image:Wi.M2k.medium})),mG(po.ZP,{tooltip:(0,B.Z)("Edit gesture"),onClick:V,disabled:!J,image:Wi.NNg.medium}),mG(po.ZP,{title:(0,B.Z)("Restore Default Gestures"),onClick:()=>{P(!0)}})),1===Z&&mG("form",{onSubmit:V},void 0,mG("h3",{className:"pad-top"},void 0,(0,B.Z)("Pick a Command")),mG("div",{className:"toolbar"},void 0,(()=>{const t=S.filter((e=>!e.gestures&&e)),n=e.category!==vG.all;return mG(uO.Z,{placeholder:(0,B.Z)("Filter commands..."),isClearable:!0,autoFocus:n,selectedCommand:A,openMenuOnFocus:!0,isMulti:!1,setSelectedItem:T,commands:t})})(),mG("input",{type:"submit",disabled:!J,value:(0,B.Z)("Next...")}),mG("input",{type:"button",onClick:U,value:(0,B.Z)("Cancel")}))),J&&2===Z&&(0,ss.jsxs)(ss.Fragment,{children:[mG("h3",{className:"pad-top"},void 0,(0,B.Z)("Recording “$1” Gesture",[J.label])),mG("div",{className:"add-gesture"},void 0,mG("p",{className:"info"},void 0,(0,B.Z)("Draw a new gesture in the highlighted area using the primary input. Gesture may consist of horizontal and vertical lines, limited to maximum of five strokes.")),mG("div",{className:"save"},void 0,mG("input",{type:"submit",value:(0,B.Z)("Save Gesture"),onClick:()=>{if(!d.current)return;let e=d.current.join("");const t=A;t&&((0,hG.jD)(t.name)&&(e="e"+e),ne.Z.setGestures(t.name,[e]),d.current=[],gG.nextTick((()=>s.current?.focus())))},disabled:te||k}),mG("input",{type:"button",onClick:U,value:(0,B.Z)("Cancel")}),se&&mG("p",{className:"alert"},void 0,(0,B.Z)("This gesture is already used by “$1” command.",[se.label]))))]})))),mG("div",{className:"setting-group unlimited"},void 0,mG("div",{className:"setting-single pad-top"},void 0,mG("h3",{},void 0,(0,B.Z)("Gesture Sensitivity")),mG("p",{className:"info"},void 0,(0,B.Z)("Set minimum stroke length to be recognized as a gesture move.")),mG("div",{className:"setting-single tolerance"},void 0,mG("div",{className:"gesture-preview"},void 0,AG,mG("span",{className:"meter",style:{width:n[I.kMouseGesturesStrokeTolerance]+"px"}}),mG("span",{},void 0,(0,B.Z)("$1 pixels",[n[I.kMouseGesturesStrokeTolerance]]))),mG(cB,{min:5,max:100,step:5,onChange:SG(I.kMouseGesturesStrokeTolerance),value:n[I.kMouseGesturesStrokeTolerance]}))),mG("div",{className:"setting-single pad-top"},void 0,mG("h3",{},void 0,(0,B.Z)("Rocker Gestures")),mG("label",{},void 0,mG("input",{type:"checkbox",checked:n[I.kMouseGesturesRockerGesturesEnabled],onChange:SG(I.kMouseGesturesRockerGesturesEnabled)}),mG("span",{},void 0,(0,B.Z)("Allow Rocker Gestures"))),mG("p",{className:"info"},void 0,oe),mG("div",{className:"pad-left"},void 0,mG("div",{className:"rocker-gesture-settings"},void 0,mG("span",{className:"rocker-gesture-settings-title"},void 0,mG("span",{dangerouslySetInnerHTML:{__html:Wi.GmL}}),(0,B.Z)("other","Right")),Q("LTR")),mG("p",{className:"info"},void 0,(0,B.Z)("Press left mouse button followed by right button to execute."))),mG("div",{className:"pad-left"},void 0,mG("div",{className:"rocker-gesture-settings"},void 0,mG("span",{className:"rocker-gesture-settings-title"},void 0,mG("span",{style:{transform:"scale(-1, 1)"},dangerouslySetInnerHTML:{__html:Wi.GmL}}),(0,B.Z)("other","Left")),Q("RTL")),mG("p",{className:"info"},void 0,(0,B.Z)("Press right mouse button followed by left button to execute.")))),Oi.Z.isEnabled("double_click_menu")&&mG("div",{className:"setting-single pad-top"},void 0,mG("h3",{},void 0,(0,B.Z)("Double Click Context Menu")),mG("label",{},void 0,mG("input",{type:"checkbox",checked:n[I.kMouseGesturesDoubleClickMenuEnabled],onChange:SG(I.kMouseGesturesDoubleClickMenuEnabled)}),mG("span",{},void 0,(0,B.Z)("Allow Double Click to Show Context Menu"))),mG("p",{className:"info"},void 0,(0,B.Z)("Use a double click to show the context menu.")+oe))))),i]})}const TG=Li.memo(IG);var ZG;function EG(e,t,n,i){ZG||(ZG="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:ZG,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const kG=w.Z.getEventHandler,_G=[I.kVivaldiClientHintsBrand,I.kVivaldiClientHintsBrandAppendVivaldi,I.kVivaldiClientHintsBrandCustomBrand,I.kVivaldiClientHintsBrandCustomBrandVersion],NG=new RegExp(/[^\x20-\x21\x23-\x5B\x5D-\x7E]/),PG=new RegExp(/^[0-9.]*$/);function DG(e){const t=Li.useContext(ts.Z),n=(0,Ya.Z)(_G),i=sN({filter:e.filter,prefPaths:_G,name:e.category.title}),[s,o]=Li.useState(!1),[a,r]=Li.useState(!1),l=Boolean(navigator.userAgentData);return(0,ss.jsxs)(ss.Fragment,{children:[EG("section",{className:"setting-section"},void 0,EG(tN.Z,{categoryTitle:(0,B.Z)("Network"),filter:e.filter},void 0,EG("div",{className:"setting-group"},void 0,EG("h3",{},void 0,(0,B.Z)("Proxies")),EG("div",{className:"setting-single"},void 0,EG("input",{type:"button",value:(0,B.Z)("Proxy Settings"),onClick:()=>{se.Z.utilities.launchNetworkSettings(t.vivaldiWindowId)}}))),l&&EG("div",{className:"setting-group setting-group-double brand-masking"},void 0,EG("h3",{},void 0,(0,B.Z)("User Agent Brand Masking")),EG("p",{className:"info"},void 0,(0,B.Z)("This setting is intended for debugging websites by updating the Sec-CH-UA browser identity HTTP header. Changes may cause site compatibility issues.")," ",(0,B.Z)("This setting requires a restart to take full effect.")),EG("div",{},void 0,EG("label",{className:"stack-column"},void 0,EG("span",{},void 0,(0,B.Z)("Report Browser Brand as")),EG(ta.Z,{value:n[I.kVivaldiClientHintsBrand].toString(),onChange:kG(I.kVivaldiClientHintsBrand)},void 0,EG("option",{value:"0"},void 0,(0,B.Z)("No Brand")),EG("option",{value:"1"},void 0,(0,B.Z)("Vivaldi")),EG("option",{value:"2"},void 0,(0,B.Z)("Custom")),EG("option",{value:"3"},void 0,(0,B.Z)("Google Chrome")),EG("option",{value:"4"},void 0,(0,B.Z)("Microsoft Edge"))))),EG("div",{className:"setting-single pad-top"},void 0,EG("label",{},void 0,EG("input",{type:"checkbox",checked:n[I.kVivaldiClientHintsBrandAppendVivaldi],onChange:kG(I.kVivaldiClientHintsBrandAppendVivaldi),disabled:n[I.kVivaldiClientHintsBrand]<2}),EG("span",{},void 0,(0,B.Z)("Append Vivaldi Brand")))),EG("div",{className:"setting-single"},void 0,EG("label",{},void 0,EG("input",{type:"text",value:n[I.kVivaldiClientHintsBrandCustomBrand],onChange:e=>{const t=e.target.value;!NG.test(t)&&!t.includes('"')||""===t?(w.Z.set(I.kVivaldiClientHintsBrandCustomBrand,t),s&&o(!1)):o(!0)},disabled:2!==n[I.kVivaldiClientHintsBrand],maxLength:"50"}),EG("span",{},void 0,(0,B.Z)("Custom Brand"))),s&&EG(To,{type:"warning"},void 0,(0,B.Z)("Brand is limited to 50 ASCII and punctuation characters except for a double quote."))),EG("div",{className:"setting-single"},void 0,EG("label",{},void 0,EG("input",{type:"text",value:n[I.kVivaldiClientHintsBrandCustomBrandVersion],onChange:e=>{const t=e.target.value;PG.test(t)||""===t?(w.Z.set(I.kVivaldiClientHintsBrandCustomBrandVersion,t),a&&r(!1)):r(!0)},disabled:2!==n[I.kVivaldiClientHintsBrand],maxLength:"20"}),EG("span",{},void 0,(0,B.Z)("Custom Version"))),a&&EG(To,{type:"warning"},void 0,(0,B.Z)("Version is limited to 20 number or period characters."))),EG("div",{className:"setting-single pad-top"},void 0,EG("h3",{},void 0,(0,B.Z)("Sec-CH-UA HTTP Header")),EG("p",{},void 0,EG("span",{className:"selectable"},void 0,(()=>{const e=navigator.userAgentData?.brands.map((e=>`"${e.brand}";v="${e.version}"`)).join(",");return e??""})())))))),i]})}const MG=Li.memo(DG);var OG;function xG(e,t,n,i){OG||(OG="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:OG,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const LG=[I.kMailContactDefaultAction,I.kMailSingleClickTabs,I.kNotesCreationAddScreenshot,I.kNotesCreationNotify,I.kNotesCreationShowPanel,I.kPanelsAsOverlayAutoClose,I.kPanelsAsOverlayEnabled,I.kPanelsLazyLoad,I.kPanelsPosition,I.kPanelsShowCloseButton,I.kPanelsShowFolderBadge,I.kPanelsShowToggle,I.kPanelsTranslatePaste,I.kPanelsTranslateRedirect,I.kPanelsWindowDragToStack,I.kPanelsWindowShowPinnedGroup,I.kPanelsWindowShowUnread,I.kPanelsWindowSingleClickOpens,I.kReadingListPanelSingleClickOpens,I.kReadingListShowCounter],RG=w.Z.getEventHandler,BG=[...LG,I.kMailIsTurnedOff];var FG=xG("input",{type:"radio",value:"left"}),WG=xG("input",{type:"radio",value:"right"}),UG=xG("input",{type:"radio",value:"viewAllMessages"}),VG=xG("input",{type:"radio",value:"compose"});function HG(e){const t=(0,Ya.Z)(BG),n=sN({filter:e.filter,prefPaths:LG,name:e.category.title});return(0,ss.jsxs)(ss.Fragment,{children:[xG("section",{className:"setting-section"},void 0,xG(tN.Z,{categoryTitle:(0,B.Z)("Panels"),filter:e.filter},void 0,xG("div",{className:"setting-group"},void 0,xG("h3",{},void 0,(0,B.Z)("Panel Position")),xG(ja.Z,{name:"panelPosition",value:t[I.kPanelsPosition],onChange:RG(I.kPanelsPosition),className:"group"},void 0,xG("div",{className:"setting-single"},void 0,xG("label",{},void 0,FG,xG("span",{},void 0,(0,B.Z)("Left Side")))),xG("div",{className:"setting-single"},void 0,xG("label",{},void 0,WG,xG("span",{},void 0,(0,B.Z)("Right Side")))))),xG("div",{className:"setting-group"},void 0,xG("h3",{},void 0,(0,B.Z)("Panel Options")),xG("div",{className:"setting-single"},void 0,xG("label",{title:(0,B.Z)("Display a panel toggle button along the side")},void 0,xG("input",{type:"checkbox",checked:t[I.kPanelsShowToggle],onChange:RG(I.kPanelsShowToggle)}),xG("span",{},void 0,(0,B.Z)("Show Panel Toggle")))),xG("div",{className:"setting-single"},void 0,xG("label",{title:(0,B.Z)("Overlay panel over browser content")},void 0,xG("input",{type:"checkbox",checked:t[I.kPanelsAsOverlayEnabled],onChange:RG(I.kPanelsAsOverlayEnabled)}),xG("span",{},void 0,(0,B.Z)("Floating Panel")))),xG("div",{className:"setting-single pad-left"},void 0,xG("label",{title:(0,B.Z)("Automatically collapse panel upon losing focus")},void 0,xG("input",{type:"checkbox",disabled:!t[I.kPanelsAsOverlayEnabled],checked:t[I.kPanelsAsOverlayAutoClose],onChange:RG(I.kPanelsAsOverlayAutoClose)}),xG("span",{},void 0,(0,B.Z)("Auto-Close Inactive Panel")))),xG("div",{className:"setting-single"},void 0,xG("label",{},void 0,xG("input",{type:"checkbox",checked:t[I.kPanelsShowCloseButton],onChange:RG(I.kPanelsShowCloseButton)}),xG("span",{},void 0,(0,B.Z)("Show Close Button")))),xG("div",{className:"setting-single"},void 0,xG("label",{},void 0,xG("input",{type:"checkbox",checked:t[I.kPanelsShowFolderBadge],onChange:RG(I.kPanelsShowFolderBadge)}),xG("span",{},void 0,(0,B.Z)("Show Folder Counters"))))),xG("div",{className:"setting-group"},void 0,xG("h3",{},void 0,(0,B.Z)("Web Panels")),xG("div",{className:"setting-single"},void 0,xG("label",{title:(0,B.Z)("Detect and display numeric notification from page title in Tabs and Web Panels")},void 0,xG("input",{type:"checkbox",checked:t[I.kTabsCounterDetection],onChange:RG(I.kTabsCounterDetection)}),xG("span",{},void 0,(0,B.Z)("Detect Page Title Notifications")))),xG("div",{className:"setting-single"},void 0,xG("label",{title:(0,B.Z)("Wait to Load Panels Until Activated")},void 0,xG("input",{type:"checkbox",checked:t[I.kPanelsLazyLoad],onChange:RG(I.kPanelsLazyLoad)}),xG("span",{},void 0,(0,B.Z)("Lazy Load"))))),xG("div",{className:"setting-group"},void 0,xG("h3",{},void 0,(0,B.Z)("title","Notes Panel")),xG("div",{className:"setting-single"},void 0,xG("label",{title:(0,B.Z)("Show panel content when adding a note from a page")},void 0,xG("input",{type:"checkbox",checked:t[I.kNotesCreationShowPanel],onChange:RG(I.kNotesCreationShowPanel)}),xG("span",{},void 0,(0,B.Z)("Open Panel Automatically")))),xG("div",{className:"setting-single"},void 0,xG("label",{},void 0,xG("input",{type:"checkbox",checked:t[I.kNotesCreationNotify],onChange:RG(I.kNotesCreationNotify)}),xG("span",{},void 0,(0,B.Z)("Notify on Adding New Note")))),xG("div",{className:"setting-single"},void 0,xG("label",{title:(0,B.Z)("Add a screenshot when adding a note from a page")},void 0,xG("input",{type:"checkbox",checked:t[I.kNotesCreationAddScreenshot],onChange:RG(I.kNotesCreationAddScreenshot)}),xG("span",{},void 0,(0,B.Z)("Fetch Screenshot for New Notes"))))),xG("div",{className:"setting-group"},void 0,xG("h3",{},void 0,(0,B.Z)("title","Windows Panel")),xG("div",{className:"setting-single"},void 0,xG("label",{},void 0,xG("input",{type:"checkbox",checked:t[I.kPanelsWindowSingleClickOpens],onChange:RG(I.kPanelsWindowSingleClickOpens)}),xG("span",{},void 0,(0,B.Z)("Activate with Single Click")))),xG("div",{className:"setting-single"},void 0,xG("label",{},void 0,xG("input",{type:"checkbox",checked:t[I.kPanelsWindowShowPinnedGroup],onChange:RG(I.kPanelsWindowShowPinnedGroup)}),xG("span",{},void 0,(0,B.Z)("Pinned Folder")))),xG("div",{className:"setting-single"},void 0,xG("label",{},void 0,xG("input",{type:"checkbox",checked:t[I.kPanelsWindowDragToStack],onChange:RG(I.kPanelsWindowDragToStack)}),xG("span",{},void 0,(0,B.Z)("Create Tab Stack by Drag and Drop")))),xG("div",{className:"setting-single"},void 0,xG("label",{},void 0,xG("input",{type:"checkbox",checked:t[I.kPanelsWindowShowUnread],onChange:RG(I.kPanelsWindowShowUnread)}),xG("span",{},void 0,(0,B.Z)("Show Unread Tabs Badge"))))),xG("div",{className:"setting-group"},void 0,xG("h3",{},void 0,(0,B.Z)("title","Translate Panel")),xG("div",{className:"setting-single"},void 0,xG("label",{},void 0,xG("input",{type:"checkbox",checked:t[I.kPanelsTranslateRedirect],onChange:RG(I.kPanelsTranslateRedirect)}),xG("span",{},void 0,(0,B.Z)("Use Panel Instead of Dialog")))),xG("div",{className:"setting-single"},void 0,xG("label",{},void 0,xG("input",{type:"checkbox",checked:t[I.kPanelsTranslatePaste],onChange:RG(I.kPanelsTranslatePaste)}),xG("span",{},void 0,(0,B.Z)("Translate when pasting text"))))),xG("div",{className:"setting-group"},void 0,xG("h3",{},void 0,(0,B.Z)("Reading List Panel")),xG("div",{className:"setting-single"},void 0,xG("label",{},void 0,xG("input",{type:"checkbox",checked:t[I.kReadingListPanelSingleClickOpens],onChange:RG(I.kReadingListPanelSingleClickOpens)}),xG("span",{},void 0,(0,B.Z)("Activate with Single Click")))),xG("div",{className:"setting-single"},void 0,xG("label",{},void 0,xG("input",{type:"checkbox",checked:t[I.kReadingListShowCounter],onChange:RG(I.kReadingListShowCounter)}),xG("span",{},void 0,(0,B.Z)("Show Unread Counters"))))),!t[I.kMailIsTurnedOff]&&xG("div",{className:"setting-group"},void 0,xG("h3",{},void 0,(0,B.Z)("title","Contacts Panel")),xG("div",{className:"setting-single"},void 0,xG("label",{},void 0,xG("input",{type:"checkbox",checked:t[I.kMailSingleClickTabs],onChange:RG(I.kMailSingleClickTabs)}),xG("span",{},void 0,(0,B.Z)("Activate with Single Click")))),xG("div",{className:"setting-single pad-top"},void 0,xG("h3",{},void 0,(0,B.Z)("Default Contact Action")),xG(ja.Z,{name:"contactDefaulAction",value:t[I.kMailContactDefaultAction],onChange:RG(I.kMailContactDefaultAction),className:"group"},void 0,xG("div",{className:"setting-single"},void 0,xG("label",{},void 0,UG,xG("span",{},void 0,(0,B.Z)("View All Mail Messages")))),xG("div",{className:"setting-single"},void 0,xG("label",{},void 0,VG,xG("span",{},void 0,(0,B.Z)("radio","Compose New Message"))))))))),n]})}const GG=Li.memo(HG);var $G;function KG(e,t,n,i){$G||($G="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:$G,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const zG=[I.kAutofillProfileEnabled],jG=w.Z.getEventHandler,YG={guid:void 0,fields:[],languageCode:void 0,metadata:void 0},XG="ADDRESS_HOME_COUNTRY",QG="ADDRESS_HOME_STREET_ADDRESS",qG="PHONE_HOME_WHOLE_NUMBER",JG="EMAIL_ADDRESS";class e$ extends Li.PureComponent{static contextType=ts.Z;#m=!1;getAddressList=async()=>{i.Z.autofillPrivate.getAddressList((e=>{this.setState({addresses:e})}))};getAddressComponents=async()=>{this.state.countries.forEach((e=>{e.countryCode&&i.Z.autofillPrivate.getAddressComponents(e.countryCode).then((t=>{this.setState((n=>{n.addressComponents.set(e.countryCode??"",t)}))}))}))};getCountryList=async()=>{i.Z.autofillPrivate.getCountryList(!1,(e=>{this.setState({countries:e},(()=>this.getAddressComponents()))}))};constructor(e){super(e),this.state={addresses:[],countries:[],addressComponents:new Map,dialogVisible:"none",dialogAddress:YG}}async componentDidMount(){this.#m=!0,await this.getCountryList(),await this.getAddressList(),i.Z.autofillPrivate.onPersonalDataChanged.addListener((()=>{this.getAddressList()}))}componentWillUnmount(){this.#m=!1,i.Z.autofillPrivate.onPersonalDataChanged.removeListener((()=>{this.getAddressList()}))}handleInputChange(e,t){this.setState((n=>{const i=[...n.dialogAddress.fields];let s=!1;if(i.forEach((n=>{n.type===e&&(n.value=t,s=!0)})),!s){const n={type:e,value:t};i.push(n)}return{dialogAddress:{...n.dialogAddress,fields:i}}}))}showNewAddressDialog=()=>{const e=YG;if(this.state.countries[0].countryCode){const t={type:XG,value:this.state.countries[0].countryCode};e.fields.push(t)}this.setState({dialogVisible:"new",dialogAddress:e})};showEditAddressDialog=e=>{this.setState({dialogVisible:"edit",dialogAddress:e})};handleOnCloseDialog=()=>{this.setState({dialogVisible:"none",dialogAddress:YG})};saveAddressAndCloseDialog=()=>{i.Z.autofillPrivate.saveAddress(this.state.dialogAddress),this.handleOnCloseDialog()};deleteAddressAndCloseDialog=()=>{"edit"===this.state.dialogVisible&&this.state.dialogAddress.guid&&i.Z.autofillPrivate.removeEntry(this.state.dialogAddress.guid),this.handleOnCloseDialog()};renderAddress=e=>{const t=new Map;e.fields.forEach((e=>t.set(e.type,e.value)));const n=t.get(XG),i=this.state.countries.find((e=>e.countryCode===n))?.name||"",s=t.get("NAME_FULL")||t.get("COMPANY_NAME"),o=t.get(QG);return n&&i?KG("div",{className:"CardDisplay Address"},e.guid,s&&KG("strong",{},void 0,s),[o,i].filter(Boolean).join(", "),KG("button",{className:"CardDisplay-Edit",value:(0,B.Z)("Edit Address"),onClick:()=>this.showEditAddressDialog(e)},void 0,"•••")):null};renderEditDialogFields=()=>{const e=new Map;this.state.dialogAddress.fields.forEach((t=>e.set(t.type,t.value)));const t=e.get(XG);if(!t)return null;const n=this.state.addressComponents.get(t),i=e.get(qG),s=e.get(JG);return(0,ss.jsxs)(ss.Fragment,{children:[KG("div",{className:"dialog-row"},void 0,KG("div",{className:"dialog-column"},void 0,KG("label",{},void 0,KG("p",{},void 0,(0,B.Z)("Country")),KG(ta.Z,{name:"countryCode",value:t,onChange:e=>{this.handleInputChange(XG,e.target.value)},autoFocus:!0},void 0,this.state.countries.filter((e=>e.name&&e.countryCode)).map(((e,t)=>KG("option",{value:e.countryCode},t,(0,B.Z)("$1",[e.name||""])))))))),n&&n.components.map(((t,n)=>KG("div",{className:"dialog-row"},n,t.row.map(((t,n)=>{const i=t.fieldName,s=e.get(t.field);return KG("div",{className:"dialog-column"},n,i?KG("label",{},void 0,KG("p",{},void 0,i),t.field===QG?KG("textarea",{rows:3,value:s||"",onChange:e=>this.handleInputChange(t.field,e.target.value)}):KG("input",{type:"text",value:s||"",onChange:e=>this.handleInputChange(t.field,e.target.value)})):null)}))))),KG("div",{className:"dialog-row"},void 0,KG("div",{className:"dialog-column"},void 0,KG("label",{},void 0,KG("p",{},void 0,(0,B.Z)("Phone")),KG("input",{type:"text",value:i||"",onChange:e=>this.handleInputChange(qG,e.target.value)}))),KG("div",{className:"dialog-column"},void 0,KG("label",{},void 0,KG("p",{},void 0,(0,B.Z)("Email")),KG("input",{type:"email",value:s||"",onChange:e=>this.handleInputChange(JG,e.target.value)}))))]})};render(){const e="none"!==this.state.dialogVisible;return(0,ss.jsxs)(ss.Fragment,{children:[e&&KG(ra.Z,{onRequestClose:this.handleOnCloseDialog,className:"float address",ignoreClickOutside:!0},void 0,KG("form",{},void 0,KG("div",{className:"dialog-header"},void 0,KG("h1",{},void 0,"new"===this.state.dialogVisible?(0,B.Z)("Add Address"):(0,B.Z)("Edit Address"))),KG("div",{className:"dialog-content"},void 0,this.renderEditDialogFields()),KG("footer",{className:"dialog-footer"},void 0,KG("input",{type:"submit",onClick:this.saveAddressAndCloseDialog,value:(0,B.Z)("Save")}),"edit"===this.state.dialogVisible&&KG("input",{type:"button",className:"danger",onClick:this.deleteAddressAndCloseDialog,value:(0,B.Z)("verb","Delete")}),KG("input",{type:"button",onClick:this.handleOnCloseDialog,value:(0,B.Z)("Cancel")})))),KG(tN.Z,{categoryTitle:(0,B.Z)("Addresses and More"),filter:this.props.filter},void 0,KG("div",{className:"setting-group unlimited"},void 0,KG("div",{className:"setting-single"},void 0,KG("label",{},void 0,KG("input",{type:"checkbox",checked:this.props.prefValues[I.kAutofillProfileEnabled],onChange:jG(I.kAutofillProfileEnabled)}),KG("span",{},void 0,(0,B.Z)("Save and Fill Addresses"))),KG("p",{className:"info"},void 0,(0,B.Z)("Includes information such as phone numbers, email addresses and delivery addresses"))),KG("div",{className:"setting-single pad-top"},void 0,Boolean(this.state.addresses.length>0&&this.state.addressComponents.size)&&(0,ss.jsxs)(ss.Fragment,{children:[KG("h3",{},void 0,(0,B.Z)("Saved Addresses")),KG("div",{},void 0,this.state.addresses.map((e=>this.renderAddress(e))))]}),KG("input",{type:"button",value:(0,B.Z)("Add New Address"),disabled:!this.props.prefValues[I.kAutofillProfileEnabled],onClick:this.showNewAddressDialog}))))]})}}const t$=(0,Bu.Z)(e$,zG),n$="https://downloads.vivaldi.com/",i$={[n$+"ddg/tds-v2-current.json"]:"DuckDuckGo Tracker Radar",[n$+"easylist/easyprivacy-current.txt"]:"EasyPrivacy",[n$+"easylist/easylist-current.txt"]:"EasyList",[n$+"lists/abp/abp-filters-anti-cv-current.txt"]:"ABP anti-circumvention list",[n$+"lists/abp/antiadblockfilters-current.txt"]:"AdBlock Warning Removal List",[n$+"lists/vivaldi/partners-current.txt"]:(0,B.Z)("Allow ads from our partners (support Vivaldi)"),"https://www.i-dont-care-about-cookies.eu/abp/":(0,B.Z)("Remove cookie warnings ($1)",["I don’t care about cookies"]),"https://secure.fanboy.co.nz/fanboy-cookiemonster.txt":(0,B.Z)("Remove cookie warnings ($1)",["Easylist Cookie List"]),"https://secure.fanboy.co.nz/fanboy-annoyance.txt":(0,B.Z)("Remove annoyances, can break sites ($1)",["Fanboy's Annoyance List"]),"https://easylist-downloads.adblockplus.org/Liste_AR.txt":(0,B.Z)("Arabic ($1)",["Liste AR"]),"http://stanev.org/abp/adblock_bg.txt":(0,B.Z)("Bulgarian ($1)",["Bulgarian List"]),"https://easylist-downloads.adblockplus.org/easylistchina.txt":(0,B.Z)("Chinese ($1)",["EasyList China"]),"https://raw.githubusercontent.com/cjx82630/cjxlist/master/cjx-annoyance.txt":(0,B.Z)("Chinese ($1)",["CJX’s Annoyance List"]),"https://raw.githubusercontent.com/yecarrillo/adblock-colombia/master/adblock_co.txt":(0,B.Z)("Colombian ($1)",["Colombian List by Yecarrillo"]),"https://raw.githubusercontent.com/tomasko126/easylistczechandslovak/master/filters.txt":(0,B.Z)("Czech and Slovak ($1)",["Czech and Slovak filter list"]),"https://easylist-downloads.adblockplus.org/easylistdutch.txt":(0,B.Z)("Dutch ($1)",["EasyList Dutch"]),"https://pgl.yoyo.org/adservers/serverlist.php?hostformat=adblockplus&mimetype=plaintext":(0,B.Z)("English ($1)",["Peter Lowe’s List"]),"https://adblock.ee/list.php":(0,B.Z)("Estonian ($1)",["Eesti saitidele kohandatud filter"]),"https://gurud.ee/ab.txt":(0,B.Z)("Estonian ($1)",["Filters by Gurud.ee"]),"https://cdn.rawgit.com/SlashArash/adblockfa/master/adblockfa.txt":(0,B.Z)("Farsi ($1)",["AdBlock Farsi"]),"https://raw.githubusercontent.com/finnish-easylist-addition/finnish-easylist-addition/master/Finland_adb.txt":(0,B.Z)("Finnish ($1)",["EasyList Finland"]),"https://easylist-downloads.adblockplus.org/liste_fr.txt":(0,B.Z)("French ($1)",["Liste FR"]),"https://easylist.to/easylistgermany/easylistgermany.txt":(0,B.Z)("German ($1)",["EasyList Germany"]),"https://www.void.gr/kargig/void-gr-filters.txt":(0,B.Z)("Greek ($1)",["void.gr"]),"https://raw.githubusercontent.com/easylist/EasyListHebrew/master/EasyListHebrew.txt":(0,B.Z)("Hebrew ($1)",["EasyList Hebrew"]),"https://raw.githubusercontent.com/hufilter/hufilter/refs/heads/gh-pages/hufilter.txt":(0,B.Z)("Hungarian ($1)",["hufilter"]),"https://adblock.gardar.net/is.abp.txt":(0,B.Z)("Icelandic ($1)",["Icelandic ABP List"]),"https://easylist-downloads.adblockplus.org/indianlist.txt":(0,B.Z)("Indian ($1)",["Indian List"]),"https://raw.githubusercontent.com/heradhis/indonesianadblockrules/master/subscriptions/abpindo.txt":(0,B.Z)("Indonesian ($1)",["ABPindo"]),"https://raw.githubusercontent.com/gioxx/xfiles/master/filtri.txt":(0,B.Z)("Italian ($1)",["X Files"]),"https://easylist-downloads.adblockplus.org/easylistitaly.txt":(0,B.Z)("Italian ($1)",["EasyList Italy"]),"https://raw.githubusercontent.com/k2jp/abp-japanese-filters/master/abpjf.txt":(0,B.Z)("Japanese ($1)",["ABP Japanese filters"]),"https://raw.githubusercontent.com/eEIi0A5L/adblock_filter/master/mochi_filter.txt":(0,B.Z)("Japanese ($1)",["もちフィルタ（広告ブロック）"]),"https://raw.githubusercontent.com/eEIi0A5L/adblock_filter/master/tamago_filter.txt":(0,B.Z)("Japanese ($1)",["たまごフィルタ（mobile filter）"]),"https://easylist-downloads.adblockplus.org/koreanlist.txt":(0,B.Z)("Korean ($1)",["Korean List"]),"https://raw.githubusercontent.com/yous/YousList/master/youslist.txt":(0,B.Z)("Korean ($1)",["YousList"]),"https://notabug.org/latvian-list/adblock-latvian/raw/master/lists/latvian-list.txt":(0,B.Z)("Latvian ($1)",["Latvian List"]),"https://raw.githubusercontent.com/EasyList-Lithuania/easylist_lithuania/master/easylistlithuania.txt":(0,B.Z)("Lithuanian ($1)",["EasyList Lithuania"]),"https://raw.githubusercontent.com/DandelionSprout/adfilt/master/NorwegianExperimentalList%20alternate%20versions/NordicFiltersABP.txt":(0,B.Z)("Nordic ($1)",["Dandelion Sprout’s Nordic Filters"]),"https://easylist-downloads.adblockplus.org/easylistpolish.txt":(0,B.Z)("Polish ($1)",["EasyList Polish"]),"https://easylist-downloads.adblockplus.org/easylistportuguese.txt":(0,B.Z)("Portuguese ($1)",["EasyList Portuguese"]),"https://www.zoso.ro/pages/rolist.txt":(0,B.Z)("Romanian ($1)",["ROLIST"]),"https://easylist-downloads.adblockplus.org/advblock.txt":(0,B.Z)("Russian ($1)",["RU AdList"]),"https://easylist-downloads.adblockplus.org/easylistspanish.txt":(0,B.Z)("Spanish ($1)",["EasyList Spanish"]),"https://secure.fanboy.co.nz/fanboy-turkish.txt":(0,B.Z)("Turkish ($1)",["Fanboy’s Turkish"]),"https://raw.githubusercontent.com/abpvn/abpvn/master/filter/abpvn.txt":(0,B.Z)("Vietnamese ($1)",["ABPVN List"])};function s$(e){return i$[e]||e}var o$;function a$(e,t,n,i){o$||(o$="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:o$,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const r$={width:500,minWidth:"unset"},l$={success:(0,B.Z)("Fetched successfully"),download_failed:(0,B.Z)("Failed to download"),file_not_found:(0,B.Z)("File cannot be located"),file_read_error:(0,B.Z)("File cannot be read"),file_unsupported:(0,B.Z)("Invalid format"),failed_saving_parsed_rules:(0,B.Z)("Cannot save to the profile"),unknown:(0,B.Z)("Fetch not completed")},d$={allowSnippets:!1,pureHost:!0,documentAllow:!0};var c$=a$("br",{}),u$=a$("br",{});class p$ extends Li.PureComponent{static contextType=ts.Z;fileInput=Li.createRef();state={blockerSources:[],sortedList:[],cachedSource:void 0,newSource:"",showEditor:0,importError:"",...d$};componentDidMount(){this.updateSources(),se.Z.contentBlocking.onRuleSourceUpdated.addListener(this.updateSources),se.Z.contentBlocking.onRuleSourceDisabled.addListener(this.updateSources),se.Z.contentBlocking.onRuleSourceEnabled.addListener(this.updateSources)}componentWillUnmount(){se.Z.contentBlocking.onRuleSourceUpdated.removeListener(this.updateSources),se.Z.contentBlocking.onRuleSourceDisabled.removeListener(this.updateSources),se.Z.contentBlocking.onRuleSourceEnabled.removeListener(this.updateSources)}updateSources=()=>{se.Z.contentBlocking.getRuleSources(this.props.ruleGroup,(e=>{this.setState({blockerSources:e,sortedList:this.remapSources(e)})})),this.state.cachedSource&&this.updateCachedSource()};updateCachedSource=()=>{this.state.cachedSource&&se.Z.contentBlocking.getRuleSource(this.props.ruleGroup,this.state.cachedSource.id,(e=>{if("unknown"!==e.last_fetch_result)return"success"!==e.last_fetch_result?(this.state.cachedSource&&this.removeSource(this.state.cachedSource.id),void this.setState({cachedSource:void 0,showEditor:1,importError:l$[e.last_fetch_result],...d$})):void this.setState({cachedSource:e,allowSnippets:e.settings.allow_abp_snippets,pureHost:e.settings.naked_hostname_is_pure_host,documentAllow:e.settings.use_whole_document_allow,showEditor:3,importError:""})}))};remapSources=e=>{if(e){return e.map(((e,t)=>{const n=e.unsafe_adblock_metadata,i=e.is_from_url?e.source_url:e.source_file,s=n.title&&s$(i)===i?n.title:s$(i);return{key:e.id.toString(),name:s,isDefault:e.source_url.startsWith(n$),enabled:e.loaded,id:e.id}})).sort(((e,t)=>e.name<t.name?-1:1)).sort(((e,t)=>e.isDefault&&!t.isDefault?-1:1))}return[]};updateNewSource=e=>{const{value:t}=e.currentTarget;this.setState({newSource:t})};onImportFromFile=e=>se.Z.utilities.selectFile({windowId:this.context.vivaldiWindowId,title:(0,B.Z)("Select a Blocker List Text File"),type:"file",accepts:[{ext:"txt"}]}).then((e=>{e&&this.importFromFile(e)}));importFromFile=e=>{se.Z.contentBlocking.addKnownSourceFromFile(this.props.ruleGroup,e,{allow_abp_snippets:this.state.allowSnippets,naked_hostname_is_pure_host:this.state.pureHost,use_whole_document_allow:this.state.documentAllow},(e=>this.finishImport(e)))};importFromUrl=()=>{this.state.newSource.includes(n$)?this.setState({importError:(0,B.Z)("Failed to add internal list.")}):se.Z.contentBlocking.addKnownSourceFromURL(this.props.ruleGroup,this.state.newSource,{allow_abp_snippets:this.state.allowSnippets,naked_hostname_is_pure_host:this.state.pureHost,use_whole_document_allow:this.state.documentAllow},(e=>this.finishImport(e)))};finishImport=e=>{i.Z.runtime.lastError?(console.warn(Object.values(i.Z.runtime.lastError)),this.setState({cachedSource:void 0,importError:(0,B.Z)("Failed to add list")})):se.Z.contentBlocking.getRuleSource(this.props.ruleGroup,e,(e=>{this.setState({cachedSource:e,allowSnippets:e.settings.allow_abp_snippets,pureHost:e.settings.naked_hostname_is_pure_host,documentAllow:e.settings.use_whole_document_allow,showEditor:2,importError:""},(()=>{this.updateCachedSource()}))}))};onToggleStatus=e=>{this.state.sortedList[e]&&this.toggleStatus(this.state.sortedList[e].id)};toggleStatus=e=>{const t=this.state.blockerSources.find((t=>t.id===e));t&&(t.loaded?se.Z.contentBlocking.disableSource(this.props.ruleGroup,e):se.Z.contentBlocking.enableSource(this.props.ruleGroup,e))};editSource=e=>{const t=this.state.blockerSources.find((t=>e===t.id));t&&this.setState({cachedSource:t,allowSnippets:t.settings.allow_abp_snippets,pureHost:t.settings.naked_hostname_is_pure_host,documentAllow:t.settings.use_whole_document_allow,showEditor:4,importError:""})};copySource=e=>{const t=this.state.blockerSources.find((t=>e===t.id));if(t){const e=t.is_from_url?t.source_url:t.source_file;Gp.Z.set(e)}};onRemoveSource=e=>{this.state.sortedList[e]&&this.removeSource(this.state.sortedList[e].id)};removeSource=e=>{se.Z.contentBlocking.deleteKnownSource(this.props.ruleGroup,e)};restoreSources=()=>{se.Z.contentBlocking.resetPresetSources(this.props.ruleGroup),this.updateSources()};onContextMenu=(e,t)=>{const n=this.state.sortedList[e];if(!n)return;const i=[{handler:this.copySource.bind(null,n.id),...(0,us.Z)("Copy List Origin")},{handler:this.toggleStatus.bind(null,n.id),isVisible:()=>!n.enabled,...(0,us.Z)("Enable List")},{handler:this.toggleStatus.bind(null,n.id),isVisible:()=>n.enabled,...(0,us.Z)("Disable List")},{...Qe.Z.separatorItem,isVisible:()=>!n.isDefault},{handler:this.editSource.bind(null,n.id),isVisible:()=>!n.isDefault,...(0,us.Z)("Edit List")},{handler:this.removeSource.bind(null,n.id),isVisible:()=>!n.isDefault,...(0,us.Z)("Remove List")},{handler:this.restoreSources,isVisible:()=>"ad_blocking"===this.props.ruleGroup,...(0,us.Z)("Restore Built-In Lists")}];(0,cs.Z)(this.context,i)(t)};showDialog=()=>{this.setState({showEditor:1})};onCancel=()=>{4!==this.state.showEditor&&this.state.cachedSource&&this.removeSource(this.state.cachedSource.id),this.closeDialog()};closeDialog=()=>{this.setState({cachedSource:void 0,newSource:"",importError:"",showEditor:0,...d$})};saveSettings=()=>{const{cachedSource:e,allowSnippets:t,pureHost:n,documentAllow:i}=this.state;e&&se.Z.contentBlocking.setKnownSourceSettings(this.props.ruleGroup,e.id,{allow_abp_snippets:t,naked_hostname_is_pure_host:n,use_whole_document_allow:i},(()=>{this.closeDialog(),this.updateSources()}))};renderOptions=()=>{const{cachedSource:e,allowSnippets:t,pureHost:n,documentAllow:i}=this.state;return(0,ss.jsxs)(ss.Fragment,{children:[a$("div",{className:"dialog-row"},void 0,a$("label",{},void 0,a$("input",{type:"checkbox",checked:t,disabled:e?.loaded,onChange:()=>this.setState({allowSnippets:!t})}),a$("span",{},void 0,(0,B.Z)("Allow List to Use ABP Snippet Rules"))),a$("p",{className:"info"},void 0,(0,B.Z)("ABP snippet rules can be misused for malicious script injection.")),this.state.allowSnippets&&a$(To,{type:"warning"},void 0,(0,B.Z)("Make sure you trust the author of the list."))),a$("div",{className:"dialog-row"},void 0,a$("label",{},void 0,a$("input",{type:"checkbox",checked:n,disabled:e?.loaded,onChange:()=>this.setState({pureHost:!n})}),a$("span",{},void 0,(0,B.Z)("Treat Plain Hostnames as a Pure Hostname Rule"))),a$("p",{className:"info"},void 0,(0,B.Z)("Disable this if the rule list expects to match hostnames in any part of the URL."))),a$("div",{className:"dialog-row"},void 0,a$("label",{},void 0,a$("input",{type:"checkbox",checked:i,disabled:e?.loaded,onChange:()=>this.setState({documentAllow:!i})}),a$("span",{},void 0,(0,B.Z)("Rules that allow the document type cause all resources to be allowed for matching pages."))),a$("p",{className:"info"},void 0,(0,B.Z)("This is the ABP behavior for document rules. The uBlock behavior is active regardless of this setting.")))]})};renderDialog=()=>{const{cachedSource:e,showEditor:t}=this.state,n=e?e.unsafe_adblock_metadata:void 0,i=e&&e.loaded;return a$(ra.Z,{style:r$,className:"float",onRequestClose:this.state.showEditor<2?this.onCancel:Lr.Z,labelledBy:ra.t},void 0,a$("form",{className:"ContentBlocker-Import"},void 0,a$("header",{className:"dialog-header"},void 0,a$("h1",{className:"dialog-title",id:ra.t},void 0,4!==t?(0,B.Z)("Import New Blocker List"):(0,B.Z)("Edit Blocker List"))),1===t&&a$("div",{className:"dialog-content"},void 0,a$("p",{className:"info"},void 0,(0,B.Z)("Enter URL to import blocker rules")),a$("div",{className:"dialog-row input"},void 0,a$("input",{type:"text",value:this.state.newSource,onChange:this.updateNewSource,autoFocus:!0}),a$("label",{className:"button-toolbar"},void 0,a$("button",{className:"FormButton",type:"button",title:(0,B.Z)("Import from a file..."),dangerouslySetInnerHTML:{__html:Wi._TQ.small},onClick:this.onImportFromFile}))),this.renderOptions()),e&&2===t&&a$("div",{className:"dialog-content"},void 0,a$("h3",{},void 0,(0,B.Z)("Loading..."))),e&&3===t&&a$("div",{className:"dialog-content"},void 0,n?.title&&a$("h3",{},void 0,n.title),a$("p",{className:"info"},void 0,e.source_url),a$("p",{},void 0,(0,B.Z)("Valid rules: $1",[e.rules_info.valid_rules]),c$,(0,B.Z)("Invalid rules: $1",[e.rules_info.invalid_rules]),u$,(0,B.Z)("Unsupported rules: $1",[e.rules_info.unsupported_rules]))),e&&4===t&&a$("div",{className:"dialog-content"},void 0,i&&a$(To,{type:"info"},void 0,(0,B.Z)("Please disable the source list before editing.")),a$("p",{},void 0,(0,B.Z)("Source:")," ",e.source_url||e.source_file),this.renderOptions()),a$("footer",{className:"dialog-footer"},void 0,this.state.importError&&a$("p",{className:"info"},void 0,this.state.importError),(1===t||2===t)&&a$("input",{type:"submit",onClick:this.importFromUrl,value:(0,B.Z)("Import...")}),3===t&&a$("input",{type:"submit",onClick:this.closeDialog,value:(0,B.Z)("blocker","Done"),autoFocus:!0}),4===t&&a$("input",{type:"submit",onClick:this.saveSettings,disabled:e?.loaded,value:(0,B.Z)("blocker","Save"),autoFocus:!0}),a$("input",{type:"button",onClick:this.onCancel,value:(0,B.Z)("Cancel")}))))};renderItem=(e,t)=>{const n=this.state.blockerSources.find((e=>t.id===e.id));return n?a$("div",{className:"ContentBlocker-SourceItem"},void 0,a$("input",{type:"checkbox",onMouseDown:e=>e.stopPropagation(),checked:t.enabled,onChange:this.toggleStatus.bind(null,n.id)}),a$("span",{className:"title"},void 0,e),a$("p",{className:"info"},void 0,""!==n.rules_list_checksum?(0,B.Z)("Updated on $1",[W()(n.last_update).format("lll")]):n.loaded?(0,B.Z)("Not fetched"):(0,B.Z)("Disabled"),n.is_fetching?" "+(0,B.Z)("(Fetching...)"):"")):null};render(){const{sortedList:e}=this.state,t=Math.min(44*e.length+22,200);return(0,ss.jsxs)(ss.Fragment,{children:[0!==this.state.showEditor&&this.renderDialog(),a$("h3",{},void 0,this.props.title),a$("div",{className:"ContentBlocker-Sources",style:{minHeight:t}},void 0,a$(lk.Z,{items:e,renderListItem:this.renderItem,filter:this.props.filter,onActivate:this.onToggleStatus,onContextMenu:this.onContextMenu,onCreateItem:this.showDialog,onRemove:this.onRemoveSource,addTipString:(0,B.Z)("Add List"),deleteTipString:(0,B.Z)("Remove List"),supportDragAndDrop:!1}))]})}}const h$=p$;var g$,m$=n(96405);function f$(e,t,n,i){g$||(g$="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:g$,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const v$=["tracking","ad_blocking"],y$={width:500,minWidth:"unset"};function b$(e){const t=Li.useContext(ts.Z),n=Li.useRef(),i=Li.useRef(),[s,o]=Li.useState(void 0),[a,r]=Li.useState([]),[l,d]=Li.useState(!1),[c,u]=Li.useState(!1),[p,h]=Li.useState({name:"",level:"2"}),[g,m]=Li.useState(!1),[f,v]=Li.useState(!1),[y,b]=Li.useState(!1),S=Li.useCallback((()=>se.Z.contentBlocking.getAllExceptionLists((e=>{const t=Object.values(e).reduce(((e,t)=>e.concat(t.exempt_list).concat(t.process_list)),[]),n=T((0,m$.Z)(t).sort());o(e),r(n)}))),[]),w=Li.useCallback((()=>v$.forEach((e=>(0,SC.pg)(e,(e=>{e.hasOwnProperty("trackerBlockingEnabled")&&d(e.trackerBlockingEnabled),e.hasOwnProperty("adBlockingEnabled")&&u(e.adBlockingEnabled),S()}))))),[S]);Li.useEffect((()=>(w(),S(),se.Z.contentBlocking.onExceptionsChanged.addListener(S),se.Z.contentBlocking.onStateChanged.addListener(w),()=>{se.Z.contentBlocking.onExceptionsChanged.removeListener(S),se.Z.contentBlocking.onStateChanged.removeListener(w)})),[w,S]);const C=e=>{const{value:t}=e.target;switch(t){case"0":se.Z.contentBlocking.setActiveExceptionsList("tracking","process_list"),se.Z.contentBlocking.setActiveExceptionsList("ad_blocking","process_list");break;case"1":se.Z.contentBlocking.setActiveExceptionsList("tracking","exempt_list"),se.Z.contentBlocking.setActiveExceptionsList("ad_blocking","process_list");break;case"2":se.Z.contentBlocking.setActiveExceptionsList("tracking","exempt_list"),se.Z.contentBlocking.setActiveExceptionsList("ad_blocking","exempt_list")}w()},A=e=>{if("number"==typeof e&&a){const t=a[e].key;["tracking","ad_blocking"].forEach((e=>["process_list","exempt_list"].forEach((n=>se.Z.contentBlocking.removeExceptionForDomain(e,n,t))))),S()}},I=()=>{["tracking","ad_blocking"].forEach((e=>["process_list","exempt_list"].forEach((t=>se.Z.contentBlocking.removeAllExceptions(e,t))))),S()},T=e=>e?e.map((e=>({key:e,name:e}))):[],Z=e=>{const t=e.currentTarget;"name"===t.name?h((e=>({...e,name:t.value}))):h((e=>({...e,level:t.value})))},E=()=>{h((e=>({...e,name:""}))),m(!1),b(!1)},k=()=>{const e=(0,rl.Ph)((0,rl.Qj)(p.name));e?((0,SC.fs)(e,p.level),E()):b(!0)},_=e=>{const{name:t,value:n}=e.target,i=he.ZP.isSettings(he.ZP.getActiveWindowId())?void 0:Ce.ZP.getActivePage(he.ZP.getLastActiveBrowserWindowId())?.id;(0,SC.fs)(t,n,i)},N=0+(l?1:0)+(c?1:0);return f$(tN.Z,{categoryTitle:(0,B.Z)("title","Tracker and Ad Blocking"),"data-anchor":"tracker_and_ad_blocking",filter:e.filter},void 0,g&&f$(ra.Z,{style:y$,onRequestClose:E,className:"float",title:(0,B.Z)("Add a New Site to Exception List")},void 0,f$("form",{className:"ContentBlocker-Exception"},void 0,f$("div",{className:"dialog-content"},void 0,f$("input",{type:"text",name:"name",placeholder:(0,B.Z)("e.g. example.com"),value:p.name,onChange:Z,autoFocus:!0}),y&&f$("p",{className:"info"},void 0,(0,B.Z)("Enter a valid domain name excluding the protocol")),f$(ta.Z,{value:p.level,onChange:Z,name:"level"},void 0,f$("option",{value:"0"},void 0,(0,B.Z)("No Blocking")),f$("option",{value:"1"},void 0,(0,B.Z)("Block Trackers")),f$("option",{value:"2"},void 0,(0,B.Z)("Block Trackers and Ads")))),f$("footer",{className:"dialog-footer"},void 0,f$("input",{type:"submit",className:"primary",onClick:k,value:(0,B.Z)("other","Add Site")}),f$("input",{type:"button",onClick:E,value:(0,B.Z)("Cancel")})))),f$("div",{className:"ContentBlocker-Rules"},void 0,f$("div",{className:"setting-group setting-group-double"},void 0,f$("h3",{},void 0,(0,B.Z)("Blocking Level")),f$("p",{className:"info"},void 0,(0,B.Z)("Select default level of protection.")),f$("label",{className:Fi()({"ContentBlocker-Setting":!0,"ContentBlocker-Setting--Active":0===N})},void 0,f$("button",{value:"0",title:(0,B.Z)("No content blocking will be applied to any site by default."),onClick:C,className:"ContentBlocker-Control",style:{"--no-blocking":1,"--base":0},dangerouslySetInnerHTML:{__html:Wi.Tu3}}),f$("span",{className:"keep-ea-words"},void 0,(0,B.Z)("No Blocking"))),f$("label",{className:Fi()({"ContentBlocker-Setting":!0,"ContentBlocker-Setting--Active":1===N})},void 0,f$("button",{value:"1",title:(0,B.Z)("Online trackers collect personal information and browsing habits across multiple sites."),onClick:C,className:"ContentBlocker-Control",style:{"--trackers":1},dangerouslySetInnerHTML:{__html:Wi.Tu3}}),f$("span",{className:"keep-ea-words"},void 0,(0,B.Z)("Block Trackers"))),f$("label",{className:Fi()({"ContentBlocker-Setting":!0,"ContentBlocker-Setting--Active":2===N})},void 0,f$("button",{value:"2",title:(0,B.Z)("Web advertisement supports existence of many sites but can also be used to build a personal profile for monetization."),onClick:C,className:"ContentBlocker-Control",style:{"--ads":1},dangerouslySetInnerHTML:{__html:Wi.Tu3}}),f$("span",{className:"keep-ea-words"},void 0,(0,B.Z)("Block Trackers and Ads")))),f$("div",{className:"setting-group setting-group-double"},void 0,f$("h3",{},void 0,(0,B.Z)("Exceptions")),f$("p",{className:"info"},void 0,(0,B.Z)("Manage blocking level per site")),a&&f$("div",{className:"ContentBlocker-Exceptions"},void 0,(0,ss.jsx)(lk.Z,{ref:i,items:a,renderListItem:(e,t)=>{if(!t)return null;const n=(e=>{if(!s)return;let t=0;return!s.tracking.process_list.includes(e)&&s.tracking.exempt_list.includes(e)||t++,!s.ad_blocking.process_list.includes(e)&&s.ad_blocking.exempt_list.includes(e)||t++,t})(t.key);return(0,ss.jsxs)(ss.Fragment,{children:[f$("span",{},void 0,e),f$("select",{value:n,name:t.name,onMouseDown:e=>e.stopPropagation(),onChange:_,tabIndex:"-1"},void 0,f$("option",{value:"0"},void 0,(0,B.Z)("No Blocking")),f$("option",{value:"1"},void 0,(0,B.Z)("Block Trackers")),f$("option",{value:"2"},void 0,(0,B.Z)("Block Trackers and Ads")))]})},filter:e.filter,onContextMenu:(e,n)=>{const i=[{handler:A.bind(null,e),...(0,us.Z)("Remove Site")},{handler:I,...(0,us.Z)("Remove All Sites from List")}];(0,cs.Z)(t,i)(n)},onCreateItem:()=>m(!0),onRemove:A,addTipString:(0,B.Z)("Add Site Exception"),deleteTipString:(0,B.Z)("Remove Site Exception"),supportDragAndDrop:!1,onSelectItem:e=>{const{HTMLSelectElement:s}=t,o=i.current?.refItems.current?.children;if(!o||0===o.length)return;const a=o[e].children[1];a instanceof s&&(n.current=a)},onActivate:(e,t)=>{t.target!==n.current&&n.current?.focus()}})),f$("input",{type:"button",value:f?(0,B.Z)("Hide Sources"):(0,B.Z)("Manage Sources"),onClick:()=>v((e=>!e))})),f&&(0,ss.jsxs)(ss.Fragment,{children:[f$("div",{className:"setting-group setting-group-double"},void 0,f$("div",{className:"setting-single"},void 0,f$(h$,{filter:e.filter,ruleGroup:"tracking",title:(0,B.Z)("Tracker Blocking Sources")}))),f$("div",{className:"setting-group setting-group-double"},void 0,f$("div",{className:"setting-single"},void 0,f$(h$,{filter:e.filter,ruleGroup:"ad_blocking",title:(0,B.Z)("Ad Blocking Sources")})))]})))}const S$=Li.memo(b$);var w$;function C$(e,t,n,i){w$||(w$="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:w$,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class A$ extends Li.PureComponent{refButton=Li.createRef();handleDelete=async e=>{(0,ms.ZP)(e),this.props.onDeleteCookie(this.props.domain)};handleDeleteCookie=async(e,t)=>{(0,ms.ZP)(e),this.props.onDeleteCookie(this.props.domain,t)};toggleDetail=()=>{this.props.viewCookies?(this.props.onCollapse(this.props.domain),this.props.onHideInfo(this.props.domain)):this.props.onExpand(this.props.domain)};showDetail=()=>{this.props.onExpand(this.props.domain)};hideDetail=()=>{this.props.onHideInfo(this.props.domain),this.props.onCollapse(this.props.domain)};handleRowClicked=e=>{this.refButton.current?.focus(),this.toggleDetail()};showInfo=e=>{this.props.onShowInfo(this.props.domain,e)};focusCookie=e=>{const t=e.currentTarget,n=this.refButton.current?.querySelectorAll("a");if(n?.length)switch(e.key){case"ArrowRight":let e=Array.from(n).indexOf(t)+1;e>=n.length&&(e=0),n[e].focus();break;case"ArrowLeft":const i=Array.from(n).indexOf(t)-1;i<0?(this.toggleDetail(),this.refButton.current?.focus()):n[i].focus()}};sameSitePolicy=e=>{switch(e){case"no_restriction":return(0,B.Z)("policy","no restriction");case"lax":return(0,B.Z)("policy","lax");case"strict":return(0,B.Z)("policy","strict");default:return(0,B.Z)("policy","unspecified")}};handleKeyDown=e=>{switch(e.key){case"Enter":(0,ms.ZP)(e),this.toggleDetail();break;case"ArrowRight":(0,ms.ZP)(e),this.props.viewCookies?this.focusCookie(e):this.showDetail();break;case"ArrowLeft":(0,ms.ZP)(e),this.focusCookie(e);break;case"Escape":(0,ms.ZP)(e),this.hideDetail(),this.refButton.current?.focus();break;case"Delete":(0,ms.ZP)(e),this.props.onDeleteCookie(this.props.domain,this.props.viewInfo);break;default:this.props.onKeyDown(e)}};renderCookies=()=>this.props.items.map((e=>C$("a",{tabIndex:"0",onFocus:()=>this.showInfo(e),onKeyDown:this.handleKeyDown,title:e.name},"cookie-"+e.name.toLowerCase(),C$("span",{},void 0,e.name),C$("input",{type:"button",className:"circular clearkey",tabIndex:-1,title:(0,B.Z)("Delete cookie"),onMouseDown:ms.ZP,onClick:t=>this.handleDeleteCookie(t,e)}))));renderInfo=()=>{if(!this.props.viewInfo)return null;const{expirationDate:e,hostOnly:t,httpOnly:n,name:i,partitionKey:s,path:o,sameSite:a,secure:r,session:l,storeId:d,value:c}=this.props.viewInfo,u=e?W()(Math.round(1e3*e)).format("L LT"):(0,B.Z)("unset");return C$("dl",{},void 0,C$("dt",{},void 0,(0,B.Z)("Name:")),C$("dd",{className:"selectable"},void 0,i),C$("dt",{},void 0,(0,B.Z)("Expires:")),C$("dd",{className:"selectable"},void 0,u),C$("dt",{},void 0,(0,B.Z)("Session:")),C$("dd",{className:"selectable"},void 0,l.toString()),C$("dt",{},void 0,(0,B.Z)("Path:")),C$("dd",{className:"selectable"},void 0,o),C$("dt",{},void 0,(0,B.Z)("Secure:")),C$("dd",{className:"selectable"},void 0,r.toString()),C$("dt",{},void 0,(0,B.Z)("Host Only:")),C$("dd",{className:"selectable"},void 0,t.toString()),C$("dt",{},void 0,(0,B.Z)("HTTP Only:")),C$("dd",{className:"selectable"},void 0,n.toString()),C$("dt",{},void 0,(0,B.Z)("Store ID:")),C$("dd",{className:"selectable"},void 0,d),C$("dt",{},void 0,(0,B.Z)("Same Site:")),C$("dd",{className:"selectable"},void 0,this.sameSitePolicy(a)),s&&(0,ss.jsxs)(ss.Fragment,{children:[C$("dt",{},void 0,(0,B.Z)("Partition Key:")),C$("dd",{className:"selectable"},void 0,s.topLevelSite)]}),C$("dt",{},void 0,(0,B.Z)("Value:")),C$("dd",{className:"selectable"},void 0,unescape(c)))};render(){const{domain:e,index:t}=this.props,n=e.replace(/^\./,""),i=(0,rl.q9)(n);return(0,ss.jsxs)("button",{id:e,ref:this.refButton,style:{...this.props.style,overflowY:this.props.viewCookies?"auto":"hidden"},onKeyDown:this.handleKeyDown,className:t%2==0?"even":"odd",children:[C$("div",{className:"overview",onClick:this.handleRowClicked},void 0,C$(Ri.ZP,{className:"site-icon",url:i,loadType:"page"}),C$("span",{className:"domain"},void 0,e),!this.props.viewCookies&&C$("span",{className:"count"},void 0,this.props.count),C$("span",{className:"controls"},void 0,C$("input",{type:"button",className:"circular clearkey",tabIndex:-1,title:(0,B.Z)("Delete all domain cookies"),onClick:this.handleDelete}))),this.props.viewCookies&&C$("div",{className:"detail"},void 0,this.renderCookies(),this.props.viewInfo&&C$("div",{className:"info"},void 0,this.renderInfo()))]})}}const I$=A$;var T$,Z$=n(78330),E$=n(34155);function k$(e,t,n,i){T$||(T$="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:T$,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const _$={width:400,minWidth:"unset"};class N$ extends Li.PureComponent{static contextType=ts.Z;refList=Li.createRef();#Wt=Li.createRef();visibleCookies=new Map;state={cookieData:{},cookieFilter:"",confirmation:!1,showCookies:!1,domains:[],expandedItems:[]};componentDidMount(){i.Z.cookies.onChanged.addListener(this.cookieChangeListener),this.getAllCookies()}componentWillUnmount(){i.Z.cookies.onChanged.removeListener(this.cookieChangeListener)}cookieChangeListener=e=>{const{removed:t}=e;t&&this.debouncedGetAllCookies()};getAllCookies=async()=>{const e=(await i.Z.cookies.getAll({partitionKey:{}})).reduce(((e,t)=>{const n=e[t.domain]||[];return n.push(t),e[t.domain]=n,e}),{}),t=this.state.cookieFilter.toLowerCase();this.setState({cookieData:e,domains:Object.keys(e).filter((e=>e.includes(t))).sort()},(()=>{E$.nextTick((()=>{this.refList.current?.recomputeRowHeights(),this.refList.current?.forceUpdate()}))}))};debouncedGetAllCookies=(0,Ae.Z)(this.getAllCookies);deleteFilteredCookies=async()=>{const e=await i.Z.cookies.getAll({});await Promise.all(e.map((e=>e.domain.toLowerCase().includes(this.state.cookieFilter.toLowerCase())?i.Z.cookies.remove({url:this.getCookieUrl(e),name:e.name}):Promise.resolve())))};deleteAllCookies=async()=>{const e=await i.Z.cookies.getAll({});await Promise.all(e.map((e=>i.Z.cookies.remove({url:this.getCookieUrl(e),name:e.name})))),this.setState({cookieData:{},confirmation:!1,showCookies:!1,domains:[]})};getButtons=()=>Array.from(this.context.document.querySelectorAll(".setting-group.setting-cookies button"));getCookieUrl=e=>"http"+(e.secure?"s":"")+"://"+e.domain+e.path;removeChromeEntry=async e=>{await i.Z.cookies.remove({url:this.getCookieUrl(e),name:e.name,partitionKey:e.partitionKey})};handleDeleteCookie=async(e,t)=>{const{cookieData:n}=this.state,i=n[e];t&&i.length>1?(this.focusNextCookie(e,t),await this.removeChromeEntry(t)):(this.collapseRow(e),E$.nextTick((()=>{const t=this.getButtons();if(t.length>1){const n=t.findIndex((t=>t.id===e));(t[n]??t[n-1])?.focus()}else this.#Wt.current?.focus();Promise.all(i.map(this.removeChromeEntry))})))};focusNextCookie=(e,t)=>{const n=this.getButtons().find((t=>t.id===e)),i=Array.from(n?.querySelectorAll("a")??[]),s=i.findIndex((e=>e.title===t.name));(i[s+1]??i[s-1]??i[0])?.focus()};onSettingsFilter=e=>{this.setState({cookieFilter:e.target.value},(()=>{Li.startTransition((()=>{const e=this.state.cookieFilter.toLowerCase();this.setState((t=>({domains:Object.keys(t.cookieData).filter((t=>t.includes(e))).sort()})))}))}))};onAskToDelete=()=>{this.setState({confirmation:!0})};onCancel=()=>{this.setState({confirmation:!1})};renderModal=()=>k$(ra.Z,{style:_$,onRequestClose:this.onCancel,title:(0,B.Z)("Delete All Cookies?")},void 0,k$("div",{className:"dialog-delete-cookies"},void 0,k$("div",{className:"dialog-content"},void 0,k$("p",{},void 0,(0,B.Z)("All cookies will be removed."))),k$("footer",{className:"dialog-footer"},void 0,k$("input",{type:"button",className:"primary",onClick:this.deleteAllCookies,value:(0,B.Z)("other","Delete"),autoFocus:!0}),k$("input",{type:"button",onClick:this.onCancel,value:(0,B.Z)("Cancel")}))));showCookieList=()=>{this.setState((e=>({showCookies:!e.showCookies})))};handleKeyDown=e=>{const{HTMLAnchorElement:t}=this.context,n=e.currentTarget instanceof t?e.currentTarget.parentElement?.parentElement:e.currentTarget,i=this.getButtons();if(i?.length)switch(e.key){case"ArrowUp":(0,ms.ZP)(e);const s=Array.from(i).indexOf(n),o=e.currentTarget instanceof t?s:s-1;o>=0&&i[o].focus();break;case"Delete":case"ArrowDown":(0,ms.ZP)(e);const a=Array.from(i).indexOf(n)+1;a<i.length&&i[a].focus();break;default:return}};handleExpandRow=e=>{this.setState((t=>({expandedItems:t.expandedItems.concat([e])}))),this.refList.current?.recomputeRowHeights(),this.refList.current?.forceUpdate()};collapseRow=e=>{this.setState((t=>({expandedItems:t.expandedItems.filter((t=>t!==e))}))),this.refList.current?.recomputeRowHeights(),this.refList.current?.forceUpdate()};handleShowInfo=(e,t)=>{this.visibleCookies.set(e,t),this.refList.current?.recomputeRowHeights(),this.refList.current?.forceUpdate()};hideInfo=e=>{this.visibleCookies.delete(e),this.refList.current?.recomputeRowHeights(),this.refList.current?.forceUpdate()};getRowHeight=({index:e})=>{const t=this.state.domains[e];if(this.state.expandedItems.includes(t)){const e=this.refList.current?.props.width,n=e?Math.floor(e/120):1,i=1+Math.ceil(this.state.cookieData[t].length/n);return this.visibleCookies.get(t)?28*i+230:28*i}return 28};renderRow=({index:e,parent:t,key:n,style:i})=>{const{domains:s,expandedItems:o,cookieData:a}=this.state,r=s[e],l=a[r];return k$(I$,{style:i,domain:r,index:e,count:l.length,items:l,onKeyDown:this.handleKeyDown,onExpand:this.handleExpandRow,onCollapse:this.collapseRow,viewCookies:o.includes(r),viewInfo:this.visibleCookies.get(r),onShowInfo:this.handleShowInfo,onHideInfo:this.hideInfo,onDeleteCookie:this.handleDeleteCookie},n)};render(){if(!this.state.cookieData)return k$("div",{className:"saved-passwords"},void 0,k$("p",{},void 0,(0,B.Z)("No cookies found.")));const{cookieData:e,cookieFilter:t,domains:n}=this.state,i=n.length,s=n.reduce(((t,n)=>t+e[n].length),0);return k$(iA.Z,{filter:this.props.filter},void 0,k$("div",{className:"setting-group setting-cookies unlimited",style:{"--cookieWidth":"120px"}},void 0,this.state.confirmation&&this.renderModal(),k$("h3",{},void 0,(0,B.Z)("Saved Cookies")),k$("p",{},void 0,(0,B.Z)("Vivaldi currently stores $1 cookie entry $2.","Vivaldi currently stores $1 cookie entries $2.",[s,(0,B.Z)("from $1 domain","from $1 domains",[i])])),this.state.showCookies&&(0,ss.jsxs)(ss.Fragment,{children:[k$("div",{className:"setting-single"},void 0,(0,ss.jsx)("input",{type:"search",ref:this.#Wt,placeholder:(0,B.Z)("Filter by domain"),value:t,onChange:this.onSettingsFilter})),0===i&&t&&k$("div",{className:"empty-cookie-items"},void 0,(0,B.Z)("Query “$1” matches no result.",[t])),k$("div",{className:"cookie-list"},void 0,k$("div",{className:"setting-single cookie-items"},void 0,k$(Z$.q,{},void 0,(({height:e,width:t})=>(0,ss.jsx)(ws.aV,{ref:this.refList,width:t,height:e,rowHeight:this.getRowHeight,rowRenderer:this.renderRow,rowCount:i})))))]}),k$("div",{className:"setting-single"},void 0,k$("input",{type:"button",value:this.state.showCookies?(0,B.Z)("Hide Saved Cookies"):(0,B.Z)("Show Saved Cookies"),disabled:0===s,onClick:this.showCookieList}),k$("input",{type:"button",className:"danger",onClick:this.onAskToDelete,disabled:0===s,value:(0,B.Z)("Delete All Cookies")}),t&&k$("input",{type:"button",onClick:this.deleteFilteredCookies,value:(0,B.Z)("Delete Filtered Cookies")}))))}}const P$=N$;var D$;function M$(e,t,n,i){D$||(D$="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:D$,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const O$=[I.kExceptionsCookies];function x$(e){const t=(0,Ya.Z)(O$),[n,i]=Li.useState(""),[s,o]=Li.useState("off");Li.useEffect((()=>{se.Z.utilities.getDefaultContentSettings("cookies",(e=>{i(e)})),se.Z.utilities.getBlockThirdPartyCookies((e=>{o(e)}))}),[]);const a=()=>Object.keys(t[I.kExceptionsCookies]).filter((e=>e.startsWith("*,"))).map((e=>({key:e,name:e.replace("*,","")})),[]).sort(),r="block"===n,l=a();return M$(tN.Z,{categoryTitle:(0,B.Z)("Cookies"),filter:e.filter,"data-anchor":"cookies"},void 0,M$("p",{className:"info"},void 0,(0,B.Z)("Manage default cookie policy in Global Website Permissions.")),M$(P$,{filter:e.filter}),M$("div",{className:"setting-group"},void 0,M$("h3",{},void 0,(0,B.Z)("Third-Party Cookies")),M$("p",{className:"info"},void 0,(0,B.Z)("Disabling third party cookies might make some pages fail to work as intended.")),M$(ja.Z,{className:"cookieSelection",name:"cookieSelGroup2",value:s,onChange:e=>{const t=e.target.value;se.Z.utilities.setBlockThirdPartyCookies(t,(e=>{})),o(t)}},void 0,M$("div",{className:"setting-single"},void 0,M$("label",{},void 0,M$("input",{type:"radio",value:"off",disabled:r}),M$("span",{},void 0,(0,B.Z)("radio","Allow All")))),M$("div",{className:"setting-single"},void 0,M$("label",{},void 0,M$("input",{type:"radio",value:"BlockThirdPartyIncognitoOnly",disabled:r}),M$("span",{},void 0,(0,B.Z)("radio","Block in Incognito Mode Only")))),M$("div",{className:"setting-single"},void 0,M$("label",{},void 0,M$("input",{type:"radio",value:"BlockThirdParty",disabled:r}),M$("span",{},void 0,(0,B.Z)("radio","Block All")))))),l.length>0&&M$("div",{className:"setting-group setting-group-double"},void 0,M$("h3",{},void 0,(0,B.Z)("Third Party Cookie Exceptions")),M$("p",{className:"info"},void 0,(0,B.Z)("Manage sites allowing third-party cookies.")),M$(lk.Z,{items:l,filter:e.filter,renderListItem:(e,t)=>M$("span",{},void 0,e),onRemove:e=>{const n=a()[e].key,i=structuredClone(t[I.kExceptionsCookies]);delete i[n],Object.keys(i).length?w.Z.set(I.kExceptionsCookies,i):w.Z.reset(I.kExceptionsCookies)},deleteTipString:(0,B.Z)("Remove Domain"),supportDragAndDrop:!1})))}const L$=Li.memo(x$);(0,B.Z)("title","Name"),(0,B.Z)("Latitude"),(0,B.Z)("Longitude"),(0,B.Z)("Add your First Geolocation"),(0,B.Z)("Press the “Add” button to the left to add a new Geolocation"),lF.lE.map((e=>({label:e.value,key:e.key,local:e.local}))),[...te.z].map((e=>{const t=e.replace(/_/g," ");return{identifier:e,label:t}}));I.kGeolocationAccuracy,I.kGeolocationDefaultLocationId,I.kGeolocationLatitude,I.kGeolocationList,I.kGeolocationLongitude,I.kGeolocationUseOverride,pn.jk.settingCategories,w.Z.getEventHandler;var R$;function B$(e,t,n,i){R$||(R$="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:R$,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const F$=[I.kAutofillCreditCardEnabled],W$=(new Date).getFullYear(),U$=(new Date).getMonth()+1,V$={guid:void 0,instrumentId:void 0,name:"",cardNumber:"",expirationMonth:String(U$),expirationYear:String(W$),nickname:"",network:void 0,imageSrc:void 0,cvc:void 0,productTermsUrl:void 0,metadata:void 0};class H$ extends Li.PureComponent{static contextType=ts.Z;getCreditCardsList(){i.Z.autofillPrivate.getCreditCardList((e=>{this.setState({creditCards:e})}))}constructor(e){super(e),this.state={creditCards:[],dialogVisible:"none",dialogCard:V$}}componentDidMount(){this.getCreditCardsList(),i.Z.autofillPrivate.onPersonalDataChanged.addListener((()=>{this.getCreditCardsList()}))}componentWillUnmount(){i.Z.autofillPrivate.onPersonalDataChanged.removeListener((()=>{this.getCreditCardsList()}))}handleInputChange(e){const{name:t,value:n}=e.target;this.setState((e=>({dialogCard:{...e.dialogCard,[t]:n}})))}handleOnCloseDialog=()=>{this.setState({dialogVisible:"none",dialogCard:V$})};showEditCardDialog=e=>{e&&i.Z.autofillPrivate.getLocalCard(e).then((e=>{this.setState({dialogVisible:"edit",dialogCard:e})}))};showNewCardDialog=()=>{this.setState({dialogVisible:"new",dialogCard:V$})};saveCardAndCloseDialog=()=>{i.Z.autofillPrivate.saveCreditCard(this.state.dialogCard),this.handleOnCloseDialog()};deleteCardAndCloseDialog=()=>{"edit"===this.state.dialogVisible&&this.state.dialogCard.guid&&i.Z.autofillPrivate.removeEntry(this.state.dialogCard.guid),this.handleOnCloseDialog()};renderCreditCardIcon=e=>{if(e.network)switch(e.network){case"Amex":return B$("span",{dangerouslySetInnerHTML:{__html:Wi.tl8}});case"Diners Club":return B$("span",{dangerouslySetInnerHTML:{__html:Wi.e$7}});case"Discover":return B$("span",{dangerouslySetInnerHTML:{__html:Wi.POA}});case"Elo":return B$("span",{dangerouslySetInnerHTML:{__html:Wi.$KT}});case"JCB":return B$("span",{dangerouslySetInnerHTML:{__html:Wi.pM3}});case"Mastercard":return B$("span",{dangerouslySetInnerHTML:{__html:Wi.S2C}});case"China UnionPay":return B$("span",{dangerouslySetInnerHTML:{__html:Wi.NmO}});case"Visa":return B$("span",{dangerouslySetInnerHTML:{__html:Wi.R7A}})}return B$("span",{dangerouslySetInnerHTML:{__html:Wi.rur}})};renderCard=e=>e&&B$("div",{className:"CardDisplay"},e.guid,this.renderCreditCardIcon(e),B$("div",{className:"CardDisplay-Details"},void 0,B$("span",{className:"CardDisplay-Label"},void 0,e.nickname?e.nickname:(0,B.Z)("Card")),e.cardNumber&&B$("span",{className:"CardDisplay-Number"},void 0,"•••• "+e.cardNumber),e.expirationMonth&&e.expirationYear&&B$("span",{className:"CardDisplay-Expiration"},void 0,e.expirationMonth+" / "+e.expirationYear.substring(2,4)),B$("button",{className:"CardDisplay-Edit",title:(0,B.Z)("Edit Card"),onClick:()=>this.showEditCardDialog(e.guid)},void 0,"•••")));render(){const e="none"!==this.state.dialogVisible,t="new"===this.state.dialogVisible;return(0,ss.jsxs)(ss.Fragment,{children:[e&&this.state.dialogCard&&B$(ra.Z,{onRequestClose:this.handleOnCloseDialog,className:"float card",ignoreClickOutside:!0},void 0,B$("form",{},void 0,B$("div",{className:"dialog-header"},void 0,B$("h1",{},void 0,t?(0,B.Z)("Add Card"):(0,B.Z)("Edit Card"))),B$("div",{className:"dialog-content"},void 0,B$("div",{className:"dialog-row"},void 0,B$("div",{className:"dialog-column"},void 0,B$("label",{},void 0,(0,B.Z)("Card Number"),B$("input",{type:"number",name:"cardNumber",defaultValue:this.state.dialogCard.cardNumber,onChange:e=>this.handleInputChange(e),onInput:e=>{e.target.value=e.target.value.slice(0,19)},autoFocus:!0})))),B$("div",{className:"dialog-row"},void 0,B$("div",{className:"dialog-column"},void 0,B$("label",{},void 0,(0,B.Z)("Expiry Date"),B$("div",{className:"CardDisplay-Date"},void 0,B$(ta.Z,{id:"cc_expiry",name:"expirationMonth",value:this.state.dialogCard.expirationMonth,onChange:e=>this.handleInputChange(e)},void 0,Array.from({length:12},((e,t)=>t+1)).map((e=>B$("option",{value:e},e,e)))),B$(ta.Z,{name:"expirationYear",value:this.state.dialogCard.expirationYear,onChange:e=>this.handleInputChange(e)},void 0,Array.from({length:20},((e,t)=>W$+t)).map((e=>B$("option",{value:e},e,e)))))))),B$("div",{className:"dialog-row"},void 0,B$("div",{className:"dialog-column"},void 0,B$("label",{},void 0,(0,B.Z)("Name on Card"),B$("input",{type:"text",name:"name",maxLength:"100",defaultValue:this.state.dialogCard.name,onChange:e=>this.handleInputChange(e)})))),B$("div",{className:"dialog-row"},void 0,B$("div",{className:"dialog-column"},void 0,B$("label",{},void 0,(0,B.Z)("Card Nickname"),B$("input",{id:"cc_nick",type:"text",name:"nickname",maxLength:"25",defaultValue:this.state.dialogCard.nickname,onChange:e=>this.handleInputChange(e)}))))),B$("footer",{className:"dialog-footer"},void 0,B$("input",{type:"submit",onClick:this.saveCardAndCloseDialog,value:(0,B.Z)("Save"),disabled:!this.state.dialogCard.name&&!this.state.dialogCard.cardNumber}),"edit"===this.state.dialogVisible&&B$("input",{type:"button",className:"danger",onClick:this.deleteCardAndCloseDialog,value:(0,B.Z)("verb","Delete")}),B$("input",{type:"button",onClick:this.handleOnCloseDialog,value:(0,B.Z)("Cancel")})))),B$("div",{className:"setting-single pad-top"},void 0,this.state.creditCards.length>0&&(0,ss.jsxs)(ss.Fragment,{children:[B$("h3",{},void 0,(0,B.Z)("Your Payment Cards")),B$("div",{},void 0,this.state.creditCards.map((e=>this.renderCard(e))))]}),B$("input",{type:"button",value:(0,B.Z)("Add New Payment Card"),disabled:!this.props.prefValues[I.kAutofillCreditCardEnabled],onClick:this.showNewCardDialog}))]})}}const G$=(0,Bu.Z)(H$,F$);var $$;function K$(e,t,n,i){$$||($$="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:$$,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const z$=[I.kAutofillCanMakePaymentEnabled,I.kAutofillCreditCardEnabled];z$.push(I.kAutofillMandatoryReauthEnabled);const j$=w.Z.getEventHandler;function Y$(e){const t=(0,Ya.Z)(z$),[n,s]=Li.useState(!1);Li.useEffect((()=>{i.Z.autofillPrivate.checkIfDeviceAuthAvailable().then((e=>{s(e)})).catch((()=>{s(!1)}))}),[]);return K$(tN.Z,{categoryTitle:(0,B.Z)("Payment Methods"),filter:e.filter},void 0,K$("div",{className:"setting-group unlimited"},void 0,K$("div",{className:"setting-single"},void 0,K$("label",{},void 0,K$("input",{type:"checkbox",checked:t[I.kAutofillCreditCardEnabled],onChange:j$(I.kAutofillCreditCardEnabled)}),K$("span",{},void 0,(0,B.Z)("Save and Fill Payment Methods"))),K$("p",{className:"info"},void 0,(0,B.Z)("Fills in payment forms with your saved payment methods."))),n&&K$("div",{className:"setting-single"},void 0,K$("label",{},void 0,K$("input",{type:"checkbox",checked:t[I.kAutofillMandatoryReauthEnabled],onChange:()=>{i.Z.autofillPrivate.authenticateUserAndFlipMandatoryAuthToggle()},disabled:!t[I.kAutofillCreditCardEnabled]}),K$("span",{},void 0,(0,B.Z)("Always Verify when Using Autofill"))),K$("p",{className:"info",disabled:!t[I.kAutofillCreditCardEnabled]},void 0,(0,B.Z)("When turned off, you may be asked occasionally to verify for security purposes."))),K$("div",{className:"setting-single"},void 0,K$("label",{},void 0,K$("input",{type:"checkbox",checked:t[I.kAutofillCanMakePaymentEnabled],onChange:j$(I.kAutofillCanMakePaymentEnabled)}),K$("span",{},void 0,(0,B.Z)("Allow Sites to Check for Saved Payment Methods")))),K$(G$,{filter:e.filter})))}const X$=Li.memo(Y$),Q$=116444736e5;var q$,J$=n(34155);function eK(e,t,n,i){q$||(q$="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:q$,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const tK=[I.kExceptionsAutoplay,I.kExceptionsGeolocation,I.kExceptionsCamera,I.kExceptionsMic,I.kExceptionsSensors,I.kExceptionsNotifications,I.kExceptionsJavaScript,I.kExceptionsImage,I.kExceptionsPopUp,I.kExceptionsSubResource,I.kExceptionsAutoDownload,I.kExceptionsSound,I.kExceptionsBluetooth,I.kExceptionsMIDI,I.kExceptionsIdle,I.kExceptionsBackgroundSync,I.kExceptionsUSB,I.kExceptionsSerial,I.kExceptionsFileEdit,I.kExceptionsHID,I.kExceptionsClipboard,I.kExceptionsPayment,I.kExceptionsAugmentedReality,I.kExceptionsVirtualReality,I.kExceptionsWebID,I.kExceptionsWindowManagement,I.kExceptionsFont,I.kExceptionsCookies],nK=",*";function iK(e,t){return e.startsWith("file:")?t?(0,rl.Ph)(e.replace(nK,"")):e.split("/").pop().replace(nK,""):(0,rl.Ph)(e.replace(nK,""))}var sK=eK("hr",{});function oK(e){const t=(0,Ya.Z)(tK),[n,i]=Li.useState(""),[s,o]=Li.useState(!1),[a,r]=Li.useState({}),[l,d]=Li.useState(""),[c,u]=Li.useState(""),p=Li.useRef([]),h=Li.useRef(),g=Li.useRef(),m=async()=>{const e={};for(const t of Object.keys(sA._)){const n=await se.Z.utilities.getDefaultContentSettings(t);e[t]=n}r((t=>({...t,...e})))};Li.useEffect((()=>{m()}),[]);const f=async()=>{n?(await tK.forEach((e=>{const i=structuredClone(t[e]);Object.keys(i).filter((e=>e.includes(n))).forEach((e=>delete i[e])),Object.keys(i).length?w.Z.set(e,i):w.Z.reset(e)})),S()):(await tK.forEach((e=>w.Z.reset(e))),S())},v=e=>{const{value:t,dataset:n}=e.target,i=parseInt(t),s=n.pref,o=n.site;if(tK.includes(s)&&o){const e={...C.Z.get(s)};0===i?delete e[o]:e[o]={...e[o],setting:i,last_modified:(1e3*((a??new Date).getTime()+Q$)).toString()},w.Z.set(s,e)}var a},y=()=>{const e=structuredClone(p.current)??[],t=(0,ge.Z)((0,rl.q9)(l,!0));t?(e.push(t.origin+nK),p.current=[...new Set([...e])],d("")):(u((0,B.Z)("Please provide valid domain name including protocol.")),g.current?.focus())},b=e=>{const{value:t}=e.currentTarget;d(t),u("")},S=()=>o(!1),A=()=>{const e=h.current?.refSortable.current?.state.selectedIndex;e&&h.current?.refSortable.current?.removeItem(e),d(""),u("")},T=e=>{const t=Object.keys(sA._).find((t=>sA._[t].path===e));if(t){const e=a[t]??"";switch(e){case"allow":return sA.w.Allow;case"block":return sA.w.Block;case"ask":return sA.w.Ask;case"session_only":return sA.w["Session Only"];default:return console.warn("Setting error",e),"?"}}return console.warn("Unknown permission",e),"?"},Z=(e,n)=>{const i=t[e][n]?.setting??0,s=e.split(".").pop(),o=Object.keys(sA._).find((e=>sA._[e].path===s)),{exceptions:a}=o?sA._[o]:{};return eK("label",{className:0!==i?"changed":"default"},e,eK("span",{className:"icon",dangerouslySetInnerHTML:{__html:aA(s)}}),eK("span",{},void 0,function(e){const t=Object.keys(sA._).find((t=>sA._[t].path===e));return t?sA._[t].label:""}(s)),eK(ta.Z,{"data-pref":e,"data-site":n,"data-type":s,value:i,onChange:v},e+i,eK("option",{value:0},void 0,(0,B.Z)("Default ($1)",[T(s)])),sK,!a?.allow&&eK("option",{value:1},void 0,sA.w.Allow),e===I.kExceptionsCookies?eK("option",{value:4},void 0,sA.w["Session Only"]):!a?.ask&&eK("option",{value:3},void 0,sA.w.Ask),eK("option",{value:2},void 0,sA.w.Block)))},E=gs()(((e,t,n)=>{const i=tK.flatMap((t=>Object.keys(e[t]))),s=[...new Set([...i,...n])].filter((e=>!e.startsWith("*,"))).map((e=>({key:e,name:iK(e,!1),number:i.filter((t=>t===e)).length})),[]).sort(((e,t)=>(0,Lt.qf)(e.name,t.name)));if(t){const e=s.filter((e=>e.name.includes(t)));return p.current=e.map((e=>e.key)),e}return p.current=s.map((e=>e.key)),s.unshift({key:"default",name:sA.w["Global Permissions"],number:0,isRemovable:!1}),s}));var k=eK(To,{type:"warning"},void 0,c);const _=tK.flatMap((e=>Object.keys(t[e]))),N=_.length,P=[...new Set(_)].length;return eK(tN.Z,{filter:e.filter,categoryTitle:sA.w["Website Permissions"]},void 0,s&&eK(ra.Z,{onRequestClose:S,className:"float",title:(0,B.Z)("Reset Website Permissions?")},void 0,eK("div",{className:"dialog-delete-cookies"},void 0,eK("div",{className:"dialog-content"},void 0,eK("p",{},void 0,n?(0,B.Z)("Filtered website permission exceptions will be removed."):(0,B.Z)("All website permission exceptions will be removed."))),eK("footer",{className:"dialog-footer"},void 0,eK("input",{type:"button",className:"danger",onClick:f,value:(0,B.Z)("other","Reset"),autoFocus:!0}),eK("input",{type:"button",onClick:S,value:(0,B.Z)("Cancel")})))),eK("div",{className:"setting-group unlimited","data-anchor":"permissions"},void 0,eK("p",{},void 0,(0,B.Z)("There is $1 exception to the default permissions $2.","There are $1 exceptions to the default permissions $2.",[N,(0,B.Z)("across $1 domain","across $1 domains",[P])]))),(0,ss.jsx)(QD.Z,{ref:h,items:E(t,n,p.current??[]),masterLayout:1,renderListItem:(e,t)=>(0,ss.jsxs)(ss.Fragment,{children:[eK("span",{},void 0,e),t.number>0&&eK("span",{className:"item-count"},void 0,t.number)]}),renderContent:(t,i)=>{const s=""===n?1:0;if(s&&0===t)return eK(lA,{filter:e.filter,permissionList:a,reloadPermissions:m});const o=p.current?.[t-s]??"";return eK("div",{className:"detail"},void 0,eK("div",{className:"detail-content"},void 0,eK("h3",{},void 0,(0,B.Z)("Permissions for “$1”",[iK(o,!0)])),tK.map((e=>Z(e,o)))))},contentStrings:sA.w,className:"setting-site-permissions",filter:e.filter,addTipString:(0,B.Z)("Add new domain"),deleteTipString:(0,B.Z)("Remove domain"),deleteTitle:(0,B.Z)("Remove Domain"),deleteLabel:(0,B.Z)("Removing a domain resets all of its current permissions."),renderCreate:e=>eK("form",{className:"detail",onSubmit:y},void 0,eK("div",{className:"detail-content create"},void 0,eK("h3",{},void 0,(0,B.Z)("Add a domain, including the protocol, to adjust permissions.")),eK("label",{},void 0,(0,ss.jsx)("input",{ref:g,type:"text",value:l,onChange:b,placeholder:(0,B.Z)("e.g. https://example.com"),spellCheck:"false",autoFocus:!0})),c&&k,eK("div",{className:"toolbar"},void 0,eK("input",{type:"submit",value:(0,B.Z)("Add Domain")}),eK("input",{type:"button",value:(0,B.Z)("Cancel"),onClick:A})))),renderCreateListItem:()=>eK("span",{},void 0,""===l?(0,B.Z)("New domain"):l),onRemove:e=>{const i=E(t,n,p.current??[])[e]?.key,s=tK.map(((e,n)=>{const s=structuredClone(t[e]);delete s[i],Object.keys(s).length?w.Z.set(e,s):w.Z.reset(e)}));Promise.all(s).then((()=>{J$.nextTick((()=>{p.current?.splice(p.current.indexOf(i),1)}))}))}}),eK("div",{className:"setting-single setting-single-flex"},void 0,eK("input",{type:"search",placeholder:(0,B.Z)("Filter by domain"),value:n,onChange:e=>{i(e.target.value)}}),eK("input",{type:"button",disabled:0===P,onClick:()=>o(!0),value:(0,B.Z)(n?(0,B.Z)("Reset Filtered Website Permissions"):(0,B.Z)("Reset All Website Permissions"))})))}const aK=Li.memo(oK);var rK;function lK(e,t,n,i){rK||(rK="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:rK,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const dK=[I.kHistoryDaysToKeepVisits,I.kSavingBrowserHistoryDisabled];class cK extends Li.Component{onHistoryDaysChanged=e=>{const t=parseInt(e.target.value,10);w.Z.set(I.kHistoryDaysToKeepVisits,t),0===t?w.Z.set(I.kSavingBrowserHistoryDisabled,!0):w.Z.set(I.kSavingBrowserHistoryDisabled,!1)};render(){const e=this.props.prefValues[I.kHistoryDaysToKeepVisits],t=[0,1,7,31,91,182,365,3650].includes(e);return lK(iA.Z,{filter:this.props.filter},void 0,lK("div",{className:"setting-group"},void 0,lK("h3",{},void 0,(0,B.Z)("other","Save Browsing History")),lK("div",{className:"setting-single"},void 0,lK(ta.Z,{onChange:this.onHistoryDaysChanged,value:e},void 0,lK("option",{value:"0"},void 0,(0,B.Z)("command","Session Only")),lK("option",{value:"1"},void 0,(0,B.Z)("One Day")),lK("option",{value:"7"},void 0,(0,B.Z)("One Week")),lK("option",{value:"31"},void 0,(0,B.Z)("One Month")),lK("option",{value:"91"},void 0,(0,B.Z)("Three Months")),lK("option",{value:"182"},void 0,(0,B.Z)("Six Months")),lK("option",{value:"365"},void 0,(0,B.Z)("One Year")),lK("option",{value:"3650"},void 0,(0,B.Z)("Forever")),!t&&lK("option",{value:e},void 0,(0,B.Z)("Other ($1 Days)",[e])))),lK("p",{className:"info"},void 0,(0,B.Z)("Browser restart is required for new setting to take effect."))))}}const uK=(0,Bu.Z)(cK,dK);var pK;function hK(e,t,n,i){pK||(pK="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:pK,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const gK=[I.kAddressBarInlineSearchEnabled,I.kSearchSuggestEnabled,I.kAddressBarSearchSuggestEnabled,I.kAddressBarSearchTypedHistoryEnabled,I.kAlternateErrorPagesEnabled,I.kAutofillCreditCardEnabled,I.kEnableDoNotTrack,I.kPrivacyAdverseAdBlockEnabled,I.kPrivacyAutofillServerAssist,I.kPrivacyBlockPingsEnabled,I.kPrivacyGoogleComponentExtensionsHangoutServices,I.kPrivacyGoogleComponentExtensionsWebStore,I.kSafeBrowsingEnabled,I.kIncognitoShowIntro,I.kVivaldiCrashReportingConsentGranted,I.kWebRTCIPHandlingPolicy,I.kCustomHandlersEnabled,I.kAddressBarOmniboxShowTypedHistory];const mK=w.Z.getEventHandler;function fK(e){const t=Li.useContext(ts.Z),n=(0,Ya.Z)(gK),i=Oi.Z.isEnabled("omnibox"),[s,o]=Li.useState(n[I.kCustomHandlersEnabled]);Li.useEffect((()=>{o(n[I.kCustomHandlersEnabled])}),[n]);const a=()=>["default","default_public_interface_only","default_public_and_private_interfaces"].some((e=>n[I.kWebRTCIPHandlingPolicy]===e));return hK(tN.Z,{categoryTitle:(0,B.Z)("Privacy"),displayPrivacyLink:!0,filter:e.filter},void 0,hK("div",{className:"setting-group"},void 0,hK("div",{className:"setting-single"},void 0,hK("h3",{},void 0,(0,B.Z)("Tracking Prevention")),hK("label",{title:(0,B.Z)("Send “Do Not Track” directive to supporting websites")},void 0,hK("input",{type:"checkbox",checked:n[I.kEnableDoNotTrack],onChange:mK(I.kEnableDoNotTrack)}),hK("span",{},void 0,(0,B.Z)("Ask Websites Not to Track Me")))),hK("div",{className:"setting-single"},void 0,hK("label",{title:(0,B.Z)("Reject advertisement on websites listed by Google as privacy offenders")},void 0,hK("input",{type:"checkbox",checked:n[I.kPrivacyAdverseAdBlockEnabled],onChange:mK(I.kPrivacyAdverseAdBlockEnabled)}),hK("span",{},void 0,(0,B.Z)("Block Ads on Abusive Sites")))),hK("div",{className:"setting-single"},void 0,hK("label",{title:(0,B.Z)("Block tracking on links with a “ping” attribute or via navigator.sendBeacon")},void 0,hK("input",{type:"checkbox",checked:n[I.kPrivacyBlockPingsEnabled],onChange:mK(I.kPrivacyBlockPingsEnabled)}),hK("span",{},void 0,(0,B.Z)("Block Hyperlink Audit Tracking")))),hK("div",{className:"setting-single"},void 0,hK("label",{title:(0,B.Z)("Web Real-Time Communication broadcast may leak IP address to services")},void 0,hK("input",{type:"checkbox",checked:a(),onChange:()=>{const e=a()?"disable_non_proxied_udp":"default";w.Z.set(I.kWebRTCIPHandlingPolicy,e)}}),hK("span",{},void 0,(0,B.Z)("Broadcast IP for Best WebRTC Performance"))))),hK("div",{className:"setting-group"},void 0,hK("h3",{},void 0,(0,B.Z)("Google Services")),hK("div",{className:"setting-single"},void 0,hK("label",{},void 0,hK("input",{type:"checkbox",checked:n[I.kSafeBrowsingEnabled],onChange:mK(I.kSafeBrowsingEnabled)}),hK("span",{},void 0,(0,B.Z)("Phishing and Malware Protection")))),hK("div",{className:"setting-single"},void 0,hK("label",{},void 0,hK("input",{type:"checkbox",checked:n[I.kAlternateErrorPagesEnabled],onChange:mK(I.kAlternateErrorPagesEnabled)}),hK("span",{},void 0,(0,B.Z)("DNS to Help Resolve Navigation Errors")))),hK("div",{className:"setting-single"},void 0,hK("label",{},void 0,hK("input",{type:"checkbox",checked:n[I.kPrivacyAutofillServerAssist],onChange:mK(I.kPrivacyAutofillServerAssist)}),hK("span",{},void 0,(0,B.Z)("Form Autofill Assist"))))),hK("div",{className:"setting-group"},void 0,hK("h3",{},void 0,(0,B.Z)("Google Extensions")),hK("p",{className:"info"},void 0,(0,B.Z)("Browser restart is required for new settings to take effect.")),hK("div",{className:"setting-single"},void 0,hK("label",{},void 0,hK("input",{type:"checkbox",checked:n[I.kPrivacyGoogleComponentExtensionsHangoutServices],onChange:mK(I.kPrivacyGoogleComponentExtensionsHangoutServices)}),hK("span",{},void 0,(0,B.Z)("Meet (was Hangouts)"))),hK("p",{className:"info"},void 0,(0,B.Z)("Some Google services will break with this option disabled."))),hK("div",{className:"setting-single"},void 0,hK("label",{},void 0,hK("input",{type:"checkbox",checked:n[I.kPrivacyGoogleComponentExtensionsWebStore],onChange:mK(I.kPrivacyGoogleComponentExtensionsWebStore)}),hK("span",{},void 0,(0,B.Z)("Web Store"))),hK("p",{className:"info"},void 0,(0,B.Z)("You will be unable to install extensions with this option disabled.")))),hK("div",{className:"setting-group"},void 0,hK("h3",{},void 0,(0,B.Z)("noun","Search")),hK("div",{className:"setting-single"},void 0,hK("label",{},void 0,hK("input",{type:"checkbox",checked:n[I.kAddressBarInlineSearchEnabled],onChange:mK(I.kAddressBarInlineSearchEnabled)}),hK("span",{},void 0,(0,B.Z)("Search in Address Field")))),hK("div",{className:"setting-single"},void 0,hK("label",{},void 0,hK("input",{type:"checkbox",checked:n[I.kSearchSuggestEnabled],onChange:mK(I.kSearchSuggestEnabled)}),hK("span",{},void 0,(0,B.Z)("Suggestions in Address Field")))),hK("div",{className:"setting-single"},void 0,hK("label",{},void 0,hK("input",{type:"checkbox",checked:n[I.kAddressBarSearchSuggestEnabled],onChange:mK(I.kAddressBarSearchSuggestEnabled)}),hK("span",{},void 0,(0,B.Z)("Suggestions in Search Field"))))),!i&&hK("div",{className:"setting-group"},void 0,hK("div",{className:"setting-single"},void 0,hK("h3",{},void 0,(0,B.Z)("Show Typed History")),hK("div",{className:"setting-single"},void 0,hK("label",{},void 0,hK("input",{type:"checkbox",checked:n[I.kAddressBarOmniboxShowTypedHistory],onChange:mK(I.kAddressBarOmniboxShowTypedHistory)}),hK("span",{},void 0,(0,B.Z)("radio","In Address Field")))),hK("div",{className:"setting-single"},void 0,hK("label",{},void 0,hK("input",{type:"checkbox",checked:n[I.kAddressBarSearchTypedHistoryEnabled],onChange:mK(I.kAddressBarSearchTypedHistoryEnabled)}),hK("span",{},void 0,(0,B.Z)("radio","In Search Field")))))),hK(uK,{filter:e.filter}),hK("div",{className:"setting-group"},void 0,hK("div",{className:"setting-single"},void 0,hK("h3",{},void 0,(0,B.Z)("Private Windows")),hK("label",{},void 0,hK("input",{type:"checkbox",checked:n[I.kIncognitoShowIntro],onChange:mK(I.kIncognitoShowIntro)}),hK("span",{},void 0,(0,B.Z)("Show Introduction"))))),hK("div",{className:"setting-group"},void 0,hK("div",{className:"setting-single"},void 0,hK("h3",{},void 0,(0,B.Z)("Protocol handling")),hK("label",{},void 0,hK("input",{type:"checkbox",checked:s,onChange:()=>{se.Z.utilities.setProtocolHandling(!s),o((e=>!e))}}),hK("span",{},void 0,(0,B.Z)("Sites can ask to handle protocols")))),!1),hK("div",{className:"setting-group"},void 0,hK("h3",{},void 0,(0,B.Z)("Crash Reporting")),hK("div",{className:"setting-single"},void 0,hK("label",{},void 0,hK("input",{type:"checkbox",checked:C.Z.get(I.kVivaldiCrashReportingConsentGranted),onChange:()=>{w.Z.set(I.kVivaldiCrashReportingConsentGranted,!C.Z.get(I.kVivaldiCrashReportingConsentGranted))}}),hK("span",{},void 0,(0,B.Z)("Allow Vivaldi to Send Automatic Crash Reports"))),hK("p",{className:"info"},void 0,(0,B.Z)("Crash reports include the most recently visited webpage. It may send more personal information which is promptly deleted.")," ",hK(A_.Z,{title:p.fg,onClick:()=>{c.ZP.openURL(t.vivaldiWindowId,p.fg)}},void 0,(0,B.Z)("Privacy policy"))))))}const vK=Li.memo(fK);var yK,bK;function SK(e,t,n,i){yK||(yK="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:yK,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function wK(e){return SK("span",{},void 0,e)}function CK({filter:e}){const[t,n]=(0,Li.useState)([]),s=(0,Li.useRef)();return(0,Li.useEffect)((()=>{async function e(){try{const e=await i.Z.passwordsPrivate.getPasswordExceptionList();n(e)}catch(e){console.warn(e)}}return i.Z.passwordsPrivate.onPasswordExceptionsListChanged.addListener(e),setTimeout(e,300),()=>i.Z.passwordsPrivate.onPasswordExceptionsListChanged.removeListener(e)}),[]),(0,Li.useEffect)((()=>(1===s.current?.length&&0===t.length&&n("cleared"),()=>{s.current=t})),[t]),t.length||"cleared"===t?SK(iA.Z,{filter:e},void 0,SK("div",{className:"setting-group setting-group-double"},void 0,SK("div",{className:"setting-single"},void 0,SK("h3",{},void 0,(0,B.Z)("Declined Sites")),SK("p",{className:"info"},void 0,"cleared"===t?(0,B.Z)("No sites with password saving declined."):(0,B.Z)("Sites with password saving declined.")),"cleared"!==t&&SK(lk.Z,{items:t.map((e=>({name:e.urls.shown,key:e.id.toString()}))),renderListItem:wK,filter:e,onRemove:function(e){if("cleared"!==t){const n=t[e];n.id&&i.Z.passwordsPrivate.removePasswordException(n.id)}},deleteTipString:(0,B.Z)("Remove Site"),supportDragAndDrop:!1})))):null}function AK(e,t,n,i){bK||(bK="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:bK,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var IK=AK("span",{},void 0,"•••••••");class TK extends Li.Component{render(){const{origin:e,username:t,password:n}=this.props.savedPassword,{columns:i}=this.props;if(i.length<1||!this.props.savedPassword)return null;var s=AK(Ri.ZP,{url:e,loadType:"page"}),o=AK("span",{},void 0,e),a=AK("input",{type:"text",value:t,tabIndex:-1,readOnly:!0}),r=AK("input",{type:"text",value:n,tabIndex:-1,readOnly:!0});return i.map(((t,n)=>{switch(t.id){case"origin":return AK("label",{},t.id+"__"+n,AK("span",{className:"site-icon",onDoubleClick:this.props.openLink.bind(null,e),title:(0,B.Z)("Double-click to visit $1",[e])},void 0,s),o);case"username":return AK("label",{},t.id+"__"+n,a);case"password":return AK("div",{},t.id+"__"+n,AK("label",{},void 0,this.props.showPassword?r:IK),AK("button",{type:"button",className:"listcontrol",title:this.props.showPassword?(0,B.Z)("Hide password"):(0,B.Z)("other","Show password"),tabIndex:-1,onClick:this.props.togglePassword.bind(null,this.props.savedPassword.index),dangerouslySetInnerHTML:{__html:Wi.sgm.medium}}));default:return null}}))}}const ZK=TK;class EK extends Li.PureComponent{static contextType=ts.Z;_passwordTree=Li.createRef();state={visiblePasswords:[]};componentDidMount(){this._passwordTree.current&&this._passwordTree.current.focusTree()}togglePassword=e=>{se.Z.savedpasswords.authenticate(this.context.vivaldiWindowId,(t=>{t&&this._onShowPassword(e)}))};_onShowPassword=e=>{this.setState((t=>{const n=t.visiblePasswords.slice(0);return n.includes(e)?n.splice(n.indexOf(e),1):n.push(e),{visiblePasswords:n}}),(()=>this._passwordTree.current?.rerenderVisibleTreeItems()))};onPasswordDeleted=e=>{this.state.visiblePasswords.includes(e)&&this.setState((t=>{const n=t.visiblePasswords.slice(0);return n.splice(n.indexOf(e),1),{visiblePasswords:n}}))};openLink=e=>{c.ZP.openURL(this.context.vivaldiWindowId,e)};copyPassword=e=>{se.Z.savedpasswords.authenticate(this.context.vivaldiWindowId,(t=>{t&&Gp.Z.set(e)}))};getContextMenuItems=e=>{const t=this.state.visiblePasswords.includes(e.index);return[{handler:this.togglePassword.bind(null,e.index),isVisible:()=>t,...(0,us.Z)("Hide Password")},{handler:this.togglePassword.bind(null,e.index),isVisible:()=>!t,...(0,us.Z)("Show Password")},Qe.Z.separatorItem,{handler:()=>this.copyPassword(e.password),...(0,us.Z)("Copy Password")},{handler:()=>Gp.Z.set(e.username),...(0,us.Z)("Copy Account Name")},{handler:this.openLink.bind(null,e.origin),isVisible:()=>(0,rl.q9)(e.origin).startsWith("http"),...(0,us.Z)("Visit Page")},Qe.Z.separatorItem,{handler:this.props.onDelete.bind(null,e),...(0,us.Z)("Delete Password")}]};onKeyDown=e=>{if(!this._passwordTree.current)return;const t=this._passwordTree.current.getSelectedItem();if(t)switch(e.key){case"Delete":case"Backspace":this.props.onDelete(t);break;case" ":e.preventDefault(),this.togglePassword(t.index);break;case"Enter":this.openLink(t.origin)}};onMouseDown=()=>{this._passwordTree.current&&this._passwordTree.current.focusTree()};getRowComponentProps=e=>({columns:this.props.columns,savedPassword:e.node,showPassword:this.state.visiblePasswords.includes(e.node.index),togglePassword:this.togglePassword,openLink:this.openLink});render(){return(0,ss.jsx)(Ps,{ref:this._passwordTree,rowComponent:ZK,getRowComponentProps:this.getRowComponentProps,nodes:this.props.nodes,enableDragAndDrop:!1,onItemMouseDown:this.onMouseDown,onItemDoubleClick:Lr.Z,onKeyDown:this.onKeyDown,getContextMenuItems:this.getContextMenuItems,isFolder:gE.Z,disableClipboard:!0,hasChildren:gE.Z,sorting:this.props.sorting,columns:this.props.columns,multiSelect:!1})}}const kK=EK;var _K,NK=n(37461);function PK(e,t,n,i){_K||(_K="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:_K,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const DK=i.Z.passwordsPrivate.onPasswordsFileExportProgress,MK=[I.kCredentialsEnableService],OK=w.Z.getEventHandler,xK="passwords",LK={width:400,minWidth:"unset"},RK=[{text:(0,B.Z)("Website"),value:"origin",fullScreenTitle:(0,B.Z)("Sort by website"),width:300,visible:!0,key:!0},{text:(0,B.Z)("title","Account Name"),value:"username",fullScreenTitle:(0,B.Z)("Sort by account name"),width:160,visible:!0},{text:(0,B.Z)("Password"),value:"password",fullScreenTitle:(0,B.Z)("Sort by password"),width:160,visible:!0}];function BK(e,t){return e.index<t.index?1:-1}function FK(e){const t=Li.useContext(ts.Z),n=(0,Ya.Z)(MK),s=Li.useRef(),[o,a]=Li.useState([]),[r,l]=Li.useState(!1),[d,c]=Li.useState(null),[u,p]=Li.useState(""),[h,g]=Li.useState(!1),[m,f]=Li.useState(vs().passwords||ys(RK)),[v,y]=Li.useState({sortOrder:1,sortField:"manually",comparator:BK}),[b,S]=Li.useState("NOT_STARTED");Li.useEffect((()=>{function e(e){S(e.status)}return w(),DK.addListener(e),i.Z.extension.inIncognitoContext||se.Z.savedpasswords.createDelegate(),()=>DK.removeListener(e)}),[]);const w=()=>se.Z.savedpasswords.getList((e=>{a(e)})),C=()=>{const e=d;e&&(se.Z.savedpasswords.remove(e.index,(()=>{s.current&&s.current.onPasswordDeleted(e.index),w()})),l(!1),c(null))},A=()=>{l(!1),c(null)},T=u.toLowerCase(),Z=o.filter((e=>e.username.toLowerCase().includes(T)||e.origin.toLowerCase().includes(T)));return he.ZP.isIncognito(t.vivaldiWindowId)?PK(tN.Z,{categoryTitle:(0,B.Z)("Passwords"),filter:e.filter,className:"saved-passwords setting-group unlimited"},void 0,PK("div",{className:"setting-group setting-group-double"},void 0,PK("div",{className:"setting-single"},void 0,PK("p",{},void 0,(0,B.Z)("Passwords are not available in Private window.")),PK("input",{type:"button",value:(0,B.Z)("Open Settings Window"),onClick:()=>de.Z.showSettings(t.vivaldiWindowId,"privacy",{},!0)})))):PK(tN.Z,{categoryTitle:(0,B.Z)("Passwords"),filter:e.filter,className:"saved-passwords setting-group unlimited"},void 0,r&&(()=>{const e=d;if(!e)return null;const t=(()=>{const e=d;return e?(0,ge.Z)(e.origin)?.hostname:null})();return PK(ra.Z,{className:"float",onRequestClose:A,style:LK,title:(0,B.Z)("Delete password for $1?",[t||e.origin])},void 0,PK("div",{className:"dialog-delete-password"},void 0,PK("div",{className:"dialog-content"},void 0,PK("p",{},void 0,(0,B.Z)("Password for user “$1” on page “$2” will be removed.",[e.username,e.origin]))),PK("footer",{className:"dialog-footer"},void 0,PK("input",{type:"button",className:"primary",onClick:C,value:(0,B.Z)("other","Delete"),autoFocus:!0}),PK("input",{type:"button",onClick:A,value:(0,B.Z)("Cancel")}))))})(),PK("div",{className:"setting-group unlimited"},void 0,PK("div",{className:"setting-single"},void 0,PK("label",{},void 0,PK("input",{type:"checkbox",onChange:OK(I.kCredentialsEnableService),checked:n[I.kCredentialsEnableService]}),PK("span",{},void 0,(0,B.Z)("Save Webpage Passwords")))),h&&PK("div",{className:"setting-single"},void 0,PK("input",{type:"search",defaultValue:"",placeholder:(0,B.Z)("Filter Passwords"),onChange:e=>p(e.target.value)})),h&&PK("div",{className:"saved-passwords-tree"},void 0,PK(Mm,{fields:RK,fullsize:!0,onSortChange:(e,t)=>{y({sortOrder:e,sortField:t})},onSaveRow:()=>fs(m,xK),onUpdateRow:e=>f(e),columns:m,sortField:v.sortField,sortOrder:v.sortOrder,keyAccess:0,manualSorting:!1}),(0,ss.jsx)(kK,{ref:s,sorting:v,columns:m,onDelete:e=>{l(!0),c(e)},nodes:Z})),0===Z.length&&PK("div",{className:"saved-passwords"},void 0,u?(0,B.Z)("Query “$1” matches no result.",[u]):(0,B.Z)("No saved passwords found.")),Z.length>0&&PK("div",{className:"setting-single"},void 0,PK("input",{type:"button",onClick:()=>{g((e=>!e)),p("")},value:h?(0,B.Z)("Hide Passwords"):(0,B.Z)("Show Saved Passwords")}),PK("input",{type:"button",onClick:()=>(0,NK.T)(t.vivaldiWindowId),value:(0,B.Z)("Export Passwords"),disabled:"IN_PROGRESS"===b}),"FAILED_CANCELLED"===b||"FAILED_WRITE_FAILED"===b&&PK(To,{type:"error"},"error",(0,B.Z)("Export failed.")),PK("p",{className:"info"},void 0,(0,B.Z)("Passwords are exported in clear text without encryption.")))),PK(CK,{filter:e.filter}))}const WK=Li.memo(FK);var UK;function VK(e,t,n,i){UK||(UK="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:UK,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function HK(e){const t=Li.useContext(ts.Z);return VK(tN.Z,{categoryTitle:(0,B.Z)("Security"),filter:e.filter},void 0,VK("div",{className:"setting-group unlimited"},void 0,VK("div",{className:"setting-single"},void 0,VK("input",{type:"button",value:(0,B.Z)("Manage Certificates"),onClick:e=>{const{vivaldiWindowId:n}=t;se.Z.utilities.showManageSSLCertificates(n,(()=>{}))}}),VK("p",{className:"info"},void 0,(0,B.Z)("Manage HTTPS/SSL certificates and settings.")))))}const GK=Li.memo(HK);var $K;function KK(e,t,n,i){$K||($K="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:$K,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const zK=[...zG,...tK,...z$,...gK,...MK].concat([]),jK=[I.kExceptionsCookies,I.kCustomHandlersEnabled,I.kPrivacyBlockPingsEnabled],YK=zK.filter((e=>!jK.includes(e)));function XK({filter:e,category:t}){const n=sN({filter:e,prefPaths:YK,name:t.title});return(0,ss.jsxs)(ss.Fragment,{children:[KK("section",{className:"setting-section"},void 0,KK(vK,{filter:e})),KK("section",{className:"setting-section"},void 0,KK(S$,{filter:e})),KK("section",{className:"setting-section"},void 0,KK(GK,{filter:e})),KK("section",{className:"setting-section"},void 0,KK(WK,{filter:e})),KK("section",{className:"setting-section"},void 0,KK(X$,{filter:e})),KK("section",{className:"setting-section"},void 0,KK(t$,{filter:e})),KK("section",{className:"setting-section"},void 0,KK(aK,{filter:e})),KK("section",{className:"setting-section"},void 0,KK(L$,{filter:e})),!1,n]})}const QK=Li.memo(XK);var qK=n(5422);const JK=[{key:"CALCULATOR",name:(0,B.Z)("Calculator"),pref:I.kQuickCommandsShowCalculator},{key:"NORMAL_COMMAND",name:(0,B.Z)("Commands")},{key:"COMMAND_CHAIN",name:(0,B.Z)("Command Chains")},{key:"KEYWORD_SEARCH",name:(0,B.Z)("Web Search & URL Entry")},{key:"WORKSPACES",name:(0,B.Z)("Workspaces")},{key:"SEND_TAB_TO_SELF",name:(0,B.Z)("Send Tab to Your Devices")},{key:"OPEN_TABS",name:(0,B.Z)("Open Tabs")},{key:"BOOKMARK_ITEM_OR_FOLDER",name:(0,B.Z)("Bookmarks"),pref:I.kQuickCommandsShowBookmarks},{key:"READING_LIST",name:(0,B.Z)("Reading List"),pref:I.kQuickCommandsShowReadingList},{key:"NOTES_SEARCH",name:(0,B.Z)("Notes"),pref:I.kQuickCommandsShowNotes},{key:"HISTORY",name:(0,B.Z)("Browsing History"),pref:I.kQuickCommandsShowHistory},{key:"EXTENSIONS",name:(0,B.Z)("Extensions"),pref:I.kQuickCommandsShowExtensions},{key:"PAGE_ACTIONS",name:(0,B.Z)("Page Actions"),pref:I.kQuickCommandsShowPageActions},{key:"CLOSED_TABS",name:(0,B.Z)("Closed Tabs")}];var ez;function tz(e,t,n,i){ez||(ez="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:ez,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const nz=[I.kActions,I.kQuickCommandsKeepValue,I.kQuickCommandsOpenUrlInNewTab,I.kQuickCommandsSearchEnglish,I.kQuickCommandsMatchNickname,I.kQuickCommandsNicknameMatchInNewTab,I.kQuickCommandsLimitResults,I.kQuickCommandsSearchPriority,I.kQuickCommandsShowBookmarks,I.kQuickCommandsShowCalculator,I.kQuickCommandsShowExtensions,I.kQuickCommandsShowHistory,I.kQuickCommandsShowPageActions,I.kQuickCommandsShowNotes,I.kQuickCommandsShowReadingList,I.kQuickCommandsUseNotesManager,I.kWorkspacesEnabled,I.kChainedCommandsCommandList],iz=[I.kWorkspacesEnabled,I.kActions],sz=nz.filter((e=>!iz.includes(e))),oz=w.Z.getEventHandler;function az(e){const t=C.Z.get(I.kWorkspacesEnabled);return e.filter((e=>t||"WORKSPACES"!==e)).map((e=>({key:e,name:JK.find((t=>t.key===e))?.name||""})))}var rz=tz("br",{});function lz(e){const t=(0,Ya.Z)(nz),n=sN({filter:e.filter,prefPaths:sz,name:e.category.title}),i=t[I.kActions][0].COMMAND_SHOW_QUICK_COMMANDS.shortcuts||[];return(0,ss.jsxs)(ss.Fragment,{children:[tz("section",{className:"setting-section"},void 0,tz(tN.Z,{categoryTitle:(0,B.Z)("Quick Commands"),filter:e.filter},void 0,tz("div",{className:"info"},void 0,i.length>0&&(0,ss.jsxs)(ss.Fragment,{children:[(0,B.Z)("Open Quick Commands with:")," ",tz("span",{className:"shortcut"},void 0,i.map((e=>tz("kbd",{},e,(0,vp.$)(e))))),rz,(0,B.Z)("Press $1 or $2 keys with $3 modifier to skip to next search result section. Press $4 key to auto-complete input from current list selection.",[(0,vp.$)("Down"),(0,vp.$)("Up"),(0,vp.$)("Alt"),(0,vp.$)("Right")])]})),tz("div",{className:"setting-group setting-group-double"},void 0,tz("div",{className:"setting-single list-priority"},void 0,tz("h3",{},void 0,(0,B.Z)("Search Types and Priority")),tz("p",{className:"info"},void 0,(0,B.Z)("Select data types to include in Quick Command search results. Reorder the list to change default search highlight priority.")),tz(lk.Z,{filter:e.filter,items:az(t[I.kQuickCommandsSearchPriority]),moveItem:(e,n)=>{const i=e=>{let n=0;if(!C.Z.get(I.kWorkspacesEnabled)){const i=t[I.kQuickCommandsSearchPriority];for(let t=0;t<=e;t++)"WORKSPACES"===i[t]&&n++}return n};e+=i(e),n+=i(n);const s=t[I.kQuickCommandsSearchPriority].map((e=>e)),o=s.splice(e,1)[0];s.splice(n,0,o),w.Z.set(I.kQuickCommandsSearchPriority,s)},renderListItem:(e,n)=>{const i=JK.find((e=>e.key===n.key))?.pref,s=i&&t[i];return(0,ss.jsxs)(ss.Fragment,{children:[i?tz("input",{type:"checkbox",value:n.key,checked:s,onChange:oz(i)}):tz("span",{style:{width:16}}),n.name]})},supportDragAndDrop:!0,mimeType:"vivaldi/x-settings-quick-command-type"}),tz("input",{type:"button",onClick:()=>{w.Z.reset(I.kQuickCommandsSearchPriority)},value:(0,B.Z)("Reset Priority")}))),tz("div",{className:"setting-group setting-group-double"},void 0,tz("h3",{},void 0,(0,B.Z)("Quick Command Options")),tz("div",{className:"setting-single"},void 0,tz("label",{},void 0,tz("input",{type:"checkbox",checked:t[I.kQuickCommandsKeepValue],onChange:oz(I.kQuickCommandsKeepValue)}),tz("span",{},void 0,(0,B.Z)("Keep Last Typed Value")))),tz("div",{className:"setting-single"},void 0,tz("label",{},void 0,tz("input",{type:"checkbox",checked:t[I.kQuickCommandsLimitResults],onChange:oz(I.kQuickCommandsLimitResults)}),tz("span",{},void 0,(0,B.Z)("Limit Number of Visible Search Results")))),!navigator.language.startsWith("en")&&tz("div",{className:"setting-single"},void 0,tz("label",{},void 0,tz("input",{type:"checkbox",checked:t[I.kQuickCommandsSearchEnglish],onChange:oz(I.kQuickCommandsSearchEnglish)}),tz("span",{},void 0,(0,B.Z)("Include English Search Terms"))),tz("p",{className:"info"},void 0,(0,B.Z)("Include English equivalent of command names in search results"))),tz("div",{className:"setting-single"},void 0,tz("label",{},void 0,tz("input",{type:"checkbox",checked:t[I.kQuickCommandsOpenUrlInNewTab],onChange:oz(I.kQuickCommandsOpenUrlInNewTab)}),tz("span",{},void 0,(0,B.Z)("Open Links in New Tab")))),tz("div",{className:"setting-single"},void 0,tz("label",{},void 0,tz("input",{type:"checkbox",checked:t[I.kQuickCommandsMatchNickname],onChange:oz(I.kQuickCommandsMatchNickname)}),tz("span",{},void 0,(0,B.Z)("Open Bookmarks on Nickname Match")))),tz("div",{className:"setting-single pad-left"},void 0,tz("label",{},void 0,tz("input",{type:"checkbox",disabled:!t[I.kQuickCommandsMatchNickname],checked:t[I.kQuickCommandsNicknameMatchInNewTab],onChange:oz(I.kQuickCommandsNicknameMatchInNewTab)}),tz("span",{},void 0,(0,B.Z)("In a New Tab")))),tz("div",{className:"setting-single"},void 0,tz("label",{},void 0,tz("input",{type:"checkbox",checked:t[I.kQuickCommandsUseNotesManager],onChange:oz(I.kQuickCommandsUseNotesManager)}),tz("span",{},void 0,(0,B.Z)("Open Notes in Notes Manager")))))),tz(tN.Z,{categoryTitle:(0,B.Z)("Command Chains"),filter:e.filter},void 0,tz(qK.Z,{filter:e.filter,category:e.category}))),n]})}const dz=Li.memo(lz);var cz;function uz(e,t,n,i){cz||(cz="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:cz,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const pz={title:(0,B.Z)("title","Name"),Nickname:(0,B.Z)("Nickname"),"Nickname in use by $1":(0,B.Z)("Nickname in use by $1",[""]),URL:(0,B.Z)("URL"),"POST Parameters":(0,B.Z)("POST Parameters"),"Substitute search keyword in addresses or post parameters with %s or %S":(0,B.Z)("Substitute search keyword in addresses or post parameters with %s or %S"),"Empty post parameters disable the use of POST. Post parameters are in the form name=value,name=value":(0,B.Z)("Empty post parameters disable the use of POST. Post parameters are in the form name=value,name=value"),"Suggest URL":(0,B.Z)("Suggest URL"),"Suggest POST Parameters":(0,B.Z)("Suggest POST Parameters"),"Image Search URL":(0,B.Z)("Image Search URL"),"Image Search POST Parameters":(0,B.Z)("Image Search POST Parameters"),"Set as Default Search":(0,B.Z)("Set as Default Search"),"Set as Private Search":(0,B.Z)("Set as Private Search")};function hz(e){const t=ai.Z.getByGuid(e);return t&&e?{guid:e,extensionId:t.extensionId,extensionName:"",name:t.name?t.name.trim():"",url:t.url.trim(),postParams:t.postParams?t.postParams.trim():"",suggestUrl:t.suggestUrl?t.suggestUrl.trim():"",suggestPostParams:t.suggestPostParams?t.suggestPostParams.trim():"",imageUrl:t.imageUrl?t.imageUrl.trim():"",imagePostParams:t.imagePostParams?t.imagePostParams.trim():"",faviconUrl:t.faviconUrl?t.faviconUrl.trim():"",keyword:t.keyword,default:ai.Z.isDefault(e,!1),private:ai.Z.isDefault(e,!0),nicknameTaken:!1,readOnly:t.readOnly}:{guid:e,extensionId:"",extensionName:"",name:"",url:"",postParams:"",suggestUrl:"",suggestPostParams:"",imageUrl:"",imagePostParams:"",faviconUrl:"",keyword:"",default:!1,private:!1,nicknameTaken:!1,readOnly:!0}}class gz extends Li.Component{static contextType=ts.Z;urlHasChanged=!1;constructor(e,t){super(e),this.state=hz(e.guid),this.convertExtensionIdToName(this.state.extensionId)}static getDerivedStateFromProps(e,t){return e.guid!==t.guid?hz(e.guid):null}componentDidMount(){ai.Z.addListener(this._onSearchEngineCacheChanged)}componentWillUnmount(){ai.Z.removeListener(this._onSearchEngineCacheChanged)}componentDidUpdate(e,t){e.guid!==this.props.guid&&(this.save(t,!1),this.urlHasChanged=!1)}_onSearchEngineCacheChanged=()=>{const e=ai.Z.getDefault(!1),t=ai.Z.getDefault(!0);this.setState({default:e?.guid===this.props.guid,private:t?.guid===this.props.guid})};convertExtensionIdToName=e=>{e&&i.Z.management.getAll().then((t=>t.find((t=>t.id===e))?.name)).then((e=>e&&this.setState({extensionName:e})))};handleKeyDown=e=>{"Enter"===e.key&&this.save()};handleBlur=()=>{this.props.guid===this.state.guid&&this.save()};getDataUri=(e,t)=>{const{document:n}=this.context,i=new Image;i.onload=function(){const i=n.createElement("canvas");i.width=this.naturalWidth,i.height=this.naturalHeight,i.getContext("2d").drawImage(this,0,0),t(i.toDataURL(e))},i.src=e};constructFavicon=e=>{const{document:t}=this.context;if((e=e.trim())&&!this.state.faviconUrl){const n=(0,rl.q9)(e),i=t.createElement("a");i.href=n;const s=i.protocol+"//"+i.host+"/favicon.ico";this.getDataUri(s,(e=>{this.urlHasChanged&&this.setState({faviconUrl:e},(()=>this.save()))}))}};canSave=e=>Boolean(e.guid&&!e.nicknameTaken&&""!==e.keyword&&""!==e.name&&""!==e.url);save=(e=this.state,t=!0)=>{if(!this.canSave(e))return;const n=ai.Z.getByGuid(e.guid);if(!n)return;const i=structuredClone(n);i.guid=e.guid,i.name=e.name,i.keyword=e.keyword,i.url=e.url.trim(),i.postParams=e.postParams.trim(),i.suggestUrl=e.suggestUrl.trim(),i.suggestPostParams=e.suggestPostParams.trim(),i.imageUrl=e.imageUrl.trim(),i.imagePostParams=e.imagePostParams.trim(),i.suggestPostParams=e.suggestPostParams.trim(),this.urlHasChanged&&(i.faviconUrl=e.faviconUrl);const s=ai.Z.getDefault(!1)?.guid,o=ai.Z.getDefault(!0)?.guid;(0,QT.Z)(i,n)||se.Z.searchEngines.updateTemplateUrl(i),e.default!==(s===e.guid)&&(se.Z.searchEngines.setDefault("defaultSearch",e.guid),se.Z.searchEngines.setDefault("defaultSearchField",e.guid),se.Z.searchEngines.setDefault("defaultSpeeddials",e.guid)),e.private!==(o===e.guid)&&(e.private?(se.Z.searchEngines.setDefault("defaultPrivate",e.guid),se.Z.searchEngines.setDefault("defaultSearchFieldPrivate",e.guid),se.Z.searchEngines.setDefault("defaultSpeeddialsPrivate",e.guid)):o===n.guid&&s&&(se.Z.searchEngines.setDefault("defaultPrivate",s),se.Z.searchEngines.setDefault("defaultSearchFieldPrivate",s),se.Z.searchEngines.setDefault("defaultSpeeddialsPrivate",s)))};nameChange=e=>{this.setState({name:e.target.value})};nicknameChange=e=>{const t=e.target.value.trim();let n=t.length>0&&void 0!==ai.Z.getByKeyword(t);if(n&&this.props.guid){const e=ai.Z.getByGuid(this.props.guid);e&&e.keyword===t&&(n=!1)}this.setState({keyword:t,nicknameTaken:n})};urlChange=e=>{const t=e.target.value;(0,rl.C3)(t)&&this.constructFavicon(t),this.setState({url:t}),this.urlHasChanged=!0};postParamsChange=e=>{this.setState({postParams:e.target.value})};suggestUrlChange=e=>{this.setState({suggestUrl:e.target.value})};suggestPostParamsChange=e=>{this.setState({suggestPostParams:e.target.value})};imageUrlChange=e=>{this.setState({imageUrl:e.target.value})};imagePostParamsChange=e=>{this.setState({imagePostParams:e.target.value})};defaultChange=e=>{this.setState({default:e.target.checked},(()=>this.save()))};privateChange=e=>{this.setState({private:e.target.checked},(()=>this.save()))};openExtensionsPage=()=>{const{extensionId:e}=this.state;e&&c.ZP.openURL(this.context.vivaldiWindowId,`vivaldi://extensions/?id=${e}`,{singleton:!0})};render(){const e=this.state.nicknameTaken?ai.Z.getByKeyword(this.state.keyword):null,t=e?e.name:"";return uz("div",{className:"detail"},void 0,uz("div",{className:"detail-content"},void 0,this.state.extensionId&&uz(To,{type:"info"},void 0,(0,B.Z)("This search engine is added by “$1” extension.",[this.state.extensionName])," ",uz(A_.Z,{onClick:this.openExtensionsPage},void 0,(0,B.Z)("Show Extension"))),uz("div",{className:"setting-group"},void 0,uz("div",{className:"setting-single"},void 0,uz(Vl.Z,{type:"text",focusInput:this.props.focusNameInput,label:this.props.searchableStrings.title,value:this.state.name,onBlur:this.handleBlur,onChange:this.nameChange,onKeyDown:this.handleKeyDown,disabled:this.state.readOnly})),""===this.state.name.trim()&&uz(To,{type:"warning"},void 0,(0,B.Z)("Name cannot be empty")),uz("div",{className:"setting-single"},void 0,uz(Vl.Z,{type:"text",label:this.props.searchableStrings.Nickname,value:this.state.keyword,onBlur:this.handleBlur,onChange:this.nicknameChange,onKeyDown:this.handleKeyDown,disabled:this.state.readOnly})),""===this.state.keyword&&uz(To,{type:"warning"},void 0,(0,B.Z)("Nickname cannot be empty")),this.state.nicknameTaken&&uz(To,{type:"warning"},void 0,(0,B.Z)("Nickname in use by $1",[t]))),uz("p",{className:"info"},void 0,this.props.searchableStrings["Substitute search keyword in addresses or post parameters with %s or %S"]),uz("p",{className:"info"},void 0,this.props.searchableStrings["Empty post parameters disable the use of POST. Post parameters are in the form name=value,name=value"]),uz("div",{className:"setting-group"},void 0,uz("div",{className:"setting-single"},void 0,uz(Vl.Z,{type:"text",label:this.props.searchableStrings.URL,value:this.state.url,onBlur:this.handleBlur,onChange:this.urlChange,onKeyDown:this.handleKeyDown,disabled:this.state.readOnly})),""===this.state.url.trim()&&uz(To,{type:"warning"},void 0,(0,B.Z)("URL cannot be empty")),""!==this.state.url.trim()&&(0,rl.Zj)(this.state.url)&&!this.state.url.startsWith("{")&&uz(To,{type:"warning"},void 0,(0,B.Z)("You must provide a valid protocol")),uz("div",{className:"setting-single"},void 0,uz(Vl.Z,{type:"text",label:this.props.searchableStrings["POST Parameters"],value:this.state.postParams,onBlur:this.handleBlur,onChange:this.postParamsChange,onKeyDown:this.handleKeyDown,disabled:this.state.readOnly}))),uz("div",{className:"setting-group"},void 0,uz("div",{className:"setting-single"},void 0,uz(Vl.Z,{type:"text",label:this.props.searchableStrings["Suggest URL"],value:this.state.suggestUrl,onBlur:this.handleBlur,onChange:this.suggestUrlChange,onKeyDown:this.handleKeyDown,disabled:this.state.readOnly})),uz("div",{className:"setting-single"},void 0,uz(Vl.Z,{type:"text",label:this.props.searchableStrings["Suggest POST Parameters"],value:this.state.suggestPostParams,onBlur:this.handleBlur,onChange:this.suggestPostParamsChange,onKeyDown:this.handleKeyDown,disabled:this.state.readOnly}))),uz("div",{className:"setting-group"},void 0,uz("div",{className:"setting-single"},void 0,uz(Vl.Z,{type:"text",label:this.props.searchableStrings["Image Search URL"],value:this.state.imageUrl,onBlur:this.handleBlur,onChange:this.imageUrlChange,onKeyDown:this.handleKeyDown,disabled:this.state.readOnly})),uz("div",{className:"setting-single"},void 0,uz(Vl.Z,{type:"text",label:this.props.searchableStrings["Image Search POST Parameters"],value:this.state.imagePostParams,onBlur:this.handleBlur,onChange:this.imagePostParamsChange,onKeyDown:this.handleKeyDown,disabled:this.state.readOnly}))),uz("div",{className:"setting-group pad-top"},void 0,uz("div",{className:"setting-single"},void 0,uz("label",{},void 0,uz("input",{type:"checkbox",checked:this.state.default,disabled:this.state.default,onChange:this.defaultChange}),uz("span",{},void 0,this.props.searchableStrings["Set as Default Search"]))),uz("div",{className:"setting-single"},void 0,uz("label",{},void 0,uz("input",{type:"checkbox",checked:this.state.private,disabled:this.state.default&&this.state.private,onChange:this.privateChange}),uz("span",{},void 0,this.props.searchableStrings["Set as Private Search"]))))))}}const mz=gz;var fz;function vz(e,t,n,i){fz||(fz="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:fz,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class yz extends Li.Component{static contextType=ts.Z;state={currentSearchEngine:void 0,thanksState:!1};componentDidMount(){ai.Z.addListener(this._onSearchEngineCacheChanged)}componentWillUnmount(){ai.Z.removeListener(this._onSearchEngineCacheChanged)}_onSearchEngineCacheChanged=()=>{const e=he.ZP.isIncognito(this.context.vivaldiWindowId),t=ai.Z.getDefault(e),n=ai.Z.getSpeeddialsSearch(e),i=ai.Z.getSearchField(e);t?.prepopulateId!==ai.A&&n?.prepopulateId!==ai.A&&i?.prepopulateId!==ai.A||this.setState({thanksState:!1,currentSearchEngine:void 0})};_updateCurrentEngine=e=>{const t=ai.Z.getByPrepopulateId(Number(e));t&&this.setState({currentSearchEngine:t,thanksState:!0},(()=>{const e=he.ZP.isIncognito(this.context.vivaldiWindowId),n=ai.Z.getDefault(e),i=ai.Z.getSpeeddialsSearch(e),s=ai.Z.getSearchField(e);if(1===n?.prepopulateId){const n=e?"defaultPrivate":"defaultSearch";se.Z.searchEngines.setDefault(n,t.guid)}if(1===i?.prepopulateId){const n=e?"defaultSpeeddialsPrivate":"defaultSpeeddials";se.Z.searchEngines.setDefault(n,t.guid)}if(1===s?.prepopulateId){const n=e?"defaultSearchFieldPrivate":"defaultSearchField";se.Z.searchEngines.setDefault(n,t.guid)}}))};render(){const e=function(){const e=[3,4,5,7];return ai.Z.get().reduce(((e,t)=>{let n="";switch(t.prepopulateId){case 3:n=(0,B.Z)("Powerful AI tools. Speed.");break;case 4:n=(0,B.Z)("A better planet with every search.");break;case 5:n=(0,B.Z)("Powered by Google. Does not track you.");break;case 7:n=(0,B.Z)("Privacy first. Does not track you.");break;default:return e}return e.push({type:"Description",id:t.prepopulateId.toString(),name:t.name,icon:t.faviconUrl,description:n}),e}),[]).sort(((t,n)=>e.indexOf(t.id)-e.indexOf(n.id)))}(),{thanksState:t}=this.state;return vz("div",{className:"tracker-warning"},void 0,vz("button",{className:"close",onClick:()=>{w.Z.set(I.kStartpageSpeedDialTrackerSuggestionShow,!1)},dangerouslySetInnerHTML:{__html:Wi.kze}}),!this.props.hideImg&&vz("img",{className:"tony-illustration",src:t?"resources/tony_thanks.png":"resources/support_tony.png",align:"left"}),t?(0,ss.jsxs)(ss.Fragment,{children:[vz("h1",{},void 0,(0,B.Z)("Thank you for supporting Vivaldi")),vz("p",{},void 0,(0,B.Z)("We appreciate your decision and thank you for helping us stay sustainable. You can try one of our other partners if you're unhappy with the results from your first choice."))]}):(0,ss.jsxs)(ss.Fragment,{children:[vz("h1",{},void 0,(0,B.Z)("Support Vivaldi")),vz("p",{},void 0,(0,B.Z)("We are building the best browser for you. To be able to do this we rely on revenue from our search partners. Consider one of these search engines to help support us:"))]}),vz("div",{className:"engine-suggestion-container"},void 0,vz(wR,{className:"engine-suggestion",items:e,value:this.state.currentSearchEngine?.prepopulateId?.toString()??"",onValueChange:this._updateCurrentEngine,tooltip:(0,B.Z)("Select Default Search Engine")}),vz("a",{className:"support-vivaldi",href:"https://vivaldi.com/contribute/",onClick:()=>{c.ZP.openURL(this.context.vivaldiWindowId,"https://vivaldi.com/contribute/")}},void 0,(0,B.Z)("Other Ways To Support Vivaldi"))))}}const bz=(0,Bu.Z)(yz,[]);var Sz,wz=n(34155);function Cz(e,t,n,i){Sz||(Sz="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Sz,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Az=[I.kAddressBarInlineSearchEnabled,I.kSearchSuggestEnabled,I.kAddressBarInlineSearchSuggestOnNickname,I.kAddressBarSearchAllowExtensionOverride,I.kAddressBarSearchDisplay,I.kAddressBarSearchInNewTab,I.kAddressBarSearchKeepSelected,I.kAddressBarSearchShowFavicon,I.kAddressBarSearchShowKeyword,I.kAddressBarSearchSuggestEnabled,I.kPageSearchInBackground,I.kAddressBarSearchKeepTypedText,I.kStartpageSpeedDialDisplaySearch,I.kAddressBarSearchDirectMatchEnabled,I.kStartpageSpeedDialTrackerSuggestionShow],Iz=Az.filter((e=>e!==I.kStartpageSpeedDialTrackerSuggestionShow)),Tz=w.Z.getEventHandler,Zz={width:400,minWidth:"unset"};function Ez({engines:e,selectedEngine:t,onValueChange:n,tooltip:i}){const s=e.map((e=>({type:"Normal",id:e.guid,name:e.name,faviconUrl:e.faviconUrl,checked:t?.guid===e.guid})));return Cz(wR,{items:s,value:t?t.guid:"",onValueChange:n,tooltip:i})}var kz=Cz("input",{type:"radio",value:"field"}),_z=Cz("input",{type:"radio",value:"button"}),Nz=Cz("div",{className:"setting-single pad-left"});function Pz(e){const t=Li.useContext(ts.Z),n=(0,Ya.Z)(Az),i=sN({filter:e.filter,prefPaths:Iz,name:e.category.title}),s=Li.useRef(!1),o=Li.useRef(0),[a,r]=(Li.useRef(),Li.useState(!1)),[l,d]=Li.useState(!1),[u,p]=Li.useState(ai.Z.get());Li.useEffect((()=>{function e(){p(ai.Z.get())}return ai.Z.addListener(e),()=>ai.Z.removeListener(e)}),[]);const h=()=>{se.Z.searchEngines.repairPrepopulatedTemplateUrls(!l),r(!1)},g=(e,t)=>{se.Z.searchEngines.setDefault(t?"defaultPrivate":"defaultSearch",e),o.current=(o.current??0)+1},m=()=>{r(!1)};var f=Cz("input",{type:"checkbox",checked:l,onChange:()=>{d((e=>!e))}});if(!u)return null;const v=ai.Z.getDefault(!1),y=ai.Z.getDefault(!0),b=ai.Z.getImageSearch(),S=u.filter((e=>e.imageUrl));b&&!S.find((e=>e.guid===b.guid))&&S.push(b);const w=u.map((e=>({key:e.guid,name:e.name,isDefault:e.guid===v?.guid,isStatic:""!==e.extensionId,isRemovable:ai.Z.isRemovable(e.guid)&&!e.extensionId})));return(0,ss.jsxs)(ss.Fragment,{children:[Cz("section",{className:"setting-section"},void 0,Cz(tN.Z,{categoryTitle:(0,B.Z)("noun","Search"),filter:e.filter},void 0,a&&(()=>{const e=l?(0,B.Z)("Search engines will be reset to default settings, but your custom search engines will be kept."):(0,B.Z)("Search engines will be reset to default settings, which will also reset your custom search engines.");return Cz(ra.Z,{style:Zz,className:"float",onRequestClose:m,title:(0,B.Z)("Restore Default Search Engines?")},void 0,Cz("div",{className:"dialog-restore-search"},void 0,Cz("div",{className:"dialog-content"},void 0,Cz("p",{},void 0,e)),Cz("footer",{className:"dialog-footer"},void 0,Cz("label",{},void 0,f,Cz("span",{},void 0,(0,B.Z)("Keep Custom Searches"))),Cz("input",{type:"button",className:"danger",onClick:h,value:(0,B.Z)("Restore")}),Cz("input",{type:"button",onClick:m,value:(0,B.Z)("Cancel"),autoFocus:!0}))))})(),Cz("div",{},void 0,!1,Cz("div",{className:"setting-group"},void 0,Cz("div",{className:"setting-single"},void 0,Cz("h3",{},void 0,(0,B.Z)("Default Search Engine")),Cz(Ez,{engines:u,selectedEngine:v,onValueChange:e=>{se.Z.searchEngines.setDefault("defaultSearch",e),se.Z.searchEngines.setDefault("defaultSearchField",e),se.Z.searchEngines.setDefault("defaultSpeeddials",e)},tooltip:(0,B.Z)("Select Default Search Engine")}))),Cz("div",{className:"setting-group"},void 0,Cz("div",{className:"setting-single"},void 0,Cz("h3",{},void 0,(0,B.Z)("Private Window Search Engine")),Cz(Ez,{engines:u,selectedEngine:y,onValueChange:e=>{se.Z.searchEngines.setDefault("defaultPrivate",e),se.Z.searchEngines.setDefault("defaultSearchFieldPrivate",e),se.Z.searchEngines.setDefault("defaultSpeeddialsPrivate",e)},tooltip:(0,B.Z)("Select Private Window Search Engine")}))),Cz("div",{className:"setting-group"},void 0,Cz("div",{className:"setting-single"},void 0,Cz("h3",{},void 0,(0,B.Z)("Image Search Engine")),Cz(Ez,{engines:S,selectedEngine:b,onValueChange:e=>se.Z.searchEngines.setDefault("defaultImage",e),tooltip:(0,B.Z)("Select Default Search Engine for Images")})))),Cz("div",{className:"setting-group"},void 0,Cz("h3",{},void 0,(0,B.Z)("Search Field Display")),Cz("div",{className:"setting-single"},void 0,Cz("label",{},void 0,Cz(ja.Z,{name:"renderSearchField",value:n[I.kAddressBarSearchDisplay],onChange:Tz(I.kAddressBarSearchDisplay)},void 0,Cz("div",{className:"setting-single"},void 0,Cz("label",{},void 0,kz,Cz("span",{},void 0,(0,B.Z)("Show as a Text Field")))),Cz("div",{className:"setting-single"},void 0,Cz("label",{},void 0,_z,Cz("span",{},void 0,(0,B.Z)("Show as a Button"))))))),Cz("div",{className:"setting-single"},void 0,Cz("label",{},void 0,Cz("input",{type:"checkbox",checked:n[I.kAddressBarSearchShowKeyword],onChange:Tz(I.kAddressBarSearchShowKeyword)}),Cz("span",{},void 0,(0,B.Z)("Show Search Engine Nickname in Drop-Down Menu")))),Cz("div",{className:"setting-single"},void 0,Cz("label",{},void 0,Cz("input",{type:"checkbox",checked:n[I.kAddressBarSearchInNewTab],onChange:Tz(I.kAddressBarSearchInNewTab)}),Cz("span",{},void 0,(0,B.Z)("Always Search in New Tab")))),Cz("div",{className:"setting-single"},void 0,Cz("label",{},void 0,Cz("input",{type:"checkbox",checked:n[I.kAddressBarSearchShowFavicon],onChange:Tz(I.kAddressBarSearchShowFavicon)}),Cz("span",{},void 0,(0,B.Z)("Show Search Engine Icon"))))),Cz("div",{className:"setting-group"},void 0,Cz("h3",{},void 0,(0,B.Z)("Search Options")),Cz("div",{className:"setting-single"},void 0,Cz("label",{},void 0,Cz("input",{type:"checkbox",checked:n[I.kAddressBarInlineSearchEnabled],onChange:Tz(I.kAddressBarInlineSearchEnabled)}),Cz("span",{},void 0,(0,B.Z)("Search in Address Field")))),Cz("div",{className:"setting-single pad-left"},void 0,Cz("label",{},void 0,Cz("input",{type:"checkbox",checked:n[I.kAddressBarSearchAllowExtensionOverride],onChange:Tz(I.kAddressBarSearchAllowExtensionOverride)}),Cz("span",{},void 0,(0,B.Z)("Allow Control by Extensions"))),Cz("p",{className:"info"},void 0,(0,B.Z)("Requires a restart to take effect"))),Cz("div",{className:"setting-single"},void 0,Cz("label",{},void 0,Cz("input",{type:"checkbox",checked:n[I.kStartpageSpeedDialDisplaySearch],onChange:Tz(I.kStartpageSpeedDialDisplaySearch)}),Cz("span",{},void 0,(0,B.Z)("Show Search Field on Speed Dial")))),Cz("div",{className:"setting-single"},void 0,Cz("label",{},void 0,Cz("input",{type:"checkbox",checked:n[I.kAddressBarSearchKeepSelected],onChange:Tz(I.kAddressBarSearchKeepSelected)}),Cz("span",{},void 0,(0,B.Z)("Keep Last Selected Search Engine")))),Cz("div",{className:"setting-single"},void 0,Cz("label",{},void 0,Cz("input",{type:"checkbox",checked:n[I.kAddressBarSearchKeepTypedText],onChange:Tz(I.kAddressBarSearchKeepTypedText)}),Cz("span",{},void 0,(0,B.Z)("Keep Typed Text After Searching")))),Cz("div",{className:"setting-single"},void 0,Cz("label",{},void 0,Cz("input",{type:"checkbox",checked:n[I.kPageSearchInBackground],onChange:Tz(I.kPageSearchInBackground)}),Cz("span",{},void 0,(0,B.Z)("Page Selection Search in Background"))))),Cz("div",{className:"setting-group"},void 0,Cz("div",{id:"searchSuggest",className:"setting-group"},void 0,Cz("h3",{},void 0,(0,B.Z)("Allow Search Suggestions")),Cz("div",{className:"setting-single"},void 0,Cz("label",{},void 0,Cz("input",{type:"checkbox",checked:n[I.kSearchSuggestEnabled],onChange:Tz(I.kSearchSuggestEnabled)}),Cz("span",{},void 0,(0,B.Z)("searchengine","In Address Field")))),Cz("div",{className:"setting-single pad-left"},void 0,Cz("label",{},void 0,Cz("input",{type:"checkbox",checked:n[I.kAddressBarInlineSearchSuggestOnNickname],disabled:!n[I.kSearchSuggestEnabled],onChange:Tz(I.kAddressBarInlineSearchSuggestOnNickname)}),Cz("span",{},void 0,(0,B.Z)("Only when Using Search Engine Nickname")))),Cz("div",{className:"setting-single"},void 0,Cz("label",{},void 0,Cz("input",{type:"checkbox",checked:n[I.kAddressBarSearchSuggestEnabled],onChange:Tz(I.kAddressBarSearchSuggestEnabled)}),Cz("span",{},void 0,(0,B.Z)("searchengine","In Search Field")))),Cz("div",{className:"setting-single"},void 0,Cz("label",{},void 0,Cz("input",{type:"checkbox",checked:n[I.kAddressBarSearchDirectMatchEnabled],onChange:Tz(I.kAddressBarSearchDirectMatchEnabled)}),Cz("span",{},void 0,(0,B.Z)("searchengine","Enable Direct Match"))),Cz("a",{className:"info",onClick:()=>c.ZP.openURL(t.vivaldiWindowId,"https://help.vivaldi.com/others/what-is-direct-match/"),href:"https://help.vivaldi.com/others/what-is-direct-match/"},void 0,(0,B.Z)("Learn more about Direct Match"))))),Cz(QD.Z,{className:"setting-search-engine",filter:e.filter,subtitle:(0,B.Z)("Search Engines"),deleteTitle:(0,B.Z)("title","Delete Search Engine"),addTipString:(0,B.Z)("Add Search Engine"),deleteTipString:(0,B.Z)("tooltip","Delete Search Engine"),items:w,supportDragAndDrop:!0,masterLayout:1,mimeType:"vivaldi/x-search-engine",renderListItem:(e,t)=>{const n=ai.Z.getByGuid(t.key);if(!n)return(0,ss.jsx)(ss.Fragment,{children:Cz("div",{className:"item-title"},void 0,e||"Error")});const i=ai.Z.isDefault(n.guid,!0),s=n.guid===ai.Z.getImageSearch()?.guid;return(0,ss.jsxs)(ss.Fragment,{children:[Cz(Ri.ZP,{className:"item-icon",url:n.faviconUrl,loadType:"faviconFromCache"}),Cz("div",{className:"item-title"},void 0,e||n.name),i&&Cz("span",{className:"item-badge",title:(0,B.Z)("Private Window Search Engine")},void 0,(0,B.Z)("Private")),s&&Cz("span",{className:"item-badge",title:(0,B.Z)("Default Image Search Engine")},void 0,(0,B.Z)("Image")),Cz("div",{className:"item-meta"},void 0,n.keyword)]})},renderContent:(t,n)=>{const i=u[t];return i?Cz(mz,{focusNameInput:Boolean(s.current),searchableStrings:n,filter:e.filter,guid:i.guid},i.guid):null},contentStrings:pz,moveItem:(e,t)=>{const n=e<t?t+1:t;if(e>=0&&e<u.length&&n>=0&&n<=u.length){const t=u[e];if(n===u.length)se.Z.searchEngines.moveTemplateUrl(t.guid);else{const e=u[n];se.Z.searchEngines.moveTemplateUrl(t.guid,e.guid)}}},onContextMenu:(e,n)=>{const i=[];if(e>=0&&e<u.length){const t=u[e];ai.Z.isDefault(t.guid,!1)||i.push({handler:()=>g(t.guid,!1),...(0,us.Z)("searchengine","Set as Default Search")}),ai.Z.isDefault(t.guid,!0)||i.push({handler:()=>g(t.guid,!0),...(0,us.Z)("searchengine","Set as Private Search")})}(0,cs.Z)(t,i)(n)},onActivate:e=>{if(e>=0&&e<u.length){const t=u[e];g(t.guid,!1)}},onRemove:e=>{if(e>=0&&e<u.length){const t=u[e];se.Z.searchEngines.removeTemplateUrl(t.guid)}},onCreateItem:async()=>{const e=sl();e.name=(0,B.Z)("New Engine"),await se.Z.searchEngines.addTemplateUrl(e),s.current=!0,wz.nextTick((()=>s.current=!1))}}),Cz("div",{className:"setting-group unlimited"},void 0,Cz("div",{className:"setting-single"},void 0,Cz("input",{type:"button",onClick:()=>{r(!0),wz.nextTick((()=>{o.current=(o.current??0)+1}))},value:(0,B.Z)("Restore Defaults")}),Nz)))),i]})}const Dz=Li.memo(Pz);var Mz;function Oz(e,t,n,i){Mz||(Mz="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Mz,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const xz=["appearance","tabs","qc","privacy","mail","all"];function Lz(e){return Object.keys(pn.mh).filter((e=>{if("chat"===e){return!1&&Oi.Z.isEnabled("chat")}return!("reset"===e)})).map((e=>({...pn.mh[e],key:e})))}class Rz extends Li.PureComponent{rowComponent=e=>{const t=e.node,n=this.props.selectedCategory.title===t.title;return Oz("div",{onMouseDown:e=>e.preventDefault(),className:Fi()({"button-category":!0,"category-selected":n,spacer:xz.includes(t.key),["group_"+t.group]:!0})},t.id,Oz("span",{dangerouslySetInnerHTML:{__html:t.icon}}),t.title)};getHeight=({index:e})=>{const t=Lz(this.props.selectedCategory)[e];if(t){const e=t.title.length;return 8*Math.ceil(e/24)+20+(xz.includes(t.key)?12:0)}return Zs()};handleItemClick=(e,{key:t})=>{this.props.onCategorySelected(t)};handleItemsActivated=(e,t)=>{this.props.onCategorySelected(t[0].key)};handleFilterChange=({currentTarget:e})=>{this.props.onFilterChange(e.value)};render(){return Oz("div",{className:"settings-sidebar"},void 0,Oz("header",{className:"settings-navigation-header"},void 0,(0,ss.jsx)("input",{className:"settings-search",type:"search",ref:this.props.focusRef,placeholder:(0,B.Z)("verb","Search"),value:this.props.filter,onChange:this.handleFilterChange,autoFocus:he.ZP.isSettings(this.context.vivaldiWindowId),tabIndex:"0"})),Oz(Ps,{rowComponent:this.rowComponent,nodes:Lz(this.props.selectedCategory),className:"settings-navigation",settings:"SETTINGS_TREE",onItemClick:this.handleItemClick,onItemsActivated:this.handleItemsActivated,enableDragAndDrop:!1,rowHeight:this.getHeight,isFolder:gE.Z,hasChildren:gE.Z,multiSelect:!1}))}}const Bz=Rz;var Fz;function Wz(e,t,n,i){Fz||(Fz="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Fz,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Uz=[I.kStartpageNavigation,I.kStartpageSpeedDialAddButtonVisible,I.kStartpageSpeedDialAllowDnd,I.kStartpageSpeedDialColumns,I.kStartpageSpeedDialControlsVisible,I.kStartpageSpeedDialDeleteVisible,I.kStartpageSpeedDialFaviconVisible,I.kDashboardEnabled,I.kStartpageSpeedDialGameButtonShow,I.kStartpageSpeedDialTitlesVisible,I.kDashboardColumnLimit,I.kStartpageSpeedDialRestorePage,I.kStartpageSpeedDialSize,I.kStartpageSpeedDialPrivacyStatsShow],Vz=w.Z.getEventHandler,Hz=new Map([["icon",{value:90,label:(0,B.Z)("other","Icon")}],["tiny",{value:120,label:(0,B.Z)("Tiny")}],["small",{value:170,label:(0,B.Z)("other","Small")}],["medium",{value:220,label:(0,B.Z)("other","Medium")}],["large",{value:270,label:(0,B.Z)("other","Large")}],["huge",{value:320,label:(0,B.Z)("Huge")}],["fit_to_columns",{value:-1,label:(0,B.Z)("Scale to Fit Columns")}]]);var Gz=Wz("input",{type:"radio",value:"on"}),$z=Wz("input",{type:"radio",value:"speed_dial_only"}),Kz=Wz("input",{type:"radio",value:"off"}),zz=Wz("option",{value:1},void 0,"1"),jz=Wz("option",{value:2},void 0,"2"),Yz=Wz("option",{value:3},void 0,"3"),Xz=Wz("option",{value:4},void 0,"4"),Qz=Wz("input",{type:"radio",value:"always"}),qz=Wz("input",{type:"radio",value:"hover"}),Jz=Wz("input",{type:"radio",value:"never"}),ej=Wz("option",{value:1},void 0,"1"),tj=Wz("option",{value:2},void 0,"2"),nj=Wz("option",{value:3},void 0,"3"),ij=Wz("option",{value:4},void 0,"4"),sj=Wz("option",{value:5},void 0,"5"),oj=Wz("option",{value:6},void 0,"6"),aj=Wz("option",{value:7},void 0,"7"),rj=Wz("option",{value:8},void 0,"8"),lj=Wz("option",{value:10},void 0,"10"),dj=Wz("option",{value:12},void 0,"12");function cj(e){const t=(0,Ya.Z)(Uz),n=sN({filter:e.filter,prefPaths:Uz,name:e.category.title});return(0,ss.jsxs)(ss.Fragment,{children:[Wz("section",{className:"setting-section"},void 0,Wz(tN.Z,{categoryTitle:(0,B.Z)("verb","Start Page"),filter:e.filter},void 0,Wz("div",{className:"setting-group unlimited"},void 0,Wz("div",{className:"setting-group setting-group-double"},void 0,Wz("h3",{},void 0,(0,B.Z)("Start Page Navigation")),Wz("div",{className:"setting-single"},void 0,Wz(ja.Z,{name:"StartPageNavigation",value:t[I.kStartpageNavigation],onChange:Vz(I.kStartpageNavigation)},void 0,Wz("div",{className:"setting-single"},void 0,Wz("label",{},void 0,Gz,Wz("span",{},void 0,(0,B.Z)("Show on Internal Pages")))),Wz("div",{className:"setting-single"},void 0,Wz("label",{},void 0,$z,Wz("span",{},void 0,(0,B.Z)("Show on Speed Dial and Dashboard")))),Wz("div",{className:"setting-single"},void 0,Wz("label",{},void 0,Kz,Wz("span",{},void 0,(0,B.Z)("radio","Hide"))))))))),Wz(tN.Z,{categoryTitle:(0,B.Z)("verb","Dashboard"),filter:e.filter},void 0,Wz("div",{className:"setting-group unlimited"},void 0,Wz("div",{className:"setting-group"},void 0,Wz("div",{className:"setting-single"},void 0,Wz("label",{},void 0,Wz("input",{type:"checkbox",checked:t[I.kDashboardEnabled],onChange:Z}),Wz("span",{},void 0,(0,B.Z)("Enable Dashboard")))),Wz("div",{className:"setting-single pad-top"},void 0,Wz("h3",{},void 0,(0,B.Z)("Maximum Columns")),Wz(ta.Z,{className:"max-columns",value:t[I.kDashboardColumnLimit],onChange:Vz(I.kDashboardColumnLimit),title:(0,B.Z)("Maximum number of Dashboard columns")},void 0,zz,jz,Yz,Xz))))),Wz(tN.Z,{categoryTitle:(0,B.Z)("Speed Dial"),filter:e.filter},void 0,Wz("div",{className:"setting-group"},void 0,Wz("h3",{},void 0,(0,B.Z)("Speed Dial Appearance")),Wz(ja.Z,{name:"SpeedDialTitles",value:t[I.kStartpageSpeedDialTitlesVisible],onChange:Vz(I.kStartpageSpeedDialTitlesVisible)},void 0,Wz("div",{className:"setting-single"},void 0,Wz("label",{},void 0,Qz,Wz("span",{},void 0,(0,B.Z)("Show Title")))),Wz("div",{className:"setting-single"},void 0,Wz("label",{},void 0,qz,Wz("span",{},void 0,(0,B.Z)("Show Title on Hover")))),Wz("div",{className:"setting-single"},void 0,Wz("label",{},void 0,Jz,Wz("span",{},void 0,(0,B.Z)("Hide Title"))))),Wz("div",{className:"setting-single pad-top"},void 0,Wz("label",{},void 0,Wz("input",{type:"checkbox",checked:t[I.kStartpageSpeedDialFaviconVisible],onChange:Vz(I.kStartpageSpeedDialFaviconVisible),disabled:"never"===t[I.kStartpageSpeedDialTitlesVisible]}),Wz("span",{},void 0,(0,B.Z)("Show Favicon")))),Wz("div",{className:"setting-single"},void 0,Wz("label",{},void 0,Wz("input",{type:"checkbox",checked:t[I.kStartpageSpeedDialDeleteVisible],onChange:Vz(I.kStartpageSpeedDialDeleteVisible)}),Wz("span",{},void 0,(0,B.Z)("Show Delete Button")))),Wz("div",{className:"setting-single"},void 0,Wz("label",{},void 0,Wz("input",{type:"checkbox",checked:t[I.kStartpageSpeedDialControlsVisible],onChange:Vz(I.kStartpageSpeedDialControlsVisible)}),Wz("span",{},void 0,(0,B.Z)("Show Thumbnail Control Buttons")))),Wz("div",{className:"setting-single"},void 0,Wz("label",{},void 0,Wz("input",{type:"checkbox",checked:t[I.kStartpageSpeedDialAddButtonVisible],onChange:Vz(I.kStartpageSpeedDialAddButtonVisible)}),Wz("span",{},void 0,(0,B.Z)("Show “Add” Button"))),Wz("p",{className:"info"},void 0,(0,B.Z)("When disabled, new bookmarks can be added by double-clicking the Speed Dial background."))),Wz("div",{className:"setting-single"},void 0,Wz("label",{},void 0,Wz("input",{type:"checkbox",checked:t[I.kStartpageSpeedDialPrivacyStatsShow],onChange:Vz(I.kStartpageSpeedDialPrivacyStatsShow)}),Wz("span",{},void 0,(0,B.Z)("Show Privacy Statistics"))))),Wz("div",{className:"setting-group"},void 0,Wz("div",{className:"setting-single"},void 0,Wz("h3",{},void 0,(0,B.Z)("Maximum Columns")),Wz(ta.Z,{className:"max-columns",value:t[I.kStartpageSpeedDialColumns],onChange:Vz(I.kStartpageSpeedDialColumns),title:(0,B.Z)("Maximum number of Speed Dial columns")},void 0,ej,tj,nj,ij,sj,oj,aj,rj,lj,dj,Wz("option",{value:99},void 0,(0,B.Z)("Unlimited")))),Wz("div",{className:"setting-single pad-top"},void 0,Wz("h3",{},void 0,(0,B.Z)("Speed Dial Size")),Wz(ta.Z,{className:"max-columns",value:t[I.kStartpageSpeedDialSize],onChange:Vz(I.kStartpageSpeedDialSize)},void 0,Array.from(Hz).map((([e,{label:t}])=>Wz("option",{value:e},e,t))))),Wz("div",{className:"setting-single pad-top"},void 0,Wz("label",{},void 0,Wz("input",{type:"checkbox",checked:t[I.kStartpageSpeedDialAllowDnd],onChange:Vz(I.kStartpageSpeedDialAllowDnd)}),Wz("span",{},void 0,(0,B.Z)("Allow Drag and Drop Reordering"))))),Wz("div",{className:"setting-group"},void 0,Wz("div",{className:"setting-single"},void 0,Wz("h3",{},void 0,(0,B.Z)("Vivaldia, the Vivaldi Game")),Wz("label",{},void 0,Wz("input",{type:"checkbox",checked:t[I.kStartpageSpeedDialGameButtonShow],onChange:Vz(I.kStartpageSpeedDialGameButtonShow)}),Wz("span",{},void 0,(0,B.Z)("Show on Speed Dial"))))))),n]})}const uj=Li.memo(cj);var pj;function hj(e,t,n,i){pj||(pj="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:pj,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class gj extends Li.PureComponent{state={remaining:W().duration({})};componentDidMount=()=>{this.timer=setInterval(this.nextTick,1e3)};componentWillUnmount=()=>clearInterval(this.timer);nextTick=()=>{this.setState({remaining:W().duration(this.props.end.diff(W()()))}),this.props.end.isAfter(W()())?this.props.onElapsed(!1):(this.props.onElapsed(!0),clearInterval(this.timer))};render(){const e=this.state.remaining;return hj("span",{},void 0,(0,B.Z)(this.props.label,[e.minutes().toString().padStart(2,"0")+":"+e.seconds().toString().padStart(2,"0")]))}}const mj=gj;var fj;function vj(e,t,n,i){fj||(fj="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:fj,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function yj(e){c.ZP.openURL(e,"https://login.vivaldi.net/profile/samlsso")}function bj(){Di.logout()}function Sj({windowId:e,deviceName:t,pictureUrl:n,username:i,isLoggedIn:s,donationTier:o}){const[a,r]=Li.useState(!1),l="3"===o?(0,B.Z)("Advocate"):"2"===o?(0,B.Z)("Patron"):"1"===o?(0,B.Z)("Supporter"):"",d=Li.useCallback((e=>{const t=e.currentTarget.value;switch(e.key){case"Escape":r(!1),e.preventDefault();break;case"Enter":""===t.trim()?w.Z.reset(I.kSyncSessionName):w.Z.set(I.kSyncSessionName,t),r(!1),e.preventDefault()}}),[]);return vj("div",{className:"sync-status"},void 0,vj("div",{className:"avatar-username"},void 0,vj("span",{className:"profile-picture-wrapper"},void 0,vj("img",{src:n||"/resources/default-avatar.png",className:"profile-picture",title:(0,B.Z)("View account profile page"),onClick:()=>yj(e),alt:""}),o&&vj("img",{className:"Supporter-Badge",src:`/resources/badge-${cp(o)}-16@2x.png`,title:(0,B.Z)("Vivaldi $1\nThank you for your contribution!",[l])})),vj("div",{className:"user-info"},void 0,vj("strong",{className:"username",title:(0,B.Z)("View account profile page"),onClick:()=>yj(e)},void 0,i),a?vj("input",{type:"text",defaultValue:t,onKeyDown:d,autoFocus:!0,onBlur:()=>r(!1)}):(0,ss.jsx)(ss.Fragment,{children:t&&vj("label",{onClick:()=>r(!0),className:"device-name",title:(0,B.Z)("Edit device name")},void 0,vj("span",{className:"info"},void 0," "+(0,B.Z)("on $1",[t])),vj("span",{className:"edit-device-name",dangerouslySetInnerHTML:{__html:Wi.JHW}}))}))),s&&vj("input",{type:"button",value:(0,B.Z)("Log Out"),onClick:bj}))}var wj,Cj,Aj=n(34155);function Ij(e,t,n,i){wj||(wj="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:wj,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class Tj extends Li.PureComponent{_refInput=Li.createRef();state={type:"password"};toggleVisibility=()=>{const e={start:this._refInput.current?.selectionStart||0,end:this._refInput.current?.selectionEnd||0};this.setState((e=>({type:"text"===e.type?"password":"text"}))),Aj.nextTick((()=>{this._refInput.current&&(this._refInput.current.selectionStart=e.start,this._refInput.current.selectionEnd=e.end)}))};render(){const{hideButton:e,...t}=this.props;return Ij("span",{className:"PasswordInputWrapper"},void 0,(0,ss.jsx)("input",{...t,ref:this._refInput,type:this.state.type,className:"PasswordInput"}),!e&&Ij("button",{type:"button",title:"password"===this.state.type?(0,B.Z)("title","Show password"):(0,B.Z)("Hide password"),onClick:this.toggleVisibility,className:"PasswordToggle",tabIndex:"-1",dangerouslySetInnerHTML:{__html:Wi.sgm.medium}}))}}function Zj(e,t,n,i){Cj||(Cj="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Cj,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Ej="•••••••",kj=w.Z.getEventHandler,_j="17006";class Nj extends Li.PureComponent{static contextType=ts.Z;constructor(e){super(e),this.state={username:e.accountState.accountInfo.username,password:e.accountState.hasSavedPassword?Ej:"",sessionName:"",savePassword:!1,countdownElapsed:!1}}onCountDownElapsed=e=>{this.setState({countdownElapsed:e})};onUsernameChange=e=>{this.setState({username:e.target.value})};onPasswordChange=e=>{this.setState({password:e.target.value})};onSavePasswordChange=e=>{this.setState({savePassword:e.target.checked})};onRecoverAccount=()=>{c.ZP.openURL(this.context.vivaldiWindowId,"https://login.vivaldi.net/profile/id/recoverAccount",{inCurrent:!1})};onPasswordReset=()=>{c.ZP.openURL(this.context.vivaldiWindowId,"https://login.vivaldi.net/profile/id/userInfoView",{inCurrent:!1})};onLogin=()=>{this.state.username&&this.state.password&&Di.login(this.state.username,this.state.password===Ej?"":this.state.password,this.state.savePassword)};onLogout=()=>{Di.logout()};onRegister=()=>{this.props.onChangeDisplay()};renderForm=e=>{const t=""!==this.props.accountState.accountInfo.accountId,n=this.props.accountState.hasSavedPassword&&this.props.accountState.accountInfo.username===this.state.username,i=n&&this.state.password===Ej;return Zj("form",{onSubmit:this.onLogin,noValidate:!0},void 0,Zj("h1",{},void 0,(0,B.Z)("Log in to Your Account")),Zj("p",{},void 0,(0,B.Z)("To begin with data synchronization, a confirmed Vivaldi account is required. New to Vivaldi?")," ",Zj(A_.Z,{onClick:this.onRegister},void 0,(0,B.Z)("Create an Account."))),Zj("div",{className:"AccountSheet-Form"},void 0,Zj("label",{},void 0,(0,B.Z)("Username"),Zj("input",{type:"text",value:this.state.username,disabled:t,onChange:this.onUsernameChange,autoFocus:this.props.autoFocus})),!i&&Zj(A_.Z,{onClick:this.onRecoverAccount},void 0,(0,B.Z)("Forgot Username?")),Zj("label",{},void 0,(0,B.Z)("Password"),Zj(Tj,{value:this.state.password,onChange:this.onPasswordChange,hideButton:i})),!n&&Zj(A_.Z,{onClick:this.onPasswordReset},void 0,(0,B.Z)("Forgot Password?")),Zj("label",{className:"AccountSheet-Password"},void 0,Zj("input",{type:"checkbox",disabled:i,checked:this.state.savePassword||i,onChange:this.onSavePasswordChange}),(0,B.Z)("Save Password")),Zj("label",{},void 0,(0,B.Z)("Device Name"),Zj("input",{type:"text",defaultValue:this.props.customSessionName,placeholder:this.props.defaultSessionName,onChange:kj(I.kSyncSessionName)}))),e&&Zj(To,{type:"error"},void 0,e),Zj("div",{className:"AccountSheet-Footer"},void 0,t&&Zj("input",{type:"button",value:(0,B.Z)("Cancel"),onClick:this.onLogout}),Zj("input",{type:"submit",value:(0,B.Z)("Login")})))};render(){if(he.ZP.isIncognitoOrGuest(this.context.vivaldiWindowId))return null;const{accountState:e,defaultSessionName:t}=this.props,n=e.accountInfo.username,i=e.lastTokenFetchError.serverMessage,s=e.lastTokenFetchError.errorCode,o=W()(e.nextTokenRequestTime),a=C.Z.get(I.kSyncSessionName)||t;let r=null;switch(ce(e)){case"loggedIn":return(0,ss.jsxs)(ss.Fragment,{children:[Zj("h1",{},void 0,(0,B.Z)("Connected")),Zj("p",{},void 0,(0,B.Z)("Vivaldi account is active and connected.")),Zj(Sj,{windowId:this.context.vivaldiWindowId,deviceName:a,pictureUrl:e.accountInfo.pictureUrl,username:n,isLoggedIn:!0})]});case"loginFailed":if(i){if(e.lastTokenFetchError.serverMessage.startsWith(_j))break;r=function(e){const t=parseInt(e.substring(0,5));switch(t){case 17001:return(0,B.Z)("$1 Account doesn’t exist.",[t]);case 17002:return(0,B.Z)("$1 Invalid credentials are provided.",[t]);case 17003:return(0,B.Z)("$1 Account is locked after multiple incorrect login attempts, please wait 5 minutes.",[t]);case 17004:return(0,B.Z)("$1 Account is disabled.",[t]);case 17005:return(0,B.Z)("$1 Account has been temporarily locked as a result of multiple unsuccessful login attempts. Please wait 5 minutes before trying again.",[t]);case 17006:return(0,B.Z)("$1 Account hasn’t been activated yet. Please check your email to finish the registration process.",[t]);default:return e}}(i)}else r=-1===s?(0,B.Z)("You must use a vivaldi.net user account to log in."):(0,B.Z)("Vivaldi.net rejected your credentials: Error code $1",[s]);break;case"loggingIn":return o.isAfter(W()())&&("network_error"===e.lastTokenFetchError.errorType&&(r=(0,B.Z)("Unable to connect to vivaldi.net: $1 ($2)",[i,s])),"server_error"===e.lastTokenFetchError.errorType&&(r=i?(0,B.Z)("Vivaldi.net is experiencing issues: $1 ($2)",[i,s]):(0,B.Z)("Vivaldi.net is experiencing issues: Error code $1",[s]))),(0,ss.jsxs)(ss.Fragment,{children:[Zj("div",{className:"AccountSheet-Form"},void 0,Zj("p",{className:r?null:"in-progress"},void 0,(0,B.Z)("Logging in to Vivaldi.net as $1.",[n]),!r&&" "+(0,B.Z)("Please wait."))),r&&Zj(To,{type:"error"},void 0,r," ",Zj(mj,{label:(0,B.Z)("Retrying in $1"),end:o,onElapsed:this.onCountDownElapsed})),Zj("div",{className:"AccountSheet-Footer"},void 0,Zj("input",{type:"button",value:(0,B.Z)("Cancel"),onClick:this.onLogout}))]});case"credentialsMissing":r=e.hasEncryptedToken?(0,B.Z)("Failed to decrypt your credentials. Please log in again."):(0,B.Z)("Failed to retreive your credentials. Please log in again.")}return this.renderForm(r)}}const Pj=Nj;var Dj,Mj=n(34155);function Oj(e,t,n,i){Dj||(Dj="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Dj,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const xj=/[a-zA-Z0-9]{3,30}/,Lj=R.ZP.UI_LANGUAGE.replace("-","_"),Rj=w.Z.getEventHandler;let Bj=new AbortController;const Fj=()=>Bj.abort();function Wj(e,t){Fj();const n=new Promise(((n,i)=>{Bj=new AbortController,fetch(e,{method:"POST",body:JSON.stringify(t),signal:Bj.signal,headers:{"Content-Type":"application/json"}}).then((e=>{e.ok||i(e.text()),n(e.json())}))})),i=new Promise(((e,t)=>{const n=setTimeout((()=>{clearTimeout(n),t({status:0,statusText:"Error: Connection timed out [9010]"})}),6e4)}));return Promise.race([n,i])}class Uj extends Li.PureComponent{static contextType=ts.Z;_refEmailField=Li.createRef();_refConfirmEmailField=Li.createRef();_refUsernameField=Li.createRef();_refAgeField=Li.createRef();_refPasswordField=Li.createRef();_refConfirmPasswordField=Li.createRef();_refVerifyAccountField=Li.createRef();constructor(e){super(e),this.state={username:e.accountState.accountInfo.username||"",email:"",error:"",age:-1,password:"",savePassword:!0,step:e.unverified?3:1,fetching:!1,agreedToTerms:!1,agreedToNewsletter:!1,activationCode:"",activationCount:0},e.unverified&&se.Z.vivaldiAccount.getPendingRegistration((e=>{e&&this.setState({username:e.username,email:e.recovery_email,password:e.password},(()=>this.goToStep(3)))}))}componentWillUnmount(){Fj()}getError=e=>{switch(e){case 1001:case 1005:return{error:(0,B.Z)("Please choose a username between 3 and 30 letters (a-z) and numbers (0-9) only."),step:1,field:"username"};case 1002:return{error:(0,B.Z)("Please enter a valid email address."),step:1,field:"email"};case 1003:return{error:(0,B.Z)("We require our members to be at least 16 years old to join."),step:1,field:"age"};case 1004:return{error:(0,B.Z)("This email is already linked with another account."),step:1,field:"email"};case 1006:return{error:(0,B.Z)("Please choose a password at least 12 characters long."),step:2,field:"password"};case 1007:return{error:(0,B.Z)("Username “$1” already exists, please enter another one.",[this.state.username]),step:1,field:"username"};case 1008:return{error:(0,B.Z)("Email is in wrong format."),step:1,field:"email"};case 1010:return{error:(0,B.Z)("Please enter a realistic lifespan number."),step:1,field:"age"};case 2001:return{error:(0,B.Z)("Username contains a reserved word."),step:1,field:"username"};case 2002:return{error:(0,B.Z)("Email domain has been blacklisted."),step:1,field:"email"};case 2003:return{error:(0,B.Z)("IP address has been blacklisted."),step:1,field:"username"};case 3001:return{error:(0,B.Z)("Claims are missing."),step:1,field:"username"};case 4001:return{error:(0,B.Z)("Code does not match."),step:3,field:"activationCode"};case 4002:return{error:(0,B.Z)("The code has expired. Please request a new activation code."),step:3,field:"activationCode"};case 4004:return{error:(0,B.Z)("The code has been invalidated. Please request a new activation code."),step:3,field:"activationCode"};case 5001:return{error:(0,B.Z)("Failed to send account activation email."),step:3,field:"activationCode"};case 4003:case 5002:return{error:(0,B.Z)("Account has been locked."),step:3,field:"activationCode"};case 9e3:return{error:(0,B.Z)("Please fill in the required fields."),step:1,field:"username"};case 9001:return{error:(0,B.Z)("Email addresses need to match."),step:1,field:"email"};case 9002:return{error:(0,B.Z)("Passwords need to match."),step:2,field:"password"};case 9003:return{error:(0,B.Z)("You need to agree to Terms and Conditions."),step:2,field:"password"};case 9004:return{error:(0,B.Z)("Activation code should consist of $1 number.","Activation code should consist of $1 numbers.",[6]),step:3,field:"activationCode"};case 9010:return{error:(0,B.Z)("Connection error"),step:1,field:"username"};case 9020:return{error:(0,B.Z)("Please fill in the username"),step:1,field:"username"};case 9021:return{error:(0,B.Z)("Please provide your age"),step:2,field:"age"};case 9022:return{error:(0,B.Z)("Please provide your email"),step:1,field:"email"};case 9023:return{error:(0,B.Z)("Please fill in the email confirmation"),step:1,field:"confirmEmail"};case 9024:return{error:(0,B.Z)("Please provide your password"),step:3,field:"password"};case 9025:return{error:(0,B.Z)("Please fill in the password confirmation"),step:2,field:"confirmPassword"};default:return{error:(0,B.Z)("Unknown error"),step:1,field:"username"}}};onRegister=e=>{const t=e.currentTarget;t.password.checkValidity()&&t.confirmPassword.checkValidity()&&t.agreed.checkValidity()&&(this.setState({fetching:!0}),Wj("https://login.vivaldi.net/profile/sync-registration",{username:this.state.username,emailaddress:this.state.email,password:this.state.password,age:this.state.age,lang:Lj,disableNonce:!0,newsletter:this.state.agreedToNewsletter}).then((e=>{this.parseResponse(e)})).catch((e=>{console.warn("Registration request failed:",e.statusText),this.setState({fetching:!1,error:this.getError(9010).error})})))};onCheckUserCredentials=e=>{const t=e.currentTarget;t.username.checkValidity()&&t.age.checkValidity()&&t.email.checkValidity()&&t.confirmEmail.checkValidity()&&(this.setState({fetching:!0}),this.validateServerData("username").then((()=>this.validateServerData("email"))).then((()=>{this.goToStep(2),this.setState({fetching:!1})})).catch((e=>{console.warn("Account credentials validation failed",e.statusText),this.setState({fetching:!1})})))};parseResponse=e=>{if(e.error){const t=e.error,n=function(e){const t=e.match(/\[(\d+)\]/);return t?parseInt(t[1]):0}(t),{error:i,step:s,field:o}=this.getError(n);this.setState((o=>{if(0===n)return{error:t,step:o.step,activationCount:o.activationCount,fetching:!1};const a=4001===n?e.attempts_remaining:0;return{error:i,step:s,activationCount:a}})),Mj.nextTick((()=>this.reportValidity(o,i)))}else e.success?.includes("Registration")?(this.goToStep(3),se.Z.vivaldiAccount.setPendingRegistration({username:this.state.username,recovery_email:this.state.email,password:this.state.savePassword?this.state.password:""})):e.success?.includes("Code has been sent")?this.setState({activationCount:-1}):e.success?.includes("verified")&&(this.resetActivation(),this.state.username&&this.state.password?Di.login(this.state.username,this.state.password,this.state.savePassword):(this.goToStep(1),this.props.onChangeDisplay()))};validateServerData=e=>Wj("https://login.vivaldi.net/profile/validateField",{field:e,value:this.state[e]}).then((e=>{this.parseResponse(e)})).catch((t=>(console.warn("Field validation failed",t.statusText,e),this.setState({fetching:!1,error:this.getError(9010).error}),Promise.reject())));debouncedValidate=(0,Ae.Z)((e=>this.validateServerData(e).catch((()=>{}))),500);reportValidity=(e,t)=>{let n=null;switch(e){case"age":n=this._refAgeField.current;break;case"username":n=this._refUsernameField.current;break;case"email":n=this._refEmailField.current;break;case"confirmEmail":n=this._refConfirmEmailField.current;break;case"password":n=this._refPasswordField.current?._refInput.current;break;case"confirmPassword":n=this._refConfirmPasswordField.current;break;case"activationCode":n=this._refVerifyAccountField.current}n&&(n.setCustomValidity(t),n.focus())};onUsernameChange=e=>{this.resetValidity(e);const t=e.target.value.trim();xj.test(t)&&this.debouncedValidate("username"),this.setState({username:t})};onAgeChange=e=>{this.resetValidity(e),this.setState({age:parseInt(e.target.value)})};onEmailChange=e=>{this.resetValidity(e),this._refConfirmEmailField.current?.setCustomValidity("");const t=e.target.value;this.setState({email:t}),(0,dZ.HZ)(t)&&this.debouncedValidate("email")};onPasswordChange=e=>{this.resetValidity(e),this._refConfirmPasswordField?.current?.setCustomValidity(""),this.setState({password:e.target.value})};onSavePasswordChange=({target:e})=>{this.setState({savePassword:e.checked})};agreeToTerms=e=>{this.resetValidity(e),this.setState({agreedToTerms:e.target.checked})};agreeToNewsletter=({target:e})=>{this.setState({agreedToNewsletter:e.checked})};onActivationCodeChange=e=>{const{value:t}=e.target;this.resetValidity(e),this.setState({activationCode:t.trim().substring(0,6)})};verifyAccount=()=>{let{activationCode:e,username:t}=this.state;if(e=e.trim(),6!==e.length||/[^\d]/.test(e)){const{error:e,field:t}=this.getError(9004);return this.reportValidity(t,e),void this.setState({fetching:!1,error:this.getError(9004).error,activationCount:0})}Wj("https://login.vivaldi.net/profile/activation-code",{username:t,activation_code:e,lang:Lj}).then((e=>{this.parseResponse(e)})).catch((e=>{console.warn("Code verification failed",e.statusText),this.setState({fetching:!1,error:this.getError(9010).error})}))};sendVerificationCode=()=>{this.setState({error:"",activationCode:""}),Wj("https://login.vivaldi.net/profile/resend-activation-code",{username:this.state.username,lang:Lj}).then((e=>{this.parseResponse(e)})).catch((e=>{console.warn("Verification code request failed",e.statusText),this.setState({fetching:!1,error:this.getError(9010).error})}))};goToStep=e=>this.setState({step:e,error:"",activationCount:0});openNewsletterPage=()=>{c.ZP.openURL(this.context.vivaldiWindowId,"https://vivaldi.com/newsletter/",{inCurrent:!1})};openPrivacyPage=()=>{c.ZP.openURL(this.context.vivaldiWindowId,"https://vivaldi.com/privacy/",{inCurrent:!1})};setValidity=e=>{const{name:t,validity:n}=e.target;let i="";switch(!0){case n.rangeUnderflow&&"age"===t:i=this.getError(1003).error;break;case n.rangeOverflow&&"age"===t:i=this.getError(1010).error;break;case n.stepMismatch:case n.rangeUnderflow:case n.rangeOverflow:case n.typeMismatch:case n.patternMismatch:case n.badInput:case n.tooLong:case n.tooShort:"username"===t&&(i=this.getError(1001).error),"password"===t&&(i=this.getError(1006).error),"email"===t&&(i=this.getError(1002).error),"confirmEmail"===t&&(i=this.getError(9001).error),"confirmPassword"===t&&(i=this.getError(9002).error);break;case n.valueMissing:i=this.getError(9e3).error,"agreed"===t&&(i=this.getError(9003).error),"username"===t&&(i=this.getError(9020).error),"age"===t&&(i=this.getError(9021).error),"email"===t&&(i=this.getError(9022).error),"confirmEmail"===t&&(i=this.getError(9023).error),"password"===t&&(i=this.getError(9024).error),"confirmPassword"===t&&(i=this.getError(9025).error);break;case n.customError:i=e.target.validationMessage;case n.valid:}e.target.setCustomValidity(i),e.target.focus(),e.preventDefault(),this.setState({error:i})};resetValidity=e=>{e.target.setCustomValidity(""),this.setState({error:""})};resetActivation=()=>{se.Z.vivaldiAccount.setPendingRegistration()};renderUserDetails=()=>Oj("form",{onSubmit:this.onCheckUserCredentials,noValidate:!0},void 0,Oj("h1",{},void 0,(0,B.Z)("Create an Account")),Oj("p",{},void 0,(0,B.Z)("To start syncing data across devices, a confirmed Vivaldi account is required. Already have an account?")," ",Oj(A_.Z,{onClick:this.props.onChangeDisplay},void 0,(0,B.Z)("Log in."))),Oj("div",{className:"AccountSheet-Form AccountSheet-FormGrid"},void 0,Oj("label",{},void 0,Oj(B_,{label:(0,B.Z)("Username is used for email, blog link and forum display name. It can only contain letters and numbers, and cannot be changed.")},void 0,(0,B.Z)("Username")),(0,ss.jsx)("input",{ref:this._refUsernameField,type:"text",name:"username",value:this.state.username,onChange:this.onUsernameChange,onInvalid:this.setValidity,required:!0,pattern:xj.source,autoFocus:this.props.autoFocus})),Oj("label",{},void 0,Oj(B_,{label:(0,B.Z)("We need this information to prove to authorities that you are older than 16 to comply with the European General Data Protection Regulation (GDPR).")},void 0,(0,B.Z)("Age")),(0,ss.jsx)("input",{ref:this._refAgeField,type:"number",name:"age",value:this.state.age>=0?this.state.age:"",onChange:this.onAgeChange,onInvalid:this.setValidity,required:!0,min:"16",max:"150"})),Oj("label",{},void 0,Oj(B_,{label:(0,B.Z)("We’ll use this email address to send you account-related messages (activation, password reset) and technical updates.")},void 0,(0,B.Z)("Recovery Email")),(0,ss.jsx)("input",{ref:this._refEmailField,type:"email",name:"email",placeholder:"name@provider.com",value:this.state.email,onChange:this.onEmailChange,onInvalid:this.setValidity,pattern:dZ.s9.source,required:!0})),Oj("label",{},void 0,(0,B.Z)("Confirm Recovery Email"),(0,ss.jsx)("input",{ref:this._refConfirmEmailField,type:"email",name:"confirmEmail",defaultValue:"",onChange:this.resetValidity,onInvalid:this.setValidity,pattern:(0,Fv.Z)(this.state.email),required:!0}))),this.state.error&&Oj(To,{type:"error"},void 0,this.state.error),Oj("div",{className:"AccountSheet-Footer"},void 0,!this.state.fetching&&Oj("input",{type:"submit",value:(0,B.Z)("Next")}),this.state.fetching&&Oj("span",{className:"FormButton primary in-progress"},void 0,(0,B.Z)("Checking..."))));renderPasswordDetails=()=>Oj("form",{onSubmit:this.onRegister,noValidate:!0},void 0,Oj("h1",{},void 0,(0,B.Z)("Create an Account")),Oj(Sj,{windowId:this.context.vivaldiWindowId,pictureUrl:"",username:this.state.username,deviceName:this.state.email}),Oj("div",{className:"AccountSheet-Form AccountSheet-FormGrid"},void 0,Oj("label",{},void 0,Oj(B_,{label:(0,B.Z)("Use 12 or more characters. We recommend using several words separated by spaces.")},void 0,(0,B.Z)("Password")),(0,ss.jsx)(Tj,{ref:this._refPasswordField,name:"password",value:this.state.password,onChange:this.onPasswordChange,onInvalid:this.setValidity,minLength:"12",required:!0,autoFocus:this.props.autoFocus})),Oj("label",{},void 0,(0,B.Z)("Confirm Password"),(0,ss.jsx)("input",{type:"password",ref:this._refConfirmPasswordField,name:"confirmPassword",defaultValue:"",onChange:this.resetValidity,onInvalid:this.setValidity,pattern:(0,Fv.Z)(this.state.password),required:!0})),Oj("label",{className:"columnRow"},void 0,Oj("input",{type:"checkbox",checked:this.state.savePassword,onChange:this.onSavePasswordChange}),(0,B.Z)("Save Password")),Oj("label",{className:"fullRow"},void 0,(0,B.Z)("Device Name"),Oj("input",{type:"text",className:"device",defaultValue:this.props.customSessionName,placeholder:this.props.defaultSessionName,onChange:Rj(I.kSyncSessionName)})),Oj("span",{className:"fullRow columnRow link"},void 0,Oj("label",{},void 0,Oj("input",{type:"checkbox",checked:this.state.agreedToNewsletter,onChange:this.agreeToNewsletter}),(0,B.Z)("I want to receive the Vivaldi newsletter.")),Oj(A_.Z,{title:(0,B.Z)("Learn more about Vivaldi Newsletter"),onClick:this.openNewsletterPage},void 0,Oj("span",{dangerouslySetInnerHTML:{__html:Wi.vvh.small}}))),Oj("span",{className:"fullRow columnRow link"},void 0,Oj("label",{},void 0,Oj("input",{type:"checkbox",name:"agreed",required:!0,checked:this.state.agreedToTerms,onInvalid:this.setValidity,onChange:this.agreeToTerms}),(0,B.Z)("I have read and agree to the Terms of Use and Privacy Policy.")),Oj(A_.Z,{title:(0,B.Z)("Visit Vivaldi Privacy page"),onClick:this.openPrivacyPage},void 0,Oj("span",{dangerouslySetInnerHTML:{__html:Wi.vvh.small}})))),this.state.error&&Oj(To,{type:"error"},void 0,this.state.error),Oj("div",{className:"AccountSheet-Footer AccountSheet-Footer--Justified"},void 0,Oj("input",{type:"button",value:(0,B.Z)("navigation","Back"),onClick:()=>{Fj(),this.goToStep(1)}}),!this.state.fetching&&Oj("input",{type:"submit",value:(0,B.Z)("Register")}),this.state.fetching&&Oj("span",{className:"FormButton primary in-progress"},void 0,(0,B.Z)("Registering..."))));renderAccountVerification=()=>Oj("form",{onSubmit:this.verifyAccount,noValidate:!0},void 0,Oj("h1",{},void 0,(0,B.Z)("Activate Your Account")),Oj(Sj,{windowId:this.context.vivaldiWindowId,pictureUrl:"",username:this.state.username,deviceName:this.state.email}),Oj("div",{className:"AccountSheet-Form"},void 0,Oj("p",{},void 0,this.state.email?(0,B.Z)("Activation code has been sent to “$1”.",[this.state.email]):(0,B.Z)("Activation code has been sent to your email.")," ",(0,B.Z)("Please enter the 6 digit code.")),(0,ss.jsx)("input",{ref:this._refVerifyAccountField,type:"text",onChange:this.onActivationCodeChange,value:this.state.activationCode,name:"activationCode",className:"AccountSheet-Verification",size:6,placeholder:"000000",autoFocus:!0}),Oj("p",{},void 0,(0,B.Z)("Don’t see the email? Please check your spam folder.")," ",-1!==this.state.activationCount&&Oj(A_.Z,{onClick:this.sendVerificationCode},void 0,(0,B.Z)("Or get another activation code.")))),this.state.error&&Oj(To,{type:"error"},void 0,this.state.error," ",this.state.error===this.getError(4001).error&&this.state.activationCount>0&&this.state.activationCount<3&&(0,B.Z)("$1 attempt remaining.","$1 attempts remaining.",[this.state.activationCount]),this.state.error===this.getError(4001).error&&0===this.state.activationCount&&(0,B.Z)("Please request a new activation code.")),!this.state.error&&-1===this.state.activationCount&&Oj(To,{type:"info"},void 0,(0,B.Z)("New activation code was sent.")),Oj("div",{className:"AccountSheet-Footer AccountSheet-Footer--Justified"},void 0,Oj("input",{type:"button",value:(0,B.Z)("Cancel"),onClick:()=>{this.resetActivation(),this.props.onChangeDisplay()}}),Oj("input",{type:"submit",value:(0,B.Z)("Activate Account")})));render(){const{step:e}=this.state;return(0,ss.jsxs)(ss.Fragment,{children:[1===e&&this.renderUserDetails(),2===e&&this.renderPasswordDetails(),3===e&&this.renderAccountVerification()]})}}const Vj=Uj;var Hj;function Gj(e,t,n,i){Hj||(Hj="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Hj,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const $j=[I.kSyncSessionName];class Kj extends Li.PureComponent{#m=!1;constructor(e){super(e);const t=pe.getState();this.state={display:"register"===this.props.view?"register":"login",accountState:t,defaultSessionName:"",unverified:!1}}componentDidMount(){this.#m=!0,pe.addListener(this.onVivaldiAccountChange),this.onVivaldiAccountChange(),this.setDefaultSession()}setDefaultSession=async()=>{if(!this.#m)return;const e=await(async()=>se.Z.sync.getDefaultSessionName())();this.setState({defaultSessionName:e})};componentWillUnmount(){this.#m=!1,pe.removeListener(this.onVivaldiAccountChange)}onVivaldiAccountChange=()=>{const e=pe.getState();this.setState({accountState:e}),e.lastTokenFetchError.serverMessage.includes(_j)&&"loginFailed"===ce(e)?this.setState({display:"register",unverified:!0}):se.Z.vivaldiAccount.getPendingRegistration((e=>{e&&this.setState({display:"register",unverified:!0})}))};onChangeDisplay=()=>{this.setState((e=>({display:"login"===e.display?"register":"login",unverified:!1})))};render(){const{display:e}=this.state;return Gj("div",{className:"AccountSheet"},void 0,Gj("span",{className:"AccountSheet-Logo",dangerouslySetInnerHTML:{__html:n(38151)}}),"register"===e&&Gj(Vj,{autoFocus:this.props.autoFocus,onClose:this.props.onClose,onChangeDisplay:this.onChangeDisplay,defaultSessionName:this.state.defaultSessionName,customSessionName:this.props.prefValues[I.kSyncSessionName],accountState:this.state.accountState,unverified:this.state.unverified}),"login"===e&&Gj(Pj,{autoFocus:this.props.autoFocus,onClose:this.props.onClose,onChangeDisplay:this.onChangeDisplay,defaultSessionName:this.state.defaultSessionName,accountState:this.state.accountState,customSessionName:this.props.prefValues[I.kSyncSessionName]}))}}const zj=(0,Bu.Z)(Kj,$j),jj="▽",Yj="▼",Xj="△",Qj="▲",qj="⭍",Jj={not_synced:(0,B.Z)("Not synced"),success:(0,B.Z)("sync","Done"),auth_error:(0,B.Z)("Sync server refused your credentials"),server_error:(0,B.Z)("Sync server encountered an error"),network_error:(0,B.Z)("Network error"),conflict:(0,B.Z)("Conflict with another client’s data occurred"),throttled:(0,B.Z)("Sync server throttled the connection"),other_error:(0,B.Z)("Unexpected error")};function eY(e,t){return function(e,t){switch(e){case"not_synced":return t?jj:Xj;case"success":return t?Yj:Qj;default:return qj}}(e,t)+" "+(t?(0,B.Z)("Download: $1",[Jj[e]]):(0,B.Z)("Upload: $1",[Jj[e]]))}function tY(e){return[Jj[e.downloadUpdatesStatus],Jj[e.commitStatus]]}var nY;function iY(e,t,n,i){nY||(nY="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:nY,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const sY={bookmarks:{label:(0,B.Z)("Bookmarks"),description:(0,B.Z)("Sync bookmarks and Speed Dials"),icon:Wi.CLf.small},preferences:{label:(0,B.Z)("Settings"),description:(0,B.Z)("Sync Vivaldi settings (not all settings are syncable)"),icon:Wi.bqs.small},passwords:{label:(0,B.Z)("Passwords"),description:(0,B.Z)("Sync stored webpage passwords"),icon:Wi._ZF},autofill:{label:(0,B.Z)("other","Autofill"),description:(0,B.Z)("Sync form autofill information"),icon:Wi.lku},history:{label:(0,B.Z)("History"),description:(0,B.Z)("Sync History and Typed Urls"),icon:Wi.hcy.small},extensions:{label:(0,B.Z)("Extensions"),description:(0,B.Z)("Sync browser extensions and settings"),icon:Wi.v9y.small},apps:{label:(0,B.Z)("Apps"),description:(0,B.Z)("Sync Web Apps"),icon:Wi.v9y.small},reading_list:{label:(0,B.Z)("Reading List"),description:(0,B.Z)("Sync the Reading List"),icon:Wi.R_e.small},tabs:{label:(0,B.Z)("Tabs"),description:(0,B.Z)("Sync open tabs"),icon:Wi.hcy.small},notes:{label:(0,B.Z)("Notes"),description:(0,B.Z)("Sync Vivaldi Notes (attachments are not syncable)"),icon:Wi.fbI}};class oY extends Li.Component{static contextType=ts.Z;syncAllId="syncAll__"+crypto.randomUUID();syncPartsId="syncParts__"+crypto.randomUUID();constructor(e){super(e),this.state={countdownElapsed:!1,showConfirmClearDataDialog:!1,showChangeFeedback:!1,dataTypes:e.syncState.engineData.dataTypes}}componentWillUnmount(){clearTimeout(this.changeTimeout)}onCountDownElapsed=e=>{this.setState({countdownElapsed:e})};onSyncEverythingChange=()=>{this.setChangeFeedback(),se.Z.sync.setTypes(!0,this.props.syncState.engineData.dataTypes),se.Z.sync.setupComplete(),this.setState((e=>({dataTypes:e.dataTypes.map((e=>(e.enabled=!0,e)))})))};onDataTypeChange=e=>{const t=e.target.name,n=e.target.checked;this.setState((e=>{const i=e.dataTypes,s=i.find((e=>e.dataType===t));return s&&(s.enabled=n),{dataTypes:i}})),se.Z.sync.setTypes(this.props.syncState.engineData.syncEverything,this.props.syncState.engineData.dataTypes)};setChangeFeedback=()=>{clearTimeout(this.changeTimeout),this.setState({showChangeFeedback:!0},(()=>this.changeTimeout=setTimeout(this.resetChangeFeedback,1e3)))};resetChangeFeedback=()=>{this.setState({showChangeFeedback:!1})};onApplyChanges=()=>{this.setChangeFeedback(),se.Z.sync.setTypes(!1,this.state.dataTypes),se.Z.sync.setupComplete()};onClearData=()=>{this.setState({showConfirmClearDataDialog:!0})};onConfirmClearDataDialog=e=>{this.setState({showConfirmClearDataDialog:!1}),e&&wi.clearData()};onSaveBackupKey=()=>{se.Z.utilities.selectFile({windowId:this.context.vivaldiWindowId,title:(0,B.Z)("Save Backup Encryption Key"),type:"save_file",accepts:[{ext:"txt"}]}).then((e=>{e&&se.Z.sync.backupEncryptionToken(e,(e=>{e||console.warn("File not saved (vivaldi.sync)")}))}))};renderResetButton=()=>"configuration_pending"===this.props.syncState.engineData.engineState?null:iY("input",{type:"button",onClick:this.onClearData,value:(0,B.Z)("Reset Remote Data")});openVivaldiStatusPage=()=>{c.ZP.openURL(this.context.vivaldiWindowId,"https://vivaldistatus.com/")};render(){const{cycleData:e,engineData:t}=this.props.syncState,n="not_synced"!==this.props.syncState.cycleData.downloadUpdatesStatus?W()(this.props.syncState.cycleData.cycleStartTime).calendar():"...",i=this.state.dataTypes.map((e=>iY("li",{},e.dataType,iY("label",{className:"grid"},void 0,iY("span",{className:"icon",dangerouslySetInnerHTML:{__html:sY[e.dataType].icon}}),iY("h3",{},void 0,sY[e.dataType].label),iY("span",{className:"description"},void 0,sY[e.dataType].description),iY("input",{type:"checkbox",name:e.dataType,checked:e.enabled,onChange:this.onDataTypeChange}))))),[s,o]=this.state.showChangeFeedback?[tY(e)[0],(0,B.Z)("Updating")]:tY(e),a=this.state.showChangeFeedback?"in_progress":e.commitStatus;let r=null;if(0!==parseInt(e.nextRetryTime)){const t=W()(e.nextRetryTime);r=t.isBefore(W()())?iY("p",{className:"in-progress"},void 0,(0,B.Z)("Retrying")):iY(mj,{label:(0,B.Z)("Retrying in $1"),end:t,onElapsed:this.onCountDownElapsed})}const l=t.syncEverything?this.syncAllId:this.syncPartsId,d="configuration_pending"===t.engineState,c=["server_error","network_error"],u=navigator.onLine&&(c.includes(e.downloadUpdatesStatus)||c.includes(e.commitStatus));return iY(iA.Z,{filter:this.props.filter},void 0,iY("div",{className:"setting-group-double"},void 0,!d&&iY("div",{className:"sync-status detail"},void 0,iY("span",{className:"time"},void 0,(0,B.Z)("Last sync:")," ",iY("strong",{},void 0,n)),iY("span",{className:`data-in ${e.downloadUpdatesStatus}`},void 0,iY("span",{className:"icon",dangerouslySetInnerHTML:{__html:Wi.OXd}}),(0,B.Z)("Download: $1",[s])),iY("span",{className:`data-out ${a}`},void 0,iY("span",{className:"icon",dangerouslySetInnerHTML:{__html:Wi.uUH}}),(0,B.Z)("Upload: $1",[o]))),u&&iY(To,{type:"warning"},void 0,iY("span",{className:"sync-error-vivaldistatus"},void 0,(0,B.Z)("sync error","Vivaldi Sync service may be experiencing problems. Get service updates at:")," ",iY("a",{href:"https://vivaldistatus.com/",onClick:this.openVivaldiStatusPage},void 0,"VivaldiStatus.com"))),r&&iY(To,{type:"info"},void 0,r),t.isEncryptingEverything&&(0,ss.jsxs)(ss.Fragment,{children:[iY("div",{className:"status"},void 0,iY("span",{className:"icon",dangerouslySetInnerHTML:{__html:Wi._ZF}}),(0,B.Z)("Data secured by encryption password.")),iY("div",{className:"status"},void 0,iY("label",{},void 0,iY("span",{className:"icon",dangerouslySetInnerHTML:{__html:Wi.SpM}}),iY(B_,{label:(0,B.Z)("Store the backup recovery key in a secure place. If you forget your encryption password, you may use this key to retrieve your sync data. We won’t be able to recover your data since your password and backup key are never sent to us.")},void 0,iY(A_.Z,{onClick:this.onSaveBackupKey},void 0,(0,B.Z)("Save Backup Encryption Key")))))]}),!t.isEncryptingEverything&&iY(To,{type:"error"},void 0,(0,B.Z)("Sync encryption failed. We recommend that you clear remote Sync data and restart Sync with your current browser data.")),this.state.showConfirmClearDataDialog&&iY(FT,{title:(0,B.Z)("Delete Remote Sync Data"),prompt:[(0,B.Z)("This will remove all sync data stored on the Vivaldi server, reset your encryption password, and log you out.")],positive:(0,B.Z)("Delete Sync Data"),negative:(0,B.Z)("Cancel"),onClose:this.onConfirmClearDataDialog,danger:!0})),d&&iY("div",{className:"sync-status-confirmed"},void 0,iY("h3",{},void 0,(0,B.Z)("All set! Time to decide what data to sync between devices."))),iY("div",{className:"setting-group-double pad-top"},void 0,iY(PV,{activeTabId:l,icons:[Wi.uWq,Wi.o7J]},void 0,iY("div",{label:(0,B.Z)("Sync All Data"),id:this.syncAllId},void 0,iY("div",{className:"TabbedView--Padded"},void 0,iY("p",{},void 0,!d&&t.syncEverything&&(0,B.Z)("All data is synchronized, and synchronization of new data types is automatically enabled."),!d&&!t.syncEverything&&(0,B.Z)("Selected data subset is synchronized.")," ",(!t.isFirstSetupComplete||!t.syncEverything)&&(0,B.Z)("Sychronize all data, and automatically enable synchronization of new data types."))),iY("div",{className:"TabbedView-Footer"},void 0,this.renderResetButton(),iY("input",{type:"submit",value:t.isFirstSetupComplete?(0,B.Z)("Sync All Data"):(0,B.Z)("Start Syncing"),onClick:this.onSyncEverythingChange,disabled:t.syncEverything&&!d,autoFocus:t.isFirstSetupComplete&&this.props.autoFocus}))),iY("div",{label:(0,B.Z)("Sync Selected Data"),id:this.syncPartsId},void 0,iY("form",{onSubmit:this.onApplyChanges},void 0,iY("ul",{},void 0,i),iY("div",{className:"TabbedView-Footer"},void 0,this.renderResetButton(),iY("input",{type:"submit",disabled:!d&&(!t.isSetupInProgress&&t.isFirstSetupComplete||(0,QT.Z)(this.state.dataTypes,this.props.syncState.engineData.dataTypes)),value:t.isFirstSetupComplete?(0,B.Z)("Apply Changes"):(0,B.Z)("Start Syncing"),autoFocus:!t.isFirstSetupComplete&&this.props.autoFocus})))))))}}const aY=oY;var rY;function lY(e,t,n,i){rY||(rY="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:rY,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class dY extends Li.Component{static contextType=ts.Z;ID1="fm1__"+crypto.randomUUID();ID2="fm2__"+crypto.randomUUID();state={encryptionPassword:"",wrongPasswordEntered:!1,wrongBackupKey:"key"===this.props.unlockAttempt,showConfirmClearDataDialog:!1};onEncryptionPasswordChange=e=>{this.setState({wrongPasswordEntered:!1,wrongBackupKey:!1,encryptionPassword:e.target.value})};onDecrypt=()=>{this.setState({wrongPasswordEntered:!1}),wi.setEncryptionPassword(this.state.encryptionPassword,(e=>{this.props.onUnlockAttempt("passphrase"),e||this.setState({wrongPasswordEntered:!0,wrongBackupKey:!1})}))};onPasswordLost=()=>{this.setState({showConfirmClearDataDialog:!0,wrongPasswordEntered:!1,wrongBackupKey:!1})};resetErrorState=()=>{this.setState({wrongPasswordEntered:!1,wrongBackupKey:!1})};onConfirmClearDataDialog=e=>{this.setState({showConfirmClearDataDialog:!1}),e&&wi.clearData()};onUploadEncyptionKey=()=>{se.Z.utilities.selectFile({windowId:this.context.vivaldiWindowId,title:(0,B.Z)("Select Backup Encryption Key file"),type:"file",accepts:[{ext:"txt"}]}).then((e=>{e&&se.Z.sync.restoreEncryptionToken(e).then((e=>{this.props.onUnlockAttempt("key"),e||this.setState({wrongPasswordEntered:!1,wrongBackupKey:!0})}))}))};renderForgotPassword=()=>lY(A_.Z,{onClick:this.onPasswordLost},void 0,(0,B.Z)("Forgot Password?"));render(){return lY(tN.Z,{categoryTitle:(0,B.Z)("Encryption Password"),filter:this.props.filter},void 0,lY(iA.Z,{filter:this.props.filter},void 0,lY("div",{className:"setting-group-double"},void 0,this.state.showConfirmClearDataDialog&&lY(FT,{title:(0,B.Z)("Delete Remote Sync Data"),prompt:[(0,B.Z)("Without your current encryption password we’re unable to decrypt your data. Resetting this password requires deleting all existing Sync data on Vivaldi servers.")],positive:(0,B.Z)("Delete Sync Data"),negative:(0,B.Z)("Cancel"),onClose:this.onConfirmClearDataDialog,danger:!0}),lY(PV,{activeTabId:"key"===this.props.unlockAttempt?this.ID2:void 0,icons:[Wi.WHX,Wi.c02],onTabClick:this.resetErrorState},void 0,lY("div",{label:(0,B.Z)("Encryption Password"),id:this.ID1},void 0,lY("form",{onSubmit:this.onDecrypt},void 0,lY("div",{className:"TabbedView--Padded"},void 0,lY("p",{},void 0,(0,B.Z)("The data received from the Sync server is encrypted. Please provide your encryption password to decrypt it.")),lY("label",{className:"setting-single encryption"},void 0,lY("span",{},void 0,(0,B.Z)("Encryption Password")),lY(Tj,{value:this.state.encryptionPassword,onChange:this.onEncryptionPasswordChange,autoFocus:this.props.autoFocus})),this.state.wrongPasswordEntered&&lY(To,{type:"error"},void 0,(0,B.Z)("Wrong password entered."))),lY("div",{className:"TabbedView-Footer"},void 0,this.renderForgotPassword(),lY("input",{type:"submit",value:(0,B.Z)("Decrypt")})))),lY("div",{label:(0,B.Z)("Load Encryption Key"),id:this.ID2},void 0,lY("div",{className:"TabbedView--Padded"},void 0,lY("p",{},void 0,(0,B.Z)("To recover data without a password, you may use your Backup Encryption Key, provided you have saved it earlier.")),this.state.wrongBackupKey&&lY(To,{type:"error"},void 0,(0,B.Z)("Unable to decrypt with given backup encryption key."))),lY("div",{className:"TabbedView-Footer"},void 0,this.renderForgotPassword(),lY("input",{type:"button",onClick:this.onUploadEncyptionKey,value:(0,B.Z)("Load")})))))))}}const cY=dY;var uY;function pY(e,t,n,i){uY||(uY="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:uY,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class hY extends Li.Component{static contextType=ts.Z;_input=Li.createRef();state={encryptionPassword:"",shortPassword:!1};onSetPassword=()=>{!this.state.encryptionPassword||this.state.encryptionPassword.length<12?(this.setState({shortPassword:!0}),this._input.current?._refInput.current?.focus()):this.doSetPassword(this.state.encryptionPassword)};doSetPassword=e=>{wi.setEncryptionPassword(e,(e=>{e&&this.setState({shortPassword:!1})}))};onEncryptionPasswordChange=e=>{this.setState({encryptionPassword:e.target.value}),e.target.value.length>=12&&this.setState({shortPassword:!1})};render(){return pY(iA.Z,{filter:this.props.filter},void 0,pY("h2",{},void 0,(0,B.Z)("Set a New Encryption Password")),pY("form",{onSubmit:this.onSetPassword},void 0,pY("div",{className:"setting-group-double"},void 0,pY("div",{className:"setting-single"},void 0,pY("p",{},void 0,(0,B.Z)("To encrypt and protect your sync data (passwords, bookmarks, notes, and more), please create an encryption password. This password will never be sent to us."))),pY("div",{className:"setting-single"},void 0,pY("label",{className:"encryption-password"},void 0,pY("span",{className:"icon",dangerouslySetInnerHTML:{__html:Wi._ZF}}),(0,B.Z)("Encryption Password"),(0,ss.jsx)(Tj,{ref:this._input,value:this.state.encryptionPassword,onChange:this.onEncryptionPasswordChange})),this.state.shortPassword&&pY(To,{type:"error"},void 0,(0,B.Z)("Minimum password length of $1 character is required.","Minimum password length of $1 characters is required.",[12]))),pY("div",{className:"setting-single align-right pad-top"},void 0,pY("input",{type:"submit",value:(0,B.Z)("Save and Continue"),autoFocus:this.props.autoFocus})))))}}const gY=hY;class mY extends m.Z{getInitialState(){return{engineData:{engineState:"stopped",disableReasons:[],protocolErrorType:"success",protocolErrorDescription:"",protocolErrorClientAction:"unknown",usesEncryptionPassword:!1,needsDecryptionPassword:!1,isEncryptingEverything:!1,isSetupInProgress:!1,isFirstSetupComplete:!1,syncEverything:!0,dataTypes:[],isReady:!1},cycleData:{cycleStartTime:0,downloadUpdatesStatus:"not_synced",commitStatus:"not_synced",nextRetryTime:0,isReady:!1}}}reduce(e,t){switch(t.actionType){case"SYNC_ENGINE_STATE_CHANGED":return{engineData:t.engineData,cycleData:e.cycleData};case"SYNC_CYCLE_COMPLETED":return{engineData:e.engineData,cycleData:t.cycleData}}return e}}const fY=new mY;var vY;function yY(e,t,n,i){vY||(vY="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:vY,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const bY=[I.kSyncSessionName];function SY(e){const t=Li.useContext(ts.Z),n=(0,Ya.Z)(bY),[i,s]=Li.useState(fY.getState()),[o,a]=Li.useState(pe.getState()),[r,l]=Li.useState(""),[d,c]=Li.useState("");Li.useEffect((()=>{function e(){s(fY.getState())}function t(){a(pe.getState())}return fY.addListener(e),pe.addListener(t),e(),t(),se.Z.sync.getDefaultSessionName(l),()=>{fY.removeListener(e),pe.removeListener(t)}}),[]);const u=e=>{c(e)},p=()=>{wi.start()};if(he.ZP.isIncognitoOrGuest(t.vivaldiWindowId))return yY("p",{},void 0,(0,B.Z)("Sync settings are unavailable in Private Windows."));if(!i.engineData.isReady||!i.cycleData.isReady||!o.isReady)return null;const h=(()=>{const t=i.engineData;if(t.disableReasons.includes("enterprise_policy"))return yY("p",{},void 0,(0,B.Z)("Sync has been disabled by your administrator"));const n=t.engineState;if(!o.hasToken)return null;switch(n){case"stopped":return yY("div",{className:"setting-group-double"},void 0,"disable_sync_on_client"===t.protocolErrorClientAction&&yY("p",{},void 0,(0,B.Z)("Sync was stopped following a request from the server: $1",["not_my_birthday"===t.protocolErrorType?(0,B.Z)("Sync server data was reset"):t.protocolErrorDescription])),yY("input",{type:"button",onClick:p,value:(0,B.Z)("Start Sync")}));case"failed":if(t.disableReasons.includes("not_signed_in"))return yY("div",{className:"setting-group-double"},void 0,yY("p",{className:"in-progress"},void 0,(0,B.Z)("Waiting for account details")));if(t.disableReasons.includes("flag"))return yY("p",{},void 0,(0,B.Z)("Sync was disabled from the command line"));let n=(0,B.Z)("Unexpected error. You may need to restart Vivaldi.");if(t.disableReasons.includes("unrecoverable_error"))if("upgrade_client"===t.protocolErrorClientAction)n=(0,B.Z)("You must upgrade Vivaldi in order to use Sync");else n=(0,B.Z)("Sync could not be started: $1",[t.protocolErrorDescription]);return yY("p",{},void 0,n);case"starting":return yY("p",{className:"in-progress"},void 0,(0,B.Z)("Initializing Sync..."));case"starting_server_error":return yY("p",{className:"in-progress"},void 0,(0,B.Z)("The sync server is experiencing issues. Retrying initialization soon."));case"clearing_data":return yY("p",{className:"in-progress"},void 0,(0,B.Z)("Clearing Sync data. Please wait."));case"configuration_pending":case"started":return t.needsDecryptionPassword?yY(cY,{filter:e.filter,autoFocus:e.category!==pn.jk.settingCategories.all,unlockAttempt:d,onUnlockAttempt:u}):t.usesEncryptionPassword?yY(aY,{filter:e.filter,syncState:i,autoFocus:e.category!==pn.jk.settingCategories.all}):yY(gY,{filter:e.filter,autoFocus:e.category!==pn.jk.settingCategories.all})}return null})(),{username:g,pictureUrl:m,donationTier:f}=o.accountInfo,v=n[I.kSyncSessionName]||r;return yY(tN.Z,{categoryTitle:(0,B.Z)("Sync"),filter:e.filter,className:"sync-setup"},void 0,yY(iA.Z,{filter:e.filter},void 0,yY("div",{className:"setting-group-double"},void 0,"loggedIn"!==ce(o)?yY(zj,{onClose:Lr.Z,view:(y=e.url,"register"===(0,rl.DP)(y).view?"register":"login"),autoFocus:e.category!==pn.jk.settingCategories.all},e.url):yY(Sj,{windowId:t.vivaldiWindowId,pictureUrl:m,username:g,deviceName:v,isLoggedIn:!0,donationTier:f}))),h&&yY(iA.Z,{filter:e.filter},void 0,h));var y}const wY=Li.memo(SY);var CY;function AY(e,t,n,i){CY||(CY="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:CY,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const IY=[I.kMemorySaverModeState,I.kMemorySaverModeTimeBeforeDiscardInMinutes];function TY(e){const t=(0,Ya.Z)(IY);return AY(iA.Z,{filter:e.filter},void 0,AY("div",{className:"setting-group"},void 0,AY("div",{className:"setting-single"},void 0,AY("h3",{},void 0,(0,B.Z)("Memory Saver")),AY("p",{className:"info"},void 0,(0,B.Z)("Free up memory from inactive tabs.")),AY(ta.Z,{onChange:e=>{const{value:n}=e.target;if("disabled"===n)0!==t[I.kMemorySaverModeState]&&w.Z.set(I.kMemorySaverModeState,0);else if("auto"===n)1!==t[I.kMemorySaverModeState]&&w.Z.set(I.kMemorySaverModeState,1);else{2!==t[I.kMemorySaverModeState]&&w.Z.set(I.kMemorySaverModeState,2);const e=parseInt(n);isNaN(e)||e===t[I.kMemorySaverModeTimeBeforeDiscardInMinutes]||w.Z.set(I.kMemorySaverModeTimeBeforeDiscardInMinutes,e)}},value:(e=>{switch(e){case 0:return"disabled";case 1:return"auto";default:return t[I.kMemorySaverModeTimeBeforeDiscardInMinutes].toString()}})(t[I.kMemorySaverModeState])},void 0,AY("option",{value:"disabled"},void 0,(0,B.Z)("memsaver","Disabled")),AY("option",{value:"auto"},void 0,(0,B.Z)("memsaver","Automatic")),AY("option",{value:"60"},void 0,(0,B.Z)("memsaver","After 1 Hour Idle")),AY("option",{value:"120"},void 0,(0,B.Z)("memsaver","After 2 Hours Idle")),AY("option",{value:"180"},void 0,(0,B.Z)("memsaver","After 3 Hours Idle")),AY("option",{value:"360"},void 0,(0,B.Z)("memsaver","After 6 Hours Idle"))))))}var ZY;function EY(e,t,n,i){ZY||(ZY="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:ZY,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const kY=w.Z.getEventHandler,_Y=[I.kTabsActivationOnClose,I.kTabsActivationPreferRelated,I.kTabsAlignNext,I.kTabsDoubleClick,I.kTabsFocusWebview,I.kTabsBarPosition,I.kTabsNeverCloseLast,I.kTabsConfirmClosingTabs,I.kTabsConfirmClosingThreshold];var NY=EY("input",{type:"radio",value:"activation_order"}),PY=EY("input",{type:"radio",value:"left"}),DY=EY("input",{type:"radio",value:"right"}),MY=EY("input",{type:"radio",value:"rename"}),OY=EY("input",{type:"radio",value:"close"}),xY=EY("input",{type:"radio",value:"ignore"});class LY extends Li.Component{confirmClosingTabsMinThreshold=1;confirmClosingTabsMaxThreshold=99;isHorizontal=()=>{const e=this.props.prefValues[I.kTabsBarPosition];return"top"===e||"bottom"===e};render(){const{prefValues:e}=this.props;return EY(iA.Z,{filter:this.props.filter},void 0,EY("span",{},void 0,EY("div",{className:"setting-group"},void 0,EY("div",{className:"setting-single"},void 0,EY("h3",{},void 0,(0,B.Z)("Close Tab Activation")),EY("div",{className:"setting-single"},void 0,EY("label",{title:(0,B.Z)("Activate tabs related by origin first")},void 0,EY("input",{type:"checkbox",checked:e[I.kTabsActivationPreferRelated],onChange:kY(I.kTabsActivationPreferRelated)}),EY("span",{},void 0,(0,B.Z)("Always Activate Related Tab")))),EY("div",{className:"setting-single pad-top"},void 0,EY(ja.Z,{name:"tabActivate",value:e[I.kTabsActivationOnClose],onChange:kY(I.kTabsActivationOnClose)},void 0,EY("div",{className:"setting-single"},void 0,EY("label",{},void 0,NY,EY("span",{},void 0,(0,B.Z)("Activate in Recently Used Order")))),EY("div",{className:"setting-single"},void 0,EY("label",{},void 0,PY,EY("span",{},void 0,this.isHorizontal()?(0,B.Z)("Activate Left in Tab Order"):(0,B.Z)("Activate Above in Tab Order")))),EY("div",{className:"setting-single"},void 0,EY("label",{},void 0,DY,EY("span",{},void 0,this.isHorizontal()?(0,B.Z)("Activate Right in Tab Order"):(0,B.Z)("Activate Below in Tab Order")))))))),EY("div",{className:"setting-group"},void 0,EY("h3",{},void 0,(0,B.Z)("Tab Handling")),EY("div",{className:"setting-single"},void 0,EY("label",{title:(0,B.Z)("Align the close buttons to easily close multiple tabs")},void 0,EY("input",{type:"checkbox",checked:e[I.kTabsAlignNext],onChange:kY(I.kTabsAlignNext)}),EY("span",{},void 0,(0,B.Z)("Align Next Close Button")))),EY("div",{className:"setting-single"},void 0,EY("label",{title:(0,B.Z)("Prevents window closing along with last tab.")},void 0,EY("input",{type:"checkbox",checked:e[I.kTabsNeverCloseLast],onChange:kY(I.kTabsNeverCloseLast)}),EY("span",{},void 0,(0,B.Z)("Keep Window Open when Last Tab is Closed")))),EY("div",{className:"setting-single max-bookmarks"},void 0,EY("label",{},void 0,EY("input",{type:"checkbox",checked:this.props.prefValues[I.kTabsConfirmClosingTabs],onChange:kY(I.kTabsConfirmClosingTabs)}),EY("span",{},void 0,(0,B.Z)("Confirm Closing Tabs over Maximum of"))),EY("input",{type:"number",size:"2",disabled:!this.props.prefValues[I.kTabsConfirmClosingTabs],value:this.props.prefValues[I.kTabsConfirmClosingThreshold],onChange:kY(I.kTabsConfirmClosingThreshold),min:this.confirmClosingTabsMinThreshold,max:this.confirmClosingTabsMaxThreshold})),EY("div",{className:"setting-single"},void 0,EY("label",{title:(0,B.Z)("Focus page content instead of addressfield")},void 0,EY("input",{type:"checkbox",checked:e[I.kTabsFocusWebview],onChange:kY(I.kTabsFocusWebview)}),EY("span",{},void 0,(0,B.Z)("Focus Page Content on New Tab")))),EY(ja.Z,{name:"tabDoubleClick",value:e[I.kTabsDoubleClick],onChange:kY(I.kTabsDoubleClick)},void 0,EY("div",{className:"setting-single pad-top"},void 0,EY("label",{},void 0,MY,EY("span",{},void 0,(0,B.Z)("Double-Click to Rename Tab")))),EY("div",{className:"setting-single"},void 0,EY("label",{},void 0,OY,EY("span",{},void 0,(0,B.Z)("Double-Click to Close Tab")))),EY("div",{className:"setting-single"},void 0,EY("label",{},void 0,xY,EY("span",{},void 0,(0,B.Z)("Ignore Double-Click"))))))))}}const RY=(0,Bu.Z)(LY,_Y);var BY;function FY(e,t,n,i){BY||(BY="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:BY,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const WY=w.Z.getEventHandler,UY=[I.kMouseWheelTabSwitch,I.kTabsCycleByRecentOrder,I.kTabsMinimize,I.kTabsVisualSwitchEnable,I.kTabsVisualSwitchListLayout];var VY=FY("input",{type:"radio",value:"true"}),HY=FY("input",{type:"radio",value:"false"});class GY extends Li.Component{render(){const e=this.props.prefValues;return FY(iA.Z,{filter:this.props.filter},void 0,FY("div",{className:"setting-group"},void 0,FY("h3",{htmlFor:"tabSelection"},void 0,(0,B.Z)("Tab Cycling")),FY(ja.Z,{name:"tabCyclingOrder",value:this.props.prefValues[I.kTabsCycleByRecentOrder],onChange:WY(I.kTabsCycleByRecentOrder,"convert")},void 0,FY("div",{className:"setting-single"},void 0,FY("label",{},void 0,VY,FY("span",{},void 0,(0,B.Z)("Cycle in Recently Used Order")))),FY("div",{className:"setting-single"},void 0,FY("label",{},void 0,HY,FY("span",{},void 0,(0,B.Z)("Cycle in Tab Order"))))),FY("div",{className:"setting-single pad-top"},void 0,FY("label",{},void 0,FY("input",{type:"checkbox",checked:this.props.prefValues[I.kTabsVisualSwitchEnable],onChange:WY(I.kTabsVisualSwitchEnable)}),FY("span",{},void 0,(0,B.Z)("Show Tab Cycler")))),FY("div",{className:"setting-single pad-left"},void 0,FY("label",{},void 0,FY("input",{type:"checkbox",checked:this.props.prefValues[I.kTabsVisualSwitchListLayout],disabled:!this.props.prefValues[I.kTabsVisualSwitchEnable],onChange:WY(I.kTabsVisualSwitchListLayout)}),FY("span",{},void 0,(0,B.Z)("Display Tab Cycler as List")))),FY("div",{className:"setting-single"},void 0,FY("label",{title:(0,B.Z)("Scroll over Tab Bar to switch tabs by order, or scroll anywhere else while holding Alt key to switch tabs per Tab Cycling setting.")},void 0,FY("input",{type:"checkbox",checked:e[I.kMouseWheelTabSwitch],onChange:WY(I.kMouseWheelTabSwitch)}),FY("span",{},void 0,(0,B.Z)("Switch Tabs by Scrolling")))),FY("div",{className:"setting-single"},void 0,FY("label",{},void 0,FY("input",{type:"checkbox",checked:this.props.prefValues[I.kTabsMinimize],onChange:WY(I.kTabsMinimize)}),FY("span",{},void 0,(0,B.Z)("Minimize Active Tab"))),FY("p",{className:"info"},void 0,(0,B.Z)("Click current tab to switch to last active tab.")))))}}const $Y=(0,Bu.Z)(GY,UY);var KY;function zY(e,t,n,i){KY||(KY="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:KY,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const jY=w.Z.getEventHandler,YY=[I.kTabsAutoMuting];var XY=zY("input",{type:"radio",value:"off"}),QY=zY("input",{type:"radio",value:"onlyActive"}),qY=zY("input",{type:"radio",value:"prioritizeActive"});class JY extends Li.Component{render(){return zY(iA.Z,{filter:this.props.filter},void 0,zY("div",{className:"setting-group"},void 0,zY("h3",{},void 0,(0,B.Z)("Mute Tab Audio")),zY(ja.Z,{name:"mutableTabs",value:this.props.prefValues[I.kTabsAutoMuting],onChange:jY(I.kTabsAutoMuting)},void 0,zY("div",{className:"setting-single"},void 0,zY("label",{},void 0,XY,zY("span",{},void 0,(0,B.Z)("Play All Audio")))),zY("div",{className:"setting-single"},void 0,zY("label",{},void 0,QY,zY("span",{},void 0,(0,B.Z)("Play Only in Active Tab")))),zY("div",{className:"setting-single"},void 0,zY("label",{},void 0,qY,zY("span",{},void 0,(0,B.Z)("Prioritize Active Tab")))))))}}const eX=(0,Bu.Z)(JY,YY);var tX;function nX(e,t,n,i){tX||(tX="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:tX,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const iX=w.Z.getEventHandler,sX=[I.kTabsActivationOnClone,I.kTabsNewPlacement,I.kTabsOpenNewInBackground];var oX=nX("input",{type:"radio",value:"rightofcurrent"}),aX=nX("input",{type:"radio",value:"directrightofcurrent"}),rX=nX("input",{type:"radio",value:"alwayslast"}),lX=nX("input",{type:"radio",value:"openintabstackwithrelated"}),dX=nX("input",{type:"radio",value:"rightofcurrent"}),cX=nX("input",{type:"radio",value:"alwayslast"});class uX extends Li.Component{render(){return nX(iA.Z,{filter:this.props.filter},void 0,nX("span",{},void 0,nX("div",{className:"setting-group"},void 0,nX("div",{className:"setting-single"},void 0,nX("h3",{},void 0,(0,B.Z)("New Tab Position")),nX(ja.Z,{name:"tabOpen",value:this.props.prefValues[I.kTabsNewPlacement],onChange:iX(I.kTabsNewPlacement)},void 0,nX("div",{className:"setting-single"},void 0,nX("label",{},void 0,oX,nX("span",{},void 0,(0,B.Z)("After Related Tabs")))),nX("div",{className:"setting-single"},void 0,nX("label",{},void 0,aX,nX("span",{},void 0,(0,B.Z)("After Active Tab")))),nX("div",{className:"setting-single"},void 0,nX("label",{},void 0,rX,nX("span",{},void 0,(0,B.Z)("As Last Tab")))),nX("div",{className:"setting-single"},void 0,nX("label",{},void 0,lX,nX("span",{},void 0,(0,B.Z)("As Tab Stack with Related Tab"))))),nX("div",{className:"setting-single pad-top"},void 0,nX("label",{},void 0,nX("input",{type:"checkbox",checked:this.props.prefValues[I.kTabsOpenNewInBackground],onChange:iX(I.kTabsOpenNewInBackground)}),nX("span",{},void 0,(0,B.Z)("New Tab from Link Opens in Background")))))),nX("div",{className:"setting-group"},void 0,nX("div",{className:"setting-single"},void 0,nX("h3",{},void 0,(0,B.Z)("Duplicated Tab Position")),nX(ja.Z,{name:"tabClone",value:this.props.prefValues[I.kTabsActivationOnClone],onChange:iX(I.kTabsActivationOnClone)},void 0,nX("div",{className:"setting-single"},void 0,nX("label",{},void 0,dX,nX("span",{},void 0,(0,B.Z)("Next to Original Tab")))),nX("div",{className:"setting-single"},void 0,nX("label",{},void 0,cX,nX("span",{},void 0,(0,B.Z)("As Last Tab")))))))))}}const pX=(0,Bu.Z)(uX,sX);var hX;function gX(e,t,n,i){hX||(hX="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:hX,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const mX=w.Z.getEventHandler,fX=[I.kHoverCardMemoryUsageEnabled,I.kTabsActiveMinSize,I.kTabsAtEdge,I.kTabsCloseButtonLeft,I.kTabsCloseButtonPermanent,I.kTabsCounterDetection,I.kTabsDimHibernated,I.kTabsHorizontalScrolling,I.kTabsPageLoadInfo,I.kTabsShowCloseButton,I.kTabsShowSyncedTabsButton,I.kTabsShowTrashCan,I.kTabsThumbnails,I.kTabsTooltip,I.kTabsUnread];var vX=gX("input",{type:"radio",value:"progress_bar"}),yX=gX("input",{type:"radio",value:"progress_icon"}),bX=gX("input",{type:"radio",value:"spinner"}),SX=gX("input",{type:"radio",value:"none"});class wX extends Li.Component{render(){const{prefValues:e}=this.props,{hasToken:t,isReady:i}=pe.getState();return gX(iA.Z,{filter:this.props.filter},void 0,gX("div",{className:"setting-group"},void 0,gX("h3",{},void 0,(0,B.Z)("tbd","Tab Bar")),gX("div",{className:"setting-single"},void 0,gX("label",{},void 0,gX("input",{type:"checkbox",checked:e[I.kTabsHorizontalScrolling],onChange:mX(I.kTabsHorizontalScrolling)}),gX("span",{},void 0,(0,B.Z)("Enable Horizontal Scrolling"))),gX("p",{className:"info"},void 0,(0,B.Z)("Hold Shift key when “Switch Tabs by Scrolling” setting is enabled."))),gX("div",{className:"setting-single"},void 0,gX("label",{},void 0,gX("input",{type:"checkbox",checked:e[I.kTabsAtEdge],onChange:mX(I.kTabsAtEdge)}),gX("span",{},void 0,(0,B.Z)("Remove Tab Spacing in Maximized Windows")))),gX("div",{className:"setting-single"},void 0,gX("label",{},void 0,gX("input",{type:"checkbox",checked:e[I.kTabsShowTrashCan],onChange:mX(I.kTabsShowTrashCan)}),gX("span",{},void 0,(0,B.Z)("Display Trash Can")))),gX("div",{className:"setting-single"},void 0,gX("label",{},void 0,gX("input",{type:"checkbox",checked:e[I.kTabsShowSyncedTabsButton],onChange:mX(I.kTabsShowSyncedTabsButton),disabled:!t&&!i}),gX("span",{},void 0,(0,B.Z)("Display Synced Tabs Button"))),!t&&!i&&gX("p",{className:"info"},void 0,(0,B.Z)("This setting requires active Sync.")))),gX("div",{className:"setting-group"},void 0,gX("div",{className:"setting-single"},void 0,gX("h3",{},void 0,(0,B.Z)("Tab Options")),gX("div",{className:"setting-single"},void 0,gX("label",{},void 0,gX("input",{type:"checkbox",checked:e[I.kTabsTooltip],onChange:mX(I.kTabsTooltip)}),gX("span",{},void 0,(0,B.Z)("Show Popup Thumbnails")))),gX("div",{className:"setting-single pad-left"},void 0,gX("label",{},void 0,gX("input",{type:"checkbox",checked:e[I.kHoverCardMemoryUsageEnabled],onChange:mX(I.kHoverCardMemoryUsageEnabled)}),gX("span",{},void 0,(0,B.Z)("Show Tab Memory Usage")))),gX("div",{className:"setting-single"},void 0,gX("label",{},void 0,gX("input",{type:"checkbox",checked:e[I.kTabsThumbnails],onChange:mX(I.kTabsThumbnails)}),gX("span",{},void 0,(0,B.Z)("Show Tab Thumbnails")))),gX("div",{className:"setting-single"},void 0,gX("label",{},void 0,gX("input",{type:"checkbox",checked:e[I.kTabsShowCloseButton],onChange:mX(I.kTabsShowCloseButton)}),gX("span",{},void 0,(0,B.Z)("Display Close Button")))),gX("div",{className:"setting-single pad-left"},void 0,gX("label",{title:(0,B.Z)("Display Close button on left side of a tab")},void 0,gX("input",{type:"checkbox",disabled:!e[I.kTabsShowCloseButton],checked:e[I.kTabsCloseButtonLeft],onChange:mX(I.kTabsCloseButtonLeft)}),gX("span",{},void 0,(0,B.Z)("On Left Side")))),gX("div",{className:"setting-single pad-left"},void 0,gX("label",{title:(0,B.Z)("Permanently display Close button")},void 0,gX("input",{type:"checkbox",disabled:!e[I.kTabsShowCloseButton],checked:e[I.kTabsCloseButtonPermanent],onChange:mX(I.kTabsCloseButtonPermanent)}),gX("span",{},void 0,(0,B.Z)("Permanently")))),gX("div",{className:"setting-single"},void 0,gX("label",{title:(0,B.Z)("Detect and display numeric notification from page title in Tabs and Web Panels")},void 0,gX("input",{type:"checkbox",checked:e[I.kTabsCounterDetection],onChange:mX(I.kTabsCounterDetection)}),gX("span",{},void 0,(0,B.Z)("Detect Page Title Notifications")))),gX("div",{className:"setting-single"},void 0,gX("label",{title:(0,B.Z)("Display a triangle symbol for unread Tabs")},void 0,gX("input",{type:"checkbox",checked:e[I.kTabsUnread],onChange:mX(I.kTabsUnread)}),gX("span",{},void 0,(0,B.Z)("Use Unread Indicators"))),gX("div",{className:e[I.kTabsUnread]?"img-setting":"img-setting disabled"},void 0,gX("span",{className:"image",dangerouslySetInnerHTML:{__html:n(33271)}}))),gX("div",{className:"setting-single"},void 0,gX("label",{},void 0,gX("input",{type:"checkbox",checked:e[I.kTabsDimHibernated],onChange:mX(I.kTabsDimHibernated)}),gX("span",{},void 0,(0,B.Z)("Dim Icon when Hibernated")))))),gX("div",{className:"setting-group tab-min-width"},void 0,gX("h3",{},void 0,(0,B.Z)("Active Tab Minimum Width")),gX("div",{className:"setting-single"},void 0,gX(cB,{value:e[I.kTabsActiveMinSize],min:30,max:180,step:30,onChange:mX(I.kTabsActiveMinSize),label:(0,B.Z)("$1 pixel","$1 pixels",[parseInt(e[I.kTabsActiveMinSize])]),title:(0,B.Z)("Minimum width of horizontally scaled active tab")}))),gX("div",{className:"setting-group"},void 0,gX("h3",{},void 0,(0,B.Z)("Page Load Progress")),gX(ja.Z,{name:"tabPageLoadInfo",value:this.props.prefValues[I.kTabsPageLoadInfo],onChange:mX(I.kTabsPageLoadInfo)},void 0,gX("div",{className:"setting-single"},void 0,gX("label",{title:(0,B.Z)("Display tab progress bar while page is loading")},void 0,vX,gX("span",{},void 0,(0,B.Z)("Progress Bar")))),gX("div",{className:"setting-single"},void 0,gX("label",{title:(0,B.Z)("Display circular progress in place of favicon while page is loading")},void 0,yX,gX("span",{},void 0,(0,B.Z)("Favicon Progress")))),gX("div",{className:"setting-single"},void 0,gX("label",{title:(0,B.Z)("Display spinner in place of favicon while page is loading")},void 0,bX,gX("span",{},void 0,(0,B.Z)("Favicon Spinner")))),gX("div",{className:"setting-single"},void 0,gX("label",{title:(0,B.Z)("Don’t display page loading progress")},void 0,SX,gX("span",{},void 0,(0,B.Z)("radio","None")))))))}}const CX=(0,Bu.Z)(wX,fX);var AX;function IX(e,t,n,i){AX||(AX="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:AX,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const TX=w.Z.getEventHandler,ZX=[I.kExtensionURLOverrides,I.kTabsNewPageLink],EX=[I.kTabsNewPageLink,I.kTabsNewPageCustomUrl];class kX extends Li.Component{state={customUrl:C.Z.get(I.kTabsNewPageCustomUrl)};_handleCustomUrlChange=({currentTarget:e})=>{const t=e.value;this.setState({customUrl:t}),this._saveCustomUrl(t)};_saveCustomUrl=e=>{const t=(0,rl.q9)(e);w.Z.set(I.kTabsNewPageCustomUrl,t),this.props.prefValues[I.kTabsNewPageLink]!==p.Fp.CUSTOM&&w.Z.set(I.kTabsNewPageLink,p.Fp.CUSTOM)};focusCustomUrlInput=()=>{this._customPageRef&&this._customPageRef.focus()};render(){const e=this.props.prefValues,t=e[I.kExtensionURLOverrides].newtab?.some((e=>e.active)),n=e[I.kTabsNewPageLink]===p.Fp.EXTENSION;return IX(iA.Z,{filter:this.props.filter},void 0,IX("div",{className:"setting-group new-tab-page"},void 0,IX("h3",{},void 0,(0,B.Z)("title","New Tab Page")),IX(ja.Z,{name:"tabPageSettings",value:e[I.kTabsNewPageLink],onChange:TX(I.kTabsNewPageLink)},void 0,IX("div",{className:"setting-single"},void 0,IX("label",{},void 0,IX("input",{type:"radio",value:p.Fp.STARTPAGE,checked:e[I.kTabsNewPageLink]===p.Fp.STARTPAGE||e[I.kTabsNewPageLink]===p.Fp.EXTENSION,onChange:TX(I.kTabsNewPageLink)}),IX("span",{},void 0,(0,B.Z)("noun","Start Page")))),IX("div",{className:"setting-single pad-left"},void 0,IX("label",{title:(0,B.Z)("Allow installed third-party extensions to control the Start Page")},void 0,IX("input",{type:"checkbox",disabled:!t,checked:n,onChange:TX(I.kTabsNewPageLink),value:n?p.Fp.STARTPAGE:p.Fp.EXTENSION}),IX("span",{},void 0,(0,B.Z)("Controlled by Extension")))),IX("div",{className:"setting-single"},void 0,IX("label",{},void 0,IX("input",{type:"radio",value:p.Fp.HOMEPAGE}),IX("span",{},void 0,(0,B.Z)("other","Homepage")))),IX("div",{className:"setting-single"},void 0,IX("label",{},void 0,IX("input",{type:"radio",value:p.Fp.BLANKPAGE}),IX("span",{},void 0,(0,B.Z)("other","Blank Page")))),IX("div",{className:"setting-single"},void 0,IX("label",{},void 0,IX("input",{type:"radio",className:"pad-top",onMouseUp:this.focusCustomUrlInput,value:p.Fp.CUSTOM}),IX("span",{},void 0,(0,ss.jsx)("input",{type:"text",ref:e=>this._customPageRef=e,placeholder:(0,B.Z)("Specific Page"),onChange:this._handleCustomUrlChange,value:this.state.customUrl,tabIndex:e[I.kTabsNewPageLink]===p.Fp.CUSTOM?0:-1})))))))}}const _X=(0,Bu.Z)(kX,ZX);var NX;function PX(e,t,n,i){NX||(NX="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:NX,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const DX=[I.kTabsClosePinned,I.kTabsShowSeparator,I.kTabsClosePinnedInStack],MX=w.Z.getEventHandler;var OX=PX("input",{type:"radio",value:"off"}),xX=PX("input",{type:"radio",value:"bury"}),LX=PX("input",{type:"radio",value:"on"});class RX extends Li.Component{render(){return PX(iA.Z,{filter:this.props.filter},void 0,PX("div",{className:"setting-group"},void 0,PX("h3",{},void 0,(0,B.Z)("Pinned Tabs")),PX(ja.Z,{name:"closablePinnedTabs",value:this.props.prefValues[I.kTabsClosePinned],onChange:MX(I.kTabsClosePinned)},void 0,PX("div",{className:"setting-single"},void 0,PX("label",{},void 0,OX,PX("span",{},void 0,(0,B.Z)("Don’t Close Pinned Tabs")))),PX("div",{className:"setting-single pad-left"},void 0,PX("label",{},void 0,PX("input",{type:"checkbox",disabled:!this.props.prefValues[I.kTabsClosePinned],onChange:MX(I.kTabsClosePinnedInStack),checked:this.props.prefValues[I.kTabsClosePinnedInStack]}),PX("span",{},void 0,(0,B.Z)("Allow Closing in Pinned Stacks")))),PX("div",{className:"setting-single"},void 0,PX("label",{},void 0,xX,PX("span",{},void 0,(0,B.Z)("Minimize Instead of Close")))),PX("div",{className:"setting-single"},void 0,PX("label",{},void 0,LX,PX("span",{},void 0,(0,B.Z)("Close as Other Tabs"))))),PX("div",{className:"setting-single pad-top"},void 0,PX("label",{},void 0,PX("input",{type:"checkbox",checked:this.props.prefValues[I.kTabsShowSeparator],onChange:MX(I.kTabsShowSeparator)}),PX("span",{},void 0,(0,B.Z)("Show Separator Below Pinned Tabs"))))))}}const BX=(0,Bu.Z)(RX,DX);var FX;function WX(e,t,n,i){FX||(FX="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:FX,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const UX={top:(0,B.Z)("Top"),right:(0,B.Z)("title","Right"),bottom:(0,B.Z)("Bottom"),left:(0,B.Z)("title","Left")};var VX=WX("g",{},void 0,WX("path",{className:"thumb-preview-colorBg",d:"M0 0h96v76H0z"}),WX("path",{className:"thumb-preview-colorBgDark",d:"M0 0h96v12H0z"}),WX("path",{className:"thumb-preview-non-active-tab",d:"M33 2h30v8H33zM64 2h30v8H64z"}),WX("path",{className:"thumb-preview-colorAccentBg",d:"M2 2h30v8H2z"})),HX=WX("g",{},void 0,WX("path",{className:"thumb-preview-colorBg",d:"M0 0h96v76H0z"}),WX("path",{className:"thumb-preview-colorBgDark",d:"M62 0h34v76H62z"}),WX("path",{className:"thumb-preview-non-active-tab",d:"M64 11h30v8H64zM64 20h30v8H64z"}),WX("path",{className:"thumb-preview-colorAccentBg",d:"M64 2h30v8H64z"})),GX=WX("g",{},void 0,WX("path",{className:"thumb-preview-colorBg",d:"M0 0h96v76H0z"}),WX("path",{className:"thumb-preview-colorBgDark",d:"M0 64h96v12H0z"}),WX("path",{className:"thumb-preview-non-active-tab",d:"M33 66h30v8H33zM64 66h30v8H64z"}),WX("path",{className:"thumb-preview-colorAccentBg",d:"M2 66h30v8H2z"})),$X=WX("g",{},void 0,WX("path",{className:"thumb-preview-colorBg",d:"M0 0h96v76H0z"}),WX("path",{className:"thumb-preview-colorBgDark",d:"M0 0h34v76H0z"}),WX("path",{className:"thumb-preview-non-active-tab",d:"M2 11h30v8H2zM2 20h30v8H2z"}),WX("path",{className:"thumb-preview-colorAccentBg",d:"M2 2h30v8H2z"})),KX=WX("svg",{xmlns:"http://www.w3.org/2000/svg",className:"selectbox-checkmark",viewBox:"0 0 16 16"},void 0,WX("path",{d:"M5.3 13.3L1.5 9.5 3 8l2.3 2.5L13 2.7 14.6 4l-8 8z"}));class zX extends Li.Component{render(){if(!this.props.position)return null;const e=this.props.position,t=UX[this.props.position],n=Fi()({selectbox:!0,"selectbox-selected":this.props.selected}),i=(0,xd.Z)(this.props,["position","vivaldiSettings"]);return(0,ss.jsxs)("button",{className:n,title:t,...i,children:[WX("div",{className:"selectbox-image"},void 0,WX("svg",{viewBox:"0 0 96 76",xmlns:"http://www.w3.org/2000/svg",className:"tab-preview"},void 0,"top"===e&&VX,"right"===e&&HX,"bottom"===e&&GX,"left"===e&&$X),KX),WX("div",{className:"selectbox-title"},void 0,t)]})}}const jX=zX;var YX;function XX(e,t,n,i){YX||(YX="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:YX,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const QX="left",qX="right",JX="bottom",eQ=[I.kTabsBarPosition,I.kTabsVisible],tQ=w.Z.getEventHandler;class nQ extends Li.Component{setTabPosition=e=>{w.Z.set(I.kTabsBarPosition,e)};render(){const e=this.props.prefValues,t=e[I.kTabsBarPosition];return XX(iA.Z,{filter:this.props.filter},void 0,XX("div",{className:"setting-group unlimited"},void 0,XX("div",{className:"setting-single"},void 0,XX("label",{},void 0,XX("input",{type:"checkbox",checked:e[I.kTabsVisible],onChange:tQ(I.kTabsVisible)}),XX("span",{},void 0,(0,B.Z)("radio","Show Tab Bar"))))),XX("div",{className:"setting-group unlimited"},void 0,XX("div",{className:"setting-single tabbar-position"},void 0,XX("h3",{},void 0,(0,B.Z)("Tab Bar Position")),XX("div",{className:"selectbox-container"},void 0,XX(jX,{position:"top",selected:"top"===t,onClick:this.setTabPosition.bind(this,"top")}),XX(jX,{position:"left",selected:t===QX,onClick:this.setTabPosition.bind(this,QX)}),XX(jX,{position:"right",selected:t===qX,onClick:this.setTabPosition.bind(this,qX)}),XX(jX,{position:"bottom",selected:t===JX,onClick:this.setTabPosition.bind(this,JX)})))))}}const iQ=(0,Bu.Z)(nQ,eQ);var sQ;function oQ(e,t,n,i){sQ||(sQ="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:sQ,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const aQ=w.Z.getEventHandler,rQ=[I.kTabsSelectionEnabled,I.kTabsSelectionIncludeActive];class lQ extends Li.Component{render(){return oQ(iA.Z,{filter:this.props.filter},void 0,oQ("div",{className:"setting-group"},void 0,oQ("div",{className:"setting-single"},void 0,oQ("h3",{},void 0,(0,B.Z)("Tab Selection")),oQ("div",{className:"setting-single"},void 0,oQ("label",{title:(0,B.Z)("Select multiple tabs with Ctrl and Shift")},void 0,oQ("input",{type:"checkbox",checked:this.props.prefValues[I.kTabsSelectionEnabled],onChange:aQ(I.kTabsSelectionEnabled)}),oQ("span",{},void 0,(0,B.Z)("Enable Tab Selection")))),oQ("div",{className:"setting-single"},void 0,oQ("label",{title:(0,B.Z)("The active tab will always be part of the initial tab selection")},void 0,oQ("input",{type:"checkbox",checked:this.props.prefValues[I.kTabsSelectionIncludeActive],onChange:aQ(I.kTabsSelectionIncludeActive)}),oQ("span",{},void 0,(0,B.Z)("Include Active Tab in Initial Selection")))))))}}const dQ=(0,Bu.Z)(lQ,rQ);var cQ;function uQ(e,t,n,i){cQ||(cQ="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:cQ,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const pQ=w.Z.getEventHandler,hQ=[I.kTabsStackingAllowDnd,I.kTabsStackingAutoExpand,I.kTabsStackingMode,I.kTabsStackingOpenInCurrent,I.kTabsBarWidth,I.kTabsStackingPreferDotted,I.kTabsStackingDndDelay];class gQ extends Li.Component{render(){const{prefValues:e}=this.props;return uQ(iA.Z,{filter:this.props.filter},void 0,uQ("div",{className:"setting-group"},void 0,uQ("h3",{},void 0,(0,B.Z)("Tab Stacking")),uQ("div",{className:"setting-single"},void 0,uQ("label",{},void 0,uQ("input",{name:"tab-stack-style",type:"radio",value:"dotted",checked:"dotted"===e[I.kTabsStackingMode],onChange:pQ(I.kTabsStackingMode)}),uQ("span",{},void 0,(0,B.Z)("radio","Compact"))),uQ("div",{className:"dotted"===e[I.kTabsStackingMode]?"img-setting":"img-setting disabled"},void 0,uQ("span",{className:"image",dangerouslySetInnerHTML:{__html:n(18998)}}))),uQ("div",{className:"setting-single pad-top"},void 0,uQ("label",{},void 0,uQ("input",{name:"tab-stack-style",type:"radio",value:"substrip",checked:"substrip"===e[I.kTabsStackingMode],onChange:()=>{w.Z.set(I.kTabsBarWidth,260),w.Z.set(I.kTabsStackingMode,"substrip")}}),uQ("span",{},void 0,(0,B.Z)("Two-Level"))),uQ("div",{className:"substrip"===e[I.kTabsStackingMode]?"img-setting":"img-setting disabled"},void 0,uQ("span",{className:e[I.kTabsStackingPreferDotted]?"image alternate":"image",dangerouslySetInnerHTML:{__html:n(86681)}}))),uQ("div",{className:"setting-single pad-left"},void 0,uQ("label",{},void 0,uQ("input",{type:"checkbox",disabled:"substrip"!==e[I.kTabsStackingMode],checked:e[I.kTabsStackingPreferDotted],onChange:pQ(I.kTabsStackingPreferDotted)}),uQ("span",{},void 0,(0,B.Z)("Use Compact Display Style")))),uQ("div",{className:"setting-single pad-top"},void 0,uQ("label",{},void 0,uQ("input",{name:"tab-stack-style",type:"radio",value:"accordion",checked:"accordion"===e[I.kTabsStackingMode],onChange:pQ(I.kTabsStackingMode)}),uQ("span",{},void 0,(0,B.Z)("Accordion"))),uQ("div",{className:"accordion"===e[I.kTabsStackingMode]?"img-setting":"img-setting disabled"},void 0,uQ("span",{className:"image",dangerouslySetInnerHTML:{__html:n(86484)}}))),uQ("div",{className:"setting-single pad-left"},void 0,uQ("label",{},void 0,uQ("input",{type:"checkbox",disabled:"accordion"!==e[I.kTabsStackingMode],checked:e[I.kTabsStackingAutoExpand],onChange:pQ(I.kTabsStackingAutoExpand)}),uQ("span",{},void 0,(0,B.Z)("Auto Expand")))),uQ("div",{className:"setting-single pad-top"},void 0,uQ("label",{},void 0,uQ("input",{name:"tab-stack-style",type:"radio",value:"off",checked:"off"===e[I.kTabsStackingMode],onChange:pQ(I.kTabsStackingMode)}),uQ("span",{},void 0,(0,B.Z)("Disable"))))),uQ("div",{className:"setting-group"},void 0,uQ("h3",{},void 0,(0,B.Z)("Tab Stack Options")),uQ("div",{className:"setting-single"},void 0,uQ("label",{},void 0,uQ("input",{type:"checkbox",disabled:"off"===e[I.kTabsStackingMode],checked:e[I.kTabsStackingOpenInCurrent],onChange:pQ(I.kTabsStackingOpenInCurrent)}),uQ("span",{},void 0,(0,B.Z)("Open Tabs in Current Tab Stack")))),uQ("div",{className:"setting-single"},void 0,uQ("label",{},void 0,uQ("input",{type:"checkbox",disabled:"off"===e[I.kTabsStackingMode],checked:e[I.kTabsStackingAllowDnd],onChange:pQ(I.kTabsStackingAllowDnd)}),uQ("span",{},void 0,(0,B.Z)("Allow Stacking by Drag and Drop")))),uQ("div",{className:"setting-single stacking-delay pad-left"},void 0,uQ("label",{htmlFor:"stacking-delay",title:(0,B.Z)("Adjust tab stack drop detection delay when moving a tab over another one.")},void 0,(0,B.Z)("Stacking Drop Delay")),uQ("input",{type:"range",id:"stacking-delay",value:e[I.kTabsStackingDndDelay],min:50,max:850,step:200,disabled:!e[I.kTabsStackingAllowDnd]||"off"===e[I.kTabsStackingMode],onChange:pQ(I.kTabsStackingDndDelay)}),uQ("p",{className:"info stack-speed"},void 0,uQ("span",{},void 0,(0,B.Z)("Short")),uQ("span",{},void 0,(0,B.Z)("Long"))))))}}const mQ=(0,Bu.Z)(gQ,hQ);w.Z.getEventHandler;const fQ=[I.kTabsTilingCollapseBorder];var vQ;function yQ(e,t,n,i){vQ||(vQ="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:vQ,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const bQ=["❤️","✨","😊","🎁","😂","🎉","👍","✅","⭐","👉","😉","🥰","👀","🤔","😭","🥳","💵","✈️","📚"],SQ=({closeModal:e,onPick:t,top:n,left:i,activeIcon:s,activeEmoji:o})=>{const a=(0,Li.useRef)(),[r,l]=(0,Li.useState)(void 0!==o),d=e=>{if(r){const n=e.currentTarget.dataset.emoji;return void t(n)}const n=parseInt(e.currentTarget.dataset.id);isNaN(n)||t(n)};return yQ(ra.Z,{className:"icon-picker",onRequestClose:e,style:{width:230,minWidth:"unset",top:n,left:i,right:"auto"},labelledBy:"modal-dialog-workspace-icon"},void 0,yQ("form",{onSubmit:n=>{const i=a.current?.value;i?t(i):e()}},void 0,yQ("header",{className:"dialog-header"},void 0,yQ("span",{id:"modal-dialog-workspace-icon"},void 0,(0,B.Z)("Select Workspace Icon")),yQ("div",{className:"dialog-header buttons"},void 0,yQ("input",{type:"button",className:r?"":"active",value:(0,B.Z)("title","Icon"),onClick:()=>l(!1)}),yQ("input",{type:"button",className:r?"active":"",value:`${(0,B.Z)("Emoji")} 😀`,onClick:()=>l(!0)}))),yQ("div",{className:"dialog-content workspaces"},void 0,!r&&yQ("ul",{},void 0,GF.S.map(((e,t)=>yQ("li",{className:s===e?"active":"","data-id":t,onClick:d},t,yQ("span",{className:"icon",dangerouslySetInnerHTML:{__html:e}}))))),r&&(0,ss.jsxs)(ss.Fragment,{children:[yQ("ul",{},void 0,bQ.map(((e,t)=>yQ("li",{className:o===e?"active":"","data-emoji":e,onClick:d},e,e))),o&&!bQ.includes(o)&&yQ("li",{className:"active","data-emoji":o,onClick:d},o,o)),(0,ss.jsx)("input",{ref:a,type:"text",pattern:"^(?:\\p{Emoji}+(?:\\ufe0f|\\u200d)|\\u20e3)*)+\\p{Emoji}?$",placeholder:(0,B.Z)("Paste any emoji here 👍"),onChange:e=>{const n=a.current,i=n?.value;i&&!n?.validity.patternMismatch&&t(i)}})]})),yQ("footer",{className:"dialog-footer"},void 0,yQ("input",{type:"submit",value:(0,B.Z)("OK"),autoFocus:!0}),yQ("input",{type:"button",onClick:e,value:(0,B.Z)("Cancel"),autoFocus:!0}))))};var wQ,CQ=n(29104);function AQ(){const e=GF.Z.getState(),t=(0,B.Z)("title","New Workspace");if(!e.some((e=>e.name===t)))return t;const n=`^${(0,B.Z)("New Workspace $1",["(\\d+)"])}$`,i=e.map((e=>{const t=e.name.match(n);if(t)return Number(t[1]).valueOf()})).filter(Boolean),s=0===i.length?0:Math.max(...i);return(0,B.Z)("New Workspace $1",[s+1])}function IQ(e,t,n,i){wQ||(wQ="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:wQ,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function TQ(){return GF.S[Math.floor(Math.random()*GF.S.length)]}class ZQ extends Li.PureComponent{static contextType=ts.Z;refTop=Li.createRef();state={name:AQ(),isIconPickerVisible:!1,includeWindowTabs:!1,includeSelectedTabs:Boolean(!this.props.disableMoveTabs&&this.props.withPages&&!this.props.withPages.isEmpty()),activeIcon:TQ(),activeEmoji:void 0};handleDismiss=this.props.onClose;handleChange=e=>{this.setState({name:e.currentTarget.value})};handleIncludeWindowTabs=()=>{this.setState((e=>({includeWindowTabs:!e.includeWindowTabs})))};handleIncludeSelectedTabs=()=>{this.setState((e=>({includeSelectedTabs:!e.includeSelectedTabs})))};handleCreate=e=>{const t=this.context.vivaldiWindowId,{name:n,activeIcon:i,activeEmoji:s,includeWindowTabs:o,includeSelectedTabs:a}=this.state,{withPages:r}=this.props;let l;a?l=r:o&&(l=Ce.ZP.getPages(t,{workspaceId:void 0})),e.preventDefault(),n&&i&&(CQ.Z.addWorkspace(n,i,s,l,this.props.createInBackground),this.props.onClose())};showIconPicker=()=>{this.props.onShowIconPicker?this.props.onShowIconPicker():this.setState({isIconPickerVisible:!0})};hideIconPicker=()=>{this.setState({isIconPickerVisible:!1})};handlePick=e=>{if("number"==typeof e){const t=GF.S[e];this.setState({activeIcon:t,activeEmoji:void 0})}else this.setState({activeEmoji:e});this.hideIconPicker()};handleFocus=e=>{e.target instanceof this.context.HTMLInputElement&&e.target.select()};scrollIntoView=()=>{this.refTop.current?.scrollIntoViewIfNeeded()};render(){const{name:e,activeIcon:t,activeEmoji:n,includeWindowTabs:i,isIconPickerVisible:s}=this.state,o=this.props,a=void 0===Ce.ZP.getActiveWorkspace(o.windowId);return(0,ss.jsxs)("div",{ref:this.refTop,className:Fi()("workspace-new",o.className),style:o.style,children:[IQ("header",{className:"dialog-header"},void 0,IQ("h1",{id:ra.t},void 0,(0,B.Z)("workspaces","Create Workspace"))),IQ("div",{className:"dialog-content"},void 0,IQ("form",{className:"create-form",onSubmit:this.handleCreate},void 0,IQ("div",{className:"icon-button",style:{alignItems:a?"center":"flex-end"},onClick:this.showIconPicker,dangerouslySetInnerHTML:{__html:n??t}}),IQ("div",{className:"inputs"},void 0,IQ("label",{},void 0,(0,B.Z)("Workspace Name"),IQ("input",{type:"text",value:e,placeholder:(0,B.Z)("Choose Workspace Name"),onChange:this.handleChange,autoFocus:!0,onFocus:this.handleFocus})),a&&!o.disableMoveTabs&&!o.withPages&&IQ("label",{},void 0,IQ("input",{type:"checkbox",checked:i,onChange:this.handleIncludeWindowTabs}),(0,B.Z)("Move tabs from current window to the new workspace")),!o.disableMoveTabs&&o.withPages&&!o.withPages.isEmpty()&&IQ("label",{},void 0,IQ("input",{type:"checkbox",checked:this.state.includeSelectedTabs,onChange:this.handleIncludeSelectedTabs}),(0,B.Z)("Move selected tabs to the new workspace"))))),IQ("footer",{className:"dialog-footer"},void 0,IQ("input",{type:"button",value:(0,B.Z)("Create"),className:"primary",disabled:!e,onClick:this.handleCreate}),IQ("input",{type:"button",value:(0,B.Z)("Cancel"),onClick:this.handleDismiss})),s&&IQ(SQ,{closeModal:this.hideIconPicker,onPick:this.handlePick,activeIcon:t,activeEmoji:n,top:0,left:50})]})}}const EQ=ZQ;var kQ,_Q=n(5200),NQ=n(59240);function PQ(e,t,n,i){kQ||(kQ="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:kQ,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const DQ="DRAGGABLE_RULE";var MQ=PQ("option",{value:""},"");function OQ({windowId:e,rule:t,ruleCount:n,style:i,workspaces:s,findItem:o,moveItem:a,onDelete:r,onFocus:l,onTypeChanged:d,onExpressionChanged:c,onWorkspaceChanged:u,onDrop:p,onAddWorkspace:h}){const g=Li.useRef(null),m=o(t.id)?.index,f=(m??0)+1,[{isDragging:v,handlerId:y},b]=(0,_Q.c)((()=>({type:DQ,item:{id:t.id,originalIndex:m},collect:e=>({isDragging:e.isDragging(),handlerId:e.getHandlerId()})})),[t.id,m]),[,S]=(0,NQ.L)((()=>({accept:DQ,hover(e,n){if(!g.current||"number"!=typeof m)return;const i=e.originalIndex,s=m;if(i===s)return;const o=g.current?.getBoundingClientRect(),r=(o.bottom-o.top)/2,l=n.getClientOffset().y-o.top;i<s&&l<r||i>s&&l>r||(a(e.id,t.id),e.originalIndex=s)},drop:p})),[t.id,a]);return b(g),S(g),(0,ss.jsxs)("div",{ref:g,className:"WorkspaceLinkRouting-Item",style:{...i,opacity:v?0:1},"data-handler-id":y,children:[PQ("div",{className:"header"},void 0,PQ("p",{className:"name"},void 0,(0,B.Z)("Workspace Rule $1",[f])),PQ("div",{},void 0,PQ("input",{type:"button",className:"circular remove",title:(0,B.Z)("Remove Workspace Rule"),onClick:r}))),PQ("form",{},void 0,PQ("div",{},void 0,(0,B.Z)("If URL")),PQ("div",{className:"inputs"},void 0,PQ(ta.Z,{value:t.type,onChange:d,onFocus:l},void 0,PQ("option",{value:"CONTAINS"},void 0,(0,B.Z)("contains")),PQ("option",{value:"EQUALS"},void 0,(0,B.Z)("is")),PQ("option",{value:"STARTSWITH"},void 0,(0,B.Z)("starts with"))),PQ(Vl.Z,{label:"",className:"expression",type:"text",placeholder:(0,B.Z)("https://"),value:t.expression,onChange:c,onFocus:l,hasError:!t.expression})),PQ("div",{},void 0,(0,B.Z)("Open in")),PQ("div",{className:"inputs"},void 0,s.length>0&&PQ(ta.Z,{name:"workspaceId",value:t.workspaceId,onChange:u,onFocus:l},void 0,!t.workspaceId&&MQ,s.map((e=>PQ("option",{value:e.id},e.id,e.name))),PQ("option",{value:"NEW_WORKSPACE"},void 0,(0,B.Z)("+ Create New Workspace"))),0===s.length&&PQ("div",{className:"toolbar toolbar-default toolbar-group"},void 0,PQ("div",{className:"toolbar-group"},void 0,PQ(po.ZP,{onClick:h,image:Wi.md4.medium,title:(0,B.Z)("Add Workspace")})))))]},t.id)}const xQ=Li.memo(OQ);function LQ(e){const t={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=0);return t}function RQ(e,t,n){for(const i in t){if(!Object.prototype.hasOwnProperty.call(t,i))continue;if(0!==n[i])return!1;const s="number"==typeof t[i]?t[i]:t[i].val;if(e[i]!==s)return!1}return!0}const BQ=[0,0];function FQ(e,t,n,i,s,o,a){const r=n+(-s*(t-i)+-o*n)*e,l=t+r*e;return Math.abs(r)<a&&Math.abs(l-i)<a?(BQ[0]=i,BQ[1]=0,BQ):(BQ[0]=l,BQ[1]=r,BQ)}function WQ(e){const t={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]="number"==typeof e[n]?e[n]:e[n].val);return t}const UQ=1e3/60;class VQ extends Li.Component{static contextType=ts.Z;constructor(e){super(e),this.state=this.defaultState()}unmounting=!1;wasAnimating=!1;animationID=null;prevTime=0;accumulatedTime=0;defaultState(){const{defaultStyle:e,style:t}=this.props,n=e||WQ(t),i=LQ(n);return{currentStyle:n,currentVelocity:i,lastIdealStyle:n,lastIdealVelocity:i}}unreadPropStyle=null;clearUnreadPropStyle=e=>{let t=!1,{currentStyle:n,currentVelocity:i,lastIdealStyle:s,lastIdealVelocity:o}=this.state;for(const a in e){if(!Object.prototype.hasOwnProperty.call(e,a))continue;const r=e[a];"number"==typeof r&&(t||(t=!0,n={...n},i={...i},s={...s},o={...o}),n[a]=r,i[a]=0,s[a]=r,o[a]=0)}t&&this.setState({currentStyle:n,currentVelocity:i,lastIdealStyle:s,lastIdealVelocity:o})};startAnimationIfNecessary=()=>{if(this.unmounting||null!=this.animationID)return;const{requestAnimationFrame:e}=this.context;this.animationID=e((e=>{if(this.unmounting)return;const t=this.props.style;if(RQ(this.state.currentStyle,t,this.state.currentVelocity))return this.wasAnimating&&this.props.onRest&&this.props.onRest(),this.animationID=null,this.wasAnimating=!1,void(this.accumulatedTime=0);this.wasAnimating=!0;const n=e||performance.now(),i=n-this.prevTime;if(this.prevTime=n,this.accumulatedTime=this.accumulatedTime+i,this.accumulatedTime>10*UQ&&(this.accumulatedTime=0),0===this.accumulatedTime)return this.animationID=null,void this.startAnimationIfNecessary();const s=(this.accumulatedTime-Math.floor(this.accumulatedTime/UQ)*UQ)/UQ,o=Math.floor(this.accumulatedTime/UQ),a={},r={},l={},d={};for(const e in t){if(!Object.prototype.hasOwnProperty.call(t,e))continue;const n=t[e];if("number"==typeof n)l[e]=n,d[e]=0,a[e]=n,r[e]=0;else{let t=this.state.lastIdealStyle[e],i=this.state.lastIdealVelocity[e];for(let e=0;e<o;e++)[t,i]=FQ(UQ/1e3,t,i,n.val,n.stiffness,n.damping,n.precision);const[c,u]=FQ(UQ/1e3,t,i,n.val,n.stiffness,n.damping,n.precision);l[e]=t+(c-t)*s,d[e]=i+(u-i)*s,a[e]=t,r[e]=i}}this.animationID=null,this.accumulatedTime-=o*UQ,this.setState({currentStyle:l,currentVelocity:d,lastIdealStyle:a,lastIdealVelocity:r}),this.unreadPropStyle=null,this.startAnimationIfNecessary()}))};componentDidMount(){this.prevTime=performance.now(),this.startAnimationIfNecessary()}UNSAFE_componentWillReceiveProps(e){null!=this.unreadPropStyle&&this.clearUnreadPropStyle(this.unreadPropStyle),this.unreadPropStyle=e.style,null==this.animationID&&(this.prevTime=performance.now(),this.startAnimationIfNecessary())}componentWillUnmount(){this.unmounting=!0,null!=this.animationID&&(this.context.cancelAnimationFrame(this.animationID),this.animationID=null)}render(){const e=this.props.children(this.state.currentStyle);return e&&Li.Children.only(e)}}var HQ=n(64387),GQ=n(92);const $Q={stiffness:170,damping:26,precision:.01};function KQ(e,t){return{...$Q,...t,val:e}}var zQ,jQ=n(81365),YQ=n(57865);function XQ(e,t,n,i){zQ||(zQ="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:zQ,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function QQ(e){return(0,Li.forwardRef)((function(t,n){const i=(0,Li.useContext)(ts.Z);return XQ(jQ.W,{backend:YQ.PD,context:i},void 0,(0,ss.jsx)(e,{ref:n,...t}))}))}var qQ,JQ=n(34155);function eq(e,t,n,i){qQ||(qQ="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:qQ,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const tq={stiffness:500,damping:32},nq="CREATE_WORKSPACE_DIALOG";const iq=QQ((function(e){const t=Li.useContext(ts.Z),n=yL(),i=Li.useRef(null),s=Li.useRef(null),o=Li.useRef(null),a=Li.useRef(GQ.Z.getRules()),[r,l]=Li.useState(GF.Z.getState()),[d,c]=Li.useState(),[u,p]=Li.useState(""),h=a.current?.length??0,[g,m]=Li.useState(!1);Li.useEffect((()=>{function e(){const e=GF.Z.getState();l(e),c((t=>t?{...t,workspaceId:e[e.length-1]?.id}:t)),xi.Z.focus(t.vivaldiWindowId)}function i(){a.current=GQ.Z.getRules(),n()}return GF.Z.addListener(e),GQ.Z.addListener(i),()=>{GF.Z.removeListener(e),GQ.Z.removeListener(i)}}),[t.vivaldiWindowId,n]);const f=e=>{if(!d)return;const t=e.currentTarget.value;"CONTAINS"!==t&&"EQUALS"!==t&&"STARTSWITH"!==t||c({...d,type:t})},y=e=>{d&&c({...d,expression:e.target.value})},b=e=>{if(!d)return;const t=e.currentTarget.value;if("NEW_WORKSPACE"===t)return void S(d.id);const n=Number(e.currentTarget.value);""===t||isNaN(n)||c({...d,workspaceId:n})},S=e=>{p(e),JQ.nextTick((()=>{s.current?.scrollIntoView()}))};Li.useEffect((()=>{d&&(d.id?HQ.Z.updateLinkRoutingRule(d.id,d.type,d.expression,d.workspaceId):HQ.Z.addLinkRoutingRule(d.type,d.expression,d.workspaceId).then((()=>c(void 0))))}),[d]);const w=Li.useCallback((()=>{const e=a.current?.map((e=>e.id))??[];HQ.Z.setOrder(t.vivaldiWindowId,e)}),[t.vivaldiWindowId,a]),C=Li.useMemo((()=>({position:"relative",minHeight:114*h+8})),[h]),A=Li.useCallback((e=>{const t=a.current?.find((t=>t.id===e));if(t)return{item:t,index:a.current?.indexOf(t)??0}}),[a]),I=Li.useRef(null),T=Li.useCallback(((e,i)=>{const s=()=>{n(),I.current=null},o=A(e)?.index,r=a.current;if(r&&"number"==typeof o){const n=r.find((t=>t.id===e)),o=r.find((e=>e.id===i)),l=r.indexOf(n),d=r.indexOf(o);a.current=(0,v.Uy)(r,(e=>{const[t]=e.splice(l,1);e.splice(d,0,t)})),I.current||(I.current=t.requestAnimationFrame(s))}}),[t,A,n]);let Z;if(d)if(d.id){const e=a.current??[];Z=[];for(let t=0;t<e.length;t++){const n=e[t];n.id===d.id?Z.push(d):Z.push(n)}}else Z=a.current?.concat([d])??[d];else Z=a.current?[...a.current]:[];const E=u?Z.findIndex((({id:e})=>e===u)):-1;return E>-1&&Z.splice(E+1,0,{id:nq,type:"EQUALS",expression:"",workspaceId:-1}),he.ZP.isIncognitoOrGuest(t.vivaldiWindowId)?null:eq(iA.Z,{filter:e.filter},void 0,(0,ss.jsxs)("div",{ref:o,className:Fi()("WorkspaceLinkRouting",{disabled:!e.enabled}),children:[eq("div",{className:"WorkspaceLinkRouting-Description"},void 0,eq("h3",{},void 0,(0,B.Z)("Open Websites in Workspaces Automatically")),eq("p",{className:"info"},void 0,(0,B.Z)("Set up rules to automatically open websites in specific Workspaces.")," ",(0,B.Z)("Example: All links from “vivaldi.net” open in a workspace called “Vivaldi”."))),(0,ss.jsx)("div",{ref:i,className:"WorkspaceLinkRouting-DragArea",style:C,children:Z.map(((e,n)=>eq(VQ,{style:{posY:KQ(114*n,tq)}},e.id,(({posY:n})=>e.id===nq?(0,ss.jsx)(EQ,{ref:s,windowId:t.vivaldiWindowId,onClose:()=>Promise.resolve(p("")),onShowIconPicker:()=>m(!0),createInBackground:!0,disableMoveTabs:!0,className:"inline",style:{transform:`translate3d(0, ${n}px, 0)`}},e.id):eq(xQ,{windowId:t.vivaldiWindowId,rule:e,ruleCount:h,style:{transform:`translate3d(0, ${n}px, 0)`},workspaces:r,findItem:A,moveItem:T,onDelete:()=>{var t;(t=e.id)?HQ.Z.removeLinkRoutingRules([t]):c(void 0)},onFocus:()=>c(e),onTypeChanged:f,onExpressionChanged:y,onWorkspaceChanged:b,onDrop:w,onAddWorkspace:()=>S(e.id)})))))})]}),eq("div",{className:"setting-single"},void 0,eq("input",{type:"button",disabled:!e.enabled,value:(0,B.Z)("Add New Workspace Rule"),onClick:()=>{c({id:"",type:"CONTAINS",expression:"",workspaceId:r[0]?.id})}})),g&&eq(SQ,{closeModal:()=>m(!1),onPick:e=>{s.current?.handlePick(e),m(!1)},activeIcon:s.current?.state.activeIcon,activeEmoji:s.current?.state.activeEmoji,top:o.current?.offsetTop??0,left:90}))}));var sq;function oq(e,t,n,i){sq||(sq="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:sq,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const aq=[I.kWorkspacesButtonShowInTabbar,I.kWorkspacesEnabled,I.kWorkspacesButtonMouseWheelEnabled],rq=w.Z.getEventHandler;function lq({filter:e}){const t=(0,Ya.Z)(aq),[n,i]=(0,Li.useState)(!1),[s,o]=(0,Li.useState)("");(0,Li.useEffect)((()=>{se.Z.utilities.getStartupAction((e=>o(e)))}),[]);return(0,ss.jsxs)(ss.Fragment,{children:[oq(iA.Z,{filter:e},void 0,oq("div",{className:"setting-group"},void 0,oq("div",{className:"setting-single"},void 0,"last"!==s&&oq("p",{className:"info"},void 0,(0,B.Z)("Enabling Workspaces will set “Startup with” setting to “Last Session”.")),oq("div",{className:"setting-single"},void 0,oq("label",{},void 0,oq("input",{type:"checkbox",checked:t[I.kWorkspacesEnabled],onChange:()=>{t[I.kWorkspacesEnabled]?i(!0):(w.Z.set(I.kWorkspacesEnabled,!0),se.Z.utilities.setStartupAction("last",C.Z.get(I.kURLsToRestoreOnStartup)))}}),oq("span",{},void 0,(0,B.Z)("Enable Workspaces"))))),oq("div",{className:"setting-single"},void 0,oq("label",{},void 0,oq("input",{type:"checkbox",checked:t[I.kWorkspacesButtonShowInTabbar],onChange:rq(I.kWorkspacesButtonShowInTabbar),disabled:!t[I.kWorkspacesEnabled]}),oq("span",{},void 0,(0,B.Z)("Show Workspaces in Tab Bar")))),oq("div",{className:"setting-single"},void 0,oq("label",{},void 0,oq("input",{type:"checkbox",checked:t[I.kWorkspacesButtonMouseWheelEnabled],onChange:rq(I.kWorkspacesButtonMouseWheelEnabled),disabled:!t[I.kWorkspacesEnabled]}),oq("span",{},void 0,(0,B.Z)("Switch Workspaces using Mouse Wheel")))))),n&&oq(jF,{onClose:e=>{i(!1),e&&w.Z.set(I.kWorkspacesEnabled,!1)},from:"tabs"})]})}var dq;function cq(e,t,n,i){dq||(dq="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:dq,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const uq=[..._Y,...IY,...UY,...YY,...sX,...fX,...EX,...DX,...eQ,...rQ,...hQ,...fQ,...aq,I.kWorkspacesLinkRoutes];function pq({filter:e,isWorkspacesEnabled:t,category:n}){const i=sN({filter:e,prefPaths:uq,name:n.title});return(0,ss.jsxs)(ss.Fragment,{children:[cq("section",{className:"setting-section"},void 0,cq(tN.Z,{categoryTitle:(0,B.Z)("Tabs"),filter:e},void 0,cq(iQ,{filter:e}),cq(_X,{filter:e}),cq(pX,{filter:e}),cq(RY,{filter:e}),cq(TY,{filter:e})),cq(tN.Z,{categoryTitle:(0,B.Z)("Tab Display"),filter:e},void 0,cq(CX,{filter:e})),cq(tN.Z,{categoryTitle:(0,B.Z)("Tab Features"),filter:e},void 0,cq($Y,{filter:e}),cq(dQ,{filter:e}),cq(mQ,{filter:e}),!1,cq(BX,{filter:e}),cq(eX,{filter:e})),cq(tN.Z,{categoryTitle:(0,B.Z)("Workspaces"),filter:e},void 0,cq(lq,{filter:e}),cq(iq,{filter:e,enabled:t}))),i]})}const hq=Li.memo(pq);var gq;function mq(e,t,n,i){gq||(gq="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:gq,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const fq=[I.kHueBridgeIp,I.kHueEnabled,I.kHueLights,I.kHueUsername];class vq extends Li.PureComponent{initialState=()=>{const{lights:e,groups:t}=Re.getState();return{groups:t,lights:e,validBridge:!1,validUsername:!1,waitingForButtonPress:!1,givenUp:!1,manualIp:""}};_isMounted=!1;state=this.initialState();componentDidMount(){this._isMounted=!0,Re.addListener(this.onHueStoreChanged),this.props.prefValues[I.kHueEnabled]&&this.props.prefValues[I.kHueBridgeIp]&&this.verifyBridge()}componentWillUnmount(){Re.removeListener(this.onHueStoreChanged),this._isMounted=!1}onHueStoreChanged=()=>{const{lights:e,groups:t}=Re.getState();this.setState({lights:e,groups:t})};verifyBridge=()=>{const e=C.Z.get(I.kHueBridgeIp);e?fetch(`http://${e}/description.xml`).then((e=>{e.ok?this.setState({validBridge:!0},this.verifyUsername):this.getBridge()})).catch((e=>{this.getBridge()})):this.getBridge()};getBridge=()=>{fetch("https://discovery.meethue.com/").then((e=>{e.ok?e.json().then((e=>{e&&e[0]&&e[0].internalipaddress?(w.Z.set(I.kHueBridgeIp,e[0].internalipaddress),this.verifyBridge()):this.setState({givenUp:!0})})):this.setState({givenUp:!0})})).catch((e=>{this.setState({givenUp:!0})}))};setBridge=()=>{w.Z.set(I.kHueBridgeIp,this.state.manualIp),this.verifyBridge()};verifyUsername=()=>{const e=C.Z.get(I.kHueBridgeIp),t=C.Z.get(I.kHueUsername);t?fetch(`http://${e}/api/${t}/`).then((e=>{e.ok?e.json().then((e=>{e[0]?.error?(w.Z.set(I.kHueUsername,""),this.getUsername()):e?.config&&this.setState({validUsername:!0,waitingForButtonPress:!1},He.updateLights)})):this.setState({givenUp:!0})})).catch((e=>{this.setState({givenUp:!0})})):this.getUsername()};getUsername=()=>{const e=C.Z.get(I.kHueBridgeIp);e&&fetch(`http://${e}/api`,{method:"POST",body:JSON.stringify({devicetype:"vivaldi_browser#desktop_hue"})}).then((e=>{e.ok?e.json().then((e=>{e[0]?.success?.username?(w.Z.set(I.kHueUsername,e[0].success.username),this.verifyUsername()):e[0]?.error&&101===e[0].error.type&&(this.setState({waitingForButtonPress:!0}),setTimeout((()=>{this._isMounted&&this.getUsername()}),1e3))})):this.setState({givenUp:!0})})).catch((e=>{this.setState({givenUp:!0})}))};toggleLight=(e,t)=>{const n=!C.Z.get(I.kHueLights).includes(t),i=C.Z.get(I.kHueLights).filter((e=>e!==t));n&&i.push(t),He.flash(e),w.Z.set(I.kHueLights,i)};resetBridge=()=>{w.Z.reset(I.kHueBridgeIp),w.Z.reset(I.kHueUsername),this.setState(this.initialState())};changeManualIp=e=>{this.setState({manualIp:e.currentTarget.value})};render(){const e=this.props.prefValues[I.kHueEnabled],t=this.props.prefValues[I.kHueLights],{waitingForButtonPress:n,validBridge:i,validUsername:s,groups:o,lights:a}=this.state;return mq(tN.Z,{categoryTitle:(0,B.Z)("Philips Hue Theme Integration"),filter:this.props.filter},void 0,mq("div",{className:"setting-group"},void 0,mq("div",{className:"setting-single"},void 0,mq("label",{},void 0,mq("input",{type:"checkbox",checked:e,onChange:w.Z.getEventHandler(I.kHueEnabled)}),mq("span",{},void 0,(0,B.Z)("Enable Hue"))),mq("p",{className:"info"},void 0,e&&i&&!n?(0,B.Z)("Connected to Hue Bridge at $1.",[this.props.prefValues[I.kHueBridgeIp]]):(0,B.Z)("Requires a Philips Hue lighting system on the local network.")))),e&&i&&mq("div",{className:"setting-group"},void 0,mq("input",{type:"button",className:"danger",value:(0,B.Z)("Reset Bridge Connection"),onClick:this.resetBridge})),e&&(!i||n)&&mq("div",{className:"setting-group unlimited"},void 0,mq("h3",{},void 0,(0,B.Z)("Bridge Discovery")),!n&&mq("div",{className:"setting-group"},void 0,mq(Vl.Z,{type:"text",onChange:this.changeManualIp,label:(0,B.Z)("Bridge IP (Leave blank to autodiscover)"),placeholder:"127.0.0.1",value:this.state.manualIp}),mq("div",{className:"setting-single"},void 0,mq("input",{type:"button",className:"primary",value:this.state.manualIp?(0,B.Z)("Connect"):(0,B.Z)("Find Bridge"),onClick:this.state.manualIp?this.setBridge:this.getBridge}))),n&&mq("div",{className:"setting-group unlimited"},void 0,mq("p",{className:"info"},void 0,(0,B.Z)("Found Bridge at $1. Waiting for button press...",[this.props.prefValues[I.kHueBridgeIp]])),mq("div",{className:"hue-press-button",dangerouslySetInnerHTML:{__html:`${Wi.I_V}${(0,B.Z)("Press the button on your Bridge")}`}}))),e&&s&&o.size>0&&a.size>0&&mq("div",{className:"setting-group unlimited"},void 0,mq("p",{className:"info"},void 0,(0,B.Z)("Only lights that support color can be selected."),"* "+(0,B.Z)("Light currently unreachable.")),[...o.keys()].map((e=>mq("div",{className:"setting-group"},e,mq("h3",{},void 0,o.get(e)?.name),o.get(e)?.lights.map((e=>{const n=a.get(e);if(!n)return null;const i=t&&t.some((e=>e===n.uniqueid)),s=n.type.toLowerCase().includes("color light");return mq("div",{className:"setting-single"},n.uniqueid,mq("label",{},void 0,mq("input",{type:"checkbox",checked:i,disabled:!s,onChange:()=>{this.toggleLight(e,n.uniqueid)}}),mq("span",{},void 0,n.name,!n.state.reachable&&"*")))})))))))}}const yq=(0,Bu.Z)(vq,fq);var bq;function Sq(e,t,n,i){bq||(bq="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:bq,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const wq=["keyboard","mouse","chromalink","mousemat","headset"],Cq=[I.kRazerChromaDevices,I.kRazerChromaEnabled],Aq=[{device:"keyboard",text:(0,B.Z)("Keyboard")},{device:"mouse",text:(0,B.Z)("Mouse")},{device:"mousemat",text:(0,B.Z)("Mouse Mat")},{device:"headset",text:(0,B.Z)("Headset")},{device:"chromalink",text:(0,B.Z)("Chroma Link")}];function Iq(e){const t=(0,Ya.Z)(Cq),n=(e,t)=>e.findIndex((e=>e===t))>-1;return Sq(tN.Z,{categoryTitle:(0,B.Z)("Razer Chroma Theme Integration"),filter:e.filter},void 0,Sq("div",{className:"setting-group"},void 0,Sq("div",{className:"setting-single"},void 0,Sq("label",{},void 0,Sq("input",{type:"checkbox",checked:t[I.kRazerChromaEnabled],onChange:e=>{const t=e.target.checked;w.Z.set(I.kRazerChromaEnabled,t)}}),Sq("span",{},void 0,(0,B.Z)("Enable Razer Chroma Integration"))),Sq("p",{className:"info"},void 0,(0,B.Z)("Requires Razer Chroma enabled devices connected to the local machine."))),function(){const e=t[I.kRazerChromaDevices],i=Aq.map((i=>Sq("div",{className:"setting-single pad-left"},i.device,Sq("label",{},void 0,Sq("input",{type:"checkbox",disabled:!t[I.kRazerChromaEnabled],checked:n(e,i.device),onChange:e=>((e,i)=>{const s=e.target.checked,o=t[I.kRazerChromaDevices],a=wq.filter((e=>i===e?s:n(o,e)));w.Z.set(I.kRazerChromaDevices,a)})(e,i.device)}),Sq("span",{},void 0,i.text)))));return i}()))}const Tq=Li.memo(Iq);var Zq;function Eq(e,t,n,i){Zq||(Zq="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Zq,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const kq=["Spacer","FlexibleSpacer","PanelWidthSpacer","Divider","AddressField","AccountButton","PanelChat","StatusInfo","MailSearch","VersionInfo","Zoom"];async function _q(e,t,n,i){let s=await i.arrayBuffer();i.name.endsWith(".svg")&&(s=(0,Cs.tc)(s).buffer);const o=await se.Z.utilities.storeImage({data:s,mimeType:i.type});(0,cr.kz)(e,(e=>{const i=e.find((e=>e.id===t));i?(i.buttons=i.buttons??{},i.buttons[n]=o):console.error("saveButtonImage: expected to find theme")}))}var Nq=Eq("span",{className:"label"},void 0,"28 × 28");function Pq(e){const{showOpenFilePicker:t}=Li.useContext(ts.Z),{themePref:n,themeId:i,selectedButton:s,preventEditing:o}=e,a=s&&null!==Be.Z.getToolbarButtonImage(s),r=Li.useCallback((async e=>{if(1!==e.length||!s)return;const[t]=e;try{_q(n,i,s,t)}catch(e){console.error("ThemeButtonsEditor: "+e.toString())}}),[s,n,i]);function l(e){return s?Eq(Nae,{name:s,index:0,draggable:!1,label:" ",size:e,mimeType:"",onDragEnter:Lr.Z,onDragStart:Lr.Z,onDragEnd:Lr.Z,onDrop:Lr.Z,preview:!0,inEditor:!0,forceIcon:!0,isMailWindow:!0},s):null}const{canDropFile:d,onDragLeave:c,onDragOver:u,onDrop:p}=tZ(r);return(0,ss.jsxs)(ss.Fragment,{children:[Eq("div",{inert:o?"true":null,className:"Button-Area droparea",onDragEnter:e=>{e.currentTarget.classList.add("dragover")},onDragOver:e=>{e.preventDefault(),u(e)},onDragLeave:e=>{d&&c(e),e.currentTarget.classList.remove("dragover")},onDrop:e=>{d&&p(e),e.currentTarget.classList.remove("dragover")},onClick:async()=>{if(!s)return;const[e]=await t({types:[{description:(0,B.Z)("Image files"),accept:{"image/*":[".bmp",".gif",".jpg",".jpeg",".png",".webp",".svg"]}}]}),o=await e.getFile();_q(n,i,s,o)}},void 0,Eq("div",{className:"Button-Area-Large toolbar-large"},void 0,l("large"),Nq),Eq("div",{className:"Button-Area-Preview",style:{scale:4}},void 0,l("large"),Eq("span",{className:"label"},void 0,(0,B.Z)("command","Preview")))),Eq("div",{className:"Button-Area-Controls"},void 0,Eq("input",{type:"button",value:(0,B.Z)("Remove Custom Image"),disabled:!a,onClick:()=>{(0,cr.kz)(n,(e=>{const t=e.find((e=>e.id===i));t?.buttons&&(delete t.buttons[s],0===Object.keys(t.buttons).length&&delete t.buttons)}))}}))]})}class Dq extends Li.PureComponent{static contextType=ts.Z;state={selectedButton:""};changeButtonSelection=e=>{const t=e.target.value;this.setState({selectedButton:t})};renderCategory=e=>{let t=[];return t="chains"===e?C.Z.get(I.kChainedCommandsCommandList).map((e=>({id:e.name,label:e.label}))):"mail"===e?[...Qf.ww.find((e=>"mail"===e.category))?.buttons||[],...Qf.ww.find((e=>"mail_composer"===e.category))?.buttons||[],...Qf.ww.find((e=>"mail_message"===e.category))?.buttons||[]]:Qf.ww.find((t=>t.category===e))?.buttons||[],t=[...new Set(t)],t.filter((e=>!kq.includes(e.id))).map(((e,t)=>Eq("option",{value:e.id},e.id+"__"+t,e.label)))};render(){const{themeId:e,prefValues:t}=this.props,n=Cs.ZP.getThemesWithButtons(),i=Boolean(t[I.kThemesCurrentButtons]&&e!==t[I.kThemesCurrentButtons]);return(0,ss.jsx)(ss.Fragment,{children:Eq("div",{className:"TabbedView--Padded Button-Settings"},void 0,Eq("h3",{},void 0,(0,B.Z)("Current Theme Icons")),Eq("div",{className:"Button-Manager"},void 0,Eq("div",{className:"Button-Selector"},void 0,Eq("select",{size:"14",onChange:this.changeButtonSelection,onKeyDown:t=>{"Delete"!==t.key&&"Backspace"!==t.key||(0,cr.kz)(this.props.themePref,(t=>{const n=t.find((t=>t.id===e));n?.buttons&&(delete n.buttons[this.state.selectedButton],0===Object.keys(n.buttons).length&&delete n.buttons)}))}},void 0,Eq("option",{disabled:!0},void 0,(0,B.Z)("category","Navigation")),this.renderCategory("navigation"),Eq("option",{disabled:!0},void 0,(0,B.Z)("category","Status Bar")),this.renderCategory("status"),Eq("option",{disabled:!0},void 0,(0,B.Z)("category","Panel")),this.renderCategory("panel"),Eq("option",{disabled:!0},void 0,(0,B.Z)("category","Mail")),this.renderCategory("mail"),Eq("option",{disabled:!0},void 0,(0,B.Z)("category","Command Chains")),this.renderCategory("chains"))),Eq("div",{className:"Button-Editor"},void 0,i?Eq(To,{type:"warning"},void 0,(0,B.Z)("Only the currently active theme can be edited. Please switch to “$1” theme first, or change the Custom Buttons setting above.",[n.find((e=>e.id===t[I.kThemesCurrentButtons]))?.name??""])):Eq("p",{className:"info"},void 0,!this.state.selectedButton&&(0,B.Z)("Select a button from the list on the left.")," ",(0,B.Z)("Drop a custom icon in the area below. Supply images in bitmap or SVG format, designed to fit on a 28 × 28 pixel canvas.")," ",Eq(A_.Z,{onClick:()=>{c.ZP.openURL(this.context.vivaldiWindowId,"https://help.vivaldi.com/desktop/appearance-customization/creating-custom-icon-set/",{singleton:!0})}},void 0,(0,B.Z)("Learn more."))),this.state.selectedButton&&Eq(Pq,{themePref:this.props.themePref,themeId:e,selectedButton:this.state.selectedButton,preventEditing:i}))))})}}const Mq=Dq;var Oq;function xq(e,t,n,i){Oq||(Oq="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Oq,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var Lq=xq("span",{className:"ThemeEditorColorPicker-HexSymbol"},void 0,"#");class Rq extends Li.PureComponent{state={hexString:void 0};onKeyDown=e=>{const t="#"+e.currentTarget.value;switch(e.key){case"Enter":4!==t.length&&7!==t.length||!xe().valid(t)||(this.props.setColor(xe()(t).hex()),this.setState({hexString:void 0}));break;case"Escape":this.setState({hexString:void 0})}};updateHexString=e=>{const t="#"+e.currentTarget.value;"blur"===e.type&&4===t.length&&xe().valid(t)?(this.props.setColor(xe()(t).hex()),this.setState({hexString:void 0})):7===t.length&&xe().valid(t)?(this.props.setColor(t),this.setState({hexString:void 0})):this.setState({hexString:t})};render(){return xq("div",{className:"ThemeEditorColorPicker"},void 0,this.props.label&&xq("div",{className:"ThemeEditorColorPicker-Label"},void 0,this.props.label),xq("input",{type:"color",className:"ThemeEditorColorPicker-ColorInput",disabled:this.props.disabled,value:this.props.color,onChange:e=>this.props.setColor(e.currentTarget.value)}),Lq,xq("input",{className:"ThemeEditorColorPicker-HexInput",type:"text",disabled:this.props.disabled,value:(this.state.hexString||this.props.color).substring(1),onChange:this.updateHexString,onKeyDown:this.onKeyDown,onBlur:this.updateHexString}))}}const Bq=Rq;var Fq;function Wq(e,t,n,i){Fq||(Fq="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Fq,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Uq=[I.kThemeScheduleEnabled,I.kThemeScheduleOS,I.kThemeScheduleTimeline,I.kThemesSystem,I.kThemesUser,I.kThemesCurrent,I.kThemesCurrentPrivate],Vq=["backgroundBlur","backgroundImage","colorAccentBg","colorAccentBgDark","colorAccentFg","colorBg","colorBgAlphaBlur","colorBgIntenser","colorBgLightIntense","colorBorder","colorFg","colorHighlightBg","colorTabBar","colorWindowBg","radius","radiusRounded"];var Hq=Wq("div",{className:"ThemePreview-TabBar"},void 0,Wq("div",{className:"ThemePreview-TabBar-Tab ThemePreview-TabBar-Tab--Active"}),Wq("div",{className:"ThemePreview-TabBar-Tab"})),Gq=Wq("div",{className:"ThemePreview-AddressBar"},void 0,Wq("div",{className:"ThemePreview-AddressBar-Icon ThemePreview-AddressBar-Icon--Active"}),Wq("div",{className:"ThemePreview-AddressBar-Icon ThemePreview-AddressBar-Icon--Active"}),Wq("div",{className:"ThemePreview-AddressBar-Icon"}),Wq("div",{className:"ThemePreview-AddressBar-Input"})),$q=Wq("div",{className:"ThemePreview-Panel"},void 0,Wq("div",{className:"ThemePreview-Panel-Item ThemePreview-Panel-Item--Active"}),Wq("div",{className:"ThemePreview-Panel-Item"}),Wq("div",{className:"ThemePreview-Panel-Item"}));class Kq extends Li.PureComponent{constructor(e){super(e);const{backgroundImage:t,backgroundPosition:n,id:i}=this.props.theme;this.state={style:void 0},Cs.ZP.getImageVars(t,n).then((e=>{this.setState({style:{...e,...Be.Z.getBaseStylesByThemeId(i,Vq)}})}))}componentDidUpdate(e,t){if(e.theme!==this.props.theme){const{backgroundImage:e,backgroundPosition:t,id:n}=this.props.theme;Cs.ZP.getImageVars(e,t).then((e=>{this.setState({style:{...e,...Be.Z.getBaseStylesByThemeId(n,Vq)}})}))}}render(){const e=this.props.theme.id,t=this.props.prefValues[I.kThemeScheduleEnabled],n=this.props.prefValues[I.kThemeScheduleOS],i=this.props.prefValues[I.kThemeScheduleTimeline],s=Cs.ZP.createClassnames(this.props.theme,this.state.style);return Wq("div",{className:Fi()(this.props.className,"ThemePreview",{"ThemePreview--Selected":this.props.isCurrent&&this.props.themeChangeCallback})},void 0,Wq("button",{disabled:!this.props.themeChangeCallback,onClick:this.props.themeChangeCallback?()=>{const e=this.props.theme.id;ki.Z.setTheme(e),this.props.themeChangeCallback&&this.props.themeChangeCallback(e)}:null,className:"ThemePreview-Image"},void 0,!this.state.style&&Wq("div",{className:"ThemePreview-Browser ThemePreview-Browser--Loading",dangerouslySetInnerHTML:{__html:Wi.H0I}}),Wq("div",{className:Fi()("ThemePreview-Browser",s),style:this.state.style},void 0,Hq,Gq,$q)),(this.props.themeChangeCallback||this.props.welcomePage)&&Wq("div",{className:"ThemePreview-Label"},void 0,this.props.theme.name),this.props.themeChangeCallback&&!this.props.welcomePage&&Wq("div",{className:"ThemePreview-Label-Meta"},void 0,this.props.theme.id===this.props.prefValues[I.kThemesCurrentPrivate]&&Wq("span",{},void 0,(0,B.Z)("Private")),"system"===t&&e===n.light&&Wq("span",{},void 0,(0,B.Z)("theme","Light")),"system"===t&&e===n.dark&&Wq("span",{},void 0,(0,B.Z)("theme","Dark")),"timeline"===t&&i.some((t=>t.themeId===e))&&Wq("span",{},void 0,(0,B.Z)("Schedule"))),!this.props.isSystem&&this.props.onConfirmDeletion&&Wq("button",{className:"ThemePreview-Delete",onClick:()=>{void 0!==this.props.onConfirmDeletion&&this.props.onConfirmDeletion(e)},tabIndex:-1,dangerouslySetInnerHTML:{__html:Wi.uN0}}))}}const zq=(0,Bu.Z)(Kq,Uq);var jq;function Yq(e,t,n,i){jq||(jq="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:jq,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Xq="chrome://vivaldi-data/desktop-image/0",Qq=[I.kSystemAccentColor,I.kSystemHasDesktopWallpaperProtocol,I.kThemesPreferCustomButtons,I.kThemesCurrentButtons,I.kThemesSystem,I.kThemesUser],qq={colorBg:(0,B.Z)("Background"),colorFg:(0,B.Z)("Foreground"),colorHighlightBg:(0,B.Z)("Highlight"),colorAccentBg:(0,B.Z)("Accent"),colorWindowBg:(0,B.Z)("background color","Window")},Jq={"#EDEEF2":(0,B.Z)("background","Light"),"#1D1E21":(0,B.Z)("background","Dark"),"#BBDFEF":(0,B.Z)("background","Blue"),"#fce370":(0,B.Z)("background","Yellow"),"#a4edd9":(0,B.Z)("background","Green"),"#ffb6c9":(0,B.Z)("background","Pink"),"#A9C8B3":(0,B.Z)("background","Soft Green"),"#BEB0CB":(0,B.Z)("background","Purple"),"#EFE5DD":(0,B.Z)("background","Sand"),"#FA7C68":(0,B.Z)("background","Orange")},eJ={"/resources/bg_gradient_01.webp":(0,B.Z)("Gradient"),"/resources/bg_gradient_09.webp":(0,B.Z)("Gradient"),"/resources/bg_landscape.webp":(0,B.Z)("Landscape"),"/resources/bg_pawel-czerwinski-Xk7ktUfyaNI-unsplash.webp":(0,B.Z)("Waves"),"/resources/bg_pawel-czerwinski-bWeZR1BQU9o-unsplash.webp":(0,B.Z)("Pink Waves"),"/resources/bg_alt_4.webp":(0,B.Z)("Beach"),"/resources/bg_richard-horvath-_nWaeTF6qo0-unsplash.webp":(0,B.Z)("Dark Shapes")},tJ=(0,Ae.Z)(((e,t)=>{(0,cr.kz)(e,t)}),50,{leading:!1,trailing:!0}),nJ=(0,aC.Z)(((e,t)=>{(0,cr.kz)(e,t)}),50,{leading:!0,trailing:!0});var iJ=Yq("img",{width:"24",height:"24",src:"../../../resources/emoji_party.png"});class sJ extends Li.PureComponent{static contextType=ts.Z;_isIMEOpen=!1;colorId=crypto.randomUUID();backgroundId=crypto.randomUUID();settingsId=crypto.randomUUID();buttonsId=crypto.randomUUID();state={backgroundType:"image",baseBgShowPicker:!1,baseFgShowPicker:!1,highlightBgShowPicker:!1,accentBgShowPicker:!1,view:"colors"};render(){const{theme:e,isCurrent:t,isSystem:i,prefValues:s}=this.props,o=i?I.kThemesSystem:I.kThemesUser,a=s[I.kThemesSystem].concat(s[I.kThemesUser]),r=s[o].findIndex((t=>t.id===e.id)),l=a.reduce(((e,t)=>{const n=t.backgroundImage,i=[...Object.keys(e),...Object.keys(eJ)];return n&&!i.includes(n)&&n!==Xq&&(e[n]=(0,B.Z)("From $1",[t.name])),e}),{}),d={...eJ,...l};return Yq(iA.Z,{filter:this.props.filter},void 0,Yq("div",{className:"ThemeEditor"},void 0,Yq("div",{className:"ThemeEditor-Header"},void 0,Yq("div",{className:"ThemeEditor-HeaderBasics"},void 0,Yq("div",{className:"toolbar toolbar-default"},void 0,Yq(ta.Z,{value:e.id,onChange:e=>{this.props.themeChangeCallback&&this.props.themeChangeCallback(e.currentTarget.value)}},void 0,a.map((e=>Yq("option",{value:e.id},e.id,e.name)))),Yq("input",{type:"button",className:t?void 0:"primary",disabled:t,onClick:()=>ki.Z.setTheme(e.id),value:(0,B.Z)("other","Enable")}),i&&Yq("input",{type:"button",className:"danger",disabled:Cs.ZP.isSystemThemeModified(Cs.ZP.getThemeWithFallback(e.id)),onClick:()=>ki.Z.revertSystemTheme(e.id),value:(0,B.Z)("Reset")}),!i&&e.url&&Yq("input",{type:"button",className:"danger",disabled:!t,onClick:()=>ki.Z.updateCustomTheme(e.id),value:(0,B.Z)("Reload")})),Yq("div",{className:"ThemeEditor-Name"},void 0,Yq("h3",{},void 0,(0,B.Z)("theme","Name")),Yq("input",{className:"theme-name",type:"text",disabled:i,onCompositionStart:()=>this._isIMEOpen=!0,onCompositionEnd:e=>{this._isIMEOpen=!1,(0,cr.kz)(o,(t=>{t[r].name=e.target.value}))},onChange:e=>{this._isIMEOpen||(0,cr.kz)(o,(t=>{t[r].name=e.target.value}))},defaultValue:e.name},e.id)),!i&&Yq("div",{className:"toolbar toolbar-default"},void 0,iJ,Yq("a",{className:"external-link",href:"https://themes.vivaldi.net",onClick:()=>c.ZP.openURL(this.context.vivaldiWindowId,"https://themes.vivaldi.net/upload")},void 0,(0,B.Z)("Share your theme"),Yq("span",{dangerouslySetInnerHTML:{__html:n(70942)}})))),Yq("div",{},void 0,Yq(zq,{isCurrent:t,isSystem:i,theme:e},e.id))),Yq(PV,{icons:[Wi.v5q.small,Wi.yhu.small,Wi.d$r.small,Wi.oMs.small]},void 0,Yq("div",{id:this.colorId,label:(0,B.Z)("Colors")},void 0,Yq("div",{className:"ThemeEditorColors"},void 0,Yq("div",{className:"ThemeEditorColors-Base"},void 0,["colorBg","colorFg"].map((t=>Yq(Bq,{label:qq[t],color:e[t],setColor:e=>{tJ(o,(n=>{n[r][t]=xe()(e).hex()}))}},e.id+t)))),Yq("div",{className:"ThemeEditorColors-Accent"},void 0,["colorHighlightBg","colorAccentBg"].map((t=>Yq(Bq,{label:qq[t],disabled:["colorHighlightBg"].includes(t)&&e.preferSystemAccent,color:e[t],setColor:e=>{tJ(o,(n=>{n[r][t]=xe()(e).hex()}))}},e.id+t))),Yq("div",{className:"setting-single"},void 0,Yq("label",{},void 0,Yq("input",{type:"checkbox",checked:e.preferSystemAccent,onChange:e=>{(0,cr.kz)(o,(t=>{t[r].preferSystemAccent=e.target.checked}))}}),Yq("span",{},void 0,(0,B.Z)("Prefer System Color")))))),Yq("div",{className:"TabbedView--Padded"},void 0,Yq("div",{className:"setting-group"},void 0,Yq("div",{className:"setting-single"},void 0,Yq("h3",{},void 0,(0,B.Z)("Color Overrides")),Yq("label",{},void 0,Yq("input",{type:"checkbox",checked:e.accentFromPage,onChange:e=>{(0,cr.kz)(o,(t=>{t[r].accentFromPage=e.target.checked}))}}),Yq("span",{},void 0,(0,B.Z)("Accent from Page"))),Yq("p",{className:"info"},void 0,(0,B.Z)("Get accent color from current webpage. Apply accent color to transparent Tab Bar background."))),Yq("div",{className:"setting-single"},void 0,Yq("label",{},void 0,Yq("input",{type:"checkbox",checked:e.accentOnWindow,onChange:e=>{(0,cr.kz)(o,(t=>{t[r].accentOnWindow=e.target.checked}))}}),Yq("span",{},void 0,(0,B.Z)("Accent on Window"))),Yq("p",{className:"info"},void 0,(0,B.Z)("Apply accent color to window background instead of the toolbar.")))),Yq("div",{className:"setting-group"},void 0,Yq("div",{className:"setting-single"},void 0,Yq("h3",{},void 0,(0,B.Z)("Limit Accent Color Saturation")),Yq(cB,{min:.2,max:1,step:.05,value:e.accentSaturationLimit,onChange:e=>{nJ(o,(t=>{t[r].accentSaturationLimit=Number(e.target.value)}))},label:`${Math.floor(100*e.accentSaturationLimit)}%`})),Yq("div",{className:"setting-single pad-top"},void 0,Yq("h3",{},void 0,(0,B.Z)("Color Contrast")),Yq(cB,{min:-10,max:20,step:1,onChange:e=>{nJ(o,(t=>{t[r].contrast=Number(e.target.value)}))},value:e.contrast}))))),Yq("div",{id:this.backgroundId,label:(0,B.Z)("Background")},void 0,Yq("div",{className:"ThemeEditor-BackgroundMeta"},void 0,Yq("div",{className:"ThemeEditor-BackgroundMetaBasic"},void 0,Yq("span",{},void 0,(0,B.Z)("Type:")),Yq(ta.Z,{value:this.state.backgroundType,onChange:e=>{const t=e.target.value;"image"!==t&&"color"!==t||this.setState({backgroundType:t})}},void 0,Yq("option",{value:"image"},void 0,(0,B.Z)("theme background","Image")),Yq("option",{value:"color"},void 0,(0,B.Z)("theme background","Color"))),"color"===this.state.backgroundType&&(0,ss.jsxs)(ss.Fragment,{children:[Yq("span",{},void 0,(0,B.Z)("Custom Color")),Yq(Bq,{color:e.colorWindowBg,setColor:e=>{tJ(o,(t=>{t[r].colorWindowBg=xe()(e).hex()}))}})]}),"image"===this.state.backgroundType&&(0,ss.jsxs)(ss.Fragment,{children:[Yq(ta.Z,{value:e.backgroundPosition,onChange:e=>{(0,cr.kz)(o,(t=>{t[r].backgroundPosition=e.target.value}))}},void 0,Yq("option",{value:"stretch"},void 0,(0,B.Z)("Stretch to Fit")),Yq("option",{value:"repeat"},void 0,(0,B.Z)("verb","Repeat")),Yq("option",{value:"center"},void 0,(0,B.Z)("Center"))),this.props.prefValues[I.kSystemHasDesktopWallpaperProtocol]&&Yq("input",{className:"ThemeEditor-BackgroundCustomButton",type:"button",disabled:e.backgroundImage===Xq,value:(0,B.Z)("Use Desktop Image"),onClick:()=>{(0,cr.kz)(o,(e=>{e[r].backgroundImage=Xq}))}}),Yq("input",{className:"ThemeEditor-BackgroundCustomButton",type:"button",value:(0,B.Z)("Select Image..."),onClick:()=>{se.Z.utilities.selectLocalImage({windowId:this.context.vivaldiWindowId,title:(0,B.Z)("Select Background Image"),themeId:e.id})}})]})),"color"===this.state.backgroundType&&e.backgroundImage&&e.colorWindowBg&&Yq("div",{className:"ThemeEditor-BackgroundMetaInfoBar"},void 0,Yq("span",{},void 0,(0,B.Z)("This theme has a background image set that may obscure the color.")),Yq("input",{type:"button",value:(0,B.Z)("Clear Image"),onClick:()=>{(0,cr.kz)(o,(e=>{e[r].backgroundImage=""}))}}))),Yq("div",{className:"ThemeEditor-Background"},void 0,Yq("div",{className:"ThemeEditor-BackgroundList"},void 0,"color"===this.state.backgroundType&&(0,ss.jsxs)(ss.Fragment,{children:[Yq("button",{className:Fi()("selectbox",{"selectbox-selected":!e.colorWindowBg}),onClick:()=>{(0,cr.kz)(o,(e=>{e[r].colorWindowBg=""}))}},void 0,Yq("div",{className:"selectbox-image",style:{backgroundColor:e.colorBg},dangerouslySetInnerHTML:{__html:Wi.D7r.medium}}),Yq("div",{className:"selectbox-title"},void 0,(0,B.Z)("No color"))),Object.keys(Jq).map((t=>Yq("button",{className:Fi()("selectbox",{"selectbox-selected":t===e.colorWindowBg}),onClick:e=>{(0,cr.kz)(o,(e=>{e[r].colorWindowBg=t}))}},t,Yq("div",{className:"selectbox-image",style:{backgroundColor:t},dangerouslySetInnerHTML:{__html:Wi.D7r.medium}}),Yq("div",{className:"selectbox-title"},void 0,Jq[t]))))]}),"image"===this.state.backgroundType&&(0,ss.jsxs)(ss.Fragment,{children:[Yq("button",{className:Fi()("selectbox",{"selectbox-selected":!e.backgroundImage}),onClick:e=>{(0,cr.kz)(o,(e=>{e[r].backgroundImage=""}))}},void 0,Yq("div",{className:"selectbox-image",style:{backgroundColor:e.colorWindowBg},dangerouslySetInnerHTML:{__html:Wi.D7r.medium}}),Yq("div",{className:"selectbox-title"},void 0,(0,B.Z)("No image"))),Object.keys(d).map((t=>Yq("button",{className:Fi()("selectbox",{"selectbox-selected":t===e.backgroundImage}),onClick:e=>{(0,cr.kz)(o,(e=>{e[r].backgroundImage=t}))}},t,Yq("div",{className:"selectbox-image",style:{backgroundImage:`url(${t})`},dangerouslySetInnerHTML:{__html:Wi.D7r.medium}}),Yq("div",{className:"selectbox-title"},void 0,d[t]))))]})))),Yq("div",{id:this.settingsId,label:(0,B.Z)("Settings")},void 0,Yq("div",{className:"TabbedView--Padded"},void 0,Yq("div",{className:"setting-group"},void 0,Yq("div",{className:"setting-single"},void 0,Yq("h3",{},void 0,(0,B.Z)("Transparency")),Yq(cB,{min:0,max:.25,step:.01,value:1-e.alpha,onChange:e=>{nJ(o,(t=>{t[r].alpha=parseFloat((1-Number(e.currentTarget.value)).toFixed(2))}))},label:`${Math.round(100*(1-e.alpha))}%`}),Yq("p",{className:"info pad-zero"},void 0,(0,B.Z)("Adjust Panel transparency level."))),Yq("div",{className:"setting-single pad-top"},void 0,Yq("label",{},void 0,Yq("input",{type:"checkbox",checked:e.transparencyTabBar,onChange:e=>{(0,cr.kz)(o,(t=>{t[r].transparencyTabBar=e.target.checked}))}}),Yq("span",{},void 0,(0,B.Z)("Transparent Tab Bar")))),Yq("div",{className:"setting-single"},void 0,Yq("label",{},void 0,Yq("input",{type:"checkbox",checked:e.transparencyTabs,onChange:e=>{(0,cr.kz)(o,(t=>{t[r].transparencyTabs=e.target.checked}))}}),Yq("span",{},void 0,(0,B.Z)("Transparent Background Tabs"))))),Yq("div",{className:"setting-group"},void 0,Yq("div",{className:"setting-single"},void 0,Yq("h3",{},void 0,(0,B.Z)("Blur")),Yq(cB,{min:0,max:10,step:1,value:e.blur,onChange:e=>{nJ(o,(t=>{t[r].blur=Number(e.target.value)}))}}),Yq("p",{className:"info pad-zero"},void 0,(0,B.Z)("Apply blur effect to image in Panel and Tab Bar background."))),Yq("div",{className:"setting-single pad-top"},void 0,Yq("h3",{},void 0,(0,B.Z)("Corner Rounding")),Yq(cB,{min:-1,max:14,value:e.radius,onChange:e=>{nJ(o,(t=>{t[r].radius=Number(e.target.value)}))},label:-1===e.radius?(0,B.Z)("Disabled"):e.radius.toString()}))))),Yq("div",{id:this.buttonsId,label:(0,B.Z)("Icons")},void 0,Yq(Mq,{themeId:e.id,themePref:o,prefValues:s})))))}}const oJ=(0,Bu.Z)(sJ,Qq);var aJ;function rJ(e,t,n,i){aJ||(aJ="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:aJ,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const lJ=[I.kThemeScheduleEnabled,I.kThemeScheduleOS,I.kThemeScheduleTimeline,I.kThemesSystem,I.kThemesUser],dJ=w.Z.getEventHandler,cJ=["colorFg","colorBg","colorBgDark","colorBgIntense","colorBorderIntense","colorAccentBg"];var uJ=rJ("hr",{});class pJ extends Li.PureComponent{static contextType=ts.Z;refScheduleTimeline=Li.createRef();constructor(e){super(e),this.state={dragging:!1,now:new Date,selectedScheduleId:e.prefValues[I.kThemeScheduleTimeline][0].id}}componentDidMount(){this.context.addEventListener("pointerup",this.stopPointerReschedule),this.timer=setInterval(this.updateNow,6e4)}componentWillUnmount(){clearInterval(this.timer),this.context.removeEventListener("pointerup",this.stopPointerReschedule)}updateNow=()=>{this.setState({now:new Date})};startPointerReschedule=(e,t)=>{t.persist(),t.preventDefault(),this.setState({dragging:!0,selectedScheduleId:e},(()=>{this.handlePointerReschedule(t)}))};pointerReschedule=e=>{e.preventDefault(),this.state.dragging&&this.handlePointerReschedule(e)};stopPointerReschedule=()=>{if(this.state.dragging){this.setState({dragging:!1});const e=Cs.ZP.getTimerByDate(new Date,"current");e&&ki.Z.setTheme(e.themeId)}};handlePointerReschedule=e=>{const t=this.refScheduleTimeline.current?.getBoundingClientRect()??{left:0,width:0},n=e.clientX-t.left,i=5*Math.floor(1439/t.width*n/5);i<0||i>1439||(0,cr.kz)(I.kThemeScheduleTimeline,(e=>{const t=e.findIndex((e=>e.id===this.state.selectedScheduleId));e[t].hours=Math.floor(i/60),e[t].minutes=i-60*e[t].hours}))};addSchedule=()=>{const e=this.props.prefValues[I.kThemeScheduleTimeline],t=crypto.randomUUID();w.Z.set(I.kThemeScheduleTimeline,[...e,{id:t,minutes:0,hours:12,themeId:Cs.ZP.getDefaultTheme().id,undeletable:!1}]),this.setState({selectedScheduleId:t})};removeSelectedScheduleOnDelete=e=>{["KeyCode.KEY_BACK_SPACE","KeyCode.KEY_DELETE"].includes(e.keyCode)&&this.removeSelectedSchedule()};handleKeyboardReschedule=(e,t)=>{if([xa.Z.KEY_LEFT,xa.Z.KEY_RIGHT].includes(t.keyCode)){(0,cr.kz)(I.kThemeScheduleTimeline,(n=>{const i=n.findIndex((t=>t.id===e));let s=60*n[i].hours+n[i].minutes;t.shiftKey?t.keyCode===xa.Z.KEY_LEFT&&s>29?s-=30:t.keyCode===xa.Z.KEY_RIGHT&&s<1409&&(s+=30):t.keyCode===xa.Z.KEY_LEFT&&s>4?s-=5:t.keyCode===xa.Z.KEY_RIGHT&&s<1434&&(s+=5),n[i].hours=Math.floor(s/60),n[i].minutes=s-60*n[i].hours}))&&this.setState({selectedScheduleId:e})}else[xa.Z.KEY_BACK_SPACE,xa.Z.KEY_DELETE].includes(t.keyCode)&&this.removeSelectedSchedule()};removeSelectedSchedule=()=>{(0,cr.kz)(I.kThemeScheduleTimeline,(e=>{const t=e.findIndex((e=>e.id===this.state.selectedScheduleId));e[t].undeletable||e.splice(t,1)}))&&this.setState({selectedScheduleId:void 0})};updateOSTheme=e=>{const t=this.props.prefValues[I.kThemeScheduleOS];w.Z.set(I.kThemeScheduleOS,{...t,[e.target.name]:e.target.value})};indicatorFocus=(e,t)=>{t.stopPropagation(),this.setState({selectedScheduleId:e})};indicatorBlur=()=>{this.setState({selectedScheduleId:void 0})};render(){const e=[...this.props.prefValues[I.kThemeScheduleTimeline]],t=this.state.now,n=(t.getMinutes()+60*t.getHours())/14.4+"%",{prefValues:i}=this.props,s=i[I.kThemesSystem].concat(i[I.kThemesUser]).sort(((e,t)=>e.name.localeCompare(t.name))),o="timeline"!==i[I.kThemeScheduleEnabled],a="system"!==i[I.kThemeScheduleEnabled],r=!1===e.find((e=>e.id===this.state.selectedScheduleId))?.undeletable;return e.sort(((e,t)=>60*e.hours+e.minutes-(60*t.hours+t.minutes))),e.unshift(e[e.length-1]),rJ(tN.Z,{categoryTitle:(0,B.Z)("Theme Schedule"),className:"setting-group unlimited",filter:this.props.filter,onPointerMove:this.pointerReschedule},void 0,rJ("div",{className:"setting-group-double"},void 0,rJ("div",{className:"setting-single"},void 0,rJ("label",{},void 0,rJ("input",{type:"radio",value:"off",checked:"off"===i[I.kThemeScheduleEnabled],onChange:dJ(I.kThemeScheduleEnabled)}),rJ("span",{},void 0,(0,B.Z)("No Schedule")))),rJ("div",{className:"setting-single pad-top"},void 0,rJ("label",{},void 0,rJ("input",{type:"radio",value:"system",checked:"system"===i[I.kThemeScheduleEnabled],onChange:dJ(I.kThemeScheduleEnabled)}),rJ("span",{},void 0,(0,B.Z)("Operating System")))),rJ("div",{className:"setting-single"},void 0,rJ("label",{},void 0,rJ("span",{},void 0,(0,B.Z)("theme","Light")),rJ(ta.Z,{name:"light",value:i[I.kThemeScheduleOS].light,disabled:a,onChange:this.updateOSTheme},void 0,s.map((e=>rJ("option",{value:e.id},e.id,e.name)))))),rJ("div",{className:"setting-single"},void 0,rJ("label",{},void 0,rJ("span",{},void 0,(0,B.Z)("theme","Dark")),rJ(ta.Z,{name:"dark",value:i[I.kThemeScheduleOS].dark,disabled:a,onChange:this.updateOSTheme},void 0,s.map((e=>rJ("option",{value:e.id},e.id,e.name)))))),rJ("div",{className:"setting-single"},void 0,rJ("label",{},void 0,rJ("input",{type:"radio",value:"timeline",checked:"timeline"===i[I.kThemeScheduleEnabled],onChange:dJ(I.kThemeScheduleEnabled)}),rJ("span",{},void 0,(0,B.Z)("Manual Schedule"))))),(0,ss.jsxs)("div",{className:"theme-schedule-timeline"+(o?" schedule-disabled":""),ref:this.refScheduleTimeline,children:[!o&&rJ("span",{className:"theme-schedule-now-indicator",style:{left:n}},void 0,(0,B.Z)("Now")),e.map(((t,n)=>{const i=0===n?0:(60*t.hours+t.minutes)/14.4,a=e[n+1],r=a?60*a.hours+a.minutes:1440,l=String(t.hours).padStart(2,"0"),d=String(t.minutes).padStart(2,"0"),{name:c}=Cs.ZP.getThemeWithFallback(t.themeId),u=Be.Z.getBaseStylesByThemeId(t.themeId,cJ),p=this.state.selectedScheduleId===t.id;return rJ("div",{className:Fi()("theme-schedule-timeslice",{"timeslice-selected":!o&&p}),style:{width:r/14.4-i+"%",left:`${i}%`}},n,0!==n&&(0,ss.jsxs)(ss.Fragment,{children:[!o&&rJ("div",{title:c,className:"timeslice-bubble",onFocus:this.indicatorFocus.bind(this,t.id),onBlur:this.indicatorBlur,disabled:o,onPointerDown:e=>this.startPointerReschedule(t.id,e),onKeyDown:this.handleKeyboardReschedule.bind(this,t.id)},void 0,rJ("div",{},void 0,`${l}:${d}`)),rJ("div",{className:"theme-schedule-timeslice-indicator"},void 0,rJ("input",{type:"button",className:"theme-schedule-timeslice-draghandle",title:c,onFocus:this.indicatorFocus.bind(this,t.id),onBlur:this.indicatorBlur,disabled:o,onPointerDown:e=>this.startPointerReschedule(t.id,e),onKeyDown:this.handleKeyboardReschedule.bind(this,t.id)}))]}),rJ("select",{disabled:o,value:t.themeId,style:u,title:c,onFocus:this.indicatorFocus.bind(this,t.id),onKeyDown:this.removeSelectedScheduleOnDelete,onChange:e=>{return n=t.id,i=e.target.value,void(0,cr.kz)(I.kThemeScheduleTimeline,(e=>{const t=e.findIndex((e=>e.id===n));-1!==t&&(e[t].themeId=i)}));var n,i}},void 0,s.map((e=>rJ("option",{value:e.id},e.id,e.name)))))}))]}),rJ("div",{className:"toolbar toolbar-default toolbar-group"},void 0,rJ("div",{className:"toolbar-group"},void 0,rJ(po.ZP,{disabled:o,onClick:this.addSchedule,image:Wi.md4.medium,title:(0,B.Z)("Add")}),uJ,rJ(po.ZP,{disabled:o||!r||void 0===this.state.selectedScheduleId,onClick:this.removeSelectedSchedule,image:Wi.M2k.medium,title:(0,B.Z)("other","Remove")}))))}}const hJ=(0,Bu.Z)(pJ,lJ);var gJ,mJ=n(97899),fJ=n(8959);function vJ(e,t,n,i){gJ||(gJ="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:gJ,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const yJ=w.Z.getEventHandler,bJ=[I.kSystemAccentColor,I.kThemeScheduleEnabled,I.kThemeScheduleOS,I.kThemeScheduleTimeline,I.kThemesCurrent,I.kThemesCurrentButtons,I.kThemesCurrentPrivate,I.kThemesPreferCustomButtons,I.kThemesPreview,I.kThemesSystem,I.kThemesUser];const SJ=crypto.randomUUID(),wJ=crypto.randomUUID();function CJ(e){const{value:t}=e.currentTarget;"none"===t?w.Z.reset(I.kThemesCurrentButtons):w.Z.set(I.kThemesCurrentButtons,t)}var AJ=vJ("div",{className:"ThemePreview-Label-Meta"}),IJ=vJ("hr",{});function TJ(e){const t=Li.useContext(ts.Z),i=(0,Ya.Z)(bJ),[s,o]=Li.useState(ki.Z.getCurrentIdWithoutPreview(t.vivaldiWindowId)),[a,r]=Li.useState(SJ),[l,d]=Li.useState(void 0),u=e=>{d(e)},p=()=>{d(void 0)},h=()=>{l&&ki.Z.deleteTheme(l),p()};function g(e){return vJ("div",{className:"TabbedView-Footer"},void 0,vJ("input",{type:"button",value:(0,B.Z)("Import Theme..."),onClick:()=>async function(e){ki.Z.clearThemePreview();const[t]=await e.showOpenFilePicker({multiple:!1,types:[{description:(0,B.Z)("Select Theme to Import"),accept:{"application/zip":[".zip"]}}]}),n=(0,mJ.Z)(await t.getFile()),i=new ReadableStream({pull:async e=>{const t=await n.next();if(t.done)return e.close();const{value:i}=t,{name:s}=i;let o;if(s.toLowerCase().endsWith(".svg")){const e=await i.arrayBuffer(),t=(0,Cs.tc)(e);o=()=>new ReadableStream({start:e=>{e.enqueue(t),e.close()}})}else o=()=>i.stream();return e.enqueue({name:s,stream:o})}}),s=i.pipeThrough(new fJ.Z).getReader(),o=[];let a=0;for(;;){const{done:e,value:t}=await s.read();if(e||!t)break;a+=t.byteLength,o.push(t)}const r=new Uint8Array(a);let l=0;for(const e of o)r.set(e,l),l+=e.byteLength;const{error:d}=await se.Z.themePrivate.import({dataBlob:r.buffer});if(d)throw new Error(`${d.kind} - ${d.details}`)}(t)}),vJ("input",{type:"button",value:(0,B.Z)("Export Theme..."),onClick:async()=>{const n=Cs.ZP.getThemeWithFallback(e);await ki.Z.exportTheme(n,t.vivaldiWindowId)}}),vJ("a",{className:"external-link",href:"https://themes.vivaldi.net",onClick:()=>c.ZP.openURL(t.vivaldiWindowId,"https://themes.vivaldi.net"),style:{margin:"auto 0 auto auto"}},void 0,(0,B.Z)("Get more themes"),vJ("span",{dangerouslySetInnerHTML:{__html:n(70942)}})))}const m=Cs.ZP.getSystemThemes(),f=m.concat(i[I.kThemesUser]),v=ki.Z.getCurrentIdWithoutPreview(t.vivaldiWindowId),y=Cs.ZP.getThemesWithButtons();return(0,ss.jsxs)(ss.Fragment,{children:[vJ(tN.Z,{filter:e.filter,categoryTitle:(0,B.Z)("Themes")},void 0,vJ(iA.Z,{filter:e.filter},void 0,vJ("p",{className:"info"},void 0,(0,B.Z)("Select any of the pre-installed themes, make your own in the Theme Editor, or head over to themes.vivaldi.net to download themes shared by the Vivaldi community.")),vJ(PV,{icons:[Wi.v5q.small,Wi.B$9.small],activeTabId:a,onTabClick:r,className:"ThemeEditor-Tabs-"+(a===SJ?"Library":"Editor")},void 0,vJ("div",{id:SJ,label:(0,B.Z)("Library")},void 0,vJ("div",{className:"TabbedView--Padded ThemePreviews"},void 0,l&&(()=>{const e=Cs.ZP.getThemeWithFallback(l).name;return vJ(ra.Z,{onRequestClose:p,className:"float",title:(0,B.Z)("Deleting “$1”",[e])},void 0,vJ("div",{className:"dialog-content"},void 0,vJ("p",{},void 0,(0,B.Z)("Do you want to permanently delete the “$1” theme?",[e]))),vJ("div",{className:"dialog-footer"},void 0,vJ("input",{type:"button",className:"danger",onClick:h,value:(0,B.Z)("Delete Theme")}),vJ("input",{type:"button",onClick:p,value:(0,B.Z)("Cancel")})))})(),f.map((e=>vJ("div",{onDoubleClick:()=>{r(wJ)}},e.id,vJ(zq,{isCurrent:e.id===v,isSystem:m.some((t=>t.id===e.id)),theme:e,themeChangeCallback:o,onConfirmDeletion:u})))),vJ("div",{className:"ThemePreview ThemePreview--New"},void 0,vJ("button",{onClick:e=>((e,t)=>{const n=t.currentTarget.closest(".settings-content");n&&n.scrollTop>150&&n.scrollTo({top:150,behavior:"smooth"}),o(ki.Z.createTheme(e)),r(wJ)})(v,e),className:"ThemePreview-Image",dangerouslySetInnerHTML:{__html:Wi.Clf}}),vJ("div",{className:"ThemePreview-Label"},void 0,(0,B.Z)("New Theme...")),AJ)),g(v)),vJ("div",{id:wJ,label:(0,B.Z)("Editor")},void 0,vJ("div",{className:"TabbedView--Padded"},void 0,vJ(oJ,{theme:Cs.ZP.getThemeWithFallback(s),isCurrent:s===v,isSystem:m.some((e=>e.id===s)),filter:e.filter,themeChangeCallback:o})),g(s||v))),vJ("div",{className:"Button-Set-Picker setting-group unlimited pad-top"},void 0,vJ("div",{className:"setting-single"},void 0,vJ("label",{},void 0,vJ("input",{type:"checkbox",checked:i[I.kThemesPreferCustomButtons],onChange:yJ(I.kThemesPreferCustomButtons),disabled:!y.length}),vJ("span",{},void 0,(0,B.Z)("Use Icon Set"))),y.length>0&&vJ("label",{},void 0,vJ("span",{},void 0,(0,B.Z)("other","from")),vJ(ta.Z,{defaultValue:i[I.kThemesCurrentButtons],onChange:CJ,disabled:!i[I.kThemesPreferCustomButtons]},void 0,vJ("option",{value:"none"},void 0,(0,B.Z)("Currently Active Theme")),IJ,y.map((e=>vJ("option",{value:e.id},e.id,e.name)))))),vJ("p",{className:"info"},void 0,(0,B.Z)("Disable setting to always use default Vivaldi icon set. Or select a theme to apply its icon set to all other themes."))))),vJ(tN.Z,{categoryTitle:(0,B.Z)("Private Window Theme"),filter:e.filter},void 0,vJ("div",{className:"setting-single setting-single--LeadingText"},void 0,vJ("label",{},void 0,vJ("span",{},void 0,(0,B.Z)("Select theme for Private Windows")),vJ(ta.Z,{value:i[I.kThemesCurrentPrivate],onChange:e=>w.Z.set(I.kThemesCurrentPrivate,e.currentTarget.value)},void 0,f.map((e=>vJ("option",{value:e.id},e.id,e.name))))))),vJ(hJ,{filter:e.filter})]})}const ZJ=Li.memo(TJ);var EJ;function kJ(e,t,n,i){EJ||(EJ="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:EJ,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const _J=[...fq,...Cq,...bJ];function NJ({filter:e,category:t}){const n=sN({filter:e,prefPaths:_J,name:t.title});return(0,ss.jsxs)(ss.Fragment,{children:[kJ("section",{className:"setting-section"},void 0,kJ(ZJ,{filter:e})),kJ("section",{className:"setting-section"},void 0,kJ(Tq,{filter:e}),kJ(yq,{filter:e})),n]})}const PJ=Li.memo(NJ);var DJ,MJ=n(85619);function OJ(e,t,n,i){DJ||(DJ="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:DJ,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const xJ=[I.kWebpagesCaptureDirectory,I.kWebpagesCaptureSaveFilePattern],LJ=w.Z.getEventHandler,RJ=new Date,BJ="139cea89-3ed1-4ccd-bd3c-7a6a36f824d5",FJ=[{tag:"$timestamp",title:(0,B.Z)("Long date"),format:"YYYY-MM-DD HH.mm.ss"},{tag:"$year",title:(0,B.Z)("Year"),format:"YYYY"},{tag:"$month",title:(0,B.Z)("Month"),format:"MM"},{tag:"$day",title:(0,B.Z)("Day"),format:"DD"},{tag:"$hour",title:(0,B.Z)("Hour"),format:"HH"},{tag:"$minute",title:(0,B.Z)("Minute"),format:"mm"},{tag:"$second",title:(0,B.Z)("time","Second"),format:"ss"},{tag:"$ms",title:(0,B.Z)("Millisecond"),format:"SSS"},{tag:"$longid",title:(0,B.Z)("Unique ID"),value:BJ},{tag:"$shortid",title:(0,B.Z)("Short unique ID"),value:BJ.substring(24)},{tag:"$host",title:(0,B.Z)("Active tab host name"),value:"example.com"},{tag:"$title",title:(0,B.Z)("Active tab title"),value:(0,B.Z)("Example Page Title")}];function WJ(e){const t=(0,Ya.Z)(xJ),n=Li.useContext(ts.Z),i=Li.useRef(),s=e=>{const{dataTransfer:t,target:n}=e;t.setData("text/plain",n.innerText),t.dropEffect="none",t.effectAllowed="copyMove",t.setDragImage(n,0,0)},o=e=>{const{HTMLInputElement:t}=n,{target:s}=e;let o=s.innerText;if(i.current instanceof t){const e=i.current.selectionStart,t=i.current.value||"";o=" "+o+" ";let n=e>0?t.substr(0,e)+o+t.substr(e):t+o;n=n.replace(/ {2}/g," ").trim(),w.Z.set(I.kWebpagesCaptureSaveFilePattern,n),i.current&&i.current.focus()}};return OJ(tN.Z,{categoryTitle:(0,B.Z)("Image Capture"),filter:e.filter},void 0,OJ("div",{className:"setting-group"},void 0,OJ("div",{className:"setting-single"},void 0,OJ("h3",{},void 0,(0,B.Z)("Capture Storage Folder")),OJ("div",{className:"setting-single folder-selection"},void 0,OJ("input",{type:"text",value:t[I.kWebpagesCaptureDirectory],title:(0,B.Z)("Enter capture storage folder"),spellCheck:"false",onChange:LJ(I.kWebpagesCaptureDirectory)}),OJ("input",{type:"button",value:(0,B.Z)("Select Folder..."),onClick:()=>{se.Z.utilities.selectFile({windowId:n.vivaldiWindowId,title:(0,B.Z)("Select Capture Folder"),type:"folder"}).then((e=>{e&&w.Z.set(I.kWebpagesCaptureDirectory,e)}))}})))),OJ("div",{className:"setting-group"},void 0,OJ("div",{className:"setting-single capture-name-template"},void 0,OJ("h3",{},void 0,(0,B.Z)("Capture File Name Template")),(0,ss.jsx)("input",{type:"text",ref:i,onDragEnter:e=>{const{dataTransfer:t,target:n}=e;n&&t.types.includes("text/plain")&&(n.setSelectionRange(n.value.length,n.value.length),n.focus())},value:t[I.kWebpagesCaptureSaveFilePattern],title:(0,B.Z)("Modify file name template"),spellCheck:"false",onChange:LJ(I.kWebpagesCaptureSaveFilePattern)}),OJ("p",{className:"info"},void 0,(()=>{let e=t[I.kWebpagesCaptureSaveFilePattern];return FJ.forEach((t=>{const n=new RegExp((0,MJ.Z)(t.tag),"gi"),i=t.format?W()(RJ).format(t.format):t.value;e=e.replace(n,i)})),(e||BJ)+".png"})()),OJ("p",{className:"info"},void 0,FJ.map(((e,t)=>OJ("span",{draggable:"true",onDoubleClick:o,onDragStart:s,title:e.title+(e.format?" ("+e.format+")":"")},t,e.tag)))),OJ("input",{type:"button",value:(0,B.Z)("Restore Default"),onClick:()=>{w.Z.reset(I.kWebpagesCaptureSaveFilePattern)}}))))}const UJ=Li.memo(WJ);var VJ;function HJ(e,t,n,i){VJ||(VJ="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:VJ,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const GJ={standard:{localizedFamily:(0,B.Z)("Standard")},sansserif:{localizedFamily:(0,B.Z)("Sans-serif")},serif:{localizedFamily:(0,B.Z)("Serif")},fixed:{localizedFamily:(0,B.Z)("Monospaced")},cursive:{localizedFamily:(0,B.Z)("Cursive")},fantasy:{localizedFamily:(0,B.Z)("Fantasy")}},$J=[9,10,11,12,13,14,16,18,20,24],KJ=[0,4,6,7,8,...$J],zJ=[I.kWebKitDefaultFontSize,I.kWebKitMinimumFontSize],jJ=w.Z.getEventHandler,YJ=[...zJ,I.kWebKitCursiveFontFamily,I.kWebKitFantasyFontFamily,I.kWebKitFixedFontFamily,I.kWebKitSansSerifFontFamily,I.kWebKitSerifFontFamily,I.kWebKitStandardFontFamily];function XJ(e,t){return Object.keys(e).map((n=>t(n,e[n])))}function QJ(e){const t=(0,Ya.Z)(zJ),[n,s]=Li.useState([]),[o,a]=Li.useState({}),r=Li.useRef(new Set);Li.useEffect((()=>(i.Z.fontSettings.onFontChanged.addListener(l),i.Z.fontSettings.getFontList((e=>{r.current=new Set(e.map((e=>e.fontId))),s(e)})),XJ(GJ,((e,t)=>{i.Z.fontSettings.getFont({genericFamily:e},(n=>{a((i=>({...i,[e]:{font:n.fontId,localizedFamily:t.localizedFamily}})))}))})),()=>i.Z.fontSettings.onFontChanged.removeListener(l))),[]);const l=e=>{a((t=>({...t,[e.genericFamily]:{font:e.fontId,localizedFamily:GJ[e.genericFamily].localizedFamily}})))},d=e=>{const n="default"===e?parseInt(t[I.kWebKitDefaultFontSize]):parseInt(t[I.kWebKitMinimumFontSize]),i="default"===e?$J:KJ;return i.includes(n)||(i.push(n),i.sort(((e,t)=>e-t))),i.map((e=>HJ("option",{},e,e)))},c=n.map((e=>HJ("option",{value:e.fontId},e.fontId,e.displayName)));return HJ(tN.Z,{categoryTitle:(0,B.Z)("Fonts"),filter:e.filter,className:"setting-group unlimited"},void 0,HJ("div",{className:"setting-group-double font-slider"},void 0,HJ("label",{},void 0,HJ("span",{},void 0,(0,B.Z)("Default Font Size")),HJ("span",{className:"fake-dataset"},void 0,HJ("input",{type:"number",min:"6",max:"99",value:t[I.kWebKitDefaultFontSize],onChange:jJ(I.kWebKitDefaultFontSize)}),HJ(ta.Z,{value:t[I.kWebKitDefaultFontSize],onChange:jJ(I.kWebKitDefaultFontSize)},void 0,d("default")))),HJ("label",{},void 0,HJ("span",{},void 0,(0,B.Z)("Minimum Font Size")),HJ("span",{className:"fake-dataset"},void 0,HJ("input",{type:"number",min:"0",max:"99",value:t[I.kWebKitMinimumFontSize],onChange:jJ(I.kWebKitMinimumFontSize)}),HJ(ta.Z,{value:t[I.kWebKitMinimumFontSize],onChange:jJ(I.kWebKitMinimumFontSize)},void 0,d("minimum"))))),HJ("div",{className:"setting-group-double pad-top font-face-list"},void 0,HJ("h3",{},void 0,(0,B.Z)("Default Fonts")),XJ(o,((e,t)=>{const{font:n,localizedFamily:i}=t,s=void 0===n||r.current?.has(n)?"":HJ("option",{value:n},n,(0,B.Z)("Fallback for “$1”",[n]));return HJ("label",{className:"setting-single"},e,HJ("span",{},void 0,i),HJ(ta.Z,{onChange:t=>((e,t)=>{const n=t.target.value;switch(e){case"standard":default:w.Z.set(I.kWebKitStandardFontFamily,n);break;case"fantasy":w.Z.set(I.kWebKitFantasyFontFamily,n);break;case"fixed":w.Z.set(I.kWebKitFixedFontFamily,n);break;case"sansserif":w.Z.set(I.kWebKitSansSerifFontFamily,n);break;case"serif":w.Z.set(I.kWebKitSerifFontFamily,n);break;case"cursive":w.Z.set(I.kWebKitCursiveFontFamily,n)}})(e,t),value:n},void 0,s,c))}))))}const qJ=Li.memo(QJ);var JJ;function e0(e,t,n,i){JJ||(JJ="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:JJ,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const t0=w.Z.getEventHandler,n0=[I.kWebpagesReaderAllowVertical,I.kWebpagesReaderControls,I.kWebpagesReaderStyle],i0=["ja","ja-KS","ko","zh-CN","zh-TW"].includes(navigator.language),s0={min:.5,max:4,step:.1},o0={min:1,max:2,step:.1},a0={min:20,max:100,step:2};var r0=e0("hr",{}),l0=e0("hr",{}),d0=e0("hr",{}),c0=e0("hr",{}),u0=e0("hr",{}),p0=e0("hr",{});function h0(e){const t=Li.useContext(ts.Z),n=Li.useRef(null),i=(0,Ya.Z)(n0),[s,o]=Li.useState(!1),[a,r]=Li.useState(String(Be.Z.getReaderThemeColor(t.vivaldiWindowId)["--colorFg"]));Li.useEffect((()=>{function e(){r(String(Be.Z.getReaderThemeColor(t.vivaldiWindowId)["--colorFg"]))}return Be.Z.addListener(e),()=>Be.Z.removeListener(e)}),[t.vivaldiWindowId]);const l=e=>()=>{g({themeStyle:e})},d=e=>()=>{g({fontFamily:e})},c=e=>()=>{const t=i[I.kWebpagesReaderStyle],{step:n}=o0,s=(t.lineHeight+("increment"===e?n:-n)).toFixed(1);g({lineHeight:parseFloat(s)})},u=e=>()=>{const t=i[I.kWebpagesReaderStyle],{step:n}=s0,s=(t.fontSize+("increment"===e?n:-n)).toFixed(1);g({fontSize:parseFloat(s)})},p=e=>()=>{const t=i[I.kWebpagesReaderStyle],{step:n}=a0;g({width:t.width+("increment"===e?n:-n)})},h=e=>()=>{g({writingMode:e})},g=(0,aC.Z)((e=>{w.Z.set(I.kWebpagesReaderStyle,{...i[I.kWebpagesReaderStyle],...e}),si.Z.setReaderModeStyle(t.vivaldiWindowId)}),300,{leading:!0,trailing:!0}),m=()=>{o((e=>!e))},f=i[I.kWebpagesReaderAllowVertical],v=i[I.kWebpagesReaderStyle],y="vertical-rl"===v.writingMode;if(e.prefs&&v){const n=(0,ss.jsxs)(ss.Fragment,{children:[e0("h2",{},void 0,(0,B.Z)("Reader")),e0("div",{className:"setting-group-unlimited"},void 0,e0("div",{className:"setting-single"},void 0,e0("label",{},void 0,e0("input",{type:"checkbox",checked:i[I.kWebpagesReaderControls],onChange:t0(I.kWebpagesReaderControls)}),e0("span",{},void 0,(0,B.Z)("Display Settings on Page in Reader")))),!i0&&e0("div",{className:"setting-single"},void 0,e0("label",{},void 0,e0("input",{type:"checkbox",checked:f,onChange:t0(I.kWebpagesReaderAllowVertical)}),e0("span",{},void 0,(0,B.Z)("Allow Vertical Text Direction"))))),e0("div",{className:"setting-group pad-top"},void 0,e0("div",{className:"setting-single"},void 0,e0("h3",{},void 0,(0,B.Z)("Font Face")),e0("div",{className:"toolbar toolbar-default"},void 0,e0("div",{className:"toolbar toolbar-group"},void 0,e0(po.ZP,{title:(0,B.Z)("Sans-serif"),image:Wi.g4W.medium,isPressed:"sans-serif"===v.fontFamily,onClick:d("sans-serif")}),r0,e0(po.ZP,{title:(0,B.Z)("Serif"),image:Wi.USP.medium,isPressed:"serif"===v.fontFamily,onClick:d("serif")})))),e0("div",{className:"setting-single"},void 0,e0("h3",{},void 0,(0,B.Z)("Font Size")),e0(cB,{label:Math.round(100*v.fontSize)+" %",value:v.fontSize,min:s0.min,max:s0.max,step:s0.step,onChange:e=>g({fontSize:Number(e.currentTarget.value)})})),e0("div",{className:"setting-single"},void 0,e0("h3",{},void 0,(0,B.Z)("Line Height")),e0(cB,{value:v.lineHeight,min:o0.min,max:o0.max,step:o0.step,onChange:e=>g({lineHeight:Number(e.currentTarget.value)})})),e0("div",{className:"setting-single"},void 0,e0("h3",{},void 0,(0,B.Z)("Column Width")),e0(cB,{value:v.width,min:a0.min,max:a0.max,step:a0.step,onChange:e=>g({width:Number(e.currentTarget.value)})})),e0("div",{className:"setting-single"},void 0,e0("input",{type:"button",value:(0,B.Z)("Reset to Defaults"),onClick:()=>si.Z.resetReaderModeStyle(t.vivaldiWindowId)}))),e0("div",{className:"setting-group pad-top"},void 0,e0("div",{className:"setting-single"},void 0,e0("h3",{},void 0,(0,B.Z)("Color Scheme")),e0("div",{className:"toolbar toolbar-default"},void 0,e0("div",{className:"toolbar toolbar-group"},void 0,e0(po.ZP,{title:(0,B.Z)("other","Light"),image:Wi.XQw.medium,onClick:l("light"),isPressed:"light"===v.themeStyle,buttonStyle:{"--kIconCircleFill":"#f6f6f6","--kIconCircleStroke":"var(--colorFg)"}}),l0,e0(po.ZP,{title:(0,B.Z)("other","Dark"),image:Wi.XQw.medium,onClick:l("dark"),isPressed:"dark"===v.themeStyle,buttonStyle:{"--kIconCircleFill":"#111111","--kIconCircleStroke":"var(--colorFg)"}}),d0,e0(po.ZP,{title:(0,B.Z)("other","Theme"),image:Wi.XQw.medium,isPressed:"theme"===v.themeStyle,onClick:l("theme"),buttonStyle:{"--kIconCircleFill":"var(--colorBgLight)","--kIconCircleStroke":"var(--colorHighlightBg)"}})))),(i0||f)&&e0("div",{className:"setting-single"},void 0,e0("h3",{},void 0,(0,B.Z)("Text Direction")),e0("div",{className:"toolbar toolbar-default"},void 0,e0("div",{className:"toolbar toolbar-group"},void 0,e0(po.ZP,{tooltip:(0,B.Z)("Horizontal Text"),title:(0,B.Z)("title","Horizontal"),onClick:h("unset"),isPressed:"vertical-rl"!==v.writingMode,image:Wi.weK,disabled:!(i0||f)}),e0(po.ZP,{tooltip:(0,B.Z)("Vertical Text"),title:(0,B.Z)("title","Vertical"),isPressed:"vertical-rl"===v.writingMode,onClick:h("vertical-rl"),image:Wi.lIQ,disabled:!(i0||f)})))))]});return(0,yr.ZP)(n,e.filter)}return(0,ss.jsxs)(ss.Fragment,{children:[e0(EI.Z,{classNames:"reader-toolbar",in:s,mountOnEnter:!0,unmountOnExit:!0,timeout:{enter:300,exit:150},nodeRef:n},"toolbar",(0,ss.jsxs)("div",{ref:n,className:"toolbar toolbar-default reader-toolbar",children:[e0("div",{className:"toolbar-group"},void 0,e0(po.ZP,{tooltip:(0,B.Z)("Sans-serif"),image:Wi.g4W.medium,isPressed:"sans-serif"===v.fontFamily,onClick:d("sans-serif")}),e0(po.ZP,{tooltip:(0,B.Z)("Serif"),image:Wi.USP.medium,buttonStyle:{fontFamily:"serif"},isPressed:"serif"===v.fontFamily,onClick:d("serif")})),e0("div",{className:"toolbar-group"},void 0,e0(po.ZP,{className:"decrease-font-size",tooltip:(0,B.Z)("Decrease font size"),image:Wi.g4W.medium,disabled:!(i[I.kWebpagesReaderStyle].fontSize>s0.min),onClick:u("decrement")}),c0,e0(po.ZP,{className:"increase-font-size",tooltip:(0,B.Z)("Increase font size"),image:Wi.g4W.medium,disabled:!(i[I.kWebpagesReaderStyle].fontSize<s0.max),onClick:u("increment")})),e0("div",{className:"toolbar-group"},void 0,e0(po.ZP,{className:y?"button-rotateimage":"",tooltip:(0,B.Z)("Tighten line spacing"),disabled:!(i[I.kWebpagesReaderStyle].lineHeight>o0.min),onClick:c("decrement"),image:Wi.sss}),u0,e0(po.ZP,{className:y?"button-rotateimage":"",tooltip:(0,B.Z)("Loosen line spacing"),disabled:!(i[I.kWebpagesReaderStyle].lineHeight<o0.max),onClick:c("increment"),image:Wi.zDC})),e0("div",{className:"toolbar-group"},void 0,e0(po.ZP,{className:y?"button-rotateimage":"",tooltip:(0,B.Z)("Shrink column"),disabled:!(i[I.kWebpagesReaderStyle].width>a0.min),onClick:p("decrement"),image:Wi.Gpq}),p0,e0(po.ZP,{className:y?"button-rotateimage":"",tooltip:(0,B.Z)("Grow column"),disabled:!(i[I.kWebpagesReaderStyle].width<a0.max),onClick:p("increment"),image:Wi.Fib})),(i0||f)&&e0("div",{className:"toolbar-group"},void 0,e0(po.ZP,{tooltip:(0,B.Z)("Horizontal Text"),isPressed:"vertical-rl"!==v.writingMode,onClick:h("unset"),image:Wi.weK}),e0(po.ZP,{tooltip:(0,B.Z)("Vertical Text"),isPressed:"vertical-rl"===v.writingMode,onClick:h("vertical-rl"),image:Wi.lIQ})),e0("div",{className:"toolbar-group"},void 0,e0(po.ZP,{tooltip:(0,B.Z)("other","Light"),image:Wi.XQw.medium,onClick:l("light"),isPressed:"light"===v.themeStyle,buttonStyle:{"--kIconCircleFill":"white","--kIconCircleStroke":"var(--colorFg)"}}),e0(po.ZP,{tooltip:(0,B.Z)("other","Dark"),image:Wi.XQw.medium,onClick:l("dark"),image:Wi.XQw.medium,isPressed:"dark"===v.themeStyle,buttonStyle:{"--kIconCircleFill":"black","--kIconCircleStroke":"var(--colorFg)"}}),e0(po.ZP,{tooltip:(0,B.Z)("other","Inherit Theme"),image:Wi.XQw.medium,isPressed:"theme"===v.themeStyle,onClick:l("theme"),buttonStyle:{"--kIconCircleFill":"var(--colorBgLight)","--kIconCircleStroke":"var(--colorHighlightBg)"}}))]})),e0(po.ZP,{buttonStyle:s?void 0:{fill:a},className:"reader-settings-toggle",onClick:m,tooltip:(0,B.Z)("Reader settings"),image:Wi.bqs.medium},"reader-settings-toggle")]})}const g0=Li.memo(h0);var m0;function f0(e,t,n,i){m0||(m0="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:m0,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const v0=[I.kPluginsAlwaysOpenPdfExternally,I.kPluginsWidevineEnabled],y0=w.Z.getEventHandler;function b0(e){const t=(0,Ya.Z)(v0);return f0(tN.Z,{categoryTitle:(0,B.Z)("Plugins"),filter:e.filter},void 0,f0("div",{className:"setting-group unlimited"},void 0,f0("div",{className:"setting-single"},void 0,f0("label",{},void 0,f0("input",{type:"checkbox",checked:!t[I.kPluginsAlwaysOpenPdfExternally],onChange:y0(I.kPluginsAlwaysOpenPdfExternally,"inverse")}),f0("span",{},void 0,(0,B.Z)("Enable Internal PDF Viewer")))),f0("div",{className:"setting-single"},void 0,f0("label",{},void 0,f0("input",{type:"checkbox",checked:t[I.kPluginsWidevineEnabled],onChange:y0(I.kPluginsWidevineEnabled)}),f0("span",{},void 0,(0,B.Z)("Enable Widevine Plugin"))))))}const S0=Li.memo(b0);var w0;function C0(e,t,n,i){w0||(w0="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:w0,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class A0 extends Li.PureComponent{state={zoom:1};#m=!1;componentDidMount(){this.#m=!0,se.Z.zoom.onDefaultZoomChanged.addListener(this._onDefaultZoomChanged),se.Z.zoom.getDefaultZoom(this._onDefaultZoomChanged)}componentWillUnmount(){this.#m=!1,se.Z.zoom.onDefaultZoomChanged.removeListener(this._onDefaultZoomChanged)}rangeCheck=e=>Math.min(Math.max(e,fw.VH),fw.oJ);_onDefaultZoomChanged=e=>{this.#m&&this.setState({zoom:this.rangeCheck(e)})};setZoomLevel=e=>{const t=this.rangeCheck(e);se.Z.zoom.setDefaultZoom(t)};render(){const{zoom:e}=this.state;return C0(gw.Z,{zoom:e,defaultZoomLevel:fw.XZ,scrolling:!0,inFooter:!1,maxLevel:fw.oJ,minLevel:fw.VH,step:fw.s5,disabled:!1,onZoomUpdated:this.setZoomLevel},"zoomslider")}}const I0=A0;var T0;function Z0(e,t,n,i){T0||(T0="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:T0,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const E0=[I.kMouseWheelPageZoom,I.kWebpagesTabZoomEnabled],k0=w.Z.getEventHandler;var _0=Z0("div",{className:"toolbar toolbar-default"},void 0,Z0(I0,{}));class N0 extends Li.Component{handleZoomUpdated=e=>{se.Z.zoom.setDefaultZoom(e)};render(){return Z0(iA.Z,{filter:this.props.filter},void 0,Z0("div",{className:"setting-group"},void 0,Z0("div",{className:"setting-single"},void 0,Z0("h3",{},void 0,(0,B.Z)("Default Webpage Zoom")),Z0("p",{className:"info"},void 0,(0,B.Z)("This affects all webpages with default zoom level.")),_0),Z0("div",{className:"setting-single pad-top"},void 0,Z0("label",{},void 0,Z0("input",{type:"checkbox",checked:this.props.prefValues[I.kMouseWheelPageZoom],onChange:k0(I.kMouseWheelPageZoom)}),Z0("span",{},void 0,(0,B.Z)("Use $1+Scroll to Zoom Page",["Ctrl"])))),Z0("div",{className:"setting-single"},void 0,Z0("label",{},void 0,Z0("input",{type:"checkbox",checked:this.props.prefValues[I.kWebpagesTabZoomEnabled],onChange:k0(I.kWebpagesTabZoomEnabled)}),Z0("span",{},void 0,(0,B.Z)("Use Tab Zoom"))),Z0("p",{className:"info"},void 0,(0,B.Z)("Retain zoom level when navigating between websites")))))}}const P0=(0,Bu.Z)(N0,E0);var D0;function M0(e,t,n,i){D0||(D0="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:D0,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const O0=[I.kWebpagesFullScreenShowBubble];O0.push(I.kWebpagesFullScreenHideMouse);const x0=w.Z.getEventHandler;class L0 extends Li.Component{render(){const e=M0("div",{className:"setting-single"},void 0,M0("label",{},void 0,M0("input",{type:"checkbox",checked:this.props.prefValues[I.kWebpagesFullScreenShowBubble],onChange:x0(I.kWebpagesFullScreenShowBubble)}),M0("span",{},void 0,(0,B.Z)("Show Fullscreen Reminder")))),t=M0("div",{className:"setting-single"},void 0,M0("label",{},void 0,M0("input",{type:"checkbox",checked:this.props.prefValues[I.kWebpagesFullScreenHideMouse],onChange:x0(I.kWebpagesFullScreenHideMouse)}),M0("span",{},void 0,(0,B.Z)("Hide the Mouse Cursor for Page-initiated Fullscreen"))));return M0(iA.Z,{filter:this.props.filter},void 0,M0("span",{},void 0,M0("div",{className:"setting-group"},void 0,M0("h3",{},void 0,(0,B.Z)("Fullscreen Mode")),e,t)))}}const R0=(0,Bu.Z)(L0,O0);var B0;function F0(e,t,n,i){B0||(B0="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:B0,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const W0=[I.kHardwareAccelerationModeEnabled],U0=w.Z.getEventHandler;class V0 extends Li.Component{render(){return F0(iA.Z,{filter:this.props.filter},void 0,F0("div",{className:"setting-group unlimited"},void 0,F0("div",{className:"setting-single"},void 0,F0("label",{},void 0,F0("input",{type:"checkbox",checked:this.props.prefValues[I.kHardwareAccelerationModeEnabled],onChange:U0(I.kHardwareAccelerationModeEnabled)}),F0("span",{},void 0,(0,B.Z)("Use Hardware Acceleration When Available"))),F0("p",{className:"info"},void 0,(0,B.Z)("This setting requires a restart to take full effect.")))))}}const H0=(0,Bu.Z)(V0,W0);var G0;function $0(e,t,n,i){G0||(G0="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:G0,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var K0=$0("input",{type:"radio",value:"allowed"}),z0=$0("input",{type:"radio",value:"once"}),j0=$0("input",{type:"radio",value:"none"});class Y0 extends Li.Component{state={animationPolicy:"allowed"};componentDidMount(){i.Z.accessibilityFeatures.animationPolicy.onChange.addListener(this._onAnimationPolicyChanged),this._onAnimationPolicyChanged()}componentWillUnmount(){i.Z.accessibilityFeatures.animationPolicy.onChange.removeListener(this._onAnimationPolicyChanged)}_onAnimationPolicyChanged=()=>{i.Z.accessibilityFeatures.animationPolicy.get({},(({value:e})=>{this.setState({animationPolicy:e})}))};onSelected=e=>{const t=e.target.value;this.setState({animationPolicy:t},(()=>{i.Z.accessibilityFeatures.animationPolicy.set({value:t},(()=>{}))}))};render(){return $0(iA.Z,{filter:this.props.filter},void 0,$0("div",{className:"setting-group"},void 0,$0("div",{className:"setting-single"},void 0,$0("h3",{},void 0,(0,B.Z)("Play Image Animation")),$0(ja.Z,{name:"animationPolicy",value:this.state.animationPolicy,onChange:this.onSelected},void 0,$0("div",{className:"setting-single"},void 0,$0("label",{},void 0,K0,$0("span",{},void 0,(0,B.Z)("command","Loop")))),$0("div",{className:"setting-single"},void 0,$0("label",{},void 0,z0,$0("span",{},void 0,(0,B.Z)("Once")))),$0("div",{className:"setting-single"},void 0,$0("label",{},void 0,j0,$0("span",{},void 0,(0,B.Z)("radio","Never"))))))))}}const X0=Y0;var Q0;function q0(e,t,n,i){Q0||(Q0="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Q0,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const J0=[I.kPageImageLoading],e1=w.Z.getEventHandler;var t1=q0("input",{type:"radio",value:"always"}),n1=q0("input",{type:"radio",value:"never"}),i1=q0("input",{type:"radio",value:"cache"});class s1 extends Li.Component{render(){return q0(iA.Z,{filter:this.props.filter},void 0,q0("div",{className:"setting-group"},void 0,q0("div",{className:"setting-single"},void 0,q0("h3",{},void 0,(0,B.Z)("page settings","Load Images")),q0("p",{className:"info"},void 0,(0,B.Z)("Image loading setting for new tabs.")),q0(ja.Z,{name:"imageLoadingPolicy",value:this.props.prefValues[I.kPageImageLoading],onChange:e1(I.kPageImageLoading)},void 0,q0("div",{className:"setting-single"},void 0,q0("label",{},void 0,t1,q0("span",{},void 0,(0,B.Z)("radio","Always")))),q0("div",{className:"setting-single"},void 0,q0("label",{},void 0,n1,q0("span",{},void 0,(0,B.Z)("radio","Never")))),q0("div",{className:"setting-single"},void 0,q0("label",{},void 0,i1,q0("span",{},void 0,(0,B.Z)("radio","Cached"))))))))}}const o1=(0,Bu.Z)(s1,J0);var a1;function r1(e,t,n,i){a1||(a1="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:a1,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const l1=[I.kWebpagesPictureInPictureButtonEnabled],d1=w.Z.getEventHandler;class c1 extends Li.Component{render(){return r1(iA.Z,{filter:this.props.filter},void 0,r1("div",{className:"setting-group unlimited"},void 0,r1("div",{className:"setting-single"},void 0,r1("label",{},void 0,r1("input",{type:"checkbox",checked:this.props.prefValues[I.kWebpagesPictureInPictureButtonEnabled],onChange:d1(I.kWebpagesPictureInPictureButtonEnabled)}),r1("span",{},void 0,(0,B.Z)("Picture-in-Picture Button on Videos"))),r1("p",{className:"info"},void 0,(0,B.Z)("This setting requires a restart to take effect.")))))}}const u1=(0,Bu.Z)(c1,l1);var p1;function h1(e,t,n,i){p1||(p1="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:p1,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const g1=[I.kNetworkPredictionOptions];function m1(e){const t=(0,Ya.Z)(g1);return h1(iA.Z,{filter:e.filter},void 0,h1("div",{className:"setting-group"},void 0,h1("h3",{},void 0,(0,B.Z)("Prefetch")),h1("p",{className:"info"},void 0,(0,B.Z)("Follow webpage suggestions to prefetch DNS, and to preload resources and documents early.")),h1("div",{className:"setting-single"},void 0,h1("label",{},void 0,h1("input",{type:"checkbox",checked:2!==t[I.kNetworkPredictionOptions],onChange:e=>{const{checked:t}=e.currentTarget;w.Z.set(I.kNetworkPredictionOptions,t?0:2)}}),h1("span",{},void 0,(0,B.Z)("Prefetch Resources"))))))}var f1;function v1(e,t,n,i){f1||(f1="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:f1,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const y1=[I.kWebpagesAllowSelectionInLinks],b1=w.Z.getEventHandler;class S1 extends Li.Component{render(){return v1(iA.Z,{filter:this.props.filter},void 0,v1("div",{className:"setting-group unlimited"},void 0,v1("div",{className:"setting-single"},void 0,v1("label",{},void 0,v1("input",{type:"checkbox",checked:this.props.prefValues[I.kWebpagesAllowSelectionInLinks],onChange:b1(I.kWebpagesAllowSelectionInLinks)}),v1("span",{},void 0,(0,B.Z)("Allow Text Selection in Links"))))))}}const w1=(0,Bu.Z)(S1,y1);var C1;function A1(e,t,n,i){C1||(C1="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:C1,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const I1=[I.kWebpagesSmoothScrollingEnabled],T1=w.Z.getEventHandler;class Z1 extends Li.Component{render(){return A1(iA.Z,{filter:this.props.filter},void 0,A1("div",{className:"setting-group unlimited"},void 0,A1("div",{className:"setting-single"},void 0,A1("label",{},void 0,A1("input",{type:"checkbox",checked:this.props.prefValues[I.kWebpagesSmoothScrollingEnabled],onChange:T1(I.kWebpagesSmoothScrollingEnabled)}),A1("span",{},void 0,(0,B.Z)("Smooth Scrolling"))),A1("p",{className:"info"},void 0,(0,B.Z)("This setting requires a restart to take full effect.")))))}}const E1=(0,Bu.Z)(Z1,I1);var k1;function _1(e,t,n,i){k1||(k1="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:k1,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const N1=w.Z.getEventHandler,P1=[I.kWebpagesTabFocusesLinks];var D1=_1("input",{type:"radio",value:"false"}),M1=_1("input",{type:"radio",value:"true"});class O1 extends Li.Component{render(){return _1(iA.Z,{filter:this.props.filter},void 0,_1("div",{className:"setting-group"},void 0,_1("div",{className:"setting-single"},void 0,_1("h3",{},void 0,(0,B.Z)("Webpage Focus")),_1("p",{className:"info"},void 0,(0,B.Z)("This setting takes effect in new tabs or windows only.")),_1(ja.Z,{name:"tabToFocusSetting",className:"setting-single",value:this.props.prefValues[I.kWebpagesTabFocusesLinks],onChange:N1(I.kWebpagesTabFocusesLinks,"convert")},void 0,_1("div",{className:"setting-single"},void 0,_1("label",{},void 0,D1,_1("span",{},void 0,(0,B.Z)("Focus Forms Only")))),_1("div",{className:"setting-single"},void 0,_1("label",{className:"setting-single"},void 0,M1,_1("span",{},void 0,(0,B.Z)("Focus All Controls and Links"))))))))}}const x1=(0,Bu.Z)(O1,P1);var L1;function R1(e,t,n,i){L1||(L1="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:L1,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const B1=[I.kWebpagesTranslateSelectionButtonEnabled],F1=w.Z.getEventHandler;class W1 extends Li.Component{render(){return R1(iA.Z,{filter:this.props.filter},void 0,R1("div",{className:"setting-group unlimited"},void 0,R1("div",{className:"setting-single"},void 0,R1("label",{},void 0,R1("input",{type:"checkbox",checked:this.props.prefValues[I.kWebpagesTranslateSelectionButtonEnabled],onChange:F1(I.kWebpagesTranslateSelectionButtonEnabled)}),R1("span",{},void 0,(0,B.Z)("Show Selected Text Translate Button"))))))}}const U1=(0,Bu.Z)(W1,B1);var V1;function H1(e,t,n,i){V1||(V1="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:V1,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const G1=[...E0,...O0,...W0,...J0,...l1,...g1,...y1,...I1,...P1,...B1];function $1(e){return H1(tN.Z,{categoryTitle:(0,B.Z)("Webpages"),filter:e.filter},void 0,(0,ss.jsx)(E1,{...e}),(0,ss.jsx)(H0,{...e}),(0,ss.jsx)(u1,{...e}),(0,ss.jsx)(w1,{...e}),(0,ss.jsx)(U1,{...e}),(0,ss.jsx)(x1,{...e}),(0,ss.jsx)(R0,{...e}),(0,ss.jsx)(X0,{...e}),(0,ss.jsx)(o1,{...e}),(0,ss.jsx)(m1,{...e}),(0,ss.jsx)(P0,{...e}))}const K1=Li.memo($1);var z1;function j1(e,t,n,i){z1||(z1="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:z1,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Y1=[I.kWebpagesSpatialNavigationEnabled],X1=[...xJ,...YJ,...n0,...v0,...G1,...Y1];function Q1({filter:e,category:t}){const{filter:n,name:i}=Li.useMemo((()=>({filter:e,name:t.title})),[e,t.title]),s=sN({filter:n,prefPaths:X1,name:i});return(0,ss.jsxs)(ss.Fragment,{children:[j1("section",{className:"setting-section"},void 0,j1(K1,{filter:e})),j1("section",{className:"setting-section"},void 0,j1(S0,{filter:e})),j1("section",{className:"setting-section"},void 0,j1(g0,{prefs:!0,filter:e})),j1("section",{className:"setting-section"},void 0,j1(UJ,{filter:e})),j1("section",{className:"setting-section"},void 0,j1(qJ,{filter:e})),s]})}const q1=Li.memo(Q1);var J1;function e3(e,t,n,i){J1||(J1="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:J1,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const t3=pn.jk.settingCategories,n3="http://example.com/?path=",i3=[I.kThemesPreview,I.kThemesUser,I.kSettingsMonoIcons,I.kWorkspacesEnabled];function s3(e){const t=(0,rl.DP)(e);return t.scroll?t.scroll:""}function o3(e){const t=(0,rl.DP)(e),n=t.query,i=n?"all":t.path,s=i&&i.split("/");let o;if(!n&&s&&s.length>0&&t3[s[0]]&&(o=t3[s[0]],s.length>1)){const e=s.join("_");o=t3[e]}return o||(n?t3.all:t3.general)}var a3=e3("svg",{className:"guest-intro-background",viewBox:"0 0 1244 860"},void 0,e3("path",{fill:"url(#guest-intro-bg-gradient)",d:"M0 0h153.513c16.141 27.93 32.15 55.734 47.912 83.11 16.086 27.94 32.722 56.832 49.076 85.128 11.01 19.031 22.079 38.316 32.781 56.967 25.186 43.883 51.228 89.259 77.402 132.848 33.382 55.651 75.894 82.121 137.77 85.829 3.205.192 6.454.288 9.655.288 39.673 0 78.14-14.461 108.316-40.722 21.644-18.834 48.687-52.291 54.604-104.667.749-6.654 1.357-13.708 1.855-19.573-1.07-29.74-6.476-52.92-17.294-74.518C622.935 139.46 612.708 67.99 625.087 0h136.676C747.1 44.93 749.845 96.364 774.32 145.251c20.839 41.6 30.654 85.7 31.485 138.023-.568 6.192-1.472 18.273-2.83 30.356-17.572 155.524-149.172 263.318-294.866 263.318-5.816 0-11.67-.173-17.526-.521C382.84 569.97 301.9 518.174 246.822 426.358c-38.015-63.313-74.255-127.68-111.253-191.634C90.359 156.507 45.49 78.062 0 0zm1113.47 0H1244v140.1c-7.496 27.86-18.849 54.995-34.031 81.275a1299530.57 1299530.57 0 0 1-170.255 294.799A1223193.145 1223193.145 0 0 0 841.018 860.24H687.72c135.675-235.123 271.527-470.147 407.26-705.25 22.311-38.621 31.22-79.696 25.368-124.548A170.12 170.12 0 0 0 1113.471 0z"}));function r3(e){return e3("div",{className:"guest-intro"},void 0,a3,e3("div",{className:"guest-intro-content"},void 0,e3("h1",{},void 0,(0,B.Z)("Settings Unavailable")),e3("p",{},void 0,(0,B.Z)("Settings are not available in guest windows.")),e3("p",{},void 0,e3("a",{tabIndex:0,href:kT,onClick:t=>_T(e.windowId,t)},void 0,(0,B.Z)("Learn more about Guest Profiles")))))}var l3=e3("img",{srcSet:"chrome://theme/IDR_PRODUCT_LOGO_16 1x,chrome://theme/IDR_PRODUCT_LOGO_16@2x 2x",width:"16",height:"16",alt:""}),d3=e3(QB,{});function c3(e){const t=Li.useContext(ts.Z),n=(0,Ya.Z)(i3),i=Li.useRef(),s=Li.useRef(),o=Li.useRef(),a=Li.useRef(n[I.kThemesPreview].length),[r,l]=Li.useState(o3(e.url)),[d,u]=Li.useState((p=e.url,(0,rl.DP)(p)?.search||""));var p;const[h,g]=Li.useState(void 0),m=Li.useDeferredValue(d.length>=2?d:"");Li.useEffect((()=>{e.url.startsWith(n3)||l(o3(e.url))}),[e.url]);const f=Li.useCallback((e=>{const n=s3(e);if(!n)return;const s=i.current?.focusRef.current,{HTMLElement:o}=t;if(!(s instanceof o))return;const a=s.querySelector(`[data-anchor='${n}']`);a&&a.scrollIntoView(!0)}),[t]),v=Li.useCallback((()=>r?(0,B.Z)("Vivaldi Settings: $1",[r.title]):(0,B.Z)("Vivaldi Settings")),[r]);Li.useEffect((()=>{setTimeout((()=>f(e.url)),200),b()}),[]),Li.useEffect((()=>()=>{0}),[t,e.url,f]),Li.useEffect((()=>{const{document:e,vivaldiWindowId:n}=t;he.ZP.isSettings(n)&&(e.title=v()),w()}),[r,t,v]),Li.useEffect((()=>{const i=n[I.kThemesPreview].length;if((a.current??-1)<i){const{name:e,id:i}=n[I.kThemesPreview][0];he.ZP.isSettings(t.vivaldiWindowId)&&he.ZP.isActive(t.vivaldiWindowId)?g({themeName:e,isUpdate:n[I.kThemesUser].findIndex((e=>e.id===i))>-1}):y()}a.current=i;s3(e.url)&&f(e.url)}),[t.vivaldiWindowId,n,e.url,f]);const y=()=>g(void 0),b=()=>s.current?.focus(),S=e=>r&&r===t3.all||r&&r===e,w=()=>{o.current&&(o.current.scrollTop=0)},C=e=>{const n=t.vivaldiWindowId;he.ZP.isSettings(n)?l(t3[e]):c.ZP.openURL(n,pn.jk.internalUrl("settings",e),{inCurrent:!0})},A=Li.useCallback((e=>{"ctrl+f"===Ke.Z.keyComboFromEvent(e.nativeEvent)&&b()}),[]);return he.ZP.isGuest()?e3(r3,{windowId:t.vivaldiWindowId}):(0,ss.jsxs)(ss.Fragment,{children:[e3("header",{className:"settings-header"},void 0,l3,e3("h1",{},void 0,v())),(0,ss.jsxs)(za.Z,{ref:i,focusName:"focus_settings",className:Fi()("vivaldi-settings",{"mono-icons":n[I.kSettingsMonoIcons]}),onKeyDown:A,children:[e3(Bz,{focusRef:s,filter:d,onFilterChange:e=>{u(e),r!==t3.all&&C("all")},selectedCategory:r,onCategorySelected:e=>{u(""),C(e)}}),r&&(0,ss.jsxs)("div",{className:"settings-content",ref:o,children:[r===t3.general&&d3,S(t3.general)&&e3(AW,{filter:m,category:r}),S(t3.sync)&&e3("section",{className:"setting-section"},void 0,e3(wY,{url:e.url,category:r,filter:m})),S(t3.appearance)&&e3(oP,{filter:m,category:r}),S(t3.themes)&&e3(PJ,{filter:m,category:r}),S(t3.startpage)&&e3(uj,{category:r,filter:m}),S(t3.tabs)&&e3(hq,{category:r,filter:m,isWorkspacesEnabled:n[I.kWorkspacesEnabled]}),S(t3.panel)&&e3(GG,{category:r,filter:d}),S(t3.addressbar)&&e3(mN,{category:r,filter:m}),S(t3.bookmarks)&&e3(lD,{filter:m,category:r}),S(t3.search)&&e3(Dz,{category:r,filter:m}),S(t3.qc)&&e3(dz,{filter:m,category:r}),S(t3.keyboard)&&e3(rU,{filter:m,category:r,view:"editable"}),S(t3.mouse)&&e3(TG,{filter:m,category:r}),S(t3.privacy)&&e3(QK,{filter:m,category:r}),S(t3.downloads)&&e3("section",{className:"setting-section"},void 0,e3(nF,{category:r,filter:m})),S(t3.webpages)&&e3(q1,{filter:m,category:r}),S(t3.network)&&e3(MG,{category:r,filter:m}),S(t3.mail)&&e3("section",{className:"setting-section"},void 0,e3(dG,{filter:m})),S(t3.calendar)&&e3("section",{className:"setting-section"},void 0,e3(HB,{filter:m})),S(t3.rss)&&e3("section",{className:"setting-section"},void 0,e3(CU,{filter:m})),Oi.Z.isEnabled("chat")&&S(t3.chat)&&e3("section",{className:"setting-section"},void 0,e3(GB,{filter:m})),S(t3.biscuit)&&e3("section",{className:"setting-section"},void 0,e3(FP,{filter:m})),!1]}),h&&e3(ku,{onClose:y,themeName:h.themeName,isUpdate:h.isUpdate})]})]})}const u3=Li.memo(c3);class p3 extends hr.Z{_tasks=(0,ze.aV)();getBackgroundTasks(){return this._tasks}dispatchAction(e){if("BACKGROUND_TASKS_SET"===e.actionType)this._tasks=(0,ze.aV)(e.tasks),this.emitChange()}}const h3=new p3(A.Z);class g3{#Ut;#Vt=0;#Ht=(0,ze.aV)();#Gt=new Event("undoredo");#$t=!0;#Kt=!0;constructor(e=500){if(e<1)throw new Error("Stack size must be greater than 0");this.#Ut=e}record(e){this.#Ht=this.#Ht.slice(this.#Vt,this.#Ut-1+this.#Vt).unshift(e),this.#Vt=0,this._onChange()}clear(){this.#Ht=(0,ze.aV)(),this.#Vt=0,this._onChange()}undo(){this.#$t||(this.#Ht.get(this.#Vt)?.undo(),this.#Vt+=1,this._onChange(),document.dispatchEvent(this.#Gt))}redo(){this.#Kt||(this.#Vt-=1,this.#Ht.get(this.#Vt)?.redo(),this._onChange(),document.dispatchEvent(this.#Gt))}_onChange(){this.#$t=this.#Vt===this.#Ht.size,this.#Kt=0===this.#Vt}canUndo(){return!this.#$t}canRedo(){return!this.#Kt}}class m3{#zt;#jt;constructor(e,t,n){this.#zt=e,this.#jt=t,this._updateFunction=n}undo(){this._updateFunction(this.#zt)}redo(){this._updateFunction(this.#jt)}}var f3,v3=n(64626);class y3{cut=(e,t)=>ee.Z.cut(e,t);copy=(e,t)=>ee.Z.copy(e,t);constructor(){this.undoStack=new g3}undo(){this.undoStack.undo()}redo(){this.undoStack.redo()}canUndo(){return this.undoStack.canUndo()}canRedo(){return this.undoStack.canRedo()}clearUndoStack(){this.undoStack.clear()}async paste(e,t,n){const i=g.Z.getCutIds(),s=i.length>0?g.Z.getItemById(i[0]).parentId:"",o=await ee.Z.paste(e,t,n),{isCut:a,ids:r}=o;return this.undoStack.record(new m3({sourceId:s,isCut:a,ids:r},{sourceId:s,targetId:t,isCut:a,ids:r},(e=>{e.targetId?ee.Z.move(e.ids,e.targetId,0):a?ee.Z.move(e.ids,e.sourceId,0):ee.Z.remove(e.ids)}))),o}async create(e){const t=await i.Z.bookmarks.create(e);if(t)return this.undoStack.record(new m3({createdId:t.id,remove:!0},{createdId:t.id,parentId:t.parentId},(e=>{e.remove?ee.Z.remove([e.createdId]):ee.Z.move([e.createdId],e.parentId||"",t.index||0)}))),t}async createWithPromise(e,t,n){const i=await ee.Z.createWithPromise(e,t,n),s=(Array.isArray(i)?i:[i]).map((e=>e.id));return this.undoStack.record(new m3({createdIds:s,parentId:t,index:n,remove:!0},{createdIds:s,parentId:t,index:n},(e=>{e.remove?ee.Z.remove(e.createdIds):ee.Z.move(e.createdIds,e.parentId,e.index||0)}))),i}update(e,t){const n=g.Z.getItemById(e);return i.Z.bookmarks.update(e,t).then((s=>(this.undoStack.record(new m3({nodeId:e,item:(0,v3.Z)(n,Object.keys(t))},{nodeId:e,item:t},(e=>{i.Z.bookmarks.update(e.nodeId,e.item)}))),s)))}async mergeWithPromise(e,t,n){const i=(await this.createWithPromise([{parentId:e.parentId,children:[],title:n}],e.parentId||"",t.index))[0].id;return await this.move([e.id,t.id],i,0),i}async move(e,t,n){const i=e.length>0?g.Z.getItemById(e[0]).parentId:"",s=await ee.Z.move(e,t,n);return this.undoStack.record(new m3({ids:e,parentId:i,index:0},{ids:e,parentId:t,index:n},(e=>{ee.Z.move(e.ids,e.parentId,e.index)}))),s}async reorder(e,t){const n={nodeId:t,order:g.Z.getItemById(t)?.children?.map((e=>e.id))??[]},i=await ee.Z.reorder(e,t);return this.undoStack.record(new m3(n,{nodeId:t,order:e},(e=>{ee.Z.reorder(e.order,e.nodeId)}))),i}async remove(e=[]){if(0===e.length)return;const t={removed:e,parentId:g.Z.getItemById(e[0]).parentId};await ee.Z.remove(e),this.undoStack.record(new m3(t,{ids:e},(e=>{e.removed?ee.Z.move(e.removed,e.parentId||"",0):ee.Z.remove(e.ids)})))}async duplicate(e,t,n){const i=await ee.Z.duplicate(e,t,n);return this.undoStack.record(new m3({ids:i,remove:!0},{ids:i,parentId:t,index:n},(e=>{e.remove?ee.Z.remove(e.ids):ee.Z.move(e.ids,e.parentId,e.index)}))),i}async createBookmarks(e,t,n){const i=await ee.Z.createBookmarks(e,t,n,"none");return this.undoStack.record(new m3({ids:i,remove:!0},{ids:i,parentId:t,index:n},(e=>{e.remove?ee.Z.remove(e.ids):ee.Z.move(e.ids,e.parentId,e.index)}))),i}onDropEvent(e,t,n,i){if(e.dataTransfer.types.includes(zi.yR)){const s=JSON.parse(e.nativeEvent.dataTransfer.getData(zi.yR));zi.ZP.isCopyModifierPressed(e)||i&&i.disableMove?this.duplicate(s,t,n):this.move(s,t,n)}else zi.ZP.getUrlsFromEventPromise(e,!0).then((e=>this.createBookmarks(e,t,n)))}}function b3(e,t,n,i){f3||(f3="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:f3,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class S3 extends Li.PureComponent{_imageElementKey=0;_reloadRetryCount=0;state={titleAsFallback:!1};componentDidUpdate(e){e.src!==this.props.src&&(this.setState({titleAsFallback:!1}),this.finishErrorRecovery())}componentWillUnmount(){this.finishErrorRecovery()}finishErrorRecovery(){this._reloadRetryCount=0,void 0!==this._reloadRetryTimer&&(clearTimeout(this._reloadRetryTimer),this._reloadRetryTimer=void 0)}onImageLoad=()=>{this.setState({titleAsFallback:!1})};onImageError=()=>{if(this.props.isFolder||this.setState({titleAsFallback:!0}),void 0!==this._reloadRetryTimer)return;if(this._reloadRetryCount>=4)return void(4===this._reloadRetryCount&&(this._reloadRetryCount=5,this.props.onImageLoadError&&this.props.onImageLoadError(this.props.src)));this._reloadRetryCount++;const e=1e3*Math.pow(2,this._reloadRetryCount);this._reloadRetryTimer=setTimeout(this.onTryReload,e)};onTryReload=()=>{this._reloadRetryTimer=void 0,this._imageElementKey++,this.forceUpdate()};_getTitle=()=>{if(void 0!==this.props.pageId){const e=Ce.ZP.getPageById(this.props.pageId);return e&&!pn.jk.isInternalUrl(e.url)&&(0,rl.C3)(e.url)?new URL(e.url).hostname:pn.jk.getDisplayTitleByUrl(e?.url??"","")}return"---"===this.props.title?"":this.props.title};render(){const e=this.props.className||"thumbnail-image";if(this.props.src){const t=this.state.titleAsFallback?{gridTemplateRows:"auto 0px",backgroundColor:this.props.backgroundColor??"var(--colorBgDarker)"}:{},n=this.props.backgroundColor?xe()(this.props.backgroundColor).luminance()>DI.$J?DI.E5:DI.Cj:"var(--colorFg)";return b3("div",{className:e,style:t,onPointerEnter:this.props.onPointerEnter,onPointerLeave:this.props.onPointerLeave,onPointerDown:this.props.onPointerDown,onPointerUp:this.props.onPointerUp},void 0,this.state.titleAsFallback&&b3("span",{style:{color:n}},void 0,this._getTitle()),b3("img",{width:"100%",height:"auto",src:this.props.src,onError:this.onImageError,onLoad:this.onImageLoad},this._imageElementKey))}if(this.props.title&&!this.props.isFolder){const t=this.props.backgroundColor?xe()(this.props.backgroundColor).luminance()>DI.$J?DI.E5:DI.Cj:"var(--colorFg)";return b3("div",{className:e,style:{backgroundColor:this.props.backgroundColor??"var(--colorBgDarker)"},onPointerEnter:this.props.onPointerEnter,onPointerLeave:this.props.onPointerLeave,onPointerDown:this.props.onPointerDown,onPointerUp:this.props.onPointerUp},void 0,b3("span",{style:{color:t}},void 0,this._getTitle()))}return b3("div",{className:e,onPointerEnter:this.props.onPointerEnter,onPointerLeave:this.props.onPointerLeave,onPointerDown:this.props.onPointerDown,onPointerUp:this.props.onPointerUp,dangerouslySetInnerHTML:this.props.isFolder?{__html:Wi.feS}:{__html:Wi.$B$}})}}const w3=S3;var C3,A3=n(30460),I3=n(34155);function T3(e,t,n,i){C3||(C3="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:C3,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Z3=[I.kBookmarksBarVisible],E3=Object.freeze({bookmarkbar:!1,description:"",id:"",nickname:"",partner:"",themeColor:"",speeddial:!1,thumbnail:"",title:"",trash:!1});var k3=T3("input",{type:"submit",hidden:!0});class _3 extends Li.Component{static contextType=ts.Z;refTitle=Li.createRef();refUrlField=Li.createRef();refUrlFieldDeprecated=Li.createRef();_isCreating=!1;_isMounted=!1;_disableSaveOnBlur=!1;_id=crypto.randomUUID();_pageContext={};_useOmni=Oi.Z.isEnabled("omnibox");state={item:E3,unmodifiedItem:E3,typedUrl:void 0,nickError:!1};componentDidMount(){this._isMounted=!0,this._useOmni?Rv.addListener(this._onUrlFieldStoreChanged,(e=>e.get(this._id))):rb.addListener(this._onUrlFieldStoreChanged,(e=>e.get(this._id))),g.Z.addListener(this.onBookmarkStoreChange)}componentWillUnmount(){this._useOmni?Rv.removeListener(this._onUrlFieldStoreChanged):rb.removeListener(this._onUrlFieldStoreChanged),g.Z.removeListener(this.onBookmarkStoreChange),this._save(),I3.nextTick((()=>{this._useOmni?Ov.Z.reset(this._id):sb.reset(this._id)})),Ho.unlinkBookmarkComponent(this),this._isMounted=!1}setIsCreating=e=>{this._isCreating=e};getIsCreating=()=>this._isCreating;_onUrlFieldStoreChanged=()=>{const{autocompleteValue:e,typedUrl:t}=this._useOmni?Rv.getUrlfieldState(this._id):rb.getUrlfieldState(this._id);this.setState((n=>({typedUrl:t,item:{...n.item,url:e||t||n.unmodifiedItem.url}})))};onSubmit=()=>{this._save(),this.props.onFocusTree()};_save=async()=>{const{item:e,unmodifiedItem:t}=this.state;if(e===t||g.Z.isTrashed(e)||g.Z.isSeparator(e)||this.state.nickError||""===e.id)return;const n=zi.ZP.verifyForUpdate({title:e.title,url:e.url,nickname:e.nickname,description:e.description,speeddial:e.speeddial},g.Z.isFolder(e));return i.Z.bookmarks.update(e.id,n)};_saveOnBlur=()=>{!1===this._disableSaveOnBlur&&this._save().then(this.setIsCreating(!1))};_updateStateWithItem=e=>{const t=e.id===this.state.item.id;return new Promise((n=>{this.setState((n=>{if(!t||e.id===n.item.id)return{item:e,unmodifiedItem:e,nickError:!1}}),n)}))};handleKeyPress=e=>{if(e.stopPropagation(),"Escape"===e.key){e.preventDefault(),this._useOmni?Ov.Z.reset(this._id):sb.reset(this._id);const t=this.state.item.id;if(!t)return;if(this.getIsCreating())this.setIsCreating(!1),this._updateStateWithItem(E3).then(this.props.onCancel(t,!0));else{const e=g.Z.getItemById(t);e?this._updateStateWithItem(e).then((()=>this.props.onCancel(t,!1))):this.props.onCancel(t,!1)}}};focusUrlField=()=>{this._useOmni&&!this.refUrlField.current||!this._useOmni&&!this.refUrlFieldDeprecated.current||(0,Dv.x0)(this.context,this._id)};focusTitleField=()=>{this.refTitle.current&&this.refTitle.current.focus()};handleFocus=e=>{this.props.updateLayout&&this.props.updateLayout();const{HTMLInputElement:t}=this.context;e.target instanceof t&&e.target.select()};handleUpdateThumbnail=e=>{if(e.stopPropagation(),g.Z.isFolder(this.state.item))return void i.Z.bookmarks.update(this.state.item.id,{thumbnail:""});const t=zi.ZP.verifyForUpdate({url:this.state.item.url},!1);t.url&&Ho.updateForBookmark(this.state.item.id,t.url)};onBookmarkStoreChange=()=>{const{item:e}=this.state;if(""!==e.id){const t=g.Z.getItemById(e.id);t&&t.id===e.id&&this._updateStateWithItem(t)}};handleSetCustomThumbnail=e=>{e?.stopPropagation?.(),se.Z.utilities.selectLocalImage({windowId:this.context.vivaldiWindowId,title:(0,B.Z)("Select Custom Image"),thumbnailBookmarkId:this.state.item.id})};checkChangeSpeeddial=()=>{this.setState((e=>({item:{...e.item,speeddial:!e.item.speeddial}})),(()=>{this._save()}))};isBookmarkBarChecked=()=>g.Z.getBookmarkBarFolderId()===this.state.item.id&&this.props.prefValues[I.kBookmarksBarVisible];checkChangeBookmarkBar=()=>{ee.Z.setBookmarkBarFolderAndToggleVisibility(this.state.item.id)};onInputChange=(e,t)=>{this.setState((n=>({item:{...n.item,[e]:t.target.value}}))),"nickname"===e&&(g.Z.hasNickname(t.target.value)?this.setState({nickError:!0}):this.setState({nickError:!1}))};setItem=e=>{this._save().then((()=>{if(this._isMounted){const e=this.props.getSelectedItem();this._setItem(e??E3)}}))};_setItem=e=>(this._useOmni?Ov.Z.reset(this._id):sb.reset(this._id),this._updateStateWithItem(e).then((()=>{this.getIsCreating()&&(this._disableSaveOnBlur=!0,g.Z.isFolder(this.state.item)?this.focusTitleField():g.Z.isTrashed(this.state.item)||this.focusUrlField(),this._disableSaveOnBlur=!1)})));render(){const{item:e,unmodifiedItem:t}=this.state,n=g.Z.isFolder(e),i=Ho.linkAndQueryUpdatingBookmark(this,this.state.item.id),s=W()(e.dateAdded).format("LLL"),o=!e.id||g.Z.isSeparator(e)||g.Z.isTrashed(e)||g.Z.isMobileFolder(e),a=this.state.item.title?this.state.item.title:this.state.item.url?se.Z.utilities.urlToThumbnailText(this.state.item.url):"";return T3("div",{className:"manager-editor",onKeyDown:this.handleKeyPress},void 0,T3("form",{className:"addbookmark-cardwrapper cardview",onSubmit:this.onSubmit},void 0,T3("div",{className:"upper-half"},void 0,T3("div",{className:"title-and-address"},void 0,T3("div",{className:"fieldset"},void 0,(0,ss.jsx)("input",{className:"cardview title",ref:this.refTitle,placeholder:(0,B.Z)("Title"),onChange:this.onInputChange.bind(this,"title"),value:e.title,title:e.title,disabled:o,type:"text",onFocus:this.handleFocus,onBlur:this._saveOnBlur})),T3("div",{className:n?"fieldset collapse":"fieldset"},void 0,this._useOmni?(0,ss.jsx)(ib,{ref:this.refUrlField,pageId:this._id,pageContext:this._pageContext,autocompletionEnabled:!0,typedHistoryEnabled:!1,autoFocus:!1,className:"cardview address",disabled:o||n,displayUrl:t.url===A3.p?"":t.url??"",typedUrl:this.state.typedUrl,handleDrop:!0,onBlur:this._saveOnBlur,onFocus:this.handleFocus,onKeyPress:this.handleKeyPress,placeholder:(0,B.Z)("Address"),title:e.url??(0,B.Z)("Enter webpage address"),inputId:this._id,urlFragments:null}):(0,ss.jsx)(ZS,{ref:this.refUrlFieldDeprecated,pageId:this._id,pageContext:this._pageContext,autocompletionEnabled:!0,typedHistoryEnabled:!1,autoFocus:!1,className:"cardview address",disabled:o||n,displayUrl:t.url===A3.p?"":t.url??"",typedUrl:this.state.typedUrl,handleDrop:!0,onBlur:this._saveOnBlur,onFocus:this.handleFocus,onKeyPress:this.handleKeyPress,placeholder:(0,B.Z)("Address"),title:e.url??(0,B.Z)("Enter webpage address"),inputId:this._id,urlFragments:null})),T3("div",{className:"fieldset"},void 0,T3("input",{className:"cardview nickname",placeholder:(0,B.Z)("Nickname"),value:e.nickname,title:e.nickname,onChange:this.onInputChange.bind(this,"nickname"),type:"text",disabled:o,onFocus:this.handleFocus,onBlur:this._saveOnBlur}))),T3("div",{className:"preview",title:`${a}\n${this.state.item.url??""}`},void 0,T3(w3,{isFolder:n,src:e.thumbnail,backgroundColor:this.state.item.themeColor||void 0},e.id),!o&&T3("div",{className:"thumb-controls"},void 0,T3("button",{type:"button",tabIndex:"-1",className:Fi()({circular:!0,"update-thumbnail":!0,updating:i}),title:(0,B.Z)("Update thumbnail"),onClick:this.handleUpdateThumbnail,dangerouslySetInnerHTML:{__html:Wi.GO5.medium}}),T3("button",{type:"button",tabIndex:"-1",onClick:this.handleSetCustomThumbnail,className:Fi()({circular:!0,"set-custom-thumbnail":!0}),title:(0,B.Z)("Select custom thumbnail"),dangerouslySetInnerHTML:{__html:Wi.md4.medium}})))),this.state.nickError&&T3("div",{className:"fieldset"},void 0,T3(To,{type:"warning"},void 0,(0,B.Z)("This nickname is already in use."))),T3("div",{className:"lower-half"},void 0,T3("div",{className:"fieldset resizable"},void 0,T3("textarea",{className:"description",placeholder:(0,B.Z)("Description"),value:e.description,onChange:this.onInputChange.bind(this,"description"),type:"text",disabled:o,onFocus:this.handleFocus,onBlur:this._saveOnBlur})),T3("div",{className:"speeddial-bookmarksbar"},void 0,T3("div",{className:n?"fieldset center cardview":"fieldset center collapse"},void 0,T3("label",{},void 0,T3("input",{className:"cardview",disabled:o||!n,checked:e.speeddial,onChange:this.checkChangeSpeeddial,onFocus:this.handleFocus,type:"checkbox"}),T3("span",{},void 0,(0,B.Z)("Speed Dial")))),T3("div",{className:n?"fieldset center cardview":"fieldset center collapse"},void 0,T3("label",{},void 0,T3("input",{className:"cardview",disabled:o||!n,checked:this.isBookmarkBarChecked(),onChange:this.checkChangeBookmarkBar,onFocus:this.handleFocus,type:"checkbox"}),T3("span",{},void 0,(0,B.Z)("Bookmark Bar"))))),e.dateAdded&&T3("div",{className:"fieldset"},void 0,T3("div",{className:"meta-icon date fieldset",dangerouslySetInnerHTML:{__html:Wi.V_c}}),T3("span",{className:"dateCreated bookmark",title:(0,B.Z)("Date created")},void 0,s))),k3))}}const N3=(0,Bu.Z)(_3,Z3);var P3,D3=n(34155);function M3(e,t,n,i){P3||(P3="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:P3,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function O3(e){return!!e&&g.Z.isTrashed(e)}function x3(e){return!e.trash&&!U3(e)}function L3(e){return!O3(e)}function R3(e,t){const n=K3(t)?t.title:pn.jk.getHoverUrl(g.Z.getUrlByNode(t));u.Z.setStatus(e,n)}function B3(e){u.Z.clearStatus(e)}function F3(e,t){t.button===es.Z.kCenter&&(t.preventDefault(),t.stopPropagation())}function W3(e){return e&&Boolean(e.trash)}function U3(e){return e&&g.Z.isMobileFolder(e)}function V3(e,t){i.Z.bookmarks.update(e,{title:t})}function H3(e){return Boolean(e.speeddial)}function G3(e){return!W3(e)&&!U3(e)}function $3(e){return!!e.children&&e.children.length>0}function K3(e){return!(!e||!e.children&&e.url)}function z3(e){const{columns:t,level:n,isExpanded:i,node:s}=e,{onExpandClick:o,inManager:a,fullView:r,windowId:l}=e,d=g.Z.isSeparator(s),c=(n+1)*ks+"px";if(d){const e=t?t.findIndex((e=>"title"===e.id)):0,n=a&&0===e||!a?c:0;return M3("label",{"data-parent":s.parentId},"0",M3("hr",{style:{marginLeft:n},className:"separator"}))}return r?t.map((t=>{switch(t.id){case"title":return M3(Os,{node:s,inlineEditText:e.inlineEditText,onExpandClick:o,inManager:a,fullView:r,isExpanded:e.isExpanded,level:n,onChange:e.onChange,onBlur:e.onBlur,onFocus:e.onFocus,showBadge:e.showBadge,onMouseEnter:()=>R3(l,s),onMouseLeave:()=>B3(l)},s.id);case"url":const i=(0,Ty.dO)(g.Z.getUrlByNode(s));return M3("label",{},t.id,$3(s)&&r?M3("span",{className:"secondary"},void 0,(0,B.Z)("$1 item","$1 items",[s.children.length])):M3(Vy,{windowId:l,urlFragments:i,displayUrl:s.url,shouldShowFullUrl:!0,onGoToPath:Lr.Z,onBaseDomainObscured:Lr.Z,shouldHighlightBaseDomain:!1,rawDisplay:!0}));case"nickname":return M3("label",{},t.id,M3("span",{},void 0,s.nickname));case"description":return M3("label",{},t.id,M3("span",{},void 0,s.description));case"dateAdded":return M3("label",{className:"right-aligned"},t.id,M3("span",{},void 0,W()(s.dateAdded).format("ll")))}})):M3(Os,{node:s,inlineEditText:e.inlineEditText,onExpandClick:o,inManager:a,fullView:r,isExpanded:i,level:n,onChange:e.onChange,onBlur:e.onBlur,onFocus:e.onFocus,showBadge:e.showBadge,onMouseEnter:()=>R3(l,s),onMouseLeave:()=>B3(l)},s.id)}class j3 extends Li.PureComponent{refTreeList=Li.createRef();static contextType=ts.Z;winId=this.context.vivaldiWindowId;state={nodes:[],cutIds:[],showBadge:C.Z.get(I.kPanelsShowFolderBadge)};_isMounted=!1;_hasSeenSelection=!1;expandModel={};componentDidMount(){this._isMounted=!0,g.Z.addListener(this._onStoreChange),C.Z.addListener(I.kPanelsShowFolderBadge,this._onBadgeChanged),this.onFilterChange(this.props.filter,this._monitorInitialSelection)}componentDidUpdate(e,t){if(this.props.filter!==e.filter){const t=this.props.filter.length,n=e.filter.length;0===n&&t>0&&this.refTreeList.current&&(this.expandModel=this.refTreeList.current.getExpandModel()),this.onFilterChange(this.props.filter,(e=>{t>0?D3.nextTick((()=>{this.refTreeList.current?.expandAllExcept(e)})):n>0&&0===t&&D3.nextTick((()=>{this.refTreeList.current?.expandWithModel(this.expandModel)}))}))}0!==this.state.nodes.length&&t.nodes!==this.state.nodes&&D3.nextTick((()=>{this.onBookmarksUpdatedIsEmpty()}))}componentWillUnmount(){C.Z.removeListener(I.kPanelsShowFolderBadge,this._onBadgeChanged),g.Z.removeListener(this._onStoreChange),this._isMounted=!1}_onStoreChange=()=>{this.onFilterChange(this.props.filter,this._monitorInitialSelection)};onBookmarksUpdatedIsEmpty=()=>{const{onBookmarksUpdatedIsEmpty:e,filter:t}=this.props;if(e&&0===t.length){e(!(!this.state.nodes||this.state.nodes.every((e=>(W3(e)||U3(e))&&0===e.children?.length))))}};onFilterChange=(e,t)=>{if(e&&e.length>0){const n={bookmarks:!0,folders:!0};if("tree"===this.refTreeList.current?.getSearchStyle()){const i=g.Z.getFilteredTree(e,n);this.setState({nodes:i.nodes,cutIds:g.Z.getCutIds()},t?.(i.collapsed))}else{const i=g.Z.getFilteredFlat(e,n);this.setState({nodes:i,cutIds:g.Z.getCutIds()},t?.([]))}}else this.setState({nodes:g.Z.getTopNodes(),cutIds:g.Z.getCutIds()},t?.([]))};_monitorInitialSelection=()=>{this._hasSeenSelection||D3.nextTick((()=>{if(this._isMounted){const e=this.refTreeList.current?.getSelectedItem();e&&(this._hasSeenSelection=!0,this.props.onSelect(e))}}))};_onBadgeChanged=(e,t)=>{this.setState({showBadge:Boolean(t)})};deleteSelectedItems=()=>this.refTreeList.current?.onDelete();expandAll=()=>{this.refTreeList.current?.expandAll()};collapseAll=()=>{this.refTreeList.current?.collapseAll()};setSearchStyle=e=>{this.refTreeList.current?.setSearchStyle(e)};onSearchStyleChanged=e=>{this.props.filter&&this.onFilterChange(this.props.filter,(t=>{"tree"===e&&D3.nextTick((()=>{this.refTreeList.current?.expandAllExcept(t)}))}))};scrollToId=e=>{this.refTreeList.current?.scrollToId(e)};expandAndHighlight=e=>{this.refTreeList.current?.expandToId(e),this.refTreeList.current?.expand(e),this.refTreeList.current?.selectById(e)};getTargetSpec=(e,t)=>{const n={...zi.ZP.getEmptyNode(),id:e.id,index:0,parentId:void 0};if((W3(e)||U3(e))&&"on"!==t){const e=g.Z.getLastTopNode();e?(n.parentId=e.parentId,n.index=(e.index||0)+1):n.parentId=g.Z.getRootId()}else if(K3(e)&&"on"===t)n.parentId=e.id;else{Boolean(this.refTreeList.current?.isExpanded(e.id))&&"below"===t?n.parentId=e.id:(n.parentId=e.parentId,n.index=(e.index||0)+("below"===t?1:0))}return n};onDrop=(e,t,n)=>{const i=this.getTargetSpec(t,n),s=i.parentId,o=i.index;return void 0===s||void 0===o?Promise.resolve([]):zi.ZP.getUrlsFromEventPromise(e,!0).then((e=>{const t=e.map((e=>({...zi.ZP.getEmptyNode(),url:e.url,title:e.title})));return this.onCreate(t,s,o,!1)}))};onAdd=e=>{this.refTreeList.current?.onAdd(e?"folder":"item")};buildItem=(e,t)=>"folder"===e?{title:(0,B.Z)("title","New Folder"),children:[]}:"separator"===e?{separator:!0}:{...t};bookmarkActivePage=async e=>{const t=Ce.ZP.getActivePage(this.context.vivaldiWindowId);if(t){const n=this.refTreeList.current?.getParentAndIndex(e,!0);if(void 0!==n?.parentId){const e=await ee.Z.bookmarkPages(t,!1,n.parentId,n.index);"string"==typeof e&&this.refTreeList.current?.selectById(e)}}};bookmarkAllOpenPages=async e=>{const t=this.refTreeList.current?.getParentAndIndex(e,!0);if(void 0!==t?.parentId){const e=await ee.Z.bookmarkAllOpenPages(this.winId,t.parentId,t.index);"string"==typeof e&&this.refTreeList.current?.selectById(e)}};onRootPasteContextMenu=e=>{const{document:t}=this.context;t.addEventListener("paste",this.onRootPaste),t.execCommand("paste"),t.removeEventListener("paste",this.onRootPaste)};onRootPaste=e=>{const t=g.Z.getRootId();void 0!==t&&ee.Z.paste(e,t,!0)};getSelectedBookmarks=()=>(this.refTreeList.current?.getAllSelectedItems()||[]).map((e=>zi.ZP.getBookmarksByNode(e))).flat();getSelectedItem=()=>this.refTreeList.current?.getSelectedItem();_onNodesActivated=(e,t)=>{const n=this.context.vivaldiWindowId,i=(0,La.ZP)(n,{button:e.button,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,metaKey:e.metaKey}),s=t.map((e=>zi.ZP.getBookmarksByNode(e))).flat();zi.ZP.open(n,s,i,!0)};_openInNewTab=e=>{const t={inCurrent:!1,inBackground:e||C.Z.get(I.kTabsOpenNewInBackground),inNewWindow:!1,allowOverride:!1,incognito:!1};zi.ZP.open(this.context.vivaldiWindowId,this.getSelectedBookmarks(),t,!0)};_openInNewWindow=(e,t)=>{const n={inCurrent:!1,inBackground:!1,inNewWindow:!0,allowOverride:!1,incognito:e};zi.ZP.open(this.context.vivaldiWindowId,t,n,!0)};_openBookmark=()=>{zi.ZP.open(this.context.vivaldiWindowId,this.getSelectedBookmarks(),{inCurrent:!0,inBackground:!1,inNewWindow:!1,allowOverride:!1,incognito:!1},!0)};_supportSingleClick=()=>C.Z.get(I.kBookmarksSingleClickOpens)&&!this.props.inManager;getMenuCapability=async(e,t,n)=>{const s=this.winId,o=Boolean(n)&&!W3(n)&&!U3(n)&&!g.Z.isSeparator(n);switch(e.action){case"CONTEXT_OPEN_IN_NEW_TAB":return{handler:()=>this._openInNewTab(!1),isVisible:()=>o,...t(s,e,{})};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{handler:()=>this._openInNewTab(!0),isVisible:()=>o&&!C.Z.get(I.kTabsOpenNewInBackground),...t(s,e,{})};case"CONTEXT_OPEN_IN_TAB":return{handler:this._openBookmark,isVisible:()=>o,...t(s,e,{})};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{handler:()=>this._openInNewWindow(!1,this.getSelectedBookmarks()),isVisible:()=>o,...t(s,e,{})};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{handler:()=>this._openInNewWindow(!0,this.getSelectedBookmarks()),isVisible:()=>o,...t(s,e,{})};case"CONTEXT_CONTAINER_OPEN_IN_WINDOW":{const n=zi.ZP.getUrlsByNodes(this.refTreeList.current?.getAllSelectedItems()||[]),i=await Ta.getMenu(s,!0,n);return{isVisible:()=>o&&i.length>0,items:i,...t(s,e,{})}}case"CONTEXT_SET_SPEEDDIAL":return{handler:()=>{ee.Z.addSpeeddialGroup(n)},isVisible:()=>Boolean(n)&&!O3(n)&&!U3(n)&&!H3(n)&&K3(n)&&g.Z.validateForEdit(n.id),...t(s,e,{})};case"CONTEXT_UNSET_SPEEDDIAL":return{handler:()=>{ee.Z.removeSpeeddialGroup(n)},isVisible:()=>Boolean(n)&&!O3(n)&&!U3(n)&&H3(n)&&K3(n)&&g.Z.validateForEdit(n.id),...t(s,e,{})};case"CONTEXT_SET_BOOKMARK_BAR":{const i=Boolean(n)&&C.Z.get(I.kBookmarksBarVisible)&&g.Z.getBookmarkBarFolderId()===n.id;return{handler:()=>{if(n)ee.Z.setBookmarkBarFolderAndToggleVisibility(n.id);else{const e=g.Z.getRootId();void 0!==e&&ee.Z.setBookmarkBarFolderAndShow(e)}},isVisible:()=>!n||K3(n)&&!i&&!W3(n)&&!U3(n),...t(s,e,{})}}case"CONTEXT_UNSET_BOOKMARK_BAR":{const i=Boolean(n)&&C.Z.get(I.kBookmarksBarVisible)&&g.Z.getBookmarkBarFolderId()===n.id;return{handler:()=>ee.Z.setBookmarkBarFolderAndToggleVisibility(n.id),isVisible:()=>i,...t(s,e,{})}}case"CONTEXT_MOVE_TO_BOOKMARK_BAR":return{handler:()=>async function(e){const t=g.Z.getBookmarkBarFolderId();if(void 0===t)return;const n=g.Z.getItemById(t);if(!n||g.Z.isDescendantOf(n,e))return;const s=g.Z.getItemById(e);s&&s.parentId!==t&&await i.Z.bookmarks.move(e,{parentId:t})}(n.id),isVisible:()=>Boolean(n)&&!W3(n)&&!U3(n),...t(s,e,{})};case"CONTEXT_BOOKMARK":return{handler:()=>{if(n)this.bookmarkActivePage(n);else{const e=g.Z.getRootId();if(void 0!==e){const t=g.Z.getItemById(e);t&&this.bookmarkActivePage(t)}}},isVisible:()=>!W3(n),...t(s,e,{})};case"CONTEXT_BOOKMARK_ALL":return Promise.resolve({handler:()=>{if(n)this.bookmarkAllOpenPages(n);else{const e=g.Z.getRootId();if(void 0!==e){const t=g.Z.getItemById(e);t&&this.bookmarkAllOpenPages(t)}}},isVisible:()=>!W3(n),...t(s,e,{})});case"CONTEXT_EMPTY_TRASH":return{handler:()=>{ee.Z.emptyTrash()},isVisible:()=>Boolean(n)&&W3(n),...t(s,e,{})};default:return{...t(s,e,{})}}};getMenuVisibility=(e,t)=>{if(t)if(W3(t))switch(e.action){case"CONTEXT_IMPORT":case"CONTEXT_CONTAINER_SEARCH":return!0;default:return!1}else switch(e.action){case"CONTEXT_NEW_ITEM":case"CONTEXT_NEW_FOLDER":case"CONTEXT_PASTE":case"CONTEXT_EXPAND_ALL":case"CONTEXT_COLLAPSE_ALL":case"CONTEXT_IMPORT":case"CONTEXT_CONTAINER_SEARCH":return!0;case"CONTEXT_NEW_SEPARATOR":return this.props.sorting.sortOrder===ds.Z.NO_SORTING;case"CONTEXT_RENAME":return g.Z.validateForEdit(t.id);case"CONTEXT_CUT":case"CONTEXT_COPY":return!g.Z.isSeparator(t)&&!U3(t);case"CONTEXT_DELETE":return!U3(t);default:return!1}else switch(e.action){case"CONTEXT_NEW_ITEM":case"CONTEXT_NEW_FOLDER":case"CONTEXT_PASTE":case"CONTEXT_EXPAND_ALL":case"CONTEXT_COLLAPSE_ALL":case"CONTEXT_IMPORT":case"CONTEXT_CONTAINER_SEARCH":return!0;case"CONTEXT_NEW_SEPARATOR":return this.props.sorting.sortOrder===ds.Z.NO_SORTING;default:return!1}};onContextMenu=e=>{this.refTreeList.current?.onContextMenu(e)};getDropSupport=(e,t)=>{const n=t.dataTransfer.types.some((e=>zi.ZP.isUriListType(e)||"text/plain"===e||e===zi.yR));return{available:n,onto:n&&K3(e),edge:"both"}};handleExpandClick=(e,t)=>{this.refTreeList.current?.toggleSelectedExpansion(e,t)};onItemClick=(e,t)=>{e.button!==es.Z.kCenter&&this._supportSingleClick()&&!K3(t)&&void 0===this.refTreeList.current?.getInlineEditId()&&this.openWithEventModifiers(e)};onItemDoubleClick=(e,t)=>{e.button===es.Z.kCenter||this._supportSingleClick()||K3(t)||this.openWithEventModifiers(e)};onItemMouseUp=(e,t)=>{t.button===es.Z.kCenter&&(this._openInNewTab(!0),t.preventDefault(),t.stopPropagation())};openWithEventModifiers=e=>{const t=this.context.vivaldiWindowId,n=(0,La.ZP)(t,{button:e.button,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,metaKey:e.metaKey});zi.ZP.open(t,this.getSelectedBookmarks(),n,!0)};getRowComponentProps=e=>({...e,childCount:e.node.children?e.node.children.length:0,columns:this.props.columns||[],showBadge:this.state.showBadge,windowId:this.context.vivaldiWindowId});unSelectAll=()=>{this.refTreeList.current?.unSelectAll()};onSelect=async e=>{if(e){const t=g.Z.getItemById(e.id);t&&this.props.onSelect(t)}else this.props.onSelect()};onCreate=async(e,t,n,i)=>{const s=await ee.Z.createWithPromise(e,t??"",n??0),o=1===s.length&&g.Z.isSeparator(zi.ZP.convertToPrivateType(s[0]));return this.props.onCreate(!o&&i),s};onMove=(e,t)=>{const{parentId:n="",index:i}=t;return ee.Z.move(e,n,i)};handleCut=(e,t)=>{const n=t.filter(x3).map((e=>e.id));ee.Z.cut(e,n)};handleCopy=(e,t)=>{const n=t.filter(x3).map((e=>e.id));ee.Z.copy(e,n)};menu={name:"bookmarklist",getCapability:this.getMenuCapability,getVisibility:this.getMenuVisibility};render(){return(0,ss.jsx)(Ps,{ref:this.refTreeList,rowComponent:e=>(0,ss.jsx)(z3,{...e,onExpandClick:(e,t)=>this.handleExpandClick(e,t),inManager:this.props.inManager,fullView:this.props.fullView}),getRowComponentProps:this.getRowComponentProps,nodes:this.state.nodes,cutIds:this.state.cutIds,onSelect:this.onSelect,onItemClick:this.onItemClick,onItemDoubleClick:this.onItemDoubleClick,onItemMouseDown:F3,onItemMouseUp:this.onItemMouseUp,onItemsActivated:this._onNodesActivated,buildItem:this.buildItem,onCreate:this.onCreate,onSearchStyleChanged:this.onSearchStyleChanged,delete:ee.Z.remove,onMove:this.onMove,onEdit:this.props.onEdit,onCut:this.handleCut,onCopy:this.handleCopy,onImport:()=>de.Z.showImportDataDialog(this.context.vivaldiWindowId),isFolder:K3,isSeparator:g.Z.isSeparator,supportsInlineEdit:!0,menu:this.menu,mimeType:zi.yR,getDropSupport:this.getDropSupport,getDragData:g.Z.getDragData,hasChildren:$3,settings:this.props.inManager?"BOOKMARKS_MANAGER":"BOOKMARKS_PANEL",multiSelect:!this._supportSingleClick(),setCutIds:ee.Z.setCutIds,getTitle:g.Z.getTitle,saveTitle:V3,getTargetSpec:this.getTargetSpec,sorting:this.props.sorting,onDrop:this.onDrop,rootId:g.Z.getRootId(),isValidAddTarget:L3,isValidDragSource:G3,isValidToEdit:g.Z.validateForEdit,validateForDrag:g.Z.validateForDrag,validateForDeletion:g.Z.validateForDeletion,columns:this.props.columns,onRowsRendered:this.props.onRowsRendered})}}const Y3=j3;var X3;function Q3(e,t,n,i){X3||(X3="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:X3,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const q3=[{text:(0,B.Z)("Title"),value:"title",fullScreenTitle:(0,B.Z)("Sort by title"),width:300,visible:!0,key:!0},{text:(0,B.Z)("Address"),value:"url",icon:Wi.iD7,fullScreenTitle:(0,B.Z)("Sort by address"),width:300,visible:!0},{text:(0,B.Z)("Nickname"),value:"nickname",icon:Wi.vvh.small,fullScreenTitle:(0,B.Z)("Sort by nickname"),width:100,visible:!0},{text:(0,B.Z)("Description"),value:"description",icon:Wi.sWI,fullScreenTitle:(0,B.Z)("Sort by description"),width:200,visible:!0},{text:(0,B.Z)("Date Created"),value:"dateAdded",icon:Wi.V_c,fullScreenTitle:(0,B.Z)("Sort by creation date"),width:150,visible:!1}];class J3 extends Li.PureComponent{static contextType=ts.Z;refEditor=Li.createRef();refTree=Li.createRef();#Yt=!0;state={filter:"",sorting:{sortOrder:ds.Z.NO_SORTING,sortField:"manually",comparator:this.sortComparator},columns:vs().bookmarks||ys(q3)};componentDidMount(){const e=C.Z.get(I.kBookmarksManagerSorting);this.onSortChange(e.sortOrder,e.sortField)}componentDidUpdate(e){this.props.highlightId&&e.highlightId!==this.props.highlightId&&(this.#Yt=!0,this.#Xt())}#Qt=()=>{this.#Xt()};#Xt=()=>{const{highlightId:e}=this.props;this.#Yt&&e&&this.refTree.current?.expandAndHighlight(e),this.#Yt=!1};onSortChange=(e,t)=>{const n={sortOrder:e,sortField:t,comparator:this.sortComparator};this.setState({sorting:n});const i={sortOrder:e,sortField:t};w.Z.set(I.kBookmarksManagerSorting,i)};sortComparator=(e,t)=>g.Z.treeSortComparator(e,t,this.state.sorting);importData=()=>{de.Z.showImportDataDialog(this.context.vivaldiWindowId)};focusTree=()=>{this.refTree.current?.refTreeList.current?.focusTree()};onSelect=e=>{this.refEditor.current?.setItem(e)};onCreate=e=>{e&&this.setState({filter:""},(()=>{this.refEditor.current?.setIsCreating(!0),this.onSelect(this.getSelectedItem())}))};onEditorCanceled=(e,t)=>{const n=this.refTree.current;n&&t&&e?n.deleteSelectedItems()?.then((()=>{i.Z.bookmarks.remove(e),this.focusTree()})):this.focusTree()};onUpdateRow=e=>{this.setState({columns:e})};onSaveRow=()=>{fs(this.state.columns,"bookmarks")};getSelectedItem=()=>this.refTree.current?.getSelectedItem();deleteItem=()=>{this.refTree.current?.deleteSelectedItems()};_updateThumbnails=()=>{const e=[],t=this.refTree.current?.getSelectedBookmarks();if(t)for(const n of g.Z.iterateTrees(t,!0))n.url&&e.push({id:n.id,url:n.url});Ho.updateForBookmarks(e)};onSearchChange=e=>{this.setState({filter:e.target.value})};createBookmark=()=>{this.refTree.current?.onAdd(!1)};createFolder=()=>{this.refTree.current?.onAdd(!0)};onContextMenu=e=>{e.nativeEvent.buttons>0&&this.refTree.current?.unSelectAll(),this.refTree.current?.onContextMenu(e)};render(){return Q3("div",{className:"bookmark manager"},void 0,Q3("div",{className:"toolbar toolbar-default",role:"toolbar","aria-label":(0,B.Z)("toolbar label","Bookmark Actions")},void 0,Q3("input",{value:this.state.filter,onChange:this.onSearchChange,type:"search",tabIndex:"0",placeholder:(0,B.Z)("verb","Search")}),Q3("div",{className:"toolbar-group"},void 0,Q3(po.ZP,{onClick:this.createBookmark,image:Wi.md4.small,tooltip:(0,B.Z)("New Bookmark")}),Q3(po.ZP,{onClick:this.deleteItem,image:Wi.M2k.small,tooltip:(0,B.Z)("other","Delete")})),Q3(po.ZP,{onClick:this.createFolder,image:Wi._TQ.small,title:(0,B.Z)("command","New Folder")}),Q3("div",{className:"toolbar-group",style:{marginLeft:"auto"}},void 0,Q3(po.ZP,{onClick:this.importData,image:Wi.feZ.small,title:(0,B.Z)("Import...")}),Q3(po.ZP,{onClick:this._updateThumbnails,image:Wi.GO5.small,title:(0,B.Z)("Update Thumbnails")}))),Q3("div",{className:"manager-content"},void 0,Q3("div",{className:"manager-treeview"},void 0,Q3(Mm,{fields:q3,onSortChange:this.onSortChange,fullsize:!0,sortField:this.state.sorting.sortField,sortOrder:this.state.sorting.sortOrder,columns:this.state.columns,onUpdateRow:this.onUpdateRow,onSaveRow:this.onSaveRow,keyAccess:C.Z.get(I.kKeyboardTabToAll)}),Q3("div",{className:"vivaldi-tree-container",onContextMenu:this.onContextMenu},void 0,(0,ss.jsx)(Y3,{filter:this.state.filter,ref:this.refTree,fullView:!0,inManager:!0,onEdit:this.onSelect,onSelect:this.onSelect,onCreate:this.onCreate,sorting:this.state.sorting,columns:this.state.columns,onRowsRendered:this.#Qt}))),(0,ss.jsx)(N3,{ref:this.refEditor,getSelectedItem:this.getSelectedItem,onCancel:this.onEditorCanceled,onFocusTree:this.focusTree})))}}const e2=J3;var t2=n(56284);class n2 extends t2.Z{#qt=(new Date).getDate();#C;addListener(e){super.addListener(e),this.#C||this.#Z()}removeListener(e){super.removeListener(e),0===this._listeners.size&&(clearTimeout(this.#C),this.#C=null)}#Z(){this.#C=setTimeout((()=>{const e=(new Date).getDate();e!==this.#qt&&(this.#qt=e,this.emitChange()),this.#Z()}),me.lb)}}const i2=new n2;var s2=n(34930),o2=n(9126),a2=n(47543);const r2=function(e,t){const n=Li.useContext(ts.Z).vivaldiWindowId,i=Li.useCallback((t=>t.get(e)),[e]),s=(0,DD.Z)(Wp.Z,i).get(e),o=!!t?.filter,[a,r]=Li.useState(t?.filter),l=a||(s??(0,o2.l)(e)),d=Li.useRef(),[c,u]=Li.useState((()=>{if(t?.draft){const n=Zl.ZP.initializeEvent(e,t?.draft);return d.current=structuredClone(n),n}})),p=Li.useRef();p.current=c;const h=Li.useRef();h.current=a;const g=Li.useRef(d.current),m=Li.useRef(),f=Li.useRef(!1);Li.useEffect((()=>{bO.Z.init(e)}),[e]);const{anchorDate:v,allDaySelected:y,displayMode:b,filterText:S,selectedEvent:w,selectedDate:A}=l,{accounts:T,calendars:Z,events:E,tasks:k,currentEdit:_}=(0,DD.Z)(El.Z),N=Li.useCallback((function(){if(A&&A.valueOf()<(new Date).valueOf()){const t=W()().hour(A.hour()).minute(A.minute());if(o&&h.current){const n=bO.Z.selectDate(e,t,{allDay:y,setToday:!0,filter:h.current});r(n)}else bO.Z.selectDate(e,t,{allDay:y,setToday:!0})}}),[e,y,A,o]);Li.useEffect((()=>{function e(){N()}return i2.addListener(e),()=>{i2.removeListener(e)}}),[N]);const P=Li.useCallback((function(t){d.current?.id===_.eventId&&n===_.windowId&&e===_.pageId&&te.ZP.updateEditState(n,e,null);const i=t||p.current?.id;if(d.current=null,p.current=null,u(),o&&h.current){const t=bO.Z.selectEvent(e,{eventId:i,filter:h.current});r(t)}else bO.Z.selectEvent(e,{eventId:i})}),[n,e,_,o]),D=Li.useCallback((async function(){if(!p.current)return;const t=p.current.id,n=await te.ZP.saveEvent(p.current,d.current,e);return await new Promise((e=>setTimeout(e,1))),n.clearDraft&&!f.current&&P(t||n.event?.id),f.current=!1,n.event}),[P,e]),M=Li.useCallback((async function(e){"cancel"===C.Z.get(I.kCalendarClickOutside)?P():await D(),e&&(u(e),d.current=e)}),[P,D]),O=Li.useCallback((async function(t){p.current&&await M(),o&&h.current?r(bO.Z.selectEvent(e,{...t,filter:h.current})):bO.Z.selectEvent(e,t)}),[e,M,o]),x=Li.useCallback((function(e){const{eventDraft:t,cache:n}=function(e,t,n,i){let s=t?.start!==e.start||t?.end!==e.end?null:n;if(t&&t.task!==e.task)if(s=n?null:{start:e.start,end:e.end},e.task)n?(e.start=n.start,e.end=n.end):(e.end=e.start,e.start=0);else if(n&&e.end===n.start&&(e.start=n.start,e.end=n.end),!e.start){const t=C.Z.get(I.kCalendarDefaultDuration);e.end?e.start=e.end-t:(i.selectedDate?e.start=(0,ih.zX)(i.selectedDate.valueOf()):e.start=(0,ih.zX)(Date.now()),e.end=e.start+t)}return n&&t&&!t.start&&e.start&&n.start===e.end&&(e.start=n.start,e.end=n.end),t&&t.allDay!==e.allDay&&(e.allDay?e.start&&e.end&&(e.end=e.end+me.hd):(e.start&&e.end&&(e.end=e.end-me.hd),e.timezone===me.$T&&(e.timezone=""))),{eventDraft:e,cache:s}}(e,g.current,m.current,l);m.current=n;const i=function(e,t,n){if(n.filterText&&""===e.id&&(e.filteredOut=!Zl.ZP.eventHasText(e,n.filterText)&&"DELETE"!==Zl.ZP.shouldSaveEvent(e)),n.calendarIds.size&&!n.calendarIds.has(e.calendarId)&&(e.filteredOut=!0),!e.organizer&&e.invites?.length){const{invites:t}=e,n=s2.Z.getOrganizerForEvent(e);e.organizer=n,n&&!t.find((e=>e.address===n))&&t.push({id:"",event_id:e.id,address:n,partstat:"ACCEPTED"})}const{calendarId:i,task:s}=e;let{account:o,calendar:a}=Zl.ZP.getAccountAndCalendar(i);return(s&&!a?.supportedCalendarComponent.vtodo||!s&&!a?.supportedCalendarComponent.vevent)&&(e.calendarId=Zl.ZP.getDefaultCalendar(s)?.id||"",({account:o,calendar:a}=Zl.ZP.getAccountAndCalendar(i))),"google"===o?.account_type&&s&&(e.allDay=!0,e.timezone=me.$T),!e.rrule||e.start||e.end||(e.rrule=""),e}(t,g.current,l);u({...i}),g.current=i}),[l]),L=Li.useCallback((function(t,n){if(p.current&&M(),o&&h.current){const i=h.current,s=w?bO.Z.selectEvent(e,{date:t,allDay:n,filter:i}):bO.Z.selectDate(e,t,{allDay:n,filter:i});r(s)}else w?bO.Z.selectEvent(e,{date:t,allDay:n}):bO.Z.selectDate(e,t,{allDay:n})}),[e,w,M,o]),R=Li.useCallback((async function(t,i){const s=i?Zl.ZP.initializeEvent(e,i):structuredClone(t);if(Zl.ZP.doesCalendarsExistsAndShowWarning(n,s?.task)&&(p.current&&(p.current.uid===s?.uid?P():await M(),await new Promise((e=>setTimeout(e,1)))),u(s),d.current=structuredClone(s),g.current=d.current,m.current=null,te.ZP.updateEditState(n,e,s?.id),s)){const{start:e,end:t}=s,n=!!s.allDay||l.allDaySelected;if(e&&t&&e!==t){const i=A?.valueOf()??0;if(i<e||i>t){Zl.ZP.getDisplayRange(v,b).contains(e)&&L(W()(e),n)}}else(e||t)&&L(W()(e||t),n)}}),[n,e,P,M,L,v,b,A,l.allDaySelected]),B=Li.useCallback((function(t){o&&h.current?r(bO.Z.setCalendarIds(e,t,{filter:h.current})):bO.Z.setCalendarIds(e,t)}),[e,o]),F=Li.useCallback((function(){o&&h.current?r(bO.Z.showCompletedTasks(e,{filter:h.current})):bO.Z.showCompletedTasks(e)}),[e,o]),U=Li.useRef({selectDate:L,selectEvent:O,selectCalendars:B,toggleShowCompleted:F,editEvent:R,updateEventEdit:x,saveEventEdit:D,endEventEdit:M,cancelEventEdit:P});U.current.selectDate=L,U.current.selectEvent=O,U.current.editEvent=R,U.current.updateEventEdit=x,U.current.saveEventEdit=D,U.current.endEventEdit=M,U.current.cancelEventEdit=P,!c||n===_.windowId&&e===_.pageId||M();const{calendarIds:V,showTasks:H}=l,G=Li.useMemo((()=>new Set(Z.filter((e=>!e.hidden&&(0===V.size||V.has(e.id)))).map((e=>e.id)))),[Z,V]),[$,K]=Li.useMemo((()=>{const e=E.filter((e=>G.has(e.calendarId)&&(H||!e.task)));return(0,px.Z)(e,(e=>!e.trash))}),[E,G,H]),z=mh.tV.call($,v,b),j=Li.useMemo((()=>S?["agenda","year"].includes(b)?z.filter((e=>Zl.ZP.eventSearchPredicate(e,S))):z.map((e=>Zl.ZP.eventSearchPredicate(e,S)?e:{...e,filteredOut:!0})):z),[b,S,z]),{showCompletedTasks:Y}=l,X=Li.useMemo((()=>{const e=new Set;for(const t of k)if(t.recurrenceExceptions)for(const n of t.recurrenceExceptions)e.add(n.exception_event_id);return k.flatMap((t=>{if(t.trash||e.has(t.id)||t.complete&&!Y||!G.has(t.calendarId))return[];const{rrule:n,timezone:i}=t;if(!n)return t;let s=(0,ih.oJ)(t);if(!t.recurrenceExceptions?.length&&s)return{...t,id:`${t.id}:${(0,ih.oJ)(t)}`};const o=(0,a2.Qj)(n,i,s);if(!s||!o)return t;const a=new Set((t.recurrenceExceptions??[]).map((e=>e.date)));let r=[];const l=[];do{const e=new Date(s),n=new Date(8e15);r=(0,a2.qh)(o,e,n,100,t.timezone);for(const e of r){a.delete(e.valueOf());const n=(0,mh.Km)(e,t);if(n.event)if(n.event.complete&&Y)l.push(n.event);else if(!n.event.complete)return l.push(n.event),a.size&&Y&&a.forEach((e=>{const n=(0,mh.Km)(new Date(e),t);n.event?.complete&&l.push(n.event)})),l}s=r.length&&r[r.length-1].valueOf()+1e3}while(r.length);return l}))}),[k,G,Y]),Q=Li.useMemo((()=>S?X.filter((e=>Zl.ZP.eventSearchPredicate(e,S))):X),[X,S]),q=""===d.current?.id,J=Li.useMemo((()=>{const e=d.current;return q&&e?e.uid?[...j.filter((t=>t.uid!==e.uid)),e]:[...j,e]:j}),[j,q]),ee=Li.useMemo((()=>q&&d.current?.task?[...Q,d.current]:Q),[Q,q]);if(l.editing){if(l.selectedEvent===c?.id)f.current=!0;else{const e=z.find((e=>e.id===l.selectedEvent));setTimeout((()=>R(e)),1)}o&&h.current?r(bO.Z.selectEvent(e,{eventId:l.selectedEvent,edit:!1,filter:h.current})):bO.Z.selectEvent(e,{eventId:l.selectedEvent,edit:!1})}return{stateHandler:U.current,calendarFilter:l,eventDraft:c,accounts:T,calendars:Z,events:J,trashedEvents:K,tasks:ee,hasTasks:k.length>0}};var l2,d2=n(87852);function c2(e,t,n,i){l2||(l2="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:l2,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const u2=[I.kCalendarDisplayDensity],p2={allDaySelected:!1,anchorDate:W()(),calendarIds:new Set,displayMode:"day",editing:!1,filterText:"",selectedDate:W()(),selectedEvent:"",showCompletedTasks:!1,showTasks:!0};const h2=function(e){const t=(0,Ya.Z)(u2)[I.kCalendarDisplayDensity],{anchorDate:n,displayMode:i,pageId:s}=e,o=r2(d2.Q9,{filter:p2}),a=!!o.eventDraft,r=Li.useMemo((()=>{const e={...o.stateHandler,selectDate:function(e,t){bO.Z.selectDate(s,e,{allDay:t})}};return{pageId:d2.Q9,displayDensity:t,isPanel:!0,isEditing:a,isWidget:!1,isTaskList:"agenda"===i,handler:e}}),[t,i,o.stateHandler,a,s]);Li.useEffect((()=>{o.stateHandler.selectDate(n)}),[n,o.stateHandler]);const l=o.calendarFilter.selectedDate??n;return c2("div",{className:"manager-detail"},void 0,c2("div",{className:"header"},void 0,c2("h1",{},void 0,"agenda"===i?(0,B.Z)("Tasks"):l.format(R.ZP.getWeekdayFormat("LL")))),c2(yM.Provider,{value:r},void 0,c2(DL,{filter:o.calendarFilter,events:"agenda"===i?o.tasks:o.events,trashedEvents:o.trashedEvents,anchorDate:l,displayMode:"agenda"===i?"agenda":"day",eventDisplayStyle:"solid",editingEvent:o.eventDraft})),"agenda"===i&&c2("div",{className:"footer cal-tasks"},void 0,c2("label",{},void 0,c2("input",{type:"checkbox",checked:o.calendarFilter.showCompletedTasks,onChange:o.stateHandler.toggleShowCompleted}),c2("span",{},void 0,(0,B.Z)("Show Completed Tasks")))))};var g2,m2=n(29940);function f2(e,t,n,i){g2||(g2="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:g2,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class v2 extends Li.Component{cache={};state={eventsToRender:[],resultCount:0};static contextType=yM;density="";listRef=Li.createRef();constructor(e,t){super(e),this.cache=new m2.t1({defaultHeight:50}),this.density=t?.displayDensity}static getDerivedStateFromProps=(e,t)=>{const n=El.Z.getEvents()||[],i=Zl.ZP.searchEvents(n,e.filterText).reduce(((e,t)=>{const n=(0,ih.oJ)(t),i=n?W()(n).startOf("day").valueOf():0,s=e.findIndex((e=>e.timestamp===i));return-1===s?e.push({timestamp:i,events:[t]}):e[s].events.unshift(t),e}),[]),s=i.reduce(((e,t)=>e+t.events.length),0);return{eventsToRender:i,resultCount:s}};componentDidUpdate(e,t){this.props.filterText===e.filterText&&this.density===this.context?.displayDensity||(this.cache.clearAll(),this.density=this.context?.displayDensity,this.listRef.current?.forceUpdateGrid())}selectEvent=e=>{const t=W()(e.start);this.context.handler.selectDate(t)};setSelectedIndex=e=>{const{selectedEvent:t}=this.props,{eventsToRender:n}=this.state,i=n.flatMap((e=>e.events));if(t){let n=i.findIndex((e=>e.id===t));"Up"===e?n=Math.max(0,n-1):"Down"===e&&(n=Math.min(i.length-1,n+1)),this.context.handler.selectEvent({event:i[n]})}else this.context.handler.selectEvent({event:i[0]})};onKeyDown=e=>{switch(OM.Z[e.keyCode]){case"Up":case"Down":this.setSelectedIndex(OM.Z[e.keyCode])}};renderDay=({index:e,parent:t,key:n,style:i})=>{const{eventsToRender:s}=this.state;if(0===s.length)return;const o=s[e],a=o.events.map(((e,t)=>this.renderEvent(e))),r=W()(o.timestamp);return f2(m2.Z8,{cache:this.cache,parent:t,columnIndex:0,rowIndex:e},n,f2("div",{className:"cal-tasks-row",style:i},void 0,f2("div",{className:"cal-tasks-row-date"},void 0,f2("span",{className:"cal-tasks-row-dow"},void 0,r.format("dddd")),f2("span",{className:"cal-tasks-row-doy"},void 0,r.format("ll"))),f2("div",{className:Fi()("cal-tasks-row-events")},void 0,a)))};eventClick=e=>{this.props.onSelectEvent(e.id)};renderEvent=e=>{const t=Zl.ZP.isMultiDayEvent(e),{selectedEvent:n}=this.props,i=n===e.id,s=!!this.props.editingEvent&&this.props.editingEvent.id===e.id,o=Zl.ZP.isRecurringEvent(e),a=Boolean(this.props.filterText);let r;if(o){const t=e.rrule&&(0,a2.Qj)(e.rrule,e.timezone,e.start);if(t){const e=(0,YM.p)(t),n=(0,a2.qh)(t,new Date,W()().add(1,"y").toDate(),3).map((e=>W()(e).format("LL")));r=`${(0,B.Z)("Next occurrences:")}\n          ${n.join(", ")}. ${e}.`}}return f2("div",{onClick:this.eventClick.bind(null,e),className:"event-container"},e.id,f2(sx,{event:e,displayStyle:"transparent",isSelected:i,isEditing:s,isMultiDay:t,isFiltering:a}),r&&f2("div",{},void 0,r))};render(){return f2("div",{className:"manager-content search-result"},void 0,f2("div",{className:"calendar-viewport",onFocus:this.props.onFocus},void 0,f2("style",{},void 0,Zl.ZP.getCalendarColors()),f2("div",{className:"search-results"},void 0,(0,B.Z)("$1 result for “$2”","$1 results for “$2”",[this.state.resultCount,this.props.filterText]),f2("button",{onClick:this.props.onClose},void 0,f2("span",{dangerouslySetInnerHTML:{__html:Wi.kze}}))),f2("div",{className:"calendar-grid-agenda search-results-list",onKeyDown:this.onKeyDown},void 0,f2(Z$.q,{},void 0,(({height:e,width:t})=>(0,ss.jsx)(ws.aV,{ref:this.listRef,width:t,height:e,defferredMeasurementCache:this.cache,rowHeight:this.cache.rowHeight,rowRenderer:this.renderDay,rowCount:this.state.eventsToRender.length}))))))}}const y2=v2;var b2,S2=n(98035);function w2(e,t,n,i){b2||(b2="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:b2,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class C2 extends Li.PureComponent{static contextType=yM;undeleteEvent=e=>{te.ZP.restoreEvent(this.context.pageId,e)};undo=()=>{const{trashedEvents:e}=this.props;e.length>0&&this.undeleteEvent(e[0])};trimTitle=e=>(e.length>70&&(e=e.substring(0,70)+"..."),e);getContextMenuItems=()=>this.props.trashedEvents.sort(((e,t)=>(t.trash_time||0)-(e.trash_time||0))).map((e=>({mnemonic:!1,url:e.id,handler:this.undeleteEvent.bind(this,e),...Qe.Z.makeLabelPair(e.title||eh.gT)}))).filter(Boolean).concat([Qe.Z.separatorItem,{handler:this.clearAll,...(0,us.Z)("other","Clear All")}]);clearAll=()=>{const{trashedEvents:e}=this.props;e.forEach((e=>{const{id:t,syncPending:n}=e;n?S2.Z.updateEvent({id:t,deletePending:!0}):te.ZP.deleteEvent(t)}))};onDrop=e=>{const t=e.dataTransfer.getData(ox);if(t){e.preventDefault(),e.stopPropagation();const n=JSON.parse(t),{id:i}=n;te.ZP.trashEvent(i)}};render(){return w2(po.ZP,{className:"toggle-trash",onDrop:this.onDrop,onDragEnter:Lr.Z,disabled:0===this.props.trashedEvents.length,image:Wi.nre.small,onMiddleClick:this.undo,menu:this.getContextMenuItems,menuOrigin:"bottomLeft",mimeType:ox,edgeAmount:0,tooltip:(0,B.Z)("Trashed Events")})}}const A2=C2;var I2;function T2(e,t,n,i){I2||(I2="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:I2,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Z2=e=>{te.ZP.toggleCalendarVisibility(e)},E2=e=>{const{key:t}=e;" "!==t&&"Enter"!==t||e.target.dispatchEvent(new Event("click",{bubbles:!0}))};var k2=T2("div",{className:"CalendarPicker-Separator"}),_2=T2("div",{className:"CalendarPicker-Separator"}),N2=T2("div",{className:"CalendarPicker-Separator"});const P2=function(e){const t=Li.useRef(),n=Li.useRef(),i=Li.useRef(),s=Li.useRef(!1),o=Li.useRef(),a=Li.useContext(ts.Z),{document:r}=a,[l,d]=Li.useState(!1);Li.useEffect((()=>(t.current&&t.current.focus(),()=>{o.current&&clearTimeout(o.current)})),[]);const c=e=>{te.ZP.setDefaultCalendarId(e),t.current&&t.current.focus()},u=e=>{e.currentTarget.focus();const t=e.currentTarget.classList.contains("CalendarPicker-Item--Submenu")||e.currentTarget.closest(".CalendarPicker-Item--Submenu");t?l?o.current&&(o.current=clearTimeout(o.current)):d(!0):!t&&l&&(o.current=setTimeout((()=>{d(!1),o.current=null}),500))},p=e=>{t.current&&t.current.focus()},h=Zl.ZP.getDefaultCalendar()?.id,g=s.current;s.current=!1;const{accounts:m,calendars:f}=e,v=[],y=[];let b=!1;return m.forEach((e=>{const t=f.filter((t=>t.accountId===e.id));v.push({account:e,calendars:t}),e.url&&t.length&&(b=!0),"ical"!==e.account_type&&y.push(...t)})),v.sort(((e,t)=>"local"===e.account.account_type?-1:"local"===t.account.account_type?1:0)),(0,ss.jsxs)("div",{className:"CalendarPicker",onKeyDown:e=>{const o=r.activeElement,{key:a}=e;if(o&&o.classList.contains("CalendarPicker-Item")){if(o){const e=((e,t)=>{const n=e.parentElement&&e.parentElement.children;return n&&n.length?[...n].filter((e=>e.classList.contains(t))):[]})(o,"CalendarPicker-Item"),n=e.indexOf(o);if(0===e.length||-1===n)return;if("ArrowDown"===a)e[(n+1)%e.length].focus();else if("ArrowUp"===a)e[(n-1+e.length)%e.length].focus();else if("ArrowLeft"===a){if(l&&t.current){const e=t.current.querySelector(".CalendarPicker-Item--Submenu");e&&e.focus(),d(!1)}}else if("ArrowRight"===a&&o.classList.contains("CalendarPicker-Item--Submenu"))if(l){const e=o.querySelectorAll(".CalendarPicker-Item");e.length&&e[0].focus()}else d(!0),s.current=!0}}else"ArrowUp"===a?i.current&&i.current.focus():"ArrowDown"===a&&(n.current?n.current.focus():i.current&&i.current.focus())},ref:t,tabIndex:0,children:[e.calendars.length>0&&(0,ss.jsxs)(ss.Fragment,{children:[v.map((e=>T2(Li.Fragment,{},e.account.id,v.length>1&&T2("h3",{className:"CalendarPicker-Account"},void 0,"local"===e.account.account_type?(0,B.Z)("Local Calendars"):e.account.name||e.account.url),!!e.calendars.length&&e.calendars.map(((e,t)=>{const i=Zl.ZP.createCalendarIcon(e,16,!e.hidden);return(0,ss.jsxs)("button",{onMouseEnter:u,onMouseLeave:p,className:"CalendarPicker-Item",onClick:Z2.bind(null,e.id),ref:0===t?n:null,children:[T2("span",{className:"CalendarPicker-Icon",dangerouslySetInnerHTML:{__html:i}}),T2("span",{className:Fi()("CalendarPicker-Title",{"CalendarPicker-Title--Default":e.id===h})},void 0,Zl.ZP.getCalendarDisplayName(e))]},e.id)})),!e.calendars.length&&T2("div",{},void 0,T2("span",{className:"CalendarPicker-Title"},void 0,(0,B.Z)("No Calendars")))))),y.length>0&&(0,ss.jsxs)(ss.Fragment,{children:[k2,T2("div",{className:"CalendarPicker-Item CalendarPicker-Item--Submenu",onClick:()=>d(!l),onMouseEnter:u,onMouseLeave:p,onKeyUp:E2,tabIndex:0},void 0,T2("span",{className:"CalendarPicker-Title"},void 0,(0,B.Z)("Default Calendar")),T2("span",{className:"CalendarPicker-SubmenuIcon",dangerouslySetInnerHTML:{__html:Wi.nfH}}),l&&T2("div",{className:"CalendarPicker-Submenu"},void 0,y.map(((e,t)=>{const n=h===e.id,i=Zl.ZP.createCalendarIcon(e,16,n);return T2("button",{className:"CalendarPicker-Item",onClick:c.bind(null,e.id),onMouseEnter:u,onMouseLeave:p,autoFocus:0===t&&g},e.id,T2("span",{className:"CalendarPicker-Icon",dangerouslySetInnerHTML:{__html:i}}),T2("span",{className:"CalendarPicker-Title"},void 0,Zl.ZP.getCalendarDisplayName(e,!0)))}))))]}),_2]}),T2("button",{className:"CalendarPicker-Item",onClick:()=>{de.Z.showCreateCalendarDialog(a.vivaldiWindowId),e.requestClose&&e.requestClose()},onMouseEnter:u,onMouseLeave:p},void 0,T2("span",{className:"CalendarPicker-Icon",dangerouslySetInnerHTML:{__html:Wi.md4.medium}}),T2("span",{className:"CalendarPicker-Title"},void 0,(0,B.Z)("verb","New Calendar"))),b&&(0,ss.jsxs)(ss.Fragment,{children:[T2("button",{className:"CalendarPicker-Item",onClick:async()=>{e.requestClose&&e.requestClose(),te.ZP.pollAllCalDAVAccountsWithStatus()},onMouseEnter:u,onMouseLeave:p},void 0,T2("span",{className:"CalendarPicker-Icon",dangerouslySetInnerHTML:{__html:Wi.GO5.medium}}),T2("span",{className:"CalendarPicker-Title"},void 0,(0,B.Z)("Refresh"))),N2]}),(0,ss.jsxs)("button",{className:"CalendarPicker-Item",onClick:()=>{de.Z.showSettings(a.vivaldiWindowId,"calendar"),e.requestClose&&e.requestClose()},onMouseEnter:u,onMouseLeave:p,ref:i,children:[T2("span",{className:"CalendarPicker-Icon",dangerouslySetInnerHTML:{__html:Wi.bqs.medium}}),T2("span",{className:"CalendarPicker-Title"},void 0,(0,B.Z)("Calendar Settings"))]})]})};var D2;function M2(e,t,n,i){D2||(D2="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:D2,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const O2={width:"auto",minWidth:"unset"};const x2=function(e){const[t,n]=Li.useState(!1);return(0,ss.jsx)(ss.Fragment,{children:M2("div",{className:"toolbar-dropdown-container"},void 0,M2(po.ZP,{image:Wi.bcq.small,isPressed:t,onClick:()=>n(!t),popupPosition:"below",hidePopup:Lr.Z,title:(0,B.Z)("Calendars"),isMenuIndicatorVisible:!0,isMenuIndicatorDisabled:!0}),t&&M2(ra.Z,{style:O2,className:"calendar-picker",onRequestClose:e=>{e&&e.target.addEventListener("click",ms.ZP,{once:!0}),n(!1)},label:(0,B.Z)("Calendar Picker")},void 0,M2(P2,{accounts:e.accounts,calendars:e.calendars,requestClose:()=>n(!1)})))})};var L2,R2=n(46884);function B2(e,t,n,i){L2||(L2="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:L2,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const{searchEvents:F2}=Zl.ZP,W2={events:[],count:0,totalCount:0};var U2=B2("br",{});const V2=function(e){const t=Li.useContext(ts.Z),n=Li.useContext(yM),{document:i}=t,[s,o]=Li.useState(!1),[a,r]=Li.useState(W2),[l,d]=Li.useState(-1),c=Li.useRef(),u=Li.useRef();Li.useEffect((()=>{s&&c.current?.focus()}),[s]),Li.useEffect((()=>{function e(e){e===t.vivaldiWindowId&&(u.current?.focus(),o(!0))}return Oa.Z.addListener("COMMAND_CALENDAR_SEARCH",e),()=>{Oa.Z.removeListener("COMMAND_CALENDAR_SEARCH",e)}}),[t.vivaldiWindowId]);const p=t=>{m(),e.onSelectEvent(t)},h=()=>{m(),e.onShowSearchResults()},g=t=>{const n=El.Z.getEvents()||[];let i=F2(n,t||e.filterText);const s=i.length;return s>10&&(i=i.slice(0,10)),{events:i,count:i.length,totalCount:s}},m=()=>{o(!1),d(-1)},f=t=>{switch(OM.Z[t.keyCode]){case"Enter":r(g()),o(!0);break;case"Escape":e.onSearchChange(""),o(!1)}},v=n.isPanel?(0,B.Z)("verb","Search"):(0,B.Z)("Filter and Search"),y=Li.useRef(null),b=Li.useCallback((()=>m),[]),S=Li.useCallback((()=>y.current),[]);return(0,R2.Z)(S,b),(0,ss.jsxs)("div",{ref:y,className:"toolbar-group FilterAndSearch",children:[(0,ss.jsx)("input",{type:"search",className:"FilterAndSearch-Input no-page-focus",tabIndex:"0",ref:u,placeholder:v,title:(0,B.Z)("Type to filter. Press enter or click button to search."),value:e.filterText,onChange:t=>{const{value:n}=t.target;e.onSearchChange(n),""===n&&m(),s&&r(g(n))},onKeyDown:f}),B2("input",{className:"FilterAndSearch-Button",type:"button",disabled:0===e.filterText.length,onClick:h,value:(0,B.Z)("verb","Search")}),s&&(0,ss.jsxs)("div",{className:"SearchDropdown",ref:c,tabIndex:"0",onFocus:e=>{e.target===c.current&&l<0&&d(0)},onKeyDown:e=>{switch(OM.Z[e.keyCode]){case"Space":case"Enter":l>=0&&l<a.count&&(p(a.events[l].id),e.stopPropagation());break;case"Escape":m(),u.current&&u.current.focus();break;case"Up":d((e=>Math.max(0,e-1)));break;case"Down":d((e=>Math.min(a.count-1,e+1)));break;case"Tab":i.activeElement===c.current&&(!e.shiftKey&&l<a.count-1?(d((e=>e+1)),e.preventDefault()):e.shiftKey&&l>0&&(d((e=>e-1)),e.preventDefault()))}},children:[0===a.count&&B2("div",{className:"SearchDropdown-NoItems"},void 0,(0,B.Z)("No events found")),a.count>0&&B2("ul",{},void 0,a.events.map(((t,n)=>{const i=El.Z.getCalendars(),{title:s,id:o}=t,{start:a,end:r}=(0,ih.aE)(t),c=i.find((e=>e.id===t.calendarId)),u=c?Zl.ZP.createCalendarIcon(c,9):"";return B2("li",{className:Fi()("SearchDropdown-Item",{"SearchDropdown-Item--Selected":l===n}),onKeyDown:f,onMouseUp:()=>p(o),onMouseOver:()=>d(n)},n,B2("div",{className:"SearchDropdown-ItemEvent"},void 0,B2("p",{className:"SearchDropdown-ItemEventTitle"},void 0,(0,yr.CH)(s,e.filterText))),B2("div",{className:"SearchDropdown-ItemMetaData"},void 0,B2("div",{className:"SearchDropdown-ItemIcon"},void 0,B2("span",{dangerouslySetInnerHTML:{__html:u}})),B2("p",{className:"SearchDropdown-ItemEventCalendar"},void 0,!!c&&Zl.ZP.getCalendarDisplayName(c,!0)),!!t.end&&B2("div",{className:"SearchDropdown-ItemDate"},void 0,function(e,t){if(e.valueOf()&&t.isAfter(e,"day"))return(0,B.Z)("$1 - $2 $3",[e.format(R.ZP.getShortDateFormat()),t.format(R.ZP.getShortDateFormat()),e.format("YYYY")]);const n=e.valueOf()?e:t;return(0,B.Z)("$1. $2",[n.format("ddd"),n.format("ll")])}(a,r),U2,!t.allDay&&function(e,t){return e.valueOf()?`${e.format("LT")}-${t.format("LT")}`:t.format("LT")}(a,r))))}))),a.count!==a.totalCount&&B2("div",{className:"SearchDropdown-MoreItems"},void 0,(0,B.Z)("More results, showing first $1 items out of $2 total.",[a.count,a.totalCount])),a.count>0&&B2("input",{className:"SearchDropdown-Button",type:"button",onClick:h,value:(0,B.Z)("Go to Search Results")})]})]})};var H2;function G2(e,t,n,i){H2||(H2="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:H2,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function $2(e){return"day"===e||"week"===e?"month":"year"}const K2=function(e){const{document:t,HTMLElement:n}=Li.useContext(ts.Z),i=Li.useRef(),s=Li.useRef(),o=Li.useRef(e.initialPeriod),a=(0,Ya.Z)([I.kKeyboardTabToAll]),[r,l]=Li.useState(e.mode),[d,c]=Li.useState((()=>e.initialPeriod.clone()));function u(){const e="year"===r?12:1,t=$2(r);c(d.clone().subtract(e,t))}function p(){const e="year"===r?12:1,t=$2(r);c(d.clone().add(e,t))}function h(t){e.setPeriod(t),e.requestClose()}function g(t){r===e.mode?h(t):(c(t),l(e.mode))}function m(e){const t=e.currentTarget;if(t instanceof n){const e=t.dataset.period;g("month"===r?d.clone().month(parseInt(e)):d.clone().year(parseInt(e)))}}function f(t){if("number"==typeof t.keyCode){const e=OM.Z[t.keyCode];if(t.repeat||"Space"!==e&&"Enter"!==e)return}t.stopPropagation(),t.preventDefault(),l(r===e.mode?$2(r):e.mode)}Li.useEffect((()=>(i.current=t.activeElement,s.current?.focus(),c(e.initialPeriod.clone()),l(e.mode),()=>{i.current?.focus()})),[t,e.initialPeriod,e.mode]);const v=d.year()-d.year()%12;let y="",b="",S="",w="";switch(r){case"year":b=(0,B.Z)("Previous Years"),S=(0,B.Z)("Next Years"),y=`${v} - ${v+11}`;break;case"month":b=(0,B.Z)("Previous Year"),S=(0,B.Z)("Next Year"),w="month"===e.mode?(0,B.Z)("Show Years"):(0,B.Z)("Show Month"),y=d.format("YYYY");break;case"week":case"day":b=(0,B.Z)("Previous Month"),S=(0,B.Z)("Next Month"),w=e.mode===r?(0,B.Z)("Show Year"):(0,B.Z)("Show Month"),y=d.format("MMMM YYYY")}let C="";if(d!==o.current){let e=!1;if("year"===r){Math.floor(o.current.year()/12)!==Math.floor(d.year()/12)&&(e=!0)}else{const t=$2(r);o.current.isSame(d,t)||(e=!0)}e&&(C=o.current.valueOf()<d.valueOf()?"DatePickerPopup-Contents--Increase":"DatePickerPopup-Contents--Decrease"),o.current=d}const A=d.get($2(r));return(0,ss.jsxs)("div",{className:"DatePickerPopup panel-clickoutside-ignore",ref:s,onMouseDown:ms.ZP,onClick:ms.ZP,onKeyDown:function(t){let n;switch(OM.Z[t.keyCode]){case"Left":n=d.clone().subtract(1,r);break;case"Right":n=d.clone().add(1,r);break;case"Up":n="month"===r||"year"===r?d.clone().subtract(3,r):d.clone().subtract(1,"week");break;case"Down":n="month"===r||"year"===r?d.clone().add(3,r):d.clone().add(1,"week");break;case"PageUp":u(),(0,ms.ZP)(t);break;case"PageDown":p(),(0,ms.ZP)(t);break;case"Enter":if((0,ms.ZP)(t),t.target!==t.currentTarget)return;g(d.clone());break;case"Escape":(0,ms.ZP)(t),e.requestClose()}n&&(c(n),(0,ms.ZP)(t))},tabIndex:"0",children:[G2("div",{className:"toolbar toolbar-default"},void 0,G2("h1",{className:"year"!==r?"button":"",onMouseDown:f,onKeyDown:f,tooltip:w,tabIndex:"year"!==r?a[I.kKeyboardTabToAll]:"-1"},void 0,y),G2("div",{className:"toolbar-group",style:{marginLeft:"auto"}},void 0,G2(po.ZP,{className:"button-narrow",onClick:u,tooltip:b,image:Wi.mgF.medium}),G2(po.ZP,{onClick:function(){c(W()().startOf("hour")),l(e.mode)},title:(0,B.Z)("calendar","Today")}),G2(po.ZP,{className:"button-narrow",onClick:p,tooltip:S,image:Wi.Zu.medium}))),G2("div",{className:`DatePickerPopup-Contents ${C}`,onAnimationEnd:function(e){const t=e.target;C&&t instanceof n&&t.classList.remove(C)}},A,("day"===r||"week"===r)&&G2(gL,{events:[],month:d,onSelect:h,selectedDate:d,showOutOfMonthDays:!0,showWeekNumber:!0,showWeekDays:!0,highlightMode:"week"===r?"week":"day",fixedHeight:!0}),"month"===r&&G2("div",{className:"DatePickerPopup-YearMonths"},void 0,W().months().map(((t,n)=>{const i=n===e.initialPeriod.month()&&e.initialPeriod.year()===d.year(),s=n===d.month();return G2("div",{className:Fi()("DatePickerPopup-YearMonth",{"DatePickerPopup-YearMonth--Selected":s,"DatePickerPopup-YearMonth--Highlighted":i}),"data-period":n,onClick:m},t,t)}))),"year"===r&&G2("div",{className:"DatePickerPopup-YearMonths"},void 0,(0,Fx.Z)(v,v+12).map((t=>{const n=t===e.initialPeriod.year(),i=t===d.year();return G2("div",{className:Fi()("DatePickerPopup-YearMonth",{"DatePickerPopup-YearMonth--Selected":i,"DatePickerPopup-YearMonth--Highlighted":n}),"data-period":t,onClick:m},t,t)}))))]})};var z2;function j2(e,t,n,i){z2||(z2="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:z2,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Y2=function(e){const[t,n]=Li.useState(!1),i=(0,Ya.Z)([I.kKeyboardTabToAll]),s=Li.useContext(ts.Z),o=Li.useRef(),a=Li.useRef(),r=Li.useRef(0),[l,d]=Li.useState("full"),c=Li.useCallback((e=>{a.current||(a.current=s.requestAnimationFrame((()=>{const t=e?.querySelector("h1").childNodes[0];if(e&&t){const n=e.getBoundingClientRect().width,i=document.createRange();i.setStart(t,0),i.setEnd(t,t.textContent.length-1);i.getClientRects().length>=2&&"full"===l?(d("compact"),r.current=n+5):n>r.current&&d("full")}a.current=null})))}),[s,l]);function u(){n(!1)}function p(e){if("number"==typeof e.keyCode){const t=OM.Z[e.keyCode];if(e.repeat||"Space"!==t&&"Enter"!==t||e.target!==e.currentTarget)return}n(!t)}Li.useEffect((()=>{const e=o.current?.parentElement;if(!e)return;const t=new s.ResizeObserver((function(){c(e)}));return t.observe(e),()=>{e&&t.unobserve(e)}}),[o,c,s]),Li.useEffect((()=>{function t(t){if(t!==s.vivaldiWindowId)return;const{area:i}=$e.Z.getContext(s.vivaldiWindowId);(!e.inPanel&&"panel"!==i||e.inPanel&&"panel"===i)&&n(!0)}return Oa.Z.addListener("COMMAND_CALENDAR_GOTO_DATE",t),()=>{Oa.Z.removeListener("COMMAND_CALENDAR_GOTO_DATE",t)}}),[e.inPanel,s]);const h="full"===l?"ll":R.ZP.getShortDateFormat();let g,m;switch(e.displayMode){case"year":m="year",g=e.startDate.year();break;case"month":m="month",g=(0,B.Z)("$1 $2",[e.initialPeriod.format("MMMM"),e.initialPeriod.format("YYYY")]);break;case"multiweek":case"week":m="week",g=(0,B.Z)("$1 – $2",[e.startDate.format(h),e.endDate?.format(h)??""]);break;case"day":m="day",g=W()(e.startDate).format("LL");break;case"agenda":m="day",g=(0,B.Z)("$1 – $2",[e.startDate.format(h),e.endDate?.format(h)??""]);break;default:m="day"}return(0,ss.jsxs)("div",{ref:o,className:"PeriodPicker no-page-focus",onKeyDown:p,onMouseDown:p,tabIndex:i[I.kKeyboardTabToAll],children:[j2("h1",{},void 0,g),j2(po.ZP,{tooltip:(0,B.Z)("Select calendar view period from a yearly calendar"),label:(0,B.Z)("Period Selector"),popupLabel:(0,B.Z)("Period Selector"),popupPosition:"below",image:Wi.yaZ.small,onClick:p,hidePopup:u,isPopupVisible:t,popupWidth:300,outsideClickIgnoreClass:"PeriodPicker",tabIndex:-1},void 0,j2(K2,{initialPeriod:e.initialPeriod,setPeriod:e.setPeriod,mode:m,requestClose:u}))]})};var X2,Q2=n(34155);function q2(e,t,n,i){X2||(X2="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:X2,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const J2=(0,ux.extendMoment)(W()),{minimalCreateEvent:e4,doesCalendarsExistsAndShowWarning:t4}=Zl.ZP,n4=[I.kCalendarDisplayDensity,I.kCalendarDisplayWeekNumber,I.kMailIsTurnedOff];function i4(){w.Z.set(I.kCalendarDisplayDensity,"minimal")}function s4(){w.Z.set(I.kCalendarDisplayDensity,"compact")}function o4(){w.Z.set(I.kCalendarDisplayDensity,"full")}const a4=QQ((function(e){const t=Li.useContext(ts.Z),{vivaldiWindowId:n}=t,i=Li.useRef(),{pageId:s}=e,[o,a]=Li.useState(C.Z.get(I.kCalendarShowDaySidebar)),[r,l]=Li.useState(C.Z.get(I.kCalendarShowTasksSidebar)),[d,c]=Li.useState(!1),u=(0,Ya.Z)(n4),{stateHandler:p,calendarFilter:h,accounts:g,calendars:m,events:f,eventDraft:v,trashedEvents:y}=r2(s),{displayMode:b,anchorDate:S,selectedDate:A,filterText:T}=h,Z=["week","multiweek","month","year"].includes(b)&&(!0===o||"year"===b)||"agenda"===b&&r;Li.useEffect((()=>()=>{Q2.nextTick((()=>p.endEventEdit()))}),[n,s,p,t.selectWindow]),Li.useEffect((()=>{C.Z.get(I.kCalendarOnboardingShown)||Q2.nextTick((()=>{!El.Z.getAccounts().some((e=>"local"!==e.account_type))&&de.Z.showCalendarAccountDialog(t.vivaldiWindowId)}))}),[t]),Li.useEffect((()=>{const e=t.document.activeElement;if(!i.current||i.current?.contains(e))return;const n=t.document.getElementById("browser")?.querySelector(".DatePickerPopup");n?.contains(e)||i.current?.querySelector(".calendar-grid")?.focus()}),[b,t.document]);const E=!!v,k=u[I.kCalendarDisplayDensity],_=Li.useMemo((()=>({pageId:e.pageId,displayDensity:k,isPanel:!1,isEditing:E,isWidget:!1,handler:p})),[k,p,e.pageId,E]);function N(e){bO.Z.setViewMode(s,e)}function P(e){v&&p.endEventEdit(),bO.Z.selectDate(s,e)}function D(){T&&bO.Z.search(s,""),c(!1)}function M(e){const t=El.Z.getEvent(e);t&&bO.Z.selectEvent(s,{event:t,allDay:t.allDay})}if(u[I.kMailIsTurnedOff])return q2(OZ,{windowId:t.vivaldiWindowId});d&&!T&&D();const O=Zl.ZP.getDisplayRange(S,b),x=!!T&&(["agenda","year"].includes(b)?0===f.length:f.every((e=>!0===e.filteredOut)));let L="";if(A&&u[I.kCalendarDisplayWeekNumber])if("day"===b)L=(0,B.Z)("Week $1",[A.week()]);else if("week"===b)L=(0,B.Z)("Week $1",[A.week()]);else if("multiweek"===b){const{start:e,end:t}=O;L=(0,B.Z)("Weeks $1 - $2",[e.week(),t.week()])}else if("month"===b){const e=J2(S);L=(0,B.Z)("Weeks $1 - $2",[e.startOf("month").week(),e.endOf("month").week()])}else if("agenda"===b){const{start:e,end:t}=O;L=(0,B.Z)("Weeks $1 - $2",[e.week(),t.week()])}return q2(za.Z,{focusName:"focus_calendar",noInitialFocus:!0},void 0,(0,ss.jsxs)("div",{className:"manager calendar",onClick:function(e){e.stopPropagation(),v&&p.endEventEdit()},ref:i,children:[q2("div",{className:"toolbar toolbar-default",role:"toolbar","aria-label":(0,B.Z)("toolbar label","Calendar")},void 0,q2(po.ZP,{onClick:function(){if(!t4(n))return;const e=h.selectedDate?.valueOf()??0;te.ZP.addEventCommand(t.vivaldiWindowId,e4({start:e}))},title:(0,B.Z)("New Event"),image:Wi.md4.small,commandId:"COMMAND_ADD_CALENDAR_EVENT"}),q2(x2,{accounts:g,calendars:m}),q2("div",{className:"toolbar-group",style:{marginLeft:"auto"}},void 0,q2("span",{className:"density-label"},void 0,(0,B.Z)("calendar","View")),q2(po.ZP,{tooltip:(0,B.Z)("Minimal view"),isPressed:"minimal"===k,onClick:i4,image:Wi.NBh.small}),q2(po.ZP,{tooltip:(0,B.Z)("Compact view"),isPressed:"compact"===k,onClick:s4,image:Wi.EEk.small}),q2(po.ZP,{tooltip:(0,B.Z)("Full view"),isPressed:"full"===k,onClick:o4,image:Wi.Bd5.small})),q2(V2,{filterText:T,onSearchChange:function(e){bO.Z.search(s,e)},onSelectEvent:M,onShowSearchResults:function(){c(!0)}})),q2("div",{className:"toolbar toolbar-default",role:"toolbar","aria-label":(0,B.Z)("toolbar label","Display Period")},void 0,q2("div",{className:"toolbar-group",style:{marginRight:"auto"}},void 0,q2(po.ZP,{className:"button-narrow",onClick:function(){bO.Z.viewPreviousPeriod(e.pageId)},tooltip:(0,B.Z)("Previous"),image:Wi.mgF.small}),q2(po.ZP,{onClick:function(){P(J2((0,ih.zX)(Date.now())))},disabled:!!A&&(0,ih.KC)(A.toDate(),new Date),title:(0,B.Z)("calendar","Today")}),q2(po.ZP,{className:"button-narrow",onClick:function(){bO.Z.viewNextPeriod(e.pageId)},tooltip:(0,B.Z)("Next"),image:Wi.Zu.small})),q2(Y2,{initialPeriod:S,setPeriod:P,startDate:O.start,endDate:O.end,displayMode:b,inPanel:!1}),L&&q2("p",{className:"weeks"},void 0,L),q2("div",{className:"toolbar-group",style:{marginLeft:"auto"}},void 0,q2(po.ZP,{onClick:()=>N("day"),title:(0,B.Z)("Day"),tooltip:(0,B.Z)("Day (d)"),isPressed:"day"===b}),q2(po.ZP,{onClick:()=>N("week"),title:(0,B.Z)("Week"),tooltip:(0,B.Z)("Week (w)"),isPressed:"week"===b}),q2(po.ZP,{onClick:()=>N("multiweek"),title:(0,B.Z)("Multiweek"),tooltip:(0,B.Z)("Multiweek (n)"),isPressed:"multiweek"===b}),q2(po.ZP,{onClick:()=>N("month"),title:(0,B.Z)("Month"),tooltip:(0,B.Z)("Month (m)"),isPressed:"month"===b}),q2(po.ZP,{onClick:()=>N("year"),title:(0,B.Z)("Year"),tooltip:(0,B.Z)("Year (y)"),isPressed:"year"===b}),q2(po.ZP,{onClick:()=>N("agenda"),title:(0,B.Z)("Agenda"),tooltip:(0,B.Z)("Agenda (a)"),isPressed:"agenda"===b})),q2("div",{className:"toolbar-group"},void 0,q2(A2,{trashedEvents:y}),q2(po.ZP,{onClick:function(){"agenda"===h.displayMode?l((e=>(w.Z.set(I.kCalendarShowTasksSidebar,!e),!e))):a((e=>(w.Z.set(I.kCalendarShowDaySidebar,!e),!e)))},disabled:"day"===b||"year"===b,tooltip:(0,B.Z)("Show Sidebar"),isPressed:"agenda"===b?r:o||"year"===b,image:Wi.S8w.small}))),!d&&x&&q2("div",{className:"no-search-results"},void 0,q2(To,{type:"info"},void 0,(0,B.Z)("Showing filtered results. Press “Search” for full results."))),q2("div",{className:`manager-view ${b}`},void 0,d&&q2(y2,{selectedEvent:h.selectedEvent,onSelectEvent:M,filterText:T,onClose:D,editingEvent:v}),!d&&q2("div",{className:"manager-content"},void 0,q2(yM.Provider,{value:_},void 0,q2(DL,{filter:h,events:f,trashedEvents:y,editingEvent:v}))),Z&&q2(h2,{anchorDate:A||S,displayMode:b,pageId:s}))]}))})),r4=Li.createContext({onMoveItem:Lr.Z,onDrop:Lr.Z,findItem:Lr.Z,viewWidth:812,columns:2,onMoveNew:Lr.Z,animate:!1}),l4=gs()((e=>"double_height"===e?{height:2,width:1}:{height:1,width:1}),{maxSize:2}),d4=l4;var c4;function u4(e,t,n,i){c4||(c4="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:c4,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function p4(e){return e.startsWith("#")}function h4(e,t,n,i,s,o){const a=[{type:"separator",label:"",labelEnglish:""}];return s&&s.length>1&&a.push({items:[{type:"checkbox",checked:"regular"===n,handler:()=>M(e,"regular"),...(0,us.Z)("Regular")},{type:"checkbox",checked:"double_height"===n,handler:()=>M(e,"double_height"),...(0,us.Z)("Tall")}],...(0,us.Z)("Widget Size")}),a.push({items:[{type:"checkbox",checked:"solid"===i,handler:()=>O(e,f.bz),...(0,us.Z)("Solid")},{type:"checkbox",checked:"semi-transparent"===i,handler:()=>O(e,f.UQ),...(0,us.Z)("Semi-Transparent")},{type:"checkbox",checked:"transparent"===i,handler:()=>O(e,f.Au),...(0,us.Z)("Transparent")},{type:"checkbox",checked:p4(i),handler:()=>o(),...(0,us.Z)("Custom")}],...(0,us.Z)("Background Style")}),a.push({handler:()=>{var n;n=e,A.Z.dispatch({actionType:"DASHBOARD_REMOVE_WIDGET",widgetId:n}),S.Z.closeAssociatedTabsByWidget(n),"sticky-note"===t&&function(e){A.Z.dispatch({actionType:"STICKY_NOTE_REMOVE",widgetId:e})}(e)},...(0,us.Z)("Remove Widget")}),a}const g4=[I.kThemeUseAnimation];function m4({id:e,index:t,type:n,title:i,className:s,children:o,getMenu:a,hideMenu:r=!1,size:l,background:d,sizeOptions:c}){const u=(0,Ya.Z)(g4),p=Li.useContext(ts.Z),h=Li.useContext(r4),g=Li.useRef(),m=Li.useRef(),v=Li.useRef(),{viewWidth:y,columns:b,animate:S}=h;Li.useEffect((()=>{function e(){v.current&&(v.current.disabled=!0)}return p.document.addEventListener("mousedown",e),()=>p.document.removeEventListener("mousedown",e)}),[p]);const[w,C]=Li.useMemo((()=>p4(d)?[d,f.sg]:["",d]),[d]),[{isDragging:A},T,Z]=(0,_Q.c)((()=>({type:f.Zg,item:{id:e},collect:e=>({isDragging:e.isDragging()})})),[]),[,E]=(0,NQ.L)((()=>({accept:f.Zg,hover:(t,n)=>{t.id!==e&&h.onMoveItem(t.id,e)},drop:h.onDrop})),[]),[,k]=(0,NQ.L)((()=>({accept:f.qk,hover:(t,n)=>{h.onMoveNew(e,t.type)},drop:h.onDrop})),[]),_=Li.useCallback((()=>{const t=h4(e,n,l,d,c,(function(){const e=v.current;e&&(e.disabled=!1,e.click())}));return a?a().concat(t):t}),[d,a,e,l,c,n,v]),N=Li.useCallback(((e,t)=>{const n=e%b,i=Math.round(n*(t+f.cX));return S&&u[I.kThemeUseAnimation]?KQ(i,f.Y3):i}),[b,S,u]),P=Li.useCallback((e=>{const t=Math.floor(e/b),n=Math.round(t*(f.EE+f.cX));return S&&u[I.kThemeUseAnimation]?KQ(n,f.Y3):n}),[b,S,u]),{height:D}=d4(l),M=Li.useMemo((()=>Math.min((y-f.cX)/b,f.V9)),[y,b]),x=Li.useMemo((()=>D>1?f.EE*D+f.cX*(D-1):f.EE),[D]),L=f.sB[n];if(!L)return console.warn("No defaults have been created for this widget type."),null;const R=(0,Ae.Z)((t=>O(e,t.target.value)),200,{leading:!0});return T(g),Z(E(m)),k(m),u4(VQ,{style:{posX:N(t,M),posY:P(t)}},e,(({posX:e,posY:t})=>(0,ss.jsxs)("div",{ref:m,className:Fi()("dashboard-widget",s,l,C),style:{opacity:A?0:1,height:x,width:M,position:"absolute",transform:`translate3d(${e}px, ${t}px, 0)`,backgroundColor:w},children:[u4("div",{className:"dashboard-widget-header"},void 0,(0,ss.jsxs)("h1",{ref:g,className:"title",children:[u4("span",{},void 0,i??L.defaultTitle),(0,ss.jsx)("input",{ref:v,type:"color",disabled:!0,value:w,onChange:R}),!r&&u4(po.ZP,{className:"dashboard-widget-menubutton",image:Wi.VZO,menu:_,menuOrigin:"bottomLeft",tooltip:(0,B.Z)("Open menu")})]})),o]})))}const f4=e=>{const{children:t,...n}=e;return u4(Lu,{level:"tabs"},void 0,(0,ss.jsx)(m4,{...n,children:t}))};var v4;function y4(e,t,n,i){v4||(v4="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:v4,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const b4=["regular","double_height"],S4=[I.kCalendarDisplayDensity];function w4(e){const t=Li.useContext(ts.Z),[n,i]=Li.useState([]),s=(0,Ya.Z)(S4),o=t.vivaldiWindowId,a=Li.useMemo((()=>Ce.ZP.getActivePage(o)?.id??-1),[o]),r=Li.useMemo((()=>({filter:{...(0,o2.l)(),displayMode:"agenda",showTasks:!1,calendarIds:new Set(e.calendarIds)}})),[e.calendarIds]),{stateHandler:l,calendarFilter:d,eventDraft:c,trashedEvents:u,events:p}=r2(a,r);Li.useEffect((()=>{bO.Z.setViewMode(a,"agenda",{save:!1})}),[a]),Li.useEffect((()=>{function e(){El.Z.isInitialized()?i(function(){const e=El.Z.getAccounts(),t=El.Z.getVisibleCalendars();return e.reduce(((e,n)=>{const i=t.filter((e=>e.accountId===n.id&&e.supportedCalendarComponent.vevent));return i.length>0&&e.push({account:n,calendars:i}),e}),[]).sort(((e,t)=>"local"===e.account.account_type?-1:"local"===t.account.account_type?1:0))}()):setTimeout(e,500)}return El.Z.addListener(e),e(),()=>El.Z.removeListener(e)}),[e.calendarIds]);const h=Li.useMemo((()=>new Set(e.calendarIds)),[e.calendarIds]),g=Li.useRef(h),m=Li.useCallback(((t,i)=>{if(i){const i=new Set(g.current);0===i.size?n.forEach((({calendars:e})=>{e.forEach((e=>{e.id!==t&&i.add(e.id)}))})):i.has(t)?i.delete(t):i.add(t),g.current=i,l.selectCalendars(i),function(e,t){A.Z.dispatch({actionType:"DASHBOARD_UPDATE_WIDGET",widgetId:e,calendarIds:t})}(e.id,i)}return g.current.has(t)}),[n,e.id,l]),f=Li.useCallback((()=>[{items:n.flatMap((({account:e,calendars:t})=>{const n=[{isEnabled:gE.Z,label:e.name,labelEnglish:e.name}];return t.reduce(((e,t)=>(e.push({type:"checkbox",persistent:!0,checked:h.has(t.id)||0===h.size,checkedHandler:(e,n)=>Promise.resolve(m(t.id,n)),label:t.description??(0,B.Z)("Unnamed calendar"),labelEnglish:t.description??"Unnamed calendar"}),e)),n)})),...(0,us.Z)("Select Calendars")}]),[n,h,m]),v=Li.useMemo((()=>({pageId:a,displayDensity:s[I.kCalendarDisplayDensity],isPanel:!1,isEditing:!1,isWidget:!0,handler:l})),[a,s,l]);return y4(f4,{id:e.id,index:e.index,type:"calendar",size:e.size,sizeOptions:b4,background:e.background,keyAccess:e.keyAccess,getMenu:f,className:"Dashboard-CalendarWidget"},void 0,y4("div",{className:"scrollable"},void 0,0===p.length&&y4("div",{className:"widget-image-intro"},void 0,y4("span",{className:"icon",dangerouslySetInnerHTML:{__html:Wi.Ase["regular"===e.size?"medium":"large"]}})),y4(yM.Provider,{value:v},void 0,y4(DL,{filter:d,events:p,trashedEvents:u,editingEvent:c,displayMode:"agenda",eventDisplayStyle:"transparent"}))))}const C4=Li.memo(w4);function A4(e="minutes"){const[t,n]=Li.useState(new Date);return Li.useEffect((()=>{function t(e){n(e)}return ug.addListener(e,t),()=>ug.removeListener(t)}),[e]),t}var I4,T4,Z4;function E4(e,t,n,i){I4||(I4="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:I4,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function k4(e){const t=W()(A4("minutes"));return E4(f4,{id:e.id,index:e.index,type:"date",size:e.size,background:e.background,keyAccess:e.keyAccess,className:"Dashboard-Date"},void 0,E4("div",{className:"date-wrapper"},void 0,E4("p",{className:"day-display"},void 0,t.format("dddd")),E4("p",{className:"date-display"},void 0,E4("span",{className:"date"},void 0,t.format("LL"))),E4("p",{className:"week-display"},void 0,(0,B.Z)("Week $1",[t.week()])),E4("p",{className:"time-display"},void 0,t.format("LT"))))}function _4(e,t,n,i){T4||(T4="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:T4,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function N4(e){const{vivaldiWindowId:t}=Li.useContext(ts.Z),[n,i]=Li.useState(It.of),s=C.Z.get(I.kMailAccounts),o=[It.of].concat(s.map((e=>e.MAIL_EMAIL)));return _4("form",{className:"widget-config"},void 0,0===s.length?(0,ss.jsxs)(ss.Fragment,{children:[_4("div",{className:"widget-config-intro"},void 0,_4("span",{className:"icon",dangerouslySetInnerHTML:{__html:Wi.ms3[e.iconSize]}}),_4("p",{},void 0,(0,B.Z)("Add your mail account first in order to view your recent messages."))),_4("footer",{className:"widget-config-footer"},void 0,_4("input",{type:"submit",value:(0,B.Z)("Add Mail Account"),onClick:()=>de.Z.showMailAccountDialog(t)}))]}):(0,ss.jsxs)(ss.Fragment,{children:[_4("div",{className:"widget-config-content"},void 0,_4("span",{},void 0,(0,B.Z)("Select Account:")),_4(ta.Z,{value:n,onChange:e=>{i(e.target.value)}},void 0,o.map((e=>_4("option",{value:e},e,e))))),_4("footer",{className:"widget-config-footer"},void 0,_4("input",{type:"submit",value:(0,B.Z)("verb","Done"),onClick:()=>e.onChange(n)}))]}))}function P4(e,t,n,i){Z4||(Z4="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Z4,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const D4=[I.kCalendarRelativeDates],M4=["regular","double_height"],O4=[];var x4=P4("span",{}),L4=P4("hr",{});function R4(e){const t=Li.useContext(ts.Z),n=e.accountId||It.of,i=n===It.of?It.ik:It.Gf,[s,o]=Li.useState(Kt.getList(n,i)||O4),[a,r]=Li.useState(!0),l=(0,Ya.Z)(D4),d=Li.useRef(e.accountId);Li.useEffect((()=>{function t(){if(Kt.isInitialized()){d.current=e.accountId;const t=Kt.getList(n,i);t&&o(t),r(!1)}}return Kt.addListener(t),d.current!==e.accountId&&t(),()=>Kt.removeListener(t)}),[s,e.accountId,n,i]);const c=Li.useCallback((()=>[{handler:()=>E(e.id,""),...(0,us.Z)("Change Folder")}]),[e.id]);function u(e,n){const i=(0,La.wJ)(t.vivaldiWindowId,e);i&&tn.Z.messages.get(n).then((e=>(0,Zf.Z)(he.ZP.getMailWindowId(),e,{inBackground:i.inBackground,inCurrent:!1})))}const p=Li.useCallback(((e,n)=>{e.persist(),(0,ms.ZP)(e),If("mailandfeeds",t.vivaldiWindowId,n,!1,(function(e,t){(0,Zf.Z)(he.ZP.getMailWindowId(),e,t)})).then((n=>{(0,cs.Z)(t,n)(e)}))}),[t]);return e.accountId===f.$c&&1===C.Z.get(I.kMailAccounts).length&&E(e.id,It.of),P4(f4,{id:e.id,index:e.index,type:"email",size:e.size,sizeOptions:M4,background:e.background,keyAccess:e.keyAccess,className:"Dashboard-EmailWidget",getMenu:c,title:e.accountId?e.accountId===It.of?(0,B.Z)("All Recent Messages"):(0,B.Z)("Recent in $1",[e.accountId]):void 0},void 0,e.accountId?P4("div",{className:"email-wrapper scrollable"},void 0,s.map(((e,t,n)=>{const i=!At.Z.call(e.sources);return P4(Li.Fragment,{},`email_${e.id}`,P4("div",{className:Fi()("email-item",{unread:i,unseen:e.unseen}),onPointerDown:t=>function(e,t){e.button,es.Z.kCenter,u(e,t)}(t,e.id),onKeyDown:t=>function(e,t){"Enter"!==e.key&&" "!==e.key||u(e,t)}(t,e.id),tabIndex:0,onContextMenu:t=>p(t,e)},void 0,P4("div",{className:"data-row"},void 0,i?P4("span",{dangerouslySetInnerHTML:{__html:Wi.AtI.small}}):x4,P4("div",{className:"title"},void 0,(0,dZ.Qb)(e.fromIds).contactString),P4("div",{className:"date"},void 0,l[I.kCalendarRelativeDates]?W()(e.sentDate).calendar(null,f.BO):W()(e.sentDate).format(f.BO.sameElse))),P4("div",{className:"subject-row"},void 0,P4("div",{className:"title"},void 0,e.subject)),P4("div",{className:"content-row"},void 0,P4("div",{className:"content"},void 0,e.preview))),t<n.length-1&&L4)})),0===s.length&&!a&&P4("div",{className:"empty-widget-message"},void 0,P4("div",{dangerouslySetInnerHTML:{__html:Wi.Fii}}),a?"":(0,B.Z)("No messages to display."))):P4(N4,{iconSize:"regular"===e.size?"medium":"large",onChange:t=>{E(e.id,t)}}))}const B4=Li.memo(R4);var F4;function W4(e,t,n,i){F4||(F4="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:F4,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function U4({feeds:e,onValidate:t,iconSize:n}){const[i,s]=Li.useState(""),o=Li.useContext(ts.Z);return Li.useEffect((()=>{e.length>0&&s(e[0].path??""),1===e.length&&t(e[0].path)}),[e,t]),W4("form",{className:"widget-config"},void 0,0!==e.length?W4("div",{className:"widget-config-content"},void 0,W4("span",{},void 0,(0,B.Z)("Select a Feed:")),W4(ta.Z,{value:i,onChange:e=>s(e.target.value)},void 0,W4("option",{value:It.of},void 0,(0,B.Z)("All Messages")),e.map((e=>W4("option",{value:e.path},e.id,e.name))))):W4("div",{className:"widget-config-intro"},void 0,W4("span",{className:"icon",dangerouslySetInnerHTML:{__html:Wi.L_F[n]}}),W4("p",{},void 0,(0,B.Z)("Look for RSS feed icon in address bar to add feeds from websites that offer them. Or test with our own, Vivaldi Browser Feed."))),W4("footer",{className:"widget-config-footer"},void 0,0===e.length?W4("input",{type:"submit",onClick:()=>de.Z.showAddFeed(o.vivaldiWindowId,f.EK),title:f.EK[0].title,value:(0,B.Z)("Add a Feed")}):W4("input",{type:"submit",value:(0,B.Z)("verb","Done"),onClick:()=>{i.length>0&&t(i)}})))}var V4,H4=n(55603);function G4(e,t,n,i){V4||(V4="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:V4,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function $4({message:e}){const[t,n]=Li.useState();return(0,H4.F7)(e).then((e=>{n(e[0])})),t?G4("img",{src:t}):null}const K4=Li.memo($4);var z4,j4=n(34155);function Y4(e,t,n,i){z4||(z4="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:z4,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const X4=[I.kCalendarRelativeDates],Q4=["regular","double_height"];var q4=Y4("hr",{});function J4(e){const t=Li.useContext(ts.Z),n=(0,Ya.Z)(X4),[i,s]=Li.useState([]),[o,a]=Li.useState([]),r=Li.useRef(crypto.randomUUID()),[l,u]=Li.useState(Boolean(e.feedId));Li.useEffect((()=>{function t(){if(Kt.isInitialized()){const t=ht.Z.getByAccountId(It.u4).filter((e=>It.pG.test(e.path))).map((e=>({id:e.id,name:e.name,path:e.path}))),n=t.find((e=>e.path===r.current));n&&(j4.nextTick((()=>{k(e.id,n.path)})),r.current=crypto.randomUUID()),a(t),e.feedId&&s(function(e){try{return(e===It.of?Kt.getList(It.u4,It.ym):Kt.getList(It.u4,e)).slice(0,f.bb)}catch(e){return console.error(e),[]}}(e.feedId)),u(!1)}else setTimeout(t,500)}return Kt.addListener(t),t(),()=>Kt.removeListener(t)}),[e.feedId,e.feedDisplay,e.id]);const p=Li.useCallback((()=>[{items:o.reduce(((t,n)=>(t.push({type:"checkbox",checked:!!e.feedId&&n.path.endsWith(e.feedId),handler:()=>k(e.id,n.path),label:n.name,labelEnglish:n.name}),t)),[{type:"checkbox",checked:e.feedId===It.of,handler:()=>k(e.id,It.of),...(0,us.Z)("All Recent Feeds")}]),...(0,us.Z)("Select Feed")},{items:[{type:"checkbox",checked:"list"===e.feedDisplay,handler:()=>_(e.id,"list"),...(0,us.Z)("List")},{type:"checkbox",checked:"focusFirst"===e.feedDisplay,handler:()=>_(e.id,"focusFirst"),...(0,us.Z)("Focus First Item")},{type:"checkbox",checked:"titleOnly"===e.feedDisplay,handler:()=>_(e.id,"titleOnly"),...(0,us.Z)("Title only")}],...(0,us.Z)("Select Display")},{handler:()=>de.Z.showAddFeed(t.vivaldiWindowId,[{url:"",path:r.current??crypto.randomUUID(),title:"",refreshInterval:0}]),...(0,us.Z)("title","Add Feed")}]),[t.vivaldiWindowId,o,e.feedId,e.id,e.feedDisplay]),h=Li.useCallback((e=>o.find((t=>t.id===e))?.name??""),[o]);async function g(e,n){const i=ht.Z.getListEntry(n),s=(0,La.wJ)(t.vivaldiWindowId,e);if(s&&i){const e=await(0,H4.ME)(i);if(e){d.Z.markAllListEntriesRead([i]);const n=t.vivaldiWindowId;s.inNewWindow?xi.Z.openBrowserWindow(n,e,{incognito:s.incognito,transition:se.Z.historyPrivate.TransitionType.LINK}):c.ZP.openURL(n,e,{inCurrent:s.inCurrent,inBackground:s.inBackground,transition:se.Z.historyPrivate.TransitionType.LINK})}else tn.Z.messages.get(n).then((e=>(0,Zf.Z)(he.ZP.getMailWindowId(),e,{inBackground:s.inBackground,inCurrent:!1})))}}const m=Li.useMemo((()=>o.find((t=>t.path===e.feedId))?.name??(0,B.Z)("Feed")),[o,e.feedId]),v=Li.useCallback(((e,n)=>{e.persist(),(0,ms.ZP)(e),If("mailandfeeds",t.vivaldiWindowId,n,!0,(function(e,t){(0,Zf.Z)(he.ZP.getMailWindowId(),e,t)})).then((n=>{(0,cs.Z)(t,n)(e)}))}),[t]);return Y4(f4,{id:e.id,index:e.index,type:"feed",size:e.size,sizeOptions:Q4,background:e.background,keyAccess:e.keyAccess,className:"Dashboard-FeedWidget",getMenu:p,title:e.feedId?e.feedId===It.of?(0,B.Z)("Recent Feeds"):(0,B.Z)("Recent in $1",[m]):void 0},void 0,e.feedId?(0,ss.jsxs)(ss.Fragment,{children:[Y4("div",{className:"feed-wrapper scrollable"},void 0,i.map(((t,i,s)=>{const o=!At.Z.call(t.sources);return Y4(Li.Fragment,{},`feed_${t.id}`,Y4("div",{className:Fi()("feed-row",{"focus-first":"focusFirst"===e.feedDisplay&&0===i,"title-only":"titleOnly"===e.feedDisplay,unread:o,unseen:t.unseen}),onPointerDown:e=>function(e,t){e.button,es.Z.kCenter,g(e,t)}(e,t.id),onKeyDown:e=>function(e,t){"Enter"!==e.key&&" "!==e.key||g(e,t)}(e,t.id),tabIndex:0,onContextMenu:e=>v(e,t)},void 0,Y4("div",{className:"preview-image"},void 0,Y4(K4,{message:t})),Y4("div",{className:"title-row"},void 0,Y4("div",{className:"title"},void 0,h(t.sourceFilterIds[0])),Y4("div",{className:"date"},void 0,n[I.kCalendarRelativeDates]?W()(t.sentDate).calendar(null,f.BO):W()(t.sentDate).format(f.BO.sameElse))),Y4("div",{className:"subject-row"},void 0,Y4("div",{className:"title"},void 0,t.subject)),Y4("div",{className:"content-row"},void 0,Y4("div",{className:"content"},void 0,t.preview))),i<s.length-1&&q4)}))),0===i.length&&!l&&Y4("div",{className:"empty-widget-message"},void 0,Y4("div",{dangerouslySetInnerHTML:{__html:Wi.Fii}}),l?"":(0,B.Z)("No messages to display."))]}):Y4(U4,{feeds:o,onValidate:t=>{k(e.id,t)},iconSize:"regular"===e.size?"medium":"large"}))}const e5=Li.memo(J4);var t5;function n5(e,t,n,i){t5||(t5="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:t5,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var i5,s5,o5,a5,r5=n5(co,{type:"blocker-shield",size:32,className:"Blocker-Shield-Trackers Modal-Shield"}),l5=n5(co,{type:"blocker-shield",size:32,className:"Blocker-Shield-Ads Modal-Shield"});function d5(e){const t=Li.useContext(ts.Z),[n,i]=Li.useState({reportingStart:0,adsBlocked:0,trackersBlocked:0});return Li.useEffect((()=>{se.Z.contentBlocking.getBlockedCounters((function(e,t){i({reportingStart:e,adsBlocked:t.blocked_for_origin.ad_blocking.reduce(((e,t)=>e+t.blocked_count),0),trackersBlocked:t.blocked_for_origin.tracking.reduce(((e,t)=>e+t.blocked_count),0)})}))}),[]),n5(f4,{id:e.id,type:"privacy-stats",index:e.index,size:e.size,background:e.background,keyAccess:e.keyAccess,className:"Dashboard-PrivacyStatsWidget"},void 0,n5("div",{className:"privacy-stats-wrapper scrollable"},void 0,n5("div",{className:"counter-wrapper",onClick:()=>de.Z.showPrivacyStatsDialog(t.vivaldiWindowId)},void 0,n5("div",{},void 0,n5("div",{className:"counter"},void 0,r5,(0,R.uf)(n.trackersBlocked)),n5("div",{className:"title"},void 0,(0,B.Z)("Trackers prevented from profiling you"))),n5("div",{},void 0,n5("div",{className:"counter"},void 0,l5,(0,R.uf)(n.adsBlocked)),n5("div",{className:"title"},void 0,(0,B.Z)("Ads blocked")))),n5("p",{},void 0,n.reportingStart>0?(0,B.Z)("Since $1",[W()(n.reportingStart).format("LL")]):"")))}function c5(e,t,n,i){i5||(i5="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:i5,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class u5 extends Li.Component{componentDidMount(){const e=this.props.bookmark.url;this.props.showThumbnail&&0===this.props.bookmark.thumbnail.length&&e&&(Ho.linkAndQueryUpdatingBookmark(this,this.props.bookmark.id),Ho.updateForBookmark(this.props.bookmark.id,e))}render(){const{bookmark:e}=this.props,t=e.url??"",n=e.faviconUrl||pn.jk.getFavicon(t)||t,i=e.faviconUrl?"faviconFromCache":"page";return(0,ss.jsx)(ss.Fragment,{children:this.props.showThumbnail?c5(w3,{className:"icon-wrapper",src:this.props.bookmark.thumbnail,title:e.title?e.title:e.url?se.Z.utilities.urlToThumbnailText(e.url):""}):c5("span",{className:"icon-wrapper"},void 0,c5(Ri.ZP,{className:"favicon",url:n,loadType:i,size:32}))})}}function p5(e,t,n,i){s5||(s5="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:s5,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class h5 extends Li.Component{static contextType=ts.Z;openUrl=e=>{e=e||{};const t=this.props.node;e.newWindow?xi.Z.openBrowserWindow(this.context.vivaldiWindowId,t.url,{incognito:e.incognito,transition:se.Z.historyPrivate.TransitionType.AUTO_BOOKMARK}):c.ZP.openURL(this.context.vivaldiWindowId,t.url,{inCurrent:!e.newTab,inBackground:e.background,bookmarkId:t.id,addOpenerTabId:!0,transition:se.Z.historyPrivate.TransitionType.AUTO_BOOKMARK})};copyUrl=()=>{const{document:e}=this.context;e.addEventListener("copy",this.onCopy),e.execCommand("copy"),e.removeEventListener("copy",this.onCopy)};onCopy=e=>{ee.Z.copy(e,[this.props.node.id]),(0,ms.ZP)(e)};removeBookmark=async()=>{ee.Z.remove([this.props.node.id])};handleEdit=()=>{de.Z.showBookmarkDialog(this.context.vivaldiWindowId,{mode:"edit",id:this.props.node.id,index:-1})};openAll=()=>{zi.ZP.open(this.context.vivaldiWindowId,zi.ZP.getBookmarksByNode(this.props.node),{inCurrent:!1,inBackground:!0,inNewWindow:!1,incognito:!1,allowOverride:!1},!0)};getContextMenuItems=e=>{const t=this.context.vivaldiWindowId,n=ji.Z.getOptionFunction(e),i={};return ji.Z.getNamedMenu(t,e,(async e=>{switch(e.action){case"CONTEXT_OPEN_IN_NEW_TAB":return{handler:()=>this.openUrl({newTab:!0}),...n(t,e,i)};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{handler:()=>this.openUrl({newTab:!0,background:!0}),...n(t,e,i)};case"CONTEXT_OPEN_IN_TAB":return{handler:()=>this.openUrl({newTab:!1}),...n(t,e,i)};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{handler:()=>this.openUrl({newWindow:!0}),...n(t,e,i)};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{handler:()=>this.openUrl({newWindow:!0,incognito:!0}),...n(t,e,i)};case"CONTEXT_CONTAINER_OPEN_IN_WINDOW":{const s=await Ta.getMenu(t,!0,[this.props.node.url||""]);return{isVisible:()=>s.length>0,items:s,...n(t,e,i)}}case"CONTEXT_OPEN_ALL":return{handler:()=>this.openAll(),...n(t,e,i)};case"CONTEXT_EDIT":return{handler:()=>this.handleEdit(),...n(t,e,i)};case"CONTEXT_COPY":return{handler:()=>this.copyUrl(),...n(t,e,i)};case"CONTEXT_DELETE":return{handler:()=>this.removeBookmark(),...n(t,e,i)};default:return{...n(t,e,i)}}}))};handleContextMenu=e=>{e.persist(),(0,ms.ZP)(e),this.props.isFolder?this.getContextMenuItems("shortcutfolder").then((t=>{(0,cs.Z)(this.context,t)(e)})):this.getContextMenuItems("shortcut").then((t=>{(0,cs.Z)(this.context,t)(e)}))};#Jt=e=>{const{node:t}=this.props;if(t.isParent)this.props.dispatchNavigate({type:"leave"});else if(g.Z.isFolder(t))this.props.dispatchNavigate({type:"enter",id:t.id});else{const t=(0,La.wJ)(this.context.vivaldiWindowId,e);t&&this.openUrl({newWindow:t.inNewWindow,background:t.inBackground,newTab:!t.inCurrent})}};#en=e=>{e.button,es.Z.kCenter,this.#Jt(e)};#Ot=e=>{const t=(0,ps.Z)(e);switch(e.key){case"Enter":case" ":this.#Jt(e);break;case"ArrowLeft":if(t||!this.props.moveFocus(this.props.node.id,"left"))return;(0,ms.ZP)(e);break;case"ArrowRight":if(t||!this.props.moveFocus(this.props.node.id,"right"))return;(0,ms.ZP)(e);break;case"ArrowUp":if(t||!this.props.moveFocus(this.props.node.id,"up"))return;(0,ms.ZP)(e);break;case"ArrowDown":if(t||!this.props.moveFocus(this.props.node.id,"down"))return;(0,ms.ZP)(e)}};render(){const{node:e,showTitle:t,isFolder:n,keyAccess:i,showThumbnail:s,background:o}=this.props,a=e.isParent?(0,B.Z)("Parent Folder"):e.title;return p5("div",{className:Fi()("item",p4(o)?f.sg:o,{"show-title":t}),onContextMenu:this.handleContextMenu,onPointerDown:this.#en,onKeyDown:this.#Ot,tabIndex:i,title:a,role:"link","aria-label":a,"data-id":this.props.node.id},e.id,n?e.isParent?p5("span",{className:"icon-wrapper folder-back",dangerouslySetInnerHTML:{__html:Wi.zwh}}):p5("span",{className:"icon-wrapper",dangerouslySetInnerHTML:{__html:Wi.feS}}):p5(u5,{bookmark:e,showThumbnail:s}),t&&!e.isParent&&p5("p",{},void 0,e.title))}}function g5(e,t,n,i){o5||(o5="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:o5,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function m5({onValidate:e}){const[t,n]=Li.useState(""),[i,s]=Li.useState([]);return Li.useEffect((()=>{i.length>0&&n(i[0].id)}),[i]),Li.useEffect((()=>{const e=[...g.Z.getFilteredTree("",{folders:!0,bookmarks:!1,root:!0}).nodes][0]?.children??[];s(e)}),[]),g5("form",{className:"widget-config"},void 0,g5("div",{className:"widget-config-content shortcuts-config"},void 0,g5("span",{style:{gridArea:"folder-label"}},void 0,(0,B.Z)("Folder:")),g5(oa,{onChange:e=>n(e.target.value),selectedItemID:t})),g5("footer",{className:"widget-config-footer"},void 0,g5("input",{type:"submit",value:(0,B.Z)("verb","Done"),onClick:()=>{t.length>0&&e({folderId:t})}})))}function f5(e,t,n,i){a5||(a5="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:a5,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const v5=["regular","double_height"],y5={"--shortcut-item-width":"78px","--shortcut-list-gap":"24px"};function b5(e){const t=Li.useContext(ts.Z).vivaldiWindowId,n=Li.useRef(),[i,s]=Li.useState(g.Z.getItemById(e.folderId)?.children??[]),o=Li.useCallback(((t,n)=>{switch(n.type){case"leave":return{id:t.parentId??e.folderId,parentId:void 0};case"init":return{id:n.id,parentId:void 0};case"enter":return{id:n.id,parentId:t.id}}}),[e.folderId]),[a,r]=Li.useReducer(o,{id:e.folderId,parentId:void 0});Li.useEffect((()=>{function t(){!function(){const t=[...g.Z.getItemById(a.id)?.children??[]];a.id!==e.folderId&&t.unshift({isParent:!0,id:crypto.randomUUID()});s(t.filter((e=>!g.Z.isSeparator(e))))}()}return g.Z.addListener(t),t(),()=>g.Z.removeListener(t)}),[a.id,a.parentId,e.folderId]);const l=Li.useCallback((()=>[{handler:()=>P(e.id,{folderId:""}),...(0,us.Z)("Select Folder")},{handler:()=>de.Z.showBookmarks(t,a.id),...(0,us.Z)("Edit Bookmarks")},{type:"checkbox",checked:e.showTitle,handler:()=>P(e.id,{showTitle:!e.showTitle}),...(0,us.Z)("Show Site Title")},{type:"checkbox",checked:e.showThumbnail,handler:()=>P(e.id,{showThumbnail:!e.showThumbnail}),...(0,us.Z)("Show Thumbnail")}]),[e.showTitle,e.showThumbnail,e.id,t,a.id]),d=Li.useMemo((()=>g.Z.getItemById(e.folderId)?.title),[e.folderId]),c=(e,t)=>{const i=n.current;if(i){const n=Math.floor((i.clientWidth-(0,Cs.np)())/90);return aw(e,t,Array.from(i.querySelectorAll(".item")),n)}return!1};return f5(f4,{id:e.id,index:e.index,type:"shortcuts",size:e.size,sizeOptions:v5,background:e.background,keyAccess:e.keyAccess,getMenu:l,className:"Dashboard-Shortcuts",title:d},void 0,""===e.folderId?f5(m5,{onValidate:t=>{t.folderId&&r({type:"enter",id:t.folderId}),P(e.id,t)}}):(0,ss.jsxs)(ss.Fragment,{children:[(0,ss.jsx)("div",{ref:n,className:"shortcut-list scrollable",style:y5,children:i.map(((t,n)=>{const i=g.Z.isFolder(t);return f5(h5,{node:t,isFolder:i,keyAccess:0===n?0:-1,showThumbnail:e.showThumbnail,showTitle:e.showTitle,dispatchNavigate:r,background:e.background,moveFocus:c},t.id)}))}),0===i.length&&f5("div",{className:"empty-widget-message"},void 0,(0,B.Z)("No bookmarks to display."))]}))}const S5=Li.memo(b5);class w5 extends m.Z{getInitialState(){return[]}getContentByWidgetId(e){return this.getState().find((t=>t.widgetId===e))?.content}reduce(e,t){switch(t.actionType){case"STICKY_NOTE_INIT":return[...t.notes];case"STICKY_NOTE_UPDATE":{const n=(0,v.Uy)(e,(e=>{const n=e.find((e=>e.widgetId===t.widgetId));n?n.content=t.content:e.push({widgetId:t.widgetId,content:t.content})}));return w.Z.set(I.kDashboardStickyNotes,n),n}case"STICKY_NOTE_REMOVE":{const n=(0,v.Uy)(e,(e=>e.filter((e=>e.widgetId!==t.widgetId))));return w.Z.set(I.kDashboardStickyNotes,n),n}default:return e}}}const C5=new w5;var A5;function I5(e,t,n,i){A5||(A5="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:A5,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const T5=(0,Ae.Z)(((e,t)=>{var n,i;n=e,i=t.target.value,A.Z.dispatch({actionType:"STICKY_NOTE_UPDATE",widgetId:n,content:i})}),1e3);function Z5(e){const t=Li.useContext(ts.Z),n=Li.useRef(null),[i,s]=Li.useState(!1),[o,a]=Li.useState("");Li.useEffect((()=>{a(C5.getContentByWidgetId(e.id)??""),s(!0)}),[e.id]),Li.useEffect((()=>{const t=()=>{const t=C5.getContentByWidgetId(e.id);"string"==typeof t&&a(t)};return C5.addListener(t),()=>C5.removeListener(t)}),[e.id]);const r=Li.useCallback((()=>[{handler:()=>zn.Z.createNote(t.vivaldiWindowId,{content:o,type:"note"},!1),isEnabled:()=>""!==o,...(0,us.Z)("Save to a Note")}]),[t.vivaldiWindowId,o]);return I5(f4,{id:e.id,index:e.index,type:"sticky-note",size:e.size,background:e.background,keyAccess:e.keyAccess,className:"Dashboard-StickyNoteWidget",getMenu:r},void 0,(0,ss.jsx)("textarea",{ref:n,className:"note-editor scrollable",value:o,placeholder:i?(0,B.Z)("Start typing your note"):void 0,onChange:t=>{a(t.currentTarget.value),T5(e.id,t)}}))}const E5=Li.memo(Z5);var k5;function _5(e,t,n,i){k5||(k5="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:k5,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const N5=[I.kCalendarDisplayDensity],P5=["regular","double_height"],D5={...(0,o2.l)(),displayMode:"agenda"};function M5(e){const t=Li.useContext(ts.Z).vivaldiWindowId,n=(0,Ya.Z)(N5),i=Li.useMemo((()=>Ce.ZP.getActivePage(t)?.id??-1),[t]),{stateHandler:s,calendarFilter:o,eventDraft:a,tasks:r,trashedEvents:l}=r2(i,{filter:D5}),d=Li.useMemo((()=>({pageId:i,displayDensity:n[I.kCalendarDisplayDensity],isPanel:!1,isEditing:!1,isWidget:!0,isTaskList:!0,handler:s})),[i,n,s]);return _5(f4,{id:e.id,index:e.index,type:"tasks",size:e.size,sizeOptions:P5,background:e.background,keyAccess:e.keyAccess,className:"Dashboard-TasksWidget"},void 0,_5("div",{id:"tasks-widget",className:"scrollable"},void 0,0===r.length&&_5("div",{className:"widget-image-intro"},void 0,_5("span",{className:"icon",dangerouslySetInnerHTML:{__html:Wi.tDC["regular"===e.size?"medium":"large"]}})),_5(yM.Provider,{value:d},void 0,_5(DL,{filter:o,events:r,trashedEvents:l,editingEvent:a,displayMode:"agenda",eventDisplayStyle:"transparent"}))))}const O5=Li.memo(M5);var x5;function L5(e,t,n,i){x5||(x5="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:x5,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const R5="https://downloads.vivaldi.com/feeds/desktop-tip.atom";function B5(e){const t=Li.useContext(ts.Z),[n,i]=Li.useState(!1);function s(t,n){const i=e.tipLink;i&&n&&(n.newWindow?xi.Z.openBrowserWindow(t,i,{incognito:n.incognito,transition:se.Z.historyPrivate.TransitionType.LINK}):c.ZP.openURL(t,i,{inCurrent:!n.newTab,inBackground:n.background,transition:se.Z.historyPrivate.TransitionType.LINK}))}function o(t){const{clipboardData:n}=t,i=e.tipLink;n&&i&&n.setData("text/plain",i)}function a(n){const i=t.vivaldiWindowId,a=ji.Z.getOptionFunction(n),r={};return ji.Z.getNamedMenu(i,n,(async n=>{switch(n.action){case"CONTEXT_OPEN_IN_NEW_TAB":return{handler:()=>s(i,{newTab:!0}),...a(i,n,r)};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{handler:()=>s(i,{newTab:!0,background:!0}),...a(i,n,r)};case"CONTEXT_OPEN_IN_TAB":return{handler:()=>s(i,{newTab:!1}),...a(i,n,r)};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{handler:()=>s(i,{newWindow:!0}),...a(i,n,r)};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{handler:()=>s(i,{newWindow:!0,incognito:!0}),...a(i,n,r)};case"CONTEXT_CONTAINER_OPEN_IN_WINDOW":{const t=await Ta.getMenu(i,!0,[e.tipLink||""]);return{isVisible:()=>t.length>0,items:t,...a(i,n,r)}}case"CONTEXT_COPY":return{isVisible:()=>e.tipLink.length>0,handler:()=>function(){const{document:e}=t;e.addEventListener("copy",o),e.execCommand("copy"),e.removeEventListener("copy",o)}(),...a(i,n,r)};default:return{...a(i,n,r)}}}))}return Li.useEffect((()=>{const t=(new Date).valueOf();(!e.tipContent||e.tipTimestamp+144e5<t)&&function(){const e=new XMLHttpRequest;return new Promise(((t,n)=>{e.onload=function(){let{responseXML:n}=e;null===n&&/^\s/.test(e.responseText)&&(n=(new DOMParser).parseFromString(e.responseText.trim(),"text/xml"));const i=(0,Zn.t5)(n,e.responseText,R5);if(i&&"string"!=typeof i){const e=i.feeditems[0];return t({content:e.htmlsummary,url:e.id})}return t()},e.onerror=()=>n("Unable to fetch tip of the day."),e.overrideMimeType("text/xml"),e.open("GET",R5,!0),e.send(null)}))}().then((n=>{var s,o;n?.content&&e.tipContent!==n.content&&(s=e.id,o={tipContent:n.content,tipLink:n.url,tipTimestamp:t},A.Z.dispatch({actionType:"DASHBOARD_UPDATE_WIDGET",widgetId:s,tipData:o})),i(!0)})).catch((e=>{console.error(e),i(!0)}))}),[e.id,e.tipContent,e.tipLink,e.tipTimestamp]),L5(f4,{id:e.id,index:e.index,type:"tip",size:e.size,background:e.background,keyAccess:e.keyAccess,className:"Dashboard-TipWidget"},void 0,e.tipLink?L5("div",{className:"tip",onPointerDown:function(n){if(n.button,es.Z.kCenter,!e.tipLink)return;const i=t.vivaldiWindowId,o=(0,La.wJ)(i,n);o&&s(i,{newWindow:o.inNewWindow,background:o.inBackground,newTab:!o.inCurrent}),n.stopPropagation()},title:(0,B.Z)("Read more at $1",[e.tipLink]),onContextMenu:function(e){e.persist(),(0,ms.ZP)(e),a("tip").then((n=>{(0,cs.Z)(t,n)(e)}))}},void 0,L5("h1",{},void 0,e.tipContent)):n&&L5("span",{},void 0,(0,B.Z)("No Tip Available.")))}const F5=Li.memo(B5);var W5,U5;function V5(e,t,n,i){W5||(W5="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:W5,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class H5 extends Li.Component{static contextType=ts.Z;#tn=e=>{e=e||{};const t=this.props.node;e.newWindow?xi.Z.openBrowserWindow(this.context.vivaldiWindowId,t.url,{incognito:e.incognito,transition:se.Z.historyPrivate.TransitionType.AUTO_BOOKMARK}):c.ZP.openURL(this.context.vivaldiWindowId,t.url,{inCurrent:!e.newTab,inBackground:e.background,bookmarkId:t.id,addOpenerTabId:!0,transition:se.Z.historyPrivate.TransitionType.AUTO_BOOKMARK})};#nn=()=>{const{document:e}=this.context;e.addEventListener("copy",this.#in),e.execCommand("copy"),e.removeEventListener("copy",this.#in)};#in=e=>{ee.Z.copy(e,[this.props.node.id]),(0,ms.ZP)(e)};#sn=async()=>{const e=this.props.node.url;return e&&(await i.Z.history.deleteUrl({url:e}),se.Z.historyPrivate.updateTopSites()),this.props.onItemRemoved(),Promise.resolve()};#on=e=>{const t=this.context.vivaldiWindowId,n=ji.Z.getOptionFunction(e),i={};return ji.Z.getNamedMenu(t,e,(async e=>{switch(e.action){case"CONTEXT_OPEN_IN_NEW_TAB":return{handler:()=>this.#tn({newTab:!0}),...n(t,e,i)};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{handler:()=>this.#tn({newTab:!0,background:!0}),...n(t,e,i)};case"CONTEXT_OPEN_IN_TAB":return{handler:()=>this.#tn({newTab:!1}),...n(t,e,i)};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{handler:()=>this.#tn({newWindow:!0}),...n(t,e,i)};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{handler:()=>this.#tn({newWindow:!0,incognito:!0}),...n(t,e,i)};case"CONTEXT_CONTAINER_OPEN_IN_WINDOW":{const s=await Ta.getMenu(t,!0,[this.props.node.url||""]);return{isVisible:()=>s.length>0,items:s,...n(t,e,i)}}case"CONTEXT_COPY":return{handler:()=>this.#nn(),...n(t,e,i)};case"CONTEXT_DELETE":return{handler:()=>this.#sn(),isVisible:()=>!this.props.node.partner,...n(t,e,i)};case"CONTEXT_HIDE_SUGGESTIONS":return{handler:()=>{w.Z.set(I.kDashboardTopSitesHideSuggestions,!0),ee.Z.setTopSites()},isVisible:()=>Boolean(this.props.node.partner),...n(t,e,i)};default:return{...n(t,e,i)}}}))};#x=e=>{e.persist(),(0,ms.ZP)(e),this.#on("topsite").then((t=>{(0,cs.Z)(this.context,t)(e)}))};#Jt=e=>{const t=(0,La.wJ)(this.context.vivaldiWindowId,e);t&&this.#tn({newWindow:t.inNewWindow,background:t.inBackground,newTab:!t.inCurrent})};#en=e=>{e.button,es.Z.kCenter,this.#Jt(e)};#Ot=e=>{const t=(0,ps.Z)(e);switch(e.key){case"Enter":case" ":this.#Jt(e);break;case"ArrowLeft":if(t||!this.props.moveFocus(this.props.node.id,"left"))return;(0,ms.ZP)(e);break;case"ArrowRight":if(t||!this.props.moveFocus(this.props.node.id,"right"))return;(0,ms.ZP)(e);break;case"ArrowUp":if(t||!this.props.moveFocus(this.props.node.id,"up"))return;(0,ms.ZP)(e);break;case"ArrowDown":if(t||!this.props.moveFocus(this.props.node.id,"down"))return;(0,ms.ZP)(e)}};render(){const{favIconUrl:e,favIconLoadType:t}=pn.jk.getBookmarkFavicon(this.props.node.url,this.props.node.faviconUrl);return V5("div",{className:Fi()("item",this.props.background,{"show-title":this.props.showTitle}),onPointerDown:this.#en,onContextMenu:this.#x,onKeyDown:this.#Ot,tabIndex:this.props.keyAccess,title:this.props.node.title,"aria-label":this.props.node.title,role:"link","data-id":this.props.node.id},void 0,V5("span",{className:"icon-wrapper"},void 0,V5(Ri.ZP,{className:"favicon",url:e,loadType:t,size:32})),this.props.showTitle&&V5("p",{},void 0,this.props.node.title))}}function G5(e,t,n,i){U5||(U5="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:U5,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const $5={"--shortcut-item-width":"78px","--shortcut-list-gap":"12px"};function K5(e){const[t,n]=Li.useState(g.Z.getTopSiteFolder()?.children??[]),i=Li.useRef();Li.useEffect((()=>{const e=()=>{if(g.Z.isInitialized()){const e=g.Z.getTopSiteFolder()?.children??[];n(e)}else setTimeout(e,500)};return g.Z.addListener(e),()=>g.Z.removeListener(e)}),[]);const s=Li.useCallback((()=>[{type:"checkbox",checked:e.showTitle,handler:()=>{return t=e.id,n=!e.showTitle,void A.Z.dispatch({actionType:"DASHBOARD_UPDATE_WIDGET",widgetId:t,showTitle:n});var t,n},...(0,us.Z)("Show Site Title")}]),[e.id,e.showTitle]),o=(e,t)=>{const n=i.current;if(n){const i=Math.floor((n.clientWidth-(0,Cs.np)())/90);return aw(e,t,Array.from(n.querySelectorAll(".item")),i)}return!1};return G5(f4,{id:e.id,index:e.index,type:"top-sites",size:e.size,background:e.background,keyAccess:e.keyAccess,className:"Dashboard-TopSites",getMenu:s},void 0,t.length?(0,ss.jsx)("div",{ref:i,className:"top-sites-wrapper scrollable",style:$5,children:t.slice(0,8).map(((i,s)=>G5(H5,{node:i,showTitle:e.showTitle,keyAccess:0===s?0:-1,onItemRemoved:()=>n(t.filter((e=>e.id!==i.id))),background:e.background,moveFocus:o},i.url)))}):G5("div",{className:"widget-config-intro"},void 0,G5("span",{className:"icon",dangerouslySetInnerHTML:{__html:Wi.ObT.medium}}),G5("p",{},void 0,(0,B.Z)("After some time of browsing in Vivaldi, Top Sites will populate with frequently visites web pages."))))}function z5(e){return 1.8*e+32}function j5(e,t){switch(t){case"kph":return(0,B.Z)("$1 km/h",[(3.6*e).toFixed(1)]);case"mph":return(0,B.Z)("$1 mph",[(2.236936*e).toFixed(1)]);default:return(0,B.Z)("$1 m/s",[e.toFixed(1)])}}function Y5(e,t){return"inches"===t?(0,B.Z)("$1 in",[(.0393700787*e).toFixed(2)]):(0,B.Z)("$1 mm",[e.toFixed(1)])}function X5(e,t,n){return e>27?function(e,t){return 1.61139411*e-8.784695+2.338549*t-.14611605*e*t-.01230809*Math.pow(e,2)-.01642482*Math.pow(t,2)+.00221173*Math.pow(e,2)*t+72546e-8*e*Math.pow(t,2)-358e-8*Math.pow(e,2)*Math.pow(t,2)}(e,t):e<10?function(e,t){return 13.12+.6215*e-11.37*Math.pow(t,.16)+.3965*e*Math.pow(t,.16)}(e,n):e}var Q5;function q5(e,t,n,i){Q5||(Q5="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Q5,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const J5={sameDay:(0,B.Z)("[Later]"),nextDay:(0,B.Z)("[Tomorrow]"),nextWeek:"dddd",lastDay:"dddd",lastWeek:"dddd",sameElse:"dddd"};function e6({todayForecast:e,forecast:t,temperatureUnit:n,windspeedUnit:i,precipitationUnit:s,locationId:o,view:a="WEEK",onViewChanged:r,background:l}){const d=(0,Ya.Z)([I.kCalendarRelativeDates]),c=Li.useId(),u=Li.useId(),p=Li.useMemo((()=>{const e=t?.forecast.properties.dates??{},n={};for(const t of Object.keys(e))if(n[t]=e[t],7===Object.keys(n).length)break;return n}),[t]),h=Li.useCallback((e=>{r({locationId:o,view:e===c?"WEEK":"DAY"})}),[o,r,c]),g=Li.useMemo((()=>{const e=R.ZP.getShortDateFormat();return t=>d[I.kCalendarRelativeDates]?t.calendar(J5):t.format(e)}),[d]);return q5(PV,{activeTabId:"WEEK"===a?c:u,onTabClick:h,className:p4(l)?f.sg:l},void 0,q5("div",{id:u,label:(0,B.Z)("Today's Forecast","Today")},void 0,q5("table",{className:"hourly-forecast"},void 0,q5("tbody",{},void 0,"DAY"!==a?null:e.map((e=>{const{symbol_code:o,air_temperature:a,precipitation_amount:r,wind_speed:l,wind_from_direction:d}=e.data;return q5("tr",{},e.time,q5("td",{},void 0,hO().tz(e.time,t?.city.timezone).add(30,"minute").startOf("hour").format("LT")),q5("td",{},void 0,q5("img",{src:`resources/weather_icons_svg/${o}.svg`,height:24,width:24,alt:o})),q5("td",{},void 0,function(e,t){return"fahrenheit"===t?(0,B.Z)("$1°",[Math.round(z5(e))]):(0,B.Z)("$1°",[Math.round(e)])}(a,n)),q5("td",{},void 0,Y5(r,s)),q5("td",{},void 0,j5(l,i)),q5("td",{},void 0,q5("span",{style:{rotate:`${d}deg`,height:"16px",width:"16px"},dangerouslySetInnerHTML:{__html:Wi.lWf}})))}))))),q5("div",{id:c,label:(0,B.Z)("Week")},void 0,q5("table",{className:"week-forecast"},void 0,q5("tbody",{},void 0,"WEEK"!==a?null:Object.keys(p).map(((e,t)=>{const o=p[e],a=function(e){const t=Object.groupBy(e,(e=>e.data.symbol_code));let n="",i=0;for(const[e,s]of Object.entries(t))s.length>i&&(n=e,i=s.length);return n}(o),r=a.replace(/(_night|_polartwilight)/g,"_day");const l=function(e,t){const[n,i]=e.reduce(((e,t)=>{const n=t.data.air_temperature;return[n<e[0]?n:e[0],n>e[1]?n:e[1]]}),[1/0,-1/0]);return{minTemperature:Math.round("fahrenheit"===t?z5(n):n),maxTemperature:Math.round("fahrenheit"===t?z5(i):i)}}(o,n),d=0===(c=o).length?0:c.reduce(((e,t)=>e+t.data.wind_speed),0)/c.length;var c;const u=hO()(e);return q5("tr",{},e,q5("td",{title:u.format(R.ZP.getWeekdayFormat())},void 0,g(u)),q5("td",{},void 0,q5("img",{src:`resources/weather_icons_svg/${r}.svg`,onError:({currentTarget:e})=>e.src=`resources/weather_icons_svg/${a}.svg`,height:24,width:24,alt:a})),q5("td",{},void 0,q5("span",{},void 0,(0,B.Z)("$1°",[l.minTemperature]))," / ",q5("strong",{},void 0,(0,B.Z)("$1°",[l.maxTemperature]))),q5("td",{},void 0,Y5(function(e){return e.reduce(((e,t)=>e+t.data.precipitation_amount),0)}(o),s)),q5("td",{},void 0,j5(d,i)))}))))))}const t6=Li.memo(e6);var n6;function i6(e,t,n,i){n6||(n6="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:n6,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function s6(e,t,n){return(0,ss.jsx)(ss.Fragment,{children:i6("span",{className:n},void 0,"celsius"===t?(0,B.Z)("$1°C",[Math.round(e)]):(0,B.Z)("$1°F",[Math.round(z5(e))]))})}function o6({todayForecast:e,forecast:t,temperatureUnit:n,windspeedUnit:i,precipitationUnit:s,multipleViews:o}){const[a,r]=Li.useState(),l=hO()(A4("minutes"));Li.useEffect((()=>{let t;return function n(){const i=Date.now(),s=a?me.lb-(i+1)%me.lb:0;t=setTimeout((()=>{r(e.find((e=>new Date(e.time).getHours()===(new Date).getHours()))),n()}),s)}(),()=>clearTimeout(t)}),[a,e]);const d=Li.useMemo((()=>{const e=t?.city,n=a?.time;if(n&&e)return o?hO().tz(l,e.timezone).format("LT"):hO().tz(l,e.timezone).format(R.ZP.getWeekdayFormat(R.ZP.getShortDateFormat(!1)))}),[t?.city,a?.time,o,l]);if(!a||!t)return null;const{symbol_code:c,air_temperature:u,relative_humidity:p,wind_speed:h,precipitation_amount:g}=a.data;return i6("div",{className:"today-forecast-wrapper"},void 0,i6("div",{},void 0,i6("span",{className:"heading block"},void 0,t.city.name),i6("span",{className:"date"},void 0,d),i6("div",{className:"current-forecast"},void 0,i6("img",{src:`resources/weather_icons_svg/${c}.svg`,height:48,width:48,alt:c}),s6(u,n,"heading"))),i6("div",{className:"forecast-details"},void 0,i6("span",{dangerouslySetInnerHTML:{__html:Wi.kHg}}),i6("span",{},void 0,(0,B.Z)("Feels like")),i6("strong",{},void 0,s6(X5(u,p,h),n)),i6("span",{dangerouslySetInnerHTML:{__html:Wi.RBC}}),i6("span",{},void 0,(0,B.Z)("Rain")),i6("strong",{},void 0,Y5(g,s)),i6("span",{dangerouslySetInnerHTML:{__html:Wi.Xzh}}),i6("span",{},void 0,(0,B.Z)("Wind")),i6("strong",{},void 0,j5(h,i))))}const a6=Li.memo(o6);var r6,l6=n(64136);function d6(e,t,n,i){r6||(r6="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:r6,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const c6=(0,Ae.Z)(((e,t)=>{(async function(e){const t=R.ZP.UI_LANGUAGE.substring(0,2),n=await fetch(`https://weather.vivaldi.com/cities/?lang=${t}&s=${e}`),i=await n.json();return i&&i.results?i.results.slice(0,4).map((e=>({value:e.id,label:`${e.city}, ${e.admin_division1}, ${e.country}`}))):[]})(e).then(t)}),500,{leading:!0});function u6(){return(0,B.Z)("Loading...")}function p6(){return(0,B.Z)("No options")}var h6=d6("input",{type:"radio",value:"celsius"}),g6=d6("input",{type:"radio",value:"fahrenheit"}),m6=d6("input",{type:"radio",value:"mm"}),f6=d6("input",{type:"radio",value:"inches"});function v6(e){const[t,n]=Li.useState(),[i,s]=Li.useState(e.temperatureUnit),[o,a]=Li.useState(e.windspeedUnit),[r,l]=Li.useState(e.precipitationUnit);const d=Li.useCallback((e=>n(e.value)),[]),c=Li.useCallback((e=>{const{value:t}=e.target;s("fahrenheit"===t?t:"celsius")}),[]),u=Li.useCallback((e=>{const{value:t}=e.target;switch(t){case"ms":case"kph":case"mph":a(t);break;default:console.error("Invalid windspeed unit")}}),[]),p=Li.useCallback((e=>{const{value:t}=e.target;l("inches"===t?t:"mm")}),[]);return d6("form",{className:"widget-config vivaldi-settings"},void 0,d6("div",{className:"widget-config-content"},void 0,d6("div",{className:"setting-group"},void 0,d6("h3",{},void 0,(0,B.Z)("forecast","Location")),d6("div",{className:"setting-single"},void 0,d6("label",{className:"floating-label"},void 0,d6(l6.Z,{className:"VivaldiSelector",classNamePrefix:"Inner",placeholder:(0,B.Z)("Enter City Name"),loadOptions:c6,loadingMessage:u6,noOptionsMessage:p6,onChange:d,"aria-labelledby":"arialabel",menuPlacement:"auto",autoFocus:!0}))),d6(ja.Z,{name:"WeatherWidgetTemperature",onChange:c,value:i,className:"setting-group temperature-radio-group"},void 0,d6("div",{className:"setting-single pad-top"},void 0,d6("h3",{},void 0,(0,B.Z)("Temperature:")),d6("div",{className:"setting-single"},void 0,d6("label",{},void 0,h6,d6("span",{},void 0,(0,B.Z)("Celsius (°C)")))),d6("div",{className:"setting-single"},void 0,d6("label",{},void 0,g6,d6("span",{},void 0,(0,B.Z)("Fahrenheit (°F)")))))),d6("div",{className:"setting-single pad-top"},void 0,d6("h3",{},void 0,(0,B.Z)("Wind speed:")),d6("div",{className:"setting-single"},void 0,d6(ta.Z,{value:o,onChange:u},void 0,d6("option",{value:"ms"},void 0,(0,B.Z)("Meters per Second (m/s)")),d6("option",{value:"kph"},void 0,(0,B.Z)("Kilometers per Hour (km/h)")),d6("option",{value:"mph"},void 0,(0,B.Z)("Miles per Hour (mph)"))))),d6(ja.Z,{name:"WeatherWidgetPrecipitation",onChange:p,value:r,className:"setting-group precipitation-radio-group"},void 0,d6("div",{className:"setting-single pad-top"},void 0,d6("h3",{},void 0,(0,B.Z)("Precipitation:")),d6("div",{className:"setting-single"},void 0,d6("label",{},void 0,m6,d6("span",{},void 0,(0,B.Z)("Millimeters (mm)")))),d6("div",{className:"setting-single"},void 0,d6("label",{},void 0,f6,d6("span",{},void 0,(0,B.Z)("Inches (in)")))))))),d6("footer",{className:"widget-config-footer"},void 0,d6("input",{type:"submit",value:(0,B.Z)("verb","Done"),disabled:void 0===t,onClick:function(){e.onChange({locationId:t,temperatureUnit:i,windspeedUnit:o,precipitationUnit:r})}})))}class y6 extends m.Z{getInitialState(){return new Map}getForecastByLocationId(e){return this.getState().get(e)}getNextUpdate(e){return this.getState().get(e)?.nextUpdate}reduce(e,t){const n=new Map(e);return"WEATHER_UPDATE"===t.actionType?(n.set(t.locationId,t.forecast),n):e}}const b6=new y6;var S6;function w6(e,t,n,i){S6||(S6="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:S6,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function C6(e=0){return hO()().add(e,"day").toISOString().split("T")[0]}const A6=["regular","double_height"];function I6(e){const t=function(e){const[t,n]=Li.useState(e?b6.getForecastByLocationId(e):void 0),i=Li.useRef();return Li.useEffect((()=>{let t;return e&&async function e(n){const s=b6.getNextUpdate(n),o=new Date;(n!==i.current||!s||s<=o)&&q(n),i.current=n,t=setTimeout((async()=>e(n)),6e5)}(e),()=>clearTimeout(t)}),[e]),Li.useEffect((()=>{function t(){e&&n(b6.getForecastByLocationId(e))}return b6.addListener(t),()=>b6.removeListener(t)}),[e]),t}(e.locationId),n=Li.useMemo((()=>{const e=new Date;e.setMinutes(0,0,0);const n=e.getTime();return[C6(),C6(1)].reduce(((e,i)=>e.concat(t?.forecast.properties.dates[i]?.filter((e=>new Date(e.time).getTime()>=n))??[])),[]).slice(0,24)}),[t]),i=Li.useCallback((t=>D(e.id,t)),[e.id]),s=Li.useMemo((()=>{const e=t?.forecast.properties.meta.updated_at;return e?hO()(e).format(hO()(e).isSame(new Date,"day")?"LT":"ll"):""}),[t?.forecast.properties.meta.updated_at]),o=Li.useCallback((()=>{const{id:t,locationId:n,temperatureUnit:i,windspeedUnit:s,precipitationUnit:o}=e;return[{handler:()=>{D(t,{locationId:void 0})},...(0,us.Z)("Change Location")},{items:[{type:"checkbox",checked:"celsius"===i,handler:()=>D(t,{locationId:n,temperatureUnit:"celsius",windspeedUnit:s,precipitationUnit:o}),...(0,us.Z)("Celsius")},{type:"checkbox",checked:"fahrenheit"===i,handler:()=>D(t,{locationId:n,temperatureUnit:"fahrenheit",windspeedUnit:s,precipitationUnit:o}),...(0,us.Z)("Fahrenheit")}],...(0,us.Z)("Temperature Unit")},{items:[{type:"checkbox",checked:"ms"===s,handler:()=>D(t,{locationId:n,temperatureUnit:i,windspeedUnit:"ms",precipitationUnit:o}),...(0,us.Z)("m/s")},{type:"checkbox",checked:"kph"===s,handler:()=>D(t,{locationId:n,temperatureUnit:i,windspeedUnit:"kph",precipitationUnit:o}),...(0,us.Z)("km/h")},{type:"checkbox",checked:"mph"===s,handler:()=>D(t,{locationId:n,temperatureUnit:i,windspeedUnit:"mph",precipitationUnit:o}),...(0,us.Z)("mph")}],...(0,us.Z)("Wind Speed Unit")},{items:[{type:"checkbox",checked:"mm"===o,handler:()=>D(t,{locationId:n,temperatureUnit:i,windspeedUnit:s,precipitationUnit:"mm"}),...(0,us.Z)("millimeters")},{type:"checkbox",checked:"inches"===o,handler:()=>D(t,{locationId:n,temperatureUnit:i,windspeedUnit:s,precipitationUnit:"inches"}),...(0,us.Z)("inches")}],...(0,us.Z)("Precipitation Unit")}]}),[e]),{onLine:a}=navigator;return w6(f4,{id:e.id,index:e.index,type:"weather",size:e.size,sizeOptions:A6,background:e.background,keyAccess:e.keyAccess,getMenu:o,className:"Dashboard-WeatherWidget"},void 0,!a&&w6("div",{className:"weather-wrapper"},void 0,(0,B.Z)("No internet connection")),a&&void 0!==e.locationId&&w6("div",{className:"weather-wrapper"},void 0,n&&(0,ss.jsxs)(ss.Fragment,{children:[w6(a6,{todayForecast:n,forecast:t,temperatureUnit:e.temperatureUnit,windspeedUnit:e.windspeedUnit,precipitationUnit:e.precipitationUnit,multipleViews:e.multipleViews}),"double_height"===e.size&&w6(t6,{todayForecast:n,forecast:t,temperatureUnit:e.temperatureUnit,windspeedUnit:e.windspeedUnit,precipitationUnit:e.precipitationUnit,locationId:e.locationId,view:e.view,onViewChanged:i,background:e.background}),w6("div",{className:"provider"},void 0,w6("div",{},void 0,(0,B.Z)("Forecast from MET.no")),s&&w6("div",{},void 0,(0,B.Z)("Updated at $1",[s])))]})),a&&void 0===e.locationId&&w6("section",{},void 0,w6(v6,{id:e.id,onChange:i,temperatureUnit:e.temperatureUnit,windspeedUnit:e.windspeedUnit,precipitationUnit:e.precipitationUnit})))}const T6=Li.memo(I6);var Z6;function E6(e,t,n,i){Z6||(Z6="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Z6,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const k6=void 0,_6=(0,B.Z)("You must provide a URL.");function N6({id:e,onValidate:t,widgetUrl:n,iconSize:i,shareTheme:s}){const o=Li.useContext(ts.Z),[a,r]=Li.useState(n),[l,d]=Li.useState(s),[c,u]=Li.useState(k6),p=Oi.Z.isEnabled("omnibox");return Li.useEffect((()=>{function t(t){(0,Dv.RT)(o,e)&&u(k6)}return o.document.addEventListener("keydown",t),()=>o.document.removeEventListener("keydown",t)}),[o,e]),Li.useEffect((()=>{function t(){const{typedUrl:t}=p?Rv.getUrlfieldState(e):rb.getUrlfieldState(e);r(t)}return p?(Rv.addListener(t),()=>Rv.removeListener(t)):(rb.addListener(t),()=>rb.removeListener(t))}),[e,p]),E6("form",{className:"widget-config"},void 0,E6("div",{className:"widget-config-intro"},void 0,E6("span",{className:"icon",dangerouslySetInnerHTML:{__html:Wi.LQS[i]}}),E6("p",{},void 0,(0,B.Z)("A simple webpage view. Enter the address below."))),E6("label",{className:"widget-config-content",title:(0,B.Z)("Enter webpage address")},void 0,E6("span",{},void 0,(0,B.Z)("URL")),p?E6(ib,{placeholder:"https://vivaldi.net",displayUrl:"",typedUrl:a,autocompletionEnabled:!0,typedHistoryEnabled:!1,showDropdown:!1,pageId:e,inputId:e,pageContext:{},autoFocus:!0}):E6(ZS,{placeholder:"https://vivaldi.net",displayUrl:"",typedUrl:a,autocompletionEnabled:!0,autocompleteOnTitle:!1,typedHistoryEnabled:!1,showDropdown:!1,pageId:e,inputId:e,pageContext:{},autoFocus:!0}),c&&E6("p",{className:"error"},void 0,c)),E6("label",{className:"widget-config-content",title:(0,B.Z)("Allow webpages in this widget to access current theme base colors.")},void 0,E6("input",{type:"checkbox",checked:l,onChange:e=>d(e.currentTarget.checked)}),E6("span",{},void 0,(0,B.Z)("Share Theme Colors"))),E6("footer",{className:"widget-config-footer"},void 0,E6("input",{type:"submit",value:(0,B.Z)("verb","Done"),onClick:function(){let n=c;const{autocompleteValue:i}=p?Rv.getUrlfieldState(e):rb.getUrlfieldState(e),s=(i||a||"").trim(),o=(0,rl.q9)(s,!0).trim();s.includes(" ")&&(n=_6),0===o.length||n||t(o,l),n&&u(n)}})))}var P6;function D6(e,t,n,i){P6||(P6="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:P6,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const M6={contentload:"handleContentLoad",dialog:"handleDialog",loadabort:"handleAbort",loadstop:"handleLoadStop",newwindow:"handleNewWindow",permissionrequest:"handleOnPermissionRequest",targeturlchanged:"handleTargetURLChanged",close:"handleOnClose"};function O6(){let e=navigator.userAgent;const t=e.indexOf("("),n=e.indexOf(")",t);return t>=0&&n>t&&(e=e.substring(0,t+1)+"Linux; Android 10; K"+e.substring(n)),e=e.replace("Safari","Mobile Safari"),e}var x6=D6(co,{type:"close",size:16});class L6 extends Li.PureComponent{static contextType=ts.Z;nodeRef=Li.createRef();refWebpanelwebview=Li.createRef();winId=this.context.vivaldiWindowId;messageId=this.props.webPanel.id;state={title:(0,B.Z)("Loading..."),tooltip:void 0,canGoBack:!1,canGoForward:!1,canReload:!1,muted:!1,tabId:void 0};_lookupFavicon=!0;#an=!1;componentDidMount(){const e=this.refWebpanelwebview.current;e&&(this.props.webPanel.mobileMode&&e.setUserAgentOverride(O6()),1!==this.props.webPanel.zoom&&e.setZoom(this.props.webPanel.zoom),this.attachWebViewEventHandlers(e),vr.Z.isExtPanel(this.props.webPanel.id)||this.props.webPanel.activeUrl?e.src=this.props.webPanel.activeUrl:e.src=this.props.webPanel.url),Yn.ZP.addListener(this.onPanelStoreChange),Xe.Z.addListener(this._alarmsChanged),(0,Fn.Tg)(this._onMessageReceived),jn.Z.setWebPanelBoolValue(this.props.webPanel.id,"hasBeenVisible",!0)}componentWillUnmount(){const e=this.refWebpanelwebview.current;e&&this.removeWebViewEventHandlers(e),Xe.Z.removeListener(this._alarmsChanged),(0,Fn.eL)(this._onMessageReceived)}attachWebViewEventHandlers=e=>{Object.keys(M6).forEach((t=>{e.addEventListener(t,this[M6[t]])}))};removeWebViewEventHandlers=e=>{Object.keys(M6).forEach((t=>{e.removeEventListener(t,this[M6[t]])}))};_alarmsChanged=e=>{const t=e?.find((e=>e&&"RELOAD"===e.type&&this.props.webPanel.id.endsWith(e.id)));t&&this.reload()};componentDidUpdate(e){if(this.#an)return;const{document:t}=this.context,n=this.refWebpanelwebview.current;this.props.webPanel.mobileMode!==n?.isUserAgentOverridden()&&(this.props.webPanel.mobileMode?n?.setUserAgentOverride(O6()):n?.setUserAgentOverride(navigator.userAgent),this.home()),n?.setZoom(this.props.webPanel.zoom||1);const i=e.webPanel,s=this.props.webPanel,o=vr.Z.isExtPanel(s.id);!this.props.isVisible||!this.props.focusContent&&!o||!t.activeElement||t.activeElement===this.refWebpanelwebview.current||e.isVisible&&s.activeUrl===i.activeUrl||(o&&n&&n.src!==s.activeUrl&&(n.src=s.activeUrl),t.activeElement.blur(),this.refWebpanelwebview.current?.focus())}onPanelStoreChange=()=>{const e=Yn.ZP.getWindowData(this.winId),t=Yn.ZP.getChangeReason();if(!e)return;const{document:n}=this.context;if("setFocus"===t)this.props.isVisible&&!(0,Ra.sT)(n,this.nodeRef.current)&&n.activeElement&&(n.activeElement.blur(),this.refWebpanelwebview.current?.focus());else{const e=Yn.ZP.getIsMuted(this.winId,this.props.webPanel.id);this.state.muted!==e&&this.setState({muted:e},(()=>{const t=this.refWebpanelwebview.current;t&&t.setAudioMuted(e)}))}};_onMessageReceived=(e,t,n)=>{if("WEB_PANEL_TITLE_CHANGED"===e.type&&e.messageId===this.messageId){const t=e.title;jn.Z.setWebPanelStringValue(this.props.webPanel.id,"title",t),this.setTitle(t)}};handleNewWindow=async e=>{switch(e.windowOpenDisposition){case"current_tab":case"new_foreground_tab":e.preventDefault(),e.window.accept(this.winId+";1");break;case"new_background_tab":e.preventDefault(),e.window.accept(this.winId+";0");break;case"new_window":case"off_the_record":e.preventDefault(),xi.Z.openBrowserWindow(this.winId,e.targetUrl,{incognito:"off_the_record"===e.windowOpenDisposition});break;case"new_popup":e.preventDefault()}};handleOnClose=async e=>{this.#an=!0,jn.Z.setWebPanelBoolValue(this.props.webPanel.id,"hasBeenVisible",!1),jn.Z.setWebPanels(),jn.Z.closePanel(this.winId)};handleDialog=e=>{"confirm"===e.messageType||"prompt"===e.messageType?e.dialog.cancel():"alert"===e.messageType&&e.dialog.ok("")};handleTargetURLChanged=({newUrl:e})=>{const t=(0,aS.ZP)(e);u.Z.setStatus(this.winId,t)};getFaviconHost=()=>{const e=(0,ge.Z)(this.refWebpanelwebview.current?.src??"");return e?.protocol&&e?.host?e.protocol+"//"+e.host+"/":""};handleLoadStop=e=>{const t=this.refWebpanelwebview.current;if(vr.Z.isExtPanel(this.props.webPanel.id))this.setState({canGoBack:!1,canGoForward:!1,canReload:!1});else{this.setState({canGoBack:t?.canGoBack(),canGoForward:t?.canGoForward(),canReload:!0});const e=this.refWebpanelwebview.current?.src??"";jn.Z.setWebPanelStringValue(this.props.webPanel.id,"activeUrl",e)}if(this._lookupFavicon){const e=this.props.webPanel;vr.Z.isExtPanel(e.id)?jn.Z.setWebPanelStringValue(e.id,"faviconUrl",e.url):setTimeout(this.onSetFaviconUrl.bind(this),1e3),this._lookupFavicon=!1}t?.setZoomMode("per-view")};handleContentLoad=e=>{this.refWebpanelwebview.current?.executeScript({code:"document.title"},(e=>{if(Array.isArray(e)&&e.length>0&&"string"==typeof e[0]){const t=e[0];this.setState({title:t,tooltip:void 0}),jn.Z.setWebPanelStringValue(this.props.webPanel.id,"title",t)}}));const t=`(function() {\n      const target = document.querySelector('title');\n      const observer = new MutationObserver(mutations => {\n        chrome.runtime.sendMessage({\n          type: "WEB_PANEL_TITLE_CHANGED",\n          messageId: "${this.messageId}",\n          title: mutations[0].target.innerText\n        });\n      });\n      observer.observe(target, { subtree: true, characterData: true, childList: true });\n    })()`;this.refWebpanelwebview.current?.executeScript({code:t},(()=>{i.Z.runtime.lastError&&console.warn("listenForTitleChange:",i.Z.runtime.lastError)})),this.refWebpanelwebview.current?.executeScript({file:"inject-all-bundle.js"})};handleAbort=e=>{const t=(0,B.Z)("Aborted"),n=(0,B.Z)("Loading aborted with reason $1",[e.reason]);this.setState({title:t,tooltip:n})};onSetFaviconUrl=()=>{const e=this.refWebpanelwebview.current?.src??"";jn.Z.setWebPanelStringValue(this.props.webPanel.id,"faviconUrl",e)};reload=()=>{this.setState({title:(0,B.Z)("Loading..."),tooltip:void 0,canReload:!1}),this.refWebpanelwebview.current?.reload()};home=()=>{if(vr.Z.isExtPanel(this.props.webPanel.id))return;this.setState({title:(0,B.Z)("Loading..."),tooltip:void 0,canReload:!1});const e=this.refWebpanelwebview.current;e&&(e.src=this.props.webPanel.url)};back=()=>{this.refWebpanelwebview.current?.back()};forward=()=>{this.refWebpanelwebview.current?.forward()};setTitle=e=>{this.setState({title:e})};onContextMenu=e=>{e.persist(),e.preventDefault(),e.stopPropagation(),xS.getPromise(this.winId,this.props.webPanel.id,{title:this.props.webPanel.title,url:this.props.webPanel.url,activeUrl:this.props.webPanel.activeUrl,faviconUrl:this.props.webPanel.faviconUrl,muted:Yn.ZP.getIsMuted(this.winId,this.props.webPanel.id),mobileMode:this.props.webPanel.mobileMode}).then((t=>{(0,cs.Z)(this.context,t)(e)}))};handleOnPermissionRequest=e=>{if(e.preventDefault(),"download"===e.permission)C.Z.get(I.kDownloadsStartAutomatically)?(e.request.allow(),C.Z.get(I.kDownloadsOpenPanelOnNew)&&((0,Qf.PK)("DownloadButton",this.winId)?ne.Z.executeActions("event",this.context,"COMMAND_SHOW_DOWNLOADS_POPOUT"):Yn.ZP.canAutoOpen(this.winId,"PanelDownloads")&&jn.Z.toggleContent(this.winId,"PanelDownloads"))):this.showDialog(e)};showDialog=e=>{const t=this.refWebpanelwebview.current;e.webview=t,e.dialogtype=e.permission,de.Z.showDialog(this.winId,e,null)};setZoomLevel=e=>{if(!this.refWebpanelwebview.current)return;const{zoom:t=1,id:n}=this.props.webPanel,i=e?t+fw.Zh:t-fw.Zh,s=Math.min(Math.max(i,fw.XF),fw.qt),o=Number(s.toFixed(1));vr.Z.setZoom(n,o)};resetZoom=()=>vr.Z.setZoom(this.props.webPanel.id,1);decreaseZoom=()=>this.setZoomLevel(!1);increaseZoom=()=>this.setZoomLevel(!0);render(){const e=Fi()({panel:!0,webpanel:!0,visible:this.props.isVisible});let t=vr.Z.makePanelId(this.props.webPanel.id,this.winId);return this.props.webPanel.tabId&&(t=""+this.props.webPanel.tabId),(0,ss.jsxs)("div",{ref:this.nodeRef,className:e,children:[this.props.isVisible&&this.props.panelUI.showToolbar&&D6("header",{className:"webpanel-header",onContextMenu:this.onContextMenu},void 0,D6("div",{className:"toolbar toolbar-default full-width",role:"toolbar","aria-labelledby":"webpanel-title"},void 0,D6("h1",{className:"webpanel-title",title:this.state.tooltip||this.state.title},void 0,D6("span",{id:"webpanel-title"},void 0,this.state.title)),D6("div",{className:"toolbar toolbar-group"},void 0,this.props.panelUI.zoomControls&&D6("div",{className:"toolbar-group pad-right"},void 0,D6("div",{className:"button-toolbar"},void 0,D6("button",{className:"ToolbarButton-Button",title:(0,B.Z)("Reset Zoom"),onClick:this.resetZoom,disabled:!this.refWebpanelwebview||1===this.props.webPanel.zoom,dangerouslySetInnerHTML:{__html:Wi.kze}})),D6("div",{className:"button-toolbar"},void 0,D6("button",{className:"ToolbarButton-Button",title:(0,B.Z)("Zoom Out"),onClick:this.decreaseZoom,disabled:!this.refWebpanelwebview,dangerouslySetInnerHTML:{__html:Wi.M2k.small}})),D6("div",{className:"button-toolbar"},void 0,D6("button",{className:"ToolbarButton-Button",title:(0,B.Z)("Zoom In"),onClick:this.increaseZoom,disabled:!this.refWebpanelwebview,dangerouslySetInnerHTML:{__html:Wi.md4.small}}))),this.props.panelUI.deviceControl&&D6("div",{className:"toolbar-group pad-right"},void 0,D6("div",{className:"button-toolbar"},void 0,D6("button",{className:"ToolbarButton-Button",title:this.props.webPanel.mobileMode?(0,B.Z)("Switch to Desktop View"):(0,B.Z)("Switch to Mobile View"),onClick:()=>vr.Z.setMobileMode(this.props.webPanel.id,!this.props.webPanel.mobileMode),dangerouslySetInnerHTML:this.props.webPanel.mobileMode?{__html:Wi.X6J}:{__html:Wi.hPK}}))),this.props.panelUI.allControls&&(0,ss.jsxs)(ss.Fragment,{children:[D6("div",{className:"button-toolbar"},void 0,D6("button",{className:"button-toolbar back",title:(0,B.Z)("navigation","Back"),onClick:this.back,disabled:!this.state.canGoBack,dangerouslySetInnerHTML:{__html:Wi.mgF.small}})),D6("div",{className:"button-toolbar"},void 0,D6("button",{className:"button-toolbar forward",title:(0,B.Z)("navigation","Forward"),onClick:this.forward,disabled:!this.state.canGoForward,dangerouslySetInnerHTML:{__html:Wi.Zu.small}})),D6("div",{className:"button-toolbar"},void 0,D6("button",{className:"button-toolbar reload",title:(0,B.Z)("Reload"),onClick:this.reload,disabled:!this.state.canReload,dangerouslySetInnerHTML:{__html:Wi.GO5.small}}))]}),D6("div",{className:"button-toolbar"},void 0,D6("button",{className:"button-toolbar home",title:(0,B.Z)("Home"),onClick:this.home,disabled:!this.state.canReload,dangerouslySetInnerHTML:{__html:Wi.PaK.small}}))),this.props.showCloseButton&&D6("button",{className:"close transparent",onClick:()=>jn.Z.closePanel(this.winId),tooltip:(0,B.Z)("Close Panel")},void 0,x6))),D6("section",{className:"webpanel-content"},void 0,(0,ss.jsx)("webview",{tab_id:t,parent_tab_id:"0",ref:this.refWebpanelwebview,name:"vivaldi-webpanel"},t))]})}}const R6=L6;var B6;function F6(e,t,n,i){B6||(B6="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:B6,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const W6=["regular","double_height"];function U6(e){return e?(0,ge.Z)(e)?.hostname:""}function V6(e){const t=Li.useContext(ts.Z),n=Li.useRef(null),[s,o]=Li.useState(!e.url),[a,r]=Li.useState(U6(e.url)),[l,d]=Li.useState((0,Ty.dO)(e.url??"about:blank")),[c,u]=Li.useState(void 0),p=Li.useCallback((()=>{const e=n?.current;if(e){const n=Be.Z.getBaseStylesByWindowId(t.vivaldiWindowId,["colorFg","colorBg","colorBgLight","colorHighlightFg","colorHighlightBg","radius"]),i=Cs.ZP.isThemeDark({"--colorBg":n["--colorBg"]}),s=`:root {\n        --colorFg: ${n["--colorFg"]};\n        --colorBg: ${n["--colorBgLight"]};\n        --colorHighlightFg: ${n["--colorHighlightFg"]};\n        --colorHighlightBg: ${n["--colorHighlightBg"]};\n        --radius: ${n["--radius"]};\n        --isDarkTheme: ${i?1:0};\n      }`;e.insertCSS({code:s})}}),[t.vivaldiWindowId]);Li.useEffect((()=>{e.shareTheme&&Be.Z.addListener(p,(e=>e.theme.id))}),[p,e.shareTheme]),Li.useEffect((()=>{function t(e){(e=parseInt(e))&&i.Z.tabs.get(parseInt(e),(e=>{e&&(h(e.url),function(e,t){const n=(0,pn.Rf)(t??"");r("string"!=typeof e||""===e||n?t&&!n?(0,B.Z)("Title: $1",[U6(t)??""]):void 0:(0,B.Z)("Title: $1",[e]))}(e.title,e.url))}))}function s(e){u(e.SSLState)}function o(t){t.isTopLevel&&(e.shareTheme&&p(),h(t.url))}function a(){let e=n.current?.tab_id;e&&e.startsWith(Ju.zs)&&(e=S.Z.resolve(e)),e&&t(e)}const l=n.current,d=e.url;return l&&d&&(l.addEventListener("contentload",a),l.addEventListener("loadcommit",o),l.addEventListener("sslstatechanged",s),l.tab_id.startsWith(Ju.zs)?(l.src=d,l.setUserAgentOverride(O6())):t(l.tab_id)),()=>{l&&(l?.removeEventListener("contentload",a),l?.removeEventListener("loadcommit",o),l?.removeEventListener("sslstatechanged",s))}}),[e.url,e.shareTheme,s,p]);const h=e=>{let t;t=e&&"string"==typeof e?(0,Ty.dO)(e):(0,Ty.dO)("about:blank"),d(t)},g=Li.useCallback((()=>{const t=n.current,i=e.url;return[{handler:()=>{t&&i&&(o(!1),t.src=i)},...t&&t.src===i?(0,us.Z)("Reload"):(0,us.Z)("Go to Home Page")},{handler:()=>o(!0),...(0,us.Z)("Change Webpage URL")}]}),[e.url]),[{canDrag:m},f]=(0,_Q.c)((()=>({type:"DASHBOARD_WIDGET",item:{id:e.id},collect:e=>({canDrag:e.canDrag()})})));f(n.current);const v=S.Z.resolveWebWidget(e.dashboardId,e.id);return F6(f4,{id:e.id,index:e.index,type:"webpage",size:e.size,sizeOptions:W6,background:e.background,keyAccess:e.keyAccess,className:"Dashboard-Webpage",getMenu:g,title:s?void 0:a},void 0,e.url&&(0,ss.jsxs)(ss.Fragment,{children:[F6("div",{className:"url-wrapper",tabIndex:"-1"},void 0,!s&&l&&(0,ss.jsxs)(ss.Fragment,{children:["warning"===c&&F6("span",{className:"not-secure"},void 0,"[",(0,B.Z)("Not Secure"),"]"),"security_error"===c&&F6("span",{className:"not-secure"},void 0,"[",(0,B.Z)("Dangerous"),"]"),F6(Vy,{windowId:t.vivaldiWindowId,displayUrl:(0,aS.gC)(l),shouldShowFullUrl:!1,onGoToPath:Lr.Z,shouldHighlightBaseDomain:!1,urlFragments:l,rawDisplay:!0})]})),F6("section",{style:{pointerEvents:m?"initial":"none",display:s?"none":"initial"}},void 0,(0,ss.jsx)("webview",{ref:n,tab_id:v,role:"document",name:"vivaldi-webpage-widget",parent_tab_id:e.dashboardId}))]}),s&&F6(N6,{id:e.id,widgetUrl:e.url||"",onValidate:(t,i)=>{if(t!==e.url||i!==e.shareTheme){s=e.id,a={url:t,shareTheme:i},A.Z.dispatch({actionType:"DASHBOARD_UPDATE_WIDGET",widgetId:s,webpageData:a});const o=n.current;o&&(o.src=t),i||Be.Z.ensureRemovedListener(p)}var s,a;o(!1)},iconSize:"regular"===e.size?"medium":"large",shareTheme:e.shareTheme}))}const H6=Li.memo(V6);var G6,$6=n(79336);function K6(e,t,n,i){G6||(G6="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:G6,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function z6(e,t){if(!t)return{display:"none"};return{transform:`translate(${t.x-f.V9/2}px, ${t.y-e/2}px)`,height:e,width:f.V9}}function j6(){const{item:e,isDragging:t,sourceClientOffset:n}=(0,$6.f)((e=>({item:e.getItem(),isDragging:e.isDragging(),sourceClientOffset:e.getSourceClientOffset()}))),i=e?.type&&f.sB[e.type];if(!i||!t)return null;const{size:s,icon:o}=i;return K6("div",{className:"widget-drag-layer"},void 0,K6("div",{style:z6("double_height"===s?2*f.EE+f.cX:f.EE,n)},void 0,K6("span",{className:"icon",dangerouslySetInnerHTML:{__html:o?o.medium:""}})))}var Y6,X6,Q6,q6=n(46408);function J6(e,t,n,i){Y6||(Y6="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Y6,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function e8(e){const t=Li.useContext(r4),{type:n,disabled:i,onClick:s,onKeyUp:o,title:a,icon:r}=e,l=Li.useRef(),[,d,c]=(0,_Q.c)((()=>({type:f.qk,item:{type:n},collect:e=>({isDragging:e.isDragging()}),end:(e,n)=>{n.didDrop()||t.onDrop()}})),[]);return Li.useEffect((()=>{c((0,q6.r)(),{captureDraggingState:!0})}),[c]),d(l),(0,ss.jsxs)("button",{ref:l,className:"add-button",disabled:i,onClick:s,onKeyUp:o,children:[J6("span",{className:"icon",dangerouslySetInnerHTML:{__html:r?r.medium:""}}),J6("div",{},void 0,a)]},n)}function t8(e,t,n,i){X6||(X6="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:X6,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function n8({onClose:e,onAddWidget:t,widgets:n}){const i=Li.useCallback((t=>{"Escape"===t.key&&e()}),[e]);return t8("div",{className:"dashboard-list-wrapper"},void 0,t8("div",{className:"dashboard-list-header"},void 0,t8("h2",{},void 0,(0,B.Z)("Add a New Widget")),t8("button",{className:"close",tabIndex:"-1",dangerouslySetInnerHTML:{__html:Wi.kze},onClick:e})),t8("div",{className:"button-wrapper"},void 0,Object.entries(f.sB).filter((([e,t])=>!(t.singular&&n.includes(e)))).map((([e])=>{const{icon:n,defaultTitle:s}=f.sB[e];return t8(e8,{type:e,title:s,icon:n,disabled:!1,onClick:()=>t(e),onKeyUp:i},e)}))))}function i8(e,t,n,i){let s=n,o=i;for(;void 0!==e[s]?.[o];)o<t-1?o+=1:(s+=1,o=0);return[s,o]}function s8(e,t){if(0===e.length)return[[],0];const n=[0];if(1===t){for(const t of e){const{height:e}=d4(t.size),i=n.at(-1)??0;n.push(i+e)}const t=n.at(-1)??0;return[n.slice(0,-1),t]}{const n=function(e,t){let n=[],i=[0,0];for(let s=0;s<e.length;s++){const o=e[s],{height:a}=d4(o.size);if(n[i[0]]){const e=n[i[0]],o=e.findIndex((e=>void 0===e));if(1===a){e[o]=s,n[i[0]]=e,i=i8(n,t,i[0],o);continue}{const e=[...n];for(let n=i[0];n<i[0]+a;n++){const i=e[n];if(i&&void 0!==i[o])break;if(i)e[n][o]=s;else{const n=new Array(t).with(o,s);e.push(n)}}n=e,i=i8(n,t,i[0],o);continue}}if(n.push(new Array(t).with(0,s)),i[1]=1,a>1){i[1]=1;for(let e=1;e<a;e++)n.push(new Array(t).with(0,s))}}return n}(e,t),i=function(e){const t=e[0].length,n=[0];let i=0;for(let s=0;s<e.length;s++){const o=e[s];for(let e=0;e<o.length;e++)o[e]&&o[e]>i&&(i=o[e],n.push(t*s+e))}return n}(n);return[i,n.length]}}function o8(e,t,n,i){Q6||(Q6="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Q6,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const a8=Object.keys(f.sB).reduce(((e,t)=>{const{requiresMailEnabled:n}=f.sB[t];return n&&e.push(t),e}),[]),r8=[I.kMailIsTurnedOff,I.kKeyboardTabToAll,I.kDashboardColumnLimit];var l8=o8(j6,{});const d8=QQ((e=>{const t=Li.useContext(ts.Z),n=(0,Ya.Z)(r8),i=yL(),s=Li.useRef(b.getState()),o=Li.useRef(null),[a,r]=Li.useState(!1),[l,d]=Li.useState(!1),[c,u]=Li.useState(),p=Boolean(c),h=function(e,t){let n=2;return e>1800?n=4:e>1200?n=3:e<600&&(n=1),Math.min(t,n)}(e.maxWidth,n[I.kDashboardColumnLimit]),[m,y]=Li.useState(),[S,C]=Li.useState(),T=Li.useRef(),Z=Li.useRef();Li.useEffect((()=>{function e(){s.current=b.getState(),i()}return b.addListener(e),()=>b.removeListener(e)}),[i]),Li.useEffect((()=>{e.isActive?setTimeout((()=>r(!0)),1e3):r(!1)}),[e.isActive]);const E=Li.useCallback((e=>{const t=s.current??[],n=t.find((t=>t.id===e));if(n)return{item:n,index:t.indexOf(n)}}),[]),k=Li.useRef(""),_=Li.useRef(""),D=Li.useCallback(((e,n)=>{if(e===k.current&&n===_.current)return;k.current=e,_.current=n;const a=()=>{i(),o.current=null,setTimeout((()=>{k.current="",_.current=""}),500)},r=s.current,l=E(e)?.index??0,d=E(n)?.index??0;r&&l!==d&&(s.current=(0,v.Uy)(r,(e=>{const t=e[d];e[d]=e[l],e[l]=t})),o.current||(o.current=t.requestAnimationFrame(a)))}),[t,E,i]),M=Li.useCallback((()=>{const e=s.current?.map((e=>e.id))??[];var t;t=e,A.Z.dispatch({actionType:"DASHBOARD_SET_WIDGET_ORDER",widgetIds:t}),y(void 0),C(void 0)}),[]),O=Li.useCallback(((e,t)=>{m?D(m,e):(y(e),C(t))}),[D,m]),x=Li.useMemo((()=>({onMoveItem:D,onDrop:M,findItem:E,viewWidth:Math.max(320,e.maxWidth-160),columns:h,onMoveNew:O,animate:a})),[h,E,M,D,O,e.maxWidth,a]),L=Li.useMemo((()=>n[I.kMailIsTurnedOff]?a8:[]),[n]),R=Li.useCallback(((e,t)=>{L.includes(e)&&n[I.kMailIsTurnedOff]?u({type:e,index:t?.index}):(N(e,t||{index:void 0}),d(!1))}),[L,n]),F=Li.useMemo((()=>n[I.kKeyboardTabToAll]),[n]),W=[];for(const e of s.current??[])if(!L.includes(e.type)){if(e.id===m&&S){const e={id:"fake",type:S,size:f.sB[S].size};W.push(e)}W.push(e)}const[U,V]=s8(W,h),H=Li.useMemo((()=>({"--dashboardMaxWidth":`${Math.min(h*f.V9+(h-1)*f.cX,Math.max(320,e.maxWidth-160))}px`,"--widgetsHeight":`${Math.max(f.EE,V*(f.EE+f.cX))}px`})),[h,V,e.maxWidth]),[,G]=(0,NQ.L)((()=>({accept:f.qk,drop:({type:e})=>{if(s.current){const t=s.current.findIndex((e=>e.id===m));R(e,{index:Math.max(t,0)}),y(void 0),C(void 0)}}})),[m,R]),[,$]=(0,NQ.L)((()=>({accept:f.qk,hover:(e,t)=>{t.isOver({shallow:!0})&&y(void 0)},drop:({type:e},t)=>{if(t.isOver({shallow:!0})&&s.current){const t=s.current.length;R(e,{index:Math.max(t,0)}),y(void 0),C(void 0)}}})),[]),K=Boolean(W.filter((e=>"weather"===e.type))?.length>1);return G(Z),$(T),o8(r4.Provider,{value:x},void 0,(0,ss.jsxs)("div",{ref:T,className:"Dashboard",style:H,children:[(0,ss.jsx)("div",{ref:Z,className:"Dashboard-Widgets",children:W.map(((t,n)=>{if("fake"!==t.id)switch(t.type){case"email":return o8(B4,{id:t.id,index:U[n],size:t.size,background:t.background,keyAccess:F,accountId:t.accountId},t.id);case"calendar":return o8(C4,{id:t.id,index:U[n],size:t.size,background:t.background,keyAccess:F,calendarIds:t.calendarIds},t.id);case"shortcuts":let i=t.folderId;return"DEFAULT"===i&&(i=function(e){const t=g.Z.getTopNodes();let n=t.find((e=>"7dc00b6d-b26b-4371-83cb-2cd63274b9b8"===e.partner))?.id;return n||(console.error("Could not find home folder."),n=t[0]?.id??"1"),P(e,{folderId:n}),n}(t.id)),o8(S5,{id:t.id,index:U[n],size:t.size,background:t.background,keyAccess:F,folderId:i,showTitle:t.showTitle,showThumbnail:t.showThumbnail},t.id);case"tasks":return o8(O5,{id:t.id,index:U[n],size:t.size,background:t.background,keyAccess:F},t.id);case"feed":return o8(e5,{id:t.id,index:U[n],size:t.size,background:t.background,keyAccess:F,feedId:t.feedId,feedDisplay:t.feedDisplay},t.id);case"sticky-note":return o8(E5,{id:t.id,index:U[n],size:t.size,background:t.background,keyAccess:F},t.id);case"tip":return o8(F5,{id:t.id,index:U[n],size:t.size,background:t.background,keyAccess:F,tipContent:t.tipContent,tipLink:t.tipLink,tipTimestamp:t.tipTimestamp},t.id);case"top-sites":return o8(K5,{id:t.id,index:U[n],size:t.size,background:t.background,keyAccess:F,showTitle:t.showTitle},t.id);case"privacy-stats":return o8(d5,{id:t.id,index:U[n],size:t.size,background:t.background,keyAccess:F},t.id);case"webpage":return o8(H6,{id:t.id,index:U[n],size:t.size,background:t.background,keyAccess:F,url:t.url,shareTheme:Boolean(t.shareTheme),dashboardId:e.pageId},t.id);case"date":return o8(k4,{id:t.id,index:U[n],size:t.size,background:t.background,keyAccess:F},t.id);case"weather":return o8(T6,{id:t.id,index:U[n],size:t.size,background:t.background,keyAccess:F,locationId:t.locationId,temperatureUnit:t.temperatureUnit,windspeedUnit:t.windspeedUnit,precipitationUnit:t.precipitationUnit??"mm",view:t.view,multipleViews:K},t.id);default:return console.warn(`Widget ${t.type} does not exist.`),null}}))}),o8("button",{className:Fi()("add-button",{pressed:l}),onClick:()=>d(!0)},void 0,o8("span",{dangerouslySetInnerHTML:{__html:Wi.md4.small}}),o8("p",{},void 0,(0,B.Z)("Add a Widget")))]}),l&&o8(n8,{widgets:W.map((e=>e.type)),onClose:()=>d(!1),onAddWidget:R}),l8,p&&o8(FT,{title:(0,B.Z)("Would you like to enable Mail, Calendar and Feeds?"),prompt:[(0,B.Z)("Enjoy Dashboard widgets displaying your latest mail, calendar events, or RSS feed news.")],positive:(0,B.Z)("Enable Components"),negative:(0,B.Z)("Not Now"),onClose:e=>{if(e&&(w.Z.set(I.kMailIsTurnedOff,!1),c)){const{type:e,index:t}=c;N(e,{index:t})}u()}}))})),c8=d8;var u8,p8=n(34155);function h8(e,t,n,i){u8||(u8="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:u8,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const g8=function(e){const[t,n]=(0,Li.useState)(),i=(0,ux.extendMoment)(W()),s=i.range(e.minDate,e.maxDate),o=Array.from(s.by("month")),a=(0,Li.createRef)(),r=t=>{e.onSelect(t),n(void 0)},l=({index:n,parent:i,key:s,style:a})=>h8(gL,{style:e.isHeatMap?a:{},events:[],month:o[n],selectedDate:e.selectedDate,onSelect:r,showOutOfMonthDays:e.isHeatMap,renderMonthDay:e.renderMonthDay,highlightMode:"day",fixedHeight:!1,highlightedDate:t},s);return(0,ss.jsx)("div",{ref:a,onMouseDown:e=>{e.currentTarget?.focus()},onKeyDown:o=>{const l=t&&i(t).within(s)?t:e.selectedDate;let d;switch(OM.Z[o.keyCode]){case"Left":if(l.isSame(e.minDate.startOf("month"),"day"))break;d=l.clone().subtract(1,"day");break;case"Right":if(l.isSame(e.maxDate.endOf("month"),"day"))break;d=l.clone().add(1,"day");break;case"Up":if(l.isSame(e.minDate.startOf("month"),"day"))break;d=l.clone().subtract(1,"week"),l.isSame(e.minDate,"month")&&l.date()<8&&(d=l.clone().startOf("month"));break;case"Down":if(l.isSame(e.maxDate.endOf("month"),"day"))break;d=l.clone().add(1,"week"),l.isSame(e.maxDate,"month")&&l.clone().endOf("month").date()-l.date()<8&&(d=l.clone().endOf("month"));break;case"Space":case"Enter":o.preventDefault(),r(l);break;case"Escape":o.preventDefault(),n(void 0)}if(d&&(o.preventDefault(),n(d),e.isHeatMap)){const e=a.current?.children[0].querySelector(".CalendarMonth-Day--Highlighted");p8.nextTick((()=>e?.scrollIntoViewIfNeeded()))}},tabIndex:"0",className:e.isHeatMap?"timeline-grid":"month-view-grid",children:h8(Z$.q,{},void 0,(({height:t,width:n})=>h8(ws.aV,{width:n,height:t,rowHeight:t=>e.isHeatMap?(({index:t})=>{const n=6===o[t].endOf("month").weekday()||o[t].endOf("month").isSame(e.maxDate)?0:1;return 50*(Math.ceil((o[t].daysInMonth()+o[t].startOf("month").weekday())/7)-n)})(t):e.maxHeight,rowRenderer:l,rowCount:o.length,estimatedRowSize:e.isHeatMap?250:e.maxHeight,overscanRowCount:1,scrollToIndex:e.isHeatMap?o.length-1:void 0},e.isHeatMap?void 0:e.selectedDate.format("YY-MM"))))})};const m8=function(e){if(0===e.length)return{combinedTopPages:[],linkTypes:[],linkTypeColors:[],linkTypeTotal:0,pageCount:0,siteCount:0};const t={},n={};let i=Be.Z.getState().theme.colorHighlightBg,s=xe()(i).get("hsl.h"),o=xe()(i).get("hsl.s");const a=xe()(i).get("hsl.l");(o<.2||a<.4)&&(i="#006ed7",s=xe()(i).get("hsl.h"),o=xe()(i).get("hsl.s"));const r=xe().scale([i,xe()(i).set("hsl.h",s+50).desaturate(o),xe()(i).set("hsl.h",s+130).desaturate(o),xe()(i).set("hsl.h",s+180).desaturate(o),xe()(i).set("hsl.h",s+230).desaturate(o),xe()(i).set("hsl.h",s-50).desaturate(o)]).mode("lab").colors(6);let l=[{type:"auto_toplevel",count:0,color:r[0],print:(0,B.Z)("linktype","Direct")},{type:"typed",count:0,color:r[1],print:(0,B.Z)("linktype","Typed")},{type:"link",count:0,color:r[2],print:(0,B.Z)("linktype","Link")},{type:"reload",count:0,color:r[3],print:(0,B.Z)("linktype","Reload")},{type:"form_submit",count:0,color:r[4],print:(0,B.Z)("linktype","Form")},{type:"other",count:0,color:r[5],print:(0,B.Z)("linktype","Other")}];e.forEach((e=>{l=e.children.map((e=>e.transitionType)).filter(Boolean).reduce(((e,t)=>{const n=e.find((e=>e.type===t));if(n)n.count=n.count+1;else{const t=e.find((e=>"other"===e.type));t&&(t.count=t.count+1)}return e}),l)}));const d=l.map((e=>e.color)),c=l.reduce(((e,t)=>e+t.count),0);e.forEach((e=>{e.children.forEach((e=>{e&&(t[e.address]=t[e.address]?e.visitCount+t[e.address]||0:e.visitCount,n[e.url]=n[e.url]?e.visitCount+n[e.url]||0:e.visitCount)}))}));const u=Object.keys(n).length,p=Object.keys(t).length;return{linkTypeColors:d,linkTypeTotal:c,combinedTopPages:Object.keys(t).map((e=>({url:e,visitCount:t[e]}))).sort(((e,t)=>t.visitCount-e.visitCount)),linkTypes:l,pageCount:u,siteCount:p}};var f8,v8=n(38775),y8=n(97891),b8=n(9740),S8=n(76148),w8=n(97599);function C8(e,t,n,i){f8||(f8="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:f8,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const A8=(0,ux.extendMoment)(W()),I8={top:6,right:12,bottom:40,left:30},T8={axis:{stroke:"var(--colorFg)"},axisLabel:{fontSize:12,padding:20},grid:{stroke:"var(--colorFgAlpha)"},tickLabels:{angle:-45,textAnchor:"end",fontSize:11,padding:5,fontWeight:600,fontFamily:"inherit"}},Z8={labels:{fontSize:13,padding:0,fontFamily:"inherit"}},E8={labels:{fontSize:13,padding:0,fontFamily:"inherit"}};var k8=C8(v8.i6,{mouseFollowTooltips:!0,voronoiDimension:"x"}),_8=C8(Sg.E,{dependentAxis:!0,standalone:!1,style:{axis:{stroke:"var(--colorFg)"},axisLabel:{fontSize:12,padding:20},grid:{stroke:"var(--colorFgAlpha)"},ticks:{stroke:"var(--colorFg)"},tickLabels:{fontSize:11,padding:5,fontFamily:"inherit"}}}),N8=C8(y8.y,{constrainToVisibleArea:!0,pointerLength:0,flyoutStyle:{stroke:"var(--colorBorder)",fill:"var(--colorBg)"}}),P8=C8(y8.y,{center:{x:80,y:80},pointerWidth:0,pointerLength:0,cornerRadius:0,flyoutStyle:{stroke:"none",fill:"transparent"}});class D8 extends Li.PureComponent{state={externalMutations:[]};#rn=gs()((function(e){return e.filter((e=>e.children.length>0))}));#ln=gs()((function(e,t){if(1===t.length&&t[0].id){const e=[];for(let n=0;n<=24;n++){const i=t[0],s=i.visitTime+3600*n*1e3,o=i.children.filter((e=>{const t=e.visitTime-s;return t>0&&t<36e5}));e.push({hour:n,pages:o.length,visits:o.reduce(((e,t)=>e+t.visitCount),0),unixDate:s})}return e}{const{range:n}=e;let i=n.start.clone(),s=n.end.clone();t.length===n.duration("days")&&(i=i.startOf(e.displayMode),s=s.endOf(e.displayMode));const o=A8.range(i,s),a=new Map;for(const e of t){const t=e.id,n=A8(t,"YYYY-MM-DD");n.within(o)&&a.set(t,{hour:0,pages:e.children.length,visits:e.visitCount,unixDate:n.valueOf()})}const r=new Map,l=i.clone().subtract(1,"d"),d=i,c=i.clone().add(1,"d"),u=o.diff("days")<32;do{const e=(0,R.SI)(d);!a.has(e)&&(u||a.has((0,R.SI)(l))||a.has((0,R.SI)(c)))&&r.set(e,{hour:0,pages:0,visits:0,unixDate:d.valueOf()}),l.add(1,"d"),d.add(1,"d"),c.add(1,"d")}while(d.diff(s)<=0);const p=[...a.values(),...r.values()].sort(((e,t)=>e.unixDate-t.unixDate)),h=200;if(p.length>h)for(;p.length>h;){const e=Math.floor(Math.random()*p.length);p.splice(e,1)}return p}}));#dn=gs()((function(e){if(e.length>2){const t=[e[0].id,e[e.length-1].id];return A8(t[0]).diff(A8(t[1]),"days")}return e.length}));formatTick=e=>{const t=this.#dn(this.#rn(this.props.nodes));let n;switch(!0){case t<6:n="H:00",0===A8(e).hour()&&(n="ddd D");break;case t<20:n="H:00",0===A8(e).hour()&&(n="ddd D"),1===A8(e).date()&&(n="MMM",0===A8(e).month()&&(n="MMM YYYY"));break;case t<80:n="ddd D",1===A8(e).date()&&(n="MMM D",0===A8(e).month()&&(n="MMM YYYY"));break;default:n="MMM",0===A8(e).month()&&(n="YYYY")}return A8(e).format(n)};formatTotalLabel=({datum:e})=>{if(!e)return null;const t=this.formatTick(new Date(Math.round(e.unixDate)));return e.visits<1?t:(0,B.Z)("$1\nViews: $2\nPages: $3",[t,Math.round(e.visits),Math.round(e.pages)])};formatPieLabel=e=>{const t=e.slice.data;if(Number.isInteger(t.count)){const{linkTypeTotal:e}=this.#cn(this.#rn(this.props.nodes)),n=(0,w8.Z)(t.count/e*100,0);if(n>0)return`${t.print}\n${n} %`}};removeMutation=()=>{this.setState({externalMutations:[]})};toggleLabel=(e,t)=>{this.setState({externalMutations:[{target:"labels",eventKey:"all",mutation:()=>({active:!1}),callback:()=>this.removeMutation()},{target:"data",eventKey:"all",mutation:()=>({style:void 0}),callback:()=>this.removeMutation()},{target:"labels",eventKey:String(e),mutation:()=>({active:t}),callback:()=>this.removeMutation()},{target:"data",eventKey:String(e),mutation:()=>t?{style:{opacity:.5,fill:this.#cn(this.#rn(this.props.nodes)).linkTypeColors[e],stroke:"var(--colorBg)",strokeWidth:2}}:{style:void 0},callback:()=>this.removeMutation()}]})};formatAreaXValue=e=>A8(e.unixDate).toDate();formatAreaYValue=e=>e.visits-e.pages;pieEvents=[{target:"data",eventHandlers:{onMouseEnter:()=>[{target:"labels",mutation:()=>({active:!0})},{target:"data",mutation:e=>{const{linkTypeColors:t}=this.#cn(this.#rn(this.props.nodes));return{style:{...e.style,fill:t[e.index],opacity:.5,stroke:"var(--colorBg)",strokeWidth:2}}}}],onMouseOut:()=>[{target:"labels",mutation:()=>({active:!1})},{target:"data",mutation:()=>({style:void 0})}]}}];#cn=gs()((function(e){return m8(e)}));render(){const{title:e,filter:t,max:n,scaleY:i,pageViewsCount:s}=this.props,o=this.#rn(this.props.nodes),a=this.#cn(o),r=this.#ln(t,o),l=0===o.length,{linkTypeColors:d,linkTypes:c,combinedTopPages:u,pageCount:p,siteCount:h}=a,g=this.#dn(o)<2,m={y:g?[0,n/2]:[0,n]},f={x:"time",y:i},v=[d[0],d[3]],y="linear";return C8("div",{className:"manager-editor more-info"},void 0,C8("div",{className:"header"},void 0,C8("h1",{},void 0,e)),C8("div",{className:"moreinfo-stats"},void 0,C8("h2",{},void 0,(0,B.Z)("Browsing Activity")),C8("div",{className:"moreinfo-activity"},void 0,!1===l&&C8(wg.k,{containerComponent:k8,width:245,height:200,padding:I8,domain:m,scale:f},void 0,C8(Sg.E,{tickCount:g?13:void 0,tickFormat:this.formatTick,standalone:!1,style:T8}),_8,C8(b8.N,{standalone:!0,responsive:!1,colorScale:v,style:Z8,labels:this.formatTotalLabel,labelComponent:N8},void 0,C8(Cg.b,{data:r,interpolation:y,standalone:!1,x:this.formatAreaXValue,y:"pages"}),C8(Cg.b,{data:r,interpolation:y,standalone:!1,x:this.formatAreaXValue,y:this.formatAreaYValue})))),C8("ul",{className:"moreinfo-activity-labels"},void 0,C8("li",{className:"visits"},void 0,C8("span",{style:{backgroundColor:v[1]}}),(0,B.Z)("Page Views: $1",[s])),C8("li",{className:"pages"},void 0,C8("span",{style:{backgroundColor:v[0]}}),(0,B.Z)("Pages: $1",[p]))),C8("h2",{},void 0,(0,B.Z)("Link Transition Type")),C8("div",{className:"moreinfo-link-types"},void 0,!1===l&&C8(S8.b,{externalEventMutations:this.state.externalMutations,data:c,x:"type",y:"count",width:160,height:160,innerRadius:40,padding:10,colorScale:d,style:E8,labels:this.formatPieLabel,labelComponent:P8,events:this.pieEvents}),!1===l&&C8("ul",{className:"moreinfo-link-labels"},void 0,c.map(((e,t)=>C8("li",{onMouseEnter:()=>this.toggleLabel(t,!0),onMouseOut:()=>this.toggleLabel(t,!1),title:e.print.length>7?e.print:null,className:0===e.count?"disabled":null},e.type,C8("span",{style:{backgroundColor:e.color}}),e.print))))),C8("h2",{},void 0,(0,B.Z)("Top Domains of $1 Total",[h])),u.length>0&&C8("ul",{className:"moreinfo-top-domains"},void 0,u.map(((e,t)=>{if(t<5)return C8("li",{onClick:this.props.onOpenDomain.bind(this,e.url),onContextMenu:this.props.onDomainContextMenu.bind(this,e.url)},"top_domain_"+t,C8(Ri.ZP,{url:(0,rl.q9)(e.url),loadType:"page"}),C8("span",{className:"title link"},void 0,e.url?e.url:"localhost"),C8("span",{className:"item-count"},void 0,e.visitCount))})))))}}const M8=D8;var O8=n(62819),x8=n(10334);const L8=[(0,us.Z)("keyword","title"),(0,us.Z)("keyword","url")].map((e=>{const t=(0,x8.lp)({label:e.label});return{...e,labelMatch:t,wordMatch:new RegExp(t,"i")}})),R8=L8.map((e=>e.labelMatch)).join("|"),B8=new RegExp(`(${R8}):\\s*((['"])([^'"]*)\\3|\\S*([^:\\w]|\\w+\\b(?!:))*)`,"gi"),F8=function(e){const t=e.match(B8);if(!t)return{title:"",url:"",query:e.length?e.trim():""};const n=t[0],i=e.indexOf(n),s={query:e.substring(0,i).trim(),url:"",title:""};return t.forEach((e=>{const[t,n]=e.split(":");switch(L8.find((e=>e.wordMatch.test(t)))?.labelEnglish){case"query":s.query=n.trim();break;case"title":s.title=n.trim();break;case"url":s.url=n.trim()}})),s};var W8;function U8(e,t,n,i){W8||(W8="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:W8,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class V8 extends Li.Component{static contextType=ts.Z;refSearch=Li.createRef();refDatePicker=Li.createRef();search=e=>{this.props.search({...this.props.filter,...e})};focusField=()=>{this.refSearch.current?.focus()};onSearchChange=e=>{this.updateFilter(e.target.value)};updateFilter=e=>{const t=F8(e.trim()),n={text:e,parsedFilter:t};this.search(n)};onStartTimeChange=e=>{const t=W()(e.target.value).startOf("day");t.isValid()&&this.search({startTime:t})};onEndTimeChange=e=>{const t=W()(e.target.value).endOf("day");this.search({endTime:t})};onSelectOption=()=>{const e=function(e){const t=parseInt(e);if(!isNaN(t))return t;switch(e){case"today":case"yesterday":case"last_month":case"all":case"date_range":return e;default:return"today"}}(this.refDatePicker.current?.value),t=O8.Z.getTimeByRange({rangePicker:e},this.props.minDate.startOf("day"));this.search(t)};onClearBrowsingData=()=>{de.Z.showClearBrowsingHistoryDialog(this.context.vivaldiWindowId)};convertDate=e=>(0,R.SI)(W()(e));render(){const e=this.props.filter,t=this.convertDate(new Date);return(0,ss.jsxs)(ss.Fragment,{children:[U8("div",{className:"toolbar toolbar-default"},void 0,(0,ss.jsx)("input",{ref:this.refSearch,type:"search",tabIndex:"0",style:{flexShrink:2},value:e.text,onChange:this.onSearchChange,onFocus:this.props.onFocus,onBlur:this.props.onBlur,placeholder:(0,B.Z)("verb","Search"),disabled:!this.props.hasHistory}),this.props.showClearBtn&&U8(po.ZP,{onClick:this.onClearBrowsingData,tooltip:(0,B.Z)("title","Clear browsing data"),image:Wi.DwE.small,commandId:"COMMAND_SHOW_CLEAR_PRIVATE_DATA"})),this.props.showPicker&&U8("div",{className:"toolbar toolbar-default toolbar-wrap"},void 0,(0,ss.jsxs)(ta.Z,{ref:this.refDatePicker,value:this.props.filter.rangePicker,onChange:this.onSelectOption,children:[U8("option",{value:"today"},void 0,(0,B.Z)("other","Today")),U8("option",{value:"yesterday"},void 0,(0,B.Z)("Yesterday")),U8("option",{value:"7"},void 0,(0,B.Z)("Last 7 Days")),U8("option",{value:"30"},void 0,(0,B.Z)("Last 30 Days")),U8("option",{value:"date_range"},void 0,(0,B.Z)("Date Range...")),U8("option",{value:"all"},void 0,(0,B.Z)("All History"))]}),"date_range"===e.rangePicker&&U8("div",{className:"date-range"},void 0,U8(Vk.Z,{title:(0,B.Z)("Start Date"),max:t,value:this.convertDate(e.startTime),onChange:this.onStartTimeChange}),U8(Vk.Z,{title:(0,B.Z)("End Date"),max:t,value:this.convertDate(e.endTime),onChange:this.onEndTimeChange})))]})}}const H8=V8;var G8;function $8(e,t,n,i){G8||(G8="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:G8,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class K8 extends Li.Component{handleClick=(e,t)=>{e.preventDefault(),e.altKey?this.props.isExpanded?this.props.collapseAll():this.props.expandAll():this.props.toggle(t)};render(){const{folder:e,children:t}=this.props,n=t.reduce(((e,t)=>e+t.visitCount),0),i=R.ZP.getWeekdayFormat("LL"),s=W()(e.visitTime).format(i),o=e.id;return $8("label",{"data-parent":o,onClick:this.props.fullView?e=>this.handleClick(e,o):null},void 0,!this.props.fullView&&$8("span",{className:"expand-icon",onMouseDown:ms.ZP,onMouseUp:e=>this.handleClick(e,o),dangerouslySetInnerHTML:{__html:Wi.nfH}}),$8("span",{className:"url"},void 0,s),!0===this.props.showBadge&&$8("span",{className:"item-count"},void 0,n))}}const z8=K8;var j8;function Y8(e,t,n,i){j8||(j8="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:j8,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var X8,Q8=Y8("svg",{width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"},void 0,Y8("path",{d:"M4.5,13.5v-12h7v12L8,10.7L4.5,13.5z"}));function q8(e){const{node:t}=e,n=Li.useContext(ts.Z);function i(e){const{document:i}=n;var s=i.createElement("img");s.srcset="chrome://favicon/size/16@1x/"+t.url+" 1x,chrome://favicon/size/16@2x/"+t.url+" 2x",e.dataTransfer.setDragImage(s,s.width-s.width/3,s.height-s.height/3),s.remove(),Za(e,t.url,t.title)}const s=W()(t.visitTime),o=t.url.split("\\").pop().split("/").pop()||t.url,a=R.ZP.getWeekdayFormat("LL"),r=Li.useMemo((()=>(0,Ty.dO)(t.url)),[t.url]);return e.fullView?e.columns?(0,ss.jsx)(ss.Fragment,{children:e.columns.map((e=>{switch(e.id){case"visitTime":return Y8("label",{className:"date",title:s.format(a),draggable:"true",onDragStart:i},e.id,Y8("span",{},void 0,s.format("LTS")));case"title":return Y8("label",{className:"title",title:t.title?t.title:o,draggable:"true",onDragStart:i},e.id,Y8(Ri.ZP,{url:t.url,loadType:"page"}),Y8("span",{},void 0,t.title?t.title:o));case"address":return Y8("label",{className:"url",title:t.url,draggable:"true",onDragStart:i},e.id,g.Z.findByUrl(t.url)&&Q8,Y8(Vy,{windowId:n.vivaldiWindowId,urlFragments:r,displayUrl:t.url,shouldShowFullUrl:!0,onGoToPath:Lr.Z,onBaseDomainObscured:Lr.Z,shouldHighlightBaseDomain:!1,rawDisplay:!0}));case"visitCount":return Y8("label",{className:"visits",draggable:"true",onDragStart:i},e.id,t.visitCount>1&&Y8("span",{className:"item-count"},void 0,t.visitCount));default:console.warn("Unknown sorting field:",e.id)}}))}):null:Y8("label",{title:s.format("LTS")+p.YV+s.format(a)+p.YV+(t.title?(0,B.Z)("Title: $1",[t.title])+p.YV:"")+(0,B.Z)("Address: $1",[t.url]),onMouseEnter:function(){const e=t.url;u.Z.setStatus(n.vivaldiWindowId,e)},onMouseLeave:function(){u.Z.clearStatus(n.vivaldiWindowId)},draggable:"true",onDragStart:i},void 0,Y8(Ri.ZP,{url:t.url,loadType:"page"}),Y8("span",{className:"title"},void 0,Y8("span",{className:"time"},void 0,s.format("LT")),t.title?t.title:t.url),t.visitCount>1&&Y8("span",{className:"item-count"},void 0,t.visitCount))}function J8(e,t,n,i){X8||(X8="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:X8,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function e7(e,t,n){zi.ZP.openUrls(e,(0,m$.Z)(t),n,!0)}class t7 extends Li.PureComponent{static contextType=ts.Z;refTreeList=Li.createRef();_isPrivateWindow=he.ZP.isIncognito(this.context.vivaldiWindowId);state={showBadge:C.Z.get(I.kPanelsShowFolderBadge)};componentDidMount(){C.Z.addListener(I.kPanelsShowFolderBadge,this._onBadgeChanged)}componentWillUnmount(){C.Z.removeListener(I.kPanelsShowFolderBadge,this._onBadgeChanged)}_onBadgeChanged=(e,t)=>{this.setState({showBadge:Boolean(t)})};hasChildren=e=>Boolean(e.children?.length);isFolder=e=>Boolean(e.children);unSelectAll=()=>{this.refTreeList.current?.unSelectAll()};getSelectedItem=()=>this.refTreeList.current?.getSelectedItem();getSelectedUrls=()=>this.refTreeList.current?.getAllSelectedItems().map((e=>e.url))??[];getItemById=e=>{const t=function(n){for(let i=0;i<n.length;i++){const s=n[i];if(s.id===e)return s;if(s.children){const e=t(s.children);if(e)return e}}};return t(this.props.nodes)};getItemsByIds=(e,t)=>{const n=[];return e.forEach((e=>{const i=this.getItemById(e);i&&(i.children&&t?n.push(...i.children):n.push(i))})),n};getUrlsByIds=e=>this.getItemsByIds(e,!0).map((e=>e.url)).filter(Boolean);openSelected=()=>{const e=this.getSelectedUrls();e7(this.context.vivaldiWindowId,e,{inCurrent:!0,inNewWindow:!1,inBackground:!1,allowOverride:!1,incognito:!1})};openSelectedInNewTab=e=>{const t=this.getSelectedUrls(),n={inCurrent:!1,inNewWindow:!1,inBackground:e||C.Z.get(I.kTabsOpenNewInBackground),allowOverride:!1,incognito:!1};e7(this.context.vivaldiWindowId,t,n)};openSelectedInNewWindow=e=>{const t=this.getSelectedUrls(),n={inCurrent:!1,inNewWindow:!0,inBackground:!1,allowOverride:!1,incognito:e};e7(this.context.vivaldiWindowId,t,n)};copy=(e,t)=>{const{clipboardData:n}=e;if(n){const e=t.map((e=>e.id)),i=this.getUrlsByIds(e);n.setData("text/plain",i.join("\r\n")),n.setData("text/uri-list",i.join("\r\n")),n.setData("vivaldi/x-uri-list",i.join("\r\n"))}e.preventDefault()};delete=e=>{const t=[];return this.getItemsByIds(e,this.props.filter&&this.props.filter.text.length>0).forEach((e=>{e.children?t.push({isFolder:!0,visitTime:e.visitTime}):t.push({isFolder:!1,url:e.url,visitTime:e.visitTime})})),Me.deleteHistoryPromise(t)};_saveBookmarks=e=>{const t=g.Z.getRootId();if(void 0!==t){const n=this.getItemsByIds(e,!0).map((e=>{if(!e.children)return{url:e.url,title:e.title}})).filter(Boolean);ee.Z.createBookmarks(n,t,0,"history")}};handleExpandClick=e=>{this.refTreeList.current?.toggleSelectedExpansion(e)};expandAll=()=>{this.refTreeList.current?.expandAll()};collapseAll=()=>{this.refTreeList.current?.collapseAll()};getMenuCapability=async(e,t,n)=>{const i=this.context.vivaldiWindowId,s={address:n.children?"":n.address,selectedCount:this.refTreeList.current?.getSelectedCount()??2};switch(e.action){case"CONTEXT_OPEN_IN_NEW_TAB":return{handler:()=>this.openSelectedInNewTab(!1),isVisible:()=>Boolean(n),...t(i,e,s)};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{handler:()=>this.openSelectedInNewTab(!0),isVisible:()=>!C.Z.get(I.kTabsOpenNewInBackground)&&Boolean(n),...t(i,e,s)};case"CONTEXT_OPEN_IN_TAB":return{handler:this.openSelected,isVisible:()=>Boolean(n),...t(i,e,s)};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{handler:()=>this.openSelectedInNewWindow(!1),isVisible:()=>Boolean(n),...t(i,e,s)};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{handler:()=>this.openSelectedInNewWindow(!0),isVisible:()=>Boolean(n),...t(i,e,s)};case"CONTEXT_CONTAINER_OPEN_IN_WINDOW":{const s=this.getSelectedUrls(),o=await Ta.getMenu(i,!0,s);return{isVisible:()=>Boolean(n)&&o.length>0,items:o,...t(i,e,{})}}case"CONTEXT_FILTER_BY":return{handler:()=>this.props.onSearchDomain(s.address),isVisible:()=>Boolean(n)&&!this.isFolder(n),...t(i,e,s)};default:return{...t(i,e,s)}}};getMenuVisibility=(e,t)=>{if(t)switch(e.action){case"CONTEXT_COPY":case"CONTEXT_SAVE":case"CONTEXT_DELETE":case"CONTEXT_EXPAND_ALL":case"CONTEXT_COLLAPSE_ALL":return!0;default:return!1}else switch(e.action){case"CONTEXT_EXPAND_ALL":case"CONTEXT_COLLAPSE_ALL":return!0;default:return!1}};onContextMenu=e=>{this.refTreeList.current?.onContextMenu(e)};onItemMouseDown=(e,t)=>{t.button===es.Z.kCenter&&(t.preventDefault(),t.stopPropagation())};onItemMouseUp=(e,t)=>{t.button===es.Z.kCenter&&(this.openSelectedInNewTab(!0),t.preventDefault(),t.stopPropagation())};onItemDoubleClick=e=>{if(e.button!==es.Z.kCenter){const t=this.context.vivaldiWindowId;e7(t,this.getSelectedUrls(),{...(0,La.ZP)(t,{button:e.button,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,metaKey:e.metaKey})})}};onItemsActivated=(e,t)=>{const n=this.context.vivaldiWindowId;e7(n,this.getUrlsByIds(t.map((e=>e.id))),{...(0,La.ZP)(n,{ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,metaKey:e.metaKey})})};handleSelect=e=>{if(e&&!e.children&&this.refTreeList.current?.isItemSelected(e.id)){const t=(0,O8.E)(e.visitTime),n=this.refTreeList.current?.findTreeItem(t);if(n&&this.refTreeList.current?._isFolderWithChildren(n)&&this.refTreeList.current?.isItemSelected(n.id)){const e=!1;this.refTreeList.current?.SelectionMixinSelectItem(n.id,!e,!1,e)}}};validateForDeletion=vN.Z;getRowComponentProps=e=>({...e,columns:this.props.columns,showBadge:this.state.showBadge});rowComponent=e=>{const{columns:t,node:n,isExpanded:i}=e,s=[];return n.children?s.push(J8(z8,{folder:n,children:n.children,isExpanded:i,toggle:this.handleExpandClick,expandAll:this.expandAll,collapseAll:this.collapseAll,showBadge:e.showBadge,fullView:this.props.fullView},"history_tree_folder_"+n.id+"_"+n.visitTime)):s.push(J8(q8,{node:n,columns:t,isPrivateWindow:this._isPrivateWindow,fullView:this.props.fullView},"history_tree_item_"+n.id+"_"+n.visitTime)),s};menu={name:"historylist",getCapability:this.getMenuCapability,getVisibility:this.getMenuVisibility};render(){if(!this.props.nodes)return null;const e={sortOrder:this.props.filter.sortOrder,sortField:this.props.filter.sortField,onlyScroll:!0},{filter:t,nodes:n}=this.props,{text:i,displayMode:s}=t,o=!n.some((e=>Boolean(e.children?.length))),a=n.some((e=>Boolean(e.children)));return(0,ss.jsx)(ss.Fragment,{children:o&&"week"!==s?J8("div",{className:"vivaldi-tree-empty"},void 0,(0,B.Z)("The search term “$1” did not return any results.",[i])):(0,ss.jsx)(Ps,{settings:this.props.inManager?"HISTORY_MANAGER":"HISTORY_PANEL",ref:this.refTreeList,rowComponent:this.rowComponent,getRowComponentProps:this.getRowComponentProps,nodes:a?n.filter((e=>Boolean(e.children?.length))):n,columns:this.props.columns,folderMode:"expand",hasChildren:this.hasChildren,isFolder:this.isFolder,onItemDoubleClick:this.onItemDoubleClick,onItemMouseDown:this.onItemMouseDown,onItemMouseUp:this.onItemMouseUp,onItemsActivated:this.onItemsActivated,onCopy:this.copy,onSave:this._saveBookmarks,menu:this.menu,delete:this.delete,disableSelectAfterDelete:!1,enableDragAndDrop:!1,validateForDeletion:this.validateForDeletion,sorting:e,onSelect:this.handleSelect})})}}const n7=t7;function i7(e){return{text:"",startTime:W()().startOf("day"),endTime:W()().endOf("day"),rangePicker:"today",displayMode:"day",parsedFilter:{title:"",url:"",query:""},searchURL:!0,searchTitle:!0,range:null,sortOrder:ds.Z.DESCENDING_SORT,sortField:"visitTime",...e}}var s7;function o7(e,t,n,i){s7||(s7="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:s7,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const a7=[I.kStartpageNavigation],r7=[{text:(0,B.Z)("Date"),fullScreenTitle:(0,B.Z)("Sort by visit time"),value:"visitTime",icon:Wi.V_c,width:100,visible:!0},{text:(0,B.Z)("Title"),fullScreenTitle:(0,B.Z)("Sort by page title"),value:"title",width:300,visible:!0,key:!0},{text:(0,B.Z)("Address"),fullScreenTitle:(0,B.Z)("Sort by page address"),value:"address",icon:Wi.iD7,width:300,visible:!0},{text:(0,B.Z)("Views"),fullScreenTitle:(0,B.Z)("Sort by number of page views"),value:"visitCount",icon:Wi.boz,width:100,visible:!0}],l7=(0,ux.extendMoment)(W()),d7=R.ZP.UI_LANGUAGE.startsWith("de")?"L":"l";function c7(e,t){return e.find((e=>e.id===t))??O8.Z.getState().items.find((e=>e.id===t))}class u7 extends Li.PureComponent{static contextType=ts.Z;_locale={weekdays:[],weekdaysShort:[],monthsShort:[],weekStartsOn:0};_weekdaysSorted;_selecting=!1;_selectionHighlight=!1;_anchorDate=l7();_shortDayFormat="";constructor(e){super(e);const t=function(e){let t={...Ce.ZP.getHistoryManagerState(e)};return 0===Object.getOwnPropertyNames(t).length?(t={...Dn.Z.getSync("HISTORY_MANAGER_STATE")},t.endTime=l7(),"range"===t.displayMode?(t.startTime?t.startTime=l7(t.startTime):O8.Z.getOldestDate()?t.startTime=O8.Z.getOldestDate():l7().startOf("month"),t.range=l7.range(t.startTime,t.endTime)):(t.startTime=l7().startOf(t.displayMode),t.range=l7.range(l7(t.startTime).startOf(t.displayMode),l7(t.endTime).endOf(t.displayMode)))):(t.startTime=t.startTime?l7(t.startTime):l7(),t.endTime=t.endTime?l7(t.endTime):l7(),t.range=l7.range(l7(t.startTime).startOf("day"),l7(t.endTime).endOf("day"))),{...i7({range:l7.range(l7().startOf("day"),l7().endOf("day"))}),...t}}(e.pageId),{dayPickerVisible:n,moreInfoVisible:i,monthEntriesVisible:s,...o}=t;this.state={loaded:!1,columns:vs().history||ys(r7),filter:o,nodes:O8.Z.getTreeNodes(o),oldestDate:O8.Z.getOldestDate(),dayPickerVisible:n??!1,moreInfoVisible:i??!0,monthEntriesVisible:s??!0,themeKey:0};const a=R.ZP.getWeekdays("long"),r=l7.localeData().firstDayOfWeek();this._locale={weekdays:a,weekdaysShort:R.ZP.getWeekdays("short"),monthsShort:R.ZP.getMonths("short"),weekStartsOn:r},this._weekdaysSorted=a.slice(r).concat(a.slice(0,r)),this._shortDayFormat=R.ZP.getWeekdayFormat(R.ZP.getShortDateFormat())}componentDidMount(){Me.loadAll().then((()=>this.setState({loaded:!0}))),O8.Z.addListener(this.#un),Be.Z.addListener(this.#pn)}componentWillUnmount(){O8.Z.removeListener(this.#un),Be.Z.removeListener(this.#pn)}#un=()=>{this.setState((e=>{const{filter:t}=e;return{nodes:O8.Z.getTreeNodes(t),oldestDate:O8.Z.getOldestDate()}}))};#pn=()=>{this.setState((e=>({themeKey:e.themeKey+1})))};#hn=e=>{const t={displayMode:e.displayMode,startTime:e.startTime.valueOf(),endTime:e.endTime.valueOf(),dayPickerVisible:this.state.dayPickerVisible,moreInfoVisible:this.state.moreInfoVisible,monthEntriesVisible:this.state.monthEntriesVisible};c.ZP.setHistoryManagerState(this.props.pageId,t),Dn.Z.set({HISTORY_MANAGER_STATE:{displayMode:t.displayMode,startTime:t.startTime.valueOf(),endTime:t.endTime.valueOf(),dayPickerVisible:t.dayPickerVisible,moreInfoVisible:t.moreInfoVisible,monthEntriesVisible:t.monthEntriesVisible}})};_setRange=(e,t,n=null,i=!1)=>{const{filter:s}=this.state,o=l7.range(l7(e).startOf("day"),l7(t).endOf("day")),a={...s,startTime:o.start,endTime:o.end,displayMode:n||s.displayMode,range:o};this._selectionHighlight=i,this.onSearch(a)};_setDayPickRange=(e,t)=>{const{filter:n}=this.state,i=l7.range(n.startTime,n.endTime),s=l7.range(l7(e).startOf("day"),l7(t).endOf("day"));if(l7(e).within(i)&&l7(t).within(i)){const e={...n,range:s};this.onSearch(e),this._selectionHighlight=!0}else if(s.overlaps(i)){const e=s.add(i);this._setRange(e.start,e.end,null,!1)}else this._setRange(l7(t).startOf(n.displayMode),l7(t).endOf(n.displayMode),null,!1)};toggleDayPicker=()=>{this.setState((e=>({dayPickerVisible:!e.dayPickerVisible})),(()=>{this.#hn(this.state.filter)}))};toggleMoreInfo=()=>{this.setState((e=>({moreInfoVisible:!e.moreInfoVisible})),(()=>{this.#hn(this.state.filter)}))};#gn=e=>{this.setState((e=>({monthEntriesVisible:!e.monthEntriesVisible})),(()=>{this.#hn(this.state.filter)}))};onSortChange=(e,t)=>{if(1===e)return;const{filter:n}=this.state,i={...n,sortOrder:e,sortField:t};this.onSearch(i)};onUpdateRow=e=>{this.setState({columns:e})};onSaveRow=()=>{fs(this.state.columns,"history")};onSelectAll=()=>{const e=l7(),t=this.state.oldestDate,{filter:n}=this.state,i={...n,startTime:t,endTime:e.endOf("day")};this.onSearch(i),this._setRange(t,e.endOf("day"),"range",!1)};onIncludeUrlChange=()=>{const{filter:e}=this.state,t=!e.searchURL,n={...e,searchURL:t};this.onSearch(n)};onClearBrowsingData=()=>{de.Z.showClearBrowsingHistoryDialog(this.context.vivaldiWindowId)};onCalendarSelect=(e,t)=>{if(!0===this._selecting)return this._selecting=!1,Promise.resolve();const n=l7(e);if(t?.shiftKey){const e=this.expandRange(n);this._setRange(e.start,e.end)}else this._anchorDate=n,this._setRange(n,n,null,!0);return this._selectionHighlight=!0,Promise.resolve()};expandRange=e=>{const t=this.state.filter.range,n=l7.range(e,e);return t.contains(n)?t:e.unix()>t.start.unix()?l7.range(t.start,n.end.endOf("day")):l7.range(n.start.startOf("day"),t.end)};handleMouseDown=(e,t)=>{const{button:n,ctrlKey:i,shiftKey:s}=t;if(n&&0!==n)return;const o=l7(e);let a;s?(a=this.expandRange(o),this._setDayPickRange(a.start,a.end)):this._setDayPickRange(o,o),this._selecting=!0,this._anchorDate=l7(e)};handleMouseUp=(e,t)=>{this._selecting&&this.state.filter.range&&(this._selecting=!1)};handleMouseEnter=(e,t)=>{if(!this._selecting||!this.state.filter.range)return;const n=this.expandRange(l7(e));this._setDayPickRange(n.start,n.end)};onSearch=e=>{this.#hn(e),this.setState({filter:e,nodes:O8.Z.getTreeNodes(e)})};onSearchDomain=e=>{e=nI(e);const{filter:t}=this.state,n={...t,text:e,parsedFilter:F8(e),searchURL:!0};this.onSearch(n)};onOpenDomain=e=>{c.ZP.openURL(this.context.vivaldiWindowId,(0,rl.q9)(e))};handleDisplayModeChange=(e="day")=>{if("range"===e)this._anchorDate=l7(),this._setRange(this.state.oldestDate,l7(),e,!1);else{const t=this._anchorDate||l7();this._setRange(l7(t).startOf(e),l7(t).endOf(e),e,!1)}};restoreSelection=()=>{this._selectionHighlight=!1;const{displayMode:e}=this.state.filter;this.handleDisplayModeChange(e)};viewCurrent=()=>{const{displayMode:e}=this.state.filter;this._setRange(l7().startOf(e),l7().endOf(e))};viewPrevious=e=>{const{startTime:t,displayMode:n}=this.state.filter,i="range"===n?"day":n,s=l7(t).subtract(1,i).startOf(i),o=l7(s).endOf(i);this._setRange(s,o)};viewNext=()=>{const{startTime:e,displayMode:t}=this.state.filter,n="range"===t?"day":t,i=l7(e).add(1,n).startOf(n),s=l7(i).endOf(n);this._setRange(i,s)};getNumWeeksForMonth=(e,t)=>{let n=new Date(e,t-1,1).getDay()-this._locale.weekStartsOn;n<0&&(n+=7);const i=new Date(e,t,0).getDate();return Math.ceil((i+n)/7)};getDomainMenuItems=e=>[{handler:()=>this.onSearchDomain(e),...(0,us.Z)("Filter by “$1”",[e])},{handler:()=>this.onOpenDomain(e),...(0,us.Z)("Go to “$1”",[e])}];onDomainContextMenu=(e,t)=>{(0,cs.Z)(this.context,this.getDomainMenuItems(e))(t)};getActivityLevel=(e,t,n)=>e>=t-t/10?"max":e>=n&&e<t-t/10?"high":e>=n/2&&e<n?"mid":e>0&&e<n/2?"low":"min";#mn=(e,t,n,i,s,o)=>{o=l7(o);const{filter:a}=this.state,r=c7(e,(0,R.SI)(o));if(!r||0===r.children.length)return o7("div",{className:o.within(a.range)?"selected":null,onClick:e=>this.onCalendarSelect(o,e),style:{height:i}},o.valueOf(),o7("span",{className:"Cal__Day__day"},void 0,o.date()));const l=this.getActivityLevel(r.visitCount,t,n),d=Math.max(Math.floor((i-72)/15),1);let c;if(0===a.text.length){const e=Object.groupBy(r.children,(e=>e.address));c=Object.keys(e).map((t=>({url:t,visitCount:e[t].reduce(((e,t)=>e+t.visitCount),0)})))}else c=r.children.slice();c.sort(((e,t)=>t.visitCount-e.visitCount)),c=c.slice(0,d);const u=c.map((({url:e},t)=>o7("li",{title:e,onContextMenu:this.onDomainContextMenu.bind(this,e)},o.unix()+"_"+t,e)));return o7("div",{className:o.within(a.range)?"selected":null,onClick:e=>this.onCalendarSelect(o,e),style:{height:i}},void 0,o7("span",{className:"Cal__Day__day"},void 0,o.date()),o7("h4",{className:Fi()({heat:!0,[`${l}`]:!0})},void 0,o7("span",{className:"visits"},void 0,o7("strong",{},void 0,r.visitCount),(0,B.Z)("view","views",[r.visitCount])),o7("span",{className:"pages"},void 0,o7("strong",{},void 0,r.children.length),(0,B.Z)("page","pages",[r.children.length]))),o7("ul",{className:"top-links"},void 0,u))};renderCalWeek=()=>{const{filter:e,nodes:t}=this.state,{range:n}=e;let i=Array.from(n.by("days"));if(l7(i[0]).day()!==this._locale.weekStartsOn||i.length<7){const e=l7(i[0]).startOf("week"),t=l7(i[0]).endOf("week");i=Array.from(l7.range(e,t).by("days"))}else i.length>7&&(i=i.slice(0,6));return o7("div",{className:"week-container"},void 0,i.map((i=>{const s=l7(i).within(n),o=(0,R.SI)(i),a=t.find((e=>e.id===o)),r=l7(i).within(l7.range(this.state.oldestDate,l7()));return o7("div",{className:"week-day"},"week_"+o,o7("header",{onClick:r?this._setDayPickRange.bind(this,i,i):null,className:Fi()({selected:s,disabled:!r})},void 0,i.format(this._shortDayFormat)),o7("div",{className:"tree"},void 0,a?.children&&o7(n7,{fullView:!1,inManager:!0,nodes:a.children,filter:e,onSearchDomain:this.onSearchDomain},"week_"+i.id)))})))};#fn=(e,t,n,i)=>{i=l7(i);const{filter:s}=this.state,o=l7(this.state.oldestDate).within(s.range)&&l7().within(s.range),a=c7(e,(0,R.SI)(i));let r,l="min";return a&&0!==a.children.length?(r=a.visitCount,l=this.getActivityLevel(r,t,n)):r=0,o7("span",{title:(0,B.Z)("$1 visit","$1 visits",[r]),className:Fi()({heat:!0,selected:!o&&i.within(s.range),[`${l}`]:!0}),onMouseDown:e=>this.handleMouseDown(i,e),onMouseUp:e=>this.handleMouseUp(i,e),onMouseEnter:e=>this.handleMouseEnter(i,e)},i.unix()+"_"+i,o7("span",{},void 0,i.format("D")),"1"===i.format("D")&&o7("span",{className:"Cal__Day__month"},void 0,i.format("MMM")),"1"===i.format("D")&&i.year()!==l7().year()&&o7("span",{className:"Cal__Day__year"},void 0,i.format("YYYY")))};render(){const{dayPickerVisible:e,moreInfoVisible:t,monthEntriesVisible:n}=this.state,{filter:i}=this.state,s=i.range,o=(0,R.SI)(s.start),a=(0,R.SI)(s.end);let r=this.state.nodes.filter((e=>e.id>=o&&e.id<=a));r.length===this.state.nodes.length&&(r=this.state.nodes);const l=t||i.text.length>1?r.reduce(((e,t)=>e+t.visitCount),0):0,d=l7(i.startTime),c=this.getNumWeeksForMonth(d.year(),d.month()+1),u=(0,R.SI)(s.start)===(0,R.SI)(l7(this.state.oldestDate))&&(0,R.SI)(s.end)===(0,R.SI)(l7());let p,h,g,m=[],f="";if(r.length>1){const e=r[0],t=r[r.length-1];e&&t&&(m=[l7(e.visitTime).format(d7),l7(t.visitTime).format(d7)],f="visitTime"===i.sortField&&2===i.sortOrder?m[0]+" – "+m[1]:m[1]+" – "+m[0])}switch(p="month"===i.displayMode?(0,B.Z)("$1 $2",[l7(d).format("MMMM"),l7(d).format("YYYY")]):"week"===i.displayMode?(0,B.Z)("Week $1, $2",[l7(d).week(),l7(d).year()]):r.length>1?f:l7(i.startTime).format("LL"),h=r.length>1?f:1===r.length?l7(r[0].visitTime).format("LL"):l7(i.startTime).format("LL"),i.displayMode){case"month":g=(0,B.Z)("This Month");break;case"week":g=(0,B.Z)("This Week");break;default:g=(0,B.Z)("other","Today")}const v=l7(r.map((e=>e.id)).sort()[0]).startOf("month"),y=l7(),b=l7(this.state.oldestDate).isBefore(y.subtract(2,"m"))?l7(this.state.oldestDate):y.subtract(2,"m"),S=O8.Z.getState().items.map((e=>e.visitCount)),w=Math.max(Math.max.apply(Math,S),10);S.sort(((e,t)=>e-t));const C=(S[Math.floor((S.length-1)/2)]+S[Math.ceil((S.length-1)/2)])/2,A="on"===this.props.prefValues[I.kStartpageNavigation]?51:0,T=i.text.length>1?40:0,Z=(this.props.maxHeight-(A+T+40+21))/c,E=Boolean(this.props.pageId&&Ce.ZP.getPageInWindow(this.context.vivaldiWindowId,this.props.pageId)?.active);return o7("div",{className:"history manager"},void 0,o7("div",{className:"toolbar toolbar-default",role:"toolbar","aria-label":(0,B.Z)("toolbar label","History")},void 0,o7(po.ZP,{onClick:this.toggleDayPicker,tooltip:(0,B.Z)("Day picker calendar"),isPressed:e,image:Wi.eVT}),o7(H8,{search:this.onSearch,filter:i,minDate:this.state.oldestDate,hasHistory:0!==r.length,showClearBtn:!1}),o7("h1",{onClick:this.restoreSelection,style:{marginLeft:"auto",marginRight:"auto",flexShrink:5}},void 0,p),o7(po.ZP,{onClick:this.viewCurrent,title:g}),o7("div",{className:"toolbar-group"},void 0,o7(po.ZP,{onClick:this.viewPrevious.bind(this,v),tooltip:(0,B.Z)("Previous"),className:"button-narrow",disabled:l7(this.state.oldestDate).within(s),image:Wi.mgF.small}),o7(po.ZP,{onClick:this.viewNext,className:"button-narrow",tooltip:(0,B.Z)("Next"),disabled:y.within(s),image:Wi.Zu.small})),o7("div",{className:"toolbar-group"},void 0,o7(po.ZP,{title:(0,B.Z)("List"),isPressed:"range"===i.displayMode,onClick:()=>this.handleDisplayModeChange("range")}),o7(po.ZP,{title:(0,B.Z)("Day"),isPressed:"day"===i.displayMode,onClick:()=>this.handleDisplayModeChange("day")}),o7(po.ZP,{title:(0,B.Z)("Week"),isPressed:"week"===i.displayMode,onClick:()=>this.handleDisplayModeChange("week")}),o7(po.ZP,{title:(0,B.Z)("Month"),isPressed:"month"===i.displayMode,onClick:()=>this.handleDisplayModeChange("month")})),o7(po.ZP,{onClick:this.onClearBrowsingData,tooltip:(0,B.Z)("title","Clear browsing data"),image:Wi.DwE.small}),o7(po.ZP,{onClick:this.toggleMoreInfo,tooltip:t?(0,B.Z)("Hide info"):(0,B.Z)("More info"),image:Wi.GH$,isPressed:t})),i.text.length>1&&o7("div",{className:"toolbar toolbar-default search-options"},void 0,o7(po.ZP,{onClick:this.onSelectAll,title:(0,B.Z)("Search All History"),disabled:u}),o7("label",{},void 0,o7("input",{type:"checkbox",checked:i.searchURL,onChange:this.onIncludeUrlChange}),(0,B.Z)("Include Address in Search Results")),o7("div",{className:"filtered-entries"},void 0,(0,B.Z)("$1 Entry","$1 Entries",[l]))),o7("div",{className:Fi()({"history-view":!0,selecting:this._selectionHighlight})},void 0,e&&o7("div",{className:"manager-editor"},void 0,o7("div",{className:"CalendarMonth-Weekdays"},void 0,this._weekdaysSorted.map((e=>o7("span",{className:"CalendarMonth-DayOfWeek"},`hdr-${e.toString()}`,l7().day(e).format("ddd"))))),o7("div",{className:"timeline",onMouseLeave:this.handleMouseUp},void 0,o7(g8,{selectedDate:s.start,minDate:b,maxDate:y.endOf("month"),renderMonthDay:e=>this.#fn(r,w,C,e),onSelect:this.onCalendarSelect,isHeatMap:!0}))),o7("div",{className:"manager-content history-calendar-container"},void 0,"range"===i.displayMode&&o7("div",{className:"view range"},void 0,o7(Mm,{fields:r7,columns:this.state.columns,fullsize:!0,manualSorting:!1,keyAccess:this.props.keyAccess,onUpdateRow:this.onUpdateRow,onSaveRow:this.onSaveRow,onSortChange:this.onSortChange,sortField:i.sortField,sortOrder:i.sortOrder}),r.length>0?o7("div",{className:"history-tree"},void 0,o7(n7,{nodes:r,fullView:!0,inManager:!0,columns:this.state.columns,onSearchDomain:this.onSearchDomain,filter:i})):o7("div",{className:"vivaldi-tree-empty"},void 0,(0,B.Z)("No browsing history data for selected period"))),"day"===i.displayMode&&o7("div",{className:"view day"},void 0,o7(Mm,{fields:r7,columns:this.state.columns,fullsize:!0,manualSorting:!1,keyAccess:this.props.keyAccess,onUpdateRow:this.onUpdateRow,onSaveRow:this.onSaveRow,onSortChange:this.onSortChange,sortField:i.sortField,sortOrder:i.sortOrder}),r.length>0?o7("div",{className:"history-tree"},void 0,o7(n7,{nodes:r,fullView:!0,inManager:!0,columns:this.state.columns,filter:i,onSearchDomain:this.onSearchDomain})):o7("div",{className:"vivaldi-tree-empty"},void 0,(0,B.Z)("No browsing history data for selected period"))),"week"===i.displayMode&&o7("div",{className:"view week"},void 0,this.renderCalWeek()),"month"===i.displayMode&&o7("div",{className:"view month"},void 0,o7("div",{className:"month-calendar"},void 0,o7("div",{className:"CalendarMonth-Weekdays"},void 0,this._weekdaysSorted.map((e=>o7("span",{className:"CalendarMonth-DayOfWeek"},`hdr-${e.toString()}`,l7().day(e).format("dddd"))))),o7(g8,{selectedDate:s.start,minDate:l7(d.startOf("month")),maxDate:l7(d.endOf("month")),renderMonthDay:e=>this.#mn(r,w,C,Z,Math.floor(this.props.maxWidth/7),e),onSelect:this.onCalendarSelect,maxHeight:this.props.maxHeight})),n&&o7("div",{className:"month-links"},void 0,o7("ul",{className:"CalendarMonth-Weekdays"},void 0,o7("li",{className:"CalendarMonth-DayOfWeek"},void 0,(0,B.Z)("Entries"))),o7(n7,{nodes:r,fullView:!1,inManager:!0,filter:i,onSearchDomain:this.onSearchDomain})),o7("button",{className:"toggle-month-entries",title:n?(0,B.Z)("Hide entries"):(0,B.Z)("Show entries"),onClick:this.#gn,value:"monthEntriesVisible",tabIndex:this.props.keyAccess},void 0,n?">":"<"))),t&&this.state.loaded&&o7(M8,{title:h,filter:i,nodes:r,pageViewsCount:l,onOpenDomain:this.onOpenDomain,max:w,scaleY:"sqrt",onDomainContextMenu:this.onDomainContextMenu,pageIsActive:E},this.state.themeKey)))}}const p7=(0,Bu.Z)(u7,a7);var h7=n(62882),g7=n(60007),m7=n.n(g7),f7=n(89927),v7=n(63549),y7=n(57570),b7=n.n(y7),S7=n(96936),w7=n.n(S7),C7=n(5460),A7=n.n(C7),I7=n(61519),T7=n.n(I7),Z7=n(56827),E7=n.n(Z7),k7=n(6691),_7=n.n(k7),N7=n(74006),P7=n.n(N7),D7=n(4499),M7=n.n(D7),O7=n(91833),x7=n.n(O7),L7=n(45253),R7=n.n(L7),B7=n(27055),F7=n.n(B7),W7=n(85215),U7=n.n(W7),V7=n(29560),H7=n.n(V7),G7=n(37721),$7=n.n(G7),K7=n(96344),z7=n.n(K7),j7=n(82026),Y7=n.n(j7),X7=n(23874),Q7=n.n(X7),q7=n(93839),J7=n.n(q7),e9=n(61083),t9=n.n(e9),n9=n(41304),i9=n.n(n9),s9=n(42387),o9=n.n(s9),a9=n(61896),r9=n.n(a9),l9=n(78529),d9=n.n(l9),c9=n(30308),u9=n.n(c9),p9=n(58473),h9=n.n(p9),g9=n(36632),m9=n.n(g9),f9=n(19514),v9=n.n(f9),y9=n(97181),b9=n.n(y9),S9=n(26306),w9=n.n(S9),C9=n(91533),A9=n.n(C9),I9=n(17151),T9=n.n(I9),Z9=n(42157),E9=n.n(Z9);const k9={FORBID_TAGS:["style"],ALLOW_UNKNOWN_PROTOCOLS:!0};class _9{constructor(e){b7().registerLanguage("apache",w7()),b7().registerLanguage("applescript",A7()),b7().registerLanguage("bash",T7()),b7().registerLanguage("basic",E7()),b7().registerLanguage("coffeescript",_7()),b7().registerLanguage("cpp",P7()),b7().registerLanguage("css",M7()),b7().registerLanguage("diff",x7()),b7().registerLanguage("django",R7()),b7().registerLanguage("dockerfile",F7()),b7().registerLanguage("dos",U7()),b7().registerLanguage("ini",H7()),b7().registerLanguage("java",$7()),b7().registerLanguage("javascript",z7()),b7().registerLanguage("json",Y7()),b7().registerLanguage("less",Q7()),b7().registerLanguage("markdown",J7()),b7().registerLanguage("mathematica",t9()),b7().registerLanguage("matlab",i9()),b7().registerLanguage("nginx",o9()),b7().registerLanguage("objectivec",r9()),b7().registerLanguage("perl",d9()),b7().registerLanguage("python",u9()),b7().registerLanguage("ruby",h9()),b7().registerLanguage("scss",m9()),b7().registerLanguage("shell",v9()),b7().registerLanguage("sql",b9()),b7().registerLanguage("swift",w9()),b7().registerLanguage("typescript",A9()),b7().registerLanguage("vim",T9()),b7().registerLanguage("xml",E9()),this.remarkable=new f7._("commonmark",{emptyLines:!0,html:!0,breaks:!0,typographer:!1,quotes:e.quotes,highlight:(e,t)=>{if(t&&b7().getLanguage(t))try{return b7().highlight(t,e).value}catch(e){}return""}}),this.remarkable.use(m7()),this.remarkable.use(v7.N);const t=this.remarkable.inline.validateLink,n=/^\s*data:([a-z]+\/[a-z]+(;[a-z-]+=[a-z-]+)?)?(;base64)?,[a-z0-9!$&',()*+,;=\-._~:@/?%\s]*\s*$/i,i=/^\s*blob:chrome-extension:\/\/[a-z0-9!$&',()*+,;=\-._~:@/?%\s]*\s*$/i,s=/^\s*file:\/\/[a-z0-9!$&',()*+,;=\-._~:@/?%\s]*\s*$/i;this.remarkable.inline.validateLink=e=>t(e)||e.match(n)||e.match(i)||e.match(s),this.remarkable.inline.ruler.enable(["del","mark","sub","sup"]),this.remarkable.block.ruler.enable(["table"])}getRawMarkup(e){return(0,sh.sanitize)(this.remarkable.render(e),k9)}}var N9;function P9(e,t,n,i){N9||(N9="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:N9,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class D9 extends Li.Component{static contextType=ts.Z;refWebview=Li.createRef();constructor(e,t){super(e),this.state={startOffsetOnNewline:0,createLinkModalOpen:!1,caretState:{bold:!1,italic:!1,strikeThrough:!1,formatBlock:"p",insertOrderedList:!1,insertUnorderedList:!1},windowStyle:Be.Z.getBaseStylesByWindowId(t.vivaldiWindowId,XT)}}componentDidMount(){Be.Z.addListener(this.onThemeStoreChanged),this.refWebview.current?.addEventListener("consolemessage",this.handleConsoleMessage),this.refWebview.current?.addEventListener("contentload",this.handleContentLoad),this.refWebview.current?.addEventListener("newwindow",this.handleGoToURL)}componentWillUnmount(){Be.Z.removeListener(this.onThemeStoreChanged),this.refWebview.current?.removeEventListener("consolemessage",this.handleConsoleMessage),this.refWebview.current?.removeEventListener("contentload",this.handleContentLoad),this.refWebview.current?.removeEventListener("newwindow",this.handleGoToURL)}onThemeStoreChanged=()=>{const e=Be.Z.getBaseStylesByWindowId(this.context.vivaldiWindowId,XT);e!==this.state.windowStyle&&this.setState({windowStyle:e},this.setStyle)};postMessage=e=>{this.refWebview.current?.contentWindow?.postMessage?.(e,"*")};handleContentLoad=()=>{this.setStyle(),this.props.onContentLoad(),this.postMessage({type:"CONTENT_LOAD_REPLY",translatedStrings:{bold:(0,B.Z)("Strong text"),italic:(0,B.Z)("Emphasized text"),strikeThrough:(0,B.Z)("Deleted text"),quotes:(0,B.Z)("“”‘’")}})};handleGoToURL=e=>{e.preventDefault(),e.targetUrl.startsWith("#")||c.ZP.openURL(this.context.vivaldiWindowId,e.targetUrl)};onCaretStateEvent(e){if(!e)return;let t;try{t=JSON.parse(e)}catch(e){return}this._updateCaretState(t)}_updateCaretState(e){this.setState((t=>({caretState:{...t.caretState,...e}})),(()=>this.props.updateButtonState?.()))}focus(){this.refWebview.current?.focus()}blur(){this.refWebview.current?.blur()}hasFocus(){const{document:e}=this.context;return Boolean(this.refWebview.current)&&this.refWebview.current===e.activeElement}getContentAsBodyParts=()=>{const e=this.refWebview.current;return e?new Promise(((t,n)=>{e.executeScript({code:"document.body.innerText"},(e=>{e&&Array.isArray(e)&&"string"==typeof e[0]?t([{type:"text",content:e[0],charset:"UTF-8"}]):n("PlainTextEdit.getContentAsBodyParts: Couldn't get content from Webview")}))})):Promise.reject("RichTextEdit.getContentAsBodyParts: Webview doesn't exist")};onClick=e=>{if("createLink"===e)this.props.handleLinkEvent({type:e});else this.execCommand(e,""),this.props.updateButtonState?.()};onChange=(e,t)=>{this.execCommand(e,t.currentTarget.value),this.props.updateDropdownState?.()};execCommand(e,t){this.postMessage({type:"BUTTON_CLICK",command:e,value:t})}setContent=e=>{this.refWebview.current?.executeScript({code:`document.body.innerText = unescape('${escape(e)}');`},this.setStyle)};setStyle=()=>{this.refWebview.current?.executeScript({code:"document.head.innerHTML = `<style>"+Cs.ZP.createStyleRoot(this.state.windowStyle)+"\n    html, body, iframe {\n      background-color: var(--colorBg);\n      padding: 0;\n      margin: 0;\n      font-family: sans-serif;\n      overflow: initial;\n    }\n    body[contenteditable=\"plaintext-only\"] {\n      font-family: monospace;\n    }\n    body {\n      --EditorPadding: 12px;\n      --MaxWidth: 700px;\n      margin-left: var(--EditorPadding);\n      padding-left: calc(calc(50% - calc(var(--MaxWidth) / 2) - var(--EditorPadding))) !important;\n      padding-right: calc(50% - calc(var(--MaxWidth) / 2)) !important;\n      padding-top: var(--EditorPadding);\n      padding-bottom: calc(var(--EditorPadding) * 3);\n      color: var(--colorFgIntense);\n      font-size: 100%;\n      cursor: text;\n    }\n    img {\n      display: inline-block;\n      vertical-align: top;\n      max-width: 100%;\n      height: auto;\n    }\n    a:-webkit-any-link {\n      color: var(--colorHighlightBg);\n      cursor: pointer;\n    }\n  \n    html {\n      width: calc(100% - 12px);\n    }\n    html, body, iframe {\n      font-size: 100%;\n    }\n    input[type=checkbox] {\n      appearance: none;\n      position: relative;\n      width: 16px;\n      height: 16px;\n      min-width: 16px;\n      min-height: 16px;\n      vertical-align: middle;\n      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1) inset;\n      margin: unset;\n      border-width: 1px;\n      border-style: solid;\n      border-color: rgba(0,0,0,0.2);\n      background-color: var(--colorBgIntense);\n    }\n    input[type='checkbox']:disabled {\n      opacity: 1;\n      filter: grayscale(1);\n    }\n    input[type=checkbox]:before,\n    input[type=checkbox]:after {\n      content: '';\n      position: absolute;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background-color: var(--colorHighlightBg);\n      transform-origin: 0 0;\n    }\n    input[type=checkbox]:before {\n      transform: rotate(-45deg) translateY(45%) translateX(-30%) scaleX(0.25) scaleY(0);\n    }\n    input[type=checkbox]:checked:before {\n      transform: rotate(-45deg) translateY(45%) translateX(-30%) scaleX(0.25) scaleY(0.4);\n    }\n    input[type=checkbox]:after {\n      transform: rotate(225deg) translateY(-30%) translateX(-95%) scaleX(0.25) scaleY(0);\n    }\n    input[type=checkbox]:checked:after {\n      transform: rotate(225deg) translateY(-30%) translateX(-95%) scaleX(0.25) scaleY(1.2);\n    }\n    \n    .tooltip {\n      --TipWidth: 480px;\n      position: relative;\n    }\n    .tooltip .tooltip-text * {\n      user-select: none;\n    }\n    .tooltip-text input {\n      margin-left: 3px;\n      border: 1px solid var(--colorBorder);\n      border-radius: 2px;\n      font-size: 13px;\n      opacity: 0.8;\n      color: var(--colorFg);\n      background-color: var(--colorBg);\n    }\n    .tooltip-text input:active {\n      background-color: var(--colorBgDark);\n    }\n    .tooltip-text input:first-of-type {\n      margin-left: 12px;\n    }\n    .tooltip-text a {\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      color: var(--colorFg);\n    }\n    .tooltip .tooltip-text {\n      cursor: default;\n      position: absolute;\n      z-index: 1;\n      display: flex;\n      align-items: center;\n      top: 100%;\n      left: -6px;\n      max-width: var(--TipWidth);\n      padding: 6px 6px 6px 12px;\n      color:var(--colorFg);\n      background-color: var(--colorBg);\n      border: 1px solid var(--colorBgDark);\n      box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.1), 0 3px 10px rgba(0, 0, 0, 0.3);\n      border-radius: 3px;\n    }\n  \n  ".replace(/\n|\r/g,"")+"</style>`;"})};debouncedUpdateState=(0,Ae.Z)((()=>{this.props.updateButtonState?.(),this.props.updateDropdownState?.()}),100);handleConsoleMessage=e=>{const[t,n]=e.message.split(" ",2);switch(t){case"caretState":this.onCaretStateEvent(n);break;case"selectionchange":this.debouncedUpdateState();break;case"input":this.debouncedUpdateState(),this.props.onChange(e);break;case"createLink":this.props.handleLinkEvent({type:t});break;default:throw new Error(e.message)}};setZoomLevel=e=>{const t=this.refWebview.current;t&&(t.setZoomMode("per-view"),t.setZoom(e))};render(){const{disabled:e,hidden:t}=this.props;return P9("div",{className:"editor-html"},void 0,(0,ss.jsx)("webview",{className:"editor-webview",name:"markdowneditor",ref:this.refWebview,style:t||e?{display:"none"}:{},allowtransparency:"on",src:'data:text/html,<html id="content" tabindex="-1">\n  <head><script src="chrome-extension://mpognobbkildjkofajifpdfhcoklimli/markdowneditor-bundle.js"><\/script></head>\n  <body contenteditable="plaintext-only"></body>\n</html>'}))}}var M9,O9,x9,L9=n(50564),R9=n(50036);class B9{constructor(){this.turndownService=new R9.Z({headingStyle:"atx",codeBlockStyle:"fenced"}),this.turndownService.use(L9.r0),this.turndownService.addRule("strikethrough",{filter:["del","s","strike"],replacement:e=>"~~"+e+"~~"}),this.turndownService.addRule("listItem",{filter:"li",replacement:function(e,t,n){e=e.replace(/^\n+/,"").replace(/\n+$/,"\n").replace(/\n/gm,"\n    ");let i=n.bulletListMarker+" ",s=t.parentNode;if("OL"===s.nodeName){const e=s.getAttribute("start"),n=Array.from(s.children).indexOf(t);i=(e?Number(e)+n:n+1)+". "}let o=-1;for(;s&&("OL"===s.nodeName||"UL"===s.nodeName);)o+=1,s=s.parentNode;return"    ".repeat(o)+i+e+(t.nextSibling&&!/\n$/.test(e)?"\n":"")}})}}function F9(e,t,n,i){M9||(M9="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:M9,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function W9({disabled:e,keyAccess:t,noteId:n,text:i,onOpenDialog:s}){const o=Li.useRef(null);return F9("label",{className:Fi()("button-toolbar",{disabled:e}),title:(0,B.Z)("Attach new file..."),tabIndex:t},void 0,(0,ss.jsx)("input",{ref:o,type:"file",style:{display:"none"},accept:"image/*",disabled:e,onChange:e=>zn.Z.addFile(n,e.target.files[0])}),F9("button",{disabled:e,tabIndex:t,onClick:function(){s?.(),o.current?.click()}},void 0,F9("div",{style:{display:"contents"},dangerouslySetInnerHTML:{__html:Wi.onv}}),F9("span",{},void 0,i)))}function U9(e,t,n,i){O9||(O9="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:O9,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function V9({onDelete:e,onContextMenu:t,url:n,onOpen:i,onDragStart:s,draggable:o}){return U9("div",{className:"AttachmentItem",onDragStart:s?e=>s(e,n):null,draggable:o},void 0,U9("img",{className:"AttachmentItem-Image",src:n}),U9("button",{className:"AttachmentItem-DeleteButton",title:(0,B.Z)("Remove attachment"),onClick:()=>e(),tabIndex:"-1",dangerouslySetInnerHTML:{__html:Wi.M2k.medium}}),U9("button",{className:Fi()({"AttachmentItem-ViewOverlayButton":!0,"dragging-enabled":o}),title:(0,B.Z)("View attachment"),onContextMenu:t,onClick:i,dangerouslySetInnerHTML:{__html:Wi.YvR.large}}))}function H9(e,t,n,i){x9||(x9="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:x9,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function G9(e,t,n,i){const s={inCurrent:n,inBackground:i};c.ZP.openURL(e,t,s)}function $9(e,t,n){const i={inNewWindow:!0,incognito:n};c.ZP.openURL(e,t,i)}class K9 extends Li.Component{static contextType=ts.Z;onContextMenu=(e,t,n)=>{const i=this.context.vivaldiWindowId,s=[{items:[{handler:()=>G9(i,t,!0,!1),...(0,us.Z)("Current Tab")},{handler:()=>G9(i,t,!1,C.Z.get(I.kTabsOpenNewInBackground)),...(0,us.Z)("open in","New Tab")},{handler:()=>G9(i,t,!1,!0),isVisible:()=>!C.Z.get(I.kTabsOpenNewInBackground),...(0,us.Z)("Background Tab")},Qe.Z.separatorItem,{handler:()=>$9(i,t,!1),...(0,us.Z)("open in","New Window")},{handler:()=>$9(i,t,!0),...(0,us.Z)("open in","Private Window")}],...(0,us.Z)("Open in")},Qe.Z.separatorItem,{handler:(e=>{e&&this.props.onInsertMarkdown?.(e)}).bind(null,t),...(0,us.Z)("Insert Markdown"),isVisible:()=>!!this.props.onInsertMarkdown},{handler:this.props.onRemoveAttachment.bind(null,e),...(0,us.Z)("verb","Remove")}];(0,cs.Z)(this.context,s)(n)};onDragStart=(e,t)=>{"html"===this.props.dragFormat?e.dataTransfer.setData("text/html",`<img src="${t}" />`):e.dataTransfer.setData("text/plain",`attachment:${t}`)};render(){const{attachments:e}=this.props;return H9("div",{className:"NotesAttachments"},void 0,e.map(((e,t)=>{const n=e.content?`chrome://vivaldi-data/synced-store/${e.content}`:"";return H9(V9,{url:n,onContextMenu:this.onContextMenu.bind(null,e.id,n),onOpen:e=>c.ZP.openURL(this.context.vivaldiWindowId,n),onDelete:this.props.onRemoveAttachment.bind(null,e.id),onDragStart:this.onDragStart,draggable:!!this.props.onInsertMarkdown},e.id)})))}}const z9=K9;var j9,Y9;function X9(e,t,n,i){j9||(j9="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:j9,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function Q9({noteId:e,attachments:t,onRemoveAttachment:n,onInsertMarkdown:i,dragFormat:s}){return X9("div",{className:"NotesAttachmentPopup"},void 0,X9(z9,{attachments:t,onRemoveAttachment:n,onInsertMarkdown:i,dragFormat:s}),X9(W9,{noteId:e,disabled:!1,keyAccess:-1,text:(0,B.Z)("Add attachment")}))}function q9(e,t,n,i){Y9||(Y9="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Y9,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const J9=[[{command:"bold",text:(0,B.Z)("Bold"),icon:Wi.q7H},{command:"italic",text:(0,B.Z)("Italic"),icon:Wi.znb},{command:"strikeThrough",text:(0,B.Z)("Strike through"),icon:Wi._QD}],[{command:"insertOrderedList",text:(0,B.Z)("Numbered list"),icon:Wi.o_D},{command:"insertUnorderedList",text:(0,B.Z)("Bullet list"),icon:Wi.rr$},{command:"outdent",text:(0,B.Z)("Remove indentation"),icon:Wi.XKb},{command:"indent",text:(0,B.Z)("Indent"),icon:Wi.b2r}],[{command:"createLink",text:(0,B.Z)("Create Link"),icon:Wi.v2I}],[{command:"undo",text:(0,B.Z)("win_linux","Undo"),icon:Wi.LwO},{command:"redo",text:(0,B.Z)("win_linux","Redo"),icon:Wi.W9w}]];class eee extends Li.Component{static contextType=ts.Z;isAnchor=!1;anchorOrSelection="";state={buttonState:[],createLinkModalOpen:!1,formatBlock:"p",isAttachmentPopupOpen:!1};updateButtonState=(e,t)=>{this.setState((n=>({buttonState:e||n.buttonState,formatBlock:t||n.formatBlock})))};updateLinkState=e=>{this.isAnchor=e.isAnchor,this.anchorOrSelection=e.anchorOrSelection};onCreateLink=e=>{this.setState({createLinkModalOpen:!1}),this.props.onCreateLink(e)};onCancelCreateLink=()=>{this.setState({createLinkModalOpen:!1}),this.props.onCancelCreateLink()};showCreateLinkModal=()=>this.setState({createLinkModalOpen:!0});cacheFocus=()=>{const{document:e}=this.context;e.activeElement?this._focusCache=e.activeElement:this._focusCache=void 0};restoreFocus=()=>{this._focusCache&&this._focusCache.focus()};toggleAttachmentPopup=()=>this.setState((e=>({isAttachmentPopupOpen:!e.isAttachmentPopupOpen})));hideAttachmentPopup=()=>this.setState({isAttachmentPopupOpen:!1});enableVisualMode=()=>this.props.setVisualMode(!0);disableVisualMode=()=>this.props.setVisualMode(!1);handleFindInPage=(e,t)=>af.Z.findInPage(this.context.vivaldiWindowId,this.props.pageId,e,t);handleFindNextInPage=(e,t,n)=>af.Z.findNextInPage(this.context.vivaldiWindowId,this.props.pageId,e,t,n);render(){const{noteId:e}=this.props;let t=0;return q9("div",{className:"NotesManager-Toolbar"},void 0,this.state.createLinkModalOpen&&q9($T,{onCreateLink:this.onCreateLink,onCancelCreateLink:this.onCancelCreateLink,isAnchor:this.isAnchor,anchorOrSelection:this.anchorOrSelection}),q9("div",{className:"toolbar toolbar-default NotesManager-Buttons",role:"toolbar","aria-label":(0,B.Z)("toolbar label","Notes")},void 0,q9(po.ZP,{tooltip:this.props.inFullView?(0,B.Z)("Enter Full View"):(0,B.Z)("Exit Full View"),onClick:this.props.toggleFullEditor,image:this.props.inFullView?Wi.ADs.medium:Wi.BB1.medium}),q9(ta.Z,{onChange:e=>{this.props.onParagraphFormatChange("formatBlock",e),this.restoreFocus()},onMouseDown:this.cacheFocus,value:this.state.formatBlock,title:(0,B.Z)("Paragraph Format"),tabIndex:"-1",disabled:this.props.disabled},void 0,q9("option",{value:"h1"},void 0,(0,B.Z)("Heading 1")),q9("option",{value:"h2"},void 0,(0,B.Z)("Heading 2")),q9("option",{value:"h3"},void 0,(0,B.Z)("Heading 3")),q9("option",{value:"h4"},void 0,(0,B.Z)("Heading 4")),q9("option",{value:"p"},void 0,(0,B.Z)("Paragraph")),q9("option",{value:"pre"},void 0,(0,B.Z)("Preformatted"))),J9.map(((e,n)=>{const i=e.map(((e,n)=>q9(po.ZP,{tooltip:e.text,image:e.icon,onClick:()=>this.props.onStylingButtonClicked(e.command),tabIndex:-1,disabled:this.props.disabled,isPressed:!0===this.state.buttonState[t+n]},e.command)));return t+=i.length,q9("div",{className:"toolbar-group"},n,i)})),q9(po.ZP,{className:"attachment-button push-right",title:(0,B.Z)("$1 Attachment","$1 Attachments",[this.props.attachments.length]),onClick:this.toggleAttachmentPopup,isPopupVisible:this.state.isAttachmentPopupOpen,hidePopup:this.hideAttachmentPopup,popupClassName:"ToolbarButtonPopup-DefaultStyles",popupWidth:222,popupPosition:"below",image:Wi.onv,disabled:this.props.disabled},void 0,e&&q9(Q9,{attachments:this.props.attachments,noteId:e,onRemoveAttachment:e=>{zn.Z.removeNode(e)},onInsertMarkdown:this.props.handleAttachmentMarkdown,dragFormat:this.props.visualMode?"html":"url"})),q9("div",{className:"toolbar-group"},void 0,q9(po.ZP,{title:(0,B.Z)("Text"),onClick:this.disableVisualMode,isPressed:!this.props.visualMode,disabled:this.props.disabled}),q9(po.ZP,{title:(0,B.Z)("Visual"),onClick:this.enableVisualMode,isPressed:this.props.visualMode,disabled:this.props.disabled}))),q9(PI,{isActive:this.props.isActive,pageId:this.props.pageId,onFindInPage:this.handleFindInPage,onFindNextInPage:this.handleFindNextInPage}))}}function tee(e,t){if(e.title)return e.title;if(!e.content)return t||"";return e.content.split("\n")[0].trim().replace(/ {2,}/g," ").replace(/^#+ /g,"").substr(0,128).trim()}function nee({content:e}){return e?e.replace(/\n+/g,"").length:0}function iee({content:e}){return e?e.trim().split(/\s+/g).length:0}var see,oee,aee=n(5846),ree=n(34155);function lee(e,t,n,i){see||(see="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:see,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class dee extends Li.Component{static contextType=ts.Z;refMarkdownEditor=Li.createRef();refVisualEditor=Li.createRef();refToolbar=Li.createRef();markdownFormatter=new _9({quotes:(0,B.Z)("“”‘’")});turndownFormatter=new B9;state={visualMode:!C.Z.get(I.kNotesManagerShowMarkdown),attachments:this.props.note?.children?this.props.note.children:[]};componentDidMount(){h7.ZP.addListener(this._onNoteStoreChanged)}componentDidUpdate(e){e.note!==this.props.note&&(this.hasFocus()||(this.onRichContentLoad(),this.onMarkdownContentLoad()),this.setState({attachments:this.props.note?.children?this.props.note.children:[]}))}componentWillUnmount(){h7.ZP.removeListener(this._onNoteStoreChanged)}_onNoteStoreChanged=e=>{if(this.props.note){const e=h7.ZP.getNodeById(this.props.note.id);e&&this.setState({attachments:e.children})}};focus=()=>{this.state.visualMode?this.refVisualEditor.current?.focus():this.refMarkdownEditor.current&&this.refMarkdownEditor.current.focus()};blur=()=>{this.state.visualMode?this.refVisualEditor.current?.blur():this.refMarkdownEditor.current&&this.refMarkdownEditor.current.blur()};hasFocus=()=>this.state.visualMode&&this.refVisualEditor.current?this.refVisualEditor.current.hasFocus():!!this.refMarkdownEditor.current&&this.refMarkdownEditor.current.hasFocus();handleAttachmentMarkdown=async e=>{this.refVisualEditor.current&&this.props.note&&this.refVisualEditor.current.execCommand("insertImage",e)};onHtmlChange=()=>{if(!this.refVisualEditor.current)throw new Error("VisualEditor: Building body parts after body is gone");return this.refVisualEditor.current.getContentAsBodyParts().then((e=>{if("html"===e[0].type){const t=this.turndownFormatter.turndownService.turndown(e[0].content);this.props.updateNoteContent(t,(()=>{this.refMarkdownEditor&&this.refMarkdownEditor.current&&this.refMarkdownEditor.current.setContent(t)}))}}))};onMarkDownChange=async()=>{if(!this.refMarkdownEditor.current)throw new Error("MarkdownEditor: Building body parts after body is gone");const e=await this.refMarkdownEditor.current.getContentAsBodyParts();if("text"!==e[0].type)return;const t=e[0].content;this.props.updateNoteContent(t,(()=>{}))};setZoomLevel=()=>{const e=mw.Z.getNotesZoom();this.refVisualEditor.current?.setZoomLevel(e),this.refMarkdownEditor.current?.setZoomLevel(e)};onRichContentLoad=()=>{const{note:e}=this.props,t=this.markdownFormatter.getRawMarkup(e?.content??"").replace(/<p><\/p>/g,"<p><br></p>");ree.nextTick((()=>{this.refVisualEditor.current?.setContent([{content:t,isPlainText:!1}]),this.setZoomLevel()}))};onMarkdownContentLoad=()=>{const{note:e}=this.props;ree.nextTick((()=>{this.refMarkdownEditor.current?.setContent(e?.content||""),this.setZoomLevel()}))};onStylingButtonClicked=e=>{this.state.visualMode?this.refVisualEditor.current?.onClick(e):this.refMarkdownEditor.current?.onClick(e)};onParagraphFormatChange=(e,t)=>{this.state.visualMode?this.refVisualEditor.current?.onChange(e,t):this.refMarkdownEditor.current?.onChange(e,t)};onCreateLink=e=>{const t=this.state.visualMode?this.refVisualEditor.current:this.refMarkdownEditor.current;t&&(""===e?t.execCommand("unlink"):"https://"!==e&&t.execCommand("createLink",e),t.focus())};onCancelCreateLink=()=>{this.focus()};handleLinkEvent=e=>{const t=this.refToolbar.current;if(!t)return;const{isAnchor:n,anchorOrSelection:i}=t;switch(e.type){case"selectionchange":t.updateLinkState(e);break;case"createLink":case"editLink":t.showCreateLinkModal();break;case"copyLink":break;case"unlink":n&&i&&this.refVisualEditor.current?.unlink();break;case"createLinkClicked":n&&i&&this.refVisualEditor.current?.selectSurrounding(),t.showCreateLinkModal()}};setActiveWebView=()=>{this.clearActiveWebViews();const e=this.refVisualEditor.current?.refWebview.current,t=this.refMarkdownEditor.current?.refWebview.current,n=this.context.vivaldiWindowId;this.state.visualMode&&e?sI.Z.setActiveWebView(n,e):this.refMarkdownEditor&&t&&sI.Z.setActiveWebView(n,t)};clearActiveWebViews=()=>{const e=this.refVisualEditor.current?.refWebview.current,t=this.refMarkdownEditor.current?.refWebview.current,n=this.context.vivaldiWindowId;e&&sI.Z.clearIfActive(n,e),t&&sI.Z.clearIfActive(n,t)};setVisualMode=e=>{this.setState({visualMode:e},(()=>{this.setActiveWebView(),this.onRichContentLoad(),w.Z.set(I.kNotesManagerShowMarkdown,!e)}))};updateDropdownAndColorState=()=>{this.refVisualEditor.current?.executeScript({code:"['formatBlock'].map(command => document.queryCommandValue(command));"}).then((e=>{if(Array.isArray(e)&&1===e.length&&Array.isArray(e[0])){const[t]=e[0],n=""===t||"div"===t?"p":t;this.refToolbar.current?.updateButtonState(void 0,n)}}))};updateButtonState=()=>{const e=this.refToolbar.current;if(e)if(this.state.visualMode){const t=`[${'"'+J9.flat().map((e=>e.command)).join('","')+'"'}].map(command => document.queryCommandState(command));`;this.refVisualEditor.current?.executeScript({code:t}).then((t=>{const n=J9.flat().map((e=>e.command)).indexOf("createLink"),i=t&&t[0]||[];i[n]=!!e.state.anchor,e.updateButtonState(i)}))}else{const t=this.refMarkdownEditor.current;if(!t)return;const n=J9.flat().map((e=>e.command)).map((e=>t.state.caretState[e])).filter(aee.Z),{formatBlock:i}=t.state.caretState;e.updateButtonState(n,i)}};render(){const{note:e}=this.props;return(0,ss.jsxs)(ss.Fragment,{children:[(0,ss.jsx)(eee,{ref:this.refToolbar,isActive:this.props.isActive,noteId:e?.id,pageId:this.props.pageId,attachments:this.state.attachments,disabled:!e||this.props.isFolder,inFullView:this.props.inFullView,visualMode:this.state.visualMode,handleAttachmentMarkdown:this.handleAttachmentMarkdown,onCreateLink:this.onCreateLink,onCancelCreateLink:this.onCancelCreateLink,onParagraphFormatChange:this.onParagraphFormatChange,onStylingButtonClicked:this.onStylingButtonClicked,setVisualMode:this.setVisualMode,toggleFullEditor:this.props.toggleFullEditor}),lee("div",{className:"NotesManager-Editor"},void 0,lee("div",{className:"editor-html"},void 0,(0,ss.jsx)(eZ,{ref:this.refVisualEditor,onChange:this.onHtmlChange,onContentLoad:this.onRichContentLoad,focusPreviousElement:Lr.Z,isNote:!0,hidden:!this.state.visualMode,disabled:!e||this.props.isFolder,updateDropdownAndColorState:this.updateDropdownAndColorState,updateButtonState:this.updateButtonState,handleLinkEvent:this.handleLinkEvent})),(0,ss.jsx)(D9,{ref:this.refMarkdownEditor,onChange:this.onMarkDownChange,onContentLoad:this.onMarkdownContentLoad,hidden:this.state.visualMode,disabled:this.state.visualMode||!e||this.props.isFolder,updateDropdownState:this.updateDropdownAndColorState,updateButtonState:this.updateButtonState,handleLinkEvent:this.handleLinkEvent})),e&&lee("footer",{className:"NotesManager-Footer"},void 0,lee("div",{className:"NotesManager-WordCount"},void 0,(0,B.Z)("$1 word","$1 words",[iee(e)])+", "+(0,B.Z)("$1 character","$1 characters",[nee(e)])))]})}}function cee(e,t,n,i){oee||(oee="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:oee,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function uee(e,t){c.ZP.openURL(e,pn.jk.internalUrl("notes",t.id),{singleton:!0})}class pee extends Li.PureComponent{refTreeList=Li.createRef();static contextType=ts.Z;_isAdding=!1;state={nodes:[],populated:!1,cutIds:[],showBadge:C.Z.get(I.kPanelsShowFolderBadge)};expandModel={};componentDidMount(){C.Z.addListener(I.kPanelsShowFolderBadge,this._onBadgeChanged),h7.ZP.addListener(this._onStoreChange),this._onStoreChange({reason:"init",id:"-1"})}componentWillUnmount(){C.Z.removeListener(I.kPanelsShowFolderBadge,this._onBadgeChanged),h7.ZP.removeListener(this._onStoreChange)}componentDidUpdate(e){if(this.props.filter!==e.filter){const t=this.props.filter.length,n=e.filter.length;0===n&&t>0&&this.refTreeList.current&&(this.expandModel=this.refTreeList.current.getExpandModel()),this.onFilterChange(this.props.filter,(e=>{t>0?this.refTreeList.current?.expandAllExcept(e):n>0&&0===t&&this.refTreeList.current?.expandWithModel(this.expandModel)}))}}isEmpty=()=>this.state.populated&&0===this.state.nodes.length;isInManager=()=>Boolean(this.props.columns);deleteSelectedItems=()=>this.refTreeList.current?.onDelete()||Promise.reject();delete=(e=[])=>Promise.all(e.map((e=>"string"!=typeof e?Promise.resolve():new Promise((t=>{se.Z.notes.get(e,(n=>{n&&n.length>0&&!this.isTrashCan(n[0])?se.Z.notes.remove(e,t):t()}))})))));isFolder=e=>h7.ZP.isFolder(e);isTrashCan=e=>Boolean("trash"===e.type);getUrlsByNodes=e=>e.map((e=>h7.ZP.getNodeById(e.id))).map((e=>e?.url?(0,rl.q9)(e.url):void 0)).filter(Boolean);onItemMouseDown=(e,t)=>{t.button===es.Z.kCenter&&(0,ms.ZP)(t)};onItemMouseUp=(e,t)=>{if(t.button===es.Z.kCenter){const n=this.getUrlsByNodes([e]),i=this.context.vivaldiWindowId;n.length>0?c.ZP.openUrls(i,n,{...(0,La.ZP)(i,{button:t.button,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey})}):uee(this.context.vivaldiWindowId,e),(0,ms.ZP)(t)}};onItemDoubleClick=(e,t)=>{const n=this.getUrlsByNodes([t]),i=this.context.vivaldiWindowId;n.length>0?c.ZP.openUrls(i,n,{...(0,La.ZP)(i,{button:e.button,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,metaKey:e.metaKey})}):uee(i,t)};onNodesActivated=(e,t)=>{const n=this.getUrlsByNodes(t),i=this.context.vivaldiWindowId;c.ZP.openUrls(i,n,{...(0,La.ZP)(i,{ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,metaKey:e.metaKey})})};onFilterChange=(e,t=Lr.Z)=>{let n=[],i=[];if(h7.ZP.hasNotes())if(e.length>0){let t=e.toLowerCase();const s={};if(t.startsWith("url:")?(t=t.substring(4),s.url=t.length>0,s.content=!1):t.startsWith("content:")&&(t=t.substring(8),s.url=!1,s.content=t.length>0),"."===t&&(s.url=!1),"tree"===this.refTreeList.current?.getSearchStyle()){const e=h7.ZP.getFilteredTree(t,s);n=e.nodes,i=e.collapsed}else n=h7.ZP.getFilteredFlat(t,s)}else n=h7.ZP.getRootNode().children;this.setState({nodes:n,populated:!0,cutIds:h7.ZP.getCutIds()},(()=>{t(i)}))};_onStoreChange=(e,t)=>{this._isAdding&&"added"===e.reason||this.onFilterChange(this.props.filter,(()=>{"removed"!==e.reason&&"moved"!==e.reason||this.refTreeList.current?.pruneExpandModel(),this.props.onStoreChange(e,Boolean(t))}))};_onBadgeChanged=(e,t)=>{this.setState({showBadge:Boolean(t)})};hasChildren=e=>"note"!==e.type&&!!e.children&&e.children.length>0;handleExpandClick=(e,t)=>{const n=e.altKey;this.refTreeList.current?.toggleSelectedExpansion(t,n)};unSelectAll=()=>{this.refTreeList.current?.unSelectAll()};getSelectedItem=()=>this.refTreeList.current?.getSelectedItem();expandAll=()=>{this.refTreeList.current?.expandAll()};collapseAll=()=>{this.refTreeList.current?.collapseAll()};setSearchStyle=e=>{this.refTreeList.current?.setSearchStyle(e)};onSearchStyleChanged=e=>{this.props.filter&&this.onFilterChange(this.props.filter,(t=>{"tree"===e&&this.refTreeList.current?.expandAllExcept(t)}))};isValidForClipboard=e=>!this.isTrashCan(e);isValidDragSource=e=>!this.isTrashCan(e);isValidAddTarget=e=>!this.isTrashed(e);isTrashed=e=>!!e&&(!!this.isTrashCan(e)||!!e.parentId&&this.isTrashed(this.refTreeList.current?.findTreeItem(e.parentId)));onAddFolder=()=>{const e={title:(0,B.Z)("title","New Folder")};this.refTreeList.current?.onAdd("folder",e)};onAddNote=e=>{this.refTreeList.current?.onAdd("item",e)};selectById=e=>{this.refTreeList.current?.expandToId(e),this.refTreeList.current?.selectById(e)};onDrop=(e,t,n)=>{const i=e.dataTransfer.getData("text/plain");if(i.length>0){const e=this.getTargetSpec(t,n),s={id:"",content:i,title:"",type:"note"};return this.onCreate([s],e.parentId,e.index,!0)}return Promise.resolve()};getTargetSpec=(e,t)=>{const n={index:0,parentId:void 0,pageIndex:void 0};if(this.isTrashCan(e)&&"on"!==t){const e=h7.ZP.getLastTopNode();e?(n.parentId=e.parentId,n.index=(e.index||0)+1):n.parentId=h7.ZP.getRootNode().id}else if(this.isFolder(e)&&"on"===t)n.parentId=e.id;else{Boolean(this.refTreeList.current?.isExpanded(e.id))&&"below"===t?n.parentId=e.id:(n.parentId=e.parentId,n.index=(e.index||0)+("below"===t?1:0))}return n};buildNode=(e,t)=>({...t,type:"item"===e?"note":e});onCreate=async(e,t,n,i)=>{const s=void 0===e[0].children;this.props.onBeforeCreate(s),this._isAdding=!0;const o=await zn.Z.createNotesFromTreeNodes(e,t||"",n);this._isAdding=!1,o.length>0&&this._onStoreChange({reason:"added",id:o[0].id},!0)};onMove=async(e,t,n)=>{if("number"!=typeof t.index)return[];const i=t.index,s=t.parentId??"",o=h7.ZP.validateForDrag(e);let a=0;for(let e=0;e<o.length;e++){const t=o[e],n=h7.ZP.getNodeById(t),r=n?.index??-1;if(!(r<0)){if(0===e)a=i;else{const e=s!==n?.parentId;a+=r<i&&!e?0:1}await se.Z.notes.move(t,{parentId:s,index:a})}}return[]};getText=()=>new Promise((e=>{const t=Ce.ZP.getActivePage(this.context.vivaldiWindowId);t?se.Z.utilities.getSelectedText(t.id,e):e("")}));getMenuCapability=async(e,t,n)=>{const i=this.context.vivaldiWindowId,s={inManager:this.isInManager()};switch(e.action){case"CONTEXT_OPEN_ADDRESS":{const o=n?.url;return{handler:()=>!!o&&c.ZP.openUrls(i,[o],{inNewWindow:!1,inCurrent:!1,inBackground:C.Z.get(I.kTabsOpenNewInBackground)}),isVisible:()=>!!o,...t(i,e,s)}}case"CONTEXT_CONTAINER_OPEN_IN_WINDOW":{const s=n?.url,o=await Ta.getMenu(i,!0,[s||""]);return{isVisible:()=>!!s&&o.length>0,items:o,...t(i,e,{})}}case"CONTEXT_NEW_FROM_SELECTION":return this.getText().then((n=>{const o=Ce.ZP.getActivePage(i),a=o?.url??"";return{isVisible:()=>!!n&&!!o,handler:()=>{this.refTreeList.current?.onAdd("item",{content:n,url:a})},...t(i,e,s)}}));case"CONTEXT_EDIT":return{handler:()=>uee(this.context.vivaldiWindowId,n),isVisible:()=>Boolean(n)&&!this.isTrashCan(n),...t(i,e,s)};case"CONTEXT_EMPTY_TRASH":return{handler:()=>zn.Z.emptyTrash(),isVisible:()=>Boolean(n)&&this.isTrashCan(n),...t(i,e,s)};default:return{...t(i,e,s)}}};getMenuVisibility=(e,t)=>{if(t)if(this.isTrashCan(t))switch(e.action){case"CONTEXT_EXPAND_ALL":case"CONTEXT_COLLAPSE_ALL":case"CONTEXT_CONTAINER_SEARCH":return!0;default:return!1}else{const n=this.isTrashCan(t)||h7.ZP.isSeparator(t);switch(e.action){case"CONTEXT_NEW_ITEM":case"CONTEXT_NEW_FOLDER":case"CONTEXT_CUT":case"CONTEXT_COPY":case"CONTEXT_PASTE":case"CONTEXT_DELETE":return!this.isTrashCan(t);case"CONTEXT_NEW_SEPARATOR":return!this.isTrashCan(t)&&this.props.sorting.sortOrder===ds.Z.NO_SORTING;case"CONTEXT_RENAME":return!n;case"CONTEXT_EXPAND_ALL":case"CONTEXT_COLLAPSE_ALL":case"CONTEXT_CONTAINER_SEARCH":return!0;default:return!1}}else switch(e.action){case"CONTEXT_NEW_ITEM":case"CONTEXT_NEW_FOLDER":case"CONTEXT_PASTE":case"CONTEXT_EXPAND_ALL":case"CONTEXT_COLLAPSE_ALL":case"CONTEXT_CONTAINER_SEARCH":return!0;case"CONTEXT_NEW_SEPARATOR":return this.props.sorting.sortOrder===ds.Z.NO_SORTING;default:return!1}};onContextMenu=e=>{this.refTreeList.current?.onContextMenu(e)};getDropSupport=(e,t)=>{const n={available:!1,onto:!1,edge:"both"};return n.available=t.dataTransfer.types.some((e=>zi.ZP.isUriListType(e)||"text/plain"===e||e===h7.d0)),n.available&&(n.onto=this.isFolder(e)),n};saveTitle=(e,t)=>{se.Z.notes.update(e,{title:t})};handleCut=(e,t)=>{const n=t.filter(this.isValidForClipboard),i=n.map((e=>e.id));(0,ms.ZP)(e),zn.Z.setClipboard(e,n,!0),zn.Z.setCutIds(i)};handleCopy=(e,t)=>{(0,ms.ZP)(e),zn.Z.setClipboard(e,t.filter(this.isValidForClipboard),!1)};renderTitleRow=e=>{const t=e.node,n=e.level,i=(n+1)*ks+"px",s=n*ks+"px",o=this.isFolder(t);return cee("label",{},t.id,o&&this.hasChildren(t)&&cee("span",{className:"expand-icon",style:{marginLeft:s},onMouseDown:ms.ZP,onMouseUp:e=>this.handleExpandClick(e,t.id),dangerouslySetInnerHTML:{__html:Wi.nfH}}),o&&cee(Ki,{trash:this.isTrashCan(t),open:e.isExpanded,leftMargin:this.hasChildren(t)?0:i}),!o&&!t.url&&cee("span",{style:{marginLeft:i},className:"tree-icon",dangerouslySetInnerHTML:{__html:Wi.zKr}}),!o&&!!t.url&&cee("span",{style:{marginLeft:i},className:"tree-icon",dangerouslySetInnerHTML:{__html:Wi.NwZ}}),void 0!==e.inlineEditText&&cee("input",{type:"text",value:e.inlineEditText,onChange:e.onChange,onFocus:e.onFocus,onBlur:e.onBlur,autoFocus:!0}),void 0===e.inlineEditText&&cee("span",{className:"title",title:tee(t)},void 0,tee(t)),e.showBadge&&!this.props.fullView&&this.hasChildren(t)&&cee("span",{className:"item-count"},void 0,t.children?.length))};getRowComponentProps=e=>({...e,childCount:e.node.children&&"note"!==e.node.type?e.node.children.length:0,columns:this.props.columns,showBadge:this.state.showBadge});rowComponent=e=>{const t=e.node,n=e.level,i=h7.ZP.isSeparator(t),s=this.isFolder(t),o=(n+1)*ks+"px",{columns:a}=e,r=[];return i?r.push(cee("label",{"data-parent":t.parentId},`${t.id}__separator__${r.length}`,cee("hr",{style:{marginLeft:o},className:"separator"}))):this.props.fullView?(a||[]).map((n=>{switch(n.id){case"title":r.push(this.renderTitleRow(e));break;case"url":r.push(cee("label",{},n.id,cee("span",{},void 0,t.url)));break;case"content":r.push(cee("label",{},n.id,!s&&cee("span",{},void 0,t.content),s&&t.children&&t.children.length>0&&cee("span",{className:"secondary"},void 0,(0,B.Z)("$1 item","$1 items",[t.children.length]))));break;case"attachments":r.push(cee("label",{className:"right-aligned"},n.id,cee("span",{},void 0,"note"===t.type&&t.children&&t.children.length>0?t.children.length:"")));break;case"dateAdded":r.push(cee("label",{className:"right-aligned"},n.id,!s&&cee("span",{},void 0,W()(t.dateAdded).format("ll"))));break;case"dateModified":r.push(cee("label",{className:"right-aligned"},n.id,!s&&cee("span",{},void 0,W()(t.dateModified).format("ll"))))}})):r.push(this.renderTitleRow(e)),r};menu={name:"noteslist",getCapability:this.getMenuCapability,getVisibility:this.getMenuVisibility};render(){if(!this.state.populated&&!this.props.filter)return null;const e=h7.ZP.getRootNode().id;return(0,ss.jsx)(Ps,{ref:this.refTreeList,rowComponent:this.rowComponent,getRowComponentProps:this.getRowComponentProps,nodes:this.state.nodes,cutIds:this.state.cutIds,settings:this.props.settings,rootId:e,buildItem:this.buildNode,onSelect:this.props.onItemSelected,onItemDoubleClick:this.onItemDoubleClick,onItemMouseDown:this.onItemMouseDown,onItemMouseUp:this.onItemMouseUp,onItemsActivated:this.onNodesActivated,onCreate:this.onCreate,onSearchStyleChanged:this.onSearchStyleChanged,delete:this.delete,onMove:this.onMove,onDrop:this.onDrop,onCut:this.handleCut,onCopy:this.handleCopy,supportsInlineEdit:!0,mimeType:h7.d0,getDropSupport:this.getDropSupport,getDragData:h7.ZP.getDragData,isFolder:this.isFolder,isSeparator:h7.ZP.isSeparator,hasChildren:this.hasChildren,menu:this.menu,setCutIds:zn.Z.setCutIds,getTitle:h7.ZP.getTitle,saveTitle:this.saveTitle,getTargetSpec:this.getTargetSpec,isValidAddTarget:this.isValidAddTarget,isValidDragSource:this.isValidDragSource,isValidToEdit:h7.ZP.validateForEdit,validateForDrag:h7.ZP.validateForDrag,validateForDeletion:h7.ZP.validateForDeletion,sorting:this.props.sorting,columns:this.props.columns})}}const hee=pee;var gee,mee;function fee(e,t,n,i){gee||(gee="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:gee,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function vee({onAddNote:e}){return fee("div",{className:"notes-welcome"},void 0,fee("div",{className:"note-empty-state",onClick:e},void 0,fee("span",{dangerouslySetInnerHTML:{__html:Wi.SXC}}),fee("h1",{},void 0,(0,B.Z)("Write your first note")),fee("p",{className:"faded-text"},void 0,(0,B.Z)("Click the “+” to create a new note, or select text on any webpage and create a note from the contextual menu."))))}function yee(e,t,n,i){mee||(mee="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:mee,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class bee extends Li.PureComponent{refSearch=Li.createRef();focusSearch(){this.refSearch.current&&this.refSearch.current.focus()}render(){const{editorLayout:e,filter:t,onFilterValueChange:n,onAddNote:i,onDeleteSelectedItems:s,onAddFolder:o,onSetLayout:a,isDeleteDisabled:r}=this.props;return yee("div",{className:"toolbar toolbar-default toolbar-small toolbar-wrap",role:"toolbar","aria-label":(0,B.Z)("toolbar label","Notes")},void 0,(0,ss.jsx)("input",{ref:this.refSearch,type:"search",className:"notesearch",placeholder:(0,B.Z)("verb","Search"),value:t,title:(0,B.Z)("Limit the search to address or content by $1 or $2",["URL:","CONTENT:"]),disabled:!this.props.hasNotes,onChange:({currentTarget:e})=>n(e.value)}),yee("div",{className:"toolbar",style:e?{flexGrow:1}:{}},void 0,yee("div",{className:"toolbar-group"},void 0,yee(po.ZP,{onClick:i,tooltip:(0,B.Z)("New Note"),image:Wi.md4.small}),yee(po.ZP,{onClick:s,tooltip:(0,B.Z)("other","Delete"),image:Wi.M2k.small,disabled:r})),yee("div",{className:"toolbar-group"},void 0,yee(po.ZP,{onClick:o,image:Wi._TQ.small,tooltip:(0,B.Z)("command","New Folder")})),e&&yee(po.ZP,{name:"MailViewLayout",className:"layout-toggle push-right",onClick:a,image:Wi.EVi.small,tooltip:(0,B.Z)("command","Toggle Layout"),style:{"--modeVerticalWide":0,"--modeVertical":"vertical"===e?1:0,"--modeHorizontal":"horizontal"===e?1:0}})))}}var See,wee=n(34155);function Cee(e,t,n,i){See||(See="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:See,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Aee=[{text:(0,B.Z)("Title"),value:"title",fullScreenTitle:(0,B.Z)("Sort by title"),width:300,visible:!0,key:!0},{text:(0,B.Z)("Content"),value:"content",icon:Wi.sWI,fullScreenTitle:(0,B.Z)("Sort by content"),width:300,visible:!1},{text:(0,B.Z)("Address"),value:"url",icon:Wi.iD7,fullScreenTitle:(0,B.Z)("Sort by address"),width:300,visible:!0},{text:(0,B.Z)("Date Created"),value:"dateAdded",icon:Wi.V_c,fullScreenTitle:(0,B.Z)("Sort by creation date"),width:120,visible:!0},{text:(0,B.Z)("Date Modified"),value:"dateModified",icon:Wi.JHW,fullScreenTitle:(0,B.Z)("Sort by last modified date"),width:120,visible:!0},{text:(0,B.Z)("Attachments"),value:"attachments",icon:Wi.onv,fullScreenTitle:(0,B.Z)("Sort by attachments"),width:60,visible:!0}],Iee=(0,Ae.Z)(Tee,h7.mS,{trailing:!0,leading:!1});function Tee({id:e,changes:t}){return new Promise(((n,s)=>{se.Z.notes.update(e,t,(()=>i.Z.runtime.lastError?s(i.Z.runtime.lastError):n()))}))}class Zee extends Li.PureComponent{static contextType=ts.Z;refBody=Li.createRef();_tree=Li.createRef();_treeWrapper=Li.createRef();constructor(e,t){super(e),this.winId=t.vivaldiWindowId;const n=C.Z.get(I.kNotesManagerSorting),i=C.Z.get(I.kNotesManagerLayout),s="horizontal"===i?"notes":"notes_vertical";this.state={filter:"",note:void 0,markdownScrollPosition:0,editorScrollPosition:0,isAttachmentPopupOpen:!1,editorCursorPosition:0,editorLayout:i,editLinkModal:!1,treeViewSize:"vertical"===i?C.Z.get(I.kNotesManagerTreeWidth):C.Z.get(I.kNotesManagerTreeHeight),sorting:{sortOrder:n.sortOrder,sortField:n.sortField,comparator:this.sortComparator},columns:vs()[s]||ys(Aee),showWelcome:!h7.ZP.hasNotes()}}componentDidMount(){const{selectWindow:e}=this.context;Ce.ZP.addListener(this._onPageStoreChange,e),this.props.id&&"-1"!==this.props.id&&wee.nextTick((()=>{this.selectById(this.props.id)}))}componentWillUnmount(){Ce.ZP.removeListener(this._onPageStoreChange)}_onPageStoreChange=()=>{const e=Ce.ZP.getActivePage(this.context.vivaldiWindowId);if(e&&e.id===this.props.pageId)wee.nextTick((()=>{const{note:e}=this.state;if(e){e.id!==this.props.id&&this.selectById(this.props.id);const t=tee(e);c.ZP.setTitle(this.props.pageId,this.winId,t)}this.refBody.current?.setActiveWebView()}));else{const e=this.refBody.current;e&&wee.nextTick(e.clearActiveWebViews)}};_onStoreChange=(e,t)=>{switch(e.reason){case"added":{if(this.setState({showWelcome:!1}),!t)return;const n=h7.ZP.getNodeById(e.id);return void this.setState({note:n},(()=>{if(n&&!h7.ZP.isSeparator(n))if(this.selectById(n.id),h7.ZP.isFolder(n)){const e=this._tree.current?.refTreeList.current;e?.startInlineEditForSelectedItem()}else this.refBody.current&&this.refBody.current.focus()}))}case"moved":e.id===this.state.note?.id&&this._tree?.current?.selectById(e.id);break;case"removed":e.id===this.state.note?.id&&this._tree?.current?.selectById(""),this.setState({showWelcome:!h7.ZP.hasNotes()});break;case"changed":if(!this.state.note||this.state.note.id!==e.id)return;this.setState({note:h7.ZP.getNodeById(this.props.id)});break;case"init":this.selectById(this.props.id),this.setState({note:h7.ZP.getNodeById(this.props.id),showWelcome:!h7.ZP.hasNotes()})}};selectById=e=>{this._tree.current?.selectById(e)};sortComparator=(e,t)=>{if("trash"===e.type)return 1;if("trash"===t.type)return-1;if(h7.ZP.isFolder(e)&&!h7.ZP.isFolder(t))return-1;if(h7.ZP.isFolder(t)&&!h7.ZP.isFolder(e))return 1;const{sortOrder:n,sortField:i}=this.state.sorting;if("title"===i)return this.sortByTitle(e,t,n);return ds.Z.getDefaultComparator(n,i)(e,t)};sortByTitle=(e,t,n)=>{if(n<=ds.Z.NO_SORTING)return 0;const i=e.title||tee(e),s=t.title||tee(t);return i||s?i?s?n===ds.Z.ASCENDING_SORT?i.toLowerCase().localeCompare(s.toLowerCase()):s.toLowerCase().localeCompare(i.toLowerCase()):n===ds.Z.ASCENDING_SORT?-1:1:n===ds.Z.ASCENDING_SORT?1:-1:0};onSortChange=(e,t)=>{this.setState((n=>({sorting:{...n.sorting,sortOrder:e,sortField:t}}))),w.Z.set(I.kNotesManagerSorting,{sortOrder:e,sortField:t})};onUpdateRow=e=>{this.setState({columns:e})};onSaveRow=()=>{fs(this.state.columns,"horizontal"===this.state.editorLayout?"notes":"notes_vertical")};onItemSelected=(0,Ae.Z)((e=>{if(!e&&!this.state.note)return;this.setState({note:e,markdownScrollPosition:0,editorScrollPosition:0,isAttachmentPopupOpen:!1,editorCursorPosition:0});const t=e?.id||"";c.ZP.openURL(this.context.vivaldiWindowId,pn.jk.internalUrl("notes",t),{inSpecificPageId:this.props.pageId})}),200);handleFilterChange=e=>{this.setState({filter:e})};onBeforeCreate=e=>{this.setState({filter:""})};onAddNote=()=>{this.refBody.current?.blur(),this._tree.current?.onAddNote()};onAddFolder=()=>{this._tree.current?.onAddFolder()};onDeleteSelectedItems=()=>{this.refBody.current?.blur(),this._tree.current?.deleteSelectedItems()};toggleFullEditor=()=>{this.setState((e=>{const t="vertical"===e.editorLayout?I.kNotesManagerTreeWidth:I.kNotesManagerTreeHeight;let n;return 0!==e.treeViewSize?(this.restoreSize=e.treeViewSize,n=0):n=this.restoreSize??C.Z.getDefault(t),w.Z.set(t,n),{treeViewSize:n}}))};onSlidebarPosition=(e,t)=>{if(!this._treeWrapper.current)return;const n=this._treeWrapper.current.getBoundingClientRect(),{width:i,height:s,top:o,left:a}=n,r="vertical"===this.state.editorLayout?(e-a)/i:(t-o)/s;this.setState((e=>({treeViewSize:Math.max(100*r,0)})))};onSlidebarStop=()=>{this.setState((e=>{const t="horizontal"===e.editorLayout?I.kNotesManagerTreeHeight:I.kNotesManagerTreeWidth,n=e.treeViewSize>5?e.treeViewSize:0;return w.Z.set(t,n),{treeViewSize:n}}))};updateNoteContent=(e,t)=>{this.setState((t=>t.note?{note:{...t.note,content:e}}:null),t),this.state.note&&Iee({id:this.state.note.id,changes:{content:e}})};onSaveLink=e=>{const{note:t}=this.state;t&&Tee({id:t.id,changes:{url:e}}),this.setState({editLinkModal:!1})};onCancelEditLink=()=>this.setState({editLinkModal:!1});onEditLink=()=>this.setState({editLinkModal:!0});toggleManagerLayout=()=>this.setState((e=>{const t="horizontal"===e.editorLayout?"vertical":"horizontal",n="horizontal"===t?C.Z.get(I.kNotesManagerTreeHeight):C.Z.get(I.kNotesManagerTreeWidth),i="horizontal"===t?"notes":"notes_vertical";return w.Z.set(I.kNotesManagerLayout,t),{editorLayout:t,treeViewSize:n,columns:vs()[i]||ys(Aee)}}));render(){const{note:e,editorLayout:t,showWelcome:n}=this.state,i=!!e&&h7.ZP.isFolder(e),s=e&&!i,o=!s&&!n;return(0,ss.jsxs)("div",{ref:this._treeWrapper,className:Fi()({"NotesManager manager":!0,"NotesManager--Horizontal":"horizontal"===t,"NotesManager--Vertical":"vertical"===t}),children:[this.state.editLinkModal&&Cee($T,{onCreateLink:this.onSaveLink,onCancelCreateLink:this.onCancelEditLink,anchorOrSelection:e?.url??"",isAnchor:!0,useAddress:!0}),Cee("div",{className:Fi()({"NotesManager-Tree":!0,"NotesManager-Tree--Collapsed":0===this.state.treeViewSize}),style:{flexBasis:`${this.state.treeViewSize}%`}},void 0,Cee(bee,{filter:this.state.filter,onFilterValueChange:this.handleFilterChange,onAddNote:this.onAddNote,onAddFolder:this.onAddFolder,onDeleteSelectedItems:this.onDeleteSelectedItems,onSetLayout:this.toggleManagerLayout,editorLayout:t,isDeleteDisabled:!this.state.note,hasNotes:h7.ZP.hasNotes()}),Cee("div",{className:"NotesManager-Tree-Container"},void 0,Cee(Mm,{fields:Aee,onSortChange:this.onSortChange,fullsize:!0,sortField:this.state.sorting.sortField,sortOrder:this.state.sorting.sortOrder,columns:this.state.columns,onUpdateRow:this.onUpdateRow,onSaveRow:this.onSaveRow,keyAccess:C.Z.get(I.kKeyboardTabToAll),manualSorting:!0},this.state.editorLayout),(0,ss.jsx)(hee,{ref:this._tree,settings:`NOTES_MANAGER_TREE_${this.props.pageId}`,filter:this.state.filter,sorting:this.state.sorting,onItemSelected:this.onItemSelected,onStoreChange:this._onStoreChange,onBeforeCreate:this.onBeforeCreate,editLink:this.onEditLink,columns:this.state.columns,noteId:this.state.note?this.state.note.id:"-1",pageId:this.props.pageId,fullView:!0}))),n&&Cee(vee,{onAddNote:this.onAddNote}),Cee("div",{className:o?"NotesManager-EmptyPlaceholder":"NotesManager-Note",onClick:o?this.onAddNote:null},void 0,Cee(Zm.Z,{onSlidebarPosition:this.onSlidebarPosition,onStop:this.onSlidebarStop,onDoubleClick:this.toggleFullEditor,position:"vertical"===t?"right":"bottom"}),s&&(0,ss.jsx)(dee,{ref:this.refBody,inFullView:this.state.treeViewSize>0,note:this.state.note,pageId:this.props.pageId,isFolder:i,toggleFullEditor:this.toggleFullEditor,updateNoteContent:this.updateNoteContent,isActive:this.props.isActive}),o&&(0,B.Z)("Add a new note"))]})}}var Eee;function kee(e){Li.useContext(ts.Z);const[t,n]=Li.useState(!1),[i,s]=Li.useState(!1);return null}function _ee(e,t,n,i){Eee||(Eee="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Eee,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Nee="category__",Pee=[(0,B.Z)("Popular Sites"),(0,B.Z)("Travel"),(0,B.Z)("Shopping"),(0,B.Z)("Gaming"),(0,B.Z)("Social"),(0,B.Z)("Finance"),(0,B.Z)("News"),(0,B.Z)("Education"),(0,B.Z)("Sport"),(0,B.Z)("Streaming"),(0,B.Z)("Food"),(0,B.Z)("Health"),(0,B.Z)("Parenting"),(0,B.Z)("Books"),(0,B.Z)("Photography"),(0,B.Z)("Tools")],Dee=["popular_sites","travel","shopping","gaming","social","finance","news","education","sport","streaming","food","health","parenting","books","photography","tools"];const Mee=function({nodeLinks:e,onSetCategory:t,addSpeedDial:n,categoryOverride:i}){const s=Li.createRef(),o=Li.createRef(),[a,r]=Li.useState(null),[l,d]=Li.useState("number"==typeof i?i:-1);Li.useEffect((()=>{(async function(){const e=(await pn.jk.getDirectMatchPopularSites()).reduce(((e,t,n)=>{n<10&&(e[0]||(e[0]=[]),e[0].push(t));const i=t.category;return i>Pee.length||(e[i]||(e[i]=[]),e[i].push(t)),e}),{});return Object.entries(e).map((([e,t])=>({category:parseInt(e),bookmarks:t})))})().then((e=>r(e)))}),[]);const c=(e,t)=>{const n=s.current;if(n){return aw(e,t,Array.from(n.querySelectorAll("button.dial")),Pee.length)}return!1},u=(e,t)=>{const n=o.current;if(n){return aw(e,t,Array.from(n.querySelectorAll("button.dial")),Math.floor((n.clientWidth+6)/96))}return!1},p=-1===l;return a?.length?(0,ss.jsxs)(ss.Fragment,{children:[_ee("section",{className:"drawer-categories",style:p?void 0:{display:"none"}},void 0,_ee("h2",{},void 0,(0,B.Z)("Categories")),(0,ss.jsx)("div",{className:"dials dial-suggestions",ref:s,children:a.filter((e=>0!==e.category&&e.bookmarks.length>=4)).map(((e,n)=>{const i=Pee[e.category]||"",s=Dee[e.category]||"";return _ee("button",{className:`dial ${s}`,onClick:()=>{d(e.category),t(!0)},onKeyDown:t=>((e,t)=>{switch(t.key){case"ArrowLeft":c(e,"left"),(0,ms.ZP)(t);break;case"ArrowRight":c(e,"right"),(0,ms.ZP)(t);break;default:return}})(Nee+e.category,t),tabIndex:0===n?"0":"-1","data-id":Nee+e.category},e.category,_ee("img",{src:`../../resources/dm_${s}.svg`,alt:""}),_ee("span",{},void 0,i))}))})),!p&&_ee("section",{className:"drawer-suggestions"},void 0,a.map((t=>{if(t.category===l)return _ee(Li.Fragment,{},t.category,_ee("h2",{},void 0,Pee[t.category]),(0,ss.jsx)("div",{className:"dials dial-suggestions",ref:o,children:t.bookmarks.map(((i,s)=>_ee("button",{className:Fi()("dial",{disabled:e.includes(i.redirect_url)}),"data-id":i.redirect_url,tabIndex:0===s?"0":"-1",autoFocus:0!==t.category&&0===s,onClick:e.includes(i.redirect_url)?void 0:()=>n(i.name,i.redirect_url),onKeyDown:e=>((e,t)=>{switch(t.key){case"ArrowLeft":u(e,"left"),(0,ms.ZP)(t);break;case"ArrowRight":u(e,"right"),(0,ms.ZP)(t);break;case"ArrowUp":u(e,"up"),(0,ms.ZP)(t);break;case"ArrowDown":u(e,"down"),(0,ms.ZP)(t);break;default:return}})(i.redirect_url,e)},i.redirect_url,_ee("div",{className:"dial-image"},void 0,_ee("img",{width:"32",height:"32",src:i.image_path,alt:""})),_ee("div",{className:"dial-title"},void 0,i.name))))}))})),0!==i&&_ee("input",{type:"button",className:"back",onClick:()=>{d(-1),t(!1)},value:(0,B.Z)("navigation","Back")}))]}):null};var Oee;function xee(e,t,n,i){Oee||(Oee="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Oee,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Lee=({nodeLinks:e,nodeId:t,keyAccess:n,onSpeedDialDrawerDone:i})=>{const s=Li.useContext(ts.Z),o=Li.createRef(),[a,r]=Li.useState([]),l=Li.useCallback((()=>{he.ZP.isIncognitoOrGuest(s.vivaldiWindowId)||(0,Qb.Z)().then((t=>{const n=t.filter((t=>!e.includes(t.url)));r(n)}))}),[s.vivaldiWindowId,e]);Li.useEffect((()=>{l()}),[l]);const d=e=>{e.preventDefault()},c=(e,t)=>{const{HTMLElement:n}=s,i=o.current;if(i instanceof n){return aw(e,t,Array.from(i.querySelectorAll("button.dial")),Math.floor((i.clientWidth-36)/90))}return!1},u=he.ZP.isIncognito(s.vivaldiWindowId);return(0,ss.jsxs)("section",{ref:o,className:"drawer-suggestions",children:[xee("header",{},void 0,xee("h2",{},void 0,(0,B.Z)("Frequently Visited"))),u?xee("p",{},void 0,(0,B.Z)("Frequently visited suggestions are not available in private window.")):a.length>0?xee("div",{className:"dials dial-suggestions"},void 0,a.map(((e,s)=>{const o=s.toString();return xee("button",{className:"dial",tabIndex:0===s?"0":n,"data-id":o,title:e.title+"\n"+e.url,onMouseDown:d,onMouseUp:d,onKeyDown:e=>((e,t)=>{switch(t.key){case"ArrowLeft":c(e,"left");break;case"ArrowRight":c(e,"right");break;case"ArrowUp":c(e,"up");break;case"ArrowDown":c(e,"down");break;default:return}t.preventDefault(),t.stopPropagation()})(o,e),onClick:n=>((e,n)=>{if(t){const s={parentId:t,title:e,url:(0,rl.q9)(n)};i(s)}else i()})(e.title,e.url),"data-dialurl":e.url},s,xee("div",{className:"dial-image suggest-thumbnail-image"},void 0,xee(Ri.ZP,{url:e.url,size:32,loadType:"page"})),xee("div",{className:"dial-title"},void 0,e.title))}))):xee("p",{},void 0,(0,B.Z)("No history to choose from yet."))]})};var Ree;function Bee(e,t,n,i){Ree||(Ree="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Ree,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function Fee(e){const t=e.trim();return!!(0,rl.K2)((0,rl.q9)(t))||!(0,rl.Zj)(t)}const Wee=function({node:e,keyAccess:t,onSpeedDialDrawerDone:n}){const i=Li.useMemo((()=>crypto.randomUUID()),[]),s={},[o,a]=Li.useState(""),[r,l]=Li.useState(""),[d,c]=Li.useState(!1),[u,p]=Li.useState(!1),h=Oi.Z.isEnabled("omnibox");Li.useEffect((()=>{const e=()=>{const{autocompleteValue:e,typedUrl:t}=Rv.getUrlfieldState(i),n=e||t||"";l(t||""),c(Fee(n))},t=()=>{const{autocompleteValue:e,typedUrl:t}=rb.getUrlfieldState(i),n=e||t||"";l(t||""),c(Fee(n))};return h?(Rv.addListener(e,(e=>e.get(i))),()=>{Rv.removeListener(e),Ov.Z.reset(i)}):(rb.addListener(t,(e=>e.get(i))),()=>{rb.removeListener(t),sb.reset(i)})}),[i,h]);const g=(t,s,o=!0)=>{if(e&&e.id){const a={parentId:e.id,title:t,url:(0,rl.q9)(s),thumbnail:void 0};h?Ov.Z.reset(i):sb.reset(i),n(a,o)}},m=()=>{n()},f=(()=>{const t=[];return e?.children&&e.children.forEach((e=>{e.url?t.push(e.url):Array.isArray(e.children)&&e.children.forEach((e=>{e.url&&t.push(e.url)}))})),t})();return Bee(ra.Z,{onRequestClose:m,className:"startpage-drawer"},void 0,Bee("button",{className:"close",tabIndex:"-1",dangerouslySetInnerHTML:{__html:Wi.kze},onClick:m}),!u&&Bee("section",{className:"drawer-adddial"},void 0,Bee("header",{},void 0,Bee("h2",{},void 0,(0,B.Z)("Add Bookmark to Speed Dial"))),Bee("form",{className:"drawer-addform",onSubmit:e=>{e.stopPropagation(),e.preventDefault();const{autocompleteValue:t}=h?Rv.getUrlfieldState(i):rb.getUrlfieldState(i);let n=(t||r||"").trim();if(n=(0,rl.q9)(n),0===n.length)return;const s=o||(e=>e.startsWith("file://")?e.replace(/^file:\/\//,""):e.replace(/^[a-zA-Z0-9+-.]+:\/\/(www\.)?/,""))(n);g(s,n,!1)}},void 0,Bee("span",{},void 0,(0,B.Z)("Address")),Bee(h?ib:ZS,{pageId:i,pageContext:s,autoFocus:!0,autocompletionEnabled:!1,typedHistoryEnabled:!1,className:"address",displayUrl:"",typedUrl:r,handleDrop:!0,title:(0,B.Z)("Enter page address"),showDropdown:!1,placeholder:"https://vivaldi.com",inputId:i}),Bee("span",{},void 0,(0,B.Z)("Title")),Bee("input",{type:"text",name:"title",className:"title",value:o,onChange:e=>a(e.currentTarget.value)}),Bee("span",{className:"controls"},void 0,Bee("input",{className:"add-dial-submit primary",type:"submit",disabled:!d,value:(0,B.Z)("Add")}),Bee("button",{type:"button",className:"FormButton",onClick:t=>{if(e){const t={parentId:e.id,title:o||(0,B.Z)("title","New Folder")};n(t)}},dangerouslySetInnerHTML:{__html:Wi._TQ.small+(0,B.Z)("command","New Folder")}})))),!u&&Bee(Mee,{categoryOverride:0,onSetCategory:p,addSpeedDial:g,nodeLinks:f}),Bee(Mee,{onSetCategory:p,addSpeedDial:g,nodeLinks:f}),!u&&Bee(Lee,{onSpeedDialDrawerDone:n,keyAccess:t,nodeId:e?.id,nodeLinks:f}))};var Uee;function Vee(e,t,n,i){Uee||(Uee="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Uee,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Hee=[I.kDashboardColumnLimit,I.kDashboardEnabled,I.kMailIsTurnedOff,I.kStartpageNavigation,I.kStartpageSpeedDialAddButtonVisible,I.kStartpageSpeedDialColumns,I.kStartpageSpeedDialDeleteVisible,I.kStartpageSpeedDialDisplaySearch,I.kStartpageSpeedDialGameButtonShow,I.kStartpageSpeedDialPrivacyStatsShow,I.kStartpageSpeedDialRestorePage,I.kStartpageSpeedDialSize,I.kStartpageSpeedDialTitlesVisible,I.kThemesSystem,I.kThemesUser],Gee={...eJ,"":(0,B.Z)("No Image")};var $ee=Vee(co,{type:"close",size:16}),Kee=Vee(co,{type:"checkmark"}),zee=Vee("hr",{}),jee=Vee("hr",{}),Yee=Vee("option",{value:1},void 0,"1"),Xee=Vee("option",{value:2},void 0,"2"),Qee=Vee("option",{value:3},void 0,"3"),qee=Vee("option",{value:4},void 0,"4"),Jee=Vee("option",{value:5},void 0,"5"),ete=Vee("option",{value:6},void 0,"6"),tte=Vee("option",{value:7},void 0,"7"),nte=Vee("option",{value:8},void 0,"8"),ite=Vee("option",{value:10},void 0,"10"),ste=Vee("option",{value:12},void 0,"12"),ote=Vee("hr",{}),ate=Vee("option",{value:1},void 0,"1"),rte=Vee("option",{value:2},void 0,"2"),lte=Vee("option",{value:3},void 0,"3"),dte=Vee("option",{value:4},void 0,"4"),cte=Vee(co,{size:16,type:"settings"});function ute(e){const t=(0,Ya.Z)(Hee),{vivaldiWindowId:n}=Li.useContext(ts.Z),i=w.Z.getEventHandler,[s,o]=Li.useState(!!e.startOpened),[a,r]=Li.useState(Gee),[l,d]=Li.useState(ki.Z.getCurrentIdWithoutPreview(n)),[u,p]=Li.useState(Cs.ZP.getThemeWithFallback(l)),[h,g]=Li.useState(!1);Li.useEffect((()=>{function e(){const e=ki.Z.getCurrentIdWithoutPreview(n);d(e),p(Cs.ZP.getThemeWithFallback(e))}return Be.Z.addListener(e),()=>Be.Z.removeListener(e)}),[n]),Li.useEffect((()=>{const e=t[I.kThemesSystem].concat(t[I.kThemesUser]).reduce(((e,t)=>{const n=t.backgroundImage,i=[...Object.keys(e),...Object.keys(Gee)];return n&&!i.includes(n)&&n!==Xq&&(e[n]=(0,B.Z)("From $1",[t.name])),e}),{});r({...Gee,...e})}),[t]),Li.useEffect((()=>{const e=()=>o(!1);return s&&Ke.Z.bind("esc",e),()=>{Ke.Z.unbind("esc",e)}}),[s]),Li.useEffect((()=>{(0,SC.pg)("tracking",(e=>{e.trackerBlockingEnabled&&g(!0)})),(0,SC.pg)("ad_blocking",(e=>{e.adBlockingEnabled&&g(!0)}))}),[]);const m=e=>{const t=function(e){return Cs.ZP.getSystemThemes().some((t=>t.id===e))?I.kThemesSystem:I.kThemesUser}(l);(0,cr.kz)(t,(t=>{const n=t.findIndex((e=>e.id===l));-1!==n&&(t[n].backgroundImage=e)}))};return(0,ss.jsxs)(ss.Fragment,{children:[s&&Vee(za.Z,{focusName:"focus-speeddial-settings"},void 0,Vee("div",{className:Fi()("SpeedDialView-Settings",{"navigation-title":"off"!==C.Z.get(I.kStartpageNavigation)}),onDoubleClick:ms.ZP,role:"dialog","aria-labelledby":"speeddial-settings-title",id:"speeddial-settings-pane"},void 0,Vee("div",{className:"SpeedDialView-Settings-Head"},void 0,Vee("h1",{id:"speeddial-settings-title"},void 0,(0,B.Z)("Quick Settings")),Vee("button",{className:"close",onClick:()=>o(!1),label:(0,B.Z)("Close"),tabIndex:C.Z.get(I.kKeyboardTabToAll)},void 0,$ee)),Vee("div",{className:"SpeedDialView-Settings-BackgroundImages"},void 0,Vee("h2",{},void 0,(0,B.Z)("Background Images")),Vee("div",{className:"images"},void 0,Object.keys(a).sort().map((e=>Vee("button",{title:a[e],className:Fi()("selectbox",{"selectbox-selected":e===u.backgroundImage}),onClick:()=>m(e)},e,Vee("div",{className:"selectbox-image",style:{backgroundColor:""===e?u.colorWindowBg:void 0,backgroundImage:`url(${e})`}},void 0,Kee))))),Vee("div",{className:"actions"},void 0,Vee("a",{href:"https://themes.vivaldi.net",onClick:()=>c.ZP.openURL(n,"https://themes.vivaldi.net")},void 0,(0,B.Z)("Get More Background Images")),Vee("input",{type:"button",value:(0,B.Z)("Select Image..."),title:(0,B.Z)("Select Background Image"),onClick:()=>{se.Z.utilities.selectLocalImage({title:(0,B.Z)("Select Background Image"),themeId:l,windowId:n})}}))),zee,Vee("div",{className:"SpeedDialView-Settings-StartPage"},void 0,Vee("h2",{},void 0,(0,B.Z)("title","Start Page")),Vee("div",{className:"row"},void 0,Vee("label",{htmlFor:"navigationToggle"},void 0,(0,B.Z)("Start Page Navigation")),Vee(ta.Z,{id:"navigationToggle",value:t[I.kStartpageNavigation],onChange:i(I.kStartpageNavigation)},void 0,Vee("option",{value:"on"},void 0,(0,B.Z)("Show on Internal Pages")),Vee("option",{value:"speed_dial_only"},void 0,(0,B.Z)("Show on Speed Dial and Dashboard")),Vee("option",{value:"off"},void 0,(0,B.Z)("radio","Hide")))),Vee("div",{className:"row"},void 0,Vee("label",{htmlFor:"privacyStatsToggle"},void 0,(0,B.Z)("Reopen Speed Dial with Last Selected Group")),Vee(FL,{inputId:"privacyStatsToggle",checked:t[I.kStartpageSpeedDialRestorePage],onChange:i(I.kStartpageSpeedDialRestorePage)})),Vee("div",{className:"row"},void 0,Vee("label",{htmlFor:"searchFieldToggle"},void 0,(0,B.Z)("Search Field")),Vee(FL,{inputId:"searchFieldToggle",checked:t[I.kStartpageSpeedDialDisplaySearch],onChange:i(I.kStartpageSpeedDialDisplaySearch)})),h&&Vee("div",{className:"row"},void 0,Vee("label",{htmlFor:"privacyStatsToggle"},void 0,(0,B.Z)("Privacy Statistics")),Vee(FL,{inputId:"privacyStatsToggle",checked:t[I.kStartpageSpeedDialPrivacyStatsShow],onChange:i(I.kStartpageSpeedDialPrivacyStatsShow)})),Vee("div",{className:"row"},void 0,Vee("label",{htmlFor:"gameToggle"},void 0,(0,B.Z)("Vivaldia Game")),Vee(FL,{inputId:"gameToggle",checked:t[I.kStartpageSpeedDialGameButtonShow],onChange:i(I.kStartpageSpeedDialGameButtonShow)}))),jee,Vee("div",{className:"SpeedDialView-Settings-Appearance"},void 0,Vee("h2",{},void 0,(0,B.Z)("Speed Dial Appearance")),Vee("div",{className:"row"},void 0,Vee("label",{className:"dropdown",htmlFor:"thumbnailSelect"},void 0,(0,B.Z)("Thumbnail Size")),Vee(ta.Z,{id:"thumbnailSelect",value:t[I.kStartpageSpeedDialSize],onChange:i(I.kStartpageSpeedDialSize)},void 0,Array.from(Hz).map((([e,{label:t}])=>Vee("option",{value:e},e,t))))),Vee("div",{className:"row"},void 0,Vee("label",{className:"dropdown",htmlFor:"maxColumnSelect"},void 0,(0,B.Z)("Maximum Columns")),Vee(ta.Z,{id:"maxColumnSelect",value:t[I.kStartpageSpeedDialColumns],onChange:i(I.kStartpageSpeedDialColumns),title:(0,B.Z)("Maximum number of Speed Dial columns")},void 0,Yee,Xee,Qee,qee,Jee,ete,tte,nte,ite,ste,Vee("option",{value:99},void 0,(0,B.Z)("Unlimited")))),Vee("div",{className:"row"},void 0,Vee("label",{className:"dropdown",htmlFor:"titleSelect"},void 0,(0,B.Z)("Speed Dial Title")),Vee(ta.Z,{id:"titleSelect",value:t[I.kStartpageSpeedDialTitlesVisible],onChange:i(I.kStartpageSpeedDialTitlesVisible)},void 0,Vee("option",{value:"always"},void 0,(0,B.Z)("verb","Show")),Vee("option",{value:"hover"},void 0,(0,B.Z)("Show on Hover")),Vee("option",{value:"never"},void 0,(0,B.Z)("verb","Hide")))),Vee("div",{className:"row"},void 0,Vee("label",{htmlFor:"addButtonToggle"},void 0,(0,B.Z)("Show Add Button")),Vee(FL,{inputId:"addButtonToggle",checked:t[I.kStartpageSpeedDialAddButtonVisible],onChange:i(I.kStartpageSpeedDialAddButtonVisible)})),Vee("div",{className:"row"},void 0,Vee("label",{htmlFor:"deleteButtonToggle"},void 0,(0,B.Z)("Show Delete Button")),Vee(FL,{inputId:"deleteButtonToggle",checked:t[I.kStartpageSpeedDialDeleteVisible],onChange:i(I.kStartpageSpeedDialDeleteVisible)}))),ote,Vee("div",{className:"SpeedDialView-Settings-Dashboard"},void 0,Vee("h2",{},void 0,(0,B.Z)("Dashboard")),Vee("div",{className:"row"},void 0,Vee("label",{htmlFor:"dashboardToggle"},void 0,(0,B.Z)("Enable Dashboard")),Vee(FL,{inputId:"dashboardToggle",checked:t[I.kDashboardEnabled],onChange:Z})),Vee("div",{className:"row"},void 0,Vee("label",{htmlFor:"dashboardColumns"},void 0,(0,B.Z)("Maximum Columns")),Vee(ta.Z,{id:"dashboardColumns",className:"max-columns",value:t[I.kDashboardColumnLimit],onChange:i(I.kDashboardColumnLimit),title:(0,B.Z)("Maximum number of Dashboard columns")},void 0,ate,rte,lte,dte))),Vee("div",{className:"toolbar toolbar-default SpeedDial-Show-Settings"},void 0,Vee(po.ZP,{label:(0,B.Z)("Start Page Settings"),title:(0,B.Z)("Open Start Page Settings"),onClick:()=>{de.Z.showSettings(n,"startpage"),o(!1)},image:Wi.bqs.small,className:"button-show-setting",tabIndex:-1})))),Vee("button",{className:"SpeedDialView-Settings-Button",onClick:()=>o(!0),title:(0,B.Z)("Show Start Page Settings"),label:(0,B.Z)("Start Page Settings"),"aria-expanded":s,"aria-haspopup":"dialog","aria-controls":"speeddial-settings-pane",tabIndex:C.Z.get(I.kKeyboardTabToAll)},void 0,cte)]})}const pte={click:function(){},repeat:function(e=2){}},hte=pte;var gte,mte=n(34844);function fte(e,t,n,i){gte||(gte="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:gte,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var vte,yte=fte(w3,{src:"",className:"thumbnail-folder-image",isFolder:!0});function bte(e){const{bookmark:t}=e,n=Array.isArray(t.children)&&0===t.children.length,i=Boolean(t.thumbnail);return fte("div",{className:Fi()("thumbnail-image",{"drop-hover":e.canDrop}),title:t.url,onPointerEnter:e.onPointerEnter,onPointerLeave:e.onPointerLeave,onPointerDown:e.onPointerDown,onPointerUp:e.onPointerUp,onPointerCancel:e.onPointerCancel,onDoubleClick:ms.ZP,onDragOver:e.onDragOver,onDragLeave:e.onDragLeave,onDrop:e.onDrop},t.id,n&&!i&&yte,!n&&!i&&fte("div",{className:"preview"},void 0,function(e,t){const{children:n=[]}=e,i=[];for(let s=0;s<Math.min(n.length,4);s++){const o=n[s];i.push(fte(w3,{src:o.thumbnail?o.thumbnail:"",className:"Mini-Thumbnail",onImageLoadError:t,isFolder:!!o.children},`thumb__${e.id}__${s}`))}return i}(t,e.onImageLoadError)),i&&fte(w3,{className:"thumbnail-folder-image",src:t.thumbnail,onImageLoadError:e.onImageLoadError}))}function Ste(e,t,n,i){vte||(vte="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:vte,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var wte=Ste(w3,{src:"",isFolder:!0});function Cte(e){const{bookmark:t}=e,n=Boolean(t.children);return"icon"===e.speedDialSize?n?Ste("div",{className:Fi()("thumbnail-favicon-folder",{"drop-hover":e.canDrop}),title:t.url,onPointerEnter:e.onPointerEnter,onPointerLeave:e.onPointerLeave,onPointerDown:e.onPointerDown,onPointerUp:e.onPointerUp,onPointerCancel:e.onPointerCancel,onDoubleClick:ms.ZP,onDragOver:e.onDragOver,onDragLeave:e.onDragLeave,onDrop:e.onDrop},t.id,t.children&&0===t.children.length?wte:function(e,t=[]){const n=[];for(let i=0;i<Math.min(t.length,4);i++){const s=t[i],{url:o=""}=s;n.push(Ste(Ri.ZP,{className:"favicon",url:s.faviconUrl||pn.jk.getFavicon(o)||o,loadType:s.faviconUrl?"faviconFromCache":"page"},`thumb__${e}__${i}`))}return n}(t.id,t.children)):Ste("div",{className:"thumbnail-favicon",onPointerEnter:e.onPointerEnter,onPointerLeave:e.onPointerLeave,onPointerDown:e.onPointerDown,onPointerUp:e.onPointerUp},void 0,Ste(Ri.ZP,{className:"favicon",url:e.faviconUrl,loadType:e.faviconLoadType,size:32})):n?Ste(bte,{bookmark:t,canDrop:e.canDrop,onPointerEnter:e.onPointerEnter,onPointerLeave:e.onPointerLeave,onPointerDown:e.onPointerDown,onPointerUp:e.onPointerUp,onImageLoadError:e.onImageLoadError,onPointerCancel:e.onPointerCancel,onDragOver:e.onDragOver,onDragLeave:e.onDragLeave,onDrop:e.onDrop}):Ste(w3,{onPointerEnter:e.onPointerEnter,onPointerLeave:e.onPointerLeave,onPointerDown:e.onPointerDown,onPointerUp:e.onPointerUp,src:t.thumbnail,title:t.title?t.title:t.url?se.Z.utilities.urlToThumbnailText(t.url):"",backgroundColor:t.themeColor||void 0,onImageLoadError:e.onImageLoadError},t.id)}var Ate,Ite=n(34155);function Tte(e,t,n,i){Ate||(Ate="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Ate,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class Zte extends Li.PureComponent{static contextType=ts.Z;bookmarkActions=this.props.bookmarkActions||ee.Z;nodeRef=Li.createRef();refInput=Li.createRef();state={isEditing:this.props.needsInitialEdit,title:this.props.bookmark.title,fallbackTitle:this.props.bookmark.title};componentDidMount(){this.state.isEditing&&this._focusInput()}componentDidUpdate(e,t){!1===e.needsInitialEdit&&!0===this.props.needsInitialEdit&&!1===this.state.isEditing&&this.enableEditing(),!1===t.isEditing&&!0===this.state.isEditing&&this._focusInput()}_documentClickHandler=e=>{const t=this.nodeRef.current,n=e.target,{document:i,HTMLElement:s}=this.context;t&&n instanceof s&&!t.contains(n)?this.refInput.current?.blur():i.removeEventListener("click",this._documentClickHandler)};_focusInput(){const e=this.refInput.current,t=e?.value;e&&t&&(e.setSelectionRange(0,t.length),e.focus())}enableEditing(){if(!1===this.state.isEditing&&this.props.bookmark.id!==f.N4){const{document:e}=this.context;e.addEventListener("click",this._documentClickHandler),this.setState({isEditing:!0})}}isTopSite(){return g.Z.isTopSite(this.props.bookmark.id)}handleClick=e=>{(0,ms.ZP)(e),"click"!==this.props.howToEdit?this.props.onSelect&&this.props.onSelect(e):Ite.nextTick((()=>this.enableEditing()))};handleDoubleClick=e=>{"doubleClick"===this.props.howToEdit&&this.enableEditing()};finishEdit(e){if(!1===this.state.isEditing)return;const{document:t}=this.context;t.removeEventListener("click",this._documentClickHandler),this.props.needsInitialEdit&&this.props.setSpeedDialAwaitingEdit("");const n=this.props.bookmark.id;switch(e){case"save":this.setState({isEditing:!1},(()=>{i.Z.bookmarks.update(n,{title:this.state.title}).then((()=>{this.props.onFinished&&this.props.onFinished(!1)}))}));break;case"undo":this.setState((e=>({title:e.fallbackTitle,isEditing:!1})),(()=>{i.Z.bookmarks.update(n,{title:this.state.title}).then((()=>{this.props.onFinished&&this.props.onFinished(!1)}))}));break;case"delete":this.setState({isEditing:!1},(()=>{this.props.onFinished&&this.props.onFinished(!0),this.bookmarkActions.remove([n])}))}}handleBlur=e=>{this.finishEdit("save")};handleChange=e=>{const t=e.target.value;this.setState({title:t})};handleKeyDown=e=>{switch(e.stopPropagation(),e.key){case"Enter":this.finishEdit("save");break;case"Escape":{const e=this.props.bookmark.children??[];this.props.needsInitialEdit&&this.state.title===g.Z.getDefaultFolderName()&&0===e.length?this.finishEdit("delete"):this.finishEdit("undo");break}}};removeSpeedDial=()=>{const e=g.Z.getItemById(this.props.bookmark.id);e&&ee.Z.removeSpeeddialGroup(e)};onContextMenu=e=>{this.state.isEditing?e.stopPropagation():(e.persist(),e.preventDefault(),e.stopPropagation(),this.props.getContextMenuItemsPromise(this.props.bookmark).then((t=>{(0,cs.Z)(this.context,t)(e)})))};render(){const e=Fi()({"editable-title-container":!0,edit:this.state.isEditing});return(0,ss.jsx)("span",{ref:this.nodeRef,className:e,onBlur:ms.UW,onFocus:ms.UW,onContextMenu:this.onContextMenu,draggable:!this.state.isEditing&&(this.props.draggable??!1),onDragEnter:this.props.onDragEnter??Lr.Z,onDragOver:this.props.onDragOver??Lr.Z,onDragStart:this.props.onDragStart??Lr.Z,onDragEnd:this.props.onDragEnd??Lr.Z,onDrop:this.props.onDrop??Lr.Z,children:this.state.isEditing?(0,ss.jsx)("input",{type:"text",ref:this.refInput,className:"sd-title-editor",value:this.state.title,onBlur:this.handleBlur,style:this.props.style,onKeyDown:this.handleKeyDown,onPointerUp:ms.ZP,onChange:this.handleChange,autoFocus:!0}):Tte("button",{className:this.props.className,"data-id":this.props.bookmark.id,tabIndex:this.props.keyAccess,onClick:this.handleClick,onDoubleClick:this.handleDoubleClick,onPointerUp:ms.ZP,title:this.props.bookmark.title,onKeyDown:this.props.onKeyDown?this.props.onKeyDown.bind(this,this.props.bookmark.id):void 0},void 0,this.props.bookmark.title)})}}const Ete=Zte;var kte,_te=n(34155);function Nte(e,t,n,i){kte||(kte="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:kte,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Pte=new Set;var Dte=Nte(Ki,{rightMargin:0,className:"favicon"});class Mte extends Li.PureComponent{static contextType=ts.Z;nodeRef=Li.createRef();refTitle=Li.createRef();focusedElement=null;_hasClipboardListener=!1;_customThumbnail=!1;state={canDrop:!1,isHovered:!1};componentWillUnmount(){this.disableClipboardListener(),Ho.unlinkBookmarkComponent(this)}componentDidUpdate(e){this.props.highlight&&!e.highlight&&hte.click()}isFolder(){return!this.props.node.url}isBookmark(){return!this.isFolder()}handleRemoveDial=()=>{const e=(0,Ra.sT)(this.context.document,this.nodeRef.current)?this.props.getNextFocusable(this.props.node.id):"";this.props.bookmarkActions.remove([this.props.node.id]).then((()=>{e&&this.props.moveFocus(e,"current")}))};enableClipboardListener=()=>{if(this._hasClipboardListener)return;this._hasClipboardListener=!0;const{document:e}=this.context;e.addEventListener("cut",this.onCut),e.addEventListener("copy",this.onCopy),e.addEventListener("paste",this.onPaste)};disableClipboardListener=()=>{if(!this._hasClipboardListener)return;this._hasClipboardListener=!1;const{document:e}=this.context;e.removeEventListener("cut",this.onCut),e.removeEventListener("copy",this.onCopy),e.removeEventListener("paste",this.onPaste)};handleCutDial=()=>{const{document:e}=this.context,t=this._hasClipboardListener;t||e.addEventListener("cut",this.onCut),e.execCommand("cut"),t||e.removeEventListener("cut",this.onCut)};handleCopyDial=()=>{const{document:e}=this.context,t=this._hasClipboardListener;t||e.addEventListener("copy",this.onCopy),e.execCommand("copy"),t||e.removeEventListener("copy",this.onCopy)};handlePasteDial=()=>{const{document:e}=this.context,t=this._hasClipboardListener;t||e.addEventListener("paste",this.onPaste),e.execCommand("paste"),t||e.removeEventListener("paste",this.onPaste)};handleRename=()=>{this.refTitle.current?.enableEditing()};onRenameFinished=e=>{e?_te.nextTick((()=>{this.props.moveFocus("add","current")})):this.props.moveFocus(this.props.node.id,"current")};handleEdit=()=>{de.Z.showBookmarkDialog(this.context.vivaldiWindowId,{mode:"edit",id:this.props.node.id,index:-1})};handleUpdateThumbnail=()=>{this.props.node.url&&Ho.updateForBookmark(this.props.node.id,this.props.node.url)};handleSetCustomThumbnail=()=>{se.Z.utilities.selectLocalImage({windowId:this.context.vivaldiWindowId,title:(0,B.Z)("Select Custom Image"),thumbnailBookmarkId:this.props.node.id})};handleClearCustomThumbnail=()=>{this.props.bookmarkActions.update(this.props.node.id,{thumbnail:""})};onThumbnailImageLoadError=e=>{e&&!(0,rl.Li)(e)&&se.Z.bookmarksPrivate.isCustomThumbnail(this.props.node.id,(t=>{e===this.props.node.thumbnail&&(t||Pte.has(e)||(Pte.add(e),this.props.node.url&&Ho.updateForBookmark(this.props.node.id,this.props.node.url)))}))};openSpeedDialNodeHandler=e=>{const t=this.context.vivaldiWindowId,n=(0,La.wJ)(t,e);e.button,es.Z.kCenter,n&&n.inNewWindow?xi.Z.openBrowserWindow(t,this.props.node.url,{incognito:!1,transition:se.Z.historyPrivate.TransitionType.AUTO_BOOKMARK}):void 0!==n&&(e.stopPropagation(),this.openSpeedDialNode(this.props.node,{openInBackground:n.inBackground,openInNewTab:!n.inCurrent}),u.Z.clearStatus(t))};openSpeedDialNode=(e,t)=>{this.props.openSpeedDialNode(e,t)};handleThumbnailPointerEnter=()=>{const{node:e}=this.props,{children:t}=e,n=t?(0,B.Z)("$1 Folder",[e.title||""]):e?pn.jk.getHoverUrl(g.Z.getUrlByNode(e)):"";u.Z.setStatus(this.context.vivaldiWindowId,n)};handleThumbnailPointerLeave=()=>{u.Z.clearStatus(this.context.vivaldiWindowId)};handlePointerEnter=e=>{this.setState({isHovered:!0})};handlePointerLeave=e=>{this.setState({isHovered:!1})};dialPointerDownHandler=e=>{this.props.onPointerDown(this.props.node,e)};pointerDownHandler=e=>{e.button,es.Z.kCenter,e.button!==es.Z.kLeft&&e.preventDefault(),se.Z.bookmarksPrivate.isCustomThumbnail(this.props.node.id,(e=>{this._customThumbnail=e}))};pointerUpHandler=e=>{this.props.lastPress===this.props.node.id&&(this.openSpeedDialNodeHandler(e),this.focusedElement&&this.context.requestAnimationFrame((()=>{this.focusedElement?.focus(),this.focusedElement=null})))};keyDownHandler=e=>{const t=(0,ps.Z)(e);switch(e.key){case" ":case"Enter":this.openSpeedDialNodeHandler(e);break;case"F2":this.handleRename();break;case"ArrowLeft":if(t||!this.props.moveFocus(this.props.node.id,"left"))return;break;case"ArrowRight":if(t||!this.props.moveFocus(this.props.node.id,"right"))return;break;case"ArrowUp":if(!this.props.moveFocus(this.props.node.id,"up"))return;break;case"ArrowDown":if(!this.props.moveFocus(this.props.node.id,"down"))return;break;default:return}(0,ms.ZP)(e)};getContextMenuItems=(e,t)=>{const n=this.context.vivaldiWindowId,i=ji.Z.getOptionFunction(e),s="always"===this.props.titleVisibility,o={};return ji.Z.getNamedMenu(n,e,(async e=>{switch(e.action){case"CONTEXT_OPEN_IN_NEW_TAB":return{handler:this.openSpeedDialNode.bind(this,t,{openInNewTab:!0,openInBackground:this.props.openTabsInBackground}),isVisible:()=>this.isBookmark(),...i(n,e,o)};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{handler:this.openSpeedDialNode.bind(this,t,{openInNewTab:!0,openInBackground:!0}),isVisible:()=>this.isBookmark()&&!this.props.openTabsInBackground,...i(n,e,o)};case"CONTEXT_OPEN_IN_TAB":return{handler:()=>this.openSpeedDialNode(t),isVisible:()=>this.isBookmark(),...i(n,e,o)};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{handler:this.openSpeedDialNode.bind(this,t,{openInNewWindow:!0}),isVisible:()=>this.isBookmark(),...i(n,e,o)};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{handler:this.openSpeedDialNode.bind(this,t,{openInNewWindow:!0,incognito:!0}),isVisible:()=>this.isBookmark(),...i(n,e,o)};case"CONTEXT_CONTAINER_OPEN_IN_WINDOW":{const s=await Ta.getMenu(n,!0,[t.url||""]);return{isVisible:()=>this.isBookmark()&&s.length>0,items:s,...i(n,e,o)}}case"CONTEXT_OPEN_ALL":return{handler:this.openSpeedDialNode.bind(this,t,{openInBackground:!0}),isVisible:()=>this.isFolder(),...i(n,e,o)};case"CONTEXT_SET_THUMBNAIL":return{handler:this.handleSetCustomThumbnail,isVisible:()=>(this.isBookmark()||this.isFolder())&&!this.props.incognito,...i(n,e,o)};case"CONTEXT_CLEAR_THUMBNAIL":return{handler:this.handleClearCustomThumbnail,isVisible:()=>this._customThumbnail,...i(n,e,o)};case"CONTEXT_RELOAD":return{handler:this.handleUpdateThumbnail,isVisible:()=>(this.isBookmark()||this.isFolder())&&!this.props.incognito,...i(n,e,o)};case"CONTEXT_EDIT":return{handler:this.handleEdit,...i(n,e,o)};case"CONTEXT_RENAME":return{handler:this.handleRename,isVisible:()=>s,...i(n,e,o)};case"CONTEXT_CUT":return{handler:this.handleCutDial,...i(n,e,o)};case"CONTEXT_COPY":return{handler:this.handleCopyDial,...i(n,e,o)};case"CONTEXT_PASTE":return{handler:this.handlePasteDial,...i(n,e,o)};case"CONTEXT_DELETE":return{handler:this.handleRemoveDial,...i(n,e,o)};default:return{...i(n,e,o)}}}))};handleContextMenu=e=>{const t=this.props.node;e.persist(),(0,ms.ZP)(e),this.getContextMenuItems("speeddialitem",t).then((t=>{(0,cs.Z)(this.context,t)(e)}))};onDragOver=e=>{e.dataTransfer.types.some((e=>zi.ZP.isUriListType(e)||"text/plain"===e||e===zi.yR))&&((0,ms.ZP)(e),e.dataTransfer.dropEffect=zi.ZP.isCopyModifierPressed(e)?"copy":"move",this.setState({canDrop:!0}))};onDragLeave=e=>{this.state.canDrop&&this.setState({canDrop:!1})};onDrop=e=>{(0,ms.ZP)(e),this.props.bookmarkActions.onDropEvent(e,this.props.node.id,0),this.setState({canDrop:!1})};onCut=e=>{this.props.bookmarkActions.cut(e,[this.props.node.id]),(0,ms.ZP)(e)};onCopy=e=>{this.props.bookmarkActions.copy(e,[this.props.node.id]),(0,ms.ZP)(e)};onPaste=e=>{this.props.bookmarkActions.paste(e,this.props.node.id),(0,ms.ZP)(e)};getContextMenuItemsPromise=e=>this.getContextMenuItems("speeddialitem",e);getTitleStyle=gs()((e=>e?{}:{textAlign:"center"}));render(){const{node:e,showFavicon:t,titleVisibility:n,deleteVisible:i,controlsVisible:s}=this.props,{children:o,url:a=""}=e,r=Ho.linkAndQueryUpdatingBookmark(this,e.id),l=e.faviconUrl||pn.jk.getFavicon(a)||a,d=a.startsWith(pn.LA)?"faviconSkipCache":e.faviconUrl?"faviconFromCache":"page",c="never"!==n,u=c?45:10,p="never"===n||"hover"===n&&!this.state.isHovered?{"aria-label":e.title}:{};return(0,ss.jsxs)("div",{ref:this.nodeRef,tabIndex:this.props.keyAccess,onPointerDown:this.dialPointerDownHandler,className:Fi()("draggable","dial",{dragging:this.props.dragging,dragover:this.props.highlight,folder:Boolean(o),isCut:this.props.isCut}),style:this.props.style,"data-id":e.id,onContextMenu:this.handleContextMenu,onBlur:this.disableClipboardListener,onFocus:this.enableClipboardListener,onKeyDown:this.keyDownHandler,onPointerEnter:this.handlePointerEnter,onPointerLeave:this.handlePointerLeave,onDoubleClick:ms.ZP,role:"link",...p,children:[Nte(Cte,{bookmark:e,canDrop:this.state.canDrop,faviconUrl:l,faviconLoadType:d,onPointerEnter:this.handleThumbnailPointerEnter,onPointerLeave:this.handleThumbnailPointerLeave,onPointerDown:this.pointerDownHandler,onPointerUp:this.pointerUpHandler,onImageLoadError:this.onThumbnailImageLoadError,onPointerCancel:this.pointerUpHandler,onDragOver:this.onDragOver,onDragLeave:this.onDragLeave,onDrop:this.onDrop,speedDialSize:this.props.size}),e.url&&s&&Nte("div",{className:"thumb-controls",style:{bottom:u}},void 0,!this.props.incognito&&Nte("button",{tabIndex:"-1",onClick:this.handleUpdateThumbnail,className:Fi()("circular","update-thumbnail",{updating:r}),disabled:r,title:(0,B.Z)("Update thumbnail"),dangerouslySetInnerHTML:{__html:Wi.GO5.medium}}),Nte("button",{tabIndex:"-1",onClick:this.handleSetCustomThumbnail,className:"circular set-custom-thumbnail",title:(0,B.Z)("Select custom thumbnail"),dangerouslySetInnerHTML:{__html:Wi.md4.medium}})),i&&Nte("button",{tabIndex:"-1",onClick:this.handleRemoveDial,disabled:!this.state.isHovered,title:(0,B.Z)("other","Delete"),className:"close circular",dangerouslySetInnerHTML:{__html:Wi.M2k.medium}}),c&&Nte("div",{className:Fi()("thumbnail-title",{hidden:"hover"===n}),onPointerUp:this.pointerUpHandler},void 0,t&&!o&&Nte(Ri.ZP,{className:"favicon",url:l,loadType:d}),t&&o&&Dte,(0,ss.jsx)(Ete,{ref:this.refTitle,bookmark:e,bookmarkActions:this.props.bookmarkActions,className:"button-title",getContextMenuItemsPromise:this.getContextMenuItemsPromise,howToEdit:"doubleClick",keyAccess:-1,needsInitialEdit:this.props.awaitingInitialEditId===e.id,onSelect:this.pointerUpHandler,setSpeedDialAwaitingEdit:this.props.setSpeedDialAwaitingEdit,style:this.getTitleStyle(t),onFinished:this.onRenameFinished,titleMargin:this.props.titleMargin}))]})}}const Ote=Mte;var xte;function Lte(e,t,n,i){xte||(xte="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:xte,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Rte="add",Bte=[I.kStartpageSpeedDialFaviconVisible,I.kStartpageSpeedDialSize,I.kStartpageSpeedDialTitlesVisible];var Fte=Lte(Ri.ZP,{className:"favicon SpeedDialAddButton-Favicon",url:Wi.a8r,loadType:"faviconFromCache"});class Wte extends Li.Component{static contextType=ts.Z;_hasClipboardListener=!1;refOpenAddSpeedDial=Li.createRef();componentWillUnmount(){this._enableClipboardListener(!1)}_enableClipboardListener=e=>{if(this._hasClipboardListener!==e){this._hasClipboardListener=e,this.props.onSetClipboardListener(this._hasClipboardListener);const{document:t}=this.context;this._hasClipboardListener?t.addEventListener("paste",this.onPaste):t.removeEventListener("paste",this.onPaste)}};onPaste=e=>{this.props.onPaste(e)};keyDownHandler=e=>{if(" "===e.key||"Enter"===e.key)this.props.addItem();else switch(e.key){case"ArrowLeft":this.props.moveFocus(Rte,"left",!1);break;case"ArrowRight":this.props.moveFocus(Rte,"right",!1);break;case"ArrowUp":this.props.moveFocus(Rte,"up",!1);break;case"ArrowDown":this.props.moveFocus(Rte,"down",!1);break;default:return}e.preventDefault(),e.stopPropagation()};_handleItemMouseDown=e=>{e.button!==es.Z.kLeft&&e.preventDefault()};render(){const{prefValues:e}=this.props,t=e[I.kStartpageSpeedDialFaviconVisible]&&"icon"!==e[I.kStartpageSpeedDialSize],n=t?{}:{textAlign:"center"};return Lte("div",{className:Fi()("dial","add","ignore-react-onclickoutside",{active:this.props.drawerIsOpen,"SpeedDial-Dial--Favicon":t,"SpeedDial-Dial--Title":"never"!==e[I.kStartpageSpeedDialTitlesVisible]}),"data-id":Rte,style:this.props.style,onBlur:()=>this._enableClipboardListener(!1),onFocus:()=>this._enableClipboardListener(!0),onMouseDown:this._handleItemMouseDown,tabIndex:this.props.keyAccess,onKeyDown:this.keyDownHandler},void 0,(0,ss.jsx)("button",{ref:this.refOpenAddSpeedDial,className:"thumbnail-image",title:this.props.title,tabIndex:this.props.keyAccess,onClick:this.props.addItem,dangerouslySetInnerHTML:{__html:Wi.irc}}),Lte("div",{className:"thumbnail-title"},void 0,t&&Fte,"never"!==e[I.kStartpageSpeedDialTitlesVisible]&&Lte("span",{className:"button-title",style:n},void 0,(0,B.Z)("command","New"))))}}const Ute=(0,Bu.Z)(Wte,Bte);var Vte;function Hte(e,t,n,i){Vte||(Vte="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Vte,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var Gte,$te=Hte(co,{className:"Blocker-Shield-Blocking",type:"blocker-shield",size:16}),Kte=Hte(co,{className:"Info-Icon",type:"info",size:16});class zte extends Li.PureComponent{static contextType=ts.Z;state={totalAdBlocked:0,totalTrackerBlocked:0};componentDidMount(){se.Z.contentBlocking.getBlockedCounters(this.getTotalBlockedData)}getTotalBlockedData=(e,t)=>{if(!t||!t.blocked_for_origin)return;const n=t.blocked_for_origin.ad_blocking.reduce(((e,t)=>e+t.blocked_count),0),i=t.blocked_for_origin.tracking.reduce(((e,t)=>e+t.blocked_count),0);this.setState({totalAdBlocked:n,totalTrackerBlocked:i})};formatPrivacyDataNumber(e){return e.split(/(\d+)/).map(((e,t)=>/\d/.test(e)?Hte("strong",{},t,(0,R.uf)(e)):e))}render(){const{totalAdBlocked:e,totalTrackerBlocked:t}=this.state;return Hte("div",{className:"SpeedDial-Blocked-Counter",onClick:()=>de.Z.showPrivacyStatsDialog(this.context.vivaldiWindowId),onDoubleClick:ms.ZP},void 0,Hte("div",{className:"SpeedDial-Blocked-Counter-Container"},void 0,$te,Hte("p",{className:"Blocked-Info"},void 0,this.formatPrivacyDataNumber((0,B.Z)("$1 tracker and","$1 trackers and",[t]))," ",this.formatPrivacyDataNumber((0,B.Z)("$1 ad blocked","$1 ads blocked",[e]))),Kte))}}function jte(e,t,n,i){Gte||(Gte="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Gte,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Yte=[I.kAddressBarSearchSuggestEnabled,I.kThemeUseAnimation,I.kStartpageSpeedDialAddButtonVisible,I.kStartpageSpeedDialAllowDnd,I.kStartpageSpeedDialColumns,I.kStartpageSpeedDialControlsVisible,I.kStartpageSpeedDialDeleteVisible,I.kStartpageSpeedDialFaviconVisible,I.kStartpageSpeedDialTitlesVisible,I.kStartpageSpeedDialSize,I.kTabsOpenNewInBackground,I.kStartpageNavigation,I.kStartpageSpeedDialDisplaySearch,I.kStartpageSpeedDialGameButtonShow,I.kStartpageSpeedDialOrder,I.kStartpageSpeedDialPrivacyStatsShow,I.kThemesSystem,I.kThemesUser,I.kStartpageSpeedDialTrackerSuggestionShow,I.kAddressBarSearchKeepSelected];function Xte(e,t){const n=Array(e);for(let i=0;i<e;i++)n[i]=t(i);return n}let Qte=null;var qte=jte(zte,{});class Jte extends Li.PureComponent{static contextType=ts.Z;animate=!1;dragStartX=0;dragStartY=0;dragDialStartPos=[0,0];refSpeedDial=Li.createRef();refParentFolderButton=Li.createRef();refSpeedDialDefaultSearchEngine=Li.createRef();_useOmni=Oi.Z.isEnabled("omnibox");constructor(e){super(e),this.state={dialNodes:[],pressed:"none",lastPress:null,dragDialXY:[0,0],transitionType:"down",dialId:null,highlightParentButton:!1,showSupportDialog:this.shouldShowSupportDialog(e.incognito),blockTrackers:!1,blockAds:!1}}componentDidMount(){No.Z.addListener(this._onWebpageViewStoreChanged),ai.Z.addListener(this._handleSupportDialogDisplay),this.timeout=setTimeout((()=>this.animate=!0),300),(0,SC.pg)("tracking",(e=>{this.setState({blockTrackers:e.trackerBlockingEnabled})})),(0,SC.pg)("ad_blocking",(e=>{this.setState({blockAds:e.adBlockingEnabled})}))}componentDidUpdate(e,t){const{HTMLElement:n,DOMRect:i}=this.context,s=this.refParentFolderButton.current;if(s instanceof n){const e=s.getBoundingClientRect();e instanceof i&&(this.parentButtonRect=e)}}componentWillUnmount(){this.timeout&&clearTimeout(this.timeout),No.Z.removeListener(this._onWebpageViewStoreChanged),ai.Z.removeListener(this._handleSupportDialogDisplay),this.finishPointerClick(!1)}static getDerivedStateFromProps(e,t){const n=t.dialId,i=e.speedDialNode,s=i&&i.id,o=(i&&i.children||[]).filter((e=>!g.Z.isSeparator(e)));if(n===s){let{lastPress:e}=t;if(null===e||Qte||o.every((t=>t.id!==e))&&(e=null),null===e)Qte=null;else if(Qte){const e=t.dialNodes;e.length===o.length&&e.every(((e,t)=>e.id===o[t].id))||(Qte=null)}return{dialNodes:o,lastPress:e}}let a="down";if(i&&n&&n!==i.parentId)if(o.some((e=>e.id===n)))a="up";else{const t=e.prefValues[I.kStartpageSpeedDialOrder].length?e.prefValues[I.kStartpageSpeedDialOrder]:e.speedDialSet.map((e=>e.id));if(t){const e=t.findIndex((e=>e===n)),i=t.findIndex((e=>e===s));-1!==i&&-1!==e&&(i<e?a="right":i>e&&(a="left"))}}return{dialNodes:o,lastPress:null,transitionType:a,dialId:s}}getLastPressPosition(){const{dialNodes:e,lastPress:t}=this.state;return Qte?Qte.findIndex((e=>e===t)):e.findIndex((e=>e.id===t))}maybeSpring(e,t){return this.animate&&this.props.prefValues[I.kThemeUseAnimation]?KQ(e,t):e}_handleSupportDialogDisplay=()=>{const e=this.shouldShowSupportDialog(this.props.incognito);this.setState({showSupportDialog:e})};shouldShowSupportDialog(e){return!1}_onWebpageViewStoreChanged=e=>{e.winId===this.context.vivaldiWindowId&&"WEBPAGEVIEW_RELOAD"===e.type&&this._handlePageReload()};handleSpeedDialPointerDown=(e,t)=>{const{document:n}=this.context;"none"!==this.state.pressed&&this.finishPointerClick(!1,t),t.button!==es.Z.kLeft&&t.button!==es.Z.kCenter||n.activeElement&&"sd-title-editor"===n.activeElement.className||(this.setState({pressed:"pressed",lastPress:e.id}),this.dragStartX=t.pageX,this.dragStartY=t.pageY)};onPointerMove=e=>{const{pressed:t}=this.state;if("none"===t||!this.props.prefValues[I.kStartpageSpeedDialAllowDnd])return;if(0===e.buttons)return void this.finishPointerClick(!1,e);if(!(1&e.buttons))return;const{lastPress:n}=this.state;if(null===n||"dragcancel"===t)return;const i=this.isPointerOverParentButton(e);this.setState((e=>(!e.highlightParentButton&&i&&hte.click(),{highlightParentButton:i})));const s=e.pageX-this.dragStartX,o=e.pageY-this.dragStartY;if("pressed"===t&&Math.abs(s)<=5&&Math.abs(o)<=5)return;const a=this.getSpeedDialGeometry(),r=this.getLastPressPosition();"pressed"===t&&(this.setDialDragListeners(!0),this.dragDialStartPos=this.computeLayout(a,r),this.setState({pressed:"dragging"}));let[l,d]=this.dragDialStartPos;l+=s,d+=o,this.setState({dragDialXY:[l,d]});const{cols:c,rows:u,dialWidth:p,dialHeight:h,thumbnailWidth:g,backgroundHeight:m}=this.getSpeedDialGeometry(),f=this.state.dialNodes.length,v=l+Math.ceil(g/3.5),y=d+Math.ceil(m/3.5),b=s<0?Math.round:Math.floor,S=o<0?Math.round:Math.floor,w=(0,Gw.Z)(b(v/p),0,c-1),C=(0,Gw.Z)(S(y/h),0,u-1),A=Math.min(C*c+w,f-1);r!==A&&this.moveDial(A,r)};moveDial=(e,t)=>{Qte=(0,v.Uy)(Qte??this.state.dialNodes.map((e=>e.id)).slice(0),(n=>{const i=n.splice(t,1)[0];n.splice(e,0,i)}))};setDialDragListeners(e){if(!this.props.prefValues[I.kStartpageSpeedDialAllowDnd])return;const{document:t}=this.context;e?(this.context.addEventListener("pointermove",this.onPointerMove,!0),this.context.addEventListener("pointerup",this.onPointerPressEnd,!1),this.context.addEventListener("pointercancel",this.onPointerPressEnd,!0),this.context.addEventListener("pointerdown",this.onPointerPressEnd,!0),Ke.Z.bind("esc",this.onDragEscapeKey)):(this.context.removeEventListener("pointermove",this.onPointerMove,!0),this.context.removeEventListener("pointerup",this.onPointerPressEnd,!1),this.context.removeEventListener("pointercancel",this.onPointerPressEnd,!0),this.context.removeEventListener("pointerdown",this.onPointerPressEnd,!0),Ke.Z.unbind("esc",this.onDragEscapeKey));const n=t.getElementById("browser");n&&(n.style.pointerEvents=e?"none":"auto")}onPointerPressEnd=e=>{const{pressed:t}=this.state;if("dragging"!==t&&"dragcancel"!==t||(0,ms.ZP)(e),"dragging"===t){const e=this.context.document.querySelector(".dial.dragover")?.getAttribute("data-id");e&&this.mergeSpeedDials(e)}this.finishPointerClick(!0,e)};onDragEscapeKey=()=>{Qte=null,this.setState({pressed:"dragcancel"})};isPointerOverParentButton=e=>!(!e||!this.parentButtonRect)&&(e.pageX>this.parentButtonRect.x&&e.pageX<this.parentButtonRect.x+this.parentButtonRect.width&&e.pageY>this.parentButtonRect.y&&e.pageY<this.parentButtonRect.y+this.parentButtonRect.height);async finishPointerClick(e,t){const{pressed:n}=this.state;if("none"!==n){if(this.setDialDragListeners(!1),"dragging"===n||"dragcancel"===n){let i=!1;const s=this.getDraggedNode();if("dragging"===n&&e&&this.isPointerOverParentButton(t)){const e=this.props.speedDialNode&&this.props.speedDialNode.parentId;s&&e&&(await this.props.bookmarkActions.move([s.id],e,0),i=!0)}else if("dragging"===n&&e){const e=this.getLastPressPosition();if(!s)return;if(("number"==typeof s.index?s.index:e)!==e&&Qte){const e=s.parentId||"";await this.props.bookmarkActions.reorder(Qte,e),i=!0}}i?this.onBookmarksMoved():Qte=null}this.setState({pressed:"none",highlightParentButton:!1})}}getDraggedNode=()=>{const{dialNodes:e}=this.state,t=this.getLastPressPosition();return Qte?e.find((e=>e.id===Qte?.[t])):e[t]};mergeSpeedDials=async e=>{if("dragging"!==this.state.pressed||!this.state.lastPress)return;const t=g.Z.getItemById(this.state.lastPress);if(t&&t.id!==e){const n=g.Z.getItemById(e);if(Boolean(n?.children))await this.props.bookmarkActions.move([t.id],e,0);else if(function(e){return!!e&&!e.url}(t))await this.props.bookmarkActions.move([e],t.id,0);else{const e=await this.props.bookmarkActions.mergeWithPromise(t,n,(0,B.Z)("title","New Folder"));this.props.setSpeedDialAwaitingEdit(e)}this.onBookmarksMoved(),this.setState({pressed:"dragcancel"})}else this.finishPointerClick(!0)};onBookmarksMoved=()=>{i.Z.runtime.lastError&&(Qte=null,console.warn("Error moving bookmark: ",i.Z.runtime.lastError))};openParentNode=e=>{(0,ms.ZP)(e),this.props.speedDialNode&&this.props.speedDialNode.parentId&&i.Z.bookmarks.getSubTree(this.props.speedDialNode.parentId,(e=>{if(i.Z.runtime.lastError)return;const t=e[0];t&&this.props.openSpeedDialNode(t)}))};openSpeedDialNode=(e,t)=>{this.props.openSpeedDialNode(e,t)};isTopLevel=()=>!this.props.speedDialNode||!this.props.speedDialSetNode||this.props.speedDialNode.id===this.props.speedDialSetNode.id;_handlePageReload=()=>{!this.props.incognito&&this.props.speedDialNode&&i.Z.bookmarks.getChildren(this.props.speedDialNode.id,(e=>{if(!e)return;const t=[];e.forEach(((e,n,i)=>{se.Z.bookmarksPrivate.isCustomThumbnail(e.id,(s=>{!1===s&&e.url&&t.push({id:e.id,url:e.url}),n===i.length-1&&Ho.updateForBookmarks(t)}))}))}))};onDragUrlOver=e=>{e.dataTransfer.types.some((e=>zi.ZP.isUriListType(e)||"text/plain"===e||e===zi.yR))&&((0,ms.ZP)(e),e.dataTransfer.dropEffect="copy")};onDropUrlOn=e=>{const t=this.props.speedDialNode;if(t){const n=t.children?t.children.length:0,i={disableMove:!0};this.props.bookmarkActions.onDropEvent(e,t.id,n,i)}};onKeyDown=e=>{const t=e.key.toLowerCase();if(e.ctrlKey)switch(t){case"z":e.shiftKey?this.props.bookmarkActions.redo():this.props.bookmarkActions.undo();break;case"y":this.props.bookmarkActions.redo()}};onPaste=e=>{this.props.speedDialNode&&this.props.bookmarkActions.paste(e,this.props.speedDialNode.id,!0),(0,ms.ZP)(e)};getSpeedDialSize(){const{prefValues:e}=this.props;return e[I.kStartpageSpeedDialSize]}getSpeedDialGeometry(){const{prefValues:e}=this.props,t=this.getSpeedDialSize();let n=Hz.get(t)?.value;const i="always"===e[I.kStartpageSpeedDialTitlesVisible];if(!n||"fit_to_columns"===t){const e=Math.round(this.props.maxWidth/(1.4*this.props.prefValues[I.kStartpageSpeedDialColumns]));n=Math.max(Math.min(e,320),120)}const s=n<150?26:33,o="icon"===t?n-s:Math.round(n/1.22),a=Math.round(n/12),r=this.state.dialNodes.length+(e[I.kStartpageSpeedDialAddButtonVisible]?1:0),l=6*a,d=e[I.kStartpageSpeedDialColumns],c=o+(i?s:0),u=n+2*a,p=c+2*a;let h=Math.max(1,Math.min(Math.floor((this.props.maxWidth-l)/u),d));this.props.maxWidth<u*h+l&&(h=1);return{backgroundHeight:c,count:r,cols:h,rows:Math.ceil(r/h),dialWidth:u,dialHeight:p,thumbnailWidth:n,thumbnailHeight:o,dialSpace:a}}computeLayout(e,t){const n=Math.floor(t/Number(e.cols)),i=t%Number(e.cols);return[Number(e.dialWidth)*i,Number(e.dialHeight)*n]}getNextFocusable=e=>{const{HTMLElement:t}=this.context,n=this.refSpeedDial.current;if(n instanceof t){const t=Array.from(n.querySelectorAll("div.dial")).map((e=>e.getAttribute("data-id"))).filter(Boolean);let i=t.indexOf(e);return-1===i?"":(i=i>0?i-1:i+1,i>=t.length?"":t[i])}return""};moveFocus=(e,t)=>{const{HTMLElement:n}=this.context,i=this.refSpeedDial.current;if(i instanceof n){const{cols:n}=this.getSpeedDialGeometry(),s=aw(e,t,Array.from(i.querySelectorAll(".dial")),n);if(!s&&"up"===t){const e=i.querySelector(".button-startpage.up-level");return!!e&&(e.focus(),!0)}return s}return!1};getTileSize=e=>{switch(!0){case e>=320:return"huge";case e>=270:return"large";case e>=220:return"medium";case e>=170:return"small";case e>=120:return"tiny";default:return"icon"}};renderNavigation=()=>this.isTopLevel()?null:jte("nav",{className:"startpage-folder-navigation"},void 0,(0,ss.jsxs)("button",{ref:this.refParentFolderButton,onClick:this.openParentNode,title:(0,B.Z)("Show Parent Folder"),"data-name":"up-button",className:Fi()("button-startpage","up-level",{highlight:this.state.highlightParentButton}),children:[jte("span",{dangerouslySetInnerHTML:{__html:Wi.zwh}}),this.props.speedDialNode?this.props.speedDialNode.title:""]}));render(){const{maxWidth:e,speedDialSet:t,prefValues:n}=this.props;if(!e)return null;const i=n[I.kStartpageSpeedDialAllowDnd],s="icon"===this.getSpeedDialSize(),o=n[I.kStartpageSpeedDialFaviconVisible]&&!s,a=n[I.kStartpageSpeedDialTitlesVisible],r=n[I.kTabsOpenNewInBackground],l=n[I.kStartpageSpeedDialControlsVisible]&&!s,d=n[I.kStartpageSpeedDialDeleteVisible],c=n[I.kStartpageSpeedDialDisplaySearch],u=n[I.kStartpageSpeedDialPrivacyStatsShow]&&(this.state.blockTrackers||this.state.blockAds),p=u&&c?900:500,{pressed:h,dialId:g,dialNodes:m}=this.state,v=Fi()({dials:!0,speeddial:!0,"sd-titles-onhover":"hover"===a}),y=t.length>0,b=this.getSpeedDialGeometry(),{backgroundHeight:S,count:w,cols:C,rows:A,dialWidth:T,dialHeight:Z,thumbnailWidth:E,thumbnailHeight:k,dialSpace:_}=b,N=C*T-2*_,P=Math.round(E/20),D=Fi()("dials-wrapper",this.getTileSize(E)),M=w<C?w*T-2*_:void 0;return(0,ss.jsxs)("div",{ref:this.refSpeedDial,children:[jte("div",{className:"SpeedDialView-Head",style:{maxWidth:Math.min(N,p)}},void 0,this.state.showSupportDialog&&this.props.prefValues[I.kStartpageSpeedDialTrackerSuggestionShow]&&(0,ss.jsx)(bz,{ref:this.refSpeedDialDefaultSearchEngine,hideImg:C<3}),c&&jte("div",{className:"on-speeddial"},void 0,this._useOmni?jte(Qw,{className:"SpeedDialView-SearchField",origin:"speed_dial_view",suggestEnabled:n[I.kAddressBarSearchSuggestEnabled],size:"large",name:"SearchField"},"speed_dial_search"):jte(Ise,{className:"SpeedDialView-SearchField",origin:"speed_dial_view",suggestEnabled:n[I.kAddressBarSearchSuggestEnabled],size:"large",name:"SearchField"},"speed_dial_search")),u&&qte),jte(mte.Z,{className:Fi()({"dials-wrapper":!0,dragging:"dragging"===h,"dragging-disabled":!i}),transitionName:this.state.transitionType,transitionEnterTimeout:300,transitionLeaveTimeout:300,overflowHidden:!1},void 0,jte("div",{onDragOver:this.onDragUrlOver,onDrop:this.onDropUrlOn,onKeyDown:this.onKeyDown,className:v},"node__"+(g||"unset"),this.renderNavigation(),jte("div",{className:D,onPointerMove:"pressed"===h&&i?this.onPointerMove:null,onPointerUp:this.onPointerPressEnd,onPointerCancel:this.onPointerPressEnd,style:{width:N,height:A*Z,marginLeft:"auto",marginRight:"auto",maxWidth:M,"--thumbnailHeight":k+"px","--thumbnailWidth":E+"px","--backgroundHeight":S+"px"}},void 0,Xte(w,(e=>{let t=null;e<m.length&&(t=Qte?m.find((t=>t.id===Qte?.[e])):m[e]);const n=!!t&&t.id===this.state.lastPress,i=n&&"dragging"===h,[s,c]=this.state.dragDialXY,[u,p]=this.computeLayout(b,e);let g;g=i?{translateX:s,translateY:c,opacity:this.maybeSpring(.95,f.Y3)}:t?{translateX:this.maybeSpring(u,f.Y3),translateY:this.maybeSpring(p,f.Y3),opacity:this.maybeSpring(1,f.Y3)}:{translateX:this.maybeSpring(u,f.Y3),translateY:this.maybeSpring(p,f.Y3),opacity:1};const v=Boolean("dragging"===h&&this.state.lastPress&&t?.id!==this.state.lastPress&&s>u-T/2&&s<=u+T/2&&c>p-Z/2&&c<=p+Z/2);return jte(VQ,{style:g,children:Lr.Z},t?"node_"+t.id:"add_button",(({translateX:s,translateY:c,opacity:u})=>t?jte(Ote,{incognito:this.props.incognito,onPointerDown:this.handleSpeedDialPointerDown,dragging:i,style:{transform:`translate3d(${s}px, ${c}px, 0)`,zIndex:n?999:e,opacity:u,pointerEvents:i?"none":"auto"},isCut:this.props.cutIds.includes(t.id),highlight:v,titleMargin:P,node:t,lastPress:this.state.lastPress,bookmarkActions:this.props.bookmarkActions,keyAccess:0===e?0:-1,moveFocus:this.moveFocus,getNextFocusable:this.getNextFocusable,openSpeedDialNode:(e,t)=>{"dragcancel"!==h&&this.openSpeedDialNode(e,t)},awaitingInitialEditId:this.props.awaitingInitialEditId,setSpeedDialAwaitingEdit:this.props.setSpeedDialAwaitingEdit,showFavicon:o,titleVisibility:a,openTabsInBackground:r,controlsVisible:l,deleteVisible:d,size:this.getSpeedDialSize()}):jte(Ute,{style:{transform:`translate3d(${s}px, ${c}px, 0)`,zIndex:0,"--thumbnailHeight":k+"px","--thumbnailWidth":E+"px","--backgroundHeight":S+"px"},id:this.props.speedDialNode?.id,drawerIsOpen:this.props.drawerIsOpen,title:y?(0,B.Z)("title","Add bookmark to Speed Dial"):(0,B.Z)("First add a new Speed Dial Group"),keyAccess:0===e?0:-1,moveFocus:this.moveFocus,onPaste:this.onPaste,onSetClipboardListener:this.props.onSetClipboardListener,addItem:this.props.toggleStartpageDrawer})))})))))]})}}const ene=(0,Bu.Z)(Jte,Yte);var tne;function nne(e,t,n,i){tne||(tne="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:tne,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const ine=[I.kDashboardEnabled,I.kMailIsTurnedOff,I.kStartpageSpeedDialAddButtonVisible,I.kStartpageSpeedDialOrder];function sne(e){const t=(0,Li.useContext)(ts.Z),n=(0,Ya.Z)(ine),i=(0,Li.createRef)(),s=new Map,[o,a]=(0,Li.useState)([]),[r,l]=(0,Li.useState)(),[d,u]=(0,Li.useState)(""),[p,h]=(0,Li.useState)(""),g=(n,i,s)=>{n===w_.Mail?de.Z.showMail(t.vivaldiWindowId):e.section!==n?((0,Dv.gR)(t),c.ZP.openURL(t.vivaldiWindowId,pn.jk.internals[n],{inCurrent:!0})):n===w_.SpeedDial&&i&&e.showSpeedDialGroup(i)},m=e=>{const n="startpagebar",i=t.vivaldiWindowId,s=ji.Z.getOptionFunction(n);return ji.Z.getNamedMenu(i,n,(async t=>{switch(t.action){case"CONTEXT_SET_AS_DEFAULT":return{isVisible:()=>e.length>0,handler:()=>{const t=e,n=o[0];_(t,n),w.Z.set(I.kStartpageSpeedDialRestorePage,!1)},...s(i,t,{})};case"CONTEXT_RENAME":return{isVisible:()=>e.length>0,isEnabled:()=>e!==f.N4,handler:()=>v(e),...s(i,t,{})};case"CONTEXT_REMOVE":return{isVisible:()=>e.length>0,handler:()=>e===f.N4?Z():y(e),...s(i,t,{})};default:return{...s(i,t,{})}}}))},v=e=>{s.get(e)?.enableEditing()},y=e=>{s.get(e)?.removeSpeedDial()},b=(e,t)=>{switch(t.key){case"ArrowLeft":S(e,"left",!1);break;case"ArrowRight":S(e,"right",!1);break;default:return}(0,ms.ZP)(t)},S=(e,n,s)=>{const{document:o,HTMLElement:a}=t,r=i.current;if(r instanceof a&&(!0===s||(0,Ra.sT)(o,r))){const t=Array.from(r.querySelectorAll("button.button-startpage")).map((e=>e.getAttribute("data-id"))).filter(Boolean);if("current"===n){if(""===e){const t=o.getElementsByClassName("div.button-startpage active")[0];t instanceof a&&(e=t.dataset.id)}const n=t.indexOf(e);if(-1===n)return;e=t[n]}else if("right"===n||"left"===n){if(1===t.length)return;let i=t.indexOf(e);if(-1===i)return;i="right"===n?i+1>=t.length?0:i+1:i<=0?t.length-1:i-1,e=t[i]}const i=r.querySelector(`button.button-startpage[data-id="${e}"]`);i&&i.focus()}};let C=-1===e.keyAccess;const A=e=>{let t=-1;return!C&&e&&(C=!0,t=0),t},T=e=>o.findIndex((t=>t===e)),E=()=>{u(""),h(""),l(void 0)},k=e=>{d!==p&&(e.stopPropagation(),_(d,p)),u(""),h(""),l(void 0)},_=(e,t)=>{let n=T(t);const i=T(e);i<n&&n--;let s=[...o];const l=s[i].slice();s=s.filter((e=>e!==l)),s.splice(n+("right"===r?1:0),0,l),a(s),w.Z.set(I.kStartpageSpeedDialOrder,s)},N=(0,Li.useMemo)((()=>{const i=[...e.speedDialSet];n[I.kDashboardEnabled]&&!he.ZP.isIncognito(t.vivaldiWindowId)&&i.push(f.h6);const s=n[I.kStartpageSpeedDialOrder];return i.sort(((e,t)=>s.length?s.indexOf(e.id)>s.indexOf(t.id)?1:-1:0)),a(i.map((e=>e.id),[])),i}),[e.speedDialSet,n,t.vivaldiWindowId]),P=n[I.kDashboardEnabled]&&!he.ZP.isIncognito(t.vivaldiWindowId)&&e.speedDialSet.length||e.speedDialSet.length>1;return(0,ss.jsxs)("nav",{ref:i,className:"startpage-navigation toolbar-medium",role:"toolbar","aria-label":(0,B.Z)("toolbar label","Start Navigation"),onContextMenu:e=>{e.persist(),(0,ms.ZP)(e),m("").then((n=>{(0,cs.Z)(t,n)(e)}))},onDragOver:ms.PF,onDrop:k,children:[nne("div",{className:"startpage-navigation-group"},void 0,N.map(((t,n)=>{const i=e.section===w_.SpeedDial&&e.speedDialSetNode&&e.speedDialSetNode.id===t.id,o=t.id,c=P?{draggable:!0,onDragStart:e=>((e,t)=>{e.persist(),e.stopPropagation(),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("vivaldi/x-speeddial-entry",t),u(t),a(N.map((e=>e.id),[]))})(e,t.id),onDragEnter:()=>{return e=t.id,void(d!==e&&h(e));var e},onDragOver:e=>((e,t)=>{if(e.stopPropagation(),e.dataTransfer.dropEffect="move",!d||t===d)return;e.preventDefault();const n=e.currentTarget.getBoundingClientRect(),i=e.clientX-n.left>n.width/2?"right":"left";l(i)})(e,t.id),onDragEnd:E,onDrop:k}:{draggable:!1};return(0,ss.jsx)(Ete,{className:Fi()({active:i,"button-startpage":!0,"no-page-focus":!0,collapsed:d===t.id,"hover-left":d!==t.id&&p===t.id&&"left"===r,"hover-right":d!==t.id&&p===t.id&&"right"===r}),ref:e=>{return t=o,void((n=e)?s.set(t,n):s.delete(t));var t,n},bookmark:t,howToEdit:"doubleClick",getContextMenuItemsPromise:()=>m(o),keyAccess:A(!!i),onSelect:e=>g(w_.SpeedDial,t),onKeyDown:b,needsInitialEdit:e.initialEditSpeedDialSet===t.id,setSpeedDialAwaitingEdit:e.setSpeedDialAwaitingEdit,...c},t.id)}),this),n[I.kStartpageSpeedDialAddButtonVisible]&&nne("button",{onClick:()=>{e.section!==w_.SpeedDial&&c.ZP.openURL(t.vivaldiWindowId,pn.jk.internals[w_.SpeedDial],{inCurrent:!0}),e.createSpeedDialSet()},"data-id":"add",className:"button-startpage add-set no-page-focus",title:(0,B.Z)("New Group"),tabIndex:A(!0),onKeyDown:e=>b("add",e),dangerouslySetInnerHTML:{__html:Wi.md4.medium}})),nne("div",{className:"startpage-navigation-group"},void 0,nne(po.ZP,{name:"PanelBookmarks",onClick:e=>g(w_.Bookmarks,void 0),onKeyDown:e=>b(w_.Bookmarks,e),"data-id":w_.Bookmarks,tabIndex:A(!0),className:Fi()({"button-startpage":!0,"no-page-focus":!0,active:e.section===w_.Bookmarks}),title:(0,B.Z)("Bookmarks"),size:"medium",image:Wi.CLf.large,commandId:"COMMAND_SHOW_BOOKMARKS"}),nne(po.ZP,{name:"PanelHistory",onClick:e=>g(w_.History,void 0),onKeyDown:e=>b(w_.History,e),title:(0,B.Z)("History"),"data-id":w_.History,tabIndex:A(!0),className:Fi()({"button-startpage":!0,"no-page-focus":!0,active:e.section===w_.History}),size:"medium",image:Wi.hcy.large,commandId:"COMMAND_SHOW_HISTORY"}),nne(po.ZP,{name:"PanelNotes",onClick:e=>g(w_.NotesManager,void 0),onKeyDown:e=>b(w_.NotesManager,e),title:(0,B.Z)("Notes"),"data-id":w_.NotesManager,tabIndex:A(!0),className:Fi()({"button-startpage":!0,"no-page-focus":!0,active:e.section===w_.NotesManager}),size:"medium",image:Wi.cyI.large,commandId:"COMMAND_SHOW_NOTES"}),!n[I.kMailIsTurnedOff]&&(0,ss.jsxs)(ss.Fragment,{children:[nne(po.ZP,{name:"PanelCalendar",onClick:e=>g(w_.Calendar,void 0),onKeyDown:e=>b(w_.Calendar,e),title:(0,B.Z)("Calendar"),"data-id":w_.Calendar,tabIndex:A(!0),className:Fi()({"button-startpage":!0,"no-page-focus":!0,active:e.section===w_.Calendar}),size:"medium",image:Wi.bcq.large,commandId:"COMMAND_SHOW_CALENDAR"}),nne(po.ZP,{name:"PanelMail",onClick:e=>g(w_.Mail,void 0),onKeyDown:e=>b(w_.Mail,e),title:(0,B.Z)("Mail"),"data-id":w_.Mail,tabIndex:A(!0),className:Fi()({"button-startpage":!0,"no-page-focus":!0,active:e.section===w_.Mail}),size:"medium",image:Wi.lvj.large,commandId:"COMMAND_SHOW_MAIL"})]}))]})}const one=(0,Li.memo)(sne);var ane;function rne(e,t,n,i){ane||(ane="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:ane,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const lne=[I.kBookmarksConfirmOpening,I.kBookmarksConfirmOpeningThreshold,I.kDashboardEnabled,I.kKeyboardTabToAll,I.kStartpageNavigation,I.kStartpageSpeedDialAddButtonVisible,I.kStartpageSpeedDialGameButtonShow,I.kStartpageSpeedDialRestorePage,I.kTabsBarPosition,I.kTabsBarWidth,I.kStartpageSpeedDialOrder,I.kBiscuitPromote];function dne(e,t,n,i){const s=n.prefValues[I.kStartpageSpeedDialRestorePage]?g.Z.getActiveGroup(e):n.prefValues[I.kStartpageSpeedDialOrder][0],o=n.prefValues[I.kDashboardEnabled]&&!i;let a;return o&&s===f.N4?a=f.h6:s&&(a=t.find((e=>e.id===s))),a??t[0]??(o?f.h6:void 0)}var cne=rne(ute,{}),une=rne("div",{className:"StartPage-GameButton"},void 0,rne(sf,{isStartPage:!0}));class pne extends Li.PureComponent{static contextType=ts.Z;refSDdWrapper=Li.createRef();refSpeedDialView=Li.createRef();bookmarkActions=new y3;_hasClipboardListener=!1;constructor(e,t){super(e);const n=g.Z.getSpeeddialFolders(),i=dne(t.vivaldiWindowId,n,e,he.ZP.isIncognito(t.vivaldiWindowId)),s=Yn.ZP.getWidth(t.vivaldiWindowId),o=e.prefValues[I.kTabsBarWidth],a=e.prefValues[I.kTabsBarPosition],r="left"===a||"right"===a?o:0;this.state={section:e.view,bookmarksAvailable:void 0!==g.Z.getRootId(),speeddialFolders:n,menuSpeeddial:i,currentSpeeddial:i,drawerIsOpen:!1,awaitingInitialEditId:"",initialEditSpeedDialSet:"",viewWidth:t.innerWidth-s-r,viewHeight:t.innerHeight,wallpaperId:crypto.randomUUID(),cutIds:g.Z.getCutIds(),isResizing:!1}}componentDidMount(){g.Z.addListener(this._onStoreChange),h3.addListener(this._onTaskStoreChange),this.context.addEventListener("resize",this.handleWindowResize,!1)}componentWillUnmount(){g.Z.removeListener(this._onStoreChange),h3.removeListener(this._onTaskStoreChange),Ke.Z.unbind("esc",this.closeStartpageDrawer),this.context.removeEventListener("resize",this.handleWindowResize,!1),clearTimeout(this._resizingTimeout)}componentDidUpdate(e,t){t.drawerIsOpen!==this.state.drawerIsOpen&&(this.state.drawerIsOpen?Ke.Z.bind("esc",this.closeStartpageDrawer):Ke.Z.unbind("esc",this.closeStartpageDrawer)),e.view!==this.props.view&&this.setState({section:this.props.view}),e.prefValues[I.kDashboardEnabled]!==this.props.prefValues[I.kDashboardEnabled]&&this._onStoreChange()}handleWindowResize=()=>{clearTimeout(this._resizingTimeout),this.setState({isResizing:!0}),this.freezeProps||(this.freezeProps={viewWidth:this.state.viewWidth,viewHeight:this.state.viewHeight}),this._resizingTimeout=setTimeout((()=>{this.setState({isResizing:!1}),this.freezeProps=void 0}),1e3)};_onStoreChange=()=>{const e=g.Z.getSpeeddialFolders();let t=dne(this.context.vivaldiWindowId,e,this.props,he.ZP.isIncognito(this.context.vivaldiWindowId)),n=t;for(const i of e)this.getUpdatedNode(i,this.state.currentSpeeddial)&&(n=this.getUpdatedNode(i,this.state.currentSpeeddial)),this.getUpdatedNode(i,this.state.menuSpeeddial)&&(t=this.getUpdatedNode(i,this.state.menuSpeeddial));this.setState({bookmarksAvailable:!0,speeddialFolders:e,menuSpeeddial:t,currentSpeeddial:n,cutIds:g.Z.getCutIds()})};_onTaskStoreChange=()=>{this.forceUpdate()};jumpToTop=()=>{const{HTMLElement:e}=this.context,t=this.refSDdWrapper.current;t instanceof e&&(t.scrollTop=0)};onResize=e=>{const t=e[0].contentRect;(this.state.viewHeight!==t.height||this.state.viewWidth!==t.width)&&this.setState({viewWidth:t.width,viewHeight:t.height})};getUpdatedNode=(e,t)=>{if(e&&e.id&&t&&t.id){if(e.id===t.id)return e;if(e.children){for(var n=0;n<e.children.length;n++){var i=this.getUpdatedNode(e.children[n],t);if(i&&i.id===t.id)return i}return}}else;};showStartpageDrawer=(e,t)=>{this.setState({drawerIsOpen:e},(()=>{!1===e&&""===this.state.awaitingInitialEditId&&this.refSpeedDialView.current?.moveFocus(t||"add","current")}))};closeStartpageDrawer=()=>{this.showStartpageDrawer(!1,"")};toggleStartpageDrawer=()=>{0===this.state.speeddialFolders.length?this.createSpeedDialSet():this.showStartpageDrawer(!this.state.drawerIsOpen)};handleDoubleClick=e=>{e.target.className&&this.state.menuSpeeddial?.id!==f.N4&&this.state.section===w_.SpeedDial&&!this.props.prefValues[I.kStartpageSpeedDialAddButtonVisible]&&this.toggleStartpageDrawer()};onSetClipboardListener=e=>{this._hasClipboardListener=e};handlePaste=()=>{const{document:e}=this.context,t=this._hasClipboardListener;t||e.addEventListener("paste",this.onPaste),e.execCommand("paste"),t||e.removeEventListener("paste",this.onPaste)};onPaste=e=>{this.state.currentSpeeddial&&(this.bookmarkActions.paste(e,this.state.currentSpeeddial.id,!0),e.stopPropagation(),e.preventDefault())};createSpeedDialSet=async()=>{const e=await this.bookmarkActions.create({parentId:g.Z.getRootId(),title:g.Z.getDefaultFolderName()});e&&this.bookmarkActions.update(e.id,{speeddial:!0}).then((e=>{this.setState({initialEditSpeedDialSet:e.id})}))};showSpeedDialGroup=e=>{ee.Z.setActiveGroup(this.context.vivaldiWindowId,e.id),this.props.updatePageThumbnailWithActiveWebview(1e3),this.jumpToTop(),this.setState({section:w_.SpeedDial,menuSpeeddial:e,currentSpeeddial:e})};isFolder=e=>!e.url;openFolder=(e,t)=>{!0===(t=t||{}).openInBackground?zi.ZP.open(this.context.vivaldiWindowId,zi.ZP.getBookmarksByNode(e),{inCurrent:!1,inBackground:!0,inNewWindow:!1,incognito:!1,allowOverride:!1},!0):(this.jumpToTop(),this.setState({currentSpeeddial:e},(()=>{this.refSpeedDialView.current?.moveFocus("","current"),this.bookmarkActions.clearUndoStack()})))};openSpeedDialNode=(e,t)=>{t=t||{},this.isFolder(e)?this.openFolder(e,t):t.openInNewWindow?xi.Z.openBrowserWindow(this.context.vivaldiWindowId,e.url,{incognito:t.incognito,transition:se.Z.historyPrivate.TransitionType.AUTO_BOOKMARK}):e.url&&c.ZP.openURL(this.context.vivaldiWindowId,e.url,{inCurrent:!t.openInNewTab,inBackground:t.openInBackground,bookmarkId:e.id,addOpenerTabId:!0,inSpecificPageId:t.openInNewTab?void 0:this.props.pageId,transition:se.Z.historyPrivate.TransitionType.AUTO_BOOKMARK})};setSpeedDialAwaitingEdit=e=>{this.setState({awaitingInitialEditId:e})};onSpeedDialDrawerDone=async(e,t=!1)=>{if(!e)return void this.closeStartpageDrawer();const n=await this.bookmarkActions.create(e);if(!n)return void this.closeStartpageDrawer();const i=n.url;i?he.ZP.isIncognito(this.context.vivaldiWindowId)||Ho.updateForBookmark(n.id,i):this.setSpeedDialAwaitingEdit(n.id),t||this.showStartpageDrawer(!1,n.id)};customize=()=>{de.Z.showSettings(this.context.vivaldiWindowId,"startpage")};renderSection=e=>{switch(this.state.section){case w_.Bookmarks:const t=new URL(this.props.url).searchParams.get("path");return rne(e2,{highlightId:t});case w_.History:return rne(p7,{pageId:this.props.pageId,keyAccess:this.props.prefValues[I.kKeyboardTabToAll],maxWidth:this.freezeProps?.viewWidth??this.state.viewWidth,maxHeight:this.freezeProps?.viewHeight??this.state.viewHeight});case w_.SpeedDial:return this.state.bookmarksAvailable?this.state.currentSpeeddial?.id!==f.N4||e?(0,ss.jsx)(ene,{ref:this.refSpeedDialView,bookmarkActions:this.bookmarkActions,cutIds:this.state.cutIds,speedDialNode:this.state.currentSpeeddial,speedDialSetNode:this.state.menuSpeeddial,speedDialSet:this.state.speeddialFolders,keyAccess:this.props.prefValues[I.kKeyboardTabToAll],drawerIsOpen:this.state.drawerIsOpen,maxWidth:this.state.viewWidth,maxHeight:this.state.viewHeight,openSpeedDialNode:this.openSpeedDialNode,toggleStartpageDrawer:this.toggleStartpageDrawer,onSetClipboardListener:this.onSetClipboardListener,incognito:e,setSpeedDialAwaitingEdit:this.setSpeedDialAwaitingEdit,awaitingInitialEditId:this.state.awaitingInitialEditId}):rne(c8,{maxWidth:this.state.viewWidth,isActive:this.props.isActive,pageId:this.props.pageId}):null;case w_.Calendar:return rne(a4,{pageId:this.props.pageId,url:this.props.url});case w_.NotesManager:{const e=new URL(this.props.url).searchParams.get("path")||"-1";return rne(Zee,{id:e,pageId:this.props.pageId,isActive:this.props.isActive},`notes-manager-${this.props.pageId}`)}default:return console.warn("Unknown Startpage Section: ",this.state.section),null}};getContextMenuItems=e=>{const t=this.context.vivaldiWindowId,n=!1===this.state.drawerIsOpen&&Boolean(this.state.currentSpeeddial)&&!he.ZP.isGuest(),i=!1===this.state.drawerIsOpen&&!this.state.currentSpeeddial&&!he.ZP.isGuest(),s=ji.Z.getOptionFunction(e);return ji.Z.getNamedMenu(t,e,(async e=>{switch(e.action){case"CONTEXT_ADD_BOOKMARK_TO_SPEEDDIAL":return{handler:this.toggleStartpageDrawer,isVisible:()=>n,...s(t,e,{})};case"CONTEXT_ADD_FOLDER_TO_SPEEDDIAL":return{handler:this.createSpeedDialSet,isVisible:()=>i,...s(t,e,{})};case"CONTEXT_PASTE":return{handler:this.handlePaste,...s(t,e,{})};case"CONTEXT_CUSTOMIZE":return{handler:this.customize,isVisible:()=>!he.ZP.isGuest(),...s(t,e,{})};case"CONTEXT_UNDO":return{handler:()=>this.bookmarkActions.undo(),isEnabled:()=>this.bookmarkActions.canUndo(),...s(t,e,{})};case"CONTEXT_REDO":return{handler:()=>this.bookmarkActions.redo(),isEnabled:()=>this.bookmarkActions.canRedo(),...s(t,e,{})};default:return Promise.resolve({...s(t,e,{})})}}))};onContextMenu=e=>{e.persist(),e.preventDefault(),e.stopPropagation(),this.getContextMenuItems("startpage").then((t=>{(0,cs.Z)(this.context,t)(e)}))};render(){if(!this.props.open)return null;const e=he.ZP.isIncognito(this.context.vivaldiWindowId);return rne(Yi.Z,{className:"startpage",onResize:this.onResize},void 0,("on"===this.props.prefValues[I.kStartpageNavigation]||"speed_dial_only"===this.props.prefValues[I.kStartpageNavigation]&&this.state.section===w_.SpeedDial)&&rne(one,{showSpeedDialGroup:this.showSpeedDialGroup,section:this.state.section,speedDialSet:this.state.speeddialFolders,speedDialSetNode:this.state.menuSpeeddial,createSpeedDialSet:this.createSpeedDialSet,initialEditSpeedDialSet:this.state.initialEditSpeedDialSet,setSpeedDialAwaitingEdit:this.setSpeedDialAwaitingEdit,keyAccess:this.props.prefValues[I.kKeyboardTabToAll]}),rne("div",{className:"startpage-content",onContextMenu:this.state.section===w_.SpeedDial&&this.state.currentSpeeddial?.id!==f.N4?this.onContextMenu:null,onDoubleClick:this.handleDoubleClick},void 0,(0,ss.jsxs)("div",{className:Fi()("sdwrapper",{"has-SpeedDial":this.state.section===w_.SpeedDial}),ref:this.refSDdWrapper,children:[this.renderSection(e),(this.state.section===w_.SpeedDial||this.state.section===w_.Dashboard)&&cne]}),!e&&this.props.prefValues[I.kDashboardEnabled]&&this.state.section===w_.SpeedDial&&this.state.currentSpeeddial?.id!==f.N4&&(0,ss.jsx)(ss.Fragment,{children:C.Z.get(I.kBiscuitPromote)?rne("div",{className:"StartPage-PromoteButton"},void 0,rne(kee,{onChange:()=>{this.showSpeedDialGroup(f.h6)}})):(0,ss.jsx)(ss.Fragment,{children:this.props.prefValues[I.kStartpageSpeedDialGameButtonShow]&&this.state.currentSpeeddial?.id!==f.N4&&une})})),this.state.section===w_.SpeedDial&&this.state.drawerIsOpen&&rne(Wee,{node:this.state.currentSpeeddial,keyAccess:this.props.prefValues[I.kKeyboardTabToAll],onSpeedDialDrawerDone:this.onSpeedDialDrawerDone}))}}const hne=(0,Bu.Z)(pne,lne);var gne;function mne(e,t,n,i){gne||(gne="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:gne,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class fne extends Li.PureComponent{static contextType=ts.Z;state={windowStyle:Be.Z.getState().windowStyles.get(this.context.vivaldiWindowId)||{}};componentDidMount(){Be.Z.addListener(this.onThemeStoreChanged)}componentWillUnmount(){Be.Z.removeListener(this.onThemeStoreChanged)}onThemeStoreChanged=()=>{const e=Be.Z.getState().windowStyles.get(this.context.vivaldiWindowId);this.setState({windowStyle:e})};render(){const e=Object.entries(this.state.windowStyle),t=e.filter((([e,t])=>e.includes("colorSuccess")||e.includes("colorWarning")||e.includes("colorError"))),n=e.filter((([e,t])=>e.includes("radius"))),i=e.filter((([e,t])=>e.includes("colorBg"))),s=e.filter((([e,t])=>e.includes("colorFg"))),o=e.filter((([e,t])=>e.includes("colorAccent"))),a=e.filter((([e,t])=>e.includes("colorHighlight"))),r=e.filter((([e,t])=>e.includes("colorBorder")));return mne("div",{className:"theme-test",tabIndex:"0"},void 0,mne("h1",{},void 0,(0,B.Z)("Theme Color Test Page")),mne("p",{},void 0,(0,B.Z)("$1 color and $2 radius variables created",[Object.entries(this.state.windowStyle).length,n.length])),mne("div",{},void 0,mne("h2",{},void 0,`${(0,B.Z)("Info Colors")} (${t.length})`),mne("div",{className:"list"},void 0,t.map((([e,t])=>mne("div",{style:{backgroundColor:t}},e,mne("input",{type:"text",value:e,readOnly:!0}),mne("input",{type:"text",value:t,readOnly:!0})))))),mne("div",{},void 0,mne("h2",{},void 0,`${(0,B.Z)("Foreground Colors")} (${s.length})`),mne("div",{className:"list"},void 0,s.map((([e,t])=>mne("div",{style:{backgroundColor:t}},e,mne("input",{type:"text",value:e,readOnly:!0}),mne("input",{type:"text",value:t,readOnly:!0})))))),mne("div",{},void 0,mne("h2",{},void 0,`${(0,B.Z)("Background Colors")} (${i.length})`),mne("div",{className:"list"},void 0,i.map((([e,t])=>mne("div",{style:{backgroundColor:t}},e,mne("input",{type:"text",value:e,readOnly:!0}),mne("input",{type:"text",value:t,readOnly:!0})))))),mne("div",{},void 0,mne("h2",{},void 0,`${(0,B.Z)("Border Colors")} (${r.length})`),mne("div",{className:"list"},void 0,r.map((([e,t])=>mne("div",{style:{backgroundColor:t}},e,mne("input",{type:"text",value:e,readOnly:!0}),mne("input",{type:"text",value:t,readOnly:!0})))))),mne("div",{},void 0,mne("h2",{},void 0,`${(0,B.Z)("Accent Colors")} (${o.length})`),mne("div",{className:"list"},void 0,o.map((([e,t])=>mne("div",{style:{backgroundColor:t}},e,mne("input",{type:"text",value:e,readOnly:!0}),mne("input",{type:"text",value:t,readOnly:!0})))))),mne("div",{},void 0,mne("h2",{},void 0,`${(0,B.Z)("Highlight Colors")} (${a.length})`),mne("div",{className:"list"},void 0,a.map((([e,t])=>mne("div",{style:{backgroundColor:t}},e,mne("input",{type:"text",value:e,readOnly:!0}),mne("input",{type:"text",value:t,readOnly:!0})))))),mne("div",{},void 0,mne("h2",{},void 0,`${(0,B.Z)("Border radius")} (${n.length})`),mne("div",{className:"list"},void 0,n.map((([e,t])=>mne("div",{style:{radius:t}},e,mne("input",{type:"text",value:e,readOnly:!0}),mne("input",{type:"text",value:t,readOnly:!0})))))))}}const vne=fne;var yne;function bne(e,t,n,i){yne||(yne="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:yne,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var Sne=bne("div",{className:"welcome-control-media"});function wne(e,t){const[n,i]=Li.useState(!0),[s,o]=Li.useState(!0),[a,r]=Li.useState(!0),[l,d]=Li.useState(e.shouldShowImport),[c,u]=Li.useState(!0),[p,h]=Li.useState(!1),g=async()=>{try{const e=await async function(){return await se.Z.utilities.isVivaldiPinnedToLaunchBar()}();u(e),h(!0)}catch(e){h(!1)}};Li.useEffect((()=>{g()}),[]);const m=async()=>{if(n){const e=await async function(){return await se.Z.utilities.pinVivaldiToLaunchBar()}();u(e)}};Li.useEffect((()=>{(async()=>{const e=await se.Z.utilities.isVivaldiDefaultBrowser();o(e)})()}),[]);const f=e.callout[2],v=e.callout[3],y=e.callout[4];return(0,ss.jsx)("div",{ref:t,className:"welcome-content-outer",children:bne("div",{className:"welcome-content-inner welcome-center-horizontal welcome-center-vertical"},void 0,bne("div",{className:"welcome-control"},void 0,Sne,bne("div",{className:"welcome-control-panel"},void 0,bne("h1",{},void 0,e.title),bne("p",{},void 0,e.callout[0]),bne("div",{className:"welcome-control-wrapper"},void 0,p&&!c&&bne("label",{className:"control-panel-dock-container",title:f},void 0,bne("input",{type:"checkbox",onChange:e=>i(e.target.checked),checked:n}),bne("span",{className:"control-panel-dock-text"},void 0,f)),!s&&bne("label",{className:"control-panel-default-container",title:v},void 0,bne("input",{type:"checkbox",onChange:e=>r(e.target.checked),checked:a}),bne("span",{className:"control-panel-default-text"},void 0,v)),bne("label",{className:"control-panel-import-container",title:y},void 0,bne("input",{type:"checkbox",onChange:t=>{const{checked:n}=t.target;e.toggleShowImport(n),d(n)},checked:l}),bne("span",{className:"control-panel-import-text"},void 0,y))))),bne("button",{tabIndex:0,className:"welcome-button primary",onClick:async()=>{a&&!s&&se.Z.utilities.setVivaldiAsDefaultBrowser(),m(),e.continue()}},void 0,e.continueText))})}const Cne=Li.forwardRef(wne);var Ane;function Ine(e,t,n,i){Ane||(Ane="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Ane,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Tne=(0,QC.Z)("button");var Zne=Ine("div",{className:"card-outline"});class Ene extends Li.Component{render(){const e=this.props.style||{};return this.props.backgroundImage&&(e.backgroundImage=`url(${this.props.backgroundImage})`),Ine(Tne,{className:Fi()({"welcome-card":!0,"card-has-background":this.props.backgroundImage,"card-has-image-zoom":this.props.hasImageZoom,"card-is-done":this.props.done,"card-is-selected":this.props.selected}),disabled:this.props.done,onClick:this.props.onClick,title:this.props.tooltip??this.props.title,style:e},void 0,Zne,this.props.image&&Ine("div",{className:"card-image"},void 0,Ine("img",{src:this.props.image,height:"78",width:"78"})),this.props.svg&&Ine("div",{className:"card-image",dangerouslySetInnerHTML:{__html:this.props.svg}}),this.props.renderContent&&this.props.renderContent(),Ine("div",{className:"card-text"},void 0,this.props.title))}}const kne=Ene;var _ne;function Nne(e,t,n,i){_ne||(_ne="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:_ne,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Pne=[{names:["chrome"],imageName:"welcomepage-chrome.svg"},{names:["chromium"],imageName:"welcomepage-chromium.svg"},{names:["mozilla firefox"],imageName:"welcomepage-firefox.svg"},{names:["opera gx"],imageName:"welcomepage-operagx.svg"},{names:["opera 12"],imageName:"welcomepage-opera-12.svg"},{names:["opera"],imageName:"welcomepage-opera.svg"},{names:["safari"],imageName:"welcomepage-safari.svg"},{names:["edge legacy"],imageName:"welcomepage-edge.svg"},{names:["explorer"],imageName:"welcomepage-explorer.svg"},{names:["vivaldi"],imageName:"welcomepage-vivaldi.svg"},{names:["brave"],imageName:"welcomepage-brave.svg"},{names:["edge"],imageName:"welcomepage-edge-chromium.svg"},{names:["yandex","яндекс"],imageName:"welcomepage-yandex.svg"},{names:["arc"],imageName:"welcomepage-arc.svg"}],Dne=["safari","edge","explorer"],Mne=["Thunderbird"],One=(0,QC.Z)("button");function xne(e){const t=e.toLowerCase();for(let e=0;e<Pne.length;e++)for(let n=0;n<Pne[e].names.length;n++)if(t.includes(Pne[e].names[n]))return{name:Pne[e].names[n],imageName:Pne[e].imageName};return{name:e,imageName:""}}var Lne=Nne("br",{});class Rne extends Li.Component{static contextType=ts.Z;constructor(e){super(e),this.state={error:null,profileStatus:[],profiles:[],toImport:[],requiresInteractiveImport:null,importsExtensions:!1,importsTabs:!1}}componentDidMount(){this.refreshProfileList(),se.Z.importData.onImportEnded.addListener(this.onImportEnded)}componentWillUnmount(){se.Z.importData.onImportEnded.removeListener(this.onImportEnded)}refreshProfileList=()=>{se.Z.runtimePrivate.getUserProfiles((e=>{this.refreshProfileListWithIgnorePaths(e.map((e=>e.path)))}))};refreshProfileListWithIgnorePaths=e=>{se.Z.importData.getProfiles((t=>{const n=t.filter((t=>!(t.detectedProfilePath&&e.some((e=>e.startsWith(t.detectedProfilePath))))));this.setState({profileStatus:n.map((()=>"IDLE")),profiles:n})}))};selectProfileFolder=()=>{if(null!=this.state.requiresInteractiveImport){const e=this.state.profiles[this.state.requiresInteractiveImport];se.Z.utilities.selectFile({windowId:this.context.vivaldiWindowId,title:(0,B.Z)("Select $1 Folder",[e.name]),type:"folder",defaultPath:e.suggestedProfilePath}).then((t=>{t&&e.requiresAccessPermission&&(this.refreshProfileList(),this.handleOnCloseDialog())}))}};toggleImport=e=>{const{toImport:t}=this.state;if(t.includes(e))t.splice(t.indexOf(e),1);else{t.push(e);const n=this.state.profiles[e];n.requiresInteractiveImport&&this.setState({requiresInteractiveImport:e}),n.extensions&&this.setState({importsExtensions:!0}),n.tabs&&this.setState({importsTabs:!0})}this.setState({toImport:t})};importSelected=()=>{this.startImport(this.state.toImport[0]),this.toggleImport(this.state.toImport[0])};onImportEnded=e=>{const t=[...this.state.profileStatus];for(let n=0;n<this.state.profileStatus.length;n++)"STARTED"===t[n]&&(t[n]=0===e?"COMPLETED":"FAILED");0===e?this.setState({error:null,profileStatus:t}):this.setState({error:(0,B.Z)("An error occurred during import"),profileStatus:t}),this.state.toImport.length>0&&this.importSelected(),this.state.importsExtensions&&(c.ZP.openURL(this.context.vivaldiWindowId,pn.xy.extensions,{inBackground:!0,singleton:!0}),this.state.importsExtensions=!1),this.state.importsTabs&&(this.state.importsTabs=!1)};startImport(e){const t=this.state.profiles[e];let n="";t.UserProfiles&&t.UserProfiles[0]&&t.UserProfiles[0].profileName&&(n=t.UserProfiles[0].profileName);const i={history:t.history,favorites:t.favorites,passwords:t.passwords,notes:t.notes,speeddial:t.speeddial,extensions:t.extensions,tabs:t.tabs};this.setState((t=>{const n=[...t.profileStatus];return n[e]="STARTED",{profileStatus:n}}),(()=>{se.Z.importData.startImport(e,true,n,i,"","",(()=>{}))}))}handleOnCloseDialog=()=>{this.setState({requiresInteractiveImport:null})};render(){const e=this.state.profileStatus.some((e=>"COMPLETED"===e)),t=this.state.profiles.filter((e=>(e.hasDefaultInstall||Dne.includes(xne(e.name).name))&&!Mne.includes(xne(e.name).name))),n=t.length,i=null!=this.state.requiresInteractiveImport?this.state.profiles[this.state.requiresInteractiveImport]:void 0;return(0,ss.jsxs)(ss.Fragment,{children:[i&&Nne(ra.Z,{onRequestClose:this.handleOnCloseDialog,className:"welcome-import-data-dialog float",title:(0,B.Z)("Import Browser Data")},void 0,Nne("div",{className:"import-data"},void 0,Nne("div",{className:"dialog-content"},void 0,Nne("div",{className:"import-pathname"},void 0,i.requiresAccessPermission&&(0,ss.jsxs)(ss.Fragment,{children:[(0,B.Z)("Vivaldi needs your permission to read the $1 folder.",[i.name]),Lne]}),(0,B.Z)("Select the $1 folder to begin import.",[i.name])))),Nne("footer",{className:"dialog-footer"},void 0,Nne("input",{type:"button",className:"primary",onClick:this.selectProfileFolder,value:(0,B.Z)("Select $1 Folder",[i.name||"Profile"])}),Nne("input",{type:"button",onClick:this.handleOnCloseDialog,value:(0,B.Z)("Cancel")}))),(0,ss.jsx)("div",{ref:this.props.forwardRef,className:"welcome-content-outer",children:Nne("div",{className:"welcome-content-inner welcome-center-horizontal welcome-center-vertical"},void 0,Nne("h1",{},void 0,this.props.title),0===n?Nne("p",{},void 0,this.props.callout[1]):(0,ss.jsxs)(ss.Fragment,{children:[Nne("p",{},void 0,this.props.callout[0]),Nne("div",{className:Fi()("cards-container","cards-container-import pad-top")},void 0,t.map(((e,t)=>{const{imageName:n}=xne(e.name),i=this.state.profileStatus[t];return Nne(kne,{done:"COMPLETED"===i,onClick:()=>this.toggleImport(t),selected:this.state.toImport.includes(t),title:"COMPLETED"===i?(0,B.Z)("Imported"):e.name,image:`resources/${n}`},t)})))]}),this.state.toImport.length?Nne("input",{type:"submit",className:"welcome-button",onClick:this.importSelected,value:(0,B.Z)("Import Selected")}):Nne(One,{tabIndex:0,className:"welcome-button primary",onClick:this.props.continue},void 0,e||0===this.state.profiles.length?this.props.continueText:(0,B.Z)("Skip")),this.state.error&&Nne("p",{},void 0,this.state.error))})]})}}const Bne=Rne;var Fne;function Wne(e,t,n,i){Fne||(Fne="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Fne,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Une=[I.kVivaldiCrashReportingConsentGranted],Vne=(w.Z.getEventHandler,(0,QC.Z)("button"));var Hne=Wne("div",{}),Gne=Wne("img",{className:"welcome-icon",src:"../../resources/vivaldi-icon-macos.png"});class $ne extends Li.Component{static contextType=ts.Z;openPrivacyPage=()=>{c.ZP.openURL(this.context.vivaldiWindowId,p.fg)};renderCrashReportingConsent(){return Hne}render(){const e=navigator.deviceMemory<8||navigator.hardwareConcurrency<=4||screen.colorDepth<24||window.matchMedia("(prefers-reduced-motion: reduce)").matches?"startup-static":"startup";return(0,ss.jsxs)("div",{ref:this.props.forwardRef,className:"welcome-content-outer",children:[Wne("div",{className:"effect-container",style:{backgroundImage:`url('/resources/${e}.svg')`}}),Wne("div",{className:"welcome-content-inner welcome-center-horizontal welcome-center-vertical intro"},void 0,Gne,Wne("h1",{},void 0,this.props.title),Wne("p",{},void 0,this.props.callout[0]),Wne(Vne,{tabIndex:0,className:"welcome-button primary",onClick:this.props.continue},void 0,this.props.continueText),this.renderCrashReportingConsent())]})}}const Kne=(0,Bu.Z)($ne,Une);var zne;function jne(e,t,n,i){zne||(zne="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:zne,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Yne=[I.kThemeScheduleEnabled,I.kThemeScheduleOS,I.kThemeScheduleTimeline,I.kThemesCurrent,I.kThemesSystem],Xne=(0,QC.Z)("button");class Qne extends Li.Component{static contextType=ts.Z;context;toggleOSSchedule=()=>{const e="system"===this.props.prefValues[I.kThemeScheduleEnabled]?"off":"system";w.Z.set(I.kThemeScheduleEnabled,e)};render(){const{prefValues:e}=this.props,t=ki.Z.getCurrentIdWithoutPreview();return(0,ss.jsx)("div",{ref:this.props.forwardRef,className:"welcome-content-outer",children:jne("div",{className:"welcome-content-inner welcome-center-horizontal welcome-center-vertical"},void 0,jne("h1",{},void 0,this.props.title),jne("p",{},void 0,this.props.callout[0]),jne("label",{className:"welcome-pref-checkbox"},void 0,jne(FL,{value:"system",checked:"system"===e[I.kThemeScheduleEnabled],onChange:this.toggleOSSchedule}),jne("span",{},void 0,this.props.callout[1])),jne("div",{className:"cards-container cards-container-themes"},void 0,e[I.kThemesSystem].slice(0,4).map((e=>{const n=e.id===t,i=Fi()("ThemePreview","ThemePreview-Welcome","welcome-card",{"card-is-selected":n});return jne(zq,{className:i,theme:e,welcomePage:!0,themeChangeCallback:ki.Z.setTheme,isCurrent:!1,isSystem:!0},e.id)}))),jne(Xne,{tabIndex:0,className:"welcome-button primary",onClick:this.props.continue},void 0,this.props.continueText))})}}const qne=(0,Bu.Z)(Qne,Yne);var Jne;function eie(e,t,n,i){Jne||(Jne="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Jne,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const tie="fullyLoaded",nie="essentials",iie="https://vivaldi.com/getstarted/",sie="https://vivaldi.com/getstarted-mail/",oie=(0,QC.Z)("button"),aie=[I.kMailIsTurnedOff,I.kPanelsWindowDefaults,I.kStatusBarDisplay,I.kToolbarsNavigation];var rie=eie("div",{className:"card-image"},void 0,eie("img",{src:"/resources/welcome-client.webp"}));class lie extends Li.Component{static contextType=ts.Z;context;getUIMode=()=>this.props.prefValues[I.kMailIsTurnedOff]?nie:tie;setFeature=e=>{const{value:t}=e.target;w.Z.set(I.kMailIsTurnedOff,t===nie)};render(){const e=this.context.vivaldiWindowId,t=this.getUIMode()===nie;return(0,ss.jsx)("div",{ref:this.props.forwardRef,className:"welcome-content-outer",children:eie("div",{className:"welcome-content-inner welcome-center-horizontal welcome-center-vertical"},void 0,eie("div",{className:"cards-container cards-container-choice"},void 0,eie("div",{className:"card-text"},void 0,eie("h1",{},void 0,this.props.title),eie("p",{},void 0,this.props.callout[0])),rie),eie("link",{rel:"prefetch",href:t?iie:sie}),eie("label",{className:"feature-choice-switch"},void 0,eie(FL,{value:t?tie:nie,checked:!this.props.prefValues[I.kMailIsTurnedOff],onChange:this.setFeature}),eie("span",{},void 0,this.props.callout[2])),eie(oie,{className:"welcome-button primary",onClick:()=>{!t&&de.Z.showMailAccountDialog(e),navigator.onLine?c.ZP.openURL(e,t?iie:sie,{inCurrent:!0}):this.props.continue()}},void 0,t?this.props.callout[3]:this.props.callout[4]))})}}const die=(0,Bu.Z)(lie,aie);var cie;function uie(e,t,n,i){cie||(cie="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:cie,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const pie=[I.kTabsBarPosition],hie={top:{title:(0,B.Z)("Top"),image:n(48753)},left:{title:(0,B.Z)("title","Left"),image:n(31614)},bottom:{title:(0,B.Z)("Bottom"),image:n(34511)},right:{title:(0,B.Z)("title","Right"),image:n(76201)}},gie=(0,QC.Z)("button");class mie extends Li.Component{setPosition=e=>{w.Z.set(I.kTabsBarPosition,e),w.Z.set(I.kPanelsPosition,"left"===e?"right":"left")};render(){return(0,ss.jsx)("div",{ref:this.props.forwardRef,className:"welcome-content-outer",children:uie("div",{className:"welcome-content-inner welcome-center-horizontal welcome-center-vertical"},void 0,uie("h1",{},void 0,this.props.title),uie("p",{},void 0,this.props.callout[0]),uie("div",{className:"cards-container cards-container-tabs"},void 0,Object.keys(hie).map((e=>uie(kne,{onClick:this.setPosition.bind(this,e),title:hie[e].title,selected:e===this.props.prefValues[I.kTabsBarPosition],svg:hie[e].image},e)))),uie(gie,{tabIndex:0,className:"welcome-button primary",onClick:this.props.continue},void 0,this.props.continueText))})}}const fie=(0,Bu.Z)(mie,pie);var vie;function yie(e,t,n,i){vie||(vie="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:vie,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const bie=(0,QC.Z)("button");class Sie extends Li.Component{state={trackerBlockingEnabled:!1,adBlockingEnabled:!1};componentDidMount(){this.updateRules(),se.Z.contentBlocking.onStateChanged.addListener(this.updateRules)}componentWillUnmount(){se.Z.contentBlocking.onStateChanged.removeListener(this.updateRules)}updateRules=()=>{["ad_blocking","tracking"].forEach((e=>{se.Z.contentBlocking.getActiveExceptionsList(e,(t=>{const n="tracking"===e?"trackerBlockingEnabled":"adBlockingEnabled";this.setState({[n]:"exempt_list"===t})}))}))};setNoBlocking=()=>{se.Z.contentBlocking.setActiveExceptionsList("tracking","process_list"),se.Z.contentBlocking.setActiveExceptionsList("ad_blocking","process_list"),this.updateRules()};setTrackerBlocking=()=>{se.Z.contentBlocking.setActiveExceptionsList("tracking","exempt_list"),se.Z.contentBlocking.setActiveExceptionsList("ad_blocking","process_list"),this.updateRules()};setTrackerAndAdBlocking=()=>{se.Z.contentBlocking.setActiveExceptionsList("tracking","exempt_list"),se.Z.contentBlocking.setActiveExceptionsList("ad_blocking","exempt_list"),this.updateRules()};getBlockLevel=()=>{let e=0;return this.state.trackerBlockingEnabled&&(e=1),this.state.trackerBlockingEnabled&&this.state.adBlockingEnabled&&(e=2),e};render(){const e=this.getBlockLevel();return(0,ss.jsx)("div",{ref:this.props.forwardRef,className:"welcome-content-outer",children:yie("div",{className:"welcome-content-inner welcome-center-horizontal welcome-center-vertical"},void 0,yie("h1",{},void 0,this.props.title),this.props.callout.map(((e,t)=>yie("p",{},t,e))),yie("div",{className:"cards-container card-blocker"},void 0,yie(kne,{onClick:this.setNoBlocking,title:(0,B.Z)("No Blocking"),hasImageZoom:!0,tooltip:(0,B.Z)("No content blocking will be applied to any site by default."),selected:0===e,svg:Wi.Tu3,style:{"--no-blocking":1,"--base":0}}),yie(kne,{onClick:this.setTrackerBlocking,title:(0,B.Z)("Block Trackers"),hasImageZoom:!0,tooltip:(0,B.Z)("Online trackers collect personal information and browsing habits across multiple sites."),selected:1===e,svg:Wi.Tu3,style:{"--trackers":1}}),yie(kne,{onClick:this.setTrackerAndAdBlocking,title:(0,B.Z)("Block Trackers and Ads"),hasImageZoom:!0,tooltip:(0,B.Z)("Web advertisement supports existence of many sites but can also be used to build a personal profile for monetization."),selected:2===e,svg:Wi.Tu3,style:{"--ads":1}})),yie(bie,{tabIndex:0,className:"welcome-button primary",onClick:this.props.continue},void 0,this.props.continueText))})}}const wie=Sie;var Cie,Aie=n(55667);function Iie(e,t,n,i){Cie||(Cie="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Cie,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Tie=[I.kTabsBarPosition,I.kWelcomeReadPages],Zie={enter:1e3,exit:1e3};var Eie=Iie("svg",{className:"guest-intro-background",viewBox:"0 0 1244 860"},void 0,Iie("path",{fill:"url(#guest-intro-bg-gradient)",d:"M0 0h153.513c16.141 27.93 32.15 55.734 47.912 83.11 16.086 27.94 32.722 56.832 49.076 85.128 11.01 19.031 22.079 38.316 32.781 56.967 25.186 43.883 51.228 89.259 77.402 132.848 33.382 55.651 75.894 82.121 137.77 85.829 3.205.192 6.454.288 9.655.288 39.673 0 78.14-14.461 108.316-40.722 21.644-18.834 48.687-52.291 54.604-104.667.749-6.654 1.357-13.708 1.855-19.573-1.07-29.74-6.476-52.92-17.294-74.518C622.935 139.46 612.708 67.99 625.087 0h136.676C747.1 44.93 749.845 96.364 774.32 145.251c20.839 41.6 30.654 85.7 31.485 138.023-.568 6.192-1.472 18.273-2.83 30.356-17.572 155.524-149.172 263.318-294.866 263.318-5.816 0-11.67-.173-17.526-.521C382.84 569.97 301.9 518.174 246.822 426.358c-38.015-63.313-74.255-127.68-111.253-191.634C90.359 156.507 45.49 78.062 0 0zm1113.47 0H1244v140.1c-7.496 27.86-18.849 54.995-34.031 81.275a1299530.57 1299530.57 0 0 1-170.255 294.799A1223193.145 1223193.145 0 0 0 841.018 860.24H687.72c135.675-235.123 271.527-470.147 407.26-705.25 22.311-38.621 31.22-79.696 25.368-124.548A170.12 170.12 0 0 0 1113.471 0z"}));function kie(e){return Iie("div",{className:"guest-intro"},void 0,Eie,Iie("div",{className:"guest-intro-content"},void 0,Iie("h1",{},void 0,(0,B.Z)("Welcome Page Unavailable")),Iie("p",{},void 0,(0,B.Z)("Welcome page is not available in guest windows.")),Iie("p",{},void 0,Iie("a",{tabIndex:0,href:kT,onClick:t=>_T(e.windowId,t)},void 0,(0,B.Z)("Learn more about Guest Profiles")))))}class _ie extends Li.Component{static contextType=ts.Z;ref={};constructor(e,t){super(e);const n=this.getNextUnread(),i=Object.keys(hi),s=n||i[i.length-1];i.forEach((e=>this.ref[e]=Li.createRef())),this.state={currentPageKey:s,minimalUI:"intro"===s&&fi.isFirstStart(),shouldShowControl:!1,shouldShowImport:!1}}componentDidMount(){fi.isFirstStart()&&"intro"===this.state.currentPageKey&&this.setCurrentPageRead(),rW().then((e=>this.setState({shouldShowControl:!e,shouldShowImport:!e})))}componentDidUpdate(e,t){!t.minimalUI&&this.state.minimalUI||!t.shouldShowControl&&this.state.shouldShowControl||!t.shouldShowImport&&this.state.shouldShowImport||this.state.minimalUI&&"tabs"!==t.currentPageKey&&"tabs"===this.state.currentPageKey&&this.setState({minimalUI:!1})}setPage=e=>()=>{this.setCurrentPageRead(),this.scrollToTop(),this.setState({currentPageKey:e})};toggleShowImport=e=>{this.setState({shouldShowImport:e})};getNextUnread=e=>{const t=Object.keys(hi),n=this.props.prefValues[I.kWelcomeReadPages],i=e?t.indexOf(e):-1;for(let e=-1;e<t.length;e++){const s=e+1;if(t[s]&&!n.includes(t[s])&&s>i)return t[s]}return fi.getUnreadPageKeys()[0]};getFilteredKeys=()=>Object.keys(hi).filter((e=>!("control"===e&&!this.state.shouldShowControl||"import_data"===e&&!this.state.shouldShowImport)));getNextPageKey=()=>{const e=this.getFilteredKeys();return e?.find(((t,n)=>this.state.currentPageKey===e[n-1]))};setCurrentPageRead=()=>{const e=this.props.prefValues[I.kWelcomeReadPages],t=this.state.currentPageKey;e.includes(t)||w.Z.set(I.kWelcomeReadPages,e.concat([t]))};continue=()=>{this.setCurrentPageRead();const e=this.getNextPageKey();if(e)this.scrollToTop(),this.setState({currentPageKey:e});else{const e=this.context.vivaldiWindowId;c.ZP.openURL(e,Ce.ZP.getDefaultStartpage(e),{inCurrent:!0})}};getContinueText=()=>fi.getUnreadPageKeys().length===Object.keys(hi).length&&this.state.currentPageKey===Object.keys(hi)[0]?(0,B.Z)("Let’s Go"):(0,B.Z)("Continue");scrollToTop=()=>{const{Element:e}=this.context,t=this.ref[this.state.currentPageKey].current;t instanceof e&&t.scrollTo({behavior:"smooth",top:0})};render(){if(he.ZP.isGuest())return Iie(kie,{windowId:this.context.vivaldiWindowId});const e=this.getContinueText(),{prefValues:t}=this.props,n=fi.getUnreadPageKeys().length;return Iie("div",{className:Fi()("welcome-wrapper",this.state.currentPageKey,{"welcome-wrapper-animate":"tabs"===this.state.currentPageKey&&2===n&&C.Z.usesDefault(I.kTabsBarPosition),"welcome-minimal-ui":this.state.minimalUI})},void 0,Iie(Aie.Z,{className:"welcome-content"},void 0,"intro"===this.state.currentPageKey&&Iie(EI.Z,{classNames:"welcome-page",timeout:Zie,nodeRef:this.ref[this.state.currentPageKey]},void 0,Iie(Kne,{forwardRef:this.ref[this.state.currentPageKey],continue:this.continue,continueText:e,title:hi[this.state.currentPageKey],callout:gi[this.state.currentPageKey]})),"control"===this.state.currentPageKey&&Iie(EI.Z,{classNames:"welcome-page",timeout:Zie,nodeRef:this.ref[this.state.currentPageKey]},void 0,(0,ss.jsx)(Cne,{ref:this.ref[this.state.currentPageKey],continue:this.continue,continueText:e,title:hi[this.state.currentPageKey],callout:gi[this.state.currentPageKey],toggleShowImport:this.toggleShowImport,shouldShowImport:this.state.shouldShowImport})),"welcome_feature_amount"===this.state.currentPageKey&&Iie(EI.Z,{classNames:"welcome-page",timeout:Zie,nodeRef:this.ref[this.state.currentPageKey]},void 0,Iie(die,{forwardRef:this.ref[this.state.currentPageKey],continue:this.continue,continueText:e,title:hi[this.state.currentPageKey],callout:gi[this.state.currentPageKey]})),"tracker_and_ad"===this.state.currentPageKey&&Iie(EI.Z,{classNames:"welcome-page",timeout:Zie,nodeRef:this.ref[this.state.currentPageKey]},void 0,Iie(wie,{forwardRef:this.ref[this.state.currentPageKey],continue:this.continue,continueText:e,title:hi[this.state.currentPageKey],callout:gi[this.state.currentPageKey]})),"import_data"===this.state.currentPageKey&&Iie(EI.Z,{classNames:"welcome-page",timeout:Zie,nodeRef:this.ref[this.state.currentPageKey]},void 0,Iie(Bne,{forwardRef:this.ref[this.state.currentPageKey],continue:this.continue,continueText:e,title:hi[this.state.currentPageKey],callout:gi[this.state.currentPageKey]})),"personalize"===this.state.currentPageKey&&Iie(EI.Z,{classNames:"welcome-page",timeout:Zie,nodeRef:this.ref[this.state.currentPageKey]},void 0,Iie(qne,{forwardRef:this.ref[this.state.currentPageKey],continue:this.continue,continueText:e,title:hi[this.state.currentPageKey],callout:gi[this.state.currentPageKey]})),"tabs"===this.state.currentPageKey&&Iie(EI.Z,{classNames:"welcome-page",timeout:Zie,nodeRef:this.ref[this.state.currentPageKey]},void 0,Iie(fie,{forwardRef:this.ref[this.state.currentPageKey],continue:this.continue,continueText:e,title:hi[this.state.currentPageKey],callout:gi[this.state.currentPageKey]}))),Iie("div",{className:"welcome-navigation"},void 0,this.getFilteredKeys()?.map((e=>Iie("button",{onClick:this.setPage(e),title:hi[e],tabIndex:-1,className:Fi()("nav-page",{"nav-page-current":e===this.state.currentPageKey,"nav-page-completed":e!==this.state.currentPageKey&&t[I.kWelcomeReadPages].includes(e)})},e)))))}}var Nie;function Pie(e,t,n,i){Nie||(Nie="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Nie,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var Die=Pie((0,Bu.Z)(_ie,Tie),{},"welcome"),Mie=Pie(vne,{},"welcome"),Oie=Pie(ZT,{},"experiments"),xie=Pie(DT,{},"guest-intro"),Lie=Pie(v_,{},"private-intro"),Rie=Pie(fT,{},"actionlog"),Bie=Pie(S_,{}),Fie=Pie("div",{},"mailmessage"),Wie=Pie("div",{},"chat"),Uie=Pie(Z_,{});class Vie extends Li.PureComponent{static contextType=ts.Z;refComponent=Li.createRef();focus=()=>{const e=this.refComponent.current,{document:t,HTMLDivElement:n}=this.context;if(!(e instanceof n))return;if(e.contains(t.activeElement))return;const i=e.querySelector('[tabindex="0"]:not(.no-page-focus)');i?.focus()};getComponent=()=>{const{url:e}=this.props;if(pn.jk.matchInternal("welcome",e))return Die;if(pn.jk.matchInternal("themecolors",e))return Mie;if(pn.jk.matchInternal("settings",e))return Pie(u3,{url:e},"settings");if(pn.jk.matchInternal("experiments",e))return Oie;if(pn.jk.matchInternal("guest-intro",e))return xie;if(pn.jk.matchInternal("private-intro",e))return Lie;if(pn.jk.matchInternal("actionlog",e))return Rie;if(pn.jk.matchInternal("saga",e))return Bie;if(pn.jk.matchInternal("mailpage",e)){if(C.Z.get(I.kMailIsTurnedOff))return Pie(OZ,{windowId:this.context.vivaldiWindowId});if(pn.jk.matchUrl(pn.jk.internalUrl("mailpage","composer"),e)){const t=(0,rl.DP)(e);let n;if(t.query)try{const e=JSON.parse(t.query);"object"==typeof e&&e.id&&ht.Z.isInDraftOrOutbox(e.id)&&(n=e.id)}catch(e){console.warn(e)}return Pie(PZ,{pageId:this.props.pageId,searchListId:n,mailto:t.mailto,url:e,isActive:this.props.isActive},"mail")}if(pn.jk.matchUrl(pn.jk.internalUrl("mailpage","message"),e)){let t=-1;const n=(0,rl.DP)(e);if(n.path){const e=n.path.split("/");2===e.length&&(t=parseInt(e[1]))}return t>-1?Pie(FZ,{id:t,isActive:this.props.isActive},"mailmessage"):Fie}return Pie(d_,{id:this.props.pageId,isActive:this.props.isActive},"mailview")}if(pn.jk.matchInternal("chat",e)&&Oi.Z.isEnabled("chat")){const t=new URL(e).searchParams.get("path");t&&t.includes("@");return Wie}return pn.jk.matchInternal("session-recovery",e)?Uie:null};render(){const{isVisible:e,url:t}=this.props;let n=w_.SpeedDial;const i=pn.jk.isStartPage(t);return(0,pn.rl)(t)&&(pn.jk.matchInternal("bookmarks",t)?n=w_.Bookmarks:pn.jk.matchInternal("history",t)?n=w_.History:pn.jk.matchInternal("calendar",t)?n=w_.Calendar:pn.jk.matchInternal("notes",t)&&(n=w_.NotesManager)),(0,ss.jsx)("div",{className:"internal-page",ref:this.refComponent,children:(0,ss.jsxs)(ss.Fragment,{children:[Pie(hne,{open:i&&e||n!==w_.SpeedDial,pageId:this.props.pageId,url:t,view:n,updatePageThumbnailWithActiveWebview:this.props.updatePageThumbnailWithActiveWebview,isActive:this.props.isActive},"startpage"),this.getComponent()]})})}}const Hie=Vie;var Gie=n(7168);const $ie=new class{setUtilityWebView(e,t){A.Z.dispatch({actionType:"UTILITY_WEBVIEW_SET_VIEW",windowId:e,webview:t})}};class Kie extends Li.PureComponent{refWebView=Li.createRef();componentDidMount(){const e=this.refWebView.current;e&&(e.addEventListener("contentload",this.handleContentload),e.addEventListener("contentscreated",this.handleContentscreated),e.addEventListener("createsearch",this.handleCreatesearch),e.addEventListener("contentallowed",this.handleContentallowed),e.addEventListener("contentblocked",this.handleContentblocked),e.addEventListener("dialog",this.handleDialog),e.addEventListener("findupdate",this.handleFindupdate),e.addEventListener("fullscreen",this.handleFullscreen),e.addEventListener("loadabort",this.handleLoadabort),e.addEventListener("loadcommit",this.handleLoadcommit),e.addEventListener("loadprogress",this.handleLoadprogress),e.addEventListener("loadredirect",this.handleLoadredirect),e.addEventListener("loadstart",this.handleLoadstart),e.addEventListener("loadstop",this.handleLoadstop),e.addEventListener("newwindow",this.handleNewwindow),e.addEventListener("pasteandgo",this.handlePasteandgo),e.addEventListener("permissionrequest",this.handlePermissionrequest),e.addEventListener("sslstatechanged",this.handleSslstatechanged),e.addEventListener("targeturlchanged",this.handleTargetUrlChanged),e.addEventListener("windowblocked",this.handleWindowblocked),this.props.discarded&&this.props.isVisible&&se.Z.tabsPrivate.loadViaLifeCycleUnit(this.props.id),se.Z.tabsPrivate.update(this.props.id,{showImages:"never"!==C.Z.get(I.kPageImageLoading),loadFromCacheOnly:"cache"===C.Z.get(I.kPageImageLoading)}))}componentWillUnmount(){const e=this.refWebView.current;e&&(e.removeEventListener("contentload",this.handleContentload),e.removeEventListener("contentscreated",this.handleContentscreated),e.removeEventListener("createsearch",this.handleCreatesearch),e.removeEventListener("contentallowed",this.handleContentallowed),e.removeEventListener("contentblocked",this.handleContentblocked),e.removeEventListener("dialog",this.handleDialog),e.removeEventListener("findupdate",this.handleFindupdate),e.removeEventListener("fullscreen",this.handleFullscreen),e.removeEventListener("loadabort",this.handleLoadabort),e.removeEventListener("loadcommit",this.handleLoadcommit),e.removeEventListener("loadprogress",this.handleLoadprogress),e.removeEventListener("loadredirect",this.handleLoadredirect),e.removeEventListener("loadstart",this.handleLoadstart),e.removeEventListener("loadstop",this.handleLoadstop),e.removeEventListener("newwindow",this.handleNewwindow),e.removeEventListener("pasteandgo",this.handlePasteandgo),e.removeEventListener("permissionrequest",this.handlePermissionrequest),e.removeEventListener("sslstatechanged",this.handleSslstatechanged),e.removeEventListener("targeturlchanged",this.handleTargetUrlChanged),e.removeEventListener("windowblocked",this.handleWindowblocked))}componentDidUpdate(){this.props.discarded&&this.props.isVisible&&se.Z.tabsPrivate.loadViaLifeCycleUnit(this.props.id)}handleContentload=e=>{this.props.onContentLoad?.(e)};handleContentscreated=e=>{this.props.onContentsCreated?.(e)};handleCreatesearch=e=>{this.props.onCreateSearch?.(e)};handleContentallowed=e=>{this.props.onContentAllowed?.(e)};handleContentblocked=e=>{this.props.onContentBlocked?.(e)};handleDialog=e=>{this.props.onDialog?.(e)};handleFindupdate=e=>{this.props.onFindUpdate?.(e)};handleFullscreen=e=>{this.props.onFullscreen?.(e)};handleLoadabort=e=>{this.props.onLoadAbort?.(e)};handleLoadcommit=e=>{this.props.onLoadCommit?.(e)};handleLoadprogress=e=>{this.props.onLoadProgress?.(e)};handleLoadredirect=e=>{this.props.onLoadRedirect?.(e)};handleLoadstart=e=>{this.props.onLoadStart?.(e)};handleLoadstop=e=>{this.props.onLoadStop?.(e)};handleNewwindow=e=>{this.props.onNewWindow?.(e)};handlePasteandgo=e=>{this.props.onPasteAndGo?.(e)};handlePermissionrequest=e=>{this.props.onPermissionRequest?.(e)};handleSslstatechanged=e=>{this.props.onSslStateChanged?.(e)};handleTargetUrlChanged=e=>{this.props.onTargetUrlChanged?.(e)};handleWindowblocked=e=>{this.props.onWindowBlocked?.(e)};canGoBack=()=>!!this.refWebView.current&&this.refWebView.current.canGoBack();canGoForward=()=>!!this.refWebView.current&&this.refWebView.current.canGoForward();executeScript=e=>new Promise(((t,n)=>{this.refWebView.current?.executeScript(e,(e=>{i.Z.runtime.lastError?n(i.Z.runtime.lastError.message):t(e)}))}));reload=()=>{this.refWebView.current?.reload()};stop=()=>{this.refWebView.current?.stop()};sendRequest=(e,t,n,i,s,o)=>{this.refWebView.current?.sendRequest(e,t,n,i,s,o)};render(){return(0,ss.jsx)("webview",{ref:this.refWebView,role:"document",id:this.props.id,tab_id:this.props.id})}}var zie=n(2497);var jie,Yie=n(60339),Xie=n(34155);function Qie(e,t,n,i){jie||(jie="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:jie,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const qie=[I.kMailIsTurnedOff,I.kRssDetectFeeds,I.kWebpagesReaderControls,I.kWebpagesReaderStyle],Jie=(0,Ae.Z)((e=>e()));var ese=Qie(g0,{prefs:!1,filter:""});class tse extends Li.PureComponent{static contextType=ts.Z;captureScheduled=!1;viewUnchangedFlags={};_localStatus=!1;refInternalPage=Li.createRef();refWebview=Li.createRef();nodeRef=Li.createRef();constructor(e){super(e),this.state={draggedLength:null,customData:null,dockingState:"off",undockedIsUnmounted:!0,undockedDevtoolsWindowId:void 0,pendingDockingState:void 0,viewWidth:"auto",viewHeight:"auto",viewTop:0,viewLeft:0,hideInspectedContents:!1,disableWebviewEvents:!1,tabIsFullscreen:!1,mediaState:Gie.Z.getState().get(this.props.id)||(0,ze.l4)()}}componentDidMount(){this.attachEventHandlers(),this.updateFocus(this.props.id,this.props.url),this.props.isActive&&Xie.nextTick((()=>{const e=this.getWebviewElement();e&&$ie.setUtilityWebView(this.context.vivaldiWindowId,e)})),Gie.Z.addListener(this._onMediaStateStoreChanged),(0,pn.cw)(this.props.url)||this.injectScripts(this.props.id)}componentDidUpdate(e,t){const{target:n}=this.props;if(n&&n!==e.target){const{transition:e,fromUrlField:t,postParams:i,headers:s}=n;this.props.url&&Xie.nextTick((()=>{this.refWebview.current?.sendRequest(this.props.url,e,Boolean(t),void 0!==i&&""!==i,i||"",s||"")}))}if(this.props.url!==e.url){let t="",n="";try{t=new URL(e.url).origin}catch(e){}try{n=new URL(this.props.url).origin}catch(e){}t!==n&&Xie.nextTick((()=>{rC.Z.resetPermissions(e.id),rC.Z.resetPageHasBlockedContent(e.id),rC.Z.resetBlockedPopups(e.id)}))}(n&&n!==e.target||e.url!==this.props.url||e.isActive!==this.props.isActive||e.discarded!==this.props.discarded)&&this.updateFocus(this.props.id,this.props.url);const i=this.getWebviewElement();if(i){const t=e.discarded&&!this.props.discarded,n=(!e.isActive||t)&&this.props.isActive;if(n){Xie.nextTick((()=>$ie.setUtilityWebView(this.context.vivaldiWindowId,i)));!this.props.vivExtData.thumbnail&&Xie.nextTick((()=>{this.updatePageThumbnailWithActiveWebview(0)}))}const s=e.isActive&&!this.props.isActive,o=(0,pn.cw)(e.url),a=(0,pn.cw)(this.props.url),r=!o&&a;a||!n&&!o?(s||r)&&Xie.nextTick((()=>{if(this.clearWebview(),this.state.tabIsFullscreen){this.getWebviewElement()?.setIsFullscreen(!1)}})):Xie.nextTick((()=>{const e=this.getWebviewElement();e&&sI.Z.setActiveWebView(this.context.vivaldiWindowId,e)}))}Boolean(this.props.vivExtData.readerMode)!==Boolean(e.vivExtData.readerMode)&&this.refWebview.current?.reload(),this.props.prefValues[I.kWebpagesReaderStyle]!==e.prefValues[I.kWebpagesReaderStyle]&&this.updateReaderStyle(),this.updateViewUnchangedFlag(e,this.props);const s=e.prefValues[I.kRssDetectFeeds],o=!this.props.prefValues[I.kRssDetectFeeds];s&&o&&oi.resetRssFeeds(this.props.id)}componentWillUnmount(){this.state.tabIsFullscreen&&Xie.nextTick((()=>{xi.Z.restoreStateAfterHTMLFullscreen(this.context.vivaldiWindowId)})),this.removeEventHandlers(),se.Z.devtoolsPrivate.closeDevtools(this.props.id,(e=>{})),this.state.undockedDevtoolsWindowId&&xi.Z.close(this.state.undockedDevtoolsWindowId),Xie.nextTick(this.clearWebview),Gie.Z.removeListener(this._onMediaStateStoreChanged),Be.Z.ensureRemovedListener(this.updateReaderStyle)}_onMediaStateStoreChanged=()=>{this.setState({mediaState:Gie.Z.getState().get(this.props.id)||(0,ze.l4)()})};updateReaderStyle=()=>{if(!this.props.vivExtData.readerMode)return;const e={...this.props.prefValues[I.kWebpagesReaderStyle],...Be.Z.getReaderThemeColor(this.context.vivaldiWindowId)};(0,Fn.VN)(this.props.id,{type:"READER_MODE_SET_STYLE",readerStyle:e})};getWebviewElement=()=>this.refWebview.current?.refWebView.current;clearWebview=()=>{const e=this.getWebviewElement();e&&sI.Z.clearIfActive(this.context.vivaldiWindowId,e)};toggleImageInspector=()=>{c.ZP.setImageInspector(this.props.id,this.context.vivaldiWindowId,!this.props.showImageInspector)};updateViewUnchangedFlag=(e,t)=>{e.isActive===t.isActive&&e.vivExtData.tiling===t.vivExtData.tiling||(this.viewUnchangedFlags={})};shouldCaptureThumbnail=()=>C.Z.get(I.kTabsTooltip)||C.Z.get(I.kTabsThumbnails)||C.Z.get(I.kTabsVisualSwitchEnable);updatePageThumbnailWithActiveWebview=e=>{const t=he.ZP.isIncognitoOrGuest(this.context.vivaldiWindowId),n=crypto.randomUUID();this.shouldCaptureThumbnail()&&(this.viewUnchangedFlags[n]=!0===this.props.isActive,setTimeout((()=>{const e=this.getWebviewElement();if(e)if((0,pn.cw)(this.props.url))this.viewUnchangedFlags[n]&&e&&Ho.getPageThumbnail(e,{compact:!0},(e=>{this.props.isActive&&this.viewUnchangedFlags[n]&&e&&c.ZP.setThumbnail(this.props.id,e)}));else{const e={encodeFormat:"jpg",encodeQuality:80,fullPage:!1,width:330,height:270};se.Z.thumbnails.captureTab(this.props.id,e,((e,t)=>{!i.Z.runtime.lastError&&e&&c.ZP.setThumbnail(this.props.id,t)}))}}),e));const{bookmarkThumbnailQueue:s}=this.props.pageContext;if(!t&&s&&s.url===this.props.url){const e=s.bookmarkId;i.Z.bookmarks.get(e,(t=>{if(i.Z.runtime.lastError)console.warn("chrome.bookmarks.get failed:",e,i.Z.runtime.lastError);else{const e=t&&1===t.length?t[0]:null,s=this.getWebviewElement();e&&!e.thumbnail&&s&&Ho.getPageThumbnail(s,{compact:!1},(t=>{t&&(this.props.isActive&&e&&this.viewUnchangedFlags&&this.viewUnchangedFlags[n]?i.Z.bookmarks.update(e.id,{thumbnail:t}):console.warn("Cannot update thumbnail as page was not active"))}))}})),this.props.pageContext.bookmarkThumbnailQueue=void 0}};attachEventHandlers=()=>{No.Z.addListener(this._onWebpageviewStoreChanged),se.Z.devtoolsPrivate.onDockingSizesChanged.addListener(this.onDockingSizesChanged),se.Z.devtoolsPrivate.onDockingStateChanged.addListener(this.onDockingStateChanged),se.Z.devtoolsPrivate.onClosed.addListener(this.onDevtoolsClosed),se.Z.devtoolsPrivate.onDevtoolsUndocked.addListener(this.onDevtoolsUndocked),se.Z.tabsPrivate.onTabIsAttached.addListener(this.onWebViewElementIsAttached),se.Z.tabsPrivate.onTabIsDetached.addListener(this.onWebViewElementIsDetached)};removeEventHandlers=()=>{No.Z.removeListener(this._onWebpageviewStoreChanged),se.Z.devtoolsPrivate.onDockingSizesChanged.removeListener(this.onDockingSizesChanged),se.Z.devtoolsPrivate.onDockingStateChanged.removeListener(this.onDockingStateChanged),se.Z.devtoolsPrivate.onClosed.removeListener(this.onDevtoolsClosed),se.Z.devtoolsPrivate.onDevtoolsUndocked.removeListener(this.onDevtoolsUndocked),se.Z.tabsPrivate.onTabIsAttached.removeListener(this.onWebViewElementIsAttached),se.Z.tabsPrivate.onTabIsDetached.removeListener(this.onWebViewElementIsDetached)};updateNavigationState=(e,t,n)=>{const i={canGoBack:Boolean(this.refWebview.current?.canGoBack()),canGoForward:Boolean(this.refWebview.current?.canGoForward()),isLoading:e,reason:n,trigger:t};rC.Z.setNavigationState(this.props.id,this.context.vivaldiWindowId,i,this.props.pageContext.isUrlFieldFocused)};handleLoadCommit=e=>{if(!e.isTopLevel||void 0===e.url)return;const{url:t}=e;oi.resetRssFeeds(this.props.id),(0,pn.cw)(t)?_e.Z.setFastForwardUrl(this.props.id,""):this.injectScripts(this.props.id);const n=this.getWebviewElement();n&&_e.Z.setRewindInfo(n,this.props.id),this.updateNavigationState(!0,"commit")};handleLoadStart=e=>{if(!e.isTopLevel)return;const{urlForThumbnail:t}=this.props.vivExtData;t!==e.url&&c.ZP.setThumbnail(this.props.id,null),rC.Z.resetPermissions(this.props.id),af.Z.closeFindInPageToolbar(this.context.vivaldiWindowId,this.props.id),this.updateNavigationState(!0,"start"),rC.Z.resetPageHasBlockedContent(this.props.id),rC.Z.resetBlockedPopups(this.props.id),_i.Z.resetTranslationParameters(this.props.id),this.props.pageContext.isUrlFieldFocused||Ov.Z.reset(this.props.id),this.captureScheduled=!1};handleLoadStop=e=>{this.updateNavigationState(!1,"stop"),this.props.vivExtData.thumbnail||this.updatePageThumbnailWithActiveWebview(0),!1===this.captureScheduled&&(this.captureScheduled=!0,this.updatePageThumbnailWithActiveWebview(5e3))};handleLoadRedirected=e=>{if(e.isTopLevel){const t=e.newUrl,n=e.oldUrl;c.ZP.setThumbnail(this.props.id,null),this.captureScheduled=!1;const{bookmarkThumbnailQueue:i}=this.props.pageContext;i&&i.url===n&&(i.url=t)}};handleContentAllowed=({allowedType:e})=>{if("midi"===e||"midi-sysex"===e||"geolocation"===e||"notifications"===e){const t=this.props.url?new URL(this.props.url).origin:"";rC.Z.setPermission(this.props.id,t,e,null,"allowed")}};handleContentBlocked=({blockedType:e})=>{if("popups"!==e&&"sound"!==e&&"notifications"!==e&&"idle-detection"!==e&&"sensors"!==e&&"geolocation"!==e&&"clipboard"!==e)if("midi"===e||"midi-sysex"===e){const t=this.props.url?new URL(this.props.url).origin:"";rC.Z.setPermission(this.props.id,t,e,null,"blocked")}else rC.Z.setPageHasBlockedContent(this.props.id,e)};handleLoadAbort=e=>{e.preventDefault(),e.isTopLevel&&this.updateNavigationState(!1,"abort",e.reason)};handleOnLoadProgress=e=>{if((0,pn.pM)(e.url))return;const t={url:e.url,progress:e.progress,loadedBytes:e.loadedBytes,loadedElements:e.loadedElements,totalElements:e.totalElements,isFetching:!1};(class{static setProgressState(e,t){A.Z.dispatch({actionType:"PAGE_SET_PROGRESS",pageId:e,progressState:t})}}).setProgressState(this.props.id,t)};handleOnFullscreen=e=>{!1===Gie.Z.hasMediaState(this.props.id,"capturing")&&xi.Z.onHTML5FullScreen(e.enterFullscreen,e.windowId),this.setState({tabIsFullscreen:e.enterFullscreen})};handleBlockedPopup=e=>{rC.Z.addBlockedPopupEvent(this.props.id,e)};injectScripts=(0,aC.Z)((e=>{const t=Ce.ZP.getPageById(e),n=this.props.prefValues[I.kRssDetectFeeds];this.refWebview.current?.executeScript({allFrames:!0,code:`window.__vivaldiDetectFeeds = ${n.toString()};\n             window.__vivaldiUseBossSelect = ${C.Z.get(I.kWebpagesAllowSelectionInLinks)};\n             window.__vivaldiUseTranslateSelection =\n                      ${Boolean(t&&!(0,pn.pM)(t.url)).toString()};\n             window.__vivaldiContentScriptsInitialized;`,runAt:"document_start"}).then((e=>{if(e&&e.some((e=>!e)))return this.refWebview.current?.executeScript({file:"inject-root-bundle.js"}).catch((e=>{console.warn("Injecting inject-root-bundle failed:",e)})),this.refWebview.current?.executeScript({allFrames:!0,file:"inject-all-bundle.js"})})).catch((e=>{console.warn("Checking for inject-all-bundle failed:",e)})),this.props.vivExtData.readerMode&&this.injectReaderView()}),400);injectReaderView=()=>{Be.Z.ensureAddedListener(this.updateReaderStyle);const e={code:'/* global chrome */\n\n/* This is the user file part of reader mode, it\'s injected after the\n   browserjs part of reader mode and does the real injecetion\n   (browserjs only does detection at an earlier stage so that we don\'t\n   need to wait for the page to load to update the indicator status of\n   the readability of the page */\nconst FEATURE_HIDE_PAGE = true;\n/* Hide page on load for better transition while navigating */\n\nconst AVERAGE_READ_WORDS = 225;\nconst DEFAULT_CHAR_THRESHOLD = 300; // Readability default is 500\n// Class names to preserve in the readerized output. We preserve these class\n// names so that rules in aboutReader.css can match them.\n\nconst CLASSES_TO_PRESERVE = ["caption", "emoji", "hidden", "invisible", "sr-only", "visually-hidden", "visuallyhidden", "wp-caption", "wp-caption-text", "wp-smiley"];\n\nfunction canSetStyle() {\n  return document && document.documentElement && document.documentElement.style;\n} // TODO: not working after delaying injection in the browserjs part of reader view\n\n\nif (FEATURE_HIDE_PAGE && canSetStyle()) {\n  document.documentElement.style.display = "none";\n}\n\nconst DEBUG_READABILITY = false;\nconst readabilityCss = `\nhtml {\n  margin: 0;\n  padding: 0;\n}\nbody {\n  color: #111111;\n  background-color: #f6f6f6;\n  font-family: sans-serif;\n  font-size: 1.3em;\n  font-style: normal;\n  font-weight: 400;\n  line-height: 1.5;\n  margin: 0 auto;\n  padding: 40px 10px 80px;\n  text-orientation: upright;\n  transition:\n    color 200ms cubic-bezier(0.4, 0, 1, 1),\n    background-color 200ms cubic-bezier(0.4, 0, 1, 1);\n}\nbody.vertical {\n  margin: 40px auto 0;\n  padding: 40px 60px 0;\n  max-height: calc(100vh - 120px);\n}\n.entry-content * {\n  max-width: 100%;\n  line-height: inherit;\n  vertical-align: baseline;\n  background: transparent;\n}\n.entry-content p {\n  margin: 1.5em 0;\n}\nbody.vertical .entry-content p {\n  margin: 0 1.5em;\n}\nh1 {\n  font-size: 1.8em;\n  line-height: 1.35;\n}\nh1, h2, h3, h4, h5, h6, b {\n  font-weight: 700;\n}\nhr {\n  border-style: solid;\n  border-width: 0 0 0.5px 0.5px;\n}\n.byline,\n.figcaption {\n  font-style: italic;\n}\n.entry-content img {\n  max-width: 100%;\n  height: auto;\n}\nbody.vertical .entry-content img {\n  max-height: 100%;\n  width: auto;\n}\n.entry-content code {\n  font-weight: 500;\n}\n.entry-content pre {\n  font-weight: 300;\n  background-color: rgba(128, 128, 128, 0.05);\n  border: 1px solid rgba(128, 128, 128, 0.1);\n  white-space: pre-wrap;\n  padding: 0.5em;\n  margin: 1.5em 0;\n}\n.entry-content code, .entry-content pre {\n  text-align: left;\n  max-width: 100%;\n  writing-mode: horizontal-tb;\n  overflow: auto;\n  white-space: pre-wrap;\n}\nbody.vertical .entry-content pre {\n  margin: 0 1.5em;\n  max-width: 80%;\n  max-height: 100%;\n}\nblockquote {\n  border-left: 2px solid currentColor;\n  padding-left: 1em;\n  margin-left: 0;\n}\nblockquote p {\n  font-style: italic;\n}\niframe, textarea, input {\n  display: none;\n}\n\n.entry-content img.wp-smiley,\n.entry-content img.emoji {\n  display: inline-block;\n  border-width: 0;\n  width: 1em;\n  margin: 0 .07em;\n  padding: 0;\n}\n\n.entry-content .visually-hidden,\n.entry-content .visuallyhidden,\n.entry-content .sr-only {\n  display: inline-block;\n  width: 1px;\n  height: 1px;\n  margin: -1px;\n  overflow: hidden;\n  padding: 0;\n  border-width: 0;\n}\n\n.entry-content .caption,\n.entry-content .wp-caption-text,\n.entry-content figcaption {\n  font-size: 0.9em;\n  line-height: 1.48em;\n  font-style: italic;\n}\n`;\n\nfunction __vivaldiGetHTML(article) {\n  const content = window.DOMPurify.sanitize(article.content);\n  const words = article.textContent.split(" ").filter(elem => {\n    return elem.length && !/\\r?\\n|\\r/.test(elem);\n  });\n  const readingTime = Math.round(words.length / AVERAGE_READ_WORDS);\n  const _ = window.Translate;\n\n  const readText = _("Read time: $1 minute", "Read time: $1 minutes", [readingTime]);\n\n  const byline = article.byline ? `${article.byline} — ` : "";\n  const textDir = article.dir ?? "auto";\n  return `<!DOCTYPE html>\n<html><head>\n<title>${article.title}</title>\n<style>${readabilityCss}</style>\n</head><body>\n<h1>${article.title}</h1>` + `<p class="byline">${byline} ${readText}</p>` + `<hr />\n<article class="entry-content" dir="${textDir}">${content}</article>\n</body></html>`;\n}\n\nfunction ready() {\n  if (typeof document !== "undefined" && ["complete", "loaded", "interactive"].indexOf(document.readyState) > -1) {\n    return true;\n  }\n\n  return false;\n}\n\nlet _numTriesLeft = 5;\n\nfunction onLoad() {\n  if (!window["Readability"] && _numTriesLeft-- > -1) {\n    setTimeout(onLoad, 500);\n  }\n\n  try {\n    if (!window["Readability"]) {\n      return;\n    } // TODO: should probably reuse this object when enabling, instead\n    // of running it again via the user script\n\n\n    const {\n      Readability\n    } = window;\n    const readability = new Readability(document.cloneNode(true), {\n      classesToPreserve: CLASSES_TO_PRESERVE,\n      charThreshold: DEFAULT_CHAR_THRESHOLD,\n      debug: DEBUG_READABILITY\n    });\n    const isProbablyReaderable = window.isProbablyReaderable(document);\n    let article;\n\n    if (isProbablyReaderable) {\n      article = readability.parse();\n    } else {\n      console.log("[readability] Probably not readable");\n    }\n\n    if (DEBUG_READABILITY) {\n      console.log("isReadable?", isProbablyReaderable, "article:", article);\n    }\n\n    if (article) {\n      // VB-22288 Cancel unload events\n      document.beforeunload = () => {};\n\n      document.unload = () => {};\n\n      const reader = document.implementation.createHTMLDocument(document.title);\n      reader.documentElement.innerHTML = __vivaldiGetHTML(article);\n      document.replaceChild(reader.documentElement, document.documentElement);\n\n      if (chrome && chrome.runtime && chrome.runtime.sendMessage) {\n        chrome.runtime.sendMessage({\n          type: "READER_MODE_UPDATE_STYLE"\n        });\n      }\n    } else {\n      console.log("[readability] Nothing to show");\n    }\n  } finally {\n    // The page is rendered with display: none, so need to ensure this\n    // is always called\n    if (FEATURE_HIDE_PAGE && canSetStyle()) {\n      document.documentElement.style.display = "block";\n    }\n  }\n}\n\nif (ready()) {\n  onLoad();\n} else {\n  window.addEventListener("DOMContentLoaded", onLoad, false);\n}',runAt:"document_start"};this.refWebview.current?.executeScript(e).catch(Lr.Z)};onNewPopup=e=>{e.targetUrl||(e.targetUrl=p.f4);const t=he.ZP.isIncognito(this.context.vivaldiWindowId);de.Z.openNewPopAsTabOrWindow(this.context.vivaldiWindowId,e,t)};handleOnNewWindow=e=>{const t=he.ZP.isPopup(this.context.vivaldiWindowId);let n=t?0:this.context.vivaldiWindowId;const i=he.ZP.isIncognito(this.context.vivaldiWindowId);if(t)for(const[e]of he.ZP.getState()){if(i&&he.ZP.isIncognitoOrGuest(e)&&he.ZP.isTabbedBrowser(e)){n=e;break}if(he.ZP.isTabbedBrowser(e)){n=e;break}}let s=e.windowOpenDisposition;switch(0===n&&(s=i?"off_the_record":"new_window"),s){case"current_tab":case"new_foreground_tab":e.preventDefault(),e.window.accept(n+";1");break;case"new_background_tab":e.preventDefault(),e.window.accept(n+";0");break;case"off_the_record":case"new_window":e.preventDefault();const t="off_the_record"===e.windowOpenDisposition?{incognito:!0,transition:se.Z.historyPrivate.TransitionType.LINK}:{};xi.Z.openBrowserWindow(this.context.vivaldiWindowId,e.targetUrl,t);break;case"new_popup":e.preventDefault(),this.onNewPopup(e)}};showDialog=e=>{e.webview=this.getWebviewElement(),this.setState({customData:e})};handleOnCloseDialog=()=>{this.setState({customData:null})};handleOnJavascriptDialog=e=>{e.preventDefault(),e.dialogtype="javascript",e.url.startsWith(p.Fv)?se.Z.extensionActionUtils.getToolbarExtensions((t=>{const{url:n}=e,i=n?.replace(p.Fv,"").split("/")[0],s=t.filter((e=>e.id===i))[0]?.name;this.showDialog({...e,url:s})})):this.showDialog(e)};handleOnPermissionRequest=e=>{e.preventDefault();const t=e.url?new URL(e.url).origin:"";switch(e.permission){case"geolocation":case"idle_detection":case"clipboard":case"microphone":case"microphone_and_camera":case"midi":case"midi-sysex":case"camera":case"notifications":case"protocol_handling":rC.Z.setPermission(this.props.id,t,e.permission,e.request,"undecided",e.protocolDisplayName,e.suppressedPrompt);break;case"pointerLock":e.request.allow(),e.dialogtype=e.permission,this.showDialog(e);break;case"download":if(e.suggestedFilename.endsWith(".ics")&&!C.Z.get(I.kMailIsTurnedOff)&&C.Z.get(I.kCalendarHandleIcsDownloads))e.request.allow("open");else if(C.Z.get(I.kDownloadsStartAutomatically)&&!1===e.mixedDownload){if(e.request.allow(),C.Z.get(I.kDownloadsOpenPanelOnNew)){const e=this.context.vivaldiWindowId;Qf.ZP.isComponentVisible("DownloadButton",e)?ne.Z.executeActions("event",this.context,"COMMAND_SHOW_DOWNLOADS_POPOUT"):Yn.ZP.canAutoOpen(e,"PanelDownloads")&&jn.Z.toggleContent(e,"PanelDownloads")}}else e.dialogtype=e.permission,this.showDialog(e);break;case"media":e.request.allow();break;default:e.dialogtype=e.permission,this.showDialog(e)}};handleOnSSLStateChanged=e=>{if(e.SSLState){const t={state:e.SSLState,issuer:e.issuerstring};rC.Z.setSSLState(this.props.id,t)}};handleOnTargetURLChanged=e=>{const t=(0,aS.ZP)(e.newUrl);u.Z.setStatus(this.context.vivaldiWindowId,t),this._localStatus=!0};handleOnCreateSearch=e=>{e.dialogtype="createSearch",this.showDialog(e)};handleOnPasteAndGo=e=>{e.preventDefault();const t={ctrlKey:e.modifiers.includes("ctrl"),shiftKey:e.modifiers.includes("shift"),altKey:e.modifiers.includes("alt"),metaKey:!1},n=this.context.vivaldiWindowId,i=e.clipBoardText,s=(0,La.ZP)(n,t);"search"===e.pasteTarget&&af.Z.doAction(n,this.props.id,"searchPasteAndGo",{clipboardText:i,openOptions:s}),"url"===e.pasteTarget&&af.Z.doAction(n,this.props.id,"urlPasteAndGo",{clipboardText:i,openOptions:s})};handleOnContentsCreated=()=>{(0,pn.cw)(this.props.url)||this.injectScripts(this.props.id)};_onWebpageviewStoreChanged=e=>{if(e.pageId!==this.props.id)return;const t=this.getWebviewElement();switch(e.type){case"WEBPAGEVIEW_CLOSE_FIND_IN_PAGE":return t?.stopFinding("keep"),void this.focusWebView(this.props.url);case"WEBPAGEVIEW_GO":return this.props.vivExtData.readerMode&&c.ZP.setReaderState(e.pageId,!1),void t?.go(e.index);case"WEBPAGEVIEW_BACK":return this.props.vivExtData.readerMode&&c.ZP.setReaderState(e.pageId,!1),void t?.back();case"WEBPAGEVIEW_FORWARD":return this.props.vivExtData.readerMode&&c.ZP.setReaderState(e.pageId,!1),void t?.forward();case"WEBPAGEVIEW_GET_HISTORY":return void t?.getPageHistory(e.callback);case"WEBPAGEVIEW_STOP":{const e=Ev.getNavigationInfo(this.props.id);return void((!e||e&&e.isLoading)&&this.refWebview.current?.stop())}case"WEBPAGEVIEW_RELOAD":return void(this.props.id===e.pageId&&i.Z.tabs.reload(e.pageId,{bypassCache:e.bypassCache}));case"WEBPAGEVIEW_ACTIONS":switch(e.action){case"focusWebView":return void this.focusWebView(this.props.url);case"pageScrollUp":return void this.pageScrollUp();case"pageScrollDown":return void this.pageScrollDown();case"pageScrollTop":return void this.pageScrollTop();case"pageScrollBottom":return void this.pageScrollBottom();case"print":{const e=this.context.vivaldiWindowId,n=pw.Z.getActiveWebView(e);return void(n===t?se.Z.utilities.print(e):n&&n.print())}}}};focusWebView=e=>{(0,pn.cw)(e)?this.refInternalPage.current?.focus():this.getWebviewElement()?.focus()};pageScrollUp=()=>{const e=Ce.ZP.getActivePage(this.context.vivaldiWindowId);e&&se.Z.tabsPrivate.scrollPage(e.id,"pageup",0,(()=>{i.Z.runtime.lastError&&console.warn("vivaldi.tabsPrivate.scrollPage failed: "+(i.Z.runtime.lastError.message||""))}))};pageScrollDown=()=>{const e=Ce.ZP.getActivePage(this.context.vivaldiWindowId);e&&se.Z.tabsPrivate.scrollPage(e.id,"pagedown",0,(()=>{i.Z.runtime.lastError&&console.warn("vivaldi.tabsPrivate.scrollPage failed: "+(i.Z.runtime.lastError.message||""))}))};pageScrollTop=()=>{const e=Ce.ZP.getActivePage(this.context.vivaldiWindowId);e&&se.Z.tabsPrivate.scrollPage(e.id,"top",0,(()=>{i.Z.runtime.lastError&&console.warn("vivaldi.tabsPrivate.scrollPage failed: "+(i.Z.runtime.lastError.message||""))}))};pageScrollBottom=()=>{const e=Ce.ZP.getActivePage(this.context.vivaldiWindowId);e&&se.Z.tabsPrivate.scrollPage(e.id,"bottom",0,(()=>{i.Z.runtime.lastError&&console.warn("vivaldi.tabsPrivate.scrollPage failed: "+(i.Z.runtime.lastError.message||""))}))};onKeyDown=e=>{"Escape"===e.key&&af.Z.closeFindInPageToolbar(this.context.vivaldiWindowId,this.props.id)&&e.preventDefault()};onMouseDown=()=>{c.ZP.activateTab(this.props.id,this.context.vivaldiWindowId)};onMouseLeave=()=>{this._localStatus&&(this._localStatus=!1,u.Z.clearStatus(this.context.vivaldiWindowId))};updateDockingSizes_=e=>{se.Z.devtoolsPrivate.getDockingStateSizes(e,(e=>{const t=e.hideInspectedContents,n=e.inspectedHeight,i=e.inspectedLeft,s=e.inspectedTop,o=e.inspectedWidth;se.Z.zoom.getVivaldiUIZoom((e=>this.setState({hideInspectedContents:t,viewWidth:o/e,viewHeight:n/e,viewTop:s/e,viewLeft:i/e,disableWebviewEvents:!0},(()=>{this._eventGuard&&clearTimeout(this._eventGuard),this._eventGuard=setTimeout((()=>{this.setState({disableWebviewEvents:!1})}),300)}))))}))};onDockingSizesChanged=e=>{e===this.props.id&&this.updateDockingSizes_(e)};onDockingStateChanged=(e,t)=>{e===this.props.id&&this.state.dockingState!==t&&("undocked"===this.state.dockingState?this.setState({pendingDockingState:t}):this.setState({dockingState:t}),c.ZP.setPageInspected(e,this.context.vivaldiWindowId,"off"!==t))};onDevtoolsClosed=e=>{e===this.props.id&&(this.setState({dockingState:"off",viewWidth:"auto",viewHeight:"auto",viewTop:0,viewLeft:0}),c.ZP.setPageInspected(e,this.context.vivaldiWindowId,!1))};onDevtoolsWindowClosed=e=>{if(this.state.pendingDockingState){const e=this.state.pendingDockingState;this.setState((t=>({pendingDockingState:void 0,dockingState:e})))}else se.Z.devtoolsPrivate.closeDevtools(e,(e=>{}));c.ZP.setPageInspected(e,this.context.vivaldiWindowId,!1)};onDevtoolsUndocked=(e,t,n)=>{e===this.props.id&&this.setState({dockingState:"undocked"},(async()=>{const t={bounds:{left:n.left,top:n.top,width:n.right-n.left,height:n.bottom-n.top},focused:!0,windowDecoration:!0,incognito:he.ZP.isIncognitoOrGuest(this.context.vivaldiWindowId),windowKey:"DevToolsUndocked_"+e.toString()},i=await xi.Z.openWindow(this.context.vivaldiWindowId,"devtools.html","devtools",t),s=(0,zie.Z)(i);if(s){s.vivaldiInspectTabId=e,s.vivaldiWindowId=this.context.vivaldiWindowId,this.setState({undockedIsUnmounted:!1,undockedDevtoolsWindowId:i});const t=n=>{n===i&&(this.setState({undockedIsUnmounted:!0,undockedDevtoolsWindowId:void 0}),this.onDevtoolsWindowClosed(e),se.Z.windowPrivate.onWindowClosed.removeListener(t))};se.Z.windowPrivate.onWindowClosed.addListener(t)}}))};onWebViewElementIsAttached=(e,t)=>{const{id:n,isActive:i,url:s}=this.props,o=this.getWebviewElement();e===n&&o&&i&&!(0,pn.cw)(s)&&sI.Z.setActiveWebView(t,o)};onWebViewElementIsDetached=(e,t)=>{e===this.props.id&&this.clearWebview()};updateFocus=(e,t)=>{if(!this.props.discarded)if(this.props.isActive){const e=this.nodeRef.current;e instanceof Node&&e.contains(this.activeElement)?Jie((()=>{this.activeElement&&(this.activeElement.focus(),delete this.activeElement)})):this.props.pageContext.isUrlFieldFocused||function({winId:e,pageId:t,url:n,activeElement:i}){if(Ce.ZP.getPageInWindow(e,t)?.isMailPage)return"";if(pr.getCapturingState(e))return"capture";if(Wp.Z.getStateForPage(t).selectedEvent)return"calendarEditor";if("quick-command-search"===i?.className)return"quickCommands";let s=!1;try{s=!0===No.Z.getFindResultsForPage(t).isFindInPageToolbarOpen}catch(e){console.warn(e)}return!0===s?"findInPage":""}({winId:this.context.vivaldiWindowId,pageId:this.props.id,url:t,activeElement:this.activeElement||this.context.document.activeElement})||Jie((()=>this.focusWebView(t)))}else this.activeElement=this.context.document.activeElement};_onFindInPage=(e,t)=>{af.Z.findInPage(this.context.vivaldiWindowId,this.props.id,e,t)};_onFindNextInPage=(e,t,n)=>{af.Z.findNextInPage(this.context.vivaldiWindowId,this.props.id,e,t,n)};render(){const e=this.props.supportsReaderMode,t=this.props.vivExtData.readerMode&&e&&!(0,pn.cw)(this.props.url),n=Ce.ZP.isDisplayingImage(this.props.id),i="off"!==this.state.dockingState&&!(0,pn.cw)(this.props.url),s="auto"===this.state.viewWidth||0===this.state.viewWidth?"100%":this.state.viewWidth+this.state.viewLeft,o=0!==this.state.viewWidth,a=0!==this.state.viewHeight,r=this.state.mediaState.has("recording")||this.state.mediaState.has("capturing"),l={visibility:r||this.props.isVisible?"inherit":"hidden",zIndex:this.props.isVisible?"initial":"-1",opacity:this.props.isVisible?1:0};if(this.state.tabIsFullscreen&&r){const e=1920,t=1080,n=this.props.contentWidth/e;l.transform=`scale(${n})`,l.left=(this.props.contentWidth-e)/2,l.top=(this.props.contentHeight-t)/2,l.width=e,l.height=t,l.position="absolute"}const d=Number(this.props.id),c=(0,pn.cw)(this.props.url),u=Fi()("webpageview",{active:this.props.isActive,internal:c,tiled:(0,Yie.Qz)(this.props.id),visible:this.props.isVisible,pagefocusstop:this.props.isVisible});return Qie(Lu,{level:"tabs"},void 0,(0,ss.jsxs)("div",{ref:this.nodeRef,className:u,style:l,"data-id":this.props.id,tabIndex:"-1",onKeyDown:this.onKeyDown,onMouseLeave:this.onMouseLeave,onMouseDown:this.onMouseDown,children:[t&&this.props.prefValues[I.kWebpagesReaderControls]&&!(i&&"undocked"!==this.state.dockingState)&&ese,!n&&!(0,pn.Gp)(this.props.url)&&Qie(PI,{isActive:this.props.isActive,pageId:this.props.id,onFindInPage:this._onFindInPage,onFindNextInPage:this._onFindNextInPage}),Qie(uI,{tabId:d}),Qie(SI,{url:this.props.url}),Qie("div",{className:"row-wrapper"},void 0,Qie("div",{className:"devtools-container"},void 0,Qie(fI,{active:this.props.isActive,tabId:d,dockingState:c?"off":this.state.dockingState,undockedIsUnmounted:this.state.undockedIsUnmounted}),Qie("div",{className:"webpage",style:i?{top:this.state.viewTop,left:this.state.viewLeft,width:o?this.state.viewWidth:"none",height:a?this.state.viewHeight:"none",pointerEvents:this.state.disableWebviewEvents?"none":null}:null},void 0,(0,ss.jsx)(Kie,{ref:this.refWebview,id:d,pinned:this.props.pinned,discarded:this.props.discarded,isVisible:this.props.isVisible,onContentsCreated:this.handleOnContentsCreated,onCreateSearch:this.handleOnCreateSearch,onContentAllowed:this.handleContentAllowed,onContentBlocked:this.handleContentBlocked,onDialog:this.handleOnJavascriptDialog,onFullscreen:this.handleOnFullscreen,onLoadAbort:this.handleLoadAbort,onLoadCommit:this.handleLoadCommit,onLoadProgress:this.handleOnLoadProgress,onLoadRedirect:this.handleLoadRedirected,onLoadStart:this.handleLoadStart,onLoadStop:this.handleLoadStop,onNewWindow:this.handleOnNewWindow,onPasteAndGo:this.handleOnPasteAndGo,onPermissionRequest:this.handleOnPermissionRequest,onSslStateChanged:this.handleOnSSLStateChanged,onTargetUrlChanged:this.handleOnTargetURLChanged,onWindowBlocked:this.handleBlockedPopup})),(0,ss.jsx)(Hie,{ref:this.refInternalPage,pageId:this.props.id,url:this.props.url,isVisible:this.props.isVisible,isActive:this.props.isActive,updatePageThumbnailWithActiveWebview:this.updatePageThumbnailWithActiveWebview}),n&&!this.props.showImageInspector&&Qie("button",{className:"inspector",title:(0,B.Z)("Image Properties"),style:{left:s},onClick:this.toggleImageInspector,dangerouslySetInnerHTML:{__html:Wi.GH$}})),n&&Qie(pT,{url:this.props.url,open:this.props.showImageInspector,toggleImageInspector:this.toggleImageInspector}),this.props.isActive&&this.state.customData&&Qie(Pu,{customData:this.state.customData,closeDialog:this.handleOnCloseDialog}))]}))}}const nse=(0,Bu.Z)(tse,qie);var ise=n(34155);function sse(e,t){return function(n){n.stopPropagation(),ose(e,t.vivaldiWindowId)}}function ose(e,t){let n;n="content"===e?function(e){const t=Ce.ZP.getActivePage(e);return t?.isMailPage?"mail":t?.url&&pn.jk.getDisplayUrlFromMapping(t.url).startsWith("vivaldi://calendar")?"calendar":"browser"}(t):"panel"===e?function(e){switch(Yn.ZP.getSelected(e)){case"PanelMail":case"PanelFeeds":case"PanelContacts":return"mail";case"PanelTasks":case"PanelCalendar":return"calendar";default:return"browser"}}(t):"browser";const i={actionType:"SWITCH_CONTEXT",context:{area:e,feature:n},windowId:t};A.Z.isDispatching()?ise.nextTick((()=>A.Z.dispatch(i))):A.Z.dispatch(i)}var ase,rse=n(34155);function lse(e,t,n,i){ase||(ase="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:ase,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const dse=[I.kAddressBarAutocompleteEnabled,I.kAddressBarExtensionsVisible,I.kAddressBarExtensionsRenderInDropdown,I.kAddressBarExtensionsShowAllToggle,I.kAddressBarInlineSearchEnabled,I.kAddressBarPosition,I.kAddressBarSearchSuggestEnabled,I.kAddressBarShowQrGenerator,I.kPopupsShowInTab,I.kKeyboardTabToAll,I.kAddressBarSearchShowFavicon,I.kAddressBarAutocompleteAutocompleteOnTitle,I.kAddressBarOmniboxShowSearchHistory,I.kAddressBarOmniboxShowSyncTabs,I.kAddressBarOmniboxShowTypedHistory,I.kPrivacyPartnersExceptionsDismissed];function cse(e){return{blockedPageContent:Ev.getblockedPageContents(e),blockedPopups:Ev.getBlockedPopupsById(e),permissionInfo:Ev.getPermissionsById(e),sslInfo:Ev.getSSLInfo(e),trigger:Ev.getNavigationInfo(e).trigger}}function use(e){if(!e)return;const t=ai.Z.getByQuery(e);if(!t||!t.keyword)return;return e.substring(t.keyword.length)?t:void 0}function pse(e){const{blockedPageContent:t,blockedPopups:n,permissionInfo:i,sslInfo:s,trigger:o}=cse(e),{selectedItem:a,typedUrl:r}=rb.getUrlfieldState(e);return{prevPageId:e,blockedPageContent:t,blockedPopups:n,permissionInfo:i,sslInfo:s,trigger:o,selectedItem:a,typedUrl:r,feeds:OA.getFeeds(e)}}function hse(e){const t=g.Z.findByUrl(e);return{prevPageUrl:e,bookmarkData:t?{...t}:void 0}}class gse extends Li.PureComponent{static contextType=ts.Z;#m;refPageloadProgress=Li.createRef();refPopupBlockerNotificator=Li.createRef();urlBarRef=Li.createRef();passwordElm=Li.createRef();siteInfoElm=Li.createRef();refUrlField=Li.createRef();constructor(e,t){super(e),this.state={isBaseDomainObscured:!1,createBookmarkCallout:!1,showPasswordIcon:!1,defaultSearchEngine:ai.Z.getDefault(he.ZP.isIncognito(t.vivaldiWindowId)),defaultTypedHistory:[],syncedTabs:[],...pse(e.id),...hse(e.url)},this.trackContextOnFocus=sse("tabBar",t)}static getDerivedStateFromProps(e,t){const n={};return e.id!==t.prevPageId&&Object.assign(n,pse(e.id)),e.url!==t.prevPageUrl&&Object.assign(n,hse(e.url)),n}componentDidUpdate(e,t){const n=e.id!==this.props.id;n&&this.hideDropdown(),n&&this.props.pageContext.isUrlFieldFocused&&Jie((()=>(0,Dv.i6)(this.context)))}componentDidMount(){this.#m=!0,g.Z.addListener(this._onBookmarkStoreChanged),No.Z.addListener(this._onWebpageviewStoreChanged),rb.addListener(this._onUrlFieldStoreChanged,(e=>e.get(this.props.id))),Ev.addListener(this._onNavigationStoreChanged),ai.Z.addListener(this._onSearchEngineCacheChanged),se.Z.windowPrivate.onPositionChanged.addListener(this._onWindowPositionChanged),se.Z.utilities.onPasswordIconStatusChanged.addListener(this.togglePasswordIcon),i.Z.history.onVisited.addListener(this.updateDefaultTypedHistory),i.Z.history.onVisitRemoved.addListener(this.updateDefaultTypedHistory),OA.addListener(this._onRssDetectStoreChanged),se.Z.sync.onCycleCompleted.addListener(this.onSyncCycleCompleted),pe.addListener(this.onVivaldiAccountChange),this.onSyncCycleCompleted(),this.props.pageContext.isUrlFieldFocused&&Jie((()=>(0,Dv.i6)(this.context))),this.updateDefaultTypedHistory()}componentWillUnmount(){this.#m=!1,g.Z.removeListener(this._onBookmarkStoreChanged),No.Z.removeListener(this._onWebpageviewStoreChanged),rb.removeListener(this._onUrlFieldStoreChanged),Ev.removeListener(this._onNavigationStoreChanged),ai.Z.removeListener(this._onSearchEngineCacheChanged),se.Z.windowPrivate.onPositionChanged.removeListener(this._onWindowPositionChanged),se.Z.utilities.onPasswordIconStatusChanged.removeListener(this.togglePasswordIcon),i.Z.history.onVisited.removeListener(this.updateDefaultTypedHistory),i.Z.history.onVisitRemoved.removeListener(this.updateDefaultTypedHistory),OA.removeListener(this._onRssDetectStoreChanged),se.Z.sync.onCycleCompleted.removeListener(this.onSyncCycleCompleted),pe.removeListener(this.onVivaldiAccountChange)}getUrlFragments=gs()(Ty.dO);getReaderContextMenu=()=>{const e=this.context.vivaldiWindowId;return[{handler:()=>de.Z.showSettings(e,"webpages"),isVisible:()=>!he.ZP.isGuest(),...(0,us.Z)("Configure Reader View")}]};_setBookmarkedState=(0,Ae.Z)((e=>{if(!this.#m)return;const t=g.Z.findByUrl(e);this.setState({bookmarkData:t?{...t}:void 0})}),100);_onUrlFieldStoreChanged=()=>{const{selectedItem:e,typedUrl:t}=rb.getUrlfieldState(this.props.id);this.setState({selectedItem:e,typedUrl:t})};_onNavigationStoreChanged=()=>{const e=cse(this.props.id);if(this.state.blockedPageContent===e.blockedPageContent&&this.state.blockedPopups===e.blockedPopups&&this.state.permissionInfo===e.permissionInfo&&this.state.sslInfo===e.sslInfo&&this.state.trigger===e.trigger)return;const t=()=>{this.setState({blockedPageContent:e.blockedPageContent,blockedPopups:e.blockedPopups,permissionInfo:e.permissionInfo,sslInfo:e.sslInfo,trigger:e.trigger})};this.state.permissionInfo===e.permissionInfo?t():setTimeout(t,200)};_onSearchEngineCacheChanged=()=>{this.setState({defaultSearchEngine:ai.Z.getDefault(he.ZP.isIncognito(this.context.vivaldiWindowId))})};_onRssDetectStoreChanged=()=>{const e=OA.getFeeds(this.props.id);this.state.feeds!==e&&this.setState({feeds:e})};onSyncCycleCompleted=async()=>{this.props.prefValues[I.kAddressBarOmniboxShowSyncTabs]&&!he.ZP.isIncognitoOrGuest(this.context.vivaldiWindowId)&&this.setState({syncedTabs:await dS()})};onVivaldiAccountChange=()=>{const e=ce(pe.getState());"loggedIn"===e?this.onSyncCycleCompleted():"loggedOut"===e&&this.setState({syncedTabs:[]})};selectAddressField=()=>{this.#m&&(0,Dv.i6)(this.context)};focusAddressField=()=>{this.#m&&(0,Dv.x0)(this.context)};blurAddressField=()=>{this.#m&&((0,Dv.gR)(this.context),rse.nextTick((()=>{this.hideDropdown()})))};_onBookmarkStoreChanged=()=>{this._setBookmarkedState(this.props.url)};_onWebpageviewStoreChanged=e=>{e.winId===this.context.vivaldiWindowId&&("WEBPAGEVIEW_ACTIONS"===e.type?"focusAddressField"===e.action?(this.onCloseCreateBookmarkCallout(),rse.nextTick((()=>{this.focusAddressField(),this.selectAddressField()}))):"urlPasteAndGo"===e.action&&e.payload&&this.urlPasteAndGo(e.payload):"WEBPAGEVIEW_URLFIELD_BLUR"===e.type&&rse.nextTick((()=>this.hideDropdown())))};urlPasteAndGo=async e=>{const{HTMLInputElement:t}=this.context,{clipboardText:n}=e;if(!n)return;const i=this.refUrlField.current?._urlInput.current?.refUrlInput.current?.inputField.current;i instanceof t&&(await oy.Z.go(this.context.vivaldiWindowId,[n],{transition:se.Z.historyPrivate.TransitionType.TYPED,fromUrlField:!0,addTypedSearchHistory:!1,enableSearch:!0,...e.openOptions}),this.blurAddressField())};onPasswordFocus=e=>{se.Z.utilities.isDialogOpen("password",(e=>{se.Z.utilities.focusDialog("password",(e=>{}))}))};compareProtocol=e=>{if((0,rl.C3)(e)&&(0,rl.Zj)(e)&&this.props.url&&nI(e)===nI(this.props.url)){const t=(0,ge.Z)(this.props.url),n=(0,ge.Z)(e);if(n&&t&&(n.protocol=t.protocol,(0,rl.K2)(n.href)))return n.href}return e};handleUrlFieldSubmit=async({url:e,options:t})=>{const n=use(this.state.typedUrl),i=Boolean(n||this.props.prefValues[I.kAddressBarInlineSearchEnabled]);n||(e=this.compareProtocol(e)),await oy.Z.go(this.context.vivaldiWindowId,[e],{...t,enableSearch:i,addTypedSearchHistory:!1})};easterEggNavigation=async()=>{const e=rb.getUrlfieldState(this.props.id);if(!e||!e.autocompleteValue&&!e.typedUrl)return;const t=e?.autocompleteValue||e?.typedUrl||"";this.hideDropdown(),await oy.Z.go(this.context.vivaldiWindowId,[pn.jk.getUrl(t)],{enableSearch:!0,transition:se.Z.historyPrivate.TransitionType.TYPED,addTypedSearchHistory:!1})};onSiteInfoButtonFieldGo=()=>{this.easterEggNavigation(),(0,Dv.gR)(this.context)};showPasswordDialog=()=>{se.Z.utilities.showPasswordDialog(this.context.vivaldiWindowId)};onUrlFieldDrop=e=>{const t=this.context.vivaldiWindowId,n=e.dataTransfer;if(!n)return;const i=zi.ZP.extractUriListFromEvent(e);if(i.length>0){const e=i.split("\n");e.length>0&&oy.Z.go(t,e)}else{const e=n.getData("text/plain");e.length>0&&((0,rl.K2)(e)?oy.Z.go(t,[e]):(sb.updateState(this.props.id,{typedUrl:e}),this.focusAddressField()))}};togglePasswordIcon=(e,t)=>{e===this.context.vivaldiWindowId&&this.setState((e=>({showPasswordIcon:t})))};updateDefaultTypedHistory=()=>{se.Z.historyPrivate.getTypedHistory("",50).then((e=>{const t=jb(e);this.setState({defaultTypedHistory:t})}))};setUrlDragEvent=e=>{e.stopPropagation();const{document:t,devicePixelRatio:n,vivaldiWindowId:i}=this.context,s=t.createElement("img");s.src=this.props.favIconUrl||"/resources/default_favicon_64.png",s.width=32,s.height=32,e.dataTransfer.setDragImage(s,s.width*n,s.height*n),s.remove();const o=Ce.ZP.getActivePage(i),a=this.state.typedUrl??this.props.url;Za(e,a,o?.title??""),e.dataTransfer.effectAllowed="all"};onReaderModeClicked=()=>{c.ZP.setReaderState(this.props.id,!this.props.isReaderModeActive)};onCreateBookmarkCallout=()=>{this.props.active&&this.props.url&&this.setState({createBookmarkCallout:!0})};onCloseCreateBookmarkCallout=()=>{this.setState({createBookmarkCallout:!1})};onPopupAllowed=e=>{rC.Z.removeBlockedPopup(this.props.id,e.targetUrl),this.refPopupBlockerNotificator.current?.onDialogClosed(),this.openNewPopAsTabOrWindow(e)};openNewPopAsTabOrWindow=e=>{const t=he.ZP.isIncognito(this.context.vivaldiWindowId);de.Z.openNewPopAsTabOrWindow(this.context.vivaldiWindowId,e,t)};hideDropdown=()=>{this.refUrlField.current?.hideDropdown()};toggleTypedHistory=e=>{e.preventDefault(),this.refUrlField.current?.toggleTypedHistory(e)};_storeDialogAnchorRect=(e,t)=>{const n="top"===this.props.prefValues[I.kAddressBarPosition]?"down":"up";se.Z.zoom.getVivaldiUIZoom((i=>{se.Z.utilities.setDialogPosition(t,this.context.vivaldiWindowId,{left:Math.round(e.left*i),top:Math.round(e.top*i),width:Math.round(e.width*i),height:Math.round(e.height*i)},n)}))};_updateDialogPositions=()=>{const e=this.passwordElm.current;if(e){const t=e.getRect();t&&this._passwordPopupPos!==t&&(this._passwordPopupPos=t,this._storeDialogAnchorRect({left:t.left,top:t.top,width:t.width,height:t.height},"password"))}const{Element:t}=this.context,n=this.siteInfoElm.current?.refSiteInfoButton.current;if(n instanceof t){const e=n.getBoundingClientRect();this._permissionPopupPos!==e&&(this._permissionPopupPos=e,this._storeDialogAnchorRect({left:e.left,top:e.top,width:e.width,height:e.height},"permission"))}i.Z.windows.get(this.context.vivaldiWindowId,{},(e=>{if(!i.Z.runtime.lastError){let{left:t=0,top:n=0,width:i,height:s}=e;i=i||0,s=s||0,this._storeDialogAnchorRect({left:Math.round(t+i/2),top:Math.round(n+s/2),width:0,height:0},"chromecast")}}))};_onWindowPositionChanged=e=>{e===this.context.vivaldiWindowId&&this._sendBatchedUpdatedBounds()};_sendBatchedUpdatedBounds=()=>{this._resizeDelayRunning||(this._resizeDelayRunning=!0,setTimeout((()=>{this._updateDialogPositions(),this._resizeDelayRunning=!1}),500))};onUrlbarResized=e=>{this._sendBatchedUpdatedBounds()};onSetBookmarked=e=>i.Z.bookmarks.create(e).then((t=>(de.Z.showBookmarkAddedPopup(he.ZP.getLastActiveBrowserWindowId(),{pageId:this.props.id,url:e.url??"",isActive:!0}),t)));blurUnfocused=e=>{this.context.document.activeElement!==this.refUrlField.current&&"Escape"===e.key&&(e.stopPropagation(),e.preventDefault(),this.refUrlField.current?._onEscPressed())};onBaseDomainObscured=e=>{this.setState({isBaseDomainObscured:e})};getOffsetWidth=()=>this.urlBarRef.current?.offsetWidth??0;getPlaceholderUrlFieldText=()=>this.props.prefValues[I.kAddressBarInlineSearchEnabled]?ai.Z.systemDefaultEngineChanged()?(0,B.Z)("Search $1 [NEW] or enter an address",[this.state.defaultSearchEngine?.name??""]):(0,B.Z)("Search $1 or enter an address",[this.state.defaultSearchEngine?.name??""]):(0,B.Z)("Enter an address");render(){const{preview:e=!1}=this.props;if(e)return(0,ss.jsx)("input",{type:"text",className:"AddressField",name:"AddressField",value:(0,B.Z)("url","Address"),...(0,dp.uu)({draggable:this.props.draggable,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,onDragEnter:this.props.onDragEnter,onDragOver:this.props.onDragOver,onDragLeave:this.props.onDragLeave,onDrop:this.props.onDrop}),readOnly:!0});const{isBaseDomainObscured:t,defaultTypedHistory:n,feeds:i,syncedTabs:s,trigger:o}=this.state,{prefValues:a,url:r}=this.props,l=use(this.state.typedUrl),d=n.length>0?(0,B.Z)("Show typed history"):(0,B.Z)("Enter an address to activate typed history"),c=(0,B.Z)("Save your password"),u=a[I.kAddressBarOmniboxShowTypedHistory]&&!0!==this.props.readonly,p=this.props.menuOrigin||"bottomLeft",h=this.props.popupPosition||"below",m=this.getUrlFragments(this.props.url),f=(0,aS.gC)(m),v=function(e){return Boolean(e)&&!pn.jk.isInternalUrl(e)&&!pn.jk.isNewTabPage(e)}(r),y=pn.jk.isInternalUrl(r)||r.startsWith("chrome://"),b=(0,rl.tn)(r,m),S=(0,rl.C3)(escape(r))&&!(y||(0,rl.Sc)(r)||b),w="commit"===o||"start"===o,C=(0,zi.TR)(r),A=g.Z.getRootId()&&void 0!==this.props.id&&C;return(0,ss.jsxs)("div",{ref:this.urlBarRef,className:Fi()("UrlBar-AddressField urlfield-anchor",this.props.buttonClasses,h),name:"AddressField",onFocus:this.trackContextOnFocus,...(0,dp.uu)({draggable:this.props.draggable,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,onDragEnter:this.props.onDragEnter,onDragOver:this.props.onDragOver,onDragLeave:this.props.onDragLeave,onDrop:this.props.onDrop}),onKeyDown:this.blurUnfocused,children:[lse("div",{className:"toolbar toolbar-small toolbar-insideinput"},void 0,!y&&lse(MC,{blockerVisible:S,position:h,tabIndex:a[I.kKeyboardTabToAll],pageId:this.props.id,url:r,exceptionDismissed:this.props.prefValues[I.kPrivacyPartnersExceptionsDismissed]>0}),(0,ss.jsx)(HA,{ref:this.siteInfoElm,draggable:!y,isInternal:y,isLocal:b,isLoading:w,onDragStart:this.setUrlDragEvent,fieldGo:this.onSiteInfoButtonFieldGo,sslState:this.state.sslInfo.state,tabIndex:a[I.kKeyboardTabToAll],typedUrl:this.state.typedUrl,displayUrl:f,selectedItem:this.state.selectedItem})),lse("div",{className:"UrlBar-UrlFieldWrapper"},void 0,lse(Yi.Z,{className:"observer",onResize:this.onUrlbarResized},void 0,(0,ss.jsx)(ZS,{ref:this.refUrlField,getOffsetWidth:this.getOffsetWidth,onBaseDomainObscured:this.onBaseDomainObscured,urlFragments:m,onSubmit:this.handleUrlFieldSubmit,className:"UrlBar-UrlField url vivaldi-addressfield uifocusstop",typedUrl:this.state.typedUrl,displayUrl:f,selectedItem:this.state.selectedItem,pageId:this.props.id,pageContext:this.props.pageContext,onUrlDrag:this.setUrlDragEvent,autoFocus:!1,autocompletionEnabled:a[I.kAddressBarAutocompleteEnabled],typedHistoryEnabled:a[I.kAddressBarOmniboxShowTypedHistory],onDrop:this.onUrlFieldDrop,placeholder:this.getPlaceholderUrlFieldText(),showDropdown:!0,autocompleteOnTitle:a[I.kAddressBarAutocompleteAutocompleteOnTitle],defaultSearchEngine:this.state.defaultSearchEngine,typedSearchEngine:l,readonly:this.props.readonly,defaultTypedHistory:n,syncedTabs:s}))),lse("div",{className:"toolbar toolbar-small toolbar-insideinput"},void 0,t&&lse("div",{title:(0,B.Z)("Caution!\nThe entire domain name cannot be shown. Make sure you trust this website before submitting data."),className:"UrlBar-UrlObfuscationWarning",dangerouslySetInnerHTML:{__html:Wi.Si$.small}}),(0,ss.jsx)(VC,{pageId:this.props.id,ref:this.refPageloadProgress,open:!y}),lse(yA,{pageId:this.props.id,pagePermissions:this.state.permissionInfo,popupPosition:h}),this.state.blockedPopups.size>0&&(0,ss.jsx)(TA,{ref:this.refPopupBlockerNotificator,url:r,blockedPopups:this.state.blockedPopups,onPopupAllowed:this.onPopupAllowed,popupPosition:h}),this.state.blockedPageContent.length>0&&lse(gC,{pageId:this.props.id,url:r,position:h,blockedPageContent:this.state.blockedPageContent}),i&&i.length>0&&lse(PA,{feeds:i}),this.state.showPasswordIcon&&(0,ss.jsx)(po.ZP,{ref:this.passwordElm,className:"password-icon",tooltip:c,onClick:this.showPasswordDialog,image:Wi.hXX,tabIndex:0,onFocus:this.onPasswordFocus}),!y&&this.props.supportsReaderMode&&lse(po.ZP,{menu:this.getReaderContextMenu,menuOrigin:p,isPressed:this.props.isReaderModeActive,image:Wi.sWI,onClick:this.onReaderModeClicked,tooltip:(0,B.Z)("Reader View"),commandId:"COMMAND_READERVIEW_TOGGLE"}),v&&a[I.kAddressBarShowQrGenerator]&&lse(_A,{popupPosition:h,size:this.props.size,data:r}),v&&lse(tI,{popupPosition:h,size:this.props.size,tabId:this.props.id,url:r}),A&&lse(Yo,{setBookmarked:this.onSetBookmarked,pageId:this.props.id,bookmarkData:this.state.bookmarkData,popupPosition:h},r),u&&lse("div",{className:"button-toolbar drop-down-menu"},void 0,lse("button",{title:d,tabIndex:a[I.kKeyboardTabToAll],disabled:0===n.length,onMouseDown:this.toggleTypedHistory,dangerouslySetInnerHTML:{__html:Wi.yaZ.small}})))]})}}const mse=(0,Bu.Z)((0,dp.ZP)(gse),dse);var fse,vse=n(34155);function yse(e,t,n,i){fse||(fse="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:fse,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const bse="select-search-history",Sse=[I.kAddressBarSearchDisplay,I.kAddressBarSearchFieldWidth,I.kAddressBarSearchInNewTab,I.kAddressBarSearchKeepSelected,I.kAddressBarSearchShowFavicon,I.kAddressBarSearchShowKeyword,I.kAddressBarSearchSuggestEnabled,I.kAddressBarSearchTypedHistoryEnabled,I.kAddressBarVisible,I.kKeyboardTabToAll,I.kStartpageSpeedDialTrackerSuggestionShow,I.kAddressBarSearchKeepTypedText];function wse({disabled:e,tabIndex:t,onMouseDown:n,onClick:i,ariaExpanded:s}){return yse("div",{className:"toolbar toolbar-insideinput ignore-react-onclickoutside"},void 0,yse("div",{className:"button-toolbar drop-down-menu"},void 0,yse("button",{disabled:e,tabIndex:t,title:(0,B.Z)("Show search history"),"aria-label":(0,B.Z)("Show search history"),onMouseDown:n,onClick:i,dangerouslySetInnerHTML:{__html:Wi.yaZ.medium},roles:"button combobox","aria-haspopup":"menu","aria-expanded":s,"aria-controls":bse})))}function Cse({onClick:e,tabIndex:t}){return yse("div",{className:"toolbar toolbar-insideinput"},void 0,yse("div",{className:"button-toolbar drop-down-menu"},void 0,yse("button",{type:"submit",onMouseDown:e=>e.preventDefault(),tabIndex:t,title:(0,B.Z)("verb","Search"),className:"SearchField-ExecuteSearchButton ignore-react-onclickoutside",onClick:e,dangerouslySetInnerHTML:{__html:Wi.S$A.small}})))}class Ase extends Li.PureComponent{static contextType=ts.Z;_isPasting=!1;_nav=new Jb(this);_isIMEOpen=!1;_justClosedIME=!1;_isOnSpeedDial="speed_dial_view"===this.props.origin;_refSearchField=Li.createRef();_omniDropdownRef=Li.createRef();_suppressReplace=!1;state={dropdownSelectionIndex:0,editText:sC.getText(this.context.vivaldiWindowId),typedValue:"",filteredTypedHistoryStore:[],isOmniDropdownOpen:!1,searchSuggestionStore:[],directMatchItem:void 0,showAll:!1,showPopup:!1,searchEngineSelectItems:[],typedHistoryStore:[],currentSearchEngine:void 0,selectedItem:void 0,numberOfSelectableItems:0,isSearchEngineSelectOpen:!1};componentDidMount(){this._onSearchEngineCacheChanged(),this._onSearchFieldStoreChanged(),ai.Z.addListener(this._onSearchEngineCacheChanged),sC.addListener(this._onSearchFieldStoreChanged),No.Z.addListener(this._onWebpageviewStoreChanged)}componentWillUnmount(){ai.Z.removeListener(this._onSearchEngineCacheChanged),sC.removeListener(this._onSearchFieldStoreChanged),No.Z.removeListener(this._onWebpageviewStoreChanged)}_onWebpageviewStoreChanged=e=>{e.winId===this.context.vivaldiWindowId&&"WEBPAGEVIEW_ACTIONS"===e.type&&("searchPasteAndGo"===e.action?e.payload&&this.context.document.activeElement===this._refSearch&&vse.nextTick((()=>this._pasteAndGo(e.payload))):"focusSearchField"===e.action&&("button"===this.props.prefValues[I.kAddressBarSearchDisplay]&&this.toggleHiddenSearchFieldPopup(),vse.nextTick(this.focusField)))};_pasteAndGo=({openOptions:e,clipboardText:t})=>{this._search({value:t,openOptions:e})};_onSearchEngineCacheChanged=()=>{this.setState(((e,t)=>{const n=ai.Z.get().map((e=>({name:e.name,faviconUrl:e.faviconUrl,shortcut:e.keyword,noPrettifying:!0,id:e.guid}))),i=t.prefValues[I.kAddressBarSearchKeepSelected],s=he.ZP.isIncognito(this.context.vivaldiWindowId);let o;return o=this._isOnSpeedDial&&i?ai.Z.getSpeeddialsSearch(s):ai.Z.getSearchField(s),{currentSearchEngine:o,searchEngineSelectItems:n}}))};_onSearchFieldStoreChanged=()=>{const{document:e}=this.context,t=sC.getTypedHistory(),n={};if(n.typedHistoryStore=t,e.activeElement===this._refSearch){const e=sC.getText(this.context.vivaldiWindowId),i=e.trim()&&t.filter((t=>t.url.toLowerCase().startsWith(e.toLowerCase())))||[];n.editText=e,n.filteredTypedHistoryStore=i}this.setState(n)};_onCompositionStart=()=>{this._isIMEOpen=!0};_onCompositionEnd=()=>{this._isIMEOpen=!1,this._justClosedIME=!0};_updateCurrentEngine=e=>{this.setState({currentSearchEngine:e},(()=>{if(this.props.prefValues[I.kAddressBarSearchKeepSelected]){const t=he.ZP.isIncognitoOrGuest(this.context.vivaldiWindowId),n=this._isOnSpeedDial?t?"defaultSpeeddialsPrivate":"defaultSpeeddials":t?"defaultSearchFieldPrivate":"defaultSearchField";se.Z.searchEngines.setDefault(n,e.guid)}}))};_search=({value:e,openOptions:t})=>{const{document:n}=this.context;this._abortController&&this._abortController.abort(),this._protectedSearchSuggest.cancel&&this._protectedSearchSuggest.cancel(),this._refSearch&&n.activeElement===this._refSearch&&this._refSearch.blur();const{typedValue:i,directMatchItem:s}=this.state,o=e===s?.url,a=this.props.prefValues[I.kAddressBarSearchKeepTypedText],r=o?i:e,l={editText:r};a||(l.editText="",l.typedValue=""),this.setState(l),ri.Z.setText(this.context.vivaldiWindowId,a?r:"");let d=!t||!1!==t.inCurrent;this.props.prefValues[I.kAddressBarSearchInNewTab]&&(this._isOnSpeedDial||(d=!1));const c=s&&(s.url===e||s.title===e),u={...t,inCurrent:d,addTypedSearchHistory:!c};if(s&&c&&t)return void this.directMatchSearch(s,{...t,fromUrlField:!1});const p=ai.Z.getByQuery(i);if(e=vS(e,p),p&&this._updateCurrentEngine(p),e.length>0&&this.state.currentSearchEngine){this.onSearch(e,this.state.currentSearchEngine,u);const t=he.ZP.isIncognito(this.context.vivaldiWindowId),n=ai.Z.getSearchField(t);!this.props.prefValues[I.kAddressBarSearchKeepSelected]&&n&&this._updateCurrentEngine(n)}};onSearch=(e,t,n={})=>{oy.Z.goSearchUrl(this.context.vivaldiWindowId,e.trim(),{useSearchEngine:t,...n}),this._hideDropdown()};directMatchSearch=(e,t)=>{Tb(e,this.context.vivaldiWindowId,t),this._hideDropdown()};onKeyDowned=e=>{this._justClosedIME=!1;const t=e.shiftKey&&!e.ctrlKey&&!e.altKey&&!e.metaKey,n=!(0,ps.Z)(e),{isOmniDropdownOpen:i}=this.state;switch(e.key){case"ArrowUp":return void(i&&(0,ms.ZP)(e));case"ArrowDown":return void(t&&this.onKeyPressed(e));case"Tab":if(!i)return;return n&&((0,ms.ZP)(e),vse.nextTick(this._nav.down)),void(t&&((0,ms.ZP)(e),vse.nextTick(this._nav.up)));case"Escape":return(0,ms.ZP)(e),"button"===this.props.prefValues[I.kAddressBarSearchDisplay]&&this.props.prefValues[I.kAddressBarVisible]||this.setState((e=>({editText:e.typedValue}))),void this._esc();case"Enter":return void(n||this.onKeyPressed(e))}};onExecuteSearchButtonClick=e=>{const t={ctrlKey:e.ctrlKey,altKey:!1,shiftKey:e.shiftKey||e.altKey,metaKey:e.metaKey},n=(0,La.ZP)(this.context.vivaldiWindowId,t),i=this.state.selectedItem?this.state.selectedItem.url||"":this.state.typedValue;this._search({value:i,openOptions:n})};onKeyPressed=e=>{const{key:t,shiftKey:n,currentTarget:i}=e;switch(t){case"Enter":{this._justClosedIME=!1,this._abortController&&this._abortController.abort(),this._protectedSearchSuggest.cancel&&this._protectedSearchSuggest.cancel();const t={ctrlKey:e.ctrlKey,altKey:!1,shiftKey:e.shiftKey||e.altKey,metaKey:e.metaKey},n=(0,La.ZP)(this.context.vivaldiWindowId,t);return void this._search({value:i.value,openOptions:n})}case"ArrowDown":if(!n)return;return void(this.state.typedHistoryStore.length>0&&this.props.prefValues[I.kAddressBarSearchTypedHistoryEnabled]&&this._showDropdown({showAll:!0}));case"Tab":return void this._hideDropdown()}};onSearchEngineChanged=e=>{const t=this._refSearch?this._refSearch.value:"";this._refSearch&&""===t&&this._refSearch.focus();const n=ai.Z.getByGuid(e);if(t.length>0&&n){const e={addTypedSearchHistory:!0,inCurrent:!0!==this.props.prefValues[I.kAddressBarSearchInNewTab]};this.onSearch(t,n,e)}n&&this._updateCurrentEngine(n),this.setState({searchSuggestionStore:[],directMatchItem:void 0,isSearchEngineSelectOpen:!1})};onTypedSearchHistoryDeleted=e=>{e.url?ri.Z.deleteTypedSearchHistory(e.url,-1):e.when&&ri.Z.deleteTypedSearchHistory("",e.when)};_showDropdown=e=>{if(!0===this._isPasting)return;const{document:t}=this.context;let n=e?.showAll;if("boolean"!=typeof n&&(n=!1),this.setState({showAll:n}),!this.state.isOmniDropdownOpen){this._refSearch&&t.activeElement!==this._refSearch&&this._refSearch.focus();const e=this.getDropdownItems(n).flatMap((e=>e.items));this.setState({isOmniDropdownOpen:!0,selectedItem:e[0]},(()=>{this.setAutocompleteHighlight(0,!0)}))}};_hideDropdown=()=>{this.state.isOmniDropdownOpen&&this.setState({selectedItem:void 0,isOmniDropdownOpen:!1,showAll:!1,searchSuggestionStore:[],directMatchItem:void 0})};componentDidUpdate(e,t){t.dropdownSelectionIndex!==this.state.dropdownSelectionIndex&&this._nav.setSelectionIndex(this.state.dropdownSelectionIndex);const n=(this.state.showAll?this.state.typedHistoryStore.length:this.state.filteredTypedHistoryStore.length)+this.state.searchSuggestionStore.length+(this.state.directMatchItem?1:0)+1;this._nav.setNumberOfSelectableItems(n)}getDropdown=()=>this._omniDropdownRef.current;setAutocompleteHighlight=(e,t)=>{this.setState({dropdownSelectionIndex:e}),t&&this.setState((e=>({editText:e.selectedItem&&e.selectedItem.url||e.editText})))};_esc=()=>{if(this._isIMEOpen||this._justClosedIME)this._justClosedIME=!1;else{if(this.state.isOmniDropdownOpen)this._hideDropdown();else if(this.state.isSearchEngineSelectOpen)this.closeSearchEngineSelect();else if(this.state.editText)this.setState({typedValue:""}),ri.Z.setText(this.context.vivaldiWindowId,"");else{this.state.showPopup&&this.hideSearchField(),this.onBlur();const e=Ce.ZP.getActivePage(this.context.vivaldiWindowId);e&&af.Z.doAction(this.context.vivaldiWindowId,e.id,"focusWebView")}this._justClosedIME=!1}};_onDelete=()=>{this.state.selectedItem&&this.onTypedSearchHistoryDeleted(this.state.selectedItem)};_onKeyboardChanged=(e,t,n,i)=>{if(t&&0===n)switch(i){case xa.Z.KEY_DOWN:if(this._isIMEOpen)return;!0===this.state.isOmniDropdownOpen?this._nav.down():this.setState({isSearchEngineSelectOpen:!0});break;case xa.Z.KEY_UP:this._isIMEOpen||this._nav.up();break;case xa.Z.KEY_END:this.setAutocompleteHighlight(this.state.numberOfSelectableItems-1,!0);break;case xa.Z.KEY_ESCAPE:"button"===this.props.prefValues[I.kAddressBarSearchDisplay]&&this.props.prefValues[I.kAddressBarVisible]||this.context.document.activeElement===this._refSearch||this._esc();break;case xa.Z.KEY_HOME:this.setAutocompleteHighlight(0,!0);break;case xa.Z.KEY_PAGE_DOWN:this._nav.pageDown();break;case xa.Z.KEY_PAGE_UP:this._nav.pageUp();break;case xa.Z.KEY_DELETE:this._onDelete()}};onFocus=()=>{se.Z.tabsPrivate.onKeyboardChanged.addListener(this._onKeyboardChanged)};onBlur=()=>{const{getSelection:e}=this.context,t=e();t&&t.empty(),se.Z.tabsPrivate.onKeyboardChanged.removeListener(this._onKeyboardChanged)};onMouseDown=e=>{const{document:t}=this.context;this._focusedOnMouseDown=t.activeElement};onMouseUp=({currentTarget:e})=>{const{document:t}=this.context;t.activeElement===e&&(this._focusedOnMouseDown!==this._refSearch&&e.selectionStart===e.selectionEnd&&e.select(),this._focusedOnMouseDown=void 0)};onDoubleClick=e=>{(0,ms.ZP)(e)};onPaste=e=>{this._isPasting=!0,setTimeout((()=>this._isPasting=!1),5)};_protectedSearchSuggest=(0,aC.Z)(((e,t,n)=>{this._abortController&&this._abortController.abort();const i=use(t),s=i?vS(t,i):t;this._abortController=new AbortController,Xb({windowId:e,query:s,searchEngine:i??n,typedSearchEngine:i,abortController:this._abortController}).then((e=>{this.setState({searchSuggestionStore:e},(()=>this._showDropdown()))}))}),500,{leading:!1});_updateDirectMatchItems(e){Zb(e,this._refSearchField.current?.offsetWidth??0).then((e=>{const t=e[0];this.setState({directMatchItem:t},(()=>{this.state.directMatchItem&&this._showDropdown()}))}))}onChange=({currentTarget:{value:e}})=>{ri.Z.setText(this.context.vivaldiWindowId,e);const t=e.length>0&&e.indexOf(" ")>=1?ai.Z.getByQuery(e):null;t&&this.setState({currentSearchEngine:t});if(!(e.trim().length>1))return void this.setState({searchSuggestionStore:[],directMatchItem:void 0,dropdownSelectionIndex:0,typedValue:e,selectedItem:void 0});const n={dropdownSelectionIndex:0,typedValue:e,showAll:!1};this.state.typedValue.length<e.length&&(n.selectedItem=void 0),this.props.prefValues[I.kAddressBarSearchSuggestEnabled]?this.state.currentSearchEngine&&this._protectedSearchSuggest(this.context.vivaldiWindowId,e,this.state.currentSearchEngine):n.searchSuggestionStore=[],C.Z.get(I.kAddressBarSearchDirectMatchEnabled)?this._updateDirectMatchItems(e):n.directMatchItem=void 0,this.setState(n)};onDragStart=e=>{this._suppressReplace=!0};onDragOver=e=>{e.stopPropagation()};onDragEnter=e=>{if(e.stopPropagation(),this._suppressReplace)return;e.preventDefault();const{HTMLInputElement:t}=this.context,n=e.target;n instanceof t&&""!==n.value&&n.classList.add("pseudo-selected")};onDragLeave=e=>{if(!this._suppressReplace){const{HTMLInputElement:t}=this.context,n=e.target;n instanceof t&&n.classList.remove("pseudo-selected")}};onDropped=e=>{if(this._suppressReplace)this._suppressReplace=!1;else{const t=e.dataTransfer.getData("text/plain");""!==t&&(e.preventDefault(),this.setState({editText:t}),ri.Z.setText(this.context.vivaldiWindowId,t));const{HTMLInputElement:n}=this.context,i=e.target;i instanceof n&&i.classList.remove("pseudo-selected")}};onToggleDropdownClicked=e=>{if(e.preventDefault(),"click"!==e.type||0===e.clientX||0===e.clientY)return this.state.isOmniDropdownOpen?void this._hideDropdown():(this._onSearchFieldStoreChanged(),void this._showDropdown({showAll:!0}))};onSlidebarPosition=(e,t)=>{if(this._refSearchField.current){const t=this._refSearchField.current.getBoundingClientRect();w.Z.set(I.kAddressBarSearchFieldWidth,Math.floor(t.right-e))}};getWidth=()=>(0,Gw.Z)(this.props.prefValues[I.kAddressBarSearchFieldWidth],175,800);focusField=()=>{this._refSearch?.select()};onOmniDropdownItemClicked=(e,t)=>{this._search({value:e.url,openOptions:t})};onContextMenu=e=>{e.stopPropagation()};setSelectedItem=e=>{const t=e&&e.url?"OMNI_RESULT_DIRECT_MATCH"===e.type?e.title:e.url:"";this.setState({selectedItem:e,editText:t})};getDropdownItems=e=>{const t=e?this.state.typedHistoryStore:this.state.filteredTypedHistoryStore,{typedValue:n,directMatchItem:i}=this.state;return[{items:n.length?[{id:n,type:"OMNI_TYPE_SEARCH",url:n,text:n,faviconType:"img",faviconUrl:"",isDeleteDisabled:!0}]:[],type:"SEARCH"},{items:i?[i]:[],type:"DIRECT_MATCH"},{items:t,type:"TYPED_HISTORY"},{items:this.props.prefValues[I.kAddressBarSearchSuggestEnabled]?this.state.searchSuggestionStore.map((e=>({...e,isDeleteDisabled:!0}))):[],type:"SUGGESTIONS"}]};renderDropdown=()=>{const e=this.getDropdownItems(this.state.showAll);return 0===e.length?null:(0,ss.jsx)(zb,{hideIcons:!0,defaultSearchEngine:this.state.currentSearchEngine,onDeleteItem:this.onTypedSearchHistoryDeleted,onLinkItemClicked:this.onOmniDropdownItemClicked,pattern:this.state.editText,ref:this._omniDropdownRef,selectionIndex:this.state.dropdownSelectionIndex,items:e,onMenuClosed:this._hideDropdown,id:bse})};toggleSearchEngineSelectOpen=()=>{this.setState((e=>({isSearchEngineSelectOpen:!e.isSearchEngineSelectOpen,isOmniDropdownOpen:!1})))};closeSearchEngineSelect=()=>{this.setState({isSearchEngineSelectOpen:!1}),"button"!==this.props.prefValues[I.kAddressBarSearchDisplay]&&this.focusField()};hideSearchField=()=>{this.setState({showPopup:!1})};toggleHiddenSearchFieldPopup=()=>{this.setState((e=>({showPopup:!e.showPopup})))};renderSearchField(){const{inEditor:e=!1}=this.props;if(e)return(0,ss.jsx)("input",{type:"text",value:(0,B.Z)("verb","Search"),name:"SearchField",...(0,dp.uu)({draggable:this.props.draggable,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,onDragEnter:this.props.onDragEnter,onDragOver:this.props.onDragOver,onDragLeave:this.props.onDragLeave,onDrop:this.props.onDrop}),readOnly:!0});const t=this.state.currentSearchEngine,n=t&&t.name?ai.Z.systemDefaultEngineChanged()?(0,B.Z)("Search $1 [NEW]",[t.name]):(0,B.Z)("Search $1",[t.name]):"",i=0===this.state.typedHistoryStore.length,s=Boolean(this.state.typedValue),o=!s&&this.props.prefValues[I.kAddressBarSearchTypedHistoryEnabled],a=this.props.popupPosition||"below";return(0,ss.jsxs)("div",{ref:this._refSearchField,className:Fi()(this.props.buttonClasses,this.props.className,"iconmenu-container","SearchField",a),name:"SearchField",...(0,dp.uu)({draggable:this.props.draggable,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,onDragEnter:this.props.onDragEnter,onDragOver:this.props.onDragOver,onDragLeave:this.props.onDragLeave,onDrop:this.props.onDrop}),onContextMenu:this.onContextMenu,style:{"--SearchFieldWidth":this.getWidth()},children:[!this._isOnSpeedDial&&"button"!==this.props.prefValues[I.kAddressBarSearchDisplay]&&yse(Zm.Z,{className:"SearchField-SlideBar",onSlidebarPosition:this.onSlidebarPosition,offset:2,position:"left"}),yse(Rw,{onItemClicked:this.onSearchEngineChanged,items:this.state.searchEngineSelectItems,isOpen:this.state.isSearchEngineSelectOpen,onClose:this.closeSearchEngineSelect,toggleOpen:this.toggleSearchEngineSelectOpen,icon:this.state.currentSearchEngine?this.state.currentSearchEngine.faviconUrl:"",useFavicon:this.props.prefValues[I.kAddressBarSearchShowFavicon],showKeywords:this.props.prefValues[I.kAddressBarSearchShowKeyword]}),(0,ss.jsx)("input",{role:o?"combobox":"searchbox","aria-autocomplete":o?"both":void 0,"aria-controls":bse,"aria-expanded":this.state.isOmniDropdownOpen,"aria-activedescendant":Bb+this.state.dropdownSelectionIndex,ref:e=>this._refSearch=e,className:"vivaldi-searchfield searchfield-input",onBlur:this.onBlur,onChange:this.onChange,autoFocus:!this._isOnSpeedDial&&"button"===this.props.prefValues[I.kAddressBarSearchDisplay],onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onDoubleClick:this.onDoubleClick,onDragEnter:this.onDragEnter,onDragStart:this.onDragStart,onDragOver:this.onDragOver,onDragLeave:this.onDragLeave,onDrop:this.onDropped,onFocus:this.onFocus,onKeyDown:this.onKeyDowned,onKeyPress:this.onKeyPressed,onCompositionStart:this._onCompositionStart,onCompositionUpdate:this._onCompositionStart,onCompositionEnd:this._onCompositionEnd,onPaste:this.onPaste,placeholder:n,tabIndex:this._isOnSpeedDial?0:null,type:"search",value:this.state.editText}),this.state.isOmniDropdownOpen&&this.renderDropdown(),s&&yse(Cse,{onClick:this.onExecuteSearchButtonClick,tabIndex:this.props.prefValues[I.kKeyboardTabToAll]}),o&&yse(wse,{disabled:i,tabIndex:this.props.prefValues[I.kKeyboardTabToAll],onMouseDown:this.onToggleDropdownClicked,onClick:this.onToggleDropdownClicked,ariaExpanded:this.state.isOmniDropdownOpen})]})}render(){if("button"===this.props.prefValues[I.kAddressBarSearchDisplay]&&!this._isOnSpeedDial||this.props.forceIcon){const{size:e="large"}=this.props;return yse(po.ZP,{image:Wi.YvR[e],label:(0,B.Z)("Search Field"),tooltip:(0,B.Z)("Show Search Field"),onClick:this.toggleHiddenSearchFieldPopup,customizeMenu:this.props.customizeMenu,menuOrigin:this.props.menuOrigin,popupPosition:this.props.popupPosition,draggable:this.props.draggable,onDragStart:this.props.onDragStart??Lr.Z,onDragEnd:this.props.onDragEnd??Lr.Z,onDragEnter:this.props.onDragEnter,onDragOver:this.props.onDragOver,onDragLeave:this.props.onDragLeave,onDrop:this.props.onDrop??Lr.Z,hidePopup:this.hideSearchField,isPopupVisible:this.state.showPopup,popupWidth:210,hasLightArrow:!0,size:e,popupClassName:"SearchField-Popup",popupLabel:(0,B.Z)("dialog title","Search Field"),mimeType:this.props.mimeType,name:this.props.name},void 0,this.renderSearchField())}return this.renderSearchField()}}const Ise=(0,Bu.Z)((0,dp.ZP)(Ase),Sse);var Tse;function Zse(e,t,n,i){Tse||(Tse="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Tse,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class Ese extends Li.Component{static contextType=ts.Z;state={taskInfo:this.props.taskInfo};onContextMenu=e=>{const{taskInfo:t}=this.props;(0,cs.Z)(this.context,t.menuItems)};render(){const{taskInfo:e}=this.props;return Zse("p",{className:"button-toolbar-small in-progress",id:e.id,title:e.title+"\n"+e.description,onContextMenu:this.onContextMenu},void 0,this.state.taskInfo.text)}}const kse=Ese;var _se;function Nse(e,t,n,i){_se||(_se="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:_se,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class Pse extends Li.PureComponent{state={backgroundTasks:h3.getBackgroundTasks()};componentDidMount(){h3.addListener(this.onBackgroundTaskStoreChange)}componentWillUnmount(){h3.removeListener(this.onBackgroundTaskStoreChange)}onBackgroundTaskStoreChange=()=>{this.setState({backgroundTasks:h3.getBackgroundTasks()})};render(){return(0,ss.jsx)(ss.Fragment,{children:this.state.backgroundTasks.map((e=>Nse(kse,{taskInfo:e},e.id)))})}}const Dse=Pse,Mse=Object.freeze({status:"",persistentStatuses:new Map});class Ose extends m.Z{getInitialState(){return new Map}getEntry(e){return this.getState().get(e)??Mse}reduce(e,t){switch(t.actionType){case"WINDOW_CLOSED":return(0,cr.u4)(e,t.windowId);case"STATUS_SET_STATUS":return(0,cr.cR)(e,t.windowId,(e=>{e.status=t.status}),Mse);case"STATUS_SET_PERSISTENT_STATUS":return(0,cr.cR)(e,t.windowId,(e=>{e.persistentStatuses.set(t.key,t.status)}),Mse);case"STATUS_CLEAR_PERSISTENT_STATUS":return(0,cr.cR)(e,t.windowId,(e=>{e.persistentStatuses.delete(t.key)}),Mse);case"PAGE_OPEN":return(0,cr.cR)(e,t.windowId,(e=>{e.status=""}),Mse)}return e}}const xse=new Ose;var Lse;function Rse(e,t,n,i){Lse||(Lse="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Lse,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var Bse=Rse(Dse,{});class Fse extends Li.PureComponent{static contextType=ts.Z;state={status:xse.getEntry(this.context.vivaldiWindowId).status,visible:!1};componentDidMount(){const{selectWindow:e}=this.context;xse.addListener(this.onStoreChange,e),this._persistentStatusIndex=0}componentWillUnmount(){clearTimeout(this._statusTimeout),clearInterval(this._persistentStatusInterval),xse.removeListener(this.onStoreChange)}onStoreChange=()=>{clearTimeout(this._statusTimeout),clearInterval(this._persistentStatusInterval);const{status:e,persistentStatuses:t}=xse.getEntry(this.context.vivaldiWindowId);e?this.setState({status:e,visible:!0}):1===t.size?this.setState({status:[...t.values()][0],visible:!0}):t.size>1?this._persistentStatusInterval=setInterval((()=>{this._persistentStatusIndex=this._persistentStatusIndex%t.size;const e=[...t.values()][this._persistentStatusIndex++];this.setState({status:e,visible:!0})}),2e3):this._statusTimeout=setTimeout((()=>this.setState({visible:!1})),200)};urlSecurityDisplay=()=>{const e=(0,Ty.dO)(this.state.status);return Rse("div",{className:"StatusInfo-Content"},void 0,Rse(Vy,{windowId:this.context.vivaldiWindowId,urlFragments:e,displayUrl:this.state.status,shouldShowFullUrl:!0,onGoToPath:Lr.Z,onBaseDomainObscured:Lr.Z,shouldHighlightBaseDomain:!1,rawDisplay:!0}))};renderStatusInfoContent=()=>Gy()(this.state.status)?this.urlSecurityDisplay():Rse("span",{className:"StatusInfo-Content"},void 0,this.state.status);render(){const e=this.props.customizeMenu?.("StatusInfo");return(0,ss.jsxs)(ss.Fragment,{children:[(0,ss.jsx)("span",{style:this.props.style,name:"StatusInfo",className:Fi()(this.props.buttonClasses,{StatusInfo:!0,"button-toolbar":this.props.preview,"StatusInfo--Visible":this.state.visible||this.props.preview}),...(0,dp.uu)({draggable:this.props.draggable,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,onDragEnter:this.props.onDragEnter,onDragOver:this.props.onDragOver,onDragLeave:this.props.onDragLeave,onDrop:this.props.onDrop}),onContextMenu:e?t=>(0,cs.Z)(this.context,e)(t):null,children:this.props.preview?Rse("button",{className:"ToolbarButton-Button",name:"StatusInfo"},void 0,Rse("span",{dangerouslySetInnerHTML:{__html:Wi.MSA[this.props.size||"medium"]+(0,B.Z)("Status")}})):this.renderStatusInfoContent()}),"StatusOverlay"!==this.props.name&&Bse]})}}const Wse=(0,dp.ZP)(Fse);var Use;function Vse(e,t,n,i){Use||(Use="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Use,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class Hse extends Li.Component{static contextType=ts.Z;state={statusText:(0,B.Z)("Sync"),statusOverlay:"none",active:!1};componentDidMount(){fY.addListener(this.onStoreChange),pe.addListener(this.onStoreChange),this.onStoreChange()}componentWillUnmount(){fY.removeListener(this.onStoreChange),pe.removeListener(this.onStoreChange)}onStoreChange=()=>{const e=ce(pe.getState()),t=pe.getState().accountInfo.username,n=fY.getState().engineData,i=fY.getState().cycleData,s=n.isFirstSetupComplete&&"stopped"!==n.engineState;let o="none";"loggedOut"!==e&&(n.isFirstSetupComplete&&("credentialsMissing"===e||"loginFailed"===e||n.needsDecryptionPassword)||"failed"===n.engineState&&!n.disableReasons.includes("not_signed_in")||"disable_sync_on_client"===n.protocolErrorClientAction?o="failed":["started","stopped"].includes(n.engineState)&&0===parseInt(i.nextRetryTime)||(o="waiting"));let a=(0,B.Z)("Sync");if("loggedOut"===e)a=(0,B.Z)("Sync not connected");else if("failed"===o)a=(0,B.Z)("Failed to start Sync for “$1”",[t]);else if("clearing_data"===n.engineState)a=(0,B.Z)("Clearing Sync server data for “$1”",[t]);else if("configuration_pending"===n.engineState)a=(0,B.Z)("Setting up Sync for “$1”",[t]);else if("started"===n.engineState){if(a=(0,B.Z)("Connected to Sync as “$1”",[t]),"not_synced"!==i.downloadUpdatesStatus){const[e,t]=function(e){return[eY(e.downloadUpdatesStatus,!0),eY(e.commitStatus,!1)]}(i);a+="\n"+(0,B.Z)("Last sync: $1",[W()(i.cycleStartTime).calendar()])+"\n"+e+"\n"+t}}else a=(0,B.Z)("Connecting to Sync as “$1”...",[t]);this.setState({active:s,statusOverlay:o,statusText:a})};openSyncSettings=()=>{de.Z.showSettings(this.context.vivaldiWindowId,"sync")};render(){return Vse(po.ZP,{onClick:this.openSyncSettings,image:Wi.ssx[this.props.size],tooltip:this.state.statusText,customizeMenu:this.props.customizeMenu,menuOrigin:this.props.menuOrigin,draggable:this.props.draggable,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,onDrop:this.props.onDrop,onDragEnter:this.props.onDragEnter,mimeType:this.props.mimeType,name:this.props.name,size:this.props.size,style:{"--syncStatusActive":this.state.active&&"none"===this.state.statusOverlay?1:0,"--syncStatusLoading":"waiting"===this.state.statusOverlay?1:0,"--syncStatusFailed":"failed"===this.state.statusOverlay?1:0}})}}const Gse=Hse;var $se;function Kse(e,t,n,i){$se||($se="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:$se,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const zse=[{title:(0,B.Z)("Always"),profile:"always"},{title:(0,B.Z)("Cached"),profile:"cache"},{title:(0,B.Z)("title","Never"),profile:"never"}],jse=[{title:(0,B.Z)("command","Loop"),profile:"allowed"},{title:(0,B.Z)("Once"),profile:"once"},{title:(0,B.Z)("command","Never"),profile:"none"}];class Yse extends Li.PureComponent{static contextType=ts.Z;_isMounted=!1;state={imageLoading:C.Z.get(I.kPageImageLoading),animationProfile:"allowed",drawerOpen:!1};componentDidMount(){this._isMounted=!0,i.Z.accessibilityFeatures.animationPolicy.onChange.addListener(this._onAnimationPolicyChanged),this._onAnimationPolicyChanged(),C.Z.addListener(I.kPageImageLoading,this._onSettingsChanged)}componentWillUnmount(){this._isMounted=!1,i.Z.accessibilityFeatures.animationPolicy.onChange.removeListener(this._onAnimationPolicyChanged),C.Z.removeListener(I.kPageImageLoading,this._onSettingsChanged)}_onSettingsChanged=(e,t)=>{this.setState({imageLoading:t})};_onAnimationPolicyChanged=()=>{i.Z.accessibilityFeatures.animationPolicy.get({},(({value:e})=>{this._isMounted&&this.setState({animationProfile:e})}))};onImageProfileSelected=e=>{switch(w.Z.set(I.kPageImageLoading,e),e){case"never":this.updatePageImageState(!1,!1);break;case"cache":this.updatePageImageState(!0,!0);break;case"always":this.updatePageImageState(!0,!1)}};onAnimationsProfileSelected=e=>{this.setState({animationProfile:e},(()=>{i.Z.accessibilityFeatures.animationPolicy.set({value:e},(()=>{}))}))};updatePageImageState=(e,t)=>{const n=Ce.ZP.getActivePage(this.context.vivaldiWindowId);n&&se.Z.tabsPrivate.update(n.id,{showImages:e,loadFromCacheOnly:t})};hidePopup=()=>{this.state.drawerOpen&&this.setState({drawerOpen:!1})};togglePopup=()=>{this.setState((e=>({drawerOpen:!e.drawerOpen})))};render(){const e=this.state.imageLoading,t=this.state.animationProfile,n=this.props.disabled;return Kse(po.ZP,{style:{"--displayImagesAll":"always"===e?1:0,"--displayImagesCached":"cache"!==e||n?0:1,"--displayImagesNever":"never"!==e||n?0:1,"--displayAnimationLoop":"allowed"===t?1:0,"--displayAnimationOnce":"once"===t?1:0,"--displayAnimationNever":"none"===t?1:0},tooltip:(0,B.Z)("Toggle images and animation"),onClick:this.togglePopup,disabled:this.props.disabled,image:Wi.myO[this.props.size],size:this.props.size,customizeMenu:this.props.customizeMenu,menuOrigin:this.props.menuOrigin,hidePopup:this.hidePopup,popupPosition:this.props.popupPosition,isPopupVisible:this.state.drawerOpen,draggable:this.props.draggable,onDragStart:this.props.onDragStart,hasLightArrow:"above"===this.props.popupPosition,onDragEnd:this.props.onDragEnd,onDrop:this.props.onDrop,onDragEnter:this.props.onDragEnter,mimeType:this.props.mimeType,popupClassName:"ToolbarButtonPopup-DefaultStyles",popupLabel:(0,B.Z)("dialog title","Images and Animation Controls"),name:this.props.name},void 0,Kse("form",{},void 0,Kse("h2",{},void 0,(0,B.Z)("title","Load Images")),Kse("div",{className:"ToggleImages-Selection"},void 0,zse.map((({title:t,profile:n},i)=>Kse("label",{},"imagePolicy-"+n,Kse("input",{autoFocus:e===n,type:"radio",name:"toggle-image-group",checked:e===n,onChange:this.onImageProfileSelected.bind(this,n)}),t)))),Kse("h2",{},void 0,(0,B.Z)("Play Image Animation")),Kse("div",{className:"ToggleImages-Selection"},void 0,jse.map((({title:e,profile:n})=>Kse("label",{},"animationPolicy-"+n,Kse("input",{type:"radio",name:"toggle-animations-group",checked:t===n,onChange:this.onAnimationsProfileSelected.bind(this,n)}),e))))))}}const Xse=Yse;var Qse;function qse(e,t,n,i){Qse||(Qse="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Qse,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Jse=function(e){const t=Ce.ZP.unsafeGetActivePage(e),n=(0,kv.jA)(t);return{groupId:t.vivExtData.group??"",tileId:n&&Ce.ZP.getTiles(n,e).count()>1?n:"",tileMode:t.vivExtData.tiling?.layout,disabled:1===Ce.ZP.getPages(e).count()}};class eoe extends Li.PureComponent{static contextType=ts.Z;_isMounted=!1;_focusRef=Li.createRef();constructor(e,t){super(e),this.state={drawerOpen:!1,...Jse(t.vivaldiWindowId)}}componentDidMount(){const{selectWindow:e}=this.context;this._isMounted=!0,Ce.ZP.addListener(this._onPageStoreChange,e)}componentDidUpdate(e){this._isMounted&&e.pageId!==this.props.pageId&&this.hidePopup()}componentWillUnmount(){this._isMounted=!1,Ce.ZP.removeListener(this._onPageStoreChange)}_onPageStoreChange=()=>{this._isMounted&&this.setState(Jse(this.context.vivaldiWindowId))};togglePopup=()=>{this.setState((e=>({drawerOpen:!e.drawerOpen})))};hidePopup=()=>{this.state.drawerOpen&&this.setState({drawerOpen:!1})};setTiling=e=>{if(e.hasOwnProperty("button")&&e.button!==es.Z.kLeft)return;const t=this.context.vivaldiWindowId,n=e.currentTarget.value,i=Ce.ZP.getSelectedPages(t);if(i.size>1)c.ZP.tilePages(i,n);else if(this.state.tileId){const e=Ce.ZP.getTiles(this.state.tileId,t);c.ZP.tilePages(e,n)}else Ce.ZP.isGroup(this.state.groupId,t)?c.ZP.tileTabStack(t,this.state.groupId,n):c.ZP.tileLastActive(t,n);this.hidePopup()};untile=()=>{c.ZP.untileTileGroup(this.context.vivaldiWindowId,this.state.tileId),this.hidePopup()};keyDownHandler=e=>{const t=e.currentTarget,n=t.parentElement?.querySelectorAll(".PageTiling-Button:not([disabled])");if(n?.length)switch(e.key){case"ArrowUp":let i=Array.from(n).indexOf(t)-1;i<0&&(i=n.length-1),n[i].focus();break;case"ArrowDown":let s=Array.from(n).indexOf(t)+1;s>=n.length&&(s=0),n[s].focus();break;case" ":case"Enter":"none"===t.value?this.untile():this.setTiling(e);break;default:return}};focusPopup=()=>this._focusRef.current?.focus();render(){return qse(po.ZP,{customizeMenu:this.props.customizeMenu,tooltip:(0,B.Z)("Page tiling"),tooltipExtra:(0,B.Z)("Tile the current tab selection, tab stack, or last active tab"),buttonStyle:{"--displayUntiled":this.state.tileId?0:1,"--displayTileColumn":!this.state.tileId||"column"!==this.state.tileMode&&"grid"!==this.state.tileMode?0:1,"--displayTileRow":!this.state.tileId||"row"!==this.state.tileMode&&"grid"!==this.state.tileMode?0:1},className:`tilingtoggle ${this.props.size} ${["grid","row","column"].includes(this.state.tileMode)?"button-on":""}`,disabled:this.state.disabled,image:Wi.Dx_[this.props.size],size:this.props.size,onClick:this.togglePopup,onPointerDown:this.togglePopup,isPopupVisible:this.state.drawerOpen,hidePopup:this.hidePopup,popupPosition:this.props.popupPosition,popupLabelledBy:"popup-label-pagetiling",menuOrigin:this.props.menuOrigin,draggable:this.props.draggable,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,hasLightArrow:!0,onDrop:this.props.onDrop,onDragEnter:this.props.onDragEnter,mimeType:this.props.mimeType,popupClassName:`ToolbarButtonPopup-DefaultStyles ${this.props.size}`,name:this.props.name,onFocus:this.state.drawerOpen?this.focusPopup:Lr.Z},void 0,qse("h2",{id:"popup-label-pagetiling"},void 0,(0,B.Z)("Page Tiling")),(0,ss.jsx)("button",{ref:this._focusRef,className:Fi()("PageTiling-Button",{"button-on":"row"===this.state.tileMode}),title:(0,B.Z)("Tile vertically"),onKeyDown:this.keyDownHandler,onMouseUp:this.setTiling,value:"row",dangerouslySetInnerHTML:{__html:Wi.Dx_[this.props.size]+(0,B.Z)("Tile Vertically")},style:{"--displayTileColumn":0,"--displayTileRow":1,"--displayUntiled":0}}),qse("button",{className:Fi()("PageTiling-Button",{"button-on":"column"===this.state.tileMode}),title:(0,B.Z)("Tile horizontally"),onKeyDown:this.keyDownHandler,onMouseUp:this.setTiling,value:"column",dangerouslySetInnerHTML:{__html:Wi.Dx_[this.props.size]+(0,B.Z)("Tile Horizontally")},style:{"--displayTileColumn":1,"--displayTileRow":0,"--displayUntiled":0}}),qse("button",{className:Fi()("PageTiling-Button",{"button-on":"grid"===this.state.tileMode}),title:(0,B.Z)("Tile to grid"),onKeyDown:this.keyDownHandler,onMouseUp:this.setTiling,value:"grid",dangerouslySetInnerHTML:{__html:Wi.Dx_[this.props.size]+(0,B.Z)("Tile to Grid")},style:{"--displayTileColumn":1,"--displayTileRow":1,"--displayUntiled":0}}),qse("button",{className:"PageTiling-Button",title:(0,B.Z)("Untile pages"),disabled:!this.state.tileMode,onKeyDown:this.keyDownHandler,onMouseUp:this.untile,value:"none",dangerouslySetInnerHTML:{__html:Wi.Dx_[this.props.size]+(0,B.Z)("Untile Pages")},style:{"--displayTileColumn":0,"--displayTileRow":0}}))}}const toe=eoe;var noe;function ioe(e,t,n,i){noe||(noe="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:noe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var soe=ioe("svg",{viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"},void 0,ioe("g",{},void 0,ioe("path",{d:"M7 8C7 7.44772 7.44772 7 8 7C8.55228 7 9 7.44772 9 8V11C9 11.5523 8.55228 12 8 12C7.44772 12 7 11.5523 7 11V8Z"}),ioe("path",{d:"M8 6C8.55228 6 9 5.55228 9 5C9 4.44772 8.55228 4 8 4C7.44772 4 7 4.44772 7 5C7 5.55228 7.44772 6 8 6Z"}),ioe("path",{fillRule:"evenodd",d:"M15 8C15 11.866 11.866 15 8 15C4.13401 15 1 11.866 1 8C1 4.13401 4.13401 1 8 1C11.866 1 15 4.13401 15 8ZM14 8C14 11.3137 11.3137 14 8 14C4.68629 14 2 11.3137 2 8C2 4.68629 4.68629 2 8 2C11.3137 2 14 4.68629 14 8Z"}))),ooe=ioe("svg",{width:"16",height:"16",xmlns:"http://www.w3.org/2000/svg"},void 0,ioe("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8 2c1.694 0 3 1.31 3 2.846V6H5V4.846C5 3.311 6.306 2 8 2ZM4 6.085V4.846C4 2.722 5.79 1 8 1s4 1.722 4 3.846V6.085A1.5 1.5 0 0 1 13 7.5v5a1.5 1.5 0 0 1-1.5 1.5h-7A1.5 1.5 0 0 1 3 12.5v-5a1.5 1.5 0 0 1 1-1.415ZM4.5 7a.5.5 0 0 0-.5.5v5a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 .5-.5v-5a.5.5 0 0 0-.5-.5h-7Z",fill:"currentColor"}),ioe("path",{opacity:".1",d:"M8 7h3.5a.5.5 0 0 1 .5.5v5a.5.5 0 0 1-.5.5H8V7Z",fill:"#000"})),aoe=ioe("svg",{width:"16",height:"16",xmlns:"http://www.w3.org/2000/svg"},void 0,ioe("path",{d:"M7.118 1.654a1 1 0 0 1 1.764 0l6.334 11.875A1 1 0 0 1 14.333 15H1.667a1 1 0 0 1-.883-1.47L7.118 1.653Z",fill:"var(--colorErrorBg)"}),ioe("path",{d:"M8 5a1 1 0 0 0-1 1v3a1 1 0 0 0 2 0V6a1 1 0 0 0-1-1ZM8 11a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z",fill:"var(--colorErrorFg)"})),roe=ioe("svg",{viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"},void 0,ioe("path",{d:"M10.4 5c-.4-.8 0-1.8 1-2 .7 0 1.5.4 1.6 1.2a1.4 1.4 0 0 1-.2 1l-4 7c-.3.5-.7.8-1.2.8-.6 0-1-.2-1.3-.7L3.8 7.8 2.2 5c-.5-.8 0-2 1-2 .7 0 1 .2 1.4.7l1 2 1 1.4a2 2 0 0 0 1.7 1.5 2.2 2.2 0 0 0 2.3-2V6c0-.3 0-.6-.2-1z"}));function loe({pageSecurity:e,isUrlEmpty:t}){if(t)return ioe(Ri.ZP,{url:C.Z.get(I.kAddressBarInlineSearchEnabled)?Wi.YvR.medium:Wi.ZuY,loadType:"faviconFromCache"});switch(e){case"web":case"warning":return soe;case"secure":return ooe;case"insecure":return aoe;case"internal":return roe;default:return null}}class doe extends Li.PureComponent{static contextType=ts.Z;refSiteInfoButton=Li.createRef();_popupVisible=!1;_popupVisibleOnMouseDown=!1;componentDidMount(){se.Z.windowPrivate.onPageInfoPopupChanged.addListener(this.popupChanged)}componentWillUnmount(){se.Z.windowPrivate.onPageInfoPopupChanged.removeListener(this.popupChanged),clearTimeout(this._timeoutId)}popupChanged=(e,t)=>{e===this.context.vivaldiWindowId&&(t?this._popupVisible=!0:this._timeoutId=setTimeout((()=>{this._popupVisible=!1}),1))};doActionShowPageInfo=e=>{if(e)return this.props.fieldGo();pw.Z.getActiveWebView(this.context.vivaldiWindowId)&&i.Z.windows.getCurrent({},(e=>{se.Z.zoom.getVivaldiUIZoom((t=>{const n=this.refSiteInfoButton.current;if(!n)return;const i=n.getBoundingClientRect(),{left:s=0,top:o=0}=e,a=i.left*t+s-1,r=this.props.isInternal?60:360,{screen:l}=this.context,d=(l.availHeight-(i.bottom+o)*t>r?i.bottom+6:i.top-6)*t+o,c=pw.Z.getActiveWebView(this.context.vivaldiWindowId);c&&c.showPageInfo({top:Math.round(d),left:Math.round(a)})}))}))};getFavIconData(e,t,n,i){return{favIconUrl:e||!t?C.Z.get(I.kAddressBarInlineSearchEnabled)?Wi.YvR.medium:Wi.ZuY:t,favIconType:e||!t||"img"===n?"faviconFromCache":i?"faviconSkipCache":"page"}}render(){const{vivaldiWindowId:e}=this.context,{displayUrl:t,selectedItem:n,typedUrl:i,isInternal:s,isLocal:o,sslState:a,isLoading:r}=this.props,{favIconType:l,favIconUrl:d}=function(e,t){const n=foe(e);return n?{favIconUrl:n.faviconUrl,favIconType:"img"}:{favIconUrl:"",favIconType:"favicon"}}(i),c="string"==typeof i&&0===i.length||"string"!=typeof i&&0===t.length,u="string"==typeof i&&i!==t,p=!n||dy(n),h=u||s||o?"internal":function(e,t){return"security_error"===e?"insecure":"warning"===e||"none"===e&&!t?"warning":"secure"===e?"secure":"web"}(a,r),g=this.getFavIconData(c,d,l,p),m=Ce.ZP.isActiveInternal(e)?null:(0,B.Z)("View Site Info"),f=Ce.ZP.isActiveInternal(e)?null:"warning"===h?(0,B.Z)("Page Not Secure, Site Info"):(0,B.Z)("Site Info");return ioe("div",{className:"button-toolbar"},void 0,(0,ss.jsxs)("button",{ref:this.refSiteInfoButton,className:`button-addressfield SiteInfoButton ${h}`,title:m,"aria-label":f,onMouseDown:()=>{this._popupVisibleOnMouseDown=this._popupVisible},onClick:()=>{this._popupVisibleOnMouseDown||this.doActionShowPageInfo(u),this._popupVisibleOnMouseDown=!1},draggable:this.props.draggable,onDragStart:this.props.onDragStart,disabled:this.props.isInternal&&!u,tabIndex:this.props.tabIndex,"aria-haspopup":!this.props.isInternal&&"dialog","aria-expanded":this._popupVisible,children:[u?ioe(Ri.ZP,{className:"SiteInfoButton-Favicon",url:g.favIconUrl,loadType:g.favIconType}):ioe("div",{className:"SiteInfoButton-SecurityBadge"},void 0,ioe(loe,{pageSecurity:h,isUrlEmpty:c})),"warning"===h&&ioe("span",{className:"siteinfo-text"},void 0,(0,B.Z)("Not Secure"))]}))}}const coe=doe;var uoe,poe=n(34155);function hoe(e,t,n,i){uoe||(uoe="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:uoe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const goe=[I.kAddressBarAutocompleteEnabled,I.kAddressBarExtensionsVisible,I.kAddressBarExtensionsRenderInDropdown,I.kAddressBarExtensionsShowAllToggle,I.kAddressBarInlineSearchEnabled,I.kAddressBarPosition,I.kAddressBarSearchSuggestEnabled,I.kAddressBarShowQrGenerator,I.kPopupsShowInTab,I.kKeyboardTabToAll,I.kAddressBarSearchShowFavicon,I.kAddressBarOmniboxShowSearchHistory,I.kAddressBarOmniboxShowSyncTabs,I.kAddressBarOmniboxShowTypedHistory,I.kPrivacyPartnersExceptionsDismissed];function moe(e){return{blockedPageContent:Ev.getblockedPageContents(e),blockedPopups:Ev.getBlockedPopupsById(e),permissionInfo:Ev.getPermissionsById(e),sslInfo:Ev.getSSLInfo(e),trigger:Ev.getNavigationInfo(e).trigger}}function foe(e){if(!e)return;const t=ai.Z.getByQuery(e);if(!t||!t.keyword)return;return e.substring(t.keyword.length)?t:void 0}function voe(e){const{blockedPageContent:t,blockedPopups:n,permissionInfo:i,sslInfo:s,trigger:o}=moe(e),{selectedItem:a,typedUrl:r}=Rv.getUrlfieldState(e);return{prevPageId:e,blockedPageContent:t,blockedPopups:n,permissionInfo:i,sslInfo:s,trigger:o,selectedItem:a,typedUrl:r,feeds:OA.getFeeds(e)}}function yoe(e){const t=g.Z.findByUrl(e);return{prevPageUrl:e,bookmarkData:t?{...t}:void 0}}class boe extends Li.PureComponent{static contextType=ts.Z;#m;refPageloadProgress=Li.createRef();refPopupBlockerNotificator=Li.createRef();urlBarRef=Li.createRef();passwordElm=Li.createRef();siteInfoElm=Li.createRef();refUrlField=Li.createRef();constructor(e,t){super(e),this.state={isBaseDomainObscured:!1,createBookmarkCallout:!1,showPasswordIcon:!1,defaultSearchEngine:ai.Z.getDefault(he.ZP.isIncognito(t.vivaldiWindowId)),...voe(e.id),...yoe(e.url)},this.trackContextOnFocus=sse("tabBar",t)}static getDerivedStateFromProps(e,t){const n={};return e.id!==t.prevPageId&&Object.assign(n,voe(e.id)),e.url!==t.prevPageUrl&&Object.assign(n,yoe(e.url)),n}componentDidUpdate(e,t){const n=e.id!==this.props.id;n&&this.hideDropdown(),n&&this.props.pageContext.isUrlFieldFocused&&Jie((()=>(0,Dv.i6)(this.context)))}componentDidMount(){this.#m=!0,g.Z.addListener(this._onBookmarkStoreChanged),No.Z.addListener(this._onWebpageviewStoreChanged),Rv.addListener(this._onUrlFieldStoreChanged,(e=>e.get(this.props.id))),Ev.addListener(this._onNavigationStoreChanged),ai.Z.addListener(this._onSearchEngineCacheChanged),se.Z.windowPrivate.onPositionChanged.addListener(this._onWindowPositionChanged),se.Z.utilities.onPasswordIconStatusChanged.addListener(this.togglePasswordIcon),OA.addListener(this._onRssDetectStoreChanged),this.props.pageContext.isUrlFieldFocused&&Jie((()=>(0,Dv.i6)(this.context)))}componentWillUnmount(){this.#m=!1,g.Z.removeListener(this._onBookmarkStoreChanged),No.Z.removeListener(this._onWebpageviewStoreChanged),Rv.removeListener(this._onUrlFieldStoreChanged),Ev.removeListener(this._onNavigationStoreChanged),ai.Z.removeListener(this._onSearchEngineCacheChanged),se.Z.windowPrivate.onPositionChanged.removeListener(this._onWindowPositionChanged),se.Z.utilities.onPasswordIconStatusChanged.removeListener(this.togglePasswordIcon),OA.removeListener(this._onRssDetectStoreChanged)}getUrlFragments=gs()(Ty.dO);getReaderContextMenu=()=>{const e=this.context.vivaldiWindowId;return[{handler:()=>de.Z.showSettings(e,"webpages"),isVisible:()=>!he.ZP.isGuest(),...(0,us.Z)("Configure Reader View")}]};_setBookmarkedState=(0,Ae.Z)((e=>{if(!this.#m)return;const t=g.Z.findByUrl(e);this.setState({bookmarkData:t?{...t}:void 0})}),100);_onUrlFieldStoreChanged=()=>{const{selectedItem:e,typedUrl:t}=Rv.getUrlfieldState(this.props.id);this.setState({selectedItem:e,typedUrl:t})};_onNavigationStoreChanged=()=>{const e=moe(this.props.id);if(this.state.blockedPageContent===e.blockedPageContent&&this.state.blockedPopups===e.blockedPopups&&this.state.permissionInfo===e.permissionInfo&&this.state.sslInfo===e.sslInfo&&this.state.trigger===e.trigger)return;const t=()=>{this.setState({blockedPageContent:e.blockedPageContent,blockedPopups:e.blockedPopups,permissionInfo:e.permissionInfo,sslInfo:e.sslInfo,trigger:e.trigger})};this.state.permissionInfo===e.permissionInfo?t():setTimeout(t,200)};_onSearchEngineCacheChanged=()=>{this.setState({defaultSearchEngine:ai.Z.getDefault(he.ZP.isIncognito(this.context.vivaldiWindowId))})};_onRssDetectStoreChanged=()=>{const e=OA.getFeeds(this.props.id);this.state.feeds!==e&&this.setState({feeds:e})};selectAddressField=()=>{this.#m&&(0,Dv.i6)(this.context)};focusAddressField=()=>{this.#m&&(0,Dv.x0)(this.context)};blurAddressField=()=>{this.#m&&((0,Dv.gR)(this.context),poe.nextTick((()=>{this.hideDropdown()})))};_onBookmarkStoreChanged=()=>{this._setBookmarkedState(this.props.url)};_onWebpageviewStoreChanged=e=>{e.winId===this.context.vivaldiWindowId&&("WEBPAGEVIEW_ACTIONS"===e.type?"focusAddressField"===e.action?(this.onCloseCreateBookmarkCallout(),poe.nextTick((()=>{this.focusAddressField(),this.selectAddressField()}))):"urlPasteAndGo"===e.action&&e.payload&&this.urlPasteAndGo(e.payload):"WEBPAGEVIEW_URLFIELD_BLUR"===e.type&&poe.nextTick((()=>this.hideDropdown())))};urlPasteAndGo=async e=>{const{HTMLInputElement:t}=this.context,{clipboardText:n}=e;if(!n)return;const i=this.refUrlField.current?._urlInput.current?.refUrlInput.current?.inputField.current;i instanceof t&&(await oy.Z.go(this.context.vivaldiWindowId,[n],{transition:se.Z.historyPrivate.TransitionType.TYPED,fromUrlField:!0,addTypedSearchHistory:!1,enableSearch:!0,...e.openOptions}),this.blurAddressField())};onPasswordFocus=e=>{se.Z.utilities.isDialogOpen("password",(e=>{se.Z.utilities.focusDialog("password",(e=>{}))}))};compareProtocol=e=>{if((0,rl.C3)(e)&&(0,rl.Zj)(e)&&this.props.url&&nI(e)===nI(this.props.url)){const t=(0,ge.Z)(this.props.url),n=(0,ge.Z)(e);if(n&&t&&(n.protocol=t.protocol,(0,rl.K2)(n.href)))return n.href}return e};handleUrlFieldSubmit=async({url:e,options:t})=>{const n=foe(this.state.typedUrl),i=Boolean(n||this.props.prefValues[I.kAddressBarInlineSearchEnabled]);n||(e=this.compareProtocol(e)),await oy.Z.go(this.context.vivaldiWindowId,[e],{...t,enableSearch:i,addTypedSearchHistory:!1})};easterEggNavigation=async()=>{const e=Rv.getUrlfieldState(this.props.id);if(!e||!e.autocompleteValue&&!e.typedUrl)return;const t=e?.autocompleteValue||e?.typedUrl||"";this.hideDropdown(),await oy.Z.go(this.context.vivaldiWindowId,[pn.jk.getUrl(t)],{enableSearch:!0,transition:se.Z.historyPrivate.TransitionType.TYPED,addTypedSearchHistory:!1})};onSiteInfoButtonFieldGo=()=>{this.easterEggNavigation(),(0,Dv.gR)(this.context)};showPasswordDialog=()=>{se.Z.utilities.showPasswordDialog(this.context.vivaldiWindowId)};onUrlFieldDrop=e=>{const t=this.context.vivaldiWindowId,n=e.dataTransfer;if(!n)return;const i=zi.ZP.extractUriListFromEvent(e);if(i.length>0){const e=i.split("\n");e.length>0&&oy.Z.go(t,e)}else{const e=n.getData("text/plain");e.length>0&&((0,rl.K2)(e)?oy.Z.go(t,[e]):(Ov.Z.updateState(this.props.id,{typedUrl:e}),this.focusAddressField()))}};togglePasswordIcon=(e,t)=>{e===this.context.vivaldiWindowId&&this.setState({showPasswordIcon:t})};setUrlDragEvent=e=>{e.stopPropagation();const{document:t,devicePixelRatio:n,vivaldiWindowId:i}=this.context,s=t.createElement("img");s.src=this.props.favIconUrl||"/resources/default_favicon_64.png",s.width=32,s.height=32,e.dataTransfer.setDragImage(s,s.width*n,s.height*n),s.remove();const o=Ce.ZP.getActivePage(i),a=this.state.typedUrl??this.props.url;Za(e,a,o?.title??""),e.dataTransfer.effectAllowed="all"};onReaderModeClicked=()=>{c.ZP.setReaderState(this.props.id,!this.props.isReaderModeActive)};onCloseCreateBookmarkCallout=()=>{this.setState({createBookmarkCallout:!1})};onPopupAllowed=e=>{rC.Z.removeBlockedPopup(this.props.id,e.targetUrl),this.refPopupBlockerNotificator.current?.onDialogClosed(),this.openNewPopAsTabOrWindow(e)};openNewPopAsTabOrWindow=e=>{const t=he.ZP.isIncognito(this.context.vivaldiWindowId);de.Z.openNewPopAsTabOrWindow(this.context.vivaldiWindowId,e,t)};hideDropdown=()=>{this.refUrlField.current?.hideDropdown()};_storeDialogAnchorRect=(e,t)=>{const n="top"===this.props.prefValues[I.kAddressBarPosition]?"down":"up";se.Z.zoom.getVivaldiUIZoom((i=>{se.Z.utilities.setDialogPosition(t,this.context.vivaldiWindowId,{left:Math.round(e.left*i),top:Math.round(e.top*i),width:Math.round(e.width*i),height:Math.round(e.height*i)},n)}))};_updateDialogPositions=()=>{const e=this.passwordElm.current;if(e){const t=e.getRect();t&&this._passwordPopupPos!==t&&(this._passwordPopupPos=t,this._storeDialogAnchorRect({left:t.left,top:t.top,width:t.width,height:t.height},"password"))}const{Element:t}=this.context,n=this.siteInfoElm.current?.refSiteInfoButton.current;if(n instanceof t){const e=n.getBoundingClientRect();this._permissionPopupPos!==e&&(this._permissionPopupPos=e,this._storeDialogAnchorRect({left:e.left,top:e.top,width:e.width,height:e.height},"permission"))}i.Z.windows.get(this.context.vivaldiWindowId,{},(e=>{if(!i.Z.runtime.lastError){let{left:t=0,top:n=0,width:i,height:s}=e;i=i||0,s=s||0,this._storeDialogAnchorRect({left:Math.round(t+i/2),top:Math.round(n+s/2),width:0,height:0},"chromecast")}}))};_onWindowPositionChanged=e=>{e===this.context.vivaldiWindowId&&this._sendBatchedUpdatedBounds()};_sendBatchedUpdatedBounds=()=>{this._resizeDelayRunning||(this._resizeDelayRunning=!0,setTimeout((()=>{this._updateDialogPositions(),this._resizeDelayRunning=!1}),500))};onUrlbarResized=e=>{this._sendBatchedUpdatedBounds()};onSetBookmarked=e=>i.Z.bookmarks.create(e).then((t=>(de.Z.showBookmarkAddedPopup(he.ZP.getLastActiveBrowserWindowId(),{pageId:this.props.id,url:e.url??"",isActive:!0}),t)));blurUnfocused=e=>{this.context.document.activeElement!==this.refUrlField.current&&"Escape"===e.key&&(e.stopPropagation(),e.preventDefault(),this.refUrlField.current?._onEscPressed())};onBaseDomainObscured=e=>{this.setState({isBaseDomainObscured:e})};getOffsetWidth=()=>this.urlBarRef.current?.offsetWidth??0;getPlaceholderUrlFieldText=()=>this.props.prefValues[I.kAddressBarInlineSearchEnabled]?ai.Z.systemDefaultEngineChanged()?(0,B.Z)("Search $1 [NEW] or enter an address",[this.state.defaultSearchEngine?.name??""]):(0,B.Z)("Search $1 or enter an address",[this.state.defaultSearchEngine?.name??""]):(0,B.Z)("Enter an address");render(){const{preview:e=!1}=this.props;if(e)return(0,ss.jsx)("input",{type:"text",className:"AddressField",name:"AddressField",value:(0,B.Z)("url","Address"),...(0,dp.uu)({draggable:this.props.draggable,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,onDragEnter:this.props.onDragEnter,onDragOver:this.props.onDragOver,onDragLeave:this.props.onDragLeave,onDrop:this.props.onDrop}),readOnly:!0});const{isBaseDomainObscured:t,feeds:n,trigger:i}=this.state,{prefValues:s,url:o}=this.props,a=foe(this.state.typedUrl),r=(0,B.Z)("Save your password"),l=this.props.menuOrigin||"bottomLeft",d=this.props.popupPosition||"below",c=this.getUrlFragments(this.props.url),u=(0,aS.gC)(c),p=function(e){return Boolean(e)&&!pn.jk.isInternalUrl(e)&&!pn.jk.isNewTabPage(e)}(o),h=pn.jk.isInternalUrl(o)||o.startsWith("chrome://"),m=(0,rl.tn)(o,c),f=(0,rl.C3)(escape(o))&&!(h||(0,rl.Sc)(o)||m),v="commit"===i||"start"===i,y=(0,zi.TR)(o),b=g.Z.getRootId()&&void 0!==this.props.id&&y;return(0,ss.jsxs)("div",{ref:this.urlBarRef,className:Fi()("UrlBar-AddressField urlfield-anchor",this.props.buttonClasses,d),name:"AddressField",onFocus:this.trackContextOnFocus,...(0,dp.uu)({draggable:this.props.draggable,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,onDragEnter:this.props.onDragEnter,onDragOver:this.props.onDragOver,onDragLeave:this.props.onDragLeave,onDrop:this.props.onDrop}),onKeyDown:this.blurUnfocused,children:[hoe("div",{className:"toolbar toolbar-small toolbar-insideinput"},void 0,!h&&hoe(MC,{blockerVisible:f,position:d,tabIndex:s[I.kKeyboardTabToAll],pageId:this.props.id,url:o,exceptionDismissed:this.props.prefValues[I.kPrivacyPartnersExceptionsDismissed]>0}),(0,ss.jsx)(coe,{ref:this.siteInfoElm,draggable:!h,isInternal:h,isLocal:m,isLoading:v,onDragStart:this.setUrlDragEvent,fieldGo:this.onSiteInfoButtonFieldGo,sslState:this.state.sslInfo.state,tabIndex:s[I.kKeyboardTabToAll],typedUrl:this.state.typedUrl,displayUrl:u,selectedItem:this.state.selectedItem})),hoe("div",{className:"UrlBar-UrlFieldWrapper"},void 0,hoe(Yi.Z,{className:"observer",onResize:this.onUrlbarResized},void 0,(0,ss.jsx)(ib,{ref:this.refUrlField,getOffsetWidth:this.getOffsetWidth,onBaseDomainObscured:this.onBaseDomainObscured,urlFragments:c,onSubmit:this.handleUrlFieldSubmit,className:"UrlBar-UrlField url vivaldi-addressfield uifocusstop",typedUrl:this.state.typedUrl,displayUrl:u,selectedItem:this.state.selectedItem,pageId:this.props.id,pageContext:this.props.pageContext,onUrlDrag:this.setUrlDragEvent,autoFocus:!1,autocompletionEnabled:s[I.kAddressBarAutocompleteEnabled],typedHistoryEnabled:s[I.kAddressBarOmniboxShowTypedHistory],onDrop:this.onUrlFieldDrop,placeholder:this.getPlaceholderUrlFieldText(),showDropdown:!0,defaultSearchEngine:this.state.defaultSearchEngine,typedSearchEngine:a,readonly:this.props.readonly}))),hoe("div",{className:"toolbar toolbar-small toolbar-insideinput"},void 0,t&&hoe("div",{title:(0,B.Z)("Caution!\nThe entire domain name cannot be shown. Make sure you trust this website before submitting data."),className:"UrlBar-UrlObfuscationWarning",dangerouslySetInnerHTML:{__html:Wi.Si$.small}}),(0,ss.jsx)(VC,{pageId:this.props.id,ref:this.refPageloadProgress,open:!h}),hoe(yA,{pageId:this.props.id,pagePermissions:this.state.permissionInfo,popupPosition:d}),this.state.blockedPopups.size>0&&(0,ss.jsx)(TA,{ref:this.refPopupBlockerNotificator,url:o,blockedPopups:this.state.blockedPopups,onPopupAllowed:this.onPopupAllowed,popupPosition:d}),this.state.blockedPageContent.length>0&&hoe(gC,{pageId:this.props.id,url:o,position:d,blockedPageContent:this.state.blockedPageContent}),n&&n.length>0&&hoe(PA,{feeds:n}),this.state.showPasswordIcon&&(0,ss.jsx)(po.ZP,{ref:this.passwordElm,className:"password-icon",tooltip:r,onClick:this.showPasswordDialog,image:Wi.hXX,tabIndex:0,onFocus:this.onPasswordFocus}),!h&&this.props.supportsReaderMode&&hoe(po.ZP,{menu:this.getReaderContextMenu,menuOrigin:l,isPressed:this.props.isReaderModeActive,image:Wi.sWI,onClick:this.onReaderModeClicked,tooltip:(0,B.Z)("Reader View"),commandId:"COMMAND_READERVIEW_TOGGLE"}),p&&s[I.kAddressBarShowQrGenerator]&&hoe(_A,{popupPosition:d,size:this.props.size,data:o}),p&&hoe(tI,{popupPosition:d,size:this.props.size,tabId:this.props.id,url:o}),b&&hoe(Yo,{setBookmarked:this.onSetBookmarked,pageId:this.props.id,bookmarkData:this.state.bookmarkData,popupPosition:d},o))]})}}const Soe=(0,Bu.Z)((0,dp.ZP)(boe),goe);var woe;function Coe(e,t,n,i){woe||(woe="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:woe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Aoe=[I.kBiscuitVersion,I.kPanelsPosition,I.kMailIsTurnedOff],Ioe=(0,B.Z)("$1 click to toggle panel floating",[(0,B.Z)("key","Shift")]),Toe=function(e){const t=Ce.ZP.unsafeGetActivePage(e);return{activePageUrl:t.url,activePageId:t.id,activePageContext:t.context,activePageSupportsReaderMode:t.supportsReaderMode,activePageIsReaderModeActive:Boolean(t.vivExtData.readerMode),active:t.active,favIconUrl:t.favIconUrl,isMailPage:t.isMailPage&&!C.Z.get(I.kMailIsTurnedOff)}};let Zoe="";class Eoe extends Li.PureComponent{static contextType=ts.Z;_isMounted=!1;constructor(e,t){super(e),this.winId=t.vivaldiWindowId,this.state={panelBarVisible:Yn.ZP.getIsBarVisible(this.winId),statusBarDisplay:he.ZP.getVisibleUI(this.winId).statusBar,...Toe(this.winId)}}componentDidMount(){if(this.props.inEditor)return;const{selectWindow:e}=this.context;this._isMounted=!0,Ce.ZP.addListener(this._onPageStoreChange,e),Yn.ZP.addListener(this._onPanelStoreChanged),he.ZP.addListener(this._onWindowStoreChanged,e)}componentWillUnmount(){this.props.inEditor||(this._isMounted=!1,Yn.ZP.removeListener(this._onPanelStoreChanged),Ce.ZP.removeListener(this._onPageStoreChange),he.ZP.removeListener(this._onWindowStoreChanged))}_onPageStoreChange=()=>{this._isMounted&&this.setState(Toe(this.winId))};_onPanelStoreChanged=()=>{this._isMounted&&this.setState({panelBarVisible:Yn.ZP.getIsBarVisible(this.winId)})};_onWindowStoreChanged=()=>{const e=he.ZP.getVisibleUI(this.winId).statusBar;this._isMounted&&this.state.statusBarDisplay!==e&&this.setState({statusBarDisplay:e})};#vn=()=>{jn.Z.togglePanel(this.winId)};#yn=()=>{de.Z.showSettings(this.winId)};render(){const{preview:e,name:t,size:n,label:i,popupPosition:s,customizeMenu:o,draggable:a,onDragStart:r,onDragEnd:l,onDrop:d,onDragEnter:c,mimeType:u,menuOrigin:p}=this.props,h={size:n,name:t,customizeMenu:o,menuOrigin:p,draggable:a,popupPosition:s,onDragStart:r,onDragEnd:l,onDrop:d,onDragEnter:c,mimeType:u},g=Oi.Z.isEnabled("omnibox");switch(this.props.name){case"AddressField":return g?(0,ss.jsx)(Soe,{...h,readonly:!1,url:this.state.activePageUrl,id:this.state.activePageId,supportsReaderMode:this.state.activePageSupportsReaderMode,isReaderModeActive:this.state.activePageIsReaderModeActive,active:this.state.active,favIconUrl:this.state.favIconUrl,label:i,pageContext:this.state.activePageContext,preview:this.props.inEditor}):(0,ss.jsx)(mse,{...h,readonly:!1,url:this.state.activePageUrl,id:this.state.activePageId,supportsReaderMode:this.state.activePageSupportsReaderMode,isReaderModeActive:this.state.activePageIsReaderModeActive,active:this.state.active,favIconUrl:this.state.favIconUrl,label:i,pageContext:this.state.activePageContext,preview:this.props.inEditor});case"SearchField":return g?(0,ss.jsx)(Qw,{...h,className:"UrlBar-SearchField",preview:this.props.preview,inEditor:this.props.inEditor,forceIcon:this.props.forceIcon}):(0,ss.jsx)(Ise,{...h,className:"UrlBar-SearchField",preview:this.props.preview,inEditor:this.props.inEditor,forceIcon:this.props.forceIcon});case"PanelToggle":return(0,ss.jsx)(po.ZP,{...h,className:"panel-clickoutside-ignore",tooltip:this.state.panelBarVisible?(0,B.Z)("verb","Hide Panel"):(0,B.Z)("verb","Show Panel"),tooltipExtra:Ioe,onClick:this.#vn,onMiddleClick:e=>jn.Z.toggleFloating(),style:{"--panelOpen":this.state.panelBarVisible?1:0,transform:"right"===this.props.prefValues[I.kPanelsPosition]?"scaleX(-1)":"unset"},image:Wi.sxI[this.props.size],label:i,commandId:"COMMAND_TOGGLE_PANEL"});case"SyncStatus":return!he.ZP.isIncognitoOrGuest(this.winId)&&(0,ss.jsx)(Gse,{...h});case"StatusInfo":return"overlay"!==this.state.statusBarDisplay||this.props.preview?(0,ss.jsx)(Wse,{...h,preview:e}):null;case"VersionInfo":return this.props.prefValues[I.kBiscuitVersion]?Coe("div",{className:"biscuit-setting-version"},void 0,Coe("span",{className:"application-icon-biscuit",dangerouslySetInnerHTML:{__html:Wi.Qa2}}),Coe("span",{className:"biscuit-string"},void 0," ",function(){if(!Zoe){const{vivaldiVersion:e,chromiumVersion:t}=se.Z.utilities.getVersion();Zoe=`Vivaldi ${e} / Chrome ${t}`}return Zoe}()," ")):null;case"CaptureImages":return(0,ss.jsx)(ow,{...h,winId:this.context.vivaldiWindowId});case"TilingToggle":return(0,ss.jsx)(toe,{...h,pageId:this.state.activePageId,disabled:!1});case"ImagesToggle":return(0,ss.jsx)(Xse,{...h,disabled:!1});case"PageActions":return(0,ss.jsx)(cw,{...h,pageId:this.state.activePageId,disabled:!1});case"Zoom":return(0,ss.jsx)(Sw,{...h,pageId:this.state.activePageId,preview:this.props.inEditor});case"Settings":return(0,ss.jsx)(po.ZP,{...h,className:"panel-clickoutside-ignore",tooltip:(0,Qf.wY)("Settings"),onClick:this.#yn,image:Wi.bqs[this.props.size],label:i,commandId:"COMMAND_SHOW_SETTINGS"});default:return null}}}const koe=(0,Bu.Z)(Eoe,Aoe);var _oe;function Noe(e,t,n,i){_oe||(_oe="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:_oe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Poe={onDidAbortWithError:(0,B.Z)("Update Failed"),onDidFindValidUpdate:(0,B.Z)("Update Available"),onUpdaterDidNotFindUpdate:(0,B.Z)("Up to Date"),onWillDownloadUpdate:(0,B.Z)("Downloading Update"),onDidDownloadUpdate:(0,B.Z)("Installing Update"),onWillInstallUpdateOnQuit:(0,B.Z)("Restart Required"),onNeedRestartToReloadCodecs:(0,B.Z)("Restart Required"),onUpdaterDidRelaunchApplication:(0,B.Z)("Vivaldi Updated")};class Doe extends Li.Component{static contextType=ts.Z;state={hasAutoUpdates:!1};componentDidMount(){this.refreshAutoInstallUpdates()}refreshAutoInstallUpdates=()=>{se.Z.autoUpdate.getAutoInstallUpdates((e=>{this.setState({hasAutoUpdates:e})}))};openDownloadPage=()=>{c.ZP.openURL(this.context.vivaldiWindowId,"https://vivaldi.com/download/"),this.props.hidePopup()};render(){const{status:e,version:t,releaseNotesUrl:n}=this.props.updateState;if(!e)return null;const i=(0,QC.Z)("input"),s=he.ZP.isIncognito(this.context.vivaldiWindowId),o="onWillInstallUpdateOnQuit"===e||"onNeedRestartToReloadCodecs"===e,{vivaldiVersion:a}=se.Z.utilities.getVersion();return(0,ss.jsxs)(ss.Fragment,{children:[Noe("h2",{id:"popup-label-updatepending"},void 0,Poe[e]),Noe("div",{className:"popup-scrollarea"},void 0,"onDidAbortWithError"===e&&(0,ss.jsxs)(ss.Fragment,{children:[Noe("p",{className:"popup-infotext"},void 0,(0,B.Z)("Unable to check for update.")),Noe("p",{className:"popup-infotext"},void 0,(0,B.Z)("Please try again later or visit")," ",Noe(A_.Z,{onClick:this.openDownloadPage},void 0,"vivaldi.com/download"))]}),"onDidFindValidUpdate"===e&&!this.state.hasAutoUpdates&&Noe("p",{className:"popup-infotext"},void 0,(0,B.Z)("An update to version $1 is available.",[t??""])),"onDidFindValidUpdate"===e&&this.state.hasAutoUpdates&&Noe("p",{className:"popup-infotext"},void 0,(0,B.Z)("An update to version $1 is available and scheduled for download.",[t??""])),"onUpdaterDidNotFindUpdate"===e&&Noe("p",{className:"popup-infotext"},void 0,(0,B.Z)("You are already running the latest version of Vivaldi ($1).",[a])),"onWillDownloadUpdate"===e&&(0,ss.jsxs)(ss.Fragment,{children:[Noe("p",{className:"popup-infotext"},void 0,(0,B.Z)("An update to Vivaldi version $1 is being downloaded.",[t??""])),Noe("p",{className:"popup-infotext"},void 0,(0,B.Z)("Please wait..."))]}),"onDidDownloadUpdate"===e&&(0,ss.jsxs)(ss.Fragment,{children:[Noe("p",{className:"popup-infotext"},void 0,(0,B.Z)("Installing Vivaldi update version $1.",[t??""])),Noe("p",{className:"popup-infotext"},void 0,(0,B.Z)("Please wait..."))]}),"onWillInstallUpdateOnQuit"===e&&""!==t&&Noe("p",{className:"popup-infotext"},void 0,(0,B.Z)("Restart Vivaldi to begin using the new version $1.",[t??""])),"onWillInstallUpdateOnQuit"===e&&""===t&&Noe("p",{className:"popup-infotext"},void 0,(0,B.Z)("Vivaldi has been updated in the background. Please restart now to complete the update.",[t])),"onNeedRestartToReloadCodecs"===e&&Noe("p",{className:"popup-infotext"},void 0,(0,B.Z)("Audio and video support has been updated. Please restart to allow playing additional types of media.")),"onUpdaterDidRelaunchApplication"===e&&Noe("p",{className:"popup-infotext"},void 0,(0,B.Z)("Vivaldi successfully updated to version $1.",[a]))),s&&o&&Noe("p",{className:"popup-warning"},void 0,(0,B.Z)("This will reset your Private Windows.")),Noe("footer",{className:"dialog-footer"},void 0,"onDidFindValidUpdate"===e&&this.state.hasAutoUpdates&&Noe("input",{type:"submit",className:"primary",onClick:()=>{c.ZP.openURL(this.context.vivaldiWindowId,n),this.props.hidePopup()},value:(0,B.Z)("Show Release Notes")}),"onDidFindValidUpdate"===e&&!this.state.hasAutoUpdates&&Noe("input",{type:"submit",className:"primary",onClick:()=>{se.Z.autoUpdate.checkForUpdates(!0),this.props.hidePopup()},value:(0,B.Z)("Update Vivaldi")}),o&&Noe(i,{type:"submit",className:"danger",onClick:()=>se.Z.autoUpdate.installUpdateAndRestart(),value:(0,B.Z)("browser","Restart")}))]})}}const Moe=Doe;var Ooe;function xoe(e,t,n,i){Ooe||(Ooe="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Ooe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Loe={display:"none"};class Roe extends Li.PureComponent{constructor(){super();this.state={autoUpdateEnabled:!1,popupVisible:!1,updateState:{status:void 0,version:void 0,releaseNotesUrl:void 0}}}componentDidMount(){if(this.props.inEditor)return;se.Z.autoUpdate.isUpdateNotifierEnabled((e=>{this.setState({autoUpdateEnabled:e})}));const{onDidAbortWithError:e,onDidFindValidUpdate:t,onWillDownloadUpdate:n,onDidDownloadUpdate:i,onWillInstallUpdateOnQuit:s,onNeedRestartToReloadCodecs:o,onUpdaterDidRelaunchApplication:a,onUpdateFinished:r}=se.Z.autoUpdate;e.addListener(this.#bn),t.addListener(this.#Sn),n.addListener(this.#wn),i.addListener(this.#Cn),s.addListener(this.#An),o.addListener(this.#In),a.addListener(this.#Tn),r.addListener(this.#Zn)}componentWillUnmount(){if(this.props.inEditor)return;const{onDidAbortWithError:e,onDidFindValidUpdate:t,onWillDownloadUpdate:n,onDidDownloadUpdate:i,onWillInstallUpdateOnQuit:s,onNeedRestartToReloadCodecs:o,onUpdaterDidRelaunchApplication:a,onUpdateFinished:r}=se.Z.autoUpdate;e.removeListener(this.#bn),t.removeListener(this.#Sn),n.removeListener(this.#wn),i.removeListener(this.#Cn),s.removeListener(this.#An),o.removeListener(this.#In),a.removeListener(this.#Tn),r.removeListener(this.#Zn)}#bn=(e,t)=>{e&&console.warn(e,t),this.setState((0,v.Uy)((({updateState:e})=>{e.status="onDidAbortWithError"})))};#Sn=(e,t)=>{this.setState((0,v.Uy)((({updateState:n})=>{n.status="onDidFindValidUpdate",n.version=t,n.releaseNotesUrl=e})))};#wn=e=>{this.setState((0,v.Uy)((({updateState:t})=>{t.status="onWillDownloadUpdate",t.version=e})))};#Cn=e=>{this.setState((0,v.Uy)((({updateState:t})=>{t.status="onDidDownloadUpdate",t.version=e})))};#An=e=>{this.setState((0,v.Uy)((({updateState:t})=>{t.status="onWillInstallUpdateOnQuit",t.version=e})))};#In=()=>{this.setState((0,v.Uy)((({updateState:e})=>{e.status="onNeedRestartToReloadCodecs"})))};#Tn=()=>{this.setState((0,v.Uy)((({updateState:e})=>{e.status="onUpdaterDidRelaunchApplication"})))};#Zn=()=>{this.setState((0,v.Uy)((({updateState:e})=>{e.status=void 0}))),this.hidePopup()};togglePopup=()=>{this.setState((e=>({popupVisible:!e.popupVisible})))};hidePopup=()=>{this.setState({popupVisible:!1})};render(){let{status:e}=this.state.updateState;const t=this.props.preview||this.props.inEditor;!e&&t&&(e="onUpdaterDidNotFindUpdate");const n=!this.state.autoUpdateEnabled&&!t;return xoe(po.ZP,{style:!e||n?Loe:void 0,image:Wi.nuh[this.props.size],title:e?Poe[e]:" ",titleIsStatus:!0,onClick:this.togglePopup,customizeMenu:this.props.customizeMenu,menuOrigin:this.props.menuOrigin,popupClassName:"UpdatePopup ToolbarButtonPopup-DefaultStyles",popupLabelledBy:"popup-label-updatepending",popupPosition:this.props.popupPosition,hidePopup:this.hidePopup,isPopupVisible:this.state.popupVisible,size:this.props.size,draggable:this.props.draggable,onDragStart:this.props.onDragStart??Lr.Z,onDragEnd:this.props.onDragEnd??Lr.Z,onDrop:this.props.onDrop??Lr.Z,onDragEnter:this.props.onDragEnter??Lr.Z,onDragLeave:this.props.onDragLeave??Lr.Z,onDragOver:this.props.onDragOver??Lr.Z,mimeType:this.props.mimeType,name:this.props.name},void 0,xoe(Moe,{hidePopup:this.hidePopup,updateState:this.state.updateState}))}}const Boe=(0,dp.ZP)(Roe);class Foe extends hr.Z{dispatchAction(e){switch(e.actionType){case"MAIN_SHOW_CLEAR_BROWSING_HISTORY_DIALOG":case"MAIN_SHOW_MAIL_ACCOUNT_DIALOG":case"MAIN_SHOW_CALENDAR_ACCOUNT_DIALOG":case"MAIN_SHOW_CREATE_CALENDAR_DIALOG":case"MAIN_SHOW_IMPORT_DATA_DIALOG":case"MAIN_SHOW_MAIL_INFO_DIALOG":case"MAIN_SHOW_KEYBOARDS_SHORTCUTS":case"MAIN_SHOW_PAGE_ACCESS_KEYS":case"MAIN_SHOW_OPEN_SESSION_DIALOG":case"MAIN_SHOW_QUICKCOMMANDS":case"MAIN_SHOW_PRIVACY_STATS":case"MAIN_SHOW_CREATE_LABEL":case"MAIN_SHOW_LABEL_FLAG_DIALOG":case"MAIN_TOOLBAR_SPACER_UPDATE":this.emitChange({winId:e.winId,type:e.actionType});break;case"MAIN_SELECTING_TOOLBAR":this.emitChange({winId:e.winId,type:"MAIN_SELECTING_TOOLBAR",options:e.options});break;case"MAIN_SHOW_CONFIRM_OPEN_LINKS_DIALOG":this.emitChange({winId:e.winId,type:"MAIN_SHOW_CONFIRM_OPEN_LINKS_DIALOG",options:e.options});break;case"MAIN_SHOW_CONFIRM_CLOSE_OTHER_TABS_DIALOG":this.emitChange({winId:e.winId,type:"MAIN_SHOW_CONFIRM_CLOSE_OTHER_TABS_DIALOG",options:e.options});break;case"MAIN_SHOW_BOOKMARK_DIALOG":this.emitChange({winId:e.winId,type:"MAIN_SHOW_BOOKMARK_DIALOG",options:e.options});break;case"MAIN_SHOW_SAVE_SESSION_DIALOG":this.emitChange({winId:e.winId,type:"MAIN_SHOW_SAVE_SESSION_DIALOG",options:e.options});break;case"MAIN_SHOW_ADD_FEED":this.emitChange({winId:e.winId,type:"MAIN_SHOW_ADD_FEED",options:e.options});break;case"MAIN_SHOW_ADD_MAIL_FOLDER":this.emitChange({winId:e.winId,type:"MAIN_SHOW_ADD_MAIL_FOLDER",options:e.options});break;case"MAIN_SHOW_DELETE_MAIL_FOLDER":this.emitChange({winId:e.winId,type:"MAIN_SHOW_DELETE_MAIL_FOLDER",options:e.options});break;case"MAIN_SHOW_ADD_FEED_FOLDER":this.emitChange({winId:e.winId,type:"MAIN_SHOW_ADD_FEED_FOLDER",options:e.options});break;case"MAIN_SHOW_DELETE_FEED_FOLDER":this.emitChange({winId:e.winId,type:"MAIN_SHOW_DELETE_FEED_FOLDER",options:e.options});break;case"MAIN_SHOW_DELETE_WORKSPACE":this.emitChange({winId:e.winId,type:"MAIN_SHOW_DELETE_WORKSPACE",options:e.options});break;case"MAIN_SHOW_WORKSPACE_DIALOG":this.emitChange({winId:e.winId,type:"MAIN_SHOW_WORKSPACE_DIALOG",options:e.options});break;case"MAIN_SHOW_NOTE_SELECTION_DIALOG":this.emitChange({winId:e.winId,type:"MAIN_SHOW_NOTE_SELECTION_DIALOG",options:e.options});break;case"MAIN_SHOW_MAIL_AUTHENTICATION_DIALOG":this.emitChange({winId:e.winId,type:"MAIN_SHOW_MAIL_AUTHENTICATION_DIALOG",options:e.options});break;case"MAIN_SHOW_MAIL_UNSUBSCRIBE_DIALOG":this.emitChange({winId:e.winId,type:"MAIN_SHOW_MAIL_UNSUBSCRIBE_DIALOG",options:e.options});break;case"MAIN_SHOW_MAIL_DELETE_DIALOG_ACCOUNTS":this.emitChange({winId:e.winId,type:"MAIN_SHOW_MAIL_DELETE_DIALOG_ACCOUNTS",options:e.options});break;case"MAIN_SHOW_MAIL_DELETE_DIALOG_CONFIRM_ALL":this.emitChange({winId:e.winId,type:"MAIN_SHOW_MAIL_DELETE_DIALOG_CONFIRM_ALL",options:e.options});break;case"MAIN_SHOW_DELETE_LABEL_CONFIRMATION":this.emitChange({winId:e.winId,type:"MAIN_SHOW_DELETE_LABEL_CONFIRMATION",options:e.options});break;case"MAIN_SHOW_DELETE_FILTER_CONFIRMATION":this.emitChange({winId:e.winId,type:"MAIN_SHOW_DELETE_FILTER_CONFIRMATION",options:e.options});break;case"MAIN_SHOW_DELETE_FEED_CONFIRMATION":this.emitChange({winId:e.winId,type:"MAIN_SHOW_DELETE_FEED_CONFIRMATION",options:e.options});break;case"MAIN_SHOW_MAIL_VIEW_FILTER_CONFIRMATION":this.emitChange({winId:e.winId,type:"MAIN_SHOW_MAIL_VIEW_FILTER_CONFIRMATION",options:e.options});break;case"MAIN_SHOW_MAIL_UPLOAD_CONFIRMATION":this.emitChange({winId:e.winId,type:"MAIN_SHOW_MAIL_UPLOAD_CONFIRMATION",options:e.options});break;case"MAIN_SHOW_MAIL_MESSAGE_MOVE_CONFIRMATION":this.emitChange({winId:e.winId,type:"MAIN_SHOW_MAIL_MESSAGE_MOVE_CONFIRMATION",options:e.options});break;case"MAIN_SHOW_MAIL_CREATE_ARCHIVE_FOLDER_CONFIRMATION":this.emitChange({winId:e.winId,type:"MAIN_SHOW_MAIL_CREATE_ARCHIVE_FOLDER_CONFIRMATION",options:e.options});break;case"MAIN_SHOW_TOOLBAR_RESET":this.emitChange({winId:e.winId,type:"MAIN_SHOW_TOOLBAR_RESET",options:e.options});break;case"MAIN_SHOW_MAIL_DELETE_DIALOG_FOLDERS":this.emitChange({winId:e.winId,type:"MAIN_SHOW_MAIL_DELETE_DIALOG_FOLDERS",options:e.options});break;case"MAIN_SHOW_MAIL_DELETE_DIALOG_SETTING":this.emitChange({winId:e.winId,type:"MAIN_SHOW_MAIL_DELETE_DIALOG_SETTING",options:e.options});break;case"MAIN_SHOW_ACCOUNT_SHEET":this.emitChange({winId:e.winId,type:"MAIN_SHOW_ACCOUNT_SHEET",options:e.options});break;case"MAIN_SHOW_CALENDAR_ALARM":this.emitChange({winId:e.winId,type:"MAIN_SHOW_CALENDAR_ALARM",options:e.options});break;case"MAIN_SHOW_CALENDAR_EDIT_EVENT":this.emitChange({winId:e.winId,type:"MAIN_SHOW_CALENDAR_EDIT_EVENT",options:e.options});break;case"MAIN_SHOW_CALENDAR_EDIT_TEMPLATE":this.emitChange({winId:e.winId,type:"MAIN_SHOW_CALENDAR_EDIT_TEMPLATE",options:e.options});break;case"MAIN_SHOW_CALENDAR_IMPORT_EVENTS_DIALOG":this.emitChange({winId:e.winId,type:"MAIN_SHOW_CALENDAR_IMPORT_EVENTS_DIALOG",options:e.options});break;case"MAIN_SHOW_MODAL_DIALOG":this.emitChange({winId:e.winId,type:"MAIN_SHOW_MODAL_DIALOG",options:e.options});break;case"MAIN_SHOW_MODAL_INFO":this.emitChange({winId:e.winId,type:"MAIN_SHOW_MODAL_INFO",options:e.options});break;case"MAIN_SHOW_DIALOG":this.emitChange({winId:e.winId,type:e.actionType,options:e.options,onAfterClose:e.onAfterClose});break;case"MAIN_SHOW_BOOKMARK_ADDED_POPUP":this.emitChange({winId:e.winId,type:"MAIN_SHOW_BOOKMARK_ADDED_POPUP",options:e.options});break;case"MAIN_SHOW_ENABLE_SESSION_AUTOSAVE_DIALOG":this.emitChange({type:"MAIN_SHOW_ENABLE_SESSION_AUTOSAVE_DIALOG",winId:e.winId,options:e.options});break;case"MAIN_SHOW_ENABLE_WORKSPACE_DIALOG":this.emitChange({winId:e.winId,type:"MAIN_SHOW_ENABLE_WORKSPACE_DIALOG",options:e.options});break;case"MAIN_SHOW_INCLUDE_WORKSPACE_DIALOG":this.emitChange({winId:e.winId,type:"MAIN_SHOW_INCLUDE_WORKSPACE_DIALOG",options:e.options});break;case"MAIN_SHOW_CONTEXT_DIALOG":this.emitChange({winId:e.winId,type:"MAIN_SHOW_CONTEXT_DIALOG",options:e.options})}}}const Woe=new Foe(A.Z);var Uoe;function Voe(e,t,n,i){Uoe||(Uoe="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Uoe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Hoe=[I.kAddressBarPosition,I.kMailViewLayout,I.kMenuDisplay,I.kPanelsAsOverlayEnabled,I.kPanelsPosition,I.kTabsBarPosition,I.kWindowsLinuxAltControls];function Goe(e){return"PanelWidthSpacer"===e.name}class $oe extends Li.PureComponent{static contextType=ts.Z;id=crypto.randomUUID();state={enforcedWidth:0};componentDidMount(){this.props.inEditor||Goe(this.props)&&(this.delayedSpacerUpdate(),Woe.addListener(this.onMainStoreChanged),Yn.ZP.addListener(this.delayedSpacerUpdate))}componentDidUpdate(e){if(this.props.inEditor!==e.inEditor)throw new Error("PanelButton: Invalid props change");Goe(this.props)&&e.prefValues!==this.props.prefValues&&this.delayedSpacerUpdate(),this.props.inEditor||Goe(this.props)!==Goe(e)&&(Goe(this.props)?(Woe.addListener(this.onMainStoreChanged),Yn.ZP.addListener(this.delayedSpacerUpdate)):(Woe.removeListener(this.onMainStoreChanged),Yn.ZP.removeListener(this.delayedSpacerUpdate)))}componentWillUnmount(){this.props.inEditor||Goe(this.props)&&(Woe.removeListener(this.onMainStoreChanged),Yn.ZP.removeListener(this.delayedSpacerUpdate))}onMainStoreChanged=e=>{"MAIN_TOOLBAR_SPACER_UPDATE"===e.type&&this.delayedSpacerUpdate()};delayedSpacerUpdate=()=>{this.frame=this.context.requestAnimationFrame(this.setSpacerWidth)};shouldEnforceWidth=()=>{if(Goe(this.props)&&!this.props.inEditor&&!this.props.preview){const{document:e}=this.context,t=e.getElementById(this.id);if(!t||!t?.checkVisibility())return!1;const n=t.parentElement;if(n&&!n.className.includes("toolbar-panel"))return this.props.index===[...n.querySelectorAll(":scope > *:not(.window-buttongroup, .vivaldi)")].indexOf(t)}return!1};setSpacerWidth=()=>{if(!this.shouldEnforceWidth())return;const e=this.getSpacerWidth();e>=0&&this.setState({enforcedWidth:e})};getImage=()=>{switch(this.props.name){case"PanelWidthSpacer":return Wi.GYw[this.props.size];case"FlexibleSpacer":return Wi.K3w[this.props.size];default:return Wi.Vzw[this.props.size]}};getSpacerWidth=()=>{const e=34,{vivaldiWindowId:t}=this.context,n=Yn.ZP.getSelected(t);if(this.props.prefValues[I.kPanelsAsOverlayEnabled]||n&&Yn.ZP.getSeparateFloating(n,t))return e;const{document:i}=this.context,s=i.getElementById(this.id),o=s?.parentElement?.clientWidth;if(!s||!o)return-1;const a=Math.min(Yn.ZP.getWidth(this.context.vivaldiWindowId),this.context.innerWidth/3);if(s.offsetLeft<o/2){if(!s.parentElement)return-1;if("left"===this.props.prefValues[I.kPanelsPosition]){const t=s.previousElementSibling?.getBoundingClientRect(),n=t?.right?t.right+1:0;return Math.max(a-n,e)}return e}if(s.offsetLeft>o/2){if(!s?.parentElement)return-1;if("right"===this.props.prefValues[I.kPanelsPosition]){const t=s?.nextElementSibling,n=t?.getBoundingClientRect(),i=this.context.innerWidth-(n?.left?n.left+1:0);return Math.max(a-i,e)}return e}return e};getControlsWidth=()=>{let e=0;return"top"===this.props.prefValues[I.kTabsBarPosition]||"top"===this.props.prefValues[I.kMenuDisplay]||this.props.prefValues[I.kWindowsLinuxAltControls]||(e=44),e};executeChain=e=>{const{ctrlKey:t,altKey:n,shiftKey:i,metaKey:s}=e,{chain:o}=C.Z.get(I.kChainedCommandsCommandList).find((e=>e.name===this.props.name));(0,x8.hT)({origin:"button",context:this.context,windowId:this.context.vivaldiWindowId,keyState:{ctrlKey:t,altKey:n,shiftKey:i,metaKey:s,key:""}},o)};render(){if(this.props.commandButton){const e=C.Z.get(I.kChainedCommandsCommandList).find((e=>e.name===this.props.name));return e?Voe(po.ZP,{name:e.name,customizeMenu:this.props.customizeMenu,image:Wi.Znx[this.props.size],draggable:this.props.draggable,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,onDrop:this.props.onDrop,onDragEnter:this.props.onDragEnter,className:"toolbar-command",tooltip:e.label,onClick:this.executeChain,mimeType:this.props.mimeType,size:this.props.size}):null}if("Divider"===this.props.name)return Voe(po.ZP,{customizeMenu:this.props.customizeMenu,name:this.props.name,image:Wi.Fm3[this.props.size],mimeType:this.props.mimeType,draggable:this.props.draggable,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,onDrop:this.props.onDrop,onDragEnter:this.props.onDragEnter,className:"toolbar-divider",tooltip:" ",disabled:!this.props.preview,alwaysMenu:!0});let e={};if(!this.props.inEditor&&Goe(this.props))if(this.state.enforcedWidth)e={flexBasis:this.state.enforcedWidth};else if("top"===this.props.prefValues[I.kAddressBarPosition]){const t=this.getControlsWidth();e={flexBasis:Yn.ZP.getWidth(this.context.vivaldiWindowId)-t-34*this.props.index}}return Voe(po.ZP,{style:e,id:Goe(this.props)?this.id:void 0,customizeMenu:this.props.customizeMenu,name:this.props.name,image:this.getImage(),mimeType:this.props.mimeType,draggable:this.props.draggable,onDragStart:this.props.onDragStart,onDragEnd:this.props.onDragEnd,onDrop:this.props.onDrop,onDragEnter:this.props.onDragEnter,className:Fi()({"toolbar-spacer-panel":Goe(this.props),"toolbar-spacer-flexible":"FlexibleSpacer"===this.props.name,"toolbar-spacer":"Spacer"===this.props.name}),disabled:!this.props.preview,tooltip:" ",alwaysMenu:!0})}}const Koe=(0,Bu.Z)($oe,Hoe);var zoe,joe=n(88901);function Yoe(e,t,n,i){zoe||(zoe="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:zoe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function Xoe(e,t,n,i,s){if(!n||!i||!s)return{display:"none"};const o=n.x,[a,r]=t,l=e/2;return{transform:`translate(${o}px, ${(0,Gw.Z)(s.y+(i.y-n.y),a+l,r-l)}px)`}}var Qoe,qoe=Yoe("div",{className:"checkmark"},void 0,Yoe(co,{type:"checkmark"})),Joe=Yoe(co,{type:"reorder"});function eae({itemHeight:e,refDragArea:t,refScrollArea:n,workspaceCount:i}){const{item:s,isDragging:o,initialClientOffset:a,initialSourceClientOffset:r,sourceClientOffset:l}=(0,$6.f)((e=>({item:e.getItem(),isDragging:e.isDragging(),initialClientOffset:e.getInitialClientOffset(),initialSourceClientOffset:e.getInitialSourceClientOffset(),sourceClientOffset:e.getSourceClientOffset()})));if(!o)return null;const d=GF.Z.getWorkspaceById(s.id);if(!d)return null;const{tabCount:c,isActive:u,isActiveInAnotherWindow:p}=s,{name:h,icon:g,emoji:m}=d,f=function(e,t){const n=e?.getBoundingClientRect(),i=t?.getBoundingClientRect();return n&&i?[Math.max(n.top,i.top),i.bottom]:[0,0]}(t.current,n.current),v=Boolean(n.current&&n.current.scrollHeight>n.current.clientHeight);return Yoe("div",{className:Fi()("workspace-custom-drag-layer",{"has-scrollbar":v})},void 0,Yoe("button",{style:Xoe(e,f,r,l,a),className:Fi()("workspace-item-wrapper",{selected:u&&!p}),title:h},void 0,Yoe("div",{className:"avatar picker",dangerouslySetInnerHTML:{__html:m??g}}),Yoe("div",{className:"title"},void 0,Yoe("p",{},void 0,h),Yoe("p",{className:"tab-count"},void 0,p?(0,B.Z)("Active in another window"):(0,B.Z)("$1 tab","$1 tabs",[c]))),u&&!p?qoe:i>1?Joe:null))}function tae(e,t,n,i){Qoe||(Qoe="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Qoe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function nae({windowId:e,activeWorkspaceId:t,toolbarSize:n,onClick:i}){const s=Ce.ZP.isSelecting(e),o=!t,a=s||o,r=(0,Li.useCallback)((()=>{i()}),[i]),l=(0,Li.useCallback)((()=>{const t=s?Ce.ZP.getSelectedPages(e):o?Ce.ZP.getPages(e,{workspaceId:void 0}):(0,ze.aV)();return[{handler:()=>i(),...(0,us.Z)("command","New Workspace")},...t.isEmpty()?[]:[{handler:()=>i(t),...(0,us.Z)("New Workspace with $1 Selected Tab","New Workspace with $1 Selected Tabs",[t.size])}]]}),[o,s,i,e]);return tae(po.ZP,{buttonClasses:"FormButton FormButton--WithIcon",menuOrigin:"bottomLeft",menu:a?l:void 0,isMenuIndicatorVisible:a,onClick:r,title:(0,B.Z)("command","New Workspace"),tabIndex:0,commandId:"COMMAND_WORKSPACE_CREATE_NEW"})}const iae="draggable-workspace";var sae;function oae(e,t,n,i){sae||(sae="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:sae,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const aae=Wi.S0Y;var rae=oae("div",{className:"checkmark"},void 0,oae(co,{type:"checkmark"})),lae=oae(co,{type:"reorder"});const dae=Li.forwardRef((function({id:e,name:t,icon:n,emoji:i,audioStatus:s,tabCount:o,hibernatedCount:a,windowId:r,workspaceCount:l,isActive:d,isActiveInAnotherWindow:c,isRenaming:u,isPickingIcon:p,onSelect:h,onContextMenu:g,onShowIconModal:m,onToggleMuteWorkspaceTabs:f,findItem:v,moveItem:y,onDrop:b,nameInput:S,style:w,onKeyDown:A},T){const Z=Li.useRef(),E=v(e)?.index,[{isDragging:k,handlerId:_},N,P]=(0,_Q.c)((()=>({type:iae,item:{id:e,originalIndex:E,name:t,tabCount:o,isActive:d,isActiveInAnotherWindow:c,workspaceCount:l},collect:e=>({isDragging:e.isDragging(),handlerId:e.getHandlerId()})})),[e,E,y]),[,D]=(0,NQ.L)((()=>({accept:iae,hover(t,n){if(!Z.current||"number"!=typeof E)return;const i=t.originalIndex,s=E;if(i===s)return;const o=Z.current?.getBoundingClientRect(),a=(o.bottom-o.top)/2,r=n.getClientOffset().y-o.top;i<s&&r<a||i>s&&r>a||(y(t.id,e),t.originalIndex=s)},drop:b})),[e,y]);return Li.useEffect((()=>{P((0,q6.r)(),{captureDraggingState:!0})}),[P]),l>1&&(N(Z),D(Z)),(0,ss.jsxs)("button",{ref:Z,style:{...w,opacity:k?0:1},className:Fi()("workspace-item-wrapper draggable",{selected:d&&!c}),title:`${t} ${!c&&a>0?"\r\n"+(0,B.Z)("$1 hibernated tab","$1 hibernated tabs",[a]):""}`,onPointerUp:t=>t.button===es.Z.kLeft&&h(e),onClick:t=>{t.preventDefault(),h(e)},onContextMenu:t=>g(t,e),"data-handler-id":_,onKeyDown:A,children:[(0,ss.jsx)("div",{ref:T,className:"avatar picker",onPointerDown:t=>m(t,e),onPointerUp:p?ms.ZP:Lr.Z,onClick:ms.ZP,dangerouslySetInnerHTML:{__html:i??n??aae}}),u&&S,!u&&oae("div",{className:"title"},void 0,oae("p",{},void 0,t),oae("p",{className:"tab-count"},void 0,c?(0,B.Z)("Active in another window"):(0,B.Z)("$1 tab","$1 tabs",[o]))),s&&oae("div",{className:Fi()("audio-container",{"workspace-inactive":!d||c}),onClick:ms.ZP,onPointerUp:t=>f(t,r,e,s)},void 0,oae(joe.Z,{animated:C.Z.get(I.kThemeUseAnimation),mediaState:(0,ze.l4)([s]),src:"tab"})),d&&!c?rae:l>1?lae:null]},e)})),cae=Li.memo(dae);function uae({workspaceName:e,name:t,submitOnBlur:n,onSubmitEdit:i,onCancelEdit:s,onNameChange:o},a){const r=(0,Li.useContext)(ts.Z),[l,d]=(0,Li.useState)(!1),c=()=>{d(!0)};return(0,ss.jsx)("input",{ref:a,type:"text",name:t,value:e,onKeyDown:e=>{l||(e.keyCode===xa.Z.KEY_ENTER||e.keyCode===xa.Z.KEY_RETURN?i():e.keyCode===xa.Z.KEY_ESCAPE&&s())},onBlur:n?i:Lr.Z,onFocus:e=>{e.target instanceof r.HTMLInputElement&&e.target.select()},onChange:o,onCompositionStart:c,onCompositionUpdate:c,onCompositionEnd:()=>{d(!1)}})}const pae=(0,Li.forwardRef)(uae);var hae,gae=n(34155);function mae(e,t,n,i){hae||(hae="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:hae,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const fae={stiffness:500,damping:32};function vae(e,t){const n=Ce.ZP.getPageHistory(e);for(let t=n.length-1;t>-1;t--){const i=n[t],s=Ce.ZP.getPageInWindow(e,i);if(s&&void 0===(0,kv.cm)(s))return pn.jk.getDisplayTitle(s)}return""}function yae(e,t,n,i){e.stopPropagation();const s=Ce.ZP.getPages(t,{workspaceId:n});"playing"===i?c.ZP.setMuting(t,"selection","mute",s):c.ZP.setMuting(t,"selection","unmute",s)}function bae(){return GF.S[Math.floor(Math.random()*GF.S.length)]}var Sae=mae(po.ZP,{image:Wi.BmN,tooltip:" ",size:"small",className:"avatar",imageOnly:!0,name:"WorkspaceButton"}),wae=mae("div",{className:"checkmark"},void 0,mae(co,{type:"checkmark"})),Cae=mae("hr",{});const Aae=Li.forwardRef((function(e,t){const{windowId:n,activeWorkspaceId:i,hidePopup:s}=e,o=Li.useContext(ts.Z),a=yL(),r=Li.useRef(),l=Li.useRef(null),d=Li.useRef(null),u=Ce.ZP.getActiveWorkspaces(),[p,h]=Li.useState(void 0),[g,m]=Li.useState(void 0),[f,y]=Li.useState(""),[b,S]=Li.useState(),[w,A]=Li.useState(0),T=Li.useRef(),Z=Li.useRef(),E=Li.useMemo((()=>new Map),[]),{counts:k,playingAudio:_}=function(e){const t=GF.Z.getState(),n=he.ZP.isIncognitoOrGuest(e),i=new Map(t.map((e=>[e.id,[0,0]]))),s=new Map(t.map((e=>[e.id,void 0])));let o=new ze.l4;const a=(0,DD.Z)(Ce.ZP);for(const[t,r]of a)n===he.ZP.isIncognitoOrGuest(t)&&r.list.groupBy(kv.cm).forEach(((n,a)=>{let r;void 0===a&&e!==t||(n.some((e=>e.audible&&!e.vivExtData.vivaldi_tab_muted?(r="playing",!0):(e.audible&&e.vivExtData.vivaldi_tab_muted&&(r="muting"),!1))),s.set(a,r),!a||i.has(a)||he.ZP.isIncognitoOrGuest(t)||(console.warn(`Workspace ${a} no longer exists.`),o=o.add(a)),i.set(a,[n.size,n.count((e=>e.discarded))]))}));for(const e of o)CQ.Z.addWorkspaceWithId(e,(0,B.Z)("Restored workspace"),bae(),void 0);return{counts:i,playingAudio:s}}(n),[N,P]=Li.useState(""),[D,M]=Li.useState(""),[O,x]=Li.useState(),[L,R]=Li.useState(!1),F=_.get(void 0),W=e.workspaces.length,U=Li.useRef(!0);Li.useEffect((()=>{if(!U.current||"number"!=typeof i)return;const e=E.get(i)?.current;e&&o.requestAnimationFrame((()=>{e.scrollIntoViewIfNeeded(!0),U.current=!1}))}));const[V,H]=Li.useState(e.workspaces),G=Li.useRef(e.workspaces);V!==e.workspaces&&(G.current=e.workspaces,H(e.workspaces));const $=Li.useCallback((async e=>{g&&e===g||(e!==i&&c.ZP.setActiveWorkspace(n,e),s())}),[i,s,g,n]),K=Li.useCallback(((e,t)=>{const o="workspacelist",a=Boolean(t&&u.has(t)),r=a&&t!==i,l=ji.Z.getOptionFunction(o),d=t?Ce.ZP.getWorkspacePages(t):Ce.ZP.getPages(n,{workspaceId:void 0});return ji.Z.getNamedMenu(n,o,(async e=>{switch(e.action){case"CONTEXT_WORKSPACE_RENAME":return{handler:()=>{m(t);const e=G.current?.find((e=>e.id===t))?.name??"";P(e),gae.nextTick((()=>{Z.current?.select()}))},isVisible:()=>Boolean(t),...l(n,e,t)};case"CONTEXT_WORKSPACE_DELETE":return{isEnabled:()=>!r,handler:()=>{s(),t&&de.Z.showDeleteWorkspace(n,{workspaceId:t})},isVisible:()=>Boolean(t),...l(n,e,t)};case"CONTEXT_WORKSPACE_OPEN_IN_NEW_WINDOW":return{isEnabled:()=>!a,handler:e=>{t&&c.ZP.detachWorkspace(n,t).finally(s)},isVisible:()=>Boolean(t),...l(n,e,t)};case"CONTEXT_WORKSPACE_HIBERNATE":return{handler:()=>{d.filter((e=>!(e.active||e.discarded))).forEach(c.ZP.discardPage),s()},isVisible:()=>d.some((e=>!(e.active||e.discarded))),...l(n,e,t)};case"CONTEXT_WORKSPACE_COPY_URLS":case"COMMAND_PAGE_COPY_ALL_URLS":{const i=void 0===t?n===he.ZP.getActiveWindowId()&&void 0===Ce.ZP.getActiveWorkspace(n):t===Ce.ZP.getActiveWorkspace(n),o={...l(n,{...e,action:"COMMAND_PAGE_COPY_ALL_URLS"},t)};return{...o,handler:()=>{c.ZP.copyAllUrls(n,t),s()},shortcuts:i?o.shortcuts:[]}}default:return{...l(n,e,t)}}}))}),[i,u,s,n,G]),z=Li.useCallback(((e,t)=>{e.persist(),e.preventDefault(),e.stopPropagation(),K(e,t).then((t=>{(0,cs.Z)(o,t)(e)}))}),[o,K]),j=e=>{const t=e.currentTarget,n=t.parentElement?.parentElement?.querySelectorAll(".this-window,.workspace-item-wrapper:not([disabled])");if(n?.length)switch(e.key){case"ArrowUp":let e=Array.from(n).indexOf(t)-1;e<0&&(e=n.length-1),n[e].focus();break;case"ArrowDown":let i=Array.from(n).indexOf(t)+1;i>=n.length&&(i=0),n[i].focus();break;default:return}},Y=Li.useCallback(((t,n)=>{if(t.button!==es.Z.kLeft)return;(0,ms.ZP)(t);const i=T.current?.getBoundingClientRect().top??0,s=E.get(n)?.current?.getBoundingClientRect().top??0;if(s-30+266>o.window.innerHeight-133){A(-(i-s+30+266))}else{A(s-i+30)}const a=e.workspaces.find((e=>e.id===n));a?.emoji?S(a.emoji):a?.icon&&(y(a.icon),S(void 0)),h(n)}),[o.window.innerHeight,E,e.workspaces]),X=()=>{h(void 0)},Q=(e,t)=>{if(t){const n=Li.createRef();n.current=t,E.set(e,n)}else E.delete(e)},q=Li.useCallback((()=>{N&&D&&(R(!1),m(void 0),CQ.Z.addWorkspace(N,D,O,r.current),s())}),[s,O,D,N]),J=Li.useCallback((()=>{const e=g;m(void 0),N&&e&&CQ.Z.setName(e,N)}),[g,N]),ee=Li.useCallback((e=>{P(e.currentTarget.value)}),[]),te=Li.useCallback((()=>{g?J():q()}),[q,J,g]),ne=Li.useCallback((()=>{R(!1),m(void 0)}),[]),ie=Li.useCallback((e=>{const t=G.current??[],n=t.find((t=>t.id===e));if(n)return{item:n,index:t.indexOf(n)}}),[G]),se=Li.useRef(null),oe=Li.useCallback(((e,t)=>{const n=()=>{a(),se.current=null},i=ie(e)?.index,s=G.current;if(s&&"number"==typeof i){const i=s.find((t=>t.id===e)),a=s.find((e=>e.id===t)),r=s.indexOf(i),l=s.indexOf(a);G.current=(0,v.Uy)(s,(e=>{const[t]=e.splice(r,1);e.splice(l,0,t)})),se.current||(se.current=o.requestAnimationFrame(n))}}),[o,ie,a]),ae=Li.useCallback((()=>{const e=G.current?.map((e=>e.id))??[];CQ.Z.setOrder(e)}),[]),re=Li.useMemo((()=>({position:"relative",minHeight:44*W+8})),[W]),[le,ce]=k.get(void 0)??[0,0];return(0,ss.jsxs)("div",{ref:T,className:"WorkspacePopup",onDoubleClick:ms.ZP,children:[(0,ss.jsxs)("div",{ref:d,className:"WorkspacePopup-Items",children:[W>0&&(0,ss.jsxs)(ss.Fragment,{children:[(0,ss.jsxs)("button",{ref:t,className:"this-window",onPointerUp:e=>e.button===es.Z.kLeft&&$(void 0),onClick:e=>{e.preventDefault(),$(void 0)},onContextMenu:z,onKeyDown:j,children:[Sae,mae("div",{className:"title"},void 0,mae("p",{},void 0,vae(n)),mae("p",{className:"tab-count",title:ce>0?(0,B.Z)("$1 hibernated tab","$1 hibernated tabs",[ce]):""},void 0,(0,B.Z)("$1 tab","$1 tabs",[le]))),F&&mae("div",{className:Fi()("audio-container",{"workspace-inactive":void 0!==Ce.ZP.getActiveWorkspace(n)}),onClick:e=>yae(e,n,void 0,F)},void 0,mae(joe.Z,{animated:C.Z.get(I.kThemeUseAnimation),mediaState:(0,ze.l4)([F]),src:"tab"})),void 0===Ce.ZP.getActiveWorkspace(n)&&wae]}),Cae]}),!L&&0===W&&mae("div",{className:"no-workspaces-note"},void 0,mae("h1",{},void 0,(0,B.Z)("Get organized with Workspaces")),mae("p",{className:"faded-text"},void 0,(0,B.Z)("Organize tabs by separating your social, work, and hobbies into Workspaces."))),(0,ss.jsx)("div",{ref:l,className:"WorkspacePopup-DragArea",style:re,children:G.current?.map((({name:e,icon:t,emoji:s,id:o},a)=>{const r=u.has(o),l=r&&o!==i,d=g===o,c=_.get(o);return mae(VQ,{style:{posY:KQ(44*a,fae)}},o,(({posY:i})=>{const[a,u]=k.get(o)??[0,0];return(0,ss.jsx)(cae,{ref:e=>Q(o,e),id:o,windowId:n,name:e,icon:t,emoji:s,audioStatus:c,isActive:r,isActiveInAnotherWindow:l,isPickingIcon:!!p,isRenaming:d,tabCount:a,hibernatedCount:u,workspaceCount:W,onSelect:$,onContextMenu:z,onShowIconModal:Y,onToggleMuteWorkspaceTabs:yae,findItem:ie,moveItem:oe,onDrop:ae,style:{transform:`translate3d(0, ${i}px, 0)`},onKeyDown:j,nameInput:d?(0,ss.jsx)(pae,{ref:Z,name:"",workspaceName:N,submitOnBlur:!0,onNameChange:ee,onSubmitEdit:te,onCancelEdit:ne}):null})}))}))}),mae(eae,{itemHeight:44,refDragArea:l,refScrollArea:d,workspaceCount:W}),L&&(0,ss.jsxs)(ss.Fragment,{children:[0===W&&mae("label",{htmlFor:"workspace-title",className:"first-workspace-info"},void 0,(0,B.Z)("Workspace Name")),mae("button",{className:"workspace-item-wrapper",title:(0,B.Z)("title","New Workspace")},"NEW_WORKSPACE",(0,ss.jsx)("div",{className:"avatar picker",ref:e=>Q(1,e),onClick:e=>Y(e,1),dangerouslySetInnerHTML:{__html:O??D}}),mae("div",{className:"title"},void 0,(0,ss.jsx)(pae,{name:"workspace-title",ref:Z,workspaceName:N,submitOnBlur:!L,onNameChange:ee,onSubmitEdit:te,onCancelEdit:ne})))]})]}),mae("div",{className:"actions"},void 0,L&&(0,ss.jsxs)(ss.Fragment,{children:[mae("input",{type:"button",className:"primary",value:(0,B.Z)("Create"),disabled:!N,onClick:q}),mae("input",{type:"button",value:(0,B.Z)("Cancel"),onClick:ne})]}),!L&&mae(nae,{windowId:n,activeWorkspaceId:i,toolbarSize:"small",onClick:e=>{r.current=e;const t=bae(),n=AQ();P(n),M(t),x(void 0),R(!0),gae.nextTick((()=>{Z.current?.focus()}))}})),p&&mae(SQ,{closeModal:X,onPick:e=>{p?(1!==p?"number"==typeof e?CQ.Z.setIcon(p,e):CQ.Z.setEmoji(p,e):L&&("number"==typeof e?(M(GF.S[e]),x(void 0)):x(e)),X()):X()},top:w,left:50,activeIcon:f,activeEmoji:b})]})})),Iae=QQ(Aae);var Tae;function Zae(e,t,n,i){Tae||(Tae="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Tae,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Eae=[I.kWorkspacesEnabled];class kae extends Li.PureComponent{static contextType=ts.Z;refPopup=Li.createRef();constructor(e,t){super(e),this.windowId=t.vivaldiWindowId;const n=GF.Z.getState(),i=Ce.ZP.getActiveWorkspace(this.windowId);this.state={activeWorkspaceId:i,popupVisible:!1,workspaces:n,showName:this.getShowName(),pageIdPlayingAudio:void 0},this.props.inEditor||(GF.Z.addListener(this._onWorkspaceStoreChanged),Ce.ZP.addListener(this._onPageStoreChanged),C.Z.addListener(I.kWorkspacesButtonShowName,this._onPrefsChange),Oa.Z.addListener("COMMAND_SHOW_WORKSPACE_MENU",this._onCommandSpy))}componentWillUnmount(){this.props.inEditor||(GF.Z.removeListener(this._onWorkspaceStoreChanged),Ce.ZP.removeListener(this._onPageStoreChanged),C.Z.removeListener(I.kWorkspacesButtonShowName,this._onPrefsChange),Oa.Z.removeListener("COMMAND_SHOW_WORKSPACE_MENU",this._onCommandSpy))}componentDidUpdate(e,t){!t.popupVisible&&this.state.popupVisible&&this.focusPopup()}_onCommandSpy=e=>{this.props.inTabbar&&e===this.context.vivaldiWindowId&&this.togglePopup()};_onPageStoreChanged=()=>{const e=Ce.ZP.getActiveWorkspace(this.windowId),t=he.ZP.isIncognitoOrGuest(this.windowId),n=(()=>{if(void 0!==this.state.pageIdPlayingAudio){const t=Ce.ZP.getPageById(this.state.pageIdPlayingAudio);if(t&&t.audible&&!t.vivExtData.vivaldi_tab_muted&&e!==(0,kv.cm)(t))return this.state.pageIdPlayingAudio}for(const[n,i]of Ce.ZP.getState()){if(t!==he.ZP.isIncognitoOrGuest(n))continue;const s=i.list.groupBy(kv.cm).find(((t,i)=>{if(i!==e&&(void 0!==i||n===this.windowId))return t.find((e=>e.audible&&!e.vivExtData.vivaldi_tab_muted))}))?.first();if(s)return s.id}})();this.setState({activeWorkspaceId:e,pageIdPlayingAudio:n})};_onWorkspaceStoreChanged=()=>{this.setState({workspaces:GF.Z.getState()})};_onPrefsChange=()=>{this.setState({showName:this.getShowName()})};getShowName=()=>{if(this.props.inTabbar){const e=C.Z.get(I.kTabsBarPosition);return Boolean(C.Z.get(I.kWorkspacesButtonShowName)||"left"===e||"right"===e)}return C.Z.get(I.kWorkspacesButtonShowName)};getIcon=e=>e?.emoji??e?.icon??Wi.M8b.medium;togglePopup=()=>{this.setState((e=>({popupVisible:!e.popupVisible})))};hidePopup=()=>this.setState({popupVisible:!1});focusPopup=()=>{this.refPopup.current?.focus()};handleWheel=(0,aC.Z)((e=>{if(e.deltaY&&C.Z.get(I.kWorkspacesButtonMouseWheelEnabled)){const t=this.context.vivaldiWindowId;e.deltaY>0?CQ.Z.activateNextByOrder(t):CQ.Z.activatePreviousByOrder(t)}}),500);getContextMenu=()=>[{handler:()=>w.Z.set(I.kWorkspacesButtonShowName,!C.Z.get(I.kWorkspacesButtonShowName)),type:"checkbox",checked:C.Z.get(I.kWorkspacesButtonShowName),isEnabled:()=>{if(this.props.inTabbar){const e=C.Z.get(I.kTabsBarPosition);return"top"===e||"bottom"===e}return!0},...(0,us.Z)("Display Workspace Name")},{handler:()=>w.Z.set(I.kWorkspacesButtonShowInTabbar,!C.Z.get(I.kWorkspacesButtonShowInTabbar)),type:"checkbox",checked:C.Z.get(I.kWorkspacesButtonShowInTabbar),...(0,us.Z)("Show Workspaces in Tab Bar")}];render(){if(!this.props.prefValues[I.kWorkspacesEnabled]&&!this.props.inEditor&&!this.props.preview)return null;const{showName:e,pageIdPlayingAudio:t,workspaces:n,activeWorkspaceId:i}=this.state,s=this.state.workspaces.find((e=>e.id===i));let o="";this.props.inEditor?o=(0,B.Z)("Workspaces"):e&&(o=s?.name??(0,B.Z)("Workspaces"));const a=o||(0,B.Z)("Workspaces"),r=Math.min(a.length,16);return Zae(po.ZP,{image:this.props.inEditor?Wi.BmN:this.getIcon(s),imageOverride:this.props.inEditor||!i?"WorkspaceButton":"none",label:(0,B.Z)("Workspaces"),tooltip:a,onClick:this.togglePopup,onPointerDown:this.togglePopup,customizeMenu:this.props.customizeMenu,menuOrigin:this.props.menuOrigin,popupPosition:this.props.popupPosition,className:Fi()("workspace-popup workspace-anchor",{"tabbar-workspace-button":this.props.inTabbar,label:C.Z.get(I.kWorkspacesButtonShowName)&&i}),popupClassName:"ToolbarButtonPopup-DefaultStyles",popupLabel:(0,B.Z)("dialog title","Workspaces"),popupWidth:250,hidePopup:this.hidePopup,isPopupVisible:this.state.popupVisible,size:this.props.size,draggable:this.props.draggable||!1,onDragStart:this.props.onDragStart??Lr.Z,onDragEnd:this.props.onDragEnd??Lr.Z,onDrop:this.props.onDrop??Lr.Z,onDragEnter:this.props.onDragEnter??Lr.Z,onDragLeave:this.props.onDragLeave??Lr.Z,onDragOver:this.props.onDragOver??Lr.Z,onWheel:this.handleWheel,mimeType:this.props.mimeType,name:this.props.name,title:this.props.maxWidth&&this.props.maxWidth<80?void 0:o,isMenuIndicatorVisible:!this.props.maxWidth||this.props.maxWidth>=60,isMenuIndicatorDisabled:!0,menu:this.getContextMenu,style:this.props.maxWidth?{width:this.props.maxWidth}:{"--titleChars":r+"ex"},mediaState:void 0!==t,mediaStateType:"workspace",onFocus:this.focusPopup,commandId:"COMMAND_SHOW_WORKSPACE_MENU"},void 0,(0,ss.jsx)(Iae,{ref:this.refPopup,windowId:this.context.vivaldiWindowId,activeWorkspaceId:i,workspaces:n,hidePopup:this.hidePopup}))}}const _ae=(0,Bu.Z)((0,dp.ZP)(kae),Eae);class Nae extends Li.Component{render(){const{index:e,name:t,preview:n,label:i="",customizeMenu:s=(()=>[]),popupPosition:o="below",menuOrigin:a="bottomLeft",mimeType:r,onDragStart:l,onDragEnd:d,onDrop:c,onDragEnter:u,draggable:p,inEditor:h=!1,forceIcon:g=!1}=this.props,m={name:t,label:i,customizeMenu:s,size:"large",popupPosition:o,menuOrigin:a,draggable:p,onDragStart:l,onDragEnd:d,onDrop:c,onDragEnter:u,mimeType:r,preview:n};if(t.startsWith("COMMAND_"))return(0,ss.jsx)(Koe,{...m,commandButton:!0,index:e,inEditor:h});if(Ju.ZP.isWebPanel(t))return(0,Li.createElement)(VS,{...m,key:t,inEditor:h,isMailWindow:this.props.isMailWindow});switch(t){case"Back":case"Forward":case"Rewind":case"FastForward":case"Reload":case"Stop":case"Home":return(0,ss.jsx)(Nv,{...m,inEditor:h});case"BreakMode":return(0,ss.jsx)(Bp,{...m,inEditor:h});case"Clock":return(0,ss.jsx)(vg,{...m,inEditor:h});case"AccountButton":return(0,ss.jsx)(mp,{...m});case"ReadingList":return(0,ss.jsx)(nw,{...m,inEditor:h});case"Extensions":return(0,ss.jsx)(Jm.C,{...m,inEditor:h});case"UpdateButton":return(0,ss.jsx)(Boe,{...m,inEditor:h});case"MailStatus":return(0,ss.jsx)(Vf,{...m,inEditor:h,isMailWindow:this.props.isMailWindow});case"CalendarStatus":return(0,ss.jsx)(Vh,{...m,inEditor:h,isMailWindow:this.props.isMailWindow});case"DownloadButton":return(0,ss.jsx)(Qm,{...m,inEditor:h});case"WorkspaceButton":return(0,ss.jsx)(_ae,{...m,inEditor:h});case"AddressField":case"SearchField":case"PanelToggle":case"SyncStatus":case"StatusInfo":case"VersionInfo":case"CaptureImages":case"TilingToggle":case"ImagesToggle":case"PageActions":case"Zoom":case"Settings":case"Proxy":return(0,ss.jsx)(koe,{...m,inEditor:h,forceIcon:g});case"MailBack":case"MailForward":case"MailReload":case"MailRenderingMethod":case"MailRenderingMethodText":case"MailViewLayout":case"MailViewThreading":case"MailViewThreadingFlat":case"MailViewQuickResponse":return(0,ss.jsx)(wf,{...m,disabled:!1});case"MailSearch":return(0,ss.jsx)(ff,{...m,inEditor:h});case"MailMsgEdit":case"MailMsgReply":case"MailMsgReplyToAll":case"MailMsgForward":case"MailMsgStatusRead":case"MailMsgStatusUnread":case"MailMsgFlag":case"MailMsgLabel":case"MailMsgSend":case"MailMsgShowHeaders":case"MailMsgSpam":case"MailMsgSpamRestore":case"MailMsgDiscard":case"MailMsgAttach":case"MailMsgTrash":case"MailMsgTrashRestore":case"MailMsgMove":case"MailMsgArchive":case"MailMsgArchiveRestore":case"MailCompose":case"MailUndo":return(0,ss.jsx)(Cv,{...m,inEditor:h});case"PanelBookmarks":case"PanelReadingList":case"PanelDownloads":case"PanelHistory":case"PanelNotes":case"PanelWindow":case"PanelTranslate":case"PanelMail":case"PanelCalendar":case"PanelTasks":case"PanelFeeds":case"PanelContacts":case"PanelChat":case"PanelSession":case"PanelWeb":return(0,Li.createElement)(VS,{...m,key:t,inEditor:h,isMailWindow:this.props.isMailWindow});case"Game":return(0,ss.jsx)(sf,{...m,isStartPage:!1});case"Spacer":case"FlexibleSpacer":case"PanelWidthSpacer":case"Divider":return(0,ss.jsx)(Koe,{...m,index:e,inEditor:h});default:return console.warn(`ToolbarButton “${t}” not found`),null}}}class Pae extends Li.PureComponent{static contextType=ts.Z;lastKeyWasAltDown=!1;componentDidMount(){const{selectWindow:e}=this.context;se.Z.tabsPrivate.onMouseChanged.addListener(this._onMouseChanged),se.Z.tabsPrivate.onKeyboardChanged.addListener(this._keyEventListener),se.Z.windowPrivate.onPositionChanged.addListener(this._onWindowPositionChanged),Oa.Z.addListener("COMMAND_FOCUS_MAINMENU",this._onCommandSpy),he.ZP.addListener(this._onWindowStoreChanged,e)}componentWillUnmount(){se.Z.tabsPrivate.onMouseChanged.removeListener(this._onMouseChanged),se.Z.tabsPrivate.onKeyboardChanged.removeListener(this._keyEventListener),se.Z.windowPrivate.onPositionChanged.removeListener(this._onWindowPositionChanged),Oa.Z.removeListener("COMMAND_FOCUS_MAINMENU",this._onCommandSpy),he.ZP.removeListener(this._onWindowStoreChanged)}_onCommandSpy=e=>{e===this.context.vivaldiWindowId&&he.ZP.isActive(this.context.vivaldiWindowId)&&this.props.changeFocus()};_onWindowStoreChanged=()=>{!he.ZP.isActive(this.context.vivaldiWindowId)&&this.props.showAccessKeys&&this.props.showAccessKeys(!1)};_onMouseChanged=e=>{!1===e&&(this.lastKeyWasAltDown=!1)};_onWindowPositionChanged=()=>{this.lastKeyWasAltDown=!1};_keyEventListener=(e,t,n,i,s,o)=>{if(i===xa.Z.KEY_ALT&&!o&&this.context.vivaldiWindowId===e&&he.ZP.isActive(e)){const e=t?4===n:0===n;e&&this.props.showAccessKeys&&this.props.showAccessKeys(t),!t&&!s&&this.lastKeyWasAltDown&&C.Z.get(I.kKeyboardShortcutsAltOpensMenu)&&this.props.changeFocus(),this.lastKeyWasAltDown=e&&t}else this.lastKeyWasAltDown=!1};render(){return null}}const Dae=Pae;let Mae=0,Oae=0,xae=0,Lae=!1;const Rae=new Map;let Bae=!1;const Fae=function(e,t,n,i,s,o){const a=t.filter((t=>!t.isVisible||t.isVisible(e,!1))).map((t=>{const a={item:void 0,separator:void 0,container:void 0,children:void 0};if(t.isList){if(xae<n)return Lae=!0,a;if(xae<Oae)return Lae=!0,a}else xae<Oae&&(Lae=!0);const r=t.isList?xae--:Oae++,l=Qe.Z.getDisplayName(t);if(t.handler&&(l||t.url)&&Rae.set(r,t.handler),t.container?.details)a.container=t.container.details;else if(Qe.Z.isSeparator(t))a.separator={};else{const d=void 0!==t.id&&""!==i&&t.id===i;let c;switch((t.iconPNG||t.iconPNGWhite)&&(c=[t.iconPNG||"",t.iconPNGWhite||""]),"folder"===t.type||t.commandName||console.warn("Menu element. Not a folder nor a command",l),t.type){case"checkbox":case"radio":a.item={id:r,name:l,type:t.type,radiogroup:t.radiogroup?t.radiogroup:-1,checked:t.checked,enabled:!t.isEnabled||t.isEnabled(e),shortcut:Qe.Z.getShortcut(t,s).value,url:t.url,icons:c};break;default:a.item={id:r,name:l,type:t.items?"folder":"command",selected:d,persistent:t.persistent,enabled:!t.isEnabled||t.isEnabled(e),shortcut:Qe.Z.getShortcut(t,s).value,url:t.url,icons:c},t.items&&(a.children=Fae(e,t.items,n,i,s,o))}}return a}));return o?a.filter((e=>e.item||e.separator||e.container)):a},Wae={show:function(e,t,n,i,s){const o=e.vivaldiWindowId,a=Qe.Z.getShortcutSettings();let r;const l=function(e){s&&s(e)},d=function(){p(),s&&s(-1)},c=function(t){const n=Rae.get(t.id);if(n){const i={origin:"menu",context:e,windowId:o,keyState:{shiftKey:t.state.shift,ctrlKey:t.state.ctrl,altKey:t.state.alt,metaKey:t.state.command,key:""}};t.state.left?i.button=0:t.state.right?i.button=2:t.state.center&&(i.button=1),n(i)}},u=function(e){console.warn(e)},p=function(){ga.Z.onHover(o,""),se.Z.menubarMenu.onAction.removeListener(c),se.Z.menubarMenu.onOpenBookmark.removeListener(ga.Z.onOpen),se.Z.menubarMenu.onBookmarkAction.removeListener(ga.Z.onAction),se.Z.menubarMenu.onHover.removeListener(ga.Z.onHover),se.Z.menubarMenu.onOpen.removeListener(l),se.Z.menubarMenu.onClose.removeListener(d),se.Z.menubarMenu.onError.removeListener(u),clearInterval(r),setTimeout((()=>{Bae=!1}),1)},h=function(e){n.forEach((e=>{Qe.Z.installMnemonics(e.menu.items,e.menu.preferred)})),Oae=0,xae=e,Rae.clear(),Lae=!1;let i=n.map((e=>({id:e.id,rect:e.rect,children:Fae(o,e.menu.items,0,e.menu.expandId,a,!1)})));if(Lae){console.warn("Menu truncated. Too many items");const t=Oae;Oae=0,xae=e,Rae.clear(),i=n.map((e=>({id:e.id,rect:e.rect,children:Fae(o,e.menu.items,t,e.menu.expandId,a,!0)})))}(function(e){return se.Z.zoom.getVivaldiUIZoom().then((t=>{e.forEach((e=>{e.rect.x=parseInt((e.rect.x+1)*t),e.rect.y=parseInt((e.rect.y+0)*t),e.rect.width=parseInt(e.rect.width*t),e.rect.height=parseInt(e.rect.height*t)}))}))})(i).then((()=>{se.Z.menubarMenu.onAction.addListener(c),se.Z.menubarMenu.onOpenBookmark.addListener(ga.Z.onOpen),se.Z.menubarMenu.onBookmarkAction.addListener(ga.Z.onAction),se.Z.menubarMenu.onHover.addListener(ga.Z.onHover),se.Z.menubarMenu.onOpen.addListener(l),se.Z.menubarMenu.onClose.addListener(d),se.Z.menubarMenu.onError.addListener(u),r=setInterval((()=>{se.Z.utilities.emulateUserInput(o)}),2e3),se.Z.menubarMenu.show({windowId:o,id:t,siblings:i,icons:[qe.Z,va.Z,ya.Z,ba.Z,Sa.Z,ma.Z,fa.Z]},(()=>{}))}))};Bae||(Bae=!0,0===Mae?se.Z.menubarMenu.getMaxId((e=>{Mae=e,h(Mae)})):h(Mae))}};var Uae;function Vae(e,t,n,i){Uae||(Uae="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Uae,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Hae=[I.kKeyboardShortcutsAltOpensMenu,I.kMenuIconType],Gae="vivaldi";class $ae extends Li.Component{static contextType=ts.Z;refButton=Li.createRef();shortcuts=[];hasMenu=!1;state={keyShortcut:""};componentDidMount(){C.Z.addListener(I.kKeyboardShortcutsAltOpensMenu,this._onPrefsChange),Ge.Z.addListener(this._onCommandStoreChange),this.hasMenu=Ge.Z.isNamedMenuAvailable(Gae),this.hasMenu?this._setupShortcuts(!0):this._requestMenu(),this._setButtonKeyshortcut()}componentWillUnmount(){C.Z.removeListener(I.kKeyboardShortcutsAltOpensMenu,this._onPrefsChange),Ge.Z.removeListener(this._onCommandStoreChange),this.shortcuts.forEach((e=>{e.shortcut&&Ke.Z.unbind(e.shortcut,this._showSubMenu)}))}_setButtonKeyshortcut(){this.setState({keyShortcut:Ge.Z.getShortcut("COMMAND_FOCUS_MAINMENU",!1)})}_onPrefsChange=()=>{this._setupShortcuts(!1)};_onCommandStoreChange=e=>{switch(e){case"init":this._requestMenu(),this._setButtonKeyshortcut();break;case"menu":this.hasMenu=!0,this._setupShortcuts(!1);break;case"shortcut":this._setupShortcuts(!1),this._setButtonKeyshortcut()}};_changeFocus=()=>{this._showMenu(-1)};_requestMenu(){this.hasMenu||ne.Z.requestNamedMenu(Gae)}_getMenuItems=e=>Ge.Z.getNamedMenu(this.context.vivaldiWindowId,Gae,e);_setupShortcuts=e=>{this.shortcuts.forEach((e=>{e.shortcut&&Ke.Z.unbind(e.shortcut,this._showSubMenu)})),this.shortcuts=[],this.props.prefValues[I.kKeyboardShortcutsAltOpensMenu]?(this.shortcuts=Qe.Z.getShortcutsForSubMenus(this._getMenuItems(!1)),this.shortcuts.forEach((e=>{e.shortcut&&Ke.Z.bind(e.shortcut,this._showSubMenu)}))):e&&this._getMenuItems(!1)};_showMenu=e=>{const t=this.refButton.current?.getBoundingClientRect();if(!t)return;const n=this._getMenuItems(!0),i=e<0?"":n[e].id||"",s={id:0,rect:{x:parseInt(t.left),y:parseInt(t.top),width:parseInt(t.width),height:parseInt(t.height)},menu:{items:n,expandId:i,preferred:this.shortcuts}};Wae.show(this.context,s.id,[s],"bottom")};_showSubMenu=e=>{this.shortcuts.forEach((t=>{t.shortcut&&t.key===e.keyState.key&&this._showMenu(t.index)}))};_handleDoubleClick=e=>{e.preventDefault(),e.stopPropagation()};_handleKeyDown=e=>{switch(e.key){case"ArrowDown":case"Enter":this._showMenu(-1);break;case"Escape":ne.Z.executeActions("shortcut",this.context,"COMMAND_FOCUS_WEBVIEW");break;default:return}(0,ms.ZP)(e)};render(){const{keyShortcut:e}=this.state,{inert:t}=this.props,n=(0,B.Z)("Menu"),i=e?(0,B.Z)("$1 ($2)",[n,e]):n;return Vae(Li.Fragment,{},void 0,Vae(Dae,{changeFocus:this._changeFocus}),(0,ss.jsxs)("button",{ref:this.refButton,className:"vivaldi",style:{boxShadow:"none",display:this.props.isHidden?"none":void 0},onMouseDown:()=>this._showMenu(-1),onKeyDown:this._handleKeyDown,onDoubleClick:this._handleDoubleClick,tabIndex:this.props.keyAccess,inert:t?"inert":null,title:i,"aria-label":n,"aria-keyshortcuts":e,children:["icon"===this.props.prefValues[I.kMenuIconType]&&(0,ss.jsxs)(ss.Fragment,{children:[Vae("span",{className:"vivaldi-v",dangerouslySetInnerHTML:{__html:Wi.Qa2}}),Vae("span",{className:"expand-arrow",dangerouslySetInnerHTML:{__html:Wi.uIM}})]}),"burger"===this.props.prefValues[I.kMenuIconType]&&Vae("span",{className:"burger-icon",dangerouslySetInnerHTML:{__html:Wi.nl2}})]}))}}const Kae=(0,Bu.Z)($ae,Hae);var zae,jae=n(34155);function Yae(e,t,n,i){zae||(zae="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:zae,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Xae="vivaldi/x-toolbar-name",Qae="vivaldi/x-button-index";let qae=!1;var Jae,ere=Yae(qu,{onMainBar:!0});class tre extends Li.PureComponent{static contextType=ts.Z;refToolbar=Li.createRef();_dropOnSelf=!1;_dragIndex=null;constructor(e,t){super(e),this.state={modifier:!1,editMode:""!==ft.Z.getState(),isMailWindow:he.ZP.isMail(t.vivaldiWindowId),buttons:e.showDefaultSet?(0,Qf.Gt)(t.vivaldiWindowId,!0,C.Z.getDefault(e.name)):(0,Qf.Gt)(t.vivaldiWindowId,!1,C.Z.get(e.name)),dragging:!1}}componentDidMount(){this.props.showDefaultSet||(Ge.Z.addListener(this.onCommandStoreChanged),C.Z.addListener(this.props.name,this.onPrefsChanged),ft.Z.addListener(this.editModeListener),he.ZP.addListener(this.onWindowStoreChanged),se.Z.tabsPrivate.onKeyboardChanged.addListener(this.modifierKeyListener))}componentWillUnmount(){this.props.showDefaultSet||(Ge.Z.removeListener(this.onCommandStoreChanged),C.Z.removeListener(this.props.name,this.onPrefsChanged),ft.Z.removeListener(this.editModeListener),he.ZP.removeListener(this.onWindowStoreChanged),se.Z.tabsPrivate.onKeyboardChanged.removeListener(this.modifierKeyListener))}onCommandStoreChanged=e=>{"shortcut"===e&&jae.nextTick((()=>{const e=C.Z.get(this.props.name);if(e.some((e=>e.startsWith("COMMAND_")))){const t=C.Z.get(I.kChainedCommandsCommandList).map((e=>e.name)),n=e.reduce(((e,n)=>(n.startsWith("COMMAND_")&&!t.includes(n)||e.push(n),e)),[]);e.length!==n.length&&w.Z.set(this.props.name,n)}}))};onWindowStoreChanged=()=>{this.state.modifier&&this.setState({modifier:!1});const e=he.ZP.isMail(this.context.vivaldiWindowId);e!==this.state.isMailWindow&&this.setState({isMailWindow:e,buttons:(0,Qf.Gt)(this.context.vivaldiWindowId,!1,C.Z.get(this.props.name))})};modifierKeyListener=(e,t,n,i)=>{this.context.vivaldiWindowId!==e||he.ZP.isGuest()||i===xa.Z.KEY_CONTROL&&this.setState({modifier:t})};editModeListener=()=>{this.setState({editMode:""!==ft.Z.getState()})};onPrefsChanged=(e,t)=>{this.setState({buttons:(0,Qf.Gt)(this.context.vivaldiWindowId,Boolean(this.props.showDefaultSet),t)})};editToolbar=e=>tp.Z.edit(e);reset=()=>{const e=this.props.name;de.Z.showResetToolbarConfirmation(this.context.vivaldiWindowId,(t=>{t&&((0,Qf.Np)(this.context.vivaldiWindowId,e),w.Z.reset(e))}),(0,B.Z)("Reset $1 to Default?",[(0,Qf.qS)(e)]),(0,B.Z)("Toolbar will be restored to its default layout."))};removeButton=e=>{const t=this.props.name,n=this.state.buttons,i=n[e];jn.Z.setRemovedButton(this.context.vivaldiWindowId,t,i),w.Z.set(t,n.filter(((t,n)=>e!==n))),Ju.ZP.isWebPanel(i)&&vr.Z.removeById(i,t)};onDragOver=e=>e.preventDefault();onDrop=(e,t,n)=>{this.setState({dragging:!1,modifier:!1});const i=e.dataTransfer.getData(po.f2);if(!i)return;e.stopPropagation(),qae=!0;let s=this.state.buttons.slice();const o=("vertical"===this.props.layout?"bottom"===n:"right"===t)?1:0,a=e.currentTarget.classList.contains("toolbar-droptarget")?s.length:(this._dragIndex||0)+o;if(this._dropOnSelf=this.props.name===e.dataTransfer.getData(Xae),this._dropOnSelf){s[parseInt(e.dataTransfer.getData(Qae))]=null,s.splice(a,0,i),this.props.name&&w.Z.set(this.props.name,s.filter(Boolean))}else{s.splice(a,0,i),Qf.aX.includes(i)||(s=s.filter(((e,t)=>e!==i||t===a)));const e=this.props.name;vr.Z.isExtPanel(i)&&vr.Z.installExtensionById(this.context.vivaldiWindowId,i),w.Z.set(e,s.filter(Boolean)),jn.Z.setAddedButton(this.context.vivaldiWindowId,e,i,!1)}};getButtonIndex=e=>{let t=-1;const n=e.target?.getAttribute("name");return Qf.aX.includes(n)?t=Array.from(this.refToolbar.current?.children??[]).filter((e=>e.className&&!e.className.includes("window-buttongroup")&&!e.className.includes("biscuit-setting-version"))).findIndex((t=>t.children[0]===e.target)):n&&(t=this.state.buttons.findIndex((e=>e===n))),t};getButtonMenu=e=>he.ZP.isGuest()?[]:[Qe.Z.separatorItem,{handler:()=>{const t=this.state.buttons.findIndex((t=>t===e));t>-1&&this.removeButton(t)},...(0,us.Z)("Remove from Toolbar")},Qe.Z.separatorItem,{handler:()=>this.editToolbar(this.props.name||I.kToolbarsNavigation),...(0,us.Z)("Customize Toolbar"),ellipsis:!0},{handler:this.reset,...(0,us.Z)("Reset Toolbar to Default")}];getToolbarMenu=async e=>{if(e.target.classList?.contains("toolbar")){let t=[];if(this.props.menu){const e=this.props.menu();t=Array.isArray(e)?e:await e}(0,cs.Z)(this.context,t.concat([Qe.Z.separatorItem,{handler:()=>this.editToolbar(this.props.name||I.kToolbarsNavigation),...(0,us.Z)("Customize Toolbar"),ellipsis:!0},{handler:this.reset,...(0,us.Z)("Reset Toolbar to Default")}]))(e)}};handleDragStart=e=>{const t=this.getButtonIndex(e);t<0||(qae=!1,this._dropOnSelf=!1,e.dataTransfer.setData(Qae,t),e.dataTransfer.setData(Xae,this.props.name),this.setState({dragging:!0}))};handleDragEnd=e=>{const t=this.getButtonIndex(e);t<0||(!this._dropOnSelf&&qae&&this.removeButton(t),this._dropOnSelf=!1,this._dragIndex=null,this.setState({dragging:!1,modifier:!1}))};handleDragEnter=e=>{const t=this.getButtonIndex(e);t<0||(this._dragIndex=t)};render(){const e=this.props.name===I.kToolbarsNavigation||this.props.name===I.kToolbarsMail||this.props.name===I.kToolbarsMailComposer||this.props.name===I.kToolbarsMailMessage,t=!e&&this.props.name===I.kToolbarsPanel,i=e&&this.props.controlButtonsVisible,s=!1,o=this.props.menuDisplay;return(0,ss.jsxs)("div",{ref:this.refToolbar,role:t?"tablist toolbar":"toolbar","aria-label":this.props.label,"aria-orientation":this.props.layout||"horizontal",inert:this.props.inert&&!this.state.editMode?"inert":null,className:Fi()("toolbar","toolbar-droptarget",this.props.className,"toolbar-"+this.props.size,{dragging:this.state.dragging,"toolbar-vertical":"vertical"===this.props.layout}),onContextMenu:this.getToolbarMenu,onDragOver:this.onDragOver,onDrop:this.onDrop,children:[i&&ere,s,o&&Yae(Kae,{isHidden:!1,inert:this.props.inert||!1,keyAccess:this.props.keyAccess??0}),this.state.buttons.map(((e,t)=>Yae(Nae,{index:t,name:e,preview:this.props.showDefaultSet||this.state.editMode,menuOrigin:this.props.menuOrigin,customizeMenu:this.getButtonMenu,popupPosition:this.props.popupPosition,size:this.props.size,draggable:this.state.editMode||this.state.modifier,inEditor:this.props.showDefaultSet,onDragStart:this.handleDragStart,onDragEnd:this.handleDragEnd,onDrop:this.onDrop,onDragEnter:this.handleDragEnter,mimeType:po.f2,isMailWindow:this.state.isMailWindow},e+"__"+(Qf.aX.includes(e)?t:"")))),this.props.name===I.kToolbarsNavigation&&he.ZP.isIncognito(this.context.vivaldiWindowId)&&Yae("div",{className:"UrlBar-PrivateWindowIndicator",title:(0,B.Z)("Private Browsing Window"),dangerouslySetInnerHTML:{__html:n(2018)+(0,B.Z)("Private")}}),s]})}}function nre(e,t,n,i){Jae||(Jae="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Jae,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const ire=[I.kToolbarsMail,I.kToolbarsMailComposer,I.kToolbarsMailMessage],sre="toolbar-mainbar toolbar-mailbar";class ore extends Li.PureComponent{render(){const{className:e,menuDisplay:t,menuOrigin:n,popupPosition:i,url:s,inert:o}=this.props;return(0,ss.jsxs)(ss.Fragment,{children:[!(0,Zt.vE)(s)&&!(0,Zt.Ds)(s)&&nre(tre,{name:I.kToolbarsMail,label:(0,B.Z)("toolbar label","Mail"),className:`${sre} ${e}`,controlButtonsVisible:this.props.controlButtonsVisible,menuDisplay:t,menuOrigin:n,popupPosition:i,size:"large",inert:o}),(0,Zt.Ds)(s)&&nre(tre,{name:I.kToolbarsMailMessage,label:(0,B.Z)("toolbar label","Mail Message"),className:`${sre} ${e} message`,controlButtonsVisible:this.props.controlButtonsVisible,menuDisplay:t,menuOrigin:n,popupPosition:i,size:"large",inert:o}),(0,Zt.vE)(s)&&nre(tre,{name:I.kToolbarsMailComposer,label:(0,B.Z)("toolbar label","Compose Mail"),className:`${sre} ${e} composer`,controlButtonsVisible:this.props.controlButtonsVisible,menuDisplay:t,menuOrigin:n,popupPosition:i,size:"large",inert:o})]})}}const are=(0,Bu.Z)(ore,ire);var rre,lre=n(38768);function dre(e,t,n,i){rre||(rre="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:rre,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const cre=[I.kAddressBarPosition,I.kAddressBarVisible,I.kAppearanceDisableTitleBar,I.kKeyboardTabToAll,I.kMenuDisplay,I.kTabsBarPosition,I.kTabsVisible],ure="toolbar-hidden",pre="toolbar-visible";function hre(e){return{url:e.url,isMailPage:e.isMailPage&&!C.Z.get(I.kMailIsTurnedOff)}}class gre extends Li.PureComponent{static contextType=ts.Z;state={...hre(Ce.ZP.unsafeGetActivePage(this.context.vivaldiWindowId))};componentDidMount(){const{selectWindow:e}=this.context;Ce.ZP.addListener(this.pageStoreChanged,e)}componentWillUnmount(){Ce.ZP.removeListener(this.pageStoreChanged)}pageStoreChanged=()=>{const e=Ce.ZP.getActivePage(this.context.vivaldiWindowId);e&&this.setState(hre(e))};controlButtonsVisible=()=>{const e=(0,lre.H)(this.context.vivaldiWindowId);if(e&&this.props.fullScreenState||this.props.native)return!1;return!(this.props.windowState.visibleUI.tabs&&"top"===this.props.prefValues[I.kTabsBarPosition])&&!e};render(){const e="top"===this.props.prefValues[I.kAddressBarPosition],t=e?"bottomLeft":"topLeft",n=e?"below":"above",i="vivaldi"===this.props.prefValues[I.kMenuDisplay]&&!(0,lre.H)(this.context.vivaldiWindowId),s=this.props.prefValues[I.kKeyboardTabToAll],o=this.controlButtonsVisible(),a=!C.Z.get(I.kMailIsTurnedOff)&&he.ZP.isMail(this.context.vivaldiWindowId),{inert:r=!1}=this.props.windowState,{isMailPage:l}=this.state,d=r||!l,c=r||l;return dre("div",{className:"mainbar"},void 0,(a||l)&&dre(za.Z,{focusName:"focus_mailbar"},void 0,dre(are,{url:this.state.url,controlButtonsVisible:o,menuOrigin:t,popupPosition:n,className:l?pre:ure,menuDisplay:i,inert:d})),dre(za.Z,{focusName:"focus_addressbar"},void 0,dre(tre,{name:I.kToolbarsNavigation,label:(0,B.Z)("toolbar label","Address"),className:"toolbar-mainbar "+(l?ure:pre),controlButtonsVisible:o,menuOrigin:t,menuDisplay:i,keyAccess:s,popupPosition:n,size:"large",inert:c})))}}const mre=(0,Bu.Z)(gre,cre);var fre;function vre(e,t,n,i){fre||(fre="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:fre,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class yre extends Li.PureComponent{constructor(e){super(e),this.state={folderName:""}}addFeedFolder=()=>{let{path:e}=this.props.options;e=e.split("/").filter((e=>e!==It.ym)).join("/");const t={name:this.state.folderName,accountId:It.u4,path:e?e+"/"+this.state.folderName:this.state.folderName,filterValue:{include:[],...xt.ZP.getSearchListButtons(It.u4),showSubFolders:!0}};d.Z.addFilter(t),this.props.onClose()};onDismiss=()=>{this.props.onClose()};onChange=e=>{const{value:t}=e.target;this.setState({folderName:t})};render=()=>{const{path:e}=this.props.options;return vre("form",{className:"dialog-add-folder-name"},void 0,vre("header",{className:"dialog-header"},void 0,vre("h1",{id:ra.t},void 0,(0,B.Z)("feed","New Folder")),e!==It.ym&&vre("p",{},void 0,(0,B.Z)("Create a new folder under $1",[e]))),vre("div",{className:"dialog-content"},void 0,vre("input",{autoFocus:!0,type:"text",placeholder:(0,B.Z)("feed","New Folder"),onChange:this.onChange,title:(0,B.Z)("Folder Name"),value:this.state.folderName,name:"folderName"})),vre("footer",{className:"dialog-footer"},void 0,vre("input",{type:"submit",value:(0,B.Z)("Add Folder"),className:"primary",onClick:this.addFeedFolder,disabled:!this.state.folderName}),this.props.dismissable&&vre("input",{type:"button",onClick:this.onDismiss,value:(0,B.Z)("Cancel")})))}}const bre=yre;var Sre;function wre(e,t,n,i){Sre||(Sre="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Sre,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class Cre extends Li.PureComponent{constructor(e){super(e),this.state={folderName:""}}addMailFolder=()=>{const{accountId:e,path:t}=this.props.options;Yt.Z.createMailbox(e,t,this.state.folderName),this.props.onClose()};onDismiss=()=>{this.props.onClose()};onChange=e=>{const{value:t}=e.target;this.setState({folderName:t})};render=()=>{const{accountId:e,path:t}=this.props.options,n=vt.Z.getFolder(e,t),i=t&&t!==It.ym&&n?(0,B.Z)("Create Folder for $1 in $2",[e,n.name]):(0,B.Z)("Create Folder for $1",[e]);return wre("div",{className:"dialog-add-folder-name"},void 0,wre("header",{className:"dialog-header"},void 0,wre("h1",{id:ra.t},void 0,i)),wre("div",{className:"dialog-content"},void 0,wre("input",{type:"text",placeholder:(0,B.Z)("mail","New Folder"),onChange:this.onChange,title:(0,B.Z)("Folder Name"),value:this.state.folderName,name:"folderName"})),wre("footer",{className:"dialog-footer"},void 0,wre("input",{type:"button",value:(0,B.Z)("Create Folder"),className:"primary",onClick:this.addMailFolder,disabled:!this.state.folderName}),this.props.dismissable&&wre("input",{type:"button",onClick:this.onDismiss,value:(0,B.Z)("Cancel")})))}}const Are=Cre;var Ire,Tre;function Zre(e,t,n,i){Ire||(Ire="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Ire,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function Ere(e){const[t,n]=Li.useState(!1);return Li.useEffect((()=>()=>{w.Z.set(I.kCalendarOnboardingShown,!0)}),[]),Zre("div",{className:"CalendarAccountSheet"},void 0,Zre("button",{className:"CalendarAccountSheet-Exit",onClick:e.onClose},void 0,Zre("span",{dangerouslySetInnerHTML:{__html:Wi.kze}})),!t&&Zre("div",{className:"setting-section"},void 0,Zre(YD,{searchableStrings:mM,filter:"",showTips:()=>n(!0),done:e.onClose,onboarding:!0})),t&&Zre(rM,{onClose:e.onClose,windowId:e.windowId,onboarding:!0}))}function kre(e,t,n,i){Tre||(Tre="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Tre,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function _re(e){e&&e.target.addEventListener("click",ms.ZP,{once:!0})}const Nre=function(e){const t=Li.useContext(ts.Z),[n,i]=(0,Li.useState)(""),{document:s,requestAnimationFrame:o,HTMLElement:a}=t,{stateHandler:r,eventDraft:l}=r2(d2.W$,{draft:e.event}),d=Li.useRef(!1),{cancelEventEdit:c,endEventEdit:u,saveEventEdit:p}=r;if(Li.useEffect((()=>()=>{d.current||u()}),[u]),!l)return null;function h(){o((()=>{const e=s.getElementsByClassName("calendar-grid")[0];e instanceof a&&e.focus()}))}async function g(n){d.current=!0,_re(n);try{const n=await p();n&&(e.onClose().then(h),function(e,t){const n=Ce.ZP.getActivePage(e);if(n&&pn.jk.getDisplayUrlFromMapping(n?.url).startsWith("vivaldi://calendar"))return;let i="";const s=t.start||t.end;if(s){const e=W()(s);i=t.allDay?e.format("L"):W()().isSame(s,"day")?e.format("LT"):`${e.format("L")} ${e.format("LT")}`}(0,U.c)({title:`${i} ${t.title||eh.gT}`,body:t.task?(0,B.Z)("New Task Created"):(0,B.Z)("New Event Created"),onClick:()=>{de.Z.showCalendar(e,t.id)},timeout:3e4,tag:"CALENDAR_CREATE_EVENT"})}(t.vivaldiWindowId,n))}catch(e){nn.Z.warn("Calendar",["Event not created"],e),i(e)}}function m(t){d.current=!0,_re(t),c(),e.onClose().then(h)}return kre(yM.Provider,{value:{displayDensity:"full",pageId:d2.W$,isPanel:!1,isEditing:!0,isWidget:!1,handler:r}},void 0,kre("div",{className:"dialog-add-event",onKeyDown:function(e){const t=OM.Z[e.keyCode];"Enter"!==t||e.shiftKey?"Escape"===t&&m():(e.preventDefault(),e.stopPropagation(),g())}},void 0,kre("div",{className:"dialog-content"},void 0,kre(xL,{event:l}),n&&kre(To,{type:"info"},void 0,gc([n]))),kre("footer",{className:"dialog-footer"},void 0,kre("input",{type:"button",className:"primary",value:l.id?(0,B.Z)("calendar","Done"):l.task?(0,B.Z)("Add Task"):(0,B.Z)("Add Event"),onClick:g}),kre("input",{type:"button",value:(0,B.Z)("Cancel"),onClick:m}),!!l.id&&kre("input",{type:"button",value:(0,B.Z)("verb","Delete"),onClick:function(t){d.current=!0,_re(t),l?.id&&te.ZP.trashEvent(l.id),e.onClose().then(h)}}))))};var Pre,Dre;function Mre(e,t,n,i){Pre||(Pre="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Pre,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function Ore(e){const{onClose:t}=e,[n,i]=(0,Li.useState)(""),s=(0,Li.useRef)(Lr.Z);const o=(0,Li.useCallback)((e=>{s.current=e}),[]),a=!!e.templateId,r=a?(0,B.Z)("Edit Event Template"):(0,B.Z)("Add an Event Template"),l=a?(0,B.Z)("Save Template"):(0,B.Z)("Create Template");return Mre("div",{className:"dialog-add-template"},void 0,Mre("div",{className:"dialog-header"},void 0,Mre("h1",{className:"dialog-title"},void 0,r)),Mre("form",{className:"dialog-content"},void 0,Mre(GL,{templateId:e.templateId,event:e.event,name:e.name,properties:e.properties,setSaveTemplate:o},void 0,n&&Mre(To,{type:"error"},void 0,n))),Mre("footer",{className:"dialog-footer"},void 0,Mre("input",{type:"button",className:"primary",value:l,onClick:async function(){i("");try{s.current(),t()}catch(e){i(e.message)}}}),Mre("input",{type:"button",value:(0,B.Z)("Cancel"),onClick:t})))}function xre(e,t,n,i){Dre||(Dre="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Dre,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Lre=function(e){const{filePath:t}=e,[n,i]=(0,Li.useState)({state:"info",message:"",eventCount:0}),[s,o]=(0,Li.useState)(t.startsWith("webcal")),a=(0,Li.useMemo)((()=>{const e=t.replace(/^\w+:\/\//,"");return El.Z.getAccounts().some((t=>"ical"===t.account_type&&t.url.replace(/^\w+:\/\//,"")===e))}),[t]),[r,l]=(0,Li.useState)(!1),d=(0,DD.Z)(Zd),c=(0,Li.useCallback)(((e,t,n=!1)=>{i({message:e,eventCount:t,state:n?"error":"info"})}),[]);function u(){_l.Z.clearImportProgress("Calendar","OpenIcsFileDialog"),e.onClose()}let p=0,h=0,g=0;d.Calendar&&Object.keys(d.Calendar).forEach((e=>{p+=d.Calendar[e].current,h=d.Calendar[e].total,g=Math.round(p/h*100)})),h>0&&p===h&&(u(),de.Z.showCalendar(e.windowId));const m=s?(0,B.Z)("Import Calendar"):(0,B.Z)("Import Calendar Events");return xre(za.Z,{className:"dialog-import-events",focusName:"import-events",onKeyDown:function(e){const t=OM.Z[e.keyCode];"Enter"!==t||e.shiftKey?"Escape"===t&&u():(e.preventDefault(),e.stopPropagation(),l(!0))},forceTrap:!0},void 0,xre("header",{className:"dialog-header"},void 0,xre("h1",{className:"dialog-title",id:ra.t},void 0,m)),xre("div",{className:"dialog-content"},void 0,s&&xre(Kl,{showBody:!0,subscribe:r,onStatus:c,url:t}),!s&&xre(Ll,{standAlone:!0,file:t,import:r,onStatus:c}),xre("div",{},void 0,p>0&&xre(To,{type:"info"},void 0,(0,B.Z)("Imported $1 of $2 ($3%)",[p,h,g])),0===p&&n.message&&xre(To,{type:n.state},void 0,n.message),a&&!r&&xre(To,{type:"warning"},void 0,(0,B.Z)("You are already subscribed to this calendar")))),xre("footer",{className:"dialog-footer"},void 0,s&&(0,ss.jsxs)(ss.Fragment,{children:[xre("input",{type:"button",disabled:!n.eventCount||r,className:"primary",onClick:()=>l(!0),value:(0,B.Z)("Subscribe")}),xre("input",{type:"button",onClick:()=>o(!1),disabled:!n.eventCount,value:n.eventCount?(0,B.Z)("Import $1 event","Import $1 events",[n.eventCount]):(0,B.Z)("Import")})]}),!s&&(0,ss.jsx)(ss.Fragment,{children:xre("input",{type:"button",disabled:!n.eventCount||r,className:"primary",onClick:()=>l(!0),value:(0,B.Z)("Import")})}),xre("input",{type:"button",value:(0,B.Z)("Close"),onClick:u})))};var Rre;function Bre(e,t,n,i){Rre||(Rre="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Rre,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Fre=function(e){const t=Li.useContext(ts.Z),{modal:n,resolve:i=(e=>{})}=e;function s(s){const{document:o,HTMLInputElement:a,HTMLTextAreaElement:r}=t,l=n.checks?.reduce(((e,{name:t})=>{const n=o.querySelector(`input[name="${t}"]`);return n instanceof a&&(e[t]=Boolean(n.checked)),e}),{}),d=n.inputs?.reduce(((e,{name:t})=>{const n=o.querySelector(`textarea[name="${t}"]`);return n instanceof r&&(e[t]=n.value),e}),{});i({action:s,checks:l,inputs:d}),e.onClose()}const o=n.actions.find((e=>e.default))??n.cancelAction;return Bre(ra.Z,{className:"calendar-dialog slide",onRequestClose:()=>i({action:n.cancelAction.action}),title:n.title},void 0,Bre("form",{onSubmit:()=>s(o.action),onKeyDown:function(e){if("Escape"===OM.Z[e.keyCode])s(n.cancelAction.action),(0,ms.ZP)(e)}},void 0,Bre("div",{className:"dialog-content"},void 0,n.body,n.inputs&&Bre("div",{className:"dialog-inputs"},void 0,n.inputs.map(((e,t)=>Bre(Li.Fragment,{},t,Bre("label",{htmlFor:e.name},void 0,e.label),Bre("textarea",{name:e.name}))))),n.checks&&Bre("div",{className:"dialog-inputs"},void 0,n.checks.map(((e,t)=>Bre("label",{},t,Bre("input",{type:"checkbox",name:e.name}),Bre("span",{},void 0,e.label)))))),Bre("footer",{className:"dialog-footer"},void 0,n.actions.concat([n.cancelAction]).map((e=>{const t=o.action===e.action;return Bre("input",{autoFocus:t,onClick:()=>{s(e.action)},type:t?"submit":"button",value:e.title},e.title)})))))};var Wre=n(33499),Ure=n(17673);var Vre;function Hre(e,t,n,i){Vre||(Vre="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Vre,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Gre=function(e){const t=Li.useRef(),n=Li.useRef({effects:null,isCaptured:!1,canvasReady:!1,imageData:""}).current,[i,s]=Li.useState(!1),o=Li.useContext(ts.Z),a=o.innerWidth,r=o.innerHeight,l=o.vivaldiWindowId,{children:d,effect:c,showDialog:u}=e,p=Li.useCallback((e=>{switch(e){case"showDialog":u();break;case"done":0===Li.Children.count(d)&&u(),s(!0)}}),[d,u]);function h(){n.isCaptured&&n.canvasReady&&("melt"===c?n.effects=function(e,t,n,i,s,o){const{document:a,requestAnimationFrame:r,cancelAnimationFrame:l,Image:d}=e,c=200,u=.04,p=1e3,h=Math.round(i/c),g=i/h,m=Math.round(s*u),f=4*m;let v="initial";const y=[];let b,S=0;const w=a.createElement("canvas");w.width=i,w.height=s;const C=w.getContext("2d"),A=new d(i,s);return A.onload=()=>C.drawImage(A,0,0,i,s),A.src=n,{effect:function e(n){if(!t.current)return;if(0===y.length){for(let e=0;e<g;e++)y[e]=0===e?-Math.floor(Math.random()*f):y[e-1]+(Math.floor(Math.random()*m)-m/2),y[e]>0?y[e]=0:y[e]<-f&&(y[e]=-f);S=n}if(S===n)return void(b=r(e));const a=t.current?.getContext("2d");let l=!0,d=0,c=s;const u=s*(n-S)/p;S=n,a?.clearRect(0,0,i,s);for(let e=0;e<g;e++)y[e]+=u,y[e]<0?(l=!1,d=0):y[e]<s?(l=!1,d=y[e]):d=s,c=Math.min(d,c),a?.drawImage(w,e*h,0,h,s,e*h,d,h,s);"showDialog"!==v&&c>s/2&&!l&&(v="showDialog",o(v)),l?o("done"):b=r(e)},cleanUp:function(){b&&l(b)}}}(o,t,n.imageData,a,r,p):"burn"===c&&(n.effects=function(e,t,n,i,s,o){const{document:a,requestAnimationFrame:r,cancelAnimationFrame:l}=e,d=320,c=82,u=2,p=4.25,h=1600,g=1600;let m;const f=a.createElement("canvas");f.width=d,f.height=c;const v=f.getContext("2d"),y=v.getImageData(0,0,d,c),b=y.data,S=[];for(let e=0;e<256;e++)S[e]=xe().hsl(Math.round(e/3),1,Math.min(1,e/192)).rgb();const w=[...Array(c).keys()].map((e=>Array(d)));for(let e=0;e<c;++e)for(let t=0;t<d;++t)w[e][t]=0;let C,A=u,I=p,T=0,Z="initial";return{effect:function e(n){const a=t.current;if(!a)return;if(C=C||n,T===n)return void(m=r(e));const l=n-T;T=n;for(let e=0;e<d;e++)w[c-1][e]=Math.random()>.5?255:0;let p=0;for(let e=0;e<c-1;++e)for(let t=0;t<d;++t){let n=w[(e+1)%c][(t-1+d)%d]+w[(e+1)%c][t]+w[(e+1)%c][(t+1)%d]+w[(e+2)%c][t];n/=I,w[e][t]=Math.floor(n)}for(let e=0;e<c;++e)for(let t=0;t<d;++t){let n=e*d*4+4*t;p=w[e][t];const[i,s,o]=S[p],a=Math.min(255,2*(i+s+o));b[n]=i,b[++n]=s,b[++n]=o,b[++n]=a}v.putImageData(y,0,0);const E=a.getContext("2d");E.clearRect(0,0,i,s),E.drawImage(f,0,0,d,c-A,0,0,i,s);const k=n-C;if(k>h){"showDialog"!==Z&&(Z="showDialog",o(Z));const e=k-h;I+=l/g*3,A=Math.round(u+10*e/g)}k>h+g?o("done"):m=r(e)},cleanUp:function(){m&&l(m)}}}(o,t,n.imageData,a,r,p)),n.isCaptured=!0,n.effects?.effect?o.requestAnimationFrame(n.effects.effect):(console.warn("Failed to get notification effect"),s(!0),u()))}if(!n.isCaptured){const e={windowId:l,posX:0,posY:0,width:a,height:r,saveToDisk:!1};se.Z.thumbnails.captureUI(e,((e,t)=>{e?(n.isCaptured=!0,n.imageData=t,h()):(nn.Z.warn("Calendar","Failed to capture UI for wipe effect"),n.isCaptured=!0,s(!0),u())}))}return Li.useEffect((()=>()=>{n.effects?.cleanUp}),[n.effects]),(0,ss.jsxs)(ss.Fragment,{children:[n.isCaptured&&Li.Children.count(e.children)&&Hre("div",{className:"wipe-container",onClick:e.showDialog},void 0,e.children),!i&&(0,ss.jsx)("canvas",{width:a,height:r,ref:e=>{e&&!t.current&&(t.current=e,n.canvasReady=!0,h())}})]})};var $re;function Kre(e,t,n,i){$re||($re="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:$re,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const zre=[[1,(0,B.Z)("$1 minute","$1 minutes",[1]),"1 minute"],[2,(0,B.Z)("$1 minute","$1 minutes",[2]),"2 minutes"],[5,(0,B.Z)("$1 minute","$1 minutes",[5]),"5 minutes"],[10,(0,B.Z)("$1 minute","$1 minutes",[10]),"10 minutes"],[15,(0,B.Z)("$1 minute","$1 minutes",[15]),"15 minutes"],[20,(0,B.Z)("$1 minute","$1 minutes",[20]),"20 minutes"],[30,(0,B.Z)("$1 minute","$1 minutes",[30]),"30 minutes"],[45,(0,B.Z)("$1 minute","$1 minutes",[45]),"45 minutes"],[60,(0,B.Z)("$1 hour","$1 hours",[1]),"1 hour"],[120,(0,B.Z)("$1 hour","$1 hours",[2]),"2 hours"],[240,(0,B.Z)("$1 hour","$1 hours",[4]),"4 hours"],[360,(0,B.Z)("$1 hour","$1 hours",[6]),"6 hours"],[720,(0,B.Z)("$1 hour","$1 hours",[12]),"12 hours"],[1440,(0,B.Z)("$1 day","$1 days",[1]),"1 day"],[2880,(0,B.Z)("$1 day","$1 days",[2]),"2 days"],[4320,(0,B.Z)("$1 day","$1 days",[3]),"3 days"],[5760,(0,B.Z)("$1 day","$1 days",[4]),"4 days"],[7200,(0,B.Z)("$1 day","$1 days",[5]),"5 days"],[8640,(0,B.Z)("$1 day","$1 days",[6]),"6 days"],[10080,(0,B.Z)("$1 week","$1 weeks",[1]),"1 week"]],jre=zre.map((([e,t])=>Kre("option",{value:e.toString()},e,t)));function Yre(e){const[t,n]=Li.useState("5"),i=Li.useRef(!1);Li.useEffect((()=>(i.current=!0,()=>{i.current=!1})),[]);const{notification:s}=e,o=W()(s.eventTime),a=(0,Wre.y6)(o,s.allDay);return(0,ss.jsxs)(ss.Fragment,{children:[Kre("div",{className:"CalendarNotification-Content"},void 0,Kre("span",{className:"CalendarNotification-Time"},void 0,o.format(a)),Kre("span",{className:"CalendarNotification-Text",id:"notification-calendar-event-title"},void 0,s.title)),Kre("footer",{className:"dialog-footer CalendarNotifications-Footer"},void 0,Kre("input",{className:"CalendarNotification-Button primary",type:"button",autoFocus:!0,value:(0,B.Z)("Dismiss"),onClick:()=>e.onClose(e.notification.id)}),Kre("span",{},void 0,(0,B.Z)("or")),Kre("input",{className:"CalendarNotification-Button",type:"button",value:(0,B.Z)("Snooze"),onClick:()=>{const n=parseInt(t);Wre.ZP.snooze(e.notification,n||5),e.onClose(e.notification.id)}}),Kre(ta.Z,{onChange:e=>{n(e.target.value)},defaultValue:"5"},void 0,jre))]})}var Xre=Kre("div",{className:"CalendarNotification-HoverBackground"});function Qre(e){const t=W()(e.notification.eventTime),n=(0,Wre.y6)(t,e.notification.allDay);return Kre("div",{className:"CalendarNotification-Content"},void 0,Kre("span",{className:"CalendarNotification-Time"},void 0,t.format(n)),Kre("span",{className:"CalendarNotification-Text"},void 0,e.notification.title),Kre("div",{className:"CalendarNotification-Actions"},void 0,Kre(po.ZP,{title:(0,B.Z)("Snooze"),tabIndex:0,isMenuIndicatorVisible:!0,menu:()=>zre.map((([t,n,i])=>({handler:()=>{return n=t,Wre.ZP.snooze(e.notification,n),void e.onClose(e.notification.id);var n},label:n,labelEnglish:i}))),menuOrigin:"bottomRight"}),Kre(po.ZP,{onClick:()=>{e.onClose(e.notification.id)},title:(0,B.Z)("Dismiss"),tabIndex:0}),Xre))}function qre(e){const t=e.notifications;Li.useEffect((()=>()=>{const t=e.windowToRestore;"number"==typeof t&&he.ZP.isFullscreen(t)&&xi.Z.toggleFullscreen(t)}),[e.windowToRestore]);const[n,i]=Li.useState(1===t.length);return Li.useEffect((()=>{n&&t.length>1&&i(!1)}),[n,t.length]),Kre(za.Z,{focusName:"focus_notfications",forceTrap:!0},void 0,Kre("div",{className:Fi()("CalendarNotifications",{"CalendarNotifications--FadeUp":"up"===e.fade,"CalendarNotifications--FadeDown":"down"===e.fade})},void 0,Kre("header",{className:"dialog-header CalendarNotifications-Header"},void 0,Kre("span",{dangerouslySetInnerHTML:{__html:Wi.l0O.medium}}),Kre("span",{className:"CalendarNotifications-Title",id:ra.t},void 0,t.length>1?(0,B.Z)("Reminders"):(0,B.Z)("Reminder"))),!n&&(0,ss.jsxs)(ss.Fragment,{children:[Kre("div",{className:"CalendarNotifications-List"},void 0,t.map((t=>Kre(Qre,{notification:t,onClose:e.onClose},t.id)))),Kre("footer",{className:"dialog-footer CalendarNotifications-Footer"},void 0,Kre("input",{autoFocus:!0,className:"CalendarNotifications-Button primary",type:"button",value:(0,B.Z)("Dismiss All"),onClick:function(){e.notifications.forEach((t=>e.onClose(t.id)))}}))]}),n&&t[0]&&Kre(Yre,{notification:t[0],onClose:e.onClose})))}const Jre=function(e){const t=C.Z.get(I.kCalendarNotificationType),[n,i]=Li.useState(!("melt"===t||"burn"===t)),[s,o]=Li.useState(Ure.Z.getState().activeNotifications),a=e.onClose,r=0!==s.length;Li.useEffect((()=>{function e(){const e=Ure.Z.getState().activeNotifications;0===e.length?r&&a():o(e)}return Ure.Z.addListener(e),()=>Ure.Z.removeListener(e)}),[a,r]);const l=Li.useCallback((()=>{i(!0)}),[]);Li.useEffect((()=>{let e;return"melt"!==t&&"burn"!==t||(e=setTimeout(l,8e3)),()=>{e&&clearTimeout(e)}}),[t,l]);const d={notifications:s,onClose:function(e){A.Z.dispatch({actionType:"MAIN_HIDE_CALENDAR_ALARM",notificationId:e})},fade:"melt"===t?"down":"up",windowToRestore:e.windowToRestore};return(0,ss.jsxs)(ss.Fragment,{children:[("melt"===t||"burn"===t)&&Kre(Gre,{effect:t,showDialog:l},void 0,n&&(0,ss.jsx)(qre,{...d})),"dialog"===t&&(0,ss.jsx)(qre,{...d})]})};var ele;function tle(e,t,n,i){ele||(ele="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:ele,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const nle=function(e){return tle(FT,{danger:!0,title:e.label?(0,B.Z)("title","Delete Feed"):(0,B.Z)("title","Delete All Feeds"),prompt:e.label?[(0,B.Z)("Feed '$1' will be removed",[e.label])]:[(0,B.Z)("All feeds will be reomved")],negative:(0,B.Z)("Cancel"),positive:e.label?(0,B.Z)("command","Delete Feed"):(0,B.Z)("command","Delete All Feeds"),onRequestClose:()=>{e.handleClose(e.dialog)},onClose:t=>{e.callback(t),e.handleClose(e.dialog)}},e.dialog)};var ile;function sle(e,t,n,i){ile||(ile="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:ile,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const ole=function(e){return sle(FT,{danger:!0,title:(0,B.Z)("title","Delete Filter"),prompt:[(0,B.Z)("The filter '$1' will be removed",[e.label])],negative:(0,B.Z)("Cancel"),positive:(0,B.Z)("command","Delete Filter"),onRequestClose:()=>{e.handleClose(e.dialog)},onClose:t=>{e.callback(t),e.handleClose(e.dialog)}},e.dialog)};var ale;function rle(e,t,n,i){ale||(ale="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:ale,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const lle=function(e){return rle(FT,{danger:!0,title:(0,B.Z)("title","Delete Label"),prompt:[(0,B.Z)("The '$1' label will be removed from all messages",[e.label])],negative:(0,B.Z)("Cancel"),positive:(0,B.Z)("command","Delete Label"),onRequestClose:()=>{e.handleClose(e.dialog)},onClose:t=>{e.callback(t),e.handleClose(e.dialog)}},e.dialog)};var dle;function cle(e,t,n,i){dle||(dle="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:dle,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const ule=function(e){return cle(FT,{title:(0,B.Z)("title","Upload messages to server?"),prompt:[(0,B.Z)("Do you want to upload imported messages to server for $1",[e.accountId])],negative:(0,B.Z)("No, keep them internal"),positive:(0,B.Z)("Yes, upload to server"),onRequestClose:()=>{e.handleClose(e.dialog)},onClose:t=>{e.callback(t),e.handleClose(e.dialog)}},e.dialog)};var ple;function hle(e,t,n,i){ple||(ple="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:ple,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const gle=function(e){return hle(FT,{danger:!0,title:(0,B.Z)("Trigger Mail Action"),prompt:[(0,B.Z)("This saved filter ($1) has an action which will be applied to all its messages. Would you like to proceed?",[e.label])],negative:(0,B.Z)("Cancel"),positive:(0,B.Z)("Apply Action to Mails"),onRequestClose:()=>{e.callback(!1),e.handleClose(e.dialog)},onClose:t=>{e.callback(t),e.handleClose(e.dialog)}},e.dialog)};var mle;function fle(e,t,n,i){mle||(mle="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:mle,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function vle(e){const t=Zl.ZP.getDefaultAccount()?.id;let n=e.find((e=>e.id===t));return!n&&e.length&&(n=e[0]),n}const yle=function(e){const t=El.Z.getAccounts().filter((e=>"ical"!==e.account_type)),[n,i]=(0,Li.useState)(""),[s,o]=(0,Li.useState)({vevent:!0,vtodo:"local"===vle(t)?.account_type,vjournal:!1}),[a,r]=(0,Li.useState)(Zl.ZP.getCalendarCreateColor()),[l,d]=(0,Li.useState)(""),[c,u]=(0,Li.useState)(!1),[p,h]=(0,Li.useState)(vle(t)?.id||"");function g(e){d(e)}return fle("div",{className:"dialog-add-calendar"},void 0,fle("div",{className:"dialog-header"},void 0,fle("h1",{className:"dialog-title",id:ra.t},void 0,(0,B.Z)("Add a New Calendar"))),0===t.length?(0,ss.jsxs)(ss.Fragment,{children:[fle("div",{className:"dialog-content"},void 0,(0,B.Z)("You have no suitable calendar account set up. Add one in Settings.")),fle("footer",{className:"dialog-footer"},void 0,fle("input",{type:"button",className:"primary",value:(0,B.Z)("Open Calendar Settings"),onClick:function(t){de.Z.showSettings(e.windowId,"calendar"),e.onClose()}}),fle("input",{type:"button",value:(0,B.Z)("Cancel"),onClick:e.onClose}))]}):fle("form",{onSubmit:async function(){if(""===p)return void g((0,B.Z)("No suitable calendar account found."));u(!0);const i=t.find((e=>e.id===p)),o={name:n,accountId:p,description:n,color:a,supportedCalendarComponent:s},{result:r}=await te.ZP.createCalendar(o,i,!0);r.status?e.onClose():g(r.message)}},void 0,fle("div",{className:"dialog-content"},void 0,t.length>1&&fle("label",{className:"floating-label"},void 0,fle("span",{},void 0,(0,B.Z)("Account")),fle(ta.Z,{onChange:function(e){h(e.target.value)},value:p},void 0,t.map((e=>fle("option",{value:e.id},e.id,e.name))))),fle(Vl.Z,{type:"text",onChange:function(e){i(e.target.value)},label:(0,B.Z)("Calendar Name"),value:n,autoFocus:!0}),fle(ER,{label:(0,B.Z)("Calendar color","Color"),colorKey:"color",colorValue:a,setColor:function(e,t,n=!1){r(e.hex())},predefinedColors:eh.hx}),fle(OR,{supportedCalendarComponent:s,updateCalendarComponent:function(e){o(e)},disabled:!1}),l&&fle(To,{type:"warning"},void 0,l)),fle("footer",{className:"dialog-footer"},void 0,fle("input",{type:"submit",value:(0,B.Z)("Add Calendar"),disabled:!Zl.ZP.isCalendarValidToCreate({accountId:p,description:n,supportedCalendarComponent:s,name:""})||c}),fle("input",{type:"button",value:(0,B.Z)("Cancel"),onClick:e.onClose}))))};var ble;function Sle(e,t,n,i){ble||(ble="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:ble,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class wle extends Li.PureComponent{constructor(e){super(e)}deleteFeedFolder=async()=>{const{path:e}=this.props.options,t=[],n=yt.Z.getByFolderId([It.u4,e]);if(n){const e=xt.ZP.getSubFilters(n);for(const n of e){const{ancestorPath:e,feedPath:i}=xt.ZP.parseFeedFolderPath(n.path);await Jt.Z.move(It.u4,e,"",i),t.push(n.id)}d.Z.removeFilter(n.id),t.push(n.id)}yt.Z.updateFilters(t),this.props.onClose()};onDismiss=()=>{this.props.onClose()};render=()=>Sle("div",{className:"dialog-delete-folder-name"},void 0,Sle("header",{className:"dialog-header"},void 0,Sle("h1",{id:ra.t},void 0,(0,B.Z)("Delete Feed Folder “$1”",[this.props.options.path])),Sle("h2",{},void 0,(0,B.Z)("Note that the feeds in that folder will move to the root folder."))),Sle("footer",{className:"dialog-footer"},void 0,Sle("input",{type:"button",value:(0,B.Z)("Delete Feed Folder"),className:"primary",onClick:this.deleteFeedFolder}),this.props.dismissable&&Sle("input",{type:"button",onClick:this.onDismiss,value:(0,B.Z)("Cancel")})))}const Cle=wle;var Ale;function Ile(e,t,n,i){Ale||(Ale="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Ale,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class Tle extends Li.PureComponent{constructor(e){super(e)}deleteMailFolder=()=>{const{accountId:e,path:t}=this.props.options,n=vt.Z.getFolder(e,t);if(!n)throw new Error(`Folder not found for ${e} ${t}`);const{subscribed:i}=n;!async function(){try{await d.Z.removeAccountPath(e,t),(0,Tt.mq)(e)&&i&&await Yt.Z.deleteMailbox(e,t)}catch(n){nn.Z.error("Mail",`Failed to remove folder ${(0,Rn.kF)(t)} from ${e}`)}}(),this.props.onClose()};onDismiss=()=>{this.props.onClose()};render=()=>Ile("div",{className:"dialog-delete-folder-name"},void 0,Ile("header",{className:"dialog-header"},void 0,Ile("h1",{id:ra.t},void 0,(0,B.Z)("Delete Folder “$1” From Account “$2”",[(0,Rn.kF)(this.props.options.path),this.props.options.accountId])),Ile("h2",{},void 0,(0,B.Z)("Note that all messages in that folder will also be deleted."))),Ile("footer",{className:"dialog-footer"},void 0,Ile("input",{type:"button",value:(0,B.Z)("Delete Folder"),className:"primary",onClick:this.deleteMailFolder}),this.props.dismissable&&Ile("input",{type:"button",onClick:this.onDismiss,value:(0,B.Z)("Cancel")})))}const Zle=Tle;var Ele,kle,_le,Nle;function Ple(e,t,n,i){Ele||(Ele="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Ele,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class Dle extends Li.Component{static contextType=ts.Z;context;state={saveDays:C.Z.get(I.kSessionsSaveDays)};_onEnable=()=>{w.Z.set(I.kSessionsSaveOnExit,"on"),w.Z.set(I.kSessionsSaveDays,this.state.saveDays),this.props.onClose()};_onCancel=()=>{this.props.onClose()};_onSaveDaysChange=e=>{const{HTMLSelectElement:t}=this.context;e.target instanceof t&&this.setState({saveDays:parseInt(e.target.value)})};_renderSaveDays=()=>[1,3,5,30].map((e=>Ple("option",{value:e},e,1===e?(0,B.Z)("Last day"):(0,B.Z)("$1 day","Last $1 days",[e]))));render(){const e="init"===this.props.options.mode?(0,B.Z)("title","Enable"):(0,B.Z)("Save");return Ple(ra.Z,{onRequestClose:this._onCancel,title:(0,B.Z)("title","Automatic Session Backup")},void 0,Ple("form",{onSubmit:this._onEnable},void 0,Ple("div",{className:"dialog-content"},void 0,Ple("p",{},void 0,(0,B.Z)("Sessions back up on an hourly basis. Select how many days worth of backups to keep.")),Ple(ta.Z,{value:this.state.saveDays,onChange:this._onSaveDaysChange},void 0,this._renderSaveDays()),"size"===this.props.options.mode&&(0,ss.jsx)(ss.Fragment,{children:Ple("p",{},void 0,(0,B.Z)("Any excess sessions are moved to Trash."))})),Ple("footer",{className:"dialog-footer"},void 0,Ple("input",{type:"button",onClick:this._onCancel,value:(0,B.Z)("Cancel")}),Ple("input",{type:"submit",onClick:this._onEnable,value:e}))))}}function Mle(e,t,n,i){kle||(kle="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:kle,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class Ole extends Li.Component{static contextType=ts.Z;state={enableWorkspaces:!0};_onWithWorkspaces=()=>{this.setState({enableWorkspaces:!0})};_onNoWorkspaces=()=>{this.setState({enableWorkspaces:!1})};_onCancel=()=>{this.props.onClose()};_onOpen=()=>{w.Z.set(I.kWorkspacesEnabled,this.state.enableWorkspaces),this.props.onClose(),this.props.options.onClose(!this.state.enableWorkspaces)};render(){return Mle(ra.Z,{onRequestClose:this._onCancel,title:(0,B.Z)("Enable Workspaces?")},void 0,Mle("form",{onSubmit:this._onOpen},void 0,Mle("div",{className:"dialog-content"},void 0,Mle("p",{},void 0,(0,B.Z)("Session contains tabs inside Workspaces")),Mle("label",{className:"dialog-checkbox"},void 0,Mle("input",{type:"radio",checked:this.state.enableWorkspaces,onChange:this._onWithWorkspaces}),Mle("span",{},void 0,(0,B.Z)("Enable Workspaces and Open"))),Mle("label",{className:"dialog-checkbox"},void 0,Mle("input",{type:"radio",checked:!this.state.enableWorkspaces,onChange:this._onNoWorkspaces}),Mle("span",{},void 0,(0,B.Z)("Open as Tabs")))),Mle("footer",{className:"dialog-footer"},void 0,Mle("input",{type:"button",onClick:this._onOpen,value:(0,B.Z)("Open"),autoFocus:!0}),Mle("input",{type:"button",onClick:this._onCancel,value:(0,B.Z)("Cancel")}))))}}function xle(e,t,n,i){_le||(_le="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:_le,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class Lle extends Li.Component{static contextType=ts.Z;state={workspaceAsTabs:!1};_onWithWorkspaces=()=>{this.setState({workspaceAsTabs:!1})};_onNoWorkspaces=()=>{this.setState({workspaceAsTabs:!0})};_onCancel=()=>{this.props.onClose()};_onOpen=()=>{this.props.onClose(),this.props.options.onClose(this.state.workspaceAsTabs)};render(){return xle(ra.Z,{onRequestClose:this._onCancel,title:(0,B.Z)("Open Session with Workspaces?")},void 0,xle("form",{onSubmit:this._onWithWorkspaces},void 0,xle("div",{className:"dialog-content"},void 0,xle("p",{},void 0,(0,B.Z)("New Workspaces will be added next to existing")),xle("label",{className:"dialog-checkbox"},void 0,xle("input",{type:"radio",checked:!this.state.workspaceAsTabs,onChange:this._onWithWorkspaces}),xle("span",{},void 0,(0,B.Z)("Open with Workspaces"))),xle("label",{className:"dialog-checkbox"},void 0,xle("input",{type:"radio",checked:this.state.workspaceAsTabs,onChange:this._onNoWorkspaces}),xle("span",{},void 0,(0,B.Z)("Open as Tabs")))),xle("footer",{className:"dialog-footer"},void 0,xle("input",{type:"button",onClick:this._onOpen,value:(0,B.Z)("Open"),autoFocus:!0}),xle("input",{type:"button",onClick:this._onCancel,value:(0,B.Z)("Cancel")}))))}}function Rle(e,t,n,i){Nle||(Nle="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Nle,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class Ble extends Li.PureComponent{_isMounted=!1;constructor(e){super(e),this.state={accounts:[],currentAccount:void 0,setupStep:"setup"}}componentDidMount(){this._isMounted=!0,this.loadAccountsAndCapabilities()}componentDidUpdate(e){if(e.prefValues[I.kMailAccounts]!==this.props.prefValues[I.kMailAccounts]){const e=!0;this.loadAccountsAndCapabilities(e)}}loadAccountsAndCapabilities=async e=>{const t=await iu.Z.loadAllAccounts();let n=this.state.currentAccount;if(t.length<this.state.accounts.length)n=void 0,this.setState({accounts:t,currentAccount:n});else{let i;e&&t.length>this.state.accounts.length&&(n=t.find((e=>!this.state.accounts.some((t=>t.MAIL_EMAIL===e.MAIL_EMAIL)))),i="signature"),this._isMounted&&(i?this.setState({accounts:t,setupStep:i,currentAccount:n}):this.setState({accounts:t,currentAccount:n}))}};showTips=()=>{this.setState({setupStep:"tips"})};onCreateItem=()=>{this.setState({setupStep:"setup"})};render(){return"tips"===this.state.setupStep?Rle("div",{className:"MailAccountSheet vivaldi-settings"},void 0,Rle("button",{className:"MailAccountSheet-exit",onClick:this.props.onClose},void 0,Rle("span",{dangerouslySetInnerHTML:{__html:Wi.kze}})),Rle(EV,{onClose:this.props.onClose,onCreateItem:this.onCreateItem})):Rle("div",{className:"MailAccountSheet vivaldi-settings"},void 0,Rle("button",{className:"MailAccountSheet-exit",onClick:this.props.onClose},void 0,Rle("span",{dangerouslySetInnerHTML:{__html:Wi.kze}})),Rle("div",{className:"setting-section"},void 0,"setup"===this.state.setupStep&&Rle(nV,{onClose:this.props.onClose,focusInput:!0,emptyAccounts:0===this.state.accounts.length,searchableStrings:JU},"create"),"signature"===this.state.setupStep&&this.state.currentAccount&&Rle(WV,{accountSettings:this.state.currentAccount,searchableStrings:BV,showTips:"signature"===this.state.setupStep?()=>this.showTips():void 0})))}}const Fle=(0,Bu.Z)(Ble,[I.kMailAccounts]);var Wle,Ule;function Vle(e,t,n,i){Wle||(Wle="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Wle,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function Hle(e){const[t,n]=Li.useState(e.options.account.MAIL_USER||""),[i,s]=Li.useState(e.options.account.MAIL_PASSWORD||""),[o,a]=Li.useState(!1);return Vle("form",{onSubmit:function(n){n.preventDefault();const s={...e.options.account,MAIL_USER:t,MAIL_PASSWORD:i};(0,Od.ZP)(s,e.options.account),zU(s,e.options.account),e.onClose()}},void 0,Vle("header",{className:"dialog-double-header"},void 0,Vle("div",{className:"header-icon",dangerouslySetInnerHTML:{__html:Wi.Si$.large}}),Vle("h1",{className:"dialog-title",id:ra.t},void 0,(0,B.Z)("Authentication Error")),Vle("p",{className:"info full-width"},void 0,(0,B.Z)("Enter credentials for $1",[e.options.account.MAIL_EMAIL]))),Vle("div",{className:"dialog-content"},void 0,Vle("h4",{},void 0,(0,B.Z)("IMAP Username")),Vle("div",{className:"toolbar toolbar-default"},void 0,Vle("input",{type:"text",placeholder:"user@vivaldi.net",value:t,onChange:function(e){n(e.target.value)}})),Vle("h4",{},void 0,(0,B.Z)("IMAP Password")),Vle("div",{className:"toolbar toolbar-default"},void 0,Vle("input",{autoFocus:!0,type:o?"text":"password",placeholder:(0,B.Z)("My long safe password"),value:i,onChange:function(e){s(e.target.value)}}),Vle(po.ZP,{tooltip:(0,B.Z)("tooltip","Show password"),image:Wi.sgm.medium,isPressed:o,onClick:function(){a(!o)}}))),Vle("footer",{className:"dialog-footer"},void 0,Vle("input",{type:"submit",value:(0,B.Z)("mail","Save"),autoFocus:!0}),Vle("input",{type:"button",onClick:e.onClose,value:(0,B.Z)("Cancel")})))}function Gle(e,t,n,i){Ule||(Ule="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Ule,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function $le(e,t){return Gle("h1",{},void 0,t?(0,B.Z)("Permanently Delete $1 Message","Permanently Delete $1 Messages",[e]):(0,B.Z)("Delete $1 Message","Delete $1 Messages",[e]))}var Kle=Gle("input",{type:"radio",value:"selected",autoFocus:!0}),zle=Gle("input",{type:"radio",value:"folders"}),jle=Gle("input",{type:"radio",value:"accounts"});const Yle=function(e){const{options:t,onClose:n}=e,{entries:i,deletePermanently:s}=t,[o,a]=Li.useState((()=>{const e=new Map;return i.forEach((t=>{t.sources.forEach(((t,n)=>{if(!t.deleted){const t=ht.Z.get(n);e.set(t.accountId,!0)}}))})),e}));return Gle("form",{onSubmit:function(t){t.preventDefault(),Hf.Z.delete(e.windowId,i,s,{accountIds:o}),n()}},void 0,Gle("header",{className:"dialog-header"},void 0,Gle("span",{id:ra.t},void 0,$le(i.length,s)),Gle("p",{},void 0,(0,B.Z)("From which folders would you like to delete the message?","From which folders would you like to delete the messages?",[i.length]))),Gle("div",{className:"dialog-content label-list"},void 0,[...o.entries()].map(((e,t)=>{const[n,i]=e;return Gle("label",{},n,Gle("input",{type:"checkbox",autoFocus:0===t,checked:i,onChange:()=>{o.set(n,!i),a(new Map([...o.entries()]))}}),Gle("span",{},void 0,n))}))),Gle("footer",{className:"dialog-footer"},void 0,Gle("input",{type:"submit",className:"danger",value:(0,B.Z)("mail","Delete")}),Gle("input",{type:"button",onClick:n,value:(0,B.Z)("Cancel"),autoFocus:!0})))},Xle=function(e){const{options:t,onClose:n}=e,{entries:i,deletePermanently:s}=t,o=new Set;i.forEach((e=>{e.sources.forEach(((e,t)=>{e.deleted||o.add(t)}))}));const a=ht.Z.getByIds([...o]);return Gle("form",{onSubmit:function(t){t.preventDefault(),Hf.Z.delete(e.windowId,i,s,{setting:"accounts"}),n()}},void 0,Gle("header",{className:"dialog-header"},void 0,Gle("span",{id:ra.t},void 0,$le(i.length,s)),Gle("p",{},void 0,(0,B.Z)("Are you sure you want to purge the message from the following folders?","Are you sure you want to purge your deleted messages from the following folders?",[i.length]))),Gle("div",{className:"dialog-content label-list"},void 0,Gle("ul",{},void 0,a.map((e=>{const{id:t,accountId:n,path:i}=e,s=vt.Z.getFolderName(n,i);return Gle("li",{},t,Gle("span",{},void 0,n),Gle("span",{className:"folder-path"},void 0,s))})))),Gle("footer",{className:"dialog-footer"},void 0,Gle("input",{type:"submit",className:"danger",value:(0,B.Z)("mail","Delete")}),Gle("input",{type:"button",onClick:n,value:(0,B.Z)("Cancel"),autoFocus:!0})))},Qle=function(e){const{options:t,onClose:n}=e,{entries:i,deletePermanently:s}=t,[o,a]=Li.useState((()=>{const e=new Map;return i.forEach((t=>{t.sources.forEach(((t,n)=>{t.deleted||e.set(n,!0)}))})),e})),r=ht.Z.getByIds([...o.keys()]);return Gle("form",{onSubmit:function(t){t.preventDefault(),Hf.Z.delete(e.windowId,i,s,{sourceFilterIds:o}),n()}},void 0,Gle("header",{className:"dialog-header"},void 0,Gle("span",{id:ra.t},void 0,$le(i.length,s)),Gle("p",{},void 0,(0,B.Z)("From which folders would you like to delete the message?","From which folders would you like to delete the messages?",[i.length]))),Gle("div",{className:"dialog-content label-list"},void 0,r.map(((e,t)=>{const{id:n,accountId:i,path:s}=e,r=vt.Z.getFolderName(i,s),l=o.get(n);return Gle("label",{},n,Gle("input",{type:"checkbox",autoFocus:0===t,checked:l,onChange:()=>{o.set(n,!l),a(new Map([...o.entries()]))}}),Gle("span",{},void 0,i," ",r))}))),Gle("footer",{className:"dialog-footer"},void 0,Gle("input",{type:"submit",className:"danger",value:(0,B.Z)("mail","Delete")}),Gle("input",{type:"button",onClick:n,value:(0,B.Z)("Cancel"),autoFocus:!0})))},qle=function(e){const{options:t,onClose:n}=e,{entries:i,deletePermanently:s,showSelected:o,showFolders:a,showAccounts:r}=t;let l="folders",d=!1;return Gle("form",{onSubmit:function(t){if(t.preventDefault(),Hf.Z.delete(e.windowId,i,s,{setting:l}),d){const e=s?I.kMailDeleteInOtherLocations:I.kMailMarkDeleteInOtherLocations;w.Z.set(e,l)}n()}},void 0,Gle("header",{className:"dialog-header",id:ra.t},void 0,$le(i.length,s)),Gle(ja.Z,{className:"dialog-content label-list",name:"mail_delete_dialog_setting",value:l,onChange:e=>{l=e.target.value}},void 0,o&&Gle("label",{},void 0,Kle,Gle("span",{},void 0,(0,B.Z)("From the Current Folder Only"))),a&&Gle("label",{},void 0,zle,Gle("span",{},void 0,(0,B.Z)("From All Folders on Current Account"))),r&&Gle("label",{},void 0,jle,Gle("span",{},void 0,(0,B.Z)("From All Accounts and Folders")))),Gle("footer",{className:"dialog-footer label-list"},void 0,Gle("label",{},void 0,Gle("input",{type:"checkbox",value:d,onChange:e=>d=e.target.value}),Gle("span",{},void 0,(0,B.Z)("Don’t Ask Again"))),Gle("input",{type:"submit",className:"danger",value:(0,B.Z)("mail","Delete")}),Gle("input",{type:"button",onClick:n,value:(0,B.Z)("Cancel"),autoFocus:!0})))};var Jle;function ede(e,t,n,i){Jle||(Jle="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Jle,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class tde extends Li.Component{#Lt=()=>{const e=J.Z.getActiveListEntry();return e?(0,Kf.Q3)(e.flags):[]};#En=()=>{const e=J.Z.getActiveListEntry(),t=e?(0,Kf.Zr)(e.flags):"";return!t&&e?It.T4.CLEAR_FLAGS:t};static contextType=ts.Z;wrapperRef=Li.createRef();state={labels:this.#Lt(),flag:this.#En(),activeTabId:"labels"};componentDidMount(){J.Z.addListener(this.#kn);const{document:e}=this.context;e.addEventListener("keydown",this.#_n)}componentWillUnmount(){J.Z.removeListener(this.#kn);const{document:e}=this.context;e.removeEventListener("keydown",this.#_n)}#Nn=(e,t)=>{if(e.keyCode===xa.Z.KEY_DOWN||e.keyCode===xa.Z.KEY_UP){e.stopPropagation(),e.preventDefault();const n=e.keyCode===xa.Z.KEY_DOWN?"down":"up",i=this.wrapperRef.current;if(i){const e=1;return aw(t,n,Array.from(i.querySelectorAll(".MailLabelFlagDlg-itemCanFocus")),e)}return!1}return!1};#_n=e=>{e.stopPropagation(),e.preventDefault();const t=new Set(C.Z.get(I.kMailLabelItemsHide)),n=C.Z.get(I.kMailLabelItemsOrder).filter((e=>!t.has(e)));if(e.keyCode!==xa.Z.KEY_ENTER&&e.keyCode!==xa.Z.KEY_RETURN)if(e.keyCode===xa.Z.KEY_TAB&&this.setState((e=>({activeTabId:"flags"===e.activeTabId?"labels":"flags"}))),"flags"===this.state.activeTabId){let t;const n=(0,Af.a)();switch(e.key){case"0":t=n[7];break;case"1":t=n[0];break;case"2":t=n[1];break;case"3":t=n[2];break;case"4":t=n[3];break;case"5":t=n[4];break;case"6":t=n[5];break;case"7":t=n[6]}t&&Hf.Z.setStandardFlag(this.props.windowId,t)}else{let t;switch(e.key){case"1":t=n[0];break;case"2":t=n[1];break;case"3":t=n[2];break;case"4":t=n[3];break;case"5":t=n[4];break;case"6":t=n[5];break;case"7":t=n[6];break;case"8":t=n[7];break;case"9":t=n[8]}t&&Hf.Z.toggleLabel(this.props.windowId,t,this.state.labels)()}else this.props.onClose()};#kn=()=>{this.setState({labels:this.#Lt(),flag:this.#En()})};#Pn=async()=>{this.props.onClose()};#Dn=e=>{const t=e.currentTarget.value;Hf.Z.toggleLabel(this.props.windowId,t,this.state.labels)()};#Mn=e=>{e.currentTarget.value!==this.state.flag&&Hf.Z.toggleStandardFlag(this.props.windowId,e.currentTarget.value,this.state.flag)};#On=e=>this.state.labels.includes(e);#xn=e=>this.state.flag===e;#Ln=e=>{this.setState({activeTabId:e})};render(){const e=C.Z.get(I.kMailLabelItemsOrder),t=new Set(C.Z.get(I.kMailLabelItemsHide)),n=[];e&&e.forEach((e=>{const i=yt.Z.getByFolderId([It.ut,e]);i&&!t.has(e)&&n.push(i)}));const i=(0,Af.a)();return(0,ss.jsxs)("div",{ref:this.wrapperRef,children:[ede("header",{className:"dialog-header"},void 0,ede("h1",{className:"dialog-title",id:"popup-label-addmaillabel"},void 0,(0,B.Z)("Add Labels or Flag")),ede("button",{className:"MailLabelFlagDlg-icon MailLabelFlagDlg-itemCanFocus",title:(0,B.Z)("Mail Label Settings"),dangerouslySetInnerHTML:{__html:Wi.bqs.small},"data-id":"MailLabelFlagDlg-settings",onKeyDown:e=>this.#Nn(e,"MailLabelFlagDlg-settings"),onClick:()=>de.Z.showSettings(this.context.vivaldiWindowId,"mail",{scroll:"labels"})}),ede("p",{className:"info"},void 0,(0,B.Z)("Select which labels or flag you'd like to add"))),ede("form",{onSubmit:this.#Pn},void 0,ede(PV,{activeTabId:this.state.activeTabId,icons:[Wi.rpm.small,Wi.nyn.small],className:"dialog-content",onTabClick:this.#Ln},void 0,ede("div",{className:"dialog-content MailLabelFlagDlg-tab",label:(0,B.Z)("Labels"),id:"labels"},void 0,n.map(((e,t)=>ede("label",{"data-id":e.path,onKeyDown:t=>this.#Nn(t,e.path),className:"MailLabelFlagDlg-labelWrapper MailLabelFlagDlg-itemCanFocus"},e.id,ede("input",{type:"checkbox",checked:this.#On(e.path),value:e.path,onChange:this.#Dn,autoFocus:0===t}),ede("span",{},void 0,(0,UE.X)(e.path)),t+1<10&&ede("span",{className:"MailLabelFlagDlg-shortcut"},void 0,ede("kbd",{},void 0,t+1)))))),ede("div",{className:"MailLabelFlagDlg-tab",label:(0,B.Z)("Flags"),id:"flags"},void 0,i.map(((e,t)=>ede("label",{"data-id":e,onKeyDown:t=>this.#Nn(t,e),className:"MailLabelFlagDlg-labelWrapper MailLabelFlagDlg-itemCanFocus"},e,ede("input",{type:"radio",checked:this.#xn(e),value:e,onChange:this.#Mn}),e!==It.T4.CLEAR_FLAGS&&ede("span",{className:`MailLabelFlagDlg-icon flag-color flag-${e.toLowerCase()}`,title:(0,B.Z)("Flagged"),dangerouslySetInnerHTML:{__html:Wi.nyn.small}}),ede("span",{},void 0,(0,rk.M)(e)),ede("span",{className:"MailLabelFlagDlg-shortcut"},void 0,ede("kbd",{},void 0,e===It.T4.CLEAR_FLAGS?0:t+1))))))),ede("footer",{className:"dialog-footer"},void 0,ede("input",{type:"submit",className:"primary MailLabelFlagDlg-itemCanFocus","data-id":"Submit-button-done",onKeyDown:e=>this.#Nn(e,"Submit-button-done"),value:(0,B.Z)("process","Done")})))]})}}const nde=tde;var ide,sde;function ode(e,t,n,i){ide||(ide="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:ide,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function ade(e){const t=(0,Li.useContext)(ts.Z),[n,i]=(0,Li.useState)(!1),{folder:s}=e.options,{accountId:o,path:a}=s,r=vt.Z.getFolderName(o,a);return ode("form",{onSubmit:function(i){i.preventDefault(),d.Z.unsubscribeMailbox(t.vivaldiWindowId,s,n),e.onClose()}},void 0,ode("header",{className:"dialog-double-header"},void 0,ode("div",{className:"header-icon",dangerouslySetInnerHTML:{__html:Wi.Si$.large}}),ode("h1",{className:"dialog-title",id:ra.t},void 0,(0,B.Z)("Unsubscribe from IMAP folder $1",[r]))),ode("div",{className:"dialog-content"},void 0,ode("div",{className:"toolbar toolbar-default"},void 0,ode("input",{autoFocus:!0,type:"checkbox",checked:n,onChange:function(){i(!n)}}),ode("span",{},void 0,(0,B.Z)("Remove messages from this device"))),ode("p",{className:"info"},void 0,(0,B.Z)("If checked, all message files for $1 on $2 will be deleted. Otherwise they will remain on disk.",[r,o]))),ode("footer",{className:"dialog-footer"},void 0,ode("input",{type:"submit",className:"danger",value:(0,B.Z)("mail","Unsubscribe"),autoFocus:!0}),ode("input",{type:"button",onClick:e.onClose,value:(0,B.Z)("Cancel")})))}function rde(e,t,n,i){sde||(sde="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:sde,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class lde extends Li.PureComponent{static contextType=ts.Z;refTreeList=Li.createRef();notes=h7.ZP.getRootNode().children.filter((e=>"trash"!==e.type));state={selectedId:void 0,filter:"",filteredNotes:this.notes};handleConfirm=()=>{this.state.selectedId&&(this.props.onSelected(this.state.selectedId),this.props.onClose())};handleSelected=e=>{e?.id&&this.setState({selectedId:e.id})};handleDoubleClick=(e,t)=>{t.id&&(this.props.onSelected(t.id),this.props.onClose())};hasChildren=e=>"note"!==e.type&&!!e.children&&e.children.length>0;handleExpandClick=(e,t)=>{const n=e.altKey;this.refTreeList.current?.toggleSelectedExpansion(t,n)};handleFilterChange=({currentTarget:e})=>{const t=e.value;if(0===t.length)return void this.setState({filteredNotes:this.notes,filter:""});let n=t.toLowerCase();const i={};n.startsWith("url:")?(n=n.substring(4),i.url=n.length>0,i.content=!1):n.startsWith("content:")&&(n=n.substring(8),i.url=!1,i.content=n.length>0),"."===n&&(i.url=!1);const{collapsed:s,nodes:o}=h7.ZP.getFilteredTree(n,i);this.setState({filteredNotes:o,filter:t},(()=>{this.refTreeList.current?.expandAllExcept(s)}))};renderTitleRow=e=>{const t=e.node,n=e.level,i=(n+1)*ks+"px",s=n*ks+"px",o=h7.ZP.isFolder(t);return rde("label",{},t.id,o&&this.hasChildren(t)&&rde("span",{className:"expand-icon",style:{marginLeft:s},onMouseDown:ms.ZP,onMouseUp:e=>this.handleExpandClick(e,t.id),dangerouslySetInnerHTML:{__html:Wi.nfH}}),o&&rde(Ki,{trash:!1,open:e.isExpanded,leftMargin:this.hasChildren(t)?0:i}),!o&&!t.url&&rde("span",{style:{marginLeft:i},className:"tree-icon",dangerouslySetInnerHTML:{__html:Wi.zKr}}),!o&&!!t.url&&rde("span",{style:{marginLeft:i},className:"tree-icon",dangerouslySetInnerHTML:{__html:Wi.NwZ}}),void 0!==e.inlineEditText&&rde("input",{type:"text",value:e.inlineEditText,onChange:e.onChange,onFocus:e.onFocus,onBlur:e.onBlur,autoFocus:!0}),void 0===e.inlineEditText&&rde("span",{className:"title",title:tee(t)},void 0,tee(t)),e.showBadge&&this.hasChildren(t)&&rde("span",{className:"item-count"},void 0,t.children?.length))};rowComponent=e=>{const t=e.node,n=e.level,i=h7.ZP.isSeparator(t),s=(n+1)*ks+"px",o=[];return i?o.push(rde("label",{"data-parent":t.parentId},`${t.id}__separator__${o.length}`,rde("hr",{style:{marginLeft:s},className:"separator"}))):o.push(this.renderTitleRow(e)),o};render(){const{props:e}=this,t=h7.ZP.getRootNode().id;return rde("div",{className:e.className,style:e.style},void 0,rde("header",{className:"dialog-header"},void 0,rde("h1",{id:"moodal-dialog-title"},void 0,(0,B.Z)("notes","Choose which note to append the selected text"))),rde("div",{className:"dialog-content"},void 0,rde("input",{className:"notes-filter",type:"search",placeholder:(0,B.Z)("verb","Filter"),value:this.state.filter,onChange:this.handleFilterChange,autoFocus:!0,tabIndex:"0"}),(0,ss.jsx)(Ps,{ref:this.refTreeList,rowComponent:this.rowComponent,nodes:this.state.filteredNotes,rootId:t,onSelect:this.handleSelected,onItemDoubleClick:this.handleDoubleClick,supportsInlineEdit:!1,isSeparator:h7.ZP.isSeparator,hasChildren:this.hasChildren,isFolder:h7.ZP.isFolder})),rde("footer",{className:"dialog-footer"},void 0,rde("input",{type:"button",value:(0,B.Z)("Add to Note"),className:"primary",disabled:!this.state.selectedId,onClick:this.handleConfirm}),rde("input",{type:"button",value:(0,B.Z)("Cancel"),onClick:this.props.onClose})))}}const dde=lde;var cde;function ude(e,t,n,i){cde||(cde="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:cde,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const pde="shift+alt+";class hde extends Li.PureComponent{static contextType=ts.Z;state={accessKeys:[],shown:!1,page:null};componentDidMount(){const e=Ce.ZP.getActivePage(this.context.vivaldiWindowId);e&&se.Z.accessKeys.getAccessKeysForPage(e.id,(t=>{this.setState({accessKeys:t,shown:!0,page:e},(()=>this.bindKeystrokes()))}))}componentWillUnmount(){this.unbindKeystrokes()}bindKeystrokes=()=>{const{accessKeys:e}=this.state;e.forEach((e=>{Ke.Z.bind(e.access_key,this.pressKey),Ke.Z.bind(pde+e.access_key,this.pressKey)}))};unbindKeystrokes=()=>{const{accessKeys:e}=this.state;e.forEach((e=>{Ke.Z.unbind(e.access_key,this.pressKey),Ke.Z.unbind(pde+e.access_key,this.pressKey)}))};onClose=()=>{this.state.shown&&(this.setState({shown:!1}),this.props.onClose())};getLink=e=>{const t=(0,ge.Z)(this.state.page?.url??"");if(t){if(e.startsWith("#")&&t.href)return t.href.split("#")[0]+e;if(e.startsWith("/")&&t.protocol&&t.host)return t.protocol+"//"+t.host+e}return e};pressKey=e=>{this.triggerKey(e.keyState.key)};triggerKey=e=>{const t=Ce.ZP.getActivePage(this.context.vivaldiWindowId);t&&se.Z.accessKeys.action(t.id,e),this.onClose()};render(){if(!this.state.shown)return null;const{accessKeys:e,page:t}=this.state;return ude("div",{className:"dialog-access-keys"},void 0,ude("header",{className:"dialog-header"},void 0,ude("h1",{className:"dialog-title"},void 0,ude("span",{id:ra.t},void 0,(0,B.Z)("Access Key Shortcuts")),t&&ude("span",{className:"info"},void 0,(0,B.Z)("for $1",[t.title||t.url])))),ude("div",{className:"dialog-content"},void 0,0===e.length&&(0,B.Z)("This page doesn’t seem to contain access key shortcuts."),e.length>0&&e.map(((e,t)=>ude("label",{className:"keycombo",title:e.href},t,ude("input",{type:"button",className:"item",onClick:this.triggerKey.bind(null,e.access_key),value:e.access_key}),ude("span",{},void 0,e.title.replace(/\[.*?\]/g,"")||e.textContent.trim()||e.href))))),ude("footer",{className:"dialog-footer"},void 0,ude("p",{className:"info"},void 0,C.Z.get(I.kWebpagesAccessKeys)?(0,B.Z)("Access key shortcuts are allowed in keyboard settings."):(0,B.Z)("Access key shortcuts are disabled in keyboard settings.")," ",(0,B.Z)("Run shortcuts on page with $1 modifier keys.",["Shift+Alt"])),ude("input",{type:"button",onClick:this.onClose,value:(0,B.Z)("Close"),className:"primary",autoFocus:!0})))}}const gde=hde;var mde,fde;function vde(e,t,n,i){mde||(mde="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:mde,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function yde(e){return function(t){return vde("div",{"data-selected":t.selected?"":null,className:"quick-command",style:t.style,onMouseOver:()=>t.onMouseOver(t.item),onClick:e=>t.onItemClick(t.item,e)},void 0,(0,ss.jsx)(e,{...t}))}}function bde(e,t,n,i){fde||(fde="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:fde,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class Sde extends Li.PureComponent{render(){const{name:e}=this.props.item;return(0,ss.jsxs)(ss.Fragment,{children:[bde("span",{className:"quick-command-favicon",dangerouslySetInnerHTML:{__html:Wi.VLT}}),bde("span",{className:"quick-command-title"},void 0,e),bde("span",{className:"view quick-command-shortcut"},void 0,(0,B.Z)("Press Enter to Copy"))]})}}const wde=yde(Sde);var Cde;function Ade(e,t,n,i){Cde||(Cde="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Cde,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class Ide extends Li.PureComponent{render(){const{item:e,searchTerm:t,icon:n}=this.props,i=e.faviconUrl||e.pageUrlForFavicon||e.url||void 0,s=e.faviconUrl?"faviconFromCache":"page";return(0,ss.jsxs)(ss.Fragment,{children:[n&&Ade("span",{className:"quick-command-workspace-icon",dangerouslySetInnerHTML:{__html:n}}),i&&Ade(Ri.ZP,{className:"quick-command-favicon",url:i,loadType:s,style:e.read?{filter:"saturate(0) opacity(0.5)"}:{}}),t.length?Hv(t,e.name,!1,"quick-command-title"):Ade("span",{className:"quick-command-title"},void 0,e.name),e.url&&(t.length?Hv(t,e.url,!1,"quick-command-url"):Ade("span",{className:"view quick-command-url"},void 0,e.url)),e.nickname&&(t.length?Hv(t,e.nickname,!1,"view quick-command-nickname"):Ade("span",{className:"view quick-command-nickname"},void 0,e.nickname)),e.meta&&Ade("span",{className:"view quick-command-meta"},void 0,(0,vp.$)(e.meta))]})}}const Tde=yde(Ide);var Zde;function Ede(e,t,n,i){Zde||(Zde="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Zde,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class kde extends Li.PureComponent{render(){const{name:e,url:t,faviconUrl:n,visitCount:i,visitTime:s}=this.props.item,{searchTerm:o}=this.props,a=W()(s).format("l, LT"),r=e||t;return(0,ss.jsxs)(ss.Fragment,{children:[Ede(Ri.ZP,{url:n||t,loadType:n?"faviconFromCache":"page",className:"quick-command-favicon"}),Hv(o,r,!1,"quick-command-title"),Ede("span",{className:"quick-command-timestamp"},void 0,a),Ede("span",{className:"item-count"},void 0,i)]})}}const _de=yde(kde);var Nde;function Pde(e,t,n,i){Nde||(Nde="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Nde,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Dde="/resources/folder@2x.png";class Mde extends Li.PureComponent{render(){const{item:e,searchTerm:t}=this.props,n=function(e,t){return t?Dde:e?Wi.NwZ:Wi.cyI.small}(e.hasOwnProperty("url"),Boolean(e.isFolder));return(0,ss.jsxs)(ss.Fragment,{children:[Pde(Ri.ZP,{url:n,loadType:"faviconFromCache",className:"quick-command-favicon"}),e.name&&Hv(t,e.name,!1,"quick-command-title"),!e.nickname&&e.url&&Hv(t,e.url,!1,"quick-command-url"),e.nickname&&Hv(t,e.nickname,!1,"quick-command-url"),e.hasAttachment&&Pde("span",{className:"quick-command-attachment",dangerouslySetInnerHTML:{__html:Wi.onv}})]})}}const Ode=yde(Mde);var xde;function Lde(e,t,n,i){xde||(xde="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:xde,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class Rde extends Li.PureComponent{render(){const{item:e,style:t,selected:n}=this.props,{name:i,subtitle:s,count:o}=e;return Lde("div",{"data-selected":n?"":null,style:t,className:"quick-command-sectionheader"},void 0,i,s&&Lde("span",{className:"QuickCommand-Title--Subtitle"},void 0,s),o>0&&Lde("span",{className:"item-count"},void 0,o))}}const Bde=Rde;var Fde,Wde=n(34155);function Ude(e,t,n,i){Fde||(Fde="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Fde,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class Vde extends Li.PureComponent{static contextType=ts.Z;state={selectedIndex:1};_keyedNavigation=!1;_startIndex=0;_stopIndex=0;setKeyedNavigation=e=>{this._keyedNavigation=e};getSelectedIndex=()=>this.state.selectedIndex;selectByIndex=e=>{this.props.setNavigatingList(!0),this.props.hintChange(e),this.setState({selectedIndex:e}),this.rerenderVisibleTreeItems()};onKeyDown=e=>{const t={ctrl:Boolean(e.ctrlKey),alt:Boolean(e.altKey),shift:Boolean(e.shiftKey),command:!1},n=this.props.renderedArray;let i=this.getSelectedIndex(),s=i;if(!t.ctrl&&t.alt&&!t.shift&&!t.command)switch(e.key){case"ArrowUp":i>0&&"title"===n[i-1].type&&i--,s=0;for(let e=i-1;e>=0;e--)if("title"===n[e].type){s=e+1;break}e.preventDefault();break;case"ArrowDown":for(let e=i;e<n.length;e++)if("title"===n[e].type){s=e+1;break}e.preventDefault()}else if(!(t.ctrl||t.alt||t.shift||t.command)){const t=this._stopIndex-this._startIndex;switch(e.key){case"ArrowUp":s=Math.max(0,i-1),e.preventDefault();break;case"ArrowDown":s=Math.min(i+1,n.length-1),e.preventDefault();break;case"PageUp":s=Math.max(0,this._startIndex-t);break;case"PageDown":s=Math.min(this._stopIndex+t,n.length-1)}}s!==i&&("title"===n[s].type&&(s=s>i?++s:Math.max(0,--s)),this.selectByIndex(s))};_onMouseOver=e=>{this._keyedNavigation||void 0===e.index||(this.selectByIndex(e.index),Wde.nextTick((()=>this.props.syncOffset())))};_onMouseMove=()=>{this.setKeyedNavigation(!1)};rerenderVisibleTreeItems=()=>{this.refList&&this.refList.forceUpdateGrid()};_onIndexChanged=e=>{this._startIndex=e.startIndex,this._stopIndex=e.stopIndex};_getWorkspaceIcon=e=>{const t=this.props.workspaces.find((t=>t.id===e));return t?.emoji??t?.icon??void 0};renderTreeItem=({index:e,style:t})=>{const{filtering:n,searchTerm:i}=this.props,s=this.props.renderedArray[e],o=`${s.type}__${e}`;"noteAdd"!==s.type&&"title"!==s.type&&(s.index=e);const a=this.state.selectedIndex===e,r=!n||"noteAdd"===s.type&&"search"===s.type&&"keywordSearch"===s.type&&"commandChain"===s.type?i:i.split(":")[1].trim();switch(s.type){case"title":return Ude(Bde,{selected:a,item:s,style:t},o);case"history":return Ude(_de,{selected:a,item:s,style:t,searchTerm:r,onItemClick:this.props.onExecuteCommand,onMouseOver:this._onMouseOver},o);case"calculator":{const e=s;return Ude(wde,{style:t,selected:a,onItemClick:this.props.onExecuteCommand,onMouseOver:this._onMouseOver,item:e},o)}case"note":case"noteAdd":return Ude(Ode,{item:s,style:t,selected:a,onItemClick:this.props.onExecuteCommand,searchTerm:r,onMouseOver:this._onMouseOver},o);default:{const e=s;let n;return e.workspaceId?n=this._getWorkspaceIcon(e.workspaceId):e.deviceType&&(n=(0,x8.bj)(e.deviceType)),Ude(Tde,{selected:a,item:e,style:t,searchTerm:r,onItemClick:this.props.onExecuteCommand,onMouseOver:this._onMouseOver,icon:n},o)}}};render(){const{innerHeight:e}=this.context,t=28+((0,Cs.mM)()?4:0),n=this.props.renderedArray.length*t;let i=n>10*t?10*t:n;return e/2<i&&(i=Math.round(e/2)),Ude("div",{className:"quick-commands",tabIndex:"1",onKeyDown:this.onKeyDown,onMouseMove:this._onMouseMove},void 0,(0,ss.jsx)(ws.aV,{ref:e=>this.refList=e,onRowsRendered:this._onIndexChanged,scrollToIndex:this.state.selectedIndex,height:i,rowHeight:t,width:520,rowRenderer:this.renderTreeItem,rowCount:this.props.renderedArray.length}))}}const Hde=Vde;var Gde,$de=n(34155);function Kde(e,t,n,i){Gde||(Gde="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Gde,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const zde=(0,B.Z)("Filter Quick Commands"),jde=[I.kAddressBarStripJavascriptOnPaste,I.kQuickCommandsKeepValue,I.kQuickCommandsOpenUrlInNewTab,I.kQuickCommandsSearchEnglish,I.kQuickCommandsFirstRunTipDismissed,I.kQuickCommandsSearchPriority,I.kQuickCommandsMatchNickname,I.kQuickCommandsNicknameMatchInNewTab,I.kChainedCommandsCommandList,I.kQuickCommandsShowBookmarks,I.kQuickCommandsShowCalculator,I.kQuickCommandsShowExtensions,I.kQuickCommandsShowHistory,I.kQuickCommandsShowNotes,I.kQuickCommandsShowPageActions,I.kQuickCommandsLimitResults,I.kQuickCommandsShowReadingList,I.kQuickCommandsUseNotesManager,I.kWorkspacesEnabled],Yde="text/plain";let Xde=!1;const Qde=(0,us.Z)("keyword","bookmark"),qde=(0,us.Z)("keyword","note"),Jde=(0,us.Z)("keyword","tab"),ece=(0,us.Z)("keyword","nick"),tce=(0,us.Z)("keyword","history"),nce=(0,us.Z)("keyword","command"),ice=(0,us.Z)("keyword","action"),sce=(0,us.Z)("keyword","extension"),oce=[{...(0,x8.jn)({labelPair:Qde,initialPart:"^",endingPart:"$"}),...Qde,type:"bookmark"},{...(0,x8.jn)({labelPair:qde,initialPart:"^",endingPart:"$"}),...qde,type:"note"},{...(0,x8.jn)({labelPair:Jde,initialPart:"^",endingPart:"$"}),...Jde,type:"tab"},{...(0,x8.jn)({labelPair:ece,initialPart:"^",endingPart:"$"}),...ece,type:"bookmarkNick"},{...(0,x8.jn)({labelPair:tce,initialPart:"^",endingPart:"$"}),...tce,type:"history"},{...(0,x8.jn)({labelPair:nce,initialPart:"^",endingPart:"$"}),...nce,type:"command"},{...(0,x8.jn)({labelPair:ice,initialPart:"^",endingPart:"$"}),...ice,type:"contentScript"},{...(0,x8.jn)({labelPair:sce,initialPart:"^",endingPart:"$"}),...sce,type:"extension"}];var ace=Kde(co,{type:"close",size:16});class rce extends Li.PureComponent{static contextType=ts.Z;state={quickCommandSearchValue:this.props.quickCommandValue||"",typeAheadHint:zde,filtering:null,renderedArray:[]};#m=!1;_isIMEOpen=!1;_justClosedIME=!1;contentScripts=[];hasSearchedForFullHistory=!1;_imeProcessSpace=!1;defaultEngine;chainShortcuts=[];refQuickCommandInput=Li.createRef();refQuickCommandHint=Li.createRef();extensions=[];commandChains=[];sendTabToSelfTargets=[];constructor(e,t){super(e),Xde||(Xde=!0,Me.loadAll()),this.defaultEngine=ai.Z.getDefault(he.ZP.isIncognito(t.vivaldiWindowId))}componentDidMount(){this.#m=!0,No.Z.addListener(this._onWebpageviewStoreChanged),this._initialSetup(),se.Z.pageActions.getScripts((e=>{this.contentScripts=e}))}_initialSetup=()=>{const e=(0,x8.IZ)(this.context.vivaldiWindowId,""),t=(0,x8.JQ)(""),n=C.Z.get(I.kWorkspacesEnabled),i=n?(0,x8.fX)(""):[];this.chainShortcuts=Ge.Z.getChainCommandsShortcuts(),(0,x8.pN)().then((e=>this.extensions=e)),(0,x8.a$)().then((e=>{this.sendTabToSelfTargets=e})),this.commandChains=this.props.prefValues[I.kChainedCommandsCommandList];const s=(0,x8.$J)(this.context,{searchText:"",chains:this.commandChains,shortcuts:this.chainShortcuts});let o=[];if(this.props.prefValues[I.kQuickCommandsSearchPriority].forEach((a=>{switch(a){case"OPEN_TABS":o=[...o,...t];break;case"NORMAL_COMMAND":o=[...o,...e];break;case"WORKSPACES":n&&(o=[...o,...i]);break;case"COMMAND_CHAIN":o=[...o,...s]}})),this.setState({renderedArray:o},(()=>{const{selectIndex:e}=this.getSelectPriority();this.hintChange(e)})),this.props.prefValues[I.kQuickCommandsKeepValue]&&this.refQuickCommandInput.current?.value===this.props.quickCommandValue){const e=this.state.quickCommandSearchValue;e.length&&(this.refQuickCommandInput.current?.setSelectionRange(0,e.length),this.searchChange(e))}};componentWillUnmount(){const e=this.state.quickCommandSearchValue;this.props.prefValues[I.kQuickCommandsKeepValue]&&e.length?this.props.storeQuickCommandValue(e):this.props.storeQuickCommandValue(""),No.Z.removeListener(this._onWebpageviewStoreChanged),this.#m=!1}componentDidUpdate(){this._imeProcessSpace&&this._isIMEOpen&&(this._imeProcessSpace=!1),this.commandChains!==this.props.prefValues[I.kChainedCommandsCommandList]&&(this.commandChains=this.props.prefValues[I.kChainedCommandsCommandList])}_onWebpageviewStoreChanged=e=>{if(this.#m&&"qcPasteAndGo"===e.action&&e.payload){const t=this.refQuickCommandInput.current?.selectionStart??0,n=this.refQuickCommandInput.current?.selectionEnd??0,{clipboardText:i}=e.payload,{quickCommandSearchValue:s}=this.state,o=(0,$y.Z)({textToStrip:i,caretPosition:t,selectionEnd:n,currentValue:s}),{renderedArray:a,filtering:r}=this.processRenderedArray({qcInputText:o,renderedArray:[]});this.setState({renderedArray:a,filtering:r},(()=>{const{selectIndex:e}=this.getSelectPriority(),t=this.state.renderedArray[e];setTimeout((()=>{this.executeCommand(t,{ctrlKey:!1,altKey:!1,metaKey:!1,shiftKey:!1}),this.props.onClose()}),5)}))}};onKeyDown=e=>{switch(this.qclist.setKeyedNavigation(!0),e.key){case"Process":this._isIMEOpen&&(this._imeProcessSpace=!0);break;case"Escape":this.onEscape(),e.preventDefault(),e.stopPropagation();break;case"ArrowUp":case"ArrowDown":case"PageUp":case"PageDown":this.qclist.onKeyDown(e),e.preventDefault();break;case"Enter":{if(this._isIMEOpen||this.expireTimeout)break;const t=this.qclist.getSelectedIndex(),{renderedArray:n}=this.state,i=n[t];this.executeCommand(i,e),e.preventDefault(),e.stopPropagation();break}case"Tab":case"ArrowRight":if((0,ps.Z)(e)||this._isIMEOpen)break;this.autoCompleteHint(),"Tab"===e.key&&e.preventDefault()}this._justClosedIME=!1,$de.nextTick((()=>this.syncOffset()))};onCompositionStart=()=>{this._isIMEOpen=!0};onCompositionEnd=()=>{this._isIMEOpen=!1,this._justClosedIME=!0,this.searchChange(this.state.quickCommandSearchValue)};onEscape=()=>{this._isIMEOpen||(this.state.quickCommandSearchValue.length>0&&!this._justClosedIME&&!this._isIMEOpen?(this.props.storeQuickCommandValue(""),this.setState({quickCommandSearchValue:"",typeAheadHint:zde},(()=>this.searchChange("")))):this._justClosedIME||this.props.onClose()),this._justClosedIME=!1};syncOffset=()=>{const{HTMLInputElement:e}=this.context,t=this.refQuickCommandInput.current?.scrollLeft??-1;t>-1&&this.refQuickCommandHint.current instanceof e&&(this.refQuickCommandHint.current.scrollLeft=t)};autoCompleteHint=()=>{const{typeAheadHint:e,renderedArray:t}=this.state,n=t[this.qclist.getSelectedIndex()];if(!e.length||"calculator"===n.type)return;const i="commandKeyword"===n.type&&n.searchString?n.searchString+" ":n.name;this.setState({quickCommandSearchValue:i},(()=>this.searchChange(i)))};executeCommand=(e,t)=>{const{ctrlKey:n,altKey:s,metaKey:o,shiftKey:a}=t,r={ctrlKey:n,altKey:s,metaKey:o,shiftKey:a},l=(0,x8.vD)(this.context.vivaldiWindowId,r),d=this.context.vivaldiWindowId;switch(e.type){case"openTab":if(e.windowId&&e.pageId){const{windowId:t,pageId:n,workspaceId:s}=e;s!==Ce.ZP.getActiveWorkspace(d)&&c.ZP.setActiveWorkspace(t,s),i.Z.windows.update(t,{focused:!0},(()=>{i.Z.tabs.update(n,{active:!0})}))}break;case"readingList":e.url&&c.ZP.openURL(d,e.url,{...l});break;case"closedTab":e.command&&Ni.Z.undeleteTab(e.command.sessionId);break;case"calculator":{const{name:t}=e;this.context.navigator.clipboard.writeText(t);break}case"commandChain":e.action&&e.action();break;case"bookmarkFolder":case"bookmarkNick":e.folderId?(0,x8.hV)(this.context.vivaldiWindowId,e.folderId):e.url&&c.ZP.openURL(d,e.url,{...l});break;case"bookmark":if(e.url){const{url:t}=e;c.ZP.openURL(d,t,{...l})}break;case"sendtabtoself":{const{pageUrl:t,title:n,guid:i}=e;t&&i&&se.Z.tabsPrivate.sendSendTabToSelfTarget(t,n??"",i);break}case"extension":if(e.id&&void 0!==e.enabled){const{id:t,enabled:n,optionsUrl:i=""}=e,s={id:t,enabled:n,optionsPage:(0,As.mT)(r),optionsUrl:i};(0,x8.de)(d,s)}break;case"url":{const{name:t}=e;c.ZP.openURL(d,t,{transition:se.Z.historyPrivate.TransitionType.TYPED,...l});break}case"keywordSearch":case"search":e.searchQuery&&"string"==typeof e.searchQuery&&oy.Z.goSearchUrl(d,e.searchQuery,{...l});break;case"command":case"commandKeyword":if(e.commandName){const{commandName:t,value:n,name:i}=e;return void this.props.onClose().then((()=>{ne.Z.executeActions("qc",this.context,t,n),u.Z.setStatus(d,(0,B.Z)("Command: $1",[i]),3e3),this.props.storeQuickCommandValue("")}))}break;case"history":if(e.url){const{url:t}=e;c.ZP.openURL(d,t,{...l})}break;case"contentScript":{const t=Ce.ZP.getActivePage(d);if(t&&e.script){const n=t.id,{script:i}=e;se.Z.pageActions.getScriptOverridesForTab(n,(e=>{const t=e.find((e=>e.script===i)),s=t&&"enabled"===t.override?"no_override":"enabled";se.Z.pageActions.setScriptOverrideForTab(i,n,s,(()=>{}))}))}break}case"note":if(e.id){const{id:t}=e;this.handleNotesOpening(t,{...l})}break;case"noteAdd":if(e.value&&"string"==typeof e.value){const{value:t}=e;zn.Z.createNote(d,{content:t,type:"note"})}break;case"workspace":{const{workspaceId:t}=e;c.ZP.setActiveWorkspace(d,t);break}}this.#m&&(this.setState({quickCommandSearchValue:""}),this.props.storeQuickCommandValue("")),$de.nextTick((()=>{this.closeTip(),this.props.onClose()}))};onSearchChange=e=>{const t=e.target;this.searchChange(t.value)};handleNotesOpening=(e,t)=>{const n=this.props.prefValues,i=this.context.vivaldiWindowId;n[I.kQuickCommandsUseNotesManager]||!Yn.ZP.hasPanel(i,"PanelNotes")?c.ZP.openURL(i,pn.jk.internalUrl("notes",e),{...t}):jn.Z.showContent(i,"PanelNotes",{setFocus:!0,selectId:e,reason:""})};handleHistoryFullSearchTimeout=(0,Ae.Z)((e=>{if(this.hasSearchedForFullHistory||!this.state.quickCommandSearchValue.length)return!1;if(this.isNavigatingList)return this.hasSearchedForFullHistory=!1,this.handleHistoryFullSearchTimeout(e),!1;this.hasSearchedForFullHistory=!0;const t=(0,x8.s1)({searchText:e,today:!1}),n=this.state.renderedArray[this.qclist?.getSelectedIndex()],{renderedArray:i,filtering:s}=this.processRenderedArray({qcInputText:e,renderedArray:t});this.setState({renderedArray:i,filtering:s},(()=>this.performFullSearchSelection(n)))}),750);performFullSearchSelection=e=>{const t=e;if("history"!==t.type||void 0===t.url)return;const n=this.state.renderedArray.findIndex((n=>{const i=n.url;return!(!i||!e)&&i.toLowerCase()===t.url?.toLowerCase()}));-1!==n&&(this.selectByIndex(n),this.qclist.rerenderVisibleTreeItems())};setNavigatingList=e=>{this.isNavigatingList=e,this.closeTip(),this.debounceNavigationOfList()};debounceNavigationOfList=(0,Ae.Z)((()=>{this.isNavigatingList=!1}),500);processRenderedArray=e=>{const{qcInputText:t,renderedArray:n}=e,i=t.trim(),s=this.props.prefValues,o=this.props.prefValues[I.kQuickCommandsSearchPriority];let a,r,l,d=[];-1===i.indexOf(":")||(0,rl.K2)(i)||([r,l]=i.split(":"),a=oce.find((e=>(0,x8.Fm)(r,e))));const c=(0,x8.xh)(i);c.forEach((e=>d.push(e)));const u=i.length;if(s[I.kQuickCommandsShowCalculator]&&(0,x8.CD)(i).forEach((e=>d.push(e))),u&&!c.length){const e=(0,x8.JC)(i,this.defaultEngine);d.push(e)}s[I.kQuickCommandsShowNotes]&&(0,x8.Dj)(i).forEach((e=>d.push(e)));const p=l?.trim()||i,h=l?.trim()?.length||u,g=void 0!==a,m=Boolean(!g&&h);return o.forEach((e=>{switch(e){case"OPEN_TABS":{if(!("tab"===a?.type)&&g)break;const e=(0,x8.JQ)(p);d=[...d,...e];break}case"NORMAL_COMMAND":{if(!("command"===a?.type)&&g)break;const e=(0,x8.IZ)(this.context.vivaldiWindowId,p);d=[...d,...e];break}case"SEND_TAB_TO_SELF":{const e=(0,x8.fJ)(this.context.vivaldiWindowId,p,this.sendTabToSelfTargets);d=[...d,...e];break}case"EXTENSIONS":{const e=s[I.kQuickCommandsShowExtensions]&&h,t="extension"===a?.type;if(!e||!t&&g)break;const n=(0,x8.nX)(p,this.extensions);d=[...d,...n];break}case"COMMAND_CHAIN":u&&(0,x8.$J)(this.context,{searchText:i,chains:this.commandChains,shortcuts:this.chainShortcuts}).forEach((e=>d.push(e)));break;case"BOOKMARK_ITEM_OR_FOLDER":{const e=s[I.kQuickCommandsShowBookmarks]&&h,t="bookmark"===a?.type,n="bookmarkNick"===a?.type;if(!e)break;(n||m)&&(0,x8.hm)(p).forEach((e=>d.push(e)));let i=[],o=[];(t||m)&&(i=(0,x8.Xz)(p),o=(0,x8.oE)(p)),d=[...d,...i,...o];break}case"READING_LIST":if(u&&s[I.kQuickCommandsShowReadingList]){const e=(0,x8.Lm)(i);d=[...d,...e]}break;case"NOTES_SEARCH":{const e=s[I.kQuickCommandsShowNotes]&&h,t="note"===a?.type;if(!e||!t&&g)break;const n=(0,x8.Kk)(p);d=[...d,...n];break}case"HISTORY":{const e=s[I.kQuickCommandsShowHistory]&&h>1,t="history"===a?.type;if(!e||!t&&g)break;if(!n.length){const e=this.throttleHistory(p);d=[...d,...e]}else d=[...d,...n];break}case"CLOSED_TABS":{if(!("tab"===a?.type)&&g)break;const e=(0,x8.S4)(p);d=[...d,...e];break}case"KEYWORD_SEARCH":(0,x8.Gr)(i).forEach((e=>d.push(e)));break;case"PAGE_ACTIONS":{const e=s[I.kQuickCommandsShowPageActions]&&h,t="contentScript"===a?.type,n=Ce.ZP.isActiveExternal(this.context.vivaldiWindowId);if(!e||!t&&g||!n)break;const i=(0,x8.sh)(p,this.contentScripts);d=[...d,...i];break}case"WORKSPACES":if(C.Z.get(I.kWorkspacesEnabled)){const e=(0,x8.fX)(p);d=[...d,...e]}}})),{renderedArray:d,filtering:a}};searchChange=(e,t=-1)=>{this.hasSearchedForFullHistory=!1;const{renderedArray:n,filtering:i}=this.processRenderedArray({qcInputText:e,renderedArray:[]});this.setState({renderedArray:n,filtering:i,quickCommandSearchValue:e},(()=>{-1!==t&&this.refQuickCommandInput.current?.setSelectionRange(t,t),this.performSelection()}))};throttleHistory=e=>(C.Z.get(I.kQuickCommandsLimitResults)||this.handleHistoryFullSearchTimeout(e),(0,x8.s1)({searchText:e,today:!0}));onPaste=e=>{const{clipboardData:t}=e;if(t.types[0]!==Yde)return;const n=t.getData(Yde);n.trim()||e.preventDefault();const{prefValues:i}=this.props,{quickCommandSearchValue:s}=this.state,o=/^(\s*javascript:)+/i;if(i[I.kAddressBarStripJavascriptOnPaste]){const t=o.test(n),i=o.test(s+n);if(t||i){e.preventDefault();const{selectionEnd:t,selectionStart:i}=e.currentTarget,s=(0,$y.Z)({textToStrip:n,caretPosition:i,selectionEnd:t,currentValue:this.state.quickCommandSearchValue}),o=e.currentTarget.selectionStart+s.length-this.state.quickCommandSearchValue.length;this.searchChange(s,o)}}};getSelectPriority=()=>{const{renderedArray:e,filtering:t,quickCommandSearchValue:n}=this.state,{prefValues:i}=this.props;let s=0;const o=i[I.kQuickCommandsSearchEnglish];if(t){const{type:n}=t,i=e.findIndex((e=>void 0!==e.selectPriority&&e.type.toLowerCase().includes(n.toLowerCase())));if(i>-1){const t=e[i];return(0,x8.Jg)(t,i)}}const a=n.toLowerCase(),r=e.findIndex((e=>{const t=e.name.toLowerCase();if(o&&e.labelEnglish){const n=e.labelEnglish.toLowerCase();return a===t||a===n}return a===t}));if(r>-1){const t=e[r];return(0,x8.Jg)(t,r)}let l=i[I.kQuickCommandsSearchPriority].length;return e.forEach(((e,t)=>{void 0!==e.selectPriority&&e.selectPriority<l&&(s=t,l=e.selectPriority)})),{priority:l,selectIndex:s}};openBookmark=e=>{const t=this.props.prefValues;if(t[I.kQuickCommandsMatchNickname]){if(e.folderId)(0,x8.hV)(this.context.vivaldiWindowId,e.folderId);else if(e.url){const n={inCurrent:!1===t[I.kQuickCommandsNicknameMatchInNewTab],inBackground:!1,inNewWindow:!1,allowOverride:!1,incognito:!1};zi.ZP.openUrls(this.context.vivaldiWindowId,[e.url],n,!1)}this.expireTimeout=setTimeout((()=>{this.props.storeQuickCommandValue(""),this.setState({quickCommandSearchValue:""},(()=>{this.props.onClose()}))}),200)}};performSelection=()=>{const{quickCommandSearchValue:e}=this.state,{renderedArray:t}=this.state;let{priority:n,selectIndex:i}=this.getSelectPriority();const s=t[i],o=this.props.prefValues[I.kQuickCommandsSearchPriority];if("bookmarkNick"===s.type)this.openBookmark(s);else if(n===o.length){const n=t.findIndex((t=>"history"===t.type&&t.name.toLowerCase().includes(e.toLowerCase())));i=-1!==n?n:0}this.selectByIndex(i),this.hintChange(i),this.qclist?.rerenderVisibleTreeItems()};hintChange=e=>{let t;const{renderedArray:n,filtering:i,quickCommandSearchValue:s}=this.state,o=n[e];let a=s;switch(i&&(a=a.split(":")[1]),o.type){case"url":case"noteAdd":case"search":case"keywordSearch":t="";break;case"commandKeyword":case"command":if(o.value)t="";else{const{name:e}=o,n=(0,x8.ue)(e,a);t=s+e.substring(n+a.length)}break;case"calculator":if(o.searchString&&o.name){const{searchString:e,name:n}=o;t=e!==n?`${a} = ${n}`:""}break;default:{let e="";const{name:n="",url:i="",nickname:r=""}=o,l=(0,x8.ue)(n,a),d=i?(0,x8.ue)(i,a):-1,c=(0,x8.ue)(r,a);-1!==l?e=n.substring(l+a.length):i&&-1!==d?e=i.substring(d+a.length):-1!==c&&(e=r.substring(c+a.length)),t=s+e}}a.length||"title"!==o.type||(t=zde),this.setState({typeAheadHint:t}),this.qclist.rerenderVisibleTreeItems()};closeTip=()=>{w.Z.set(I.kQuickCommandsFirstRunTipDismissed,!0)};selectByIndex(e){this.qclist&&this.qclist.selectByIndex(e)}render(){const{renderedArray:e,filtering:t,quickCommandSearchValue:n}=this.state,i=C.Z.get(I.kWorkspacesEnabled)?GF.Z.getState():[];return Kde("div",{className:"quick-command-container"},void 0,Kde("div",{className:"qc-entry"},void 0,(0,ss.jsx)("input",{tabIndex:"-1",readOnly:!0,ref:this.refQuickCommandHint,className:"quick-command-search-hint",value:this.state.typeAheadHint}),(0,ss.jsx)("input",{type:"search",autoFocus:!0,ref:this.refQuickCommandInput,className:"quick-command-search",onKeyDown:this.onKeyDown,onScroll:()=>$de.nextTick(this.syncOffset),onCompositionStart:this.onCompositionStart,onCompositionEnd:this.onCompositionEnd,value:this.state.quickCommandSearchValue,onChange:this.onSearchChange,onPaste:this.onPaste})),!this.props.prefValues[I.kQuickCommandsFirstRunTipDismissed]&&Kde("div",{className:"quick-command-tip"},void 0,Kde(To,{type:"info"},void 0,Kde("div",{className:"quick-command-tip-content"},void 0,(0,B.Z)("Press $1 or $2 keys with $3 modifier to skip to next search result section. Press $4 key to auto-complete input from current list selection.",[(0,vp.$)("Down"),(0,vp.$)("Up"),(0,vp.$)("Alt"),(0,vp.$)("Right")]),Kde("span",{className:"close-tip",onClick:this.closeTip},void 0,ace)))),(0,ss.jsx)(Hde,{ref:e=>this.qclist=e,renderedArray:e,onExecuteCommand:this.executeCommand,syncOffset:this.syncOffset,filtering:Boolean(t),setNavigatingList:this.setNavigatingList,searchTerm:n.trim(),hintChange:this.hintChange,workspaces:i}))}}const lce=(0,Bu.Z)(rce,jde);var dce;function cce(e,t,n,i){dce||(dce="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:dce,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const uce=[I.kKeyboardShortcutsEnable,I.kKeyboardShortcutsEnableSingleKey];class pce extends Li.Component{refComboFilter=Li.createRef();state={filter:""};componentDidMount(){this.refComboFilter.current?.focus()}onSettingsFilter=e=>{const t=e.target.value.toLowerCase().replace(/⌘/g,"meta").replace(/⌥/g,"alt").replace(/⇧/g,"shift").replace(/⌃/g,"ctrl");this.setState({filter:t})};onKeyDown=e=>{"Escape"===e.nativeEvent.code&&0===this.refComboFilter.current?.value.length&&(this.props.onClose(),e.stopPropagation(),e.preventDefault())};render(){let e="keystrokes";return this.props.prefValues[I.kKeyboardShortcutsEnable]?this.props.prefValues[I.kKeyboardShortcutsEnableSingleKey]||(e+=" singlekeydisabled"):e+=" shortcutsdisabled",cce("div",{className:"keyboardShortcutsWrapper",tabIndex:"0",onKeyDown:this.onKeyDown},void 0,cce("header",{},void 0,cce("h1",{id:ra.t},void 0,(0,B.Z)("Keyboard Cheat Sheet")),(0,ss.jsx)("input",{className:"search",ref:this.refComboFilter,type:"search",placeholder:(0,B.Z)("Filter Commands"),onChange:this.onSettingsFilter}),cce("button",{className:"close",onClick:this.props.onClose,dangerouslySetInnerHTML:{__html:Wi.kze}})),cce("div",{className:e},void 0,cce(rU,{filter:this.state.filter,view:"read-only"})))}}const hce=(0,Bu.Z)(pce,uce);var gce;function mce(e,t,n,i){gce||(gce="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:gce,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const fce=[I.kThemeUseAnimation];class vce extends Li.Component{static contextType=ts.Z;state={mediaState:Gie.Z.getState().get(this.props.page.id)||(0,ze.l4)()};componentDidMount(){Gie.Z.addListener(this._onMediaStateStoreChanged)}componentDidUpdate(e,t){e.page.id!==this.props.page.id&&this._onMediaStateStoreChanged()}componentWillUnmount(){Gie.Z.removeListener(this._onMediaStateStoreChanged)}_onMediaStateStoreChanged=()=>{this.setState({mediaState:Gie.Z.getState().get(this.props.page.id)||(0,ze.l4)()})};onClickAudio=(e,t,n)=>{if((0,ms.ZP)(e),n.has("pip"))c.ZP.exitPictureInPicture(this.props.page.id);else{const e=n.has("muting")?"unmute":"mute";c.ZP.setMuting(this.context.vivaldiWindowId,"selection",e,ze.aV.of(t))}};selectPage=e=>{(0,ms.ZP)(e),this.props.selectPage?.(this.props.page)};_renderMediaIcon=(e,t)=>!(0===e.size||t.discarded)&&mce("span",{className:"tab-audio",onMouseDown:n=>this.onClickAudio(n,t,e)},void 0,mce(joe.Z,{animated:C.Z.get(I.kThemeUseAnimation),mediaState:e,src:"tab"}));render(){const{page:e,selected:t,listType:n}=this.props,{active:i}=e,{mediaState:s}=this.state,o=pn.jk.getFavicon(e.url);return(0,ss.jsxs)(ss.Fragment,{children:["minimal"===n&&mce("li",{onContextMenu:ms.ZP,onMouseDown:this.selectPage,className:Fi()({"visual-list":!0,selected:t,"active-page":i})},void 0,mce(Ri.ZP,{className:"visual-tab-list-favicon",url:o||e.url,loadType:o?"faviconFromCache":"page"}),this._renderMediaIcon(s,e),pn.jk.getDisplayTitle(e)),"visual"===n&&mce("div",{className:"visual-tab-switcher-title"},void 0,this._renderMediaIcon(s,e),pn.jk.getDisplayTitle(e))]})}}const yce=(0,Bu.Z)(vce,fce);var bce,Sce=n(71193);function wce(e,t,n,i){bce||(bce="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:bce,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Cce=212;class Ace extends Li.PureComponent{static contextType=ts.Z;constructor(e,t){super(e),this.pages=(0,Sce.Z)(t.vivaldiWindowId),this.workingPageSet=this.pages.map((e=>({uid:Math.ceil(Math.random()*Math.pow(10,12)),page:e})));const n=this.props.forward?1:-1,i=Ce.ZP.unsafeGetActivePage(t.vivaldiWindowId),s=this.getSelectedPageWithOffset(i,n);this.state={selected:s,offset:n}}getMaxAllowedWidth=()=>this.context.innerWidth-Cce;getNumberOfPreviews=()=>{const{pages:e}=this;if(e.size*Cce<this.getMaxAllowedWidth())return e.size;let t=1;for(;(t+1)*Cce+24<this.getMaxAllowedWidth()&&t<e.size;)t++;return t};getSelectedPageWithOffset=(e,t)=>{const{pages:n}=this;let i=n.indexOf(e)+t;i=(i%n.size+n.size)%n.size;const s=n.get(i);return s||e};cancelEvent=e=>{e.stopPropagation(),e.preventDefault()};navigateWithOffset=e=>{const{document:t}=this.context;this.setState((t=>({selected:this.getSelectedPageWithOffset(t.selected,e),offset:e})),(()=>{const e=t.querySelector(".visual-list.selected");e&&e.scrollIntoViewIfNeeded()}))};selectBack=()=>{this.navigateWithOffset(-1)};selectForward=()=>{this.navigateWithOffset(1)};selectByUid=e=>{const t=this.workingPageSet.find((t=>t.uid===e));t&&this.selectPage(t.page)};selectPage=e=>{this.setState({selected:e})};renderMinimalList=()=>{const{pages:e}=this,{selected:t}=this.state;return wce("div",{className:"tabswitcher list"},void 0,wce("img",{className:Fi()({"visual-list-preview":!0,"active-page":t.active}),src:t.vivExtData.thumbnail,onContextMenu:this.cancelEvent,onMouseDown:()=>this.selectPage(t),title:pn.jk.getDisplayUrlFromMapping(t.url)||pn.jk.getDisplayTitle(t),alt:""}),wce("ul",{className:"listed-tabs"},void 0,e.map((e=>{const n=e.id===t.id;return wce(yce,{selectPage:this.selectPage,listType:"minimal",page:e,selected:n},"visual-tab-list-"+e.id)}))))};renderVisualList=()=>{const{pages:e,workingPageSet:t}=this,{selected:n,offset:i}=this.state,s=this.getNumberOfPreviews(),o=s*Cce+24,a=e.indexOf(this.state.selected);let r=t;if(t.size>s){const e=Math.min(Math.max(a-Math.floor(s/2)+(-1!==i||s%2?0:1),0),t.size-s);r=t.reduce(((t,n,i)=>i>=e&&i<e+s?t.push(n):t),(0,ze.aV)())}return wce("div",{className:"tabswitcher",tabIndex:"1",style:{width:o},onContextMenu:this.cancelEvent},void 0,wce("div",{className:"visual-tabs"},void 0,r.map((e=>{const{page:t,uid:i}=e,{active:s,id:o,url:a}=t,r=pn.jk.getFavicon(t.url);return wce("div",{onMouseDown:this.selectByUid.bind(this,i),style:{backgroundImage:`url('${t.vivExtData.thumbnail??""}')`},title:pn.jk.getDisplayTitle(t),className:Fi()({"visual-tab":!0,selected:o===n.id,"active-page":s})},i,wce("div",{className:"visual-tab-favicon-container"},void 0,wce(Ri.ZP,{className:"visual-tab-favicon",url:r||a,loadType:r?"faviconFromCache":"page"})))}))),wce(yce,{page:n,listType:"visual"}))};render(){return C.Z.get(I.kTabsVisualSwitchListLayout)?this.renderMinimalList():this.renderVisualList()}}const Ice=Ace;var Tce;function Zce(e,t,n,i){Tce||(Tce="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Tce,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Ece=function({windowId:e,workspaceId:t,onClose:n}){const i=GF.Z.getWorkspaceById(t),s=i?.id?GQ.Z.getWorkspaceRules(i.id).length:0,o=i?.name??"",a=Ce.ZP.getWorkspacePages(t).size,r=a>0||s>0;return Zce("div",{className:"dialog-delete-workspace"},void 0,Zce("header",{className:"dialog-header"},void 0,Zce("h1",{className:"dialog-title",id:ra.t},void 0,(0,B.Z)("Delete the “$1” workspace?",[o]))),r&&Zce("div",{className:"dialog-content"},void 0,a>0&&Zce("p",{className:"error"},void 0,(0,B.Z)("Deleting the workspace will close the $1 tab inside it.","Deleting the workspace will close the $1 tabs inside it.",[a])),a>0&&s>0&&Zce("p",{className:"error"},void 0,(0,B.Z)("It will also delete the $1 link route associated with it.","It will also delete the $1 link routes associated with it.",[s])),0===a&&s>0&&Zce("p",{className:"error"},void 0,(0,B.Z)("Deleting the workspace will delete the $1 link route associated with it.","Deleting the workspace will delete the $1 link routes associated with it.",[s]))),Zce("footer",{className:"dialog-footer"},void 0,Zce("input",{type:"button",className:"danger",value:(0,B.Z)("verb","Delete"),onClick:async()=>{await CQ.Z.removeWorkspace(e,t),n()}}),Zce("input",{type:"button",value:(0,B.Z)("Cancel"),autoFocus:!0,onClick:n})))};var kce;function _ce(e,t,n,i){kce||(kce="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:kce,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class Nce extends Li.Component{static contextType=ts.Z;refVisualTabSwitcher=Li.createRef();handleClose=e=>{const{dialog:t,onClose:n}=this.props;return e!==t?Promise.resolve():n()};render(){const{dialog:e,options:t}=this.props;let n,i,s="float",o=!1;switch(e){case"MAIN_SHOW_TAB_CYCLER":s="modal-tabswitcher",i=(0,B.Z)("dialog-title","Tabs");break;case"MAIN_SHOW_QUICKCOMMANDS":s="qc-modal float top no-fade-background",i=(0,B.Z)("Quick Command Prompt");break;case"MAIN_SHOW_KEYBOARDS_SHORTCUTS":s="show-keyboard-shortcuts-modal-top float top no-fade-background",n=ra.t;break;case"MAIN_SHOW_PAGE_ACCESS_KEYS":s="page-access-keys",n=ra.t;break;case"MAIN_SHOW_MAIL_ACCOUNT_DIALOG":s="onboarding",i=(0,B.Z)("Mail Account Wizard");break;case"MAIN_SHOW_CALENDAR_ACCOUNT_DIALOG":s="onboarding",i=(0,B.Z)("Calendar Account Wizard");break;case"MAIN_SHOW_CALENDAR_EDIT_EVENT":s="calendar-new",i=(0,B.Z)("New Event");break;case"MAIN_SHOW_CALENDAR_EDIT_TEMPLATE":s="calendar-new",i=(0,B.Z)("Edit Template");break;case"MAIN_SHOW_CREATE_CALENDAR_DIALOG":case"MAIN_SHOW_CALENDAR_IMPORT_EVENTS_DIALOG":s="calendar-new",n=ra.t;break;case"MAIN_SHOW_ACCOUNT_SHEET":s="slide",i=(0,B.Z)("title","Browser Accounts");break;case"MAIN_SHOW_CALENDAR_ALARM":s=t.fullscreen?"calendar-fullscreen-alarm":"calendar-alarm",n=ra.t;break;case"MAIN_SHOW_WORKSPACE_DIALOG":s="workspace-new float no-fade-background",n=ra.t;break;case"MAIN_SHOW_LABEL_FLAG_DIALOG":s="float MailLabelFlagDlg",o=!0;break;case"MAIN_SHOW_DELETE_WORKSPACE":case"MAIN_SHOW_ADD_FEED":case"MAIN_SHOW_MAIL_AUTHENTICATION_DIALOG":case"MAIN_SHOW_MAIL_DELETE_DIALOG_ACCOUNTS":case"MAIN_SHOW_MAIL_DELETE_DIALOG_CONFIRM_ALL":case"MAIN_SHOW_MAIL_DELETE_DIALOG_FOLDERS":case"MAIN_SHOW_MAIL_DELETE_DIALOG_SETTING":case"MAIN_SHOW_MAIL_UNSUBSCRIBE_DIALOG":case"MAIN_SHOW_ADD_MAIL_FOLDER":case"MAIN_SHOW_DELETE_MAIL_FOLDER":case"MAIN_SHOW_ADD_FEED_FOLDER":case"MAIN_SHOW_DELETE_FEED_FOLDER":n=ra.t;break;case"MAIN_SHOW_NOTE_SELECTION_DIALOG":s="note-selection-dialog",n=ra.t;break;case"MAIN_SHOW_MODAL_DIALOG":case"MAIN_SHOW_CREATE_LABEL":case"MAIN_SHOW_MODAL_INFO":case"MAIN_SHOW_DELETE_LABEL_CONFIRMATION":case"MAIN_SHOW_DELETE_FILTER_CONFIRMATION":case"MAIN_SHOW_DELETE_FEED_CONFIRMATION":case"MAIN_SHOW_MAIL_VIEW_FILTER_CONFIRMATION":case"MAIN_SHOW_MAIL_UPLOAD_CONFIRMATION":case"MAIN_SHOW_MAIL_MESSAGE_MOVE_CONFIRMATION":case"MAIN_SHOW_MAIL_CREATE_ARCHIVE_FOLDER_CONFIRMATION":case"MAIN_SHOW_ENABLE_WORKSPACE_DIALOG":case"MAIN_SHOW_ENABLE_SESSION_AUTOSAVE_DIALOG":case"MAIN_SHOW_INCLUDE_WORKSPACE_DIALOG":case"MAIN_SHOW_TOOLBAR_RESET":o=!0}return _ce(Lu,{level:"tabs"},void 0,_ce(ra.Z,{onRequestClose:this.handleClose.bind(this,e),className:s,ignoreClickOutside:"MAIN_SHOW_CALENDAR_ALARM"===e,labelledBy:n,label:i,a11yIgnored:o},void 0,"MAIN_SHOW_QUICKCOMMANDS"===e&&_ce(lce,{onClose:this.handleClose.bind(this,e),quickCommandValue:this.props.quickCommandValue,storeQuickCommandValue:this.props.storeQuickCommandSearch},"MAIN_SHOW_QUICKCOMMANDS"),"MAIN_SHOW_KEYBOARDS_SHORTCUTS"===e&&_ce(hce,{onClose:this.handleClose.bind(this,e)},"MAIN_SHOW_KEYBOARDS_SHORTCUTS"),"MAIN_SHOW_PAGE_ACCESS_KEYS"===e&&_ce(gde,{onClose:this.handleClose.bind(this,e)},"MAIN_SHOW_PAGE_ACCESS_KEYS"),"MAIN_SHOW_TAB_CYCLER"===e&&(0,ss.jsx)(Ice,{ref:this.refVisualTabSwitcher,forward:t.forward},"MAIN_SHOW_TAB_CYCLER"),"MAIN_SHOW_CALENDAR_ALARM"===e&&_ce(Jre,{onClose:this.handleClose.bind(this,e),windowToRestore:t.windowToRestore},"MAIN_SHOW_CALENDAR_ALARM"),"MAIN_SHOW_CALENDAR_EDIT_EVENT"===e&&_ce(Nre,{event:t.event,onClose:this.handleClose.bind(this,e)}),"MAIN_SHOW_CALENDAR_EDIT_TEMPLATE"===e&&(0,ss.jsx)(Ore,{...t,onClose:this.handleClose.bind(this,e)}),"MAIN_SHOW_CALENDAR_IMPORT_EVENTS_DIALOG"===e&&_ce(Lre,{windowId:this.context.vivaldiWindowId,filePath:t.uri,onClose:this.handleClose.bind(this,e)}),"MAIN_SHOW_CREATE_CALENDAR_DIALOG"===e&&_ce(yle,{windowId:this.context.vivaldiWindowId,onClose:this.handleClose.bind(this,e)}),"MAIN_SHOW_MAIL_AUTHENTICATION_DIALOG"===e&&_ce(Hle,{onClose:this.handleClose.bind(this,e),options:t}),"MAIN_SHOW_MAIL_DELETE_DIALOG_ACCOUNTS"===e&&_ce(Yle,{windowId:this.context.vivaldiWindowId,onClose:this.handleClose.bind(this,e),options:t}),"MAIN_SHOW_MAIL_DELETE_DIALOG_CONFIRM_ALL"===e&&_ce(Xle,{windowId:this.context.vivaldiWindowId,onClose:this.handleClose.bind(this,e),options:t}),"MAIN_SHOW_MAIL_DELETE_DIALOG_FOLDERS"===e&&_ce(Qle,{windowId:this.context.vivaldiWindowId,onClose:this.handleClose.bind(this,e),options:t}),"MAIN_SHOW_MAIL_DELETE_DIALOG_SETTING"===e&&_ce(qle,{windowId:this.context.vivaldiWindowId,onClose:this.handleClose.bind(this,e),options:t}),"MAIN_SHOW_MAIL_UNSUBSCRIBE_DIALOG"===e&&_ce(ade,{onClose:this.handleClose.bind(this,e),options:t}),"MAIN_SHOW_MODAL_DIALOG"===e&&_ce(Fre,{onClose:this.handleClose.bind(this,e),modal:t.modal,resolve:t.resolve}),"MAIN_SHOW_MODAL_INFO"===e&&_ce(FT,{onClose:t=>{this.handleClose(e)},title:t.title,prompt:[t.body],positive:(0,B.Z)("Close"),hideNegative:!0,preventInnerModal:!0}),"MAIN_SHOW_ADD_FEED"===e&&_ce(vd,{onClose:this.handleClose.bind(this,e),options:t,dismissable:!0},e),"MAIN_SHOW_ADD_MAIL_FOLDER"===e&&_ce(Are,{onClose:this.handleClose.bind(this,e),options:t,dismissable:!0},e),"MAIN_SHOW_ADD_FEED_FOLDER"===e&&_ce(bre,{onClose:this.handleClose.bind(this,e),options:t,dismissable:!0},e),"MAIN_SHOW_CREATE_LABEL"===e&&_ce(Yf,{windowId:this.context.vivaldiWindowId,onClose:this.handleClose.bind(this,e),viewMode:"float"},e),"MAIN_SHOW_LABEL_FLAG_DIALOG"===e&&_ce(nde,{windowId:this.context.vivaldiWindowId,onClose:this.handleClose.bind(this,e),viewMode:"float"},e),"MAIN_SHOW_DELETE_MAIL_FOLDER"===e&&_ce(Zle,{onClose:this.handleClose.bind(this,e),options:t,dismissable:!0},e),"MAIN_SHOW_DELETE_FEED_FOLDER"===e&&_ce(Cle,{onClose:this.handleClose.bind(this,e),options:t,dismissable:!0},e),"MAIN_SHOW_DELETE_WORKSPACE"===e&&_ce(Ece,{windowId:this.context.vivaldiWindowId,workspaceId:t.workspaceId,onClose:this.handleClose.bind(this,e)},e),"MAIN_SHOW_DELETE_LABEL_CONFIRMATION"===e&&lle({dialog:e,handleClose:this.handleClose,label:t.label,callback:t.callback}),"MAIN_SHOW_DELETE_FILTER_CONFIRMATION"===e&&ole({dialog:e,handleClose:this.handleClose,label:t.label,callback:t.callback}),"MAIN_SHOW_DELETE_FEED_CONFIRMATION"===e&&nle({dialog:e,handleClose:this.handleClose,label:t.label,callback:t.callback}),"MAIN_SHOW_MAIL_VIEW_FILTER_CONFIRMATION"===e&&gle({dialog:e,handleClose:this.handleClose,label:t.label,callback:t.callback}),"MAIN_SHOW_MAIL_UPLOAD_CONFIRMATION"===e&&ule({dialog:e,handleClose:this.handleClose,accountId:t.accountId,callback:t.callback}),"MAIN_SHOW_MAIL_MESSAGE_MOVE_CONFIRMATION"===e&&_ce(FT,{onClose:n=>{t.callback(n),this.handleClose(e)},title:t.title,prompt:[t.body],positive:(0,B.Z)("Move All Messages"),negative:(0,B.Z)("Cancel"),danger:!0,preventInnerModal:!0}),"MAIN_SHOW_MAIL_CREATE_ARCHIVE_FOLDER_CONFIRMATION"===e&&_ce(FT,{onClose:n=>{t.callback(n),this.handleClose(e)},title:t.title,prompt:[t.body],positive:(0,B.Z)("Create Archive Folder"),negative:(0,B.Z)("Cancel"),preventInnerModal:!0}),"MAIN_SHOW_TOOLBAR_RESET"===e&&_ce(FT,{onClose:n=>{t.callback(n),this.handleClose(e)},title:t.title,prompt:[t.body],positive:(0,B.Z)("Reset Toolbar"),negative:(0,B.Z)("Cancel"),preventInnerModal:!0}),"MAIN_SHOW_ACCOUNT_SHEET"===e&&_ce(zj,{onClose:this.handleClose.bind(this,e),view:t,autoFocus:!0},e),"MAIN_SHOW_MAIL_ACCOUNT_DIALOG"===e&&_ce(Fle,{onClose:this.handleClose.bind(this,e)},e),"MAIN_SHOW_CALENDAR_ACCOUNT_DIALOG"===e&&_ce(Ere,{windowId:this.context.vivaldiWindowId,onClose:this.handleClose.bind(this,e)},e),"MAIN_SHOW_WORKSPACE_DIALOG"===e&&_ce(EQ,{windowId:this.context.vivaldiWindowId,onClose:this.handleClose.bind(this,e),createInBackground:t.createInBackground,withPages:t.withPages}),"MAIN_SHOW_NOTE_SELECTION_DIALOG"===e&&_ce(dde,{windowId:this.context.vivaldiWindowId,onClose:()=>this.handleClose(e),onSelected:t.onSelected}),"MAIN_SHOW_ENABLE_WORKSPACE_DIALOG"===e&&_ce(Ole,{options:t,onClose:()=>this.handleClose(e)}),"MAIN_SHOW_ENABLE_SESSION_AUTOSAVE_DIALOG"===e&&_ce(Dle,{options:t,onClose:()=>this.handleClose(e)}),"MAIN_SHOW_INCLUDE_WORKSPACE_DIALOG"===e&&_ce(Lle,{options:t,onClose:()=>this.handleClose(e)})))}}const Pce=Nce;var Dce,Mce=n(18237),Oce=n(14022);function xce(e,t,n,i){Dce||(Dce="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Dce,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class Lce extends Li.PureComponent{static contextType=ts.Z;state={dummy:!1};onHistoryClicked=e=>{e.stopPropagation(),this.props.onToggleHistory(this.props.node.id)};render(){const{node:e}=this.props,t=Mce.ZP.isTrashFolder(e.id),n="history"===e.type,i=Mce.ZP.isHistoryParent(e.id);return xce("div",{style:{minHeight:`${this.props.height}px`},className:"SessionItem-Wrapper",title:Oce.Z.getTooltipString(e)},void 0,!t&&!n&&(0,ss.jsxs)(ss.Fragment,{children:[xce("div",{className:"SessionItem-Entry"},void 0,void 0!==this.props.inlineEditText?xce("input",{type:"text",value:this.props.inlineEditText,onChange:this.props.onChange,onFocus:this.props.onFocus,onBlur:this.props.onBlur,autoFocus:!0}):xce("div",{className:"SessionItem-Title"},void 0,Oce.Z.getNameString(e)),xce("div",{className:"SessionItem-Info"},void 0,Oce.Z.getContentString(e)),xce("div",{className:"SessionItem-Date"},void 0,Oce.Z.getDateModifyString(e))),i&&xce("button",{type:"button",className:"ActionButton",onClick:this.onHistoryClicked,title:(0,B.Z)("Show history"),tabIndex:"-1",dangerouslySetInnerHTML:{__html:Wi.yaZ.small}})]}),!t&&n&&xce("div",{className:"SessionItem-Entry"},void 0,xce("div",{className:"SessionItem-Info"},void 0,Oce.Z.getContentString(e)),xce("div",{className:"SessionItem-Date"},void 0,Oce.Z.getDateModifyString(e))),t&&void 0===this.props.inlineEditText&&xce("span",{className:"SessionItem-Title"},void 0,Oce.Z.getNameString(e)))}}const Rce=Lce;var Bce;function Fce(e,t,n,i){Bce||(Bce="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Bce,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function Wce(e,t){const n=function(e,i){const s={id:e.id,containerId:e.containerId,type:e.type,name:e.name,createDateJS:e.createDateJS,modifyDateJS:e.modifyDateJS,windows:e.windows,tabs:e.tabs,quarantined:e.quarantined,workspaces:e.workspaces,parentId:e.parentId,index:i};if(e.children){if(!t&&"folder"===e.type)return;s.children=e.children.map(((e,t)=>n(e,t))).filter(Boolean)}return s},i=Mce.ZP.getFiltered(e).map(((e,t)=>n(e,t))).filter(Boolean);return 1===i.length&&Mce.ZP.isTrashFolder(i[0].id)&&!i[0].children?.length?[]:i}class Uce extends Li.PureComponent{static contextType=ts.Z;refTreeList=Li.createRef();id=crypto.randomUUID();checkSelection=!0;historyIds=[];constructor(e){super(e),this.state={nodes:Wce(e.filter,e.showFolders)}}componentDidMount(){Mce.ZP.addListener(this.onStoreChanged),Mce.ZP.hasSessions()&&this.focusTree(),this.setInitialSelection(),this.reportContentCount()}componentWillUnmount(){Mce.ZP.removeListener(this.onStoreChanged)}componentDidUpdate(e){this.props.filter!==e.filter&&this.setState({nodes:Wce(this.props.filter,this.props.showFolders)},(()=>this.reportContentCount()))}onStoreChanged=e=>{switch(e.reason){case"init":this.setState({nodes:Wce(this.props.filter,this.props.showFolders)},(()=>this.setInitialSelection()));break;case"added":this.setState({nodes:Wce(this.props.filter,this.props.showFolders)},(()=>{e.info&&e.owner===this.id?this.selectById(e.info.item.id):this.setInitialSelection(),this.reportContentCount()}));break;case"changed":case"moved":this.setState({nodes:Wce(this.props.filter,this.props.showFolders)});break;case"deleted":this.setState({nodes:Wce(this.props.filter,this.props.showFolders)},(()=>{this.state.nodes.length||(this.checkSelection=!0),this.reportContentCount()}))}};setInitialSelection=()=>{this.checkSelection&&this.state.nodes.length>0&&(0===this.getSelected().length&&(this.refTreeList.current?.setSelectedIds([this.state.nodes[0].id]),this.reportSelectionState()),this.checkSelection=!1)};reportContentCount=()=>{this.props.onContentCount&&this.props.onContentCount(this.state.nodes.length)};reportSelectionState=()=>{this.props.onSelectionState&&this.props.onSelectionState(this.getSelected().length>0)};getNodeById=e=>{const t=function(n){for(let i=0;i<n.length;i++){const s=n[i];if(s.id===e)return s;if(s.children){const e=t(s.children);if(e)return e}}};return t(this.state.nodes)};isPanel=()=>!this.props.columns;focusTree=()=>{this.refTreeList.current?.focusTree()};isFolder=e=>"folder"===e.type||this.isHistoryParent(e);isTrashFolder=e=>Mce.ZP.isTrashFolder(e.id);isHistoryParent=e=>"node"===e.type&&Boolean(e.children);isHistoryChild=e=>"history"===e.type;canMoveUpDown=(e,t)=>!this.isTrashFolder(e)&&!this.isHistoryChild(e);hasChildren=e=>this.isFolder(e)&&Boolean(e.children?.length);hasHistoryId=e=>-1!==e.containerId;isValidForEdit=e=>!Mce.ZP.isTrash(e,!0)&&!Mce.ZP.isHistoryChild(e);allowDoubleClick=e=>!this.isFolder(e)||this.isHistoryParent(e);isValidDragSource=e=>!this.isTrashFolder(e);validateForDeletion=e=>e.filter((e=>!Mce.ZP.isTrashFolder(e))).map((e=>this.getNodeById(e))).filter(Boolean).map((e=>e.id));validateForDrag=e=>{const t=e.filter((e=>!Mce.ZP.isTrashFolder(e))).map((e=>this.getNodeById(e))).filter(Boolean),n=t.some((e=>this.hasHistoryId(e))),i=t.some((e=>!this.hasHistoryId(e)));return n&&i||n&&t.some((e=>-1===e.containerId||e.containerId!==t[0].containerId))?[]:t.map((e=>e.id))};getDragData=(e,t)=>{const n=t.map((e=>this.getNodeById(e))).filter(Boolean);switch(e){case"text/plain":case"vivaldi/x-title":{const e=[];return n.forEach((t=>{e.push(t.name)})),e.join("\r\n")}default:return""}};setEventBehavior=(e,t)=>{const n=t.map((e=>this.getNodeById(e))).filter(Boolean);n.some((e=>this.hasHistoryId(e)))?(this.historyIds=n.map((e=>e.containerId)),e.dataTransfer.setData(Mce.iq,JSON.stringify(n.map((e=>e.id))))):(this.historyIds=[],e.dataTransfer.setData(Mce.m8,JSON.stringify(n.map((e=>e.id)))))};getDropSupport=(e,t)=>{let n={available:!1,onto:!1,edge:"both"};return this.isHistoryParent(e)&&t.dataTransfer.types.some((e=>e===Mce.iq))?this.historyIds.some((t=>t!==e.id))?n:{available:!0,onto:!0,edge:"none"}:this.isHistoryChild(e)?t.dataTransfer.types.some((e=>e===Mce.iq))?this.historyIds.some((t=>t!==e.containerId))?n:{available:!0,onto:!1,edge:"both"}:n:t.dataTransfer.types.some((e=>e===Mce.iq))?(this.isTrashFolder(e)?n={available:!0,onto:!0,edge:"none"}:Mce.ZP.isTrash(e.id,!1)?n={available:!0,onto:!1,edge:"both"}:this.historyIds.some((t=>t===e.id))&&(n={available:!0,onto:!0,edge:"none"}),n):(this.isHistoryParent(e)&&this.refTreeList.current?.isExpanded(e.id)&&(n.edge="above"),n.available=t.dataTransfer.types.some((e=>e===Mce.m8)),n.available&&(n.onto=this.isFolder(e)&&!this.isHistoryParent(e)),n)};getTargetSpec=(e,t)=>{const n={index:0,parentId:void 0,pageIndex:void 0};switch(t){case"above":n.index=parseInt(e.index),n.parentId=e.parentId;break;case"on":n.parentId=e.id;break;case"below":this.refTreeList.current&&this.refTreeList.current.isExpanded(e.id)?n.parentId=e.id:(n.index=parseInt(e.index)+1,n.parentId=e.parentId)}return n};handleExpandClick=(e,t)=>{const n=e.altKey;this.refTreeList.current?.toggleSelectedExpansion(t,n)};onMove=(e,t)=>void 0!==t.parentId?li.Z.move(e,t.parentId,t.index??0):Promise.resolve([]);getMenuCapability=async(e,t,n)=>{const i=this.context.vivaldiWindowId,s=this.refTreeList.current?.getSelectedCount()??0;switch(e.action){case"CONTEXT_OPEN_IN_NEW_WINDOW":return{handler:()=>this.onOpen(!0),isVisible:()=>s>0&&!Mce.ZP.isTrash(n.id,!0),...t(i,e,{})};case"CONTEXT_OPEN":return{handler:()=>this.onOpen(!1),isVisible:()=>s>0&&!he.ZP.isIncognito(this.context.vivaldiWindowId)&&!Mce.ZP.isTrash(n.id,!0),...t(i,e,{})};case"CONTEXT_UPDATE":return{handler:()=>{const e=this.getSelected().map((e=>e.id));1===e.length&&this.onUpdate(e[0])},isVisible:()=>1===s&&!Mce.ZP.isTrash(n.id,!0)&&!Mce.ZP.isAutoSaveNode(n.id)&&!Mce.ZP.isHistoryChild(n.id),...t(i,e,{})};case"CONTEXT_RESTORE":return{handler:()=>li.Z.restore(this.getSelected().map((e=>e.id))),isVisible:()=>Mce.ZP.isTrash(n.id,!1)&&!Mce.ZP.isTrashFolder(n.id),...t(i,e,{})};case"CONTEXT_EMPTY_TRASH":return{handler:()=>{li.Z.emptyTrash()},isVisible:()=>Mce.ZP.isTrashFolder(n.id),...t(i,e,{})};case"CONTEXT_DUPLICATE":return{handler:()=>{li.Z.duplicate(n.id,Mce.ZP.getRootId(),0,this.id)},isVisible:()=>Mce.ZP.isHistoryChild(n.id),...t(i,e,{})};case"CONTEXT_MOVE_TO_TOP":return{handler:()=>{const e=this.getSelected().map((e=>e.id));1===e.length&&li.Z.makeContainer(e[0]).then((()=>{this.refTreeList.current?.setSelectedIds([n.parentId])}))},isVisible:()=>1===s&&this.isHistoryChild(n),...t(i,e,{})};case"CONTEXT_AUTOMATIC_BACKUP":return{handler:()=>{"on"===C.Z.get(I.kSessionsSaveOnExit)?w.Z.set(I.kSessionsSaveOnExit,"off"):de.Z.showEnableSessionAutosaveDialog(i,{mode:"size"})},checked:"on"===C.Z.get(I.kSessionsSaveOnExit),...t(i,e,{})};case"CONTEXT_AUTOSAVE_SIZE":return{handler:()=>{},isVisible:()=>!1,...t(i,e,{})};case"CONTEXT_HISTORY":return{handler:()=>{this.refTreeList.current?.toggleSelectedExpansion(n.id,!1)},isVisible:()=>this.isHistoryParent(n),checked:Boolean(this.refTreeList.current?.isExpanded(n.id)),...t(i,e,{})};default:return{...t(i,e,{})}}};getMenuVisibility=(e,t)=>{const n=this.refTreeList.current?.getSelectedCount()??0;switch(e.action){case"CONTEXT_NEW_ITEM":return!Mce.ZP.isTrash(t.id,!0);case"CONTEXT_RENAME":return 1===n&&this.isValidForEdit(t.id);case"CONTEXT_EDIT":return 1===n&&!this.isTrashFolder(t);case"CONTEXT_DELETE":return n>0&&!Mce.ZP.isTrashFolder(t.id)}return!0};getSelected=()=>(this.refTreeList.current?.getAllSelectedItems()??[]).map((e=>this.getNodeById(e.id))).filter(Boolean);selectById=e=>{this.refTreeList.current?.selectById(e)};onKeyDown=e=>{"Enter"===OM.Z[e.keyCode]&&this.onOpen(!!this.isPanel()||void 0),("Escape"===OM.Z[e.keyCode]||"."===OM.Z[e.keyCode]&&e.metaKey)&&this.props.onClose&&this.props.onClose(),"Up"!==OM.Z[e.keyCode]&&"Down"!==OM.Z[e.keyCode]||this.reportSelectionState()};add=()=>{this.refTreeList.current?.onAdd("item")};onCreate=async(e,t,n,i)=>new Promise((e=>{de.Z.showSaveSessionDialog(this.context.vivaldiWindowId,{mode:"all",parentId:t??-1,index:n??-1,owner:this.id,onClose:t=>{e()}})}));onUpdate=async e=>new Promise((t=>{de.Z.showSaveSessionDialog(this.context.vivaldiWindowId,{mode:"all",updateId:e,onClose:e=>{t()}})}));onEdit=()=>{const e=this.getSelected().map((e=>e.id));1===e.length&&this.props.onEdit&&this.props.onEdit(e[0])};deleteSelected=()=>this.refTreeList.current?.onDelete()||Promise.reject();onDelete=e=>li.Z.remove(e);onOpen=e=>{const t=this.getSelected().filter((e=>!Mce.ZP.isTrash(e.id,!1))).map((e=>e.id));this.props.onOpen(t)};getRowHeight=e=>this.getRowHeightById(this.refTreeList.current?.getId(e.index)??-1);getRowHeightById=e=>Mce.ZP.isTrashFolder(e)?Zs():Mce.ZP.isHistoryChild(e)?46:70;getRowComponentProps=e=>({...e,columns:this.props.columns??[]});rowComponent=e=>{const t=e.node,n=Mce.ZP.isTrashFolder(t.id),i=Mce.ZP.isTrash(t.id,!1),s=this.hasHistoryId(t),o=e.level,a=(o+1)*ks+"px",r=o*ks+"px";return this.isPanel()?Fce("div",{className:Fi()("SessionItem",{"SessionItem-Trash":n,"SessionItem-Trashed":i})},t.id,n&&this.hasChildren(t)&&Fce("span",{className:"expand-icon",style:{marginLeft:r},onMouseUp:e=>this.handleExpandClick(e,t.id),dangerouslySetInnerHTML:{__html:Wi.nfH}}),n&&Fce(Ki,{trash:!0,open:e.isExpanded,leftMargin:this.hasChildren(t)?0:a}),(i||s)&&Fce("span",{style:{marginLeft:r},className:"tree-icon"}),Fce(Rce,{node:t,height:this.getRowHeightById(t.id),inlineEditText:e.inlineEditText,onChange:e.onChange,onFocus:e.onFocus,onBlur:e.onBlur,onToggleHistory:e=>{this.refTreeList.current?.toggleSelectedExpansion(e,!1)}})):n?null:(this.props.columns??[]).map((e=>{switch(e.id){case"name":return Fce("label",{},"0",Fce("span",{},void 0,Oce.Z.getNameString(t)));case"createDateJS":return Fce("label",{},"1",Fce("span",{},void 0,Oce.Z.getDateCreateString(t)));case"modifyDateJS":return Fce("label",{},"2",Fce("span",{},void 0,Oce.Z.getDateModifyString(t)));case"tabs":return Fce("label",{},"3",Fce("span",{},void 0,Oce.Z.getContentString(t)));default:console.warn("Unknown sorting field:",e.id)}})).filter(Boolean)};onItemDoubleClick=()=>this.onOpen(!!this.isPanel()||void 0);onItemsActivated=()=>this.onOpen(!!this.isPanel()||void 0);menu={name:"sessionlist",getCapability:this.getMenuCapability,getVisibility:this.getMenuVisibility};render(){return(0,ss.jsx)(Ps,{ref:this.refTreeList,rootId:Mce.ZP.getRootId(),nodes:this.state.nodes,settings:this.isPanel()?"SETTINGS_TREE":void 0,rowComponent:this.rowComponent,getRowComponentProps:this.getRowComponentProps,overrideDoubleClick:this.allowDoubleClick,onItemMouseDown:this.reportSelectionState,onItemDoubleClick:this.onItemDoubleClick,onItemsActivated:this.onItemsActivated,onMove:this.onMove,onKeyDown:this.onKeyDown,onCreate:this.onCreate,onEdit:this.onEdit,delete:this.isPanel()?this.onDelete:void 0,isFolder:this.isFolder,isTrashFolder:this.isTrashFolder,hasChildren:this.hasChildren,supportsUpDownMove:this.canMoveUpDown,getTitle:Mce.ZP.getTitle,saveTitle:li.Z.setTitle,disableClipboard:!0,isValidToEdit:this.isValidForEdit,isValidDragSource:this.isValidDragSource,validateForDeletion:this.validateForDeletion,validateForDrag:this.validateForDrag,mimeType:Mce.m8,setCustomEventBehavior:this.setEventBehavior,getDragData:this.getDragData,getDropSupport:this.getDropSupport,getTargetSpec:this.getTargetSpec,menu:this.isPanel()?this.menu:void 0,supportsInlineEdit:!0,sorting:this.props.sorting,columns:this.props.columns,rowHeight:this.isPanel()?this.getRowHeight:void 0})}}const Vce=Uce;var Hce;function Gce(e,t,n,i){Hce||(Hce="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Hce,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const $ce=[I.kSessionsDialogSorting,I.kKeyboardTabToAll],Kce={width:800,minWidth:"unset"},zce=[{text:(0,B.Z)("title","Name"),value:"name",fullScreenTitle:(0,B.Z)("Sort by Name"),width:350,visible:!0,key:!0},{text:(0,B.Z)("Creation Date"),value:"createDateJS",fullScreenTitle:(0,B.Z)("Sort by Creation Date"),width:260,visible:!0},{text:(0,B.Z)("Modified Date"),value:"modifyDateJS",fullScreenTitle:(0,B.Z)("Sort by Modifcation Date"),width:260,visible:!1},{text:(0,B.Z)("Info"),value:"tabs",fullScreenTitle:(0,B.Z)("Sort by Info"),width:150,visible:!0}];class jce extends Li.Component{static contextType=ts.Z;refSessionTree=Li.createRef();constructor(e){super(e);const t=this.props.prefValues[I.kSessionsDialogSorting];this.state={columns:vs().sessions||ys(zce),hasSelection:!1,hasContent:!0,sorting:{sortOrder:t.sortOrder,sortField:t.sortField,comparator:this.sortComparator}}}sortComparator=(e,t)=>{const{sortOrder:n,sortField:i}=this.state.sorting;return ds.Z.getDefaultComparator(n,i)(e,t)};getSelected=()=>this.refSessionTree.current?.getSelected()??[];onContentCount=e=>{this.setState({hasContent:e>0})};onSelectionState=e=>{this.setState({hasSelection:e})};onDelete=()=>{li.Z.remove(this.getSelected().map((e=>e.id)))};onOpen=e=>{li.Z.open(this.context.vivaldiWindowId,e,!0),this.props.onClose()};onSortChange=(e,t)=>{this.setState((n=>({sorting:{sortOrder:e,sortField:t,comparator:n.sorting.comparator}}))),w.Z.set(I.kSessionsDialogSorting,{sortOrder:e,sortField:t})};onUpdateRow=e=>{this.setState({columns:e})};onSaveRow=()=>{fs(this.state.columns,"sessions")};render(){return Gce(ra.Z,{onRequestClose:this.props.onClose,style:Kce,title:(0,B.Z)("Open Session")},void 0,Gce("div",{className:"open-session"},void 0,Gce("form",{className:"dialog-session",onSubmit:()=>{this.onOpen(this.getSelected().map((e=>e.id)))}},void 0,Gce("div",{className:"dialog-content"},void 0,this.state.hasContent?Gce("div",{className:"session-list"},void 0,Gce(Mm,{fields:zce,fullsize:!0,onSortChange:this.onSortChange,onSaveRow:this.onSaveRow,onUpdateRow:this.onUpdateRow,columns:this.state.columns,sortField:this.state.sorting.sortField,sortOrder:this.state.sorting.sortOrder,keyAccess:this.props.prefValues[I.kKeyboardTabToAll],manualSorting:!1}),(0,ss.jsx)(Vce,{ref:this.refSessionTree,filter:"",showFolders:!1,columns:this.state.columns,sorting:this.state.sorting,onOpen:this.onOpen,onClose:this.props.onClose,onContentCount:this.onContentCount,onSelectionState:this.onSelectionState})):Gce("div",{},void 0,(0,B.Z)("No saved session."))),Gce("footer",{className:"dialog-footer"},void 0,Gce("input",{type:"submit",disabled:!this.state.hasSelection,value:(0,B.Z)("session","Open")}),Gce("input",{type:"button",onClick:this.props.onClose,value:(0,B.Z)("session","Cancel")})))))}}const Yce=(0,Bu.Z)(jce,$ce);var Xce,Qce=n(34155);function qce(e,t,n,i){Xce||(Xce="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Xce,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Jce=[I.kBookmarksPanelEditorHeight],eue=[{text:(0,B.Z)("Title"),value:"title",fullScreenTitle:(0,B.Z)("Sort by Title")},{text:(0,B.Z)("Address"),value:"url",fullScreenTitle:(0,B.Z)("Sort by Address")},{text:(0,B.Z)("Nickname"),value:"nickname",fullScreenTitle:(0,B.Z)("Sort by Nickname")},{text:(0,B.Z)("Description"),value:"description",fullScreenTitle:(0,B.Z)("Sort by Description")},{text:(0,B.Z)("Created"),value:"dateAdded",fullScreenTitle:(0,B.Z)("Sort by Date Created")}];class tue extends Li.PureComponent{static contextType=ts.Z;nodeRef=Li.createRef();#Rn=Li.createRef();#Bn=Li.createRef();state={filter:"",editorHeight:this.props.prefValues[I.kBookmarksPanelEditorHeight],failedUpgrade:!1,sorting:{sortOrder:ds.Z.NO_SORTING,sortField:"manually",comparator:this.sortComparator},hasBookmark:!0};componentDidMount(){const e=C.Z.get(I.kBookmarksPanelSorting);this.onSortChange(e.sortOrder,e.sortField),Yn.ZP.addListener(this.onPanelStoreChange),g.Z.addListener(this.onBookmarkStoreChange)}componentWillUnmount(){Yn.ZP.removeListener(this.onPanelStoreChange),g.Z.removeListener(this.onBookmarkStoreChange)}componentDidUpdate(e,t){!e.open&&this.props.open&&Qce.nextTick((()=>this.focusTree()))}hasFocus=()=>{const{document:e,HTMLElement:t}=this.context,n=this.nodeRef.current;return n instanceof t&&(0,Ra.sT)(e,n)};onPanelStoreChange=()=>{const e=Yn.ZP.getChangeReason();this.props.open&&"setFocus"===e&&!this.hasFocus()&&this.focusTree()};onBookmarkStoreChange=()=>{this.setState({failedUpgrade:g.Z.isFailedUpgrade()})};onSelect=e=>{this.#Rn.current?.setItem(e)};addBookmark=()=>{this.onAdd(!1)};addFolder=()=>{this.onAdd(!0)};onAdd=e=>{this.state.editorHeight>p.mT&&this.#Rn.current?this.#Rn.current._save().then((()=>this.#Bn.current?.onAdd(e))):this.#Bn.current?.onAdd(e)};onCreate=e=>{e&&this.setState({filter:""},(()=>{this.setEditorVisible(),this.#Rn.current&&this.#Rn.current.setIsCreating(!0),this.onSelect(this.getSelectedItem())}))};onEditorCanceled=(e,t)=>{t&&e&&this.#Bn.current?this.#Bn.current.deleteSelectedItems()?.then((()=>{i.Z.bookmarks.remove(e),this.focusTree()})):this.focusTree()};setEditorVisible=()=>{const e=this.state.editorHeight<230?Math.max(this.props.prefValues[I.kBookmarksPanelEditorHeight],230):this.state.editorHeight;this.updateEditorVisiblityWithHeight(e,!0)};focusTree=()=>{this.#Bn.current?.refTreeList.current?.focusTree()};deleteSelectedItems=()=>{this.#Bn.current?.deleteSelectedItems()};onSortChange=(e,t)=>{const n={sortOrder:e,sortField:t,comparator:this.sortComparator};this.setState({sorting:n});const i={sortOrder:e,sortField:t};w.Z.set(I.kBookmarksPanelSorting,i)};sortComparator=(e,t)=>g.Z.treeSortComparator(e,t,this.state.sorting);getSelectedItem=()=>this.#Bn.current?.getSelectedItem();onContextMenu=e=>{e.nativeEvent.buttons>0&&this.#Bn.current?.unSelectAll(),this.#Bn.current?.onContextMenu(e)};onSearchChange=e=>{this.setState({filter:e.target.value})};onSlidebarPosition=(e,t)=>{this.setState((e=>({editorHeight:Math.max(Math.min(e.editorHeight-t,600),p.mT)})))};onSlideBarStop=()=>{this.updateEditorVisiblityWithHeight(this.state.editorHeight,!0)};onSlidebarToggle=()=>{const e=this.state.editorHeight>p.Cn?p.mT:230;this.updateEditorVisiblityWithHeight(e,!0)};updateEditorVisiblityWithHeight=(e,t)=>{e<p.Cn?e=p.mT:e>600&&(e=600),t&&w.Z.set(I.kBookmarksPanelEditorHeight,e),this.setState({editorHeight:e})};renderEmptyState=()=>qce("div",{className:"panel-empty-state"},void 0,qce("span",{dangerouslySetInnerHTML:{__html:Wi.Zgq}}),qce("h1",{},void 0,(0,B.Z)("Add your first bookmark")),qce("p",{className:"faded-text"},void 0,(0,B.Z)("Click the “+” button to add a new bookmark.")));render(){if(!this.props.open)return null;const e=this.props.title+(this.state.failedUpgrade?" (needs upgrade)":"");return(0,ss.jsxs)("div",{ref:this.nodeRef,className:"panel panel-bookmarks",children:[qce("header",{},void 0,qce(im,{title:e,showCloseButton:this.props.showCloseButton}),qce("div",{className:"toolbar toolbar-default toolbar-wrap",role:"toolbar","aria-label":(0,B.Z)("toolbar label","Bookmarks")},void 0,qce("input",{type:"search",placeholder:(0,B.Z)("verb","Search"),value:this.state.filter,disabled:!this.state.hasBookmark,onChange:this.onSearchChange}),qce("div",{className:"toolbar"},void 0,qce("div",{className:"toolbar-group"},void 0,qce(po.ZP,{onClick:this.addBookmark,tooltip:(0,B.Z)("New Bookmark"),image:Wi.md4.small}),qce(po.ZP,{onClick:this.deleteSelectedItems,tooltip:(0,B.Z)("other","Delete"),image:Wi.M2k.small})),qce(po.ZP,{onClick:this.addFolder,tooltip:(0,B.Z)("command","New Folder"),image:Wi._TQ.small})))),!this.state.hasBookmark&&this.renderEmptyState(),this.state.hasBookmark&&qce(Mm,{fields:eue,onSortChange:this.onSortChange,keyAccess:this.props.keyAccess,sortField:this.state.sorting.sortField,sortOrder:this.state.sorting.sortOrder}),qce("section",{onContextMenu:this.onContextMenu,className:this.state.hasBookmark?"outerScrollbar":"hide-bookmark-tree"},void 0,(0,ss.jsx)(Y3,{ref:this.#Bn,filter:this.state.filter,fullView:!1,inManager:!1,onSelect:this.onSelect,onCreate:this.onCreate,sorting:this.state.sorting,onBookmarksUpdatedIsEmpty:e=>this.setState({hasBookmark:e})})),this.state.hasBookmark&&qce("section",{className:Fi()("panel-bookmarks-edit","limited",{collapsed:this.state.editorHeight===p.mT}),style:{flexBasis:this.state.editorHeight}},void 0,qce(Zm.Z,{onStop:this.onSlideBarStop,onSlidebarPosition:this.onSlidebarPosition,onDoubleClick:this.onSlidebarToggle,returnOffset:!0,position:"bottom"}),this.state.editorHeight>0&&(0,ss.jsx)(N3,{ref:this.#Rn,updateLayout:this.setEditorVisible,getSelectedItem:this.getSelectedItem,onCancel:this.onEditorCanceled,onFocusTree:this.focusTree}))]})}}const nue=(0,Bu.Z)(tue,Jce);var iue;function sue(e,t,n,i){iue||(iue="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:iue,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const oue=function(e){const t=e.date.clone(),n=new Date,i=n.getFullYear(),s=n.getMonth(),o=n.getDate(),a=e.date.year(),r=e.date.month(),l=e.date.week(),d=e.date.date();t.startOf("month").subtract(1,"week").startOf("week");const c=[];for(;c.length<7;){const e=t.format("dd");c.push(sue("div",{className:"MonthDayPicker-DayOfWeek"},e,e)),t.add(1,"day")}const u=e.date.clone().endOf("month");for(;t.isSameOrBefore(u)||0!==t.weekday();){const n=t.date()===o&&t.month()===s&&t.year()===i,u=t.date()===d&&t.month()===r&&t.year()===a,p=t.week()===l&&t.year()===a,h=t.clone();c.push(sue("div",{className:Fi()("MonthDayPicker-Day",{"MonthDayPicker-Day--Current":n,"MonthDayPicker-Day--Selected":u,"MonthDayPicker-Day--SelectedWeek":p&&!u&&!n,"MonthDayPicker-Day--OtherMonth":t.month()!==s}),onClick:()=>bO.Z.selectDate(e.pageId,h)},t.format("M-D"),t.date())),t.add(1,"day")}return sue("div",{className:"MonthDayPicker"},void 0,sue("header",{className:"MonthDayPicker-Header"},void 0,sue("div",{className:"toolbar-group"},void 0,sue(po.ZP,{className:"button-narrow button-transparent",onClick:()=>function(e,t){bO.Z.selectDate(e,t.clone().subtract(1,"month"))}(e.pageId,e.date),tooltip:(0,B.Z)("Previous"),image:Wi.mgF.small}),sue(po.ZP,{className:"button-narrow button-transparent",onClick:()=>function(e,t){bO.Z.selectDate(e,t.clone().add(1,"month"))}(e.pageId,e.date),tooltip:(0,B.Z)("Next"),image:Wi.Zu.small})),sue("h2",{className:"MonthDayPicker-Month"},void 0,e.date.format("MMMM YYYY"))),c)};var aue;function rue(e,t,n,i){aue||(aue="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:aue,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const lue=[I.kCalendarDisplayDensity,I.kCalendarOnboardingShown,I.kCalendarPanelCalendarHeight],due=d2.G6;let cue=!1;const uue=()=>bO.Z.viewPreviousPeriod(due),pue=()=>bO.Z.viewNextPeriod(due);function hue(e){bO.Z.selectDate(due,e)}function gue(){bO.Z.selectToday(due)}function mue(){bO.Z.setViewMode(due,"day")}function fue(){bO.Z.setViewMode(due,"week")}function vue(){bO.Z.setViewMode(due,"agenda")}function yue(e){return rue("div",{className:"panel-empty-state"},void 0,rue("span",{dangerouslySetInnerHTML:{__html:Wi.VA7}}),rue("h1",{},void 0,(0,B.Z)("Add your first calendar account")),rue("p",{className:"faded-text"},void 0,(0,B.Z)("You can add a local or online calendar to Vivaldi Calendar.")),rue("input",{type:"button",onClick:()=>de.Z.showCalendarAccountDialog(e.windowId),value:(0,B.Z)("Add Calendar Account")}))}function bue(e){return rue("div",{className:"panel-empty-state",onClick:e.onCreateEvent},void 0,rue("span",{dangerouslySetInnerHTML:{__html:Wi.VA7}}),rue("h1",{},void 0,(0,B.Z)("Your calendar is empty")),rue("p",{className:"faded-text"},void 0,(0,B.Z)("Click the “+” button to add a new event.")))}function Sue(e){const t=Li.useContext(ts.Z),{stateHandler:n,calendarFilter:i,eventDraft:s,events:o,trashedEvents:a}=r2(due),r=(0,Ya.Z)(lue),l=r[I.kCalendarPanelCalendarHeight]||p.mT,[d,c]=Li.useState(!1),[u,h]=Li.useState(l);Li.useEffect((()=>h(l)),[l]);const g=Li.useMemo((()=>({pageId:due,displayDensity:r[I.kCalendarDisplayDensity],isPanel:!0,isEditing:!!s,isWidget:!1,handler:n})),[r,n,s]),m=Li.useCallback((()=>{de.Z.showCalendar(t.vivaldiWindowId)}),[t.vivaldiWindowId]),{editEvent:f}=n,v=Li.useCallback((()=>{f(null,Zl.ZP.minimalCreateEvent({}))}),[f]);if(!e.open)return cue=!1,null;function y(){T&&bO.Z.search(due,""),c(!1)}function b(e){const t=El.Z.getEvent(e);t&&bO.Z.selectEvent(due,{event:t,allDay:t.allDay})}!1===cue&&e.open&&(te.ZP.pollAllCalDAVAccounts(!0),cue=!0);const{anchorDate:S,selectedDate:C,displayMode:A,filterText:T}=i,Z=Zl.ZP.getDisplayRange(S,A),E=0===El.Z.getCalendars().length||!r[I.kCalendarOnboardingShown]&&0===El.Z.getEvents().length&&!El.Z.getAccounts().some((e=>"local"!==e.account_type)),k=!s&&!El.Z.getEvents().length;d&&!T&&y();const _=!!T&&(["agenda","year"].includes(A)?0===o.length:o.every((e=>!0===e.filteredOut))),N=!d&&_&&!k;return rue("div",{className:"panel",id:"calendar_panel",onClick:function(e){e.stopPropagation(),s&&n.endEventEdit()}},void 0,rue(yM.Provider,{value:g},void 0,rue("header",{},void 0,rue(im,{title:(0,B.Z)("Calendar"),showCloseButton:e.showCloseButton}),!E&&(0,ss.jsxs)(ss.Fragment,{children:[rue("div",{className:"toolbar toolbar-default",role:"toolbar","aria-label":(0,B.Z)("toolbar label","Calendar")},void 0,rue(V2,{filterText:T,onSearchChange:function(e){bO.Z.search(due,e)},onSelectEvent:b,onShowSearchResults:function(){c(!0)}})),rue("div",{className:"toolbar toolbar-default"},void 0,rue(Y2,{initialPeriod:S,setPeriod:hue,startDate:Z.start,endDate:Z.end,displayMode:A,inPanel:!0}),rue("div",{className:"toolbar-group",style:{marginLeft:"auto"}},void 0,rue(po.ZP,{className:"button-narrow",onClick:uue,tooltip:(0,B.Z)("Previous"),image:Wi.mgF.small}),rue(po.ZP,{onClick:gue,disabled:!!C&&(0,ih.KC)(C.toDate(),new Date),title:(0,B.Z)("calendar","Today")}),rue(po.ZP,{className:"button-narrow",onClick:pue,tooltip:(0,B.Z)("Next"),image:Wi.Zu.small}))),rue("div",{className:"toolbar toolbar-default toolbar-wrap",role:"toolbar","aria-label":(0,B.Z)("toolbar label","Display Period")},void 0,rue("div",{className:"toolbar-group",style:{marginRight:"auto"}},void 0,rue(po.ZP,{onClick:mue,title:(0,B.Z)("Day"),isPressed:"day"===A}),rue(po.ZP,{onClick:fue,title:(0,B.Z)("Week"),isPressed:"week"===A}),rue(po.ZP,{onClick:vue,title:(0,B.Z)("Agenda"),isPressed:"agenda"===A})),rue(po.ZP,{className:"left-gap",onClick:m,tooltip:(0,B.Z)("Open Calendar in Tab"),label:(0,B.Z)("Open Calendar"),image:Wi.bcq.small,commandId:"COMMAND_SHOW_CALENDAR"}),rue(po.ZP,{onClick:v,tooltip:(0,B.Z)("title","Create New Event"),image:Wi.md4.small}))]})),E&&rue(yue,{windowId:t.vivaldiWindowId}),!E&&k&&rue(bue,{onCreateEvent:v}),N&&rue(To,{type:"info"},void 0,(0,B.Z)("Showing filtered results. Press “Search” for full results.")),!k&&!d&&rue(DL,{filter:i,events:o,trashedEvents:a,editingEvent:s}),d&&rue(y2,{selectedEvent:i.selectedEvent,onSelectEvent:b,filterText:T,onClose:y,editingEvent:s}),rue("div",{className:Fi()("CalendarPanel-MiniCalendar",{collapsed:u<=p.mT}),style:{height:Math.abs(me.yn-u)>10?u:me.yn}},void 0,rue(Zm.Z,{onSlidebarPosition:function(e,t){h((e=>e-t))},onStop:function(){h((e=>{let t=e;return t<=p.Cn&&(t=p.mT),w.Z.set(I.kCalendarPanelCalendarHeight,t),t}))},onDoubleClick:function(){h((e=>{let t=e;return t=t>p.Cn?p.mT:me.yn,w.Z.set(I.kCalendarPanelCalendarHeight,t),t}))},returnOffset:!0,position:"bottom"}),u>=p.mT&&rue(oue,{date:i.selectedDate??i.anchorDate,pageId:due}))))}const wue=Li.memo(Sue);var Cue,Aue=n(92521);function Iue(e,t,n,i){Cue||(Cue="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Cue,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Tue=[{text:(0,B.Z)("other","Name"),value:"name",fullScreenTitle:(0,B.Z)("Sort by Name")}];class Zue extends Li.PureComponent{refTreeList=Li.createRef();static contextType=ts.Z;winId=this.context.vivaldiWindowId;state={sorting:C.Z.get(I.kContactPanelSorting)};onSortChange=(e,t)=>{const n={sortOrder:e,sortField:t};this.setState({sorting:n}),w.Z.set(I.kContactPanelSorting,{sortOrder:e,sortField:t})};sortComparator=(e,t)=>{if(e.trash)return 1;if(t.trash)return-1;if(this.isFolder(e)&&!this.isFolder(t))return-1;if(this.isFolder(t)&&!this.isFolder(e))return 1;const n=e=>e.emailAddresses&&e.emailAddresses.length>0?e.emailAddresses[0].emailAddress:"";e.name||(e.name=n(e)),t.name||(t.name=n(t));const{sortOrder:i,sortField:s}=this.state.sorting;return ds.Z.getDefaultComparator(i,s)(e,t)};getSelectedIds=()=>(this.refTreeList.current?.getAllSelectedItems()||[]).map((e=>e.id));getSelectedItems=()=>{const e=[];for(const t of this.getSelectedIds()){const n=Ed.Z.getNodeById(t);n&&e.push(n)}return e};getSelectedItem=()=>this.refTreeList.current?.getSelectedItem();getNodeName=e=>e.name?e.name:e.emailAddresses&&e.emailAddresses.length>0?e.emailAddresses[0].emailAddress:"";isFolder=gE.Z;hasChildren=e=>!!e.children&&e.children.length>0;unSelectAll=()=>{this.refTreeList.current?.unSelectAll()};deleteSelected=()=>{this.refTreeList.current?.onDelete()};deleteByIds=e=>{this.refTreeList.current?.onDeleteItems(e)};validateForEdit=Aue.Z;isValidAddTarget=Aue.Z;getTitle=e=>{if("string"==typeof e){const t=Ed.Z.getNodeById(e);return t?this.getNodeName(t):""}return""};saveTitle=(e,t)=>{const n=Ed.Z.getNodeById(e);n&&(n.name=t,a.Z.updateContact(n))};onAdd=e=>{this.refTreeList.current?.onAdd(e?"folder":"item")};getMenuCapability=async(e,t,n)=>{const i=this.winId;switch(e.action){case"CONTEXT_COMPOSE_MAIL":return{handler:this.compose,isVisible:()=>Boolean(n),...t(i,e,{})};case"CONTEXT_VIEW_ALL_MESSAGES":return{handler:this.viewAll,isVisible:()=>Boolean(n),...t(i,e,{})};case"CONTEXT_CONTAINER_DEFAULT_ACTION":{const n=this.props.prefValues[I.kMailContactDefaultAction];return{items:[{type:"radio",radiogroup:1,checked:"compose"===n,handler:()=>this.setDefaultAction("compose"),...(0,us.Z)("Compose")},{type:"radio",radiogroup:1,checked:"viewAllMessages"===n,handler:()=>this.setDefaultAction("viewAllMessages"),...(0,us.Z)("View All Messages")}],...t(i,e,{})}}default:return{...t(i,e,{})}}};getMenuVisibility=(e,t)=>{if(!t)return"CONTEXT_NEW_ITEM"===e.action;switch(e.action){case"CONTEXT_NEW_ITEM":case"CONTEXT_EDIT":case"CONTEXT_DELETE":return!0;default:return!1}};onContextMenu=e=>{this.refTreeList.current?.onContextMenu(e)};setDefaultAction=e=>{w.Z.set(I.kMailContactDefaultAction,e)};onDoubleClick=e=>{0!==e.button||this.props.prefValues[I.kMailSingleClickTabs]||this.openTabForSelectedNode()};onNodeMouseDown=(e,t)=>{this.props.focusTree(),0===t.button&&this.props.prefValues[I.kMailSingleClickTabs]&&this.openTabForSelectedNode()};openTabForSelectedNode=()=>{const e=this.props.prefValues[I.kMailContactDefaultAction];"compose"===e?this.compose():"viewAllMessages"===e&&this.viewAll()};compose=()=>{const e=this.getSelectedItems();if(e&&e.length>0){const t=e.flatMap((e=>e.emailAddresses)).map((({emailAddress:e})=>({address:e})));Qt.Z.createDraft({to:t})}};viewAll=()=>{const e=this.getSelectedItems();if(e&&e.length>0){const t=this.context.vivaldiWindowId;a.Z.selectContact(e[0]),d.Z.selectContactById(t,e[0].id),c.ZP.openURL(t,pn.jk.internals.mailpage,{singleton:!0})}};rowComponent=e=>{const t=e.node,n=t?this.getNodeName(t):"";return Iue("label",{tabIndex:"-1"},`contact__list__${t.id}`,Iue("span",{className:"tree-row-image"},void 0,Iue("img",{src:t.avatarUrl?t.avatarUrl:Kk.g,alt:""})),Iue("span",{className:"title",title:n},void 0,n))};selectById=e=>{this.refTreeList.current?.selectById(e)};menu={name:"contactlist",getCapability:this.getMenuCapability,getVisibility:this.getMenuVisibility};render(){const e={sortOrder:this.state.sorting.sortOrder,sortField:this.state.sorting.sortField,comparator:this.sortComparator};return(0,ss.jsxs)(ss.Fragment,{children:[Iue(Mm,{fields:Tue,manualSorting:!1,onSortChange:this.onSortChange,keyAccess:this.props.keyAccess,compact:!0,sortField:this.state.sorting.sortField,sortOrder:this.state.sorting.sortOrder}),Iue("section",{className:"outerScrollbar"},void 0,(0,ss.jsx)(Ps,{ref:this.refTreeList,settings:"CONTACT_TREE",rowComponent:this.rowComponent,nodes:this.props.nodes,menu:this.menu,delete:a.Z.deleteContactsByIds,enableDragAndDrop:!1,isFolder:this.isFolder,hasChildren:this.hasChildren,supportsInlineEdit:!1,isValidToEdit:gE.Z,getTitle:this.getTitle,saveTitle:this.saveTitle,isValidAddTarget:this.isValidAddTarget,sorting:e,onSelect:this.props.onItemSelected,onItemMouseDown:this.onNodeMouseDown,onCreate:this.props.onCreate,onEdit:this.props.onEdit,onItemsActivated:this.openTabForSelectedNode,onItemDoubleClick:this.onDoubleClick}))]})}}const Eue=Zue;var kue;function _ue(e,t,n,i){kue||(kue="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:kue,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Nue=256,Pue=["../resources/contact-person.png","../resources/contact-company.png"];class Due extends Li.PureComponent{static contextType=ts.Z;nodeRef=Li.createRef();refPhotoPicker=Li.createRef();state={drawerOpen:!1,isDropTarget:!1,initialPhoto:"",id:""};componentDidUpdate(e,t){const n=this.props.id;n&&n!==e.id&&this.setState({initialPhoto:this.props.photo,id:n}),!0===t.drawerOpen&&!1===this.state.drawerOpen?this.props.disableOnClickOutside?.():!1===t.drawerOpen&&!0===this.state.drawerOpen&&this.props.enableOnClickOutside()}getNode(){return this.nodeRef.current}onToggleOverlay=()=>{this.setState((e=>({drawerOpen:!e.drawerOpen})))};handleClickOutside=()=>{this.setState({drawerOpen:!1})};photoChange=()=>{this.refPhotoPicker.current?.click()};setContactPhoto=e=>{if(e.target.files&&e.target.files.length>0){var t=e.target.files[0],n=new FileReader;n.onloadend=()=>{this.setState({drawerOpen:!1,isDropTarget:!1}),"string"==typeof n.result&&this.props.attributeChange(n.result)},n.readAsDataURL(t)}};photoDragOver=e=>{e.preventDefault()};photoDragEnter=()=>{this.setState({isDropTarget:!0})};photoDragLeave=()=>{this.setState({isDropTarget:!1})};photoDrop=e=>{const t=e.dataTransfer.files[0];if(this.setState({isDropTarget:!1}),t&&/image.*/.test(t.type)){const e=new FileReader;e.onloadend=()=>{"string"==typeof e.result&&this.setPhoto(e.result)},e.readAsDataURL(t)}};getGravatar=()=>{const e=wn()(this.props.emailAddress);fetch(`https://secure.gravatar.com/avatar/${e}?s=512&d=404`).then((e=>{e.ok&&e.blob().then((e=>{const t=new FileReader;t.addEventListener("loadend",(()=>{"string"==typeof t.result&&this.setPhoto(t.result),this.setState({drawerOpen:!1,isDropTarget:!1})})),t.readAsDataURL(e)}))}))};setPhoto=e=>{const{document:t}=this.context;if(!e)return this.props.attributeChange(""),void this.setState({drawerOpen:!1,isDropTarget:!1});const n=t.createElement("canvas"),i=n.getContext("2d"),s=t.createElement("img");let o=0,a=0;n.width=Nue,n.height=Nue,s.onload=()=>{s.height>s.width?(s.height*=Nue/s.width,s.width=Nue,a=.5*-(s.height-Nue)):(s.width*=Nue/s.height,s.height=Nue,o=.5*-(s.width-Nue)),i.drawImage(s,o,a,s.width,s.height),this.props.attributeChange(n.toDataURL("image/jpeg",.9)),this.setState({drawerOpen:!1})},s.src=e};render(){const e=this.props.photo,t=Fi()({"contact-photo-is-droptarget":this.state.isDropTarget,"contact-photo":!0});return(0,ss.jsxs)("span",{ref:this.nodeRef,className:"contact-photo-picker",children:[_ue("button",{className:t,onDrop:this.photoDrop,onDragEnter:this.photoDragEnter,onDragLeave:this.photoDragLeave,onDragOver:this.photoDragOver,style:e?{backgroundImage:`url(${e})`}:{backgroundImage:`url(${Kk.g})`},disabled:-1===this.props.id,onClick:this.onToggleOverlay}),(0,ss.jsx)("input",{type:"file",tabIndex:"-1",accept:"image/*",ref:this.refPhotoPicker,disabled:-1===this.props.id,onChange:this.setContactPhoto,style:{position:"absolute",visibility:"hidden",height:0,width:0}}),this.state.drawerOpen&&_ue("div",{className:"contact-photo-picker-overlay"},void 0,_ue("div",{className:"photo-picker-suggestions"},void 0,_ue("button",{className:"photo-picker-suggestion",onClick:this.props.disabled?void 0:this.setPhoto.bind(this,this.state.initialPhoto),style:{backgroundImage:this.state.initialPhoto?`url(${this.state.initialPhoto})`:`url(${Kk.g})`}}),Pue.map(((e,t)=>_ue("button",{className:"photo-picker-suggestion",onClick:this.setPhoto.bind(this,Pue[t]),style:{backgroundImage:`url(${e})`}},`photo-picker-suggestion-${t}`)))),_ue("input",{type:"button",onClick:this.getGravatar,value:(0,B.Z)("Get Gravatar")}),_ue("input",{type:"button",className:"primary",onClick:this.photoChange,value:(0,B.Z)("Browse...")}))]})}}const Mue=(0,sy.Z)(Due);var Oue,xue;function Lue(e,t,n,i){Oue||(Oue="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Oue,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class Rue extends Li.PureComponent{isIMEOpen=!1;nodeRef=Li.createRef();state={values:this.props.values};resetValues(){this.setState({values:this.props.values})}_handleChange=(e,t)=>{if(this.isIMEOpen)return!1;const n=t.target.value,i=t.target.name;this.setState((t=>{const s=[...t.values];return s[e]={...t.values[e],[i]:n},{values:s}}))};_handleAdd=e=>{0===e.button&&this._handleChange(this.props.values.length,e)};_handleRemove=(e,t)=>{0===t.button&&(e?this.props.onRemove(e):this.resetValues())};_handleSubmit=()=>{this.props.onChange(this.state.values)};_handleFormSubmit=e=>{e.preventDefault(),this._handleSubmit()};_handleInputKeyDown=e=>{switch(e.key){case"Escape":return void this.resetValues();case"Enter":return void this._handleSubmit()}};onCompositionUpdate=()=>{this.isIMEOpen=!0};onCompositionEnd=(e,t)=>{this.isIMEOpen=!1,this._handleChange(e,t)};renderSimpleForm(e,t){return Lue("form",{},void 0,this.renderTypes(e,0),this.props.label&&Lue("input",{className:"contact-field",type:e,defaultValue:this.props.values[0],placeholder:t,title:t,name:"value",onChange:e=>this._handleChange(0,e),onKeyDown:this._handleInputKeyDown,onBlur:this._handleFormSubmit,onCompositionStart:this.onCompositionUpdate,onCompositionUpdate:this.onCompositionUpdate,onCompositionEnd:e=>this.onCompositionEnd(0,e)}))}renderTypes(e,t){return Lue(ta.Z,{className:"contact-type-picker",name:"type",onChange:this._handleChange.bind(this,t),onBlur:this._handleFormSubmit,value:e},void 0,Lue("option",{value:""},void 0,(0,B.Z)("contact type","default")),Lue("option",{value:"home"},void 0,(0,B.Z)("home")),Lue("option",{value:"work"},void 0,(0,B.Z)("work")))}render(){const{values:e}=this.state,{inputType:t="text",label:n}=this.props;return 0===e.length?this.renderSimpleForm(t,n):(0,ss.jsx)(ss.Fragment,{children:(0,ss.jsx)("form",{ref:this.nodeRef,onSubmit:this._handleFormSubmit,children:e.map(((i,s)=>Lue(Li.Fragment,{},i.id+"_"+s,this.renderTypes(i.type||"",s),Lue("span",{className:"contact-field"},void 0,this.props.label&&Lue("input",{type:t,name:"value",defaultValue:i.value||"",placeholder:n,title:n,onChange:this._handleChange.bind(this,s),onBlur:this._handleFormSubmit,onKeyDown:this._handleInputKeyDown,onCompositionStart:this.onCompositionUpdate,onCompositionUpdate:this.onCompositionUpdate,onCompositionEnd:this.onCompositionEnd,autoFocus:s===e.length-1}),Lue("button",{type:"button",className:"remove",title:(0,B.Z)("verb","Remove"),onMouseUp:this._handleRemove.bind(this,i.id),onClick:this._handleRemove.bind(this,i.id)},void 0,"–")),s===e.length-1&&Lue("input",{type:"button",value:this.props.actionLabel,className:"add",onMouseUp:this._handleAdd,onClick:this._handleAdd}))))})})}}function Bue(e,t,n,i){xue||(xue="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:xue,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var Fue=Bue("span",{className:"spacer"}),Wue=Bue("span",{className:"spacer"}),Uue=Bue("span",{className:"spacer"}),Vue=Bue("span",{className:"spacer"}),Hue=Bue("span",{className:"spacer"}),Gue=Bue("span",{className:"spacer"}),$ue=Bue("span",{className:"spacer"}),Kue=Bue("span",{className:"spacer"}),zue=Bue("span",{className:"spacer"});class jue extends Li.Component{static contextType=ts.Z;refName=Li.createRef();refPhotoPicker=Li.createRef();state={contact:this.props.contact,editMode:!1};static getDerivedStateFromProps(e,t){return{contact:e.contact}}focus=()=>{this.refName.current?.focus()};changeProperty=(e,t)=>{const{contact:n}=this.state;switch(e){case"birthday":{const e=W()(t.target.value).valueOf();n.birthday!==e&&(n.birthday=e,this.setState({contact:n}));break}case"note":case"name":{const i=t.target.value;n[e]!==i&&(n[e]=i,this.setState({contact:n}));break}}};updateCheckboxProperty=e=>{const{contact:t}=this.state;-1!==t.id&&a.Z.update(t.id,{trusted:e.target.checked})};updateAvatar=e=>{const{contact:t}=this.state;a.Z.update(t.id,{avatarUrl:e}),this.setState((t=>({contact:{...t.contact,avatarUrl:e}})))};update=e=>{const{contact:t}=this.state;switch(e){case"name":return a.Z.update(t.id,{name:t.name,generatedFromSentMail:!1});case"birthday":return a.Z.update(t.id,{birthday:t.birthday,generatedFromSentMail:!1});case"note":return a.Z.update(t.id,{note:t.note,generatedFromSentMail:!1})}};_handleEmailsChanged=e=>{const{contact:t}=this.state;e.forEach((e=>{const n=e.id,i=t.emailAddresses.find((e=>e.id===n));i?(0,QT.Z)(i,e)||a.Z.updateEmailAddress(n,{contactId:t.id,emailAddress:e.value,type:e.type}):a.Z.addEmailAddress({contactId:t.id,emailAddress:e.value,type:e.type})}))};_handleEmailsRemoved=e=>{a.Z.removeEmailAddress({contactId:this.props.contact.id,emailAddressId:e})};_handlePropertyValueChanged=({propertyName:e,propertyCollectionName:t,values:n})=>{if(0===n.length)return;const{contact:i}=this.state,s=i.id;n.forEach((n=>{const o=n.id,r=i[t].find((e=>e.id===o));(r||n.value)&&(r?a.Z.updatePropertyItem({contactId:s,propertyName:e,propertyId:o,type:n.type,propertyValue:n.value}):a.Z.addPropertyItem({contactId:s,propertyName:e,type:n.type||"",propertyValue:n.value}))}))};_handlePhoneNumbersChanged=e=>{this._handlePropertyValueChanged({values:e,propertyName:"phoneNumber",propertyCollectionName:"phoneNumbers"})};_handlePhoneNumbersRemoved=e=>{a.Z.removePropertyItem({propertyName:"phoneNumber",contactId:this.state.contact.id,propertyId:e})};_handlePostalAddressesChanged=e=>{this._handlePropertyValueChanged({values:e,propertyName:"postalAddress",propertyCollectionName:"postalAddresses"})};_handlePostalAddressesRemoved=e=>{a.Z.removePropertyItem({propertyName:"postalAddress",contactId:this.state.contact.id,propertyId:e})};onKeyDown=(e,t)=>{"Enter"!==t.key||this.update(e)};call=(e="",t)=>{const n=e.replace(/[^\d]/g,"");n&&(t.stopPropagation(),c.ZP.openURL(this.context.vivaldiWindowId,`tel:+${n}`))};compose=(e="",t)=>{e&&(t.stopPropagation(),Qt.Z.createDraft({to:(0,dZ.D$)(e)}))};showMap=(e="",t)=>{e&&(t.stopPropagation(),c.ZP.openURL(this.context.vivaldiWindowId,`map:+${e}`))};enableEditMode=()=>{this.setState({editMode:!0},(()=>this.focus()))};toggleEditMode=()=>{this.setState((e=>({editMode:!e.editMode})))};addSpaces=e=>e.split("").reverse().join("").replace(/(.{3})/g,"$1 ").split("").reverse().join("").replace("+ ","+");renderDisplayMode=()=>{const{contact:e}=this.state;return Bue("div",{className:"contact-view cardview",onClick:this.props.onEdit},void 0,Bue("div",{className:"contact-header"},void 0,(0,ss.jsx)(Mue,{ref:this.refPhotoPicker,id:e.id,disabled:!0,attributeChange:this.updateAvatar,photo:e.avatarUrl||"",emailAddress:e.emailAddresses.length>0?e.emailAddresses[0].emailAddress:""}),Bue("div",{className:Fi()({"contact-name":!0,selectable:e.name,disabled:!e.name})},void 0,e.name||(0,B.Z)("noun","Name"))),Fue,e.emailAddresses.map((e=>{if(e.emailAddress)return Bue(Li.Fragment,{},e.id,Bue("div",{className:"contact-field-type"},void 0,Bue("span",{className:"info"},void 0,e.type),Bue("span",{dangerouslySetInnerHTML:{__html:Wi.HXY},className:"contact-action-button",onClick:this.compose.bind(null,e.emailAddress),title:(0,B.Z)("Compose new mail"),tooltip:(0,B.Z)("Compose new mail")+" "+Ge.Z.getShortcut("COMMAND_MAIL_COMPOSE_NEW_MESSAGE")})),Bue("p",{className:"contact-email selectable"},void 0,e.emailAddress))})),Wue,e.phoneNumbers.map((e=>{if(e.phoneNumber)return Bue(Li.Fragment,{},e.id,Bue("div",{className:"contact-field-type"},void 0,Bue("span",{className:"info"},void 0,e.type),Bue("span",{dangerouslySetInnerHTML:{__html:Wi.Mqy},className:"contact-action-button",onClick:this.call.bind(null,e.phoneNumber),title:(0,B.Z)("Call")})),Bue("p",{className:"contact-phone selectable"},void 0,this.addSpaces(e.phoneNumber)))})),Uue,e.postalAddresses.map((e=>{if(e.postalAddress)return Bue(Li.Fragment,{},e.id,Bue("div",{className:"contact-field-type"},void 0,Bue("span",{className:"info"},void 0,e.type),Bue("span",{dangerouslySetInnerHTML:{__html:Wi.rnU},className:"contact-action-button",onClick:this.showMap.bind(null,e.postalAddress),title:(0,B.Z)("Open map")})),Bue("p",{className:"contact-phone selectable"},void 0,e.postalAddress))})),0!==e.birthday&&(0,ss.jsxs)(ss.Fragment,{children:[Vue,Bue("span",{dangerouslySetInnerHTML:{__html:Wi.bcq.small},className:"contact-field-type contact-action-button"}),Bue("p",{className:"contact-birthday selectable"},void 0,W()(e.birthday).format("LL"))]}),e.note&&(0,ss.jsxs)(ss.Fragment,{children:[Hue,Bue("span",{dangerouslySetInnerHTML:{__html:Wi.NNg.small},className:"contact-field-type contact-action-button",onClick:this.toggleEditMode,title:(0,B.Z)("Edit note")}),Bue("p",{className:"contact-note selectable"},void 0,e.note)]}))};render(){const{contact:e}=this.state,t=e.emailAddresses[0]&&e.emailAddresses[0].emailAddress;return this.state.editMode?Bue("div",{className:"contact-view cardview"},void 0,Bue("div",{className:"contact-header"},void 0,Bue(Mue,{id:e.id,attributeChange:this.updateAvatar,photo:e.avatarUrl||"",emailAddress:t}),Bue("span",{className:"contact-name"},void 0,(0,ss.jsx)("input",{ref:this.refName,type:"text",value:e.name||"",placeholder:(0,B.Z)("other","Name"),onChange:this.changeProperty.bind(this,"name"),onKeyDown:this.onKeyDown.bind(this,"name"),onBlur:this.update.bind(this,"name")}))),Bue(Rue,{values:e.emailAddresses.map((({emailAddress:e,id:t,type:n})=>({value:e,id:t,type:n}))),label:(0,B.Z)("Email"),actionLabel:(0,B.Z)("Add another Email"),inputType:"email",onChange:this._handleEmailsChanged,onRemove:this._handleEmailsRemoved},`emailAddresses-${Math.max(e.emailAddresses.length,1)}`),Bue("label",{className:"contact-trusted"},void 0,Bue("input",{type:"checkbox",checked:e.trusted||!1,onChange:this.updateCheckboxProperty}),Bue("span",{},void 0,(0,B.Z)("Always allow external content in emails"))),Gue,Bue(Rue,{values:e.phoneNumbers.map((({phoneNumber:e,id:t,type:n})=>({value:e,id:t,type:n}))),label:(0,B.Z)("Phone Number"),actionLabel:(0,B.Z)("Add another Phone Number"),inputType:"tel",onChange:this._handlePhoneNumbersChanged,onRemove:this._handlePhoneNumbersRemoved},`phoneNumbers-${e.phoneNumbers.length}`),$ue,Bue(Rue,{values:e.postalAddresses.map((({postalAddress:e,id:t,type:n})=>({value:e,id:t,type:n}))),label:(0,B.Z)("Postal Address"),actionLabel:(0,B.Z)("Add another Postal Address"),inputType:"text",onChange:this._handlePostalAddressesChanged,onRemove:this._handlePostalAddressesRemoved},`postalAddresses-${e.postalAddresses.length}`),Kue,Bue("span",{className:"contact-field"},void 0,Bue(Vk.Z,{className:"contact-bday",value:e.birthday?W()(e.birthday).format("YYYY-MM-DD"):"",title:(0,B.Z)("title","Birthday"),onChange:this.changeProperty.bind(this,"birthday"),onKeyDown:this.onKeyDown.bind(this,"birthday"),onBlur:this.update.bind(this,"birthday"),placeholder:(0,B.Z)("title","Birthday")}),Bue("button",{type:"button",className:"remove",title:(0,B.Z)("Remove Birthday"),onMouseUp:this.changeProperty.bind({target:{value:0}},"birthday")},void 0,"–")),zue,Bue("textarea",{className:"contact-edit-note",type:"text",value:e.note||"",title:e.note||"",onChange:this.changeProperty.bind(this,"note"),onKeyDown:this.onKeyDown.bind(this,"note"),onBlur:this.update.bind(this,"note"),placeholder:(0,B.Z)("Note")})):this.renderDisplayMode()}}const Yue=jue;var Xue;function Que(e,t,n,i){Xue||(Xue="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Xue,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var que=Que("input",{type:"checkbox",disabled:!0}),Jue=Que("span",{className:"spacer"}),epe=Que("span",{className:"spacer"}),tpe=Que("span",{className:"spacer"}),npe=Que("span",{className:"spacer"});function ipe(){return Que("div",{className:"contact-view cardview"},void 0,Que("div",{className:"contact-header"},void 0,Que("span",{className:"contact-photo-picker"},void 0,Que("div",{className:"contact-photo",style:{backgroundImage:"url('/resources/contact-person.png')"}})),Que("input",{className:"contact-name",type:"text",placeholder:(0,B.Z)("other","Name"),disabled:!0})),Que("input",{className:"contact-email",type:"email",placeholder:(0,B.Z)("Email"),disabled:!0}),Que("label",{className:"contact-trusted"},void 0,que,Que("span",{},void 0,(0,B.Z)("Always allow external content in emails"))),Jue,Que("input",{className:"contact-email",type:"tel",placeholder:(0,B.Z)("Phone number"),disabled:!0}),epe,Que("input",{className:"contact-email",type:"text",placeholder:(0,B.Z)("Postal address"),disabled:!0}),tpe,Que("input",{className:"contact-email",type:"text",placeholder:(0,B.Z)("title","Birthday"),disabled:!0}),npe,Que("input",{className:"contact-postal",type:"text",placeholder:(0,B.Z)("Notes"),disabled:!0}))}var spe,ope=n(34155);function ape(e,t,n,i){spe||(spe="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:spe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const rpe=[I.kContactPanelEditorHeight,I.kMailContactDefaultAction,I.kMailSingleClickTabs];var lpe=ape(ipe,{});class dpe extends Li.PureComponent{static contextType=ts.Z;winId=this.context.vivaldiWindowId;nodeRef=Li.createRef();_tree=Li.createRef();_editor=Li.createRef();state={items:Ed.Z.getAsTree(""),filter:"",editorHeight:this.props.prefValues[I.kContactPanelEditorHeight],contact:{id:Ed.s}};componentDidMount(){0===this.state.items.length&&a.Z.initialize(),Yn.ZP.addListener(this.onPanelStoreChange),Ed.Z.addListener(this.onContactStoreChange)}componentWillUnmount(){Yn.ZP.removeListener(this.onPanelStoreChange),Ed.Z.removeListener(this.onContactStoreChange)}componentDidUpdate(e,t){!e.open&&this.props.open&&ope.nextTick((()=>this._applyTransitionState()))}_applyTransitionState=()=>{const e=Yn.ZP.getTransitionState(this.winId,"PanelContacts");jn.Z.clearTransitionState(this.winId,"PanelContacts"),this._tree.current&&e?(e.selectId&&this._tree.current.selectById(e.selectId),"edit"===e.reason?this.onEdit():e.setFocus&&this.focusTree()):this.focusTree()};onPanelStoreChange=()=>{const e=Yn.ZP.getChangeReason();if(this.props.open)switch(e){case"setFocus":(0,Ra.sT)(this.context.document,this.nodeRef.current)||this.focusTree();break;case"display":ope.nextTick((()=>this._applyTransitionState()))}};onContactStoreChange=e=>{switch(e.reason){case"selectedContact":{const t=e.focusContactView;return this.onContactSelectedChange(e.contact,t)}case"newContact":{const t=e.focusContactView;return this.onContactSelectedChange(e.contact,t,{items:Ed.Z.getAsTree(this.state.filter)})}case"startup":{const e=Dn.Z.getSync("SELECTION_CONTACT_TREE")?.selectedIds_[0]?.id,t=e&&Ed.Z.getNodeById(e)||{id:Ed.s};this.setState((e=>({contact:t,items:Ed.Z.getAsTree(e.filter)})));break}case"addContacts":case"deleteContact":case"updatedContact":return this.setState((e=>({contact:Ed.Z.getSelected()||{id:Ed.s},items:Ed.Z.getAsTree(e.filter)})))}};onContactSelectedChange=(e,t,n)=>{this.setState({...n,contact:e},(()=>{t&&e.id!==Ed.s&&(this._editor.current&&this._editor.current.enableEditMode(),this._tree.current&&this._tree.current.selectById(e.id))}))};newItem=e=>{this._tree.current&&this._tree.current.onAdd(e)};onCreate=(e,t,n,i)=>(this.onEdit(),a.Z.newEmptyContact());onEdit=()=>{this.state.editorHeight<p.Cn&&this.onSlidebarToggle();(this.state.contact||Ed.Z.getSelected()||{id:Ed.s})&&this._editor.current&&this._editor.current.enableEditMode()};deleteSelected=()=>{this._tree.current&&this._tree.current.deleteSelected()};handleFilterChange=e=>{const t=e.target.value;this.setState({filter:t,items:Ed.Z.getAsTree(t)})};onCompose=()=>{this._tree.current&&this._tree.current.compose()};focusTree=()=>{this._tree.current&&this._tree.current.refTreeList.current?.focusTree()};onItemSelected=e=>{if(e){if(e.id===this.state.contact.id)return;a.Z.selectContact(e,!1)}else this.setState({contact:{id:Ed.s}})};onContextMenu=e=>{e.nativeEvent.buttons>0&&this._tree.current?.unSelectAll(),this._tree.current?.onContextMenu(e)};onSlidebarPosition=(e,t)=>{this.setState((e=>({editorHeight:Math.max(Math.min(e.editorHeight-t,800),p.mT)})))};onSlideBarStop=()=>{this.setState((e=>{let t=e.editorHeight;return t<=p.Cn&&(t=p.mT),w.Z.set(I.kContactPanelEditorHeight,t),{editorHeight:t}}))};onSlidebarToggle=()=>{this.setState((e=>{let t=e.editorHeight;return t>p.Cn?(t=p.mT,w.Z.set(I.kContactPanelEditorHeight,t)):(t=320,w.Z.reset(I.kContactPanelEditorHeight)),{editorHeight:t}}))};renderEmptyState=()=>ape("div",{className:"panel-empty-state"},void 0,ape("span",{dangerouslySetInnerHTML:{__html:Wi.h5j}}),ape("h1",{},void 0,(0,B.Z)("Your contact list is empty")),ape("p",{className:"faded-text"},void 0,(0,B.Z)("Click the “+” button to add a new contact.")));renderNoContactFound=()=>ape("div",{className:"panel-empty-state"},void 0,ape("span",{dangerouslySetInnerHTML:{__html:Wi.h5j}}),ape("h1",{},void 0,(0,B.Z)("No contact found")));render(){if(!this.props.open)return null;const e=this.state.contact&&this.state.contact.id!==Ed.s?this.state.contact:void 0;return(0,ss.jsxs)("div",{ref:this.nodeRef,className:"panel",id:"contacts",children:[ape("header",{},void 0,ape(im,{title:this.props.title,showCloseButton:this.props.showCloseButton}),ape("div",{className:"toolbar toolbar-default toolbar-wrap",role:"toolbar","aria-label":(0,B.Z)("toolbar label","Contacts")},void 0,ape("input",{type:"search",placeholder:(0,B.Z)("verb","Search"),value:this.state.filter,onChange:this.handleFilterChange}),ape("div",{className:"toolbar"},void 0,ape("div",{className:"toolbar-group"},void 0,ape(po.ZP,{onClick:this.newItem.bind(this,!1),tooltip:(0,B.Z)("New Contact"),image:Wi.md4.small}),ape(po.ZP,{onClick:this.deleteSelected,disabled:this.state.contact.id===Ed.s,image:Wi.M2k.small,tooltip:(0,B.Z)("other","Delete")})),ape(po.ZP,{onClick:this.onCompose,tooltip:(0,B.Z)("Compose mail to contact"),disabled:this.state.contact.id===Ed.s,image:Wi.XTV.small})))),0===this.state.items.length&&(this.state.filter?this.renderNoContactFound():this.renderEmptyState()),(0,ss.jsx)(Eue,{ref:this._tree,nodes:this.state.items,keyAccess:this.props.keyAccess,onCreate:this.onCreate,onEdit:this.onEdit,focusTree:this.focusTree,prefValues:this.props.prefValues,onItemSelected:this.onItemSelected}),this.state.items.length>0&&ape("section",{className:Fi()("panel-contacts-edit","outerScrollbar",{collapsed:this.state.editorHeight===p.mT}),style:{flexBasis:this.state.editorHeight}},void 0,ape(Zm.Z,{onSlidebarPosition:this.onSlidebarPosition,onStop:this.onSlideBarStop,onDoubleClick:this.onSlidebarToggle,returnOffset:!0,position:"bottom"}),this.state.editorHeight>p.mT&&e?(0,ss.jsx)(Yue,{ref:this._editor,contact:e,onEdit:this.onEdit},e.id):lpe)]})}}const cpe=(0,Bu.Z)(dpe,rpe);var upe;function ppe(e,t,n,i){upe||(upe="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:upe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const hpe=(0,ux.extendMoment)(W()),gpe=[{text:(0,B.Z)("Date"),value:"visitTime",fullScreenTitle:(0,B.Z)("Sort by Date")},{text:(0,B.Z)("Title"),value:"title",fullScreenTitle:(0,B.Z)("Sort by Title")},{text:(0,B.Z)("Address"),value:"address",fullScreenTitle:(0,B.Z)("Sort by Address")},{text:(0,B.Z)("Views"),value:"visitCount",fullScreenTitle:(0,B.Z)("Sort by Page Views")}];class mpe extends Li.PureComponent{static contextType=ts.Z;hasLoadedData=!1;refSearch=Li.createRef();constructor(e){super(e);const t=function(){let e=i7({range:hpe.range(hpe().startOf("day"),hpe().endOf("day"))});const t=Dn.Z.getSync("HISTORY_PANEL");if(t&&t.startTime&&t.endTime){const n=O8.Z.getTimeByRange({rangePicker:t.rangePicker,startTime:hpe(t.startTime),endTime:hpe(t.endTime)});e={...e,...n}}else{const t=O8.Z.getTimeByRange({rangePicker:e.rangePicker});e={...e,endTime:t.endTime?t.endTime:e.endTime,startTime:t.startTime?t.startTime:e.startTime}}return e}();this.state={filter:t,nodes:O8.Z.getTreeNodes(t),oldestDate:O8.Z.getOldestDate()}}componentDidMount(){O8.Z.addListener(this.#un)}componentDidUpdate(e){!e.open&&this.props.open&&this.refSearch.current?.focusField(),this.props.open&&!this.hasLoadedData&&(this.hasLoadedData=!0,Me.loadAll())}componentWillUnmount(){O8.Z.removeListener(this.#un)}#un=()=>{this.setState((e=>{const{filter:t}=e;return{nodes:O8.Z.getTreeNodes(t),oldestDate:O8.Z.getOldestDate()}}))};onSearch=e=>{Dn.Z.set({HISTORY_PANEL:{rangePicker:e.rangePicker,startTime:e.startTime.valueOf(),endTime:e.endTime.valueOf()}}),this.setState({filter:e,nodes:O8.Z.getTreeNodes(e)})};onSearchDomain=e=>{e=nI(e);const{filter:t}=this.state,n={...t,text:e,parsedFilter:F8(e),searchURL:!0};this.onSearch(n)};onSortChange=(e,t)=>{if(1===e)return;const{filter:n}=this.state,i={...n,sortOrder:e,sortField:t};this.onSearch(i)};renderHistory=()=>0===O8.Z.getNumerOfItems()?ppe("div",{className:"panel-empty-state"},void 0,ppe("span",{dangerouslySetInnerHTML:{__html:Wi.dgq}}),ppe("h1",{},void 0,(0,B.Z)("No browsing history to show")),ppe("p",{},void 0,(0,B.Z)("As soon as you start browsing, your history will show here."))):this.state.nodes.length>0?ppe("section",{className:"outerScrollbar"},void 0,ppe(n7,{fullView:!1,inManager:!1,nodes:this.state.nodes,filter:this.state.filter,onSearchDomain:this.onSearchDomain})):ppe("section",{},void 0,ppe("p",{},void 0,(0,B.Z)("No browsing history data for selected period.")));render(){if(!this.props.open)return null;const{filter:e}=this.state,{nodes:t}=this.state;return ppe("div",{className:"panel",id:"history-panel"},void 0,ppe("header",{},void 0,ppe(im,{title:this.props.title,showCloseButton:this.props.showCloseButton}),ppe("div",{className:"toolbar toolbar-default toolbar-wrap"},void 0,(0,ss.jsx)(H8,{ref:this.refSearch,showPicker:!0,search:this.onSearch,filter:e,minDate:this.state.oldestDate,hasHistory:0!==t.length,showClearBtn:!0}))),t.length>0&&ppe(Mm,{fields:gpe,onSortChange:this.onSortChange,keyAccess:this.props.keyAccess,sortField:e.sortField,sortOrder:e.sortOrder,fullsize:!1,manualSorting:!1}),this.renderHistory())}}const fpe=mpe;var vpe;function ype(e,t,n,i){vpe||(vpe="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:vpe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class bpe extends Li.PureComponent{static contextType=ts.Z;markdownFormatter=new _9({quotes:(0,B.Z)("“”‘’")});refRender=Li.createRef();constructor(e){super(e);const t=this.props.attachments.map((e=>e.content?`[${e.content}]: chrome://vivaldi-data/synced-store/${e.content}`:"")).join("\n"),n=`${this.props.body}\n\n${t}\n`;this.state={markup:n}}componentDidMount(){this.refRender.current&&(this.refRender.current.scrollTop=this.props.initialScrollPosition||0)}onScroll=({currentTarget:e})=>{this.props.onScrollValueChange&&this.props.onScrollValueChange(e.scrollTop)};selectAll=e=>{const{document:t,getSelection:n}=this.context;e.focus();const i=n();i&&i.removeAllRanges();const s=t.createRange();s.selectNodeContents(e),i&&i.addRange(s)};onKeyDown=e=>{const{getSelection:t}=this.context;switch(e.key){case"a":return void(e.ctrlKey&&(e.preventDefault(),this.selectAll(e.currentTarget)));case"Escape":{const e=t();return void(e&&e.removeAllRanges())}}};render(){const{className:e}=this.props,t=this.markdownFormatter.getRawMarkup(this.state.markup);return(0,ss.jsx)("div",{ref:this.refRender,onMouseUp:e=>function(e,t){if(t.button!==es.Z.kLeft)return;const{vivaldiWindowId:n,HTMLAnchorElement:i}=e,s=t.target;if(s instanceof i&&s.href){const e=s.getAttribute("href");if(!e||e&&e.startsWith("#"))return;const{metaKey:i,shiftKey:o,ctrlKey:a,altKey:r,button:l}=t,{allowOverride:d,...u}=(0,La.ZP)(n,{metaKey:i,shiftKey:o,ctrlKey:a,altKey:r,button:l});if(!d)return;c.ZP.openURL(n,s.href,{...u,inCurrent:!1,inBackground:d?C.Z.get(I.kTabsOpenNewInBackground):u.inBackground})}}(this.context,e),onKeyDown:this.onKeyDown,className:Fi()("MarkdownRender",e),tabIndex:"0",onScroll:this.onScroll,children:ype("div",{dangerouslySetInnerHTML:{__html:t}})})}}const Spe=bpe;class wpe extends Li.PureComponent{_isIMEOpen=!1;state={content:this.props.content};refContent=Li.createRef();focus=()=>{this.refContent.current?.focus()};reset=(0,Ae.Z)((()=>{this.setState({content:this.props.content})}),h7.mS,{leading:!1,trailing:!0});_save=(0,Ae.Z)((()=>{this.waitForCompositionEnd.then((()=>{this.props.onSave(this.state.content)}))}),h7.mS,{leading:!1,trailing:!0});handleContentChange=({currentTarget:e})=>{this.props.onChange(e.value),this.setState({content:e.value},this._save)};waitForCompositionEnd=Promise.resolve();resolveComposition=Lr.Z;_handleCompositionStart=()=>{this._isIMEOpen=!0,this.waitForCompositionEnd=(()=>new Promise((e=>{this.resolveComposition=e})))()};_handleCompositionEnd=()=>{this._isIMEOpen=!1,this.resolveComposition()};handleKeyDown=e=>{(e.metaKey||e.ctrlKey)&&"s"===e.key&&(e.preventDefault(),this.props.onSave(this.state.content)),"Escape"===e.key&&this._isIMEOpen&&(e.preventDefault(),e.stopPropagation())};handleFocus=e=>{e.persist(),e.currentTarget.selectionStart=this.props.content.length,e.currentTarget.selectionEnd=this.props.content.length};render(){const{disabled:e,className:t}=this.props,{content:n}=this.state;return(0,ss.jsx)("textarea",{ref:this.refContent,className:t,placeholder:(0,B.Z)("Note"),title:(0,B.Z)("Write a note"),value:n,disabled:e,onFocus:this.handleFocus,onChange:this.handleContentChange,onCompositionStart:this._handleCompositionStart,onCompositionEnd:this._handleCompositionEnd,onKeyDown:this.handleKeyDown,onBlur:this.props.onBlur})}}var Cpe;function Ape(e,t,n,i){Cpe||(Cpe="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Cpe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function Ipe({windowId:e,disabled:t,onToggleMarkDown:n,onDoCapture:i,onOpenDialog:s,keyAccess:o,viewMarkdown:a,noteId:r}){const l=t?-1:o;return Ape("div",{className:"toolbar toolbar-default"},void 0,Ape("div",{className:"toolbar-group"},void 0,Ape("div",{className:"button-toolbar"},void 0,Ape("button",{disabled:t,onClick:i,title:(0,B.Z)("Add capture of selected area or full page"),tabIndex:l,dangerouslySetInnerHTML:{__html:Wi.F_h}})),Ape(W9,{onOpenDialog:s,disabled:t,keyAccess:l,noteId:r}),Ape("div",{className:"button-toolbar"},void 0,Ape("button",{className:"button-toolbar"+(a?" button-pressed":""),disabled:t,onClick:n,title:a?(0,B.Z)("Switch to Editor"):(0,B.Z)("Switch Markdown View"),tabIndex:l,dangerouslySetInnerHTML:{__html:Wi.Pje}}))),Ape("div",{className:"button-toolbar open-in-tab-button"},void 0,Ape("button",{disabled:t,onClick:()=>function(e,t){c.ZP.openURL(e,pn.jk.internalUrl("notes",t),{singleton:!0})}(e,r),title:(0,B.Z)("Open in Tab"),tabIndex:l,dangerouslySetInnerHTML:{__html:Wi.vvh.medium}})))}function Tpe(e,{title:t,content:n,url:s}){const o={};return"string"==typeof s&&(o.url=(0,rl.q9)(s.trim())),void 0!==t&&(o.title=t),void 0!==n&&(o.content=n),async function(e,t){const n=await se.Z.notes.update(e,t);if(!i.Z.runtime.lastError)return n}(e,o)}function Zpe(e){return{id:e.note?.id??"",url:e.note?.url,title:e.note?.title,content:e.note?.content,attachments:"note"===e.note?.type?e.note.children:void 0}}class Epe extends Li.Component{static contextType=ts.Z;refFolderName=Li.createRef();refContainer=Li.createRef();refTextEditor=Li.createRef();_id=crypto.randomUUID();_pageContext={};_useOmni=Oi.Z.isEnabled("omnibox");state=Zpe(this.props);componentDidMount(){this._useOmni?(Ov.Z.updateState(this._id,{typedUrl:this.props.note?.url??""}),Rv.addListener(this._onUrlFieldStoreChanged,(e=>e.get(this._id)))):(sb.updateState(this._id,{typedUrl:this.props.note?.url??""}),rb.addListener(this._onUrlFieldStoreChanged,(e=>e.get(this._id)))),h7.ZP.addListener(this._onNoteStoreChanged)}componentDidUpdate(e,t){this.props.note&&this.props.note.content!==t.content&&this.updateState()}componentWillUnmount(){if(this._useOmni?(Rv.removeListener(this._onUrlFieldStoreChanged),Ov.Z.reset(this._id)):(rb.removeListener(this._onUrlFieldStoreChanged),sb.reset(this._id)),h7.ZP.removeListener(this._onNoteStoreChanged),!this.props.note)return;const{id:e,content:t,url:n}=this.state;Tpe(e,{content:"string"==typeof t?t:void 0,url:n})}updateState=(0,Ae.Z)((()=>{(0,Ra.sT)(this.context.document,this.refTextEditor.current?.refContent.current??null)||this.setState({...Zpe(this.props)},(()=>this.refTextEditor.current?.reset()))}),h7.mS,{trailing:!0,leading:!1});focusPrimaryInput=()=>{if(!this.props.note)return;h7.ZP.isFolder(this.props.note)?this.refFolderName.current?.focus():this.refTextEditor.current?.focus()};_doCapture=()=>{const e=this.props.note;var t;e&&(t=this.context.vivaldiWindowId,new Promise((e=>{C.Z.get(I.kPanelsAsOverlayEnabled)&&jn.Z.toggleContent(t,"PanelNotes"),setTimeout((()=>e()),200)}))).then((()=>{$a.Z.captureFromNote(this.context.vivaldiWindowId,e.id)}))};_openUrl=e=>{if(es.Z.isContextMenuButton(e.button))return;const t=(0,rl.q9)(this.props.note?.url??"");if(!t)return;const n=this.context.vivaldiWindowId,{metaKey:i,shiftKey:s,ctrlKey:o,altKey:a,button:r}=e,{allowOverride:l,...d}=(0,La.ZP)(n,{metaKey:i,shiftKey:s,ctrlKey:o,altKey:a,button:r});c.ZP.openURL(n,t,d)};_toggleMarkdown=()=>{this._saveUrlAndContent(),this.props.toggleMarkdown()};_saveUrlAndContent=async()=>{const{note:e}=this.props;if(!e||"trash"===e.type)return Promise.resolve();const{url:t,content:n}=this.state;return await Tpe(e.id,{url:t,content:"string"==typeof n?n:void 0})};_saveContent=e=>{const{note:t}=this.props;t&&Tpe(t.id,{content:e})};_onUrlFieldStoreChanged=()=>{const{typedUrl:e}=this._useOmni?Rv.getUrlfieldState(this._id):rb.getUrlfieldState(this._id);e!==this.state.url&&this.setState({url:e})};_onNoteStoreChanged=e=>{if("note"===this.props.note?.type){const e=h7.ZP.getNodeById(this.props.note.id);e&&this.setState({attachments:e.children})}};handleTitleChange=({currentTarget:e})=>{const{note:t}=this.props;if(!t)return;const n=e.value;this.setState({title:n},(()=>{Tpe(this.state.id,{title:n})}))};handleTitleKeyUp=e=>{e.keyCode!==xa.Z.KEY_RETURN&&e.keyCode!==xa.Z.KEY_ENTER||(e.stopPropagation(),e.preventDefault(),this.props.focusTree())};onUrlBlur=()=>{const{note:e}=this.props;if(!e||"trash"===e.type)return;const{id:t,url:n}=this.state;Tpe(t,{url:n})};onTextBlur=()=>{const{note:e}=this.props;if(!e||"trash"===e.type)return;const{id:t,content:n}=this.state;"string"==typeof n&&Tpe(t,{content:n})};deleteAttachment=e=>{this.props.note&&zn.Z.removeNode(e)};handleTextEditorChange=e=>{this.setState({content:e})};handleFocus=e=>{e.currentTarget.select()};render(){const{note:e}=this.props,t=e&&!h7.ZP.isFolder(e),n=e&&h7.ZP.isFolder(e),i=!e,s=e?W()(e.dateAdded).format("l, LTS"):"",o=e?W()(e.dateModified).format("l, LTS"):"",a=Boolean(!e||h7.ZP.isSeparator(e)||n);return(0,ss.jsxs)("div",{className:Fi()("NotesEditor","cardview",{"NotesEditor--HasAttachments":e&&"note"===e.type&&e.children&&e.children.length>0}),ref:this.refContainer,onKeyDown:this.props.onKeyDown,children:[Ape(Ipe,{windowId:this.context.vivaldiWindowId,disabled:a,onToggleMarkDown:this._toggleMarkdown,onDoCapture:this._doCapture,keyAccess:this.props.keyAccess,viewMarkdown:this.props.viewMarkdown,noteId:e?e.id:"-1",onOpenDialog:this.props.onOpenDialog}),t&&!this.props.viewMarkdown&&e&&Ape("span",{className:"NotesEditor-Editor-Background"},void 0,(0,ss.jsx)(wpe,{ref:this.refTextEditor,onBlur:this.onTextBlur,className:"NotesEditor-Editor",disabled:a,content:e.content||"",onChange:this.handleTextEditorChange,onSave:this._saveContent},e.id)),t&&this.props.viewMarkdown&&e&&Ape(Spe,{body:e.content||"",attachments:[]},e.content?e.content.length:"-1"),n&&e&&Ape("div",{className:"folder"},void 0,(0,ss.jsx)("input",{ref:this.refFolderName,type:"text",placeholder:(0,B.Z)("Folder"),title:(0,B.Z)("Edit folder name"),value:this.state.title,disabled:"trash"===e.type,onFocus:this.handleFocus,onChange:this.handleTitleChange,onKeyUp:this.handleTitleKeyUp})),i&&Ape("div",{className:"NotesEditor-EmptyPlaceholder ",onClick:this.props.onAdd},void 0,(0,B.Z)("Add a new note")),e&&"note"===e.type&&Ape(z9,{className:"NotesEditor-Attachments",attachments:this.state.attachments||[],onRemoveAttachment:this.deleteAttachment}),Ape("div",{className:Fi()("NotesEditor-Metadata",{disabled:a})},void 0,Ape("button",{className:"NotesEditor-MetaIcon NotesEditor-MetaIcon--Url",title:(0,B.Z)("Go to address"),disabled:a,tabIndex:a?-1:this.props.keyAccess,onClick:this._openUrl,onAuxClick:this._openUrl,dangerouslySetInnerHTML:{__html:Wi.iD7}}),this._useOmni?Ape(ib,{onBlur:this.onUrlBlur,autoFocus:!1,title:(0,B.Z)("Enter webpage address"),className:"cardview address",disabled:a,displayUrl:e?.url??"",typedUrl:this.state.url,autocompletionEnabled:!0,typedHistoryEnabled:!1,pageId:this._id,pageContext:this._pageContext,placeholder:e?(0,B.Z)("Address"):null,inputId:this._id,urlFragments:null}):Ape(ZS,{onBlur:this.onUrlBlur,autoFocus:!1,title:(0,B.Z)("Enter webpage address"),className:"cardview address",disabled:a,displayUrl:e?.url??"",typedUrl:this.state.url,autocompletionEnabled:!0,typedHistoryEnabled:!1,pageId:this._id,pageContext:this._pageContext,placeholder:e?(0,B.Z)("Address"):null,inputId:this._id,urlFragments:null}),Ape("div",{className:"NotesEditor-Created dateCreated"},void 0,Ape("div",{className:"NotesEditor-MetaIcon",dangerouslySetInnerHTML:{__html:Wi.V_c}}),Ape("span",{className:"NotesEditor-MetaIcon-Label"},void 0,(0,B.Z)("Created:")),Ape("span",{},void 0,s)),Ape("div",{className:"NotesEditor-Modified dateModified",title:(0,B.Z)("Date modified")},void 0,Ape("div",{className:"NotesEditor-MetaIcon",dangerouslySetInnerHTML:{__html:Wi.JHW}}),Ape("span",{className:"NotesEditor-MetaIcon-Label"},void 0,(0,B.Z)("Modified:")),Ape("span",{},void 0,o)))]})}}const kpe=Epe;var _pe,Npe=n(34155);function Ppe(e,t,n,i){_pe||(_pe="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:_pe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Dpe=[I.kKeyboardTabToAll,I.kNotesPanelEditorHeight,I.kNotesPanelShowMarkdown],Mpe=[{text:(0,B.Z)("Title"),value:"title",fullScreenTitle:(0,B.Z)("Sort by Title")},{text:(0,B.Z)("Address"),value:"url",fullScreenTitle:(0,B.Z)("Sort by Address")},{text:(0,B.Z)("Content"),value:"content",fullScreenTitle:(0,B.Z)("Sort by Content")},{text:(0,B.Z)("Created"),value:"dateAdded",fullScreenTitle:(0,B.Z)("Sort by Date Created")},{text:(0,B.Z)("Modified"),value:"dateModified",fullScreenTitle:(0,B.Z)("Sort by Last Modified Date")}];class Ope extends Li.PureComponent{static contextType=ts.Z;_editor=Li.createRef();_tree=Li.createRef();canDrop=!1;editorMaxHeight=900;refPanel=Li.createRef();refToolbar=Li.createRef();constructor(e){super(e);const t=C.Z.get(I.kNotesPanelSorting);this.state={hasNotes:h7.ZP.hasNotes(),selectedNote:void 0,filter:"",editorHeight:this.props.prefValues[I.kNotesPanelEditorHeight],sorting:{sortOrder:t.sortOrder,sortField:t.sortField,comparator:this.sortComparator}}}componentDidMount(){Yn.ZP.addListener(this._onPanelStoreChange),this.context.addEventListener("resize",this._onWindowResize,!1),this._onWindowResize()}componentWillUnmount(){Yn.ZP.removeListener(this._onPanelStoreChange),this.context.removeEventListener("resize",this._onWindowResize)}componentDidUpdate(e,t){!e.open&&this.props.open&&Npe.nextTick((()=>this._applyTransitionState()))}_onWindowResize=()=>{const e=this.refPanel.current?.getBoundingClientRect().height;this.editorMaxHeight=e?e-250:900};_onStoreChange=(e,t)=>{switch(e.reason){case"added":{if(!t)return void this.setState({hasNotes:!0});const n=h7.ZP.getNodeById(e.id);this.setState({selectedNote:n},(()=>{n&&(this._tree.current?.selectById(e.id),this._editor.current?.focusPrimaryInput())}));break}case"changed":if(this.state.selectedNote?.id!==e.id)return;case"init":if(this.state.selectedNote){const e=this.state.selectedNote.id;this.setState({selectedNote:h7.ZP.getNodeById(e)})}}const n=h7.ZP.hasNotes();!n&&this.state.hasNotes&&(this.setState({selectedNote:void 0}),this.focusSearch()),this.setState({hasNotes:n})};onDropPanelButton=e=>{const t=e.dataTransfer.getData("text/plain"),n=this.context.vivaldiWindowId;(async function(e,t){const n=Ce.ZP.getActivePage(e);if(n){const{id:e,url:i}=n;if(await se.Z.utilities.getSelectedText(e)===t)return i}})(n,t).then((e=>{this.onBeforeCreate(!0),e?zn.Z.createNote(n,{content:t,url:e,type:"note"}):zn.Z.createNote(n,{content:t,type:"note"})}))};_applyTransitionState=()=>{const e=this.context.vivaldiWindowId,t=Yn.ZP.getTransitionState(e,"PanelNotes");jn.Z.clearTransitionState(e,"PanelNotes"),this._tree.current&&t?(t.selectId&&this._tree.current.selectById(t.selectId),t.setFocus&&this.focusTree()):this._tree.current&&!0===this.state.hasNotes?this.focusTree():this.focusSearch()};_onPanelStoreChange=()=>{const e=Yn.ZP.getChangeReason();if(this.props.open)switch(e){case"setFocus":(0,Ra.sT)(this.context.document,this.refPanel.current)||this.focusTree();break;case"display":Npe.nextTick((()=>this._applyTransitionState()))}};onItemSelected=e=>{this.setState({selectedNote:e})};unSelectAll=()=>{this._tree.current?.unSelectAll(),this.setState({selectedNote:void 0})};onSortChange=(e,t)=>{this.setState((n=>({sorting:{...n.sorting,sortOrder:e,sortField:t}}))),w.Z.set(I.kNotesPanelSorting,{sortOrder:e,sortField:t})};sortComparator=(e,t)=>{if("trash"===e.type)return 1;if("trash"===t.type)return-1;if(h7.ZP.isFolder(e)&&!h7.ZP.isFolder(t))return-1;if(h7.ZP.isFolder(t)&&!h7.ZP.isFolder(e))return 1;const{sortOrder:n,sortField:i}=this.state.sorting;if("title"===i)return this.sortByTitle(e,t,n);return ds.Z.getDefaultComparator(n,i)(e,t)};sortByTitle=(e,t,n)=>{if(n<=ds.Z.NO_SORTING)return 0;const i=e.title||tee(e),s=t.title||tee(t);return i||s?i?s?n===ds.Z.ASCENDING_SORT?i.toLowerCase().localeCompare(s.toLowerCase()):s.toLowerCase().localeCompare(i.toLowerCase()):n===ds.Z.ASCENDING_SORT?-1:1:n===ds.Z.ASCENDING_SORT?1:-1:0};getSelectedItem=()=>this._tree.current?.getSelectedItem();onBeforeCreate=e=>{e&&(this.props.prefValues[I.kNotesPanelShowMarkdown]&&this.toggleMarkdown(),this.state.editorHeight===p.mT&&this.resizeToDefault()),this.setState({filter:""})};onAddNote=()=>{this._tree.current?.onAddNote()};onAddFolder=()=>{this._tree.current?.onAddFolder()};deleteSelectedItems=()=>{this._tree.current?.deleteSelectedItems()};handleFilterChange=e=>{this.setState({filter:e})};onSlidebarPosition=(e,t)=>{this.setState((e=>({editorHeight:Math.max(Math.min(e.editorHeight-t,this.editorMaxHeight),p.mT)})))};onSlidebarStop=()=>{this.setState((e=>{let t=e.editorHeight;return t<=p.Cn&&(t=p.mT),w.Z.set(I.kNotesPanelEditorHeight,parseInt(t)),{editorHeight:t}}))};toggleMarkdown=()=>{w.Z.toggle(I.kNotesPanelShowMarkdown,!0,!1)};resizeToDefault=()=>{this.setState((e=>{let t=e.editorHeight;return t>p.Cn?(t=p.mT,w.Z.set(I.kNotesPanelEditorHeight,parseInt(t))):(t=300,w.Z.reset(I.kNotesPanelEditorHeight)),{editorHeight:t}}))};focusSearch=()=>{this.refToolbar.current?.focusSearch()};focusTree=()=>{this._tree.current?.refTreeList.current?.focusTree()};onContextMenu=e=>{e.nativeEvent.buttons>0&&this.unSelectAll(),this._tree.current?.onContextMenu(e)};onDragEnter=e=>{this.canDrop=-1!==e.dataTransfer.types.findIndex((e=>"text/plain"===e)),e.preventDefault(),e.stopPropagation()};onDragOver=e=>{this.canDrop&&e.nativeEvent.dataTransfer&&(e.nativeEvent.dataTransfer.dropEffect="copy"),e.preventDefault(),e.stopPropagation()};onDrop=e=>{if(this.canDrop){const t=e.dataTransfer.getData("text/plain");t.length>0&&this._tree.current?.onAddNote({content:t})}e.preventDefault(),e.stopPropagation()};_onKeyDown=e=>{if("Escape"===e.key)return this.focusTree(),e.stopPropagation(),void e.preventDefault()};render(){if(!this.props.open)return null;const e=this.state.editorHeight>p.mT,t=Boolean(!this.state.selectedNote||this.state.selectedNote&&"trash"===this.state.selectedNote.type);return(0,ss.jsxs)("div",{ref:this.refPanel,className:"panel",id:"notes-panel",children:[Ppe("header",{},void 0,Ppe(im,{title:this.props.title,showCloseButton:this.props.showCloseButton}),(0,ss.jsx)(bee,{ref:this.refToolbar,filter:this.state.filter,hasNotes:this.state.hasNotes,isDeleteDisabled:t,onFilterValueChange:this.handleFilterChange,onAddNote:this.onAddNote,onDeleteSelectedItems:this.deleteSelectedItems,onAddFolder:this.onAddFolder})),!0===this.state.hasNotes&&Ppe(Mm,{fields:Mpe,onSortChange:this.onSortChange,keyAccess:this.props.prefValues[I.kKeyboardTabToAll],sortField:this.state.sorting.sortField,sortOrder:this.state.sorting.sortOrder}),Ppe("section",{className:"outerScrollbar",onClick:this.unSelectAll,onContextMenu:!0===this.state.hasNotes?this.onContextMenu:null},void 0,!1===this.state.hasNotes&&Ppe("div",{className:"no-notes",onDragEnter:this.onDragEnter,onDragOver:this.onDragOver,onDrop:this.onDrop},void 0,Ppe(vee,{onAddNote:this.onAddNote})),(0,ss.jsx)(hee,{ref:this._tree,settings:"NOTES_TREE",filter:this.state.filter,sorting:this.state.sorting,onBeforeCreate:this.onBeforeCreate,onItemSelected:this.onItemSelected,onStoreChange:this._onStoreChange})),Ppe("div",{className:Fi()("notes-editor",{collapsed:this.state.editorHeight===p.mT}),onDragEnter:!0===this.state.hasNotes?null:this.onDragEnter,onDragOver:!0===this.state.hasNotes?null:this.onDragOver,onDrop:!0===this.state.hasNotes?null:this.onDrop,style:{height:this.state.editorHeight}},void 0,Ppe(Zm.Z,{onSlidebarPosition:this.onSlidebarPosition,onStop:this.onSlidebarStop,onDoubleClick:this.resizeToDefault,returnOffset:!0,position:"bottom"}),e&&(0,ss.jsx)(kpe,{ref:this._editor,note:this.state.selectedNote,onAdd:this.onAddNote,onOpenDialog:this.props.onOpenDialog,toggleMarkdown:this.toggleMarkdown,viewMarkdown:this.props.prefValues[I.kNotesPanelShowMarkdown],keyAccess:this.props.prefValues[I.kKeyboardTabToAll],onKeyDown:this._onKeyDown,focusTree:this.focusTree},this.state.selectedNote?this.state.selectedNote.id:-1))]})}}const xpe=(0,Bu.Z)(Ope,Dpe);var Lpe;function Rpe(e,t,n,i){Lpe||(Lpe="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Lpe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Bpe=[{text:(0,B.Z)("title","Title"),value:"title",fullScreenTitle:(0,B.Z)("Sort by Title")},{text:(0,B.Z)("Read state"),value:"read",fullScreenTitle:(0,B.Z)("Sort by Read State")},{text:(0,B.Z)("Date"),value:"lastUpdate",fullScreenTitle:(0,B.Z)("Sort by Date Updated")},{text:(0,B.Z)("Address"),value:"url",fullScreenTitle:(0,B.Z)("Sort by Address")}];class Fpe extends Li.PureComponent{refTreeList=Li.createRef();static contextType=ts.Z;state={sorting:this.props.prefValues[I.kReadingListPanelSorting]};onSortChange=(e,t)=>{const n={sortOrder:e,sortField:t};this.setState({sorting:n}),w.Z.set(I.kReadingListPanelSorting,{sortOrder:e,sortField:t})};sortComparator=(e,t)=>{const{sortOrder:n,sortField:i}=this.state.sorting;return ds.Z.getDefaultComparator(n,i)(e,t)};getSelectedIds=()=>(this.refTreeList.current?.getAllSelectedItems()||[]).map((e=>e.id));deleteSelected=()=>{this.refTreeList.current?.onDelete()};onClickUrl=e=>{c.ZP.openURL(this.context.vivaldiWindowId,e,{singleton:!0}),x.Bz(e,!0)};onClick=(e,t)=>{this.onClickUrl(t.url)};onItemsActivated=(e,t)=>{t.forEach((e=>{e.url&&this.onClickUrl(e.url)}))};onOpenSelected=()=>{const e=this.getSelectedIds();e&&e.forEach((e=>{e&&this.onClickUrl(e)}))};onClickMark=(e,t,n)=>{n&&(0,ms.ZP)(n),x.Bz(e,t)};copy=e=>{Gp.Z.copyTextToClipboard(e)};onRemoveSelected=async e=>{e.forEach((e=>x.Od(e)))};rowComponent=e=>{const t=e.node;return Rpe("div",{className:"readinglist-item-large"},t.url,Rpe(KS,{onClickMark:this.onClickMark,onClickRemove:()=>{},entry:t}))};getMenuCapability=async(e,t,n)=>{const i=this.context.vivaldiWindowId;switch(e.action){case"CONTEXT_OPEN":return{handler:()=>this.onOpenSelected(),isVisible:()=>Boolean(n),...t(i,e,{})};case"CONTEXT_MARK_READ":return{handler:()=>this.onClickMark(n.url,!0),isVisible:()=>Boolean(n)&&!n.read,...t(i,e,{})};case"CONTEXT_MARK_UNREAD":return{handler:()=>this.onClickMark(n.url,!1),isVisible:()=>Boolean(n)&&n.read,...t(i,e,{})};case"CONTEXT_COPY_URL":return{handler:()=>this.copy(n.url),isVisible:()=>Boolean(n),...t(i,e,{})};default:return{...t(i,e,{})}}};getMenuVisibility=(e,t)=>{if(!t)return!1;switch(e.action){case"CONTEXT_OPEN":case"CONTEXT_COPY_URL":case"CONTEXT_MARK_READ":case"CONTEXT_MARK_UNREAD":case"CONTEXT_DELETE":return!0;default:return!1}};menu={name:"readinglist",getCapability:this.getMenuCapability,getVisibility:this.getMenuVisibility};render(){const e=this.props.prefValues[I.kReadingListPanelSingleClickOpens],t={sortOrder:this.state.sorting.sortOrder,sortField:this.state.sorting.sortField,comparator:this.sortComparator};return(0,ss.jsxs)(ss.Fragment,{children:[Rpe(Mm,{fields:Bpe,manualSorting:!1,onSortChange:this.onSortChange,keyAccess:this.props.keyAccess,compact:!0,sortField:this.state.sorting.sortField,sortOrder:this.state.sorting.sortOrder}),Rpe("section",{className:"outerScrollbar"},void 0,(0,ss.jsx)(Ps,{ref:this.refTreeList,settings:"READING_LIST_TREE",rowComponent:this.rowComponent,nodes:this.props.nodes,onSelect:this.props.onItemSelected,menu:this.menu,hasChildren:gE.Z,isFolder:gE.Z,onItemsActivated:this.onItemsActivated,onItemClick:e?this.onClick:void 0,onItemDoubleClick:e?void 0:this.onClick,delete:this.onRemoveSelected,enableDragAndDrop:!1,supportsInlineEdit:!1,sorting:t,rowHeight:68}))]})}}const Wpe=Fpe;var Upe;function Vpe(e,t,n,i){Upe||(Upe="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Upe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Hpe=[I.kReadingListPanelSingleClickOpens,I.kReadingListPanelSorting];function Gpe(e){return e.map((e=>({...e,id:e.url})))}class $pe extends Li.PureComponent{static contextType=ts.Z;winId=this.context.vivaldiWindowId;_tree=Li.createRef();state={items:[],selected:"",isUrlSupported:!1,filter:""};componentDidMount(){const{selectWindow:e}=this.context;LS.Z.addListener(this._onStoreChanged),Ce.ZP.addListener(this._onPageStoreChanged,e),this._onStoreChanged(),this._onPageStoreChanged()}componentWillUnmount(){LS.Z.removeListener(this._onStoreChanged),Ce.ZP.removeListener(this._onPageStoreChanged)}_onStoreChanged=()=>{const e=this.state.filter?LS.Z.getFilter(this.state.filter):LS.Z.getList();this.setState({items:Gpe(e)})};_onPageStoreChanged=()=>{const{url:e}=Ce.ZP.unsafeGetActivePage(this.winId);this.setState({isUrlSupported:x.MT(e)})};addCurrentPage=()=>x.IH(this.context.vivaldiWindowId);deleteSelected=()=>this._tree.current?.deleteSelected();onToggleReadStatus=()=>{this.setState((e=>{const t=e.items.find((t=>t.id===e.selected));t&&x.Bz(t.url,!t.read)}))};handleFilterChange=e=>{const t=e.target.value;this.setState({filter:t}),Li.startTransition((()=>{const e=Gpe(t?LS.Z.getFilter(t):LS.Z.getList());this.setState({items:e})}))};focusTree=()=>{this._tree.current&&this._tree.current.refTreeList.current?.focusTree()};onItemSelected=e=>{if(e){if(e.id===this.state.selected)return;this.setState({selected:e.id})}else this.setState({selected:""})};renderEmptyState=()=>Vpe("div",{className:"panel-empty-state"},void 0,Vpe("span",{dangerouslySetInnerHTML:{__html:Wi.MLu}}),Vpe("h1",{},void 0,(0,B.Z)("Add your first entry to the reading list")),Vpe("p",{className:"faded-text"},void 0,(0,B.Z)("Click the “+“ button to add the current webpage to the reading list.")));render(){if(!this.props.open)return null;const e=this.state.items.find((e=>e.url===this.state.selected)),t=0===this.state.items.length&&!this.state.filter;return Vpe("div",{className:"panel",id:"readinglist"},void 0,Vpe("header",{},void 0,Vpe(im,{title:this.props.title,showCloseButton:this.props.showCloseButton}),Vpe("div",{className:"toolbar toolbar-default toolbar-wrap",role:"toolbar","aria-label":(0,B.Z)("toolbar label","Reading List")},void 0,Vpe("input",{type:"search",placeholder:(0,B.Z)("verb","Search"),value:this.state.filter,disabled:t,onChange:this.handleFilterChange}),Vpe("div",{className:"toolbar"},void 0,Vpe("div",{className:"toolbar-group"},void 0,Vpe(po.ZP,{onClick:this.addCurrentPage,tooltip:(0,B.Z)("Add current page"),disabled:!this.state.isUrlSupported,image:Wi.md4.small}),Vpe(po.ZP,{onClick:this.deleteSelected,disabled:""===this.state.selected,image:Wi.M2k.small,tooltip:(0,B.Z)("other","Delete")})),Vpe(po.ZP,{onClick:this.onToggleReadStatus,tooltip:e?.read?(0,B.Z)("Set as Unread"):(0,B.Z)("Set as Read"),disabled:""===this.state.selected,image:e?.read?Wi.sgm.small:Wi.D7r.small})))),t?this.renderEmptyState():(0,ss.jsx)(Wpe,{ref:this._tree,nodes:this.state.items,keyAccess:this.props.keyAccess,focusTree:this.focusTree,prefValues:this.props.prefValues,onItemSelected:this.onItemSelected}))}}const Kpe=(0,Bu.Z)($pe,Hpe);var zpe;function jpe(e,t,n,i){zpe||(zpe="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:zpe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var Ype=jpe("g",{fill:"none",stroke:"currentColor"},void 0,jpe("path",{d:"M1 1.5h3.5v-1h7v1h-8H15"}),jpe("path",{d:"M3.5 3.5v11h9v-11zm3 8v-4zm3 0v-4z"})),Xpe=jpe("g",{fill:"none",stroke:"currentColor"},void 0,jpe("path",{d:"M1.5,1.5 L1.5,9.5"}),jpe("path",{d:"M9.5,1.5 L9.5,9.5"}),jpe("path",{d:"M1.5,9.5 L9.5,9.5"}),jpe("path",{d:"M1.5,1.5 L9.5,1.5"}),jpe("path",{d:"M3.5,9.5 L3.5,11.5"}),jpe("path",{d:"M11.5,3.5 L11.5,11.5"}),jpe("path",{d:"M3.5,11.5 L11.5,11.5"}),jpe("path",{d:"M9.5,3.5 L11.5,3.5"}),jpe("path",{d:"M5.5,11.5 L5.5,13.5"}),jpe("path",{d:"M13.5,5.5 L13.5,13.5"}),jpe("path",{d:"M5.5,13.5 L13.5,13.5"}),jpe("path",{d:"M11.5,5.5 L13.5,5.5"})),Qpe=jpe("g",{transform:"translate(3, 2)",fill:"none",stroke:"currentColor"},void 0,jpe("polygon",{points:"2.5 5.5 6.5 9.5 7.5 9.5 7.5 5.5 11.5 2.5 9.5 0.5 6.5 4.5 2.5 4.5"}),jpe("polygon",{points:"0 12 3 8 4 9"})),qpe=jpe("g",{fill:"none",stroke:"currentColor"},void 0,jpe("path",{d:"M13 12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h10Z"}),jpe("path",{fill:"currentColor",d:"M6 12h4v2H6z",opacity:".5"}),jpe("path",{fill:"currentColor",d:"M1 10h14a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2Z"})),Jpe=jpe("g",{fill:"none",stroke:"currentColor"},void 0,jpe("path",{d:"M10 15C11.1046 15 12 14.1046 12 13V3C12 1.89543 11.1046 1 10 1H6C4.89543 1 4 1.89543 4 3V13C4 14.1046 4.89543 15 6 15H10Z",stroke:"currentColor"}),jpe("path",{d:"M4 13H12V13C12 14.1046 11.1046 15 10 15H6C4.89543 15 4 14.1046 4 13V13Z",fill:"currentColor"}),jpe("circle",{cx:"8",cy:"3.25",r:"0.75",fill:"currentColor"})),ehe=jpe("g",{fill:"none",stroke:"currentColor"},void 0,jpe("path",{stroke:"currentColor",d:"M11 15a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h6Z"}),jpe("path",{fill:"currentColor",d:"M3 2a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v1H3V2ZM3 14a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1H3v1Z"})),the=jpe("g",{fill:"none",stroke:"currentColor"},void 0,jpe("path",{d:"M13.246 7.338C14.268 7.668 15 8.558 15 9.6c0 1.326-1.17 2.9-2.634 2.9H3.5C2.044 12.5 1 10.922 1 9.6c0-1.051.735-1.944 1.77-2.269C2.913 6.354 3.827 5.6 4.936 5.6c.584 0 1.114.208 1.505.549C6.92 4.899 8.22 4 9.75 4c1.934 0 3.5 1.432 3.5 3.2l-.004.138Z"})),nhe=jpe("polygon",{points:"16.5 3.5 16.5 0.5 1.5 0.5 1.5 3.5"}),ihe=jpe("path",{d:"M1.5,3.5 L1.5,12.5"}),she=jpe("path",{d:"M16.5,3.5 L16.5,12.5"}),ohe=jpe("path",{d:"M1.5,12.5 L16.5,12.5"}),ahe=jpe("path",{d:"M4.5,0.5 L4.5,3.5"}),rhe=jpe("path",{d:"M7.5,0.5 L7.5,3.5"}),lhe=jpe("polygon",{points:"4.5 6.5 4.5 8.5 7.5 6.5",strokeWidth:"2"});class dhe extends Li.PureComponent{render(){const e="trash"===this.props.shape,t=Fi()({"folder-icon":!e,"folder-trash":e});return"emoji"===this.props.shape||"workspace"===this.props.shape?this.props.url?jpe(Ri.ZP,{className:"workspace-icon",url:this.props.url,loadType:"emoji"===this.props.shape?"emoji":"faviconFromCache"}):(console.warn("Url missing for workspace/emoji type"),null):jpe("svg",{width:"16",height:"16",viewBox:"0 0 16 16",className:t,style:this.props.leftMargin?{marginLeft:this.props.leftMargin}:null},void 0,e&&Ype,"stack"===this.props.shape&&Xpe,"pinned"===this.props.shape&&Qpe,"desktop"===this.props.shape&&qpe,"phone"===this.props.shape&&Jpe,"tablet"===this.props.shape&&ehe,"sync"===this.props.shape&&the,"folder"===this.props.shape&&jpe("g",{transform:"translate(-1, 1)",fill:"none",stroke:"currentColor"},void 0,nhe,ihe,she,ohe,ahe,rhe,this.props.activeWindow&&lhe))}}const che=dhe;var uhe;function phe(e,t,n,i){uhe||(uhe="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:uhe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const hhe=!1;function ghe(e,t,n){const i=(e,t,n,i,s)=>{const o=(e,t,n,i)=>{const s=[];for(let o=0;o<n.length;o++){const a=n[o];if(a.group){let n=s.find((e=>"stack"===e.type&&e.group===a.group));if(n||(n={type:"stack",id:a.id.toString()+"_tabstack",index:t+s.length,parentId:e,group:a.group,url:"",name:(0,B.Z)("title","Stack")+" - "+(a.groupName||a.name),rawName:a.groupName||a.name,quarantine:!1,children:[]},s.push(n)),n.children){const e=n.children.length;n.children.push({type:"tab",id:a.id.toString(),index:e,parentId:n.id,group:"",url:a.url,name:a.name,quarantine:a.quarantine})}}else void 0!==i&&i!==a.quarantine||s.push({type:"tab",id:a.id.toString(),index:t+s.length,parentId:e,group:"",url:a.url,name:a.name,quarantine:a.quarantine})}return s},a=i.filter((e=>e.pinned===n)).map(((n,i)=>{if(void 0===s||s===n.quarantine)return{type:"tab",id:n.id.toString(),index:t+i,parentId:e,group:n.group,groupName:n.group?n.fixedGroupName:void 0,url:n.url,name:n.fixedName||(0,pn.d6)(n.url,n.name||n.url),quarantine:n.quarantine}})).filter(Boolean);if(n){const n=e+"_pinned";return[{type:"pinned",id:n,parentId:e,index:t,group:"",url:"",name:(0,B.Z)("Pinned Tabs"),children:o(n,0,a,s),quarantine:!1}]}return o(e,t,a)},s=(e,n,s)=>t.windows.map((t=>{const n=t.id.toString()+"_"+e,o=i(n,0,!0,t.tabs,s),a=i(n,o.length,!1,t.tabs,s),r=[...o,...a];if(r.length)return{type:"window",id:n,index:0,parentId:e,group:"",name:(0,B.Z)("title","Window"),url:"",quarantine:!1,children:r}})).filter(Boolean).map(((e,t)=>({...e,index:t+n}))),o=(e,n,s)=>t.workspaces.map((t=>{const n=t.id.toString()+"_"+e,o=i(n,0,!0,t.tabs,s),a=i(n,o.length,!1,t.tabs,s),r=[...o,...a];if(r.length)return{type:"workspace",id:n,index:0,parentId:e,group:"",name:(0,B.Z)("title","Workspace")+" - "+t.name,rawName:t.name,url:"",icon:t.icon,emoji:t.emoji,quarantine:!1,children:r}})).filter(Boolean).map(((e,t)=>({...e,index:t+n}))),a=s(e,0,void 0),r=o(e,a.length,void 0);let l=[];if(n){const t="trash",n=s(t,0,!0),i=o(t,n.length,!0);l=[{type:"trash",id:t,index:a.length+r.length,parentId:e,group:"",name:(0,B.Z)("Trash"),url:"",quarantine:!1,children:[...n,...i]}]}return[...a,...r,...l]}function mhe(e,t,n){if(!t.trim())return ghe(e,n,hhe);const i=(e,t)=>e.name.toLowerCase().includes(t),s=function(e,t,n){let o=!1;for(let a=0;a<e.length;a++){const r=e[a];let l=!1;if(r.children){const e={...r,children:[]};s(r.children,e.children,n)&&(t.push(e),o=!0,l=!0)}if(!l&&i(r,n)){const e={...r};t.push(e),o=!0}}return o},o=[];return s(ghe(e,n,hhe),o,t.toLowerCase()),o}class fhe extends Li.PureComponent{static contextType=ts.Z;refTreeList=Li.createRef();constructor(e){super(e),this.state={rootId:"0",nodes:mhe("0",e.filter,e.content)}}componentDidUpdate(e){this.props.content===e.content&&this.props.filter===e.filter||this.setState({nodes:mhe("0",this.props.filter,this.props.content)})}_getNodeById=e=>{const t=function(n){for(let i=0;i<n.length;i++){const s=n[i];if(s.id===e)return s;if(s.children){const e=t(s.children);if(e)return e}}};return t(this.state.nodes)};_isFolder=e=>"tab"!==e.type;_isTab=e=>"tab"===e.type;_isStack=e=>"stack"===e.type;_isPin=e=>"pinned"===e.type;_isWorkspace=e=>"workspace"===e.type;_isWindow=e=>"window"===e.type;_isPinnable=e=>this._isTab(e)||this._isStack(e);_isPinned=e=>{if(this._isPinnable(e)){let t=this._getNodeById(e.parentId);for(;t;){if("pinned"===t.type)return!0;t=this._getNodeById(t.parentId)}}return!1};_isStacked=e=>{if(this._isTab(e)){let t=this._getNodeById(e.parentId);for(;t;){if(this._isStack(t))return!0;t=this._getNodeById(t.parentId)}}return!1};_isValidForEdit=e=>{const t=this._getNodeById(e);return!!t&&(this._isWorkspace(t)||this._isStack(t)||this._isTab(t))};_hasChildren=e=>this._isFolder(e)&&Boolean(e.children?.length);_handleExpandClick=(e,t)=>{const n=e.altKey;this.refTreeList.current?.toggleSelectedExpansion(t,n)};_getChildren=e=>e.children??[];_getWindow=e=>{let t=e;for(;t&&!this._isWindow(t);)t=this._getNodeById(t.parentId);return t};_getWorkspace=e=>{let t=e;for(;t&&!this._isWorkspace(t);)t=this._getNodeById(t.parentId);return t};_getGroup=e=>{let t=e;for(;t&&!this._isStack(t);)t=this._getNodeById(t.parentId);return t};_getSelected=()=>(this.refTreeList.current?.getAllSelectedItems()??[]).map((e=>this._getNodeById(e.id))).filter(Boolean);_getSelectedUrls=()=>this._getSelected().filter((e=>this._isTab(e))).map((e=>e.url));_openSession=e=>{const t=this._getSelected().filter((e=>this._isTab(e))).map((e=>Number(e.id)));li.Z.open(this.context.vivaldiWindowId,[this.props.content.id],e,t)};_openInTab=(e,t)=>{const n={inCurrent:e,inBackground:!e&&(t||C.Z.get(I.kTabsOpenNewInBackground)),inNewWindow:!1,allowOverride:!1,incognito:!1};zi.ZP.openUrls(this.context.vivaldiWindowId,this._getSelectedUrls(),n,!0)};_openInNewWindow=e=>{const t={inCurrent:!1,inBackground:!1,inNewWindow:!0,allowOverride:!1,incognito:e};zi.ZP.openUrls(this.context.vivaldiWindowId,this._getSelectedUrls(),t,!0)};_onNodeDoubleClick=(e,t)=>{this._isTab(t)&&e.button!==es.Z.kCenter&&this._openSession(!0)};_onNodeMouseUp=(e,t)=>{this._isTab(e)&&t.button===es.Z.kCenter&&(this._openSession(!0),t.preventDefault(),t.stopPropagation())};_openWithEventModifiers=e=>{this._openSession(!0)};_isValidDragSource=e=>this._isTab(e)||this._isStack(e);_validateForDrag=e=>{const t=e.map((e=>this._getNodeById(e))).filter(Boolean);if(1===t.length&&this._isStack(t[0]))return[t[0].id];return t.filter((e=>this._isStack(e))).length>1?[]:e.map((e=>this._getNodeById(e))).filter(Boolean).filter((e=>this._isTab(e))).map((e=>e.id))};_getDragData=(e,t)=>{const n=t.map((e=>this._getNodeById(e))).filter(Boolean).filter((e=>this._isTab(e)));switch(e){case"text/plain":case"vivaldi/x-title":{const e=[];return n.forEach((t=>{e.push(t.name)})),e.join("\r\n")}case"text/uri-list":case"vivaldi/x-uri-list":{const e=[];return n.forEach((t=>{this._isTab(t)&&e.push(t.url)})),e.join("\r\n")}default:return""}};_getDropSupport=(e,t)=>{const n={available:!1,onto:!1,edge:"both"};return t.dataTransfer.types.some((e=>e===Mce.AP))&&(n.available=!0,n.onto=this._isFolder(e),this._isWindow(e)?n.edge="none":this._isPin(e)&&(n.edge="below")),n};_copy=(e,t)=>{const{clipboardData:n}=e;if(n){const e=t.map((e=>e.url)).filter(Boolean).map((e=>pn.jk.getHoverUrl(e))).join("\n");n.setData("text/plain",e),n.setData("text/uri-list",e),n.setData("vivaldi/x-uri-list",e)}e.preventDefault()};_onDelete=e=>li.Z.modifyContent(this.props.content.id,{ids:this._validateForDeletion(e).map((e=>Number(e))),remove:!0});_onDeleteWithoutQuarantine=()=>{const e=this._getSelected().filter((e=>this._isTab(e))).map((e=>Number(e.id)));return li.Z.modifyContent(this.props.content.id,{ids:e,remove:!0})};_setPinned=e=>{const t=this._getSelected(),n=t.filter((e=>"stack"===e.type)).map((e=>this._getChildren(e))).filter(Boolean).reduce(((e,t)=>e.concat(t)),[]),i=t.filter((e=>this._isTab(e))).filter((e=>-1===n.findIndex((t=>t===e.id)))),s=[...n,...i].map((e=>Number(e.id)));li.Z.modifyContent(this.props.content.id,{pin:e,ids:s})};_getNodesForNewStack=()=>this._getSelected().filter((e=>!this._isWindow(e)&&!this._isWorkspace(e))).flatMap((e=>e.children||e)).flatMap((e=>e.children||e));_setTabStack=e=>{const t=this._getNodesForNewWindow();if(t.length>0){const n=t.map((e=>Number(e.id)));e?li.Z.modifyContent(this.props.content.id,{tabstack:!0,ids:n,target:{beforeTabId:-1,group:crypto.randomUUID()}}):li.Z.modifyContent(this.props.content.id,{tabstack:!1,ids:n})}};_getNodesForNewWindow=()=>this._getSelected().filter((e=>!this._isWindow(e)&&!this._isWorkspace(e))).flatMap((e=>e.children||e)).flatMap((e=>e.children||e));_setWindow=()=>{const e=this._getNodesForNewWindow();if(e.length>0){const t=[];e.forEach((e=>{const n=this._getGroup(e);n&&!t.find((e=>e.group===n.group))&&t.push({group:n.group,alias:crypto.randomUUID()})})),li.Z.modifyContent(this.props.content.id,{window:!0,ids:e.map((e=>Number(e.id))),groupAliases:t})}};_setWorkspace=()=>{const e=this._getNodesForNewWindow();if(e.length>0){const t=[];e.forEach((e=>{const n=this._getGroup(e);n&&!t.find((e=>e.group===n.group))&&t.push({group:n.group,alias:crypto.randomUUID()})})),li.Z.modifyContent(this.props.content.id,{workspace:!0,ids:e.map((e=>Number(e.id))),groupAliases:t,workspaceId:Date.now(),workspaceState:{groups:t,item:{id:Date.now(),name:(0,B.Z)("command","New Workspace"),icon:GF.Z.getDefaultIcon(),emoji:""}}})}};_validateForDeletion=e=>e.map((e=>this._getNodeById(e))).filter(Boolean).filter((e=>Boolean(e?.quarantine))).map((e=>e.id));_setQuarantine=async e=>{const t=this._getSelected().filter((e=>this._isTab(e))).map((e=>Number(e.id)));li.Z.modifyContent(this.props.content.id,{ids:t,quarantine:e})};_getTitle=e=>{const t=this._getNodeById(e);return t?t.rawName??t.name:""};_getId=e=>e.split("_")[0];_setTitle=(e,t)=>{const n=this._getNodeById(e);if(n)switch(n.type){case"workspace":li.Z.modifyContent(this.props.content.id,{ids:[Number(this._getId(e))],type:"workspace",title:t});break;case"stack":n.children?.length&&li.Z.modifyContent(this.props.content.id,{ids:n.children.map((e=>Number(e.id))),type:"group",title:t});break;case"tab":n.children||li.Z.modifyContent(this.props.content.id,{ids:[Number(n.id)],type:"tab",title:t})}};_canMoveUpDown=(e,t)=>this._isTab(e)||this._isStack(e);_onMove=(e,t,n)=>{const i=e=>{for(const t of e){if(this._isTab(t))return t;if(this._isStack(t)&&t.children){const e=i(t.children);if(e)return e}}for(const t of e)if(t.children){const e=i(t.children);if(e)return e}},s=void 0===t.parentId?void 0:this._getNodeById(t.parentId),o=this._getNodeById(e[0]);if(s&&o){let n,a,r;this._isPin(s)||this._isPinned(s)?this._isPinned(o)||(n=!0):this._isPinned(o)&&(n=!1),this._isStack(s)?(this._getGroup(o)?.group??"")!==s.group&&(a=s.group):this._getGroup(o)&&(this._isStack(o)||(a=""));const l=this._getWorkspace(s);let d;l?(this._getWorkspace(o)?.id??"")!==l.id&&(r=Number(this._getId(l.id))):this._getWorkspace(o)&&(r=-1),this._isStack(o)&&(e=o.children?o.children.map((e=>e.id)):[]);const c=t.index??0;if(s.children&&s.children.length>c){const e=s.children,t=e[c];d=this._isTab(t)?t:i(e.slice(c))}const u=this._getWindow(s),p={beforeTabId:d?Number(d.id):-1};void 0!==a&&(p.group=a),void 0!==n&&(p.pinned=n),u&&(p.windowId=Number(this._getId(u.id))),void 0!==r&&(p.workspace=r),li.Z.modifyContent(this.props.content.id,{move:!0,ids:e.map((e=>Number(this._getId(e)))),target:p})}return Promise.resolve([])};_handleMouseEnter=(e,t)=>{this._isTab(t)&&u.Z.setStatus(e,pn.jk.getHoverUrl(t.url))};_handleMouseLeave=e=>{u.Z.clearStatus(e)};getMenuCapability=async(e,t,n)=>{const i=this.context.vivaldiWindowId,s="tab"===n.type,o=this.refTreeList.current?.getSelectedCount()??0;switch(e.action){case"CONTEXT_OPEN_SESSION_IN_NEW_WINDOW":return{handler:()=>this._openSession(!0),isVisible:()=>s,...t(i,e,{})};case"CONTEXT_OPEN_SESSION":return{handler:()=>this._openSession(!1),isVisible:()=>s,...t(i,e,{})};case"CONTEXT_OPEN_IN_NEW_TAB":return{handler:()=>this._openInTab(!1,!1),isVisible:()=>s,...t(i,e,{})};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{handler:()=>this._openInTab(!1,!0),isVisible:()=>s&&!C.Z.get(I.kTabsOpenNewInBackground),...t(i,e,{})};case"CONTEXT_OPEN_IN_TAB":return{handler:()=>this._openInTab(!0,!1),isVisible:()=>s,...t(i,e,{})};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{handler:()=>this._openInNewWindow(!1),isVisible:()=>s,...t(i,e,{})};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{handler:()=>this._openInNewWindow(!0),isVisible:()=>s,...t(i,e,{})};case"CONTEXT_OPEN_LINK_MENU":return{handler:()=>{},isVisible:()=>s,...t(i,e,{})};case"CONTEXT_QUARANTINE":return{handler:()=>this._setQuarantine(!n.quarantine),isVisible:()=>s,checked:n.quarantine,...t(i,e,{})};case"CONTEXT_DELETE_WITHOUT_QUARANTINE":return{handler:()=>this._onDeleteWithoutQuarantine(),isVisible:()=>s,...t(i,e,{})};case"CONTEXT_PIN":return{handler:()=>this._setPinned(!this._isPinned(n)),isVisible:()=>this._isPinnable(n)&&!this._isPinned(n),...t(i,e,{})};case"CONTEXT_UNPIN":return{handler:()=>this._setPinned(!this._isPinned(n)),isVisible:()=>this._isPinnable(n)&&this._isPinned(n),...t(i,e,{})};case"CONTEXT_NEW_STACK":return{handler:()=>this._setTabStack(!0),isVisible:()=>this._getNodesForNewStack().length>=2,...t(i,e,{})};case"CONTEXT_REMOVE_STACK":return{handler:()=>this._setTabStack(!1),isVisible:()=>1===o&&this._isStack(n),...t(i,e,{})};case"CONTEXT_NEW_WINDOW":return{handler:()=>this._setWindow(),isVisible:()=>this._getNodesForNewWindow().length>0,...t(i,e,{})};case"CONTEXT_NEW_WORKSPACE":return{handler:()=>this._setWorkspace(),isVisible:()=>this._getNodesForNewWindow().length>0,...t(i,e,{})};default:return{...t(i,e,{})}}};getMenuVisibility=(e,t)=>{if(t)switch(e.action){case"CONTEXT_COPY":return this._isTab(t);case"CONTEXT_RENAME":return this._isValidForEdit(t.id);case"CONTEXT_DELETE":return t.quarantine;case"CONTEXT_EXPAND_ALL":case"CONTEXT_COLLAPSE_ALL":return!0;default:return!1}else switch(e.action){case"CONTEXT_EXPAND_ALL":case"CONTEXT_COLLAPSE_ALL":return!0;default:return!1}};getFolderShape=e=>{switch(e.type){case"trash":return"trash";case"stack":return"stack";case"pinned":return"pinned";case"workspace":if(e.emoji)return"emoji";if(e.icon)return"workspace"}return"folder"};getFolderIconUrl=e=>{if("workspace"===e.type){if(e.emoji)return e.emoji;if(e.icon)return e.icon}return""};_getChildCount=e=>{let t=0;const n=e=>{e.forEach((e=>{this._isFolder(e)&&e.children?n(e.children):t++}))};return this._isFolder(e)&&e.children&&(n(e.children),0===t&&this._isWindow(e)&&(t=1)),t};rowComponent=e=>{const t=e.node,n=e.level,i=(n+1)*ks,s=n*ks,o=s+10,a=t.url,r=t.quarantine&&!0,l=t.children?this._getChildCount(t):0,{favIconUrl:d,favIconLoadType:c}=(0,pn.yl)(a,""),u=this.context.vivaldiWindowId;return[phe("label",{title:t.name,onMouseEnter:()=>this._handleMouseEnter(u,t),onMouseLeave:()=>this._handleMouseLeave(u)},"window__panel__"+t.id,this._hasChildren(t)&&phe("span",{className:"expand-icon",style:{marginLeft:s},onMouseUp:e=>this._handleExpandClick(e,t.id),dangerouslySetInnerHTML:{__html:Wi.nfH}}),this._isFolder(t)&&phe(che,{leftMargin:this._hasChildren(t)?0:i,shape:this.getFolderShape(t),url:this.getFolderIconUrl(t)}),!this._isFolder(t)&&(0,ss.jsxs)(ss.Fragment,{children:[phe("span",{style:{marginLeft:o}}),a.startsWith("<svg")?phe("span",{className:"svg-icon",dangerouslySetInnerHTML:{__html:a}}):phe(Ri.ZP,{className:"fav-icon",url:d,loadType:c})]}),void 0!==e.inlineEditText&&phe("input",{type:"text",value:e.inlineEditText,onChange:e.onChange,onFocus:e.onFocus,onBlur:e.onBlur,autoFocus:!0}),void 0===e.inlineEditText&&r&&phe("span",{},void 0,phe("s",{},void 0,t.name)),void 0===e.inlineEditText&&!r&&phe("span",{},void 0,t.name),this._hasChildren(t)&&phe("span",{className:"item-count"},void 0,l))]};getRowComponentProps=e=>({...e});menu={name:"sessioncontentlist",getCapability:this.getMenuCapability,getVisibility:this.getMenuVisibility};render(){return(0,ss.jsx)(Ps,{ref:this.refTreeList,rootId:this.state.rootId,nodes:this.state.nodes,folderMode:"expand",settings:"CONTENT_TREE",onItemMouseUp:this._onNodeMouseUp,onItemDoubleClick:this._onNodeDoubleClick,onItemsActivated:this._openWithEventModifiers,supportsUpDownMove:this._canMoveUpDown,onMove:this._onMove,isValidToEdit:this._isValidForEdit,validateForDeletion:this._validateForDeletion,isValidDragSource:this._isValidDragSource,validateForDrag:this._validateForDrag,mimeType:Mce.AP,getDragData:this._getDragData,getDropSupport:this._getDropSupport,getTitle:this._getTitle,saveTitle:this._setTitle,onCopy:this._copy,delete:this._onDelete,rowComponent:this.rowComponent,getRowComponentProps:this.getRowComponentProps,hasChildren:this._hasChildren,isFolder:this._isFolder,menu:this.menu,supportsInlineEdit:!0})}}const vhe=fhe;var yhe;function bhe(e,t,n,i){yhe||(yhe="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:yhe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var She=bhe("br",{});function whe({onAdd:e}){return bhe("div",{className:"notes-welcome"},void 0,bhe("div",{className:"note-empty-state",onClick:e},void 0,bhe("span",{dangerouslySetInnerHTML:{__html:Wi.vOf}}),bhe("h1",{},void 0,(0,B.Z)("Sessions")),bhe("p",{className:"faded-text"},void 0,(0,B.Z)("Save and restore your tabs and Workspaces with Sessions.")),She,bhe("p",{className:"faded-text"},void 0,(0,B.Z)("Click the “+” button above to save your first Session backup."))))}var Che,Ahe=n(34155);function Ihe(e,t,n,i){Che||(Che="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Che,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const The=[{text:(0,B.Z)("Title"),value:"name",fullScreenTitle:(0,B.Z)("Sort by Title")},{text:(0,B.Z)("Created"),value:"createDateJS",fullScreenTitle:(0,B.Z)("Sort by Date Created")},{text:(0,B.Z)("Modified"),value:"modifyDateJS",fullScreenTitle:(0,B.Z)("Sort by Date Modified")}],Zhe={id:-1,windows:[],workspaces:[]},Ehe=[I.kKeyboardTabToAll,I.kSessionsPanelSorting,I.kSessionsSaveDays,I.kSessionsSaveOnExit];class khe extends Li.PureComponent{static contextType=ts.Z;refTree=Li.createRef();nodeRef=Li.createRef();id=crypto.randomUUID();constructor(e){super(e);const t=this.props.prefValues[I.kSessionsPanelSorting];this.state={mode:"main",content:Zhe,contentTitle:"",hasSessions:Mce.ZP.hasSessions(),autoSave:!0,sessionFilter:"",contentFilter:"",sorting:{sortOrder:t.sortOrder,sortField:t.sortField,comparator:this._sortComparator}}}componentDidMount(){Mce.ZP.addListener(this._onStoreChanged)}componentWillUnmount(){Mce.ZP.removeListener(this._onStoreChanged)}componentDidUpdate(e,t){!e.open&&this.props.open&&Mce.ZP.hasSessions()&&Ahe.nextTick((()=>this._focusTree()))}_onStoreChanged=e=>{const t=e=>void 0!==e&&e===this.state.content.id;switch(e.reason){case"init":case"added":this.setState({hasSessions:Mce.ZP.hasSessions()});break;case"deleted":this.setState({hasSessions:Mce.ZP.hasSessions()}),t(e.info?.item.id)&&this._onLeaveEdit();break;case"changed":if(e.info?.item){const n=e.info.item.id;t(n)&&this.setState({contentTitle:Mce.ZP.getTitle(n)})}break;case"content":if(e.info?.item.content){const n=e.info.item.content;(e.owner===this.id||t(n.id))&&this.setState({mode:"edit",content:n,contentTitle:Mce.ZP.getTitle(n.id)})}}};_onSortChange=(e,t)=>{this.setState((n=>({sorting:{sortOrder:e,sortField:t,comparator:n.sorting.comparator}}))),w.Z.set(I.kSessionsPanelSorting,{sortOrder:e,sortField:t})};_sortComparator=(e,t)=>{if(Mce.ZP.isTrashFolder(e.id))return 1;if(Mce.ZP.isTrashFolder(t.id))return-1;if(Mce.ZP.isAutoSaveNode(e.id))return 1;if(Mce.ZP.isAutoSaveNode(t.id))return-1;const{sortOrder:n,sortField:i}="history"===e.type&&"history"===t.type?{sortOrder:ds.Z.DESCENDING_SORT,sortField:"modifyDateJS"}:this.state.sorting;return ds.Z.getDefaultComparator(n,i)(e,t)};_getSelected=()=>this.refTree.current?.getSelected()??[];_focusTree=()=>{this.refTree.current?.focusTree()};_onSessionFilterChange=e=>{this.setState({sessionFilter:e.target.value})};_onContentFilterChange=e=>{this.setState({contentFilter:e.target.value})};_onAdd=()=>{this.refTree.current?.add()};_onDelete=()=>{this.refTree.current?.deleteSelected()};_onOpen=e=>{li.Z.open(this.context.vivaldiWindowId,e,!0)};_onEdit=e=>{li.Z.requestContent(e,this.id)};_onLeaveEdit=()=>{this.setState({mode:"main",content:Zhe,contentTitle:""})};_onEditFromButton=()=>{const e=this._getSelected();1===e.length&&li.Z.requestContent(e[0].id,this.id)};_onUpdateAutoSave=()=>{this.setState((e=>({autoSave:!e.autoSave})))};onAutosaveChanged=()=>{"on"!==this.props.prefValues[I.kSessionsSaveOnExit]?de.Z.showEnableSessionAutosaveDialog(this.context.vivaldiWindowId,{mode:"intro"}):w.Z.toggle(I.kSessionsSaveOnExit,"on","off")};getSaveDaysText=()=>{if("on"!==this.props.prefValues[I.kSessionsSaveOnExit])return"";const e=this.props.prefValues[I.kSessionsSaveDays];return 1===e?(0,B.Z)("Last day"):(0,B.Z)("$1 day","Last $1 days",[e])};renderHeader=()=>{const e="edit"===this.state.mode?(0,B.Z)('Edit "$1"',[this.state.contentTitle]):this.props.title;return Ihe("header",{},void 0,Ihe("div",{className:"toolbar-back-navigation",role:"toolbar","aria-label":(0,B.Z)("toolbar label","Session Editor")},void 0,"edit"===this.state.mode&&Ihe(po.ZP,{tooltip:(0,B.Z)("command","Go Back to Session List"),tabIndex:this.props.prefValues[I.kKeyboardTabToAll],onClick:this._onLeaveEdit,image:Wi.mgF.small}),Ihe(im,{title:e,showCloseButton:this.props.showCloseButton})),Ihe("div",{className:"toolbar toolbar-default toolbar-wrap",role:"toolbar","aria-label":(0,B.Z)("toolbar label","Sessions")},void 0,"main"===this.state.mode&&(0,ss.jsxs)(ss.Fragment,{children:[Ihe("input",{type:"search",className:"tabsearch",placeholder:(0,B.Z)("verb","Search"),value:this.state.sessionFilter,onChange:this._onSessionFilterChange}),Ihe("div",{className:"toolbar-group"},void 0,Ihe(po.ZP,{tooltip:(0,B.Z)("command","Save Tabs as Session"),tabIndex:this.props.prefValues[I.kKeyboardTabToAll],onClick:this._onAdd,image:Wi.md4.small}),Ihe(po.ZP,{tooltip:(0,B.Z)("command","Delete Session"),tabIndex:this.props.prefValues[I.kKeyboardTabToAll],onClick:this._onDelete,image:Wi.M2k.small})),Ihe(po.ZP,{tooltip:(0,B.Z)("command","Edit Session"),tabIndex:this.props.prefValues[I.kKeyboardTabToAll],onClick:this._onEditFromButton,image:Wi.NNg.small})]}),"edit"===this.state.mode&&(0,ss.jsx)(ss.Fragment,{children:Ihe("input",{type:"search",className:"tabsearch",placeholder:(0,B.Z)("verb","Search"),value:this.state.contentFilter,onChange:this._onContentFilterChange})})))};renderMain=()=>(0,ss.jsxs)(ss.Fragment,{children:[this.state.hasSessions&&Ihe(Mm,{fields:The,onSortChange:this._onSortChange,keyAccess:this.props.keyAccess,sortField:this.state.sorting.sortField,sortOrder:this.state.sorting.sortOrder}),!this.state.hasSessions&&Ihe(whe,{onAdd:this._onAdd}),Ihe("section",{className:"outerScrollbar"},void 0,(0,ss.jsx)(Vce,{ref:this.refTree,filter:this.state.sessionFilter,showFolders:!0,sorting:this.state.sorting,onOpen:this._onOpen,onEdit:this._onEdit})),Ihe("footer",{},void 0,Ihe("label",{title:this.getSaveDaysText()},void 0,Ihe("input",{type:"checkbox",checked:"on"===this.props.prefValues[I.kSessionsSaveOnExit],onChange:this.onAutosaveChanged}),Ihe("span",{},void 0,(0,B.Z)("verb","Automatic Session Backup"))))]});renderEdit=()=>Ihe("section",{className:"outerScrollbar"},void 0,Ihe(vhe,{content:this.state.content,filter:this.state.contentFilter}));render(){return this.props.open?(0,ss.jsxs)("div",{ref:this.nodeRef,className:"panel",id:"session-panel",children:[this.renderHeader(),"main"===this.state.mode&&this.renderMain(),"edit"===this.state.mode&&this.renderEdit()]}):null}}const _he=(0,Bu.Z)(khe,Ehe);var Nhe;function Phe(e,t,n,i){Nhe||(Nhe="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Nhe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const{minimalCreateEvent:Dhe}=Zl.ZP,Mhe=[I.kCalendarDisplayDensity,I.kCalendarOnboardingShown],Ohe=d2.Nw;let xhe=!1;function Lhe(e){return Phe("div",{className:"panel-empty-state"},void 0,Phe("span",{dangerouslySetInnerHTML:{__html:Wi.C1I}}),Phe("h1",{},void 0,(0,B.Z)("Add your first calendar account")),Phe("p",{className:"faded-text"},void 0,(0,B.Z)("You can add a local or online calendar to Vivaldi Calendar.")),Phe("input",{type:"button",onClick:()=>de.Z.showCalendarAccountDialog(e.windowId),value:(0,B.Z)("Add Calendar Account")}))}function Rhe(e){return Phe("div",{className:"panel-empty-state",onClick:e.onCreateTask},void 0,Phe("span",{dangerouslySetInnerHTML:{__html:Wi.C1I}}),Phe("h1",{},void 0,(0,B.Z)("Your task list is empty")),Phe("p",{},void 0,(0,B.Z)("Click the “Add Task” button to add a new task.")))}function Bhe(e){return Phe("div",{className:"panel-empty-state",onClick:e.onCreateTask},void 0,Phe("span",{dangerouslySetInnerHTML:{__html:Wi.C1I}}),Phe("h1",{},void 0,(0,B.Z)("No tasks found.")))}function Fhe(e){const t=Li.useContext(ts.Z),{stateHandler:n,calendarFilter:i,eventDraft:s,tasks:o,hasTasks:a,trashedEvents:r}=r2(Ohe),[l,d]=Li.useState(!1),c=(0,Ya.Z)(Mhe),u=Li.useMemo((()=>({pageId:Ohe,displayDensity:c[I.kCalendarDisplayDensity],isPanel:!0,isEditing:!!s,isWidget:!1,isTaskList:!0,handler:n})),[c,n,s]);if(!e.open)return xhe=!1,null;function p(){d(!0),n.editEvent(null,Dhe({task:!0}))}!1===xhe&&e.open&&(te.ZP.pollAllCalDAVAccounts(!0),xhe=!0),l&&!s&&d(!1);let h=null;return!l&&(0===El.Z.getCalendars().length||!c[I.kCalendarOnboardingShown]&&0===El.Z.getEvents().length&&!El.Z.getAccounts().some((e=>"local"!==e.account_type)))?h=Phe(Lhe,{windowId:t.vivaldiWindowId}):o.length||i.filterText||l?o.length||!i.filterText||l||(h=Phe(Bhe,{onCreateTask:p})):h=Phe(Rhe,{onCreateTask:p}),Phe("div",{className:"panel",id:"tasks_panel",onClick:function(e){e.stopPropagation(),s&&n.endEventEdit()}},void 0,Phe("header",{},void 0,Phe(im,{title:e.title,showCloseButton:e.showCloseButton}),Phe("div",{className:"toolbar toolbar-default",role:"toolbar","aria-label":(0,B.Z)("toolbar label","Tasks")},void 0,Phe("input",{type:"search",placeholder:(0,B.Z)("verb","Search"),title:(0,B.Z)("Type to filter tasks"),value:i.filterText,onChange:function(e){bO.Z.search(Ohe,e.target.value)}}),Phe(po.ZP,{title:(0,B.Z)("Add Task"),label:(0,B.Z)("Add Task"),tooltip:(0,B.Z)("Add a New Task"),onClick:p,image:Wi.md4.small}))),h,(!!o.length||l)&&Phe(yM.Provider,{value:u},void 0,Phe(DL,{filter:i,events:o,trashedEvents:r,editingEvent:s,displayMode:"agenda"})),a&&Phe("footer",{},void 0,Phe("label",{},void 0,Phe("input",{type:"checkbox",checked:i.showCompletedTasks,onChange:function(){bO.Z.showCompletedTasks(Ohe)}}),Phe("span",{},void 0,(0,B.Z)("Show Completed Tasks")))))}const Whe=Li.memo(Fhe);var Uhe;function Vhe(e,t,n,i){Uhe||(Uhe="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Uhe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class Hhe extends Li.PureComponent{refTreeList=Li.createRef();static contextType=ts.Z;winId=this.context.vivaldiWindowId;_languageFromCode=e=>{const t=this.props.languages.findIndex((t=>t.id===e));return-1===t?e:this.props.languages[t].historyName};_onNodesActivated=(e,t)=>{this.props.onActivated(t[0].id)};_onNodeDoubleClick=(e,t)=>{this.props.onActivated(t.id)};_onCopyAll=()=>{const{document:e}=this.context,t=e=>{const t=(this.refTreeList.current?.getAllSelectedItems()||[]).map((e=>e.id));this.props.onItemsCopy(e,t,!0)};e.addEventListener("copy",t),e.execCommand("copy"),e.removeEventListener("copy",t)};_onCopy=(e,t)=>{const n=t.map((e=>e.id));this.props.onItemsCopy(e,n,!1)};_getMenuCapability=async(e,t,n)=>{const i=this.winId;return"CONTEXT_COPY_ALL"===e.action?{handler:this._onCopyAll,isVisible:()=>Boolean(n),...t(i,e,{})}:{...t(i,e,{})}};_getMenuVisibility=(e,t)=>{if(!t)return!1;switch(e.action){case"CONTEXT_COPY":case"CONTEXT_DELETE":return!0;default:return!1}};clipByWord=e=>{if(e.length<=560)return e;const t=e.substring(0,560),n=t.lastIndexOf(" ");return t.substring(0,n)+"..."};getRowHeight=({index:e})=>this.props.nodes[e].translatedItem?.text?.length>140?98:68;rowComponent=e=>{const t=e.node,n=`${this._languageFromCode(t.srcItem.code)} → ${this._languageFromCode(t.translatedItem.code)}`;return Vhe("div",{className:["TranslatePanel-Row",t.translatedItem.text?.length<=140?"TranslatePanel-Row-Narrow":""].join(" "),title:(0,B.Z)("Go to full translation")},void 0,Vhe("label",{className:"TranslatePanel-Row-Heading"},t.id,Vhe("span",{},void 0,n)),Vhe("label",{className:"TranslatePanel-Row-Source"},void 0,Vhe("span",{},void 0,this.clipByWord(t.srcItem.text))),Vhe("label",{className:"TranslatePanel-Row-Result"},void 0,Vhe("span",{},void 0,this.clipByWord(t.translatedItem.text))))};menu={name:"translatehistory",getCapability:this._getMenuCapability,getVisibility:this._getMenuVisibility};render(){return Vhe("section",{className:"outerScrollbar"},void 0,(0,ss.jsx)(Ps,{ref:this.refTreeList,settings:"TRANSLATE_HISTORY_TREE",rowComponent:this.rowComponent,nodes:this.props.nodes,menu:this.menu,isFolder:gE.Z,hasChildren:gE.Z,delete:this.props.onItemsDelete,onSelect:Lr.Z,onCopy:this._onCopy,enableDragAndDrop:!1,onItemDoubleClick:this._onNodeDoubleClick,onItemsActivated:this._onNodesActivated,rowHeight:this.getRowHeight}))}}const Ghe=Hhe;var $he;function Khe(e,t,n,i){$he||($he="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:$he,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class zhe extends Li.PureComponent{render(){return this.props.showPlaceholder?Khe("textarea",{className:"TranslatePanel-TranslatedText",type:"text",placeholder:(0,B.Z)("Please wait"),readOnly:!0}):Khe("textarea",{className:"TranslatePanel-TranslatedText",type:"text",value:this.props.text,readOnly:!0})}}const jhe=zhe;var Yhe;function Xhe(e,t,n,i){Yhe||(Yhe="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Yhe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Qhe=[I.kPanelsTranslateAutomatic,I.kTranslateTargetLanguage,I.kVivaldiTranslateLanguageList],qhe=gs()((function(e){return $A.Z.getTranslationLocales().map((e=>({id:$A.Z.getTranslationCode(e.key),name:KA(e),historyName:e.value})))}));var Jhe=Xhe(Ri.ZP,{url:Wi.eIC,loadType:"faviconFromCache"});class ege extends Li.PureComponent{static contextType=ts.Z;_errorId=null;_hasLoadedHistory=!1;_idleId=null;_pendingText="";constructor(e){super(e),this.state={busy:!1,error:"none",history:[],showPlaceholder:!1,srcLanguage:"auto",srcStrings:[""],translatedText:"",viewMode:"main",translatePageIndex:0}}componentDidMount(){this._isMounted=!0,se.Z.tabsPrivate.onWebviewClickCheck.addListener(this._onWebviewClicked),se.Z.utilities.onBroadcastMessage.addListener(this._onBroadcastMessage),this._loadHistory(),this._runAutoTranslate(this.props.prefValues[I.kPanelsTranslateAutomatic])}componentWillUnmount(){this._isMounted=!1,this._idleId&&clearTimeout(this._idleId),se.Z.utilities.onBroadcastMessage.removeListener(this._onBroadcastMessage),se.Z.tabsPrivate.onWebviewClickCheck.removeListener(this._onWebviewClicked),this._hasLoadedHistory&&(se.Z.translateHistory.onAdded.removeListener(this._onAdded),se.Z.translateHistory.onMoved.removeListener(this._onMoved),se.Z.translateHistory.onRemoved.removeListener(this._onRemoved)),this._setError("none")}componentDidUpdate(e,t){!e.open&&this.props.open?(this._loadHistory(),this._runAutoTranslate(this.props.prefValues[I.kPanelsTranslateAutomatic])):e.open&&!this.props.open&&this._setError("none")}_loadHistory=()=>{this.props.open&&!this._hasLoadedHistory&&se.Z.translateHistory.get().then((e=>{this._isMounted&&(this._hasLoadedHistory=!0,se.Z.translateHistory.onAdded.addListener(this._onAdded),se.Z.translateHistory.onMoved.addListener(this._onMoved),se.Z.translateHistory.onRemoved.addListener(this._onRemoved),this.setState({history:e}))}))};_getItemById=e=>this.state.history.find((t=>t.id===e));_detectLanguage=async(e,t,n)=>{const i=await $A.Z.detectTextLanguage(e,n);return i&&t!==i?i:t};_onBroadcastMessage=e=>{if(!e.translate)return;const{winId:t,lang:n,text:i}=e.translate;t===this.context.vivaldiWindowId&&this.setState({srcStrings:[i],translatePageIndex:0,srcLanguage:n||"auto"},this._onTranslate)};_onAdded=(e,t)=>{this.setState((n=>{const i=[...n.history];return e.forEach(((e,n)=>{i.splice(t+n,0,e)})),{history:i}}))};_onMoved=(e,t)=>{const n=this.state.history.findIndex((t=>t.id===e));-1!==n&&n!==t&&this.setState((e=>{const i=[...e.history],s=i.splice(n,1);return i.splice(t>n?t-1:t,0,s[0]),{history:i}}))};_onRemoved=e=>{0===e.length?this.setState({history:[]}):this.setState((t=>{const n=[...t.history];return e.forEach((e=>{const t=n.findIndex((t=>t.id===e));-1!==t&&n.splice(t,1)})),{history:n}}))};_onSourceLanguageSelected=e=>{const{value:t}=e.currentTarget;this.setState({srcLanguage:t})};_onTargetLanguageSelected=e=>{const{value:t}=e.currentTarget;$A.Z.setTargetTranslationCode(t)};_onSrcEditChanged=e=>{this._setError("none");let t=[e.target.value];if(t[0].length>$A.k){if(-1===t[0].search(/[ ,\n.]/))return void this._setError("system");this._setError("NbCharExceeded"),t=this.splitSrcTextInPages(t[0])}this.setState((n=>({srcLanguage:e.target.value?n.srcLanguage:"auto",srcStrings:t,translatePageIndex:0,translatedText:"",showPlaceholder:!1})))};_onKeyDown=e=>{const{ctrlKey:t,altKey:n,shiftKey:i,metaKey:s}=e,o={ctrlKey:t,altKey:n,shiftKey:i,metaKey:s};"Enter"===e.key&&(0,As.VV)(o)&&(e.stopPropagation(),e.preventDefault(),this._onTranslate())};_onKeyDownMonitor=e=>{this._setError("none")};_onPaste=e=>{this.setState({srcLanguage:"auto"},(()=>{setTimeout((()=>{(C.Z.get(I.kPanelsTranslatePaste)||this.state.srcStrings.length>1)&&this._onTranslate()}))}))};_onWebviewClicked=(e,t,n,i,s)=>{const{document:o}=this.context;if(this.props.open&&this.props.prefValues[I.kPanelsTranslateAutomatic]&&e===this.context.vivaldiWindowId&&!1===t&&0===n){"WEBVIEW"===o.elementFromPoint(Math.round(i),Math.round(s))?.tagName&&this._getSelectionAndTranslate()}};_getSelectionAndTranslate=()=>{const e=Ce.ZP.unsafeGetActivePage(this.context.vivaldiWindowId);se.Z.utilities.getSelectedText(e.id,(e=>{e&&(e===this.getCurrentSrcText()&&(e=""),this.setState({srcLanguage:"auto",srcStrings:[e],translatePageIndex:0},this._onTranslate))}))};_toggleAutoTranslate=()=>{const e=!this.props.prefValues[I.kPanelsTranslateAutomatic];w.Z.set(I.kPanelsTranslateAutomatic,e),this._runAutoTranslate(e)};_runAutoTranslate=e=>{e&&(this.getCurrentSrcText()||this._getSelectionAndTranslate())};_onTranslate=async()=>{const e=this.getCurrentSrcText().trim();if(!$A.Z.canTranslateText(e))return void this.setState({translatedText:"",showPlaceholder:!1});if(this.state.busy)return void(this._pendingText=e);this._setError("none"),this.setState({translatedText:"",showPlaceholder:!0,busy:!0});let t=await this._detectLanguage(Ce.ZP.unsafeGetActivePage(this.context.vivaldiWindowId).id,this.state.srcLanguage,e);"auto"===t&&(t="");const n=t?$A.Z.getTranslationCode(t):"",i=$A.Z.getTranslationCode(this.props.prefValues[I.kTranslateTargetLanguage]),s=await se.Z.utilities.translateText(n,i,[e]);if(this._isMounted){if("no_error"!==s.error){this.setState({showPlaceholder:!1});let e="system";"unknown_language"===s.error?e="unknownLangServer":n&&(e="noDetect"),this._setError(e)}else{const e={id:"",srcItem:{code:s.detectedSourceLanguage,text:s.sourceText[0]},translatedItem:{code:i,text:s.translatedText[0]}};this._addToHistory(e),"auto"===this.state.srcLanguage&&this.setState({srcLanguage:s.detectedSourceLanguage})}this._idleId&&clearTimeout(this._idleId),this._idleId=setTimeout(this._idleEnds,1e3)}};_idleEnds=()=>{if(this._idleId&&clearTimeout(this._idleId),this._pendingText){const e=this._pendingText;this._pendingText="",this.setState({busy:!1,srcStrings:[e],translatePageIndex:0},this._onTranslate)}else this.setState({busy:!1})};_errorEnds=()=>{this._errorId&&clearTimeout(this._errorId),this._setError("none")};_addToHistory=e=>{he.ZP.isIncognitoOrGuest(this.context.vivaldiWindowId)?(this.setState({translatedText:e.translatedItem.text,showPlaceholder:!1}),this._setError("none")):se.Z.translateHistory.add(e,0).then((t=>{const n=i.Z.runtime.lastError;n&&console.error(n.message),this.setState({translatedText:e.translatedItem.text,showPlaceholder:!1}),this._setError("none")}))};_onItemActivated=e=>{const t=this._getItemById(e);t&&this.setState({viewMode:"main"},(()=>{$A.Z.setTargetTranslationCode(t.translatedItem.code),this.setState({srcLanguage:t.srcItem.code,srcStrings:[t.srcItem.text],translatePageIndex:0,translatedText:t.translatedItem.text,showPlaceholder:!1})}))};_onItemsDelete=e=>se.Z.translateHistory.remove(e).then((()=>Promise.resolve()));_onClearHistory=()=>{se.Z.translateHistory.reset(0)};_onClearText=()=>{this._pendingText="",this.setState({srcLanguage:"auto",srcStrings:[""],translatePageIndex:0,translatedText:""})};_onSwapLanguage=()=>{"auto"!==this.state.srcLanguage&&this.setState((e=>{$A.Z.setTargetTranslationCode(e.srcLanguage);const t=e.translatedText.length>0;return{srcLanguage:this.props.prefValues[I.kTranslateTargetLanguage],srcStrings:t?[e.translatedText]:e.srcStrings,translatePageIndex:t?0:e.translatePageIndex,translatedText:t?e.srcStrings[e.translatePageIndex]:e.translatedText}}))};_onItemsCopy=(e,t,n)=>{const i=t.map((e=>this._getItemById(e))).filter(Boolean),s=[];i.forEach((e=>{n&&s.push(e.srcItem.text),s.push(e.translatedItem.text)})),e.clipboardData&&(e.clipboardData.setData("text/plain",s.join("\r\n")),e.stopPropagation(),e.preventDefault())};_setError=e=>{const{document:t}=this.context;"none"===e?"none"!==this.state.error&&(t.removeEventListener("keydown",this._onKeyDownMonitor),this._errorId&&clearTimeout(this._errorId)):"none"===this.state.error&&(t.addEventListener("keydown",this._onKeyDownMonitor),this._errorId&&clearTimeout(this._errorId),this._errorId=setTimeout(this._errorEnds,3e3)),this._isMounted&&this.setState({error:e})};_errorMessage=e=>{switch(e){case"unknownLangServer":return(0,B.Z)("Translation failed. Server could not determine the language.");case"noDetect":return(0,B.Z)("Translation failed. Try selecting another language.");case"system":return(0,B.Z)("Translation failed.");case"NbCharExceeded":return(0,B.Z)("You cannot translate more than $1 characters. Use the arrows to translate more.",[$A.k]);default:return""}};_onCopyText=()=>{const{document:e}=this.context,t=e=>{e.clipboardData&&(e.clipboardData.setData("text/plain",this.state.translatedText),e.stopPropagation(),e.preventDefault())};e.addEventListener("copy",t),e.execCommand("copy"),e.removeEventListener("copy",t)};_renderToolbar=()=>{if("main"===this.state.viewMode){const e=[{id:"auto",name:(0,B.Z)("Automatic Detection")}].concat(qhe(this.props.prefValues[I.kVivaldiTranslateLanguageList])).map((e=>Xhe("option",{value:e.id},e.id,e.name))),t=qhe(this.props.prefValues[I.kVivaldiTranslateLanguageList]).map((e=>Xhe("option",{value:e.id},e.id,e.name)));return Xhe("div",{className:"TranslatePanel-FromTo toolbar toolbar-default",role:"toolbar","aria-label":(0,B.Z)("toolbar label","Pick Languages")},void 0,Xhe(ta.Z,{autoFocus:!0,value:this.state.srcLanguage,onChange:this._onSourceLanguageSelected,"aria-label":(0,B.Z)("From Language")},void 0,e),Xhe("input",{type:"button",style:{paddingLeft:6,paddingRight:6},value:"⇆","aria-label":(0,B.Z)("Swap To/From Languages"),disabled:"auto"===this.state.srcLanguage,onClick:this._onSwapLanguage}),Xhe(ta.Z,{value:this.props.prefValues[I.kTranslateTargetLanguage],onChange:this._onTargetLanguageSelected,"aria-label":(0,B.Z)("To Language")},void 0,t))}return Xhe("div",{className:"toolbar toolbar-default toolbar-wrap",role:"toolbar","aria-label":(0,B.Z)("toolbar label","Translation History Actions")},void 0,Xhe("input",{type:"button",onClick:()=>this.setState({viewMode:"main"}),value:(0,B.Z)("navigation","Back")}),Xhe("input",{type:"button",className:"danger",onClick:this._onClearHistory,value:(0,B.Z)("Clear Translate History")}))};splitText=e=>{let t=0;const n=e.split(/([ ,\n])/).reduce(((e,n)=>(n.length+e[t].length>$A.k?(e.push(n),t+=1):e[t]=e[t]+n,e)),[""]);return!n[0].length&&n.shift(),n};splitSrcTextInPages=e=>{let t=0;const n=e.split(/(\.)/).reduce(((e,n)=>"."===n?(e[t].concat("."),e):((n=n.trim()).length>$A.k?e.push(...this.splitText(n)):n.length+e[t].length>$A.k?(e.push(n),t+=1):e[t]=e[t]+n,e)),[""]);return!n[0].length&&n.shift(),n};changeTranslationPage=e=>{this.setState({translatePageIndex:e},this._onTranslate)};getCurrentSrcText=()=>{const{srcStrings:e,translatePageIndex:t}=this.state;return t>=e.length?(this.setState({translatePageIndex:0}),e[0]):e[t]};_renderTranslatePages=()=>{const{translatePageIndex:e,srcStrings:t,busy:n}=this.state,i=e<t.length-1;return Xhe("div",{className:"TranslatePanel-Pages"},void 0,Xhe("div",{className:"Translate-Characters"},void 0,Xhe("p",{},void 0,t[e]?.length??0),Jhe),Xhe("p",{className:"Translate-Page-Index"},void 0,e+1,"/",t.length),Xhe(po.ZP,{className:"Previous-Translate",image:Wi.eFz.small,tooltip:(0,B.Z)("Previous"),disabled:e<1||n,onClick:()=>this.changeTranslationPage(e-1)}),Xhe(po.ZP,{image:Wi.S$A.small,tooltip:(0,B.Z)("Next"),disabled:!i||n,onClick:()=>this.changeTranslationPage(e+1)}))};_renderMain=()=>{const e=this.state.srcStrings[this.state.translatePageIndex],t=!this.state.busy&&$A.Z.canTranslateText(e);return Xhe("div",{className:"TranslatePanel"},void 0,Xhe("div",{className:"TranslatePanel-Content"},void 0,Xhe("textarea",{className:"TranslatePanel-SrcText",type:"text",value:e,placeholder:(0,B.Z)("Enter text to translate"),onChange:this._onSrcEditChanged,onKeyDown:this._onKeyDown,onPaste:this._onPaste,autoFocus:!e}),"none"!==this.state.error&&Xhe("div",{onPointerDown:()=>this._setError("none")},void 0,Xhe(To,{type:"system"===this.state.error?"error":"warning"},void 0,this._errorMessage(this.state.error))),this.state.srcStrings.length>1&&this._renderTranslatePages(),Xhe("div",{className:"TranslatePanel-BottomToolbar"},void 0,Xhe("input",{type:"submit",disabled:!t,autoFocus:t,value:(0,B.Z)("verb","Translate")}),Xhe("input",{type:"button",title:(0,B.Z)("Copy translation"),value:(0,B.Z)("verb","Copy"),onClick:this._onCopyText,disabled:!this.state.translatedText}),Xhe("input",{type:"button",className:"clear",onClick:this._onClearText,value:(0,B.Z)("Clear")})),Xhe(jhe,{text:this.state.translatedText,showPlaceholder:this.state.showPlaceholder})),Xhe("div",{className:"TranslatePanel-CheckboxArea"},void 0,Xhe("label",{},void 0,Xhe("input",{type:"checkbox",checked:this.props.prefValues[I.kPanelsTranslateAutomatic],onChange:this._toggleAutoTranslate}),Xhe("span",{},void 0,(0,B.Z)("Auto-translate selected text")))),Xhe("div",{className:"TranslatePanel-ShowTranslateHistory"},void 0,Xhe("input",{type:"button",onClick:()=>this.setState({viewMode:"history"}),value:(0,B.Z)("Show Translate History")}),Xhe("span",{className:"credits"},void 0,(0,B.Z)("Powered by Lingvanex, hosted by Vivaldi."))))};_renderHistory=()=>Xhe("div",{className:"TranslatePanel TranslatePanel-History"},void 0,Xhe(Ghe,{nodes:this.state.history,languages:qhe(this.props.prefValues[I.kVivaldiTranslateLanguageList]),onActivated:this._onItemActivated,onItemsCopy:this._onItemsCopy,onItemsDelete:this._onItemsDelete}));render(){return this.props.open?Xhe("div",{className:"panel",id:"translate-panel"},void 0,Xhe("header",{},void 0,Xhe(im,{title:this.props.title,showCloseButton:this.props.showCloseButton})),Xhe("form",{className:"main"===this.state.viewMode?"Translate-Main-Form":"Translate-History-Form",onSubmit:this._onTranslate},void 0,this._renderToolbar(),"main"===this.state.viewMode&&this._renderMain()),"history"===this.state.viewMode&&this._renderHistory()):null}}const tge=(0,Bu.Z)(ege,Qhe);var nge=n(94420),ige=n(1810),sge=n(50012),oge=n(32782),age=n(54189),rge=n(70025);const lge=class{windowId;device;workspaceNames;windowNodes;browserWindows;workspaces;panels;tabsInStackCount;constructor(e,t){if(this.windowId=t,this.device=e,this.browserWindows=new Map,this.windowNodes=new Map,this.workspaces=new Map,this.panels=new Map,this.tabsInStackCount=new Map,e.tabs)for(let t=0;t<e.tabs.length;++t)this._addTab(e.tabs[t]);e.windows&&e.windows.forEach((e=>{this.windowNodes.set(e.id,e),e.tabs.forEach((e=>{this._addTab(e)}))}))}_getFavicon=e=>pn.jk.getFaviconWithFallback(e.url||"",e.favIconUrl||"");_getPanelTitle(e){let t;return e.id&&(t=this.panels.get(e.id)?.tab?.title),t||(t=e?.title),t||(t=e?.url),t||"..."}_getPanelUrl(e){let t;return e.id&&(t=this.panels.get(e.id)?.tab?.url),t||(t=e.url),t||"about:blank"}_createPanelLeaf(e,t){const n=t.url;if(!n||(0,rl.xl)(n))return;return{id:`panel-${e}-${this.device.id}`,type:"panel",parentId:"none",title:this._getPanelTitle(t),index:-1,pageIndex:void 0,wid:this.windowId,workspaceId:void 0,syncItem:{url:this._getPanelUrl(t),loadType:"page",faviconUrl:t.initialFaviconUrl?t.initialFaviconUrl:"",windowId:""}}}_getTabTitle(e){return e.fixedTitle?e.fixedTitle:e.name}_createLeaf(e,t,n,i,s){const o={id:t.id,type:i,parentId:"none",title:this._getTabTitle(t),index:n,pageIndex:void 0,wid:this.windowId,workspaceId:s,syncItem:{url:t.url,loadType:"page",faviconUrl:this._getFavicon(t.tab),windowId:t.windowId}},a=t.stackId;if(a){const e=this.tabsInStackCount.get(a);if(!e||e<2)return o}if(!a)return o;let r=e.get(a);if(!r){let n="Stack";return t.fixedGroupTitle&&(n=t.fixedGroupTitle),r=this._createFolder(a,"stack",n,[]),e.set(a,r),r.children||(r.children=[]),r.children.push(o),r}r.children||(r.children=[]),r.children.push(o)}_createFolder(e,t,n,i){return{id:e,type:t,parentId:"none",title:(0,B.Z)("title",n),index:0,pageIndex:void 0,wid:this.windowId,workspaceId:void 0,children:i}}_getTabGroupName(e,t){if("window"===t){const t=this.windowNodes.get(String(e));return t?t.name:"1"}if("syncPanels"===t)return"Panel";const n=this.device?.workspaceNames?.get(Number(e))?.name;return n||"..."}_getWorkspaceIcon(e,t){const n=this.device?.workspaceNames?.get(t);n&&(n.emoji?e.emoji=n.emoji:"number"==typeof n.iconId?e.icon=GF.S[n.iconId]:e.icon=n.icon)}_createTabGroup(e,t,n,i){const s=new Map,o=t.pinned.map(((e,t)=>this._createLeaf(s,e,t,"tab",i))).filter(Boolean),a=t.regular.map(((e,t)=>this._createLeaf(s,e,t,"tab",i))).filter(Boolean);let r=[];if(o.length>0){const t=this._createFolder(`pinned-${e}`,"pinned","Pinned Tabs",o);r.push(t)}return a&&(r=[...r,...a]),r}_createTabGroupFolder(e,t,n,i){const s=this._createTabGroup(e,t,n,i);return this._createFolder(e,n,this._getTabGroupName(e,n),s)}_fillBack(e,t){t&&(e.parentId=t.id),e.children&&e.children.forEach(((t,n)=>{t.index=n,this._fillBack(t,e)}))}build(e){const t=[],n=(e,n,i,s)=>{if(!n?.pinned?.length&&!n?.regular?.length)return;const o=this._createTabGroupFolder(String(e),n,i,s);"workspace"===i&&s&&this._getWorkspaceIcon(o,s),t.push(o)};if(1===this.browserWindows.size?this.browserWindows.forEach(((e,n)=>{const i=this._createTabGroup(String(n),e,"window");t.push(...i)})):this.browserWindows.forEach(((e,t)=>{n(t,e,"window")})),this.workspaces.forEach(((e,t)=>{n(t,e,"workspace",t)})),this.device.panels){const e=this.device.panels.map(((e,t)=>this._createPanelLeaf(t,e))).filter(Boolean);if(e.length>0){const n=this._createFolder(`panels-${this.device.id}`,"syncPanels","Web Panels",e);t.push(n)}}const i=this._createFolder(`device-${this.device.id}`,"syncDevice",this.device.name,t);return this._fillBack(i,e),i.deviceType=this.device.deviceType,i}#Fn(e){return e.length>70&&(e=e.substring(0,70)+"..."),e}_createMenuFolder(e){const t=e=>({url:e.url,mnemonic:!1,handler:()=>Ei.openTabs([e.id]),...Qe.Z.makeLabelPair(this.#Fn(e.name||""))}),n=e=>{const n=new Map,i=[];return e.forEach(((e,s)=>{const o=e.stackId;if(!o)return void i.push(t(e));let a=n.get(o);if(!a){a=[],n.set(o,a);const e={items:a,labelEnglish:"Stack",label:(0,B.Z)("title","Stack"),iconPNG:sge.Z,iconPNGWhite:oge.Z};i.push(e)}a.push(t(e))})),i};n(e.regular);const i=n(e.pinned),s=n(e.regular);let o=[];i.length>0&&(o=[{items:i,iconPNG:nge.Z,iconPNGWhite:ige.Z,...(0,us.Z)("Pinned Tabs")}]),o=[...o,...s];const a=[...e.pinned.map((e=>e.id)),...e.regular.map((e=>e.id))];return o.push(Qe.Z.separatorItem),o.push({mnemonic:!1,handler:()=>{Ei.openWindows(a)},...(0,us.Z)("Open All")}),o}buildContextMenuTree(){let e=[];if(1===this.browserWindows.size)this.browserWindows.forEach((t=>{e=this._createMenuFolder(t)}));else{let t=0;this.browserWindows.forEach((n=>{t++,e.push({items:this._createMenuFolder(n),iconPNG:age.Z,iconPNGWhite:rge.Z,...(0,us.Z)("Window "+t)})}))}if(e.push(Qe.Z.separatorItem),this.workspaces.forEach(((t,n)=>{const i=this._getTabGroupName(n,"workspace"),s={items:this._createMenuFolder(t),labelEnglish:"Workspace "+i,label:(0,B.Z)("title","Workspace")+" "+i,iconPNG:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABZWlDQ1BEaXNwbGF5IFAzAAB4nHWQvUvDUBTFT6tS0DqIDh0cMolD1NIKdnFoKxRFMFQFq1OafgltfCQpUnETVyn4H1jBWXCwiFRwcXAQRAcR3Zw6KbhoeN6XVNoi3sfl/Ticc7lcwBtQGSv2AijplpFMxKS11Lrke4OHnlOqZrKooiwK/v276/PR9d5PiFlNu3YQ2U9cl84ul3aeAlN//V3Vn8maGv3f1EGNGRbgkYmVbYsJ3iUeMWgp4qrgvMvHgtMunzuelWSc+JZY0gpqhrhJLKc79HwHl4plrbWD2N6f1VeXxRzqUcxhEyYYilBRgQQF4X/8044/ji1yV2BQLo8CLMpESRETssTz0KFhEjJxCEHqkLhz634PrfvJbW3vFZhtcM4v2tpCAzidoZPV29p4BBgaAG7qTDVUR+qh9uZywPsJMJgChu8os2HmwiF3e38M6Hvh/GMM8B0CdpXzryPO7RqFn4Er/QfBIQM2AAAA0ElEQVR4AbVSiQ2CQBAcrYASoANLwA4o4UqgA+jAEqATtALtgFgBsQLdy83qeqAiCZNMLuw/uwArIxc6LEAq7IQ92dA2wjb6ToQVk0/CjLwKz/R9RPGjm7e1jHGx0xvumKdXY4spx7cJvLyDcBCWatQd7PjuhTeEHZQmuWLxDcJOLibnWcB292zxukJn7HqdtwKKms6KwQ7hX9DrDIxBLMExsaWMjJ3AQj1fbz/S5+LubkKGjp9zioZTjJJhutVGhsKOn2AGUkwv8W84hPHXwwNmHziySwmKKQAAAABJRU5ErkJggg==",iconPNGWhite:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABZWlDQ1BEaXNwbGF5IFAzAAB4nHWQvUvDUBTFT6tS0DqIDh0cMolD1NIKdnFoKxRFMFQFq1OafgltfCQpUnETVyn4H1jBWXCwiFRwcXAQRAcR3Zw6KbhoeN6XVNoi3sfl/Ticc7lcwBtQGSv2AijplpFMxKS11Lrke4OHnlOqZrKooiwK/v276/PR9d5PiFlNu3YQ2U9cl84ul3aeAlN//V3Vn8maGv3f1EGNGRbgkYmVbYsJ3iUeMWgp4qrgvMvHgtMunzuelWSc+JZY0gpqhrhJLKc79HwHl4plrbWD2N6f1VeXxRzqUcxhEyYYilBRgQQF4X/8044/ji1yV2BQLo8CLMpESRETssTz0KFhEjJxCEHqkLhz634PrfvJbW3vFZhtcM4v2tpCAzidoZPV29p4BBgaAG7qTDVUR+qh9uZywPsJMJgChu8os2HmwiF3e38M6Hvh/GMM8B0CdpXzryPO7RqFn4Er/QfBIQM2AAAA2klEQVR4AbVSbQ2DMBR8RQESOgdI2BwgoRLmABxMAjhhU7A5IFOwTEF3L1yXpikl/OAll5T30Xd3ReTI8N6fASd7A0MWmICZGDSX662SwRrocJyAhzHmpMD5DTxZW93alraR1cgelxadX8LJtrzQ2+YKJQYq7wZ8gKvEHiDR8PsCfNWDuInaZ8AA6skrmlkuiLcneme+iE1ep8np61ns2Oz4L9TMKf0+nqli/TiOlKE0J/ZY0rfM38nCSclEItAPLAaycJILDv1lxCYG+nqRbMWaibI3golyZPwA4iNOsOEBLSEAAAAASUVORK5CYII="};e.push(s)})),this.device.panels?.length){const t=this.device.panels.map((e=>{if(e.title){const t=this._getPanelUrl(e);return{label:this._getPanelTitle(e),labelEnglish:this._getPanelTitle(e),url:t,mnemonic:!1,handler:()=>{c.ZP.openURL(this.windowId,t)}}}})).filter(Boolean);e.push({items:t,label:(0,B.Z)("title","Web Panels"),labelEnglish:"Web Panels"})}return e}_ensureMainWorkspace(e){let t=this.browserWindows.get(e);return t||(t={pinned:[],regular:[]},this.browserWindows.set(e,t)),t}_addTab(e){const t=this._ensureMainWorkspace(e.windowId),n=e.tab;let i,s=0;try{const t=e.stackId;if(t){const e=this.tabsInStackCount.get(t);this.tabsInStackCount.set(t,e?e+1:1)}let n=e.panelId;if(n){if(n.startsWith(Ju.zs))return;if(n.startsWith("WEBPANEL_")){const t=n.split("_");return 3===t.length&&(n=t[0]+"_"+t[1]),void("string"==typeof n&&this.panels.set(n,e))}}e.workspaceId&&(s=e.workspaceId)}catch(e){}0===s?i=t:(this.workspaces.get(s)||this.workspaces.set(s,{pinned:[],regular:[]}),i=this.workspaces.get(s)),i&&(n.pinned?i.pinned.push(e):i.regular.push(e))}};var dge,cge=n(63365),uge=n(42578),pge=n(34155);function hge(e,t,n,i){dge||(dge="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:dge,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const gge=[I.kPanelsShowFolderBadge,I.kPanelsWindowDragToStack,I.kPanelsWindowSingleClickOpens,I.kPanelsWindowShowPinnedGroup,I.kTabsAutoMuting,I.kTabsDimHibernated,I.kTabsShowCloseButton,I.kTabsStackingMode,I.kTabsUnread,I.kThemeUseAnimation,I.kWorkspacesEnabled],mge="root",fge="trash",vge="vivaldi/x-window-item";var yge=hge("g",{transform:"translate(2, 2)",fill:"none",stroke:"currentColor"},void 0,hge("polygon",{points:"2.5 5.5 6.5 9.5 7.5 9.5 7.5 5.5 11.5 2.5 9.5 0.5 6.5 4.5 2.5 4.5"}),hge("polygon",{points:"0 12 3 8 4 9"}));class bge extends Li.PureComponent{refTreeList=Li.createRef();static contextType=ts.Z;isDroppingOnWindowOrWorkspace=!1;constructor(e,t){super(e),this.state={windowIds:this.getWindowIds(t.vivaldiWindowId),nodes:[],hasContent:!1}}expandModel={};blockPageStoreChange=!1;lastActivePinnedId="";centerDownId="";componentDidMount(){Gie.Z.addListener(this._onPageStoreChanged),Ce.ZP.addListener(this._onPageStoreChanged),Ai.addListener(this._onSyncedTabsStoreChanged),cge.Z.addListener(this._onTrashStoreChanged),he.ZP.addListener(this._onWindowStoreChanged),GF.Z.addListener(this._onWorkspaceStoreChanged),this._onFilterChange(this.props.filter,Lr.Z)}componentWillUnmount(){Gie.Z.removeListener(this._onPageStoreChanged),Ce.ZP.removeListener(this._onPageStoreChanged),Ai.removeListener(this._onSyncedTabsStoreChanged),cge.Z.removeListener(this._onTrashStoreChanged),he.ZP.removeListener(this._onWindowStoreChanged),GF.Z.removeListener(this._onWorkspaceStoreChanged)}componentDidUpdate(e){if(this.props.filter!==e.filter){const t=this.props.filter.length,n=e.filter.length;0===n&&t>0&&this.refTreeList.current&&(this.expandModel=this.refTreeList.current.getExpandModel()),this._onFilterChange(this.props.filter,(e=>{t>0?pge.nextTick((()=>{this.refTreeList.current?.expandAllExcept(e)})):n>0&&0===t&&pge.nextTick((()=>{this.refTreeList.current?.expandWithModel(this.expandModel)}))}))}else(this.props.prefValues[I.kThemeUseAnimation]!==e.prefValues[I.kThemeUseAnimation]||this.props.prefValues[I.kTabsStackingMode]!==e.prefValues[I.kTabsStackingMode]||this.props.prefValues[I.kTabsUnread]!==e.prefValues[I.kTabsUnread]||this.props.prefValues[I.kPanelsWindowShowPinnedGroup]!==e.prefValues[I.kPanelsWindowShowPinnedGroup]||this.props.prefValues[I.kWorkspacesEnabled]!==e.prefValues[I.kWorkspacesEnabled]||this.props.sorting!==e.sorting&&"manually"===this.props.sorting.sortField)&&pge.nextTick((()=>{this.setState({nodes:this._getNodes(),hasContent:!0})}))}focusTree=()=>{this.refTreeList.current?.focusTree()};_onPageStoreChanged=()=>{this.blockPageStoreChange||this._onFilterChange(this.props.filter,Lr.Z);const e=Ce.ZP.getActivePage(this.context.vivaldiWindowId);e&&e.pinned&&(this.lastActivePinnedId=e.id.toString())};_onSyncedTabsStoreChanged=()=>{this._onFilterChange(this.props.filter,Lr.Z)};_onTrashStoreChanged=()=>{this._onFilterChange(this.props.filter,Lr.Z)};_onWindowStoreChanged=()=>{const e=this.getWindowIds(this.context.vivaldiWindowId);(0,QT.Z)(e,this.state.windowIds)||this.setState({windowIds:e})};_getWorkspaces=()=>this.props.prefValues[I.kWorkspacesEnabled]?GF.Z.getState():[];_onWorkspaceStoreChanged=()=>{this.setState({nodes:this._getNodes(),hasContent:!0})};getWindowIds=e=>{const t=he.ZP.isIncognito(e);return he.ZP.getIds("normal").filter((e=>t===he.ZP.isIncognito(e)))};_getFavicon=e=>pn.jk.getFaviconWithFallback(e.url||"",e.favIconUrl||"");_getNodes=()=>{const e="off"===this.props.prefValues[I.kTabsStackingMode],t=he.ZP.isIncognito(this.context.vivaldiWindowId)?"faviconSkipCache":"faviconFromCache",n=function(e){return e&&e.startsWith("www.")?e.substring(4):e},i=e=>{const i=(0,ge.Z)(e.url)?.hostname||"",s=!e.url||!e.favIconUrl&&!(0,pn.pM)(e.url)&&!(0,pn.QB)(e.url);return{page:e,hostname:i,url:e.url,domain:n(i),loadType:t,faviconUrl:this._getFavicon(e),useDefaultIcon:s,active:Ce.ZP.isActivePage(e.windowId,e.id)}},s=(e,t,n,s)=>e.flatMap(((e,o)=>{if("tab"===e.type){return[{id:e.id.toString(),type:"tab",parentId:t,title:e.page.vivExtData.fixedTitle??pn.jk.getDisplayTitle(e.page),index:o,pageIndex:e.page.index,wid:n,workspaceId:s,pageItem:i(e.page)}]}return"group"===e.type?[{id:e.id,type:"stack",parentId:t,title:(0,kv.XN)(e.page)??pn.jk.getDisplayTitle(e.page),index:o,pageIndex:void 0,wid:n,workspaceId:s,children:e.pages.map(((t,o)=>({id:t.id.toString(),type:"tab",parentId:e.id,title:t.vivExtData.fixedTitle??pn.jk.getDisplayTitle(t),index:o,pageIndex:t.index,wid:n,workspaceId:s,pageItem:i(t)}))).toArray()}]:[]})).toArray(),o=this.state.windowIds.map(((t,n)=>{const i=Ce.ZP.getWorkspaceTabsInWindow(t,void 0,e);if(0===i.size)return;const o=this.props.prefValues[I.kPanelsWindowShowPinnedGroup],a=o?i.filter((e=>e.page.pinned)):(0,ze.aV)(),r=o?i.filter((e=>!e.page.pinned)):i,l=`window-${t}`,d=[];if(!a.isEmpty()){const e=`pinned-${t}`,n=s(a,e,t,void 0);d.push({id:e,type:"pinned",parentId:l,title:(0,B.Z)("title","Pinned Tabs"),index:0,pageIndex:void 0,wid:t,workspaceId:void 0,children:n})}const c=s(r,l,t,void 0),u=Ce.ZP.getActivePage(t);return{id:l,type:"window",parentId:mge,title:u?pn.jk.getDisplayTitle(u):"",index:n,pageIndex:void 0,wid:t,workspaceId:void 0,children:[...d,...c]}})).filter(Boolean),a=this._getWorkspaces().map(((e,t)=>{const n=Ce.ZP.getWorkspaceTabs(e.id,!1),i=this.props.prefValues[I.kPanelsWindowShowPinnedGroup],a=i?n.filter((e=>e.page.pinned)):(0,ze.aV)(),r=i?n.filter((e=>!e.page.pinned)):n,l=e.id,d=`workspace-${l}`,c=n.first()?.page?.windowId,u=[];if(c&&!a.isEmpty()){const e=`pinned-${l}`,t=s(a,e,c,l);u.push({id:e,type:"pinned",parentId:d,title:(0,B.Z)("title","Pinned Tabs"),index:0,pageIndex:void 0,wid:c,workspaceId:l,children:t})}const p=c?s(r,d,c,l):[];return{id:d,type:"workspace",parentId:mge,title:e.name,index:t+o.length,pageIndex:void 0,wid:c,workspaceId:l,children:[...u,...p]}})),r=(e,t,i)=>{const s=(0,ge.Z)(t.url??"")?.hostname??"",{favIconUrl:o,favIconLoadType:a}=pn.jk.getBookmarkFavicon(t.url);return{id:t.sessionId??"",parentId:e,type:"trash",index:i,title:pn.jk.getDisplayTitle(t),wid:this.context.vivaldiWindowId,workspaceId:void 0,pageIndex:void 0,trashItem:{tab:{handle:t,url:t.url??"",hostname:s,domain:n(s),loadType:a,faviconUrl:o,useDefaultIcon:!1}}}};let l;if(Ai.hasSupport()){l={id:"sync",type:"syncFolder",parentId:mge,title:(0,B.Z)("title","Synced Tabs"),index:o.length+a.length,pageIndex:void 0,wid:this.context.vivaldiWindowId,workspaceId:void 0,children:[]};const e=Ai.getDeviceTree();l.children=e.map(((e,t)=>new lge(e,this.context.vivaldiWindowId).build(l)))}const d={id:fge,type:"trash",parentId:mge,title:(0,B.Z)("title","Closed Tabs"),index:o.length+a.length+(l?1:0),pageIndex:void 0,wid:this.context.vivaldiWindowId,workspaceId:void 0,children:cge.Z.getTrash().map(((e,t)=>{if(e.tab)return r(fge,e.tab,t);if(e.window&&e.window.tabs&&e.window.sessionId){const n=e.window,i=e.window.tabs,s=e.window.sessionId;return{id:s,parentId:fge,type:"trash",index:t,title:(0,B.Z)("Window with $1 Tab","Window with $1 Tabs",[i.length]),wid:this.context.vivaldiWindowId,workspaceId:void 0,pageIndex:void 0,trashItem:{window:{handle:n}},children:i.map(((e,t)=>r(s,e,t)))}}})).filter(Boolean)},c=l?this._getRootNode([...o,...a,l,d]).children||[]:this._getRootNode([...o,...a,d]).children||[];return c.forEach((e=>{this._updateCounts(e)})),c};_updateCounts=e=>{let t=0;return e.children?e.children.forEach(((e,n)=>{t+=this._updateCounts(e)})):"tab"!==e.type&&"trash"!==e.type&&"panel"!==e.type||(t=1),e.count=t,t};_getRootNode=e=>({id:mge,parentId:"",type:"root",title:"",index:0,pageIndex:void 0,wid:this.context.vivaldiWindowId,workspaceId:void 0,children:e});_getChildren=e=>e?.children??[];_hasSyncChildren=e=>{switch(e.type){case"syncFolder":if(e.children)for(let t=0;t<e.children.length;t++)if(this._hasSyncChildren(e.children[t]))return!0;break;case"syncWindow":return Boolean(e.children?.length);case"syncDevice":if(e.children)for(let t=0;t<e.children.length;t++){const n=e.children[t];if("tab"===n.type)return!0;if("syncWindow"===n.type&&Boolean(n.children?.length))return!0}}return!1};_getPageIndex=e=>e.pageIndex;_getFilteredTree=e=>{const t=function(e,t){let n=!1;return e.pageItem?n=e.pageItem.url.includes(t):e.syncItem&&(n=e.syncItem.url.includes(t)),n||"window"===e.type||(n=e.title.toLowerCase().includes(t)),n},n=function(e,i,s,o){let a=!1;for(let r=0;r<e.length;r++){const l=e[r];let d=!1;if(l.children){const e={...l,children:[]};n(l.children,e.children,s,o)&&(i.push(e),a=!0,d=!0)}if(!d&&t(l,o)){const e={...l};i.push(e),l.children&&s.push(l),a=!0}}return a},i=[],s=[];return{nodes:i,collapsed:s,hasContent:n(this._getNodes(),i,s,e.toLowerCase())}};_onFilterChange=(e,t)=>{if(e&&e.length>0){const n=this._getFilteredTree(e);n.nodes.forEach(((e,t)=>{e.index=t})),this.setState({nodes:n.nodes,hasContent:n.hasContent},t(n.collapsed))}else this.setState({nodes:this._getNodes(),hasContent:!0},t([]))};getSelectedItem=()=>this.refTreeList.current?.getSelectedItem();getSelectedItems=()=>this.refTreeList.current?.getAllSelectedItems()||[];unSelectAll=()=>{this.refTreeList.current?.unSelectAll()};_isTrashFolder=e=>"trash"===e.type&&!e.trashItem;_isPinnedFolder=e=>"pinned"===e.type;_getSelectedBackgroundPages=()=>{const e=this.getSelectedItems(),t=e.filter((e=>"window"===e.type||"workspace"===e.type));return t.length>0?t.flatMap((e=>e.children||[e])).flatMap((e=>e.children||[e])).map((e=>e.pageItem)).filter(Boolean).filter((e=>e.page!==Ce.ZP.getActivePage(e.page.windowId))).map((e=>e.page)):e.flatMap((e=>e.children||[e])).map((e=>e.pageItem)).filter(Boolean).filter((e=>e.page!==Ce.ZP.getActivePage(e.page.windowId))).map((e=>e.page))};_getDiscardablePages=()=>this._getSelectedBackgroundPages().filter((e=>!e.discarded&&!e.isInspected));#Wn(e){let t=e;if(1===t.length&&"stack"===t[0].type)return[];return t=t.filter((e=>"tab"===e.type||"stack"===e.type)).flatMap((e=>e.children??[e])).filter((e=>e.pageItem)),(e=>{const t=[];return e.forEach((e=>{e.pageItem&&-1===t.findIndex((t=>e.wid))&&t.push(e.wid)})),t})(t).length>1?[]:t}#Un(e){return e.filter((e=>"tab"===e.type||"trash"===e.type||"stack"===e.type)).flatMap((e=>e.children??[e])).filter((e=>e.pageItem||e.trashItem))}_getStackableNodesForHost=(e,t,n)=>this.state.nodes.filter((n=>("window"===n.type||"workspace"===n.type)&&n.wid===e&&n.workspaceId===t)).flatMap((e=>e.children??[e])).filter((e=>e.pageItem&&!e.pageItem.page.pinned&&e.pageItem.hostname===n));_getTileableSelectedNodes=()=>{const e=this.getSelectedItems();if(1===e.length&&"stack"!==e[0].type)return[];if(1===e.length&&"stack"===e[0].type){const t=new Map,n=this._getChildren(e[0]);for(let e=0;e<n.length;e++){const i=n[e].pageItem,s=i?(0,kv.jA)(i.page):void 0;if(void 0===s){t.clear();break}t.set(s,"")}if(1===t.size)return[]}const t=this._filterNodesToTabs().filter((e=>void 0!==e.pageItem)),n=new Set(t.map((e=>e.pageItem?.page&&(0,kv.jA)(e.pageItem.page))));return 1!==n.size||n.has(void 0)?t:[]};_filterNodesToTabs=()=>this.getSelectedItems().filter((e=>"tab"===e.type||"stack"===e.type||"pinned"===e.type)).flatMap((e=>e.children||e));_allTabsHaveTheSameTilingId=()=>{const e=new Set(this._filterNodesToTabs().map((e=>e.pageItem?(0,kv.jA)(e.pageItem.page):void 0)));return 1===e.size&&!e.has(void 0)};_getSelectedTilingItems=()=>this._filterNodesToTabs().map((e=>{const t=e.pageItem?(0,kv.jA)(e.pageItem.page):void 0;return t?{node:e,tid:t}:void 0})).filter(Boolean).filter(((e,t,n)=>n.indexOf(e)===t));_getNodesWithMediaState=(e,t)=>{let n=[];return"selection"===t?n=this.getSelectedItems():"all"===t?n=this.state.nodes:"active"===t&&(n=this.state.nodes.filter((e=>Boolean(e.pageItem&&e.pageItem.page.active)))),n.filter((e=>"window"===e.type||"tab"===e.type||"stack"===e.type||"pinned"===e.type)).map((e=>e.children||e)).reduce(((e,t)=>e.concat(t)),[]).filter((t=>{const n=t.pageItem?.page;return n&&("playing"===e?Gie.Z.hasMediaState(n.id,"playing")&&!Gie.Z.hasMediaState(n.id,"muting"):Gie.Z.hasMediaState(n.id,e))&&!n.discarded}))};_getMuteableNodesFrom=e=>this._getNodesWithMediaState("playing",e);_muteOthers=e=>{if(e.pageItem)c.ZP.muteAllExcept(e.wid,[e.pageItem.page]);else{const t=this._getChildren(e).map((e=>e.pageItem?.page)).filter(Boolean);c.ZP.muteAllExcept(e.wid,t)}};_getPlayableNodesFrom=(e,t)=>{const n=this._getNodesWithMediaState("muting",e),i=t.pageItem?.page;switch(this.props.prefValues[I.kTabsAutoMuting]){case"onlyActive":return n.filter((e=>e.pageItem?.page?.active));case"prioritizeActive":if(n.length>1){const e=Ce.ZP.getActivePage(t.wid);return e&&Gie.Z.hasMediaState(e.id,"playing")?[]:n.filter((e=>e.pageItem?.page===i))}}return n};_isUnread=e=>!(!this.props.prefValues[I.kTabsUnread]||!e.pageItem?.page)&&Ce.ZP.isUnread(e.pageItem.page);_isInStackFolder=e=>"stack"===e.type||Boolean(e.pageItem&&(0,kv.av)(e.pageItem.page));_isInTrashFolder=e=>"trash"===e.type||Boolean(e.trashItem);_isInPinnedFolder=e=>"pinned"===e.type||Boolean(e.pageItem?.page.pinned);_isSyncFolder=e=>"syncFolder"===e.type||"syncDevice"===e.type||"syncWindow"===e.type;_isInSyncFolder=e=>this._isSyncFolder(e)||Boolean(e.syncItem);_hasSyncUrls=e=>this._isSyncFolder(e)&&Boolean(e.children?.length)||Boolean(e.syncItem);_isWithinFolder=(e,t)=>{if(this._isFolder(e)){const n=Boolean(this.refTreeList.current?.isExpanded(e.id));return"on"===t||n&&"below"===t}return void 0!==e.parentId};_getStackFolderByNode=e=>{let t=e;return t?.pageItem&&(t=this._getNodeById(t.parentId)),"stack"===t?.type?t:void 0};_getPageByNode=e=>{if("stack"===e.type){const t=this._getChildren(e);return t.length>0?t[0].pageItem?.page:void 0}return e.pageItem?.page};_getPageIdByNode=e=>this._getPageByNode(e)?.id;_getNodeById=e=>{const t=n=>{for(let i=0;i<n.length;i++){const s=n[i];if(s.id===e)return s;if(s.children){const e=t(s.children);if(e)return e}}};return e===mge?this._getRootNode(this.state.nodes):t(this.state.nodes)};_getNodeByParentAndIndex=(e,t)=>{const n=this._getNodeById(e);return n&&n.children&&n.children.length>0?(t<0?t=0:t>=n.children.length&&(t=n.children.length-1),n.children[t]):n};_getNodeByParentAndPageIndex=(e,t)=>{const n=this._getNodeById(e)?.wid??this.context.vivaldiWindowId,i=Ce.ZP.getPages(n).find((e=>e.index===t));if(i)return this._getNodeById(i.id.toString())};_hasChildren=e=>Boolean(e.children&&e.children.length>0);_isFolder=e=>Boolean(e.children);_hasSwgIcon=e=>Boolean(e.icon);expandAll=()=>{this.refTreeList.current?.expandAll()};_onNodeClick=(e,t)=>{es.Z.isNoModifierPressed(e)&&e.button===es.Z.kLeft&&this.props.prefValues[I.kPanelsWindowSingleClickOpens]&&this._onNodesActivated(e,[t])};_onNodeMouseDown=(e,t)=>{es.Z.isNoModifierPressed(t)&&t.button===es.Z.kCenter&&(this.centerDownId=e.id)};_onNodeMouseUp=(e,t)=>{es.Z.isNoModifierPressed(t)&&t.button===es.Z.kCenter&&this.centerDownId===e.id&&e.pageItem&&!e.pageItem.page.pinned&&this._closeWithId(e.id,t),this.centerDownId=""};_onNodeDoubleClick=(e,t)=>{if(e.button===es.Z.kLeft&&!this.props.prefValues[I.kPanelsWindowSingleClickOpens])if("panel"===t.type){const e=t?.syncItem?.url;e&&c.ZP.newTab(t.wid,e)}else this._onNodesActivated(e,[t])};handleNodesActivated=(e,t)=>{this._onNodesActivated(e,t)};_activateTab=e=>{if(e.pageItem){const t=e.pageItem.page.id,n=Ce.ZP.getPageById(t)?.windowId??e.wid,i=this.context.vivaldiWindowId,s=Ce.ZP.getActiveWorkspace(i);if(i===n)e.workspaceId!==s&&c.ZP.setActiveWorkspace(i,e.workspaceId);else{const t=Ce.ZP.getActiveWorkspaces();e.workspaceId&&!t.has(e.workspaceId)?c.ZP.setActiveWorkspace(i,e.workspaceId):e.workspaceId||c.ZP.setActiveWorkspace(n,e.workspaceId)}xi.Z.focus(n).then((()=>{c.ZP.activateTab(t,n)}))}else e.syncItem&&Ei.openTabs([e.id])};_openSyncItems=e=>{const t=(e,n,i)=>{for(let s=0;s<e.length;s++){const o=e[s];"tab"===o.type?i.push(o.id):"window"===o.type&&n.push(o.id),o.children&&t(o.children,n,i)}},n=[],i=[];t(e,n,i),Ei.openTabs(i),Ei.openWindows(n)};_onNodesActivated=(e,t)=>{const n=t[0];if(n.trashItem)n.trashItem.tab?Ni.Z.undeleteTab(n.trashItem.tab.handle.sessionId):n.trashItem.window&&Ni.Z.undeleteWindow(n.trashItem.window.handle.sessionId);else if(n.pageItem)this._activateTab(n);else if(n.syncItem)this._activateTab(n);else if(this._isPinnedFolder(n)){let e=this._getNodeById(this.lastActivePinnedId);!e&&n.children&&n.children.length>0&&(e=n.children[0]),e?.pageItem&&this._activateTab(e)}};_closeByIds=e=>{let t=e.map((e=>this._getNodeById(e))).filter(Boolean);const n=t.filter((e=>"stack"===e.type)),i=t.filter((e=>"workspace"===e.type)),s=t.filter((e=>"window"===e.type)),o=t.filter((e=>"trash"===e.type)),a=n.map((e=>e.children)).filter(Boolean).reduce(((e,t)=>e.concat(t)),[]);if(t=t.filter((e=>"stack"!==e.type&&"workspace"!==e.type)).filter((e=>-1===a.findIndex((t=>t.id===e.id)))),s.length>0)return s.forEach((e=>xi.Z.close(e.wid))),Promise.resolve([]);if(1===i.length&&1===e.length){const e=i[0]?.workspaceId;if(e)return de.Z.showDeleteWorkspace(this.context.vivaldiWindowId,{workspaceId:e}),Promise.resolve([])}n.forEach((e=>{const t=this._getPageIdByNode(e);"number"==typeof t&&c.ZP.closeTabStack(t)})),c.ZP.closePage((0,ze.aV)(t.map((e=>e.pageItem?.page)).filter(Boolean)));const r=o.flatMap((e=>{if(e.trashItem?.window&&e.children){return e.children.map((e=>e.trashItem?.tab?.handle.sessionId)).filter(Boolean)}return e.trashItem?.tab?.handle.sessionId})).filter(Boolean);return Ni.Z.removeTabs(r),Promise.resolve([])};_getPagesByIds=e=>{const t=[];return e.map((e=>this._getNodeById(e))).filter(Boolean).forEach((e=>{e.pageItem?t.push(e.pageItem.page):e.children&&("window"===e.type?t.push(...this._getChildren(e).map((e=>e.children||e)).reduce(((e,t)=>e.concat(t)),[]).map((e=>e.pageItem?.page)).filter(Boolean)):t.push(...this._getChildren(e).map((e=>e.pageItem?e.pageItem.page:void 0)).filter(Boolean)))})),t};_getSyncNodesByIds=e=>{const t=[];for(let n=0;n<e.length;n++){const i=this._getNodeById(e[n]);if(i?.syncItem)t.push(i);else if(i?.children){const e=i.children.map((e=>e.id));t.push(...this._getSyncNodesByIds(e))}}return t};_saveBookmarkByIds=e=>{const t=g.Z.getRootId();if(void 0!==t)if(0===e.length)ee.Z.bookmarkAllOpenPages(this.context.vivaldiWindowId,t);else{const n=this._getNodeById(e[0]);if(n&&this._isInSyncFolder(n)){const n=this._getSyncNodesByIds(e).map((e=>{if(e.syncItem)return{url:e.syncItem.url,title:e.title}})).filter(Boolean);ee.Z.createBookmarks(n,t,0,"sync")}else ee.Z.bookmarkPages((0,ze.aV)(this._getPagesByIds(e)),!1,t)}};_saveSessionByIds=e=>{const t=this.context.vivaldiWindowId;if(0===e.length)de.Z.showSaveSessionDialog(t,{mode:"all"});else{const n=this._getPagesByIds(e).map((e=>e.id));n.length>0&&de.Z.showSaveSessionDialog(t,{mode:"ids",ids:n})}};_handleExpandClick=(e,t)=>{(0,ms.ZP)(e);const n=e.altKey;this.refTreeList.current?.toggleSelectedExpansion(t,n)};_validateForDrag=e=>{const t=e.map((e=>this._getNodeById(e))).filter(Boolean).filter((e=>e&&!this._isSyncFolder(e)));return t.every((e=>"workspace"===e.type))?t.map((e=>e.id)):t.filter((e=>"window"!==e.type&&"workspace"!==e.type&&!this._isPinnedFolder(e)&&!this._isTrashFolder(e))).map((e=>e.id))};_getDragData=(e,t)=>{const n=t.map((e=>this._getNodeById(e))).filter(Boolean);if("text/plain"===e){return n.map((e=>e.pageItem?e.pageItem.url:e.trashItem?.tab?e.trashItem.tab.url:e.syncItem?.url?e.syncItem.url:e.title)).join("\r\n")}if(zi.ZP.isUriListType(e)){return n.map((e=>e.pageItem?e.pageItem.url:e.trashItem?.tab?.url||"")).filter(Boolean).join("\r\n")}return""};_setCustomEventBehavior=(e,t)=>{const n=t.map((e=>this._getNodeById(e))).filter(Boolean),i=n.map((e=>Boolean(e.trashItem))),s=n.map((e=>Boolean(e.pageItem?.page.pinned))),o=n.map((e=>Boolean(e.syncItem)));if(i.some((e=>!0===e))&&e.dataTransfer.setData("vivaldi/x-tab-closed",JSON.stringify(i)),s.some((e=>!0===e))&&e.dataTransfer.setData("vivaldi/x-tab-pinned",JSON.stringify(s)),o.some((e=>!0===e))&&e.dataTransfer.setData("vivaldi/x-tab-sync",JSON.stringify(o)),1===n.length){const t=this._getTitle(n[0].id);t&&e.dataTransfer.setData("vivaldi/x-title",t)}};_getDropSupport=(e,t)=>{const n={available:!1,onto:!1,edge:"both"};if(this._isInSyncFolder(e))return n.edge="none",n;if(-1!==t.dataTransfer.types.findIndex((e=>"vivaldi/x-tab-sync"===e)))return n.edge="none",n;if(-1!==t.dataTransfer.types.findIndex((e=>"vivaldi/x-tab-closed"===e)))return n.available=!this._isInTrashFolder(e),n.onto=n.available&&this._canDropOnto(e,t),n;if(-1!==t.dataTransfer.types.findIndex((e=>"vivaldi/x-tab-pinned"===e))){if(!this.props.prefValues[I.kPanelsWindowShowPinnedGroup])return n.available=Boolean(e.pageItem?.page.pinned),n.onto=n.available&&this._canDropOnto(e,t),n;if(this._isInTrashFolder(e))return n}return t.dataTransfer.types.some((e=>zi.ZP.isUriListType(e)||"text/plain"===e))&&(t.dataTransfer.types.includes(vge)?(n.available=!0,this._isTrashFolder(e)&&(n.edge="none")):n.available=!this._isInTrashFolder(e),n.onto=n.available&&this._canDropOnto(e,t)),n};_canDropOnto=(e,t)=>!this._isInSyncFolder(e)&&(!!this._isFolder(e)||!(t.dataTransfer.types.includes(vge)&&(!this.props.prefValues[I.kPanelsWindowDragToStack]||this._isInPinnedFolder(e)||this._isInStackFolder(e)))&&!this._isInTrashFolder(e));_getDropIndexByNode=(e,t)=>{let n=0;if(e.pageItem){const i=e.pageItem.page.id;n=Ce.ZP.getPages(e.wid).findIndex((e=>e.id===i)),"below"===t&&(n+=1)}else if(e.children){const i=this._getChildren(e);if(i.length>0){if("above"===t||"below"===t){const e=i[0];if(e.pageItem){const t=e.pageItem.page.id;n=Ce.ZP.getPages(e.wid).findIndex((e=>e.id===t))}}"below"===t&&(n+=1)}}return n};_onDrop=async(e,t,n)=>{const i=zi.ZP.extractUriListFromEvent(e).split("\n").map((e=>e));if(i.length>0)if("on"===n&&t.pageItem)c.ZP.openURL(t.wid,i[0],{inCurrent:!0,inSpecificPageId:t.pageItem.page.id,vivExtData:JSON.stringify({workspaceId:t.workspaceId})});else{const e=this._getTargetSpec(t,n),s=this._getDropIndexByNode(t,n),o=t.wid,a=this._getStackFolderByNode(t),r=this._getPageByNode(t),l=a&&r&&(0,kv.av)(r);try{const d=await c.ZP.newTab(o,i[0],{index:s,workspaceId:t.workspaceId,groupId:l}),u=Ce.ZP.getPageById(d);if(u&&this._isWithinFolder(t,n)&&this._isInPinnedFolder(t)){c.ZP.setPinned(ze.aV.of(u),!0);const t=e.pageIndex??e.index??0;await c.ZP.moveToIndex(u.windowId,u,t)}else if(u&&l&&a){const e=r?.index??this._getPageIndex(a)??0;c.ZP.moveToIndex(o,u,e)}this.refTreeList.current?.selectById(d.toString())}catch(e){console.warn(e)}}return Promise.resolve([])};_moveWorkspaces(e,t,n){const i=e.workspaceId,s=GF.Z.getState().map((e=>e.id)),o=t.map((e=>e.workspaceId)).filter(Boolean).toArray(),a=[];if("workspace"===e.type||e.parentId.startsWith("workspace"))for(const e of s)o.includes(e)||(e===i?"above"===n?a.push(...o,e):a.push(e,...o):a.push(e));else if(e.parentId.startsWith("window")){a.push(...o);for(const e of s)a.includes(e)||a.push(e)}a.length===s.length&&CQ.Z.setOrder(a)}_getTargetPage=(e,t,n)=>{const i=t.pageIndex,s=e?.index??0;if(!i||e?.windowId!==t.wid)return this._getPageByNode(t);let o=0;s<i?o="above"===n?-1:0:s>i&&(o="below"===n?1:0);const a=i+o;return Ce.ZP.getPages(t.wid).find((e=>e.index===a))};_onMove=async(e,t,n)=>{const{parentId:i=""}=t;let s=t.index??0;const o=this._getNodeById(i);if(!o||!i)return;this.isDroppingOnWindowOrWorkspace&&"above"===n?n="below":this.isDroppingOnWindowOrWorkspace&&!this._isTrashFolder(o)&&"on"===n?n="above":"stack"===o.type&&"on"===n&&(n="below",s=this._getChildren(o).length),this.isDroppingOnWindowOrWorkspace=!1;const a=void 0!==t.pageIndex?this._getNodeByParentAndPageIndex(i,t.pageIndex):this._getNodeByParentAndIndex(i,s);if(!a)return;const r=(0,ze.aV)(e).map(this._getNodeById).filter(Boolean),l=r.flatMap((e=>e.children?(0,ze.aV)(e.children):ze.aV.of(e))).map(this._getPageByNode).filter(Boolean);let d=this._getTargetPage(l.first(),a,n);d||(d=this._isInPinnedFolder(o)?Ce.ZP.getTabs(o.wid).find((e=>e.page.pinned))?.page:Ce.ZP.getTabs(o.wid).find((e=>!e.page.pinned))?.page);const u=this._getNodeById(e[0]);if(!u)return;const p=u.wid;if(this._isInTrashFolder(a))return void this._closeByIds(e);if(u.trashItem)return void r.forEach((e=>{e.trashItem?.tab?Ni.Z.undeleteTab(e.trashItem.tab.handle.sessionId):e.trashItem?.window&&Ni.Z.undeleteWindow(e.trashItem.window.handle.sessionId)}));const h=a.workspaceId;if(r.every((e=>"workspace"===e.type)))return void this._moveWorkspaces(a,r,n);const g=a.pageItem&&(0,kv.av)(a.pageItem.page),m=e.filter((e=>Ce.ZP.isGroup(e,p)));if("stack"===o.type&&Ce.ZP.isGroup(g,a.wid))await c.ZP.treeMove({windowId:p,pages:l,groups:m,targetArea:"stack",targetPage:d,targetGroup:g,targetWorkspaceId:h});else if(this.props.prefValues[I.kPanelsWindowShowPinnedGroup]&&this._isInPinnedFolder(o)){const e=l.first();let t=e?(0,kv.av)(e):"";t&&l.size>1&&(Ce.ZP.getGroup(t,p).size!==l.size||l.some((e=>(0,kv.av)(e)!==t)))&&(t=""),await c.ZP.treeMove({windowId:p,pages:l,groups:m,targetArea:"pinned",targetPage:d,targetGroup:t,targetWorkspaceId:h})}else if("on"===n&&void 0!==t.pageIndex&&this.props.prefValues[I.kPanelsWindowDragToStack]){if(d){const e=d.id,t=l.filter((t=>t.id!==e));let n=d.index,i=0;for(let e=0;e<t.size;e++){const s=t.get(e);s&&n>s.index&&i++}n-=i;const s=Ce.ZP.getNewGroupId();c.ZP.createTabStack(t.splice(0,0,d),n,s),this.refTreeList.current?.selectById(s)}}else await c.ZP.treeMove({windowId:p,pages:l,groups:m,targetArea:"regular",targetPage:d,targetWorkspaceId:h});l.some((e=>e.active))&&c.ZP.setActiveWorkspace(p,h);const f=new Map([...GF.Z.getWorkspacePageCounts()]);for(const[e,t]of f)if(0===t){const{pageId:t}=await c.ZP.openURL(p,"",{inBackground:!0}),n=await Ce.ZP.getPageInWindow(p,t);n&&c.ZP.moveToWorkspace(n,e)}};_onCopy=(e,t)=>{const n=t.filter(this._isValidForClipboard),i=n.map((e=>e.pageItem?.page)).filter(Boolean),s=n.map((e=>e.syncItem?.url)).filter(Boolean),o=n.map((e=>e.trashItem?.tab?e.trashItem.tab.url:"")).filter(Boolean);c.ZP.copyUrls((0,ze.aV)(i),(0,ze.aV)([...s,...o])),e.preventDefault()};_isValidForClipboard=e=>Boolean(e.pageItem||e.syncItem||e.trashItem?.tab);_isValidToDelete=e=>e.map((e=>this._getNodeById(e))).filter(Boolean).filter((e=>!this._isInPinnedFolder(e))).filter((e=>!this._isInSyncFolder(e))).map((e=>e.id));_getTargetSpec=(e,t)=>{const n={index:0,parentId:void 0,pageIndex:e.pageIndex},i=Boolean(this.refTreeList.current?.isExpanded(e.id)),s=this._isFolder(e);if(!s||"window"!==e.type&&"workspace"!==e.type&&"trash"!==e.type)s&&("on"===t||i&&"below"===t)?n.parentId=e.id:e.parentId?(n.parentId=e.parentId,n.index=e.index+("below"===t?1:0)):(n.parentId=e.id,n.index=0);else if(this.isDroppingOnWindowOrWorkspace=!0,"above"===t){const t=this.state.nodes.findIndex((t=>t.id===e.id)),i=this.state.nodes[Math.max(0,t-1)];n.parentId=i.id,n.index=i.children?.length}else n.parentId=e.id;return n};_reload=()=>{const e=this.getSelectedItems(),t=e.filter((e=>"window"===e.type)).map((e=>this._getChildren(e))).filter(Boolean).reduce(((e,t)=>e.concat(t)),[]).map((e=>e.children||e)).reduce(((e,t)=>e.concat(t)),[]),n=e.filter((e=>"stack"===e.type||"pinned"===e.type)).map((e=>this._getChildren(e))).filter(Boolean).reduce(((e,t)=>e.concat(t)),[]).filter((e=>-1===t.findIndex((t=>t===e.id)))),i=e.filter((e=>"tab"===e.type&&Boolean(e.pageItem))).filter((e=>-1===t.findIndex((t=>t===e.id)))).filter((e=>-1===n.findIndex((t=>t===e.id))));[t,n,i].forEach((e=>{const t=e.map((e=>e.pageItem?.page.id)).filter(Boolean);c.ZP.reloadPage((0,ze.aV)(t))}))};_tile=()=>{const e=this._getTileableSelectedNodes();e.length>1&&c.ZP.tilePages((0,ze.aV)(e.map((e=>e.pageItem?.page)).filter(Boolean)),"row")};_untileTileGroup=()=>{this._getSelectedTilingItems().forEach((e=>{c.ZP.untileTileGroup(e.node.wid,e.tid)}))};_removeTile=()=>{const e=this._getSelectedTilingItems().reduce(((e,{node:t})=>t.pageItem?.page?e.push(t.pageItem.page):e),(0,ze.aV)());c.ZP.untilePages(e)};_setMediaState=(e,t)=>{if("playing"===e){const e=this._getPlayableNodesFrom("selection",t).map((e=>e.pageItem?.page)).filter(Boolean);c.ZP.setMuting(t.wid,"selection","unmute",(0,ze.aV)(e))}else if("muting"===e){const e=this._getMuteableNodesFrom("selection").map((e=>e.pageItem?.page)).filter(Boolean);c.ZP.setMuting(t.wid,"selection","mute",(0,ze.aV)(e))}};newTab=e=>{const t=Ce.ZP.getActiveWorkspace(e);c.ZP.newTab(e,"",{workspaceId:t}).then((e=>{this.refTreeList.current?.expandToId(e.toString()),this.refTreeList.current?.selectById(e.toString())})).catch((e=>{console.warn(e)}))};_newTabAfter=e=>{const t=this._getNodeById(e);if(!t)return;const n=this._getTargetSpec(t,"below"),i="window"===t.type||"workspace"===t.type?"on":"below",s=this._getDropIndexByNode(t,i);this.blockPageStoreChange=!0,c.ZP.newTab(t.wid,"",{index:s,workspaceId:t.workspaceId}).then((e=>{if(this._isWithinFolder(t,"below")){const i=Ce.ZP.getPages(t.wid).find((t=>t.id===e));if(this._isInPinnedFolder(t)){const e=this._getPageIndex(t);i&&void 0!==e&&(c.ZP.setPinned(ze.aV.of(i),!0),c.ZP.moveToIndex(i.windowId,i,e))}else if(this._isInStackFolder(t)){const e=this._getPageByNode(t),s=this._getStackFolderByNode(t);if(e&&s){const t=this._getChildren(s).map((e=>e.pageItem?.page)).filter(Boolean);t.splice(n.index??0,0,i),c.ZP.createTabStack((0,ze.aV)(t.filter(Boolean)),this._getPageIndex(s),e.vivExtData.group)}}}this.blockPageStoreChange=!1,this._onPageStoreChanged(),this.refTreeList.current?.expandToId(e.toString()),this.refTreeList.current?.selectById(e.toString())})).catch((e=>{console.warn(e)}))};_cloneTab=()=>{const e=this.getSelectedItems().map((e=>e.pageItem?.page)).filter(Boolean);c.ZP.clonePages((0,ze.aV)(e))};_pinTab=()=>{const e=this.getSelectedItems().filter((e=>!this._isInStackFolder(e))).map((e=>e.pageItem?.page)).filter(Boolean).filter((e=>!e.pinned));c.ZP.setPinned((0,ze.aV)(e),!0)};_unpinTab=()=>{const e=this.getSelectedItems().map((e=>e.pageItem?.page)).filter(Boolean).filter((e=>e.pinned));c.ZP.setPinned((0,ze.aV)(e),!1)};_closeWithId=(e,t)=>{(0,ms.ZP)(t);const n=this._getNodeById(e);if(n)if("tab"===n.type)this.refTreeList.current?.onDeleteItems([n.id]);else if("stack"===n.type){const e=this._getPageIdByNode(n);"number"==typeof e&&c.ZP.closeTabStack(e)}};_deleteWithId=(e,t)=>{(0,ms.ZP)(t);const n=this._getNodeById(e);n&&this.refTreeList.current?.onDeleteItems([n.id])};_close=()=>{const e=this.getSelectedItems(),t=e.filter((e=>"stack"===e.type)),n=t.map((e=>this._getChildren(e))).filter(Boolean).reduce(((e,t)=>e.concat(t)),[]),i=e.filter((e=>Boolean(e.pageItem))).filter((e=>-1===n.findIndex((t=>t===e.id))));this.blockPageStoreChange=!0;let s=t.map((e=>this._getPageByNode(e))).filter(Boolean);s.forEach((e=>{c.ZP.closeTabStack(e.id)})),s=i.map((e=>e.pageItem?.page)).filter(Boolean).filter((e=>!e.pinned)),c.ZP.closePage((0,ze.aV)(s)),this.blockPageStoreChange=!1,this._onPageStoreChanged()};_reopen=()=>{const e=this.getSelectedItems().filter((e=>Boolean(e.trashItem))),t=e.filter((e=>Boolean(e.trashItem?.window))),n=t.map((e=>e.children)).filter(Boolean).reduce(((e,t)=>e.concat(t)),[]),i=e.filter((e=>-1===n.findIndex((t=>t===e.id))));t.forEach((e=>{e.trashItem?.window&&Ni.Z.undeleteWindow(e.trashItem.window.handle.sessionId)})),i.forEach((e=>{e.trashItem?.tab&&Ni.Z.undeleteTab(e.trashItem.tab.handle.sessionId)}))};_createTabStack=e=>{if(e.length<2)return;let t=-1;for(let n=0;n<e.length;n++){let i=e[n];if(i&&this._isInStackFolder(i)&&(i=this._getNodeById(i.parentId)),!i)return;{const e=this._getPageIndex(i)??-1;(-1===t||t>e)&&(t=e)}}const n=e.map((e=>e.pageItem?.page)).filter(Boolean);if(n.length<2)return;const i=Ce.ZP.getNewGroupId();return c.ZP.createTabStack((0,ze.aV)(n),-1===t?0:t,i),this.refTreeList.current?.selectById(i),i};_disolveTabStack=()=>{const e=this.getSelectedItems(),t=e.filter((e=>"stack"===e.type)),n=t.map((e=>this._getPageByNode(e))).filter(Boolean);n.forEach((e=>{const t=(0,kv.av)(e);t&&c.ZP.expandTabStack(e.windowId,t)})),n.length>0&&e.length===t.length&&this.refTreeList.current?.selectById(n[0].id.toString())};_hibernate=()=>{this._getDiscardablePages().forEach((e=>{c.ZP.discardPage(e)}))};_reopenLastClosedTab=()=>{Ni.Z.undeletePreviousTab()};_validateForEdit=e=>{const t=this._getNodeById(e);return!!t&&("workspace"===t.type||Ce.ZP.isGroup(e,t.wid)||Boolean(t.pageItem))};_getTitle=e=>{let t;const n=this._getNodeById(e);if(n?.pageItem)t=n.pageItem.page.vivExtData.fixedTitle;else if("stack"===n?.type){const e=n?.children;e&&e[0]?.pageItem&&(t=(0,kv.XN)(e[0]?.pageItem.page))}return t??n?.title??""};_setTitle=(e,t)=>{const n=this._getNodeById(e);n&&("workspace"===n.type&&n.workspaceId?t&&CQ.Z.setName(n.workspaceId,t):n.pageItem?c.ZP.setFixedTitle(n.pageItem.page.id,t):Ce.ZP.isGroup(e,n.wid)&&c.ZP.setFixedStackTitle(n.wid,e,t))};_getMenuCapability=async(e,t,n)=>{const i=n?n.wid:this.context.vivaldiWindowId,s=n?.pageItem?.page,o="tab"===n?.type,a=o||"stack"===n?.type,r=a||"window"===n?.type,l="workspace"===n?.type,d=Boolean(n&&this._isInTrashFolder(n)),u=n&&this._isInSyncFolder(n),p=this.getSelectedItems(),h=this.#Un(p),g=this.#Wn(p),m={hostname:s?(0,uge.q)(s):"",selectedCount:h.length,selectedStackableCount:g.length,isInTrashFolder:d};let f,v=!1;if(s)f=(0,kv.av)(s);else if(!o&&n?.children&&"stack"===n?.type){const e=n.children[0]?.pageItem?.page;e?.pinned&&(v=!0),f=e&&(0,kv.av)(e)}switch(e.action){case"CONTEXT_NEW":return{handler:()=>{n?this._newTabAfter(n.id):this.newTab(i)},isVisible:()=>!n||!d&&!u,...t(i,e,m)};case"CONTEXT_NEW_STACK":return{handler:()=>this._createTabStack(g),isVisible:()=>{const e=g.filter((e=>e.pageItem?.page.pinned)).length;return(0===e||e===g.length)&&!u&&a&&g.length>1},...t(i,e,m)};case"CONTEXT_NEW_STACK_FOR_HOST":if(!n)return{isVisible:()=>!1,...t(i,e,m)};const{pageItem:h,workspaceId:y}=n,b=h?.hostname||"",S=b?this._getStackableNodesForHost(n.wid,y,b):[];return{handler:()=>c.ZP.createGroupByHost(n.wid,y,b),isVisible:()=>o&&!u&&1===p.length&&S.length>1,...t(i,e,m)};case"CONTEXT_TABSTACK_UNGROUP":return{handler:()=>{this._disolveTabStack()},isVisible:()=>"stack"===n?.type,...t(i,e,m)};case"CONTEXT_CLONE":return{handler:()=>{this._cloneTab()},isVisible:()=>o&&!d&&!u,...t(i,e,m)};case"CONTEXT_ACTIVATE":return{handler:()=>{if(xi.Z.focus(i),s){const e=(0,kv.cm)(s);e!==Ce.ZP.getActiveWorkspace(i)&&c.ZP.setActiveWorkspace(i,e),c.ZP.activateTab(s.id,i)}},isVisible:()=>("window"!==n?.type||i!==this.context.vivaldiWindowId)&&(r&&!d&&!u),...t(i,e,m)};case"CONTEXT_RELOAD":return{handler:()=>{this._reload()},isVisible:()=>r&&!d&&!u,...t(i,e,m)};case"CONTEXT_HIBERNATE":return{handler:()=>{this._hibernate()},isEnabled:()=>this._getDiscardablePages().length>0,isVisible:()=>(r||l)&&!d&&!u,...t(i,e,m)};case"CONTEXT_PIN":return{handler:()=>{this._pinTab()},isVisible:()=>Boolean(s&&!s.pinned&&!d&&!f),...t(i,e,m)};case"CONTEXT_PIN_STACK":return{handler:()=>f&&c.ZP.pinTabStack(f,this.context.vivaldiWindowId),isVisible:()=>!v&&Ce.ZP.isGroup(f,i)&&"stack"===n?.type,...t(i,e,m)};case"CONTEXT_UNPIN":return{handler:()=>{this._unpinTab()},isVisible:()=>Boolean(s?.pinned)&&!d&&!f,...t(i,e,m)};case"CONTEXT_UNPIN_STACK":return{handler:()=>f&&c.ZP.unpinTabStack(f,this.context.vivaldiWindowId),isVisible:()=>v,...t(i,e,m)};case"CONTEXT_TILE_TABS":return{handler:()=>{this._tile()},isVisible:()=>{if(a&&!u){const e=Ce.ZP.getActiveWorkspace(i),t=this._getTileableSelectedNodes();return t.length>0&&t.every((t=>{const n=t?.pageItem?.page;return n&&t.wid===i&&(0,kv.cm)(n)===e}))}return!1},...t(i,e,m)};case"CONTEXT_UNTILE_TAB":return{handler:this._removeTile,isVisible:()=>a&&this._allTabsHaveTheSameTilingId(),...t(i,e,m)};case"CONTEXT_UNTILE_TILE_GROUP":return{handler:this._untileTileGroup,isVisible:()=>a&&this._allTabsHaveTheSameTilingId(),...t(i,e,m)};case"CONTEXT_MUTE":return{handler:()=>{n&&this._setMediaState("muting",n)},isVisible:()=>r&&!d&&!u&&this._getMuteableNodesFrom("selection").length>0,...t(i,e,m)};case"CONTEXT_MUTE_OTHER":{const s="window"===n?.type&&Boolean(n.wid!==this.context.vivaldiWindowId);return{handler:()=>{n&&this._muteOthers(n)},isVisible:()=>!!n&&((a||s)&&this._getMuteableNodesFrom("all").filter((e=>e.id!==n.id)).length>0),...t(i,e,m)}}case"CONTEXT_UNMUTE":return{handler:()=>{n&&this._setMediaState("playing",n)},isVisible:()=>!!n&&(r&&this._getPlayableNodesFrom("selection",n).length>0),...t(i,e,m)};case"CONTEXT_EMPTY_TRASH":return{handler:()=>{Ni.Z.emptyTrash()},isVisible:()=>Boolean(n&&this._isTrashFolder(n)&&cge.Z.getTrash().length>0),...t(i,e,m)};case"CONTEXT_REOPEN":return{handler:()=>{n?this._reopen():this._reopenLastClosedTab()},isVisible:()=>Boolean((!n||n.trashItem)&&cge.Z.getTrash().length>0),...t(i,e,m)};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{handler:()=>n?.workspaceId&&c.ZP.detachWorkspace(i,n.workspaceId),isVisible:()=>"workspace"===n?.type,isEnabled:()=>{const e=Ce.ZP.getActiveWorkspaces();return"number"==typeof n?.workspaceId&&!e.has(n.workspaceId)},...t(i,e,m)};case"CONTEXT_OPEN_SYNC_ITEMS":return{handler:()=>{n&&this._openSyncItems(p)},isVisible:()=>void 0!==n&&this._isInSyncFolder(n)&&this._hasSyncUrls(n),...t(i,e,m)};case"CONTEXT_REGISTER_SYNC":return{handler:()=>{de.Z.showSettings(this.context.vivaldiWindowId,"sync",{view:"register"})},isVisible:()=>void 0!==n&&this._isInSyncFolder(n)&&!Ai.getLoggedIn(),...t(i,e,m)};case"CONTEXT_SIGNIN_SYNC":return{handler:()=>{de.Z.showSettings(this.context.vivaldiWindowId,"sync")},isVisible:()=>void 0!==n&&this._isInSyncFolder(n)&&!Ai.getLoggedIn(),...t(i,e,m)};case"COMMAND_PAGE_COPY_ALL_URLS":{const s={...t(i,e,m)};let o=!1;return n&&("workspace"===n.type?o=n.workspaceId===Ce.ZP.getActiveWorkspace(n.wid):"window"===n.type&&(o=n.wid===he.ZP.getActiveWindowId()&&void 0===Ce.ZP.getActiveWorkspace(n.wid))),{...s,shortcuts:o?s.shortcuts:[],handler:()=>{n&&c.ZP.copyAllUrls(n.wid,n.workspaceId)},isVisible:()=>"workspace"===n?.type||"window"===n?.type}}default:return{...t(i,e,m)}}};_getMenuVisibility=(e,t)=>{if(t)if(this._isTrashFolder(t))switch(e.action){case"CONTEXT_EXPAND_ALL":case"CONTEXT_COLLAPSE_ALL":return!0;default:return!1}else if("workspace"===t.type)switch(e.action){case"CONTEXT_RENAME":return this._validateForEdit(t.id)&&1===this.getSelectedItems().length;case"CONTEXT_SAVE":case"CONTEXT_SAVE_ALL":case"CONTEXT_DELETE":case"CONTEXT_EXPAND_ALL":case"CONTEXT_COLLAPSE_ALL":return!0;default:return!1}else{const n=this._isValidToDelete([t.id]).length>0,i=!he.ZP.isGuest()&&(this._isInSyncFolder(t)?this._hasSyncUrls(t):!this._isInTrashFolder(t)),s=i&&!this._isInSyncFolder(t),o=this.getSelectedItems();switch(e.action){case"CONTEXT_RENAME":return this._validateForEdit(t.id)&&1===o.length;case"CONTEXT_COPY":return this._isValidForClipboard(t);case"CONTEXT_SAVE":case"CONTEXT_SAVE_ALL":return i;case"CONTEXT_EXPORT_ALL":return s;case"CONTEXT_EXPORT":return s&&o.length>0;case"CONTEXT_DELETE":return n;case"CONTEXT_EXPAND_ALL":case"CONTEXT_COLLAPSE_ALL":return!0;default:return!1}}else switch(e.action){case"CONTEXT_EXPAND_ALL":case"CONTEXT_COLLAPSE_ALL":return!0;default:return!1}};_getMenuState=e=>{const t=e?.pageItem?.page,n=this.getSelectedItems(),i=this.#Un(n),s=this.#Wn(n),o=Boolean(e&&this._isInTrashFolder(e));return{hostname:t?(0,uge.q)(t):"",selectedStackableCount:s.length,selectedCount:i.length,isInTrashFolder:o}};onContextMenu=e=>{this.refTreeList.current?.onContextMenu(e)};_handleMouseEnter=e=>{e&&u.Z.setStatus(this.context.vivaldiWindowId,pn.jk.getHoverUrl(e))};_handleMouseLeave=()=>{u.Z.clearStatus(this.context.vivaldiWindowId)};getRowComponentProps=e=>({...e,showBadge:this.props.prefValues[I.kPanelsShowFolderBadge]});getDisplayTitle=e=>{switch(e.type){case"window":return`${(0,B.Z)("title","Window")} - ${e.title}`;case"workspace":return`${(0,B.Z)("title","Workspace")} - ${e.title}`;default:return e.title}};getDeviceShape=e=>{switch(e.deviceType){case"desktop":return"desktop";case"tablet":return"tablet";case"phone":return"phone"}return"desktop"};getFolderShape=(e,t)=>{switch(e.type){case"pinned":return"pinned";case"stack":return"stack";case"syncFolder":return"sync";case"syncDevice":return this.getDeviceShape(e);case"syncWindow":return"folder";case"trash":return e.trashItem?.window?"folder":"trash";case"workspace":return t?.emoji?"emoji":t?.icon?"workspace":e.emoji?"emoji":"workspace"}return"folder"};getFolderIconUrl=(e,t)=>{if(t){if(t.emoji)return t.emoji;if(t.icon)return t.icon}if(e){if(e.emoji)return e.emoji;if(e.icon)return e.icon}return""};rowComponent=e=>{const t=e.node,n=e.level,i=(n+1)*ks,s=n*ks,o=this._isInPinnedFolder(t)&&!this.props.prefValues[I.kPanelsWindowShowPinnedGroup],a=this._isUnread(t),r=Boolean(t.pageItem?.discarded)&&this.props.prefValues[I.kTabsDimHibernated],l=this._getPageByNode(t),d=this.props.prefValues[I.kTabsShowCloseButton]&&l&&Ce.ZP.canClosePage(l)&&!this._isInTrashFolder(t)&&!this._isInSyncFolder(t)&&"window"!==t.type&&"workspace"!==t.type,u=!d&&this._isInTrashFolder(t)&&!this._isTrashFolder(t),p=t.pageItem?.page&&Gie.Z.getState().get(t.pageItem?.page.id)||(0,ze.l4)(),h=0===p.size||r,g=t.count?t.count:0,m=this._isFolder(t)||o?{url:"",loadType:"faviconFromCache"}:function(e){return{url:e.pageItem?.faviconUrl||e.syncItem?.faviconUrl||e.trashItem?.tab?.faviconUrl||"",loadType:e.pageItem?.loadType||e.syncItem?.loadType||e.trashItem?.tab?.loadType||"faviconFromCache"}}(t),f="workspace"===t.type?GF.Z.getWorkspaceById(t.workspaceId):void 0;return[hge("label",{onMouseEnter:()=>this._handleMouseEnter(t.pageItem?.url||t.syncItem?.url||t.trashItem?.tab?.url),onMouseLeave:this._handleMouseLeave,title:t.url},"window__panel__"+t.id,this._hasChildren(t)&&hge("span",{className:"expand-icon",style:{marginLeft:s},onClick:ms.ZP,onMouseDown:ms.ZP,onMouseUp:e=>this._handleExpandClick(e,t.id),dangerouslySetInnerHTML:{__html:Wi.nfH}}),!h&&!this._isFolder(t)&&hge("span",{className:"tab-audio",onClick:p.has("pip")?()=>c.ZP.exitPictureInPicture(t.pageItem.page.id):()=>this._setMediaState(p.has("muting")?"playing":"muting",t)},void 0,hge(joe.Z,{animated:this.props.prefValues[I.kThemeUseAnimation],mediaState:p,src:"tab"})),this._isFolder(t)&&hge(che,{leftMargin:this._hasChildren(t)?0:i,shape:this.getFolderShape(t,f),url:this.getFolderIconUrl(t,f)}),!this._isFolder(t)&&!o&&(0,ss.jsx)(ss.Fragment,{children:m.url.startsWith("<svg")?hge("span",{className:"svg-icon",style:h?{marginLeft:i}:void 0,dangerouslySetInnerHTML:{__html:m.url}}):(0,ss.jsx)(Ri.ZP,{...m,className:Fi()({discarded:r}),style:h?{marginLeft:i}:void 0})}),o&&hge("svg",{width:"16",height:"16",viewBox:"0 0 16 16",className:"pinned-icon",style:h?{marginLeft:i}:null},void 0,yge),void 0!==e.inlineEditText&&hge("input",{type:"text",value:e.inlineEditText,onChange:e.onChange,onFocus:e.onFocus,onBlur:e.onBlur,autoFocus:!0}),void 0===e.inlineEditText&&hge("span",{className:Fi()({title:!0,active:t.pageItem?.active,unread:a})},void 0,this.getDisplayTitle(t)),e.showBadge&&this._hasChildren(t)&&hge("span",{className:"item-count"},void 0,g),d&&hge("span",{className:"close",title:(0,B.Z)("Close"),tabIndex:"-1",onClick:e=>this._closeWithId(t.id,e),dangerouslySetInnerHTML:{__html:Wi.kze}}),u&&hge("span",{className:"close",title:(0,B.Z)("verb","Delete"),tabIndex:"-1",onClick:e=>this._deleteWithId(t.id,e),dangerouslySetInnerHTML:{__html:Wi.kze}}))]};menu={name:"windowlist",getCapability:this._getMenuCapability,getVisibility:this._getMenuVisibility,getState:this._getMenuState};render(){return 0!==this.state.nodes.length&&this.state.hasContent?(0,ss.jsx)(Ps,{ref:this.refTreeList,settings:"WINDOWS_PANEL",rowComponent:this.rowComponent,getRowComponentProps:this.getRowComponentProps,nodes:this.state.nodes,folderMode:"expand",hasChildren:this._hasChildren,isFolder:this._isFolder,supportsInlineEdit:!0,isValidToEdit:this._validateForEdit,getTitle:this._getTitle,saveTitle:this._setTitle,onItemClick:this._onNodeClick,onItemDoubleClick:this._onNodeDoubleClick,onItemMouseDown:this._onNodeMouseDown,onItemMouseUp:this._onNodeMouseUp,onItemsActivated:this.handleNodesActivated,delete:this._closeByIds,onExport:this._saveSessionByIds,onSave:this._saveBookmarkByIds,onDrop:this._onDrop,onMove:this._onMove,onCopy:this._onCopy,validateForDeletion:this._isValidToDelete,menu:this.menu,mimeType:vge,validateForDrag:this._validateForDrag,getDropSupport:this._getDropSupport,getTargetSpec:this._getTargetSpec,getDragData:this._getDragData,setCustomEventBehavior:this._setCustomEventBehavior,supportsDeepCopy:!1,sorting:this.props.sorting}):this.props.filter?hge("p",{},void 0,(0,B.Z)("Nothing found")):null}}const Sge=(0,Bu.Z)(bge,gge);var wge,Cge=n(34155);function Age(e,t,n,i){wge||(wge="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:wge,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Ige=[{text:"",value:"title",fullScreenTitle:(0,B.Z)("Sort by Title")},{text:"",value:"pageItem.hostname",fullScreenTitle:(0,B.Z)("Sort by Host")},{text:"",value:"pageItem.domain",fullScreenTitle:(0,B.Z)("Sort by Domain")},{text:"",value:"sound",fullScreenTitle:(0,B.Z)("Sort by Audio Status")}],Tge=[I.kKeyboardTabToAll,I.kPanelsWindowSorting];class Zge extends Li.PureComponent{refTree=Li.createRef();static contextType=ts.Z;nodeRef=Li.createRef();constructor(e){super(e);const t=this.props.prefValues[I.kPanelsWindowSorting];this.state={filter:"",sorting:{sortOrder:t.sortOrder,sortField:t.sortField,comparator:this.sortComparator}}}componentDidMount(){Yn.ZP.addListener(this.onPanelStoreChange)}componentWillUnmount(){Yn.ZP.removeListener(this.onPanelStoreChange)}componentDidUpdate(e,t){!e.open&&this.props.open&&Cge.nextTick((()=>this.focusTree()))}onPanelStoreChange=()=>{const e=Yn.ZP.getWindowData(this.context.vivaldiWindowId),t=Yn.ZP.getChangeReason();this.props.open&&e?.focusContent&&"setFocus"===t&&!(0,Ra.sT)(this.context.document,this.nodeRef.current)&&this.focusTree()};onSortChange=(e,t)=>{this.setState((n=>({sorting:{sortOrder:e,sortField:t,comparator:n.sorting.comparator}}))),w.Z.set(I.kPanelsWindowSorting,{sortOrder:e,sortField:t})};sortComparator=(e,t)=>{if("trash"===e.type&&!e.trashItem)return 1;if("trash"===t.type&&!t.trashItem)return-1;if("syncFolder"===e.type)return 1;if("syncFolder"===t.type)return-1;if("pinned"===e.type)return-1;if("pinned"===t.type)return 1;if("stack"===e.type&&"stack"!==t.type)return-1;if("stack"===t.type&&"stack"!==e.type)return 1;const{sortOrder:n,sortField:i}=this.state.sorting;if("sound"===i)return this.sortForSound(e,t,n);return ds.Z.getDefaultComparator(n,i)(e,t)};sortForSound=(e,t,n)=>{if(n<=ds.Z.NO_SORTING)return 0;let i="";if(e.pageItem){const{page:t}=e.pageItem;t.discarded||(Gie.Z.hasMediaState(t.id,"playing")||Gie.Z.hasMediaState(t.id,"muting"))&&(i="playing")}let s="";if(t.pageItem){const{page:e}=t.pageItem;e.discarded||(Gie.Z.hasMediaState(e.id,"playing")||Gie.Z.hasMediaState(e.id,"muting"))&&(s="playing")}if("playing"===i)return-1;if("playing"===s)return 1;return ds.Z.getDefaultComparator(n,"title")(e,t)};focusTree=()=>{this.refTree.current?.focusTree()};handleFilterChange=e=>{const t=e.target.value;this.setState({filter:t})};onContextMenu=e=>{this.refTree.current?.onContextMenu(e)};onAddTab=e=>{this.refTree.current?.newTab(this.context.vivaldiWindowId)};onAddWindow=e=>{const t=this.context.vivaldiWindowId;he.ZP.isGuest()?xi.Z.openIncognitoWindow(t):xi.Z.openBrowserWindow(t)};render(){if(!this.props.open)return null;return(0,ss.jsxs)("div",{ref:this.nodeRef,className:"panel",id:"window-panel",children:[Age("header",{},void 0,Age(im,{title:this.props.title,showCloseButton:this.props.showCloseButton}),Age("div",{className:"toolbar toolbar-default toolbar-wrap",role:"toolbar","aria-label":(0,B.Z)("toolbar label","Windows Panel")},void 0,Age("input",{type:"search",className:"tabsearch",placeholder:(0,B.Z)("verb","Search"),value:this.state.filter,onChange:this.handleFilterChange}),Age("div",{className:"toolbar-group"},void 0,Age(po.ZP,{tooltip:(0,B.Z)("command","New Tab"),tabIndex:this.props.prefValues[I.kKeyboardTabToAll],onClick:this.onAddTab,image:Wi.md4.small}),Age(po.ZP,{tooltip:he.ZP.isGuest()?(0,B.Z)("action","New Private Window"):(0,B.Z)("action","New Window"),tabIndex:this.props.prefValues[I.kKeyboardTabToAll],onClick:this.onAddWindow,image:Wi.NxY.small})))),Age(Mm,{fields:Ige,onSortChange:this.onSortChange,keyAccess:this.props.keyAccess,sortField:this.state.sorting.sortField,sortOrder:this.state.sorting.sortOrder}),Age("section",{className:"outerScrollbar",onContextMenu:this.onContextMenu},void 0,(0,ss.jsx)(Sge,{ref:this.refTree,sorting:this.state.sorting,filter:this.state.filter}))]})}}const Ege=(0,Bu.Z)(Zge,Tge);var kge;function _ge(e,t,n,i){kge||(kge="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:kge,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function Nge(e){return{selectedPanel:Yn.ZP.getSelected(e),panelWidth:Yn.ZP.getWidth(e),barVisible:Yn.ZP.getIsBarVisible(e),contentVisible:Yn.ZP.getIsContentVisible(e),focusContent:Yn.ZP.getFocusContent(e),isMailWindow:he.ZP.isMail(e),regPanels:Yn.ZP.getRegPanels(e),webPanels:Yn.ZP.getWebPanels(e),changeReason:Yn.ZP.getChangeReason()}}function Pge(e,t){const n=e.faviconUrl?e.faviconUrl:e.url;return{id:e.id,title:e.title,faviconUrl:n,faviconUrlValid:!1!==e.faviconUrlValid,hasBeenActive:t,hasBeenVisible:t,activeUrl:e.activeUrl}}function Dge(e){const t=Nge(e),n=Mge(t),i=[];return t.webPanels.forEach((e=>{const s=e.id===t.selectedPanel&&!n;i.push(Pge(e,s))})),t.webPanelData=i,t}function Mge(e){const t=(e.panelToggleVisible?Yn.fG:0)+(e.barVisible?Yn.Pv+2*(0,Cs.mM)():0);return e.panelWidth<=t}const Oge=[I.kAppearanceDensity,I.kKeyboardTabToAll,I.kPanelsAsOverlayAutoClose,I.kPanelsAsOverlayEnabled,I.kPanelsLazyLoad,I.kPanelsShowCloseButton,I.kThemeUseAnimation,I.kTabsBarPosition,I.kPanelsWebToolbar,I.kToolbarsPanel,I.kMailDisplayMailPanelViewingMail,I.kMailOpenPanelAutomaticallyViewingMail];class xge extends Li.PureComponent{static contextType=ts.Z;refPanelsContainer=Li.createRef();refFocusContainer=Li.createRef();nodeRef=Li.createRef();isDraggingOverButton=!1;blockNextBlur=!1;delayTimeout=null;dndTimerId=null;resizingTimeout=null;dropMode={support:!1,copy:!1};panelResource={};constructor(e,t){super(e),this.winId=t.vivaldiWindowId,this.trackContextOnFocus=sse("panel",t),this.panelResource={PanelBookmarks:{title:(0,B.Z)("Bookmarks"),panel:nue},PanelMail:{title:(0,B.Z)("Mail"),panel:Rk},PanelFeeds:{title:(0,B.Z)("Feeds"),panel:Rk},PanelContacts:{title:(0,B.Z)("Contacts"),panel:cpe},PanelDownloads:{title:(0,B.Z)("Downloads"),panel:zm},PanelNotes:{title:(0,B.Z)("Notes"),panel:xpe},PanelHistory:{title:(0,B.Z)("History"),panel:fpe},PanelWindow:{title:(0,B.Z)("title","Windows"),panel:Ege},PanelCalendar:{title:(0,B.Z)("Calendar"),panel:wue},PanelTasks:{title:(0,B.Z)("Tasks"),panel:Whe},PanelChat:{title:(0,B.Z)("Chat"),panel:GB},PanelTranslate:{title:(0,B.Z)("title","Translate"),panel:tge},PanelReadingList:{title:(0,B.Z)("Reading List"),panel:Kpe},PanelSession:{title:(0,B.Z)("Sessions"),panel:_he}},this.state={isResizing:!1,panelToggleVisible:he.ZP.getVisibleUI(this.winId).panelToggle,webPanelData:[],minimized:Yn.ZP.getIsBarVisible(this.winId)&&!Yn.ZP.getIsContentVisible(this.winId)?"buttons":"auto",...Dge(this.winId)}}componentDidMount(){const{selectWindow:e}=this.context;this.context.addEventListener("resize",this.onWindowResize,!1),Yn.ZP.addListener(this._onPanelStoreChange),he.ZP.addListener(this._onWindowStoreChanged,e),Oa.Z.addListener("COMMAND_FOCUS_PANELBAR",this.onCommandSpy),this._onPanelStoreChange()}componentDidUpdate(e){e.prefValues[I.kAppearanceDensity]!==this.props.prefValues[I.kAppearanceDensity]&&this._onPanelStoreChange()}componentWillUnmount(){this.context.addEventListener("resize",this.onWindowResize,!1),Yn.ZP.removeListener(this._onPanelStoreChange),he.ZP.removeListener(this._onWindowStoreChanged),Oa.Z.removeListener("COMMAND_FOCUS_PANELBAR",this.onCommandSpy),this.clearDndTimer(),clearTimeout(this.resizingTimeout)}getNode(){return this.refFocusContainer.current}onWindowResize=()=>{this.state.panelWidth<=Ju.Ej||(this.setState({isResizing:!0}),clearTimeout(this.resizingTimeout),this.resizingTimeout=setTimeout((()=>{this.setState({isResizing:!1}),this.state.selectedPanel&&jn.Z.setWidth(this.winId,this.state.selectedPanel,this.limitPanelWidth(this.state.panelWidth))}),1e3))};_onPanelStoreChange=()=>{const e=Nge(this.winId),{selectedPanel:t,contentVisible:n=!1,regPanels:i,webPanels:s,focusContent:o=!1,barVisible:a=!1,panelWidth:r,isMailWindow:l,changeReason:d}=e,c=s.length===this.state.webPanelData.length&&t===this.state.selectedPanel&&Mge(this.state)===Mge(e)?void 0:e.selectedPanel,u=this.setupWebPanelData(s,c);this.setState((e=>{let{minimized:c,isResizing:p}=e;const h=Yn.Pv+2*(0,Cs.mM)();!n&&r<=Yn.fG?c="auto":!n&&r<=h+Yn.fG&&(c="buttons");return{panelWidth:p?e.panelWidth:r,webPanelData:u,minimized:c,selectedPanel:t,regPanels:i,webPanels:s,contentVisible:n,focusContent:o,barVisible:a,isMailWindow:l,isResizing:p,changeReason:d}}))};_onWindowStoreChanged=()=>{const e=he.ZP.getVisibleUI(this.winId).panelToggle,t=he.ZP.isMail(this.winId);this.state.panelToggleVisible===e&&this.state.isMailWindow===t||this.setState({panelToggleVisible:e,isMailWindow:t,panelWidth:Yn.ZP.getWidth(this.winId)})};onCommandSpy=e=>{e===this.winId&&((0,Ra.sT)(this.context.document,this.refPanelsContainer.current?.focusRef.current??null)||this.moveFocus("current",!0))};setSelected=e=>{jn.Z.toggleContent(this.winId,e),Yn.ZP.getIsWebPanel(e)&&jn.Z.setWebPanelBoolValue(e,"hasBeenVisible",!0)};handleDoubleClick=()=>{this.props.prefValues[I.kPanelsAsOverlayEnabled]&&this.props.prefValues[I.kPanelsAsOverlayAutoClose]||this.handlePanelSwitch()};handleClickOutside=()=>{if(!this.state.contentVisible)return;this.autoClosePanel(0);const e=this.refPanelsContainer.current,{document:t,Element:n}=this.context;e&&e.focusRef.current instanceof n&&e.focusRef.current.contains(t.activeElement)&&jn.Z.removeFocus(this.winId)};onSlidebarPosition=(e,t)=>{let n;switch(this.props.position){case"left":n=Math.round(e);break;case"right":n=Math.round(this.context.innerWidth-e);break;default:throw new Error("Unknown tabbar position")}n=this.limitPanelWidth(n),this.setState({panelWidth:n}),this.state.selectedPanel&&jn.Z.setWidth(this.winId,this.state.selectedPanel,n)};limitPanelWidth=e=>(0,Gw.Z)(e,Ju.Ej,.618*this.context.innerWidth);handlePanelSwitch=()=>jn.Z.togglePanel(this.winId);shouldShowCloseButton=e=>this.props.prefValues[I.kPanelsShowCloseButton]&&!((Yn.ZP.getSeparateFloating(e,this.winId)||this.props.prefValues[I.kPanelsAsOverlayEnabled])&&this.props.prefValues[I.kPanelsAsOverlayAutoClose]);autoClosePanel=(e=600)=>{if(!this.props.canAutoClose())return;if(!this.state.selectedPanel||!this.props.prefValues[I.kPanelsAsOverlayAutoClose])return;const t=Yn.ZP.getSeparateFloating(this.state.selectedPanel,this.winId),n=this.props.prefValues[I.kPanelsAsOverlayEnabled];(!1!==t&&n||!0===t&&!n)&&(this.cancelTimeout(),this.delayTimeout=setTimeout((()=>{"PanelMail"===this.state.selectedPanel&&!1===Yn.ZP.getSeparateFloating("PanelMail",this.winId)&&this.props.prefValues[I.kMailDisplayMailPanelViewingMail]&&(this.props.prefValues[I.kMailOpenPanelAutomaticallyViewingMail]||this.state.contentVisible)||this.state.contentVisible&&jn.Z.closePanel(this.winId)}),e))};cancelTimeout=()=>clearTimeout(this.delayTimeout);onDialogOpen=()=>{this.props.prefValues[I.kPanelsAsOverlayEnabled]&&this.props.prefValues[I.kPanelsAsOverlayAutoClose]&&this.state.contentVisible&&(this.blockNextBlur=!0)};handleBlur=e=>{const{Element:t}=this.context;this.blockNextBlur||e.target instanceof t&&e.target.classList.contains("home")?(this.blockNextBlur=!1,this.cancelTimeout()):this.autoClosePanel()};getWebPanelDataById=e=>this.state.webPanelData.find((t=>t.id===e));setupWebPanelData=(e,t)=>e.map((e=>{const{faviconUrl:n,url:i,faviconUrlValid:s}=e,o=e.id,a=this.getWebPanelDataById(o),r=o===t;return a?{...a,faviconUrl:n||i,faviconUrlValid:!1!==s,hasBeenVisible:r||e.hasBeenVisible,hasBeenActive:!(a.hasBeenActive||!r)||a.hasBeenActive}:Pge(e,r)}));isPanelOpen=e=>this.state.contentVisible&&this.state.selectedPanel===e;clearDndTimer=()=>{this.dndTimerId&&clearTimeout(this.dndTimerId),this.dndTimerId=null};onDragEnterBar=e=>{if(e.preventDefault(),e.stopPropagation(),he.ZP.isGuest())this.dropMode={support:!1,copy:!1};else{const t=e.dataTransfer.types.some((e=>zi.ZP.isUriListType(e)||"text/plain"===e)),n=t&&!e.dataTransfer.types.some((e=>e===p.Up));this.dropMode={copy:n,support:t}}};onDragOverBar=e=>{e.preventDefault(),this.dropMode.support?(this.clearDndTimer(),this.dropMode.copy,e.dataTransfer.dropEffect=this.dropMode.copy?"copy":"move"):e.dataTransfer.dropEffect="none"};onDropBar=e=>{this.dropMode.support&&zi.ZP.getUrlsFromEventPromise(e,!0).then((e=>{e.forEach((e=>{vr.Z.addByUrl(this.winId,e.url,!0)}))}))};onDragLeave=e=>{e.preventDefault(),e.stopPropagation(),this.clearDndTimer(),this.dndTimerId=setTimeout((()=>{this.isDraggingOverButton=!1,this.dndTimerId=null}),p._p)};handleSliderDown=()=>this.setState({isResizing:!0});handleSliderUp=()=>this.setState({isResizing:!1});handlePanelButtonKeyDown=e=>{switch(e.key){case"ArrowUp":this.moveFocus("left",!1);break;case"ArrowDown":this.moveFocus("right",!1);break;case"Escape":this.leaveBar();break;default:return}e.preventDefault(),e.stopPropagation()};moveFocus=(e,t)=>{const{document:n}=this.context,i=this.refPanelsContainer.current?.focusRef.current??null,s=n.querySelector(".toolbar-panel .uifocusstop");if(!0===t||(0,Ra.sT)(n,i))if("current"===e)s?.focus();else if("left"===e||"right"===e){const t=Array.from(n.querySelectorAll(".toolbar-panel > *:not(.toolbar-spacer-flexible, .toolbar-spacer, .toolbar-divider)"));if(1===t.length)return;let i=t.indexOf(n.activeElement?.parentElement||s?.parentElement);i="right"===e?i+1>=t.length?0:i+1:i<=0?t.length-1:i-1,t[i].querySelector("input[type=text], input[type=search], button")?.focus()}};leaveBar=()=>{de.Z.setPaneFocus(this.winId,!1),ne.Z.executeActions("event",this.context,"COMMAND_FOCUS_WEBVIEW")};getBarContextMenu=e=>{const t=this.winId,n=ji.Z.getOptionFunction(e);return ji.Z.getNamedMenu(t,e,(async e=>{if("CONTAINER_CLOSED_WEBPANEL"===e.action){const i={...n(t,e,{})};return 0===i.items?.length&&(i.isVisible=()=>!1),i}return{...n(t,e,{})}}))};renderAllPanels=()=>{const e=this.state.selectedPanel&&Yn.ZP.getIsWebPanel(this.state.selectedPanel);return(0,ss.jsxs)(ss.Fragment,{children:[this.state.regPanels.map((e=>{const t=e.id,n=this.panelResource[t];if(n)return _ge(Lu,{level:"tabs"},"panel-"+t,_ge(n.panel,{keyAccess:this.props.prefValues[I.kKeyboardTabToAll],title:n.title,panelId:t,open:this.isPanelOpen(t),onOpenDialog:this.onDialogOpen,showCloseButton:this.shouldShowCloseButton(t),focusContent:"layout"!==this.state.changeReason}))})).filter(Boolean),_ge("div",{className:e?"webpanel-stack":"webpanel-stack hidden"},void 0,this.state.webPanels.map((e=>{const t=this.getWebPanelDataById(e.id),n=!!t&&t.hasBeenVisible;return this.renderWebPanel(e,n)})))]})};renderWebPanel=(e,t)=>{if(!t)return null;const n=this.state.contentVisible&&this.state.selectedPanel===e.id;return _ge(R6,{isVisible:n,focusContent:this.state.focusContent&&n,panelUI:this.props.prefValues[I.kPanelsWebToolbar],webPanel:e,showCloseButton:this.shouldShowCloseButton(e.id)},e.id)};renderSlidebar=e=>_ge(Zm.Z,{style:e?{left:e}:void 0,onSlidebarPosition:this.onSlidebarPosition,onStart:this.handleSliderDown,onStop:this.handleSliderUp,onDoubleClick:this.handleDoubleClick,offset:1,position:this.props.position});toolbarMenu=()=>this.getBarContextMenu("panelbar");render(){const{barVisible:e,contentVisible:t,panelWidth:n,isResizing:i}=this.state,{position:s,prefValues:o}=this.props,a=this.state.panelToggleVisible?Yn.fG:0,r=2*(0,Cs.mM)(),l=a+(e?Yn.Pv+r:0),d=Mge(this.state),c=o[I.kPanelsAsOverlayEnabled],u=this.state.selectedPanel?Yn.ZP.getSeparateFloating(this.state.selectedPanel,this.winId):void 0;let p;p=void 0===u?c:u;const h=Fi()({[s]:!0,button:this.state.panelToggleVisible,switcher:n<=Yn.fG,icons:e&&!t,overlay:p,minimized:p&&"buttons"===this.state.minimized,resizing:i||"layout"===this.state.changeReason}),g="right"===s&&e||"left"===s&&!e?"0 0 0 8 4 4":"4 0 4 8 0 4",m=o[I.kThemeUseAnimation]&&!i&&"layout"!==this.state.changeReason?t?128:64:0,f=n-l+(p?0:1),v=p&&o[I.kPanelsAsOverlayAutoClose]&&t,y="left"===s?2:3,b="left"===s?n-y:-(n-l+y);return(0,ss.jsxs)(za.Z,{focusName:"focus_panel",id:"panels-container",ref:this.refPanelsContainer,className:h,style:{width:p?n-f:n,"--duration":m+"ms",transition:`width ${p?"0ms":"var(--duration)"} ease-out`},children:[(0,ss.jsxs)("div",{id:"panels",ref:this.refFocusContainer,onBlur:v?this.handleBlur:null,onFocus:e=>{this.trackContextOnFocus(e),v&&this.cancelTimeout()},inert:this.props.inert?"inert":null,children:[this.state.panelToggleVisible&&_ge("div",{id:"panel_switch",title:e?(0,B.Z)("Hide Panel"):(0,B.Z)("verb","Show Panel"),onClick:this.handlePanelSwitch},void 0,_ge("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"4px",height:"8px",viewBox:"0 0 4 8"},void 0,_ge("polygon",{points:g}))),_ge("div",{id:"switch",className:"slim-scrollbar",onDragEnter:this.onDragEnterBar,onDragLeave:this.onDragLeave,onDragOver:this.onDragOverBar,onDrop:this.onDropBar,onKeyDown:this.handlePanelButtonKeyDown},void 0,_ge(tre,{name:I.kToolbarsPanel,label:(0,B.Z)("toolbar label","Panels"),className:"toolbar-panel",menuOrigin:"left"===s?"topRight":"topLeft",popupPosition:"left"===s?"right":"left",menu:this.toolbarMenu,layout:"vertical",size:"medium"})),this.state.selectedPanel&&_ge("div",{className:"panel-group",inert:this.props.editToolbar?"true":null,style:p?{width:d?0:n-l,[s]:l}:null},void 0,_ge("div",{className:"panel-collapse-guard",role:"tabpanel","aria-labelledby":"ui-region-panel-title","aria-hidden":d,id:"ui-region-panel",style:{minWidth:i?"unset":f-1,maxWidth:i?"unset":f-1}},void 0,this.renderAllPanels())),!d&&p&&this.renderSlidebar(b)]}),!d&&!p&&this.renderSlidebar()]})}}const Lge=(0,Bu.Z)((0,sy.Z)(xge),Oge);var Rge;function Bge(e,t,n,i){Rge||(Rge="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Rge,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class Fge extends Li.Component{render(){const{domain:e,trackersCount:t}=this.props.blockedData,{columns:n}=this.props;if(n.length<1||!this.props.blockedData)return null;var i=Bge("span",{},void 0,e);return n.map((e=>{switch(e.id){case"domain":return Bge("label",{},e.id,i);case"trackersCount":return Bge("label",{className:"count"},e.id,Bge("span",{},void 0,(0,R.uf)(t)));default:return null}}))}}const Wge=Fge;var Uge;function Vge(e,t,n,i){Uge||(Uge="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Uge,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Hge="privacy_stats_domain",Gge=[{text:(0,B.Z)("Address"),value:"domain",fullScreenTitle:(0,B.Z)("Sort by Address"),width:300,visible:!0,key:!0},{text:(0,B.Z)("Trackers"),value:"trackersCount",fullScreenTitle:(0,B.Z)("Sort by Trackers"),width:90,visible:!0}];class $ge extends Li.PureComponent{constructor(e){super(e);const t=vs().privacy_stats_domain;this.state={sorting:{sortOrder:1,sortField:"manually"},columns:t||ys(Gge)}}onSortChange=(e,t)=>{this.setState({sorting:{sortOrder:e,sortField:t}})};onUpdateRow=e=>{this.setState({columns:e})};onSaveRow=()=>fs(this.state.columns,Hge);getRowComponentProps=e=>({columns:this.state.columns,blockedData:e.node});render(){const{columns:e,sorting:t}=this.state,{blockedData:n}=this.props,i=n.blocked_domains.tracking.reduce(((e,t)=>(e.push({domain:t.domain,trackersCount:t.blocked_count}),e)),[]).sort(((e,t)=>e.trackersCount>t.trackersCount?-1:1));return(0,ss.jsxs)(ss.Fragment,{children:[Vge(Mm,{fields:Gge,fullsize:!0,columns:e,keyAccess:0,manualSorting:!1,sortField:t.sortField,sortOrder:t.sortOrder,onSortChange:this.onSortChange,onSaveRow:this.onSaveRow,onUpdateRow:this.onUpdateRow}),Array.isArray(i)&&i.length&&Vge(Ps,{rowComponent:Wge,getRowComponentProps:this.getRowComponentProps,nodes:i,enableDragAndDrop:!1,isFolder:gE.Z,disableClipboard:!0,hasChildren:gE.Z,sorting:t,columns:e,multiSelect:!1,onItemDoubleClick:Lr.Z})]})}}const Kge=$ge;var zge;function jge(e,t,n,i){zge||(zge="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:zge,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class Yge extends Li.Component{render(){const{domain:e,adsCount:t,trackersCount:n}=this.props.blockedData,{columns:i}=this.props;if(i.length<1||!this.props.blockedData)return null;var s=jge("span",{},void 0,e);return i.map((e=>{switch(e.id){case"domain":return jge("label",{},e.id,s);case"trackersCount":return jge("label",{className:"count"},e.id,jge("span",{},void 0,(0,R.uf)(n)));case"adsCount":return jge("label",{className:"count"},e.id,jge("span",{},void 0,(0,R.uf)(t)));default:return null}}))}}const Xge=Yge;var Qge;function qge(e,t,n,i){Qge||(Qge="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Qge,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Jge="privacy_stats_origin",eme=[{text:(0,B.Z)("Address"),value:"domain",fullScreenTitle:(0,B.Z)("Sort by Address"),width:300,visible:!0,key:!0},{text:(0,B.Z)("Trackers"),value:"trackersCount",fullScreenTitle:(0,B.Z)("Sort by Trackers"),width:90,visible:!0},{text:(0,B.Z)("Ads"),value:"adsCount",fullScreenTitle:(0,B.Z)("Sort by Ads"),width:90,visible:!0}];class tme extends Li.PureComponent{constructor(e){super(e);const t=vs().privacy_stats_origin;this.state={sorting:{sortOrder:1,sortField:"manually"},columns:t||ys(eme)}}getFormattedData=()=>{const{blockedData:e}=this.props,t=e.blocked_for_origin.ad_blocking.reduce(((e,t)=>(e.push({domain:t.domain,adsCount:t.blocked_count,trackersCount:0}),e)),[]);return e.blocked_for_origin.tracking.reduce(((e,n)=>{if(t.find((e=>e.domain===n.domain))){const t=e.findIndex((e=>e.domain===n.domain));e[t].trackersCount=n.blocked_count}else e.push({domain:n.domain,adsCount:0,trackersCount:n.blocked_count});return e}),t).sort(((e,t)=>e.adsCount+e.trackersCount>t.adsCount+t.trackersCount?-1:1))};onSortChange=(e,t)=>{this.setState({sorting:{sortOrder:e,sortField:t}})};onUpdateRow=e=>this.setState({columns:e});onSaveRow=()=>fs(this.state.columns,Jge);getRowComponentProps=e=>({columns:this.state.columns,blockedData:e.node});render(){const{columns:e,sorting:t}=this.state,n=this.getFormattedData();return(0,ss.jsxs)(ss.Fragment,{children:[qge(Mm,{fields:eme,fullsize:!0,columns:e,keyAccess:0,manualSorting:!1,sortField:t.sortField,sortOrder:t.sortOrder,onSortChange:this.onSortChange,onSaveRow:this.onSaveRow,onUpdateRow:this.onUpdateRow}),Array.isArray(n)&&n.length&&qge(Ps,{rowComponent:Xge,getRowComponentProps:this.getRowComponentProps,nodes:n,enableDragAndDrop:!1,isFolder:gE.Z,disableClipboard:!0,hasChildren:gE.Z,sorting:t,columns:e,multiSelect:!1,onItemDoubleClick:Lr.Z})]})}}const nme=tme;var ime;function sme(e,t,n,i){ime||(ime="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:ime,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const ome=["tracking","ad_blocking"];var ame=sme(co,{type:"blocker-shield",size:40,className:"Blocker-Shield-Trackers Modal-Shield"}),rme=sme(co,{type:"blocker-shield",size:40,className:"Blocker-Shield-Ads Modal-Shield"});class lme extends Li.PureComponent{static contextType=ts.Z;isMounted=!1;websiteId=crypto.randomUUID();trackerId=crypto.randomUUID();constructor(e){super(e),this.state={totalAdBlocked:0,totalTrackerBlocked:0,blockedData:{blocked_domains:{tracking:[],ad_blocking:[]},blocked_for_origin:{tracking:[],ad_blocking:[]}},originDomainData:{domain:"",adsCount:0,trackersCount:0},currentTabId:this.websiteId,startBlockingDate:0,trackerBlockingEnabled:!1,adBlockingEnabled:!1}}componentDidMount(){se.Z.contentBlocking.getBlockedCounters(this.handleBlockedCounter),this.getRules(),this.isMounted=!0}handleCloseModal=()=>{this.props.onClose()};handleBlockedCounter=(e,t)=>{if(!t||!t.blocked_for_origin)return;const n=t.blocked_for_origin.ad_blocking.reduce(((e,t)=>e+t.blocked_count),0),i=t.blocked_for_origin.tracking.reduce(((e,t)=>e+t.blocked_count),0);this.setState({totalAdBlocked:n,totalTrackerBlocked:i,blockedData:t,startBlockingDate:e})};clearBlockedData=()=>{se.Z.contentBlocking.clearBlockedCounters(),this.setState({totalAdBlocked:0,totalTrackerBlocked:0,blockedData:{blocked_domains:{tracking:[],ad_blocking:[]},blocked_for_origin:{tracking:[],ad_blocking:[]}},startBlockingDate:0})};setDefaultBlocking=e=>{const{value:t}=e.target;switch(t){case"0":se.Z.contentBlocking.setActiveExceptionsList("tracking","process_list"),se.Z.contentBlocking.setActiveExceptionsList("ad_blocking","process_list");break;case"1":se.Z.contentBlocking.setActiveExceptionsList("tracking","exempt_list"),se.Z.contentBlocking.setActiveExceptionsList("ad_blocking","process_list");break;case"2":se.Z.contentBlocking.setActiveExceptionsList("tracking","exempt_list"),se.Z.contentBlocking.setActiveExceptionsList("ad_blocking","exempt_list")}this.getRules()};getRules=()=>ome.forEach((e=>(0,SC.pg)(e,(e=>{this.setState(e)}))));render(){if(!this.isMounted)return null;const{startBlockingDate:e,totalTrackerBlocked:t,totalAdBlocked:n,currentTabId:i,blockedData:s,trackerBlockingEnabled:o,adBlockingEnabled:a}=this.state,r=0+(o?1:0)+(a?1:0);return sme(ra.Z,{className:"slide Privacy-Stats-Modal",onRequestClose:this.handleCloseModal,labelledBy:"dialog-privacy-stats-title"},void 0,sme("header",{className:"dialog-header"},void 0,sme("h1",{id:"dialog-privacy-stats-title"},void 0,(0,B.Z)("Privacy Statistics")),sme("p",{},void 0,e?(0,B.Z)("Trackers and ads blocked since: $1",[W()(e).format("LLL")]):(0,B.Z)("Nothing has been blocked yet. Please select an appropriate blocking level below."))),sme("div",{className:"dialog-content"},void 0,sme("div",{className:"Blocked-Stats-Container"},void 0,sme("div",{className:"Blocked-Stats"},void 0,ame,sme("div",{},void 0,sme("p",{className:"Number-Blocked"},void 0,(0,R.uf)(t)),sme("p",{},void 0,(0,B.Z)("Tracker prevented from profiling you","Trackers prevented from profiling you",[t])))),sme("div",{className:"Blocked-Stats"},void 0,rme,sme("div",{},void 0,sme("p",{className:"Number-Blocked"},void 0,(0,R.uf)(n)),sme("p",{},void 0,(0,B.Z)("Ad blocked","Ads blocked",[n]))))),(t>0||n>0)&&sme(PV,{className:"Privacy-Stats-Board",activeTabId:i,onTabClick:e=>this.setState({currentTabId:e})},void 0,sme("div",{label:(0,B.Z)("Websites"),id:this.websiteId},void 0,sme(nme,{blockedData:s})),sme("div",{label:(0,B.Z)("Trackers"),id:this.trackerId},void 0,sme(Kge,{blockedData:s}))),sme("div",{className:"Blocking-Level"},void 0,sme("h3",{},void 0,(0,B.Z)("Blocking Level:")),sme(ta.Z,{className:"Blocking-Level-Select",value:r,onChange:this.setDefaultBlocking,title:(0,B.Z)("Select default level of protection.")},void 0,sme("option",{value:0},void 0,(0,B.Z)("No Blocking")),sme("option",{value:1},void 0,(0,B.Z)("Block Trackers")),sme("option",{value:2},void 0,(0,B.Z)("Block Trackers and Ads"))))),sme("footer",{className:"dialog-footer"},void 0,sme("button",{className:"privacy-btn-icon",title:(0,B.Z)("Privacy Settings"),dangerouslySetInnerHTML:{__html:Wi.sgm.medium+(0,B.Z)("Privacy Settings")},onClick:()=>{de.Z.showSettings(this.context.vivaldiWindowId,"privacy"),this.handleCloseModal()}}),sme("input",{type:"button",className:"danger",value:(0,B.Z)("Reset Statistics"),onClick:this.clearBlockedData}),sme("input",{type:"button",value:(0,B.Z)("Close"),onClick:()=>this.handleCloseModal()})))}}const dme=lme;var cme;function ume(e,t,n,i){cme||(cme="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:cme,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const pme=[I.kRazerChromaHasShownPromotion],hme={width:400,minWidth:"unset"};class gme extends Li.Component{static contextType=ts.Z;constructor(e){super(e)}onClose=()=>{w.Z.set(I.kRazerChromaHasShownPromotion,!0),this.props.onClose()};openSettings=()=>{de.Z.showSettings(this.context.vivaldiWindowId,"themes"),this.onClose()};render(){return ume(ra.Z,{onRequestClose:Lr.Z,style:hme,className:"slide",title:(0,B.Z)("Razer Chroma device detected")},void 0,ume("div",{className:"dialog-content"},void 0,ume("p",{},void 0,(0,B.Z)("Vivaldi supports connected Razer Chroma devices. You can enable them with Vivaldi from the Themes section in settings."))),ume("footer",{className:"dialog-footer"},void 0,ume("input",{type:"submit",value:(0,B.Z)("Go to Theme Settings"),onClick:this.openSettings,autoFocus:!0}),ume("input",{type:"button",value:(0,B.Z)("Close"),onClick:this.onClose})))}}const mme=(0,Bu.Z)(gme,pme);var fme;function vme(e,t,n,i){fme||(fme="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:fme,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const yme=w.Z.getEventHandler,bme=[I.kSessionsSaveAllWorkspaces];class Sme extends Li.Component{static contextType=ts.Z;state={shown:!0,name:void 0===this.props.options.updateId?"":Mce.ZP.getTitle(this.props.options.updateId),errorSaving:!1,saveOnlyCurrentWindow:!1};_getSaveByIds=()=>"ids"===this.props.options.mode&&Boolean(this.props.options.ids?.length);_close=()=>{this.state.shown&&this.setState((e=>({shown:!1})),(()=>{this.props.options.onClose&&this.props.options.onClose(0),this.props.onClose()}))};_onSaveSession=async()=>{const e=this.state.saveOnlyCurrentWindow?this.context.vivaldiWindowId:0;let t=[];switch((()=>this._getSaveByIds()?"ids":this.props.prefValues[I.kSessionsSaveAllWorkspaces]?"all":"visible")()){case"ids":t=this.props.options.ids??[];break;case"visible":(()=>{const e=new Map;return he.ZP.getIds("normal").forEach((t=>{e.set(t,Ce.ZP.getActiveWorkspace(t))})),e})().forEach(((n,i)=>{0!==e&&e!==i||(n?t.push(...Ce.ZP.getWorkspacePages(n).map((e=>e.id)).toArray()):t.push(...Ce.ZP.getPages(i,{workspaceId:void 0}).map((e=>e.id)).toArray()))}))}const n=void 0===this.props.options.updateId?await li.Z.add(this.state.name,this.props.options.parentId??-1,this.props.options.index??-1,this.props.options.owner??"",e,t):await li.Z.update(this.props.options.updateId,e,t);0===n?(this.props.options.onClose&&this.props.options.onClose(n),this.props.onClose()):this.setState({errorSaving:!0})};_nameChange=e=>{this.setState({name:e.target.value})};_toggleSaveOnlyCurrentWindow=()=>{this.setState((e=>({saveOnlyCurrentWindow:!e.saveOnlyCurrentWindow})))};render(){const e=this.state.errorSaving?(0,B.Z)("Error saving the session."):"",t=void 0!==this.props.options.updateId,n=t?(0,B.Z)("Update Session"):this._getSaveByIds()?(0,B.Z)("session","Save Selected Tabs as Session"):(0,B.Z)("session","Save Open Tabs as Session");return vme(ra.Z,{onRequestClose:this._close,title:n},void 0,vme("div",{className:"save-session"},void 0,vme("form",{},void 0,vme("div",{className:"dialog-content session-dialog"},void 0,t&&vme("span",{className:"selectable"},void 0,this.state.name),!t&&vme("input",{type:"text",placeholder:(0,B.Z)("Session Name"),value:this.state.name,onChange:this._nameChange,spellCheck:"false",autoFocus:!0}),!this._getSaveByIds()&&vme("label",{className:"dialog-checkbox"},void 0,vme("input",{type:"checkbox",checked:this.props.prefValues[I.kSessionsSaveAllWorkspaces],onChange:yme(I.kSessionsSaveAllWorkspaces)}),vme("span",{},void 0,(0,B.Z)("Include All Workspaces"))),!this._getSaveByIds()&&vme("label",{className:"dialog-checkbox"},void 0,vme("input",{type:"checkbox",checked:this.state.saveOnlyCurrentWindow,disabled:this.props.prefValues[I.kSessionsSaveAllWorkspaces],onChange:this._toggleSaveOnlyCurrentWindow}),vme("span",{},void 0,(0,B.Z)("Save Only Tabs In Current Window"))),""!==e&&vme("div",{className:"error-validation"},void 0,e)),vme("footer",{className:"dialog-footer"},void 0,vme("input",{type:"submit",className:"primary",onClick:this._onSaveSession,value:(0,B.Z)("Save"),autoFocus:t}),vme("input",{type:"button",onClick:this._close,value:(0,B.Z)("Cancel")})))))}}const wme=(0,Bu.Z)(Sme,bme);var Cme;function Ame(e,t,n,i){Cme||(Cme="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Cme,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Ime={width:420,minWidth:"unset"};var Tme=Ame("img",{src:"resources/welcomepage-vivaldi.svg",width:"46",height:"46",alt:""}),Zme=Ame("svg",{width:"15",height:"15",viewBox:"0 0 15 15",xmlns:"http://www.w3.org/2000/svg"},void 0,Ame("path",{opacity:"0.5",d:"M8.5 1H6.5V6.5H1V8.5H6.5V14H8.5V8.5H14V6.5H8.5V1Z"}));class Eme extends Li.Component{static contextType=ts.Z;state={switchPromptData:null};componentDidMount(){se.Z.searchEngines.getSwitchPromptData((e=>this.setState({switchPromptData:e})))}onClose=()=>{se.Z.searchEngines.acknowledgeSwitchPrompt(!0),this.props.onClose()};replaceSearchEngine=()=>{const{switchPromptData:e}=this.state;e&&(se.Z.searchEngines.setDefault("defaultSearch",e.partnerSearchEngine.guid),se.Z.searchEngines.setDefault("defaultSearchField",e.partnerSearchEngine.guid),se.Z.searchEngines.setDefault("defaultSpeeddials",e.partnerSearchEngine.guid)),this.onClose()};getPartnerIcon(e){return e.split(".")[0].toLowerCase()}render(){const{switchPromptData:e}=this.state;if(!e)return null;const t=e.partnerSearchEngine.name,n=e.currentSearchEngine.name,i=this.getPartnerIcon(t);return Ame(ra.Z,{onRequestClose:Lr.Z,style:Ime,className:"float search-partner-dialog"},void 0,Ame("div",{className:"dialog-header"},void 0,Tme,Zme,Ame("img",{src:`resources/search_${i}.svg`,width:"46",height:"46",alt:""})),Ame("div",{className:"dialog-content"},void 0,Ame("h2",{},void 0,(0,B.Z)("A new Search Engine")),Ame("p",{className:"faded-text"},void 0,"Startpage"===t||"Startpage.com"===t?(0,B.Z)("To support the development of Vivaldi, we have partnered with Startpage and set it as your new default search engine. Startpage is a private search engine we like, and we hope you like it too."):(0,B.Z)("To support the development of Vivaldi, we have partnered with $1 and set it as your new default search engine.",[t]))),Ame("footer",{className:"dialog-footer"},void 0,Ame("input",{type:"submit",value:(0,B.Z)("Use $1",[t]),onClick:this.replaceSearchEngine,autoFocus:!0}),Ame("input",{type:"button",value:(0,B.Z)("Keep using $1",[n]),onClick:this.onClose})))}}const kme=Eme;var _me;function Nme(e,t,n,i){_me||(_me="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:_me,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class Pme extends Li.Component{handleClick=()=>{this.props.onClose()};render(){return Nme(ra.Z,{onRequestClose:Lr.Z,className:"default-browser",asToolbar:!0,label:(0,B.Z)("toolbar label","Default browser prompt")},void 0,Nme(hW,{onClose:this.handleClick}))}}const Dme=Pme;class Mme extends m.Z{getInitialState(){return[]}getStartupDialogs(){return this.getState()}reduce(e,t){switch(t.actionType){case"STARTUP_DIALOGS_INIT":return t.state;case"STARTUP_DIALOG_CLOSE":const n=e.filter((e=>e!==t.dialog));return n.length===e.length?e:n}return e}}const Ome=new Mme(A.Z);var xme;function Lme(e,t,n,i){xme||(xme="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:xme,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Rme={width:400,minWidth:"unset"};class Bme extends Li.Component{static contextType=ts.Z;state={visible:!1};componentDidMount(){fY.addListener(this.onStoreChange),pe.addListener(this.onStoreChange),se.Z.utilities.onSharedDataUpdated.addListener(this.onSharedDataChanged),this.onStoreChange()}componentWillUnmount(){fY.removeListener(this.onStoreChange),pe.removeListener(this.onStoreChange)}onSharedDataChanged=(e,t)=>{"syncErrorReport"===e&&"reported"===t&&this.setState({visible:!1})};onStoreChange=()=>{const e=ce(pe.getState()),t=fY.getState().engineData;(t.isFirstSetupComplete||"disable_sync_on_client"===t.protocolErrorClientAction)&&("credentialsMissing"===e||"loginFailed"===e||"started"===t.engineState&&t.needsDecryptionPassword||"failed"===t.engineState||"disable_sync_on_client"===t.protocolErrorClientAction?se.Z.utilities.getSharedData({key:"syncErrorReport",value:"canReport"},(e=>{"canReport"===e&&this.setState({visible:!0})})):"loggedIn"!==e||"started"!==t.engineState||t.needsDecryptionPassword||se.Z.utilities.setSharedData({key:"syncErrorReport",value:"canReport"}))};onClose=()=>{se.Z.utilities.setSharedData({key:"syncErrorReport",value:"reported"})};openSettings=()=>{de.Z.showSettings(this.context.vivaldiWindowId,"sync"),this.onClose()};render(){return this.state.visible?Lme(ra.Z,{onRequestClose:this.onClose,style:Rme,className:"slide",title:(0,B.Z)("Sync Disabled")},void 0,Lme("div",{className:"dialog-content"},void 0,Lme("p",{},void 0,(0,B.Z)("An issue caused Vivaldi Sync to stop working. You can find more details in the Sync Settings."))),Lme("footer",{className:"dialog-footer"},void 0,Lme("input",{type:"submit",value:(0,B.Z)("Go to Sync Settings"),onClick:this.openSettings,autoFocus:!0}),Lme("input",{type:"button",value:(0,B.Z)("Close"),onClick:this.onClose}))):null}}const Fme=Bme;var Wme,Ume=n(65810);function Vme(e,t,n,i){Wme||(Wme="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Wme,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function Hme({page:e,tabIndex:t,animated:n,color:i,mediaState:s}){const o=Li.useContext(ts.Z);return s.has("playing")||s.has("muting")?Vme("button",{className:"tooltip-audio-button",tabIndex:t,onClick:function(t){t&&t.stopPropagation(),c.ZP.toggleMuting(o.vivaldiWindowId,ze.aV.of(e))}},void 0,Vme(joe.Z,{color:i,animated:n,mediaState:s,src:"tab"})):null}const Gme=Li.memo(Hme);class $me extends hr.Z{dispatchAction(e){switch(e.actionType){case"TAB_SWITCH_BACK_SETTING":this.emitChange({action:"switchTabBackBySetting",winId:e.winId,event:e.event});break;case"TAB_SWITCH_FORWARD_SETTING":this.emitChange({action:"switchTabForwardBySetting",winId:e.winId,event:e.event});break;case"TAB_VIEW_PAGE_SOURCE":this.emitChange({action:"viewPageSource",winId:e.winId});break;case"TAB_STACK_CREATE":this.emitChange({action:"stackCreate",winId:e.winId});break;case"TAB_STACK_DISSOLVE":this.emitChange({action:"stackDissolve",winId:e.winId});break;case"TAB_STACK_REMOVE":this.emitChange({action:"stackRemove",winId:e.winId});break;case"DISBAND_TILE_GROUP":this.emitChange({action:"disbandTileGroup",winId:e.winId});break;case"TAB_STACK_TILE_GRID":this.emitChange({action:"stackTileGrid",winId:e.winId});break;case"TAB_STACK_TILE_HORIZONTAL":this.emitChange({action:"stackTileHorizontal",winId:e.winId});break;case"TAB_STACK_TILE_VERTICAL":this.emitChange({action:"stackTileVertical",winId:e.winId});break;case"TAB_TOGGLE_THUMBNAIL":this.emitChange({action:"tabThumbnail",winId:e.winId});break;case"UNLOAD_DIALOG_CLOSED":this.emitChange({action:"unloadDialogClosed",winId:e.windowId})}}}const Kme=new $me(A.Z);var zme;function jme(e,t,n,i){zme||(zme="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:zme,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Yme=function({isActive:e,orientation:t="right",onClick:n,style:i,title:s}){const o=["left","up"].includes(t)?"expanded":"closed";return jme("div",{className:Fi()("tab-position","accordion-toggle-arrow",o,{active:e}),style:i,onClick:n,title:s},void 0,jme(co,{type:"folder-arrow",className:t}))};var Xme;function Qme(e,t,n,i){Xme||(Xme="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Xme,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class qme extends Li.PureComponent{_isHorizontal=()=>"top"===this.props.tabPosition||"bottom"===this.props.tabPosition;_handleKeyDown=e=>{switch(e.key){case"ArrowLeft":case"ArrowRight":case"ArrowDown":case"ArrowUp":if((this._isHorizontal()?"ArrowLeft"===e.key||"ArrowRight"===e.key:"ArrowUp"===e.key||"ArrowDown"===e.key)&&this.props.onMoveFocus){const t="ArrowLeft"===e.key||"ArrowUp"===e.key?"left":"right";this.props.onMoveFocus(this.props.id,t,!1)}break;case"Escape":this.props.onLeaveBar?.();break;default:return}e.preventDefault(),e.stopPropagation()};handleClick=e=>{this.props.onCreateTab()};render(){const e="newtab-main"===this.props.id,t=e?(0,B.Z)("Open a New Tab"):(0,B.Z)("Open a New Tab inside the Stack"),n=e?(0,B.Z)("button","New Tab"):(0,B.Z)("button","New Stacked Tab");return Qme(po.ZP,{style:this.props.style,className:"newtab",onKeyDown:this._handleKeyDown,onClick:this.handleClick,tooltip:t,label:n,image:Wi.Wjz.large,commandId:"COMMAND_NEW_TAB"})}}const Jme=qme,efe="iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAAeElEQVR42u3PsQ2AMAxE0T9CRsooGYEN8GYehREywiFZSCAaiOki3q/cnGTmUXE6ep3TuFhRopVDi9MovFVYEKISHLEwyhBOEKIwqiD6OZAh9A/8A1MNdJQuOErmhIqSNQ6GEhkXbeiRjlN5YLfG5Ac29ND2fWA2O2BvJtL+Sqc0AAAAAElFTkSuQmCC",tfe="iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAAeElEQVR42u3UMRGFMBBF0ZUQSUiJBByAs5WChEg4v2CYzK+A0DGcNNnmli9ewyQ116UancWIJXYqWJW4SDGDaT8Tc9xkRe5fKHGTgnYExAD4Al/gVYFmSA+kUXnM2ajax2HEGp0qXdek6XSy/l/cMh6wObM9D7zNDwwfZaGr1mq0AAAAAElFTkSuQmCC",nfe="iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAAg0lEQVR42u2VsQ2FMAwFbwRGYJSMkhHYAG/mUf4IGeF9OlAAW0JCNLkrI52dyrxBwWnopFMhZ0WBKwkVIYyJnokFIQohjli4wxBOiNBh+sxvcz5sIVoa6CYK697zQL/Bw8DOCIzACIzAJ4GGUkMcJTohBSVWEgwFGuTUy480nPLCKf8DboLOlYXq8a8AAAAASUVORK5CYII=",ife="iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAAf0lEQVR42u3VMQ3EMAxAUUMohEIplEIog4ZZoBRCILwbK6W6WDqpuiVvtfTtzfECm6p5qvbIOY2cMWYHxRIdiwNsMaLiiC8U1BiBe7vV5bLeV6ClgW4jpZvngf6CHwO3GZiBGZiBvwSaRBaoMjV7a5k9xhQjJXJ21VNTbS/88g95rrHAQWGpyQAAAABJRU5ErkJggg==",sfe="iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAAXElEQVR42u2VsRHAMAjENBqjsEm8GSMxAlnA+L5wmhxSrzsantsYQVKtgXPgoQQfGpwSNbaEHAi2lGz2AYWiJjCBCUzg94GkVD966yYHnIZFCS4O+PGQJLDLc/4CszsVOj41Gu4AAAAASUVORK5CYII=",ofe="iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAAWUlEQVR42u3VQRHAQAgEQaQhBSc5Z0hCwsQAVO3j8knRAua5a5fhJMUsCZvxoHisR6By65Co0jroagyYAGADG9jABn4fKGQfzbqjCutxUBybESSzIvHLf/4C9P00KaLDfPkAAAAASUVORK5CYII=";var afe;function rfe(e,t,n,i){afe||(afe="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:afe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const lfe="https://vivaldi.com/downloadapp/",dfe={type:"separator",label:"",labelEnglish:""};class cfe extends Li.PureComponent{static contextType=ts.Z;state={popupVisible:!1,isLoggedIn:!1,qrImage:"",deviceTree:[],statusOverlay:"none",sharedLinks:ci.getState().elements};componentDidMount(){Ai.addListener(this._onSyncedTabsStoreChanged),ci.addListener(this._onSharedLinksStoreChanged),this._onSyncedTabsStoreChanged()}componentWillUnmount(){Ai.removeListener(this._onSyncedTabsStoreChanged),ci.removeListener(this._onSharedLinksStoreChanged)}_onSyncedTabsStoreChanged=()=>{const e=ce(pe.getState()),t=fY.getState().engineData,n=fY.getState().cycleData;let i="none";"loggedOut"!==e&&(t.isFirstSetupComplete&&("credentialsMissing"===e||"loginFailed"===e||t.needsDecryptionPassword)||"failed"===t.engineState&&!t.disableReasons.includes("not_signed_in")||"disable_sync_on_client"===t.protocolErrorClientAction?i="failed":["started","stopped"].includes(t.engineState)&&0===parseInt(n.nextRetryTime)||(i="waiting")),this.setState({isLoggedIn:t.isFirstSetupComplete&&"stopped"!==t.engineState,deviceTree:Ai.getDeviceTree(),statusOverlay:i})};_onSharedLinksStoreChanged=()=>{const e=ci.getState().elements;this.setState({sharedLinks:e})};onSignin=()=>{de.Z.showSettings(this.context.vivaldiWindowId,"sync"),this.hidePopup()};onRegister=()=>{de.Z.showSettings(this.context.vivaldiWindowId,"sync",{view:"register"}),this.hidePopup()};trimTitle=e=>(e.length>70&&(e=e.substring(0,70)+"..."),e);getContextMenuItems=()=>{const e=this.state.sharedLinks.map((e=>{const t=(0,B.Z)("From $1: $2",[e.deviceName,e.title]);return{iconPNG:"chrome://favicon/"+e.url,iconPNGWhite:"chrome://favicon/"+e.url,label:t,labelEnglish:t,handler:()=>pi.onActivate(this.context.vivaldiWindowId,[e.guid])}}),[]);e.length>0&&(e.push(dfe),e.push({handler:()=>pi.onDelete(this.state.sharedLinks.map((e=>e.guid))),label:(0,B.Z)("Clear Shared Tabs"),labelEnglish:(0,B.Z)("Clear Shared Tabs")}),e.push(dfe));const t=this.state.deviceTree.map((e=>{const t=new lge(e,this.context.vivaldiWindowId).buildContextMenuTree();let n=efe,i=tfe;switch(e.deviceType){case"tablet":n=sfe,i=ofe;break;case"phone":n=nfe,i=ife}return{items:t,labelEnglish:e.name,label:e.name,iconPNG:n,iconPNGWhite:i}}));return Promise.resolve(e.concat(t))};togglePopup=()=>{this.setState((e=>({popupVisible:!e.popupVisible})))};hidePopup=()=>{this.setState({popupVisible:!1})};tabPosToPopupPos=()=>{const{tabPosition:e}=this.props;return"top"===e?"below":"bottom"===e?"above":"right"===e?"left":"right"};getQRCode=()=>{se.Z.utilities.generateQRCode(lfe,"dataurl",(e=>{this.setState({qrImage:e})}))};renderNoTabSynced=()=>(this.getQRCode(),rfe("div",{className:"synced-tab-dialog"},void 0,rfe("img",{className:"tab-sync-qr-code",src:this.state.qrImage}),rfe("h3",{},void 0,(0,B.Z)("Tabs from your other devices will show here.")),rfe("p",{},void 0,(0,B.Z)("Scan the QR code to install Vivaldi on your smartphone.")),rfe("input",{type:"button",value:(0,B.Z)("Get Vivaldi for Mobile"),onClick:()=>{c.ZP.openURL(this.context.vivaldiWindowId,lfe),this.hidePopup()}})));renderNotLoggedIn=()=>rfe("div",{className:"synced-tab-dialog"},void 0,rfe("span",{dangerouslySetInnerHTML:{__html:n(71665)}}),rfe("p",{},void 0,(0,B.Z)("See your tabs from other devices by signing in to Sync.")),rfe("div",{className:"toolbar toolbar-wrap toolbar-space toolbar-center"},void 0,rfe("input",{type:"button",className:"primary",value:(0,B.Z)("Create Account"),onClick:this.onRegister}),rfe("input",{type:"button",value:(0,B.Z)("Log In"),onClick:this.onSignin})));render(){const{isLoggedIn:e}=this.state;let t=null;e&&0===this.state.deviceTree.length&&0===this.state.sharedLinks.length?t=this.renderNoTabSynced():e||(t=this.renderNotLoggedIn());const n={"--syncStatusActive":e&&"none"===this.state.statusOverlay?1:0,"--syncStatusLoading":"waiting"===this.state.statusOverlay?1:0,"--syncStatusFailed":"failed"===this.state.statusOverlay?1:0},i=this.state.sharedLinks?.length,s=i>0?(0,B.Z)("$1 Shared Tab","$1 Shared Tabs",[i]):(0,B.Z)("Synced Tabs"),o=i>0?i.toString():void 0,a="synced-tabs-button"+(i>0?" receiving":"");return t?rfe(po.ZP,{name:"SyncStatus",className:a,tooltip:s,badgeText:o,image:Wi.ssx.large,onClick:this.togglePopup,hidePopup:this.hidePopup,isPopupVisible:this.state.popupVisible,popupWidth:260,popupPosition:this.tabPosToPopupPos(),popupClassName:"ToolbarButtonPopup-DefaultStyles",popupLabel:(0,B.Z)("dialog title","Synced Tabs"),style:n},void 0,t):rfe(po.ZP,{name:"SyncStatus",className:a,tooltip:s,badgeText:o,image:Wi.ssx.large,menu:this.getContextMenuItems,menuOrigin:"bottomLeft",style:n})}}const ufe=cfe;var pfe;function hfe(e,t,n,i){pfe||(pfe="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:pfe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class gfe extends Li.PureComponent{nodeRef=Li.createRef();render(){const{faviconUrl:e,isPrivate:t,isLoading:n,isFetching:i,progress:s,progressType:o}=this.props,a=Math.round(100*s),r=e.startsWith("<svg");if(n){if("spinner"===o)return(0,ss.jsx)("span",{ref:this.nodeRef,className:"favicon spinner",dangerouslySetInnerHTML:{__html:Wi.H0I}});if("progress_icon"===o)return(0,ss.jsx)("span",{ref:this.nodeRef,className:"favicon progress",style:{"--progressInPercent":a+"%"}})}else if(i){if("spinner"===o)return(0,ss.jsx)("span",{ref:this.nodeRef,className:"favicon spinner spinner-inactive",dangerouslySetInnerHTML:{__html:Wi.H0I}});if("progress_icon"===o)return(0,ss.jsx)("span",{ref:this.nodeRef,className:"favicon progress infinite-spin",style:{"--progressInPercent":a+"%"}})}return(0,ss.jsx)("span",{ref:this.nodeRef,className:"favicon jstest-favicon-image "+(r?"svg":""),children:hfe(Ri.ZP,{refFavicon:this.props.refFavicon,url:e,loadType:t?"faviconSkipCache":"faviconFromCache"})})}}const mfe=gfe,ffe={getMenu:async(e,t)=>{const n=await se.Z.tabsPrivate.getSendTabToSelfTargets();let i=[];return n.valid&&(i=n.entries.map(((n,i)=>{let s="",o="";return"phone"===n.type?(s=nfe,o=ife):"tablet"===n.type?(s=sfe,o=ofe):(s=efe,o=tfe),{iconPNG:s,iconPNGWhite:o,handler:()=>{se.Z.tabsPrivate.sendSendTabToSelfTarget(e,t,n.guid)},...Qe.Z.makeNumberMnemonic(n.name,i)}}))),{valid:n.valid,items:i}}};var vfe;function yfe(e,t,n,i){vfe||(vfe="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:vfe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var bfe,Sfe=yfe("rect",{className:"inner",width:"100%",height:"100%"}),wfe=yfe("rect",{className:"outer",width:"100%",height:"100%"}),Cfe=yfe("rect",{className:"stack-frame",width:"100%",height:"100%"});function Afe({marked:e,isStack:t,isHorizontal:n,isAccordion:i,stackOrFirst:s,accordionFrameSize:o,isDragging:a,isHiddenForDrag:r}){let l,d,c;if(i&&s){if(o>0){const e=(0,Cs.mM)()>0?(0,Cs.mM)():1;n?l=o-e+"px":d=o-e+"px"}else{const e=a||r?0:16;n?l=`calc(var(--Width) + ${e}px)`:d=`calc(var(--Height) + ${e}px)`}c={width:l,height:d}}return yfe("svg",{xmlns:"http://www.w3.org/2000/svg",width:t&&!n?"100%":null,height:t&&n?"100%":null,style:c,className:Fi()({"svg-tab-selection":e,"svg-tab-stack":s})},void 0,e&&Sfe,e&&wfe,s&&Cfe)}function Ife(e,t,n,i){bfe||(bfe="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:bfe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function Tfe({onClick:e,onMouseDown:t}){const n=(0,B.Z)("Close Tab")+"\n"+(0,B.Z)("$1 click to close other tabs except this one",[(0,B.Z)("key","Alt")]);return Ife("button",{className:"close",dangerouslySetInnerHTML:{__html:Wi.kze},onClick:e,onAuxClick:e,onMouseDown:t,title:n})}const Zfe=function(e,t,n,i){const s=()=>{e.removeEventListener("mousemove",l),e.removeEventListener("mouseup",d)},o=(e,n,s,a)=>{se.Z.tabsPrivate.onDragEnd.removeListener(o),se.Z.utilities.broadcastMessage({endDragging:!0}),!e&&n&&c.ZP.detachPage((0,ze.aV)(t),s,a),i&&i.onDragEnd()},a=n.pageX,r=n.pageY,l=e=>{if(Math.abs(e.pageX-a)>5||Math.abs(e.pageY-r)>5){s();const n=(i?i.element:e.target).getBoundingClientRect(),a=i?i.offsetLeft:0,r=i?i.offsetTop:0,l=i?i.offsetHeight:0,d=i?i.offsetWidth:0;se.Z.utilities.broadcastMessage({startDragging:!0}),se.Z.tabsPrivate.onDragEnd.addListener(o);const[c]=t;se.Z.tabsPrivate.startDrag({windowId:c.windowId,mimeType:p.Up,customData:JSON.stringify({ids:t.map((e=>e.id)),active:(t.find((e=>e.active))||c).id}),url:c.url,title:c.title,posX:n.left+a,posY:n.top+r,width:n.width+d,height:n.height+l,cursorX:10,cursorY:10}),i&&i.onDragStart(t)}},d=()=>{s()};e.addEventListener("mousemove",l),e.addEventListener("mouseup",d)},Efe=(e,t,n=!0)=>Boolean(t&&e.ctrlKey),kfe=(e,t,n=!0)=>Boolean(t&&e.shiftKey);var _fe;function Nfe(e,t,n,i){_fe||(_fe="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:_fe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var Pfe,Dfe=Nfe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"100%",height:"4",className:"svg-tab-selection"},void 0,Nfe("line",{className:"inner",x1:"0",y1:"0",x2:"100%",y2:"0"}),Nfe("line",{className:"outer",x1:"0",y1:"0",x2:"100%",y2:"0"}));function Mfe({groupId:e,stackSize:t,highlightId:n,isSelecting:i,checkSelected:s,isUnread:o,isHiddenForDrag:a,onContextMenu:r,onActivate:l,getDraggedPages:d,setPageIdsHiddenForDrag:u}){const p=Li.useContext(ts.Z),h=(0,Ya.Z)([I.kTabsUnread,I.kTabsSelectionEnabled,I.kTabsStackingAllowDnd]),g=Li.useRef({});return Nfe("div",{className:"tab-group-indicator"},void 0,Ce.ZP.getGroup(e,p.vivaldiWindowId).map((e=>{const t=Fi()("tab-indicator",{active:n===e.id,marked:i&&s(e.id),unread:h[I.kTabsUnread]&&o&&e.id!==n,"hidden-for-drag":a}),m=`stack-${e.id}`;return(0,ss.jsx)("div",{ref:e=>{e&&g.current&&(g.current[m]=e)},className:t,title:pn.jk.getDisplayTitle(e),onContextMenu:e=>r(e,!0),onClick:t=>function(e,t){if((0,ms.ZP)(e),e.button===es.Z.kLeft){const n=!1,i=he.ZP.isActive(p.vivaldiWindowId);Efe(e,h[I.kTabsSelectionEnabled],i)?c.ZP.setSelection(t,{multiSelect:!1,addGroup:!1}):kfe(e,h[I.kTabsSelectionEnabled],i)?c.ZP.setSelection(t,{multiSelect:!0,addGroup:!1}):(!(0,ps.Z)(e)||n&&!i&&e.metaKey)&&l(t)}else e.button,es.Z.kCenter}(t,e),onMouseDown:t=>function(e,t,n){(0,ms.ZP)(e);const i=g.current;if(!h[I.kTabsStackingAllowDnd]||!i)return;const s=d(t);Zfe(p,s,e,{offsetLeft:2,offsetTop:3,offsetHeight:-6,offsetWidth:-2,onDragStart:e=>u((0,ze.l4)(e.map((e=>e.id)))),onDragEnd:()=>u((0,ze.l4)()),element:i[n]})}(t,e,m),children:i&&s(e.id)&&Dfe},m)})))}function Ofe(e,t,n,i){Pfe||(Pfe="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Pfe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class xfe extends Li.Component{render(){const{progress:e=0,progressPrecision:t=.1,isFetching:n,visible:i}=this.props;return Ofe("progress",{className:Fi()({"page-progress-indicator":!0,"progress-done":1===e,"progress-visible":i}),value:n?void 0:Math.ceil(100*e/t)*t,max:100})}}const Lfe=xfe;function Rfe({pageId:e,isStack:t,groupId:n,fixedTitle:i,displayTitle:s,awaitingEdit:o,clearAwaitingEdit:a}){const r=Li.useContext(ts.Z),l=t?n:e,d=i??s,[u,p]=Li.useState(!1);function h(){p(!0)}const g=e=>{if("Enter"!==e.key||u)"Escape"===e.key&&((0,ms.ZP)(e),a());else{(0,ms.ZP)(e);const{HTMLInputElement:t}=r;e.target instanceof t&&v(e.target.value)}},m=e=>{const{document:t,HTMLInputElement:n}=r;e instanceof n&&t.activeElement!==e&&e.select()},f=e=>{v(e.target.value)},v=async i=>{t?await c.ZP.setFixedStackTitle(r.vivaldiWindowId,n,i):await c.ZP.setFixedTitle(e,i),a()};return l&&l===o?(0,ss.jsx)("input",{className:"tab-title-edit",defaultValue:d,placeholder:s,ref:m,onBlur:f,onKeyDown:g,onMouseDown:ms.UW,onDoubleClick:ms.UW,onCompositionStart:h,onCompositionUpdate:h,onCompositionEnd:function(){p(!1)}}):d}const Bfe=Li.memo(Rfe),Ffe=function(){let e,t,n,i,s;return function(o,a,r,l){const d=(new Date).getTime();o!==e||a!==t?(e=o,t=a,n=d):o===e&&a===t&&o!==i&&a!==s&&n&&d-n>r&&(l(),i=o,s=a,e=t=n=void 0)}};var Wfe,Ufe=n(34155);function Vfe(e,t,n,i){Wfe||(Wfe="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Wfe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Hfe=Ffe(),Gfe=.15,$fe=.85;function Kfe(e,t){return t?(0,B.Z)("Hibernated"):(0,B.Z)("Current RAM: $1",[(0,Mg.Z)(e,0,!0,!0)])}class zfe extends Li.PureComponent{static contextType=ts.Z;#m=!1;refTab=Li.createRef();refFavicon=Li.createRef();constructor(e){super(e);let t=pn.jk.getDisplayTitleByUrl(e.url,e.title),n="";e.prefValues[I.kTabsCounterDetection]&&({displayTitle:t,badgeText:n}=RS(t,e.url));const i=e.isStack&&!e.isSubstrip?(0,B.Z)("Tab stack with $1 tab","Tab stack with $1 tabs",[e.stackSize]):t;this.state={dragOver:"none",awaitingEdit:void 0,fadeDiscardedTabs:e.prefValues[I.kTabsDimHibernated],loadingProgress:0,timeLeft:void 0,displayTitle:t,badgeText:n,tabTitle:i,isFetching:!1,isLoading:!1}}componentDidMount(){LC.addListener(this._onProgressStateStoreChanged),this.props.doMonitorAlarms&&Xe.Z.addListener(this._alarmsChanged),this.#m=!0,this.props.active&&Ufe.nextTick((()=>this._scrollIntoView()))}componentWillUnmount(){this.#m=!1,LC.removeListener(this._onProgressStateStoreChanged),this.props.doMonitorAlarms&&Xe.Z.removeListener(this._alarmsChanged)}componentDidUpdate(e){!e.active&&this.props.active&&this._scrollIntoView(),!0===e.active&&!1===this.props.active&&void 0!==this.state.awaitingEdit&&this.setState({awaitingEdit:void 0}),!1===e.discarded&&!0===this.props.discarded&&(this.discardedFadeInTimeId&&(clearTimeout(this.discardedFadeInTimeId),delete this.discardedFadeInTimeId),this.props.prefValues[I.kTabsDimHibernated]||(this.discardedFadeInTimeId=setTimeout(this.clearFadedDiscardedTabs,2e3)),this.setState({fadeDiscardedTabs:!0}));const t=e.stackSize!==this.props.stackSize;if(e.url!==this.props.url||e.title!==this.props.title){let e,n=pn.jk.getDisplayTitleByUrl(this.props.url,this.props.title),i="";this.props.prefValues[I.kTabsCounterDetection]&&({displayTitle:n,badgeText:i}=RS(n,this.props.url)),e=t&&this.props.isStack&&!this.props.isSubstrip?(0,B.Z)("Tab stack with $1 tab","Tab stack with $1 tabs",[this.props.stackSize]):n,this.setState({displayTitle:n,badgeText:i,tabTitle:e})}e.doMonitorAlarms!==this.props.doMonitorAlarms&&(this.props.doMonitorAlarms?Xe.Z.addListener(this._alarmsChanged):Xe.Z.removeListener(this._alarmsChanged))}_scrollIntoView=()=>{const e=this.refTab.current;if(e){const t=this.isHorizontal();setTimeout((()=>{t?e.scrollIntoView(!1):e.scrollIntoViewIfNeeded(!0)}),16)}};_alarmsChanged=e=>{if(!e)return;const t=e.find((e=>e?.id===this.props.extId));if(t)switch(t.type){case"RELOAD":if(this.props.extId===t.id){const e=Ce.ZP.getPageByReloadId(t.id);e&&c.ZP.reloadPage(e.id)}break;case"TIME_CHANGED":this.setState({timeLeft:t.remainingTime})}else this.state.timeLeft&&this.setState({timeLeft:null})};_onProgressStateStoreChanged=()=>{if(this.props.isInternalPage)return void this.setState({loadingProgress:1,isLoading:!1,isFetching:!1});const e=LC.getProgressInfo(this.props.pageId);this.setState({loadingProgress:Math.min(Math.max(e.progress,0),1),isLoading:1!==e.progress&&!e.isFetching,isFetching:e.isFetching})};clearFadedDiscardedTabs=()=>{this.#m&&this.setState({fadeDiscardedTabs:!1})};discardPages=e=>{e.forEach(c.ZP.discardPage)};cloneTab=e=>{c.ZP.clonePages(ze.aV.of(e))};cloneTabs=e=>{c.ZP.clonePages(e)};async reloadTabStack(e,t){const n=Ce.ZP.getGroup(t,e);n.size>1&&(c.ZP.clearSelection(e),await c.ZP.reloadPage(n.map((e=>e.id))))}reloadTab=e=>{c.ZP.clearSelection(this.context.vivaldiWindowId),c.ZP.reloadPage(e)};renameById=e=>{this.setState({awaitingEdit:e})};#Vn=e=>{if((0,ps.Z)(e))return;const t=this.props.isStack?this.props.groupId:this.props.pageId;t&&this.renameById(t)};toggleMediaRemoting=()=>{const e=this.props.prefValues[I.kMediaRouterMediaRemotingEnabled];w.Z.set(I.kMediaRouterMediaRemotingEnabled,!e)};setPinned=(e,t)=>{c.ZP.clearSelection(this.context.vivaldiWindowId);const n=this.context.vivaldiWindowId,i=e.map(kv.av).toSet().flatMap((e=>Ce.ZP.isGroup(e,n)?Ce.ZP.getGroup(e,n):(0,ze.aV)())).union(e).toList();t?c.ZP.setPinned(i,t):c.ZP.setPinned(i.reverse(),t)};bookmarkAllOpenPages=()=>{const e=g.Z.getRootId();void 0!==e&&(c.ZP.clearSelection(this.context.vivaldiWindowId),ee.Z.bookmarkAllOpenPages(this.context.vivaldiWindowId,e))};bookmarkTab=(e,t)=>{const n=g.Z.getRootId();void 0!==n&&(c.ZP.clearSelection(this.context.vivaldiWindowId),ee.Z.bookmarkPages(e,t,n))};handleClose=e=>{const t=Ce.ZP.getPageById(this.props.pageId);t&&e.button===es.Z.kLeft&&(e.altKey?this.closeAllButTab(t,this.props.isSubstrip||this.props.isInsideAccordion):e.shiftKey||e.ctrlKey||e.metaKey||this.props.closePage(t),e.preventDefault())};closeTabStack=()=>{c.ZP.closeTabStack(this.props.pageId)};handleMedia=()=>{if(this.props.mediaState.has("pip"))c.ZP.exitPictureInPicture(this.props.pageId);else{const e=Ce.ZP.getPageById(this.props.pageId);e&&this.togglePagesMuted(this.context.vivaldiWindowId,ze.aV.of(e))}};togglePagesMuted=(e,t)=>{c.ZP.toggleMuting(e,t)};closeAllButTab=(e,t)=>{const n=!t,i=Ce.ZP.getActiveWorkspace(this.context.vivaldiWindowId);c.ZP.closeOther(e,i,n)};customize=()=>{de.Z.showSettings(this.context.vivaldiWindowId,"tabs")};isTabstackingEnabled=()=>"off"!==this.props.prefValues[I.kTabsStackingMode];isTabStack=e=>{const t=(0,kv.av)(e);return!!t&&Ce.ZP.isGroup(t,this.context.vivaldiWindowId)};isPinned=e=>e.pinned;tileTabStack=()=>{c.ZP.tileTabStack(this.context.vivaldiWindowId,this.props.groupId),c.ZP.clearSelection(this.context.vivaldiWindowId)};isPageTiledWithType=e=>{const t=Ce.ZP.getPageById(this.props.pageId);return Boolean(t&&(0,Yie.gO)(t)&&this.props.tilingType===e)};tileSelection=e=>{const t=e.count()<4?"row":"grid";c.ZP.tilePages(e.toList(),t),c.ZP.clearSelection(this.context.vivaldiWindowId)};untile=()=>{const e=Ce.ZP.getPageInWindow(this.context.vivaldiWindowId,this.props.pageId);e&&c.ZP.untilePages(ze.aV.of(e))};untileTabStack=e=>{const t=this.context.vivaldiWindowId,n=Ce.ZP.getGroup(e,t);c.ZP.untilePages(n)};untileSelection=async e=>{await c.ZP.untilePages(e);const t=this.context.vivaldiWindowId,n=this.props.tilingId;Ce.ZP.getTiles(n,t).size<2&&await c.ZP.untileTileGroup(this.context.vivaldiWindowId,n),c.ZP.clearSelection(this.context.vivaldiWindowId)};untileTileGroup=()=>{c.ZP.untileTileGroup(this.context.vivaldiWindowId,this.props.tilingId),c.ZP.clearSelection(this.context.vivaldiWindowId)};mouseEnterHandler=()=>{this.props.clearForceHover()};keyDown=e=>{if(void 0!==this.state.awaitingEdit)return;const{prefValues:t}=this.props,{ctrlKey:n,altKey:i,shiftKey:s,metaKey:o}=e,a={ctrlKey:n,altKey:i,shiftKey:s,metaKey:o},r=t[I.kTabsSelectionEnabled];switch(e.key){case"Enter":case" ":const n=Ce.ZP.getPageById(this.props.pageId);n&&this.props.onActivate(n);break;case"ArrowLeft":case"ArrowRight":case"ArrowDown":case"ArrowUp":const i=this.isHorizontal();if((0,As.Mr)(a)&&r){const t=Ce.ZP.getPageById(this.props.pageId);t&&(("ArrowLeft"===e.key&&i||"ArrowUp"===e.key&&!i)&&c.ZP.expandSelectionPrevious(t),("ArrowRight"===e.key&&i||"ArrowDown"===e.key&&!i)&&c.ZP.expandSelectionNext(t))}if((0,As.S2)(a)){const n="dotted"===t[I.kTabsStackingMode];if(i){if("ArrowLeft"===e.key||"ArrowRight"===e.key){const t=Ce.ZP.getPageById(this.props.pageId);t&&c.ZP.stepPage(t,"ArrowRight"===e.key,n,this.context.vivaldiWindowId).then((()=>{r&&(c.ZP.setSelection(t,{multiSelect:!1,addGroup:!1,excludeActive:!0}),this.props.onMoveFocus(this.props.id,"current",!0))}))}}else if("ArrowUp"===e.key||"ArrowDown"===e.key){const t=Ce.ZP.getPageById(this.props.pageId);t&&c.ZP.stepPage(t,"ArrowDown"===e.key,n,this.context.vivaldiWindowId).then((()=>{r&&(c.ZP.setSelection(t,{multiSelect:!1,addGroup:!1,excludeActive:!0}),this.props.onMoveFocus(this.props.id,"current",!0))}))}}if((0,As.VV)(a)){if(i?"ArrowLeft"===e.key||"ArrowRight"===e.key:"ArrowUp"===e.key||"ArrowDown"===e.key){const t="ArrowLeft"===e.key||"ArrowUp"===e.key?"left":"right";c.ZP.clearSelection(this.context.vivaldiWindowId),Ufe.nextTick((()=>this.props.onMoveFocus(this.props.id,t,!1)))}else if(!this.props.isSubstrip&&this.props.isStack){const e=this.refTab.current,{Element:t}=this.context;e instanceof t&&this.props.onStackMenu(this.props.pageId,e)}}break;case"Escape":c.ZP.clearSelection(this.context.vivaldiWindowId),this.props.onLeaveBar();break;default:return}(0,ms.ZP)(e)};createGroup=(e,t)=>{const n=e.sort(((e,t)=>e.index-t.index)),i=t.index-n.findIndex((e=>e===t));c.ZP.createTabStack(n,i,(0,kv.av)(t))};isHorizontal=()=>{const{tabPosition:e}=this.props;return"top"===e||"bottom"===e};onContextMenu=(e,t)=>(e.persist(),(0,ms.ZP)(e),this.getContextMenuItemsPromise("tab",t,e).then((t=>{(0,cs.Z)(this.context,t)(e)})),!1);getContextMenuItemsPromise=(e,t,n)=>{const s=this.context.vivaldiWindowId,o=Ce.ZP.getPageById(this.props.pageId);if(!o)return Promise.reject("Tab.jsx: Expected page not found");const a=Ce.ZP.getActiveWorkspace(s),{isStack:r,groupId:l,isSubstrip:d,isInsideAccordion:u}=this.props,p=this.props.isSelecting&&this.props.isSelected&&this.props.selectionCount>1,h=Ce.ZP.getSelectedPages(s),g=h.filter((e=>Ce.ZP.canClosePage(e))),m=Ce.ZP.getPages(s,{workspaceId:a}).filterNot(this.isPinned),f=m.filter((e=>!h.some((t=>t.id===e.id)))),v=he.ZP.isGuest(),[y,b]=(0,uge.d)(o,Ce.ZP.getWorkspaceTabsInWindow(s,a,!this.isTabstackingEnabled())),S=!o.active&&!o.discarded&&!o.isInspected&&o.url!==Ce.ZP.getDefaultStartpage(s),w=r&&Ce.ZP.getGroup(l,s).some((e=>!e.active&&!e.discarded&&!e.isInspected&&e.url!==Ce.ZP.getDefaultStartpage(s))),C=Ce.ZP.getDiscardablePages(s),A=Ce.ZP.isGroup(l,s),T=t||!A?m.size>=2:m.size-Ce.ZP.getGroup(l,s).size>0;let Z;Z=p?h:!t&&r?Ce.ZP.getGroup(l,s):ze.aV.of(o);const E=h.filter(this.isPinned),k={isMultiSelect:p,count:h.size,closableCount:g.size,unSelectedCount:f.size,unpinned:h.size-E.size,pinned:E.size,playing:h.count((e=>Gie.Z.hasMediaState(e.id,"playing")||Gie.Z.hasMediaState(e.id,"muting"))),canHibernateCount:h.count((e=>!e.active&&!e.isInspected)),hostname:y,hostnameCount:b.size,horizontal:this.isHorizontal(),someIncognito:h.some((e=>o.incognito)),canCloneCount:h.count((e=>!(0,pn.m7)(e)))},_=ji.Z.getOptionFunction(e),N=this.props.extId,P=async()=>{const e=[],{document:t,vivaldiWindowId:a}=this.context,d=he.ZP.getState().get(a);for(const[n,u]of he.ZP.getState()){if(n===a||"normal"!==u.type||d?.incognito!==u.incognito)continue;const g=(await i.Z.windows.get(n,{populate:!0})).tabs||[],m=g.find((e=>e.active)),f=m&&m.url?pn.jk.getDisplayTitleByUrl(m.url,m.title||m.url):String(e.length+1);e.push({handler:()=>{const e=p?h:r?Ce.ZP.getGroup(l,s):ze.aV.of(o);e.count()===Ce.ZP.getPages(a).count()&&t.querySelectorAll("webview").forEach((e=>e.parentElement?.removeChild(e))),c.ZP.moveToWindow(e,n)},...(0,us.Z)("Window with $1 Active Tab ($2)","Window with $1 Active Tabs ($2)",[g.length,f])})}return e.length>0&&e.unshift(Qe.Z.separatorItem),he.ZP.isIncognitoOrGuest(a)||(e.push(Qe.Z.separatorItem),e.push({handler:()=>{Z.count()===Ce.ZP.getPages(a).count()&&t.querySelectorAll("webview").forEach((e=>e.parentElement?.removeChild(e))),c.ZP.detachPage(Z,n.screenX,n.screenY)},...(0,us.Z)("To New Window")})),e},D=async e=>{const t=[],n=GF.Z.getState();if(n.length>0){const e=p?h:r?Ce.ZP.getGroup(l,s):ze.aV.of(o),i=()=>{const e=Ce.ZP.getActivePage(s);e&&(0,kv.cm)(e)===a||c.ZP.cycleByHistory(s)};t.push(Qe.Z.separatorItem),a&&t.push({handler:async()=>{await c.ZP.moveToWorkspace(e,void 0),i()},...(0,us.Z)("To This Window")}),n.forEach((n=>{n.id!==a&&t.push({handler:async()=>{await c.ZP.moveToWorkspace(e,n.id),i()},label:n.name,labelEnglish:n.name})}))}return he.ZP.isGuest()||(t.push(Qe.Z.separatorItem),t.push({handler:()=>{de.Z.showWorkspaceDialog(s,{createInBackground:!1,withPages:Z})},...(0,us.Z)("Create Workspace With This Tab","Create Workspace With Selected Tabs",[Z.size])})),t};return ji.Z.getNamedMenu(s,e,(async e=>{const n=this.isPageTiledWithType("selection"),i=this.isPageTiledWithType("group");switch(e.action){case"CONTEXT_NEW":return{handler:()=>this.props.onCreateTab(!p&&A&&l?l:void 0),..._(s,e,k)};case"CONTEXT_RELOAD":return{handler:p?this.reloadTab.bind(this,h.map((e=>e.id))):this.reloadTab.bind(this,o.id),..._(s,e,k)};case"CONTEXT_CLONE":return{isVisible:()=>p?!h.every(pn.m7):!(0,pn.m7)(o),handler:p?()=>c.ZP.clonePages(h):()=>c.ZP.clonePages(ze.aV.of(o)),..._(s,e,k)};case"CONTEXT_PIN":return{handler:()=>{const e=p?h:ze.aV.of(o);this.setPinned(e,!0)},isVisible:()=>!(d||u)&&(p?!h.some(this.isTabStack)&&h.every((e=>!this.isPinned(e))):!r&&!o.pinned),..._(s,e,k)};case"CONTEXT_PIN_STACK":return{handler:()=>c.ZP.pinTabStack(l,s),isVisible:()=>r&&!d&&!o.pinned&&!p,..._(s,e,k)};case"CONTEXT_UNPIN":return{handler:()=>{const e=p?h:ze.aV.of(o);this.setPinned(e,!1)},isVisible:()=>!r&&!d&&!u&&(p?!h.some(this.isTabStack)&&h.some(this.isPinned):o.pinned),..._(s,e,k)};case"CONTEXT_UNPIN_STACK":return{handler:()=>c.ZP.unpinTabStack(l,s),isVisible:()=>r&&!p&&o.pinned&&!d,..._(s,e,k)};case"CONTEXT_MUTE":return{handler:p?()=>this.togglePagesMuted(s,h):()=>this.togglePagesMuted(s,ze.aV.of(o)),isVisible:()=>!p||h.some((e=>Gie.Z.hasMediaState(e.id,"playing")||Gie.Z.hasMediaState(e.id,"muting"))),checked:p?h.every((e=>Gie.Z.hasMediaState(e.id,"muting"))):Gie.Z.hasMediaState(o.id,"muting"),..._(s,e,k)};case"CONTEXT_CONTAINER_PERIODIC_TIMER":const m=p?"select":r?"stack":"tab",Z=p||"tab"===m?N:l;return{items:MS.Z.getMenu(Z,m,o.windowId),isVisible:()=>!this.props.isInternalPage,..._(s,e,k)};case"CONTEXT_MUTE_OTHER":return{handler:()=>c.ZP.muteAllExcept(s,[o]),isVisible:()=>!p&&Ce.ZP.getPages(s).some((e=>e.id!==o.id&&Gie.Z.hasMediaState(e.id,"playing"))),..._(s,e,k)};case"CONTEXT_OPTIMIZE_FS_VIDEOS":return{handler:this.toggleMediaRemoting,type:"checkbox",checked:this.props.prefValues[I.kMediaRouterMediaRemotingEnabled],isVisible:()=>this.props.mediaState.has("capturing"),..._(s,e,k)};case"CONTEXT_BOOKMARK":return{handler:p?this.bookmarkTab.bind(this,h,!1):this.bookmarkTab.bind(this,o,!1),isVisible:()=>!v,..._(s,e,k)};case"CONTEXT_BOOKMARK_STACK":return{handler:this.bookmarkTab.bind(this,Ce.ZP.getGroup(l,s),!0),isVisible:()=>r&&!v,..._(s,e,k)};case"CONTEXT_BOOKMARK_ALL":return{handler:this.bookmarkAllOpenPages,isVisible:()=>!v,..._(s,e,k)};case"CONTEXT_COPY_LINK":return{handler:()=>c.ZP.copyUrls(ze.aV.of(o)),isVisible:()=>!p,..._(s,e,k)};case"CONTEXT_COPY_LINKS":return{handler:()=>{const e=r?Ce.ZP.getGroup((0,kv.av)(o),s):h;c.ZP.copyUrls(e)},isVisible:()=>p||r,..._(s,e,k)};case"CONTEXT_SAVE_SESSION":return{handler:h.count()>0?()=>de.Z.showSaveSessionDialog(s,{mode:"ids",ids:h.map((e=>e.id)).toArray()}):()=>de.Z.showSaveSessionDialog(s,{mode:"all"}),isVisible:()=>!v,..._(s,e,k)};case"CONTEXT_TABSTACK_BY_SELECTION":{const t=k.pinned;return{handler:()=>this.createGroup(h,o),isVisible:()=>p&&this.isTabstackingEnabled()&&this.props.isSelecting&&(0===t||t===h.size)&&!h.some((e=>{const t=(0,kv.av)(e);return t&&Ce.ZP.isGroup(t,e.windowId)})),..._(s,e,k)}}case"CONTEXT_TABSTACK_BY_HOST":return{handler:()=>{c.ZP.createGroupByHost(s,a,y)},isVisible:()=>this.isTabstackingEnabled()&&!r&&b.size>1,..._(s,e,k)};case"CONTEXT_TABSTACK_BY_HOSTS":return{handler:()=>c.ZP.createGroupByHosts(s,a),isVisible:()=>this.isTabstackingEnabled(),..._(s,e,k)};case"CONTEXT_TABSTACK_RELOAD":return{handler:()=>this.reloadTabStack(s,l),isVisible:()=>r,..._(s,e,k)};case"CONTEXT_TABSTACK_RENAME":return{handler:()=>{const e=this.props.isStack?this.props.groupId:this.props.pageId;e&&this.renameById(e)},..._(s,e,{isStack:this.props.isStack})};case"CONTEXT_TABSTACK_REMOVE_FROM":return{handler:()=>this.props.removeFromTabStack(this.props.pageId),isVisible:()=>t,..._(s,e,k)};case"CONTEXT_TABSTACK_UNGROUP":return{handler:()=>{const e=p?h.map(kv.av).filter(Boolean).toArray():[this.props.groupId];this.props.dissolveTabStacks(e)},isVisible:()=>r,..._(s,e,k)};case"CONTEXT_TILE_TABSTACK":return{handler:this.tileTabStack,isVisible:()=>r&&!this.props.isSelecting&&!i&&!n,..._(s,e,k)};case"CONTEXT_UNTILE_TABSTACK":return{handler:()=>this.untileTabStack(l),isVisible:()=>r&&!this.props.isSelecting&&(i||n),..._(s,e,k)};case"CONTEXT_TILE_TABS":return{handler:this.tileSelection.bind(this,h),isVisible:()=>p&&!n&&this.props.isSelecting&&h.count()>1,..._(s,e,k)};case"CONTEXT_UNTILE_TAB":return{handler:this.untile,isVisible:()=>!this.props.isSelecting&&n&&!r,..._(s,e,k)};case"CONTEXT_UNTILE_TILE_GROUP":return{handler:this.untileTileGroup,isVisible:()=>!this.props.isSelecting&&n,..._(s,e,k)};case"CONTEXT_UNTILE_SELECTION":return{handler:()=>this.untileSelection(h),isVisible:()=>this.props.isSelecting&&n&&!r,..._(s,e,k)};case"CONTEXT_HIBERNATE_TAB":return{handler:this.discardPages.bind(this,ze.aV.of(o)),isVisible:()=>!p&&S&&(this.props.isSubstrip||!r),..._(s,e,k)};case"CONTEXT_HIBERNATE_SELECTED_BACKGROUND_TABS":return{handler:this.discardPages.bind(this,h.filter((e=>!e.active))),isVisible:()=>Boolean(h.filter((e=>C.find((t=>t.id===e.id)))).count()),..._(s,e,k)};case"CONTEXT_HIBERNATE_TABSTACK":return{handler:this.discardPages.bind(this,Ce.ZP.getGroup(l,s).filter((e=>!e.active))),isVisible:()=>w,..._(s,e,k)};case"CONTEXT_HIBERNATE_BACKGROUND":const E=C.filter((e=>!(0,Yie.ZN)(e)));return{handler:this.discardPages.bind(this,E),isVisible:()=>!E.isEmpty(),..._(s,e,k)};case"CONTEXT_CLOSE":return{handler:p?()=>this.props.closePage(g):()=>this.props.closePage(o),isVisible:()=>Ce.ZP.canClosePage(o),..._(s,e,k)};case"CONTEXT_CLOSE_TABSTACK":const M=p?!k?.pinned:!this.props.pinned;return{handler:this.closeTabStack,isVisible:()=>r&&(M||"off"!==this.props.prefValues[I.kTabsClosePinned]),..._(s,e,k)};case"CONTEXT_CLOSE_OTHER":return{handler:()=>{p&&!f.isEmpty()?this.closeAllButTab(h,t):this.closeAllButTab(o,t)},isVisible:()=>Ce.ZP.canClosePage(o)&&(p&&0===k?.pinned&&!f.isEmpty()||!p&&T),..._(s,e,k)};case"CONTEXT_CLOSE_LEFT":return{handler:()=>c.ZP.closeToLeft(o,t),isVisible:()=>!p&&!o.pinned&&T&&!c.ZP.getTabsToTheLeft(o,t).isEmpty(),..._(s,e,k)};case"CONTEXT_CLOSE_RIGHT":return{handler:()=>c.ZP.closeToRight(o,t),isVisible:()=>!p&&!o.pinned&&T&&!c.ZP.getTabsToTheRight(o,t).isEmpty(),..._(s,e,k)};case"CONTEXT_REOPEN":return{isVisible:()=>Boolean(cge.Z.getTrash().length),..._(s,e,k)};case"CONTEXT_CONTAINER_PWA":return{isVisible:()=>o.active&&!this.props.isInternalPage,container:{content:"pwa"},..._(s,e,k)};case"CONTEXT_CUSTOMIZE":return{handler:this.customize,isVisible:()=>!v,..._(s,e,k)};case"CONTEXT_MOVE":return{isVisible:()=>p&&!h.some((e=>o.incognito))||!p&&(t||!r),..._(s,e,k)};case"CONTEXT_TABSTACK_MOVE":return{isVisible:()=>!p&&!t&&r,..._(s,e,k)};case"CONTEXT_MOVE_LEFT":return{handler:()=>c.ZP.stepPage(o,!1,!1,s),isVisible:()=>!p,..._(s,e,k)};case"CONTEXT_MOVE_RIGHT":return{handler:()=>c.ZP.stepPage(o,!0,!1,s),isVisible:()=>!p,..._(s,e,k)};case"CONTEXT_MOVE_STACK_LEFT":return{handler:()=>c.ZP.stepPage(o,!1,!0,s),isVisible:()=>!p,..._(s,e,k)};case"CONTEXT_MOVE_STACK_RIGHT":return{handler:()=>c.ZP.stepPage(o,!0,!0,s),isVisible:()=>!p,..._(s,e,k)};case"CONTEXT_CONTAINER_MOVE_TO_WINDOW":return{items:await P(),..._(s,e,k)};case"CONTEXT_CONTAINER_MOVE_TO_WORKSPACE":return{items:await D(),isVisible:()=>this.props.prefValues[I.kWorkspacesEnabled],..._(s,e,k)};case"CONTEXT_CONTAINER_SEND_TO_DEVICES":{const t=await ffe.getMenu(o.url,this.props.fixedTitle||this.state.displayTitle);return{items:t.valid?t.items:[],isVisible:()=>t.valid&&!p&&!r,..._(s,e,k)}}default:return{..._(s,e,k)}}}))};isKnownDropMimeType=e=>e.dataTransfer.types.some((e=>e===p.Up||zi.ZP.isUriListType(e)||"text/plain"===e));onDragEnterHandler=e=>{const{groupId:t,prefValues:n,isInsideAccordion:i,handleExpandAccordion:s}=this.props;t&&"accordion"===n[I.kTabsStackingMode]&&!i&&s&&(clearTimeout(this.accordionExpandTimeout),this.accordionExpandTimeout=setTimeout((()=>s(t)),1e3)),this.isKnownDropMimeType(e)&&(0,ms.ZP)(e)};onDragLeaveHandler=e=>{e.persist();this.props.groupId&&"accordion"===this.props.prefValues[I.kTabsStackingMode]&&!this.props.isInsideAccordion&&clearTimeout(this.accordionExpandTimeout),this.props.onDragLeave(e)};onDragOverHandler=e=>{if(this.isKnownDropMimeType(e)&&(0,ms.ZP)(e),e.dataTransfer.types.includes("vivaldi/x-button-toolbar"))return;const t=this.props.handleTabPosition;if(t&&this.props.isExpectingDrop&&e.dataTransfer.types.some((e=>e===p.Up))){const{pageX:n,pageY:i}=e,s=this.getDropSide(n,i);t(this.props.pageId,s)}else{e.dataTransfer.types.some((e=>zi.ZP.isUriListType(e)||Oce.Z.isSessionType(e)||"text/plain"===e))&&(e.dataTransfer.dropEffect="copy");const t=Ce.ZP.getPageById(this.props.pageId);t&&Hfe(e.screenX,e.screenY,250,(()=>this.props.onActivate(t)))}};getDropSide=(e,t)=>{const{Element:n}=this.context;if(!(this.refTab.current instanceof n))return"before";const{prefValues:i,direction:s,isSubstrip:o,isInsideAccordion:a}=this.props,r=!(this.props.pinned&&!o)&&i[I.kTabsStackingAllowDnd]&&"off"!==i[I.kTabsStackingMode]&&!o&&!a,l=this.refTab.current.getBoundingClientRect(),[d,c]=[e-l.left,t-l.top];return"row"===s?r?d<l.width*Gfe?"before":d>l.width*$fe?"after":"over":d<l.width/2?"before":"after":"column"===s?r?c<l.height*Gfe?"before":c>l.height*$fe?"after":"over":c<l.height/2?"before":"after":"before"};onDropHandler=e=>{this.isKnownDropMimeType(e)&&(0,ms.ZP)(e);const t=e.dataTransfer.getData(p.Up);if(t)return void this.props.droppedTabHandler(t);const n=zi.ZP.extractUriListFromEvent(e);if(n)return void n.split("\n").forEach(((e,t)=>c.ZP.openURL(this.context.vivaldiWindowId,e,{incognito:this.props.incognito,inCurrent:0===t,inSpecificPageId:0===t?this.props.pageId:void 0,inBackground:0!==t})));const i=Oce.Z.getSessionData(e);if(i)return void li.Z.open(this.context.vivaldiWindowId,i,!1);const s=e.dataTransfer.getData("text/plain");s&&(0,rl.K2)(s)&&c.ZP.openURL(this.context.vivaldiWindowId,s,{inCurrent:!0,inSpecificPageId:this.props.pageId,incognito:this.props.incognito})};onFocusHandler=e=>{if(void 0!==this.state.awaitingEdit)return;const t=Ce.ZP.getPageById(this.props.pageId);t&&c.ZP.setSelection(t,{multiSelect:!1,addGroup:!1,excludeActive:!0})};clearAwaitingEdit=()=>{this.setState({awaitingEdit:void 0})};render(){const{discarded:e,prefValues:t,faviconUrl:n,isInternalPage:i,isStack:s,isUnread:o,isHidden:a,shouldShowCloseButton:r,mediaState:l}=this.props,{loadingProgress:d,timeLeft:c=null,badgeText:u,tabTitle:h}=this.state,g=this.props.pinned&&!this.props.isSubstrip,m=this.props.active,f=this.props.smallTab,v=this.props.wideTab,y=0===l.size||e,b=Boolean(this.props.isSelecting&&(!this.props.isHidden&&this.props.isSelected||this.props.highlighted)),S=t[I.kTabsStackingMode],w=s&&!this.props.isSubstrip&&("dotted"===S||"substrip"===S&&t[I.kTabsStackingPreferDotted]),C=Fi()("tab",{"tab-acceptsdrop":this.props.acceptsDrop,marked:b,pinned:g,active:m,highlighted:this.props.highlighted&&!t[I.kTabsSelectionEnabled],"tab-small":f&&!g,"tab-mini":this.props.miniTab&&!g,"tab-accordion":this.props.isStack&&"accordion"===S,"tab-in-accordion":this.props.isInsideAccordion,"tab-first-in-group":this.props.isFirstInGroup,"tab-last-in-group":this.props.isLastInGroup,"force-hover":this.props.forceHover,"tab-group":w,"audio-on":l.has("playing")||l.has("pip"),"audio-muted":l.has("muting"),"tab-captured":l.has("capturing"),"button-off":!r,unread:t[I.kTabsUnread]&&o&&!m&&!s&&!i,isdiscarded:this.state.fadeDiscardedTabs&&t[I.kTabsDimHibernated]&&e,insubstrip:this.props.isSubstrip,"periodic-reload":null!==c}),A="progress_bar"===t[I.kTabsPageLoadInfo]&&!i&&(m&&!this.props.addressBarVisible||m&&!t[I.kAddressBarShowProgress]||!m),T=c||A,Z=c||d,E=m?t[I.kKeyboardTabToAll]:"-1",k=t[I.kHoverCardMemoryUsageEnabled]?Kfe(this.props.memoryUsage,this.props.discarded):void 0;return(0,ss.jsx)(ss.Fragment,{children:(0,ss.jsxs)("div",{id:this.props.id,className:Fi()("tab-wrapper",{active:m,uifocusstop:m&&!a,extended:!w&&!this.props.isSubstrip,group:w,accordion:this.props.isStack&&"accordion"===S}),ref:this.refTab,"data-id":this.props.id,title:t[I.kTabsTooltip]?null:h+(!s&&k?p.YV+k:""),role:"tab","aria-label":h,"aria-hidden":a,"aria-selected":m,onContextMenu:e=>this.onContextMenu(e,this.props.isSubstrip||this.props.isInsideAccordion),onMouseEnter:this.mouseEnterHandler,onMouseDown:ms.PF,onDragEnter:this.onDragEnterHandler,onDragOver:this.onDragOverHandler,onDragLeave:this.onDragLeaveHandler,onDrop:this.onDropHandler,onKeyDown:this.keyDown,onFocus:t[I.kTabsSelectionEnabled]?this.onFocusHandler:null,tabIndex:E,children:[Vfe("div",{className:C},void 0,Vfe("div",{className:Fi()("tab-header",{"expecting-drop":this.props.isExpectingDrop})},void 0,T&&Vfe(Lfe,{progress:Z,progressPrecision:v?.1:f?1:.5,isFetching:this.state.isFetching,visible:!!c||this.state.isFetching||this.state.isLoading}),Vfe(mfe,{isPrivate:he.ZP.isIncognitoOrGuest(this.context.vivaldiWindowId),refFavicon:this.refFavicon,faviconUrl:n,progress:this.state.loadingProgress,isLoading:this.state.isLoading,isFetching:this.state.isFetching,progressType:"progress_icon"===t[I.kTabsPageLoadInfo]||"spinner"===t[I.kTabsPageLoadInfo]?t[I.kTabsPageLoadInfo]:void 0}),Vfe("span",{className:Fi()("title",{editing:this.state.awaitingEdit}),onDoubleClick:t[I.kTabsMinimize]||"rename"!==t[I.kTabsDoubleClick]?null:this.#Vn},void 0,Vfe(Bfe,{pageId:this.props.pageId,isStack:this.props.isStack,groupId:this.props.groupId,fixedTitle:this.props.fixedTitle,displayTitle:this.state.displayTitle,awaitingEdit:this.state.awaitingEdit,clearAwaitingEdit:this.clearAwaitingEdit})),this.props.shouldShowStackCounter&&Vfe("div",{className:"stack-counter"},void 0,this.props.stackSize),r&&Vfe(Tfe,{onClick:this.handleClose,onMouseDown:ms.ZP}),!y&&Vfe("span",{className:"tab-audio",onClick:this.handleMedia,onAuxClick:this.handleClose,onMouseDown:ms.ZP},void 0,Vfe(joe.Z,{color:f||g?"#111":void 0,animated:t[I.kThemeUseAnimation],mediaState:l,src:"tab"})),t[I.kTabsCounterDetection]&&u&&Vfe("span",{className:"button-badge"},void 0,u)),t[I.kTabsThumbnails]&&Vfe(w3,{src:this.props.thumbnail||"",pageId:this.props.pageId}),(b||(s||this.props.isInsideAccordion&&this.props.isFirstInGroup)&&!this.props.isSubstrip&&!w)&&Vfe(Afe,{marked:b,isStack:s,isHorizontal:this.isHorizontal(),isAccordion:"accordion"===this.props.prefValues[I.kTabsStackingMode],stackOrFirst:s||this.props.isInsideAccordion&&this.props.isFirstInGroup,accordionFrameSize:this.props.accordionFrameSize,isDragging:this.props.isDragging,isHiddenForDrag:this.props.isHiddenForDrag})),w&&Vfe(Mfe,{groupId:this.props.groupId,stackSize:this.props.stackSize,highlightId:this.props.highlightId,isSelecting:this.props.isSelecting,checkSelected:this.props.checkSelected,isUnread:this.props.isUnread,isHiddenForDrag:this.props.isHiddenForDrag,onContextMenu:this.onContextMenu,onActivate:this.props.onActivate,getDraggedPages:this.props.getDraggedPages,setPageIdsHiddenForDrag:this.props.setPageIdsHiddenForDrag})]})})}}const jfe=zfe;class Yfe extends m.Z{getInitialState(){return null}allHidden(){return null===this.getState()}getShowTooltip(e){return this.getState()===e}reduce(e,t){switch(t.actionType){case"WEBPAGEVIEW_ACTIONS":if(["focusSearchField","focusAddressField"].indexOf(t.subAction)>-1)return null;break;case"TOOLTIP_SET":if(!Ga.Z.getState().isActive)return t.id}return e}}const Xfe=new Yfe;var Qfe,qfe=n(20745),Jfe=n(34155);function eve(e,t,n,i){Qfe||(Qfe="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Qfe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const tve="vivaldi-tooltip";function nve(e){let t=e.getElementById(tve);if(!t){const n=e.getElementById("browser");t=e.createElement("div"),t.id=tve,n&&n.appendChild(t)}return t}let ive;Xfe.addListener((()=>{Xfe.allHidden()&&(ive?.unmount(),ive=void 0)}));class sve extends Li.Component{static contextType=ts.Z;nodeRef=Li.createRef();state={show:Xfe.getShowTooltip(this.props.id)};#Hn=!1;componentWillUnmount(){Xfe.removeListener(this._onStoreChange),Jfe.nextTick(Ume.i)}componentDidMount(){Xfe.addListener(this._onStoreChange),this.props.disabled||this.renderToolTip()}componentDidUpdate(e,t){this.props.disabled||(!t.show&&this.state.show||e.memoryUsage!==this.props.memoryUsage||e.stackSize!==this.props.stackSize)&&this.renderToolTip()}_onStoreChange=()=>{this.setState({show:!this.props.disabled&&Xfe.getShowTooltip(this.props.id)})};onDragEnter=()=>{Ume.i(0),this.#Hn=!0};onDragLeave=()=>{this.#Hn=!1};onMouseEnter=()=>{if(!this.props.disabled&&!this.#Hn){const e=Xfe.allHidden()?this.props.appearDelay:64;Ume.h(this.props.id,e)}};onMouseLeave=()=>{this.props.disabled||Ume.i(this.props.disappearDelay)};onClick=()=>{Ume.i(0)};tooltipIsOpen=()=>{const{document:e}=this.context,t=nve(e).firstChild,{Element:n}=this.context;return Boolean(t instanceof n&&t.classList.contains("tooltip"))};getPosition=(e,t)=>{const{Element:n}=this.context,i=this.nodeRef.current;let s,o;if(!(i&&i.firstChild instanceof n))return{left:s,top:o};const a=i.firstChild.getBoundingClientRect(),r=this.props.noPadding?2:4;if("above"===this.props.placement){s=a.left+a.width/2-e/2,o=a.top-t-r}else if("after"===this.props.placement)s=a.left+a.width+r,o=a.top;else if("before"===this.props.placement)s=a.left-e-r,o=a.top;else{s=a.left+a.width/2-e/2,o=a.top+a.height+r}return s<0&&(s=0),o<0&&(o=0),s+e>this.context.innerWidth&&(s-=s+e-this.context.innerWidth),o+t>this.context.innerHeight&&(o-=o+t-this.context.innerHeight),{left:s,top:o}};renderToolTip=()=>{this.context.requestAnimationFrame(this._renderToolTip)};_renderToolTip=()=>{if(!this.state.show)return;const{document:e}=this.context,{width:t,height:n,content:i}=this.props.content(),{left:s,top:o=0}=this.getPosition(t,n),a=o+n>=this.context.innerHeight,r=a?"flex-end":"flex-start",l=this.props.noPadding?2:4,d=0===o?l:0,c=a?l:0,u=this.props.pointerEvents,p=["after","before"].includes(this.props.placement)?`top ${this.props.transitionSpeed}ms`:`left ${this.props.transitionSpeed}ms`,h="before"===this.props.placement||"after"===this.props.placement;ive||(ive=(0,qfe.s)(nve(e))),ive.render(eve("div",{className:"tooltip",style:{top:o,left:s,pointerEvents:u,height:h?"auto":n,width:t,paddingTop:d,paddingBottom:c,alignItems:r,transition:p},onClick:this.onClick,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},void 0,i))};render(){return(0,ss.jsx)("span",{ref:this.nodeRef,onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,children:this.props.children})}}const ove=sve;const ave=1e3/60;function rve(e,t,n){const i=t;return null==i?e.map(((e,t)=>({key:e.key,data:e.data,style:n[t]}))):e.map(((e,t)=>{for(let s=0;s<i.length;s++)if(i[s].key===e.key)return{key:i[s].key,data:i[s].data,style:n[t]};return{key:e.key,data:e.data,style:n[t]}}))}function lve(e,t,n,i,s,o,a,r,l){const d=function(e,t,n){const i={};for(let t=0;t<e.length;t++)i[e[t].key]=t;const s={};for(let e=0;e<t.length;e++)s[t[e].key]=e;const o=[];for(let e=0;e<t.length;e++)o[e]=t[e];for(let t=0;t<e.length;t++)if(!Object.prototype.hasOwnProperty.call(s,e[t].key)){const i=n(t,e[t]);null!=i&&o.push(i)}return o.sort(((e,n)=>{const o=s[e.key],a=s[n.key],r=i[e.key],l=i[n.key];if(null!=o&&null!=a)return s[e.key]-s[n.key];if(null!=r&&null!=l)return i[e.key]-i[n.key];if(null!=o){for(let e=0;e<t.length;e++){const n=t[e].key;if(Object.prototype.hasOwnProperty.call(i,n)){if(o<s[n]&&l>i[n])return-1;if(o>s[n]&&l<i[n])return 1}}return 1}for(let e=0;e<t.length;e++){const n=t[e].key;if(Object.prototype.hasOwnProperty.call(i,n)){if(a<s[n]&&r>i[n])return 1;if(a>s[n]&&r<i[n])return-1}}return-1}))}(i,s,((e,i)=>{const s=t(i);return null==s||RQ(o[e],s,a[e])?(n({key:i.key,data:i.data}),null):{key:i.key,data:i.data,style:s}})),c=[],u=[],p=[],h=[];for(let t=0;t<d.length;t++){const n=d[t];let s=null;for(let e=0;e<i.length;e++)if(i[e].key===n.key){s=e;break}if(null==s){const i=e(n);c[t]=i,p[t]=i;const s=LQ(n.style);u[t]=s,h[t]=s}else c[t]=o[s],p[t]=r[s],u[t]=a[s],h[t]=l[s]}return[d,c,u,p,h]}class dve extends Li.Component{static contextType=ts.Z;context;static defaultProps={willEnter:e=>WQ(e.style),willLeave:()=>null,didLeave:()=>{}};unmounting=!1;animationID=null;prevTime=0;accumulatedTime=0;unreadPropStyles=null;constructor(e){super(e),this.state=this.defaultState()}defaultState(){const{defaultStyles:e,styles:t,willEnter:n,willLeave:i,didLeave:s}=this.props,o="function"==typeof t?t(e):t;let a;a=null==e?o:e.map((e=>{for(let t=0;t<o.length;t++)if(o[t].key===e.key)return o[t];return e}));const r=null==e?o.map((e=>WQ(e.style))):e.map((e=>WQ(e.style))),l=null==e?o.map((e=>LQ(e.style))):e.map((e=>LQ(e.style))),[d,c,u,p,h]=lve(n,i,s,a,o,r,l,r,l);return{currentStyles:c,currentVelocities:u,lastIdealStyles:p,lastIdealVelocities:h,mergedPropsStyles:d}}clearUnreadPropStyle=e=>{const[t,n,i,s,o]=lve(this.props.willEnter,this.props.willLeave,this.props.didLeave,this.state.mergedPropsStyles,e,this.state.currentStyles,this.state.currentVelocities,this.state.lastIdealStyles,this.state.lastIdealVelocities);for(let a=0;a<e.length;a++){const r=e[a].style;let l=!1;for(const e in r){if(!Object.prototype.hasOwnProperty.call(r,e))continue;const d=r[e];"number"==typeof d&&(l||(l=!0,n[a]={...n[a]},i[a]={...i[a]},s[a]={...s[a]},o[a]={...o[a]},t[a]={key:t[a].key,data:t[a].data,style:{...t[a].style}}),n[a][e]=d,i[a][e]=0,s[a][e]=d,o[a][e]=0,t[a].style[e]=d)}}this.setState({currentStyles:n,currentVelocities:i,mergedPropsStyles:t,lastIdealStyles:s,lastIdealVelocities:o})};startAnimationIfNecessary=()=>{if(this.unmounting||null!=this.animationID)return;const{requestAnimationFrame:e}=this.context;this.animationID=e((e=>{if(this.unmounting)return;const t=this.props.styles,n="function"==typeof t?t(rve(this.state.mergedPropsStyles,this.unreadPropStyles,this.state.lastIdealStyles)):t;if(function(e,t,n,i){if(i.length!==t.length)return!1;for(let e=0;e<i.length;e++)if(i[e].key!==t[e].key)return!1;for(let s=0;s<i.length;s++)if(!RQ(e[s],t[s].style,n[s]))return!1;return!0}(this.state.currentStyles,n,this.state.currentVelocities,this.state.mergedPropsStyles))return this.animationID=null,void(this.accumulatedTime=0);const i=e||performance.now(),s=i-this.prevTime;if(this.prevTime=i,this.accumulatedTime=this.accumulatedTime+s,this.accumulatedTime>166.66666666666669&&(this.accumulatedTime=0),0===this.accumulatedTime)return this.animationID=null,void this.startAnimationIfNecessary();const o=(this.accumulatedTime-Math.floor(this.accumulatedTime/ave)*ave)/ave,a=Math.floor(this.accumulatedTime/ave),[r,l,d,c,u]=lve(this.props.willEnter,this.props.willLeave,this.props.didLeave,this.state.mergedPropsStyles,n,this.state.currentStyles,this.state.currentVelocities,this.state.lastIdealStyles,this.state.lastIdealVelocities);for(let e=0;e<r.length;e++){const t=r[e].style,n={},i={},s={},p={};for(const r in t){if(!Object.prototype.hasOwnProperty.call(t,r))continue;const l=t[r];if("number"==typeof l)n[r]=l,i[r]=0,s[r]=l,p[r]=0;else{let t=c[e][r],d=u[e][r];for(let e=0;e<a;e++)[t,d]=FQ(.016666666666666666,t,d,l.val,l.stiffness,l.damping,l.precision);const[h,g]=FQ(.016666666666666666,t,d,l.val,l.stiffness,l.damping,l.precision);n[r]=t+(h-t)*o,i[r]=d+(g-d)*o,s[r]=t,p[r]=d}}c[e]=s,u[e]=p,l[e]=n,d[e]=i}this.animationID=null,this.accumulatedTime-=a*ave,this.setState({currentStyles:l,currentVelocities:d,lastIdealStyles:c,lastIdealVelocities:u,mergedPropsStyles:r}),this.unreadPropStyles=null,this.startAnimationIfNecessary()}))};componentDidMount(){this.prevTime=performance.now(),this.startAnimationIfNecessary()}UNSAFE_componentWillReceiveProps(e){this.unreadPropStyles&&this.clearUnreadPropStyle(this.unreadPropStyles);const t=e.styles;this.unreadPropStyles="function"==typeof t?t(rve(this.state.mergedPropsStyles,this.unreadPropStyles,this.state.lastIdealStyles)):t,null==this.animationID&&(this.prevTime=performance.now(),this.startAnimationIfNecessary())}componentWillUnmount(){this.unmounting=!0,null!=this.animationID&&(this.context.cancelAnimationFrame(this.animationID),this.animationID=null)}render(){const e=rve(this.state.mergedPropsStyles,this.unreadPropStyles,this.state.currentStyles),t=this.props.children(e);return t&&Li.Children.only(t)}}class cve extends Li.PureComponent{static contextType=ts.Z;trashButton=Li.createRef();state={trash:cge.Z.getTrash()};componentDidMount(){cge.Z.addListener(this.onTrashStoreChange),Oa.Z.addListener("COMMAND_SHOW_CLOSED_TABS",this._onCommandSpy)}componentWillUnmount(){cge.Z.removeListener(this.onTrashStoreChange),Oa.Z.removeListener("COMMAND_SHOW_CLOSED_TABS",this._onCommandSpy)}onTrashStoreChange=()=>{this.setState({trash:cge.Z.getTrash()})};emptyTrash=()=>{Ni.Z.emptyTrash()};undeleteTab=e=>{Ni.Z.undeleteTab(e.sessionId)};undeleteWindow=e=>{Ni.Z.undeleteWindow(e.sessionId)};undo=()=>{if(this.state.trash.length>0){const e=this.state.trash[0];e.tab?this.undeleteTab(e.tab):e.window&&this.undeleteWindow(e.window)}};_onCommandSpy=e=>{e===this.context.vivaldiWindowId&&this.trashButton.current&&this.trashButton.current.showMenu()};_getContextMenuPromise=()=>{const e=this.context.vivaldiWindowId,t=ji.Z.getOptionFunction("closedtab");return ji.Z.getNamedMenu(e,"closedtab",(async n=>"CONTEXT_CONTAINER_CLOSED_TAB"===n.action?{items:Ge.Z.getClosedTabContainer(),...t(e,n,{})}:{...t(e,n,{})}))};onDrop=e=>{const t=e.dataTransfer.getData(p.Up);if(t){e.preventDefault(),e.stopPropagation();const n=JSON.parse(t).ids.map((e=>parseInt(e))).map((e=>Ce.ZP.getPages(this.context.vivaldiWindowId).find((t=>t.id===e)))).filter(Boolean);c.ZP.closePage((0,ze.aV)(n))}};handleContextMenuVisibilityChanged=e=>{e||this.props.onMenuClosed?.()};render(){return(0,ss.jsx)(po.ZP,{ref:this.trashButton,name:"MailMsgTrash",className:Fi()("toggle-trash",{hidden:this.props.hidden}),onDrop:this.onDrop,onDragEnter:Lr.Z,onContextMenuVisibilityChanged:this.handleContextMenuVisibilityChanged,image:Wi.nre.large,onMiddleClick:this.undo,menu:this._getContextMenuPromise,menuOrigin:"bottomLeft",mimeType:p.Up,edgeAmount:0,label:(0,B.Z)("Closed Tabs"),tooltip:(0,B.Z)("Show Closed Tabs"),tooltipExtra:(0,B.Z)("$1-click to reopen last closed tab",[(0,B.Z)("key","Shift")]),commandId:"COMMAND_SHOW_CLOSED_TABS"})}}const uve=cve;var pve=n(10695),hve=n.n(pve),gve=n(7065),mve=n(34155);function fve({accordionIsOpen:e,draggedActive:t,droppedTabs:n,isSubstrip:s,isTabStackingEnabled:o,maybeResetDragging:a,tabStackingMode:r,allTabs:l,substripTabs:d,yieldAfter:u,yieldBefore:p,yieldOver:h,windowId:g}){const m=JSON.parse(n),f=m.ids.map((e=>parseInt(e))).sort(((e,t)=>e-t)),v=(0,ze.aV)(l).filter((e=>f.some((t=>e.id===t)))).map(gve.OK),y=h?Ce.ZP.getPages(g).find((e=>e.id===h&&!e.pinned)):void 0;if(y){let e=(0,kv.av)(y);const n=o&&Ce.ZP.isGroup(e,g),i=y.windowId===v.first().windowId;let s,r,l;if(n){const t=Ce.ZP.getGroup(e,g);s=t.first().index,l=t.first().vivExtData.fixedGroupTitle,r=Ce.ZP.getGroup(e,g).concat(v)}else{s=y.index,r=ze.aV.of(y).concat(v),e=Ce.ZP.getNewGroupId();const n=t&&(0,kv.av)(t);n&&Ce.ZP.isGroup(n,g)&&(l=t?t.vivExtData.fixedGroupTitle??"":"")}const d=()=>c.ZP.createTabStack(r,s,e).then((()=>{e&&l&&c.ZP.setFixedStackTitle(g,e,l)}));if(i){const e=v.reduce(((e,t)=>t.index<s?e+1:e),0);s-=e,d()}else{const e=Ce.ZP.getActiveWorkspace(y.windowId);c.ZP.moveToWorkspace(v,e).then(d)}a()}else{const t=()=>mve.nextTick(a),n=m.active,i=function(e,t,n,i,s,o,a,r){const l=Ce.ZP.getPages(r);if("number"==typeof a){const e=l.find((e=>e.id===a));return e?e.index:-1}const d=l.find((e=>e.id===s||e.id===o));if(!d)return-1;const c=(0,kv.av)(d);let u;if(n&&Ce.ZP.isGroup(c,r))if("accordion"===i&&e(c))u=d.id;else{const e=Ce.ZP.getGroup(c,r);if(u="number"==typeof s?e.first().id:e.last().id,u===t)return l.findIndex((e=>e.id===u))}else u=d.id;return l.filter((e=>e.id!==t)).findIndex((e=>e.id===u))+("number"==typeof o?1:0)}(e,f[0],o,r,p,u,h,g);if(s)if(1===d.size)c.ZP.createTabStack(d.map((e=>e.page)).concat(v),i,Ce.ZP.getNewGroupId());else{const e=(0,kv.av)(d.first()?.page);e&&c.ZP.moveDroppedTabs(g,v,n,i,e).then(t)}else if("accordion"===r){const s=l.map(gve.OK).map((e=>(0,kv.av)(e)??"")),o=(0,ze.aV)(s).countBy((e=>e)),a=v.reduce(((e,t)=>e.add((0,kv.av)(t)??"")),new ze.l4),r=m.sourceWindow===g,d=s[i]??"",u=s[i+(i<m.activeIndex?-1:1)]??"";let p;p=r?d&&e(d)&&u===d?d:1===a.size&&o.get(a.first())===v.size?void 0:"":void 0,c.ZP.moveDroppedTabs(g,v,n,i,p).then(t)}else{const e="main"!==m.dragSource?"":void 0;c.ZP.moveDroppedTabs(g,v,n,i,e).then(t)}}i.Z.windows.update(g,{focused:!0})}var vve,yve=n(74678),bve=n(42941),Sve=n(37441);function wve(e,t,n,i){vve||(vve="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:vve,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Cve=180,Ave=150,Ive=30,Tve=32,Zve={stiffness:400,damping:32,precision:.1},Eve=Ffe();var kve=wve("hr",{}),_ve=wve("span",{className:"dragspace"});class Nve extends Li.PureComponent{static contextType=ts.Z;currentHoveredId=0;#m;refTabStrip=Li.createRef();refTabs=new Map;#Gn=!1;#$n;start=[0,0];delta=[0,0];isMouseOverScrollArrow=!1;enterSide="none";#Kn=!1;#zn=!1;#jn=null;#Yn=null;#Xn=null;state={isDragging:!1,draggedActive:null,draggedPages:(0,ze.aV)(),pageIdsHiddenForDrag:(0,ze.l4)(),freeze:null,animate:!1,highlightedId:"",isDraggingPinnedTab:!1,activeAlarms:new ze.l4,canScrollLeft:!1,canScrollRight:!1,mouse:[0,0],hoveredPageId:-1};componentDidMount(){this.setOverflowClass(),Oa.Z.addListener("COMMAND_FOCUS_TABBAR",this.onCommandSpy),Oa.Z.addListener("COMMAND_RENAME_TAB",this.onCommandSpy),Oa.Z.addListener("COMMAND_RENAME_TAB_STACK",this.onCommandSpy),Oa.Z.addListener("COMMAND_TAB_MOVE_FIRST",this.onCommandSpy),Oa.Z.addListener("COMMAND_TAB_MOVE_END",this.onCommandSpy),this.context.addEventListener("dragenter",this.windowDragEnterHandler),this.context.addEventListener("dragleave",this.windowDragLeaveHandler),this.context.addEventListener("dragover",this.windowDragOverHandler),this.context.addEventListener("drop",this.windowDropHandler),Xe.Z.addListener(this._alarmsChanged),this.#m=!0}componentWillUnmount(){this.#m=!1,this.animateTimeoutId&&clearTimeout(this.animateTimeoutId),this.#$n&&URL.revokeObjectURL(this.#$n),Oa.Z.removeListener("COMMAND_FOCUS_TABBAR",this.onCommandSpy),Oa.Z.removeListener("COMMAND_RENAME_TAB",this.onCommandSpy),Oa.Z.removeListener("COMMAND_RENAME_TAB_STACK",this.onCommandSpy),Oa.Z.removeListener("COMMAND_TAB_MOVE_FIRST",this.onCommandSpy),Oa.Z.removeListener("COMMAND_TAB_MOVE_END",this.onCommandSpy),this.context.removeEventListener("dragenter",this.windowDragEnterHandler),this.context.removeEventListener("dragleave",this.windowDragLeaveHandler),this.context.removeEventListener("dragover",this.windowDragOverHandler),this.context.removeEventListener("drop",this.windowDropHandler),Xe.Z.removeListener(this._alarmsChanged)}componentDidUpdate(e,t){this.props.tabs===e.tabs&&this.props.maxWidth===e.maxWidth&&this.props.maxHeight===e.maxHeight||this.context.requestAnimationFrame((()=>{this.setOverflowClass(),this.updateScrollStatus()})),this.props.pages!==e.pages&&(this.maybeResetDragging(),this.props.pages.size>e.pages.size&&this.state.freeze&&this.setState({freeze:null})),this.state.freeze&&this.props.openAccordions?.length!==e.openAccordions?.length&&this.cleanUpFreezeHandler(),this.props.maxWidth!==e.maxWidth&&(this.props.maxWidth<=0&&(clearTimeout(this.animateTimeoutId),this.setState({animate:!1})),e.maxWidth<=0&&this.props.maxWidth>0&&this.allowDelayedAnimation())}_alarmsChanged=e=>{e&&this.setState((t=>{const n=e.map((e=>e?.id||""));return{activeAlarms:t.activeAlarms.union(n)}}))};isTabStackingEnabled=()=>!this.props.isSubstrip&&"off"!==this.props.prefValues[I.kTabsStackingMode];setOverflowClass=()=>{if("left"===this.props.tabPosition||"right"===this.props.tabPosition){const{Element:e}=this.context,t=this.refTabStrip.current;if(t instanceof e&&t.clientHeight<t.scrollHeight){if(this.props.setOverflowClass(!0,this.props.isSubstrip),this.props.switchByScroll){const e=t.querySelector(".tab.active");e&&e.scrollIntoViewIfNeeded()}}else this.props.setOverflowClass(!1,this.props.isSubstrip)}};maybeSpring=(e,t)=>this.state.animate&&this.props.prefValues[I.kThemeUseAnimation]&&!this.props.isResizing&&this.fitsInView()?KQ(e,t):e;fitsInView=()=>"row"===this.props.direction?this.props.tabs.size*Ive<this.props.maxWidth:this.props.tabs.size*Ive<this.props.maxHeight;allowDelayedAnimation(){this.state.animate||(this.animateTimeoutId=setTimeout((()=>{this.setState({animate:!0})}),1e3))}onCommandSpy=(e,t)=>{if(e===this.context.vivaldiWindowId)switch(t){case"COMMAND_FOCUS_TABBAR":(0,Ra.sT)(this.context.document,this.refTabStrip.current)||this.moveFocus("","current",!0);break;case"COMMAND_RENAME_TAB":{const t=Ce.ZP.getActivePage(e);t&&this.refTabs.get(t.id)?.current?.renameById(t.id);break}case"COMMAND_RENAME_TAB_STACK":{const t=Ce.ZP.getActivePage(e);if(t){const e=(0,kv.av)(t);e&&this.refTabs.get(t.id)?.current?.renameById(e)}break}case"COMMAND_TAB_MOVE_FIRST":c.ZP.stepTabsToStart(e);break;case"COMMAND_TAB_MOVE_END":c.ZP.stepTabsToEnd(e)}};accordionIsOpen=e=>Boolean(e&&this.props.openAccordions?.some((t=>t.groupId===e)));getNewTabButtonId(){return"newtab-"+(this.props.isSubstrip?"sub":"main")}moveFocus=(e,t,n)=>{const{document:i,HTMLElement:s}=this.context;if(!0===n||(0,Ra.sT)(i,this.refTabStrip.current)){let n=[];const i=this.refTabStrip.current;if(i instanceof s&&(n=Array.from(i.querySelectorAll(".tab-wrapper")).map((e=>e.dataset.id)).filter(Boolean)),0===n.length)return;if("current"===t){if(""===e&&i instanceof s){const t=i.querySelector(".tab-wrapper.active");t instanceof s&&(e=t.dataset.id)}const t=n.indexOf(e);if(-1===t)return;e=n[t]}else if("right"===t||"left"===t){if(1===n.length)return;let i=n.indexOf(e);if(-1===i)return;i="right"===t?i+1>=n.length?0:i+1:i<=0?n.length-1:i-1,e=n[i]}if(i instanceof s){const t=e===this.getNewTabButtonId()?i.querySelector("div.toolbar-tabbar button"):i.querySelector(`div.tab-wrapper[data-id="${e}"]`);t&&(t.focus(),this.setState({highlightedId:String(e)}))}}};openStackMenu=(e,t)=>{if(this.isTabStackingEnabled()){const n=Ce.ZP.getPageById(e);if(n){const e=(0,kv.av)(n);if(Ce.ZP.isGroup(e,this.context.vivaldiWindowId)){const n=Ce.ZP.getGroup(e,this.context.vivaldiWindowId).toArray().map(((e,t)=>({url:e.url,handler:()=>c.ZP.activateTab(e.id,this.context.vivaldiWindowId),...Qe.Z.makeNumberMnemonic(e.title,t)}))),i="top"===this.props.tabPosition||"bottom"===this.props.tabPosition?"bottomLeft":"left"===this.props.tabPosition?"topRight":"topLeft";(0,cs.Z)(this.context,n,void 0,i,t)()}}}};handleLeaveBar=()=>{this.setState({highlightedId:""});const e=this.context.vivaldiWindowId;de.Z.setPaneFocus(e,!1),ne.Z.executeActions("event",this.context,"COMMAND_FOCUS_WEBVIEW")};closeAndFreeze=e=>{const t=this.props.prefValues[I.kTabsClosePinnedInStack],n=(0,c.nq)(e)?e:ze.aV.of(e),i="on"===this.props.prefValues[I.kTabsClosePinned]?n:n.filter((e=>!e.pinned||(0,kv.av)(e)&&t));if(0!==i.size){if(1===i.size){const e=i.first();!e.pinned&&this.props.prefValues[I.kTabsAlignNext]&&this.freezeTabSize(e)}this.setState({animate:!1},(()=>{this.props.closePage(i).then((()=>{this.allowDelayedAnimation()}))}))}};getTabStripWidth=()=>{const e=this.props.prefValues[I.kTabsShowSyncedTabsButton];if("row"===this.props.direction){const t=Number(e)+Number(this.props.showTrashCan);return t>0?this.props.maxWidth-Tve*t:this.props.maxWidth-8}return this.props.maxWidth};freezeTabSize=e=>{const t=e=>{const t=this.createFlexBoxLayout(this.props.tabs,this.props.direction,this.getTabStripWidth(),this.props.maxHeight,{pageIdsHiddenForDrag:this.state.pageIdsHiddenForDrag,freeze:this.state.freeze,yieldBefore:this.#jn,yieldAfter:this.#Yn,tabStackingEnabled:this.isTabStackingEnabled(),isThumb:this.props.prefValues[I.kTabsThumbnails]}).children.map((e=>"tab"===e.type?e:void 0)).filter(Boolean),n=t.findIndex((t=>t.page.id===e)),i=t[n];if(i){let e;e=i.page.active?t[n+1]:i;const s=e.page.id;s&&this.setState({freeze:{width:e.layout?.width||this.props.maxWidth,height:i.layout?.height||this.props.maxHeight,nextId:s}}),this.context.addEventListener("mousemove",this.detectFinishFreezeHandler)}},n=this.props.tabs.getIn([-1,"page","id"]);e.id!==n?t(e.id):this.cleanUpFreezeHandler()};cleanUpFreezeHandler=()=>{this.setState({freeze:null}),this.context.removeEventListener("mousemove",this.detectFinishFreezeHandler)};detectFinishFreezeHandler=e=>{const{Element:t}=this.context,n=this.refTabStrip.current;if(n instanceof t){const t=n.getBoundingClientRect();(t.left>e.clientX||t.left+t.width<e.clientX||t.top>e.clientY||t.top+t.height<e.clientY)&&this.cleanUpFreezeHandler()}};handleTouchMove=e=>{e.preventDefault(),this.maybeStartDragging(e.touches[0])};handleMouseMove=e=>{e.preventDefault(),e.button===es.Z.kLeft?this.maybeStartDragging(e):this.endInternalDragging()};handleMouseUp=e=>{this.endInternalDragging()};handleAccordionToggle=(e,t)=>{e&&(t?this.setState({animate:!1},(()=>{this.props.handleCompressAccordion?.(e),this.allowDelayedAnimation()})):this.props.handleExpandAccordion?.(e))};handleClick=(e,t)=>{const{prefValues:n,isSubstrip:i}=this.props,s=he.ZP.isActive(this.context.vivaldiWindowId);if(Efe(t,n[I.kTabsSelectionEnabled],s))c.ZP.setSelection(e,{multiSelect:!1,addGroup:!1});else if(kfe(t,n[I.kTabsSelectionEnabled],s)){let t=!1;if("accordion"===this.props.prefValues[I.kTabsStackingMode]){const n=Ce.ZP.unsafeGetActivePage(this.context.vivaldiWindowId),i=n&&(0,kv.av)(n);if(i&&!this.props.openAccordions?.find((e=>e.groupId===i)))t=!0;else{const n=Ce.ZP.getSelectedPages(this.context.vivaldiWindowId),i=e?(0,kv.av)(e):null;i&&!this.props.openAccordions?.find((e=>e.groupId===i))&&n.some((e=>i!==(0,kv.av)(e)))&&(t=!0)}}else t=!i;c.ZP.setSelection(e,{multiSelect:!0,addGroup:t})}};handleMouseUpGuard=e=>{e.button===es.Z.kCenter&&(e.preventDefault(),e.stopPropagation())};handleAuxClick=(e,t)=>{t.button===es.Z.kCenter&&(this.closeAndFreeze(e),t.preventDefault(),t.stopPropagation())};handleMouseDown=(e,t,n,i)=>{const s=i.detail%2==0;if(i.button===es.Z.kLeft&&!s){i.preventDefault();he.ZP.isActive(this.context.vivaldiWindowId);(0,ps.Z)(i)||(this.props.onActivateTab(e),this.initDragging(i,e,t,n))}};handleDoubleClick=(e,t)=>{t.preventDefault(),t.stopPropagation();const{prefValues:n}=this.props,i=he.ZP.isActive(this.context.vivaldiWindowId);Efe(t,n[I.kTabsSelectionEnabled],i)?c.ZP.toggleRelatedSelection(e):"close"===n[I.kTabsDoubleClick]?c.ZP.closePage(e):"accordion"===n[I.kTabsStackingMode]&&this.props.toggleAutoExpandAccordion?.((0,kv.av)(e))};handleTouchStart=(e,t,n,i)=>{this.initDragging(i.touches[0],e,t,n)};onDragEnterHandler=e=>{if(e.dataTransfer.types.some((e=>e===p.Up))&&this.props.isExpectingDrop)return e.preventDefault(),void e.stopPropagation();e.dataTransfer.types.some((e=>zi.ZP.isUriListType(e)||Oce.Z.isSessionType(e)||"text/plain"===e))&&(e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="copy")};onDragLeaveHandler=()=>{clearTimeout(this.removeYieldTimeoutId),this.removeYieldTimeoutId=setTimeout((()=>{this.#m&&(this.#Yn=null,this.#jn=null,this.#Xn=null,this.setState({hoveredPageId:void 0}),clearTimeout(this.removeYieldAnimationTimeoutId),this.removeYieldAnimationTimeoutId=setTimeout((()=>{this.#jn||this.#Yn||!this.#m||(this.#zn=!1)}),2e3))}),200)};onDragOverHandler=e=>{if(clearTimeout(this.removeYieldTimeoutId),e.dataTransfer.types.some((e=>e===p.Up))&&this.props.isExpectingDrop){e.preventDefault(),e.stopPropagation();const t=300;this.removeYieldTimeoutId=setTimeout((()=>{this.#m&&(this.#Yn=null,this.#jn=null)}),t)}else e.dataTransfer.types.some((e=>zi.ZP.isUriListType(e)||"text/plain"===e))&&(e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="copy")};onDropHandler=e=>{e.preventDefault(),e.stopPropagation();const t=this.context.vivaldiWindowId,n=e.dataTransfer.getData(p.Up);if(this.props.isExpectingDrop&&n)return void this.droppedTabHandler(n);const i=zi.ZP.extractUriListFromEvent(e);if(i){const e="directrightofcurrent"===this.props.prefValues[I.kTabsNewPlacement];let n=0;const s=i.split("\n");return e&&(s.reverse(),n=s.length-1),void s.forEach(((e,i)=>c.ZP.openURL(t,e,{inCurrent:!1,inBackground:n!==i,groupId:this.props.isSubstrip?this.props.activeGroupId:void 0})))}const s=Oce.Z.getSessionData(e);if(s.length>0)return void li.Z.open(t,s,!1);const o=e.dataTransfer.getData("text/plain");o&&oy.Z.go(t,[o],{inCurrent:!1,enableSearch:this.props.prefValues[I.kAddressBarInlineSearchEnabled],groupId:this.props.isSubstrip?this.props.activeGroupId:void 0})};droppedTabHandler=e=>{i.Z.tabs.query({},(t=>{this.setState({animate:!1},(()=>{fve({accordionIsOpen:this.accordionIsOpen,draggedActive:this.state.draggedActive,droppedTabs:e,isSubstrip:this.props.isSubstrip,isTabStackingEnabled:this.isTabStackingEnabled(),maybeResetDragging:this.maybeResetDragging,tabStackingMode:this.props.prefValues[I.kTabsStackingMode],allTabs:t,substripTabs:this.props.tabs,yieldAfter:this.#Yn,yieldBefore:this.#jn,yieldOver:this.#Xn,windowId:this.context.vivaldiWindowId}),this.allowDelayedAnimation()}))}))};showSubStack=(0,Ae.Z)((e=>this.props.showSubStack?.(e)),100);handleTabPosition=(e,t)=>{clearTimeout(this.removeYieldTimeoutId);const n=this.#Xn;"before"===t?(this.#zn=!0,this.#jn=e,this.#Yn=null,this.#Xn=null):"after"===t?(this.#zn=!0,this.#jn=null,this.#Yn=e,this.#Xn=null):"over"===t?(this.#zn=!1,this.#Xn=e,this.#jn=null,this.#Yn=null,this.props.isSubstrip||this.showSubStack(e)):"none"===t&&(this.#jn=null,this.#Yn=null,this.#Xn=null,clearTimeout(this.expireYieldTimeoutId),this.expireYieldTimeoutId=setTimeout((()=>{this.#m&&(this.#jn||this.#Yn||this.#Xn||(this.#zn=!1))}),1e3)),this.#Xn&&this.#Xn!==n&&hte.click(),this.forceUpdate()};setPageIdsHiddenForDrag=e=>{this.setState({pageIdsHiddenForDrag:e})};windowDragEnterHandler=e=>{e.dataTransfer&&e.dataTransfer.types.some((e=>e===p.Up))&&(e.preventDefault(),e.stopPropagation(),this.windowDragOverHandler(e))};windowDragLeaveHandler=e=>{if(e.dataTransfer&&e.dataTransfer.types.some((e=>e===p.Up))){e.preventDefault(),e.stopPropagation();0===e.pageX&&0===e.pageY&&this.handleTabPosition(-1,"none")}};windowDragOverHandler=e=>{if(e.dataTransfer&&e.dataTransfer.types.some((e=>e===p.Up))&&(e.preventDefault(),e.stopPropagation(),this.delayedActivateWindow(e),!this.#Xn&&!this.#jn&&!this.#Yn)){const e=this.state.pageIdsHiddenForDrag.first();if(e?!this.props.pages.some((t=>t.id===e)):this.props.isExpectingDrop){const e=this.props.pages.getIn([-1,"id"]);e&&this.handleTabPosition(e,"after")}}};windowDropHandler=e=>{const{dataTransfer:t}=e;if(t&&t.types.some((e=>e===p.Up))){e.preventDefault(),e.stopPropagation();const n=t.getData(p.Up),s=JSON.parse(n),o=s.ids.map((e=>parseInt(e))).sort(((e,t)=>e-t));i.Z.tabs.query({},(t=>{if(t.find((e=>o.includes(e.id)&&e.windowId!==this.context.vivaldiWindowId))){const e=(0,ze.aV)(t).filter((e=>o.some((t=>e.id===t)))).map(gve.OK);c.ZP.moveDroppedTabs(this.context.vivaldiWindowId,e,s.active,-1,void 0)}else{const t=Ce.ZP.getPages(this.context.vivaldiWindowId),n=o.map((e=>t.find((t=>t.id===parseInt(e))))).filter(Boolean);if(n.length===t.size)return void this.maybeResetDragging();n.length?c.ZP.detachPage((0,ze.aV)(n),e.screenX,e.screenY):(this.maybeResetDragging(),console.warn("Dropped Page(s) does not exist:",o))}}))}};delayedActivateWindow({screenX:e,screenY:t}){Eve(e,t,250,(()=>i.Z.windows.update(this.context.vivaldiWindowId,{focused:!0})))}maybeResetDragging=()=>{if(!this.#m)return;const{pageIdsHiddenForDrag:e}=this.state;(!e.isEmpty()||this.#zn||this.#Xn)&&(this.#zn=!1,this.#jn=null,this.#Yn=null,this.#Xn=null,this.setState({pageIdsHiddenForDrag:(0,ze.l4)(),isDragging:!1,hoveredPageId:void 0}))};handleEscKey=()=>{this.abortAndRevertDragging()};abortAndRevertDragging=()=>{this.state.draggedPages.forEach((e=>c.ZP.moveToIndex(e.windowId,e,e.index))),setTimeout((()=>{this.cleanupDragging(),this.maybeResetDragging()}),500)};initDragging=({pageX:e,pageY:t},n,i,s)=>{let o;this.context.addEventListener("touchmove",this.handleTouchMove,!0),this.context.addEventListener("mousemove",this.handleMouseMove,!0),this.context.addEventListener("touchend",this.handleMouseUp,!0),this.context.addEventListener("mouseup",this.handleMouseUp,!0),es.Z.setWebviewPointerEvents(!1,this.context.document),Ke.Z.bind("esc",this.handleEscKey);const{isSelecting:a,isSubstrip:r}=this.props,l=this.props.getSelectedPages(),d=(0,kv.av)(n),c=this.isTabStackingEnabled()&&Ce.ZP.isGroup(d,this.context.vivaldiWindowId),u=a&&l.some((e=>e.id===n.id)),p=this.props.prefValues[I.kTabsStackingMode];o=u?l:c&&("dotted"===p||"substrip"===p&&!r||"accordion"===p&&!this.accordionIsOpen(d))?Ce.ZP.getGroup(d,this.context.vivaldiWindowId):ze.aV.of(n),this.start=[e,t],this.delta=[e-i,t-s],this.#jn=null,this.#Yn=null,this.setState({draggedActive:n,draggedPages:o,isDragging:!1,mouse:[i,s]})};maybeStartDragging=e=>{let{isDragging:t}=this.state;const{tabs:n,direction:i,maxHeight:s,prefValues:o}=this.props,{pageX:a,pageY:r}=e,[l,d]=this.start;if(!t){if(!(Math.abs(l-a)>5||Math.abs(d-r)>5))return;t=!0}const c=this.createFlexBoxLayout(n,i,this.getTabStripWidth(),s,{freeze:this.state.freeze,pageIdsHiddenForDrag:this.state.pageIdsHiddenForDrag,yieldBefore:this.#jn,yieldAfter:this.#Yn,tabStackingEnabled:this.isTabStackingEnabled(),isThumb:o[I.kTabsThumbnails]}),u=this.props.tabs.find((e=>this.state.draggedActive?.id===e.page.id));if(!u)return;const p="group"===u.type?this.accordionIsOpen(u.id)?String(u.page.id):u.id:String(u.page.id),h={top:0,right:0,bottom:0,left:0,width:0,height:0},g=c.children?.find((e=>"tab"===e.type&&e.tabId===p))?.layout??h,[m,f]=this.delta;let[v,y]=[a-m,r-f];const b=c.children?.filter((e=>"tab"===e.type)),S=(0,yve.Z)(b).layout??h,w=(0,bve.Z)(b).layout??h;"column"===i&&(v+50<S.left||v-50>w.left)||"row"===i&&(y+50<S.top||y-50>w.top||this.isHorizontalScrollingEnabled()&&this.isMouseOverScrollArrow)?this.startDragging(u,0,0):(v="row"===i?v:g.left,y="column"===i?y:g.top,v=(0,Gw.Z)(v,S.left-5,w.left+5),y=(0,Gw.Z)(y,S.top-5,w.top+5),this.setState({mouse:[v,y],isDragging:t,isDraggingPinnedTab:u.page.pinned}),this.props.setIsInternalDragging?.(!0),this.detectInternalOverlap(u,g,c,i,v,y))};detectInternalOverlap=async(e,t,n,i,s,o)=>{if(this.#Gn)return;const a="accordion"===this.props.prefValues[I.kTabsStackingMode],r=a&&this.accordionIsOpen((0,kv.av)(e.page))?String(e.page.id):String(e.id),l=this.state.draggedPages.map((e=>String(e.id)));let d;for(let e=0;e<n.children?.length;e+=1){const a=n.children[e];if("tab"!==a.type)continue;const c=a.layout;if(a.tabId!==r&&c&&!l.find((e=>e===a.tabId))){let e;if("row"===i){const{width:n,left:i}=c,o=t.width-n,a=s+(t.left<i?n*Gfe:n*$fe);e=a>i-o&&a<i+n}else{const{height:n,top:i}=c,s=o+(t.top<i?n*Gfe:n*$fe);e=s>i&&s<i+n}if(e){d=a;break}}}if(d){const t=this.context.vivaldiWindowId,n=d.page;if(n){const i=this._getPagesFromDraggedSet(),s=(0,kv.av)(n);let o=n.index;if(!this.props.isSubstrip&&s&&!this.accordionIsOpen(s)&&Ce.ZP.isGroup(s,t)){const e=Ce.ZP.getGroup(s,t);o=o<i.first().index?e.first().index:e.last().index}const r=this.state.draggedPages.size>1;this.#Gn=!0,!r&&a&&("string"==typeof s&&this.accordionIsOpen(s)?await(0,Sve.V)(e.page.id,{group:s}):await(0,Sve.V)(e.page.id,{group:void 0})),await c.ZP.moveToIndex(e.page.windowId,this.accordionIsOpen(s)?e.page:i,o),this.#Gn=!1}}else{if(this.isTabStackingEnabled()&&this.props.prefValues[I.kTabsStackingAllowDnd]){const e={...t,left:s,top:o},l=n.children??[];let d,c=0;for(let t=0;t<l.length;t+=1){const n=l[t],{type:i,layout:s}=n,o=a&&n.page&&this.accordionIsOpen((0,kv.av)(n.page));if(s&&"tab"===i&&n.tabId!==r&&!o){if(c=(u=s,p=e,Math.max(0,Math.min(u.left+u.width,p.left+p.width)-Math.max(u.left,p.left))*Math.max(0,Math.min(u.top+u.height,p.top+p.height)-Math.max(u.top,p.top)))/(s.width*s.height),c<$fe&&c>Gfe){d=n;break}}}if(!d)return this.currentHoveredId=0,this.enterSide="none",this.setState({hoveredPageId:-1}),void(this.dragOverTimeoutId&&this.resetDragOver());if("tab"!==d.type&&"accordionToggle"!==d.type)return;const{layout:h,page:g}=d;if(!h||!g)return;const{left:m,width:f,top:v,height:y}=h;let b;b="row"===i?s<m+(t.left<m?f*Gfe:f*$fe)?"before":"after":o<v+(t.top<v?y*Gfe:y*$fe)?"before":"after";const S=this.enterSide,w=g.id;this.currentHoveredId!==w&&(this.enterSide=b),this.currentHoveredId=w??-1,"none"===S&&S!==b?this.startDragOverTimer(c):S!==b&&this.resetDragOver(),-1!==this.state.hoveredPageId&&this.state.hoveredPageId!==this.currentHoveredId&&(this.resetDragOver(),this.startDragOverTimer(c))}var u,p}};startDragOverTimer=e=>{const t=this.props.prefValues[I.kTabsStackingDndDelay];clearTimeout(this.dragOverTimeoutId),this.dragOverTimeoutId=setTimeout((()=>{this.state.isDragging&&(hte.click(),this.setState({hoveredPageId:this.currentHoveredId}))}),t)};resetDragOver=()=>{clearTimeout(this.dragOverTimeoutId),delete this.dragOverTimeoutId,this.setState({hoveredPageId:-1})};_getPagesFromDraggedSet=()=>{const e=Ce.ZP.getPages(this.context.vivaldiWindowId);return this.state.draggedPages.reduce(((t,n)=>{const i=e.find((e=>e.id===n.id));return i?t.push(i):t}),(0,ze.aV)())};getDragImageData=(e,t,n)=>{this.#$n&&URL.revokeObjectURL(this.#$n);const{document:i,HTMLImageElement:s,HTMLSpanElement:o,devicePixelRatio:a}=this.context,r=mw.Z.getUIZoom(),l=i.createElement("canvas"),d=l.getContext("2d"),c=Math.floor((e?.width||180)*r),u=Math.floor(e?.height||27)*r;let p;return l.style.width=`${c}px`,l.style.height=`${u}px`,l.width=Math.floor(c),l.height=Math.floor(u),d.fillStyle=this.props.theme.colorBg,function(e,t,n,i){e.beginPath(),e.moveTo(i,0),e.lineTo(t-i,0),e.quadraticCurveTo(t,0,t,i),e.lineTo(t,n-i),e.quadraticCurveTo(t,n,t-i,n),e.lineTo(i,n),e.quadraticCurveTo(0,n,0,n-i),e.lineTo(0,i),e.quadraticCurveTo(0,0,i,0),e.closePath(),e.clip()}(d,c,u,this.props.theme.radius),d.fill(),d.fillStyle=this.props.theme.colorFg,d.font=12*r+"px system-ui",d.fillText(n,16*r+6*r+4*r,u/2+12*r/3),p=t instanceof s?new Promise(((e,n)=>{const i=new Image;i.crossOrigin="Anonymous",t.srcset?i.srcset=t.srcset:i.src=t.src,i.onload=()=>{const t=6*r/a,n=16*r/a;d.drawImage(i,t,t,n,n),e(d.getImageData(0,0,c,u))},i.onerror=t=>{console.warn(t),e()}})):t instanceof o?new Promise((e=>{this.#$n=URL.createObjectURL(new Blob([t.innerHTML],{type:"image/svg+xml"}));const n=new Image;n.onload=()=>{const t=6*r/a,i=16*r/a;d.drawImage(n,t,t,i,i),e(d.getImageData(0,0,c,u))},n.src=this.#$n})):Promise.resolve(),d.scale(a,a),{width:c,height:u,imageDataPromise:p}};messageDragging=e=>{he.ZP.isIncognitoOrGuest(this.context.vivaldiWindowId)?this.props.setIsExpectingDrop(e):se.Z.utilities.broadcastMessage(e?{startDragging:!0}:{endDragging:!0})};createDropData=(e,t)=>JSON.stringify({ids:t.map((e=>e.id)).toJS(),active:e.id,activeIndex:e.index,dragSource:this.props.isSubstrip?"stack":"main",sourceWindow:this.context.vivaldiWindowId});startDragging=async(e,t,n)=>{const{Element:i,ClientRect:s}=this.context,{draggedPages:o}=this.state;this.cleanupDragging();const a=o.find((e=>e.active))||o.first();if(!(this.refTabStrip.current instanceof i))return;const r=this.refTabs.get(e.page.id)?.current;if(!r)return;const l=r.refTab.current,d=l instanceof i?l.getBoundingClientRect():void 0,c=(0,kv.av)(a),u=this.isTabStackingEnabled()&&Ce.ZP.isGroup(c,this.context.vivaldiWindowId)?4:0,h=r.refFavicon.current,g=pn.jk.getDisplayTitleByUrl(a.url,a.title),m=d?.left??0,f=(d?.top??0)-u,{width:v,height:y,imageDataPromise:b}=this.getDragImageData(d,h,g),S=await b;this.setState({isDragging:!0},(()=>{this.messageDragging(!0),this.setupDragEndHandler(o),se.Z.tabsPrivate.startDrag({windowId:this.context.vivaldiWindowId,mimeType:p.Up,customData:this.createDropData(a,o),imageData:S?.data.buffer,url:a.url,title:g,posX:m,posY:f,width:v,height:y,cursorX:t,cursorY:n}),this.setState({pageIdsHiddenForDrag:o.toSet().map((e=>e.id)),isDraggingPinnedTab:e.page.pinned})}))};endInternalDragging=()=>{const{vivaldiWindowId:e}=this.context,t=-1!==this.state.hoveredPageId&&Ce.ZP.getPages(e).find((e=>e.id===this.state.hoveredPageId));if(t){let n,i=this._getPagesFromDraggedSet();const s=(0,kv.av)(t);if(n=Ce.ZP.isGroup(s,e)?Ce.ZP.getGroup(s,e).sort(((e,t)=>e.index-t.index)):ze.aV.of(t),n.size>0&&i.size>0){const e=n.first().index,s=i.count((t=>t.index<e)),o=e-s;i=i.first().index<n.first().index?i.concat(n):n.concat(i),c.ZP.createTabStack(i,o,(0,kv.av)(t))}}this.cleanupDragging()};cleanupDragging=()=>{this.context.removeEventListener("touchmove",this.handleTouchMove,!0),this.context.removeEventListener("mousemove",this.handleMouseMove,!0),this.context.removeEventListener("touchend",this.handleMouseUp,!0),this.context.removeEventListener("mouseup",this.handleMouseUp,!0),es.Z.setWebviewPointerEvents(!0,this.context.document),Ke.Z.unbind("esc",this.handleEscKey),!this.state.isDragging&&this.state.draggedActive?.active&&(this.state.draggedActive.pinned&&"bury"===this.props.prefValues[I.kTabsClosePinned]||this.props.prefValues[I.kTabsMinimize])&&c.ZP.minimizePage(this.context.vivaldiWindowId),this.props.setIsInternalDragging?.(!1),this.#m&&(this.start=[0,0],this.delta=[0,0],this.isMouseOverScrollArrow=!1,this.setState({isDragging:!1,isDraggingPinnedTab:!1,hoveredPageId:-1}))};setupDragEndHandler(e){const t=(n,i,s,o)=>{if(se.Z.tabsPrivate.onDragEnd.removeListener(t),this.messageDragging(!1),n)this.abortAndRevertDragging();else if(i){const t=this.context.vivaldiWindowId;if(e.size===Ce.ZP.getPages(t).size)return void this.maybeResetDragging();e.size&&c.ZP.detachPage(e,s,o)}else{const t=s-this.context.screenLeft,n=o-this.context.screenTop,{document:i}=this.context,a=i.elementFromPoint(t,n);a&&"WEBVIEW"===a.tagName&&e.size&&c.ZP.detachPage(e,s,o)}setTimeout((()=>this.maybeResetDragging()),100)};se.Z.tabsPrivate.onDragEnd.addListener(t)}clearForceHover=()=>{this.setState((e=>e.freeze?{freeze:{...e.freeze,nextId:-1}}:null))};getScrollTabWidth=e=>e/Math.round(e/Cve);getTabStyle(e,t,n,i,s){const{prefValues:o,isSubstrip:a,maxHeight:r}=this.props,l=o[I.kTabsStackingMode],d=(0,Cs.mM)();if(e){let e;return e=n?Ive+(d||1):o[I.kTabsHorizontalScrolling]?this.scrollableAreaWidth?this.getScrollTabWidth(this.scrollableAreaWidth)-(i&&"accordion"===l?16:0):Cve:t?parseInt(o[I.kTabsActiveMinSize])||31:void 0,{flex:n?0:1,zIndex:0,maxWidth:n?31:Cve,maxHeight:a?r-(d?2*d:2):r,minHeight:Ive,minWidth:e}}{const e=this.props.overflow?(0,Cs.np)():0;let t;return t=i&&("dotted"===l||"substrip"===l&&o[I.kTabsStackingPreferDotted])?(s?90:37)+d:s&&!n?90+d:Ive+(i&&"accordion"===l?0:d||1),{flex:n?0:1,zIndex:0,maxWidth:this.props.maxWidth-e-2*(d||1),maxHeight:s&&!n?Ave:31,minHeight:t,minWidth:Ive}}}createFlexBoxLayout=gs()(((e,t,n,i,s)=>{const o=parseInt(this.props.prefValues[I.kTabsActiveMinSize]),a="row"===t;let r=!this.props.isSubstrip&&e.first()?.page.pinned&&!a&&this.props.prefValues[I.kTabsShowSeparator];const l=this.props.prefValues[I.kTabsStackingMode],d="accordion"===l&&this.props.openAccordions&&this.props.openAccordions.length>0?e.flatMap((e=>{if("group"===e.type&&this.accordionIsOpen((0,kv.av)(e.page))){const t=e.pages.size,n=t-1;return e.pages.map(((e,i)=>({type:"accordionTab",page:e,id:e.id,isFirst:0===i,isLast:i===n,accordionSize:t})))}return[e]})):e,c={style:{flexDirection:t,width:n,height:i},children:[]};let u=0;for(let e=0;e<d.size;e++){const t=d.get(e);if(!t)continue;const p=(!this.props.isSubstrip||"substrip"!==l)&&t.page.pinned,h=t.page.active,g=s.tabStackingEnabled&&!this.props.isSubstrip&&"group"===t.type,m=this.getTabStyle(a,h,p,g,s.isThumb);if(s.freeze&&!p){const e=h&&s.freeze.width<o?o:s.freeze.width,t=s.freeze.height;m.width=m.maxWidth=m.minWidth=e,m.height=m.maxHeight=m.minHeight=t}const{isDragging:f,draggedPages:v,draggedActive:y}=this.state;f&&y&&y.id!==t.page.id&&v.some((e=>e.id===t.page.id))&&(m.width=m.maxWidth=m.minWidth=0,m.height=m.maxHeight=m.minHeight=0);const b=!g&&s.pageIdsHiddenForDrag.has(t.page.id),S=g&&"group"===t.type&&t.pages.every((e=>s.pageIdsHiddenForDrag.has(e.id)));(b||S)&&(a?m.width=m.maxWidth=m.minWidth=0:m.height=m.maxHeight=m.minHeight=0),r&&!p&&(u+=18,c.children.push({type:"separator",style:{...m,flex:0,maxHeight:18,minHeight:18,height:18}}),r=!1);if(s.yieldBefore===t.page.id){const e=this.getTabStyle(a,h,p,g,s.isThumb);u+=e.maxHeight||0,c.children.push({type:"blank",style:e})}const w="accordionTab"===t.type?t.accordionSize:0,C="accordionTab"===t.type&&t.isFirst,A="accordionTab"===t.type&&t.isLast,I="group"===t.type?t.pages:(0,ze.aV)();if(c.children.push({type:"tab",tabId:t.id.toString(),page:t.page,stackPages:I,style:m,isFirst:C,isLast:A,isStack:g,accordionSize:w}),u+=m.maxHeight||0,"accordion"===l&&!f&&(g||t.isLast)&&!b&&!S){const e=this.props.overflow?(0,Cs.np)():0,s=(0,Cs.mM)()>0?(0,Cs.mM)():1,o=a?16+s:n-2*s-e,r=a?i+(1===s?1:0):16+s;u+=r,c.children.push({type:"accordionToggle",page:t.page,style:{width:o,height:r,alignSelf:a?"flex-end":"flex-start"}})}if(s.yieldAfter===t.page.id){const e=this.getTabStyle(a,h,p,g,s.isThumb);u+=e.maxHeight||0,c.children.push({type:"blank",style:e})}}const p=(a||u+Ive<i)&&(!this.isHorizontalScrollingEnabled()||this.isHorizontalScrollingEnabled()&&!this.state.canScrollLeft&&!this.state.canScrollRight);return p&&(c.children=c.children.concat({type:"button",style:{width:Ive,height:Ive,alignSelf:a?"flex-end":"center"}})),this.#Kn=!p,hve()(c),c}));removeFromTabStack=e=>{if(this.props.isSelecting){const e=this.props.getSelectedPages();e.isEmpty()||c.ZP.removeFromTabStack(e)}else{const t=Ce.ZP.getPageById(e);t&&c.ZP.removeFromTabStack(t)}};getDraggedPages=e=>{const{isSelecting:t}=this.props,n=this.props.getSelectedPages();return t&&n.some((t=>t.id===e.id))?n.toArray():[e]};checkSelected=e=>this.props.getSelectedPages().some((t=>t.id===e));getStyles=()=>{const{direction:e,tabs:t}=this.props,n=this.props.prefValues[I.kTabsThumbnails],i="row"===e,s=this.createFlexBoxLayout(t,e,this.getTabStripWidth(),this.props.maxHeight-(i?0:Tve),{pageIdsHiddenForDrag:this.state.pageIdsHiddenForDrag,freeze:this.state.freeze,yieldBefore:this.#jn,yieldAfter:this.#Yn,tabStackingEnabled:this.isTabStackingEnabled(),isThumb:n}),o=[];for(let e=0;e<s.children.length;e++){const t=s.children[e],{layout:n}=t;if(n){if(isNaN(n.left)||isNaN(n.width)||isNaN(n.top)||isNaN(n.height)){0;const t=this.state.freeze?.width??Cve;n.left=i?e*t:0,n.width=t,n.top=i?0:e*Ive,n.height=Ive}switch(t.type){case"tab":{const{tabId:e,page:s,isFirst:a,isLast:r,isStack:l,stackPages:d,accordionSize:c}=t;if(!e||!s)continue;o.push({key:e,data:{type:"tab",page:s,isFirst:a,isLast:r,isStack:l,stackPages:d,zIndex:a||s.active?2:1,accordionSize:c},style:{x:this.maybeSpring(n.left,Zve),y:this.maybeSpring(n.top,Zve),width:i?this.maybeSpring(n.width,Zve):n.width,height:n.height}});break}case"blank":o.push({key:`space-${e}`,data:{type:"space"},style:{x:n.left,y:n.top,width:this.state.isDraggingPinnedTab&&i?31:n.width,height:n.height}});break;case"button":o.push({key:"button",data:{type:"button"},style:{x:n.left,y:i?0:n.top,width:n.width,height:n.height}});break;case"separator":o.push({key:"separator",data:{type:"separator"},style:{x:this.maybeSpring(n.left),y:this.maybeSpring(n.top),width:n.width,height:n.height}});break;case"accordionToggle":const s=i?1:0;o.push({key:`accordionToggle-${e}`,data:{type:"accordionToggle",page:t.page},style:{x:n.left-s,y:i?0:n.top,width:n.width+s,height:n.height}});break;default:console.warn("Unknown Element",t.type)}}}return o};getFavicon=gs()(((e,t)=>pn.jk.getFaviconWithFallback(e,t)),{maxSize:50});getElementStyle=(e,t,n,i,s,o,a,r)=>{const l=r>0&&a?"fixed":void 0;return{"--PositionX":`${Math.floor(e)-r}px`,"--PositionY":`${Math.floor(t)}px`,"--Opacity":n,"--Height":`${Math.floor(i)}px`,"--Width":`${Math.floor(s)}px`,"--ZIndex":o,position:l}};setTabRef=(e,t)=>{if(t){const n=Li.createRef();n.current=t,this.refTabs.set(e,n)}else this.refTabs.delete(e)};getNewTabButtonStyle=gs()(((e,t,n,i,s,o)=>({"--PositionX":`${e}px`,"--PositionY":`${t}px`,"--Opacity":n,"--Height":`${i}px`,"--Width":`${s}px`,"--ZIndex":o,left:`${e}px`,top:`${t}px`})));isHorizontalScrollingEnabled=()=>this.props.prefValues[I.kTabsHorizontalScrolling]&&("top"===this.props.tabPosition||"bottom"===this.props.tabPosition);horizontalScroll=e=>{const t=(this.scrollableAreaWidth??this.props.maxWidth)*("left"===e?-1:1),n=this.refTabStrip.current,{HTMLElement:i}=this.context;n instanceof i&&n.scrollBy(t,0)};scrollRight=e=>{e.stopPropagation(),this.horizontalScroll("right")};scrollLeft=e=>{e.stopPropagation(),this.horizontalScroll("left")};updateScrollStatus=e=>{if(!this.isHorizontalScrollingEnabled())return;const{HTMLDivElement:t}=this.context,n=e??this.refTabStrip.current;if(n instanceof t){const{clientWidth:e,scrollWidth:t,scrollLeft:i}=n,s=n.getBoundingClientRect();this.scrollableAreaWidth=s.width,this.setState({canScrollLeft:i>0,canScrollRight:(i+e)/t<1})}};handleScroll=e=>{this.updateScrollStatus(e.currentTarget)};getOverflowMenu=()=>{const e=this.props.tabs.map((({page:e},t)=>{return{...Qe.Z.makeNumberMnemonic((n=pn.jk.getDisplayTitle(e),n.length>70?n.substring(0,70)+"...":n),t),url:e.url,handler:()=>this.props.onActivateTab(e)};var n})),t=ji.Z.getOptionFunction("taboverflow"),n=this.context.vivaldiWindowId;return ji.Z.getNamedMenu(n,"taboverflow",(async i=>"CONTEXT_CONTAINER_TAB_OVERFLOW"===i.action?{items:e.toArray(),...t(n,i,{})}:{...t(n,i,{})}))};handleWheel=e=>{if(e.deltaX||e.shiftKey||this.props.prefValues[I.kMouseWheelTabSwitch]||!this.isHorizontalScrollingEnabled())return;const{Element:t}=this.context,n=(this.scrollableAreaWidth?this.getScrollTabWidth(this.scrollableAreaWidth):Cve)*(e.deltaY<0?-2:2),i=this.refTabStrip.current;i instanceof t&&i.scrollBy({top:0,left:n,behavior:"smooth"})};setMouseIsOverScrollArrow=()=>{this.state.isDragging&&(this.isMouseOverScrollArrow=!0)};setMouseIsNotOverScrollArrow=()=>{this.state.isDragging&&(this.isMouseOverScrollArrow=!1)};toggleSubstripLock=()=>{w.Z.toggle(I.kTabsStackingSubstripLocked,!0,!1)};render(){const e=this.props.prefValues[I.kTabsShowSyncedTabsButton],t=this.props.prefValues[I.kTabsStackingSubstripLocked],n=this.props.prefValues[I.kTabsStackingMode],i=this.getStyles(),s=this.isHorizontalScrollingEnabled(),o=this.isTabStackingEnabled(),a={top:"below",bottom:"above",left:"after",right:"before"}[this.props.tabPosition];const r=this.props.prefValues[I.kThemeUseAnimation]?150:0,l=Boolean(!this.props.prefValues[I.kTabsTooltip]||!this.state.pageIdsHiddenForDrag.isEmpty()),d=(0,B.Z)("Hold to show open tabs"),c="row"===this.props.direction,{isDraggingPinnedTab:u}=this.state,h=s?this.props.pinnedWidth:0;return(0,ss.jsxs)(ss.Fragment,{children:[s&&wve("div",{className:"toolbar toolbar-tabbar",onMouseEnter:this.setMouseIsOverScrollArrow,onMouseOut:this.setMouseIsNotOverScrollArrow},void 0,wve(po.ZP,{className:Fi()("horizontal-scroll-arrow",{disabled:!this.state.canScrollLeft}),style:{paddingRight:h},image:Wi.mgF.medium,onClick:this.scrollLeft,menu:this.getOverflowMenu,menuOrigin:"top"===this.props.tabPosition?"bottomLeft":"topLeft",mimeType:p.Up,edgeAmount:0,tooltip:(0,B.Z)("Scroll left"),tooltipExtra:d})),wve(dve,{styles:i,children:e=>(0,ss.jsx)("div",{ref:this.refTabStrip,role:"tablist","aria-labelledby":this.props.isSubstrip?"tabbar-stack-label":"tabbar-toplevel-label","aria-orientation":"row"===this.props.direction?"horizontal":"vertical","aria-owns":this.props.tabs.map((e=>`tab-${e.id}`)).join(" "),className:Fi()("tab-strip",{"horizontal-scrolling":s,"horizontal-scrolling-smooth":s&&this.state.animate,overflow:this.props.overflow}),onDragEnter:this.onDragEnterHandler,onDragLeave:this.onDragLeaveHandler,onDragOver:this.onDragOverHandler,onDrop:this.onDropHandler,onDoubleClick:this.state.freeze?ms.UW:null,onContextMenu:e=>this.props.onContextMenu(e,this.props.isSubstrip),onWheel:this.handleWheel,onScroll:this.handleScroll,children:e.map(((t,i)=>{const s=t.data;if(s){if("tab"===s.type){const{page:d,stackPages:p=(0,ze.aV)(),isStack:g=!1,isFirst:m=!1,isLast:f=!1,accordionSize:v=0}=s,y=d.vivExtData.ext_id,b=d.url,S=this.props.prefValues[I.kTabsShowCloseButton]&&Ce.ZP.canClosePage(d),w=(0,kv.av)(d)||"",C=this.state.pageIdsHiddenForDrag.has(d.id),A="accordion"===n&&v>1&&this.accordionIsOpen(w),T=!g&&C,Z=g&&p.every((e=>this.state.pageIdsHiddenForDrag.has(e.id))),E=T||Z||!he.ZP.getVisibleUI(this.context.vivaldiWindowId).tabs,k=this.props.mediaState.get(d.id)||(0,ze.l4)(),_=Boolean(this.state.freeze?.nextId===d.id||this.props.prefValues[I.kTabsCloseButtonPermanent]&&t.style.width>66),N=d.pinned&&!u||u&&!d.pinned?void 0:this.handleTabPosition,P=this.props.isSubstrip||A,D=d.active&&this.props.isSubstripVisible&&!this.props.isSubstrip?d.id+1e3:d.id;let M=0;if(A&&m){let t=0;for(let n=i;n<e.length;n++){const i=e[n],s=i.data;if(t===v)break;0===n&&"space"===s?.type||("tab"===s?.type&&(t+=1),M+=c?i.style.width:i.style.height)}if(M>0&&!this.state.isDragging){M+=16+(0,Cs.mM)()}}const O=g&&o&&"substrip"===n&&!this.props.prefValues[I.kTabsStackingPreferDotted]&&!this.props.isSubstrip,x=this.state.isDragging&&this.state.draggedActive?.id===d.id,[L,R]=this.state.mouse,B=x&&c&&!u?Math.max(L,this.props.pinnedWidth):t.style.x,F=!x||c||u?t.style.y:Math.max(R,this.props.pinnedWidth),W=this.getElementStyle(B,F,t.style.opacity,t.style.height,t.style.width,s.zIndex,!this.props.isSubstrip&&d.pinned,this.props.isSubstrip?0:h),U=g&&!this.props.isSubstrip&&!A&&!this.props.prefValues[I.kTabsStackingPreferDotted]&&("substrip"===n||"accordion"===n);return wve(ove,{id:D,noPadding:this.props.isSubstripVisible&&!this.props.isSubstrip&&!this.props.prefValues[I.kAppearanceDensity],disabled:l||x,pointerEvents:o&&g?"auto":"none",placement:a,appearDelay:200,transitionSpeed:r,disappearDelay:o?200:1,content:()=>this.props.getTooltipContent(D,P,d.discarded,d.memoryUsage),memoryUsage:d.memoryUsage,stackSize:p.size},t.key,wve("div",{className:Fi()("tab-position",{"is-substack":O,"is-pinned":d.pinned}),style:W,onMouseDown:this.handleMouseDown.bind(null,d,t.style.x,t.style.y),onMouseUp:this.handleMouseUpGuard,onAuxClick:this.handleAuxClick.bind(null,d),onClick:this.handleClick.bind(null,d),onDoubleClick:this.handleDoubleClick.bind(null,d),onTouchStart:this.handleTouchStart.bind(null,d,t.style.x,t.style.y)},void 0,(0,ss.jsx)(jfe,{ref:e=>this.setTabRef(d.id,e),id:`tab-${t.key}`,pageId:d.id,url:b,active:d.active,acceptsDrop:d.id===this.#Xn||d.id===this.state.hoveredPageId,discarded:d.discarded,incognito:d.incognito,pinned:d.pinned,isUnread:Ce.ZP.isUnread(d),groupId:w,tilingType:d.vivExtData.tiling?.type??"",tilingId:(0,kv.jA)(d)||"",extId:y,fixedTitle:g&&(0,kv.XN)(d)||d.vivExtData.fixedTitle,faviconUrl:this.getFavicon(b,d.favIconUrl),title:d.title,memoryUsage:d.memoryUsage,thumbnail:this.props.prefValues[I.kTabsThumbnails]&&d.vivExtData.thumbnail,stackSize:p.size,isInsideAccordion:A,isFirstInGroup:m,isLastInGroup:f,isExpectingDrop:this.props.isExpectingDrop,isSelecting:this.props.isSelecting,selectionCount:this.props.getSelectedPages().size,isStack:g,isSubstrip:this.props.isSubstrip,isInternalPage:(0,rl.to)(d.url),removeFromTabStack:this.removeFromTabStack,getDraggedPages:this.getDraggedPages,isSelected:this.checkSelected(d.id),checkSelected:this.checkSelected,isHiddenForDrag:C,isHidden:E,smallTab:t.style.width<=66,wideTab:t.style.width>=100,miniTab:t.style.width<=31,highlightId:o?d.id:void 0,direction:this.props.direction,prefValues:this.props.prefValues,tabPosition:this.props.tabPosition,addressBarVisible:this.props.addressBarVisible,highlighted:this.state.highlightedId===`tab-${t.key}`,forceHover:_,clearForceHover:this.clearForceHover,onMoveFocus:this.moveFocus,onStackMenu:this.openStackMenu,onLeaveBar:this.handleLeaveBar,setPageIdsHiddenForDrag:this.setPageIdsHiddenForDrag,closePage:this.closeAndFreeze,onActivate:this.props.onActivateTab,onDragLeave:this.onDragLeaveHandler,droppedTabHandler:this.droppedTabHandler,accordionFrameSize:M,handleTabPosition:N,shouldShowCloseButton:S,onCreateTab:this.props.onCreateTab,handleExpandAccordion:this.props.handleExpandAccordion,handleCompressAccordion:this.props.handleCompressAccordion,doMonitorAlarms:this.state.activeAlarms.has(y),shouldShowStackCounter:U,isDragging:this.state.isDragging,mediaState:k,dissolveTabStacks:this.props.dissolveTabStacks})))}if("space"===s.type){const e=this.getElementStyle(t.style.x,t.style.y,t.style.opacity,t.style.height,t.style.width,0,!1,h);return wve("div",{className:Fi()({"tab-position":this.props.isSubstrip||!this.#Xn,"tab-yield-space":this.props.isExpectingDrop&&(this.props.isSubstrip||!this.#Xn)}),style:e,onDragEnter:this.onDragEnterHandler,onDragLeave:this.onDragLeaveHandler,onDragOver:this.onDragOverHandler,onDrop:this.onDropHandler},t.key)}if("separator"===s.type){return wve("div",{className:"separator",style:this.getElementStyle(t.style.x,t.style.y,t.style.opacity,t.style.height,t.style.width,0,!1,0)},t.key,kve)}if("accordionToggle"===s.type){const{page:e}=s,n=(0,kv.av)(e),i=this.accordionIsOpen(n),o=i?c?"left":"up":c?"right":"down",a=this.getElementStyle(t.style.x,t.style.y,t.style.opacity,t.style.height,t.style.width,0,e.pinned,h);return wve(Yme,{orientation:o,isActive:e.active,style:a,onClick:()=>this.handleAccordionToggle(n,i),title:i?(0,B.Z)("Reduce Tab Stack"):(0,B.Z)("Expand Tab Stack")},t.key)}return"button"!==s.type||this.props.isSubstrip&&!this.props.isSubstripVisible?void 0:wve("div",{className:"toolbar toolbar-tabbar toolbar-large tab-position"},t.key,wve(Jme,{id:this.getNewTabButtonId(),style:this.getNewTabButtonStyle(t.style.x-h,this.props.isSubstrip&&"row"===this.props.direction?0:t.style.y,t.style.opacity,t.style.height,t.style.width,0),tabPosition:this.props.tabPosition,onCreateTab:this.props.onCreateTab,onMoveFocus:this.moveFocus,onLeaveBar:this.handleLeaveBar}))}}))})}),s&&(0,ss.jsxs)(ss.Fragment,{children:[wve("div",{onMouseEnter:this.setMouseIsOverScrollArrow,onMouseOut:this.setMouseIsNotOverScrollArrow,className:"toolbar toolbar-tabbar"},void 0,wve(po.ZP,{className:Fi()("horizontal-scroll-arrow",{disabled:!this.state.canScrollRight}),image:Wi.Zu.medium,onClick:this.scrollRight,menu:this.getOverflowMenu,menuOrigin:"top"===this.props.tabPosition?"bottomRight":"topRight",mimeType:p.Up,edgeAmount:0,tooltip:(0,B.Z)("Scroll right"),tooltipExtra:d})),this.#Kn&&wve("div",{className:"toolbar toolbar-tabbar"},void 0,wve(Jme,{id:this.getNewTabButtonId(),tabPosition:this.props.tabPosition,onCreateTab:this.props.onCreateTab,onMoveFocus:this.moveFocus,onLeaveBar:this.handleLeaveBar}),_ve)]}),wve("div",{className:Fi()("toolbar toolbar-tabbar",{"toolbar-large":this.props.isSubstrip,"subcontainer-lock":this.props.isSubstrip,"sync-and-trash-container":!this.props.isSubstrip,[this.props.tabPosition]:!0,narrow:!c&&!this.props.isSubstrip&&this.getTabStripWidth()<60})},void 0,!c&&this.#Kn&&wve(Jme,{id:this.props.isSubstrip?"newtab-sub":"newtab-main",tabPosition:this.props.tabPosition,onCreateTab:this.props.onCreateTab}),this.props.isSubstrip&&wve(po.ZP,{onClick:this.toggleSubstripLock,menuOrigin:"bottomLeft",className:t?"tabs-locked":"tabs-unlocked",tooltip:t?(0,B.Z)("Unlock second tab level"):(0,B.Z)("Lock second tab level"),label:t?(0,B.Z)("Unlock Stack"):(0,B.Z)("Lock Stack"),image:t?Wi.zlZ.small:Wi.KuK.small}),!this.props.isSubstrip&&!he.ZP.isIncognitoOrGuest(this.context.vivaldiWindowId)&&e&&wve(ufe,{tabPosition:this.props.tabPosition}),!this.props.isSubstrip&&wve(uve,{hidden:!this.props.showTrashCan,onMenuClosed:this.props.handleTrashMenuClosed}))]})}}const Pve=Nve;var Dve;function Mve(e,t,n,i){Dve||(Dve="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Dve,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function Ove({page:e,discarded:t,memoryUsage:n,isMemoryUsageEnabled:i}){const s=pn.jk.getDisplayTitle(e);return Mve("span",{className:"thumbnail-text"},void 0,Mve("strong",{className:"title"},void 0,s.length>245?s.substring(0,240)+"...":s),!pn.jk.isInternalUrl(e.url)&&(0,rl.C3)(e.url)&&Mve("span",{className:"url"},void 0,(0,ge.Z)(e.url)?.hostname),i&&Mve("span",{className:Fi()("info","size",{off:t})},void 0,Mve("span",{dangerouslySetInnerHTML:{__html:Wi.GqC}}),Kfe(n,t)))}const xve=Li.memo(Ove);var Lve,Rve=n(5531),Bve=n(34155);function Fve(e,t,n,i){Lve||(Lve="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Lve,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Wve=360,Uve=340,Vve=104,Hve=[I.kAddressBarInlineSearchEnabled,I.kAddressBarShowProgress,I.kAppearanceDensity,I.kHoverCardMemoryUsageEnabled,I.kKeyboardTabToAll,I.kMediaRouterMediaRemotingEnabled,I.kMouseWheelTabSwitch,I.kPanelsPosition,I.kTabsActiveMinSize,I.kTabsAlignNext,I.kTabsBarWidth,I.kTabsCloseButtonPermanent,I.kTabsClosePinned,I.kTabsClosePinnedInStack,I.kTabsCounterDetection,I.kTabsCycleByRecentOrder,I.kTabsDimHibernated,I.kTabsDoubleClick,I.kTabsBarHeight,I.kTabsMinimize,I.kTabsPageLoadInfo,I.kTabsNeverCloseLast,I.kTabsSelectionEnabled,I.kTabsBarSliderXpos,I.kTabsBarSliderYpos,I.kTabsHorizontalScrolling,I.kTabsShowCloseButton,I.kTabsShowSeparator,I.kTabsStackingAllowDnd,I.kTabsStackingAllowRename,I.kTabsStackingMode,I.kTabsShowTrashCan,I.kTabsShowSyncedTabsButton,I.kTabsStackingOpenAccordions,I.kTabsStackingSubstripLocked,I.kTabsThumbnails,I.kTabsTooltip,I.kTabsUnread,I.kTabsVisualSwitchEnable,I.kTabsVisible,I.kThemeUseAnimation,I.kTabsStackingPreferDotted,I.kTabsStackingAutoExpand,I.kTabsStackingDndDelay,I.kWorkspacesEnabled,I.kWorkspacesButtonShowInTabbar,I.kWorkspacesButtonShowName,I.kTabsNewPlacement],Gve=function(e,t,n,i){const s=(0,kv.av)(e)||"",o=s&&("substrip"===n||"accordion"===n)?Ce.ZP.getGroup(s,t).filter((e=>(0,kv.cm)(e)===i)).map(Ce.uU):(0,ze.aV)(),a="off"===n,r=Ce.ZP.getWorkspaceTabsInWindow(t,i,a);return{tabs:r,pages:Ce.ZP.getPages(t),activePageId:e.id,url:e.url,incognito:e.incognito,tilingId:(0,kv.jA)(e)??"",groupId:s,pinned:e.pinned,isSelecting:Ce.ZP.isSelecting(t),pageSelection:Ce.ZP.getSelection(t),stackTabs:o,pinnedWidth:$ve(r),workspaceId:i,mediaState:Gie.Z.getState()}};function $ve(e){const t=e.findIndex((e=>!e.page.pinned)),n=C.Z.get(I.kTabsStackingOpenAccordions),i="accordion"===C.Z.get(I.kTabsStackingMode),s=(0,Cs.mM)();let o=0;for(let a=0;a<t;a++){const t=e.get(a);if(!t)return o;o=o+("group"===t.type&&i&&n.includes(t.id)?t.pages.size:1)*(Ive+(s||1))+("group"===t.type&&i?16:0)}return o}var Kve=Fve("div",{className:"separator separator-wsbutton"},void 0,Fve("hr",{}));class zve extends Li.PureComponent{static contextType=ts.Z;#m;#Qn=!1;visibleOnMount=this.props.visible;refMainBar=Li.createRef();refTabBarContainer=Li.createRef();#qn=!1;constructor(e,t){super(e);const n=t.vivaldiWindowId,i=Ce.ZP.unsafeGetActivePage(n),s=Ce.ZP.getActiveWorkspace(n),o=this.props.prefValues[I.kTabsStackingOpenAccordions].map((e=>({groupId:e,auto:!1})));this.state={tabStripWidth:0,tabStripHeight:0,isResizing:!1,tabBarOverflow:!1,tabStripOverflow:!1,tabBarHeight:this.props.prefValues[I.kTabsBarHeight],tabBarWidth:this.props.prefValues[I.kTabsBarWidth],...Gve(i,n,e.prefValues[I.kTabsStackingMode],s),tabBarSliderYpos:this.props.prefValues[I.kTabsBarSliderYpos],tabBarSliderXpos:this.props.prefValues[I.kTabsBarSliderXpos],tabBarContainerWidth:0,isExpectingDrop:!1,openAccordions:o,isInternalDragging:!1,addressBarVisible:he.ZP.getVisibleUI(n).addressBar,showTrashCan:e.prefValues[I.kTabsShowTrashCan]}}componentDidUpdate(e,t){"top"!==this.props.tabPosition&&"bottom"!==this.props.tabPosition||!0!==this.props.prefValues[I.kTabsThumbnails]||!1!==e.prefValues[I.kTabsThumbnails]||this.setTabBarHeight(Ave),t.openAccordions!==this.state.openAccordions&&w.Z.set(I.kTabsStackingOpenAccordions,this.state.openAccordions.map((e=>e.groupId))),e.prefValues[I.kTabsStackingMode]===this.props.prefValues[I.kTabsStackingMode]&&e.prefValues[I.kAppearanceDensity]===this.props.prefValues[I.kAppearanceDensity]&&t.openAccordions===this.state.openAccordions||this._onPageStoreChange(),e.prefValues[I.kTabsShowTrashCan]!==this.props.prefValues[I.kTabsShowTrashCan]&&this.setState({showTrashCan:this.props.prefValues[I.kTabsShowTrashCan]})}componentDidMount(){const{selectWindow:e}=this.context;se.Z.utilities.onBroadcastMessage.addListener(this.onBroadcastMessageReceived),Ce.ZP.addListener(this._onPageStoreChange,e),Kme.addListener(this.onTabStoreChange),he.ZP.addListener(this.onWindowStoreChanged,e),Gie.Z.addListener(this._onMediaStateStoreChanged),Oa.Z.addListener("COMMAND_SAVE_SELECTED_SESSION",this._onCommandSpy),Oa.Z.addListener("COMMAND_BOOKMARK_SELECTED_TABS",this._onCommandSpy),Oa.Z.addListener("COMMAND_NEW_TAB",this._onCommandSpy),Oa.Z.addListener("COMMAND_SHOW_CLOSED_TABS",this._onCommandSpy),se.Z.tabsPrivate.onKeyboardChanged.addListener(this.handleKeyboardChange),this.updateDocumentTitleById(this.state.activePageId),this.#m=!0,this.context.addEventListener("resize",this.onWindowResize,!1),this.context.addEventListener("keydown",Ume.i,!1),this.cleanUpOpenAccordions(),0===this.state.tabs.size&&Bve.nextTick((()=>{this.createTab("keyboard")})),c.ZP.tryToUpdateTabResources(this.state.pages.map((e=>e.id)).toArray())}handleKeyboardChange=(e,t,n)=>{this.#Qn=0!==n};componentWillUnmount(){se.Z.utilities.onBroadcastMessage.removeListener(this.onBroadcastMessageReceived),Ce.ZP.removeListener(this._onPageStoreChange),Kme.removeListener(this.onTabStoreChange),he.ZP.removeListener(this.onWindowStoreChanged),Gie.Z.removeListener(this._onMediaStateStoreChanged),Oa.Z.removeListener("COMMAND_SAVE_SELECTED_SESSION",this._onCommandSpy),Oa.Z.removeListener("COMMAND_BOOKMARK_SELECTED_TABS",this._onCommandSpy),Oa.Z.removeListener("COMMAND_NEW_TAB",this._onCommandSpy),Oa.Z.removeListener("COMMAND_SHOW_CLOSED_TABS",this._onCommandSpy),se.Z.tabsPrivate.onKeyboardChanged.removeListener(this.handleKeyboardChange),this.#m=!1,this.context.removeEventListener("resize",this.onWindowResize,!1),this.context.removeEventListener("keydown",Ume.i,!1),clearTimeout(this._resizingTimeout)}getMinimumTabSize=()=>Ive+2*((0,Cs.mM)()>0?(0,Cs.mM)():1);updateDocumentTitleById=e=>{const t=Ce.ZP.getPageById(e);t&&this.updateDocumentTitle(t)};cleanUpOpenAccordions(){const e=this.state.pages.reduce(((e,t)=>{const n=(0,kv.av)(t);return n&&e.push(n),e}),[]),t=(0,Rve.Z)(this.state.openAccordions,"groupId").filter((t=>e.includes(t.groupId)));t.length!==this.state.openAccordions.length&&this.setState((e=>({openAccordions:t})))}updateDocumentTitle=e=>{const t=pn.jk.getDisplayTitle(e);t!==this.context.document.title&&(this.context.document.title=t)};onWindowResize=()=>{clearTimeout(this._resizingTimeout),this.setState({isResizing:!0}),this._resizingTimeout=setTimeout((()=>{this.setState({isResizing:!1})}),1e3)};setIsExpectingDrop=(e,t)=>{this.setState({isExpectingDrop:e},t)};closePage=async e=>{this.#qn=!0,await c.ZP.closePage(e),this.#qn=!1,await this._onPageStoreChange(),this.handleClosePageAccordion(e)};handleClosePageAccordion=e=>{if(this.#qn||this.props.prefValues[I.kTabsStackingAutoExpand]||"accordion"!==this.props.prefValues[I.kTabsStackingMode])return;const t=(0,c.nq)(e)?e:ze.aV.of(e);0!==t.size&&t.some((e=>{if(e.active){const t=(0,kv.av)(e);return t&&1===this.state.pages.count((e=>(0,kv.av)(e)===t))&&this.handleCompressAccordion(t),!0}}))};onBroadcastMessageReceived=e=>{e.startDragging?this.setIsExpectingDrop(!0):e.endDragging&&this.setIsExpectingDrop(!1,(()=>{this._onPageStoreChange()}))};_onMediaStateStoreChanged=()=>{this.setState({mediaState:Gie.Z.getState()})};setTabBarWidth=(e,t=!0)=>{this.setState({tabBarWidth:e},(()=>t&&w.Z.set(I.kTabsBarWidth,Math.round(e))))};setTabBarHeight=(e,t=!0)=>{this.setState({tabBarHeight:e},(()=>t&&w.Z.set(I.kTabsBarHeight,Math.round(e))))};setInnerTabBarWidth=(e,t=!0)=>{this.setState({tabBarSliderXpos:e},(()=>t&&w.Z.set(I.kTabsBarSliderXpos,Math.round(e))))};setInnerTabBarHeight=(e,t=!0)=>{this.setState({tabBarSliderYpos:e},(()=>t&&w.Z.set(I.kTabsBarSliderYpos,Math.round(e))))};_onPageStoreChange=()=>{if(this.#qn||this.state.isExpectingDrop)return;const e=this.context.vivaldiWindowId,t=Ce.ZP.unsafeGetActivePage(e),n=Ce.ZP.getActiveWorkspace(e);this.updateDocumentTitle(t),this.setState((i=>({...Gve(t,e,this.props.prefValues[I.kTabsStackingMode],n),openAccordions:this.updateAccordionStatus(i,t)})))};updateAccordionStatus=(e,t)=>{const n=t.id!==this.state.activePageId,i=(0,kv.av)(t);return!n&&i===this.state.groupId||!this.props.prefValues[I.kTabsStackingAutoExpand]||"accordion"!==this.props.prefValues[I.kTabsStackingMode]?e.openAccordions:(0,v.Uy)(e.openAccordions,(e=>{const t=e.findIndex((e=>e.auto));-1!==t&&e.splice(t,1),i&&!e.some((e=>e.groupId===i))&&e.push({groupId:i,auto:!0})}))};dissolveTabStacks=e=>{const t=this.context.vivaldiWindowId;(0,ze.l4)(e).forEach((e=>{c.ZP.expandTabStack(t,e),this.handleCompressAccordion(e)})),Bve.nextTick((()=>c.ZP.clearSelection(t)))};isSelecting=()=>this.props.prefValues[I.kTabsSelectionEnabled]&&this.state.isSelecting&&!this.state.pageSelection.isEmpty();getSelectedPages=()=>{if(!this.isSelecting())return(0,ze.aV)();const e=Ce.ZP.getPages(this.context.vivaldiWindowId,{workspaceId:this.state.workspaceId});return this.state.pageSelection.reduce(((t,n)=>{const i=e.find((e=>e.id===n));return i?t.push(i):t}),(0,ze.aV)()).sortBy((e=>e.index))};_onCommandSpy=(e,t)=>{if(e===this.context.vivaldiWindowId)switch(t){case"COMMAND_BOOKMARK_SELECTED_TABS":{const e=g.Z.getRootId();void 0!==e&&ee.Z.bookmarkPages(this.getSelectedPages(),!1,e);break}case"COMMAND_SAVE_SELECTED_SESSION":const t=this.getSelectedPages().map((e=>e.id)).toArray();t.length>0&&de.Z.showSaveSessionDialog(e,{mode:"ids",ids:t});break;case"COMMAND_NEW_TAB":this.createTab("keyboard");break;case"COMMAND_SHOW_CLOSED_TABS":this.setState({showTrashCan:!0})}};onTabStoreChange=e=>{if(e.winId!==this.context.vivaldiWindowId)return;const t=this.context.vivaldiWindowId;switch(e.action){case"switchTabBackBySetting":this.switchBackBySetting(e.event);break;case"switchTabForwardBySetting":this.switchForwardBySetting(e.event);break;case"viewPageSource":this.state.url.startsWith("view-source:")||Bve.nextTick((()=>c.ZP.openURL(e.winId,`view-source:${this.state.url}`,{incognito:this.state.incognito})));break;case"disbandTileGroup":Bve.nextTick((()=>{this.isSelecting()?this.getSelectedPages().map((e=>e.vivExtData.tiling?.id)).filter(Boolean).toSet().forEach((e=>c.ZP.untileTileGroup(t,e))):Bve.nextTick((()=>c.ZP.untileTileGroup(t,this.state.tilingId)))}));break;case"stackCreate":Bve.nextTick((async()=>{await c.ZP.createStackFromActiveTab(t)}));break;case"stackDissolve":if(Ce.ZP.isSelecting(t)){const e=Ce.ZP.getSelectedPages(t).map(kv.av).filter(Boolean).toArray();this.dissolveTabStacks(e)}else this.dissolveTabStacks([this.state.groupId]);break;case"stackRemove":Bve.nextTick((()=>this.removeFromTabStack(this.state.pageSelection)));break;case"stackTileGrid":case"stackTileHorizontal":case"stackTileVertical":const n="stackTileGrid"===e.action?"grid":"stackTileHorizontal"===e.action?"column":"row";Bve.nextTick((()=>{this.isSelecting()?c.ZP.tilePages(this.getSelectedPages(),n):this.state.groupId?c.ZP.tileTabStack(t,this.state.groupId,n):c.ZP.tileLastActive(t,n)}));break;case"tabThumbnail":this.switchTabViewAndEnablePreview();break;case"unloadDialogClosed":this.#qn=!1,this._onPageStoreChange()}};onWindowStoreChanged=()=>{const e=this.context.vivaldiWindowId,t=he.ZP.getVisibleUI(e).addressBar;this.setState({addressBarVisible:t})};onActivateTab=e=>{if(Ume.i(),e.active)c.ZP.clearSelection(this.context.vivaldiWindowId);else{const t="dotted"===this.props.prefValues[I.kTabsStackingMode];c.ZP.activateTab(e.id,this.context.vivaldiWindowId,t)}};createTab=async(e,t)=>{const n=this.context.vivaldiWindowId;if(t){const e=Ce.ZP.getGroup(t,n).first(),i=e&&(0,kv.XN)(e);return void c.ZP.openURL(n,"",{groupId:t,fixedGroupTitle:i})}const i=this.props.prefValues[I.kTabsStackingMode],s=Ce.ZP.getPageById(this.state.activePageId),o=s&&(0,kv.av)(s),a=s&&(0,kv.XN)(s);if("dotted"!==i&&"accordion"!==i)if("substrip"!==i)c.ZP.openURL(n,"");else{const t=this.props.prefValues[I.kTabsStackingSubstripLocked]||this.state.stackTabs.size>1;if("mainStrip"===e||!t)return void c.ZP.openURL(n,"");if(o)c.ZP.openURL(n,"",{groupId:o,fixedGroupTitle:a});else{const e=Ce.ZP.unsafeGetActivePage(n),t=await c.ZP.createTabStack((0,ze.aV)([e]),e.index);c.ZP.openURL(n,"",{groupId:t})}}else o&&"keyboard"===e&&Ce.ZP.isGroup(o,n)?c.ZP.openURL(n,"",{groupId:o,fixedGroupTitle:a}):c.ZP.openURL(n,"")};onCreateTab=e=>this.createTab("mainStrip",e);onCreateGroupTab=e=>this.createTab("subStrip",e);removeFromTabStack=e=>{if(this.isSelecting()){const e=this.getSelectedPages();e.isEmpty()||c.ZP.removeFromTabStack(e)}else{const e=Ce.ZP.getActivePage(this.context.vivaldiWindowId);e&&c.ZP.removeFromTabStack(e)}};muteTab=(e,t,n)=>{n&&n.stopPropagation(),c.ZP.toggleMuting(e,ze.aV.of(t))};closeSingleTab=(e,t)=>{t?.stopPropagation?.(),c.ZP.closePage(e)};switchBackBySetting=e=>{this.props.prefValues[I.kTabsVisualSwitchEnable]?this.props.switchTabVisualTabSwitcher(e,!1,this.#Qn):this.props.prefValues[I.kTabsCycleByRecentOrder]?Bve.nextTick((()=>c.ZP.cycleByHistory(this.context.vivaldiWindowId,e,{goBack:!0}))):Bve.nextTick((()=>c.ZP.cycleByOrder(this.context.vivaldiWindowId,e,{goBack:!0})))};switchForwardBySetting=e=>{this.props.prefValues[I.kTabsVisualSwitchEnable]?this.props.switchTabVisualTabSwitcher(e,!0,this.#Qn):this.props.prefValues[I.kTabsCycleByRecentOrder]?Bve.nextTick((()=>c.ZP.cycleByHistory(this.context.vivaldiWindowId,e,{goBack:!1}))):Bve.nextTick((()=>c.ZP.cycleByOrder(this.context.vivaldiWindowId,e,{goBack:!1})))};switchTabViewAndEnablePreview=()=>{const e=this.props.prefValues[I.kTabsThumbnails],t=this.props.tabPosition,n="left"===t||"right"===t;if(e)n?w.Z.set(I.kTabsThumbnails,!1):this.switchTabView();else{w.Z.set(I.kTabsThumbnails,!0);const e=this.getMinimumTabSize();n&&this.state.tabBarWidth===e&&this.switchTabView()}};switchTabView=()=>{const e=this.props.tabPosition,t=this.getMinimumTabSize(),{tabBarWidth:n,tabBarHeight:i}=this.state;if("top"===e||"bottom"===e){const e=i<75?Ave:Ive;this.setTabBarHeight(e)}else{const e=n!==Cve?Cve:t;this.setTabBarWidth(e)}};onSlidebarPosition=(0,aC.Z)(((e,t)=>{const n=this.refTabBarContainer.current,{Element:i}=this.context;if(!(n instanceof i))return;const s=n.getBoundingClientRect();switch(this.props.tabPosition){case"top":this.setTabBarHeight(Math.max(t-s.top,Ive),!1);break;case"bottom":this.setTabBarHeight(Math.max(s.bottom-t,Ive),!1);break;case"left":this.setTabBarWidth(Math.min(e-s.left,Wve),!1);break;case"right":this.setTabBarWidth(Math.min(s.right-e,Wve),!1);break;default:throw new Error("Unknown tabbar position")}}),64);handleSliderDown=()=>{this.setState({isResizing:!0})};handleSliderUp=()=>{this.setState({isResizing:!1}),"top"===this.props.tabPosition||"bottom"===this.props.tabPosition?this.snapToEdge():w.Z.set(I.kTabsBarWidth,Math.round(this.state.tabBarWidth))};onInnerSlidebarPosition=(0,aC.Z)(((e,t)=>{const{HTMLElement:n}=this.context,i=this.refMainBar.current?.querySelector(".resize");if(!(i instanceof n))return;const s=i.getBoundingClientRect(),o=this.getMinimumTabSize(),a=((0,Cs.mM)()?0:1)+Ive,{tabBarWidth:r,tabBarHeight:l}=this.state;let d=0,c=0;switch(this.props.tabPosition){case"top":c=t-s.top,c>l-o&&this.setTabBarHeight(c+o,!1),this.setInnerTabBarHeight((0,Gw.Z)(c,a,Ave-a),!1);break;case"bottom":c=s.bottom-t,c>l-o&&this.setTabBarHeight(c+o,!1),this.setInnerTabBarHeight((0,Gw.Z)(c,a,Ave-a),!1);break;case"left":d=e-s.left,d+o>r&&d+o<=Wve&&this.setTabBarWidth(d+o,!1),this.setInnerTabBarWidth((0,Gw.Z)(d,o,Wve-o),!1);break;case"right":d=s.right-e,d+o>r&&d+o<=Wve&&this.setTabBarWidth(d+o,!1),this.setInnerTabBarWidth((0,Gw.Z)(d,o,Wve-o),!1);break;default:throw new Error("Unknown tabbar position")}}),64);handleInnerSliderDown=()=>{this.setState({isResizing:!0})};handleInnerSliderUp=()=>{this.setState({isResizing:!1}),"top"===this.props.tabPosition||"bottom"===this.props.tabPosition?(w.Z.set(I.kTabsBarSliderYpos,Math.round(this.state.tabBarSliderYpos)),this.snapToEdge()):this.setInnerTabBarWidth(this.state.tabBarSliderXpos)};switchInnerTabView=()=>{const{tabBarWidth:e,tabBarHeight:t,tabBarSliderXpos:n,tabBarSliderYpos:i}=this.state,s=this.props.tabPosition,o=this.getMinimumTabSize();if("top"===s||"bottom"===s)if(t<=2*o)this.setInnerTabBarHeight(Ave),this.setTabBarHeight(Ave+o);else{const e=75!==i?75:Ive;this.setInnerTabBarHeight(e)}else if(e<=2*o)this.setInnerTabBarWidth(Cve),this.setTabBarWidth(Cve+o);else{const t=n!==e/2?e/2:o;this.setInnerTabBarWidth(t)}};snapToEdge=()=>{const e=this.refTabBarContainer.current,{HTMLElement:t}=this.context;if(!(e instanceof t))return;let n=parseInt(e.style.height);const i=this.getMinimumTabSize(),s=this.isSubstripVisible(),o=(0,Cs.mM)(),a=s?2*i-2*o:Ive;n>a&&n<a+20?n=a:n<Ave&&n>130&&(n=Ave),this.setTabBarHeight(n)};getTabStackThumbnailsContextMenu=(e,t)=>{const n=this.context.vivaldiWindowId,i=ji.Z.getOptionFunction(e);return ji.Z.getNamedMenu(n,e,(e=>{switch(e.action){case"CONTEXT_CLOSE":return Promise.resolve({handler:()=>this.closeSingleTab(t),...i(n,e,{})});case"CONTEXT_TABSTACK_REMOVE_FROM":return Promise.resolve({handler:()=>this.removeFromTabStack(this.state.pageSelection),...i(n,e,{})});default:return Promise.resolve({...i(n,e,{})})}}))};getTabBarContextMenu=(e,t)=>{const{prefValues:n}=this.props,i=he.ZP.isGuest(),s=ji.Z.getOptionFunction(e),o=this.context.vivaldiWindowId;return ji.Z.getNamedMenu(o,e,(async e=>{switch(e.action){case"CONTEXT_NEW":return{handler:()=>this.createTab(t?"subStrip":"mainStrip"),...s(o,e,{})};case"CONTEXT_TOGGLE_SUBSTRIP_LOCK":{const t=n[I.kTabsStackingSubstripLocked];return{handler:()=>w.Z.set(I.kTabsStackingSubstripLocked,!t),isVisible:()=>"substrip"===n[I.kTabsStackingMode],checked:t,...s(o,e,{})}}case"CONTEXT_BOOKMARK_ALL":return{handler:()=>{const e=g.Z.getRootId();void 0!==e&&ee.Z.bookmarkAllOpenPages(this.context.vivaldiWindowId,e)},isVisible:()=>!i,...s(o,e,{})};case"CONTEXT_SAVE_SESSION":return{isVisible:()=>!i,...s(o,e,{})};case"CONTEXT_REOPEN":return{isVisible:()=>Boolean(cge.Z.getTrash().length),...s(o,e,{})};default:return{...s(o,e,{})}}}))};onAuxClick=(e,t)=>{e.button===es.Z.kCenter&&this.createTab(t?"subStrip":"mainStrip"),e.preventDefault()};onDoubleClick=(e,t)=>{e.button===es.Z.kLeft&&"top"!==this.props.tabPosition&&this.createTab(t?"subStrip":"mainStrip")};getTooltipPlacement=()=>({top:"below",bottom:"above",left:"after",right:"before"}[this.props.tabPosition]);getTooltipMediaState=e=>this.state.mediaState.get(e)||(0,ze.l4)();getTooltipContent=(e,t,n,i)=>{const s=Ce.ZP.getPageById(e);if(!s)return{width:0,height:0,content:null};const{prefValues:o}=this.props;let a,r;const l=(0,Yie.xz)(s)&&!t;if("off"!==o[I.kTabsStackingMode]&&l){const e=(0,kv.av)(s);a=Ce.ZP.getGroup(e,this.context.vivaldiWindowId),r=e?Ce.ZP.getGroupHighlightId(e,this.context.vivaldiWindowId):null}else a=ze.aV.of(s),r=null;const d=(0,kv.cm)(s);a=a.filter((e=>(0,kv.cm)(e)===d));const c=!l&&(0,Yie.ZN)(s),u=l?Fve("div",{className:"tab-group"},void 0,a.map((e=>Fve("div",{className:Fi()({"tooltip-item":!0,active:e.active,"last-active":r&&r===e.id}),onMouseDown:t=>Zfe(this.context,[e],t),onContextMenu:t=>this.onTabStackTooltipContextMenu(e,t),onClick:()=>this.onActivateTab(e),onAuxClick:t=>{t.button===es.Z.kCenter&&(t.preventDefault(),t.stopPropagation(),this.closeSingleTab(e))}},e.id,Fve(w3,{src:e.vivExtData.thumbnail??"",pageId:e.id}),Fve("div",{className:"thumbnail-caption"},void 0,Fve(xve,{page:e,discarded:e.discarded,memoryUsage:e.memoryUsage,isMemoryUsageEnabled:o[I.kHoverCardMemoryUsageEnabled]}),Fve("span",{className:"thumbnail-buttons"},void 0,Fve(Ri.ZP,{className:"favicon",url:pn.jk.getFavicon(e.url)??e.url,loadType:pn.jk.getFavicon(e.url)?"faviconFromCache":"page"}),Fve("button",{className:"close",dangerouslySetInnerHTML:{__html:Wi.kze},tabIndex:o[I.kKeyboardTabToAll],onClick:t=>this.closeSingleTab(e,t)}),Fve(Gme,{page:e,color:this.props.theme.colorFg,tabIndex:this.props.prefValues[I.kKeyboardTabToAll],animated:o[I.kThemeUseAnimation],mediaState:this.getTooltipMediaState(e.id)}))))))):Fve("div",{className:"tab-solo"},void 0,Fve("div",{className:Fi()({"tooltip-item":!0,active:s.active})},"tabbar_tooltip",!c&&Fve(w3,{src:s.vivExtData.thumbnail??"",pageId:s.id}),Fve("div",{className:"thumbnail-caption"},void 0,Fve(xve,{page:s,discarded:n,memoryUsage:i,isMemoryUsageEnabled:o[I.kHoverCardMemoryUsageEnabled]}),Fve("span",{className:"thumbnail-buttons"},void 0,Fve(Gme,{page:s,color:this.props.theme.colorFg,tabIndex:this.props.prefValues[I.kKeyboardTabToAll],animated:o[I.kThemeUseAnimation],mediaState:this.getTooltipMediaState(s.id)}))))),p=c?Ive:282,h=this.context.innerWidth-("left"===this.props.tabPosition||"right"===this.props.tabPosition?this.getWidth():0),g=this.context.innerHeight-("top"===this.props.tabPosition||"bottom"===this.props.tabPosition?this.getHeight():0);if(!l)return{width:222,height:p,content:u};let m=Uve,f=a.count()*Vve;if(f>g){const e=Math.floor(g/Vve),t=Math.ceil(a.count()/e);m=Uve*t,f=Math.ceil(a.count()/t)*Vve}return{width:Math.min(m,Math.floor(h/Uve)*Uve),height:Math.min(f,Math.floor(g/Vve)*Vve),content:u}};getTabDirection=()=>{const e=this.props.tabPosition;return"left"===e||"right"===e?"column":"row"};setOverflowClass=(e,t)=>{t?this.setState({tabStripOverflow:e}):this.setState({tabBarOverflow:e})};onResize=([e])=>{if(!this.#m)return;const t=e.target;this.setState((e=>({tabStripWidth:t.clientWidth,tabStripHeight:t.clientHeight,tabBarContainerWidth:t.parentElement?.clientWidth})))};isSubstripVisible(){const{prefValues:e,visible:t}=this.props;return t&&!this.state.isInternalDragging&&"substrip"===e[I.kTabsStackingMode]&&(e[I.kTabsStackingSubstripLocked]||this.state.stackTabs.size>1)}setIsInternalDragging=e=>{this.setState({isInternalDragging:e})};getWidth=()=>{if(!this.props.visible)return 0;const e=this.getMinimumTabSize(),t=(0,Cs.np)(),{tabBarWidth:n}=this.state,i=e*(this.isSubstripVisible()?2:1)+(this.state.tabBarOverflow?t:0)+(this.state.tabStripOverflow?t:0),s=(0,Gw.Z)(n,i,360);return Math.round(s)};getHeight=()=>{if(!this.props.visible)return 0;const{tabBarHeight:e}=this.state,t=(0,Cs.mM)(),n=t?0:1,i=this.isSubstripVisible()?60+(t?3*t:3):Ive+n;if(!this.props.prefValues[I.kTabsThumbnails])return i;const s=Ave+n,o=(0,Gw.Z)(e,i,s);return Math.round(o)};showSubStack=e=>{const t=Ce.ZP.getPageById(e);if(!t)return;const n=(0,kv.av)(t);if(n){const e=Ce.ZP.getGroup(n,this.context.vivaldiWindowId).map(Ce.uU);this.setState({stackTabs:e})}else{if(1===this.state.stackTabs.size&&this.state.stackTabs.first().id===t.id)return;const e=ze.aV.of({type:"tab",page:t,id:t.id});this.setState({stackTabs:e})}};onContextMenu=(e,t)=>{e.persist(),e.preventDefault(),e.stopPropagation(),this.getTabBarContextMenu("tabbar",t).then((t=>{(0,cs.Z)(this.context,t)(e)}))};onTabStackTooltipContextMenu=(e,t)=>{t.persist(),t.preventDefault(),t.stopPropagation(),this.getTabStackThumbnailsContextMenu("tabstackthumbnails",e).then((e=>{(0,cs.Z)(this.context,e)(t)}))};handleExpandAccordion=e=>{this.setState((t=>({openAccordions:t.openAccordions.concat({groupId:e,auto:!1})})))};handleCompressAccordion=e=>{this.setState((t=>({openAccordions:t.openAccordions.filter((t=>t.groupId!==e&&!1===t.auto))})))};handleTrashMenuClosed=()=>{const e=this.props.prefValues[I.kTabsShowTrashCan];e!==this.state.showTrashCan&&this.setState({showTrashCan:e})};toggleAutoExpandAccordion=e=>{e&&this.setState((t=>{const n=t.openAccordions.find((t=>t.groupId===e)),i=!!n&&!n.auto;return{openAccordions:t.openAccordions.filter((t=>t.groupId!==e)).concat({groupId:e,auto:i})}}))};render(){const e=this.props.prefValues,t=this.getTabDirection(),n=this.getMinimumTabSize(),i="row"===t,s="column"===t,o=this.state.tabStripHeight,a=s?Math.max(this.state.tabBarWidth-this.state.tabStripWidth,Tve):this.state.tabBarContainerWidth-Tve,r=(0,Cs.np)(),l=s||i&&e[I.kTabsThumbnails],d=this.props.prefValues[I.kTabsStackingSubstripLocked],c=this.isSubstripVisible(),u=d&&this.state.stackTabs.isEmpty()?ze.aV.of({type:"tab",page:Ce.ZP.unsafeGetActivePage(this.context.vivaldiWindowId),id:this.state.activePageId}):this.state.stackTabs,p=this.state.tabBarOverflow?r:0,h=c?s?Math.max(this.getWidth()-this.state.tabBarSliderXpos-p,n):Math.max(this.getHeight()-this.state.tabBarSliderYpos-(0,Cs.mM)(),n||1):0,g=e[I.kWorkspacesEnabled]&&e[I.kWorkspacesButtonShowInTabbar],m=i?{height:this.getHeight()}:{width:this.getWidth(),height:"100%"};return Fve("div",{className:"tabbar-wrapper",inert:this.props.inert?"inert":null},void 0,g&&s&&this.props.visible&&Fve(_ae,{name:"WorkspaceButton",size:"large",popupPosition:"below",inTabbar:!0,maxWidth:this.getWidth()}),(0,ss.jsxs)("div",{id:"tabs-tabbar-container",ref:this.refTabBarContainer,style:m,className:Fi()({[this.props.visible?this.props.tabPosition:"none"]:!0,resizing:this.state.isResizing,accordion:"accordion"===e[I.kTabsStackingMode],dotted:"dotted"===e[I.kTabsStackingMode]||e[I.kTabsStackingPreferDotted]}),children:[g&&s&&Kve,(0,ss.jsxs)("div",{id:"tabs-container",role:"toolbar","aria-labelledby":"tabbar-toplevel-label","aria-orientation":i?"horizontal":"vertical",ref:this.refMainBar,onAuxClick:e=>this.onAuxClick(e,!1),onDoubleClick:e=>this.onDoubleClick(e,!1),className:Fi()({[this.props.visible?this.props.tabPosition:"none"]:!0}),children:[Fve("span",{hidden:!0,id:"tabbar-toplevel-label"},void 0,(0,B.Z)("toolbar label","Tabs")),g&&i&&Fve(_ae,{name:"WorkspaceButton",size:"medium",popupPosition:"bottom"===this.props.tabPosition?"above":"below",inTabbar:!0}),Fve(Yi.Z,{className:"resize",onResize:this.onResize},void 0,Fve(Pve,{overflow:this.state.tabBarOverflow,isSubstrip:!1,isSubstripVisible:c,maxWidth:this.state.tabStripWidth-(s?0:Tve),maxHeight:s?o-64:o,direction:t,onActivateTab:this.onActivateTab,getTooltipContent:this.getTooltipContent,setOverflowClass:this.setOverflowClass,prefValues:e,tabPosition:this.props.tabPosition,isSelecting:this.isSelecting(),isResizing:this.state.isResizing,getSelectedPages:this.getSelectedPages,pages:this.state.pages,tabs:this.state.tabs,switchByScroll:e[I.kMouseWheelTabSwitch],onCreateTab:this.onCreateTab,showSubStack:this.showSubStack,isExpectingDrop:this.state.isExpectingDrop,onContextMenu:this.onContextMenu,setIsExpectingDrop:this.setIsExpectingDrop,activeGroupId:this.state.groupId,openAccordions:this.state.openAccordions,handleExpandAccordion:this.handleExpandAccordion,handleCompressAccordion:this.handleCompressAccordion,toggleAutoExpandAccordion:this.toggleAutoExpandAccordion,closePage:this.closePage,theme:this.props.theme,pinnedWidth:this.state.pinnedWidth,setIsInternalDragging:this.setIsInternalDragging,addressBarVisible:this.state.addressBarVisible,mediaState:this.state.mediaState,dissolveTabStacks:this.dissolveTabStacks,showTrashCan:this.state.showTrashCan,handleTrashMenuClosed:this.handleTrashMenuClosed})),l&&c&&Fve(Zm.Z,{onSlidebarPosition:this.onInnerSlidebarPosition,onStart:this.handleInnerSliderDown,onStop:this.handleInnerSliderUp,onDoubleClick:this.switchInnerTabView,style:"top"===this.props.tabPosition?{top:o+4}:"bottom"===this.props.tabPosition?{bottom:o-4}:{},position:this.props.tabPosition})]}),c&&Fve("div",{id:"tabs-subcontainer",role:"toolbar","aria-labelledby":"tabbar-stack-label","aria-orientation":i?"horizontal":"vertical","aria-hidden":!c,onAuxClick:e=>this.onAuxClick(e,!0),onDoubleClick:e=>this.onDoubleClick(e,!0),className:Fi()({[this.props.visible?this.props.tabPosition:"none"]:!0,visible:c}),style:{flexGrow:0,flexShrink:0,flexBasis:h}},void 0,Fve("span",{hidden:!0,id:"tabbar-stack-label"},void 0,(0,B.Z)("toolbar label","Stacked Tabs")),Fve(Pve,{overflow:this.state.tabStripOverflow,isSubstrip:!0,isSubstripVisible:c,maxWidth:a,maxHeight:s?o-Tve:h,direction:t,onActivateTab:this.onActivateTab,getTooltipContent:this.getTooltipContent,setOverflowClass:this.setOverflowClass,prefValues:e,tabPosition:this.props.tabPosition,isSelecting:this.isSelecting(),isResizing:this.state.isResizing,getSelectedPages:this.getSelectedPages,pages:this.state.pages,tabs:u,switchByScroll:e[I.kMouseWheelTabSwitch],onCreateTab:this.onCreateGroupTab,isExpectingDrop:this.state.isExpectingDrop,onContextMenu:this.onContextMenu,setIsExpectingDrop:this.setIsExpectingDrop,activeGroupId:this.state.groupId,closePage:this.closePage,theme:this.props.theme,pinnedWidth:0,addressBarVisible:this.state.addressBarVisible,mediaState:this.state.mediaState,dissolveTabStacks:this.dissolveTabStacks,showTrashCan:!1,handleTrashMenuClosed:Lr.Z})),l&&Fve(Zm.Z,{onSlidebarPosition:this.onSlidebarPosition,onStart:this.handleSliderDown,onStop:this.handleSliderUp,onDoubleClick:this.switchTabView,offset:1,position:this.props.tabPosition})]}))}}const jve=(0,Bu.Z)(zve,Hve);var Yve;function Xve(e,t,n,i){Yve||(Yve="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Yve,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var Qve=Xve(qu,{});const qve=function(e){const t=Li.useContext(ts.Z),n=(0,Ya.Z)([I.kMenuDisplay]),[i,s]=Li.useState(""),[o,a]=Li.useState("");Li.useEffect((()=>{function e(){const e=Ce.ZP.getActivePage(t.vivaldiWindowId);e&&e.windowId===t.vivaldiWindowId&&(i===e.title&&o===e.url||(s(e.title),a(e.url)))}return he.ZP.isSettings(t.vivaldiWindowId)||Ce.ZP.addListener(e,t.selectWindow),()=>Ce.ZP.ensureRemovedListener(e)}),[i,o,t.selectWindow,t.vivaldiWindowId]);const r=!e.isPopupWindow&&"vivaldi"===n[I.kMenuDisplay];if(e.isHidden)return r?Xve(Kae,{keyAccess:e.keyAccess,isHidden:!0,inert:!0}):null;const l=pn.jk.getDisplayTitleByUrl(o,i)||"Vivaldi";return Xve("div",{id:"titlebar",className:"top"!==e.tabPosition?"tabless":null},void 0,r&&Xve(Kae,{keyAccess:e.keyAccess,isHidden:!1,inert:e.inert}),!e.native&&Qve,"top"!==e.tabPosition&&("vivaldi"===n[I.kMenuDisplay]||e.isPopupWindow||!1)&&Xve("div",{id:"pagetitle"},void 0,e.isPopupWindow&&Xve(Ri.ZP,{url:(0,Ri.rv)(o),loadType:"faviconSkipCache"}),Xve("span",{},void 0,l)))};var Jve,eye=n(34155);function tye(e,t,n,i){Jve||(Jve="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Jve,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const nye=()=>[],iye=["MailMsgArchiveRestore","MailMsgStatusUnread","MailMsgSpamRestore","MailMsgTrashRestore","MailRenderingMethodText","MailViewThreadingFlat","Stop","VersionInfo"];class sye extends Li.PureComponent{static contextType=ts.Z;state={open:!0,currentToolbar:this.props.toolbar,userCommands:C.Z.get(I.kChainedCommandsCommandList),confirmReset:!1,panelExtensions:[]};componentDidMount(){C.Z.addListener(I.kToolbarsPanel,this.onPrefChanged),eye.nextTick((()=>Hf.Z.refreshActiveMessage())),se.Z.extensionActionUtils.getToolbarExtensions((e=>{const t=e.filter((e=>e.enabled&&!!e.sidePanel));this.setState({panelExtensions:t})}))}componentWillUnmount(){C.Z.removeListener(I.kToolbarsPanel,this.onPrefChanged),eye.nextTick((()=>Hf.Z.refreshActiveMessage()))}changeCurrent=e=>{const{value:t}=e.currentTarget;this.setState({currentToolbar:t})};onClose=()=>tp.Z.stopEditing();onDragStart=(e,t)=>{e.dataTransfer.setData(Qae,t),e.dataTransfer.setData(Xae,"toolbar-editor")};onConfirmReset=()=>this.setState({confirmReset:!0});onReset=e=>{if(e){const e=Qf.ww.find((e=>e.pref===this.state.currentToolbar));if(!e)return;(0,Qf.Np)(this.context.vivaldiWindowId,e.pref),w.Z.reset(e.pref)}this.setState({confirmReset:!1})};onPrefChanged=()=>{this.state.currentToolbar===I.kToolbarsPanel&&this.forceUpdate()};onEditChains=()=>{de.Z.showSettings(this.context.vivaldiWindowId,"qc"),this.onClose()};canRender=e=>e.filter((e=>!Qf.e3.includes(e.id)));appendDynamicContent=(e,t)=>{if("panel"===e){const e=C.Z.get(I.kToolbarsPanel).filter((e=>Ju.ZP.isWebPanel(e)&&!vr.Z.isExtPanel(e))),n=this.state.panelExtensions.map((e=>({id:vr.Z.getExtPanelIdFromExtensionId(e.id),label:e.name})),[]),i=e.map((e=>{const t=Yn.ZP.getWebPanels(this.context.vivaldiWindowId).find((t=>t.id===e));if(t)return{id:e,label:t.url};{const t=C.Z.getDefault(I.kPanelsWebElements).find((t=>t.id===e));if(t)return{id:e,label:t.url}}})).concat(n).filter(Boolean),s=t.findIndex((e=>"PanelWeb"===e.id));return-1!==s?t.slice(0,s).concat(i).concat(t.slice(s)):t.concat(i)}return t};render(){const e=C.Z.get(I.kMailIsTurnedOff)||!he.ZP.isMail(this.context.vivaldiWindowId),t=Qf.ww.filter((t=>e?!t.category.includes("mail"):t)).map((e=>({category:e.category,label:e.label,pref:e.pref}))),n="chains"!==this.state.currentToolbar?Qf.ww.find((e=>e.pref===this.state.currentToolbar)):void 0;return tye(ra.Z,{ignoreClickOutside:!0,onRequestClose:this.onClose,className:"toolbar-editor",labelledBy:ra.t},void 0,tye("header",{className:"dialog-header"},void 0,this.state.confirmReset&&tye(FT,{title:(0,B.Z)("Reset $1",[n?.label??""]),prompt:[(0,B.Z)("$1 will be reset to default layout.",[n?.label??""])],positive:(0,B.Z)("Reset"),negative:(0,B.Z)("Cancel"),onClose:this.onReset,danger:!0}),tye("h1",{},void 0,tye("span",{id:ra.t},void 0,(0,B.Z)("Toolbar Editor")),tye(B_,{position:"bottom",label:tye("div",{},void 0,tye("p",{},void 0,(0,B.Z)("You can always rearrange toolbar components by dragging them while pressing the $1 key.",["Ctrl"])),!1)})),tye("p",{className:"balanced"},void 0,(0,B.Z)("Choose a set of toolbar buttons, or your Command Chains. Drag buttons to toolbars, rearrange, or remove them from toolbar by dropping them on the background area.")),tye(ta.Z,{defaultValue:this.state.currentToolbar,onChange:this.changeCurrent},void 0,t.map((e=>{const{pref:t,label:n}=e;return tye("option",{value:t},t,n)})),tye("option",{value:"chains"},void 0,(0,B.Z)("Command Chains")))),tye("section",{className:"dialog-content toolbar-large"},void 0,n&&this.appendDynamicContent(n.category,this.canRender(n.buttons)).filter((e=>!iye.includes(e.id))).map(((e,t)=>tye("div",{className:"draggable-button"},t,tye(Nae,{index:t,name:e.id,label:e.label,menuOrigin:"pointer",popupPosition:"below",size:"large",onDragStart:e=>this.onDragStart(e,t),onDragEnd:Lr.Z,onDrop:Lr.Z,onDragEnter:Lr.Z,customizeMenu:nye,mimeType:po.f2,preview:!0,inEditor:!0,draggable:!0,isMailWindow:!0},t),tye("span",{},void 0,e.label)))),"chains"===this.state.currentToolbar&&this.state.userCommands.map(((e,t)=>tye("div",{className:"draggable-button"},t,tye(Nae,{index:t,name:e.name,label:e.label,size:"large",onDragStart:e=>this.onDragStart(e,t),onDragEnd:Lr.Z,onDrop:Lr.Z,onDragEnter:Lr.Z,customizeMenu:nye,menuOrigin:"pointer",popupPosition:"below",mimeType:po.f2,preview:!0,inEditor:!0,draggable:!0,isMailWindow:!0},e.key),e.label)))),"chains"!==this.state.currentToolbar&&(0,ss.jsxs)(ss.Fragment,{children:[tye("h3",{},void 0,(0,B.Z)("Default Toolbar Preview")),tye("section",{className:"dialog-preview"},void 0,n?.pref&&tye("span",{className:"default-toolbar"},void 0,tye(tre,{name:n.pref,label:(0,B.Z)("toolbar label","Preview"),showDefaultSet:!0,menuOrigin:"pointer",popupPosition:"below",size:"large"},n.pref)))]}),tye("div",{className:"dialog-footer"},void 0,"chains"===this.state.currentToolbar?tye("input",{type:"button",value:(0,B.Z)("Manage Command Chains"),onClick:this.onEditChains}):tye("input",{type:"button",className:"ignore-react-onclickoutside",value:(0,B.Z)("Reset $1 to Default",[n?.label??""]),onClick:this.onConfirmReset}),tye("input",{type:"button",className:"primary",value:(0,B.Z)("process","Done"),onClick:this.onClose})))}}var oye;function aye(e,t,n,i){oye||(oye="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:oye,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class rye extends Li.PureComponent{componentDidMount(){this._handleShortcutChange(this.props.shortcut.shortcut,!0)}componentWillUnmount(){this._handleShortcutChange(this.props.shortcut.shortcut,!1)}componentDidUpdate(e){this.props.shortcut!==e.shortcut&&(this._handleShortcutChange(e.shortcut.shortcut,!1),this._handleShortcutChange(this.props.shortcut.shortcut,!0))}_handleShortcutChange=(e,t)=>{e&&(t?Ke.Z.bind(e,this._handleMenuShortcut):Ke.Z.unbind(e,this._handleMenuShortcut))};_getDisplayName=()=>{const e=Qe.Z.getMenuBarString(this.props.item,this.props.shortcut);if(this.props.underlineAccessKeys&&-1!==e.offset){const t=e.offset;return aye("span",{},void 0,t>0?e.name.substring(0,t):"",aye("span",{className:"underlined"},void 0,e.name.substring(t,t+1)),e.name.substring(t+1))}return aye("span",{},void 0,e.name)};_handleMenuShortcut=()=>{this.props.onItemActivated(this.props.id)};_handleKeyDown=e=>{const{ctrlKey:t,altKey:n,shiftKey:i,metaKey:s}=e,o={ctrlKey:t,altKey:n,shiftKey:i,metaKey:s};switch(e.key){case"ArrowUp":case"ArrowDown":case"Enter":case" ":this.props.onItemActivated(this.props.id);break;case"ArrowLeft":this.props.moveFocus(this.props.id,"left",!1);break;case"ArrowRight":this.props.moveFocus(this.props.id,"right",!1);break;case"Escape":if(-1!==this.props.openMenuId)return;this.props.onLeaveBar();break;default:if((0,As.VV)(o)&&this.props.onAccessKey(e.key))break;return}e.preventDefault(),e.stopPropagation()};_handleMouseDown=e=>{e.button===es.Z.kLeft&&es.Z.isNoModifierPressed(e)&&this.props.onItemActivated(this.props.id),e.preventDefault(),e.stopPropagation()};_handleMouseEnter=e=>{this.props.onItemEnter(this.props.id)};_handleMouseLeave=e=>{this.props.onItemLeave(this.props.id)};_handleBlur=()=>{this.props.onItemBlur(this.props.id)};_handleFocus=()=>{this.props.highlighted||this.props.onItemHighlightMissing(this.props.id)};render(){return aye("button",{"data-id":this.props.id,"data-offset":0,tabIndex:this.props.keyAccess,className:Fi()({menubarItem:!0,uifocusstop:0===this.props.id,highlighted:this.props.highlighted,menubar:!0}),onBlur:this._handleBlur,onFocus:this._handleFocus,onKeyDown:this._handleKeyDown,onMouseEnter:this._handleMouseEnter,onMouseLeave:this._handleMouseLeave,onMouseDown:this._handleMouseDown,roles:"menuitem","aria-label":this.props.item.label,"aria-haspopup":"menu","aria-expanded":this.props.id===this.props.openMenuId},void 0,this._getDisplayName())}}const lye=rye;var dye,cye=n(34155);function uye(e,t,n,i){dye||(dye="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:dye,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const pye="menubar";class hye extends Li.PureComponent{static contextType=ts.Z;nodeRef=Li.createRef();acceptEnterId=-1;timer=null;hasMenu=!1;#m=!1;constructor(e,t){super(e),this.hasMenu=Ge.Z.isNamedMenuAvailable(pye);const n=this._getMenuItems(t.vivaldiWindowId,!1);this.state={items:n,shortcuts:Qe.Z.getShortcutsForSubMenus(n),openMenuId:-1,highlightedId:-1,underlineAccessKeys:!1}}componentDidMount(){C.Z.addListener([I.kKeyboardShortcutsAltOpensMenu,I.kMailIsTurnedOff],this._onPrefsChange),Ge.Z.addListener(this._onCommandStoreChange),this._requestMenu(),this.#m=!0}componentWillUnmount(){this.timer&&clearTimeout(this.timer),C.Z.removeListener([I.kKeyboardShortcutsAltOpensMenu,I.kMailIsTurnedOff],this._onPrefsChange),Ge.Z.removeListener(this._onCommandStoreChange),this.#m=!1}_requestMenu(){this.hasMenu||ne.Z.requestNamedMenu(pye)}_getMenuItems=(e,t)=>Ge.Z.getNamedMenu(e,pye,t).filter((t=>!t.isVisible||t.isVisible(e,!1)));_onPrefsChange=(e,t,n)=>{switch(n){case I.kMailIsTurnedOff:this.setState({items:this._getMenuItems(this.context.vivaldiWindowId,!1)});break;case I.kKeyboardShortcutsAltOpensMenu:this._setupShortcuts(this.state.items)}};_onCommandStoreChange=e=>{switch(e){case"init":this._requestMenu();break;case"menu":this.hasMenu=!0;const e=this._getMenuItems(this.context.vivaldiWindowId,!1);this.setState({items:e,shortcuts:Qe.Z.getShortcutsForSubMenus(e)});break;case"shortcut":this._setupShortcuts(this.state.items)}};_handleItemActivated=e=>{Wae.show(this.context,e,this._getSiblings(),"bottom",this._onMenuVisibilityChanged)};_handleItemEnter=e=>{-1!==this.acceptEnterId&&this.acceptEnterId!==e||((0,Ra.sT)(this.context.document,this.nodeRef.current)&&this._moveFocus(e,"current",!0),this.setState({highlightedId:e}))};_handleItemLeave=e=>{-1===this.state.openMenuId&&this.setState({highlightedId:-1})};_handleItemBlur=e=>{cye.nextTick((()=>{(0,Ra.sT)(this.context.document,this.nodeRef.current)||this.setState({highlightedId:-1})}))};_handleLeaveBar=()=>{this.setState({highlightedId:-1}),ne.Z.executeActions("event",this.context,"COMMAND_FOCUS_WEBVIEW")};_handleDoubleClick=e=>{e.preventDefault(),e.stopPropagation()};_changeFocus=()=>{(0,Ra.sT)(this.context.document,this.nodeRef.current)?this._handleLeaveBar():this._moveFocus(this.state.highlightedId,"current",!0)};_moveFocus=(e,t,n)=>{const{document:i,HTMLButtonElement:s}=this.context;if(!0===n||(0,Ra.sT)(i,this.nodeRef.current)){const n=this.state.items.map(((e,t)=>this.state.shortcuts[t]?t:-1)).filter((e=>-1!==e));if(0===n.length)return;if("current"===t){const t=e<0?0:n.indexOf(e);if(-1===t)return;e=n[t]}else if("right"===t||"left"===t){if(1===n.length)return;let i=n.indexOf(e);i="right"===t?i+1>=n.length?0:i+1:i<=0?n.length-1:i-1,e=n[i]}const o=i.querySelector(`button.menubarItem.menubar[data-id="${e}"]`);o&&o instanceof s&&this.setState({highlightedId:e},(()=>o.focus()))}};_handleItemHighlightMissing=e=>{this.setState({highlightedId:e})};_onMenuVisibilityChanged=e=>{this.#m&&(-1===e?(this.acceptEnterId=this.state.openMenuId,this.timer=setTimeout((()=>{this.acceptEnterId=-1,this.timer=null}),100),(0,Ra.sT)(this.context.document,this.nodeRef.current)?this._moveFocus(this.state.openMenuId,"current",!0):this.setState({highlightedId:-1})):(this.setState({highlightedId:e}),this._moveFocus(e,"current",!1)),this.setState({openMenuId:e}),this._showAccessKeys(!1))};_showAccessKeys=e=>{this.setState({underlineAccessKeys:e})};_setupShortcuts=e=>{this.setState({shortcuts:Qe.Z.getShortcutsForSubMenus(e)})};_activateByAccessKey=e=>{for(let t=0;t<this.state.items.length;t++)if(this.state.shortcuts[t]&&this.state.shortcuts[t].key===e)return this._handleItemActivated(t),!0;return!1};_getSiblings=()=>{const e=this._getMenuItems(this.context.vivaldiWindowId,!0);return Array.from(this.context.document.querySelectorAll("button.menubarItem.menubar")).map(((t,n)=>{const i=t.getBoundingClientRect();return{id:parseInt(t.dataset.id),rect:{x:parseInt(i.left),y:parseInt(i.top),width:parseInt(i.width),height:parseInt(i.height)},menu:{items:e[n].items||[],expandId:"",preferred:[]}}}))};renderAll=()=>this.state.items.map(((e,t)=>{if(!this.state.shortcuts[t])return null;const n=0===t?this.props.keyAccess:-1,i=t.toString();return uye(lye,{id:t,keyAccess:n,item:e,shortcut:this.state.shortcuts[t],underlineAccessKeys:this.state.underlineAccessKeys,openMenuId:this.state.openMenuId,highlighted:this.state.highlightedId===t,moveFocus:this._moveFocus,onItemActivated:this._handleItemActivated,onItemEnter:this._handleItemEnter,onItemLeave:this._handleItemLeave,onItemBlur:this._handleItemBlur,onItemHighlightMissing:this._handleItemHighlightMissing,onAccessKey:this._activateByAccessKey,onLeaveBar:this._handleLeaveBar},i)}));render(){return uye(Li.Fragment,{},void 0,uye(Dae,{changeFocus:this._changeFocus,showAccessKeys:this._showAccessKeys}),(0,ss.jsx)("div",{ref:this.nodeRef,className:Fi()({menubar:!0,horizontal:this.props.horizontal}),onDoubleClick:this._handleDoubleClick,tabIndex:"-1",role:"menu",children:this.renderAll()}))}}const gye=hye;var mye;function fye(e,t,n,i){mye||(mye="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:mye,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const vye=[I.kKeyboardTabToAll,I.kMenuIconType];class yye extends Li.PureComponent{static contextType=ts.Z;state={activePage:Ce.ZP.unsafeGetActivePage(this.context.vivaldiWindowId)};componentDidMount(){const{selectWindow:e}=this.context;Ce.ZP.addListener(this._onPageStoreChange,e)}componentWillUnmount(){Ce.ZP.removeListener(this._onPageStoreChange)}_onPageStoreChange=()=>{this.setState({activePage:Ce.ZP.unsafeGetActivePage(this.context.vivaldiWindowId)})};close=e=>{e.stopPropagation(),xi.Z.close(this.context.vivaldiWindowId)};render(){const{inert:e}=this.props;return fye("div",{className:"topmenu",inert:e?"inert":null},void 0,"icon"===this.props.prefValues[I.kMenuIconType]&&fye("button",{className:"vivaldi-horizontal-icon",onDoubleClick:this.close,title:(0,B.Z)("Double Click to Close"),tabIndex:"-1"},void 0,fye("span",{className:"application-icon",dangerouslySetInnerHTML:{__html:Wi.Qa2}}),fye("span",{className:"vivaldi-v",dangerouslySetInnerHTML:{__html:n(3783)}})),"burger"===this.props.prefValues[I.kMenuIconType]&&fye("button",{className:"vivaldi-horizontal-icon",onDoubleClick:this.close,title:(0,B.Z)("Double Click to Close"),tabIndex:"-1"},void 0,fye("span",{className:"burger-icon",dangerouslySetInnerHTML:{__html:n(37609)}})),fye(gye,{horizontal:!0,keyAccess:this.props.prefValues[I.kKeyboardTabToAll]}),fye("div",{className:"horizontal-menu-pagetitle"},void 0,pn.jk.getDisplayTitle(this.state.activePage)))}}const bye=(0,Bu.Z)(yye,vye);var Sye;function wye(e,t,n,i){Sye||(Sye="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Sye,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Cye=function(e){const t=n=>{const{direction:i,first:s,second:o,splitPercentage:a=50}=n,r=n===e.value,l={gridTemplateRows:"column"===i?`${a}% auto`:" unset",gridTemplateColumns:"row"===i?`${a}% auto`:" unset"};return r&&(l.visibility=e.visible?"inherit":"hidden",l.zIndex=e.visible?"initial":-1,l.opacity=e.visible?1:0),wye("div",{className:Fi()("tiled",{visible:e.visible&&r}),style:l},void 0,wye("div",{className:"tile"},void 0,"number"==typeof s?e.renderTile(s):t(s),wye(Zm.Z,{onSlidebarPosition:function(t,i,s){const o=s.target?.parentElement,a=o.parentElement?.getBoundingClientRect();if(a){switch(n.direction){case"row":const e=(t-a.left)/a.width*100;n.splitPercentage=(0,Gw.Z)(e,10,90);break;case"column":const s=(i-a.top)/a.height*100;n.splitPercentage=(0,Gw.Z)(s,10,90)}e.onChange(e.value,e.tilingId)}},position:"row"===i?"left":"top"})),wye("div",{className:"tile"},void 0,"number"==typeof o?e.renderTile(o):t(o)))};return t(e.value)};var Aye=n(69787),Iye=n(34540);const Tye=(0,Ae.Z)(Iye.Z,500);class Zye extends m.Z{getInitialState(){return{}}reduce(e,t){const n=e;switch(t.actionType){case"TILE_INITIALIZED":return{...e,...t.tilesState};case"TILE_SET_LAYOUT":{const{id:n,mosaicLayout:i}=t;e={...e,[n]:i};break}case"PAGE_TILE_PAGES":{const{pages:n,id:i}=t;e=kye(e,n),i||(e=Nye(e,n));break}case"CHROME_TABS_CREATE":const n=Ce.ZP.getPageById(t.page.id);n&&(e=_ye(e,ze.aV.of(n)));break;case"PAGE_TILE_REMOVE_PAGES":case"PAGE_TABSTACK_REMOVE_FROM":case"PAGE_CLOSE":{const{pages:n}=t;e=kye(e,n);break}case"PAGE_TABSTACK_CREATE":{const{pages:n}=t;e=_ye(e,n);break}default:return e}return e!==n&&Tye(t.windowId,{tiles:e}),e}}function Eye(e,t){if("object"!=typeof e)return e;if(e.first===t)return"object"==typeof e.second?{...e.second}:e.second;if(e.second===t)return"object"==typeof e.first?{...e.first}:e.first;const n=Eye(e.first,t),i=Eye(e.second,t);return e.first!==n||e.second!==i?{...e,first:n,second:i}:e}function kye(e,t){return t.reduce(((t,n,i)=>{if(!n.vivExtData.tiling?.id||!e[n.vivExtData.tiling?.id])return t;const s=n.vivExtData.tiling.id,o=t[s],a=Eye(o,Ce.ZP.getTiles(s,n.windowId).findIndex((e=>e.id===n.id)));if(o===a)return t;if("object"==typeof a)return function(e){(function e(t,n){"object"==typeof t.first?e(t.first,n):t.first=n.count++,"object"==typeof t.second?e(t.second,n):t.second=n.count++})(e,{count:0})}(a),{...t,[s]:a};const r={...t};return delete r[s],r}),e)}function _ye(e,t){return Nye(e,t)}function Nye(e,t){return t.map((e=>(0,kv.jA)(e))).forEach((t=>{t&&e[t]&&delete(e={...e})[t]})),e}function Pye(e,t){if(e<2)return;const n=t||(e<4?"row":"grid");if("grid"===n){const t=3===e?2:Math.floor(Math.sqrt(e));return Dye((0,dF.Z)(e),t)}return Mye((0,dF.Z)(e),n)}function Dye(e,t){if(e.length<=t)return Mye(e,"column");const n=e.slice(0,t),i=e.slice(t),s=n.length/e.length*100;return{direction:"row",first:Mye(n,"column"),second:Dye(i,t),...50===s?null:{splitPercentage:s}}}function Mye(e,t){if(1===e.length)return e[0];const n=Math.floor(e.length/2),i=e.slice(0,n),s=e.slice(n),o=i.length/e.length*100;return{direction:t,first:Mye(i,t),second:Mye(s,t),...50===o?null:{splitPercentage:o}}}const Oye=new Zye;var xye,Lye=n(77398);function Rye(e,t,n,i){xye||(xye="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:xye,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function Bye(e){const t=Ce.ZP.getActivePage(e)?.id??0,n=Ce.ZP.getPageInWindow(e,t);return{activePageId:t,activeWorkSpaceId:n?(0,kv.cm)(n):void 0,pages:Ce.ZP.getPages(e)}}class Fye extends Li.PureComponent{static contextType=ts.Z;constructor(e,t){super(e);const n=(0,Lye.Z)(C.Z.get(I.kPanelsState),["width"],0);this.state={...Bye(t.vivaldiWindowId),contentWidth:t.innerWidth-n,contentHeight:t.innerHeight,tiles:Oye.getState()}}async componentDidMount(){const{selectWindow:e}=this.context;Ce.ZP.addListener(this._onPageStoreChange,e),Oye.addListener(this._onTilingStoreChange)}componentWillUnmount(){Ce.ZP.removeListener(this._onPageStoreChange),Oye.removeListener(this._onTilingStoreChange)}_onPageStoreChange=()=>{const e=Bye(this.context.vivaldiWindowId);this.setState(e)};_onTilingStoreChange=()=>{this.setState({tiles:Oye.getState()})};onResize=e=>{const t=e[0].target;let n,i;if(t&&t.clientWidth&&t.clientHeight)n=t.clientWidth,i=t.clientHeight;else{const e=(0,Lye.Z)(C.Z.get(I.kPanelsState),["width"],0);n=this.context.innerWidth-e,i=this.context.innerHeight}this.setState({contentWidth:n,contentHeight:i})};handleFocus=e=>{if("WEBVIEW"===e.relatedTarget.tagName)af.Z.doAction(this.context.vivaldiWindowId,this.state.activePageId,"focusWebView");else{const t=this.context.document.querySelector("#webpage-stack .webpageview.active .internal-page");if(t){const n=(0,Ra.Ng)(t);if(n){const{classList:t}=e.target;t?.contains("focus_webview_enter")?n[n.length-1].focus():t?.contains("focus_webview_exit")&&n[0].focus()}}}};onMosaicLayoutChange=(e,t)=>{Aye.Z.setTileLayout(this.context.vivaldiWindowId,e,t)};getLayoutSize(e){return"number"==typeof e.second?e.second+1:this.getLayoutSize(e.second)}renderTileSet=e=>{const t=this.context.vivaldiWindowId,{activePageId:n}=this.state,i=e.map(kv.jA).toSet(),s=Ce.ZP.getPageInWindow(t,n),o=s?(0,kv.jA)(s):void 0;return i.map((e=>{if(!e)return;const n=Ce.ZP.getTiles(e,t).filter((e=>(0,kv.cm)(e)===this.state.activeWorkSpaceId)).sortBy((e=>e.index)).map((e=>this.renderPage(e))),i=e===o;let a=this.state.tiles[e];if(s&&i&&(!a||this.getLayoutSize(a)!==n.size)){const i=s.vivExtData.tiling?.layout;a=Pye(n.size,i),a&&Aye.Z.setTileLayout(t,a,e)}return a?Rye(Cye,{tilingId:e,visible:i,renderTile:e=>n.get(e,null),value:a,onChange:this.onMosaicLayoutChange},e):null}))};renderPage=e=>{const t=(0,Yie.ZN)(e),n=e.pinned&&C.Z.get(I.kTabsAlwaysLoadPinnedAfterRestore);return t||!e.discarded||n?Rye(nse,{id:e.id,pageContext:e.context,url:e.url,target:e.target,vivExtData:e.vivExtData,showImageInspector:e.showImageInspector,discarded:e.discarded,contentWidth:this.state.contentWidth,contentHeight:this.state.contentHeight,isVisible:t,isActive:e.active,supportsReaderMode:e.supportsReaderMode,pinned:e.pinned},`page-component-${e.id}`):null};render(){const e=Li.Fragment,t=this.props.cycleFocus?"0":"-1",[n,i]=this.state.pages.partition((e=>{const t=(0,kv.jA)(e);return this.state.activeWorkSpaceId===(0,kv.cm)(e)&&t&&Ce.ZP.getTiles(t,this.context.vivaldiWindowId).size>1}));return Rye(e,{},"webpage__collection",Rye("span",{tabIndex:t,onFocus:this.handleFocus,className:"focus_webview_enter"}),Rye(Yi.Z,{id:"webpage-stack",onResize:this.onResize},void 0,i.size>0&&this.renderTileSet(i),n.size>0&&n.sortBy((e=>e.id)).map(this.renderPage)),Rye("span",{tabIndex:t,onFocus:this.handleFocus,className:"focus_webview_exit"}))}}const Wye=Fye;var Uye=n(19718),Vye=n(40893),Hye=n(30992);const Gye=()=>[efe,tfe,nfe,ife,sfe,ofe],$ye=e=>{let t=e;return t&&(t=t.replace(/^data\:([^\;]+)\;base64,/gim,"")),t};function Kye(e,t,n){return{isVisible:()=>!e.isGuest&&n.selection.length>0,isEnabled:()=>h7.ZP.hasNotes(),handler:()=>{de.Z.showNoteSelectionDialog(e.winId,{onSelected:e=>zn.Z.appendToNode(e,n.selection)})}}}const zye=(e,t,n,i=9,s)=>{const o=$ye(n.faviconUrl);return{handler:()=>{Hye.Z.setSearchEngine(e,n),Vye.Z.withTextAndEngine(e,t,n.guid)},emphasized:n.guid===s?.guid,iconPNG:o,iconPNGWhite:o,...Qe.Z.makeNumberMnemonic(n.name,i)}},jye=(e,t)=>{if(0===t.length)return[];const n=Hye.Z.getSearchEngine(e,!0);return ai.Z.get().map(((i,s)=>zye(e,t,i,s,n)))},Yye=e=>[{commandName:"DOCUMENT_DIRECTION_DEFAULT",type:"checkbox",...(0,us.Z)("command","Default")},{commandName:"DOCUMENT_DIRECTION_LTR",type:"checkbox",...(0,us.Z)("Left to Right")},{commandName:"DOCUMENT_DIRECTION_RTL",type:"checkbox",...(0,us.Z)("Right to Left")}],Xye=e=>[{commandName:"DOCUMENT_LOOP",type:"checkbox",...(0,us.Z)("context","Loop")},{commandName:"DOCUMENT_SHOW_CONTROLS",type:"checkbox",...(0,us.Z)("Show Controls")},Qe.Z.separatorItem,{commandName:"DOCUMENT_OPEN_AV_NEW_TAB",...e.support.audio?(0,us.Z)("Open Audio in New Tab"):(0,us.Z)("Open Video in New Tab")},{commandName:"DOCUMENT_SAVE_AV",ellipsis:!0,...e.support.audio?(0,us.Z)("Save Audio As"):(0,us.Z)("Save Video As")},{commandName:"DOCUMENT_COPY_AV_ADDRESS",ellipsis:!0,...e.support.audio?(0,us.Z)("Copy Audio Address"):(0,us.Z)("Copy Video Address")},{commandName:"DOCUMENT_CAST",ellipsis:!0,...(0,us.Z)("Cast")},Qe.Z.separatorItem,{commandName:"DOCUMENT_PICTURE_IN_PICTURE",isVisible:()=>e.support.video&&e.support.pictureinpicture,...(0,us.Z)("Picture in Picture")}],Qye=async(e,t,n,i,s)=>{switch(i.action){case"DOCUMENT_CONTAINER_DEVELOPER_TOOLS":return{isVisible:()=>!n&&!t.isdevtools,items:await qye(e,t,n,s),...s(e.winId,i,t)};case"DOCUMENT_VALIDATE_URL":return{isVisible:()=>!(t.iswebpanel||t.isimage||t.isdevtools||t.ismailcontent),handler:()=>{const n=Dn.Z.getSync("VALIDATION_URL");c.ZP.openURL(e.winId,n.replace("%s",t.pageurl),{inCurrent:!1})},...s(e.winId,i,t)};case"DOCUMENT_VIEW_SOURCE":{const n=t.isimage&&t.pageurl===t.srcurl;return{isVisible:()=>!n&&!t.isdevtools&&!t.ismailcontent,commandName:"DOCUMENT_VIEW_SOURCE",...s(e.winId,i,t)}}case"DOCUMENT_VIEW_FRAME_SOURCE":return{isVisible:()=>t.isframe&&!t.isdevtools&&!t.ismailcontent,commandName:"DOCUMENT_VIEW_FRAME_SOURCE",...s(e.winId,i,t)};case"DOCUMENT_RELOAD_FRAME":return{isVisible:()=>t.isframe&&!t.isdevtools&&!t.ismailcontent,commandName:"DOCUMENT_RELOAD_FRAME",...s(e.winId,i,t)};case"DOCUMENT_INSPECT":return{commandName:"DOCUMENT_INSPECT",isVisible:()=>!t.isdevtools,...s(e.winId,i,t)};default:return Promise.resolve({...s(e.winId,i,t)})}},qye=async(e,t,n,i)=>Promise.all(["DOCUMENT_VALIDATE_URL","DOCUMENT_VIEW_SOURCE","DOCUMENT_VIEW_FRAME_SOURCE","DOCUMENT_RELOAD_FRAME","DOCUMENT_INSPECT"].map((s=>Qye(e,t,n,{id:"",type:"command",action:s},i)))),Jye=e=>[{commandName:"DOCUMENT_LANGUAGE_SETTINGS",...(0,us.Z)("Language Settings")}],ebe=async(e,t,n,i,s)=>{switch(i.action){case"DOCUMENT_LOOK_UP":return{isVisible:()=>e.isMac&&t.printableselection.length>0&&!n,...s(e.winId,i,t)};case"DOCUMENT_COPY":case"DOCUMENT_PRINT":return{...s(e.winId,i,t)};case"DOCUMENT_CONTAINER_LINK_TO_HIGHLIGHT":return{container:{content:"linktohighlight"},isVisible:()=>!t.ismailcontent,...s(e.winId,i,t)};case"DOCUMENT_GOTO_URL":return{handler:()=>{c.ZP.openURL(e.winId,t.selectionurl,{inCurrent:!1,inBackground:C.Z.get(I.kTabsOpenNewInBackground)})},isVisible:()=>t.selectionurl.length>0,...s(e.winId,i,t)};case"DOCUMENT_SEARCH":case"DOCUMENT_SEARCH_LAST_USED":{const n=Hye.Z.getSearchEngine(e.winId,"DOCUMENT_SEARCH_LAST_USED"===i.action);return n?{...zye(e.winId,t.selection,n),mnemonic:!0,...s(e.winId,i,t)}:(console.warn("No default search engine"),{isEnabled:()=>!1,...s(e.winId,i,t)})}case"DOCUMENT_CONTAINER_SEARCH_WITH":return{items:jye(e.winId,t.selection),...s(e.winId,i,t)};case"DOCUMENT_CONTAINER_EXTENSIONS":return{isVisible:()=>!t.iswebpanel&&!t.iswebpagewidget&&t.support.extensions&&!n,container:{content:"extensions"},...s(e.winId,i,t)};case"DOCUMENT_SEND_BY_MAIL":return{handler:()=>{Qt.Z.createDraft({subject:t.pagetitle||t.pageurl,body:`${t.selection} \n\n ${t.pageurl}`})},isVisible:()=>!C.Z.get(I.kMailIsTurnedOff),...s(e.winId,i,t)};case"COMMAND_COPY_SELECTION_TO_NOTE":{const n={...s(e.winId,i,t)};if(t.iswebpanel||t.iswebpagewidget||t.ismailcontent){const i=t.ismailcontent?J.Z.getActiveMessageUrl():t.pageurl;n.handler=()=>{zn.Z.createNote(e.winId,{content:t.selection,url:i,type:"note"})}}return n}case"COMMAND_APPEND_SELECTION_TO_NOTE":return{...s(e.winId,i,t),...t.ismailcontent?Kye(e,0,t):null};case"DOCUMENT_ADD_TO_CALENDAR":return{handler:()=>{te.ZP.showAddEvent(e.winId,t.selection,t.pageurl)},isVisible:()=>!e.isGuest&&!C.Z.get(I.kMailIsTurnedOff),...s(e.winId,i,t)};case"DOCUMENT_CONTAINER_SPEECH":return{isVisible:()=>e.isMac,container:{content:"speech"},...s(e.winId,i,t)};case"COMMAND_FULLSCREEN":return{...s(e.winId,i,t),isVisible:()=>!n&&!t.iswebpagewidget};case"COMMAND_TRANSLATE_SELECTION":{const{id:n,url:o}=Ce.ZP.unsafeGetActivePage(e.winId);return{isVisible:()=>$A.Z.canTranslateText(t.selection,o,n)&&!t.iswebpanel&&!t.iswebpagewidget,...s(e.winId,i,t),handler:()=>{_i.Z.translateSelection(e.winId,n,t.selection)}}}default:return Uye.Z.actions().includes(i.action)?Qye(e,t,n,i,s):Promise.resolve({...s(e.winId,i,t)})}},tbe=async(e,t,n,i,s)=>{switch(i.action){case"DOCUMENT_OPEN_IMAGE_IN_TAB":return{isVisible:()=>!t.ismailcontent,...s(e.winId,i,t)};case"DOCUMENT_OPEN_IMAGE_IN_NEW_TAB":return{isVisible:()=>!e.isPopup,...s(e.winId,i,t)};case"DOCUMENT_OPEN_IMAGE_IN_NEW_BACKGROUND_TAB":return{isVisible:()=>!e.isPopup&&!C.Z.get(I.kTabsOpenNewInBackground),...s(e.winId,i,t)};case"DOCUMENT_OPEN_IMAGE_IN_NEW_WINDOW":return{isVisible:()=>!e.isIncognito||e.isGuest,...s(e.winId,i,t)};case"DOCUMENT_OPEN_IMAGE_IN_PRIVATE_WINDOW":return{isVisible:()=>!e.isGuest,...s(e.winId,i,t)};case"DOCUMENT_CONTAINER_OPEN_IMAGE_IN_PROFILE":return{container:{content:"imageinprofile"},...s(e.winId,i,t)};case"DOCUMENT_SEARCH_FOR IMAGE":{const n=ai.Z.getImageSearch(),o=n?$ye(n.faviconUrl):"";return{isVisible:()=>Boolean(n?.imageUrl),iconPNG:o,iconPNGWhite:o,...s(e.winId,i,t)}}case"DOCUMENT_SHOW_IMAGE_PROPERTIES":return{handler:async()=>{const n=Ce.ZP.getActivePage(e.winId);if(n){const i=n.windowId;if(Ce.ZP.isDisplayingImage(n.id))c.ZP.setImageInspector(n.id,i,!0);else{await c.ZP.openURL(e.winId,t.srcurl,{inCurrent:!1,transition:se.Z.historyPrivate.TransitionType.AUTO_TOPLEVEL}),await new Promise((t=>{const n=()=>{Ce.ZP.removeListener(n),t()};Ce.ZP.addListener(n,(t=>t.get(e.winId)))}));const n=Ce.ZP.getPages(i).last();c.ZP.setImageInspector(n.id,i,!0)}}},isVisible:()=>!e.isPopup,isEnabled:()=>t.isimage,...s(e.winId,i,t)};case"DOCUMENT_USE_IMAGE_AS_STARTPAGE_BACKGROUND":return{handler:()=>{ki.Z.setThemeBackgroundImageFromUrl(e.winId,t.srcurl)},...s(e.winId,i,t)};case"DOCUMENT_CONTAINER_SEND_TO_DEVICES":return{isVisible:()=>!n&&t.support.sendtodevices,container:{content:"sendimagetodevices",icons:Gye()},...s(e.winId,i,t)};case"DOCUMENT_QR_CODE":return{isVisible:()=>t.support.qrcode&&!t.iswebpagewidget&&!e.isPopup,...s(e.winId,i,t)};case"DOCUMENT_CONTAINER_TEXT_SELECTION":return t.selection.length>0?{items:await obe(e,t,!0),...s(e.winId,i,t)}:{items:[],isVisible:()=>!1,...s(e.winId,i,t)};case"DOCUMENT_CONTAINER_EXTENSIONS":return{isVisible:()=>!t.iswebpanel&&!t.iswebpagewidget&&t.support.extensions&&!n,container:{content:"extensions"},...s(e.winId,i,t)};case"COMMAND_FULLSCREEN":return{...s(e.winId,i,t),isVisible:()=>!n&&!t.iswebpagewidget};default:return Uye.Z.actions().includes(i.action)?Qye(e,t,n,i,s):Promise.resolve({...s(e.winId,i,t)})}},nbe=async(e,t,n,i,s)=>{switch(i.action){case"DOCUMENT_CONTAINER_AV":return{items:Xye(t),...s(e.winId,i,t)};case"DOCUMENT_CONTAINER_EXTENSIONS":return{isVisible:()=>!t.iswebpanel&&t.support.extensions&&!n,container:{content:"extensions"},...s(e.winId,i,t)};default:return Uye.Z.actions().includes(i.action)?Qye(e,t,!1,i,s):Promise.resolve({...s(e.winId,i,t)})}},ibe=(e,t,n)=>{const i="image",s=ji.Z.getOptionFunction(i);return ji.Z.getNamedMenu(e.winId,i,(async i=>tbe(e,t,n,i,s)))},sbe=({winId:e},{linkurl:t})=>{const n=[],i=Ce.ZP.getActiveWorkspace(e),s=GF.Z.getState().filter((e=>e.id!==i));i&&n.push({handler:async()=>{await c.ZP.newTab(e,t,{workspaceId:void 0})},...(0,us.Z)("This Window")});for(let i=0;i<s.length;i++){const o=s[i];n.push({handler:async()=>{const n=GF.Z.getWindowId(o.id)??e;await c.ZP.setActiveWorkspace(e,o.id),await c.ZP.newTab(n,t,{workspaceId:o.id,ignoreLinkRouting:!0})},label:o.name,labelEnglish:o.name})}return n},obe=(e,t,n)=>{const i="selection",s=ji.Z.getOptionFunction(i);return ji.Z.getNamedMenu(e.winId,i,(async i=>ebe(e,t,n,i,s)))},abe={show:(e,t,n)=>{const s=(e,t,n,i)=>{(0,cs.Z)(e,n,void 0,"pointer",void 0,t,i)()},o={winId:e.vivaldiWindowId,isGuest:he.ZP.isGuest(),isIncognito:he.ZP.isIncognito(e.vivaldiWindowId),isPopup:he.ZP.isPopup(e.vivaldiWindowId),isMac:!1};n.iseditable?"regular"===n.textfield?((e,t)=>{const n="uiedit",i=ji.Z.getOptionFunction(n);return ji.Z.getNamedMenu(e.winId,n,(async n=>{switch(n.action){case"DOCUMENT_CONTAINER_SPELLCHECK":return{container:{content:"spellcheck"},...i(e.winId,n,t)};case"DOCUMENT_LOOK_UP":return{isVisible:()=>e.isMac&&t.printableselection.length>0,...i(e.winId,n,t)};case"DOCUMENT_EMOJI":return{isVisible:()=>t.support.emoji,...i(e.winId,n,t)};case"DOCUMENT_CONTAINER_NOTES":return{container:{content:"notes"},isVisible:()=>!e.isGuest,...i(e.winId,n,t)};case"DOCUMENT_CONTAINER_SPELLCHECK_OPTIONS":return e.isMac?{isVisible:()=>t.support.editoptions,items:Jye(),...i(e.winId,n,t)}:{isVisible:()=>t.support.editoptions,container:{content:"spellcheckoptions"},...i(e.winId,n,t)};case"DOCUMENT_CONTAINER_WRITING_DIRECTION":return{isVisible:()=>t.support.editoptions,items:Yye(),...i(e.winId,n,t)};case"DOCUMENT_CONTAINER_SPEECH":return{isVisible:()=>e.isMac,container:{content:"speech"},...i(e.winId,n,t)};case"COMMAND_COPY_SELECTION_TO_NOTE":return{...i(e.winId,n,t),isVisible:()=>!e.isGuest&&t.selection.length>0,handler:()=>{zn.Z.createNote(e.winId,{content:t.selection,url:"",type:"note"})}};case"COMMAND_APPEND_SELECTION_TO_NOTE":return{...i(e.winId,n,t),...Kye(e,0,t)};case"COMMAND_TRANSLATE_SELECTION":{const{id:s,url:o}=Ce.ZP.unsafeGetActivePage(e.winId);return{isVisible:()=>$A.Z.canTranslateText(t.selection,o,s),...i(e.winId,n,t),handler:()=>{_i.Z.translateSelection(e.winId,s,t.selection)}}}default:return Promise.resolve({...i(e.winId,n,t)})}}))})(o,n).then((n=>{s(e,t,n)})):["addressfield","searchfield"].includes(n.textfield)?((e,t)=>{const n="urledit",i=ji.Z.getOptionFunction(n);return ji.Z.getNamedMenu(e.winId,n,(async n=>{switch(n.action){case"DOCUMENT_CONTAINER_SPELLCHECK":return{container:{content:"spellcheck"},...i(e.winId,n,t)};case"DOCUMENT_LOOK_UP":return{isVisible:()=>e.isMac&&t.printableselection.length>0,...i(e.winId,n,t)};case"DOCUMENT_EMOJI":return{isVisible:()=>t.support.emoji,...i(e.winId,n,t)};case"COMMAND_CLIPBOARD_PASTE_AS_PLAIN_TEXT_OR_PASTE_AND_GO":return{...i(e.winId,n,t),isEnabled:()=>t.support.paste};case"DOCUMENT_CONTAINER_NOTES":return{container:{content:"notes"},isVisible:()=>!e.isGuest,...i(e.winId,n,t)};case"DOCUMENT_CONTAINER_SPELLCHECK_OPTIONS":return e.isMac?{isVisible:()=>t.support.editoptions,items:Jye(),...i(e.winId,n,t)}:{isVisible:()=>t.support.editoptions,container:{content:"spellcheckoptions"},...i(e.winId,n,t)};case"DOCUMENT_CONTAINER_WRITING_DIRECTION":return{isVisible:()=>t.support.editoptions,items:Yye(),...i(e.winId,n,t)};case"DOCUMENT_CUSTOMIZE":const s="addressfield"===t.textfield?"addressbar":"search";return{isVisible:()=>!e.isGuest,handler:()=>de.Z.showSettings(e.winId,s),...i(e.winId,n,t)};case"DOCUMENT_SHOW_FULL_ADDRESS":const o=C.Z.get(I.kAddressBarShowFullUrl);return{isEnabled:()=>!e.isGuest,checked:o,isVisible:()=>"addressfield"===t.textfield,handler:()=>{w.Z.set(I.kAddressBarShowFullUrl,!o)},...i(e.winId,n,t)};case"DOCUMENT_CONTAINER_SPEECH":return{isVisible:()=>e.isMac,container:{content:"speech"},...i(e.winId,n,t)};case"COMMAND_COPY_SELECTION_TO_NOTE":return{isVisible:()=>!e.isGuest&&t.selection.length>0,...i(e.winId,n,t),handler:()=>{zn.Z.createNote(e.winId,{content:t.selection,url:"",type:"note"})}};case"COMMAND_APPEND_SELECTION_TO_NOTE":return{...i(e.winId,n,t),...Kye(e,0,t)};case"COMMAND_TRANSLATE_SELECTION":{const{id:s,url:o}=Ce.ZP.unsafeGetActivePage(e.winId);return{isVisible:()=>$A.Z.canTranslateText(t.selection,o,s),...i(e.winId,n,t),handler:()=>{_i.Z.translateSelection(e.winId,s,t.selection)}}}default:return Promise.resolve({...i(e.winId,n,t)})}}))})(o,n).then((n=>{s(e,t,n)})):((e,t)=>{const n="docedit",i=ji.Z.getOptionFunction(n);return ji.Z.getNamedMenu(e.winId,n,(async n=>{switch(n.action){case"DOCUMENT_SUGGEST_PASSWORD":return{isVisible:()=>t.support.passwordgeneration,...i(e.winId,n,t)};case"DOCUMENT_SHOW_PASSWORDS":return{isVisible:()=>t.support.passwordshowall,handler:()=>de.Z.showSettings(e.winId,"privacy"),...i(e.winId,n,t)};case"DOCUMENT_CONTAINER_SPELLCHECK":return{container:{content:"spellcheck"},...i(e.winId,n,t)};case"DOCUMENT_LOOK_UP":return{isVisible:()=>e.isMac&&t.printableselection.length>0,...i(e.winId,n,t)};case"DOCUMENT_EMOJI":return{isVisible:()=>t.support.emoji,...i(e.winId,n,t)};case"DOCUMENT_PASTE_AS_PLAIN_TEXT":return{isVisible:()=>t.support.editoptions,...i(e.winId,n,t)};case"DOCUMENT_ADD_AS_SEARCH_ENGINE":return{isVisible:()=>!e.isGuest&&!t.iswebpagewidget&&t.keywordurl.length>0,...i(e.winId,n,t)};case"DOCUMENT_CONTAINER_NOTES":return{container:{content:"notes"},isVisible:()=>!e.isGuest,...i(e.winId,n,t)};case"DOCUMENT_CONTAINER_SPELLCHECK_OPTIONS":return e.isMac?{isVisible:()=>t.support.editoptions,items:Jye(),...i(e.winId,n,t)}:{isVisible:()=>t.support.editoptions,container:{content:"spellcheckoptions"},...i(e.winId,n,t)};case"DOCUMENT_CONTAINER_WRITING_DIRECTION":return{isVisible:()=>t.support.editoptions,items:Yye(),...i(e.winId,n,t)};case"DOCUMENT_SEARCH":case"DOCUMENT_SEARCH_LAST_USED":{const s=Hye.Z.getSearchEngine(e.winId,"DOCUMENT_SEARCH_LAST_USED"===n.action);return s?{...zye(e.winId,t.selection,s),mnemonic:!0,isVisible:()=>t.selection.length>0,...i(e.winId,n,t)}:(console.warn("No default search engine"),{isVisible:()=>t.selection.length>0,isEnabled:()=>!1,...i(e.winId,n,t)})}case"DOCUMENT_CONTAINER_SEARCH_WITH":return{items:jye(e.winId,t.selection),isVisible:()=>t.selection.length>0,...i(e.winId,n,t)};case"DOCUMENT_CONTAINER_EXTENSIONS":return{isVisible:()=>!t.iswebpanel&&!t.iswebpagewidget&&t.support.extensions,container:{content:"extensions"},...i(e.winId,n,t)};case"DOCUMENT_CONTAINER_SPEECH":return{isVisible:()=>e.isMac,container:{content:"speech"},...i(e.winId,n,t)};case"DOCUMENT_GOTO_URL":return{handler:()=>{c.ZP.openURL(e.winId,t.selectionurl,{inCurrent:!1,inBackground:C.Z.get(I.kTabsOpenNewInBackground)})},isVisible:()=>t.selectionurl.length>0,...i(e.winId,n,t)};case"COMMAND_COPY_SELECTION_TO_NOTE":return{...i(e.winId,n,t),isVisible:()=>!e.isGuest&&t.selection.length>0,handler:()=>{const n=Ce.ZP.getActivePage(e.winId);n&&zn.Z.createNote(e.winId,{content:t.selection,url:n.url,type:"note"})}};case"COMMAND_APPEND_SELECTION_TO_NOTE":return{...i(e.winId,n,t),...Kye(e,0,t)};case"COMMAND_TRANSLATE_SELECTION":{const{id:s,url:o}=Ce.ZP.unsafeGetActivePage(e.winId);return{isVisible:()=>$A.Z.canTranslateText(t.selection,o,s)&&!t.iswebpagewidget,...i(e.winId,n,t),handler:()=>{_i.Z.translateSelection(e.winId,s,t.selection)}}}case"COMMAND_FULLSCREEN":return{...i(e.winId,n,t),isVisible:()=>!t.iswebpagewidget};default:return Uye.Z.actions().includes(n.action)?Qye(e,t,!1,n,i):Promise.resolve({...i(e.winId,n,t)})}}))})(o,n).then((n=>{s(e,t,n)})):n.linkurl.length>0?((e,t)=>{const n="link",s=ji.Z.getOptionFunction(n),o=ji.Z.getActionList("image")(),a=ji.Z.getActionList("selection")(),r=ji.Z.getActionList("audiovideo")();return ji.Z.getNamedMenu(e.winId,n,(async n=>{switch(n.action){case"DOCUMENT_OPEN_IN_NEW_TAB":case"DOCUMENT_OPEN_IN_TAB":return{isVisible:()=>!t.ismailto&&!e.isPopup,...s(e.winId,n,t)};case"DOCUMENT_OPEN_IN_NEW_WINDOW":return{isVisible:()=>!t.ismailto&&(!e.isIncognito||e.isGuest),...s(e.winId,n,t)};case"DOCUMENT_OPEN_IN_NEW_BACKGROUND_TAB":return{isVisible:()=>!t.ismailto&&!e.isPopup&&!C.Z.get(I.kTabsOpenNewInBackground),...s(e.winId,n,t)};case"DOCUMENT_OPEN_IN_PRIVATE_WINDOW":return{isVisible:()=>!t.ismailto&&!e.isGuest,...s(e.winId,n,t)};case"DOCUMENT_CONTAINER_OPEN_IN_PWA":return{isVisible:()=>!t.ismailto,container:{content:"linkinpwa"},...s(e.winId,n,t)};case"DOCUMENT_CONTAINER_OPEN_IN_PROFILE":return{isVisible:()=>!t.ismailto,container:{content:"linkinprofile"},...s(e.winId,n,t)};case"DOCUMENT_CONTAINER_OPEN_IN_WINDOW":{const i=await Ta.getMenu(e.winId,!1,[t.linkurl]);return{isVisible:()=>i.length>0,items:i,...s(e.winId,n,t)}}case"DOCUMENT_CONTAINER_OPEN_IN_WORKSPACE":return{isVisible:()=>!t.ismailto&&GF.Z.getState().length>0,items:sbe(e,t),...s(e.winId,n,t)};case"DOCUMENT_ADD_LINK_TO_BOOKMARKS":return{handler:()=>{i.Z.bookmarks.create({parentId:g.Z.getRootId(),title:t.linktitle,url:t.linkurl})},isVisible:()=>!(t.ismailto||t.iswebpanel||t.iswebpagewidget||e.isGuest),...s(e.winId,n,t)};case"DOCUMENT_ADD_LINK_TO_WEBPANEL":return{handler:()=>{vr.Z.addByUrl(e.winId,t.linkurl,!0)},isVisible:()=>!t.ismailto&&!t.iswebpanel&&!e.isGuest,...s(e.winId,n,t)};case"DOCUMENT_ADD_LINK_TO_READING_LIST":return{handler:()=>{x.IH(e.winId,t.linkurl,t.linktitle)},isVisible:()=>!e.isGuest,...s(e.winId,n,t)};case"DOCUMENT_SEND_LINK_BY_MAIL":return{handler:()=>{Qt.Z.createDraft({subject:t.linktitle||t.linkurl,body:t.linkurl})},isVisible:()=>!C.Z.get(I.kMailIsTurnedOff),...s(e.winId,n,t)};case"DOCUMENT_SAVE_LINK":return{isVisible:()=>!t.ismailto,...s(e.winId,n,t)};case"DOCUMENT_COPY_LINK_TEXT":return{isVisible:()=>!t.isimage&&t.linktitle.length>0,...s(e.winId,n,t)};case"DOCUMENT_CONTAINER_SEND_TO_DEVICES":return{isVisible:()=>t.support.sendtodevices,container:{content:"sendlinktodevices",icons:Gye()},...s(e.winId,n,t)};case"DOCUMENT_CONTAINER_EXTENSIONS":return{isVisible:()=>!t.iswebpanel&&!t.iswebpagewidget&&t.support.extensions,container:{content:"extensions"},...s(e.winId,n,t)};case"DOCUMENT_CONTAINER_LINK_SELECTION":return t.selection.length>0&&!t.isimage&&!t.support.canvas?{items:await obe(e,t,!0),...s(e.winId,n,t)}:{items:[],isVisible:()=>!1,...s(e.winId,n,t)};case"DOCUMENT_CONTAINER_LINKED_IMAGE":return t.isimage||t.support.canvas?{items:await ibe(e,t,!0),...s(e.winId,n,t)}:{items:[],isVisible:()=>!1,...s(e.winId,n,t)};case"COMMAND_FULLSCREEN":return{...s(e.winId,n,t),isVisible:()=>!t.iswebpagewidget};default:return Uye.Z.actions().includes(n.action)?Qye(e,t,!1,n,s):a.includes(n.action)?t.selection.length>0&&!t.isimage&&!t.support.canvas?ebe(e,t,!1,n,s):{isVisible:()=>!1,...s(e.winId,n,t)}:o.includes(n.action)?t.isimage||t.support.canvas?tbe(e,t,!1,n,s):{isVisible:()=>!1,...s(e.winId,n,t)}:r.includes(n.action)?t.support.audio||t.support.video?nbe(e,t,!1,n,s):{isVisible:()=>!1,...s(e.winId,n,t)}:Promise.resolve({...s(e.winId,n,t)})}}))})(o,n).then((i=>{s(e,t,i,n)})):n.isimage||n.support.canvas?ibe(o,n,!1).then((i=>{s(e,t,i,n)})):n.support.audio||n.support.video?((e,t)=>{const n="audiovideo",i=ji.Z.getOptionFunction(n);return ji.Z.getNamedMenu(e.winId,n,(async n=>nbe(e,t,!1,n,i)))})(o,n).then((n=>{s(e,t,n)})):n.selection.length>0?obe(o,n,!1).then((i=>{s(e,t,i,n)})):n.ismailcontent?n.iswebpagewidget||((e,t)=>{const n="mailcontent",i=ji.Z.getOptionFunction(n);return ji.Z.getNamedMenu(e.winId,n,(async n=>{switch(n.action){case"COMMAND_PAGE_BACK":return{...i(e.winId,n,t),isVisible:()=>gt.Z.canGoBack()};case"COMMAND_PAGE_FORWARD":return{...i(e.winId,n,t),isVisible:()=>gt.Z.canGoForward()};case"COMMAND_TAB_VIEW_PAGE_SOURCE":return{checked:Boolean(J.Z.getIsRawMode()),...i(e.winId,n,t)};default:return Uye.Z.actions().includes(n.action)?Qye(e,t,!1,n,i):Promise.resolve({...i(e.winId,n,t)})}}))})(o,n).then((n=>{s(e,t,n)})):((e,t)=>{const n="page",i=ji.Z.getOptionFunction(n);return ji.Z.getNamedMenu(e.winId,n,(async n=>{switch(n.action){case"COMMAND_ADD_BOOKMARK":return{...i(e.winId,n,t),isVisible:()=>!t.iswebpanel&&!t.iswebpagewidget&&!e.isGuest};case"DOCUMENT_ADD_TO_WEBPANEL":return{handler:()=>{vr.Z.addByUrl(e.winId,t.pageurl,!0)},isVisible:()=>!t.iswebpanel&&!e.isGuest,...i(e.winId,n,t)};case"DOCUMENT_SEND_BY_MAIL":return{handler:()=>{Qt.Z.createDraft({subject:t.pagetitle||t.pageurl,body:t.pageurl})},isVisible:()=>!C.Z.get(I.kMailIsTurnedOff),...i(e.winId,n,t)};case"DOCUMENT_COPY_ADDRESS":return{handler:()=>{Gp.Z.copyUrlToClipboard(t.pageurl)},...i(e.winId,n,t)};case"DOCUMENT_CONTAINER_LINK_TO_HIGHLIGHT":return{isVisible:()=>t.support.highlight,container:{content:"linktohighlight"},...i(e.winId,n,t)};case"DOCUMENT_SAVE":case"DOCUMENT_CAST":return{isVisible:()=>!t.iswebpanel&&!t.iswebpagewidget,...i(e.winId,n,t)};case"DOCUMENT_QR_CODE":return{isVisible:()=>t.support.qrcode&&!t.iswebpagewidget,...i(e.winId,n,t)};case"DOCUMENT_CONTAINER_SEND_TO_DEVICES":return{isVisible:()=>t.support.sendtodevices,container:{content:"sendpagetodevices",icons:Gye()},...i(e.winId,n,t)};case"DOCUMENT_CONTAINER_EXTENSIONS":return{isVisible:()=>!t.iswebpagewidget&&t.support.extensions,container:{content:"extensions"},...i(e.winId,n,t)};case"DOCUMENT_CONTAINER_PLUGIN_ROTATION":{const s=!t.iswebpanel&&!t.iswebpagewidget&&t.support.plugin;return{isVisible:()=>s,items:s?[{commandName:"DOCUMENT_ROTATE_CLOCKWISE",...(0,us.Z)("Rotate Clockwise")},{commandName:"DOCUMENT_ROTATE_COUNTERCLOCKWISE",...(0,us.Z)("Rotate Counterclockwise")}]:[],...i(e.winId,n,t)}}case"CONTAINER_PERIODIC_RELOAD":if(t.iswebpanel){const s=Yn.ZP.getSelected(e.winId);return s&&Yn.ZP.getIsWebPanel(s)?{...i(e.winId,n,t),items:MS.Z.getMenu(s,"panel",e.winId)}:{isVisible:()=>!1,...i(e.winId,n,t)}}return{isVisible:()=>!t.iswebpagewidget,...i(e.winId,n,t)};case"COMMAND_FULLSCREEN":return{...i(e.winId,n,t),isVisible:()=>!t.iswebpagewidget};default:return Uye.Z.actions().includes(n.action)?Qye(e,t,!1,n,i):Promise.resolve({...i(e.winId,n,t)})}}))})(o,n).then((i=>{s(e,t,i,n)}))}},rbe=abe;var lbe=n(43656);function dbe(e,t){const{body:n}=e;if(!n)return;const i=getComputedStyle(t.srcElement).getPropertyValue("user-select");if(!t.srcElement.matches("a[href], area[href], input:not([disabled]), select:not([disabled]), option:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]")&&"text"!==i&&"all"!==i){let i=t.target;for(;i!==n&&null!==i;){if(i.draggable){const t=e.activeElement,s=function(i){this.removeEventListener("mouseup",s),this.removeEventListener("dragend",s),e.activeElement===n&&t.focus()};return i.addEventListener("mouseup",s),void i.addEventListener("dragend",s)}i=i.parentElement}t.preventDefault()}}function cbe(e){const{body:t}=e;if(!t)return Lr.Z;const n=dbe.bind(null,e);return t.addEventListener("mousedown",n),function(){t.removeEventListener("mousedown",n)}}let ube="";se.Z.utilities.onScroll.addListener((e=>{1===e?ube="mouse":2===e?ube="trackpad":3===e&&(ube="inertial")}));let pbe="";function hbe(e){this.vivaldiWindowId===e&&function(e){pbe="";const t=xse.getEntry(e).status;if(t){const{urlValid:e,isBrowserUrl:n}=se.Z.utilities.isUrlValid(t);e&&n&&(pbe=t)}}(e)}function gbe(e,t,n,i){if(this.vivaldiWindowId!==e)return;const s=Ge.Z.getCommandsForGestures();let o;if(pbe&&(o=s["e"+i]),!o){if(o=s[i],!o)return;const a=Sbe(this,t,n);if(a){const[t]=a;t.active||c.ZP.activateTab(t.id,e)}}const a=o[0];a.function({...(0,cs.m)("gesture",this),param:pbe}),pbe="",u.Z.setStatus(e,(0,B.Z)("Gesture: $1",[a.label]),3e3)}function mbe(e,t,n,i,s){if(this.vivaldiWindowId!==e)return;const o=this.document.elementFromPoint(Math.round(i),Math.round(s));if(o&&"WEBVIEW"===o.tagName){t&&o.focus();const e=new MouseEvent(t?"mousedown":"mouseup",{button:n,clientX:i,clientY:s,bubbles:!0});o.dispatchEvent(e)}}let fbe=null;function vbe(){fbe=setTimeout((()=>{fbe=null}),100)}function ybe(e,t,n,i){if(this.vivaldiWindowId!==e||null!==fbe||"inertial"===ube)return;let s;const o=Yie.kG(e);if(o.count()>=2){const t=Sbe(this,n,i,o);if(!t)return;const[a,r]=t;if(a.active||c.ZP.activateTab(a.id,e),pn.jk.isInternalPage(a))return;if("WEBVIEW"!==r.tagName)return void console.error("An external page has "+r.tagName+" tag when WEBVIEW was expected");s=r}else{const t=pw.Z.getActiveWebView(e);if(!t)return;s=t}vbe();const a=.1*t;s.getZoom((t=>{let n=Math.round(10*t)/10+a;n=Math.min(Math.max(n,.2),5),s.setZoom(n),"overlay"!==C.Z.get(I.kStatusBarDisplay)&&C.Z.get(I.kToolbarsStatus).includes("Zoom")||u.Z.setStatus(e,(0,B.Z)("Page Zoom $1%",[Math.round(100*n)]),2e3)}))}function bbe(e){const t=this.vivaldiWindowId,n=e.target;if(n.classList.contains("UrlBar-UrlField")&&n.scrollWidth>=n.clientWidth&&n!==this.document.activeElement)return void e.preventDefault();if(!C.Z.get(I.kMouseWheelTabSwitch)||function(e){return!1===e.altKey&&!1===e.ctrlKey&&!0===e.shiftKey&&!1===e.metaKey}(e))return;let i=!1;if(n.closest("div#tabs-tabbar-container")&&(i=!0),2===e.buttons||function(e){return!0===e.altKey&&!1===e.ctrlKey&&!1===e.shiftKey&&!1===e.metaKey}(e)||i){if(e.preventDefault(),"inertial"===ube)return;const n=e.wheelDelta;let i;if(n>0)i=1;else{if(!(n<0))return;i=-1}const s=false,o=s?"COMMAND_TAB_SWITCH_BACK_SETTING":"COMMAND_TAB_SWITCH_FORWARD_SETTING",a=s?"COMMAND_TAB_SWITCH_BACK_ORDER":"COMMAND_TAB_SWITCH_FORWARD_ORDER",r=s?"COMMAND_TAB_SWITCH_FORWARD_SETTING":"COMMAND_TAB_SWITCH_BACK_SETTING",l=s?"COMMAND_TAB_SWITCH_FORWARD_ORDER":"COMMAND_TAB_SWITCH_BACK_ORDER";let d;if("trackpad"===ube){if(null!==fbe)return;vbe(),d=i<0?2===e.buttons||e.altKey?o:a:2===e.buttons||e.altKey?r:l}else d=i<0?2===e.buttons||e.altKey?o:a:2===e.buttons||e.altKey?r:l;for(const n of eU.CN)if(n.name===d){n.action({origin:"gesture",context:this,windowId:t,keyState:{shiftKey:e.shiftKey,ctrlKey:e.ctrlKey,altKey:e.altKey,metaKey:e.metaKey,key:""},param:e});break}}}function Sbe(e,t,n,i){i=i||Yie.kG(e.vivaldiWindowId);for(const s of i){const i=e.document.getElementById(String(s.id));if(!i)continue;const o=i.getBoundingClientRect();if(o.left<=t&&t<o.right&&o.top<=n&&n<o.bottom)return[s,i]}return null}var wbe;function Cbe(e,t,n,i){wbe||(wbe="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:wbe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function Abe(){const e=Li.useContext(ts.Z);return Li.useEffect((()=>{function t(t,n,i){t===e.vivaldiWindowId&&rbe.show(e,n,i)}function n(t,n,i,s){t===e.vivaldiWindowId&&Ke.Z.handleShortcut(e,n,i,s,e.document.activeElement)}function i(t,n){C.Z.get(I.kBiscuitLogRockerGestures)&&console.log("onRockerGesture",t,e.vivaldiWindowId,n),t===e.vivaldiWindowId&&ne.Z.handleRockerGesture(e,n)}se.Z.contextMenu.onDocumentMenu.addListener(t),se.Z.tabsPrivate.onKeyboardShortcut.addListener(n),se.Z.tabsPrivate.onRockerGesture.addListener(i);const s=function(e){const t={onDetection:hbe.bind(e),onGesture:gbe.bind(e),onClick:mbe.bind(e),onZoom:ybe.bind(e),onWheel:bbe.bind(e)};return se.Z.tabsPrivate.onMouseGestureDetection.addListener(t.onDetection),se.Z.tabsPrivate.onMouseGesture.addListener(t.onGesture),se.Z.tabsPrivate.onWebviewClickCheck.addListener(t.onClick),se.Z.tabsPrivate.onPageZoom.addListener(t.onZoom),e.document.addEventListener("wheel",t.onWheel,{passive:!1}),t}(e),o=lbe.Z.attachSpatnavListeners(e.vivaldiWindowId),a=cbe(e.document);return()=>{se.Z.contextMenu.onDocumentMenu.removeListener(t),se.Z.tabsPrivate.onKeyboardShortcut.removeListener(n),se.Z.tabsPrivate.onRockerGesture.removeListener(i),function(e,t){se.Z.tabsPrivate.onMouseGestureDetection.removeListener(t.onDetection),se.Z.tabsPrivate.onMouseGesture.removeListener(t.onGesture),se.Z.tabsPrivate.onWebviewClickCheck.removeListener(t.onClick),se.Z.tabsPrivate.onPageZoom.removeListener(t.onZoom),e.document.removeEventListener("wheel",t.onWheel,{passive:!1})}(e,s),lbe.Z.detachSpatnavListeners(o),a()}}),[e]),Cbe("svg",{version:"1.1",width:"0",height:"0",dangerouslySetInnerHTML:{__html:n(46639)}})}var Ibe,Tbe=n(80921),Zbe=n(80419),Ebe=n(34155);function kbe(e,t,n,i){Ibe||(Ibe="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Ibe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const _be=[I.kAddressBarPosition,I.kAppearanceDensity,I.kBookmarksBarDisplay,I.kBookmarksBarPosition,I.kKeyboardTabToAll,I.kKeyboardTabToAllUsesSystemDefault,I.kMenuDisplay,I.kMenuIconType,I.kPanelsPosition,I.kTabsAtEdge,I.kTabsBarPosition,I.kTabsBarWidth,I.kTabsCloseButtonLeft,I.kTabsStackingMode,I.kTabsTilingCollapseBorder,I.kThemesPreview,I.kThemeUseAnimation,I.kThemeDimBlurred,I.kThemeSimpleScrollbar,I.kThemesUser,I.kWindowsLinuxAltControls,I.kAddressBarVisible],Nbe=vi.Z.call(),Pbe=!1;const Dbe=(0,Ae.Z)(((e,t)=>{t?c.ZP.cycleByHistory(e,void 0,{goBack:!1}):c.ZP.cycleByOrder(e,void 0,{goBack:!1})}),0),Mbe=(0,Ae.Z)(((e,t)=>{t?c.ZP.cycleByHistory(e,void 0,{goBack:!0}):c.ZP.cycleByOrder(e,void 0,{goBack:!0})}),0);var Obe=kbe(Abe,{}),xbe=kbe(Fme,{});class Lbe extends Li.PureComponent{static contextType=ts.Z;refBookmarkAddedPopup=Li.createRef();refBreakmode=Li.createRef();refWebpageView=Li.createRef();refMainDialog=Li.createRef();isFirstStart=fi.isFirstStart();hasNotch=!1;constructor(e,t){super(e);const n=he.ZP.getWindowState(t.vivaldiWindowId),{theme:i}=Be.Z.getState(),s=Be.Z.getState().windowStyles.get(t.vivaldiWindowId)||Cs.ZP.getFallbackStyle(),o=Cs.ZP.createClassnames(i,s);if(!n)throw new Error("MainWindow constructor: Expected windowState");const a=Ome.getStartupDialogs();this.state={bookmarkDialogParent:!1,bookmarkDialogOptions:null,capturing:pr.getCapturingState(t.vivaldiWindowId),clearBrowsingHistoryOptions:null,confirmOpenLinksOptions:null,confirmCloseOtherTabs:null,onAfterCloseDialog:null,dialogCustomData:null,extensionErrors:[],importData:!1,isBreakModeActive:Ga.Z.getState().isActive,isDraggingButton:!1,panelWidth:Yn.ZP.getWidth(t.vivaldiWindowId)+6,mainDialogOptions:null,mainDialogType:null,openSession:!1,paneSelection:!1,preventAppRegionDrag:!1,quickCommandValue:"",saveSession:!1,saveSessionOptions:null,windowClassNames:o,windowStyle:s,windowState:n,theme:i,showPrivacyStats:!1,showBookmarkAddedPopup:!1,bookmarkAddedPopupOptions:null,startupDialogs:a,editToolbar:"",canShowContextDialog:!1,contextDialogQueue:[],contextDialog:null},this._updateKeyUIMode(),this.trackContextOnFocus=sse("content",t)}async componentDidMount(){const{selectWindow:e,vivaldiWindowId:t,screen:n}=this.context;Woe.addListener(this._onMainStoreChanged),Yn.ZP.addListener(this._onPanelStoreChanged),pr.addListener(this.#Jn),Ga.Z.addListener(this.onBreakModeStoreChanged),Be.Z.addListener(this.onThemeStoreChanged),ft.Z.addListener(this._onToolbarStoreChanged),he.ZP.addListener(this._onWindowStoreChanged,e),Ce.ZP.addListener(this._onPageStoreChanged),Ome.addListener(this._onStartupDialogsStoreChange),se.Z.windowPrivate.onToastMessage.addListener(this.onToast),se.Z.extensionActionUtils.onAdded.addListener(this.onActionAdded),se.Z.extensionActionUtils.onRemoved.addListener(this.onActionRemoved),se.Z.extensionActionUtils.onSidePanelOptionChanged.addListener(this.onSidepanelChanged),se.Z.extensionActionUtils.onExtensionDisabledInstallErrorAdded.addListener(this.onExtensionInstallErrorAdded),se.Z.extensionActionUtils.onExtensionDisabledInstallErrorRemoved.addListener(this.onExtensionInstallErrorRemoved),se.Z.extensionActionUtils.onSidePanelActionRequested.addListener(this.onSidePanelActionRequested),se.Z.utilities.onBroadcastMessage.addListener(this.onBroadcastMessageReceived),se.Z.utilities.onShowQRCode.addListener(this.onShowQRCode),se.Z.windowPrivate.onActiveTabStatusText.addListener(this._onActiveTabStatusText),se.Z.utilities.browserWindowReady(t),i.Z.contextMenus.removeAll()}componentDidUpdate(e,t){if(e.prefValues[I.kThemesPreview].length<this.props.prefValues[I.kThemesPreview].length){const e=Cs.ZP.getPreview();let t={};try{e&&(t=Cs.ZP.createStyle(e))}catch(e){console.warn("Broken theme format:",e)}e&&Object.keys(t).length?he.ZP.isActive(this.context.vivaldiWindowId)&&this.showDialog({dialogtype:"themePreview",themeName:e?.name||"",isUpdate:this.props.prefValues[I.kThemesUser].findIndex((t=>t.id===e?.id))>-1},null):he.ZP.isActive(this.context.vivaldiWindowId)&&this.showDialog({dialogtype:"themePreviewFailed"},null)}else e.prefValues[I.kThemesPreview].length>this.props.prefValues[I.kThemesPreview].length&&this.handleOnCloseDialog()}componentWillUnmount(){Woe.removeListener(this._onMainStoreChanged),Yn.ZP.removeListener(this._onPanelStoreChanged),pr.removeListener(this.#Jn),Ga.Z.removeListener(this.onBreakModeStoreChanged),ft.Z.removeListener(this._onToolbarStoreChanged),he.ZP.removeListener(this._onWindowStoreChanged),Be.Z.removeListener(this.onThemeStoreChanged),Ce.ZP.removeListener(this._onPageStoreChanged),Ome.removeListener(this._onStartupDialogsStoreChange),se.Z.windowPrivate.onToastMessage.removeListener(this.onToast),se.Z.utilities.onBroadcastMessage.removeListener(this.onBroadcastMessageReceived),se.Z.utilities.onShowQRCode.removeListener(this.onShowQRCode),se.Z.windowPrivate.onActiveTabStatusText.removeListener(this._onActiveTabStatusText),se.Z.extensionActionUtils.onAdded.removeListener(this.onActionAdded),se.Z.extensionActionUtils.onRemoved.removeListener(this.onActionRemoved),se.Z.extensionActionUtils.onSidePanelOptionChanged.removeListener(this.onSidepanelChanged),se.Z.extensionActionUtils.onExtensionDisabledInstallErrorAdded.removeListener(this.onExtensionInstallErrorAdded),se.Z.extensionActionUtils.onExtensionDisabledInstallErrorRemoved.removeListener(this.onExtensionInstallErrorRemoved),se.Z.extensionActionUtils.onSidePanelActionRequested.removeListener(this.onSidePanelActionRequested)}onSidepanelChanged=(e,t)=>{vr.Z.updateByExtension(e,t)};onActionAdded=e=>{vr.Z.addByExtension(this.context.vivaldiWindowId,e)};onActionRemoved=e=>{const t=vr.Z.getExtPanelId(e);t&&(jn.Z.setRemovedButton(this.context.vivaldiWindowId,I.kToolbarsPanel,t),vr.Z.removeByExtension(this.context.vivaldiWindowId,e))};onSidePanelActionRequested=(e,t)=>{if(!he.ZP.isActive(this.context.vivaldiWindowId))return;const n=vr.Z.getExtPanelIdFromExtensionId(e);if("show"===t)(0,Qf.VJ)(n,this.context.vivaldiWindowId)?jn.Z.showContent(this.context.vivaldiWindowId,n):vr.Z.installExtensionById(this.context.vivaldiWindowId,e)};onToast=(e,t)=>{this.context.vivaldiWindowId===e&&this.showDialog({dialogtype:"toast",text:t.body},null)};onExtensionInstallErrorAdded=e=>{this.setState((t=>({extensionErrors:t.extensionErrors.concat(e)})),(()=>{this.isFirstStart||this.showDialog({dialogtype:"extensionError",errors:this.state.extensionErrors},null)}))};onExtensionInstallErrorRemoved=e=>{this.setState((t=>{const n=t.extensionErrors.findIndex((t=>t.id===e.id));if(-1===n)return void console.info("onExtensionInstallErrorRemoved: Error not found from id.");const i=t.extensionErrors.slice();return i.splice(n,1),{extensionErrors:i}}))};#Jn=()=>{const e=pr.getCapturingState(this.context.vivaldiWindowId);e?this.clearAppRegion():this.restoreAppRegion(),this.setState({capturing:e})};onBreakModeStoreChanged=()=>{const e=Ga.Z.getState().isActive;this.setState({isBreakModeActive:e})};onThemeStoreChanged=()=>{const e=this.context.vivaldiWindowId,t=Be.Z.getState().windowStyles.get(e)||Cs.ZP.getFallbackStyle(),{theme:n}=Be.Z.getState();if(t!==this.state.windowStyle||n!==this.state.theme){const e=Cs.ZP.createClassnames(n,t);this.setState({windowClassNames:e,windowStyle:t,theme:n})}};_onToolbarStoreChanged=()=>{this.setState({editToolbar:ft.Z.getState()})};onDragStart=e=>{e.dataTransfer.getData("vivaldi/x-button-toolbar")&&this.setState({isDraggingButton:!0})};onDragEnd=e=>{this.state.isDraggingButton&&this.setState({isDraggingButton:!1})};storeQuickCommandSearch=e=>{this.setState({quickCommandValue:e})};closeStartupDialog=e=>{yi.closeDialog(e)};shouldShowStartupDialog=e=>!this.isFirstStart&&!he.ZP.isIncognitoOrGuest(this.context.vivaldiWindowId)&&this.state.startupDialogs.includes(e);canShowContextDialog=e=>{const t=Ce.ZP.getActivePage(this.context.vivaldiWindowId);return 0===this.state.startupDialogs.length&&!he.ZP.isIncognitoOrGuest(this.context.vivaldiWindowId)&&(e||!!t&&(e=>e===Ce.ZP.getStartpage(this.context.vivaldiWindowId))(t.url))};_onActiveTabStatusText=(e,t)=>{e===this.context.vivaldiWindowId&&u.Z.setStatus(e,t)};_updateKeyUIMode=()=>{const e=this.props.prefValues;if(e[I.kKeyboardTabToAllUsesSystemDefault]){const t=this.props.prefValues[I.kSystemMacKeyboardUiMode];2===t&&0!==e[I.kKeyboardTabToAll]?w.Z.set(I.kKeyboardTabToAll,0):0===t&&-1!==e[I.kKeyboardTabToAll]&&w.Z.set(I.kKeyboardTabToAll,-1)}};_allowPanelAutoClose=()=>null===this.state.mainDialogType||"MAIN_SHOW_TAB_CYCLER"===this.state.mainDialogType;_onMainStoreChanged=e=>{if(e.winId===this.context.vivaldiWindowId)switch(e.type){case"MAIN_SHOW_CONFIRM_OPEN_LINKS_DIALOG":this.showConfirmOpenLinksDialog(e.options);break;case"MAIN_SHOW_CONFIRM_CLOSE_OTHER_TABS_DIALOG":this.setConfirmCloseOtherTabsDialog(e.options);break;case"MAIN_SHOW_CLEAR_BROWSING_HISTORY_DIALOG":this.showClearBrowsingHistoryDialog();break;case"MAIN_SHOW_BOOKMARK_DIALOG":this.showBookmarkDialog(e.options);break;case"MAIN_SHOW_SAVE_SESSION_DIALOG":this.showSaveSession(e.options);break;case"MAIN_SHOW_OPEN_SESSION_DIALOG":this.showOpenSession();break;case"MAIN_SHOW_IMPORT_DATA_DIALOG":this.showDialog({dialogtype:"import"},null);break;case"MAIN_SHOW_MAIL_INFO_DIALOG":this.showDialog({dialogtype:"mailInfo"},null);break;case"MAIN_SHOW_PAGE_ACCESS_KEYS":{const t=Ce.ZP.getActivePage(this.context.vivaldiWindowId);t&&!(0,rl.xl)(t.url)&&this.toggleMainDialog(e.type);break}case"MAIN_SHOW_KEYBOARDS_SHORTCUTS":case"MAIN_SHOW_QUICKCOMMANDS":case"MAIN_SHOW_MAIL_ACCOUNT_DIALOG":case"MAIN_SHOW_CALENDAR_ACCOUNT_DIALOG":case"MAIN_SHOW_CREATE_CALENDAR_DIALOG":case"MAIN_SHOW_CREATE_LABEL":case"MAIN_SHOW_LABEL_FLAG_DIALOG":this.toggleMainDialog(e.type);break;case"MAIN_SHOW_CALENDAR_EDIT_EVENT":case"MAIN_SHOW_CALENDAR_EDIT_TEMPLATE":case"MAIN_SHOW_CALENDAR_IMPORT_EVENTS_DIALOG":case"MAIN_SHOW_ENABLE_SESSION_AUTOSAVE_DIALOG":case"MAIN_SHOW_MAIL_AUTHENTICATION_DIALOG":case"MAIN_SHOW_MAIL_DELETE_DIALOG_ACCOUNTS":case"MAIN_SHOW_MAIL_DELETE_DIALOG_CONFIRM_ALL":case"MAIN_SHOW_MAIL_DELETE_DIALOG_FOLDERS":case"MAIN_SHOW_MAIL_UNSUBSCRIBE_DIALOG":case"MAIN_SHOW_MAIL_UPLOAD_CONFIRMATION":case"MAIN_SHOW_MAIL_MESSAGE_MOVE_CONFIRMATION":case"MAIN_SHOW_MAIL_CREATE_ARCHIVE_FOLDER_CONFIRMATION":case"MAIN_SHOW_TOOLBAR_RESET":case"MAIN_SHOW_ACCOUNT_SHEET":case"MAIN_SHOW_MODAL_INFO":case"MAIN_SHOW_ENABLE_WORKSPACE_DIALOG":case"MAIN_SHOW_INCLUDE_WORKSPACE_DIALOG":case"MAIN_SHOW_WORKSPACE_DIALOG":case"MAIN_SHOW_NOTE_SELECTION_DIALOG":case"MAIN_SHOW_MAIL_DELETE_DIALOG_SETTING":this.toggleMainDialog(e.type,e.options);break;case"MAIN_SHOW_ADD_FEED":case"MAIN_SHOW_ADD_MAIL_FOLDER":case"MAIN_SHOW_ADD_FEED_FOLDER":case"MAIN_SHOW_DELETE_LABEL_CONFIRMATION":case"MAIN_SHOW_DELETE_FILTER_CONFIRMATION":case"MAIN_SHOW_DELETE_FEED_CONFIRMATION":case"MAIN_SHOW_MAIL_VIEW_FILTER_CONFIRMATION":case"MAIN_SHOW_DELETE_MAIL_FOLDER":case"MAIN_SHOW_DELETE_FEED_FOLDER":case"MAIN_SHOW_DELETE_WORKSPACE":he.ZP.isActive(this.context.vivaldiWindowId)&&this.toggleMainDialog(e.type,e.options);break;case"MAIN_SHOW_MODAL_DIALOG":case"MAIN_SHOW_CALENDAR_ALARM":this.state.mainDialogType!==e.type?this.toggleMainDialog(e.type,e.options):this.state.mainDialogOptions?.windowToRestore||"number"!=typeof e.options.windowToRestore||this.setState({mainDialogOptions:e.options});break;case"MAIN_SHOW_CONTEXT_DIALOG":this.maybeShowContextDialog(e.options.force,e.options.id);break;case"MAIN_SELECTING_TOOLBAR":this.setPaneSelection(e.options.enable);break;case"MAIN_SHOW_DIALOG":this.showDialog(e.options,e.onAfterClose);break;case"MAIN_SHOW_BOOKMARK_ADDED_POPUP":this.props.prefValues[I.kAddressBarVisible]&&!he.ZP.isMinimalUI(this.context.vivaldiWindowId)||this.showBookmarkAddedPopup(e.options);break;case"MAIN_SHOW_PRIVACY_STATS":this.showPrivacyStats()}};_onPanelStoreChanged=()=>{this.setState({panelWidth:Yn.ZP.getWidth(this.context.vivaldiWindowId)+6})};onCloseMainDialog=()=>new Promise((e=>{this.setState({mainDialogType:null,mainDialogOptions:null},e)}));setPaneSelection=e=>{this.setState({paneSelection:e})};toggleMainDialog=(e,t)=>{this.state.mainDialogType===e?this.onCloseMainDialog():this.setState({mainDialogType:e,mainDialogOptions:t||null})};handleTabSwitcherActivation=e=>{const t=this.refMainDialog.current?.refVisualTabSwitcher.current;if(!e&&t){const e=t.state.selected;c.ZP.activateTab(e.id,this.context.vivaldiWindowId)}this.onCloseMainDialog()};switchTabVisualTabSwitcher=(e,t,n)=>{if(!n&&"wheel"!==e?.type)return void((e,t)=>{const n=C.Z.get(I.kTabsCycleByRecentOrder);t?Dbe(e,n):Mbe(e,n)})(this.context.vivaldiWindowId,t);if(Ce.ZP.getPages(this.context.vivaldiWindowId).size<2)return;const{mainDialogType:i}=this.state;if("MAIN_SHOW_TAB_CYCLER"===i){const e=this.refMainDialog.current?.refVisualTabSwitcher.current;t?e?.selectForward():e?.selectBack()}else this.toggleMainDialog("MAIN_SHOW_TAB_CYCLER",{forward:t}),(0,Zbe.g)(e,this.handleTabSwitcherActivation,this.context.document)};_onWindowStoreChanged=()=>{const e=this.context.vivaldiWindowId,t=he.ZP.getWindowState(e);t&&this.setState({windowState:t})};maybeShowContextDialog=(e,t)=>{const n=this.canShowContextDialog(e);(n||t)&&this.setState((i=>{const s=[...i.contextDialogQueue];t&&!s.includes(t)&&(e?s.unshift(t):s.push(t));return{contextDialog:!i.contextDialog&&n&&s.length?s.shift():i.contextDialog,contextDialogQueue:s,canShowContextDialog:n}}))};_onPageStoreChanged=()=>{this.maybeShowContextDialog(!1)};_onStartupDialogsStoreChange=()=>{const e=Ome.getStartupDialogs();this.setState({startupDialogs:e})};onBroadcastMessageReceived=e=>{e.startDragging?this.clearAppRegion():e.endDragging&&this.restoreAppRegion()};_onMacMenuAction=(e,t,n)=>{e!==this.context.vivaldiWindowId||he.ZP.isMinimized(e)||Ge.Z.executeLocalAction(e,t,n)||ne.Z.executeActions("menu",this.context,t)};_onMacWindowDidChangeScreens=(e,t)=>{e===this.context.vivaldiWindowId&&(this.hasNotch=t)};clearAppRegion=()=>{this.setState({preventAppRegionDrag:!0})};restoreAppRegion=()=>{this.setState({preventAppRegionDrag:!1})};handleDoubleClick=()=>{"top"===this.props.prefValues[I.kTabsBarPosition]&&this.state.windowState.nativeDecorations?c.ZP.openURL(this.context.vivaldiWindowId,""):he.ZP.isMaximized(this.context.vivaldiWindowId)||(he.ZP.isFullscreen(this.context.vivaldiWindowId),0)?xi.Z.restore(this.context.vivaldiWindowId):xi.Z.maximize(this.context.vivaldiWindowId)};closeConfirmOpenLinksDialog=()=>{this.setState({confirmOpenLinksOptions:null})};showConfirmOpenLinksDialog=e=>{this.setState({confirmOpenLinksOptions:e})};setConfirmCloseOtherTabsDialog=e=>{this.setState({confirmCloseOtherTabs:e})};showClearBrowsingHistoryDialog=()=>{he.ZP.isIncognitoOrGuest(this.context.vivaldiWindowId)||this.setState({clearBrowsingHistoryOptions:!0})};closeClearBrowsingHistoryDialog=()=>{this.setState({clearBrowsingHistoryOptions:null})};closeImportContacts=()=>{this.setState({importData:Boolean(this.refWebpageView.current)})};showBookmarkDialog=e=>{this.setState({bookmarkDialogParent:Boolean(this.refWebpageView.current),bookmarkDialogOptions:e})};showBookmarkAddedPopup=e=>{this.setState({showBookmarkAddedPopup:!0,bookmarkAddedPopupOptions:e})};closeBookmarkDialog=()=>{this.setState({bookmarkDialogParent:!1})};onShowQRCode=e=>{this.showDialog({dialogtype:"qrcode",url:e},null)};closeSaveSession=()=>{this.setState({saveSession:!1})};showSaveSession=e=>{this.setState({saveSession:Boolean(this.refWebpageView.current),saveSessionOptions:e})};closeOpenSession=()=>{this.setState({openSession:!1})};showOpenSession=()=>{this.setState({openSession:Boolean(this.refWebpageView.current)})};showDialog=(e,t)=>{this.setState({dialogCustomData:e,onAfterCloseDialog:t})};showPrivacyStats=()=>{this.setState({showPrivacyStats:!0})};handleOnCloseDialog=()=>{this.setState({dialogCustomData:null}),Ebe.nextTick((()=>{this.state.onAfterCloseDialog?.()}))};hasHorizontalMenu=()=>Boolean("top"===this.props.prefValues[I.kMenuDisplay]&&!0);showTitleBar=e=>{const{html5FullScreen:t,state:n,type:i}=e;return(0,lre.v)(e)||t||"fullscreen"!==n&&("popup"===i||"settings"===i)};getBrowserClasses=(e,t)=>{const{prefValues:n}=this.props,{visibleUI:i,type:s,active:o,state:a,nativeDecorations:r}=t,{addressBar:l,bookmarksBar:d,tabs:c}=i,{windowClassNames:u,isBreakModeActive:p,isDraggingButton:h,preventAppRegionDrag:g,paneSelection:m,editToolbar:f}=this.state,v=n[I.kTabsBarPosition],y=(0,he.WV)(t),b="settings"===s,S="normal"===s,w="popup"===s,C="substrip"===n[I.kTabsStackingMode],A="accordion"===n[I.kTabsStackingMode],T="bottom"===v||"top"===v,Z="maximized"===a||"fullscreen"===a,E=n[I.kAddressBarPosition],k=n[I.kBookmarksBarPosition],_=c&&S?v:"off",N=n[I.kTabsAtEdge]&&!n[I.kAppearanceDensity]&&T&&Z,P=this.hasHorizontalMenu();return Fi()(Nbe,y,{...u,"minimal-ui":he.ZP.isMinimalUI(e),"disable-titlebar":!this.showTitleBar(t),hasfocus:o,isblurred:!o,native:r,popup:w,"is-settingspage":b,RTL:R.ZP.isRTL(),"simple-scrollbar":n[I.kThemeSimpleScrollbar],"density-on":n[I.kAppearanceDensity],"dim-blurred":n[I.kThemeDimBlurred],"horizontal-menu":P,[`menu-${n[I.kMenuIconType]}`]:!P&&!0,"tabs-at-edge":N,alt:n[I.kWindowsLinuxAltControls]&&false,"alt-tabs":n[I.kTabsCloseButtonLeft],"substrip-tabs-on":C,"accordion-tabs-on":A,"full-key-access":0===n[I.kKeyboardTabToAll],"break-mode":p,[`stacks-${n[I.kTabsStackingMode]}`]:!0,[`address-${E}`]:l,[`address-${E}-off`]:!l,[`bookmark-bar-${k}`]:d,[`bookmark-bar-${k}-off`]:!d,[`tabs-${_}`]:!0,"narrow-tiling":n[I.kTabsTilingCollapseBorder],"is-dragging-button":h,"no-app-dragging":g,"active-pane-selection":m,"animation-off":!n[I.kThemeUseAnimation],"toolbar-edit-mode":""!==f})};onInnerOver=e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"};onInnerClick=()=>tp.Z.stopEditing();onInnerDrop=e=>{e.preventDefault();const t=e.dataTransfer.getData(Qae),n=e.dataTransfer.getData(Xae);if("toolbar-editor"!==n){const e=[...C.Z.get(n)],i=e[t];e.splice(parseInt(t),1),Ju.ZP.isWebPanel(i)&&vr.Z.removeById(i,n),w.Z.set(n,e)}};render(){const e=this.props.prefValues,{capturing:t}=this.state,n=""!==this.state.editToolbar,i=e[I.kTabsBarPosition],{html5FullScreen:s,state:o,visibleUI:a,inert:r=!1}=this.state.windowState,l="left"===i||"right"===i?{[`padding${(0,Tbe.Z)(i)}`]:e[I.kTabsBarWidth]}:void 0,d="fullscreen"===o&&!(a.tabs&&"top"===i);return kbe("div",{id:"browser",lang:R.ZP.UI_LANGUAGE,className:this.getBrowserClasses(this.context.vivaldiWindowId,this.state.windowState),style:this.state.windowStyle,onDragStart:n?this.onDragStart:null,onDragEnd:n?this.onDragEnd:null,onDrop:n?this.onDragEnd:null},void 0,kbe(Lu,{level:"nothing"},void 0,Obe,kbe("div",{id:"header",onDoubleClick:this.handleDoubleClick},void 0,this.showTitleBar(this.state.windowState)&&kbe(qve,{isHidden:d,native:this.state.windowState.nativeDecorations,isPopupWindow:!1,tabPosition:a.tabs?i:"none",keyAccess:e[I.kKeyboardTabToAll],inert:r}),this.hasHorizontalMenu()&&kbe(bye,{inert:r}),("top"===i||!a.tabs)&&kbe(jve,{switchTabVisualTabSwitcher:this.switchTabVisualTabSwitcher,mainDialogType:this.state.mainDialogType,tabPosition:i,theme:this.state.theme,visible:a.tabs,inert:r},"tabbar")),kbe("div",{id:"main",className:e[I.kPanelsPosition]},void 0,kbe(mre,{native:this.state.windowState.nativeDecorations,fullScreenState:false,size:"large",windowState:this.state.windowState}),a.bookmarksBar&&kbe(Ua,{display:e[I.kBookmarksBarDisplay],statusOff:"off"===a.statusBar,keyAccess:e[I.kKeyboardTabToAll],inert:r}),this.shouldShowStartupDialog("DIALOG_DEFAULT_BROWSER")&&kbe(Dme,{onClose:()=>this.closeStartupDialog("DIALOG_DEFAULT_BROWSER")}),kbe("div",{className:"inner",onClick:n?this.onInnerClick:null,onDragEnter:n?e=>e.preventDefault():null,onDragOver:n?this.onInnerOver:null,onDrop:n?this.onInnerDrop:null},void 0,this.state.dialogCustomData&&kbe(Pu,{customData:this.state.dialogCustomData,closeDialog:this.handleOnCloseDialog}),this.state.confirmOpenLinksOptions&&kbe(Or,{options:this.state.confirmOpenLinksOptions,onRequestClose:this.closeConfirmOpenLinksDialog}),this.state.confirmCloseOtherTabs&&kbe(Dr,{options:this.state.confirmCloseOtherTabs,onRequestClose:()=>this.setConfirmCloseOtherTabsDialog(null)}),this.state.clearBrowsingHistoryOptions&&kbe(Nr,{onClose:this.closeClearBrowsingHistoryDialog}),this.state.bookmarkDialogParent&&this.state.bookmarkDialogOptions&&kbe(ua,{onClose:this.closeBookmarkDialog,options:this.state.bookmarkDialogOptions}),this.state.saveSession&&this.state.saveSessionOptions&&kbe(wme,{onClose:this.closeSaveSession,options:this.state.saveSessionOptions}),!he.ZP.isIncognitoOrGuest(this.context.vivaldiWindowId)&&xbe,this.shouldShowStartupDialog("DIALOG_RAZER_CHROMA_FOUND")&&kbe(mme,{onClose:()=>this.closeStartupDialog("DIALOG_RAZER_CHROMA_FOUND")}),this.shouldShowStartupDialog("DIALOG_INFORM_MEDIA_WIN_N")&&kbe(Yu,{onClose:()=>this.closeStartupDialog("DIALOG_INFORM_MEDIA_WIN_N")}),this.shouldShowStartupDialog("DIALOG_INFORM_GIT_DIRECTORY_FOUND")&&kbe(Hu,{onClose:()=>this.closeStartupDialog("DIALOG_INFORM_GIT_DIRECTORY_FOUND")}),this.shouldShowStartupDialog("DIALOG_SEARCH_ENGINE_SWITCH")&&kbe(kme,{onClose:()=>this.closeStartupDialog("DIALOG_SEARCH_ENGINE_SWITCH")}),this.shouldShowStartupDialog("DIALOG_EXTENSION_INSTALL_ERROR")&&kbe(yl,{errors:this.state.extensionErrors,onClose:()=>this.closeStartupDialog("DIALOG_EXTENSION_INSTALL_ERROR")}),this.state.openSession&&kbe(Yce,{onClose:this.closeOpenSession}),this.state.showPrivacyStats&&kbe(dme,{onClose:()=>this.setState({showPrivacyStats:!1})}),kbe(Lge,{position:e[I.kPanelsPosition],outsideClickIgnoreClass:"panel-clickoutside-ignore",editToolbar:n,canAutoClose:this._allowPanelAutoClose,inert:!n&&r},"panel"),kbe("div",{className:"tabbar-wrapper"},"webview-anchor","left"===i&&a.tabs&&kbe(jve,{switchTabVisualTabSwitcher:this.switchTabVisualTabSwitcher,mainDialogType:this.state.mainDialogType,tabPosition:i,theme:this.state.theme,visible:a.tabs,inert:r},"tabbar")),(0,ss.jsx)("div",{ref:this.refWebpageView,id:"webview-container",role:"document",inert:r||n?"true":null,onFocus:this.trackContextOnFocus,children:kbe(Wye,{cycleFocus:C.Z.get(I.kWebpagesFocusTrap)})}),!(0,Qf.PK)("StatusInfo",this.context.vivaldiWindowId)&&!s&&kbe(Wse,{name:"StatusOverlay",draggable:!1,style:{[e[I.kPanelsPosition]]:this.state.panelWidth,...l}}),"right"===i&&a.tabs&&kbe(jve,{switchTabVisualTabSwitcher:this.switchTabVisualTabSwitcher,mainDialogType:this.state.mainDialogType,tabPosition:i,theme:this.state.theme,visible:a.tabs,inert:r},"tabbar"))),kbe("footer",{id:"footer",inert:!n&&r?"inert":null},void 0,"bottom"===i&&a.tabs&&kbe(jve,{switchTabVisualTabSwitcher:this.switchTabVisualTabSwitcher,mainDialogType:this.state.mainDialogType,tabPosition:i,theme:this.state.theme,visible:!0,inert:r},"tabbar"),"on"===a.statusBar&&kbe(tre,{name:I.kToolbarsStatus,label:(0,B.Z)("toolbar label","Status"),menuOrigin:"bottomLeft",className:"toolbar-statusbar",popupPosition:"above",size:"medium"})),this.state.mainDialogType&&(0,ss.jsx)(Pce,{ref:this.refMainDialog,onClose:this.onCloseMainDialog,dialog:this.state.mainDialogType,options:this.state.mainDialogOptions,quickCommandValue:this.state.quickCommandValue,storeQuickCommandSearch:this.storeQuickCommandSearch}),this.state.contextDialog&&kbe(il,{winId:this.context.vivaldiWindowId,onClose:()=>{this.setState({canShowContextDialog:!1,contextDialog:null})},dialogId:this.state.contextDialog}),n&&kbe(sye,{toolbar:this.state.editToolbar}),kbe(EI.Z,{classNames:"HUD",in:this.state.isBreakModeActive,mountOnEnter:!0,unmountOnExit:!0,timeout:{enter:500,exit:100},nodeRef:this.refBreakmode},void 0,(0,ss.jsx)("button",{ref:this.refBreakmode,className:"HUD",onClick:Ha.Z.toggleBreakMode,dangerouslySetInnerHTML:{__html:Wi._qK.large}})),!this.state.windowState.visibleUI.addressBar&&kbe(EI.Z,{in:this.state.showBookmarkAddedPopup,classNames:"Bookmark-Added-Popup",mountOnEnter:!0,unmountOnExit:!0,onExited:()=>this.setState({bookmarkAddedPopupOptions:null}),timeout:{enter:300,exit:150},nodeRef:this.refBookmarkAddedPopup},void 0,(0,ss.jsx)("div",{ref:this.refBookmarkAddedPopup,className:"Bookmark-Added-Popup",children:this.state.bookmarkAddedPopupOptions&&kbe(Jo,{options:this.state.bookmarkAddedPopupOptions,onClose:()=>this.setState({showBookmarkAddedPopup:!1})})})),t&&kbe(dr,{capturing:t,winId:this.context.vivaldiWindowId})))}}const Rbe=(0,Bu.Z)(Lbe,_be);var Bbe;function Fbe(e,t,n,i){Bbe||(Bbe="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Bbe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class Wbe extends Li.Component{render(){const e=this.props.page;return Fbe("div",{className:"inner"},void 0,Fbe(nse,{id:e.id,pageContext:e.context,url:e.url,target:e.target,vivExtData:e.vivExtData,showImageInspector:e.showImageInspector,discarded:e.discarded,isVisible:!0,contentWidth:0,contentHeight:0,isActive:this.props.active,supportsReaderMode:e.supportsReaderMode,pinned:!1},`page-component-${e.id}`))}}const Ube=Wbe;var Vbe;function Hbe(e,t,n,i){Vbe||(Vbe="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Vbe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Gbe=[I.kAddressBarPosition,I.kAppearanceDensity,I.kKeyboardTabToAll,I.kThemeDimBlurred,I.kThemeSimpleScrollbar,I.kThemeUseAnimation,I.kWindowsLinuxAltControls];function $be(e){const{html5FullScreen:t,state:n,type:i}=e;return(0,lre.v)(e)||t||"fullscreen"!==n&&("popup"===i||"settings"===i)}function Kbe(e){const{vivaldiWindowId:t,selectWindow:n}=e,[i,s]=Li.useState(!1);const o=(0,DD.Z)(Be.Z),a=(0,DD.Z)(he.ZP,n),r=(0,Ya.Z)(Gbe),l=a.get(t),{theme:d,windowStyles:c}=o,u=c.get(t);if(!l||!u)return;const p=function(e,t,n,i,s){const{visibleUI:o,type:a,active:r,nativeDecorations:l}=t,d=i[I.kAddressBarPosition],c=(0,he.WV)(t);return Fi()(vi.Z.call(),c,{...n,"minimal-ui":(0,he.TF)(t),"disable-titlebar":!$be(t),hasfocus:r,isblurred:!r,native:l,normal:!1,popup:"popup"===a,"is-settingspage":"settings"===a,"simple-scrollbar":i[I.kThemeSimpleScrollbar],"density-on":i[I.kAppearanceDensity],"dim-blurred":i[I.kThemeDimBlurred],"animation-off":!i[I.kThemeUseAnimation],alt:i[I.kWindowsLinuxAltControls]&&!1,[`address-${d}`]:o.addressBar,[`address-${d}-off`]:!o.addressBar,"tabs-off":!0})}(0,l,Cs.ZP.createClassnames(d,u),r);return{windowStyle:u,titleBarEnabled:$be(l),className:p,keyAccess:r[I.kKeyboardTabToAll],nativeDecorations:l.nativeDecorations}}var zbe,jbe=Hbe(Abe,{});function Ybe(e){const t=Kbe(Li.useContext(ts.Z));if(!t)return null;const{className:n,titleBarEnabled:i,windowStyle:s,keyAccess:o,nativeDecorations:a}=t;return Hbe("div",{id:"browser",style:s,className:n},void 0,jbe,Hbe("div",{id:"header"},void 0,i&&Hbe(qve,{isHidden:!1,tabPosition:"none",isPopupWindow:!0,keyAccess:o,native:a,inert:!1})),Hbe("div",{id:"main"},void 0,Hbe(Lu,{level:"title_bar"},void 0,e.children)))}function Xbe(e,t,n,i){zbe||(zbe="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:zbe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Qbe=[I.kAddressBarPosition];function qbe(e){const t=Ce.ZP.unsafeGetActivePage(e);return{page:t,url:t.url,id:t.id,active:he.ZP.isActive(e),favIconUrl:t.favIconUrl}}class Jbe extends Li.PureComponent{static contextType=ts.Z;state=qbe(this.context.vivaldiWindowId);componentDidMount(){const{selectWindow:e}=this.context;Ce.ZP.addListener(this.onPageStoreChanged,e),he.ZP.addListener(this.onWindowStoreChanged,e),this.updateTitle()}componentWillUnmount(){Ce.ZP.removeListener(this.onPageStoreChanged),he.ZP.removeListener(this.onWindowStoreChanged)}onWindowStoreChanged=()=>{this.setState({active:he.ZP.isActive(this.context.vivaldiWindowId)})};onPageStoreChanged=()=>{this.setState(qbe(this.context.vivaldiWindowId),(()=>{this.updateTitle()}))};updateTitle=()=>{const e=(0,pn.d6)(this.state.page.url,this.state.page.title);this.context.document.title!==e&&(this.context.document.title=e)};_onMacMenuAction=(e,t,n)=>{e!==this.context.vivaldiWindowId||he.ZP.isMinimized(e)||Ge.Z.executeLocalAction(e,t,n)||ne.Z.executeActions("menu",this.context,t)};render(){const e="top"===this.props.prefValues[I.kAddressBarPosition],t=e?"bottomLeft":"topLeft",n=e?"below":"above";return Xbe(Ybe,{},void 0,Xbe("div",{className:"mainbar"},void 0,Xbe("div",{className:"toolbar toolbar-mainbar toolbar-large"},void 0,Xbe(Oi.Z.isEnabled("omnibox")?Soe:mse,{readonly:!0,url:this.state.url,id:this.state.id,pageContext:this.state.page.context,supportsReaderMode:this.state.page.supportsReaderMode,isReaderModeActive:Boolean(this.state.page.vivExtData.readerMode),active:this.state.active,favIconUrl:this.state.favIconUrl,popupPosition:n,menuOrigin:t}),Xbe(Jm.C,{name:"Extensions",customizeMenu:()=>[],size:"large",popupPosition:n,menuOrigin:t}))),0!==this.state.id&&Xbe(Ube,{page:this.state.page,active:this.state.active}))}}const eSe=(0,Bu.Z)(Jbe,Qbe);var tSe,nSe;function iSe(e,t,n,i){tSe||(tSe="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:tSe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function sSe(e){const t=Li.useContext(ts.Z);return Li.useEffect((()=>{function e(e){w.Z.set(I.kSettingsSizeWidth,Math.max(t.outerWidth,p.MK)),w.Z.set(I.kSettingsSizeHeight,Math.max(t.outerHeight,p.mR)),w.Z.set(I.kSettingsSizeLeft,t.screenLeft),w.Z.set(I.kSettingsSizeTop,t.screenTop)}return se.Z.windowPrivate.onWindowClosed.addListener(e),()=>{se.Z.windowPrivate.onWindowClosed.removeListener(e)}}),[t]),iSe(Ybe,{},void 0,iSe("div",{className:"webpageview"},void 0,iSe(u3,{url:n3+e.settingsCategory})))}function oSe(e,t,n,i){nSe||(nSe="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:nSe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class aSe extends Li.PureComponent{state={appElm:void 0,contentWindow:void 0};onAppWindowCreated=async(e,t)=>{const n=t.document;if(!n.body)return void console.error(`Application document creation failed: ${e}`);const i=n.body.appendChild(n.createElement("div"));i.id="app",this.setState({appElm:i,contentWindow:t})};onWebContentsHasWindow=async(e,t)=>{if(e===this.props.windowId){if(se.Z.windowPrivate.onWebContentsHasWindow.removeListener(this.onWebContentsHasWindow),t||(t=i.Z.extension.getViews().find((t=>t.vivaldiWindowId===e))),!t)throw new Error("BrowserWindow ContentWindow does not exist.");await this.onAppWindowCreated(e,t)}};componentDidMount(){const e=i.Z.extension.getViews().find((e=>e.vivaldiWindowId===this.props.windowId));e&&this.props.windowId?this.onWebContentsHasWindow(this.props.windowId,e):se.Z.windowPrivate.onWebContentsHasWindow.addListener(this.onWebContentsHasWindow)}componentWillUnmount(){const{contentWindow:e}=this.state;e?e.close():console.error("WindowPortal.componentWillUnmount: Expected to find contentWindow")}render(){const{appElm:e,contentWindow:t}=this.state;return e&&t?KO.createPortal(oSe(ts.Z.Provider,{value:t},void 0,oSe(Lu,{level:"nothing"},void 0,this.props.children)),e):null}}const rSe=aSe;var lSe;function dSe(e,t,n,i){lSe||(lSe="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:lSe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var cSe=dSe(Rbe,{}),uSe=dSe(eSe,{});class pSe extends Li.PureComponent{state={windows:he.ZP.getState()};componentDidMount(){he.ZP.addListener(this._onWindowStoreChanged)}componentWillUnmount(){he.ZP.removeListener(this._onWindowStoreChanged)}_onWindowStoreChanged=()=>{const e=he.ZP.getState();e.size!==this.state.windows.size&&this.setState({windows:e})};renderWindows=()=>{const e=[];for(const[t,n]of this.state.windows){let i;"normal"===n.type?i=cSe:"popup"===n.type?i=uSe:"settings"===n.type&&(i=dSe(sSe,{settingsCategory:he.ZP.settingsCategory})),i&&e.push(dSe(rSe,{windowId:t},t,i))}return e};render(){return dSe("div",{lang:R.ZP.UI_LANGUAGE},void 0,this.renderWindows())}}const hSe=pSe;var gSe=n(11795),mSe=n.n(gSe);const fSe=function(){const e=g.Z.getSpeeddialFolders();if(!e||0===e.length||!e[0].children)return;const t=e[0].children.map((e=>e.url?{title:e.title,url:e.url}:void 0)).filter(Boolean);se.Z.bookmarksPrivate.updateSpeedDialsForWindowsJumplist(t)};const vSe={start:function(){fSe(),g.Z.addListener(fSe)}};n(34155);function ySe(e,t){return e.displayName=t,mSe().log(e)()}function bSe(e,t){const n=Date.now(),i=e(),s=Date.now();return console.log(`Non-promise from ${t||"[anonymous]"} with time ${s-n} ms`),i}navigator.serviceWorker?.ready.then((()=>tn.Z.open()));async function SSe(){const e=await se.Z.utilities.getSystemDateFormat();e.longDateFormat&&W().defineLocale(R.ZP.fixMomentLocale(i.Z.i18n.getUILanguage())+"-viv",R.ZP.getLocale(e))}console.time("JS init startup"),(0,v.MD)();try{if(!o)throw new Error("Expected portalWindow to be defined");const e=document.getElementById("portals");if(!e)throw"No root element.";!async function(e){A.Z.reorderRegistrations([J.Z,Kt,Dt,Ce.ZP,Yn.ZP]),window.isGuestSession=await se.Z.runtimePrivate.isGuestSession(),await Promise.all([ySe(C.Z.loadPromise,"PrefsCache").then((()=>ySe(Dn.Z.loadPromise,"vivaldiSettings"))).then((()=>Promise.all([ySe(xi.Z.loadPromise,"WindowActions").then((()=>ySe(ki.Z.loadPromise,"ThemeActions"))),ySe(ai.Z.load,"SearchEngineCache")]))),ySe(Oi.Z.loadPromise,"VivaldiFeatureFlags"),ySe(ke.loadPromise,"ExtensionActions"),SSe()]),c.ZP.load(),CQ.Z.init();const t=(0,qfe.s)(e);await new Promise((e=>t.render((0,ss.jsx)(hSe,{ref:e})))),_e.Z.initFastForward(),si.Z.init(),_i.Z.init(),jn.Z.init();const n=window.isGuestSession?Promise.resolve():ySe(ee.Z.loadPromise,"BookmarkActions"),s=Oi.Z.isEnabled("omnibox")?Promise.resolve():ySe(ri.Z.load,"SearchFieldActionsDeprecated");await Promise.all([ySe((()=>le.loadPromise().then((()=>ySe(ne.Z.loadPromise,"CommandActions")))),"ContentScriptActions"),ySe(Qe.Z.loadPromise,"Menu"),ySe(zn.Z.loadPromise,"NoteActions"),n,ySe(Me.loadPromise,"HistoryActions"),ySe(wi.loadPromise,"SyncActions"),ySe(Ni.Z.loadPromise,"TrashActions"),ySe(Di.loadPromise,"VivaldiAccountActions"),ySe(HQ.Z.loadPromise,"WorkspaceLinkRoutingActions"),bSe(T,"DashboardActions"),bSe(L,"StickyNoteActions"),bSe(z,"TimerActions"),bSe(Q,"WeatherActions"),bSe(x.S1,"ReadingListActions"),s,ySe(Xn.Z.load,"PeriodicReloadActions"),ySe(li.Z.loadPromise,"SessionActions"),ySe(He.loadPromise,"HueActions")&&void 0,ySe(Ee.Z.load,"DownloadActions")&&void 0,ySe((()=>Kn.startPortalLoad()),"Mail")&&void 0,ySe(Ei.loadPromise,"SyncedTabsActions"),ySe(Ze.init,"ContextDialogActions"),ySe(pi.loadPromise,"SharedLinksActions"),ySe(yi.init,"StartupDialogsActions")]),bSe(vSe.start,"updateJumplist"),i.Z.extension.inIncognitoContext||(te.ZP.init(),oi.initPortalDocument()),ii.init(),se.Z.utilities.cleanUnusedImages(0),console.timeEnd("JS init startup")}(e)}catch(e){console.log("Startup Process Failure: "+e)}},63164:(e,t,n)=>{"use strict";n.d(t,{Tg:()=>a,VN:()=>o,eL:()=>r});var i=n(92292);const s=new Map;function o(e,t,n){return i.Z.tabs.sendMessage(e,t,n)}function a(e){const t=(t,n,s)=>{i.Z.runtime.id===n.id&&e(t,n,s)};return s.set(e,t),i.Z.runtime.onMessage.addListener(t)}function r(e){const t=s.get(e);t&&(i.Z.runtime.onMessage.removeListener(t),s.delete(e))}},58379:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var i=n(92292);function s(){return i.Z.topSites.get().catch((()=>[]))}},27770:(e,t,n)=>{"use strict";n.d(t,{TR:()=>y,ZP:()=>S,yR:()=>v});var i=n(59486),s=n(46382),o=n(59322),a=n(29087),r=n(63153),l=n(92292),d=n(98010),c=n(45454),u=n(7064),p=n(30460),h=n(36436),g=n(44850),m=n(89175),f=n(1407);const v="vivaldi/x-bookmarks";function y(e){return!(0,g.$0)(e)}const b={openUrls:function(e,t,n,i){const s=t.map((e=>({...this.getEmptyNode(),url:e})));this.open(e,s,n,i)},open:function(e,t,n,o){if(o&&a.Z.get(m.kBookmarksConfirmOpening)&&t.length>=a.Z.get(m.kBookmarksConfirmOpeningThreshold))s.Z.showConfirmOpenLinksDialog(e,{urls:t.map((({url:e})=>e)).filter(Boolean),openOptions:{inCurrent:n.inCurrent,inNewWindow:n.inNewWindow,inBackground:n.inBackground,incognito:n.incognito,allowOverride:!1}});else{let s=!1===n.inCurrent;const o=!0===n.inNewWindow;let l=!0===n.inBackground;const d=!0===n.incognito;if(!1===s&&!1===o&&!1===l&&!0===n.allowOverride&&(!0===a.Z.get(m.kBookmarksOpenInNewTab)&&(s=!0,!0===a.Z.get(m.kTabsOpenNewInBackground)&&(l=!0)),1===t.length&&(t[0].url||"").startsWith("javascript:")&&(s=!1)),!0===o){0;const n=t.map((e=>e.url)).filter(Boolean).filter((e=>i.Z.filterUrl(e).length>0));r.Z.openBrowserWindow(e,n,{incognito:d,transition:u.Z.historyPrivate.TransitionType.AUTO_BOOKMARK})}else{let n=t.filter((e=>e.url&&i.Z.filterUrl(e.url).length>0));"directrightofcurrent"===a.Z.get(m.kTabsNewPlacement)&&(s?n.reverse():(n=[n[0],...n.toSpliced(0,1).toReversed()],l=!0));const o=n.length-1;n.forEach(((t,n)=>{s?this.openInNewTab(e,t,l||n!==o):(this.openInCurrentTab(e,t),s=!0)}))}}},openInNewTab:function(e,t,n){o.ZP.openURL(e,t.url,{bookmarkId:t.id,inCurrent:!1,inBackground:n,transition:u.Z.historyPrivate.TransitionType.AUTO_BOOKMARK})},openInCurrentTab:function(e,t){o.ZP.openURL(e,t.url,{bookmarkId:t.id,inCurrent:!0,transition:u.Z.historyPrivate.TransitionType.AUTO_BOOKMARK})},getBookmarksByNode:function(e){let t=[];return e.children?t=t.concat(e.children.filter((e=>i.Z.isBookmark(e)))):i.Z.isBookmark(e)&&t.push(e),t},getUrlsByNodes:function(e){return e.map((e=>b.getBookmarksByNode(e))).flat().map((e=>e.url)).filter(Boolean).filter((e=>i.Z.filterUrl(e).length>0))},getOpenOptionsFromDisposition:function(e,t,n,i){const s={inCurrent:!1,inBackground:!1,inNewWindow:!1,allowOverride:!1,incognito:!1};switch(t){case"setting":return(0,c.ZP)(e,i);case"current":return{...s,inCurrent:!0};case"new-tab":return{...s,inBackground:n||a.Z.get(m.kTabsOpenNewInBackground)};case"new-window":return{...s,inNewWindow:!0};case"new-private-window":return{...s,inNewWindow:!0,incognito:!0};default:return s}},isCopyModifierPressed:function(e){return e.ctrlKey},makeEventFlagsFromApiResponse:function(e){const t={altKey:void 0,button:void 0,ctrlKey:void 0,metaKey:void 0,shiftKey:void 0};return e.left?t.button=0:e.right?t.button=2:e.center&&(t.button=1),e.ctrl&&(t.ctrlKey=!0),e.alt&&(t.altKey=!0),e.shift&&(t.shiftKey=!0),e.command&&(t.metaKey=!0),t},verifyForUpdate(e,t){const n={...e};if(n.url&&(n.url=n.url.trim()),n.title&&(n.title=n.title.trim()),n.nickname&&(n.nickname=n.nickname.trim()),n.description&&(n.description=n.description.trim()),t)n.url="";else{let e=n.url||p.p;const{schemeParsed:t}=u.Z.utilities.isUrlValid(e);""===t&&(e=(0,h.q9)(e)),n.url=e}return n},verifyForCreate(e,t){const n={...e};if(n.url&&(n.url=n.url.trim()),n.title&&(n.title=n.title.trim()),n.nickname&&(n.nickname=n.nickname.trim()),n.description&&(n.description=n.description.trim()),t)n.url="";else{let e=n.url||p.p;const{schemeParsed:t}=u.Z.utilities.isUrlValid(e);""===t&&(e=(0,h.q9)(e)),n.url=e}return n},convertToPrivateType(e){const t={id:e.id,title:e.title,nickname:e.nickname,description:e.description,thumbnail:e.thumbnail,partner:e.partner,speeddial:e.speeddial,themeColor:e.themeColor,bookmarkbar:e.bookmarkbar,trash:e.trash};return e.parentId&&(t.parentId=e.parentId),e.index&&(t.index=e.index),e.url&&(t.url=e.url),e.dateAdded&&(t.dateAdded=e.dateAdded),e.dateGroupModified&&(t.dateGroupModified=e.dateGroupModified),e.children&&(t.children=[]),t},getEmptyNode:()=>({id:"",title:"",nickname:"",description:"",thumbnail:"",partner:"",speeddial:!1,themeColor:"",bookmarkbar:!1,trash:!1}),extractTitleFromEvent:function(e){const{dataTransfer:t}=e.nativeEvent;if(!t)return"";let n=t.getData("vivaldi/x-title");if(""===n){const e=t.getData("text/html");if(""!==e){const t=document.createElement("div");t.innerHTML=e;const i=t.getElementsByTagName("a");if(i&&i[0]){const e=i[0].textContent;""!==e&&(n=e)}}}return n||(n=e.dataTransfer.getData("text/plain")??""),n},isUriListType:e=>"text/uri-list"===e||"vivaldi/x-uri-list"===e,extractUriListFromEvent:function(e){const{dataTransfer:t}=e.nativeEvent;if(!t)return"";let n=t.getData("vivaldi/x-uri-list");return n||(n=t.getData("text/uri-list")),n??""},getUrlsFromEventPromise:(e,t)=>new Promise(((n,i)=>{const s=e.dataTransfer.getData(f.Up),o=b.extractUriListFromEvent(e);if(s){const e=JSON.parse(s).ids.map((e=>parseInt(e))).sort(((e,t)=>e-t));l.Z.tabs.query({},(t=>n(t.filter((t=>e.some((e=>t.id===e)))).filter((({url:e=""})=>e&&!(0,g.pM)(e))).map((({title:e,url:t=""},n)=>({title:e||(0,d.ZP)(t),url:t}))))))}else{if(o.length>0){const t=b.extractTitleFromEvent(e);return n(o.split("\n").map(((e,n)=>({url:e,title:0===n&&""!==t?t:(0,d.ZP)(e)}))))}if(!0!==t)return i();{let t=e.dataTransfer.getData("text/plain");if(t.length>0){if((0,h.K2)(t))return n([{url:t,title:(0,d.ZP)(t)}]);if(t=t.trim(),t.length>0&&!/\s/.test(t)){const e=t.indexOf(".");if(e>0&&e<t.length-1&&(t=(0,h.q9)(t),(0,h.K2)(t)))return n([{url:t,title:(0,d.ZP)(t)}])}return i()}}}})),isBookmarkable:y},S=b},30460:(e,t,n)=>{"use strict";n.d(t,{p:()=>i});const i="http://bookmark.placeholder.url/"},34929:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(2711),s=n(25201);const o={getOAuthServiceProvider:e=>"vivaldi"===e?"vivaldi":"google"===e?"google":"fastmail"===e?"fastmail":"yahoo",getAuthentication:async(e,t)=>{const{url:n,account_type:s}=e;let{username:a}=e;if(!a||!n)throw new Error("Username or URL missing");if(t||(t=await o._getVivaldiPassword(a,n||"")),"google"===s||"fastmail"===s||"vivaldi"===s&&!t){const t=o.getOAuthServiceProvider(s),{accessToken:n,usernameFromIdToken:r}=await i.Z.getOAuthAccessToken(a,t);return r&&(a=r),{...e,accessToken:n,username:a,password:""}}return{...e,password:t,accessToken:""}},_getVivaldiPassword:async(e,t)=>{const{password:n}=await(0,s.Ij)({url:t,username:e});return n}},a=o},9126:(e,t,n)=>{"use strict";n.d(t,{R:()=>d,l:()=>c});var i=n(15800),s=n(29087),o=n(30381),a=n.n(o),r=n(87852);const l={displayMode:"month",showCompletedTasks:!1};function d(e){if(!e)return l;const t=i.ZP.getCalendarFilterPrefsKey(e),n=e===r.Nw||e===r.G6?"day":"month",o=s.Z.get(t);return{displayMode:o.displayMode??n,showCompletedTasks:o.showCompletedTasks??!1}}function c(e){return{calendarIds:new Set,filterText:"",anchorDate:(new(a())).startOf("hour"),selectedDate:(new(a())).startOf("hour"),allDaySelected:!1,selectedEvent:"",editing:!1,showTasks:!0,...d(e)}}},87265:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var i=n(45660),s=n(25372),o=n(7064);const a={constructUrl:e=>e.filter(Boolean).map((e=>("/"===e.charAt(0)&&(e=e.substring(1)),e.endsWith("/")&&(e=e.substring(0,e.length-1)),e))).join("/"),concatUrl(e,t){const n=(0,s.Z)(e);if(!n)return"";const{protocol:i,host:o}=n;return(i||"")+"//"+(o||"")+t},stripDoubleQuotes:e=>e.split('"').join(""),parseHttpStatusCode(e){try{return parseInt(e.split(" ")[1],10)}catch(e){i.Z.error("Calendar",["network"],"Error parsing http status",e)}return-1},httpStatusSuccess(e){const t=a.parseHttpStatusCode(e);return t>=200&&t<300},getCalDAVUrl(e,t){const n=(0,s.Z)(e);if(!n)return"";const{protocol:i,host:o}=n;return i&&o&&t?`${i}//${a.constructUrl([o,t])}`:""},urlForEvent(e,t,n){const{uid:i,href:r}=n;let l="",d="";const c=(0,s.Z)(e);if(c){const{protocol:e,host:n}=c;if(e&&n&&r){const{urlValid:t}=o.Z.utilities.isUrlValid(r);l=t?r:a.constructUrl([`${e}//${n}`,r]),d=r}else{if(!e||!n||!i)throw"Error. Missing protocol, host uid ";const{urlValid:r}=o.Z.utilities.isUrlValid(t);if(r){l=`${a.constructUrl([t,i])}.ics`;const e=(0,s.Z)(t);d=`/${a.constructUrl([e?.pathname??"",i])}.ics`}else{const s=e+"//"+n;d=`/${a.constructUrl([t,i])}.ics`,l=a.constructUrl([s,d])}}}return{eventServerUrl:l,eventHref:d}}},r=a},1712:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var i=n(2934),s=n(50522),o=n(71636),a=n(15800),r=n(56371),l=n(25201);const d={getCalendarCreateParams:e=>({name:"",description:(0,r.Z)("noun","New Calendar"),accountId:e.id,color:a.ZP.getCalendarCreateColor(),timezone:"",active:"local"!==e.account_type,supportedCalendarComponent:{vevent:!0,vtodo:!0,vjournal:!1}}),getAccountCreateParams:()=>({name:(0,r.Z)("Local Account"),url:"",account_type:"local",username:""}),createLocalAccountAndCalendar:async(e,t)=>{const n=d.getLocalAccount();if(n){const e=s.Z.getCalendars().find((e=>e.accountId===n.id));if(e)return{calendar:e,result:{message:"",status:!0}};t={...d.getCalendarCreateParams(n),...t};return await i.ZP.createCalendar({...t,accountId:n.id},n)}{e={...d.getAccountCreateParams(),...e};const n=await i.ZP.createAccount(e);t={...d.getCalendarCreateParams(n),...t};return{...await i.ZP.createCalendar({...t,accountId:n.id},n),account:n}}},getLocalAccount:()=>s.Z.getAccounts().find((e=>"local"===e.account_type)),getEmptyLocalAccount:()=>{const e=d.getLocalAccount();if(!e)return;if(s.Z.getAccounts().length>1)return;const t=s.Z.getCalendars();if(t.length>=2)return;if(0===t.length)return e;const n=t[0].id;for(const e of s.Z.getEvents())if(n===e.calendarId)return;return e},startDeletingAccount:async e=>{const t=s.Z.getAccounts().find((t=>t.id===e));if(!t)return;const{username:n,url:a}=t;i.ZP.stopListeners();try{await i.ZP.deleteAccount(e),(0,l.QN)({username:n,url:a})}finally{i.ZP.startListeners(),o.Z.doneDeleteAccount(e)}}},c=d},15800:(e,t,n)=>{"use strict";n.d(t,{Fg:()=>R,NY:()=>N,ZP:()=>F});var i=n(50522),s=n(6320),o=n(65792),a=n.n(o),r=n(45502),l=n(46382),d=n(80008),c=n.n(d),u=n(96951),p=n(29087),h=n(2699),g=n(9304),m=n(56371),f=n(45660),v=n(42568),y=n.n(v),b=n(25372),S=n(24522),w=n(23542),C=n(25765),A=n(87852),I=n(74400),T=n(36436),Z=n(58821),E=n(65741),k=n(89175),_=n(47543);const N=new Set(["id","uid","calendarId","alarmId","eventTypeId","allDay","task","etag","href","sequence","syncPending","deletePending","filteredOut"]),P=new Set([...N,"start","end","timezone"]),D=(0,w.extendMoment)(c()),M=y()((function(e){let t=a()(e);t.get("lab.l")<12.5?t=t.set("lab.l",12.5):t.get("lab.l")>77.5&&(t=t.set("lab.l",77.5));const n=t.set("lab.l",t.get("lab.l")<70?"+70":"-70");return{"--colorCalendarBg":t.css(),"--colorCalendarBgAlpha":t.alpha(.2).css(),"--colorCalendarFg":n.css(),"--colorCalendarFgAlpha":n.alpha(.5).css()}}),{maxSize:100});function O(e){const t=Math.abs(e);return`${e<=0?"+":"-"}${Math.floor(t/60).toString().padStart(2,"0")}${Math.floor(t%60).toString().padStart(2,"0")}${Number.isInteger(e)?"":Math.round(t%1*60).toString().padStart(2,"0")}`}function x(e,t,n){return`BEGIN:${t.toUpperCase()}\nDTSTART:${D.tz(e.dtStart,n).format("YYYYMMDDTHHmmss")}\nTZOFFSETFROM:${O(e.offsetFrom??0)}\nTZOFFSETTO:${O(e.offsetTo??0)}\nTZNAME:${e.name??""}\n${e.rDates.map((e=>`RDATE:${D.tz(e,n).format("YYYYMMDDTHHmmss")}\n`)).join("")}END:${t.toUpperCase()}\r\n`}function L(e,t,n){const i=D.tz.zone(e);if(!i)return"";const s=Math.min(n,Date.now()+3650*S.hd),o=`BEGIN:VTIMEZONE\r\nTZID:${e}`;let a="";const{untils:r=[],offsets:l=[],abbrs:d=[]}=i;if(1===r.length)a+=`BEGIN:STANDARD\nDTSTART:19700101T000000\nTZOFFSETFROM:${O(l[0])}\nTZOFFSETTO:${O(l[0])}\nTZNAME:${d[0]}\nEND:STANDARD\r\n`;else{let n=r.findIndex((e=>e>t));n=Math.max(n,1);const i={standard:null,daylight:null};do{const t=l[n]-l[n-1],s=t>=0||t%15!=0?"standard":"daylight";!i[s]||i[s].offsetFrom===l[n-1]&&i[s].offsetTo===l[n]||(a+=x(i[s],s.toUpperCase(),e),i[s]=null);const o=i[s];o?o.rDates.push(r[n-1]):i[s]={dtStart:r[n-1],offsetFrom:l[n-1],offsetTo:l[n],name:d[n],rDates:[]},n++}while(n<r.length&&r[n-1]<s);i.standard&&(a+=x(i.standard,"STANDARD",e)),i.daylight&&(a+=x(i.daylight,"DAYLIGHT",e))}return`${o}\r\n${a}END:VTIMEZONE\r\n`}function R(e){let t=e.replace(/^DTSTART.*\n/,"");return t.startsWith("RRULE:")||(t="RRULE:"+t),t}const B={validColor:function(e){return(e??"").match(/^#?([0-9a-f]{6})([0-9a-f]{2})?$/i)?.[1]??!1},getCalendarColor:e=>{const t=B.validColor(e?.color);return t?`#${t}`:g.ZP.getThemeWithFallback(h.Z.getCurrentId()).colorHighlightBg},getCalendarColorStyles:e=>M(B.getCalendarColor(e)),getEventColors:e=>{const t=i.Z.getCalendars().find((t=>t.id===e));return B.getCalendarColorStyles(t)},getCalendarColors:()=>{let e="";for(const t of i.Z.getCalendars()){e+=`.calendar${t.id} {`;const n=B.getCalendarColorStyles(t);for(const[t,i]of Object.entries(n))e+=`${t}: ${String(i)};`;e+="}"}return e},getEventSquircle:()=>'<svg\n      viewBox="0 0 8 8"\n      xmlns="http://www.w3.org/2000/svg"\n    >\n      <rect width="8" height="8" rx="3" />\n    </svg>',createCalendarIcon:(e,t,n=!1)=>{const i=B.getCalendarColor(e);let s="";if(n){s=`<path d="M 8 17 l 7 7 l 11 -11 l -3 -3 l -8 8 l -4 -4  z" fill="#${a()(i).luminance()>.9?"000":"FFF"}" />`}return`<svg viewBox="0 0 32 32">\n      <circle cx="16" cy="16" r="${t}" fill="${i}" />\n      ${s}\n    </svg>`},createCalendarIconPNG:e=>{const t=B.getCalendarColor(e),n=document.createElement("canvas");n.width=32,n.height=32;const i=n.getContext("2d");return i.beginPath(),i.arc(16,16,Math.floor(32/3),0,2*Math.PI,!1),i.fillStyle=t,i.fill(),n.toDataURL("image/png").replace("data:image/png;base64,","")},initializeEvent:(e,t)=>{const n=s.Z.getStateForPage(e),o=e===A.G6?"day"!==n.displayMode:!["day","week"].includes(n.displayMode),{start:a,end:r,task:l=!1,allDay:d=!o&&n.allDaySelected,title:c=""}=t||{};let u=0,h=0;if(a)u=a;else if(!l&&n.selectedDate){const e=n.selectedDate.valueOf();u=o&&0===(0,Z.oR)(e)?e+10*S.QI:e}h=l?r??0:r?d?D(r).startOf("day").add(1,"day").valueOf():r:d?D(u).add(1,"day").valueOf():u+p.Z.get(k.kCalendarDefaultDuration);let g,m=-1;d?p.Z.get(k.kCalendarDefaultAlldayNotification)&&(m=p.Z.get(k.kCalendarDefaultAlldayNotificationTime)):m=p.Z.get(k.kCalendarDefaultNotification),-1!==m&&(g=[{id:"",name:"",when:m*S.lb}]);let f=t?.calendarId||B.getDefaultCalendar(l)?.id;const v=i.Z.getCalendars().find((e=>e.id===f));if(l&&!v?.supportedCalendarComponent?.vtodo||!l&&!v?.supportedCalendarComponent?.vevent){const e=i.Z.getAccounts().find((e=>e.id===v?.accountId));if(v&&!e)throw new Error("Can not create event, no account found! Broken data.");const t=l?"vtodo":"vevent",n=i.Z.getCalendars().find((n=>n.accountId===e?.id&&n.supportedCalendarComponent?.[t]));n&&(f=n.id)}const{is_template:y,exceptionEvents:b,...w}=t;return{...w,title:c,calendarId:f||"",uid:crypto.randomUUID(),id:"",start:u,end:h,allDay:d,task:l,notifications:g,invites:[],attachment:[]}},shouldSaveEvent:(e,t)=>{const n=!e.id,i=Object.entries(e).every((([t,n])=>!n||P.has(t)||"notifications"===t&&function(e){return 1===e.notifications?.length&&(!e.allDay&&p.Z.get(k.kCalendarDefaultNotification)*S.lb===e.notifications?.[0].when||!!e.allDay&&p.Z.get(k.kCalendarDefaultAlldayNotification)&&p.Z.get(k.kCalendarDefaultAlldayNotificationTime)===e.notifications?.[0].when)}(e)||Array.isArray(n)&&0===n.length)),s=!!t&&(e.start!==t.start||e.end!==t.end);if(n)return i&&!s?"DELETE":"SAVE";{const{notifications:n,...o}=e,{notifications:a,...r}=t||{},l=(0,E.Z)(o,r)&&!s,d=(0,E.Z)(n,a);return l&&d?"IGNORE":l?"SAVE_INVITED":i&&!s?"DELETE":"SAVE"}},isOwnEvent(e){const{account:t}=B.getAccountAndCalendar(e.calendarId);if("ical"===t?.account_type)return!1;if(!e.organizer)return!0;return p.Z.get(k.kMailAccounts).some((t=>t.MAIL_EMAIL===e.organizer))},shouldIncrementSequence:(e,t)=>{const n=e=>[e.address,e.partstat];if(!t)return!1;const i=(t.invites||[]).map(n),s=(e.invites||[]).map(n);return t.start!==e.start||t.end!==e.end||t.allDay!==e.allDay||!(0,E.Z)(t.rrule,e.rrule)||!(0,E.Z)(i,s)||!(0,E.Z)(t.recurrenceExceptions||[],e.recurrenceExceptions||[])},getDisplayRange:(e,t)=>{let n,i;switch(t){case"agenda":n=D(e).startOf("day"),i=D(e).add(1,"month").endOf("day");break;case"month":n=D(e).startOf("month").weekday(0),i=D(e).endOf("month").weekday(6);break;case"multiweek":n=D(e).subtract(1,"week").startOf("week"),i=D(e).add(1,"week").endOf("week");break;default:n=e.clone().startOf(t),i=e.clone().endOf(t)}return D.range(n,i)},getEventRange:e=>{const t=e.task?e.start||e.end:e.start,n=e.end||e.start;if(t&&n)return D.range(t,n)},isMultiDayEvent:e=>{if(e.allDay&&e.end)return!0;if(e.task&&e.end&&!e.start)return!1;const t=D(e.start),n=D(e.end);return!t.isSame(e.end,"day")&&!(n.diff(t,"day",!0)<1&&n.isSame(n.clone().startOf("day")))},isRecurringEvent:e=>Boolean(e.rrule),isGeneratedRecurringEvent:e=>-1!==("string"==typeof e?e:e.id).indexOf(":"),getGeneratedSourceEvent:e=>{const[t]=e.id.split("-")[0].split(":"),n=i.Z.getEvents().find((e=>e.id===t));if(!n)throw new Error(`Source event not found for recurring event id: ${e.id}`);return n},getBaseEventIfException:e=>{const[t]=e.id.split("-")[0].split(":"),n=i.Z.getEvent(t);if(n?.recurrenceExceptions?.length&&!e.recurrenceExceptions?.length)return n},getExceptionEvents:function(e,t){return(e.recurrenceExceptions||[]).flatMap((n=>{const s=n.exception_event_id;if(s){const o=s===t?.id?t:i.Z.getEvent(s);if(o)return{...o,recurrenceId:n.date,sequence:e.sequence,uid:e.uid}}return[]}))},generateKey:(e,t)=>{const{calendarId:n,id:i,uid:s,sequence:o}=e;return`${n}-${i}-${s??""}-${o??""}-${t??""}`},eventHasText:(e,t)=>{const n=t.toLowerCase();return["title","description","location","url","invites","organizer"].some((t=>(Array.isArray(e[t])?function(t){return"invites"===t&&e.invites?e.invites.map((e=>e.address)).join(""):""}(t):e[t]||"").toLowerCase().indexOf(n)>=0&&!e.trash))},eventSearchPredicate:(e,t)=>""===e.id||B.eventHasText(e,t),searchEvents:(e,t)=>e.filter((e=>B.eventSearchPredicate(e,t))).sort(((e,t)=>t.start-e.start)),filterEventsByPeriod:(e,t,n,i=1)=>{const s=t.clone();let o,a;"allday"===n?(o=s.startOf("day").valueOf(),a=s.add(i-1,"day").endOf("day").valueOf()):(o=s.startOf(n).valueOf(),a=s.add(i-1,n).endOf(n).valueOf());const r=t.dayOfYear(),l=e.filter((e=>e.id.indexOf("-")>0)).map((e=>e.id.split("-"))).filter((([e,t])=>parseInt(t)<=r)).reduce(((e,[t,n])=>(e[t]=Math.max(e[t]||0,parseInt(n)),e)),{}),d=e.filter((e=>{if(e.task){let t=e.end;return t||(t=e.start),e.start&&t?e.start<=a&&t>o||e.start===t&&e.start>=o&&e.start<a:!!t&&(t>=o&&t<=a)}return e.start<a&&(e.end||e.start)>o||e.start<a&&e.start>=o})).filter((e=>{const[t,n]=e.id.split("-");return n?l[t]===parseInt(n):!(t in l)}));return"hour"===n?d.filter((e=>!B.isMultiDayEvent(e))):"allday"===n?d.filter((e=>B.isMultiDayEvent(e))):d},foldIcal:function(e){return e.split(/\r?\n/).map((e=>{if(e.length<=75)return e;let t="",n=0;for(;n<e.length;)n+75>=e.length?t+=e.substr(n):t+=e.substr(n,73)+"\r\n ",n+=73;return t})).join("\r\n")},notificationToVAlarm:function(e){const{name:t,when:n}=e;return`BEGIN:VALARM\nACTION:DISPLAY\nDESCRIPTION:${t}\nTRIGGER:${n>0?"-":""}${D.duration(Math.abs(n)).toString()}\nEND:VALARM`},eventsToICalendar:function(e,t={}){const{method:n,includeRecurrenceId:i=!0}=t,s=D.tz().format(S.FI),o=["BEGIN:VCALENDAR","PRODID:-Vivaldi Calendar V1.0//EN","VERSION:2.0","CALSCALE:GREGORIAN","DTSTAMP:"+s];n&&o.push(`METHOD:${n}`),o.push("");let a=o.join("\r\n");const r=(0,Z.EP)()||"utc",l=e.reduce(((e,t)=>{if((t.start||t.end)&&!t.allDay&&(t.rrule||t.timezone)){const n=t.timezone||r,i=t.start||1/0;let s=t.end||-1/0;if(t.rrule){const{rrule:e,start:n,timezone:i}=t,o=(0,_.Qj)(e,i,n);s=o?.options.until?o.options.until.valueOf():o?.options.count?o.all().pop().valueOf():1/0}e[n]?e[n]={firstOccurrence:Math.min(i,e[n].firstOccurrence),lastOccurrence:Math.max(s,e[n].lastOccurrence)}:e[n]={firstOccurrence:i,lastOccurrence:s}}return e}),{});for(const e in l)e!==S.$T&&"utc"!==e.toLowerCase()&&(a+=L(e,l[e].firstOccurrence,l[e].lastOccurrence));return e.map((e=>{let t=[];e.organizer&&(t=[`ORGANIZER:mailto:${e.organizer}`]),e.invites&&e.invites.length&&(t=t.concat(e.invites.map((e=>`ATTENDEE;RSVP=TRUE${e.partstat?`;PARTSTAT=${e.partstat}`:""}${`;CN=${e.name||e.address}`}:mailto:${e.address}`))));const{uid:n,recurrenceId:o}=e,a=Boolean(o&&i);let r,l,d,c="",u="";e.allDay?(c=";VALUE=DATE",r=e.start?D(e.start).format(S.O5):"",l=e.end?D(e.end).format(S.O5):"",e.task&&(u=D().format(S.O5)),a&&(d=D(o).format(S.O5))):e.timezone===S.$T?(r=e.start?D(e.start).format(S.A):"",l=e.end?D(e.end).format(S.A):"",e.task&&(u=D().format(S.A)),a&&(d=D(o).format(S.A))):e.timezone&&"utc"!==e.timezone.toLowerCase()?(c=`;TZID=${String(e.timezone)}`,r=e.start?D.tz(e.start,e.timezone).format(S.A):"",l=e.end?D.tz(e.end,e.timezone).format(S.A):"",e.task&&(u=D.tz(D(),e.timezone).format(S.A)),a&&(d=D.tz(o,e.timezone).format(S.A))):(r=e.start?D.tz(e.start,"utc").format(S.FI):"",l=e.end?D.tz(e.end,"utc").format(S.FI):"",e.task&&(u=D.tz(D(),"utc").format(S.FI)),a&&(d=D.tz(o,e.timezone).format(S.A)));const p=e.notifications&&e.notifications.map(B.notificationToVAlarm).join("\n"),h=[],{rrule:g,recurrenceExceptions:m}=e;g&&h.push(R(g)),m&&m.forEach((t=>{const{date:n,cancelled:i}=t;if(i){let t="",i="";e.allDay?(t=";VALUE=DATE",i=`${D.tz(n,"utc").format(S.O5)}`):e.timezone===S.$T?i=D(n).format(S.A):e.timezone?(t=`;TZID=${e.timezone}`,i=D.tz(n,e.timezone).format(S.A)):i=D.tz(n,"utc").format(S.FI),h.push(`EXDATE${t}:${i}`)}}));const f=e.task?"DUE":"DTEND";return[e.task?"BEGIN:VTODO":"BEGIN:VEVENT","DTSTAMP;VALUE=DATE-TIME:"+s,e.description?`DESCRIPTION:${(0,I.ES)(e.description)}`:"",e.location?`LOCATION:${(0,I.ES)(e.location)}`:"",e.url?`URL:${e.url}`:"",l?`${f}${c}:${l}`:"",r?`DTSTART${c}:${r}`:"",d?`RECURRENCE-ID${c}:${d}`:"",Number.isInteger(e.sequence)?`SEQUENCE:${e.sequence||0}`:"",`SUMMARY:${(0,I.ES)(e.title)}`,n?`UID:${n}`:"",...t,...h,B.attachmentsToString(e.attachment),e.complete?"STATUS:COMPLETED":"",e.complete?`COMPLETED${c}:${u}`:"",p||"",e.task?"END:VTODO\r\n":"END:VEVENT\r\n"].filter(Boolean).join("\r\n")})).forEach((e=>{a+=e})),B.foldIcal(a+"END:VCALENDAR")},attachmentsToString:e=>(e||[]).map((e=>{const{filename:t,fmttype:n,url:i}=e;if(i){return`ATTACH${t?`;FILENAME=${(0,I.ES)(t)}`:""}${n?`;FMTTYPE=${n}`:""}:${i}`}})).filter(Boolean).join("\r\n"),stringToAttachments:(e="")=>e.split("\r\n").filter((e=>Boolean(e)&&-1!==e.indexOf("ATTACH")&&-1===e.indexOf("ENCODING")&&-1===e.indexOf("BINARY"))).map((e=>{const[t,n]=(0,I.Vl)(e,":",2),i=t.match(/FILENAME=([^;:]+)/),s=t.match(/FMTTYPE=([^;:]+)/);return{url:n,filename:i?i[1]:void 0,fmttype:s?s[1]:void 0}})),getDefaultCalendar:(e=!1)=>{const t=e?k.kCalendarDefaultTaskCalendarId:k.kCalendarDefaultCalendarId,n=p.Z.get(t),s=i.Z.getWritableCalendars();let o=s.find((e=>e.id===n));return o&&(e?o?.supportedCalendarComponent?.vtodo:o?.supportedCalendarComponent?.vevent)||!(s.length>0)||(o=e?s.find((e=>e.supportedCalendarComponent?.vtodo)):s.find((e=>e.supportedCalendarComponent?.vevent))),o},getAccountAndCalendar:e=>{const t=i.Z.getCalendars().find((t=>t.id===e));if(t){const e=i.Z.getAccounts();return{calendar:t,account:e.find((e=>e.id===t.accountId))}}return{account:void 0,calendar:void 0}},getDefaultAccount:()=>{const e=B.getDefaultCalendar(),t=i.Z.getAccounts(),n=t.find((t=>t.id===e?.accountId));return!n&&t.length>0?t[0]:n},isRemoteCalendar:e=>{const t=i.Z.getCalendars().find((t=>t.id===e));if(!t)return!1;const{accountId:n}=t;return!!i.Z.getAccounts().find((e=>e.id===n))?.url},isGoogleCalendar:e=>{const t=i.Z.getCalendars().find((t=>t.id===e));if(!t)return!1;const{accountId:n}=t,s=i.Z.getAccounts().find((e=>e.id===n));return!(!t||!s||"google"!==s.account_type)},isLocalCalendar:e=>{const t=i.Z.getAccounts(),n=i.Z.getCalendars().find((t=>t.id===e));if(!n)return!1;const{accountId:s}=n,o=t.find((e=>e.id===s));return!!o&&"local"===o.account_type},isCalendarValidToCreate:e=>{const{description:t,supportedCalendarComponent:n}=e,{vevent:i,vtodo:s}=n||{vevent:!1,vtodo:!1};return Boolean(t)&&(i||s)},isCalDAV:e=>"vivaldi"===e||"caldav"===e||"google"===e||"fastmail"===e,isOAuthProvider:e=>"vivaldi"===e||"google"===e||"fastmail"===e,ensureAccountType:e=>{const t=Object.keys(C.d3).find((t=>t===e))||"local";return"icloud"===t?"caldav":t},doesCalendarsExistsAndShowWarning:(e,t=!1)=>{if(0===i.Z.getCalendars().length)return l.Z.showCalendarAccountDialog(e),!1;const n=i.Z.getWritableCalendars();return 0!==(t?n.filter((e=>e.supportedCalendarComponent.vtodo)):n.filter((e=>e.supportedCalendarComponent.vevent))).length||(l.Z.showModal(e,{modal:{title:(0,m.Z)("No Writable Calendar Defined"),body:t?(0,m.Z)("At least one calendar that supports creating tasks is required to add a task."):(0,m.Z)("At least one calendar that supports creating events is required to add an event."),actions:[{title:(0,m.Z)("Open Calendar Settings"),action:"settings",default:!0}],cancelAction:{title:(0,m.Z)("Cancel"),action:"cancel"}}}).then((({action:t})=>{"settings"===t&&l.Z.showSettings(e,"calendar")})),!1)},getLocalGoogleTasksCalendars:e=>"google"!==e.account_type?[]:i.Z.getCalendars().filter((t=>t.accountId===e.id&&t.supportedCalendarComponent?.vtodo)),getPollResultText(e){const{calendars:t,error:n,message:i,didPoll:s}=e;if(n)return i||(0,m.Z)("Unknown error.");if(!s)return i||(0,m.Z)("Poll already in progress.");const o=t.reduce(((e,t)=>e+t.numberOfChangedCalendars),0);return 0===o?(0,m.Z)("Refresh complete. No change."):(0,m.Z)("Refresh complete. $1 calendar was updated.","Refresh complete. $1 calendars were updated.",[o])},getPageId:e=>"panel"===r.Z.getContext(e).area?A.G6:u.ZP.getActivePage(e)?.id,minimalCreateEvent:e=>({calendarId:"",is_template:!1,title:"",...e}),validateEventTypes:e=>(e.sequence||0)>2147483647?(f.Z.warn("Calendar",["Validating Event"],"Value in field: Sequence is to high. Sequence set to 0"),{...e,sequence:0}):e,ensureHttpsForWebcal(e){const t=(0,b.Z)(e);if(!t)throw new Error("Can not parse invalid URL for webcal");return"webcal:"===t.protocol&&(t.protocol="https:"),(0,T.q9)(t.href)},getCalendarCreateColor:()=>{const e=C.hx.map((e=>e.value.toLocaleLowerCase().replace("#",""))),t=[];i.Z.getCalendars().forEach((n=>{const i=n.color?.toLowerCase().replace("#","")||"";e.includes(i)&&t.push(i)}));let n=e.filter((e=>!t.includes(e)));return n.length||(n=e),`#${n[Math.floor(Math.random()*n.length)]}`},getCalendarDisplayName(e,t=!1){const n=e.description||e.name;if(!t)return n;const s=i.Z.getAccounts().find((t=>t.id===e.accountId));if(s){const e=s.name||s.url;return(0,m.Z)("$1 ($2)",[n,e])}return n},getCalendarFilterPrefsKey:e=>{let t="";return t=e===A.Nw?k.kCalendarTaskPanelFilter:e===A.G6?k.kCalendarPanelFilter:k.kCalendarManagerFilter,t},suggestNewCalendarDisplayName(e){const t=C.d3[e],n=i.Z.getAccounts().map((e=>e.name));if(!n.includes(t))return t;let s=1;for(;s<9999;){const e=(0,m.Z)("$1 ($2)",[t,s]);if(!n.includes(e))return e;s++}return""}},F=B},58821:(e,t,n)=>{"use strict";n.d(t,{EP:()=>m,FL:()=>v,FY:()=>u,KC:()=>I,PX:()=>h,Ro:()=>p,VV:()=>f,Xq:()=>c,Yu:()=>b,aE:()=>w,bn:()=>S,oJ:()=>C,oR:()=>T,sG:()=>y,zX:()=>A});var i=n(29087),s=n(88212),o=n(80008),a=n.n(o),r=n(24522),l=n(47543),d=n(89175);function c(e,t){const n=t?t.clone():e.clone(),i=n.startOf("month");return Math.floor((e.diff(n,"day")+1+i.weekday()-1)/7)}function u(e,t,n,i=!0){const s=n.clone();let o=7*e+1-s.startOf("month").weekday()+t;if(i){const e=s.endOf("month").date();o=Math.max(1,Math.min(o,e))}return s.date(o)}function p(e,t,n=!1){const i=t.clone(),s=i.endOf("month").weekday(),o=n?s-e:(s-e+7)%7;return i.subtract(o,"day")}function h(e,t,n=!1){const i=t.clone(),s=i.startOf("month").weekday(),o=n?e-s:(e-s+7)%7;return i.add(o,"day")}let g=null;function m(){return null===g&&(setTimeout((()=>g=null),1e4),g=Intl.DateTimeFormat().resolvedOptions().timeZone??""),g}function f(e,t){t&&t!==r.$T||(t=m());const n=a().tz(e,t);return new Date(Date.UTC(n.year(),n.month(),n.date(),n.hour(),n.minute(),n.second()))}function v(e,t){return t&&t!==r.$T||(t=m()),a().tz([e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds()],t).toDate()}function y(e){const{start:t=0,end:n=0,allDay:o}=e;if(e.task&&!t&&!n)return e;if(n&&n<t&&(e.end=t+(o?r.hd:i.Z.get(d.kCalendarDefaultDuration))),e.task||n||(e.end=e.allDay?t+r.hd:t),e.allDay){if(e.timezone=r.$T,e.start){const t=new Date(e.start),n=new Date(t.getFullYear(),t.getMonth(),t.getDate());e.start=n.valueOf()}if(e.task){const t=new Date(e.end||0),n=new Date(t.getFullYear(),t.getMonth(),t.getDate());e.end=n.valueOf()}else if(!e.task&&e.end){const t=new Date(e.end),n=new Date(t.getFullYear(),t.getMonth(),t.getDate());e.end=n.valueOf(),e.start===e.end&&(e.end=e.end+r.hd)}}const{start:a=0,end:c=0,timezone:u}=e;if(e.rrule&&a&&c-a>r.S){const t=(0,l.Qj)(e.rrule,u,a);if(t){const n=(0,l.xL)(t,new Date(a));n&&n.valueOf()<c&&(e.end=n.valueOf(),s.Z.warn("Calendar",`Event '${e.title}' '${e.uid||""}' truncated to prevent overlapping instances.`))}}return e}function b(e){return e.timezone&&e.timezone!==r.$T?e.timezone:m()||""}function S(e,t){const n=m(),i=e.timezone||n;if(t===r.$T)return e.timezone=t,e;if(t===r.ad)e.timezone=n,t=n||"UTC";else{if(!a().tz.zone(t))return e;e.timezone=t}if(e.start){const n=a().tz(e.start,i);e.start=a().tz(n.format(r.A),t).valueOf()}if(e.end){const n=a().tz(e.end,i);e.end=a().tz(n.format(r.A),t).valueOf()}return e}function w(e,t=!1){const n=t?m():b(e),i=a().tz(e.start,n),s=a().tz(e.end,n);return e.allDay&&e.start&&e.end&&s.subtract(1,"day"),{start:i,end:s}}function C(e){return e.task?e.start?e.start:e.end?e.end:NaN:e.start}function A(e){return Math.ceil(e/r.QI)*r.QI}function I(e,t){return Math.abs(e.valueOf()-t.valueOf())<r.hd&&e.getDate()===t.getDate()}function T(e){return(e-new Date(e).getTimezoneOffset()*r.lb)%r.hd}},34930:(e,t,n)=>{"use strict";n.d(t,{Z:()=>k});var i,s=n(12442),o=n(15800),a=n(72010),r=n(97698),l=n(46382),d=n(29087),c=n(67294),u=n(94283),p=n(15489),h=n(56371),g=n(88951),m=n(97823),f=n(80008),v=n.n(f),y=n(25765),b=n(27569),S=n(89175),w=n(34155);function C(e,t,n,s){i||(i="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=s;else if(a>1){for(var r=new Array(a),l=0;l<a;l++)r[l]=arguments[l+3];t.children=r}if(t&&o)for(var d in o)void 0===t[d]&&(t[d]=o[d]);else t||(t=o||{});return{$$typeof:i,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function A(e){const t=m.Z.getAccountsAndAliases();let n=(0,b.o$)([e],t,!1,!1);return n&&(n=(0,b.SG)(n)),n}function I(e){const{document:t,HTMLTextAreaElement:n}=c.useContext(u.Z),[i,s]=c.useState("");c.useEffect((()=>{const e=t.querySelector('textarea[name="note"]');e instanceof n&&e.addEventListener("input",(e=>{s(e.target.value.replace(/(?:\r\n|\r|\n)/g,"<br />"))}))}),[t,n]);const o=c.useMemo((()=>A(e.from)),[e.from]),a=`${Z(e.event,e.sendAction)}<br /><br />${i}${o}`;return C("div",{},void 0,(0,h.Z)("Send email invitation to notify $1 participant about the event.","Send email invitations to notify $1 participants about the event.",[e.recipients.length]),C("div",{className:"Invitation-Preview"},void 0,C("div",{className:"Invitation-Preview-Title"},void 0,(0,h.Z)("Invitation Message Preview:")),C("div",{className:"Invitation-Preview-Body",dangerouslySetInnerHTML:{__html:a}})))}function T(e,t,n){const i=new Set(n.map((([e])=>e)));let s="create";s=i.has("create")?"create":i.has("update")?"update":"cancel";const o=[{title:(0,h.Z)("Send"),action:"send",default:!0}];return"cancel"!==s&&o.push({title:(0,h.Z)("Edit Event"),action:"edit",default:!1}),{title:e.task?(0,h.Z)("Invite Task Participants"):(0,h.Z)("Invite Event Participants"),body:C(I,{event:e,from:t,recipients:n,sendAction:s}),actions:o,cancelAction:{title:(0,h.Z)("Don’t Notify Participants"),action:"cancel",default:!1},inputs:[{name:"note",label:(0,h.Z)("Add a Custom Note to the Message (optional):")}]}}function Z(e,t){const n=e.organizer;if(!n)throw new Error(`Event organizer not found for event uid ${String(e.uid)}`);const i=`<strong>${a.Z.getContactsWithAddress(n)?.name||n}</strong>`,s=`<strong>${e.title||y.gT}</strong>`,o=`<strong>${e.location??""}</strong>`,r=v().tz(e.start||e.end,e.timezone).toLocaleString();let l="";switch(t){case"create":l=(e.start||e.end)&&e.location?(0,h.Z)("$1 has invited you to an event “$2”, on $3, at “$4”.",[i,s,r,o]):e.start||e.end?(0,h.Z)("$1 has invited you to an event “$2”, on $3.",[i,s,r]):e.location?(0,h.Z)("$1 has invited you to an event “$2”, at “$3”.",[i,s,o]):(0,h.Z)("$1 has invited you to an event “$2”.",[i,s]);break;case"update":l=(e.start||e.end)&&e.location?(0,h.Z)("$1 has updated event “$2”, on $3, at “$4”.",[i,s,r,o]):e.start||e.end?(0,h.Z)("$1 has updated event “$2”, on $3.",[i,s,r]):e.location?(0,h.Z)("$1 has updated event “$2”, at “$3”.",[i,s,o]):(0,h.Z)("$1 has updated event “$2”.",[i,s]);break;case"cancel":l=(0,h.Z)("$1 has cancelled event “$2”.",[i,s])}return e.description&&(l+=`<br /><br />${e.description}`),l}async function E(e,t,n,i){const s=[t],o={type:"html",content:i.body+A(t)},a={type:"attachment",filename:"invite.ics",content:(new TextEncoder).encode(i.iCal),mimeType:"application/ics",fileSize:i.iCal.length},l=i.iCal.match(/METHOD:\s*(\w+)/);l&&(a.method=l[1]);const d=Date.now();r.Z.sendExternalMessage(e,{bcc:[],bodyParts:[o,a],cc:[],flags:[],forwarded:void 0,from:s,listId:"",listPost:"",inReplyTo:"",internal:!1,messageId:(0,g.Z)(s[0].address),replied:void 0,sentDate:d,subject:i.subject,threadKey:void 0,to:n})}const k={getOrganizerForEvent:function(e){const{account:t}=o.ZP.getAccountAndCalendar(e.calendarId);if(t)return"google"===t?.account_type?t.username:d.Z.get(S.kCalendarMailAccount)},sendAttendeeMails:async function(e,t,n,i=!1){if(o.ZP.isGoogleCalendar(t.calendarId))return"cancelled";const a=p.ZP.getLastActiveBrowserWindowId(),r=t.organizer;if(!r)throw new Error(`Event organizer not found for event uid ${String(t.uid)}`);const d={address:r},c=await l.Z.showModal(a,{modal:T(t,d,n)});if(await new Promise((e=>w.nextTick(e))),"cancel"===c.action)return"cancelled";if("edit"===c.action)return e&&Number.isInteger(e)&&s.Z.selectEvent(e,{event:t,edit:!0}),"edit";let u="",g="",m="REQUEST";const f=t.title||y.gT,v=n.map((([e,n])=>{switch(e){case"create":u=(0,h.Z)("Event invitation: $1",[f]),m="REQUEST";break;case"update":u=(0,h.Z)("Event updated: $1",[f]),m="REQUEST";break;case"cancel":u=(0,h.Z)("Event cancelled: $1",[f]),m="CANCEL"}g=Z(t,e);const{note:s}=c.inputs||{};s&&(g+="<br/><br/><strong>"+(0,h.Z)("Event organiser added the following note:")+"</strong><br/>"+s.replace(/(?:\r\n|\r|\n)/g,"<br />"));const r={method:m,includeRecurrenceId:i},l=o.ZP.eventsToICalendar([t],r),p=n.filter((e=>e.address!==t.organizer)).map((e=>({address:e.address,...e.name?{name:e.name}:null})));if(0===p.length)return;return E(a,d,p,{subject:u,body:g,iCal:l})}));return await Promise.all(v),"sent"},sendReplyMails:async function(e,t,n,i,s){let a="",r="";const l=t.organizer;if(!l)throw new Error(`Event organizer not found for event uid ${String(t.uid)}`);const d={address:"DECLINECOUNTER"===s?l:i},c=`<strong>${n}</strong>`,u=t.title||y.gT,p=`<strong>${u}</strong>`;switch(s){case"ACCEPTED":a=(0,h.Z)("Accepted: $1",[u]),r=(0,h.Z)("$1 has accepted your invitation to “$2”",[c,p]);break;case"TENTATIVE":a=(0,h.Z)("Tentatively accepted: $1",[u]),r=(0,h.Z)("$1 has tentatively accepted your invitation to “$2”",[c,p]);break;case"DECLINED":a=(0,h.Z)("Declined: $1",[u]),r=(0,h.Z)("$1 has declined your invitation to “$2”",[c,p]);break;case"DECLINECOUNTER":a=(0,h.Z)("Event change proposal declined: $1",[u]),r=(0,h.Z)("$1 has declined your proposed changes to “$2”",[c,p])}const g={method:"DECLINECOUNTER"===s?"DECLINECOUNTER":"REPLY"};return E(e,d,[{address:"DECLINECOUNTER"===s?c:l}],{subject:a,body:r,iCal:o.ZP.eventsToICalendar([t],g)})}}},25765:(e,t,n)=>{"use strict";n.d(t,{d3:()=>s,gT:()=>a,hx:()=>o});var i=n(56371);const s={local:(0,i.Z)("data storage","Local"),google:(0,i.Z)("Google Calendar"),vivaldi:(0,i.Z)("Vivaldi.net"),caldav:(0,i.Z)("CalDAV"),ical:(0,i.Z)("Web Calendar"),fastmail:(0,i.Z)("Fastmail"),icloud:(0,i.Z)("iCloud Calendar")},o=[{value:"#e73359",name:(0,i.Z)("calendar","Red")},{value:"#ee8835",name:(0,i.Z)("calendar","Orange")},{value:"#696969",name:(0,i.Z)("calendar","Gray")},{value:"#14a434",name:(0,i.Z)("calendar","Green")},{value:"#4facf2",name:(0,i.Z)("calendar","Blue")},{value:"#b260d3",name:(0,i.Z)("calendar","Purple")},{value:"#8b7251",name:(0,i.Z)("calendar","Brown")}],a=(0,i.Z)("No title")},8336:(e,t,n)=>{"use strict";n.d(t,{CP:()=>v,Km:()=>g,tV:()=>y});var i=n(50522),s=n(15800),o=n(80008),a=n.n(o),r=n(42568),l=n.n(r),d=n(23542),c=n(47543),u=n(90870);const p=(0,d.extendMoment)(a());function h(e,t){if(e.task){if(!e.start&&!e.end)return!1;if(e.start){const{start:n,end:i}=e;return(i&&i!==n?i:n+1)>t.start.valueOf()&&n<=t.end.valueOf()}return t.contains(e.end)}{const{start:n,end:i}=e;return(i&&i!==n?i:n+1)>t.start.valueOf()&&n<=t.end.valueOf()}}function g(e,t){const n={...t},s=(t.recurrenceExceptions||[]).filter((t=>e.valueOf()===t.date));if(!(s.length>0)){const{start:i,end:s}=function(e,t){const n={start:0,end:0};if(t.task)if(t.start&&t.end){const i=t.end-t.start;n.start=e.valueOf(),n.end=e.valueOf()+i}else n.end=e.valueOf();else{const i=(t.end||t.start)-t.start;n.start=e.valueOf(),n.end=e.valueOf()+i}return n}(e,t);return n.start=i,n.end=s,n.id=`${t.id}:${e.valueOf()}`,n.uid=t.uid,{event:n}}{const t=s[0],{cancelled:n,parent_event_id:o,exception_event_id:a}=t;if(!n&&o&&a){const t=i.Z.getEvent(o),n=i.Z.getEvent(a);if(t&&n){const i={...n},s=i.start||i.end;return i.id=`${t.id}:${s}`,i.rrule=t.rrule,i.recurrenceId=e.valueOf(),{event:i,exceptionId:a}}}}return{event:null}}const m=l()((function(e){return(0,u.Z)(e,s.ZP.isRecurringEvent)}));function f(e,t){let n=[];const[s,o]=m(e);let a=[];s.forEach((e=>{if(function(e){return Boolean(e.task&&!e.end)}(e))return;const{start:s,end:o,end_recurring:r,rrule:l,timezone:d}=e;if(r&&r<t.start.valueOf())return;const u=(0,c.Qj)(l,d,s||o),p=s&&o?o-s:0,m=(0,c.YE)(u?.toString()||"",{from:t.start.valueOf()-p,to:t.end.valueOf(),eventStart:s,timezone:e.timezone}),[f,v]=((e,t,n)=>{const i=[],s=[];return t.forEach((t=>{const{event:o,exceptionId:a}=g(t,e);o&&h(o,n)&&i.push(o),a&&s.push(a)})),[i,s]})(e,m,t);a=a.concat(f);for(const s of e.recurrenceExceptions??[]){const{cancelled:e,exception_event_id:o}=s;if(!e&&o&&!v.includes(o)){const e=i.Z.getEvent(o);let{start:s,end:r}=e??{};if(!(e&&s&&r))continue;s?r||(r=s):s=r,s<=t.end.valueOf()&&r>t.start.valueOf()&&(a.push(e),n.push(o))}}n=n.concat(v)}));return o.filter((e=>!n.includes(e.id)&&h(e,t))).concat(a)}const v={call:e=>f(e,p.range(p(),p().add(1,"week"))).filter((e=>!(e.task&&e.complete))).sort(((e,t)=>e.start!==t.start?e.start-t.start:e.allDay!==t.allDay?e.allDay?-1:1:e.end!==t.end?e.end-t.end:parseInt(e.id||0)-parseInt(t.id||0)))},y={call:l()(((e,t,n)=>f(e,s.ZP.getDisplayRange(t,n))),{maxSize:3})}},71636:(e,t,n)=>{"use strict";n.d(t,{t:()=>Te,Z:()=>tt});var i=n(2934),s=n(34929),o=n(50522),a=n(87265),r=n(15800),l=n(79706),d=n(60331),c=n(56371),u=n(64877),p=n(25372);var h=n(98035),g=n(28773);const{urlForEvent:m}=a.Z;function f(e){switch(e){case"get":return"GET";case"delete":return"DELETE";case"update":case"create":return"PUT"}}function v(e,t,n,i,s){const{etag:o}=t,{url:a,username:l,password:d,accessToken:c,account_type:u}=e,{eventHref:p,eventServerUrl:h}=m(a,n,t),v={};let y;"delete"!==s&&(!o||"update"!==s&&"get"!==s?"create"===s&&(v["If-None-Match"]="*"):v["If-Match"]=`"${o}"`,y="text/calendar; charset=utf-8",v.Accept="application/xml, text/calendar");const b=i.length?r.ZP.eventsToICalendar(i):null;return{username:l,password:d,accessToken:c,account_type:u,url:h,href:p,...(0,g.Z)(Object.keys(v).length?{headers:v}:null),...(0,g.Z)(y?{contentType:y}:null),...(0,g.Z)(b?{body:b}:null),method:f(s)}}function y(e){const{account_type:t}=e,n={Depth:"google"===t?"0":"1"};return{...e,headers:n,method:"PROPFIND",body:'<?xml version="1.0" encoding="UTF-8"?>\n    <D:propfind xmlns:D="DAV:"\n      xmlns:CS="http://calendarserver.org/ns/"\n      xmlns:C="urn:ietf:params:xml:ns:caldav">\n    <D:prop>\n    <D:displayname />\n    <CS:getctag />\n    <D:sync-token />\n    </D:prop>\n    </D:propfind>'}}var b=n(45660),S=n(23796),w=n(35391),C=n(29526);const{stripDoubleQuotes:A}=a.Z;function I(e){const t=(0,w.Z)(e),n={displayName:"",ctag:"",syncToken:""};if(t.parsererror||t.d_error)return b.Z.error("Calendar",["caldav"],"cTag parser error"),console.log("Error parsing calendarCtag.",e),n;try{const e=t.d_multistatus.d_response[0].d_propstat.d_prop,i=e.cs_getctag;i&&(n.ctag=A(i.content));const s=e.d_displayname;s&&(n.displayName=s.content);const o=e.d_syncToken;o&&(n.syncToken=(0,C.Z)(o.content))}catch(t){b.Z.error("Calendar",["caldav"],"cTag parser error",t),console.log("Error reading cTag.",e)}return n}var T=n(15805),Z=n(34006),E=n(12964);const{stripDoubleQuotes:k}=a.Z;function _(e,t){let n=[];const i=(0,w.Z)(e);if(i.parsererror)return b.Z.error("Calendar",["caldav","multistatus"],"Parsing error"),console.log("parseMultistatus error.",e),[];if("d_multistatus"!==i.root||!i.d_multistatus.d_response)return b.Z.error("Calendar",["caldav","multistatus"],"Unexpected caldav"),console.log("Unexpected caldav received.",e),[];try{n=i.d_multistatus.d_response.map((n=>{const i=n?.d_status?.content;if(i&&-1===i.indexOf("200"))return i.match(/[45]\d\d/)?b.Z.error("Calendar",["sync","parser"],`Error getting event from server for calendar ${t}.`,i,n.d_errordescription?.content):i.match(/[2]\d\d/)&&b.Z.info("Calendar",["sync","parser"],`Unexpected response status getting event for ${t}.`,i),console.log("Multiget error.",e),null;const s=n.d_href?(0,C.Z)(n.d_href.content):"",o=k(n?.d_propstat?.d_prop?.d_getetag?.content||""),a=!!n?.d_propstat?.d_prop?.d_resourcetype?.c_calendar,r=(0,E.Z)(n?.d_propstat);if(a||r)return;const l=n.d_propstat?.d_prop?.c_calendarData?.content||"";let d;try{d=(0,T.Z)(l);const e=d.VEVENT?.[0]??d.VTODO?.[0];if(e)return{...(0,Z.rP)(e,t,{href:s,etag:o}),task:!d.VEVENT?.[0]};if(d.VJOURNAL?.[0])return;return{href:s,etag:o}}catch(e){e instanceof T.z?(b.Z.error("Calendar",["import","parser"],e),console.log("CalDAV Multi-Status iCalendar parse error.",l)):b.Z.error("Calendar",["iCal","creating"],d,e)}})).filter(Boolean)}catch(t){b.Z.error("Calendar",["caldav"],"MultiStatus parse error",t),console.log("Error reading multiStatus.",e)}return n}var N=n(90870);const{httpStatusSuccess:P,parseHttpStatusCode:D,stripDoubleQuotes:M}=a.Z;function O(e,t){const n=(0,w.Z)(e),i={createdUpdated:[],deletedHrefs:[],syncToken:"",serverThrottlesEvents:!1,error:!0,staleSyncToken:!1};if(n.parsererror)return i;const s=n.d_multistatus?.d_syncToken;s&&(i.syncToken=s.content,i.error=!1);const o=n.d_multistatus?.d_response;if(!o)return n.d_error?(i.staleSyncToken=!0,i):i;const a=[];o.forEach((e=>{try{const n=e.d_status?.content||e.d_propstat?.d_status?.content;if(!n){if(e.d_propstat)return;throw new Error("Response has no status information!")}const s=P(n);t===e.d_href.content?e?.d_status?.content&&507===D(e.d_status.content)&&(i.serverThrottlesEvents=!0):a.push({etag:e.d_propstat?.d_prop?.d_getetag?.content?M(e.d_propstat.d_prop.d_getetag.content):"",href:(0,C.Z)(e.d_href.content),isDeletedOnServer:s})}catch(t){b.Z.error("Calendar",["parser","syncCollection"],t),console.log("Error parsing CalDAV sync-collection",[t,e]),i.error=!0}}));const[r,l]=(0,N.Z)(a,(e=>e.isDeletedOnServer));return{...i,createdUpdated:r.map((({href:e,etag:t})=>({href:e,etag:t}))),deletedHrefs:l.map((({href:e})=>e)),error:!1}}var x=n(8687),L=n(7064),R=n(24522),B=n(65741);const{getExceptionEvents:F}=r.ZP;function W(e,t){const{recurrenceId:n,...i}=e;return{...(0,Z.KU)(i,t),recurrenceId:n}}function U(e,t,n){let i=t[e],s=n[e];"rrule"===e&&(i=i&&(0,r.Fg)(i),s=s&&(0,r.Fg)(s));const o=!(!i||Array.isArray(i)&&0===i.length),a=!(!s||Array.isArray(s)&&0===s.length);return!(o||a)||(0,B.Z)(i,s)}function V(e,t,n){const i=new Set(e.recurrenceExceptions?.filter((e=>e.cancelled)).map((e=>e.date))),s=new Set(t.recurrenceExceptions?.filter((e=>e.cancelled)).map((e=>e.date)));if(i.size!==s.size||i.intersection(s).size!==i.size)return!1;const o=new Set(e.recurrenceExceptions?.filter((e=>!e.cancelled)).map((e=>e.date))),a=new Set(t.recurrenceExceptions?.filter((e=>!e.cancelled)).map((e=>e.date)));if(o.size||a.size){if(o.size!==a.size||o.intersection(a).size!==o.size)return!1;const i=F(e),s=n?n.map((e=>W(e,t))):F(t);for(const e of i){const t=s.find((t=>t.uid===e.uid));if(!t)return!1;if(0!==H(e,t).local.size)return!1}}return!0}function H(e,t,n){const i=n&&(0,Z.KU)(n,e),s=new Map,o=new Map;for(const n of Object.keys(e))r.NY.has(n)||("recurrenceExceptions"!==n?(U(n,e,t)||o.set(n,t[n]),i&&!U(n,e,i)&&s.set(n,i[n])):(V(e,t)||o.set(n,t[n]),i&&!V(e,i)&&s.set(n,t[n])));return{incoming:s,local:o}}var G=n(1407);function $(e,t,n){t||(t=r.ZP.getCalendarCreateColor());const{vevent:i,vtodo:s}=n||{vevent:!0,vtodo:!1};return`<?xml version="1.0" encoding="utf-8"?>\n    <C:mkcalendar xmlns:C="urn:ietf:params:xml:ns:caldav"><set xmlns="DAV:">\n      <prop><displayname>${e}</displayname>\n        <C:supported-calendar-component-set>\n        ${i?'<C:comp name="VEVENT" />':""}\n        ${s?'<C:comp name="VTODO" />':""}\n        </C:supported-calendar-component-set>\n        <calendar-color xmlns="http://apple.com/ns/ical/">${t}</calendar-color>\n      </prop></set>\n    </C:mkcalendar>`}var K=n(82164);const{constructUrl:z,stripDoubleQuotes:j}=a.Z;function Y(e){let t="";return e.split("/").forEach((e=>{e.includes("@")&&(t=e)})),t}async function X(e,t){const n=await s.Z.getAuthentication(e),{accessToken:i}=n,o=[(0,R.fP)(),"/v3/calendars",`?key=${await(0,K.w)()}`],a=z(o),r=await fetch(a,{method:"POST",headers:{Authorization:`Bearer ${i}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({summary:t})}),l={status:!1,message:"",description:"",name:""};if(r.ok){const e=function(e){const{id:t,summary:n,etag:i,timeZone:s}=e;return{name:t,description:n,ctag:j(i),timezone:s}}(await r.json());l.status=!0,l.description=e.description,l.name=`/caldav/v2/${e.name}/events/`,l.ctag=e.ctag}return l}var Q=n(80008),q=n.n(Q),J=n(81723),ee=n(58821);const{getLocalGoogleTasksCalendars:te}=r.ZP,{constructUrl:ne,stripDoubleQuotes:ie}=a.Z,se="YYYY-MM-DDTHH:mm:ss[Z]";function oe(e){const{items:t=[],etag:n}=e;return{...e,etag:ie(n),items:t.map((e=>({...e,etag:ie(e.etag)})))}}function ae(e,t){const{title:n,notes:s,etag:o,due:a,id:r,completed:l}=e,d=a?q().tz(q()(a),"UTC").valueOf():void 0,c=l?q().tz(q()(l),"UTC").valueOf():void 0,u={id:t.id,calendarId:t.calendarId,title:n,task:!0,description:s??"",end:d,etag:ie(o),status,uid:r,complete:Boolean(l),completed:c,timezone:R.$T,allDay:!0},[p]=i.ZP.transformVivaldiEvents([u]);return p}function re(e,t){const{title:n,notes:i,due:s,etag:o,id:a,completed:r}=e,l=r?q()(r).valueOf():void 0;return{calendarId:t,title:n,is_template:!1,task:!0,description:i,end:s?q()(s).valueOf():void 0,etag:ie(o),status,uid:a,complete:Boolean(r),completed:l,timezone:R.$T,allDay:!0}}async function le(e){const t=await s.Z.getAuthentication(e),{parsed:n,status:a}=await de(t),r={numberOfCalendarsPolled:0,numberOfChangedCalendars:0};if(n.error){const t=new Date;return o.Z.getState().calendars.filter((t=>t.accountId===e.id)).forEach((async e=>await i.ZP.updateCalendar(e.id,{lastChecked:t.valueOf()},!1))),b.Z.log("Calendar",["google","tasks"],"Error fetching TaskList: ",a,n),r}const l=oe(n),d=te(e);r.numberOfCalendarsPolled=l.items.length;const c=(0,J.Z)(l.items,d,((e,t)=>{const{id:n}=e;return n===t.name})),u=await async function(e,t,n){return await Promise.all(e.map((async e=>{const s={accountId:t.id,name:e.id,description:e.title,active:n,supportedCalendarComponent:{vevent:!1,vtodo:!0,vjournal:!1}},o=await i.ZP.createCalendar(s,t);if(!o.calendar)throw Error("Calendar was not created");return o.calendar})))}(c,e,d.length>0),[p,h]=(0,N.Z)(d,(e=>l.items.some((t=>t.id===e.name))));await Promise.all(h.map((async e=>{await i.ZP.deleteCalendar(e)})));const g=u.concat(p),m=(0,J.Z)(g,l.items,((e,t)=>{const{name:n}=e;return n===t.id&&e.ctag===t.etag}));await Promise.all(m.map((async e=>{const n=function(e){const{items:t=[],etag:n}=e;return{...e,etag:ie(n),items:t.map((e=>({...e,etag:ie(e.etag)})))}}(await async function(e,t){const{accessToken:n}=e,i=["showCompleted=true","showHidden=true"],s=`${(0,R.fL)()}/tasks/v1/lists/${t}/tasks?${i.join("&")}&key=${await(0,K.w)()}`,o=await fetch(s,{method:"GET",headers:{Accept:"application/json",Authorization:`Bearer ${n}`}}),{status:a,ok:r,statusText:l}=o;if(!r)throw b.Z.log("Calendar",["google, tasks"],"Error getting tasks",a,l),Error(`Error getting tasks", ${a} ${l}`);return await o.json()}(t,e.name)),s=o.Z.getEventsPerCalendar(e.id),a=n.items.filter((e=>!s.some((t=>t.uid===e.id)))),d=s.filter((e=>-1===n.items.findIndex((t=>t.id===e.uid)))),c=s.map((e=>{const t=n.items.find((t=>t.id===e.uid&&ie(t.etag)!==e.etag));return t?{...ae(t,e)}:null})).filter(Boolean),u=a.map((t=>re(t,e.id)));await Promise.all(u.map((e=>i.ZP.createEvent(e,!1)))),await Promise.all(d.map((e=>i.ZP.deleteEvent(e.id)))),await Promise.all(c.map((e=>{const t=e.rrule?"all":"single";return i.ZP.updateEvent(e,t)})));const p=l.items.find((t=>e.name===t.id));let h={ctag:n.etag};p?.title!==e.description&&(h={...h,description:p?.title}),(u.length||d.length||c.length)&&r.numberOfChangedCalendars++,await i.ZP.updateCalendar(e.id,h,!1)})));const f=new Date;return g.forEach((async e=>await i.ZP.updateCalendar(e.id,{lastChecked:f.valueOf()},!1))),r}async function de(e){const{accessToken:t}=e,n=`${(0,R.fL)()}/tasks/v1/users/@me/lists?maxResults=200&key=${await(0,K.w)()}`,i=await fetch(n,{method:"GET",headers:{Accept:"application/json",Authorization:`Bearer ${t}`}}),{status:s,ok:o,statusText:a}=i;if(!o)throw b.Z.log("Calendar",["google, tasks"],"Error fetching task lists ",s,a),Error(`Error fetching task lists, ${s} ${a}`);return{status:s,parsed:await i.json()}}var ce=n(36154);function ue(e,t){return{...e,method:"REPORT",headers:{depth:"0"},body:`<?xml version="1.0" encoding="UTF-8"?>\n    <D:sync-collection xmlns:D="DAV:"\n      xmlns:CS="http://calendarserver.org/ns/"\n      xmlns:C="urn:ietf:params:xml:ns:caldav">\n    <D:sync-token>${encodeURI(t??"")}</D:sync-token>\n    <D:sync-level>1</D:sync-level>\n    <D:prop>\n      <D:getetag />\n    </D:prop>\n    </D:sync-collection>`}}const{concatUrl:pe}=a.Z;var he=n(89873);async function ge(e,t,n,i,s){let o=1e3,a=[];const r=n.length,l=[...n];return await async function d(){if(1===o)return b.Z.error("Calendar",["multiget"],"Error fetching events from server. Exhausted retries."),a;const u=(0,he.Z)(l,o);for(const p of u){const{status:u,ok:h,response:g}=await(0,x.ZP)(me(t,p),e);if(h){l.splice(0,p.length),a=a.concat(_(g,i));const e=a.length,t=Math.round(e/r*100);s((0,c.Z)("Fetching events $1 of $2 ($3%)",[e,r,t]))}else{if(u>=500&&u<=599){o=Math.max(1,Math.min(o,n.length)/2),await d();break}b.Z.error("Calendar",["multiget"],"Error fetching events."),console.log("CalDAV Multi-get request error.",g)}}}(),a}function me(e,t){return{...e,method:"REPORT",body:`<?xml version="1.0" encoding="UTF-8"?>\n    <c:calendar-multiget xmlns:d="DAV:" xmlns:c="urn:ietf:params:xml:ns:caldav">\n    <d:prop>\n        <d:getetag />\n        <c:calendar-data />\n    </d:prop>\n      ${t.map((e=>`<d:href>${encodeURI(e)}</d:href>`)).join("\n")}\n    </c:calendar-multiget>`}}var fe=n(88545),ve=n(25201),ye=n(9141);const{stripDoubleQuotes:be,getCalDAVUrl:Se,concatUrl:we}=a.Z,{getLocalGoogleTasksCalendars:Ce,getExceptionEvents:Ae,isOAuthProvider:Ie}=r.ZP;class Te extends Error{constructor(e,t,n){super("Error merging event data"),this.name="EventMergeError",this.diff=e,this.local=t,this.incoming=n}}const{VERIFYING:Ze,OK:Ee,ERROR:ke}=R.LB,{isCalDAV:_e}=r.ZP;let Ne,Pe=!1;const De=new Map;let Me=!1,Oe=!1;const xe={},Le=new Set,Re=new Set,Be=new Set,Fe=new Set;function We(e){const t=(0,p.Z)(e);if(!t)return;const{protocol:n,host:i}=t;return n&&i?n+"//"+i:void 0}async function Ue(){const e=o.Z.getEvents().filter((e=>e.syncPending));for(const t of e)if(r.ZP.isRemoteCalendar(t.calendarId))if(t.trash){const{deleteLocal:e,ok:n}=await et.deleteEvent(t.id);(e||n)&&await i.ZP.deleteEvent(t.id)}else await et.updateEvent(t);else await h.Z.updateEvent({id:t.id,syncPending:!1})}let Ve=navigator.onLine;function He(){!Ve&&navigator.onLine&&Ue(),Ve=navigator.onLine}function Ge(){o.Z.getAccounts().filter((e=>!!e.url)).forEach((e=>{o.Z.getCalendars().filter((t=>t.accountId===e.id)).forEach((t=>{t.active?Re.has(t.id)||(Re.add(t.id),Be.add(e.id)):Re.has(t.id)&&Re.delete(t.id)})),Le.has(e.id)||(Le.add(e.id),Be.add(e.id))})),Be.size>0&&(Ne&&clearTimeout(Ne),Ne=setTimeout((()=>{et.pollCalDAV(Array.from(Be)),Be.clear()}),1e3))}function $e(e){d.Z.setStatus(G.Ex,e,5e3)}const Ke=(e,t)=>{const n=Math.round(e/t*100);$e((0,c.Z)("Imported $1 of $2 ($3%)",[e,t,n]))};async function ze(e,t,n=!1){const a={calendarId:e.id,ctag:e.ctag,lastCalendarPoll:Date.now(),changed:!1},r=We(t.url);if(!r)return Promise.reject();const{urlValid:l}=L.Z.utilities.isUrlValid(e.name),d=l?e.name:we(r,e.name),u=await s.Z.getAuthentication(t);$e((0,c.Z)('Checking calendar "$1".',[e.description??""]));const p=e.ctag,h=await(0,x.ZP)(y(u),d);if(!h.ok)return et.getStatusMessageAndLog(t,h),a;const{ctag:g,syncToken:m}=I(h.response);return a.ctag=n&&m?m:g,""!==g&&p===g||(a.changed=!0,await async function(e,t,n){const{ok:s,response:a}=await(0,x.ZP)((r=t,{...r,method:"PROPFIND",headers:{Depth:"1"},body:'<?xml version="1.0" encoding="UTF-8"?>\n    <D:propfind xmlns:D="DAV:">\n      <D:prop>\n        <D:getcontenttype/>\n        <D:resourcetype/>\n        <D:getetag/>\n      </D:prop>\n    </D:propfind>'}),n);var r;if(!s)return void b.Z.warn("Calendar",(0,c.Z)("Error polling calendar. $1",[a]));const l=_(a,e.id),d=o.Z.getEventsPerCalendar(e.id);let u=d.filter((e=>!l.some((t=>t.href===e.href))));const p=l.filter((e=>!d.some((t=>t.etag===e.etag)))).map((e=>e.href||""));if(0===p.length)return void u.forEach((e=>i.ZP.deleteEvent(e.id)));const h=await ge(n,t,p,e.id,(e=>{$e(e)}));u=u.filter((e=>h.some((t=>e.uid!==t.uid)))),await Promise.all(u.map((e=>i.ZP.deleteEvent(e.id)))),await(0,ye.Wy)(d,h);const g=h.filter((e=>!d.some((t=>t.uid===e.uid))));try{await(0,Z.nj)(g,Ke)}catch(e){b.Z.error("Calendar",["caldav"],"Error creating events",e)}}(e,u,d)),a}async function je(e,t){const n={calendarId:e.id,ctag:e.ctag,lastCalendarPoll:Date.now(),changed:!1},a=We(t.url);if(!a)throw new Error("Missing URL prefix");const r=e.id,l=a+e.name,d=await s.Z.getAuthentication(t),u=o.Z.getEventsPerCalendar(r),p=new Map,h=new Set;u.forEach((e=>{e.href&&p.set(e.href,e.etag),e.uid&&h.add(e.uid)}));let g=[];const m=[],f=[];let v=!1,S=null;do{const i=e.ctag;if(S=await(0,x.ZP)(ue(d,i),l),!S.ok){if(403!==S.status){b.Z.warn("Calendar",["caldav"],"Error fetching sync-collection"),et.getStatusMessageAndLog(t,S);continue}{b.Z.info("Calendar",["caldav"],t.name,e.name,"403 while fetching sync-collection. Stale Sync-token. Re-fetching",S.response);const n=await(0,x.ZP)(y(d),l);if(!n.ok){et.getStatusMessageAndLog(t,n);continue}const{syncToken:s}=I(n.response);s!==i&&(S=await(0,x.ZP)(ue(d,s),l))}}const s=O(S.response,e.name),{staleSyncToken:o,createdUpdated:a,syncToken:r,error:c}=s;if(c&&b.Z.warn("Calendar",["caldav"],"Error parsing sync-collection"),v=s.serverThrottlesEvents,g=g.concat(s.deletedHrefs),e={...e,ctag:r},n.ctag=r,o)return await ze(e,t,!0);if(i===r)return n;n.changed=!0;const u=new Set,w=a.filter((({etag:e,href:t})=>{const n=!p.has(t);n&&u.add(t);const i=p.has(t)&&p.get(t)!==e;return p.set(t,e),n||i})).map((({href:e})=>e||"")),C=(w.length?await ge(l,d,w,e.id,$e):[]).filter((e=>!Fe.has(e.uid??""))),[A,T]=(0,N.Z)(C,(e=>u.has(e.href)&&!h.has(e.uid)));m.push(...A),f.push(...T)}while(v);await(0,ye.Wy)(u,f);const w=u.filter((e=>g.some((t=>t===e.href))));await Promise.all(w.map((e=>i.ZP.deleteEvent(e.id)))),m.length&&$e((0,c.Z)("Importing $1 event","Importing $1 events",[m.length]));try{await(0,Z.nj)(m,Ke)}catch(e){b.Z.error("Calendar",["caldav"],"Error creating events",e)}return n}async function Ye(e,t){const n={calendars:[],error:!1,message:""};t=t??await s.Z.getAuthentication(e);const i=await(0,x.ZP)((0,u.ZP)(t),e.url),{status:o,response:a,ok:r}=i;if(!(r&&o>=200&&o<300))return n.message=et.getStatusMessageAndLog(e,i),n.error=!0,n;if(n.calendars=(0,S.Z)(a),0===n.calendars.length&&b.Z.warn("Calendar",["caldav"],(0,c.Z)("No calendars found on the server for the account “$1”.",[e.name])),"google"===e.account_type){let e;try{e=await async function(e){const{parsed:t,status:n}=await de(e);if(t.error)return b.Z.error("Calendar",["google","tasks"],"Error fetching TaskList: ",n,t),[];const i=oe(t);return i.items.map((e=>({ctag:i.etag,name:e.id,description:e.title,color:"",supportedCalendarComponent:{vevent:!1,vtodo:!0,vjournal:!1},supportsSyncCollection:!1,syncToken:""})))}(t)}catch(e){return n.error=!0,n.message=e.message,n}n.calendars.push(...e)}return n}function Xe(e,t){return Promise.all(e.map((async e=>{const{ctag:n,supportsSyncCollection:s,syncToken:o,...a}=e,r={...a,accountId:t.id,active:e.active??!0,hidden:e.hidden??!1},{calendar:l}=await i.ZP.createCalendar(r,t);if(!l)throw Error("Calendar was not created");return l})))}async function Qe(e,t){const n=o.Z.getCalendars().filter((t=>{if("google"===e.account_type){if(!t.supportedCalendarComponent)return;const{vevent:n}=t.supportedCalendarComponent;return t.accountId===e.id&&n}return t.accountId===e.id})),s=t.filter((e=>!n.some((t=>e.name===t.name)))),a=await Xe(s,e),[l,d]=(0,N.Z)(n,(e=>t.some((t=>t.name===e.name))));await Promise.all(d.map((async e=>await i.ZP.deleteCalendar(e))));const c=a.concat(l);t.forEach((async e=>{const t=c.find((t=>t.name===e.name));if(!t)return;const n={},s=r.ZP.validColor(e.color);s!==t.color&&s&&(n.color=s),e.description!==t.description&&(n.description=e.description),Object.keys(n).length&&await i.ZP.updateCalendar(t.id,n,!1)}));const u=c.filter((t=>t.active&&t.accountId===e.id)),p=[];for(const n of u){const i=t.find((e=>e.name===n.name));if(!i)break;i?.supportsSyncCollection?i.syncToken!==n.ctag&&p.push(await je(n,e)):p.push(await ze(n,e))}await Promise.all(p.filter(Boolean).map((async e=>{const{calendarId:t,ctag:n}=e;await i.ZP.updateCalendar(t,{ctag:n},!1)})));const h=p.filter(Boolean).reduce(((e,t)=>(t.changed&&e++,e)),0);return{numberOfCalendarsPolled:u.length,numberOfChangedCalendars:h}}async function qe(e){navigator.onLine&&!Pe&&(Pe=!0,await Ue());const t={didPoll:!1,calendars:[],error:!1,message:""};if(!navigator.onLine)return t.error=!0,t.message=(0,c.Z)("No network connection."),Ne=setTimeout(qe,2e4),t;Me=!0;let n=o.Z.getAccounts().filter((e=>e.url.length));if(n=n.filter((e=>!De.has(e.id))),e?.length&&(n=e.map((e=>n.find((t=>t.id===e)))).filter(Boolean)),De.size&&!Oe){Oe=!0;try{await Promise.all(Array.from(De.values()).map((async e=>await e.onRemoval(e.accountId))))}catch(e){b.Z.error("Calendar","Error removing account",e)}finally{Oe=!1}}try{for(const a of n){const{url:n,account_type:r,name:d}=a;if(!(!!e&&e.includes(a.id))){const e=o.Z.getState().calendars.filter((e=>e.accountId===a.id)).map((e=>e.lastChecked)).filter(Boolean).reduce(((e,t)=>(t??0)>e?t:e),0),t=Date.now(),n=e?e+1e3*R.jC:t;if(!(n<=t))continue}try{if(i.ZP.stopAPIChangeListeners(),t.didPoll=!0,_e(r)){const e=await s.Z.getAuthentication(a),l=await(0,x.ZP)((0,u.ZP)(e),n),{status:p,response:h,ok:g}=l;let m=[];if(p>=200&&p<300?(m=(0,S.Z)(h),0===m.length&&b.Z.warn("Calendar",["caldav"],(0,c.Z)("No calendars found on the server for the account “$1”.",[d]))):(t.message=et.getStatusMessageAndLog(a,l),t.error=!0),g){if("google"===r){let e;try{e=await le(a)}catch(e){return t.error=!0,t.message=e.message,t}t.calendars.push(e)}const e=await Qe(a,m);t.calendars.push(e)}else{const e=o.Z.getState().calendars.filter((e=>e.accountId===a.id)).map((e=>e.id));await Promise.all(e.filter(Boolean).map((async e=>await i.ZP.updateCalendar(e,{lastChecked:Date.now()},!1))))}}else if("ical"===r){const e=await l.Z.fetchAndCreate(a);t.calendars.push(e)}}catch(e){t.message=et.getStatusMessageAndLog(a,e.toString()),t.error=!0}finally{const e=o.Z.getState().calendars.filter((e=>e.accountId===a.id)).map((e=>e.id));await Promise.all(e.filter(Boolean).map((async e=>await i.ZP.updateCalendar(e,{lastChecked:Date.now()},!1)))),i.ZP.startAPIChangeListeners()}}}finally{Me=!1,Fe.clear();o.Z.getAccounts().some((e=>e.url))&&(Ne=setTimeout((()=>qe()),2e4))}return t}async function Je(e,t,n,i,s){let a,r=(0,C.Z)(e.href||""),l=e.etag,u=e.response;if(!l){const e=await(0,x.ZP)(v(i,{uid:t.uid},n.name,[],"get")),{ok:o,status:a}=e;if(!o){const n="create"===s?(0,c.Z)("Error getting newly created event from server. Retrying on next sync."):(0,c.Z)("Error getting newly updated event from server. Retrying on next sync.");d.Z.setStatus(G.Ex,n,5e3);const i=`${n} ${e.response}`;return void b.Z.error("Calendar",["caldav"],i,a,t)}l=e.etag||"",u=e.response,r=(0,C.Z)(e.href||"")}try{const{VEVENT:e,VTODO:i}=(0,T.Z)(u);if((e?.length??0+i?.length??0)>0){const t={etag:l,href:r},s=(0,Z.rP)(e?.length?e[0]:i[0],n.id,t);s.syncPending=!1;const d=o.Z.getEventsPerCalendar(n.id),c=(await(0,ye.Wy)(d,[s])).filter((e=>!e.recurrenceId));if(1!==c.length)throw console.log("Error saving synced event",u),new Error("Unexpected number of events after update");a=c[0]}else a=await h.Z.updateEvent({...t,syncPending:!1,etag:l,href:r})}catch(e){if(!(e instanceof T.z))throw e;b.Z.error("Calendar",["caldav","parsing"],e),console.log("iCalendar parsing error, updateEvent",u)}return a}const et={calendarServiceStart(){o.Z.addListener(Ge),navigator.connection.addEventListener("change",He)},calendarServiceStop(){o.Z.removeListener(Ge),navigator.connection.removeEventListener("change",He),clearTimeout(Ne)},resetStatus(e){xe[e]&&(xe[e].authenticationErrorCount=0)},resetEventRemoteData:e=>(e.href=void 0,e.url=void 0,e.etag=void 0,e),pollCalDAV:e=>(Ne&&clearTimeout(Ne),Me?Promise.resolve({didPoll:!1,calendars:[],message:"",error:!1}):qe(e)),prepareForDeleteAccount:e=>(De.set(e.accountId,e),qe([e.accountId])),doneDeleteAccount(e){De.delete(e)},async deleteEvent(e){const t={ok:!1,deleteLocal:!1},n=o.Z.getEvents().find((t=>t.id===e));if(!n||!navigator.onLine)return t;const i=o.Z.getCalendars().find((e=>e.id===n.calendarId));if(!i)return t;if(!i.active)return b.Z.info("Calendar",`Event ${n.title} not deleted on server. Sync disabled.`),t;const r=o.Z.getAccounts().find((e=>e.id===i.accountId));if(r?.url){const e=await s.Z.getAuthentication(r);if("google"!==r.account_type||!n.task){let{href:t}=n;if(!t){const{eventHref:s}=a.Z.urlForEvent(e.url,i.name,{etag:n.etag,uid:n.uid});t=s}const s=await(0,x.ZP)(v(e,{href:t},i.name,[],"delete"));return s.ok||et.getStatusMessageAndLog(r,s),{ok:s.ok,deleteLocal:[404,409,412].includes(s.status)}}if(!n.uid)return t;!async function(e,t){const{accessToken:n}=e,i=`${(0,R.fL)()}/tasks/v1/lists/@default/tasks/${t}?key=${await(0,K.w)()}`,s=await fetch(i,{method:"DELETE",headers:{Authorization:`Bearer ${n}`}}),{status:o,ok:a,statusText:r}=s;if(!a)throw b.Z.log("Calendar",["google, tasks"],"Error deleting task",o,r),Error(`Error deleting task", ${o} ${r}`)}(e,n.uid)}return t},async updateEvent(e,t){if(!navigator.onLine)return void await h.Z.updateEvent({id:e.id,syncPending:!0});let n={...e};const i=o.Z.getCalendars().find((e=>e.id===n.calendarId)),r=o.Z.getAccounts();if(!i)return;if(!i.active)return void b.Z.info("Calendar",`Event ${n.title} not updated on server. Sync disabled.`);const{accountId:l}=i,u=r.find((e=>e.id===l));if(!u)return;const p=await s.Z.getAuthentication(u);if("google"===u.account_type&&n.task){const t=await async function(e,t,n){const{accessToken:i}=e,{etag:s="",title:o,uid:a="",end:r,description:l}=t,d=`${(0,R.fL)()}/tasks/v1/lists/${n}/tasks/${a}?key=${await(0,K.w)()}`;let c;r&&(c=q().tz(q()(r),"UTC").format(se));const u={status:t.complete?"completed":"needsAction",...(0,g.Z)(t.complete?{completed:q().tz(q()(),"UTC").format(se)}:null)},p={kind:"tasks#taskList",id:`${a}`,etag:`${s}`,title:`${o}`,...(0,g.Z)(c?{due:c}:null),...(0,g.Z)(l?{notes:l}:null),...u},h=await fetch(d,{method:"PUT",headers:{Accept:"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify(p)}),{status:m,ok:f,statusText:v}=h;if(!f)throw b.Z.error("Calendar",["google, tasks"],"Error updating task",m,v),Error(`Error updating task", ${m} ${v}`);return await h.json()}(p,n,i.name),{etag:s}=t;return h.Z.updateEvent({id:e.id,syncPending:!1,etag:s})}if(n.href||n.etag){const{etag:e,href:s,uid:r}=n,l={etag:e,href:s,uid:r},u=[...Ae(n,t?.exceptionEvent),n];let h=await(0,x.ZP)(v(p,l,i.name,u,"update"));const{ok:g,status:m}=h;if(!g){if(409!==m&&412!==m){const e=(0,c.Z)("Error synching updates to server. Changes not saved.");return d.Z.setStatus(G.Ex,e,5e3),void b.Z.warn("Calendar",["caldav"],e,h.response,m)}{n.href||(n.href=a.Z.urlForEvent(p.url,i.name,l).eventHref);const e=await async function(e,t,n){const{urlValid:i}=L.Z.utilities.isUrlValid(t),s=i?t:pe(e.url,t),o=await(0,x.ZP)({...e,method:"GET",url:s,headers:{"Content-Type":"text/calendar",Accept:"application/xml, text/calendar"}});if(!o.ok)return void b.Z.warn("Calendar",["caldav"],"Error getting event.",o.status,o.response);const{etag:a,response:r}=o;try{const{VEVENT:e,VTODO:i}=(0,T.Z)(r),s=e?.[0]??i?.[0];return(0,Z.rP)(s,n,{etag:a,href:t})}catch(e){if(e instanceof T.z)return b.Z.warn("Calendar",["caldav"],e),void console.log("CalDAV iCalendar parsing error.",r);throw e}}(p,n.href,i.id);if(!e)return;const s=t?.originalEvent;if(s){const a=H(s,n,e),{etag:r,href:l,uid:d,sequence:c}=e,u=c?c+1:1;try{n=function(e,t,n){const i={...e};n&&(i.sequence=n);for(const[e,n]of t.incoming.entries()){if(t.local.has(e)&&t.local.get(e)!==n)throw new Error("Can not merge events. Inconsolable changes.");i[e]=n}for(const[e,n]of t.local.entries())i[e]=n;return i}(s,a,u)}catch{throw new Te(a,{...n,sequence:u,etag:e.etag},(0,Z.KU)({...e,sequence:u},s))}const g={etag:r,href:l,uid:d},m=a.incoming.has("recurrenceExceptions")?[...(e.exceptionEvents??[]).map((e=>W(e,n))),n]:[...Ae(n,t?.exceptionEvent),n],f=v(p,g,i.name,m,"update");h=await(0,x.ZP)(f);const{ok:y,status:S}=h;if(!y)return b.Z.error("Calendar",["caldav"],"Error syncing to server, merging changes failed.",h.response,S),void console.log(f.body);const w=(0,T.Z)(f.body??""),C=w.VEVENT.length?w.VEVENT:w.VTODO;C?.length&&await(0,ye.Wy)(o.Z.getEvents(),C.map((e=>(0,Z.rP)(e,n.calendarId,{etag:r,href:l}))))}}}return Je(h,n,i,p,"update")}return n.sequence=0,et.createEvent(n)},async createEvent(e){if(!navigator.onLine)return;const t={...e,uid:e.uid||crypto.randomUUID()},n=o.Z.getAccounts();let a=o.Z.getCalendars().find((e=>e.id===t.calendarId));if(!a)return void b.Z.debug("Calendar not found for event",t);if(!a.active)return void b.Z.info("Calendar",`Event ${t.title} not created on server. Sync disabled.`);const{etag:r,href:l,uid:d}=t,{accountId:u}=a,p=n.find((e=>e.id===u));if(!p)return void b.Z.debug("Account not found for event",t);const m={etag:r,href:l,uid:d};let f;d&&Fe.add(d);const y=await s.Z.getAuthentication(p),S=a.id;if("google"===p.account_type&&t.task){const e=Ce(p);if(!e.find((e=>e.id===S))){if(!(e.length>0))return void b.Z.log("Calendar",["google","tasks"],"Warning. No Google Task list found. Task not created.");a=e[0]}const n=await async function(e,t,n){const{accessToken:i}=e,{etag:s="",title:o,uid:a="",end:r,description:l}=n,d=[(0,R.fL)(),"/tasks/v1/lists/",t,`tasks?key=${await(0,K.w)()}`],c=ne(d),u=r?q()((0,ee.VV)(new Date(r))).format(se):void 0,p={kind:"tasks#taskList",id:`${a}`,etag:`${s}`,title:`${o}`,due:u?`${u}`:void 0,...(0,g.Z)(l?{notes:l}:null)},h=await fetch(c,{method:"POST",headers:{Accept:"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify(p)}),{status:m,ok:f,statusText:v}=h;if(!f)throw b.Z.error("Calendar",["google, tasks"],"Error creating task",m,v),Error(`Error creating task", ${m} ${v}`);return await h.json()}(y,a.name,t);t.etag=be(n.etag),t.uid=n.id,t.syncPending=!1,await h.Z.updateEvent(t)}else{const e=await(0,x.ZP)(v(y,m,a.name,[...Ae(t),t],"create")),{ok:n,status:s}=e;if(!n){if(412===s||409===s){const{id:e,uid:n}=t;if(o.Z.getEvents().some((i=>i.uid===n&&i.id!==e&&!t.trash)))return i.ZP.deleteEvent(t.id)}const n=`${(0,c.Z)("Error creating event on server. Retrying on next sync.")} ${e.response}`;return void b.Z.error("Calendar",["caldav"],n,s,t)}f=await Je(e,t,a,y,"update")}return d&&Fe.delete(d),f},updateCalendar:(e,t)=>new Promise(((n,i)=>{const l=o.Z.getAccounts(),d=o.Z.getCalendars().find((t=>t.id===e));if(!d)return void n();const{accountId:c}=d,u=l.find((e=>e.id===c));if(!u?.url)return void n();const h={};t.description!==d.description&&(h.description=t.description);const g=r.ZP.validColor(t.color);t.color===d.color||!g||"google"===u?.account_type&&d.supportedCalendarComponent?.vtodo||(h.color=g),0!==Object.keys(h).length?s.Z.getAuthentication(u).then((e=>{(0,x.ZP)(function(e,t,n,i){let s="";const o=(0,p.Z)(t);if(o){const{protocol:e,host:t}=o;if(e&&t){const i=e+"//"+t;s=a.Z.constructUrl([i,n])}}const r=[];return i.description&&r.push(`<D:displayname>${i.description}</D:displayname>`),i.color&&r.push(`<calendar-color xmlns="http://apple.com/ns/ical/">${i.color}</calendar-color>`),{...e,url:s,method:"PROPPATCH",body:`<?xml version="1.0" encoding="UTF-8"?>\n<D:propertyupdate xmlns:D="DAV:"\nxmlns:CS="http://calendarserver.org/ns/"\nxmlns:C="urn:ietf:params:xml:ns:caldav">\n<D:set>\n<D:prop>\n${r.join("\n")}\n</D:prop>\n</D:set>\n</D:propertyupdate>`}}(e,u.url,d.name,h)).then((e=>{e.ok&&n()})).catch((e=>{i(e)}))})):n()})),async createCalendar(e,t){if("google"===e.account_type){const{name:n,description:i}=t,s=n||i||"";return await X(e,s)}return await async function(e,t){const n={message:"",status:!1,name:"",description:""},{name:i,color:o,description:a,supportedCalendarComponent:r}=t,l=i||a||"";let d;try{d=await s.Z.getAuthentication(e)}catch(e){return n.message=e,n}const{url:u}=d,p=`${u.endsWith("/")?u:u+"/"}${l}`,h={...d,url:p,method:"MKCALENDAR",contentType:"application/xml",body:$(l,o,r)},g=await(0,x.ZP)(h);if(g.ok){const e={...h,method:"PROPFIND",headers:{Brief:"t",Depth:"1"},body:'<?xml version="1.0" encoding="utf-8"?><D:propfind xmlns:D="DAV:">\n                  <D:prop><D:getetag /><D:getcontenttype /></D:prop></D:propfind>'},t=await(0,x.ZP)(e);if(t.ok){const e=await t.response,i=(0,w.Z)(e);if(i.d_error||i.parsererror||!i.d_multistatus)return n.message=(0,c.Z)("Error parsing calendar path response."),console.log("Create Calendar parse error",e),n;i.d_multistatus.d_response.forEach((e=>{n.name=(0,C.Z)(e.d_href.content),n.status=!0,n.message=(0,c.Z)("Success")}))}else n.message=`${(0,c.Z)("Error creating Calendar.")} ${t.status}}`,console.log("Create Calendar Error",t.response)}else 405===g.status?(n.message=(0,c.Z)("Error creating Calendar. It might already exist."),console.log("Create Calendar 405 error",g.response)):(n.message=(0,c.Z)("Error creating Calendar."),console.log("Create Calendar error",g.response));return n}(e,t)},async deleteCalendar(e,t){const{account_type:n,url:i}=e;if("google"===n){const n=o.Z.getCalendars().find((e=>e.name===t));if(!n?.supportedCalendarComponent)return{message:(0,c.Z)("Calendar not found"),status:!1};const{supportedCalendarComponent:i}=n,{vtodo:a}=i;if(a){return async function(e,t){const{accessToken:n}=e,i=`${(0,R.fL)()}/tasks/v1/users/@me/lists/${t}?key=${await(0,K.w)()}`,s=await fetch(i,{method:"DELETE",headers:{Authorization:`Bearer ${n}`}}),{status:o,ok:a}=s;let r=s.statusText;return a||(r=`Error deleting task list. ${(await s.json())?.error?.message}`,b.Z.log("Calendar",["google","tasks"],r,o)),{status:a,message:r}}(await s.Z.getAuthentication(e),t)}return async function(e,t){const n=await s.Z.getAuthentication(e),{accessToken:i}=n,o=[(0,R.fP)(),"/v3/calendars",(a=Y(t),a.endsWith("/")?a.slice(0,-1):a),`?key=${await(0,K.w)()}`];var a;const r=z(o),l=await fetch(r,{method:"DELETE",headers:{Authorization:`Bearer ${i}`,Accept:"application/json"}}),{status:d,ok:c}=l;let u=l.statusText;return c||(u=`Error deleting calendar. ${(await l.json())?.error?.message}`,b.Z.log("Calendar",["google"],u,d)),{status:c,message:u}}(e,t)}const a=await s.Z.getAuthentication(e),{ok:r,status:l,response:d}=await(0,x.ZP)({...a,url:Se(i,t),method:"DELETE",headers:{Depth:"infinity"}});let u="";return r||(b.Z.warn("Calendar",["caldav"],l,d),u=`${(0,c.Z)("Error deleting calendar.")} ${d}`),{message:u,status:r}},getCalendarUrl(e,t){if("google"===e)return(0,R.A2)(t);if("vivaldi"===e)return(0,R.Mf)(t);if("fastmail"===e)return(0,R.L9)(t);throw Error("getCalendarUrl. Unsupported account type")},async getCalDAVAccountDetails(e,t){const{name:n,url:i,account_type:o,username:a,password:r}=e,l={id:"",name:n,url:i,account_type:o,username:a,interval:R.jC},d={account:l,password:r,calendars:[]};"vivaldi"===o?l.username=(0,ce.JI)(l.username):"fastmail"===o?a&&-1===a.indexOf("@")&&(l.username=`${a}@fastmail.com`):"google"===o&&(l.username=l.username.toLowerCase(),a&&-1===a.indexOf("@")&&(l.username=`${a}@gmail.com`)),t((0,c.Z)("Verifying..."),Ze,l);let u={statusMessage:"",foundService:!1};if("caldav"===o){if(u=await(0,fe.k)(l,r),!u.foundService){throw t(u.statusMessage||(0,c.Z)("Unknown connection error. Please check your account information."),ke),new Error(u.statusMessage)}l.url=u.calendarHomeSetURL,t((0,c.Z)("Connected to CalDAV, found $1 calendar.","Connected to CalDAV, found $1 calendars.",[u.calendars.length]),Ee,l)}else if(Ie(o)){l.url=et.getCalendarUrl(o,l.username);try{const e=await s.Z.getAuthentication(l);e.username!==l.username&&(l.username=e.username,l.url=et.getCalendarUrl(o,l.username))}catch(e){throw t((0,c.Z)("Login aborted. Please try again."),ke),e}u=await(0,fe.P)(l,r)}if(!u?.foundService)return t(u.statusMessage,ke),d;const p=await s.Z.getAuthentication(l,r),h=await Ye(l,p);return h.error?(t((0,c.Z)("Error getting calendars.")+h.message,ke),d):(d.calendars=h.calendars,d)},async saveCalendarAccount(e,t){let{account:n,password:s}=e;try{n.url=new URL(n.url).href;const{url:e,username:t,account_type:i}=n;(["caldav","vivaldi"].includes(i)||"ical"===i&&t)&&(0,ve.vW)({url:e,username:t},s)}catch(e){throw t(e.message,ke),e}try{const{id:e,...s}=n;n=await i.ZP.createAccount(s),t((0,c.Z)("Account saved"),Ee)}catch(e){return t((0,c.Z)("Error saving account:")+String(e?.message||e),ke),!1}try{await Xe(e.calendars,n)}catch(e){return t((0,c.Z)("Error saving calendars:")+String(e?.message||e),ke),!1}return!0},getStatusMessageAndLog(e,t){const n="string"==typeof t?-1:t.status,i="string"==typeof t?t:t.response,{account_type:s,name:o}=e;let a="";return xe[o]||(xe[o]={authenticationErrorCount:0}),401===n?(a=(0,c.Z)("Authentication for the account “$1” failed. Check your username and password in your calendar account settings, or contact your account provider.",[o]),b.Z.error("Calendar",[s,"polling"],a)):403===n?a=(0,c.Z)("Forbidden request for the account “$1”. Possible mismatch in state of client and server.",[o]):404===n?(a="ical"===s?(0,c.Z)("The remote calendar for the account “$1” is missing on the server. Verify your calendar account settings, or contact the calendar service provider. $2",[o,i]):(0,c.Z)("The user account or a calendar is missing on the account server “$1”. Verify your calendar account settings, or contact your calendar service provider. $2",[o,i]),b.Z.error("Calendar",[s,"polling"],a,t)):410===n?(a="ical"===s?(0,c.Z)("The remote calendar for the account “$1” has been removed from the server. Remove the calendar from your account settings, or contact your calendar service provider. $2",[o,i]):(0,c.Z)("The user account or calendar has been removed from the account server for “$1”. Remove the account or calendar from your account settings, or contact your calendar service provider. $2",[o,i]),b.Z.error("Calendar",[s,"polling"],a,t)):429===n?(a=(0,c.Z)("The account server is temporarily refusing more requests for account “$1”. $2",[o,i]),console.log("Calendar",[s,"polling"],a,t)):n>=400&&n<500?(a=(0,c.Z)("Unexpected client-side problem (HTTP $2) for account “$1”. $3",[o,n,i]),b.Z.warn("Calendar",[s,"polling"],a,t)):503===n?(a=(0,c.Z)("The account server is temporarily unavailable (HTTP 503) for account “$1”. $2",[o,i]),console.log("Calendar",[s,"polling"],a,t)):n>=500?(a=(0,c.Z)("Unexpected server-side problem (HTTP $2) for account “$1”.",[o,n]),b.Z.warn("Calendar",[s,"polling"],a,t)):-1===n&&navigator.onLine?(a=(0,c.Z)("Network problem for account “$1”. $2",[o,i]),b.Z.warn("Calendar",[s,"polling"],a,t)):(a=(0,c.Z)("Unexpected problem when retrying server data for account “$1”. $2",[o,i]),navigator.onLine&&b.Z.warn("Calendar",[s,"polling"],a,n,t)),a}},tt=et},35391:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var i=n(84749);const s="DAV:",o="urn:ietf:params:xml:ns:caldav",a="http://calendarserver.org/ns/",r={prefixes:{":":"",[s]:"d",[o]:"c",[a]:"cs"},simplify:[{parentns:o,parent:"calendar-home-set",elementns:s,element:"href"},{parentns:o,parent:"calendar-multiget",elementns:s,element:"prop"},{parentns:o,parent:"calendar-query",elementns:o,element:"filter"},{parentns:o,parent:"calendar-query",elementns:s,element:"prop"},{parentns:o,parent:"comp-filter",elementns:o,element:"comp-filter"},{parentns:s,parent:"current-user-principal",elementns:s,element:"href"},{parentns:o,parent:"filter",elementns:o,element:"comp-filter"},{parentns:s,parent:"multistatus",elementns:s,element:"sync-token"},{parentns:s,parent:"prop",elementns:o,element:"calendar-data"},{parentns:s,parent:"prop",elementns:o,element:"calendar-home-set"},{parentns:s,parent:"prop",elementns:s,element:"current-user-principal"},{parentns:s,parent:"prop",elementns:s,element:"displayname"},{parentns:s,parent:"prop",elementns:a,element:"getctag"},{parentns:s,parent:"prop",elementns:s,element:"getetag"},{parentns:s,parent:"prop",elementns:s,element:"resourcetype"},{parentns:s,parent:"prop",elementns:o,element:"supported-calendar-component-set"},{parentns:s,parent:"prop",elementns:s,element:"sync-token"},{parentns:s,parent:"propfind",elementns:s,element:"prop"},{parentns:s,parent:"propstat",elementns:s,element:"prop"},{parentns:s,parent:"propstat",elementns:s,element:"status"},{parentns:s,parent:"propstat",elementns:s,element:"errordescription"},{parentns:s,parent:"response",elementns:s,element:"href"},{parentns:s,parent:"response",elementns:s,element:"status"},{parentns:s,parent:"response",elementns:s,element:"errordescription"},{parentns:o,parent:"sync-collection",elementns:s,element:"prop"},{parentns:s,parent:"sync-collection",elementns:a,element:"sync-level"},{parentns:s,parent:"sync-collection",elementns:a,element:"sync-token"}]};function l(e){const t=(0,i.Z)(e,r);return Array.isArray(t?.d_multistatus?.d_response)&&(t.d_multistatus.d_response=t.d_multistatus.d_response.map((e=>{if(!Array.isArray(e.d_propstat))return e;const t=e.d_propstat.filter((e=>{var t;return-1!==(t=e.d_status,Array.isArray(t)?t[0]:t).content.indexOf("200")})),n=t.reduce(((e,t)=>!e.d_prop||Array.isArray(e.d_prop)||Array.isArray(t.d_prop)?Object.assign(e,t):(e.d_prop=Object.assign(e.d_prop,t.d_prop),e)),{});return e.d_propstat=n,e}))),t}},64877:(e,t,n)=>{"use strict";function i(e){return{...e,headers:{Depth:"1"},method:"PROPFIND",body:'<?xml version="1.0" encoding="UTF-8"?>\n    <D:propfind xmlns:D="DAV:"\n      xmlns:CS="http://calendarserver.org/ns/">\n      <D:prop>\n        <D:getetag />\n        <D:displayname />\n        <CS:getctag />\n        <D:resourcetype />\n        <supported-calendar-component-set xmlns="urn:ietf:params:xml:ns:caldav" />\n        <supported-address-data xmlns="urn:ietf:params:xml:ns:carddav" />\n        <xmpp-uri xmlns="http://calendarserver.org/ns/" />\n        <calendar-color xmlns="http://apple.com/ns/ical/" />\n        <D:supported-report-set />\n        <D:sync-token />\n      </D:prop>\n    </D:propfind>'}}function s(){return'<?xml version="1.0" encoding="utf-8"?>\n    <D:propfind xmlns:D="DAV:">\n      <D:prop>\n        <D:current-user-principal />\n        <D:resourcetype xmlns:D="DAV:" />\n      </D:prop>\n    </D:propfind>'}function o(){return'<?xml version="1.0" encoding="utf-8"?>\n    <D:propfind xmlns:D="DAV:">\n      <D:prop>\n        <D:displayname />\n        <schedule-inbox-URL xmlns="urn:ietf:params:xml:ns:caldav" />\n        <schedule-outbox-URL xmlns="urn:ietf:params:xml:ns:caldav" />\n        <calendar-user-address-set xmlns="urn:ietf:params:xml:ns:caldav" />\n        <default-calendar-URL xmlns="http://icewarp.com/ns/" />\n        <default-tasks-URL xmlns="http://icewarp.com/ns/" />\n        <default-contacts-URL xmlns="http://icewarp.com/ns/" />\n        <default-notes-URL xmlns="http://icewarp.com/ns/" />\n        <calendar-home-set xmlns="urn:ietf:params:xml:ns:caldav" />\n        <addressbook-home-set xmlns="urn:ietf:params:xml:ns:carddav" />\n        <D:resourcetype xmlns:D="DAV:" />\n        <supported-calendar-component-set xmlns="urn:ietf:params:xml:ns:caldav" />\n      </D:prop>\n    </D:propfind>'}n.d(t,{P_:()=>s,ZP:()=>i,sp:()=>o})},23796:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(35391),s=n(45660),o=n(29526);function a(e){const t=(0,i.Z)(e),n=[];if(t.parsererror||t.d_error)return s.Z.error("Calendar",["caldav"],"CalendarPropfind parser error"),console.log("Error parsing calendarPropfind.",e),[];if(!t.d_multistatus)return[];try{t.d_multistatus.d_response.forEach((e=>{const{d_href:t,d_propstat:i}=e,{content:s}=t,{d_prop:a}=i,{d_displayname:r,cs_getctag:l,d_syncToken:d,d_supportedReportSet:c,c_calendarColor:u,d_resourcetype:p}=a,h=r?r.content:"";let g="";g=u||a["http://apple.com/ns/ical/:calendarColor"];const m=g?g[0].content:"#",f={vevent:!1,vjournal:!1,vtodo:!1};if(a.c_supportedCalendarComponentSet){const{c_comp:e}=a.c_supportedCalendarComponentSet;f.vevent=e.some((e=>"VEVENT"===e.attributes._name)),f.vtodo=e.some((e=>"VTODO"===e.attributes._name))}let v=!1;c&&c[0].d_supportedReport&&c[0].d_supportedReport.forEach((e=>{e.d_report.forEach((e=>{e.d_syncCollection&&(v=!0)}))}));const{c_calendar:y}=p,b=l?l.content:"",S=d?d.content:"",{vevent:w,vtodo:C}=f;if(!y||w||C||(f.vevent=!0),(f.vevent||f.vtodo)&&y){const e=(0,o.Z)(S),t={syncToken:e,supportsSyncCollection:!!e&&v,ctag:(0,o.Z)(b),description:h,name:(0,o.Z)(s),color:"#"===m?"":m,supportedCalendarComponent:f};n.push(t)}}))}catch(t){s.Z.error("Calendar",["caldav"],"CalendarPropfind parse error",t),console.log("Error reading calendarPropfind.",e)}return n}},8687:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>u});var i=n(2711),s=n(34929),o=n(56371),a=n(71237),r=n(45660),l=n(84749);const d={prefixes:{":":"","DAV:":"d","http://sabredav.org/ns":"sabre"}};const c={call:async function e(t,n,c){const{username:u,password:p,account_type:h,body:g,method:m,contentType:f,accessToken:v,headers:y={},href:b}=t;n||(n=t.url);const S=f?.includes("json")?"application/json, text/json":"application/xml, text/xml";try{const C={...y,Authorization:v?`Bearer ${v}`:(0,a.Z)(u,p),Accept:y.Accept||S,"Content-Type":f||"application/xml; charset=utf-8"},A=await fetch(n,{method:m,credentials:"omit",headers:C,body:g}),{status:I,ok:T}=A,Z=A.headers.get("content-type")||void 0,E={href:b,response:await A.text(),etag:(w=A.headers.get("etag")||"",w.split('"').join("")),status:I,ok:T};if(T)return E;{if(401===I&&v&&!c){const{accessToken:o}=await i.Z.fetchAccessTokenAndRefreshToken(u,s.Z.getOAuthServiceProvider(h));return t.accessToken=o,e(t,n,!0)}const a=function(e,t=""){if(t.includes("application/xml")||t.includes("text/xml")){const t=(0,l.Z)(e,d);if(t.parsererror)return r.Z.debug(e),"Error parsing error response.";if("d_error"===t.root){const e=t.d_error.sabre_message;if(Array.isArray(e))return e[0].content;if(t?.d_error?.d_validSyncToken)return"Invalid Sync Token"}}else if(t.includes("text/html")){const t=document.createElement("div");t.innerHTML=e;const n=(t.textContent||t.innerText)?.replace(/^\s+|\s+$/g,"").replace(/\s*\n[\s\n]*/g,"\n");return n||"Error parsing html error response."}return t.includes("text/plain")?e:""}(E.response,Z);return{etag:"",response:a?(0,o.Z)("Server response: $1",[a]):E.response,status:I,ok:!1}}}catch(e){return{etag:"",response:e.message,status:-1,ok:!1}}var w}};async function u(e,t){return c.call(e,t)}},88545:(e,t,n)=>{"use strict";n.d(t,{P:()=>I,k:()=>S});var i=n(2711),s=n(34929),o=n(87265),a=n(71636),r=n(15800),l=n(56371),d=n(71237),c=n(35391),u=n(64877),p=n(45660);var h=n(23796);var g=n(8687),m=n(7064),f=n(24522),v=n(25372);const{concatUrl:y}=o.Z,{isOAuthProvider:b}=r.ZP;async function S(e,t){const n={contextPath:"",currentUserPrincipalURL:"",calendarHomeSetURL:"",foundService:!1,calendars:[],statusMessage:""},{url:i,username:s}=e;if(i)n.contextPath=i;else{const e=s.indexOf("@");if(!(e>0))return n.statusMessage=(0,l.Z)("Please provide valid server address."),n;{const t=s.substring(e+1,s.length);n.contextPath=`https://${t}`}}const o=await A(e,t,"");if(o.userPrincipal){const{urlValid:i}=m.Z.utilities.isUrlValid(o.userPrincipal);n.currentUserPrincipalURL=i?o.userPrincipal:y(n.contextPath,o.userPrincipal);const s=await C(e,t,n.currentUserPrincipalURL);m.Z.utilities.isUrlValid(s).urlValid?n.calendarHomeSetURL=s:n.calendarHomeSetURL=y(n.contextPath,s);const a=await w(e,t,n.calendarHomeSetURL);return n.calendars=a,n.foundService=!0,n.contextPath=e.url,n}const a=await async function(e,t,n){let i="";const s=(0,v.Z)(e);s&&({host:i}=s);const o=(0,f.II)(i);try{const i=await fetch(o,{method:"GET",headers:{Authorization:(0,d.Z)(t,n)}}),{status:s,ok:a}=i;if(a){if(404===s)return{redirectedUrl:"",message:(0,l.Z)("Service not found.")};if(401===s||403===s)return{redirectedUrl:"",message:(0,l.Z)("Authentication error. Check your credentials and try again.")}}const r=(0,v.Z)(i.url),c=(0,v.Z)(e);return!(r?.href===c?.href)&&r?{redirectedUrl:r.href,message:""}:{redirectedUrl:"",message:""}}catch(e){return{redirectedUrl:"",message:(0,l.Z)("Network error.")}}}(n.contextPath,s,t);a.redirectedUrl&&(n.contextPath=a.redirectedUrl);const r=await A(e,t,n.contextPath);if(!r.authenticated)return n.statusMessage=r.message,n;const{userPrincipal:c}=r;if(c){n.currentUserPrincipalURL=c;const{urlValid:i}=m.Z.utilities.isUrlValid(c);i||(n.currentUserPrincipalURL=y(n.contextPath,c));const s=await C(e,t,n.currentUserPrincipalURL);m.Z.utilities.isUrlValid(s).urlValid?n.calendarHomeSetURL=s:n.calendarHomeSetURL=y(n.contextPath,s);const o=await w(e,t,n.calendarHomeSetURL);n.foundService=!0,n.calendars=o}return n}async function w(e,t,n){const i={...e,accessToken:"",password:t},s=await(0,g.ZP)((0,u.ZP)(i),n||e.url);return(0,h.Z)(s.response)}async function C(e,t,n){const i={username:e.username,password:t,url:n||e.url,accessToken:"",method:"PROPFIND",headers:{Brief:"t",Depth:"0"},body:(0,u.sp)()},{ok:s,response:o,status:a}=await(0,g.ZP)(i);if(!s)return p.Z.warn("Calendar","Error fetching homeset.",a),console.log("Calendar service discovery request error.",o),"";const{calendarHomeSet:r,errorMsg:l}=function(e){const t=(0,c.Z)(e),n={calendarHomeSet:"",errorMsg:""};if(t.d_error)return n.errorMsg="Error parsing calendar HomeSet",n;if(!t.parserror){if(!t.d_multistatus)return n.errorMsg="Unexpected HomeSet. MultiStatus not found.",n;try{t.d_multistatus.d_response.forEach((e=>{const{d_propstat:t,d_href:i}=e,{d_prop:s}=t,{c_calendarHomeSet:o}=s;if(!o)return n.calendarHomeSet=i.content,n;const a=o.d_href.content;n.calendarHomeSet=a}))}catch(e){n.errorMsg="Error reading HomeSet."}}return n}(o);return l&&(p.Z.warn("Calendar","Error parsing homeset.",l),console.log("CalDAV homeset parse error.",o)),r}async function A(e,t,n){const{username:i}=e,s={authenticated:!1,userPrincipal:"",message:"",isCalendarUrl:!1};try{const o=await fetch(function(e){return e+(e.endsWith("/")?"":"/")}(n||e.url),{method:"PROPFIND",credentials:"omit",headers:{Brief:"t",Depth:"0","Content-Type":"text/xml;charset=UTF-8",Authorization:(0,d.Z)(i,t)},body:(0,u.P_)()}),{status:a,ok:r}=o;if(r)a>=200&&a<=299&&(s.authenticated=!0);else{if(401===a)return s.message=(0,l.Z)("Authentication failed. Check your username and password."),s;if(403===a)return s.message=(0,l.Z)("Not authorized. Check your username and password or contact your server administrator for further assistance."),s;if(404===a)return s.message=(0,l.Z)("No CalDAV service found. Check your account info."),s;if(405===a)return s}const h=await o.text(),g=(0,c.Z)(h);if(g.d_error||!g.d_multistatus)return s.message=(0,l.Z)("Error parsing response data from server."),s;const m=function(e){let t="";const n=(0,c.Z)(e);if(n.parsererror)return p.Z.error("Calendar",["caldav","userprincipal"],"Parsing error"),console.log("parseMultistatusUserPrincipal error.",e),"";if("d_multistatus"!==n.root||!n.d_multistatus.d_response)return p.Z.error("Calendar",["caldav","userprincipal"],"Unexpected caldav"),console.log("Unexpected caldav received.",e),"";try{n.d_multistatus.d_response.forEach((e=>{if(e?.d_propstat?.d_prop?.d_currentUserPrincipal){const{d_href:n}=e.d_propstat.d_prop.d_currentUserPrincipal;t=n.content}else e?.d_href?.content&&(t=e.d_href.content)}))}catch(t){p.Z.error("Calendar",["caldav"],"MultiStatus parse error",t),console.log("Error reading multiStatus.",e)}return t}(h);m&&(s.userPrincipal=m)}catch(t){s.message=(0,l.Z)("CalDAV service not found at ‘$1’. Please check if the URL is correctly typed. Error message ‘$2’.",[n||e.url,t.message])}return s}async function I(e,t){const{account_type:n,username:o,url:r}=e,{urlValid:d}=m.Z.utilities.isUrlValid(r),c={calendars:[],eventCount:0,foundService:!1,statusMessage:""};if(!d)return{statusMessage:(0,l.Z)("Invalid URL"),...c};let p;try{p=b(n)?await s.Z.getAuthentication(e):{accessToken:"",id:"",name:"",url:r,username:o,password:t}}catch(e){return Promise.resolve(c)}try{const t=await(0,g.ZP)((0,u.ZP)(p),r);if(!t.ok){const n=a.Z.getStatusMessageAndLog(e,t);return{...c,statusMessage:n}}const n=(0,h.Z)(t.response);return{...c,foundService:!0,calendars:n}}catch(e){return e.status&&i.Z.fetchAccessTokenAndRefreshToken(p.username,s.Z.getOAuthServiceProvider(n)),{...c,statusMessage:e.statusText}}}},9141:(e,t,n)=>{"use strict";n.d(t,{$E:()=>m,Wy:()=>u,YQ:()=>p});var i=n(2934),s=n(50522),o=n(98035),a=n(45660),r=n(28773),l=n(7064),d=n(34006);async function c(e,t,n){function a(e,t){for(const i of n.values())if(i.parent_event_id===e&&i.date===t)return i}t.recurrenceExceptions&&i.ZP.trimExceptions(e,t);let r=0;e.start&&t.start?r=e.start-t.start:e.end&&t.end&&(r=e.end-t.end);for(const n of e.recurrenceExceptions??[]){const{date:d,cancelled:c}=n;if(!d)break;const u=a(t.id,d-r);if(c)u?(!r&&u.cancelled||l.Z.calendar.updateRecurrenceException(u.exception_id??"",{date:u.date+r,cancelled:c}),u.exception_event_id&&i.ZP.deleteEvent(u.exception_event_id)):o.Z.createException(t.id,c,d);else{const n=u?.exception_event_id&&s.Z.getEvent(u.exception_event_id),a=e.exceptionEvents?.find((e=>e.recurrenceId===d));if(n&&a){const{recurrenceId:t,recurrenceExceptions:i,invites:s,notifications:r,...l}=a;l.calendarId=e.calendarId,await o.Z.updateEventFromServer(n.id,l)}if(u)await l.Z.calendar.updateRecurrenceException(u.exception_id??"",{date:u.date+r});else{if(!a)return void o.Z.createException(t.id,!0,d);const{start:n,end:s,title:r,description:l}=a,{rrule:c,exceptionEvents:u,attachment:p,invites:h,notifications:g,recurrenceExceptions:m,...f}=e;if(!n||!s)return;f.start=n,f.end=s,f.title=r,f.description=l;const v=await i.ZP.createEvent({...f,is_template:!1},!1);o.Z.createException(t.id,!1,d,v.id),o.Z.updateEvent({id:t.id,sequence:e.sequence,etag:e.etag})}}}}async function u(e,t){return h(e,t,(function(e,t){return e.uid===t.uid&&e.etag!==t.etag}))}async function p(e,t){return h(e,t,(function(e,t){return e.uid===t.uid&&function(e,t){if(!g(e,t))return!0;const n=t.recurrenceExceptions||[],i=new Map(e.recurrenceExceptions?.map((e=>[e.date,e])));if(n.length!==i.size)return!0;return n.some((e=>{const n=i.get(e.date);if(!n||n.cancelled!==e.cancelled)return!0;if(e.cancelled||!n.exception_event_id)return!1;const o=s.Z.getEvent(n.exception_event_id),{recurrenceId:a,...r}=t.exceptionEvents?.find((t=>t.recurrenceId===e.date))||{};if(!o||!r)throw new Error("Unexpected missing exception event!");return!g(o,r)}))}(e,t)}))}async function h(e,t,n){if(!t.length)return[];const s=new Map(e.flatMap((e=>(e.recurrenceExceptions??[]).filter((e=>"string"==typeof e.exception_event_id)).map((e=>[String(e.exception_event_id),e]))))),o=[];for(const a of e){if(s.has(a.id))continue;const e=t.find((e=>n(a,e)));e&&!e.recurrenceExceptions?.length&&a.recurrenceExceptions?.length?i.ZP.deleteExceptions(a):e?.recurrenceExceptions?.length&&c(e,a,s),e&&o.push((0,d.KU)(e,a))}let r=[];try{const e=o.map((e=>{const t=e.rrule?"all":"single";return i.ZP.updateEvent(e,t)}));r=await Promise.all(e)}catch(e){a.Z.error("Calendar",["caldav"],"Error updating event",e)}return r}function g(e,t){return!!t&&((t.etag??"")===(e.etag??"")&&(t.sequence??0)===(e.sequence??0)&&t.title===e.title&&(t.description??"")===(e.description??"")&&(t.start??0)===e.start&&(t.end??t.start??0)===e.end&&!!t.complete==!!e.complete&&!!t.allDay==!!e.allDay&&(t.rrule??"")===(e.rrule??"")&&(t.organizer??"")===(e.organizer??"")&&(t.location??"")===(e.location??"")&&(t.url??"")===(e.url??""))}async function m(e){const{exceptionEvents:t,...n}=e,s=[];for(const e of t||[]){const{recurrenceId:t,recurrenceExceptions:n,...i}=e,a=await o.Z.createEvent(i),{id:r}=a;s.push({date:t,cancelled:!1,exception_event_id:r})}const a={...n,...(0,r.Z)(s.length>0?{recurrenceExceptions:s}:null)};await i.ZP.createEvent(a,!1)}},68172:(e,t,n)=>{"use strict";n.d(t,{$u:()=>u,VK:()=>h,Z1:()=>g,e$:()=>m,tE:()=>c,tL:()=>p});var i=n(15800),s=n(80008),o=n.n(s),a=n(15805),r=n(41851),l=n(24522),d=n(58821);async function c(e,t){const n=await r.Z.loadTemplate(e);return n?u(n,t):(console.error("Template not found.",n),t)}function u(e,t){const n={...t};if(void 0!==e.start&&(n.start=e.start+o()(n.start).startOf("day").valueOf()),void 0!==e.end&&(n.end=e.end+o()(n.end).startOf("day").valueOf(),n.end<n.start&&(n.end+=l.hd)),void 0!==e.duration){const{duration:t}=e;n.start?n.end=n.start+t:n.end?n.start=n.end-t:(n.start=(0,d.zX)(Date.now()),n.end=n.start+t)}return void 0!==e.calendarId&&(n.calendarId=e.calendarId),void 0!==e.title&&(n.title=e.title),void 0!==e.description&&(n.description=e.description),void 0!==e.location&&(n.location=e.location),void 0!==e.url&&(n.url=e.url),void 0!==e.rrule&&(n.rrule=e.rrule),void 0!==e.timezone&&(n.timezone=e.timezone),void 0!==e.allDay&&(n.allDay=e.allDay),void 0!==e.organizer&&(n.organizer=e.organizer),Array.isArray(e.invites)&&(n.invites=e.invites.map((e=>({...e,event_id:n.id})))),Array.isArray(e.notifications)&&(n.notifications=e.notifications.map((e=>({...e,event_id:n.id})))),n}function p(e,t){const n={name:""};if(t.time||t.duration){const{start:i,end:s}=(0,d.aE)(e);t.time&&(n.start=i.hours()*l.QI+i.minutes()*l.lb,n.end=s.hours()*l.QI+s.minutes()*l.lb),t.duration&&(n.duration=s.diff(i))}return t.calendar&&(n.calendarId=e.calendarId),t.title&&(n.title=e.title),t.description&&(n.description=e.description),t.allDay&&(n.allDay=e.allDay),t.timezone&&(n.timezone=e.timezone),t.task&&(n.task=e.task),t.location&&(n.location=e.location),t.url&&(n.url=e.url),t.recurrence&&(n.rrule=e.rrule),t.reminders&&(n.notifications=e.notifications||[]),t.participants&&(n.organizer=e.organizer,n.invites=e.invites||[]),n}function h(e){const t=[];return void 0!==e.start&&t.push(`DTSTART:${o().tz(e.start,"utc").format(l.A)}`),void 0!==e.end&&t.push(`DTEND:${o().tz(e.end,"utc").format(l.A)}`),void 0!==e.duration&&t.push(`DURATION:${o().duration(e.duration).toISOString()}`),void 0!==e.calendarId&&t.push(`X-VIV-CALID:${e.calendarId}`),void 0!==e.title&&t.push(`SUMMARY:${e.title}`),void 0!==e.description&&t.push(`DESCRIPTION:${e.description}`),void 0!==e.location&&t.push(`LOCATION:${e.location}`),void 0!==e.url&&t.push(`URL:${e.url}`),void 0!==e.rrule&&t.push(`RRULE:${e.rrule}`),void 0!==e.timezone&&t.push(`X-VIV-TZ:${e.timezone}`),void 0!==e.allDay&&t.push("X-VIV-ALLDAY:"+(e.allDay?"TRUE":"FALSE")),void 0!==e.organizer&&t.push(`ORGANIZER:mailto:${e.organizer}`),e.invites&&(0===e.invites.length&&t.push("X-VIV-NO-ATTENDEE:TRUE"),e.invites?.forEach((e=>{const n=e.name?`;CN=${e.name}`:"";t.push(`ATTENDEE${n}:mailto:${e.address}`)}))),e.notifications&&(0===e.notifications.length&&t.push("X-VIV-NO-REMINDER:TRUE"),e.notifications?.forEach((e=>{t.push(i.ZP.notificationToVAlarm(e))}))),`BEGIN:VCALENDAR\nBEGIN:${e.task?"VTODO":"VEVENT"}\n${t.join("\n")}\nEND:${e.task?"VTODO":"VEVENT"}\nEND:VCALENDAR\n`}function g(e,t){const n={name:e},i=(0,a.Z)(t),s=[...i.VEVENT||[],...i.VTODO||[]];if(!t||1!==s.length)throw new Error("Invalid template data");i.VTODO&&i.VTODO.length&&(n.task=!0);const r=s[0];if(void 0!==r.DTSTART&&(n.start=o().tz(r.DTSTART.value,"utc").valueOf()),void 0!==r.DTEND&&(n.end=o().tz(r.DTEND.value,"utc").valueOf()),void 0!==r.DURATION&&(n.duration=o().duration(r.DURATION).asMilliseconds()),void 0!==r.SUMMARY&&(n.title=r.SUMMARY),void 0!==r.DESCRIPTION&&(n.description=r.DESCRIPTION),void 0!==r.LOCATION&&(n.location=r.LOCATION),void 0!==r.URL&&(n.url=r.URL.value),void 0!==r.RRULE&&(n.rrule=r.RRULE),void 0!==r["X-VIV-CALID"]&&(n.calendarId=r["X-VIV-CALID"]),void 0!==r["X-VIV-ALLDAY"]&&(n.allDay="TRUE"===r["X-VIV-ALLDAY"]),void 0!==r["X-VIV-TZ"]&&(n.timezone=r["X-VIV-TZ"]),void 0!==r.ORGANIZER&&(n.organizer=r.ORGANIZER.value),void 0!==r["X-VIV-NO-ATTENDEE"]&&(n.invites=[]),Array.isArray(r.ATTENDEE)){const e=[];r.ATTENDEE.map((t=>{e.push({event_id:"",id:"",address:t.value,name:t?.params.CN})})),n.invites=e}if(void 0!==r["X-VIV-NO-REMINDER"]&&(n.notifications=[]),Array.isArray(r.VALARM)){const e=[];r.VALARM.map((t=>{t.TRIGGER&&e.push({name:"",id:"",when:-o().duration(t.TRIGGER).asMilliseconds()})})),n.notifications=e}return n}function m(e){return{title:void 0!==e.title,description:void 0!==e.description,time:void 0!==e.start,duration:void 0!==e.duration,allDay:void 0!==e.allDay,timezone:void 0!==e.timezone,task:void 0!==e.task,location:void 0!==e.location,recurrence:void 0!==e.rrule,url:void 0!==e.url,reminders:void 0!==e.notifications,participants:void 0!==e.invites,calendar:void 0!==e.calendarId}}},6142:(e,t,n)=>{"use strict";n.d(t,{Z:()=>T,p:()=>w});var i=n(67294),s=n(22529),o=n(33349),a=n(98102),r=n(94283),l=n(56371),d=n(49550),c=n(80008),u=n.n(c),p=n(82191),h=n(47543),g=n(58821);function m(e){return{[p.Ci.DAILY]:"days",[p.Ci.WEEKLY]:"weeks",[p.Ci.MONTHLY]:"months",[p.Ci.YEARLY]:"years"}[e]||"none"}var f,v=n(86088),y=n(48521);function b(e,t,n,i){f||(f="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:f,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const S=new Map([["none",{name:(0,l.Z)("No repeat"),frequency:void 0}],["days",{name:(0,l.Z)("Daily"),frequency:p.Ci.DAILY}],["weeks",{name:(0,l.Z)("Weekly"),frequency:p.Ci.WEEKLY}],["months_dom",{name:(0,l.Z)("Monthly by date"),frequency:p.Ci.MONTHLY}],["months_dow",{name:(0,l.Z)("Monthly by week"),frequency:p.Ci.MONTHLY}],["years",{name:(0,l.Z)("Yearly"),frequency:p.Ci.YEARLY}]]),w=e=>{if(!e)return(0,l.Z)("No repeat");const{count:t,dtstart:n,until:i,interval:s=1}=e.origOptions,o=u()(n).format("LL");let a="",r="";if(s<=2)switch(e.origOptions.freq){case p.Ci.DAILY:a=(0,l.Z)("Repeats daily","Repeats every other day",[s]);break;case p.Ci.WEEKLY:a=(0,l.Z)("Repeats weekly","Repeats every other week",[s]);break;case p.Ci.MONTHLY:a=(0,l.Z)("Repeats monthly","Repeats every other month",[s]);break;case p.Ci.YEARLY:a=(0,l.Z)("Repeats yearly","Repeats every other year",[s])}else switch(e.origOptions.freq){case p.Ci.DAILY:a=(0,l.Z)("Repeats every $1 days","Repeats every $1 days",[s]);break;case p.Ci.WEEKLY:a=(0,l.Z)("Repeats every $1 weeks","Repeats every $1 weeks",[s]);break;case p.Ci.MONTHLY:a=(0,l.Z)("Repeats every $1 months","Repeats every $1 months",[s]);break;case p.Ci.YEARLY:a=(0,l.Z)("Repeats every $1 years","Repeats every $1 years",[s])}if(t&&t>0)r=(0,l.Z)("$1 time beginning $2","$1 times beginning $2",[t,o]);else if(i){const e=u()(i).format("LL");r=(0,l.Z)("from $1 to $2",[o,e])}else r=(0,l.Z)("beginning $1",[o]);return(0,l.Z)("$1, $2",[a,r])};var C=b("hr",{}),A=b("hr",{});class I extends i.Component{static contextType=r.Z;constructor(e){super(e);const t=u()().startOf("week");this.week=[...Array(7).keys()].map((()=>{const e={name:t.format("dddd"),shortName:t.format("dd"),number:(t.day()+6)%7};return t.add(1,"day"),e}));const n=e.event.rrule?.match(/BYMONTHDAY=([-\d,]+)/)?.[1].split(",");n&&(this.monthDates=n.join(", ")),this.state={showMonthPicker:!1}}domPickerRef=i.createRef();storedFocusElement=null;isTypingDate=!1;changeField=e=>{const t=this.recurrence;if(!t)return;let n=e.currentTarget.value;const i=e.currentTarget.name;"number"===e.currentTarget.type&&(n=parseInt(n),(isNaN(n)||n<1)&&(n=0),"count"===i&&n&&(n+=1)),this.recurrence=(0,h.yu)(t,{[i]:n}),this.props.updateEvent({...this.props.event,rrule:this.recurrence.toString()})};verifyValidValue=e=>{const{recurrence:t}=this;if(!t)return;const n=e.currentTarget.name;if("number"===e.currentTarget.type){let i=parseInt(e.currentTarget.value);(isNaN(i)||i<1)&&(i=1,"count"===n&&(i+=1),this.recurrence=(0,h.yu)(t,{[n]:i}),this.props.updateEvent({...this.props.event,rrule:this.recurrence.toString()}))}};changeRecurrence=e=>{this.props.updateEvent(function(e,t){const n=new Date((0,g.oJ)(t));let i;switch(e){case"days":i=(0,h.Ns)({dtstart:n,freq:p.Ci.DAILY,interval:1});break;case"weeks":i=(0,h.Ns)({dtstart:n,freq:p.Ci.WEEKLY,interval:1,byweekday:(n.getDay()+6)%7});break;case"months_dom":i=(0,h.Ns)({dtstart:n,freq:p.Ci.MONTHLY,interval:1,bymonthday:n.getDate()});break;case"months_dow":const e=Math.ceil(n.getDate()/7),t=(0,h._7)(n.getDay()).nth(e);i=(0,h.Ns)({dtstart:n,freq:p.Ci.MONTHLY,interval:1,byweekday:t});break;case"years":i=(0,h.Ns)({dtstart:n,freq:p.Ci.YEARLY,interval:1});break;default:i=""}return{...t,rrule:i}}(e.currentTarget.value,this.props.event))};changeDate=e=>{this.props.updateEvent(function(e,t){const{rrule:n,start:i,timezone:s}=t,o=(0,h.Qj)(n,s,i);if(!o)return t;const a=(0,h.yu)(o,{until:u()(e).endOf("day").toDate(),count:void 0});return{...t,rrule:a?.toString()}}(e.currentTarget.value,this.props.event))};changeEnds=e=>{this.props.updateEvent(function(e,t){const{rrule:n,start:i,timezone:s}=t,o=(0,h.Qj)(n,s,i);if(!o)return t;let a;switch(e){case"forever":a=(0,h.yu)(o,{until:void 0,count:void 0});break;case"endDate":const e=m(o.origOptions.freq);a=(0,h.yu)(o,{count:void 0,until:u()((0,g.oJ)(t)).add(1,e).toDate()});break;case"count":a=(0,h.yu)(o,{count:2,until:void 0})}return{...t,rrule:a?.toString()}}(e.target.value,this.props.event))};changeDayOfMonth=e=>{const{recurrence:t}=this;if(!t)return;this.monthDates=e.currentTarget.value;const n=this.monthDates.split(",").map((e=>parseInt(e))).filter((e=>e>=1&&e<=31));n.length&&(this.recurrence=(0,h.yu)(t,{bymonthday:n}),this.props.updateEvent({...this.props.event,rrule:this.recurrence.toString()}))};toggleDayOfMonthPicker=()=>{const{document:e}=this.context;this.setState((e=>({showMonthPicker:!e.showMonthPicker})),(()=>{if(this.state.showMonthPicker){this.storedFocusElement=e.activeElement;const t=e.querySelector("button[name='1-dayOfMonth']");t&&t.focus()}}))};hideDayOfMonthPicker=()=>{this.setState({showMonthPicker:!1},(()=>{this.storedFocusElement&&(this.storedFocusElement.focus(),this.storedFocusElement=null)}))};dayOfWeekPickerClick=e=>{e.target.focus();const{recurrence:t}=this;if(!t)return;const n=parseInt(e.target.name);if(isNaN(n))throw new Error("Can not select day, invalid day value");const i=new Set((0,h.IK)(t));i.has(n)&&i.size>1?i.delete(n):i.add(n),this.recurrence=(0,h.yu)(t,{byweekday:Array.from(i)}),this.props.updateEvent({...this.props.event,rrule:this.recurrence.toString()})};dayOfMonthPickerClick=e=>{e.target.focus();const t=parseInt(e.target.name);this.selectDayOfMonth(t)};selectDayOfMonth=e=>{const{recurrence:t}=this;if(!t)return;const n=new Set((0,h.v1)(t));n.has(e)&&n.size>1?n.delete(e):n.add(e);const i=Array.from(n).sort(((e,t)=>e-t));this.monthDates=i.join(", ")??"",this.recurrence=(0,h.yu)(t,{bymonthday:i}),this.props.updateEvent({...this.props.event,rrule:this.recurrence.toString()})};monthPickerBlur=e=>{const t=this.domPickerRef.current;t&&e.relatedTarget instanceof Node&&!t.contains(e.relatedTarget)&&this.setState({showMonthPicker:!1})};dayOfWeekPickerKeyDown=e=>{const{document:t}=this.context,n=t.activeElement;if(!n||!n.hasAttribute("name"))return;const i=u()().localeData().firstDayOfWeek(),s=(parseInt(n.name)-i+7)%7;let o=null;switch(d.Z[e.keyCode]){case"Left":s>0&&(o=s-1);break;case"Right":s<6&&(o=s+1);break;default:return}if(null!==o){o=(o+i)%7;const e=t.querySelector(`button[name='${o}-dayOfWeek']`);e&&(e.tabIndex=0,e.focus(),n.tabIndex=-1)}};dayOfMonthPickerKeyDown=e=>{if(!this.state.showMonthPicker&&"Down"===d.Z[e.keyCode])return void this.toggleDayOfMonthPicker();const{document:t}=this.context,n=t.activeElement;if(!n||!n.hasAttribute("name"))return;const i=parseInt(n.name);let s;switch(d.Z[e.keyCode]){case"Up":i>7&&(s=i-7);break;case"Down":i<25&&(s=i+7);break;case"Left":i%7!=1&&(s=i-1);break;case"Right":i%7!=0&&(s=i+1);break;case"Enter":return this.selectDayOfMonth(i),void e.stopPropagation();case"Escape":return e.stopPropagation(),void this.hideDayOfMonthPicker();default:return}if(s){const e=t.querySelector(`button[name='${s}-dayOfMonth']`);e&&e.focus()}};weekOfMonthChange=e=>{const{recurrence:t}=this;if(!t)return;const n=e.currentTarget.value,[i,s]=e.currentTarget.name.split("-");this.recurrence=function(e,t,n,i){const s=/^-?\d+$/.test(i)?parseInt(i):i,o=(0,h.QX)(e),a=o[n],{bysetpos:r}=e.origOptions;return"weekNumber"===t&&"number"==typeof s?r?(0,h.yu)(e,{bysetpos:s}):(o[n]=a.nth(s),(0,h.yu)(e,{byweekday:o})):"weekday"===t?"number"==typeof s?(r?(o.length=0,o.push(h.ng[s].nth(Array.isArray(r)?r[0]:r))):(o[n]=h.ng[s],void 0!==a.n&&(o[n]=o[n].nth(a.n))),(0,h.yu)(e,{byweekday:o,bysetpos:void 0})):(0,h.yu)(e,{bysetpos:a.n??1,byweekday:"day"===s?[...h.ng]:[...h.z3]}):new p.Ci(e.origOptions)}(t,s,parseInt(i),n),this.props.updateEvent({...this.props.event,rrule:this.recurrence.toString()})};addWeekOfMonth=()=>{const{event:e}=this.props,{recurrence:t}=this;t&&(this.recurrence=function(e,t){const{bysetpos:n}=t.origOptions;if(n&&(0,h.IK)(t).length>1)return new p.Ci(t.origOptions);const i=(0,h.QX)(t);n&&i.length>0&&(i[0]=i[0].nth(Array.isArray(n)?n[0]:n));const s=u()(e.start),o=Math.ceil(s.date()/7),a=(0,h._7)(s.day()).nth(o);return i.push(a),(0,h.yu)(t,{byweekday:i,bysetpos:void 0})}(e,t),this.props.updateEvent({...e,rrule:this.recurrence.toString()}))};deleteWeekOfMonth=e=>{const t=parseInt(e.currentTarget.name),{recurrence:n}=this;if(!n)return;const i=(0,h.QX)(n).splice(t,1);this.recurrence=(0,h.yu)(n,{byweekday:i}),this.props.updateEvent({...this.props.event,rrule:this.recurrence.toString()})};renderWeekSelection(){const{recurrence:e}=this;if(!e)return null;const t=(0,h.IK)(e);return b("div",{className:"edit-group capped-width"},void 0,b("div",{className:"toolbar toolbar-default calendar-week-picker"},void 0,b("div",{className:"toolbar toolbar-group"},void 0,this.week.map(((e,n)=>{const s=t.includes(e.number),o=`${e.number}-dayOfWeek`;return b(i.Fragment,{},o,b(a.ZP,{name:o,onClick:this.dayOfWeekPickerClick,onKeyDown:this.dayOfWeekPickerKeyDown,title:e.shortName.substr(0,1),tooltip:e.name,tabIndex:s?this.props.tabIndex:-1,isPressed:s}),n<this.week.length-1&&C)})))))}renderDayOfMonthSelection(){const{event:e}=this.props;if(!this.recurrence)return null;const t=(0,h.v1)(this.recurrence);return b("div",{className:"edit-group capped-width"},void 0,b("label",{},void 0,b("span",{},void 0,(0,l.Z)("On days")),b("input",{type:"text",id:"day_of_month",value:this.monthDates||u().tz(e.start,e.timezone).date(),onChange:this.changeDayOfMonth}),b(a.ZP,{className:"button-narrow",image:v.bcq.small,popupPosition:"below",isPopupVisible:this.state.showMonthPicker,popupWidth:240,onClick:this.toggleDayOfMonthPicker,onKeyDown:this.dayOfMonthPickerKeyDown,tabIndex:this.props.tabIndex,tooltip:(0,l.Z)("Show date picker"),hidePopup:this.hideDayOfMonthPicker,popupClassName:"ToolbarButtonPopup-DefaultStyles"},void 0,(0,y.jsx)("div",{className:"dom-picker",ref:this.domPickerRef,onBlur:this.monthPickerBlur,children:b("div",{className:"toolbar toolbar-default"},void 0,[...Array(31).keys()].map((e=>{const n=e+1;return b(a.ZP,{isPressed:t.includes(n),name:`${n}-dayOfMonth`,onKeyDown:this.dayOfMonthPickerKeyDown,onClick:this.dayOfMonthPickerClick,tabIndex:this.state.showMonthPicker?this.props.tabIndex:-1,title:n.toString(),tooltip:(0,l.Z)("Repeat monthly on day $1",[n])},n)})))}))))}renderWeekOfMonthSelection(){const e=this.recurrence;if(!e)return null;const t=(0,h.QX)(e),{bysetpos:n}=e.origOptions,i=n&&t.length>1,s=7===t.length;return(i?[{number:n,day:s?"day":"weekday"}]:t.map((e=>({number:e.n,day:e.weekday})))).map(((e,n)=>b("div",{className:"edit-group"},n,b("label",{},void 0,b(o.Z,{name:`${n}-weekNumber`,onChange:this.weekOfMonthChange,tabIndex:this.props.tabIndex,value:e.number},void 0,b("option",{value:"1"},void 0,(0,l.Z)("First")),b("option",{value:"2"},void 0,(0,l.Z)("ordering","Second")),b("option",{value:"3"},void 0,(0,l.Z)("Third")),b("option",{value:"4"},void 0,(0,l.Z)("Fourth")),b("option",{value:"5"},void 0,(0,l.Z)("Fifth")),b("option",{value:"-1"},void 0,(0,l.Z)("Last")),b("option",{value:"-2"},void 0,(0,l.Z)("Second last"))),b(o.Z,{name:`${n}-weekday`,onChange:this.weekOfMonthChange,tabIndex:this.props.tabIndex,value:e.day},void 0,this.week.map((e=>b("option",{value:e.number},e.number,e.name))),A,b("option",{value:"day"},void 0,(0,l.Z)("Day")),b("option",{value:"weekday"},void 0,(0,l.Z)("Weekday"))),!i&&t.length>1&&b("input",{type:"button",className:"circular",name:`${n}`,onClick:this.deleteWeekOfMonth,onKeyDown:this.dayOfMonthPickerKeyDown,tabIndex:this.props.tabIndex,title:(0,l.Z)("Remove rule"),value:"–"}),!i&&t.length>=1&&b("input",{type:"button",className:"circular",onClick:this.addWeekOfMonth,onKeyDown:this.dayOfMonthPickerKeyDown,tabIndex:this.props.tabIndex,title:(0,l.Z)("Add rule"),value:"+"})))))}render(){const{event:e}=this.props,{rrule:t,start:n,timezone:i}=e;this.recurrence=(0,h.Qj)(t,i,n);const a=this.recurrence||{origOptions:{}},{freq:r,interval:d,count:c,until:f}=a.origOptions,v=r===p.Ci.MONTHLY?a.origOptions.byweekday?"months_dow":"months_dom":m(r??-1),w=void 0!==c?"count":f?"endDate":"forever",C=c&&"number"==typeof c?c-1:"";let A="";switch(r){case p.Ci.DAILY:A=(0,l.Z)("day","days",[d??""]);break;case p.Ci.WEEKLY:A=(0,l.Z)("week","weeks",[d??""]);break;case p.Ci.MONTHLY:A=(0,l.Z)("month","months",[d??""]);break;case p.Ci.YEARLY:A=(0,l.Z)("year","years",[d??""])}return(0,y.jsxs)(y.Fragment,{children:[b("div",{className:"edit-group capped-width"},void 0,(0,y.jsx)(o.Z,{name:"frequency",ref:this.props.focusRef,onChange:this.changeRecurrence,tabIndex:this.props.tabIndex,value:v,children:Array.from(S).map((([e,t])=>b("option",{value:e},e,t.name)))})),"weeks"===v&&this.renderWeekSelection(),"months_dom"===v&&this.renderDayOfMonthSelection(),"months_dow"===v&&this.renderWeekOfMonthSelection(),"none"!==v&&b("div",{className:"edit-group capped-width"},void 0,b("label",{},void 0,b("span",{},void 0,(0,l.Z)("every","every",[d??""])),b("input",{type:"number",name:"interval",min:"1",disabled:!v,onChange:this.changeField,onBlur:this.verifyValidValue,tabIndex:this.props.tabIndex,value:d||""}),b("span",{},void 0,A))),"none"!==v&&b("div",{className:"edit-group"},void 0,(0,y.jsxs)(o.Z,{name:"endsRepeating",ref:this.props.focusRef,onChange:this.changeEnds,tabIndex:this.props.tabIndex,value:w,children:[b("option",{value:"forever"},void 0,(0,l.Z)("Forever")),b("option",{value:"endDate"},void 0,(0,l.Z)("Ending")),b("option",{value:"count"},void 0,(0,l.Z)("Repeating"))]}),(0,y.jsxs)(y.Fragment,{children:["endDate"===w&&f&&b(s.Z,{name:"endDate",onChange:this.changeDate,min:u()(e.start).format("YYYY-MM-DD"),tabIndex:this.props.tabIndex,value:u()((0,g.FL)(f)).format("YYYY-MM-DD")}),"count"===w&&b("label",{},void 0,b("input",{size:"3",type:"number",name:"count",onChange:this.changeField,onBlur:this.verifyValidValue,min:"1",tabIndex:this.props.tabIndex,value:C}),b("span",{},void 0,(0,l.Z)("time","times",[C])))]}))]})}}const T=I},79706:(e,t,n)=>{"use strict";n.d(t,{Z:()=>A});var i=n(2934),s=n(34929),o=n(50522),a=n(15800),r=n(56371),l=n(71237),d=n(45660),c=n(11430),u=n(7064),p=n(24522),h=n(34006);function g(e,t){return e.filter((e=>e.UID&&!t.has(e.UID)))}function m(e,t){const n=new Set;t.forEach((e=>{e.recurrenceExceptions&&e.recurrenceExceptions.forEach((e=>{n.add(e.exception_event_id)}))}));const i=new Set(e.map((e=>e.UID)));return t.filter((e=>{const t=i.has(e.uid),s=n.has(e.id);return!(t||s&&!e.uid)}))}function f(e,t){return e.filter((e=>e.UID&&t.has(e.UID)))}var v=n(89555),y=n(9141);let b=null;async function S(e,t,n){return await fetch(e,{Authorization:t&&n?(0,l.Z)(t,n):void 0,Accept:"text/calendar"})}function w(e,t,n){let i="";return"ParserError"===e.name?(i=(0,r.Z)("Error parsing calendar data from ‘$1’. Error message ‘$2’.",[t,e.message]),console.log("iCalendar Parser Error",n)):i=(0,r.Z)("No Web Calendar found at ‘$1’. Error message ‘$2’.",[t,e.message]),d.Z.warn("Calendar",["webcal"],i),i}const C={probeWebCalendar:async(e,t)=>{const{url:n,username:i}=e;let s=0;const o={calendars:[],eventCount:0,foundService:!1,statusMessage:""},{urlValid:l}=u.Z.utilities.isUrlValid(n);if(!l)return{...o,statusMessage:(0,r.Z)("Invalid URL $1",[n])};try{const l=await S(n,i,t),{status:d,statusText:u}=l;if(d>=200&&d<300){const t=await l.text();if(!t)return{...o,statusMessage:(0,r.Z)("Empty response from server. No calendar data.")};let i;try{i=await c.Z.parseICalendar(t)}catch(e){const i=w(e,n,t);return{...o,statusMessage:i}}b={url:n,timestamp:Date.now(),calendarData:i};const d={name:e.name,description:(i["X-WR-CALNAME"]||"").trim(),color:a.ZP.getCalendarCreateColor(),ctag:"",supportedCalendarComponent:{vevent:!0,vtodo:!1,vjournal:!1},supportsSyncCollection:!1,syncToken:"",active:!0};return s=i.VEVENT.length,{...o,foundService:!0,calendars:[d],eventCount:s,statusMessage:(0,r.Z)("Success")}}if(401===d||403===d)return{...o,statusMessage:(0,r.Z)("Not authorized, check your username and password. ‘$1’",[u])};if(404===d)return{...o,statusMessage:(0,r.Z)("Calendar not found, check your URL. ‘$1’",[u])};if(d>=500)return{...o,statusMessage:(0,r.Z)("Server error, try again later. ‘$1’.",[u])};throw new Error(u)}catch(e){return{...o,statusMessage:(0,r.Z)("Network error, check your URL. ‘$1’.",[e.message])}}},fetchAndCreate:async(e,t)=>{const{url:n}=e;if(!n)throw"Url missing";const a={numberOfCalendarsPolled:1,numberOfChangedCalendars:0};let r;const l=b?.calendarData;if(l&&b&&b.url===n&&b.timestamp+5*p.lb>Date.now())r=l;else{let t="",i="";try{const n=await s.Z.getAuthentication(e);t=n.username,i=n.password}catch(e){}const o=await S(n,t,i);if(200!==o.status)throw o;const l=await o.text();try{r=await c.Z.parseICalendar(l)}catch(e){return w(e,n,l),a}}b=null,t||(t=(r["X-WR-CALNAME"]||e.name).trim());try{i.ZP.stopAPIChangeListeners();const n=await C.getCalendar(e,t),{id:s}=n,l=r.VEVENT,d=o.Z.getEventsPerCalendar(s),{create:c,deleteEvents:u,update:p}=function(e,t){const n=new Set(t.map((e=>e.uid)).filter(Boolean));return{create:g(e,n),deleteEvents:m(e,t),update:f(e,n)}}(l,d);(c.length||u.length)&&(a.numberOfChangedCalendars=1);for(const e of u)i.ZP.deleteEvent(e.id);const y=e=>(0,h.rP)(e,n.id);await(0,h.nj)(c.map(y),v.Z);await C.updateEvents(p,n.id)&&(a.numberOfChangedCalendars=1)}finally{i.ZP.startAPIChangeListeners()}return a},getCalendar:(e,t)=>new Promise(((n,s)=>{const r=o.Z.getCalendars().filter((t=>t.accountId===e.id)),l=r.find((t=>t.accountId===e.id));if(l)n(l);else{const s={name:t,description:t,accountId:e.id,active:!0,color:a.ZP.getCalendarCreateColor(),supportedCalendarComponent:{vevent:!0,vtodo:!0,vjournal:!1}};i.ZP.createCalendar(s,e,!1,!0).then((e=>{e.calendar&&n(e.calendar)}))}})),updateEvents:async(e,t)=>{const n=e.map((e=>(0,h.rP)(e,t))),i=o.Z.getEventsPerCalendar(t);return(await(0,y.YQ)(i,n)).length}},A=C},74400:(e,t,n)=>{"use strict";n.d(t,{ES:()=>s,RO:()=>i,Vl:()=>o});const i=e=>e.replace(/\\\\|\\;|\\,|\\[Nn]/g,(e=>{switch(e){case"\\\\":return"\\";case"\\;":return";";case"\\,":return",";case"\\n":case"\\N":return"\n";default:return e}})),s=e=>e.replace(/\\|;|,|\r\n|\n/g,(e=>{switch(e){case"\\":return"\\\\";case";":return"\\;";case",":return"\\,";case"\r\n":case"RN":case"\n":case"N":return"\\n";default:return e}}));function o(e,t,n){let i=!1;if(n&&n<2)return[e];n=n||1/0;const s=[0];for(let o=0;o<e.length;o++){const a=e[o];if('"'===a)0!==o&&"\\"===e[o-1]||(i=!i);else if(a===t&&!i&&(s.push(o+1),s.length>=n))break}return 1===s.length?[e]:s.map(((t,n)=>{const i=s[n+1];return e.slice(t,i?i-1:i)}))}},15805:(e,t,n)=>{"use strict";n.d(t,{Z:()=>d,z:()=>o});var i=n(24522),s=n(74400);class o extends Error{constructor(e){super(e),this.name="ParserError"}}function a(e){try{if(e.startsWith('"')&&e.endsWith('"'))return e.slice(1,-1)}catch(t){throw new o(`Calendar: Error parsing "${e}" in stripQuotes`)}return e}const r=(e,t)=>{const n={},d=[];for(t.line&&(d.push(t.line),delete t.line);e.length>1;){const c=e.shift();d.push(c),t.index++;try{const[d,u]=(0,s.Vl)(c,":",2);if(void 0===u)throw new o(`No Value parsing iCal line ${t.index}: "${c}"`);const[p,h]=d.split(/;(.*)/,2),g=h?(0,s.Vl)(h,";").reduce(((e,t)=>{const[n,i]=t.split("=");return e[n]=a(i),e}),{}):{};switch(p){case"BEGIN":const s=u;t.line=c;let o=r(e,t)??{};switch(n[s]&&(o=[].concat(n[s],o)),s){case"VEVENT":case"VTODO":case"VJOURNAL":case"VALARM":case"VTIMEZONE":case"STANDARD":case"DAYLIGHT":n[s]=Array.isArray(o)?o:[o];break;default:n[s]=o}break;case"END":return["VEVENT","VTODO","VJOURNAL","VFREEBUSY"].includes(u)&&!n.UID&&(n.UID=crypto.randomUUID()),n;case"RECURRENCE-ID":case"DTSTART":case"DTEND":case"DTSTAMP":case"DUE":if("DTSTART"===p&&n.DTSTART&&e[0]?.startsWith("RRUL"))continue;/^\d{8}$/.test(u)&&(g.VALUE="DATE"),/\d+T\d+Z/.test(u)?g.TZID="UTC":g.TZID||(g.TZID=i.$T),n[p]={value:u,params:g};break;case"ATTENDEE":n[p]=(n[p]||[]).concat([{value:l(u),params:g}]);break;case"EXDATE":u.indexOf(",")>=0?n[p]=u.split(",").map((e=>({value:e,params:g}))):n[p]=(n[p]||[]).concat([{value:u,params:g}]);break;case"ORGANIZER":n[p]={value:l(u),params:g};break;case"URL":n[p]={value:u,params:g};break;case"ATTACH":n[p]=n[p]?[n[p],c].join("\r\n"):c;break;case"UID":case"CLASS":case"CREATED":case"DESCRIPTION":case"GEO":case"LAST-MODIFIED":case"LOCATION":case"PRIORITY":case"RRULE":case"SEQUENCE":case"STATUS":case"SUMMARY":case"TRANSP":case"X-WR-CALNAME":case"X-WR-CALDESC":n[p]=u;break;default:n[p]?n[p]=[].concat(n[p]||[],u):n[p]=u}}catch(n){let i=1;for(;e.length>1;){const s=e.shift();if(d.push(s),t.index++,s.startsWith("BEGIN")?i++:s.startsWith("END")&&i--,0===i)return console.warn("Calendar",["iCalendar","parser"],n),void console.log(`Failing iCalendar component.\n${d.join("\n")}`)}}}return n},l=e=>e.toLowerCase().startsWith("mailto:")?e.substr(7):e,d=e=>{const t=(e=>{const t=e.replace(/\n\\n/g,"\\n").split(/\r\n|\n|\r/).filter((e=>""!==e.trim())),n=[];let i="";for(;t.length>0;){const e=t.shift();" "===e[0]||"\t"===e[0]?i+=e.substr(1):(i&&n.push(i),i=e.trim())}return i&&n.push(i),n})(e),n=r(t,{index:0});if(!n?.VCALENDAR)return{VEVENT:[],VTODO:[],VJOURNAL:[]};if(n.VCALENDAR.VEVENT){const e=n.VCALENDAR.VEVENT.reduce(((e,t)=>{if(0===Object.keys(t).length)return e;const n=e.findIndex((e=>e.UID===t.UID));return-1===n?e.push({UID:t.UID,VEVENT:[t]}):e[n].VEVENT.push(t),e}),[]).reduce(((e,t)=>{const n=t.VEVENT.reduce(((e,t)=>(t["RECURRENCE-ID"]?e.EXCEPTIONS?e.EXCEPTIONS.push(t):e.EXCEPTIONS=[t]:e={...e,...t},e)),{});return e.push(n),e}),[]);n.VCALENDAR.VEVENT=e}else n.VCALENDAR.VEVENT=[];return{...n.VCALENDAR}}},34006:(e,t,n)=>{"use strict";n.d(t,{rP:()=>K,nj:()=>j,BC:()=>Q,KU:()=>z,ig:()=>q,PU:()=>J,Uq:()=>$});var i=n(2934),s=n(34929),o=n(1712),a=n(71636),r=n(15800),l=n(22616),d=n(33499),c=n(56371),u=n(45660);var p=n(28773),h=n(42568),g=n.n(h),m=n(80008),f=n.n(m),v=n(8687),y=n(15805),b=n(87265),S=n(25372);const{constructUrl:w}=b.Z;function C(e,t,n){const i=e.url,s=crypto.randomUUID();let o="",a="";const{username:r,password:l,accessToken:d}=e,c=(0,S.Z)(i);if(c){const{protocol:e,host:n}=c;if(!e||!n||!s)return;const i=e+"//"+n;a="/"+w([t,s])+".ics",o=w([i,a])}return{username:r,password:l,accessToken:d,headers:{"If-None-Match":"*"},url:o,href:a,method:"PUT",contentType:"text/calendar; charset=utf-8",body:n}}var A=n(7064),I=n(24522),T=n(9141),Z=n(74400),E=n(39190),k=n(58821);const _=(0,n(23542).extendMoment)(f());function N(e){const t=["BEGIN:VCALENDAR","PRODID:-Vivaldi Calendar V1.0//EN","VERSION:2.0","CALSCALE:GREGORIAN","DTSTAMP:"+_.tz().format(I.FI)],n=e=>e.reduce(((e,{EXCEPTIONS:t,...i})=>(e.push(i),t&&e.push(...n(t)),e)),[]);let i=[];for(const t of["VEVENT","VTODO"]){const s=e[t];s&&(i=i.concat(n(s).map((e=>O(e,"VTODO"===t)))))}t.push("");let s=t.join("\r\n");return i.forEach((e=>{s+=e})),r.ZP.foldIcal(s+"END:VCALENDAR\r\n")}function P(e,t){if(!t)return"";const{params:n}=t;return"DATE"===n.VALUE?`${e};VALUE=DATE:${t.value}`:`${e}:${t.value}`}function D(e,t){if(!t)return"";const n=[],{value:i,params:s}=t;for(const e in s)n.push(`${e}=${s[e]}`);return`${e};${n.join("=")}:mailto:${i}`}function M(e,t){const n=[],i=[];return t?(t.forEach((t=>{const{value:s,params:o}=t;for(const e in o)n.push(`${e}=${o[e]}`);const a=`${n.join(";")}`,r=`mailto:${s}`;i.push(`${e};${a}:${r}`)})),i.join("\r\n")):""}function O(e,t){let n=t?["BEGIN:VTODO"]:["BEGIN:VEVENT"];for(const t in e)switch(t){case"VALARM":const s=(i=e[t])?i.map((e=>{const t=["BEGIN:VALARM"];for(const n in e)t.push(`${n}:${e[n]}`);return t.push("END:VALARM"),t})).flat():[""];n=[...n,...s];break;case"ATTENDEE":n.push(M(t,e[t]));break;case"ORGANIZER":n.push(D(t,e[t]));break;case"DTSTART":case"RECURRENCE-ID":case"DTSTAMP":case"DTEND":n.push(P(t,e[t]));break;default:n.push(`${t}:${e[t]}`)}var i;return n.push(t?"END:VTODO\r\n":"END:VEVENT\r\n"),n.join("\r\n")}var x=n(89555);const{ensureHttpsForWebcal:L}=r.ZP,{setImportProgress:R}=l.Z,{createLocalAccountAndCalendar:B,getLocalAccount:F}=o.Z,W=new Map([["SUMMARY","title"],["LOCATION","location"],["DESCRIPTION","description"]]);function U(e,t){return t&&t!==I.$T?f().tz(e,t):f()(e)}function V(e){if(i.z.has(e)||e===I.$T)return e;const t=(0,k.EP)(),n=(0,E.findIana)(e);return t&&n&&n.includes(t)?t:n&&n.length?n[0]:""}function H(e){return"DATE"===e.params.VALUE?I.GL:I.jS}function G(e,t){if(e)return!t&&e?.value?.match(/\d+T\d+Z/)?(0,k.EP)():V(e.params.TZID)}function $(e,t){const n=V(t??e?.params.TZID),i=H(e),{value:s}=e;if(n===I.$T){const e=f().tz(s,i,"UTC").toDate();return(0,k.FL)(e).valueOf()}return n?f().tz(s,i,n).valueOf():f()(s,i).valueOf()}const K=(e,t,n={})=>{const i=[];let s=[];const o={title:""};W.forEach(((t,n)=>{"string"==typeof e[n]&&(o[t]=(0,Z.RO)(e[n]))}));const a=(e.EXCEPTIONS??[]).map((e=>{const s=K(e,t,n),o=e["RECURRENCE-ID"];if(o?.value){const e=$(o);i.push({date:e,cancelled:!1});const{exceptionEvents:t,...n}=s;return{...n,recurrenceId:e}}})).filter(Boolean);e.ATTENDEE&&(s=e.ATTENDEE.map((e=>({name:e.params.CN||"",address:e.value,partstat:e.params.PARTSTAT||"NEEDS-ACTION"}))));const r=Boolean(e.RRULE);let l,d=!1,c=0;const u=G(e.DTSTART,r);e.DTSTART?.value&&("DATE"===e.DTSTART.params.VALUE&&(d=!0),c=$(e.DTSTART,u));const h=G(e.DTEND,r);if(e.DTEND?.value&&(l=$(e.DTEND,h)),e.DURATION){l=c+f().duration(e.DURATION).asMilliseconds()}let g=[];e.VALARM&&(g=e.VALARM.map((t=>{const{TRIGGER:n=""}=t;return{when:-f().duration(n).asMilliseconds(),name:e.SUMMARY||""}})));let m=e.LOCATION;"string"!=typeof m&&(m="");let v={};const y=G(e.DUE,r);e.DUE&&("DATE"===e.DUE.params.VALUE&&(d=!0),v={end:$(e.DUE,y)}),e.EXDATE&&e.EXDATE.forEach((e=>{const t=H(e),n=V(e.params.TZID),s=n?f().tz(e.value,t,n):f()(e.value,t);i.push({cancelled:!0,date:s.valueOf()})}));const b=e.URL?.value;if(c&&l){const e=U(c,u),t=U(l,h),n=e.startOf("day").valueOf()===c,i=t.startOf("day").valueOf()===l,s=1===t.diff(e,"d");n&&i&&s&&(d=!0)}let S=!1;return e.STATUS&&(S="COMPLETED"===e.STATUS),e.RRULE&&"DATE"===e.DTSTART?.params.VALUE&&(e.RRULE=e.RRULE.replace(/\d{8}T\d{6}Z/g,(e=>f()(e).add(12,"hour").format(I.O5)))),e.RRULE&&"DATE"!==e.DTSTART?.params.VALUE&&(e.RRULE=e.RRULE.replace(/\d{8}T\d{6}Z/g,(e=>f().tz(e,u||y).format(I.A)))),{...o,rrule:e.RRULE,url:b,start:c,end:l,...(0,p.Z)(v),timezone:u||y,allDay:d,is_recurring:!!e.RRULE,calendarId:t,href:n.href,etag:n.etag,uid:e.UID?e.UID:"",organizer:e.ORGANIZER&&e.ORGANIZER.value,notifications:g,sequence:parseInt(e.SEQUENCE)||0,...(0,p.Z)(a.length>0?{exceptionEvents:a}:null),...(0,p.Z)(i.length>0?{recurrenceExceptions:i}:null),...(0,p.Z)(s.length>0?{invites:s}:null),attachment:e.ATTACH,is_template:!1,complete:S}};function z(e,t){const{is_template:n,exceptionEvents:i,...s}=e,o=function(e,t){if(e.invites)return e.invites.map((e=>{const n=t.invites?.find((t=>t.address===e.address));return{...e,id:n?.id||"",event_id:n?.event_id||""}}))}(e,t),a=function(e,n){if(!e.notifications)return;return t.notifications?e.notifications.map((({when:e,name:t})=>{const i=n.notifications?.find((n=>n.when===e&&(n.name??"")===(t??"")));return{when:e,name:t,id:i?.id??""}})):e.notifications.map((e=>({...e,id:"",event_id:t.id})))}(e,t);return{...s,attachment:r.ZP.stringToAttachments(e.attachment),...(0,p.Z)(o?{invites:o}:null),...(0,p.Z)(a?{notifications:a}:null),id:t.id,start:e.start||0,end:e.end||0}}const j=async(e,t)=>{if(0===e.length)return;let n=0;const s=[[]];let o=0;for(const i of e)100===s[o].length&&(s.push([]),o++),i.exceptionEvents?.length?(await(0,T.$E)(i),n++,t(n,e.length)):s[o].push(i);i.ZP.stopAPIChangeListeners();try{for(const o of s){n+=(await i.ZP.createEvents(o)).created_count,t(n,e.length),i.ZP.loadPromise()}}catch(e){throw u.Z.error("Calendar",["import"],e),e}finally{i.ZP.startAPIChangeListeners(),d.ZP.updateAllAlarms()}};async function Y(e,t,n){const i=n?(e,t)=>R("Calendar",n,e,t):x.Z;for(const s of["VEVENT","VTODO"])if(t[s])try{const n=t=>({...K(t,e),task:"VTODO"===s});j(t[s].map(n),i)}catch(e){l.Z.addImportError("Calendar",n,e),u.Z.error("Calendar",["import"],e)}}const X=g()((async function(e){let t;try{if("string"==typeof e)t=e.startsWith("http")||e.startsWith("webcal")?await async function(e){try{const t=await fetch(e,{method:"GET"});if(200!==t.status)throw`Fetch remote calendar. Status code: ${t.status}`;return t.text()}catch(e){throw u.Z.warn("Calendar",["network"],"Error fetching calendar",e),e}}(L(e)):await A.Z.mailPrivate.readFileToText(e);else{const n=await e.getFile();t=await n.text()}return(0,y.Z)(t)}catch(e){throw e instanceof y.z?(u.Z.error("Calendar",["import","parser"],e),console.log("iCalendar parser error",t)):u.Z.warn("Calendar",["import","load"],e),e}}),{isPromise:!0,maxSize:10,onCacheChange:e=>{const t=e.keys[0];setTimeout((()=>{const n=e.getKeyIndex(t);-1!==n&&(e.keys.splice(n,1),e.values.splice(n,1))}),5*I.lb)}}),Q=async(e,t)=>{const{file:n}=e,s=await X(n);if(s.VEVENT?.[0]){const e=K(s.VEVENT[0],r.ZP.getDefaultCalendar()?.id||"");i.ZP.addEventCommand(t,e)}else u.Z.warn("Calendar",["import"],"No event found in file")},q=async e=>{try{const{file:t}=e,n=await X(t);return n.VEVENT.length?{eventCount:n.VEVENT.length,message:"",error:!1,calendarName:n["X-WR-CALNAME"]||n["X-WR-CALDESC"]||""}:{eventCount:0,message:(0,c.Z)("No events found"),error:!0,calendarName:""}}catch(e){return{eventCount:0,message:e.message,error:!0,calendarName:""}}},J=async e=>{const{file:t}=e,n=await X(t);try{!async function(e,t){const{calendarId:n,createNew:o,newCalendarName:p}=t,{VEVENT:h=[],VTODO:g=[]}=e;if(R("Calendar",p,0,h.length+g.length),o){const t={name:"",description:p,accountId:"",supportedCalendarComponent:{vevent:!0,vtodo:!0,vjournal:!1}},n=F();let s;if(n?(t.accountId=n.id,s=(await i.ZP.createCalendar(t)).calendar):s=(await B(null,t)).calendar,!s)return l.Z.addImportError("Calendar",p,(0,c.Z)("Error creating calendar.")),void u.Z.error("Calendar",["import"],"Error creating calendar.");await Y(s.id,e,p)}else{const{account:t,calendar:i}=r.ZP.getAccountAndCalendar(n);if(!t||!i)return void u.Z.error("Calendar",["import"],"Import error. Calendar not found.");const{account_type:o}=t;if("caldav"===o||"vivaldi"===o||"google"===o){const n=[],{VEVENT:o,VTODO:r,...u}=e;for(const t of["VEVENT","VTODO"]){if(!e[t])continue;const i=e[t];for(const e of i){let i;i="VEVENT"===t?{...u,VTODO:[],VEVENT:[e]}:{...u,VEVENT:[],VTODO:[e]};const s=N(i);n.push(s)}}let h=0;for(const e of n){const o=await s.Z.getAuthentication(t),a=C(o,i.name,e),r=a?await(0,v.ZP)(a):{ok:!1,response:(0,c.Z)("Could not create a request from url. '%s'",[o.url])};r.ok?R("Calendar",p,++h,n.length):l.Z.addImportError("Calendar",p,(0,c.Z)("Error uploading event to server. $1",[r.response]))}d.ZP.updateAllAlarms(),setTimeout((()=>{a.Z.pollCalDAV([t.id])}),1e3)}else await Y(n,e,p)}}(n,e)}catch(e){throw u.Z.warn("Calendar",["import","parse"],e),e}}},87852:(e,t,n)=>{"use strict";n.d(t,{G6:()=>i,Nw:()=>o,Q9:()=>a,W$:()=>s});const i=-999,s=-997,o=-996,a=-995},47543:(e,t,n)=>{"use strict";n.d(t,{EE:()=>v,IK:()=>I,Ns:()=>g,QX:()=>Z,Qj:()=>h,YE:()=>y,Zm:()=>m,_7:()=>p,_v:()=>S,jw:()=>E,ng:()=>c,qh:()=>b,v1:()=>C,xL:()=>w,yu:()=>f,z3:()=>u});var i=n(45660),s=n(42568),o=n.n(s),a=n(30381),r=n.n(a),l=n(82191),d=n(58821);const c=[l.Ci.MO,l.Ci.TU,l.Ci.WE,l.Ci.TH,l.Ci.FR,l.Ci.SA,l.Ci.SU],u=[l.Ci.MO,l.Ci.TU,l.Ci.WE,l.Ci.TH,l.Ci.FR];function p(e){const t=c[(e+6)%7];if(!t)throw new Error("Invalid weekday number");return t}function h(e,t,n){if(e)try{const i=n?(0,d.VV)(new Date(n),t):void 0;return(0,l.SA)(e,{dtstart:i})}catch(t){i.Z.warn("Calendar",["parser"],"Error parsing rrule string",e,t)}}function g(e){return e.dtstart&&(e.dtstart=(0,d.VV)(e.dtstart)),e.until&&(e.until=(0,d.VV)(e.until)),l.Ci.optionsToString(e)}function m(e){let{dtstart:t,until:n}=e;return t=t&&(0,d.VV)(t),n=n&&(0,d.VV)(n),new l.Ci({...e,dtstart:t,until:n})}function f(e,t){let{dtstart:n,until:i}=t;return n=n?(0,d.VV)(n):e.origOptions.dtstart,t.hasOwnProperty("until")?i&&(i=(0,d.VV)(i)):i=e.origOptions.until&&(0,d.FL)(e.origOptions.until),new l.Ci({...e.origOptions,...t,dtstart:n,until:i})}function v(e,t,n){function i(e){return e.weeks()-e.clone().startOf("month").weeks()}function s(e,t,n){const i="number"==typeof n?n:n.weekday,s=c[((i+e)%7+7)%7];if(!s)throw new Error("Weekday not found. Should not happen.");return s&&n.hasOwnProperty("n")&&"number"==typeof n.n?s.nth(n.n+t):s}if(!e)throw new Error("Trying to change empty recurrence rule");const o=e.dtstart??new Date((0,d.oJ)(n)),a=(0,d.FL)(o,n.timezone),l=r()(a),u=r()(a).add(t,"millisecond"),p=u.diff(l,"day");if(!p)return e;const h=i(u)-i(l),{byweekday:g,bymonthday:m}=e;return g?Array.isArray(g)?e.byweekday=g.map((e=>s(p,h,e))):e.byweekday=s(p,h,g):m&&(Array.isArray(m)?e.bymonthday=m.map((e=>l.clone().date(e).add(p,"day").date())):"number"==typeof m&&(e.bymonthday=l.clone().date(m).add(p,"day").date())),e}const y=o()((function(e,t){const{from:n,to:i,eventStart:s,timezone:o}=t,a=h(e,o,s);return a?a.between((0,d.VV)(new Date(n),o),(0,d.VV)(new Date(i),o),!0).map((e=>(0,d.FL)(e,o))):[]}),{maxSize:250});function b(e,t,n,i,s){return e.between((0,d.VV)(t,s),(0,d.VV)(n,s),!0,((e,t)=>t<i)).map((e=>(0,d.FL)(e,s)))}function S(e,t,n,i){const s=e.before((0,d.VV)(t,n),i);return s instanceof Date?(0,d.FL)(s):null}function w(e,t,n,i){const s=e.after((0,d.VV)(t,n),i);return s instanceof Date?(0,d.FL)(s):null}function C(e){const{bymonthday:t}=e.origOptions;return t?Array.isArray(t)?t:[t]:[]}function A(e){return"number"==typeof e?e:e.weekday}function I(e){const{byweekday:t}=e.origOptions;return t?Array.isArray(t)?t.map(A):[A(t)]:[]}function T(e){return"number"==typeof e?new l.OG(e):e}function Z(e){const{byweekday:t}=e.origOptions;return t?Array.isArray(t)?t.map(T):[T(t)]:[]}function E(e,t){if(!e)return 0;if(["UNTIL","COUNT"].some((t=>e.indexOf(t)>0))){const n=h(e);if(n?.options.until)return(0,d.FL)(n.options.until,t).valueOf();if(n?.options.count)return(0,d.FL)(n.all().pop(),t).valueOf()}return 0}},98035:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});var i=n(2934),s=n(15800),o=n(45660),a=n(28773),r=n(7064),l=n(24522),d=n(58821);function c(e){if(e.timezone!==l.$T&&!e.allDay)return e;const t={...e},{start:n=0,end:i=0}=e;return n&&(t.start=(0,d.VV)(new Date(n)).valueOf()),i&&(t.end=(0,d.VV)(new Date(i)).valueOf()),t}function u(e,t){o.Z.error("Calendar",[e,"event"],t)}async function p(e,t){let n;try{n=await r.Z.calendar.updateEvent(e,c({...t}))}catch(e){throw u("update",e),e}return i.ZP.transformVivaldiEvents([n])[0]}const h={createEvent:async function(e){let t;try{t=await r.Z.calendar.eventCreate(c(e))}catch(e){throw u("create",e),e}return i.ZP.transformVivaldiEvents([t])[0]},createEvents:async function(e){let t;try{t=await r.Z.calendar.eventsCreate(e.map(c))}catch(e){throw u("create",e),e}return t},updateEvent:async function(e){const{filteredOut:t,id:n,invites:i,notifications:o,recurrenceId:r,recurrenceExceptions:l,trash_time:d,attachment:c,...u}=e;return p(n,{...u,...(0,a.Z)(c?{attachment:s.ZP.attachmentsToString(c)}:null)})},updateEventFromServer:async function(e,t){const{invites:n,notifications:i,recurrenceExceptions:s,is_template:o,exceptionEvents:a,...r}=t;return p(e,r)},createException:async function(e,t,n,s){if(!t&&!s)throw new Error("Can not create exception, invalid parameters.");const o=await r.Z.calendar.createEventException(e,t?"0":s,t,n);return i.ZP.transformVivaldiEvents([o])[0]},updateExceptions:async function(e){let t;for(const n of e){const{exception_id:e,...i}=n;e&&(t=await r.Z.calendar.updateRecurrenceException(e,i))}return t&&i.ZP.transformVivaldiEvents([t])[0]}}},41851:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var i=n(7064),s=n(68172);const o={saveTemplate:async function(e,t){const n=(0,s.VK)(t);if(e)return await i.Z.calendar.updateEventTemplate(e,{name:t.name,ical:n}),{id:e,name:t.name};return{id:(await i.Z.calendar.createEventTemplate(t.name,n)).id,name:t.name}},deleteTemplate:async function(e){return i.Z.calendar.deleteEventTemplate(e)},loadTemplate:async function(e){const t=(await i.Z.calendar.getAllEventTemplates()).find((t=>t.id===e));if(t)return(0,s.Z1)(t.name,t.ical)},loadTemplatesList:async function(){return(await i.Z.calendar.getAllEventTemplates()).map((({id:e,name:t})=>({name:t,id:e})))}}},22529:(e,t,n)=>{"use strict";n.d(t,{Z:()=>w});var i,s=n(67294),o=n(29087),a=n(94283),r=n(56371),l=n(30381),d=n.n(l),c=n(81814),u=n(19789),p=n(89175),h=n(86088),g=n(89555),m=n(48521),f=n(34155);function v(e,t,n,s){i||(i="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=s;else if(a>1){for(var r=new Array(a),l=0;l<a;l++)r[l]=arguments[l+3];t.children=r}if(t&&o)for(var d in o)void 0===t[d]&&(t[d]=o[d]);else t||(t=o||{});return{$$typeof:i,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const y=function(e,t){return"0"!==e&&e.length<t?e.padStart(t,"0"):e.length>t?e.slice(e.length-t):e};function b(e){function t(e,t){return t.findIndex((t=>t[0].toUpperCase()===e[0].toUpperCase()&&t.length<e.length))}function n(e){return["d","m","y"].includes(e?.[0].toLowerCase())}const i=e.match(/(d+|m+|y+)|([^dmy]*)/gi)?.slice(0,-1);if(!i)return console.log("Incompatible date format found: "+e),b("yyyy-mm-dd");const s=[],o=[];let a="",r=i.shift();for(;r&&a.length<3;){for(;r&&!n(r);)r=i.shift();if(!r)break;-1!==t(r,i)||a.includes(r[0].toLowerCase())||(s.push(r),a+=r[0].toLowerCase(),n(i[0])?o.push(""):o.push(i.shift())),r=i.shift()}let l=s.map((e=>e[0].toLowerCase())).join("");if("dm"===l?l="dmy":"md"===l&&(l="ymd"),3!==l.length)return console.log("Incompatible date format found: ",e,l),b("yyyy-mm-dd");return{fields:l.split("").map((t=>{switch(t){case"d":return{type:"day",format:"dd"};case"m":return{type:"month",format:"mm"};case"y":return{type:"year",format:"yyyy"};default:throw new Error(`Unexpected date format group: ${t}, ${e}`)}})),separators:o}}class S extends s.PureComponent{static contextType=a.Z;_focused=!1;hidden=s.createRef();fieldRefs={day:this.props.dayInputRef||s.createRef(),month:s.createRef(),year:s.createRef()};inputPosition=-1;constructor(e){super(e),this._template=b(this.getFormat());const[t,n,i]=this.props.value.split("-");this.state={year:t,month:n,day:i,hasInput:!1}}componentDidUpdate(e){e.value!==this.props.value&&this.setCache()}setCache=()=>{const[e,t,n]=this.props.value.split("-");this.setState((i=>({year:e??"",month:t??"",day:n??"",hasInput:!!this.props.value&&i.hasInput})))};getFormat=()=>this.props.format||d().localeData().longDateFormat("L");processChange=e=>{""===e.currentTarget.value&&this.setState({hasInput:!1}),this.props.onChange(e)};select=e=>{this.inputPosition=-1,e.target instanceof this.context.HTMLInputElement&&(e.preventDefault(),e.target.select())};focus=()=>{this.fieldRefs[this._template.fields[0].type]?.current?.focus()};onKeyDown=e=>{this.props.onKeyDown&&this.props.onKeyDown(e);const{key:t,target:n}=e,i=n.dataset.type,s=this._template.fields.findIndex((e=>e.type===i));if(t&&("ArrowLeft"===t||"ArrowRight"===t||"ArrowDown"===t))switch(t){case"ArrowRight":e.preventDefault();const t=this.fieldRefs[this._template.fields[s+1].type];return void(t&&t.current.select());case"ArrowLeft":e.preventDefault();const n=this.fieldRefs[this._template.fields[s-1].type];return void(n&&n.current.select());case"ArrowDown":return void(e.altKey&&(e.preventDefault(),this.hidden.current?.showPicker()))}isNaN(Number(t))&&f.nextTick((()=>{const{document:e,HTMLInputElement:t}=this.context;e.activeElement instanceof t&&e.activeElement.select()}))};onClickPlaceholder=e=>{this.hidden.current?.showPicker()};onPlaceholderKeyDown=e=>{if(this.props.onKeyDown&&this.props.onKeyDown(e),"ArrowDown"===e.key&&e.altKey&&(e.preventDefault(),this.hidden.current?.showPicker()),!isNaN(e.key)){const t=this._template.fields[0].type,n=this.fieldRefs[t].current;if(n){const t=new Date;this.setState({day:y(t.getDate().toString(),2),month:y((t.getMonth()+1).toString(),2),year:t.getFullYear().toString(),hasInput:!0},(()=>{const t=(Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value")||{}).set;if(n&&t){t.call(n,e.key);const i=new InputEvent("change",{bubbles:!1});n.dispatchEvent(i)}f.nextTick((()=>{n.focus(),this.context.document.getSelection()?.collapseToEnd()}))}))}}};skipToNextField(e){const{document:t}=this.context,n=this._template.fields.length,i=this._template.fields.findIndex((t=>t.type===e))+1;i===n&&(this.props.autoFocusNextElement??o.Z.get(p.kCalendarAutoTabDatetime))?f.nextTick((()=>{(0,c.pf)(t)})):f.nextTick((()=>{const e=this._template.fields[Math.min(i,n-1)].type;this.fieldRefs[e].current?.select()}))}onChangeDate=e=>{const t=e.target,n=t.dataset.type,i=t.value;let s=parseInt(i);const o=[this.state.year,this.state.month,this.state.day],a=!e.nativeEvent.inputType&&e.nativeEvent.bubbles,r=a&&this.props.step?parseInt(this.props.step):1;let l=!1;if(a&&"day"===n){const e=parseInt(this.state.day);l=!0,s=s<e?e-r:e+r}const c="year"===n?4:2,p="year"===n?9999:"month"===n?12:d()(this.props.value).daysInMonth(),h=i===c||a?1:0;s>p?a?s%=p:s=p:s<h&&(s=a?p:h);let g=s.toString();a&&(g=y(g,c)),l&&t.setAttribute("value",g),!a&&(10*s>p||i.length>=c)&&(g=y(g,c),this.skipToNextField(n)),this.setState({[n]:g},(()=>{const e=["year","month","day"].indexOf(n);if(g.length<c)return;o[e]=g;const t=d()(o.join("-"));if(t.isValid()){if(this.props.min&&t.isBefore(d()(this.props.min))||this.props.max&&t.isAfter(d()(this.props.max)))return;const e=this.hidden.current,n=(Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value")||{}).set;e&&n&&(n.call(e,(0,u.SI)(t)),e.dispatchEvent(new Event("input",{bubbles:!0})))}}))};onFocus=e=>{if(e.persist(),e.preventDefault(),this._focused)return;const t=e.target.closest(".dateInput");f.nextTick((()=>{const{onFocus:n}=this.props,{document:i,HTMLElement:s}=this.context;n&&t instanceof s&&(0,c.sT)(i,t)&&(this._focused=!0,n(e))}))};onBlur=e=>{const t=this._template.fields.reduce(((e,t)=>{const n=this.state[t.type];return n&&n.length<t.format.length&&(e[t.type]=y(n,t.format.length)),e}),{});Object.keys(t).length>0&&this.setState(t),e.preventDefault(),e.persist();const n=e.target.closest(".dateInput");f.nextTick((()=>{const{onBlur:t}=this.props,{document:i,HTMLElement:s}=this.context;t&&n instanceof s&&!(0,c.sT)(i,n)&&(this._focused=!1,t(e))}))};keepFocusWithin=e=>{e.preventDefault(),(0,c.sT)(this.context.document,e.currentTarget.nextElementSibling)||this.focus()};renderFields=e=>{const t=[this._template.fields[0].type,this._template.separators[0]??"/",this._template.fields[1].type,this._template.separators[1]??this._template.separators[0]??"/",this._template.fields[2].type],n={onFocus:this.select,onMouseDown:this.select,onMouseUp:e=>e.preventDefault(),onKeyDown:this.onKeyDown,onChange:this.onChangeDate,disabled:this.props.disabled};return v("span",{className:"faux date"},void 0,t.map(((t,i)=>{switch(t.toLowerCase()){case"day":return(0,s.createElement)("input",{...n,autoFocus:0===i&&this.props.autoFocus,key:"dd_"+i,className:"dateInputDay"+(e?" dateInputHiddenChild":""),type:"number",ref:this.fieldRefs.day,"data-type":"day",tabIndex:this.props.tabIndex,placeholder:(0,r.Z)("dd"),value:this.state.day??""});case"month":return(0,s.createElement)("input",{...n,autoFocus:0===i&&this.props.autoFocus,key:"mm_"+i,className:"dateInputMonth"+(e?" dateInputHiddenChild":""),type:"number",ref:this.fieldRefs.month,"data-type":"month",tabIndex:this.props.tabIndex,placeholder:(0,r.Z)("date","mm"),value:this.state.month??""});case"year":return(0,s.createElement)("input",{...n,autoFocus:0===i&&this.props.autoFocus,key:"yy_"+i,className:"dateInputYear"+(e?" dateInputHiddenChild":""),type:"number",ref:this.fieldRefs.year,"data-type":"year",tabIndex:this.props.tabIndex,placeholder:(0,r.Z)("yyyy"),value:this.state.year??""});default:return v("span",{className:"dateInputSeparator"+(e?" dateInputHiddenChild":"")},"separator_"+i,t)}})))};render(){const{format:e,onChange:t,tabIndex:n,onFocus:i,onBlur:s,dayInputRef:o,placeholder:a,autoFocus:r,...l}=this.props,d=!this.state.hasInput&&!this.props.value&&!!a;return v("span",{className:"dateInput",title:this.props.title,onBlur:this.onBlur,onFocus:this.onFocus},void 0,(0,m.jsx)("input",{...l,type:"date",ref:this.hidden,tabIndex:"-1",className:"dateInputHidden",onMouseDown:this.keepFocusWithin,onChange:this.processChange}),this.renderFields(d),d&&v("input",{className:"placeholder"+(d?"":" dateInputHiddenChild"),placeholder:a,onClick:this.onClickPlaceholder,onKeyDown:this.onPlaceholderKeyDown,onChange:g.Z,value:"",type:"number"}),v("span",{className:"arrowDown",dangerouslySetInnerHTML:{__html:h.yaZ.medium}}))}}const w=S},97009:(e,t,n)=>{"use strict";n.d(t,{D0:()=>u,ZP:()=>g,rv:()=>p});var i=n(67294),s=n(24325),o=n.n(s),a=n(25372),r=n(36436),l=n(44850),d=n(48521);const c=["/resources","chrome://favicon","data:"];function u(e){return c.some((t=>e.startsWith(t)))}function p(e){if(u(e))return e;let t,n="";const i=(0,a.Z)((0,r.q9)(e));i&&({hostname:t,protocol:n}=i);return`${n||"https"}//${(t||"").split(".").slice(-2).join(".")}/favicon.ico`}class h extends i.PureComponent{state={loadFailed:!1};componentDidUpdate(e,t){t.loadFailed&&this.props.url!==e.url&&this.props.loadType!==e.loadType&&this.setState({loadFailed:!1})}handleImageLoadError=()=>{this.setState({loadFailed:!0})};getUrl=()=>{const e=this.props.fallbackUrl?(0,l.w$)(this.props.fallbackUrl):void 0,t=(0,l.w$)(this.props.url);return t.startsWith("<svg")?{type:"svg",url:t}:t.startsWith("data:")?{type:"data",url:t}:this.state.loadFailed?e&&u(e)?{type:"faviconSkipCache",url:e}:{type:"faviconSkipCache",url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABiUlEQVR42u2XK08DURBG6U/D80eQeMIjqGJAocCA6hqqUBASakCBAYUqSbvb92u3j6VZZjYcQ3q3hWlSRJucfF8yt3PPlbuxtb2zUtYC/1dAfge/ZHOlAkgsXSBJkn0B9ki6nvE87z5Twi7g5vtM4pCwC0yn0yPZn6KdBATcEnaBfBzHx4p0EvIIuCTMAnLhqXCiaCcBgSwJk8B4PD6Ti1K0k3QE5kn8WWA0Gl24mEwm5wjMk7AIXA6Hw6tZ6EzO7GZhFpCLChBFkUfSyVmEYVgwC8gF14PBoKhoJwGY/ThflB2HJoF+v38jL0mRTi5MLpezCchLbnu9HtyRdFLRsyTdLNDtdkvykgdFOgkl0oVZoNPpPMqip0Vot9tkiv7XLNBqtZ5l2YuinVTkAtLJMgTeMngl6STdLNBsNt+h0WiQdNI5NwvIonK9XnfxQToomwVkiV+r1YJZ6IwEYGYWCIKgbcEs4Pt+JIQOIpJO0s0ClUrls1qtQkwqOiM5R9JNAktk9QLrb0MXX53cKptKU4a6AAAAAElFTkSuQmCC"}:"page"===this.props.loadType?t.startsWith("javascript")?{type:"svg",url:o()}:{type:"page",url:t}:u(t)?{type:"faviconSkipCache",url:t}:{type:this.props.loadType,url:t}};render(){const{type:e,url:t}=this.getUrl();if("svg"===e||"emoji"===e)return(0,d.jsx)("span",{ref:this.props.refFavicon,className:this.props.className,style:this.props.style,dangerouslySetInnerHTML:{__html:t},title:this.props.title});const n=t.replace("vivaldi://","chrome://"),i="page"===e?"":"iconurl/",s=this.props.size||16,o=1.5*s,a=2*s,r="faviconSkipCache"===e||"data"===e,l=r?t:null,c=r?null:`chrome://favicon/size/${s}/${i}${n} ${s}w,chrome://favicon/size/${o}/${i}${n} ${o}w,chrome://favicon/size/${a}/${i}${n} ${a}w`;return(0,d.jsx)("img",{ref:this.props.refFavicon,className:this.props.className,width:s,height:s,src:l,srcSet:c,style:this.props.style,title:this.props.title,onError:this.handleImageLoadError})}}const g=h},69417:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u});var i,s=n(67294),o=n(94184),a=n.n(o),r=n(86088),l=n(48521);function d(e,t,n,s){i||(i="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=s;else if(a>1){for(var r=new Array(a),l=0;l<a;l++)r[l]=arguments[l+3];t.children=r}if(t&&o)for(var d in o)void 0===t[d]&&(t[d]=o[d]);else t||(t=o||{});return{$$typeof:i,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class c extends s.PureComponent{inputRef=s.createRef();componentDidMount(){if(this.props.focusInput&&this.inputRef.current){const e=this.inputRef.current;e.focus(),e.setSelectionRange(0,e.value.length)}}componentDidUpdate(e){if(!e.focusInput&&this.props.focusInput&&this.inputRef.current){const e=this.inputRef.current;e.focus(),e.setSelectionRange(0,e.value.length)}}render(){const{placeholder:e="",label:t,labelImportant:n,className:i="",isVerified:s,hasError:o,focusInput:c,...u}=this.props,p=a()(i,{"floating-label":!0,verified:s&&!this.props.disabled});let h;return t&&(h=d(n?"strong":"span",{},void 0,t)),d("label",{className:p},void 0,h,"textarea"!==u.type?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("input",{...u,ref:this.inputRef,className:"floating-input",type:this.props.type,placeholder:e}),o&&!this.props.disabled&&d("span",{className:"error",dangerouslySetInnerHTML:{__html:r.viW}})]}):(0,l.jsx)("textarea",{...u,ref:this.inputRef,className:"floating-input",placeholder:e}))}}const u=c},63377:(e,t,n)=>{"use strict";n.d(t,{Z:()=>p});var i,s=n(67294),o=n(29087),a=n(94283),r=n(89175),l=n(48521);function d(e,t,n,s){i||(i="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=s;else if(a>1){for(var r=new Array(a),l=0;l<a;l++)r[l]=arguments[l+3];t.children=r}if(t&&o)for(var d in o)void 0===t[d]&&(t[d]=o[d]);else t||(t=o||{});return{$$typeof:i,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const c=[r.kWebpagesFocusTrap];class u extends s.PureComponent{static contextType=a.Z;focusRef=this.props.forwardRef??s.createRef();constructor(e,t){super(e),this._lastFocused=t.document.activeElement}componentDidMount(){this._getFocusable();const e=0===o.Z.get(r.kKeyboardTabToAll),{preventTrap:t,forceTrap:n,noInitialFocus:i}=this.props;!i&&(e&&!t||n)&&this.focus(),o.Z.addListener(c,this.onPrefsCacheChanged)}componentWillUnmount(){const{document:e}=this.context;!this.props.noInitialFocus&&this.focusRef?.current?.contains(e.activeElement)&&setTimeout((()=>{"BODY"===e.activeElement?.tagName&&this._lastFocused?.isConnected&&this._lastFocused.focus()}),1),delete this._focusable,o.Z.removeListener(c,this.onPrefsCacheChanged)}onPrefsCacheChanged=()=>this.forceUpdate();_getFocusable=()=>{const{HTMLElement:e}=this.context,t=this.focusRef.current;this._focusable=t instanceof e?t.querySelectorAll(`a[href]:not([tabindex='-1']),\n        button:not([disabled],[disabled=true],[tabindex='-1']),\n        input:not([disabled],[disabled=true],[tabindex='-1'],[hidden]),\n        select:not([disabled],[disabled=true],[tabindex='-1']),\n        textarea:not([disabled],[disabled=true],[tabindex='-1']),\n        p[contenteditable]:not([tabindex='-1']),\n        [tabindex]:not([tabindex='-1'],\n        .${this.props.focusName})`):void 0};focus=()=>{this.focusRef?.current?.contains(this.context.document.activeElement)||(this.props.forceTrap?this.focusRef?.current?.focus():this._focusable?.length&&this._focusable[0].focus())};isFocusOrigin=e=>Boolean(e.relatedTarget instanceof this.context.HTMLElement&&this.focusRef?.current?.contains(e.relatedTarget)&&this.focusRef?.current!==e.relatedTarget);handleTopFocus=e=>{if(this._getFocusable(),(!this.props.noInitialFocus||e.relatedTarget)&&this._focusable?.length){const t=this._focusable[0],n=this._focusable[this._focusable.length-1];if(!t||!n)return;this.isFocusOrigin(e)?n.focus():t.focus()}};handleBottomFocus=e=>{if((!this.props.noInitialFocus||e.relatedTarget)&&this._focusable?.length){const t=this._focusable[0],n=this._focusable[this._focusable.length-1];if(!t||!n)return;this.isFocusOrigin(e)?t.focus():n.focus()}};render(){const{children:e,focusName:t,forceTrap:n,preventTrap:i,noInitialFocus:s,forwardRef:a,...c}=this.props,u=n?0:null,p=!0===o.Z.get(r.kWebpagesFocusTrap);return n||p&&!i?(0,l.jsxs)("div",{...c,ref:this.focusRef,tabIndex:u,children:[d("span",{tabIndex:"0",className:"focus_anchor "+t,onFocus:this.handleTopFocus}),e,d("span",{tabIndex:"0",className:"focus_anchor "+t,onFocus:this.handleBottomFocus})]}):(0,l.jsx)("div",{...c,ref:this.focusRef,tabIndex:u,children:e})}}const p=u},90718:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var i,s=n(67294),o=n(29087),a=n(89175);function r(e,t,n,s){i||(i="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=s;else if(a>1){for(var r=new Array(a),l=0;l<a;l++)r[l]=arguments[l+3];t.children=r}if(t&&o)for(var d in o)void 0===t[d]&&(t[d]=o[d]);else t||(t=o||{});return{$$typeof:i,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class l extends s.PureComponent{onKeyDown=e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),e.stopPropagation(),this.props.onClick())};render(){return r("span",{title:this.props.title,className:"InlineText",tabIndex:o.Z.get(a.kKeyboardTabToAll),onMouseDown:e=>e.preventDefault(),onClick:this.props.onClick,onKeyDown:this.onKeyDown},void 0,this.props.children)}}},52250:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var i=n(67294),s=n(94283),o=n(46884),a=n(48521);function r(e){return(0,i.forwardRef)((function(t,n){if("function"==typeof n)throw Error("Callback refs not supported");const{Element:r}=i.useContext(s.Z),[l,d]=(0,i.useState)(!1),c=(0,i.useCallback)((()=>d(!1)),[]),u=(0,i.useCallback)((()=>d(!0)),[]),p=(0,i.useRef)(null),h=n||p,g=(0,i.useCallback)((()=>{const e=h.current?.getNode();return e instanceof r?e:null}),[h,r]),m=(0,i.useCallback)((()=>h.current?h.current.handleClickOutside:null),[h]),{disableOnClickOutside:f,outsideClickIgnoreClass:v}=t;return(0,o.Z)(g,m,v,f?.()||l),(0,a.jsx)(e,{...t,ref:h,enableOnClickOutside:c,disableOnClickOutside:u})}))}},81009:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(67294),s=n(14507),o=n(48521);const a=function(e,t){return i.forwardRef(((n,i)=>{const a=(0,s.Z)(t);return(0,o.jsx)(e,{...n,ref:i,prefValues:a})}))}},5298:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const i=Object.freeze({KEY_CANCEL:3,KEY_HELP:6,KEY_BACK_SPACE:8,KEY_TAB:9,KEY_CLEAR:12,KEY_RETURN:13,KEY_ENTER:14,KEY_SHIFT:16,KEY_CONTROL:17,KEY_ALT:18,KEY_PAUSE:19,KEY_CAPS_LOCK:20,KEY_ESCAPE:27,KEY_SPACE:32,KEY_PAGE_UP:33,KEY_PAGE_DOWN:34,KEY_END:35,KEY_HOME:36,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_PRINTSCREEN:44,KEY_INSERT:45,KEY_DELETE:46,KEY_0:48,KEY_1:49,KEY_2:50,KEY_3:51,KEY_4:52,KEY_5:53,KEY_6:54,KEY_7:55,KEY_8:56,KEY_9:57,KEY_SEMICOLON:59,KEY_EQUALS:61,KEY_A:65,KEY_B:66,KEY_C:67,KEY_D:68,KEY_E:69,KEY_F:70,KEY_G:71,KEY_H:72,KEY_I:73,KEY_J:74,KEY_K:75,KEY_L:76,KEY_M:77,KEY_N:78,KEY_O:79,KEY_P:80,KEY_Q:81,KEY_R:82,KEY_S:83,KEY_T:84,KEY_U:85,KEY_V:86,KEY_W:87,KEY_X:88,KEY_Y:89,KEY_Z:90,KEY_META:91,KEY_CONTEXT_MENU:93,KEY_NUMPAD0:96,KEY_NUMPAD1:97,KEY_NUMPAD2:98,KEY_NUMPAD3:99,KEY_NUMPAD4:100,KEY_NUMPAD5:101,KEY_NUMPAD6:102,KEY_NUMPAD7:103,KEY_NUMPAD8:104,KEY_NUMPAD9:105,KEY_MULTIPLY:106,KEY_ADD:107,KEY_SEPARATOR:108,KEY_SUBTRACT:109,KEY_DECIMAL:110,KEY_DIVIDE:111,KEY_F1:112,KEY_F2:113,KEY_F3:114,KEY_F4:115,KEY_F5:116,KEY_F6:117,KEY_F7:118,KEY_F8:119,KEY_F9:120,KEY_F10:121,KEY_F11:122,KEY_F12:123,KEY_F13:124,KEY_F14:125,KEY_F15:126,KEY_F16:127,KEY_F17:128,KEY_F18:129,KEY_F19:130,KEY_F20:131,KEY_F21:132,KEY_F22:133,KEY_F23:134,KEY_F24:135,KEY_NUM_LOCK:144,KEY_SCROLL_LOCK:145,KEY_COMMA:188,KEY_PERIOD:190,KEY_SLASH:191,KEY_BACK_QUOTE:192,KEY_OPEN_BRACKET:219,KEY_BACK_SLASH:220,KEY_CLOSE_BRACKET:221,KEY_QUOTE:222})},76632:(e,t,n)=>{"use strict";n.d(t,{Z:()=>m});var i,s=n(67294),o=n(64473),a=n(56551),r=n(56371),l=n(94184),d=n.n(l),c=n(67074),u=n(48521);function p(e,t,n,s){i||(i="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=s;else if(a>1){for(var r=new Array(a),l=0;l<a;l++)r[l]=arguments[l+3];t.children=r}if(t&&o)for(var d in o)void 0===t[d]&&(t[d]=o[d]);else t||(t=o||{});return{$$typeof:i,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const h={width:450,minWidth:"unset"};class g extends s.Component{refSortable=s.createRef();constructor(e){super(e),this.state={selectedIndex:this.props.initialSelectedIndex||(this.props.items.length>0?0:-1),isCreating:!1,isDeleting:!1,showDeleteConfirmation:!1}}componentDidUpdate(e){this.props.items.length!==e.items.length&&this.cancelRemoval()}onSelectItem=e=>{this.setState({selectedIndex:e})};onDeleteInProgress=e=>{this.setState({isDeleting:e})};onCreateItem=e=>{this.setState({isCreating:!0}),"function"==typeof this.props.onCreateItem&&this.props.onCreateItem(e)};onCancelCreate=e=>{this.setState({isCreating:!1}),"function"==typeof this.props.onCancelCreateItem&&this.props.onCancelCreateItem()};considerRemovingItem=()=>{this.setState({showDeleteConfirmation:!0})};onRemove=e=>{"function"==typeof this.props.onRemove&&(this.props.onRemove(e),this.setState({showDeleteConfirmation:!1,isDeleting:!1}))};cancelRemoval=()=>{this.setState({showDeleteConfirmation:!1})};renderContentElement=(e,t,n,i)=>{if(!e||t)return i(n);const s=e&&n&&function(e,t){let n=!1;const i={...t};for(const s of Object.keys(t)){const o=t[s];o.toLowerCase().includes(e)&&(i[s]=(0,c.CH)(o,e),n=!0)}return n?i:null}(e,n);return e&&!s?null:i(s||n)};render(){const{items:e,masterLayout:t}=this.props,n=this.state.selectedIndex,i=null!=n&&e[n];let s;const l=this.props.title||this.props.subtitle||"",g=l.toLowerCase().includes(this.props.filter)?"":this.props.filter,m=!g||e.some((e=>"string"==typeof e.name&&e.name.toLowerCase().includes(g)));if((this.state.isCreating||this.props.isCreating)&&this.props.renderCreate?s=this.renderContentElement(g,m,this.props.createStrings?this.props.createStrings:this.props.contentStrings,this.props.renderCreate.bind(this)):i?s=this.renderContentElement(g,m,this.props.contentStrings,this.props.renderContent.bind(this,n)):this.props.renderEmpty&&(s=this.renderContentElement(g,m,this.props.emptyStrings?this.props.emptyStrings:this.props.contentStrings,this.props.renderEmpty.bind(this))),!s&&!m)return null;const{className:f=""}=this.props;return p("div",{"data-anchor":this.props.dataAnchor,className:f+" master-detail-wrapper"},void 0,this.props.title&&p("h2",{},void 0,(0,c.CH)(this.props.title,this.props.filter)),this.props.subtitle&&p("h3",{},void 0,(0,c.CH)(this.props.subtitle,this.props.filter)),p("div",{className:f+" master-detail"},void 0,this.state.showDeleteConfirmation&&i&&this.props.deleteDialog&&p(o.Z,{onRequestClose:this.cancelRemoval,className:"float",ignoreClickOutside:this.state.isDeleting,ignoreEscape:this.state.isDeleting,style:h,label:l},void 0,this.props.deleteDialog({item:i,onClose:this.cancelRemoval,onDeleteInProgress:this.onDeleteInProgress})),this.state.showDeleteConfirmation&&i&&this.props.deleteTitle&&p(o.Z,{onRequestClose:this.cancelRemoval,className:"float",title:this.props.deleteTitle},void 0,p("div",{className:"dialog-content"},void 0,p("p",{className:"error"},void 0,this.props.deleteLabel," ",(0,r.Z)("Are you sure you would like to delete “$1”?",[i.label||i.name]))),p("footer",{className:"dialog-footer"},void 0,p("input",{type:"button",className:"danger",value:(0,r.Z)("verb","Delete"),onClick:()=>this.onRemove(n)}),p("input",{type:"button",value:(0,r.Z)("Cancel"),autoFocus:!0,onClick:this.cancelRemoval}))),p("div",{className:d()({master:!0,"master-layout-double":0===t,"master-layout-single":1===t})},void 0,(0,u.jsx)(a.Z,{ref:this.refSortable,items:e,emptyListGraphic:this.props.emptyListGraphic,emptyListString:this.props.emptyListString,renderListItem:this.props.renderListItem,onSelectItem:this.onSelectItem,onCreateItem:this.onCreateItem,isCreating:this.props.isCreating,moveItem:this.props.moveItem,onRemove:this.props.onRemove,filter:this.props.filter,selectedIndex:this.state.selectedIndex,onContextMenu:this.props.onContextMenu,onActivate:this.props.onActivate,onCancelCreate:this.onCancelCreate,addTipString:this.props.addTipString,considerRemovingItem:this.considerRemovingItem,deleteTipString:this.props.deleteTipString,supportDragAndDrop:this.props.supportDragAndDrop,disableAutoFocus:this.props.disableAutoFocus,mimeType:this.props.mimeType?this.props.mimeType.toString():void 0,renderCreateListItem:this.props.renderCreateListItem})),s))}}const m=g},4949:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var i=n(67294),s=n(94283),o=n(48521);class a extends i.Component{static contextType=s.Z;nodeRef=i.createRef();componentDidMount(){this.getRadios().forEach((e=>{e.name=this.props.name,e.addEventListener("change",this.props.onChange)})),this.setCheckedDisabledRadio(this.props)}setCheckedDisabledRadio=e=>{this.getRadios().forEach((t=>{t.value===e.value.toString()&&(t.checked=!0),t.disabled=Boolean(e.disabled)}))};componentDidUpdate(e){e.value===this.props.value&&e.disabled===this.props.disabled||this.setCheckedDisabledRadio(this.props)}componentWillUnmount(){this.getRadios().forEach((e=>{e.removeEventListener("change",this.props.onChange)}))}getRadios=()=>{const{HTMLInputElement:e}=this.context,t=this.nodeRef.current,n=[];if(t){t.querySelectorAll('input[type="radio"]').forEach((t=>{t instanceof e&&n.push(t)}))}return n};render(){return(0,o.jsx)("div",{ref:this.nodeRef,className:this.props.className,children:this.props.children})}}const r=a},33349:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var i,s=n(67294),o=n(48521);function a(e,t,n,s){i||(i="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=s;else if(a>1){for(var r=new Array(a),l=0;l<a;l++)r[l]=arguments[l+3];t.children=r}if(t&&o)for(var d in o)void 0===t[d]&&(t[d]=o[d]);else t||(t=o||{});return{$$typeof:i,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const r=(0,s.forwardRef)(((e,t)=>{const{children:n,...i}=e;return a("span",{className:"select-wrapper"},void 0,(0,o.jsx)("select",{...i,ref:t,children:n}))}))},69697:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var i=n(67294),s=n(94283),o=n(94184),a=n.n(o),r=n(4027),l=n(48521);class d extends i.Component{static contextType=s.Z;static defaultProps={offset:0};#ei=i.createRef();componentDidMount=()=>{const e=this.#ei.current;e&&(e.addEventListener("pointerdown",this.handlePointerDown,!0),e.addEventListener("pointerup",this.handlePointerUp,!0),e.addEventListener("pointercancel",this.handleStop,!0))};componentWillUnmount=()=>{const e=this.#ei.current;e&&(e.removeEventListener("pointerdown",this.handlePointerDown,!0),e.removeEventListener("pointerup",this.handlePointerUp,!0),e.removeEventListener("pointercancel",this.handleStop,!0))};handleDoubleClick=e=>{this.props.onDoubleClick&&(this.props.onDoubleClick(),e.stopPropagation())};handlePointerDown=e=>{e.preventDefault(),e.button===r.Z.kLeft&&(e.currentTarget.setPointerCapture(e.pointerId),r.Z.setWebviewPointerEvents(!1,this.context.document),e.currentTarget.addEventListener("pointermove",this.handlePointerMove,!0),this.props.onStart&&this.props.onStart())};handlePointerUp=e=>{e.button===r.Z.kCenter?this.handleDoubleClick(e):this.handleStop(e)};handlePointerMove=e=>{if(!e.buttons)return void this.handleStop(e);const t=this.props.returnOffset?e.movementX:e.pageX+(this.props.offset||0),n=this.props.returnOffset?e.movementY:e.pageY+(this.props.offset||0);this.context.requestAnimationFrame((()=>{this.props.onSlidebarPosition(t,n,e)}))};handleStop=({currentTarget:e,pointerId:t})=>{e.releasePointerCapture(t),r.Z.setWebviewPointerEvents(!0,this.context.document),e.removeEventListener("pointermove",this.handlePointerMove,!0),this.props.onStop&&this.props.onStop()};render(){const{position:e}=this.props,t="left"===e||"right"===e?"SlideBar--FullHeight":"SlideBar--FullWidth",n="right"===e||"bottom"===e;return(0,l.jsx)("button",{type:"button",tabIndex:"-1",ref:this.#ei,style:this.props.style,onClick:e=>e.stopPropagation(),onDoubleClick:this.handleDoubleClick,className:a()("SlideBar",this.props.className,t,{alternate:n})})}}const c=d},56551:(e,t,n)=>{"use strict";n.d(t,{Z:()=>y});var i,s=n(67294),o=n(84451),a=n(94283),r=n(56371),l=n(94184),d=n.n(l),c=n(1407),u=n(67074),p=n(13302),h=n(86088),g=n(48521),m=n(34155);function f(e,t,n,s){i||(i="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=s;else if(a>1){for(var r=new Array(a),l=0;l<a;l++)r[l]=arguments[l+3];t.children=r}if(t&&o)for(var d in o)void 0===t[d]&&(t[d]=o[d]);else t||(t=o||{});return{$$typeof:i,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class v extends s.Component{static contextType=a.Z;dropSupport=!1;moveUpCombo=(0,p.$)("alt+up");moveDownCombo=(0,p.$)("alt+down");refItems=s.createRef();constructor(e){super(e),this.state={selectedIndex:this.props.selectedIndex||(this.props.items.length>0?0:-1),isCreating:!1,dragIndex:-1,dropIndex:-1,dropPosition:""}}componentWillUnmount(){this.clearDndTimer()}componentDidUpdate(e){if(e.items.length!==this.props.items.length){let t=-1;if(this.props.items.length>0)if(0===e.items.length)t=0;else if(this.props.items.length>e.items.length){const n=this.props.items.filter((({key:t})=>!e.items.some((({key:e})=>e===t))));t=this.props.items.indexOf(n[0])}else-1!==this.state.selectedIndex&&(t=Math.min(this.state.selectedIndex,this.props.items.length-1),this.props.disableAutoFocus||t!==this.props.items.length-1||this.focusItem(t));this.setSelected(t,!1)}e.isCreating!==this.props.isCreating&&this.props.isCreating&&this.setIsCreating()}setSelected=(e,t)=>{void 0!==t&&(this.setState({isCreating:this.props.onCancelCreate&&t}),t&&this.props.onCreateItem?this.props.onCreateItem():!t&&this.props.onCancelCreate&&this.props.onCancelCreate()),this.setState({selectedIndex:e}),"function"==typeof this.props.onSelectItem&&this.props.onSelectItem(e)};loadItemAt=e=>{this.setSelected(e),m.nextTick((()=>{const e=this.refItems.current;if(e){const t=e.querySelector(".item-selected");t&&!this.props.disableAutoFocus&&t.focus()}}))};setIsCreating=()=>{this.setSelected(this.props.items.length,!0),m.nextTick((()=>{const e=this.refItems.current;e&&(e.scrollTop=e.scrollHeight)}))};removeItem=e=>{e>=this.props.items.length?("function"==typeof this.props.onCancelCreate&&this.props.onCancelCreate(),this.setSelected(this.props.items.length-1,!1)):"function"==typeof this.props.considerRemovingItem?this.props.considerRemovingItem():"function"==typeof this.props.onRemove&&this.props.onRemove(this.state.selectedIndex)};moveDown=()=>{this.props.moveItem&&this.props.items&&this.props.items.length>1&&this.state.selectedIndex+1<this.props.items.length&&(this.props.moveItem(this.state.selectedIndex,this.state.selectedIndex+1),this.loadItemAt(this.state.selectedIndex+1))};moveUp=()=>{this.props.moveItem&&this.props.items&&this.props.items.length>1&&this.state.selectedIndex>0&&(this.props.moveItem(this.state.selectedIndex,this.state.selectedIndex-1),this.loadItemAt(this.state.selectedIndex-1))};focusItem=(e,t)=>{if(this.state.isCreating||this.props.isCreating)return;this.state.selectedIndex!==e&&this.loadItemAt(e);const n=this.refItems.current;n&&!this.props.disableAutoFocus&&n.focus(),t&&t.stopPropagation()};onDoubleClick=(e,t)=>{this.props.onActivate&&this.props.onActivate(e,t),t.stopPropagation()};clearDndTimer=()=>{this.dndTimerId&&(clearTimeout(this.dndTimerId),delete this.dndTimerId)};onDragStartButton=(e,t)=>{this.props.supportDragAndDrop&&this.props.mimeType&&(t.dataTransfer.effectAllowed="move",t.dataTransfer.setData(this.props.mimeType,e),this.setState({dragIndex:e}))};onDragEnter=e=>{this.props.supportDragAndDrop&&this.props.mimeType&&(e.preventDefault(),e.stopPropagation(),this.dropSupport=e.dataTransfer.types.some((e=>e===this.props.mimeType)),e.dataTransfer.dropEffect=this.dropSupport?"move":"none")};onDragLeave=e=>{this.props.supportDragAndDrop&&(e.preventDefault(),e.stopPropagation(),this.clearDndTimer(),this.dndTimerId=setTimeout((()=>{delete this.dndTimerId,this.setState({dropIndex:-1,dropPosition:""})}),c._p))};getDropPosition=e=>{let t=0;const n=e.currentTarget.getBoundingClientRect(),i=n.height;return t=(e.clientY-n.top)/i,t<=.5?"above":"below"};onDragOverButton=(e,t)=>{if(t.preventDefault(),t.stopPropagation(),this.dropSupport){t.dataTransfer.dropEffect="move",this.clearDndTimer();const n=this.getDropPosition(t);this.state.dropIndex===e&&this.state.dropPosition===n||this.setState({dropIndex:e,dropPosition:n})}};onDragOver=e=>{if(e.preventDefault(),e.stopPropagation(),this.dropSupport){e.dataTransfer.dropEffect="move",this.clearDndTimer();const t=this.props.items.length>0?this.props.items.length-1:0,n="below";this.state.dropIndex===t&&this.state.dropPosition===n||this.setState({dropIndex:t,dropPosition:n})}};onDropButton=(e,t)=>{if(t.preventDefault(),t.stopPropagation(),this.dropSupport&&this.props.mimeType){const n=Number(t.dataTransfer.getData(this.props.mimeType));if(void 0!==n){let i=e+("below"===this.getDropPosition(t)?1:0);n<i&&(i-=1),this.props.moveItem&&(this.props.moveItem(n,i),this.loadItemAt(i))}}this.onDragEnd()};onDrop=e=>{if(e.preventDefault(),e.stopPropagation(),this.dropSupport&&this.props.mimeType){const t=Number(e.dataTransfer.getData(this.props.mimeType));if(void 0!==t){let e=this.props.items.length;t<e&&(e-=1),this.props.moveItem&&(this.props.moveItem(t,e),this.loadItemAt(e))}}this.onDragEnd()};onDragEnd=()=>{this.setState({dragIndex:-1,dropIndex:-1,dropPosition:""})};onKeyDown=e=>{const t=o.Z.keyComboFromEvent(e.nativeEvent);if("tab"!==t&&this.props.items&&this.props.items.length>0){let n=!0;const i=this.props.items.length;switch(t){case"up":this.loadItemAt(this.state.selectedIndex<=0?i-1:this.state.selectedIndex-1);break;case"down":this.loadItemAt(this.state.selectedIndex+1>=i?0:this.state.selectedIndex+1);break;case"del":case"backspace":this.removeItem(this.state.selectedIndex);break;case"home":this.loadItemAt(0);break;case"end":this.loadItemAt(i-1);break;case"alt+up":this.moveUp();break;case"alt+down":this.moveDown();break;case"enter":case"space":this.props.onActivate&&(this.props.onActivate(this.state.selectedIndex,e),n=!1);break;default:n=!1}n&&e.preventDefault()}};getButtonClassByIndex=e=>d()({item:!0,"item-is-static":this.props.items[e].isStatic,"item-default":this.props.items[e].isDefault,"item-selected":e===this.state.selectedIndex&&!(this.state.isCreating||this.props.isCreating),"item-dragged":this.state.selectedIndex===e&&this.state.dragIndex===e,dragoverAbove:e===this.state.dropIndex&&"above"===this.state.dropPosition,dragoverBelow:e===this.state.dropIndex&&"below"===this.state.dropPosition});#ti(){const e=this.props.renderCreateListItem?.();return e?f("button",{className:"item item-selected"},void 0,e):null}render(){const{items:e,filter:t,emptyListGraphic:n,emptyListString:i}=this.props,{selectedIndex:s}=this.state,o=this.state.isCreating||this.props.isCreating,a=null!=s&&e[s],l=!!a&&e[s].isDefault,d=0===e.length&&!o,c=e[s]?.isStatic,p=0!==e.length&&e[s-1]?.isStatic,m=e.length<s+1&&e[s+1]?.isStatic;return f("div",{className:"master-detail sortable-list"},void 0,(0,g.jsxs)("div",{ref:this.refItems,className:"master-items",onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave,onDragOver:this.onDragOver,onDrop:this.onDrop,onKeyDown:this.onKeyDown,tabIndex:d?-1:0,children:[d&&n&&i&&f("div",{className:"master-items-empty",dangerouslySetInnerHTML:{__html:`${n}<div>${i}</div>`}}),e.map(((e,n)=>f("button",{type:"button",title:e.label,className:this.getButtonClassByIndex(n),tabIndex:-1,draggable:this.props.supportDragAndDrop,onContextMenu:this.props.onContextMenu?this.props.onContextMenu.bind(this,n):null,onDragStart:this.onDragStartButton.bind(this,n),onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave,onDragOver:this.onDragOverButton.bind(this,n),onDrop:this.onDropButton.bind(this,n),onDragEnd:this.onDragEnd,onMouseDown:this.focusItem.bind(this,n),onDoubleClick:this.onDoubleClick.bind(this,n)},n,this.props.renderListItem((0,u.CH)(e.name,t),e)))),o&&this.#ti()]}),(this.props.optionsList||this.props.onRemove||this.props.moveItem)&&f("div",{className:"master-toolbar"},void 0,this.props.optionsList&&f("select",{className:"button-toolbar sortable-list-options",onChange:this.props.onCreateItem,title:this.props.addTipString,defaultValue:null},void 0,this.props.optionsList&&this.props.optionsList.map((e=>f("option",{value:e.key},e.key,e.value,""!==e.key&&` [${e.key}]`)))),this.props.onCreateItem&&f("button",{className:"button-toolbar",style:this.props.optionsList?{pointerEvents:"none"}:null,tabIndex:this.props.optionsList?-1:null,title:this.props.addTipString,onClick:this.setIsCreating,disabled:this.props.onCancelCreate&&o,dangerouslySetInnerHTML:{__html:h.md4.medium}}),this.props.onRemove&&f("button",{className:"button-toolbar",title:this.props.deleteTipString,onClick:this.removeItem.bind(this,s),disabled:!o&&e.length<1||l||c||a&&!1===e[s].isRemovable,dangerouslySetInnerHTML:{__html:h.M2k.medium}}),this.props.moveItem&&(0,g.jsxs)(g.Fragment,{children:[f("button",{className:"button-toolbar button-move-up",title:(0,r.Z)("Move Up ($1)",[this.moveUpCombo]),onClick:this.moveUp,disabled:c||p,dangerouslySetInnerHTML:{__html:h.OCp.medium}}),f("button",{className:"button-toolbar button-move-down",title:(0,r.Z)("Move Down ($1)",[this.moveDownCombo]),onClick:this.moveDown,disabled:c||m,dangerouslySetInnerHTML:{__html:h.yaZ.medium}})]})))}}const y=v},72882:(e,t,n)=>{"use strict";n.d(t,{Z:()=>ue});var i=n(25795),s=n(19718),o=n(76747),a=n(56371),r=n(26036);const l={actions:function(){return["DOCUMENT_CONTAINER_AV","DOCUMENT_CONTAINER_EXTENSIONS"].concat(s.Z.actions())},options:function(e,t,n){const l=void 0===n,d={...o.Z.commandItem};switch(t.action){case"DOCUMENT_CONTAINER_AV":return d.settingsLabel=(0,a.Z)("[Media Controls]"),d.type="container",{...d,...(0,r.Z)("Media Controls")};case"DOCUMENT_CONTAINER_EXTENSIONS":return d.settingsLabel=(0,a.Z)("[Extensions]"),d.type="container",{...d,...(0,r.Z)("Extensions")};default:return s.Z.actions().includes(t.action)?s.Z.options(e,t,n):i.Z.getMenuItem(e,t,l)}}};const d={actions:function(){return["CONTEXT_OPEN_IN_NEW_TAB","CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB","CONTEXT_OPEN_IN_TAB","CONTEXT_OPEN_IN_NEW_WINDOW","CONTEXT_OPEN_IN_PRIVATE_WINDOW","CONTEXT_CONTAINER_OPEN_IN_WINDOW","CONTEXT_BOOKMARK","CONTEXT_NEW_BOOKMARK","CONTEXT_NEW_FOLDER","CONTEXT_NEW_SEPARATOR","CONTEXT_EDIT","CONTEXT_RENAME","CONTEXT_CUT","CONTEXT_COPY","CONTEXT_PASTE","CONTEXT_DELETE"]},options:function(e,t,n){const s=void 0===n,l={...o.Z.commandItem};switch(t.action){case"CONTEXT_OPEN_IN_NEW_TAB":return{...l,...(0,r.Z)("Open in New Tab")};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{...l,...(0,r.Z)("Open in Background Tab")};case"CONTEXT_OPEN_IN_TAB":return{...l,...(0,r.Z)("Open")};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{...l,...(0,r.Z)("Open in New Window")};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{...l,...(0,r.Z)("Open in Private Window")};case"CONTEXT_CONTAINER_OPEN_IN_WINDOW":return l.settingsLabel=(0,a.Z)("[Open in Another Window]"),l.type="container",{...l,...(0,r.Z)("Open in Another Window")};case"CONTEXT_BOOKMARK":return{...l,...(0,r.Z)("Add Active Tab")};case"CONTEXT_NEW_BOOKMARK":return{...l,...(0,r.Z)("New Bookmark")};case"CONTEXT_NEW_FOLDER":return{...l,...(0,r.Z)("command","New Folder")};case"CONTEXT_NEW_SEPARATOR":return{...l,...(0,r.Z)("New Separator")};case"CONTEXT_EDIT":return{...l,...(0,r.Z)("command","Edit")};case"CONTEXT_RENAME":return{...l,...(0,r.Z)("Rename")};case"CONTEXT_CUT":return{...l,...(0,r.Z)("win_linux","Cut")};case"CONTEXT_COPY":return{...l,...(0,r.Z)("win_linux","Copy")};case"CONTEXT_PASTE":return{...l,...(0,r.Z)("win_linux","Paste")};case"CONTEXT_DELETE":return{...l,...(0,r.Z)("other","Delete")};default:return i.Z.getMenuItem(e,t,s)}}};const c={actions:function(){return["CONTEXT_BOOKMARK","CONTEXT_NEW_BOOKMARK","CONTEXT_NEW_FOLDER","CONTEXT_NEW_SEPARATOR","CONTEXT_PASTE","CONTEXT_CONTAINER_SORT"]},options:function(e,t,n){const s=void 0===n,l={...o.Z.commandItem};switch(t.action){case"CONTEXT_BOOKMARK":return{...l,...(0,r.Z)("Add Active Tab")};case"CONTEXT_NEW_BOOKMARK":return{...l,...(0,r.Z)("New Bookmark")};case"CONTEXT_NEW_FOLDER":return{...l,...(0,r.Z)("command","New Folder")};case"CONTEXT_NEW_SEPARATOR":return{...l,...(0,r.Z)("New Separator")};case"CONTEXT_PASTE":return{...l,...(0,r.Z)("win_linux","Paste")};case"CONTEXT_CONTAINER_SORT":return l.settingsLabel=(0,a.Z)("[Sort Options]"),l.type="container",{...l,...(0,r.Z)("Sort")};default:return i.Z.getMenuItem(e,t,s)}}};const u={actions:function(){return["CONTEXT_OPEN_IN_NEW_TAB","CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB","CONTEXT_OPEN_IN_TAB","CONTEXT_OPEN_IN_NEW_WINDOW","CONTEXT_OPEN_IN_PRIVATE_WINDOW","CONTEXT_CONTAINER_OPEN_IN_WINDOW","CONTEXT_SET_SPEEDDIAL","CONTEXT_UNSET_SPEEDDIAL","CONTEXT_SET_BOOKMARK_BAR","CONTEXT_UNSET_BOOKMARK_BAR","CONTEXT_MOVE_TO_BOOKMARK_BAR","CONTEXT_BOOKMARK","CONTEXT_BOOKMARK_ALL","CONTEXT_NEW_ITEM","CONTEXT_NEW_FOLDER","CONTEXT_NEW_SEPARATOR","CONTEXT_RENAME","CONTEXT_CUT","CONTEXT_COPY","CONTEXT_PASTE","CONTEXT_DELETE","CONTEXT_EXPAND_ALL","CONTEXT_COLLAPSE_ALL","CONTEXT_IMPORT","CONTEXT_SETTINGS","CONTEXT_CONTAINER_SEARCH"]},options:function(e,t,n){const s=void 0===n,l={...o.Z.commandItem};switch(t.action){case"CONTEXT_OPEN_IN_NEW_TAB":return{...l,...(0,r.Z)("Open in New Tab")};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{...l,...(0,r.Z)("Open in Background Tab")};case"CONTEXT_OPEN_IN_TAB":return{...l,...(0,r.Z)("Open")};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{...l,...(0,r.Z)("Open in New Window")};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{...l,...(0,r.Z)("Open in Private Window")};case"CONTEXT_CONTAINER_OPEN_IN_WINDOW":return l.settingsLabel=(0,a.Z)("[Open in Another Window]"),l.type="container",{...l,...(0,r.Z)("Open in Another Window")};case"CONTEXT_SET_SPEEDDIAL":return{...l,...(0,r.Z)("Use as Speed Dial")};case"CONTEXT_UNSET_SPEEDDIAL":return{...l,...(0,r.Z)("Remove from Speed Dial")};case"CONTEXT_SET_BOOKMARK_BAR":return{...l,...(0,r.Z)("Set as Bookmark Bar Folder")};case"CONTEXT_UNSET_BOOKMARK_BAR":return{...l,...(0,r.Z)("Remove as Bookmark Bar Folder")};case"CONTEXT_MOVE_TO_BOOKMARK_BAR":return{...l,...(0,r.Z)("Move to Bookmark Bar Folder")};case"CONTEXT_BOOKMARK":return{...l,...(0,r.Z)("Bookmark Active Page")};case"CONTEXT_BOOKMARK_ALL":return{...l,...(0,r.Z)("Bookmark All Open Pages")};case"CONTEXT_NEW_ITEM":return{...l,...(0,r.Z)("New Bookmark")};case"CONTEXT_NEW_FOLDER":return{...l,...(0,r.Z)("command","New Folder")};case"CONTEXT_NEW_SEPARATOR":return{...l,...(0,r.Z)("New Separator")};case"CONTEXT_RENAME":return{...l,...(0,r.Z)("Rename")};case"CONTEXT_CUT":return{...l,...(0,r.Z)("verb","Cut")};case"CONTEXT_COPY":return{...l,...(0,r.Z)("verb","Copy")};case"CONTEXT_PASTE":return{...l,...(0,r.Z)("verb","Paste")};case"CONTEXT_DELETE":return{...l,...(0,r.Z)("verb","Delete")};case"CONTEXT_EMPTY_TRASH":return{...l,...(0,r.Z)("Empty Trash")};case"CONTEXT_EXPAND_ALL":return{...l,...(0,r.Z)("Expand All Folders")};case"CONTEXT_COLLAPSE_ALL":return{...l,...(0,r.Z)("Collapse All Folders")};case"CONTEXT_IMPORT":return l.ellipsis=!0,{...l,...(0,r.Z)("Import Bookmarks")};case"CONTEXT_SETTINGS":return l.type="folder",{...l,...(0,r.Z)("Settings")};case"CONTEXT_CONTAINER_SEARCH":return l.settingsLabel=(0,a.Z)("[Search Settings]"),l.type="container",{...l,...(0,r.Z)("command","Search")};default:return i.Z.getMenuItem(e,t,s)}}};const p={actions:function(){return["CONTEXT_CONTAINER_CLOSED_TAB"]},options:function(e,t,n){const s=void 0===n,l={...o.Z.commandItem};return"CONTEXT_CONTAINER_CLOSED_TAB"===t.action?(l.settingsLabel=(0,a.Z)("[All Closed Tabs]"),l.type="container",{...l,...(0,r.Z)("Closed Tabs")}):i.Z.getMenuItem(e,t,s)}};const h={actions:function(){return["CONTEXT_COMPOSE_MAIL","CONTEXT_VIEW_ALL_MESSAGES","CONTEXT_NEW_ITEM","CONTEXT_EDIT","CONTEXT_DELETE","CONTEXT_CONTAINER_DEFAULT_ACTION"]},options:function(e,t,n){const s=void 0===n,l={...o.Z.commandItem};switch(t.action){case"CONTEXT_COMPOSE_MAIL":return{...l,...(0,r.Z)("Compose Mail")};case"CONTEXT_VIEW_ALL_MESSAGES":return{...l,...(0,r.Z)("View All Messages")};case"CONTEXT_NEW_ITEM":return{...l,...(0,r.Z)("New Contact")};case"CONTEXT_EDIT":return{...l,...(0,r.Z)("command","Edit")};case"CONTEXT_DELETE":return{...l,...(0,r.Z)("verb","Delete")};case"CONTEXT_CONTAINER_DEFAULT_ACTION":return l.settingsLabel=(0,a.Z)("[Default Action]"),l.type="container",{...l,...(0,r.Z)("Default Action")};default:return i.Z.getMenuItem(e,t,s)}}};var g=n(30992);const m={actions:function(){return["DOCUMENT_SUGGEST_PASSWORD","DOCUMENT_SHOW_PASSWORDS","DOCUMENT_LOOK_UP","DOCUMENT_EMOJI","DOCUMENT_UNDO","DOCUMENT_REDO","DOCUMENT_CUT","DOCUMENT_COPY","DOCUMENT_PASTE","DOCUMENT_PASTE_AS_PLAIN_TEXT","DOCUMENT_SELECT_ALL","DOCUMENT_ADD_AS_SEARCH_ENGINE","COMMAND_COPY_SELECTION_TO_NOTE","COMMAND_APPEND_SELECTION_TO_NOTE","DOCUMENT_GOTO_URL","DOCUMENT_CONTAINER_NOTES","DOCUMENT_SEARCH","DOCUMENT_SEARCH_LAST_USED","DOCUMENT_CONTAINER_SEARCH_WITH","DOCUMENT_CONTAINER_EXTENSIONS","DOCUMENT_CONTAINER_SPELLCHECK","DOCUMENT_CONTAINER_SPELLCHECK_OPTIONS","DOCUMENT_CONTAINER_SPEECH"].concat(s.Z.actions())},options:function(e,t,n){const l=void 0===n,d=n||g.Z.settingsState,c={...o.Z.commandItem};switch(t.action){case"DOCUMENT_SUGGEST_PASSWORD":return c.ellipsis=!0,{...c,...(0,r.Z)("Suggest Password")};case"DOCUMENT_SHOW_PASSWORDS":return c.ellipsis=!0,{...c,...(0,r.Z)("Show all Saved Passwords")};case"DOCUMENT_LOOK_UP":case"DOCUMENT_SEARCH":case"DOCUMENT_SEARCH_LAST_USED":return{...c,...g.Z.getLabelWithParameter(e,t,d.printableselection,l)};case"DOCUMENT_EMOJI":return{...c,...(0,r.Z)("Emoji && Symbols")};case"DOCUMENT_UNDO":return{...c,shortcuts:["ctrl+z"],...(0,r.Z)("win_linux","Undo")};case"DOCUMENT_REDO":return{...c,shortcuts:["ctrl+y"],...(0,r.Z)("win_linux","Redo")};case"DOCUMENT_CUT":return{...c,shortcuts:["ctrl+x"],...(0,r.Z)("win_linux","Cut")};case"DOCUMENT_COPY":return{...c,shortcuts:["ctrl+c"],...(0,r.Z)("win_linux","Copy")};case"DOCUMENT_PASTE":return{...c,shortcuts:["ctrl+v"],...(0,r.Z)("win_linux","Paste")};case"DOCUMENT_PASTE_AS_PLAIN_TEXT":{const t=g.Z.getShortcuts(e,"COMMAND_CLIPBOARD_PASTE_AS_PLAIN_TEXT");return{...c,shortcuts:t,...(0,r.Z)("win_linux","Paste as Plain Text")}}case"DOCUMENT_SELECT_ALL":return{...c,shortcuts:["ctrl+a"],...(0,r.Z)("win_linux","Select All")};case"DOCUMENT_GOTO_URL":return{...c,...g.Z.getLabelWithParameter(e,t,d.selectionurl,l)};case"DOCUMENT_ADD_AS_SEARCH_ENGINE":return c.ellipsis=!0,{...c,...(0,r.Z)("Add as Search Engine")};case"COMMAND_COPY_SELECTION_TO_NOTE":return{...i.Z.getMenuItem(e,t,l),...(0,r.Z)("Copy to Note")};case"COMMAND_APPEND_SELECTION_TO_NOTE":return{...i.Z.getMenuItem(e,t,l),...(0,r.Z)("Append to Note")};case"DOCUMENT_CONTAINER_NOTES":return c.settingsLabel=(0,a.Z)("[All notes]"),c.type="container",{...c,...(0,r.Z)("Insert Note")};case"DOCUMENT_CONTAINER_SEARCH_WITH":return c.settingsLabel=(0,a.Z)("[All search engines]"),c.type="container",{...c,...(0,r.Z)("Search With")};case"DOCUMENT_CONTAINER_EXTENSIONS":return c.settingsLabel=(0,a.Z)("[Extensions]"),c.type="container",{...c,...(0,r.Z)("Extensions")};case"DOCUMENT_CONTAINER_SPELLCHECK":return c.settingsLabel=(0,a.Z)("[Spell Check]"),c.type="container",{...c,...(0,r.Z)("Spell Check")};case"DOCUMENT_CONTAINER_SPELLCHECK_OPTIONS":return c.settingsLabel=(0,a.Z)("[Spell Check Options]"),c.type="container",{...c,...(0,r.Z)("Spell Check Options")};case"DOCUMENT_CONTAINER_WRITING_DIRECTION":return c.settingsLabel=(0,a.Z)("[Writing Direction Options]"),c.type="container",{...c,...(0,r.Z)("Writing Direction")};case"DOCUMENT_CONTAINER_SPEECH":return c.settingsLabel=(0,a.Z)("[Speech Commands]"),c.type="container",{...c,...(0,r.Z)("Speech")};default:return s.Z.actions().includes(t.action)?s.Z.options(e,t,n):i.Z.getMenuItem(e,t,l)}}};const f={actions:function(){return["CONTEXT_OPEN_FILE","CONTEXT_OPEN_IN_NEW_TAB","CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB","CONTEXT_OPEN_IN_TAB","CONTEXT_OPEN_IN_NEW_WINDOW","CONTEXT_OPEN_IN_PRIVATE_WINDOW","CONTEXT_FILEMANAGER","CONTEXT_COPY_ADDRESS","CONTEXT_COPY_PATH","CONTEXT_RESTART","CONTEXT_STOP","CONTEXT_RESUME","CONTEXT_REMOVE","CONTEXT_REMOVE_ALL_FINISHED"]},options:function(e,t,n){const s=void 0===n,a=n||{numAddresses:1,numFiles:1,numImages:1,hasActive:!1,hasPaused:!1,hasCompleted:!1},l={...o.Z.commandItem};switch(t.action){case"CONTEXT_OPEN_FILE":return{...l,...s||a.numFiles<2?(0,r.Z)("the file","Open"):(0,r.Z)("Open Files")};case"CONTEXT_OPEN_IN":return l.type="folder",{...l,...s||a.numFiles<2?(0,r.Z)("Open Image in"):(0,r.Z)("Open Images in")};case"CONTEXT_OPEN_IN_NEW_TAB":return{...l,...(0,r.Z)("open in","New Tab")};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{...l,...(0,r.Z)("Background Tab")};case"CONTEXT_OPEN_IN_TAB":return{...l,...(0,r.Z)("Current Tab")};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{...l,...(0,r.Z)("open in","New Window")};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{...l,...(0,r.Z)("open in","Private Window")};case"CONTEXT_FILEMANAGER":return{...l,...(0,r.Z)("Show in File Manager")};case"CONTEXT_COPY_ADDRESS":return{...l,...s||a.numAddresses<2?(0,r.Z)("Copy Download Address"):(0,r.Z)("Copy Download Addresses")};case"CONTEXT_COPY_PATH":return{...l,...s||a.numFiles<2?(0,r.Z)("Copy Local Path"):(0,r.Z)("Copy Local Paths")};case"CONTEXT_RESTART":return{...l,...(0,r.Z)("command","Restart")};case"CONTEXT_STOP":return{...l,...(0,r.Z)("other","Stop")};case"CONTEXT_RESUME":return{...l,...(0,r.Z)("Resume Download")};case"CONTEXT_REMOVE":return{...l,...(0,r.Z)("verb","Remove")};case"CONTEXT_REMOVE_ALL_FINISHED":return{...l,...(0,r.Z)("Remove All Finished")};default:return i.Z.getMenuItem(e,t,s)}}};const v={actions:function(){return["CONTEXT_OPEN_IN_NEW_TAB","CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB","CONTEXT_OPEN_IN_TAB","CONTEXT_OPEN_IN_NEW_WINDOW","CONTEXT_OPEN_IN_PRIVATE_WINDOW","CONTEXT_CONTAINER_OPEN_IN_WINDOW","CONTEXT_FILTER_BY","CONTEXT_COPY","CONTEXT_SAVE","CONTEXT_DELETE","CONTEXT_EXPAND_ALL","CONTEXT_COLLAPSE_ALL"]},options:function(e,t,n){const s=n||{address:"",selectedCount:0},l=void 0===n,d={...o.Z.commandItem};switch(t.action){case"CONTEXT_OPEN_IN_NEW_TAB":return{...d,...(0,r.Z)("Open in New Tab")};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{...d,...(0,r.Z)("Open in Background Tab")};case"CONTEXT_OPEN_IN_TAB":return{...d,...(0,r.Z)("Open")};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{...d,...(0,r.Z)("Open in New Window")};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{...d,...(0,r.Z)("Open in Private Window")};case"CONTEXT_CONTAINER_OPEN_IN_WINDOW":return d.settingsLabel=(0,a.Z)("[Open in Another Window]"),d.type="container",{...d,...(0,r.Z)("Open in Another Window")};case"CONTEXT_FILTER_BY":return d.settingsLabel=(0,a.Z)("Filter by Address"),{...d,...l?(0,r.Z)("Filter by Address"):(0,r.Z)("Filter by “$1”",[s.address])};case"CONTEXT_COPY":return{...d,...(0,r.Z)("Copy Address")};case"CONTEXT_SAVE":return{...d,...(0,r.Z)("Save as Bookmark","Save as Bookmarks",[s.selectedCount])};case"CONTEXT_DELETE":return{...d,...(0,r.Z)("verb","Delete")};case"CONTEXT_EXPAND_ALL":return{...d,...(0,r.Z)("Expand All Folders")};case"CONTEXT_COLLAPSE_ALL":return{...d,...(0,r.Z)("Collapse All Folders")};default:return i.Z.getMenuItem(e,t,l)}}};const y={actions:function(){return["DOCUMENT_OPEN_IMAGE_IN_NEW_TAB","DOCUMENT_OPEN_IMAGE_IN_NEW_BACKGROUND_TAB","DOCUMENT_OPEN_IMAGE_IN_TAB","DOCUMENT_OPEN_IMAGE_IN_NEW_WINDOW","DOCUMENT_OPEN_IMAGE_IN_PRIVATE_WINDOW","DOCUMENT_SAVE_IMAGE","DOCUMENT_COPY_IMAGE","DOCUMENT_COPY_IMAGE_ADDRESS","DOCUMENT_SHOW_IMAGE_PROPERTIES","DOCUMENT_USE_IMAGE_AS_STARTPAGE_BACKGROUND","DOCUMENT_RELOAD_IMAGE","DOCUMENT_SEARCH_FOR IMAGE","DOCUMENT_CONTAINER_SEND_TO_DEVICES","DOCUMENT_CONTAINER_OPEN_IMAGE_IN_PROFILE","DOCUMENT_CONTAINER_TEXT_SELECTION","DOCUMENT_CONTAINER_EXTENSIONS"].concat(s.Z.actions())},options:function(e,t,n){const l=void 0===n,d={...o.Z.commandItem};switch(t.action){case"DOCUMENT_OPEN_IMAGE_IN_NEW_TAB":return{...d,...(0,r.Z)("Open Image in New Tab")};case"DOCUMENT_OPEN_IMAGE_IN_NEW_BACKGROUND_TAB":return{...d,...(0,r.Z)("Open Image in Background Tab")};case"DOCUMENT_OPEN_IMAGE_IN_TAB":return{...d,...(0,r.Z)("Open Image")};case"DOCUMENT_OPEN_IMAGE_IN_NEW_WINDOW":return{...d,...(0,r.Z)("Open Image in New Window")};case"DOCUMENT_OPEN_IMAGE_IN_PRIVATE_WINDOW":return{...d,...(0,r.Z)("Open Image in Private Window")};case"DOCUMENT_CONTAINER_OPEN_IMAGE_IN_PROFILE":return d.settingsLabel=(0,a.Z)("[Open Image in Another Profile]"),d.type="container",{...d,...(0,r.Z)("Open Image in Another Profile")};case"DOCUMENT_SAVE_IMAGE":return d.ellipsis=!0,{...d,...(0,r.Z)("Save Image As")};case"DOCUMENT_COPY_IMAGE":return{...d,...(0,r.Z)("Copy Image")};case"DOCUMENT_COPY_IMAGE_ADDRESS":return{...d,...(0,r.Z)("Copy Image Address")};case"DOCUMENT_SHOW_IMAGE_PROPERTIES":return d.ellipsis=!0,{...d,...(0,r.Z)("Image Properties")};case"DOCUMENT_USE_IMAGE_AS_STARTPAGE_BACKGROUND":return{...d,...(0,r.Z)("Use Image as Window Background")};case"DOCUMENT_RELOAD_IMAGE":return{...d,...(0,r.Z)("Reload Image")};case"DOCUMENT_QR_CODE":return{...d,...(0,r.Z)("command","Create QR Code for This Image")};case"DOCUMENT_SEARCH_FOR IMAGE":return{...d,...(0,r.Z)("Search for Image")};case"DOCUMENT_CONTAINER_SEND_TO_DEVICES":return d.settingsLabel=(0,a.Z)("[Send Image to Your Devices]"),d.type="container",{...d,...(0,r.Z)("Send Image to Your Devices")};case"DOCUMENT_CONTAINER_TEXT_SELECTION":return d.settingsLabel=(0,a.Z)("[Selected Text]"),d.type="container",{...d,...(0,r.Z)("Selected Text")};case"DOCUMENT_CONTAINER_EXTENSIONS":return d.settingsLabel=(0,a.Z)("[Extensions]"),d.type="container",{...d,...(0,r.Z)("Extensions")};default:return s.Z.actions().includes(t.action)?s.Z.options(e,t,n):i.Z.getMenuItem(e,t,l)}}};var b=n(15800),S=n(15489);const w={actions:function(){return["DOCUMENT_LOOK_UP","DOCUMENT_COPY","DOCUMENT_CONTAINER_LINK_TO_HIGHLIGHT","COMMAND_COPY_SELECTION_TO_NOTE","COMMAND_APPEND_SELECTION_TO_NOTE","COMMAND_TRANSLATE_SELECTION","DOCUMENT_PRINT","DOCUMENT_GOTO_URL","DOCUMENT_SEARCH","DOCUMENT_SEARCH_LAST_USED","DOCUMENT_CONTAINER_SEARCH_WITH","DOCUMENT_CONTAINER_EXTENSIONS","DOCUMENT_SEND_BY_MAIL","DOCUMENT_ADD_TO_CALENDAR","DOCUMENT_CONTAINER_SPEECH"].concat(s.Z.actions())},options:function(e,t,n){const l=void 0===n,d=n||g.Z.settingsState,c={...o.Z.commandItem};switch(t.action){case"DOCUMENT_LOOK_UP":case"DOCUMENT_SEARCH":case"DOCUMENT_SEARCH_LAST_USED":return{...c,...g.Z.getLabelWithParameter(e,t,d.printableselection,l)};case"DOCUMENT_COPY":return{...c,...(0,r.Z)("command","Copy")};case"DOCUMENT_CONTAINER_LINK_TO_HIGHLIGHT":return c.settingsLabel=(0,a.Z)("[Link to Highlight]"),c.type="container",{...c,...(0,r.Z)("Link to Highlight")};case"COMMAND_COPY_SELECTION_TO_NOTE":return{...i.Z.getMenuItem(e,t,l),...(0,r.Z)("Copy to Note")};case"COMMAND_APPEND_SELECTION_TO_NOTE":return{...i.Z.getMenuItem(e,t,l),...(0,r.Z)("Append to Note")};case"COMMAND_TRANSLATE_SELECTION":return{...i.Z.getMenuItem(e,t,l),...(0,r.Z)("Translate Selection")};case"DOCUMENT_PRINT":return c.ellipsis=!0,{...c,...(0,r.Z)("command","Print")};case"DOCUMENT_GOTO_URL":return{...c,...g.Z.getLabelWithParameter(e,t,d.selectionurl,l)};case"DOCUMENT_CONTAINER_SEARCH_WITH":return c.settingsLabel=(0,a.Z)("[All search engines]"),c.type="container",{...c,...(0,r.Z)("Search With")};case"DOCUMENT_CONTAINER_EXTENSIONS":return c.settingsLabel=(0,a.Z)("[Extensions]"),c.type="container",{...c,...(0,r.Z)("Extensions")};case"DOCUMENT_SEND_BY_MAIL":return{...c,...(0,r.Z)("Send by Mail")};case"DOCUMENT_ADD_TO_CALENDAR":const o=void 0!==b.ZP.getDefaultCalendar(),u=S.ZP.isIncognito(e);return{isVisible:()=>o&&!u,...c,...(0,r.Z)("Add as Calendar Event")};case"DOCUMENT_CONTAINER_SPEECH":return c.settingsLabel=(0,a.Z)("[Speech Commands]"),c.type="container",{...c,...(0,r.Z)("Speech")};default:return s.Z.actions().includes(t.action)?s.Z.options(e,t,n):i.Z.getMenuItem(e,t,l)}}};const C={actions:function(){const e=["DOCUMENT_CONTAINER_EXTENSIONS","DOCUMENT_CONTAINER_DEVELOPER_TOOLS"].concat(s.Z.actions());return["DOCUMENT_OPEN_IN_NEW_TAB","DOCUMENT_OPEN_IN_NEW_BACKGROUND_TAB","DOCUMENT_OPEN_IN_TAB","DOCUMENT_OPEN_IN_NEW_WINDOW","DOCUMENT_OPEN_IN_PRIVATE_WINDOW","DOCUMENT_ADD_LINK_TO_BOOKMARKS","DOCUMENT_ADD_LINK_TO_WEBPANEL","DOCUMENT_ADD_LINK_TO_READING_LIST","DOCUMENT_SAVE_LINK","DOCUMENT_SEND_LINK_BY_MAIL","DOCUMENT_COPY_LINK_ADDRESS","DOCUMENT_COPY_LINK_TEXT","DOCUMENT_CONTAINER_OPEN_IN_PWA","DOCUMENT_CONTAINER_OPEN_IN_PROFILE","DOCUMENT_CONTAINER_SEND_TO_DEVICES","DOCUMENT_CONTAINER_EXTENSIONS","DOCUMENT_CONTAINER_LINK_SELECTION","DOCUMENT_CONTAINER_LINKED_IMAGE","DOCUMENT_CONTAINER_OPEN_IN_WINDOW"].concat(w.actions().filter((t=>!e.includes(t)))).concat(y.actions().filter((t=>!e.includes(t)))).concat(l.actions().filter((t=>!e.includes(t)))).concat(s.Z.actions())},options:function(e,t,n){const d=void 0===n,c=n||g.Z.settingsState,u={...o.Z.commandItem};switch(t.action){case"DOCUMENT_OPEN_IN_NEW_TAB":return{...u,...(0,r.Z)("Open Link in New Tab")};case"DOCUMENT_OPEN_IN_NEW_BACKGROUND_TAB":return{...u,...(0,r.Z)("Open Link in Background Tab")};case"DOCUMENT_OPEN_IN_TAB":return{...u,...(0,r.Z)("Open Link")};case"DOCUMENT_OPEN_IN_NEW_WINDOW":return{...u,...(0,r.Z)("Open Link in New Window")};case"DOCUMENT_OPEN_IN_PRIVATE_WINDOW":return{...u,...(0,r.Z)("Open Link in Private Window")};case"DOCUMENT_CONTAINER_OPEN_IN_PWA":return u.settingsLabel=(0,a.Z)("[Open Link in Progressive Web Apps]"),u.type="container",{...u,...(0,r.Z)("Open Link in Progressive Web Apps")};case"DOCUMENT_CONTAINER_OPEN_IN_PROFILE":return u.settingsLabel=(0,a.Z)("[Open Link in Another Profile]"),u.type="container",{...u,...(0,r.Z)("Open Link in Another Profile")};case"DOCUMENT_CONTAINER_OPEN_IN_WINDOW":return u.settingsLabel=(0,a.Z)("[Open Link in Another Window]"),u.type="container",{...u,...(0,r.Z)("Open Link in Another Window")};case"DOCUMENT_CONTAINER_OPEN_IN_WORKSPACE":return u.settingsLabel=(0,a.Z)("[Open Link in Another Workspace]"),u.type="container",{...u,...(0,r.Z)("Open Link in Another Workspace")};case"DOCUMENT_ADD_LINK_TO_BOOKMARKS":return{...u,...(0,r.Z)("Bookmark Link")};case"DOCUMENT_ADD_LINK_TO_WEBPANEL":return{...u,...(0,r.Z)("Add Link to Web Panel")};case"DOCUMENT_ADD_LINK_TO_READING_LIST":return{...u,...(0,r.Z)("Add Link to Reading List")};case"DOCUMENT_SEND_LINK_BY_MAIL":return{...u,...(0,r.Z)("Send Link by Mail")};case"DOCUMENT_SAVE_LINK":return u.ellipsis=!0,{...u,...(0,r.Z)("Save Link As")};case"DOCUMENT_COPY_LINK_ADDRESS":return{...u,...!d&&c.ismailto?(0,r.Z)("Copy Email Address"):(0,r.Z)("Copy Link Address")};case"DOCUMENT_COPY_LINK_TEXT":return{...u,...(0,r.Z)("Copy Link Text")};case"DOCUMENT_CONTAINER_SEND_TO_DEVICES":return u.settingsLabel=(0,a.Z)("[Send Link to Your Devices]"),u.type="container",{...u,...(0,r.Z)("Send Link to Your Devices")};case"DOCUMENT_CONTAINER_EXTENSIONS":return u.settingsLabel=(0,a.Z)("[Extensions]"),u.type="container",{...u,...(0,r.Z)("Extensions")};case"DOCUMENT_CONTAINER_LINK_SELECTION":return u.settingsLabel=(0,a.Z)("[Selection menu]"),u.type="container",{...u,...(0,r.Z)("Text Selection")};case"DOCUMENT_CONTAINER_LINKED_IMAGE":return u.settingsLabel=(0,a.Z)("[Image menu]"),u.type="container",{...u,...(0,r.Z)("Image")};default:return s.Z.actions().includes(t.action)?s.Z.options(e,t,n):w.actions().includes(t.action)?w.options(e,t,n):y.actions().includes(t.action)?y.options(e,t,n):l.actions().includes(t.action)?l.options(e,t,n):i.Z.getMenuItem(e,t,d)}}};const A={actions:function(){return["CONTEXT_OPEN_IN_NEW_TAB","CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB","CONTEXT_MAIL_REPLY","CONTEXT_MAIL_REPLY_ALL","CONTEXT_MAIL_REPLY_LIST","CONTEXT_MAIL_FORWARD","CONTEXT_MAIL_MARK_READ","CONTEXT_MAIL_MARK_UNREAD","CONTEXT_MAIL_MARK_JUNK"]},options:function(e,t,n){const s=void 0===n,a={...o.Z.commandItem};switch(t.action){case"CONTEXT_OPEN_IN_NEW_TAB":return{...a,...(0,r.Z)("Open in New Tab")};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{...a,...(0,r.Z)("Open in Background Tab")};case"CONTEXT_MAIL_REPLY":return{...a,...(0,r.Z)("Reply to Message")};case"CONTEXT_MAIL_REPLY_ALL":return{...a,...(0,r.Z)("Reply All")};case"CONTEXT_MAIL_REPLY_LIST":return{...a,...(0,r.Z)("Reply List")};case"CONTEXT_MAIL_FORWARD":return{...a,...(0,r.Z)("Forward Message")};case"CONTEXT_MAIL_MARK_READ":return{...a,...(0,r.Z)("Mark Message as Read")};case"CONTEXT_MAIL_MARK_JUNK":return{...a,...(0,r.Z)("Mark Message as Spam")};case"CONTEXT_MAIL_MARK_UNREAD":return{...a,...(0,r.Z)("Mark Message as Unread")};default:return i.Z.getMenuItem(e,t,s)}}};const I={actions:function(){return["DOCUMENT_MAIL_BACK","DOCUMENT_MAIL_FORWARD","COMMAND_SAVE_PAGE","DOCUMENT_PRINT","COMMAND_TAB_VIEW_PAGE_SOURCE","COMMAND_MAIL_SHOW_PLAINTEXT","DOCUMENT_CONTAINER_DEVELOPER_TOOLS","DOCUMENT_INSPECT"]},options:function(e,t,n){const a=void 0===n,l={...o.Z.commandItem};switch(t.action){case"COMMAND_PAGE_BACK":return{...i.Z.getMenuItem(e,t,a),...(0,r.Z)("navigation","Back")};case"COMMAND_PAGE_FORWARD":return{...i.Z.getMenuItem(e,t,a),...(0,r.Z)("navigation","Forward")};case"COMMAND_SAVE_PAGE":return l.ellipsis=!0,{...l,...i.Z.getMenuItem(e,t,a),...(0,r.Z)("command","Save As")};case"DOCUMENT_PRINT":{const t=g.Z.getShortcuts(e,"COMMAND_PRINT_PAGE");return l.ellipsis=!0,{...l,shortcuts:t,...(0,r.Z)("command","Print")}}case"COMMAND_TAB_VIEW_PAGE_SOURCE":return l.type="checkbox",{...l,...i.Z.getMenuItem(e,t,a),...(0,r.Z)("Show Raw Message")};case"DOCUMENT_INSPECT":return{...l,shortcuts:[],...(0,r.Z)("Inspect")};default:return s.Z.actions().includes(t.action)?s.Z.options(e,t,n):i.Z.getMenuItem(e,t,a)}}};const T={actions:function(){return["CONTEXT_BACK","CONTEXT_FORWARD","CONTEXT_COPY","CONTEXT_SENDER_IS_MAILING_LIST","COMMAND_TAB_VIEW_PAGE_SOURCE","COMMAND_MAIL_SHOW_PLAINTEXT"]},options:function(e,t,n){const s=void 0===n,a={...o.Z.commandItem};switch(t.action){case"COMMAND_PAGE_BACK":return{...i.Z.getMenuItem(e,t,s),...(0,r.Z)("navigation","Back")};case"COMMAND_PAGE_FORWARD":return{...i.Z.getMenuItem(e,t,s),...(0,r.Z)("navigation","Forward")};case"CONTEXT_COPY":return{...a,...(0,r.Z)("win_linux","Copy")};case"CONTEXT_SENDER_IS_MAILING_LIST":return a.type="checkbox",{...a,...(0,r.Z)("Treat Sender as a Mailing List")};case"COMMAND_TAB_VIEW_PAGE_SOURCE":return{...a,...i.Z.getMenuItem(e,t,s),...(0,r.Z)("Show Raw Message")};default:return i.Z.getMenuItem(e,t,s)}}};const Z={actions:function(){return["CONTEXT_VIEW_ALL_MESSAGES","CONTEXT_RERUN_FILTER","CONTEXT_MARK_ALL_AS_READ","CONTEXT_MOVE_ALL_TO_TRASH","CONTEXT_EMPTY_TRASH","CONTEXT_CHECK_FOR_MAIL","CONTEXT_SEND","CONTEXT_RESCAN_UNREAD","CONTEXT_IMPORT_MAIL_FILES","CONTEXT_SUBSCRIBE","CONTEXT_UNSUBSCRIBE","CONTEXT_RERUN_THREADING","CONTEXT_MOVE_INTO_IMPORTANT","CONTEXT_MOVE_INTO_OTHER","CONTEXT_DELETE","CONTEXT_DELETE_ALL","CONTEXT_RENAME","CONTEXT_REGENERATE","CONTEXT_ADVANCED","CONTEXT_CREATE_LABEL","CONTEXT_ADD_NEW_ACCOUNT","CONTEXT_RESYNC_FOLDER","CONTEXT_RESYNC_ACCOUNT","CONTEXT_RECONNECT_ACCOUNT"]},options:function(e,t,n){const s=void 0===n,a={...o.Z.commandItem};switch(t.action){case"CONTEXT_VIEW_ALL_MESSAGES":return{...a,...(0,r.Z)("View All Messages")};case"CONTEXT_RERUN_FILTER":return{...a,...(0,r.Z)("Rerun Filter for Folder")};case"CONTEXT_MARK_ALL_AS_READ":return{...a,...(0,r.Z)("Mark All as Read")};case"CONTEXT_MOVE_ALL_TO_TRASH":return{...a,...(0,r.Z)("mail","Move All to Trash")};case"CONTEXT_EMPTY_TRASH":return{...a,...(0,r.Z)("mail","Empty Trash")};case"CONTEXT_CHECK_FOR_MAIL":return{...a,...(0,r.Z)("Check for Mail")};case"CONTEXT_CREATE_FOLDER":return{...a,...(0,r.Z)("Create Folder")};case"CONTEXT_DELETE_FOLDER":return{...a,...(0,r.Z)("Delete Folder")};case"CONTEXT_CREATE_FEED_FOLDER":return{...a,...(0,r.Z)("Feeds","New Folder")};case"CONTEXT_DELETE_FEED_FOLDER":return{...a,...(0,r.Z)("Delete Feed Folder")};case"CONTEXT_SEND":return{...a,...(0,r.Z)("Send")};case"CONTEXT_RESCAN_UNREAD":return{...a,...(0,r.Z)("Rescan Unread Flags")};case"CONTEXT_IMPORT_MAIL_FILES":return{...a,...(0,r.Z)("Import Mail Files...")};case"CONTEXT_SUBSCRIBE":return{...a,...(0,r.Z)("Subscribe")};case"CONTEXT_UNSUBSCRIBE":return{...a,...(0,r.Z)("Unsubscribe")};case"CONTEXT_RERUN_THREADING":return{...a,...(0,r.Z)("Rerun Threading")};case"CONTEXT_MOVE_INTO_IMPORTANT":return{...a,...(0,r.Z)("Move into Important")};case"CONTEXT_MOVE_INTO_OTHER":return{...a,...(0,r.Z)("Move into Other")};case"CONTEXT_DELETE_ALL":return{...a,...(0,r.Z)("Delete all")};case"CONTEXT_REGENERATE":return{...a,...(0,r.Z)("Regenerate")};case"CONTEXT_DELETE":return{...a,...(0,r.Z)("verb","Delete")};case"CONTEXT_RENAME":return{...a,...(0,r.Z)("Rename")};case"CONTEXT_FILTER_EDIT":return{...a,...(0,r.Z)("mail filters","Edit")};case"CONTEXT_CREATE_LABEL":return{...a,...(0,r.Z)("Create Label")};case"CONTEXT_ADD_NEW_ACCOUNT":return{...a,...(0,r.Z)("Add Account")};case"CONTEXT_ADVANCED":return a.type="folder",{...a,...(0,r.Z)("Advanced")};case"CONTEXT_TOGGLE_MAIL_VIEWS":return a.type="folder",{...a,...(0,r.Z)("mail","Views")};case"CONTEXT_MAIL_FOLDER":return a.type="container",{...a,...(0,r.Z)("Mail Folder")};case"CONTEXT_RESYNC_FOLDER":return{...a,...(0,r.Z)("Re-sync folder with server")};case"CONTEXT_RESYNC_ACCOUNT":return{...a,...(0,r.Z)("Re-sync account with server")};case"CONTEXT_RECONNECT_ACCOUNT":return{...a,...(0,r.Z)("Reconnect to server (forced)")};default:return i.Z.getMenuItem(e,t,s)}}};const E={actions:function(){return["COMMAND_MAIL_REPLY","COMMAND_MAIL_REPLY_ALL","COMMAND_MAIL_REPLY_LIST","COMMAND_MAIL_FORWARD","COMMAND_MAIL_MARK_READ","COMMAND_MAIL_MARK_UNREAD","COMMAND_MAIL_MARK_JUNK","COMMAND_MAIL_MARK_NOT_JUNK","COMMAND_MAIL_MOVE_TO_ARCHIVE","COMMAND_MAIL_RESTORE_FROM_ARCHIVE","COMMAND_MAIL_GOTO_NEXT_UNREAD","COMMAND_MAIL_GOTO_PREVIOUS_UNREAD","COMMAND_MAIL_MARK_READ_AND_GOTO_NEXT_UNREAD","CONTEXT_CONTAINER_MOVE","CONTEXT_ADD_FLAG","CONTEXT_REMOVE_FLAG","CONTEXT_CONTAINER_FLAGS","CONTEXT_CONTAINER_LABELS","COMMAND_MAIL_LABEL_FLAG","CONTEXT_EDIT","CONTEXT_SEND","CONTEXT_RECEIVER","CONTEXT_CONTAINER_TRASH","COMMAND_MAIL_ENABLE_THREADED_VIEW","COMMAND_MAIL_MARK_THREAD_READ","COMMAND_MAIL_MARK_THREAD_UNREAD","COMMAND_MAIL_ENABLE_SENDER_VIEW","CONTEXT_SENDER_IS_MAILING_LIST","CONTEXT_EXPAND_ALL","CONTEXT_COLLAPSE_ALL","COMMAND_MAIL_COMPOSE_NEW_MESSAGE"]},options:function(e,t,n){const s=void 0===n,l={...o.Z.commandItem};switch(t.action){case"CONTEXT_GOTO":return l.type="folder",{...l,...(0,r.Z)("Go to")};case"CONTEXT_CONTAINER_MOVE":return l.settingsLabel=(0,a.Z)("[Move to Folders]"),l.type="container",{...l,...(0,r.Z)("Move")};case"CONTEXT_ADD_FLAG":return{...l,...(0,r.Z)("Add Flag")};case"CONTEXT_REMOVE_FLAG":return{...l,...(0,r.Z)("Remove Flag")};case"CONTEXT_CONTAINER_FLAGS":return l.settingsLabel=(0,a.Z)("[All Flags]"),l.type="container",{...l,...(0,r.Z)("Flags")};case"CONTEXT_CONTAINER_LABELS":return l.settingsLabel=(0,a.Z)("[All Labels]"),l.type="container",{...l,...(0,r.Z)("Labels")};case"CONTEXT_EDIT":return{...l,...(0,r.Z)("mail","Edit")};case"COMMAND_MAIL_MOVE_TO_ARCHIVE":return{...l,...(0,r.Z)("mail","Move Message to Archive")};case"COMMAND_MAIL_RESTORE_FROM_ARCHIVE":return{...l,...(0,r.Z)("mail","Restore Message from Archive")};case"CONTEXT_SEND":return{...l,...(0,r.Z)("Send")};case"CONTEXT_CONTAINER_TRASH":return l.settingsLabel=(0,a.Z)("[Trash elements]"),l.type="container",{...l,...(0,r.Z)("Trash")};case"CONTEXT_RECEIVER":return{...l,...(0,r.Z)("Show Messages for Receiver")};case"CONTEXT_THREAD":return l.type="folder",{...l,...(0,r.Z)("Thread")};case"CONTEXT_SENDER":return l.type="folder",{...l,...(0,r.Z)("Sender")};case"CONTEXT_SENDER_IS_MAILING_LIST":return l.type="checkbox",{...l,...(0,r.Z)("Treat Sender as a Mailing List")};case"CONTEXT_EXPAND_ALL":return{...l,...(0,r.Z)("Expand All Threads")};case"CONTEXT_COLLAPSE_ALL":return{...l,...(0,r.Z)("Collapse All Threads")};default:return i.Z.getMenuItem(e,t,s)}}};const k={actions:function(){return["CONTEXT_CONTAINER_CUSTOMIZE_TOOLBAR","CONTEXT_CONTAINER_BACKWARD_HISTORY","CONTEXT_CONTAINER_FORWARD_HISTORY"]},options:function(e,t,n){const s=void 0===n,l={...o.Z.commandItem};switch(t.action){case"CONTEXT_CONTAINER_CUSTOMIZE_TOOLBAR":return l.settingsLabel=(0,a.Z)("[Customize]"),l.type="container",{...l,...(0,r.Z)("Customize")};case"CONTEXT_CONTAINER_BACKWARD_HISTORY":return l.settingsLabel=(0,a.Z)("[Backward History]"),l.type="container",{...l,...(0,r.Z)("Backward History")};case"CONTEXT_CONTAINER_FORWARD_HISTORY":return l.settingsLabel=(0,a.Z)("[Forward History]"),l.type="container",{...l,...(0,r.Z)("Forward History")};default:return i.Z.getMenuItem(e,t,s)}}};const _={actions:function(){return["CONTEXT_CONTAINER_OPEN_IN_WINDOW","CONTEXT_OPEN_ADDRESS","CONTEXT_NEW_FROM_SELECTION","CONTEXT_NEW_ITEM","CONTEXT_NEW_FOLDER","CONTEXT_NEW_SEPARATOR","CONTEXT_EDIT","CONTEXT_RENAME","CONTEXT_CUT","CONTEXT_COPY","CONTEXT_PASTE","CONTEXT_DELETE","CONTEXT_EMPTY_TRASH","CONTEXT_EXPAND_ALL","CONTEXT_COLLAPSE_ALL","CONTEXT_SETTINGS","CONTEXT_CONTAINER_SEARCH"]},options:function(e,t,n){const s=n||{inManager:!1},l=void 0===n,d={...o.Z.commandItem};switch(t.action){case"CONTEXT_OPEN_IN_NEW_TAB":return{...d,...(0,r.Z)("Open in New Tab")};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{...d,...(0,r.Z)("Open in Background Tab")};case"CONTEXT_OPEN_IN_TAB":return{...d,...(0,r.Z)("Open")};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{...d,...(0,r.Z)("Open in New Window")};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{...d,...(0,r.Z)("Open in Private Window")};case"CONTEXT_CONTAINER_OPEN_IN_WINDOW":return d.settingsLabel=(0,a.Z)("[Open in Another Window]"),d.type="container",{...d,...(0,r.Z)("Open in Another Window")};case"CONTEXT_SET_SPEEDDIAL":return{...d,...(0,r.Z)("Use as Speed Dial")};case"CONTEXT_UNSET_SPEEDDIAL":return{...d,...(0,r.Z)("Remove from Speed Dial")};case"CONTEXT_SET_BOOKMARK_BAR":return{...d,...(0,r.Z)("Set as Bookmark Bar Folder")};case"CONTEXT_UNSET_BOOKMARK_BAR":return{...d,...(0,r.Z)("Remove as Bookmark Bar Folder")};case"CONTEXT_MOVE_TO_BOOKMARK_BAR":return{...d,...(0,r.Z)("Move to Bookmark Bar Folder")};case"CONTEXT_BOOKMARK":return{...d,...(0,r.Z)("Bookmark Active Page")};case"CONTEXT_BOOKMARK_ALL":return{...d,...(0,r.Z)("Bookmark All Open Pages")};case"CONTEXT_OPEN_ADDRESS":return{...d,...(0,r.Z)("Open Note Address")};case"CONTEXT_NEW_FROM_SELECTION":return{...d,...(0,r.Z)("Copy Selection to New Note")};case"CONTEXT_NEW_ITEM":return{...d,...(0,r.Z)("New Note")};case"CONTEXT_NEW_FOLDER":return{...d,...(0,r.Z)("command","New Folder")};case"CONTEXT_NEW_SEPARATOR":return{...d,...(0,r.Z)("New Separator")};case"CONTEXT_EDIT":return l?{...d,...(0,r.Z)("command","Edit")}:{...d,...s.inManager?(0,r.Z)("Edit in New Tab"):(0,r.Z)("Edit in Notes Manager")};case"CONTEXT_RENAME":return{...d,...(0,r.Z)("Rename")};case"CONTEXT_CUT":return{...d,...(0,r.Z)("verb","Cut")};case"CONTEXT_COPY":return{...d,...(0,r.Z)("verb","Copy")};case"CONTEXT_PASTE":return{...d,...(0,r.Z)("verb","Paste")};case"CONTEXT_DELETE":return{...d,...(0,r.Z)("verb","Delete")};case"CONTEXT_EMPTY_TRASH":return{...d,...(0,r.Z)("Empty Trash")};case"CONTEXT_EXPAND_ALL":return{...d,...(0,r.Z)("Expand All Folders")};case"CONTEXT_COLLAPSE_ALL":return{...d,...(0,r.Z)("Collapse All Folders")};case"CONTEXT_SETTINGS":return d.type="folder",{...d,...(0,r.Z)("Settings")};case"CONTEXT_CONTAINER_SEARCH":return d.settingsLabel=(0,a.Z)("[Search Settings]"),d.type="container",{...d,...(0,r.Z)("command","Search")};default:return i.Z.getMenuItem(e,t,l)}}};const N={actions:function(){return["DOCUMENT_BACK","DOCUMENT_FORWARD","DOCUMENT_RELOAD","COMMAND_ADD_BOOKMARK","DOCUMENT_ADD_TO_WEBPANEL","DOCUMENT_SEND_BY_MAIL","DOCUMENT_SAVE","DOCUMENT_PRINT","DOCUMENT_CAST","DOCUMENT_COPY_ADDRESS","DOCUMENT_CONTAINER_LINK_TO_HIGHLIGHT","DOCUMENT_CONTAINER_SEND_TO_DEVICES","DOCUMENT_CONTAINER_EXTENSIONS","DOCUMENT_QR_CODE","DOCUMENT_CONTAINER_PLUGIN_ROTATION"].concat(s.Z.actions())},options:function(e,t,n){const l=void 0===n,d=n||g.Z.settingsState,c={...o.Z.commandItem};switch(t.action){case"DOCUMENT_BACK":{const t=d.iswebpanel?[]:g.Z.getShortcuts(e,"COMMAND_PAGE_BACK");return{...c,shortcuts:t,...(0,r.Z)("navigation","Back")}}case"DOCUMENT_FORWARD":{const t=d.iswebpanel?[]:g.Z.getShortcuts(e,"COMMAND_PAGE_FORWARD");return{...c,shortcuts:t,...(0,r.Z)("navigation","Forward")}}case"DOCUMENT_RELOAD":{const t=d.iswebpanel?[]:g.Z.getShortcuts(e,"COMMAND_PAGE_REFRESH");return{...c,shortcuts:t,...(0,r.Z)("navigation","Reload")}}case"COMMAND_ADD_BOOKMARK":return{...i.Z.getMenuItem(e,t,l),...c,...(0,r.Z)("command","Bookmark Page")};case"DOCUMENT_ADD_TO_WEBPANEL":return{...c,...(0,r.Z)("Add Page to Web Panel")};case"DOCUMENT_SEND_BY_MAIL":return{...c,...(0,r.Z)("Send by Mail")};case"DOCUMENT_SAVE":{const t=d.iswebpanel?[]:g.Z.getShortcuts(e,"COMMAND_SAVE_PAGE");return c.ellipsis=!0,{...c,shortcuts:t,...(0,r.Z)("Save As")}}case"DOCUMENT_PRINT":{const t=d.iswebpanel?[]:g.Z.getShortcuts(e,"COMMAND_PRINT_PAGE");return c.ellipsis=!0,{...c,shortcuts:t,...(0,r.Z)("command","Print")}}case"DOCUMENT_CAST":return c.ellipsis=!0,{...c,...(0,r.Z)("Cast")};case"DOCUMENT_COPY_ADDRESS":return{...c,...d.iswebpanel?(0,r.Z)("Copy Panel Address"):(0,r.Z)("Copy Page Address")};case"DOCUMENT_CONTAINER_LINK_TO_HIGHLIGHT":return c.settingsLabel=(0,a.Z)("[Link to Highlight]"),c.type="container",{...c,...(0,r.Z)("Link to Highlight")};case"DOCUMENT_CONTAINER_SEND_TO_DEVICES":return c.settingsLabel=(0,a.Z)("[Send to Your Devices]"),c.type="container",{...c,...(0,r.Z)("Send to Your Devices")};case"DOCUMENT_QR_CODE":{const t=d.iswebpanel?[]:g.Z.getShortcuts(e,"COMMAND_PAGE_QR_CODE");return{...c,shortcuts:t,...(0,r.Z)("command","Create QR Code for This Page")}}case"DOCUMENT_CONTAINER_EXTENSIONS":return c.settingsLabel=(0,a.Z)("[Extensions]"),c.type="container",{...c,...(0,r.Z)("Extensions")};case"DOCUMENT_CONTAINER_PLUGIN_ROTATION":return c.settingsLabel=(0,a.Z)("[Plugin Rotation Commands]"),c.type="container",{...c,...(0,r.Z)("Plugin Rotation")};default:return s.Z.actions().includes(t.action)?s.Z.options(e,t,n):i.Z.getMenuItem(e,t,l)}}};const P={actions:function(){return["CONTEXT_OPEN_IN_NEW_TAB","CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB","CONTEXT_OPEN_IN_TAB","CONTEXT_OPEN_IN_NEW_WINDOW","CONTEXT_OPEN_IN_PRIVATE_WINDOW","CONTEXT_COPY_ADDRESS","CONTEXT_DESKTOP_VERSION","CONTEXT_MOBILE_VERSION","CONTEXT_SEPARATE_WIDTH","CONTEXT_CONTAINER_TOOLBAR","CONTEXT_CONTAINER_PERIODIC_TIMER","CONTEXT_CONTAINER_FLOATING","CONTEXT_MUTE_PANEL","CONTAINER_CLOSED_WEBPANEL"]},options:function(e,t,n){const s=void 0===n,l={...o.Z.commandItem};switch(t.action){case"CONTEXT_CONTAINER_PERIODIC_TIMER":return l.settingsLabel=(0,a.Z)("[Periodic Reload]"),l.type="container",{...l,...(0,r.Z)("Periodic Reload")};case"CONTEXT_MENU_OPEN":return l.type="folder",{...l,...(0,r.Z)("Open in")};case"CONTEXT_OPEN_IN_NEW_TAB":return{...l,...(0,r.Z)("open in","New Tab")};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{...l,...(0,r.Z)("Background Tab")};case"CONTEXT_OPEN_IN_TAB":return{...l,...(0,r.Z)("Current Tab")};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{...l,...(0,r.Z)("open in","New Window")};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{...l,...(0,r.Z)("open in","Private Window")};case"CONTEXT_COPY_ADDRESS":return{...l,...(0,r.Z)("Copy Panel Address")};case"CONTEXT_DESKTOP_VERSION":return{...l,...(0,r.Z)("Show Desktop Version")};case"CONTEXT_MOBILE_VERSION":return{...l,...(0,r.Z)("Show Mobile Version")};case"CONTEXT_CONTAINER_FLOATING":return l.settingsLabel=(0,a.Z)("[Separate Floating]"),l.type="container",{...l,...(0,r.Z)("Floating Panel")};case"CONTEXT_MUTE_PANEL":return{...l,...(0,r.Z)("Mute Panel")};case"CONTEXT_SEPARATE_WIDTH":return l.type="checkbox",{...l,...(0,r.Z)("Separate Width")};case"CONTEXT_CONTAINER_TOOLBAR":return l.settingsLabel=(0,a.Z)("[Toolbar]"),l.type="container",{...l,...(0,r.Z)("Navigation Controls")};default:return i.Z.getMenuItem(e,t,s)}}};const D={actions:function(){return["CONTAINER_CLOSED_WEBPANEL"]},options:function(e,t,n){const s=void 0===n;return t.action,i.Z.getMenuItem(e,t,s)}};const M={actions:function(){return["CONTEXT_OPEN","CONTEXT_MARK_READ","CONTEXT_MARK_UNREAD","CONTEXT_COPY","CONTEXT_DELETE"]},options:function(e,t,n){const s=void 0===n,a={...o.Z.commandItem};switch(t.action){case"CONTEXT_OPEN":return{...a,...(0,r.Z)("verb","Open")};case"CONTEXT_MARK_READ":return{...a,...(0,r.Z)("verb","Mark as Read")};case"CONTEXT_MARK_UNREAD":return{...a,...(0,r.Z)("Mark as Unread")};case"CONTEXT_COPY_URL":return{...a,...(0,r.Z)("verb","Copy Address")};case"CONTEXT_DELETE":return{...a,...(0,r.Z)("verb","Remove")};default:return i.Z.getMenuItem(e,t,s)}}};const O={actions:function(){return["CONTEXT_OPEN_SESSION_IN_NEW_WINDOW","CONTEXT_OPEN_SESSION","CONTEXT_OPEN_IN_NEW_TAB","CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB","CONTEXT_OPEN_IN_TAB","CONTEXT_OPEN_IN_NEW_WINDOW","CONTEXT_OPEN_IN_PRIVATE_WINDOW","CONTEXT_QUARANTINE","CONTEXT_PIN","CONTEXT_UNPIN","CONTEXT_NEW_STACK","CONTEXT_REMOVE_STACK","CONTEXT_NEW_WINDOW","CONTEXT_NEW_WORKSPACE","CONTEXT_COPY","CONTEXT_RENAME","CONTEXT_DELETE","CONTEXT_DELETE_WITHOUT_QUARANTINE","CONTEXT_EXPAND_ALL","CONTEXT_COLLAPSE_ALL"]},options:function(e,t,n){const s=void 0===n,a={...o.Z.commandItem};switch(t.action){case"CONTEXT_OPEN_SESSION_IN_NEW_WINDOW":return{...a,...(0,r.Z)("Open")};case"CONTEXT_OPEN_SESSION":return{...a,...(0,r.Z)("Open in Current Window")};case"CONTEXT_OPEN_LINK_MENU":return{...a,...(0,r.Z)("Open Link")};case"CONTEXT_OPEN_IN_NEW_TAB":return{...a,...(0,r.Z)("Open Link in New Tab")};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{...a,...(0,r.Z)("Open Link in Background Tab")};case"CONTEXT_OPEN_IN_TAB":return{...a,...(0,r.Z)("Open Link in Active Tab")};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{...a,...(0,r.Z)("Open Link in New Window")};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{...a,...(0,r.Z)("Open Link in Private Window")};case"CONTEXT_QUARANTINE":return a.type="checkbox",{...a,...(0,r.Z)("Excluded")};case"CONTEXT_DELETE_WITHOUT_QUARANTINE":return{...a,...(0,r.Z)("Delete Now")};case"CONTEXT_PIN":return{...a,...(0,r.Z)("Pin")};case"CONTEXT_UNPIN":return{...a,...(0,r.Z)("Unpin")};case"CONTEXT_NEW_STACK":return{...a,...(0,r.Z)("Stack Tabs")};case"CONTEXT_REMOVE_STACK":return{...a,...(0,r.Z)("Unstack Tabs")};case"CONTEXT_NEW_WINDOW":return{...a,...(0,r.Z)("command","New Window")};case"CONTEXT_NEW_WORKSPACE":return{...a,...(0,r.Z)("command","New Workspace")};case"CONTEXT_COPY":return{...a,...(0,r.Z)("Copy Link")};case"CONTEXT_RENAME":return{...a,...(0,r.Z)("Rename")};case"CONTEXT_DELETE":return{...a,...(0,r.Z)("verb","Delete")};case"CONTEXT_EXPAND_ALL":return{...a,...(0,r.Z)("Expand All Folders")};case"CONTEXT_COLLAPSE_ALL":return{...a,...(0,r.Z)("Collapse All Folders")};default:return i.Z.getMenuItem(e,t,s)}}};const x={actions:function(){return["CONTEXT_OPEN_IN_NEW_WINDOW","CONTEXT_OPEN","CONTEXT_NEW_ITEM","CONTEXT_RENAME","CONTEXT_EDIT","CONTEXT_UPDATE","CONTEXT_DELETE","CONTEXT_RESTORE","CONTEXT_EMPTY_TRASH","CONTEXT_MOVE_TO_TOP","CONTEXT_DUPLICATE","CONTEXT_AUTOMATIC_BACKUP","CONTEXT_HISTORY"]},options:function(e,t,n){const s=void 0===n,a={...o.Z.commandItem};switch(t.action){case"CONTEXT_OPEN_IN_NEW_WINDOW":return{...a,...(0,r.Z)("Open")};case"CONTEXT_OPEN":return{...a,...(0,r.Z)("Open in Current Window")};case"CONTEXT_RENAME":return{...a,...(0,r.Z)("Rename")};case"CONTEXT_NEW_ITEM":return a.ellipsis=!0,{...a,...(0,r.Z)("sessions","New")};case"CONTEXT_EDIT":return{...a,...(0,r.Z)("command","Edit / View Contents")};case"CONTEXT_UPDATE":return a.ellipsis=!0,{...a,...(0,r.Z)("Save New Version")};case"CONTEXT_DELETE":return{...a,...(0,r.Z)("verb","Delete")};case"CONTEXT_RESTORE":return{...a,...(0,r.Z)("Restore")};case"CONTEXT_EMPTY_TRASH":return{...a,...(0,r.Z)("Empty Trash")};case"CONTEXT_MOVE_TO_TOP":return{...a,...(0,r.Z)("Move to Top")};case"CONTEXT_DUPLICATE":return{...a,...(0,r.Z)("Duplicate as New Session")};case"CONTEXT_AUTOMATIC_BACKUP":return a.ellipsis=!0,a.type="checkbox",{...a,...(0,r.Z)("verb","Automatic Session Backup")};case"CONTEXT_AUTOSAVE_SIZE":return{...a,...o.Z.makeLabelPair("")};case"CONTEXT_HISTORY":return a.type="checkbox",{...a,...(0,r.Z)("Show History")};default:return i.Z.getMenuItem(e,t,s)}}};const L={actions:function(){return["CONTEXT_OPEN_ALL","CONTEXT_EDIT","CONTEXT_RENAME","CONTEXT_DELETE"]},options:function(e,t,n){const s=void 0===n,a={...o.Z.commandItem};switch(t.action){case"CONTEXT_OPEN_ALL":return{...a,...(0,r.Z)("Open All Bookmarks")};case"CONTEXT_EDIT":return{...a,...(0,r.Z)("verb","Edit")};case"CONTEXT_DELETE":return{...a,...(0,r.Z)("verb","Delete")};default:return i.Z.getMenuItem(e,t,s)}}};const R={actions:function(){return["CONTEXT_OPEN_IN_NEW_TAB","CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB","CONTEXT_OPEN_IN_TAB","CONTEXT_OPEN_IN_NEW_WINDOW","CONTEXT_OPEN_IN_PRIVATE_WINDOW","CONTEXT_CONTAINER_OPEN_IN_WINDOW","CONTEXT_COPY","CONTEXT_DELETE"]},options:function(e,t,n){const s=void 0===n,l={...o.Z.commandItem};switch(t.action){case"CONTEXT_OPEN_IN_NEW_TAB":return{...l,...(0,r.Z)("Open in New Tab")};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{...l,...(0,r.Z)("Open in Background Tab")};case"CONTEXT_OPEN_IN_TAB":return{...l,...(0,r.Z)("Open")};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{...l,...(0,r.Z)("Open in New Window")};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{...l,...(0,r.Z)("Open in Private Window")};case"CONTEXT_CONTAINER_OPEN_IN_WINDOW":return l.settingsLabel=(0,a.Z)("[Open in Another Window]"),l.type="container",{...l,...(0,r.Z)("Open in Another Window")};case"CONTEXT_COPY":return{...l,...(0,r.Z)("win_linux","Copy")};case"CONTEXT_DELETE":return{...l,...(0,r.Z)("verb","Delete")};default:return i.Z.getMenuItem(e,t,s)}}};const B={actions:function(){return["CONTEXT_OPEN_IN_NEW_TAB","CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB","CONTEXT_OPEN_IN_TAB","CONTEXT_OPEN_IN_NEW_WINDOW","CONTEXT_OPEN_IN_PRIVATE_WINDOW","CONTEXT_CONTAINER_OPEN_IN_WINDOW","CONTEXT_OPEN_ALL","CONTEXT_SET_THUMBNAIL","CONTEXT_CLEAR_THUMBNAIL","CONTEXT_RELOAD","CONTEXT_EDIT","CONTEXT_RENAME","CONTEXT_CUT","CONTEXT_COPY","CONTEXT_PASTE","CONTEXT_DELETE","COMMAND_TOGGLE_STARTPAGE_NAVIGATION"]},options:function(e,t,n){const s=void 0===n,l={...o.Z.commandItem};switch(t.action){case"CONTEXT_OPEN_IN_NEW_TAB":return{...l,...(0,r.Z)("Open in New Tab")};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{...l,...(0,r.Z)("Open in Background Tab")};case"CONTEXT_OPEN_IN_TAB":return{...l,...(0,r.Z)("Open")};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{...l,...(0,r.Z)("Open in New Window")};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{...l,...(0,r.Z)("Open in Private Window")};case"CONTEXT_CONTAINER_OPEN_IN_WINDOW":return l.settingsLabel=(0,a.Z)("[Open in Another Window]"),l.type="container",{...l,...(0,r.Z)("Open in Another Window")};case"CONTEXT_OPEN_ALL":return{...l,...(0,r.Z)("Open All Bookmarks")};case"CONTEXT_SET_THUMBNAIL":return l.ellipsis=!0,{...l,...(0,r.Z)("Select Custom Thumbnail")};case"CONTEXT_CLEAR_THUMBNAIL":return{...l,...(0,r.Z)("Clear Custom Thumbnail")};case"CONTEXT_RELOAD":return{...l,...(0,r.Z)("Reload")};case"CONTEXT_EDIT":return{...l,...(0,r.Z)("command","Edit")};case"CONTEXT_RENAME":return{...l,...(0,r.Z)("Rename")};case"CONTEXT_CUT":return{...l,...(0,r.Z)("win_linux","Cut")};case"CONTEXT_COPY":return{...l,...(0,r.Z)("win_linux","Copy")};case"CONTEXT_PASTE":return{...l,...(0,r.Z)("win_linux","Paste")};case"CONTEXT_DELETE":return{...l,...(0,r.Z)("other","Delete")};default:return i.Z.getMenuItem(e,t,s)}}};const F={actions:function(){return["CONTEXT_SET_AS_DEFAULT","CONTEXT_RENAME","CONTEXT_REMOVE","COMMAND_TOGGLE_STARTPAGE_NAVIGATION"]},options:function(e,t,n){const s=void 0===n,a={...o.Z.commandItem};switch(t.action){case"CONTEXT_SET_AS_DEFAULT":return{...a,...(0,r.Z)("Startpage","Set as Default")};case"CONTEXT_RENAME":return{...a,...(0,r.Z)("Rename")};case"CONTEXT_REMOVE":return{...a,...(0,r.Z)("Remove from Speed Dial")};default:return i.Z.getMenuItem(e,t,s)}}};const W={actions:function(){return["CONTEXT_ADD_BOOKMARK_TO_SPEEDDIAL","CONTEXT_ADD_FOLDER_TO_SPEEDDIAL","CONTEXT_PASTE","CONTEXT_CUSTOMIZE","COMMAND_TOGGLE_STARTPAGE_NAVIGATION","CONTEXT_UNDO","CONTEXT_REDO"]},options:function(e,t,n){const s=void 0===n,a={...o.Z.commandItem};switch(t.action){case"CONTEXT_ADD_BOOKMARK_TO_SPEEDDIAL":return{...a,...(0,r.Z)("command","Add Bookmark to Speed Dial")};case"CONTEXT_ADD_FOLDER_TO_SPEEDDIAL":return{...a,...(0,r.Z)("command","Add Speed Dial Group")};case"CONTEXT_PASTE":return{...a,...(0,r.Z)("win_linux","Paste")};case"CONTEXT_CUSTOMIZE":return a.ellipsis=!0,{...a,...(0,r.Z)("other","Customize")};case"CONTEXT_UNDO":return{...a,...(0,r.Z)("command","Undo")};case"CONTEXT_REDO":return{...a,...(0,r.Z)("command","Redo")};default:return i.Z.getMenuItem(e,t,s)}}};const U={actions:function(){return["CONTEXT_NEW","CONTEXT_TOGGLE_SUBSTRIP_LOCK","CONTEXT_BOOKMARK_ALL","CONTEXT_SAVE_SESSION","CONTEXT_REOPEN"]},options:function(e,t,n){const s=void 0===n,a={...o.Z.commandItem};switch(t.action){case"CONTEXT_LOCK_SUBSTRIP":case"CONTEXT_UNLOCK_SUBSTRIP":return{...a,isVisible:()=>!1};case"CONTEXT_NEW":return{...a,...(0,r.Z)("command","New Tab")};case"CONTEXT_TOGGLE_SUBSTRIP_LOCK":return{...a,...(0,r.Z)("Lock Second Tab Row")};case"CONTEXT_BOOKMARK_ALL":return{...a,...(0,r.Z)("Bookmark All Tabs")};case"CONTEXT_SAVE_SESSION":return i.Z.getMenuItem(e,{...t,action:"COMMAND_SAVE_SESSION"},s);case"CONTEXT_REOPEN":return i.Z.getMenuItem(e,{...t,action:"COMMAND_TAB_REOPEN_RECENTLY_CLOSED"},s);default:return i.Z.getMenuItem(e,t,s)}}};const V={actions:function(){return["CONTEXT_CONTAINER_TAB_OVERFLOW"]},options:function(e,t,n){const s=void 0===n,a={...o.Z.commandItem};return"CONTEXT_CONTAINER_TAB_OVERFLOW"===t.action?{...a,...(0,r.Z)("Open Tab")}:i.Z.getMenuItem(e,t,s)}};const H={actions:function(){return["CONTEXT_CLOSE","CONTEXT_TABSTACK_REMOVE_FROM"]},options:function(e,t,n){const s=void 0===n,a={...o.Z.commandItem};switch(t.action){case"CONTEXT_CLOSE":return{...a,...(0,r.Z)("Close Tab")};case"CONTEXT_TABSTACK_REMOVE_FROM":return{...a,...(0,r.Z)("Remove from Tab Stack")};default:return i.Z.getMenuItem(e,t,s)}}};const G={actions:function(){return["CONTEXT_NEW","CONTEXT_RELOAD","CONTEXT_CLONE","CONTEXT_PIN","CONTEXT_PIN_STACK","CONTEXT_UNPIN","CONTEXT_UNPIN_STACK","CONTEXT_MUTE","CONTEXT_MUTE_OTHER","CONTEXT_OPTIMIZE_FS_VIDEOS","CONTEXT_BOOKMARK","CONTEXT_BOOKMARK_STACK","CONTEXT_BOOKMARK_ALL","CONTEXT_COPY_LINK","CONTEXT_COPY_LINKS","CONTEXT_SAVE_SESSION","CONTEXT_TABSTACK_BY_SELECTION","CONTEXT_TABSTACK_BY_HOST","CONTEXT_TABSTACK_RENAME","CONTEXT_TABSTACK_RELOAD","CONTEXT_TABSTACK_REMOVE_FROM","CONTEXT_TABSTACK_UNGROUP","CONTEXT_TILE_TABSTACK","CONTEXT_UNTILE_TABSTACK","CONTEXT_TILE_TABS","CONTEXT_UNTILE_TAB","CONTEXT_UNTILE_TILE_GROUP","CONTEXT_UNTILE_SELECTION","CONTEXT_HIBERNATE_TAB","CONTEXT_HIBERNATE_SELECTED_BACKGROUND_TABS","CONTEXT_HIBERNATE_TABSTACK","CONTEXT_HIBERNATE_BACKGROUND","CONTEXT_CLOSE","CONTEXT_CLOSE_TABSTACK","CONTEXT_CLOSE_OTHER","CONTEXT_CLOSE_LEFT","CONTEXT_CLOSE_RIGHT","CONTEXT_REOPEN","CONTEXT_CUSTOMIZE","CONTEXT_CONTAINER_PWA","CONTEXT_CONTAINER_SEND_TO_DEVICES","CONTEXT_CONTAINER_MOVE_TO_WINDOW","CONTEXT_CONTAINER_MOVE_TO_WORKSPACE","CONTEXT_MOVE","CONTEXT_TABSTACK_MOVE","CONTEXT_MOVE_LEFT","CONTEXT_MOVE_RIGHT","CONTEXT_CONTAINER_PERIODIC_TIMER","CONTEXT_TABSTACK_BY_HOSTS","CONTEXT_MOVE_STACK_LEFT","CONTEXT_MOVE_STACK_RIGHT"]},options:function(e,t,n){const s=n||{isMultiSelect:!1,count:-1,closableCount:-1,unSelectedCount:0,unpinned:0,pinned:0,playing:0,hostname:"",hostnameCount:-1,canHibernateCount:-1,horizontal:!0,someIncognito:!1,canCloneCount:-1,isStack:!1},l=void 0===n,d={...o.Z.commandItem};switch(t.action){case"CONTEXT_NEW":return{...d,...(0,r.Z)("command","New Tab")};case"CONTEXT_RELOAD":return{...d,...s.isMultiSelect?(0,r.Z)("Reload $1 Tab","Reload $1 Tabs",[s.count]):(0,r.Z)("Reload Tab")};case"CONTEXT_CLONE":return{...d,...s.isMultiSelect?(0,r.Z)("Duplicate $1 Tab","Duplicate $1 Tabs",[s.canCloneCount]):(0,r.Z)("Duplicate Tab")};case"CONTEXT_PIN_STACK":return{...d,...(0,r.Z)("Pin Tab Stack")};case"CONTEXT_PIN":return{...d,...s.isMultiSelect?(0,r.Z)("Pin $1 Tab","Pin $1 Tabs",[s.unpinned]):(0,r.Z)("Pin Tab")};case"CONTEXT_UNPIN":return{...d,...s.isMultiSelect?(0,r.Z)("Unpin $1 Tab","Unpin $1 Tabs",[s.pinned]):(0,r.Z)("Unpin Tab")};case"CONTEXT_UNPIN_STACK":return{...d,...(0,r.Z)("Unpin Tab Stack")};case"CONTEXT_CONTAINER_PERIODIC_TIMER":return d.settingsLabel=(0,a.Z)("[Periodic Reload]"),d.type="container",{...d,...(0,r.Z)("Periodic Reload")};case"CONTEXT_MUTE":return d.type="checkbox",{...d,...s.isMultiSelect?(0,r.Z)("Mute $1 Tab","Mute $1 Tabs",[s.playing]):(0,r.Z)("Mute Tab")};case"CONTEXT_MUTE_OTHER":return{...d,...(0,r.Z)("Mute Other Tabs")};case"CONTEXT_OPTIMIZE_FS_VIDEOS":return{...d,...(0,r.Z)("Optimize fullscreen videos")};case"CONTEXT_BOOKMARK":return{...d,...s.isMultiSelect?(0,r.Z)("Bookmark $1 Tab","Bookmark $1 Tabs",[s.count]):(0,r.Z)("Bookmark Tab")};case"CONTEXT_BOOKMARK_STACK":return{...d,...(0,r.Z)("Bookmark Tab Stack")};case"CONTEXT_BOOKMARK_ALL":return{...d,...(0,r.Z)("Bookmark All Tabs")};case"CONTEXT_COPY_LINK":return{...d,...(0,r.Z)("Copy Link")};case"CONTEXT_COPY_LINKS":return{...d,...(0,r.Z)("Copy Links")};case"CONTEXT_SAVE_SESSION":return{...d,...s.count>0?(0,r.Z)("Save $1 Selected Tab as Session","Save $1 Selected Tabs as Session",[s.count]):(0,r.Z)("Save All Tabs as Session")};case"CONTEXT_TABSTACK_BY_SELECTION":return{...d,...l?(0,r.Z)("Stack Selected Tabs"):(0,r.Z)("Stack $1 Selected Tab","Stack $1 Selected Tabs",[s.count])};case"CONTEXT_TABSTACK_BY_HOST":return{...d,...l?(0,r.Z)("Stack Tabs by Host"):(0,r.Z)("Stack Tabs by Host ($1 of $2)",[s.hostnameCount,s.hostname])};case"CONTEXT_TABSTACK_BY_HOSTS":return{...d,...(0,r.Z)("Stack Tabs by Hosts")};case"CONTEXT_TABSTACK_RELOAD":return{...d,...(0,r.Z)("Reload Tab Stack")};case"CONTEXT_TABSTACK_RENAME":return{...d,...l?(0,r.Z)("Rename"):s.isStack?(0,r.Z)("Rename Tab Stack"):(0,r.Z)("Rename")};case"CONTEXT_TABSTACK_REMOVE_FROM":return{...d,...(0,r.Z)("Remove from Tab Stack")};case"CONTEXT_TABSTACK_UNGROUP":return{...d,...(0,r.Z)("Unstack Tabs")};case"CONTEXT_TILE_TABSTACK":return{...d,...(0,r.Z)("Tile Tab Stack")};case"CONTEXT_UNTILE_TABSTACK":return{...d,...(0,r.Z)("Untile Tab Stack")};case"CONTEXT_TILE_TABS":return{...d,...l?(0,r.Z)("Tile Tabs"):(0,r.Z)("Tile $1 Tab","Tile $1 Tabs",[s.count])};case"CONTEXT_UNTILE_TAB":return{...d,...(0,r.Z)("Untile Tab")};case"CONTEXT_UNTILE_TILE_GROUP":return{...d,...(0,r.Z)("Untile All Tabs in Set")};case"CONTEXT_UNTILE_SELECTION":return{...d,...(0,r.Z)("Untile Selection")};case"CONTEXT_HIBERNATE_TAB":return{...d,...(0,r.Z)("Hibernate Tab")};case"CONTEXT_HIBERNATE_SELECTED_BACKGROUND_TABS":return{...d,...l?(0,r.Z)("Hibernate Selected Background Tabs"):(0,r.Z)("Hibernate $1 Background Tab","Hibernate $1 Background Tabs",[s.canHibernateCount])};case"CONTEXT_HIBERNATE_TABSTACK":return{...d,...(0,r.Z)("Hibernate Tab Stack")};case"CONTEXT_HIBERNATE_BACKGROUND":return{...d,...(0,r.Z)("Hibernate Background Tabs")};case"CONTEXT_CLOSE":return{...d,...s.isMultiSelect?(0,r.Z)("Close $1 Tab","Close $1 Tabs",[s.closableCount]):(0,r.Z)("Close Tab")};case"CONTEXT_CLOSE_TABSTACK":return{...d,...(0,r.Z)("Close Tab Stack")};case"CONTEXT_CLOSE_OTHER":return{...d,...s.isMultiSelect&&s.unSelectedCount>0?(0,r.Z)("Close Other ($1 Unselected Tab)","Close Other ($1 Unselected Tabs)",[s.unSelectedCount]):(0,r.Z)("Close Other Tabs")};case"CONTEXT_CLOSE_LEFT":return{...d,...s.horizontal?(0,r.Z)("Close Tabs to the Left"):(0,r.Z)("Close the Tabs Above")};case"CONTEXT_CLOSE_RIGHT":return{...d,...s.horizontal?(0,r.Z)("Close Tabs to the Right"):(0,r.Z)("Close the Tabs Below")};case"CONTEXT_REOPEN":return i.Z.getMenuItem(e,{...t,action:"COMMAND_TAB_REOPEN_RECENTLY_CLOSED"},l);case"CONTEXT_CUSTOMIZE":return d.ellipsis=!0,{...d,...(0,r.Z)("panel","Customize")};case"CONTEXT_CONTAINER_PWA":return d.settingsLabel=(0,a.Z)("[All Progressive Web Apps]"),d.type="container",{...d,...(0,r.Z)("Progressive Web Apps")};case"CONTEXT_CONTAINER_SEND_TO_DEVICES":return d.settingsLabel=(0,a.Z)("[Send to Your Devices]"),d.type="container",{...d,...(0,r.Z)("Send to Your Devices")};case"CONTEXT_CONTAINER_MOVE_TO_WINDOW":return d.settingsLabel=(0,a.Z)("[All Window Destinations]"),d.type="container",{...d,...(0,r.Z)("Window Destinations")};case"CONTEXT_CONTAINER_MOVE_TO_WORKSPACE":return d.settingsLabel=(0,a.Z)("[All Workspace Destinations]"),d.type="container",{...d,...(0,r.Z)("context","Workspace")};case"CONTEXT_MOVE":return d.type="folder",{...d,...s.isMultiSelect&&!s.someIncognito?(0,r.Z)("Move $1 Tab","Move $1 Tabs",[s.count]):(0,r.Z)("Move Tab")};case"CONTEXT_TABSTACK_MOVE":return d.type="folder",{...d,...(0,r.Z)("Move Tab Stack")};case"CONTEXT_MOVE_LEFT":case"CONTEXT_MOVE_STACK_LEFT":return{...d,...s.horizontal?(0,r.Z)("navigation","Left"):(0,r.Z)("Up")};case"CONTEXT_MOVE_RIGHT":case"CONTEXT_MOVE_STACK_RIGHT":return{...d,...s.horizontal?(0,r.Z)("navigation","Right"):(0,r.Z)("Down")};default:return i.Z.getMenuItem(e,t,l)}}};const $={actions:function(){return["CONTEXT_OPEN_IN_NEW_TAB","CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB","CONTEXT_OPEN_IN_TAB","CONTEXT_OPEN_IN_NEW_WINDOW","CONTEXT_OPEN_IN_PRIVATE_WINDOW","CONTEXT_CONTAINER_OPEN_IN_WINDOW","CONTEXT_COPY"]},options:function(e,t,n){const s=void 0===n,l={...o.Z.commandItem};switch(t.action){case"CONTEXT_OPEN_IN_NEW_TAB":return{...l,...(0,r.Z)("Open in New Tab")};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{...l,...(0,r.Z)("Open in Background Tab")};case"CONTEXT_OPEN_IN_TAB":return{...l,...(0,r.Z)("Open")};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{...l,...(0,r.Z)("Open in New Window")};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{...l,...(0,r.Z)("Open in Private Window")};case"CONTEXT_CONTAINER_OPEN_IN_WINDOW":return l.settingsLabel=(0,a.Z)("[Open in Another Window]"),l.type="container",{...l,...(0,r.Z)("Open in Another Window")};case"CONTEXT_COPY":return{...l,...(0,r.Z)("win_linux","Copy URL")};default:return i.Z.getMenuItem(e,t,s)}}};const K={actions:function(){return["CONTEXT_OPEN_IN_NEW_TAB","CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB","CONTEXT_OPEN_IN_TAB","CONTEXT_OPEN_IN_NEW_WINDOW","CONTEXT_OPEN_IN_PRIVATE_WINDOW","CONTEXT_CONTAINER_OPEN_IN_WINDOW","CONTEXT_COPY","CONTEXT_DELETE","CONTEXT_HIDE_SUGGESTIONS"]},options:function(e,t,n){const s=void 0===n,l={...o.Z.commandItem};switch(t.action){case"CONTEXT_OPEN_IN_NEW_TAB":return{...l,...(0,r.Z)("Open in New Tab")};case"CONTEXT_OPEN_IN_NEW_BACKGROUND_TAB":return{...l,...(0,r.Z)("Open in Background Tab")};case"CONTEXT_OPEN_IN_TAB":return{...l,...(0,r.Z)("Open")};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{...l,...(0,r.Z)("Open in New Window")};case"CONTEXT_OPEN_IN_PRIVATE_WINDOW":return{...l,...(0,r.Z)("Open in Private Window")};case"CONTEXT_CONTAINER_OPEN_IN_WINDOW":return l.settingsLabel=(0,a.Z)("[Open in Another Window]"),l.type="container",{...l,...(0,r.Z)("Open in Another Window")};case"CONTEXT_COPY":return{...l,...(0,r.Z)("win_linux","Copy")};case"CONTEXT_DELETE":return{...l,...(0,r.Z)("Delete from History")};case"CONTEXT_HIDE_SUGGESTIONS":return{...l,...(0,r.Z)("Hide Suggested Items")};default:return i.Z.getMenuItem(e,t,s)}}};const z={actions:function(){return["CONTEXT_COPY","CONTEXT_DELETE"]},options:function(e,t,n){const s=void 0===n,a={...o.Z.commandItem};switch(t.action){case"CONTEXT_COPY":return{...a,...(0,r.Z)("verb","Copy")};case"CONTEXT_COPY_ALL":return{...a,...(0,r.Z)("Copy Both")};case"CONTEXT_DELETE":return{...a,...(0,r.Z)("verb","Delete")};default:return i.Z.getMenuItem(e,t,s)}}};const j={actions:function(){return["DOCUMENT_LOOK_UP","DOCUMENT_EMOJI","DOCUMENT_UNDO","DOCUMENT_REDO","DOCUMENT_CUT","DOCUMENT_COPY","DOCUMENT_PASTE","DOCUMENT_PASTE_AS_PLAIN_TEXT","DOCUMENT_SELECT_ALL","DOCUMENT_CONTAINER_NOTES","DOCUMENT_CONTAINER_SPELLCHECK","DOCUMENT_CONTAINER_SPELLCHECK_OPTIONS","DOCUMENT_CONTAINER_SPEECH"]},options:function(e,t,n){const s=void 0===n,l={...o.Z.commandItem},d=n||g.Z.settingsState;switch(t.action){case"DOCUMENT_LOOK_UP":return{...l,...g.Z.getLabelWithParameter(e,t,d.printableselection,s)};case"DOCUMENT_EMOJI":return{...l,...(0,r.Z)("Emoji && Symbols")};case"DOCUMENT_UNDO":return{...l,shortcuts:["ctrl+z"],...(0,r.Z)("win_linux","Undo")};case"DOCUMENT_REDO":return{...l,shortcuts:["ctrl+y"],...(0,r.Z)("win_linux","Redo")};case"DOCUMENT_CUT":return{...l,shortcuts:["ctrl+x"],...(0,r.Z)("win_linux","Cut")};case"DOCUMENT_COPY":return{...l,shortcuts:["ctrl+c"],...(0,r.Z)("win_linux","Copy")};case"DOCUMENT_PASTE":return{...l,shortcuts:["ctrl+v"],...(0,r.Z)("win_linux","Paste")};case"DOCUMENT_PASTE_AS_PLAIN_TEXT":{const t=g.Z.getShortcuts(e,"COMMAND_CLIPBOARD_PASTE_AS_PLAIN_TEXT");return{...l,shortcuts:t,...(0,r.Z)("win_linux","Paste as Plain Text")}}case"DOCUMENT_SELECT_ALL":return{...l,shortcuts:["ctrl+a"],...(0,r.Z)("win_linux","Select All")};case"DOCUMENT_CONTAINER_NOTES":return l.settingsLabel=(0,a.Z)("[All notes]"),l.type="container",{...l,...(0,r.Z)("Insert Note")};case"DOCUMENT_CONTAINER_SPELLCHECK":return l.settingsLabel=(0,a.Z)("[Spell Check]"),l.type="container",{...l,...(0,r.Z)("Spell Check")};case"DOCUMENT_CONTAINER_SPELLCHECK_OPTIONS":return l.settingsLabel=(0,a.Z)("[Spell Check Options]"),l.type="container",{...l,...(0,r.Z)("Spell Check Options")};case"DOCUMENT_CONTAINER_WRITING_DIRECTION":return l.settingsLabel=(0,a.Z)("[Writing Direction Options]"),l.type="container",{...l,...(0,r.Z)("Writing Direction")};case"DOCUMENT_CONTAINER_SPEECH":return l.settingsLabel=(0,a.Z)("[Speech Commands]"),l.type="container",{...l,...(0,r.Z)("Speech")};default:return i.Z.getMenuItem(e,t,s)}}};var Y=n(21788);const X={actions:function(){return["DOCUMENT_LOOK_UP","DOCUMENT_EMOJI","DOCUMENT_UNDO","DOCUMENT_REDO","DOCUMENT_CUT","DOCUMENT_COPY","CONTEXT_COPY_FILTERED","DOCUMENT_PASTE","COMMAND_CLIPBOARD_PASTE_AS_PLAIN_TEXT_OR_PASTE_AND_GO","DOCUMENT_SELECT_ALL","DOCUMENT_CONTAINER_NOTES","DOCUMENT_CONTAINER_SPELLCHECK","DOCUMENT_CONTAINER_SPELLCHECK_OPTIONS","DOCUMENT_CUSTOMIZE","DOCUMENT_SHOW_FULL_ADDRESS","DOCUMENT_CONTAINER_SPEECH"]},options:function(e,t,n){const s=void 0===n,l={...o.Z.commandItem},d=n||g.Z.settingsState;switch(t.action){case"DOCUMENT_LOOK_UP":return{...l,...g.Z.getLabelWithParameter(e,t,d.printableselection,s)};case"DOCUMENT_EMOJI":return{...l,...(0,r.Z)("Emoji && Symbols")};case"DOCUMENT_UNDO":return{...l,shortcuts:["ctrl+z"],...(0,r.Z)("win_linux","Undo")};case"DOCUMENT_REDO":return{...l,shortcuts:["ctrl+y"],...(0,r.Z)("win_linux","Redo")};case"DOCUMENT_CUT":return{...l,shortcuts:["ctrl+x"],...(0,r.Z)("win_linux","Cut")};case"DOCUMENT_COPY":return{...l,shortcuts:["ctrl+c"],...(0,r.Z)("win_linux","Copy")};case"CONTEXT_COPY_FILTERED":case"COMMAND_CLIPBOARD_COPY_FILTERED":return{...l,isVisible:()=>s||Boolean(n?.selection.length),handler:()=>{n&&Y.Z.copyWithFilter(n.selection)},...(0,r.Z)("Copy without Parameters")};case"DOCUMENT_PASTE":return{...l,shortcuts:["ctrl+v"],...(0,r.Z)("win_linux","Paste")};case"DOCUMENT_SELECT_ALL":return{...l,shortcuts:["ctrl+a"],...(0,r.Z)("win_linux","Select All")};case"DOCUMENT_CONTAINER_NOTES":return l.settingsLabel=(0,a.Z)("[All notes]"),l.type="container",{...l,...(0,r.Z)("Insert Note")};case"DOCUMENT_CONTAINER_SPELLCHECK":return l.settingsLabel=(0,a.Z)("[Spell Check]"),l.type="container",{...l,...(0,r.Z)("Spell Check")};case"DOCUMENT_CONTAINER_SPELLCHECK_OPTIONS":return l.settingsLabel=(0,a.Z)("[Spell Check Options]"),l.type="container",{...l,...(0,r.Z)("Spell Check Options")};case"DOCUMENT_CONTAINER_WRITING_DIRECTION":return l.settingsLabel=(0,a.Z)("[Writing Direction Options]"),l.type="container",{...l,...(0,r.Z)("Writing Direction")};case"DOCUMENT_CUSTOMIZE":return l.ellipsis=!0,{...l,...(0,r.Z)("panel","Customize")};case"DOCUMENT_SHOW_FULL_ADDRESS":return l.type="checkbox",{...l,...(0,r.Z)("Show Full Address")};case"DOCUMENT_CONTAINER_SPEECH":return l.settingsLabel=(0,a.Z)("[Speech Commands]"),l.type="container",{...l,...(0,r.Z)("Speech")};default:return i.Z.getMenuItem(e,t,s)}}};const Q={actions:function(){return["CONTEXT_NEW","CONTEXT_NEW_STACK","CONTEXT_NEW_STACK_FOR_HOST","CONTEXT_TABSTACK_UNGROUP","CONTEXT_CLONE","CONTEXT_ACTIVATE","CONTEXT_RELOAD","CONTEXT_HIBERNATE","CONTEXT_PIN","CONTEXT_PIN_STACK","CONTEXT_UNPIN","CONTEXT_UNPIN_STACK","CONTEXT_TILE_TABS","CONTEXT_UNTILE_TAB","CONTEXT_UNTILE_TILE_GROUP","CONTEXT_MUTE","CONTEXT_MUTE_OTHER","CONTEXT_UNMUTE","CONTEXT_RENAME","CONTEXT_COPY","CONTEXT_SAVE","CONTEXT_SAVE_ALL","CONTEXT_EXPORT","CONTEXT_EXPORT_ALL","CONTEXT_DELETE","CONTEXT_EMPTY_TRASH","CONTEXT_REOPEN","CONTEXT_EXPAND_ALL","CONTEXT_COLLAPSE_ALL","CONTEXT_OPEN_IN_NEW_WINDOW","CONTEXT_OPEN_SYNC_ITEMS","CONTEXT_REGISTER_SYNC","CONTEXT_SIGNIN_SYNC"]},options:function(e,t,n){const s=n||{hostname:"",selectedCount:0,selectedStackableCount:0,isInTrashFolder:!1},a=void 0===n,l={...o.Z.commandItem};switch(t.action){case"CONTEXT_NEW":return{...l,...(0,r.Z)("command","New Tab")};case"CONTEXT_NEW_STACK":return{...l,...(0,r.Z)("Stack $1 Selected Tab","Stack $1 Selected Tabs",[s.selectedStackableCount])};case"CONTEXT_NEW_STACK_FOR_HOST":return{...l,...a?(0,r.Z)("Stack Tabs by Host"):(0,r.Z)("Stack Tabs by Host ($1)",[s.hostname])};case"CONTEXT_TABSTACK_UNGROUP":return{...l,...(0,r.Z)("Unstack Tabs")};case"CONTEXT_CLONE":return{...l,...(0,r.Z)("Duplicate")};case"CONTEXT_ACTIVATE":return{...l,...(0,r.Z)("Activate")};case"CONTEXT_RELOAD":return{...l,...(0,r.Z)("Reload")};case"CONTEXT_HIBERNATE":return{...l,...(0,r.Z)("Hibernate")};case"CONTEXT_PIN":case"CONTEXT_PIN_STACK":return{...l,...(0,r.Z)("Pin")};case"CONTEXT_UNPIN":case"CONTEXT_UNPIN_STACK":return{...l,...(0,r.Z)("Unpin")};case"CONTEXT_TILE_TABS":return{...l,...(0,r.Z)("Tile")};case"CONTEXT_UNTILE_TAB":return{...l,...(0,r.Z)("Untile")};case"CONTEXT_UNTILE_TILE_GROUP":return{...l,...(0,r.Z)("Untile All Tabs in Set")};case"CONTEXT_MUTE":return{...l,...(0,r.Z)("Mute")};case"CONTEXT_MUTE_OTHER":return{...l,...(0,r.Z)("Mute Others")};case"CONTEXT_UNMUTE":return{...l,...(0,r.Z)("Unmute")};case"CONTEXT_RENAME":return{...l,...(0,r.Z)("Rename")};case"CONTEXT_COPY":return{...l,...s.selectedCount>1?(0,r.Z)("Copy Links"):(0,r.Z)("Copy Link")};case"CONTEXT_SAVE":return{...l,...(0,r.Z)("Save as Bookmarks")};case"CONTEXT_SAVE_ALL":return{...l,...(0,r.Z)("Save All as Bookmarks")};case"CONTEXT_EXPORT":return{...l,...(0,r.Z)("Save as Session")};case"CONTEXT_EXPORT_ALL":return{...l,...(0,r.Z)("Save All as Session")};case"CONTEXT_DELETE":return{...l,...s.isInTrashFolder?(0,r.Z)("verb","Delete"):(0,r.Z)("Close")};case"CONTEXT_EMPTY_TRASH":return{...l,...(0,r.Z)("command","Clear All")};case"CONTEXT_REOPEN":return{...l,...(0,r.Z)("Reopen")};case"CONTEXT_EXPAND_ALL":return{...l,...(0,r.Z)("Expand All Folders")};case"CONTEXT_COLLAPSE_ALL":return{...l,...(0,r.Z)("Collapse All Folders")};case"CONTEXT_OPEN_IN_NEW_WINDOW":return{...l,...(0,r.Z)("Open in a New Window")};case"CONTEXT_OPEN_SYNC_ITEMS":return{...l,...(0,r.Z)("Open")};case"CONTEXT_REGISTER_SYNC":return{...l,...(0,r.Z)("Create Account")};case"CONTEXT_SIGNIN_SYNC":return{...l,...(0,r.Z)("Log In")};default:return i.Z.getMenuItem(e,t,a)}}};const q={actions:function(){return["CONTEXT_WORKSPACE_RENAME","CONTEXT_WORKSPACE_DELETE","CONTEXT_WORKSPACE_OPEN_IN_NEW_WINDOW","CONTEXT_WORKSPACE_HIBERNATE"]},options:function(e,t,n){const s={...o.Z.commandItem};switch(t.action){case"CONTEXT_WORKSPACE_RENAME":return{...s,...(0,r.Z)("Rename Workspace")};case"CONTEXT_WORKSPACE_DELETE":return{...s,...(0,r.Z)("Delete Workspace")};case"CONTEXT_WORKSPACE_OPEN_IN_NEW_WINDOW":return{...s,...(0,r.Z)("Open in a New Window")};case"CONTEXT_WORKSPACE_HIBERNATE":return{...s,...n?(0,r.Z)("Hibernate Workspace"):(0,r.Z)("Hibernate Tabs")};default:return i.Z.getMenuItem(e,t,!1)}}};var J=n(92292),ee=n(7064);const te=[{name:(0,a.Z)("Web Page"),group:"8",indent:0,sort:!0},{name:(0,a.Z)("Mail"),group:"6",indent:0,sort:!0},{name:(0,a.Z)("section","Start page"),group:"1",indent:0,sort:!0},{name:(0,a.Z)("Panels"),group:"4",indent:0,sort:!0},{name:(0,a.Z)("Tabs"),group:"2",indent:0,sort:!0},{name:(0,a.Z)("Bookmarks"),group:"5",indent:0,sort:!0},{name:(0,a.Z)("context","Address Bar"),group:"3",indent:0,sort:!1},{name:(0,a.Z)("Other"),group:"7",indent:0,sort:!0}],ne={mailandfeeds:{name:(0,a.Z)("Mail and Feeds"),group:"1",...A},tab:{name:(0,a.Z)("context","Tab"),group:"2",...G},tabstackthumbnails:{name:(0,a.Z)("Tab Stack Thumbnails"),group:"2",...H},tabbar:{name:(0,a.Z)("context","Tab Bar"),group:"2",...U},closedtab:{name:(0,a.Z)("Tab Trash Can"),group:"2",...p},taboverflow:{name:(0,a.Z)("Tab Overflow"),group:"2",...V},windowlist:{name:(0,a.Z)("Window List"),group:"2",...Q},bookmarkbar:{name:(0,a.Z)("Bookmark Bar"),group:"5",...c},bookmarkbaritem:{name:(0,a.Z)("Bookmark Bar Button"),group:"5",...d},bookmarklist:{name:(0,a.Z)("Bookmark List"),group:"5",...u},panelbar:{name:(0,a.Z)("Panel Bar"),group:"4",...D},panelbaritem:{name:(0,a.Z)("Panel Bar Button"),group:"4",...P},backwardbutton:{name:(0,a.Z)("Back Button"),group:"3",...k},forwardbutton:{name:(0,a.Z)("Forward Button"),group:"3",...k},rewindbutton:{name:(0,a.Z)("Rewind Button"),group:"3",...k},fastforwardbutton:{name:(0,a.Z)("Fast Forward Button"),group:"3",...k},reloadbutton:{name:(0,a.Z)("Reload Button"),group:"3",...k},homebutton:{name:(0,a.Z)("Home Button"),group:"3",...k},urledit:{name:(0,a.Z)("Text Field"),group:"3",...X},speeddialitem:{name:(0,a.Z)("Speed Dial Button"),group:"1",...B},startpage:{name:(0,a.Z)("context","Start Page"),group:"1",...W},startpagebar:{name:(0,a.Z)("Start Page Bar"),group:"1",...F},topsite:{name:(0,a.Z)("Top Sites"),group:"1",...K},shortcut:{name:(0,a.Z)("Bookmarks"),group:"1",...R},shortcutfolder:{name:(0,a.Z)("Bookmarks Folder"),group:"1",...L},tip:{name:(0,a.Z)("Tip"),group:"1",...$},mailheader:{name:(0,a.Z)("Message Header"),group:"6",...T},mailpanellist:{name:(0,a.Z)("mail","Panel"),group:"6",...Z},mailsearchlist:{name:(0,a.Z)("Message List"),group:"6",...E},mailcontent:{name:(0,a.Z)("Message Content"),group:"6",...I},contactlist:{name:(0,a.Z)("Contacts"),group:"6",...h},noteslist:{name:(0,a.Z)("Notes List"),group:"7",..._},historylist:{name:(0,a.Z)("History List"),group:"7",...v},downloadlist:{name:(0,a.Z)("Download List"),group:"7",...f},translatehistory:{name:(0,a.Z)("Translate History"),group:"7",...z},readinglist:{name:(0,a.Z)("Reading List"),group:"7",...M},sessioncontentlist:{name:(0,a.Z)("Session Content List"),group:"7",...O},sessionlist:{name:(0,a.Z)("Session List"),group:"7",...x},uiedit:{name:(0,a.Z)("Text Field"),group:"7",...j},workspacelist:{name:(0,a.Z)("Workspace List"),group:"7",...q},link:{name:(0,a.Z)("Link"),group:"8",...C},image:{name:(0,a.Z)("Image"),group:"8",...y},page:{name:(0,a.Z)("Page"),group:"8",...N},selection:{name:(0,a.Z)("context","Selection"),group:"8",...w},docedit:{name:(0,a.Z)("Text Field"),group:"8",...m},audiovideo:{name:(0,a.Z)("Audio and Video"),group:"8",...l}},ie=()=>Object.keys(ne),se=e=>te.some((t=>t.group===e)),oe=e=>{if(se(e)){const t=te.findIndex((t=>t.group===e));return te[t].name}return ne[e].name},ae=e=>ne[e].options,re=e=>ne[e].actions;function le(e,t,n,i,s){const o=ae(t);if(o){const t=t=>Promise.resolve(o(e,t));return de(e,i,n||t,s)}return Promise.resolve([])}function de(e,t,n,i){return Promise.all(t.map((t=>n(t).then((s=>{let a=o.Z.commandItem;switch(t.type){case"folder":a={...s,type:t.type,id:t.id,items:[],commandName:t.action};break;case"command":case"checkbox":a={...s,type:t.type,id:t.id,commandName:t.action};break;case"radio":break;case"container":i.expandContainers?s.container?(s.container.cpp=!0,s.container.mode=t.containermode||"folder",s.container.edge=t.containeredge||"off",a={type:t.type,id:t.id,...s}):"inline"===t.containermode?(s.items||(s.items=[]),a={...s,type:"container",id:t.id}):"folder"===t.containermode&&(delete s.type,a={...s,type:"folder",id:t.id}):(s.container={content:t.action,mode:t.containermode,edge:t.containeredge,cpp:!1},a={...s,type:t.type,id:t.id,commandName:t.action});break;case"separator":a={...o.Z.separatorItem,id:t.id}}void 0!==t.title&&(a.label&&(a.label=t.title),a.labelEnglish&&(a.labelEnglish=t.title),a.settingsLabel&&delete a.settingsLabel,a.ellipsis=!1),void 0!==t.custom&&(a.custom=t.custom),a.showshortcut=t.showshortcut;const r=t.children;return"folder"!==t.type||!r||s.isVisible&&!s.isVisible(e,i.inSettings)?a:de(e,r,n,i).then((e=>(a.items?.push(...e),a)))}))))).then((t=>t.reduce(((t,n)=>n.isVisible&&!n.isVisible(e,i.inSettings)?[...t]:"container"===n.type&&n.items&&i.expandContainers?[...t,...n.items]:[...t,n]),[])))}const ce={isSection:se,getKeys:ie,getSettingsList:()=>{const e={};Object.keys(ne).forEach((t=>{const n=ne[t];e[n.group]||(e[n.group]=[]),e[n.group].push(t)}));let t=[];return te.forEach((n=>{if(e[n.group]){const i={key:n.group,indent:n.indent,name:n.name},s=e[n.group].map((e=>({key:e,indent:n.indent+1,name:oe(e)}))).sort(((e,t)=>!1===n.sort?0:e.name<t.name?-1:e.name>t.name?1:0));s&&s.length>0&&(t=[...t,i,...s])}})),t},getNamedMenu:(e,t,n)=>new Promise((i=>{ee.Z.menuContent.get(t,((s,o,a)=>{J.Z.runtime.lastError?(console.warn("Failed to read menu spec. Attempting fallback for menu key:",t),ee.Z.menuContent.reset(t,!0,void 0,(()=>{ee.Z.menuContent.get(t,((s,o,a)=>{void 0===J.Z.runtime.lastError?i(le(e,t,n,a,{expandContainers:!0,inSettings:!1,updateCallbacks:!1})):(console.warn("fallback failed"),i([]))}))}))):i(le(e,t,n,a,{expandContainers:!0,inSettings:!1,updateCallbacks:!1}))}))})),makeMenuWithContent:(e,t,n,i)=>le(e,t,void 0,n,i),makeCommandList:(e,t)=>{if(void 0===ne[t])return[];const n={id:"",type:"command",action:""},s=ae(t);return re(t)().map((t=>(n.type=i.Z.getIsContainer(t)?"container":"command",n.action=t,{commandName:t,...s(e,n),id:t})))},hasName:e=>ie().includes(e)||se(e),getName:oe,getOptionFunction:ae,getActionList:re},ue=ce},20676:(e,t,n)=>{"use strict";n.d(t,{Z:()=>p});var i=n(76747),s=n(96951),o=n(14481),a=n(32921),r=n(26036),l=n(35369),d=n(36436);const c=[1,2,5,10,30,60,90],u=(e,t,n)=>{const u=s.ZP.getPageByReloadId(e);if("tab"===t&&u&&(0,d.xl)(u.url))return[];const p=a.Z.getAlarmFromReloadId(e),h="stack"===t?s.ZP.getGroup(e,n).groupBy((e=>a.Z.getAlarmFromReloadId(e.vivExtData.ext_id)?.periodInMinutes??0)).toArray().sort((([,e],[,t])=>e.size-t.size)):[],g="stack"===t?h.findLast((([e,t])=>e>0))?.[0]:p?.periodInMinutes,m="number"==typeof g,f="panel"===t?"panel":"tab",v=c.map((i=>({type:"checkbox",checked:g===i,handler:()=>{let r;if("stack"===t)r=s.ZP.getGroup(e,n).filter((e=>!(0,d.xl)(e.url))),m&&h.length>1&&(r=r.filter((e=>a.Z.getAlarmFromReloadId(e.vivExtData.ext_id)?.periodInMinutes!==g)));else if("select"===t)r=s.ZP.getSelectedPages(n).filter((e=>!(0,d.xl)(e.url)));else{if("tab"!==t){const t={alarm:p,id:e,interval:i,from:f};return void o.Z.createOrDestroyAlarm(t)}r=u?l.aV.of(u):(0,l.aV)()}r.forEach((e=>{const t=e.vivExtData.ext_id;if(t){const e={alarm:a.Z.getAlarmFromReloadId(t),id:t,interval:i,from:f};o.Z.createOrDestroyAlarm(e)}}))},commandName:"PERIODIC_RELOAD",parameter:i.toString(),...(0,r.Z)("$1 Minute","$1 Minutes",[i])})));return[...v,...[i.Z.separatorItem,{isVisible:()=>Boolean(p?.id.includes(e)),handler:()=>{o.Z.destroyPeriodicAlarm({ids:[e],from:f})},commandName:"PERIODIC_RELOAD_DISABLE",parameter:"",...(0,r.Z)("timer","Disable")},{isVisible:()=>"stack"===t&&m,handler:()=>{const e=h.flatMap((([e,t])=>e?t.map((e=>e.vivExtData.ext_id)).toArray():[]));o.Z.destroyPeriodicAlarm({ids:e,from:f})},commandName:"PERIODIC_RELOAD_DISABLE",parameter:"all",...(0,r.Z)("timers","Disable All Inside Stack")},{isVisible:()=>a.Z.existingAlarms(),handler:()=>{"panel"===f?o.Z.destroyAllPanelPeriodicAlarms():o.Z.destroyTabPeriodicAlarms(n)},commandName:"PERIODIC_RELOAD_DISABLE",parameter:"all",...(0,r.Z)("timers","Disable All")}]]},p={getForActivePage:e=>{const t=s.ZP.getActivePage(e),n=t?t.vivExtData.ext_id:void 0;return n?u(n,"tab",e):[]},getMenu:u,getHandlerByAction:(e,t,n)=>{let i;switch(t){case"PERIODIC_RELOAD":const t=s.ZP.getActivePage(e),r=t?t.vivExtData.ext_id:"";if(r){const e=a.Z.getAlarmFromReloadId(r),t=parseInt(n);i=()=>o.Z.createOrDestroyAlarm({alarm:e,id:r,interval:t,from:"tab"})}break;case"PERIODIC_RELOAD_DISABLE":if("all"===n)i=()=>o.Z.destroyTabPeriodicAlarms(e);else{const t=s.ZP.getActivePage(e),n=t?t.vivExtData.ext_id:"";n&&(i=()=>o.Z.destroyPeriodicAlarm({ids:[n],from:"tab"}))}}return i}}},19718:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var i=n(25795),s=n(76747),o=n(30992),a=n(56371),r=n(26036);const l={actions:function(){return["DOCUMENT_CONTAINER_DEVELOPER_TOOLS","DOCUMENT_VALIDATE_URL","DOCUMENT_VIEW_SOURCE","DOCUMENT_VIEW_FRAME_SOURCE","DOCUMENT_RELOAD_FRAME","DOCUMENT_INSPECT"]},options:function(e,t,n){const l=void 0===n,d=n||o.Z.settingsState,c={...s.Z.commandItem};switch(t.action){case"DOCUMENT_CONTAINER_DEVELOPER_TOOLS":return c.settingsLabel=(0,a.Z)("[Developer Tools]"),c.type="container",{...c,...(0,r.Z)("Developer Tools")};case"DOCUMENT_VALIDATE_URL":return{...c,...(0,r.Z)("Validate")};case"DOCUMENT_VIEW_SOURCE":{const t=o.Z.getShortcuts(e,"COMMAND_TAB_VIEW_PAGE_SOURCE");return{...c,shortcuts:d.iswebpanel?[]:t,...d.iswebpanel?(0,r.Z)("View Panel Source"):(0,r.Z)("View Page Source")}}case"DOCUMENT_VIEW_FRAME_SOURCE":return{...c,...(0,r.Z)("View Frame Source")};case"DOCUMENT_RELOAD_FRAME":return{...c,...(0,r.Z)("Reload Frame")};case"DOCUMENT_INSPECT":{const t=o.Z.getShortcuts(e,"COMMAND_DEVELOPER_TOOLS");return{...c,shortcuts:d.iswebpanel?[]:t,...(0,r.Z)("Inspect")}}default:return i.Z.getMenuItem(e,t,l)}}}},30992:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var i=n(25795),s=n(76747),o=n(39206),a=n(15489),r=n(26036);const l=new Map;function d(e,t){const n=l.get(e),i=o.Z.getDefault(a.ZP.isIncognito(e));if(t&&n){return o.Z.getByGuid(n)||i}return i}const c={settingsState:{linkurl:"",linktitle:"",pageurl:"",pagetitle:"",srcurl:"",selection:"",printableselection:"",selectionurl:"",keywordurl:"",isdevtools:!1,iseditable:!1,isimage:!1,isframe:!1,ismailcontent:!1,iswebpanel:!1,iswebpagewidget:!1,ismailto:!1,support:{copy:!1,audio:!1,canvas:!1,editoptions:!1,emoji:!1,extensions:!1,highlight:!1,pictureinpicture:!1,password:!1,passwordgeneration:!1,passwordshowall:!1,paste:!1,plugin:!1,qrcode:!1,sendtodevices:!1,video:!1},textfield:"document"},getLabelWithParameter:function(e,t,n,i){switch(t.action){case"DOCUMENT_LOOK_UP":if(t.title){const e=t.title;return delete t.title,{...i?s.Z.makeLabelPair(e):s.Z.makeLabelPair(e.replace("$1",n))}}return{...i?(0,r.Z)("Look Up “$1”"):(0,r.Z)("Look Up “$1”",[n])};case"DOCUMENT_GOTO_URL":if(t.title){const e=t.title;return delete t.title,{...i?s.Z.makeLabelPair(e):s.Z.makeLabelPair(e.replace("$1",n))}}return{...i?(0,r.Z)("Go to “$1”"):(0,r.Z)("Go to “$1”",[n])};case"DOCUMENT_SEARCH":case"DOCUMENT_SEARCH_LAST_USED":{const o="DOCUMENT_SEARCH_LAST_USED"===t.action,a=d(e,o),l=a?a.name:"";if(t.title){const e=t.title;return delete t.title,{...i&&a?s.Z.makeLabelPair(e):s.Z.makeLabelPair(e.replace("$1",l).replace("$2",n))}}return i?o?{...(0,r.Z)("Search $1 for “$2” (With Last Used Engine)")}:{...(0,r.Z)("Search $1 for “$2”")}:{...(0,r.Z)("Search $1 for “$2”",[l,n])}}default:return s.Z.makeLabelPair("")}},setSearchEngine:function(e,t){l.set(e,t.guid)},getSearchEngine:d,getShortcuts:function(e,t){return i.Z.getMenuItem(e,{id:"",type:"command",action:t},!0).shortcuts||[]}}},1068:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var i=n(67294),s=n(48521);const o=function(e){return class extends i.Component{state={disabled:!0};componentDidMount(){this.timeout=setTimeout(this.enable,1e3)}componentWillUnmount(){clearTimeout(this.timeout)}enable=()=>this.setState({disabled:this.props.disabled||!1});render(){const{disabled:t,...n}=this.props,i=e||"input";return(0,s.jsx)(i,{...n,disabled:this.state.disabled})}}}},73132:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o,g:()=>s});var i=n(78614);const s="/resources/contact-person.png";function o(e){const t={toString:function(){return(0,i.gU)(this)},isEmpty:function(){return!(this.name||0!==this.emailAddresses.length||this.birthday||this.note||0!==this.postalAddresses.length||0!==this.phoneNumbers.length||this.avatarUrl)},clearGenerated:function(){this.generatedFromSentMail&&(this.generatedFromSentMail=!1)}};return Object.assign(Object.create(t),e)}},57118:(e,t,n)=>{"use strict";n.d(t,{$c:()=>v,Au:()=>y,BO:()=>m,EE:()=>l,EK:()=>f,N4:()=>u,UQ:()=>b,V9:()=>d,Y3:()=>c,Zg:()=>o,bb:()=>g,bz:()=>S,cX:()=>r,h6:()=>p,qk:()=>a,sB:()=>h,sg:()=>w});var i=n(56371),s=n(86088);const o="DASHBOARD_WIDGET",a="DASHBOARD_NEW_BUTTON",r=24,l=204,d=394,c={stiffness:210,damping:20,precision:.1},u="-99",p={id:u,title:(0,i.Z)("Dashboard"),bookmarkbar:!1,children:[],description:"",nickname:"",partner:"",speeddial:!0,themeColor:"",thumbnail:"",trash:!1},h={calendar:{icon:s.Ase,defaultTitle:(0,i.Z)("Calendar Agenda"),requiresMailEnabled:!0,size:"double_height",singular:!1},email:{icon:s.ms3,defaultTitle:(0,i.Z)("Latest Emails"),requiresMailEnabled:!0,size:"double_height",singular:!1},"sticky-note":{icon:s.mdK,defaultTitle:(0,i.Z)("Sticky Note"),requiresMailEnabled:!1,size:"regular",singular:!1},shortcuts:{icon:s.mX1,defaultTitle:(0,i.Z)("Bookmarks"),requiresMailEnabled:!1,size:"regular",singular:!1},tasks:{icon:s.tDC,defaultTitle:(0,i.Z)("Tasks"),requiresMailEnabled:!0,size:"regular",singular:!1},tip:{icon:s.qe_,defaultTitle:(0,i.Z)("Tip of the Day"),requiresMailEnabled:!1,size:"regular",singular:!0},feed:{icon:s.L_F,defaultTitle:(0,i.Z)("Feeds"),requiresMailEnabled:!0,size:"double_height",singular:!1},"top-sites":{icon:s.ObT,defaultTitle:(0,i.Z)("Top Sites"),requiresMailEnabled:!1,size:"regular",singular:!0},"privacy-stats":{icon:s.jcS,defaultTitle:(0,i.Z)("Privacy Statistics"),requiresMailEnabled:!1,size:"regular",singular:!0},webpage:{icon:s.LQS,defaultTitle:(0,i.Z)("Webpage"),requiresMailEnabled:!1,size:"double_height",singular:!1},date:{icon:s.N6b,defaultTitle:(0,i.Z)("Date"),requiresMailEnabled:!1,size:"regular",singular:!0},weather:{icon:s.pUr,defaultTitle:(0,i.Z)("Weather"),requiresMailEnabled:!1,size:"double_height",singular:!1}},g=10,m={...{sameDay:(0,i.Z)("[Today] $1",["LT"]),lastDay:(0,i.Z)("[Yesterday] $1",["LT"]),nextDay:(0,i.Z)("[Tomorrow]",["LT"]),nextWeek:(0,i.Z)("[Next] $1",["dddd"]),lastWeek:"dddd LT",sameElse:"LL LT"},lastWeek:"ddd LT",sameElse:"L LT"},f=[{url:"https://vivaldi.com/feed/",title:(0,i.Z)("Vivaldi Browser Feed")}],v=void 0,y="transparent",b="semi-transparent",S="solid",w="custom"},64473:(e,t,n)=>{"use strict";n.d(t,{Z:()=>g,t:()=>u});var i,s=n(67294),o=n(63377),a=n(84451),r=n(94283),l=n(52250),d=n(48521);function c(e,t,n,s){i||(i="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=s;else if(a>1){for(var r=new Array(a),l=0;l<a;l++)r[l]=arguments[l+3];t.children=r}if(t&&o)for(var d in o)void 0===t[d]&&(t[d]=o[d]);else t||(t=o||{});return{$$typeof:i,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const u="modal-dialog-title";var p=c("div",{className:"modal-faded-background"});class h extends s.Component{static contextType=r.Z;focusTrapRef=s.createRef();modalRef=s.createRef();componentDidMount(){this.props.ignoreEscape||a.Z.bind("meta+.",this.closeModalHandler);const{label:e,labelledBy:t,title:n,a11yIgnored:i}=this.props}componentWillUnmount(){this.props.ignoreEscape||a.Z.unbind("meta+.",this.closeModalHandler)}getNode(){return this.modalRef.current}closeModalHandler=()=>{this.props.onRequestClose()};handleClickOutside=e=>{this.props.ignoreClickOutside&&!e.target.closest(".window-close")||this.props.onRequestClose(e)};keyDownModal=e=>{"Escape"!==e.key||this.props.ignoreEscape||(e.preventDefault(),e.stopPropagation(),this.props.onRequestClose(e.nativeEvent))};renderBackground=()=>p;render(){const{labelledBy:e,label:t,title:n,a11yIgnored:i,asToolbar:s,className:a}=this.props,r=a?a.split(" "):[],l=(r.includes("float")||r.includes("onboarding"))&&!r.includes("no-fade-background"),p={};return i||(p.role=s?"toolbar":"dialog",t||""===t?p["aria-label"]=t:(e||n)&&(p["aria-labelledby"]=e||u)),(0,d.jsxs)(d.Fragment,{children:[l&&this.renderBackground(),(0,d.jsx)(o.Z,{focusName:"focus_modal",forceTrap:!s,id:"modal-bg",ref:this.focusTrapRef,className:a||"slide",style:this.props.style,onKeyDown:this.keyDownModal,children:(0,d.jsxs)("div",{ref:this.modalRef,className:"modal-wrapper","aria-modal":s?"false":"true",...p,children:[n&&c("div",{className:"dialog-header"},void 0,c("h1",{className:"dialog-title",id:u},void 0,n)),this.props.children]})})]})}}const g=(0,l.Z)(h)},71193:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var i=n(96951),s=n(29087),o=n(35369),a=n(89175);function r(e){const t=i.ZP.getActiveWorkspace(e),n=i.ZP.getPages(e,{workspaceId:t});if(s.Z.get(a.kTabsCycleByRecentOrder)){const t=i.ZP.getPageHistory(e);return(0,o.aV)(t.map((e=>n.find((t=>t.id===e)))).filter(Boolean).reverse())}return n}},80837:(e,t,n)=>{"use strict";n.d(t,{Z:()=>C});var i,s=n(67294),o=n(47995),a=n(64473),r=n(15285),l=n(68247),d=n(29087),c=n(86461),u=n(94283),p=n(56371),h=n(82313),g=n(25372),m=n(29526),f=n(1068),v=n(89175),y=n(48521);function b(e,t,n,s){i||(i="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=s;else if(a>1){for(var r=new Array(a),l=0;l<a;l++)r[l]=arguments[l+3];t.children=r}if(t&&o)for(var d in o)void 0===t[d]&&(t[d]=o[d]);else t||(t=o||{});return{$$typeof:i,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const S=(0,f.Z)("input");class w extends s.Component{static contextType=u.Z;refDefaultAction=s.createRef();state={askNextTime:!1};componentDidMount(){this.refDefaultAction.current?.focus()}maybeShowDownloads(){const e=this.context.vivaldiWindowId;!r.ZP.getIsVisible(e,"PanelDownloads")&&d.Z.get(v.kDownloadsOpenPanelOnNew)&&o.Z.executeActions("button",this.context,c.ZP.isComponentVisible("DownloadButton",e)?"COMMAND_SHOW_DOWNLOADS_POPOUT":"COMMAND_SHOW_DOWNLOADS_PANEL")}onOpen=()=>{this.props.customData.request.allow("open"),this.maybeShowDownloads(),this.close()};onSave=()=>{this.props.customData.request.allow(),this.maybeShowDownloads(),this.close()};onSaveAs=()=>{this.props.customData.request.allow("saveas"),this.maybeShowDownloads(),this.close()};onCancel=()=>{this.props.customData.request.deny(),this.close()};close=()=>{!0!==this.props.customData.mixedDownload&&l.Z.set(v.kDownloadsStartAutomatically,this.state.askNextTime),this.props.onClose()};onAskDownloadChanged=({target:e})=>{this.setState({askNextTime:e.checked})};getHostAndPathname=()=>{const e=(0,m.Z)(this.props.customData.url);let t="",n="";const i=(0,g.Z)(e);return i&&({hostname:t,pathname:n}=i),{hostname:t,pathname:n}};render(){const e=this.props.customData.url.startsWith("data:");let t="",n="";this.props.customData.suggestedFilename&&e||({hostname:t,pathname:n}=this.getHostAndPathname());const i=this.props.customData.suggestedFilename?this.props.customData.suggestedFilename:(n||"").split("/").pop(),s=e?(0,p.Z)("Data URL"):t,o=-1===this.props.customData.fileSize?(0,p.Z)("Unknown"):(0,h.Z)(this.props.customData.fileSize);return b(a.Z,{ignoreClickOutside:!0,ignoreEscape:!1,onRequestClose:this.onCancel,className:"dialog-download slide",title:(0,p.Z)("Download “$1”?",[i])},void 0,b("div",{className:"dialog-content"},void 0,b("p",{},void 0,b("span",{className:"label",title:i},void 0,(0,p.Z)("File Name:")),b("span",{className:"selectable"},void 0,i)),b("p",{},void 0,b("span",{className:"label"},void 0,(0,p.Z)("File Size:")),b("span",{className:"selectable"},void 0,o)),b("p",{},void 0,b("span",{className:"label"},void 0,(0,p.Z)("Host:")),b("span",{className:"selectable"},void 0,s)),b("p",{},void 0,b("span",{className:"label"},void 0,(0,p.Z)("Location:")),b("span",{className:"selectable"},void 0,d.Z.get(v.kDownloadDefaultDirectory))),!0===this.props.customData.mixedDownload?b("p",{},void 0,b("span",{className:"labelwarning"},void 0,(0,p.Z)("The download is insecure, be careful with its content."))):b("label",{className:"autosave"},void 0,b("input",{type:"checkbox",onChange:this.onAskDownloadChanged}),b("span",{},void 0,(0,p.Z)("Always Save Files to Default Download Location")))),b("footer",{className:"dialog-footer"},void 0,(0,y.jsx)("input",{type:"button",className:"primary",onClick:this.onSave,ref:this.refDefaultAction,value:(0,p.Z)("Save")}),b("input",{type:"button",onClick:this.onSaveAs,value:(0,p.Z)("Save As...")}),b(S,{type:"button",onClick:this.onOpen,value:(0,p.Z)("Open")}),b("input",{type:"button",onClick:this.onCancel,value:(0,p.Z)("Cancel")})))}}const C=w},8874:(e,t,n)=>{"use strict";n.d(t,{U:()=>p,Z:()=>h});n(67294);var i,s=n(56371),o=n(82313),a=n(30381),r=n.n(a);function l(e,t,n,s){i||(i="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=s;else if(a>1){for(var r=new Array(a),l=0;l<a;l++)r[l]=arguments[l+3];t.children=r}if(t&&o)for(var d in o)void 0===t[d]&&(t[d]=o[d]);else t||(t=o||{});return{$$typeof:i,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const d="in_progress",c="complete",u="interrupted";function p(e){switch(e){case"FILE_NO_SPACE":return(0,s.Z)("Disk is full");case"FILE_TOO_LARGE":return(0,s.Z)("File too large");case"FILE_FAILED":return(0,s.Z)("Download error");case"FILE_ACCESS_DENIED":return(0,s.Z)("Insufficient permissions");case"FILE_NAME_TOO_LONG":return(0,s.Z)("Path too long");case"FILE_VIRUS_INFECTED":return(0,s.Z)("Virus detected");case"FILE_TRANSIENT_ERROR":return(0,s.Z)("System busy");case"FILE_BLOCKED":return(0,s.Z)("Blocked");case"FILE_SECURITY_CHECK_FAILED":return(0,s.Z)("Virus scan failed");case"FILE_TOO_SHORT":return(0,s.Z)("File truncated");case"FILE_SAME_AS_SOURCE":return(0,s.Z)("Already downloaded");case"FILE_HASH_MISMATCH":return(0,s.Z)("Hash mismatch");case"NETWORK_FAILED":return(0,s.Z)("Network");case"NETWORK_TIMEOUT":return(0,s.Z)("Timeout");case"NETWORK_DISCONNECTED":return(0,s.Z)("Disconnected");case"NETWORK_SERVER_DOWN":return(0,s.Z)("Server unavailable");case"NETWORK_INVALID_REQUEST":return(0,s.Z)("Invalid network request");case"SERVER_FAILED":return(0,s.Z)("Server failed");case"SERVER_NO_RANGE":return(0,s.Z)("Server does not support range");case"SERVER_BAD_CONTENT":return(0,s.Z)("The server could not find the file");case"SERVER_UNAUTHORIZED":return(0,s.Z)("Unauthorized");case"SERVER_CERT_PROBLEM":return(0,s.Z)("Certificate problem");case"SERVER_FORBIDDEN":return(0,s.Z)("Forbidden");case"SERVER_UNREACHABLE":return(0,s.Z)("Unreachable");case"SERVER_CONTENT_LENGTH_MISMATCH":return(0,s.Z)("Content length mismatch");case"SERVER_CROSS_ORIGIN_REDIRECT":return(0,s.Z)("Cross origin redirect");case"USER_CANCELED":return(0,s.Z)("Cancelled");case"USER_SHUTDOWN":return(0,s.Z)("Shutdown");case"CRASH":return(0,s.Z)("Crashed")}return e}function h({item:e}){const t=(new Date).getTime()+2e3,n=e.estimatedEndTime?new Date(e.estimatedEndTime).getTime():NaN,i=e.state===d,a=e.bytesReceived,{currentHumanized:h,endHumanized:g}=function(e,t){let n=(0,o.Z)(e);const i=(0,o.Z)(t||e);return n.split(" ")[1]===i.split(" ")[1]&&(n=n.split(" ")[0]),{currentHumanized:n,endHumanized:i}}(a,e.totalBytes),m=function(e,t,n){return e&&t>n?r()(t).fromNow():e&&t<=n?(0,s.Z)("about a second"):""}(i,n,t),f=(0,s.Z)("$1/s",[(0,o.Z)(e.currentSpeed)]),v=e.paused||e.state===u,y=e.error?p(e.error):"",b=v?(0,s.Z)("$1 of $2 - stopped",[h,g]):(0,s.Z)("$1 of $2 at $3",[h,g,f]);return l("div",{className:"DownloadItem-FileSize"},void 0,e.state===c?g:e.error?y:b,m&&` (${m})`)}},20743:(e,t,n)=>{"use strict";n.d(t,{Z:()=>U,C:()=>H});var i=n(67294),s=n(65792),o=n.n(s),a=n(84451),r=n(46382),l=n(94283),d=n(94184),c=n.n(d),u=n(52250),p=n(7064),h=n(48521);class g extends i.Component{static contextType=l.Z;state={width:28,height:28,hasLoadedPopup:!1};constructor(e,t){super(e),this.portalContainer=t.document.getElementById("browser")}popupContainer=i.createRef();webviewelm=null;componentWillUnmount(){this.detachListeners(),this.webviewelm=null}getNode(){return this.popupContainer.current}attachListeners=()=>{this.webviewelm?.addEventListener("sizechanged",this.onSizeChanged),this.webviewelm?.addEventListener("close",this.onClose),this.webviewelm?.addEventListener("newwindow",this.onNewWindow),this.webviewelm?.addEventListener("loadstop",this.onLoadStop),this.webviewelm?.addEventListener("dialog",this.onShowDialog),a.Z.bind("esc",this.onCloseWithKeyboard)};focusPopup=()=>{const e=this.popupContainer.current?.parentElement?.parentElement?.parentElement?.querySelector(".focus-popup-area");e&&e.focus()};detachListeners=()=>{this.webviewelm?.removeEventListener("sizechanged",this.onSizeChanged),this.webviewelm?.removeEventListener("close",this.onClose),this.webviewelm?.removeEventListener("newwindow",this.onNewWindow),this.webviewelm?.removeEventListener("loadstop",this.onLoadStop),this.webviewelm?.removeEventListener("dialog",this.onShowDialog),a.Z.unbind("esc",this.onCloseWithKeyboard)};handleClickOutside=e=>{this.props.popupWantsToClose()};removeWebView=()=>{this.detachListeners(),this.webviewelm&&(this.popupContainer.current?.removeChild(this.webviewelm),this.popupContainer.current?.remove(),this.webviewelm=null),this.setState({hasLoadedPopup:!1})};recreateWebView=()=>{const{document:e}=this.context;this.webviewelm&&this.removeWebView(),p.Z.zoom.getVivaldiUIZoom((t=>{const n=this.popupContainer.current;if(!n)return;this.portalContainer?.appendChild(n);let i=800,s=600;t>=1&&(i=Math.round(800*t),s=Math.round(600*t));const{extensionId:o,popupPage:a}=this.props;if(o&&a){const t=e.createElement("webview");t.setAttribute("windowId",String(this.context.vivaldiWindowId)),t.setAttribute("autosize","on"),t.setAttribute("minwidth",String(28)),t.setAttribute("minheight",String(28)),t.setAttribute("maxwidth",String(i)),t.setAttribute("maxheight",String(s)),t.setAttribute("partition","persist:"+o),t.setAttribute("class","ignore-react-onclickoutside"),t.setAttribute("vivaldi_view_type","extension_popup"),t.setAttribute("src",a),n?.appendChild(t),this.webviewelm=t,this.attachListeners()}}))};onSizeChanged=e=>{this.setState({width:e.newWidth,height:e.newHeight})};onLoadStop=e=>{this.props.enableOnClickOutside(),this.setState({hasLoadedPopup:!0}),setTimeout((e=>{this.webviewelm&&this.webviewelm.focus()}),50)};onNewWindow=e=>{e.window.accept(this.context.vivaldiWindowId+";1"),this.props.popupWantsToClose()};onShowDialog=e=>{this.props.disableOnClickOutside?.(),e.webview=this.webviewelm,e.preventDefault(),e.dialogtype="javascript",r.Z.showDialog(this.context.vivaldiWindowId,e,this.onClose),this.onSizeChanged(e)};onCloseWithKeyboard=()=>{this.props.popupWantsToClose(),this.focusPopup()};onClose=()=>{this.props.popupWantsToClose()};render(){let e=0,t=0,n=0;const{popupPosition:i}=this.props;if(this.props.popupRect){const s=this.props.popupRect;"above"===i||"below"===i?(e="above"===i?s.top-this.state.height-3:s.bottom+6-3,t=s.left+s.width/2-this.state.width/2,t=Math.min(Math.max(t,6),this.context.innerWidth-this.state.width-6),n=s.left-t+s.width/2-6):"left"!==i&&"right"!==i||(t="left"===i?s.left-this.state.width-6:s.left+s.width+6,n=6,e=s.top,e+this.state.height>this.context.innerHeight&&(e=this.context.innerHeight-this.state.height-6,n=s.top-e+s.height/2-6))}const s=this.state.hasLoadedPopup&&this.props.popupVisible,o=0===t&&0===e;return(0,h.jsx)("div",{className:c()({"extension-popup":!0,bottom:!o&&"above"===i,top:!o&&"below"===i,left:!o&&"left"===i,right:!o&&"right"===i,hidden:!s}),style:{"--anchorPosition":n+"px",height:this.state.height,width:this.state.width,position:"fixed",left:o?"50%":t,top:o?"50%":e,transform:o?"translate(-50%, -50%)":"unset",display:s?"inherit":"none"},ref:this.popupContainer})}}const m=(0,u.Z)(g);var f=n(24602),v=n(48588);class y extends f.Z{getInitialState(){return new Map}getExtensionInfoForTab(e,t){return this.getState().get(e)?.get(t)}reduce(e,t){switch(t.actionType){case"EXTENSION_ACTION_UPDATED":{const{info:n}=t,i=e.get(n.id);let s;return i?i.has(n.tabId)?s=(0,v.cR)(i,n.tabId,(e=>{Object.assign(e,n)})):(s=new Map(i),s.set(n.tabId,n)):s=new Map([[n.tabId,n]]),i!==s&&(e=new Map(e)).set(n.id,s),e}case"EXTENSION_ACTION_CLEAR_FOR_TAB":{const{extensionId:n,tabId:i}=t,s=e.get(n);if(!s)return e;if(s.has(i)){const t=new Map(s);t.delete(i),(e=new Map(e)).set(n,t)}return e}case"EXTENSION_ACTION_REMOVED":return(0,v.u4)(e,t.info.id);default:return e}}}const b=new y;var S,w=n(60679),C=n(81009),A=n(76747),I=n(59322),T=n(96951),Z=n(68247),E=n(98102),k=n(96098),_=n(15489),N=n(56371),P=n(92292),D=n(47380),M=n(26036),O=n(93197),x=n(10334),L=n(89175),R=n(86088),B=n(89555);function F(e,t,n,i){S||(S="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:S,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const W=[L.kAddressBarExtensionsRenderInDropdown,L.kAddressBarExtensionsShowAllToggle,L.kAddressBarExtensionsHiddenExtensions],U="vivaldi/x-button-extension";class V extends i.PureComponent{static contextType=l.Z;refExtensionAnchor=i.createRef();state={extensions:b.getState(),extensionOrder:k.Z.getSync("EXTENSION_BUTTON_ORDER_BROWSER"),popupId:null,popupPage:null,popupVisible:!1,popupRect:void 0,extensionPopup:!1,showHiddenExtensions:!1,activeTabId:T.ZP.unsafeGetActivePage(this.context.vivaldiWindowId).id};_extensionActionShortcuts=new Map;_removedIdToIndex={};_shortcutCallbacks=new Map;_toolbarButtons=new Map;refWrapper=i.createRef();refToolbar=i.createRef();extensionActionPopupRef=i.createRef();async componentDidMount(){if(this.props.inEditor)return;b.addListener(this._onExtensionStoreChange);const{selectWindow:e}=this.context;T.ZP.addListener(this._onPageStoreChange,e),p.Z.extensionActionUtils.onCommandAdded.addListener(this.onCommandAdded),p.Z.extensionActionUtils.onCommandRemoved.addListener(this.onCommandRemoved),x.g2.addListener(this.extensionSubscriber),k.Z.addListener("EXTENSION_BUTTON_ORDER_BROWSER",this._onButtonOrderPrefsChange);(await p.Z.extensionActionUtils.getToolbarExtensions()).filter((e=>e.enabled)).forEach((e=>{this.updateShortcut(e.id,e.keyboardShortcut)}))}componentDidUpdate(e,t){!t.extensionPopup&&this.state.extensionPopup&&this.refWrapper.current?.focus()}componentWillUnmount(){this.props.inEditor||(b.removeListener(this._onExtensionStoreChange),T.ZP.removeListener(this._onPageStoreChange),p.Z.extensionActionUtils.onCommandAdded.removeListener(this.onCommandAdded),p.Z.extensionActionUtils.onCommandRemoved.removeListener(this.onCommandRemoved),x.g2.removeListener(this.extensionSubscriber),k.Z.removeListener("EXTENSION_BUTTON_ORDER_BROWSER",this._onButtonOrderPrefsChange),this._extensionActionShortcuts.forEach(((e,t)=>{this.removeShortcut(t,e)})))}extensionSubscriber=e=>{const t=this._toolbarButtons.get(e);this.state.popupId!==e&&this.setState({popupVisible:!1,popupPage:null,popupRect:void 0,popupId:null});const n=t?.getRect()??this.refToolbar.current?.getBoundingClientRect();this.onExtensionActionClicked(e,n)};_onButtonOrderPrefsChange=()=>{this.setState({extensionOrder:k.Z.getSync("EXTENSION_BUTTON_ORDER_BROWSER")})};_onPageStoreChange=()=>{const e=this.context.vivaldiWindowId,t=T.ZP.unsafeGetActivePage(e);this.setState({activeTabId:t.id})};_onExtensionStoreChange=()=>{this.setState({extensions:b.getState()})};_getTabExtensionInfo=(e,t)=>{const n=this.state.extensions.get(e);if(!n)throw new Error("Extension not found - "+e);const i=n.get(t),s=n.get(-1);if(!s)throw new Error("Extension fallback not set! Something is wrong. "+e);return{...s,...i}};assignShortcut=(e,t)=>{if(!t)return;this._extensionActionShortcuts.set(e,t),this._shortcutCallbacks.set(e,(()=>{this.onExtensionActionClicked(e)}));const n=this._shortcutCallbacks.get(e);n&&a.Z.bind(t.toLowerCase(),n)};removeShortcut=(e,t)=>{t&&(a.Z.unbind(t.toLowerCase(),this._shortcutCallbacks.get(e)),this._extensionActionShortcuts.set(e,""),this._shortcutCallbacks.delete(e))};updateShortcut=(e,t)=>{(t||this._extensionActionShortcuts.has(e))&&(t&&!this._extensionActionShortcuts.has(e)?this.assignShortcut(e,t):!t&&this._extensionActionShortcuts.has(e)?this.removeShortcut(e,t):t!==this._extensionActionShortcuts.get(e)&&(this.removeShortcut(e,t),this.assignShortcut(e,t)))};onCommandAdded=(e,t)=>{this.assignShortcut(e,t)};onCommandRemoved=(e,t)=>{this.removeShortcut(e,t)};saveBrowserOrder=e=>{k.Z.set({EXTENSION_BUTTON_ORDER_BROWSER:e})};onExtensionActionClicked=(e,t,n)=>{const i=b.getExtensionInfoForTab(e,this.state.activeTabId);if(i&&!i.visible){let e;const{HTMLElement:t}=this.context;return n&&n.target instanceof t&&(e=n.target),void this.getContextMenu(i).then((t=>{(0,D.Z)(this.context,t,void 0,this.props.menuOrigin,e)()}))}p.Z.extensionActionUtils.executeExtensionAction(e,this.context.vivaldiWindowId,(n=>{n&&this.setState((i=>({popupVisible:!i.popupVisible,popupPage:n,popupRect:t,popupId:e})),(()=>{this.state.popupVisible&&this.extensionActionPopupRef.current?.recreateWebView()}))}))};popupWantsToClose=()=>{this.setState({popupVisible:!1}),this.extensionActionPopupRef.current?.removeWebView()};#ni=()=>Array.from(this.state.extensions.keys()).sort(((e,t)=>this.state.extensionOrder.indexOf(e)-this.state.extensionOrder.indexOf(t)));onDrop=(e,t,n)=>{if(!this._dragOverId)return;const i=this.#ni();let s=i.indexOf(this._dragOverId);this._dragOverId=null;const o=e.dataTransfer.getData(U);if(!o)return;const a=i.indexOf(o);if(-1===a||a===s)return;if("right"===t&&s++,a===s)return;e.stopPropagation();const r=i[a];i.splice(a,1),a<s&&s--,i.splice(s,0,r),this.saveBrowserOrder(i)};stopPropagation=e=>{e.stopPropagation()};onDragEnter=e=>{this._dragOverId=e};executeExtensionAction=(e,t)=>{if(this.state.popupVisible&&(this.popupWantsToClose(),this.state.popupId===e))return;const{HTMLElement:n}=this.context;if(t.target instanceof n){const n=t.target;this.state.popupId!==e&&this.setState({popupVisible:!1,popupPage:null,popupRect:void 0,popupId:null}),this.onExtensionActionClicked(e,n.getBoundingClientRect(),t)}};removeExtension=e=>{p.Z.extensionActionUtils.removeExtension(e,this.context.vivaldiWindowId)};showOptionsPage=e=>{p.Z.extensionActionUtils.showExtensionOptions(e,this.context.vivaldiWindowId)};toggleVisibility=e=>{this.state.extensionPopup&&this.hideHiddenExtensionsPopup();const t=this.props.prefValues[L.kAddressBarExtensionsHiddenExtensions];if(-1===t.indexOf(e))Z.Z.set(L.kAddressBarExtensionsHiddenExtensions,[...t,e]);else{const n=t.filter((t=>e!==t&&this.state.extensions.has(t)));Z.Z.set(L.kAddressBarExtensionsHiddenExtensions,n)}};isExtensionAvailable=e=>!(_.ZP.isIncognito(this.context.vivaldiWindowId)&&!e.allowInIncognito);hasHiddenExtensions=()=>{for(const[e]of this.state.extensions)if(this.props.prefValues[L.kAddressBarExtensionsHiddenExtensions].includes(e))return!0;return!1};toggleHiddenExtensionsPopup=()=>{this.setState((e=>({extensionPopup:!e.extensionPopup})))};hideHiddenExtensionsPopup=()=>{this.setState({extensionPopup:!1})};onCustomMenuSelected=(e,t)=>{p.Z.extensionActionUtils.executeMenuAction(e,this.context.vivaldiWindowId,t,(e=>{P.Z.runtime.lastError&&P.Z.runtime.lastError.message&&console.warn("Error invoking menu item action: "+P.Z.runtime.lastError.message)}))};getContextMenu=e=>new Promise(((t,n)=>{const i=e.homepage||"https://chrome.google.com/webstore/detail/"+e.id,s=this.props.prefValues[L.kAddressBarExtensionsShowAllToggle];p.Z.extensionActionUtils.getExtensionMenu(e.id,(o=>{P.Z.runtime.lastError&&n(P.Z.runtime.lastError);const a=o.map((t=>{const n={handler:this.onCustomMenuSelected.bind(this,e.id,t.id),isVisible:()=>t.visible,mnemonic:!1,checked:t.checked,...A.Z.makeLabelPair(t.name)};return t.submenu&&(n.items=t.submenu.map((t=>({handler:this.onCustomMenuSelected.bind(this,e.id,t.id),isVisible:()=>t.visible,mnemonic:!1,checked:t.checked,...A.Z.makeLabelPair(t.name)})))),n})),l=this.props.prefValues[L.kAddressBarExtensionsHiddenExtensions].includes(e.id),d=[{handler:()=>I.ZP.openURL(this.context.vivaldiWindowId,i),...A.Z.makeLabelPair(e.name||"")},...a.length>0?[A.Z.separatorItem,...a,A.Z.separatorItem]:[],{handler:()=>this.showOptionsPage(e.id),isVisible:()=>void 0!==e.optionspage&&""!==e.optionspage,...(0,M.Z)("Options")},{handler:()=>this.removeExtension(e.id),isVisible:()=>"componentAction"!==e.extensionType,ellipsis:!0,...(0,M.Z)("Remove Extension")},{handler:()=>this.toggleVisibility(e.id),isVisible:()=>!s&&l,...(0,M.Z)("Show Button")},{handler:()=>this.toggleVisibility(e.id),isVisible:()=>!s&&!l,...(0,M.Z)("Hide Button")},A.Z.separatorItem,{handler:()=>r.Z.showExtensions(this.context.vivaldiWindowId),...(0,M.Z)("Manage Extensions")}];return t(d)}))}));toggleHiddenExtensions=()=>{this.setState((e=>({showHiddenExtensions:!e.showHiddenExtensions}))),r.Z.updateToolbarSpacer(this.context.vivaldiWindowId)};renderExtensionToggleButton=()=>F(E.ZP,{tooltip:(0,N.Z)("Toggle extensions"),onClick:this.toggleHiddenExtensions,image:R.v9y[this.props.size||"large"],customizeMenu:this.props.customizeMenu,menuOrigin:this.props.menuOrigin,hidePopup:this.hideHiddenExtensionsPopup,draggable:this.props.draggable||!1,onDragStart:this.props.onDragStart??B.Z,onDragEnd:this.props.onDragEnd??B.Z,onDrop:this.props.onDrop??B.Z,onDragEnter:this.props.onDragEnter??B.Z,onDragLeave:this.props.onDragLeave??B.Z,onDragOver:this.props.onDragOver??B.Z,mimeType:this.props.mimeType,name:this.props.name,size:this.props.size,className:c()("ExtensionToggleIcon",{"ExtensionToggleIcon--extensionsExpanded":this.state.showHiddenExtensions})});_shouldRenderInMainToolbar=e=>{let t=!0;const n=this.props.prefValues[L.kAddressBarExtensionsRenderInDropdown],i=this.props.prefValues[L.kAddressBarExtensionsShowAllToggle],s=this.props.prefValues[L.kAddressBarExtensionsHiddenExtensions].includes(e.id);return(!i||this.state.showHiddenExtensions&&!n)&&(i||!s||this.state.showHiddenExtensions&&!n)||(t=!1),t};renderHiddenExtensionInPopup=()=>{const{size:e="large"}=this.props,t=[],n=this.props.prefValues[L.kAddressBarExtensionsShowAllToggle];for(const e of this.#ni()){const i=this._getTabExtensionInfo(e,this.state.activeTabId);if(!i)continue;(this.props.prefValues[L.kAddressBarExtensionsHiddenExtensions].includes(e)||n)&&this.isExtensionAvailable(i)&&t.push((0,h.jsx)(E.ZP,{className:"ExtensionDropdownIcon extensionId",badgeText:i.badgeText,tooltip:i.name,tabIndex:0,draggable:this.props.draggable||!1,imagePath:i.badgeIcon,ref:e=>{e&&i&&this._toolbarButtons.set(i.id,e)},onClick:this.executeExtensionAction.bind(this,i.id),menu:this.getContextMenu.bind(this,i),onDragEnter:()=>{i&&this.onDragEnter(i.id)},onDragStart:this.stopPropagation,onDragEnd:this.stopPropagation,mimeType:U,name:i.id,onDrop:this.onDrop},i.id))}return F(E.ZP,{image:R.v9y[e],tooltip:(0,N.Z)("Show hidden extensions"),onClick:this.toggleHiddenExtensionsPopup,customizeMenu:this.props.customizeMenu,menuOrigin:this.props.menuOrigin,popupPosition:this.props.popupPosition,hidePopup:this.hideHiddenExtensionsPopup,isPopupVisible:this.state.extensionPopup,popupWidth:Math.min(34*t.length,442),className:"extensionPopupIcons",popupClassName:"extensionIconPopupMenu ToolbarButtonPopup-DefaultStyles",hasLightArrow:!0,size:e,hidePopup:this.hideHiddenExtensionsPopup,draggable:this.props.draggable||!1,onDragStart:this.props.onDragStart??B.Z,onDragEnd:this.props.onDragEnd??B.Z,onDrop:this.props.onDrop??B.Z,onDragEnter:this.props.onDragEnter??B.Z,onDragLeave:this.props.onDragLeave??B.Z,onDragOver:this.props.onDragOver??B.Z,mimeType:this.props.mimeType,name:this.props.name},void 0,(0,h.jsx)("div",{ref:this.refWrapper,className:"toolbar toolbar-mainbar toolbar-wrap",tabIndex:"-1",children:t}))};renderExtensionButtons=()=>{const e=this.props.prefValues[L.kAddressBarExtensionsShowAllToggle],t=[];for(const n of this.#ni()){const i=this._getTabExtensionInfo(n,this.state.activeTabId);if(this._shouldRenderInMainToolbar(i)&&this.isExtensionAvailable(i)){const s=i.badgeIcon?i.badgeIcon:"data:image/svg+xml;utf8,"+R.N_W;let a,r=i.badgeBackgroundColor?o()(i.badgeBackgroundColor):void 0;r&&r?.alpha()<1&&(r=r.alpha(1));const l=r?r.luminance()>O.$J?O.E5:O.Cj:void 0;a=i.badgeIcon?i.badgeText:i.name?i.name.charAt(0).toUpperCase():"";const d=this.props.prefValues[L.kAddressBarExtensionsHiddenExtensions].includes(n);t.push((0,h.jsx)(E.ZP,{badgeColor:l,badgeBackgroundColor:r,badgeText:a,onClick:this.executeExtensionAction.bind(this,i.id),menu:this.getContextMenu.bind(this,i),tooltip:i.badgeTooltip||i.name||(0,N.Z)("Extension"),popupClassName:"extensionIconPopupMenu ToolbarButtonPopup-DefaultStyles",size:this.props.size,draggable:this.props.draggable||!1,className:c()(i.id,"ExtensionIcon","extensionId",{"ExtensionIcon--Hidden":!e&&d}),menuOrigin:this.props.menuOrigin,imagePath:s,popupPosition:this.props.popupPosition,ref:e=>{i&&e&&this._toolbarButtons.set(i.id,e)},onDragEnter:()=>{i&&this.onDragEnter(i.id)},onDragStart:this.stopPropagation,onDragEnd:this.stopPropagation,onDrop:this.onDrop,mimeType:U,name:i.id},i.id))}}return t};render(){if(!this.props.preview&&0===this.state.extensions.size)return(0,h.jsx)("div",{ref:this.refExtensionAnchor,className:"toolbar-extensions"});const e=this.props.prefValues[L.kAddressBarExtensionsRenderInDropdown],t=this.props.prefValues[L.kAddressBarExtensionsShowAllToggle];return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)("div",{ref:this.refToolbar,className:"toolbar-extensions",children:[!this.props.preview&&this.renderExtensionButtons(),(this.props.preview||!e&&(t||!t&&this.hasHiddenExtensions()))&&this.renderExtensionToggleButton(),!this.props.preview&&e&&(t||this.hasHiddenExtensions()&&!t)&&this.renderHiddenExtensionInPopup(),this.state.popupId&&F("div",{},void 0,(0,h.jsx)(m,{ref:this.extensionActionPopupRef,extensionId:this.state.popupId,outsideClickIgnoreClass:"extensionId",popupVisible:this.state.popupVisible,popupPage:this.state.popupPage,popupPosition:this.props.popupPosition,popupWantsToClose:this.popupWantsToClose,popupRect:this.state.popupRect}))]}),(0,h.jsx)("div",{ref:this.refExtensionAnchor})]})}}const H=(0,C.Z)((0,w.ZP)(V),W)},46884:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var i=n(94283),s=n(67294);function o(e,t,n="ignore-react-onclickoutside",o=!1){const{document:a,Element:r}=(0,s.useContext)(i.Z);(0,s.useEffect)((()=>{if(!o)return setTimeout((()=>{a.addEventListener("mousedown",i),a.addEventListener("pointerdown",i),a.addEventListener("touchstart",i)})),()=>{a.removeEventListener("mousedown",i),a.removeEventListener("pointerdown",i),a.removeEventListener("touchstart",i)};function i(i){const s=e(),o=t();if(!s||!o)return;let a=i.target;for(;a instanceof r;){const{classList:e}=a;if(Array.isArray(n)){if(n.some((t=>e.contains(t))))return}else if(e.contains(n))return;a=a.parentNode}i.target instanceof r&&!s.contains(i.target)&&o(i)}}),[r,o,a,t,e,n])}},74487:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var i=n(67294);function s(e,t){const[n,s]=(0,i.useState)(e.getState());return(0,i.useEffect)((()=>{function n(){s(e.getState())}return e.addListener(n,t),()=>e.removeListener(n)}),[e,t]),n}},4668:(e,t,n)=>{"use strict";n.d(t,{BZ:()=>o,JX:()=>r,Ve:()=>a,up:()=>c});var i=n(83784),s=n(92292);function o(e){return e.replace(/["~*\/:<>?\\|\p{Cc}\p{Cf}]+/gu," ").replace(/^[ .]+|[ .]+$/g,"")}function a(e,t){d(l(e),o(e.filename),t)}function r(e){const t=l(e),n=o(e.filename);return{suggestedFilename:n,url:t,request:{deny:()=>URL.revokeObjectURL(t),allow:e=>d(t,n,e)}}}function l(e){const t=c(e);return URL.createObjectURL(t)}function d(e,t,n){s.Z.downloads.download({url:e,filename:t,saveAs:"saveas"===n},(t=>{URL.revokeObjectURL(e),"open"===n&&i.Z.addOpenAfterDownload(t)}))}function c(e){const t=e.content,n=e.mimeType;return new Blob([t],{type:n})}},88630:(e,t,n)=>{"use strict";n.d(t,{Z:()=>p});var i=n(62366),s=n(29087),o=n(10124),a=n(7064),r=n(70611),l=n(89175),d=n(78614);async function c(e,t){const n="string"==typeof t.content?await(0,o.Z)(t.content):t.content;return e.setContent(n)}function u(e){const t=e.method?`text/calendar; charset=utf-8; method=${e.method}`:"text/calendar; charset=utf-8";return c(new i.Z(t),e)}const p={build:async function(e,t,n){let o;const p=await(0,r.iT)(t),h=n.filter((e=>(e.mimeType.startsWith("multipart/")&&(e.mimeType="application/octet-stream"),"application/ics"===e.mimeType)));if("string"==typeof p){const e=new i.Z("text/plain; charset=utf-8");e.setContent(p),h.length?(o=new i.Z("multipart/alternative"),o.appendChild(e),o.appendChild(await u(h[0]))):o=e}else{const e=(0,r.yy)(t);o=new i.Z("multipart/alternative");const s=new i.Z("text/plain; charset=utf-8");s.setContent(e),o.appendChild(s);const a=n.filter((e=>e.id)),l=new i.Z("text/html; charset=utf-8");if(l.setContent(t),a.length>0){const e=new i.Z("multipart/related");e.appendChild(l);for(const t of a){const n=e.createChild(t.mimeType,{filename:t.filename});await c(n,t),n.setHeader("Content-Disposition","inline").setHeader("Content-Id",t.id)}o.appendChild(e)}else o.appendChild(l);h.length&&o.appendChild(await u(h[0]))}const g=n.filter((e=>!e.id));let m;if(g.length>0){m=new i.Z("multipart/mixed"),m.appendChild(o);for(const e of g){const t=m.createChild(e.mimeType,{filename:e.filename});t.setHeader("Content-Disposition","attachment"),await c(t,e)}}else m=o;return m.addHeader("message-id","<"+e.messageId+">"),m.addHeader("from",(0,d.Rz)(e.from)),m.addHeader("to",(0,d.Rz)(e.to)),m.addHeader("cc",(0,d.Rz)(e.cc)),m.addHeader("subject",e.subject),m.addHeader("date",new Date(e.sentDate).toUTCString().replace(/GMT/,"+0000")),e.inReplyTo&&e.inReplyTo.length>0&&m.addHeader("in-reply-to","<"+e.inReplyTo+">"),e.references&&e.references.length>0&&m.addHeader("references","<"+e.references.join("> <")+">"),e.listId&&m.addHeader("list-id",e.listId),e.listPost&&m.addHeader("list-post",e.listPost),s.Z.get(l.kMailIncludeIdentifyingHeaders)&&(m.addHeader("X-Mailer","Vivaldi Mail"),m.addHeader("User-Agent",`Vivaldi Mail/${a.Z.utilities.getVersion().vivaldiVersion}`)),m.build()}}},13933:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const i=new class{#ii;set(e){this.#ii=e}getAndClear(){const e=this.#ii;return this.#ii=void 0,e}}},72494:(e,t,n)=>{"use strict";n.d(t,{Z:()=>qt,K:()=>Xt});var i,s=n(67294),o=n(36964),a=n(43630),r=n(59720),l=n(2711),d=n(65792),c=n.n(d),u=n(57082),p=n(4660),h=n(72010),g=n(3184),m=n(65093),f=n(99827),v=n(98611),y=n(54162),b=n(39005),S=n(94184),w=n.n(S),C=n(86088);function A(e,t,n,s){i||(i="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=s;else if(a>1){for(var r=new Array(a),l=0;l<a;l++)r[l]=arguments[l+3];t.children=r}if(t&&o)for(var d in o)void 0===t[d]&&(t[d]=o[d]);else t||(t=o||{});return{$$typeof:i,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const I=function(e){const[t,n]=(0,s.useState)(!1);return t?null:A("div",{className:w()("MailWarningMessage",e.type)},void 0,e.children,A("button",{className:"MailWarningMessage-Exit",onClick:()=>n(!0)},void 0,A("span",{dangerouslySetInnerHTML:{__html:C.kze}})))};var T,Z=n(60331),E=n(9304),k=n(63153),_=n(94283),N=n(56371),P=n(98010),D=n(51540),M=n(30381),O=n.n(M),x=n(7064),L=n(78614),R=n(65741),B=n(97781),F=n(27569),W=n(29087),U=n(89175),V=n(48521);function H(e,t,n,i){T||(T="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:T,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const G={markup:"",style:"",prepend:!1};function $(e){const{markup:t,style:n,prepend:i}=e||G;return`{\n  let container = document.querySelector('.VIVcontainer');\n  if (!container) {\n    container = document.createElement('div');\n    container.className = 'VIVcontainer';\n  } else {\n    container.remove();\n  }\n  document.body.${i?"prepend":"append"}(container);\n  let style;\n  let content;\n  let shadowRoot;\n  if (!container.shadowRoot) {\n    style = document.createElement('style');\n    content = document.createElement('div');\n    content.className = 'shadowWrapper';\n    shadowRoot = container.attachShadow({ mode: 'open' });\n    shadowRoot.appendChild(style);\n    shadowRoot.appendChild(content);\n  } else {\n    shadowRoot = container.shadowRoot;\n    style = shadowRoot.querySelector('style');\n    content = shadowRoot.querySelector('div');\n  }\n  style.textContent = ${JSON.stringify(n)};\n  content.innerHTML = ${JSON.stringify(t)};\n  window.requestAnimationFrame(() => {\n    const styles = window.getComputedStyle(document.body);\n    const top = parseFloat(styles.marginTop) + parseFloat(styles.paddingTop);\n    const left = parseFloat(styles.marginLeft) + parseFloat(styles.paddingLeft);\n    const right = parseFloat(styles.marginRight) + parseFloat(styles.paddingRight);\n    container.style.marginTop = Math.floor(top * ${i?"-1":"0"}) + "px";\n    container.style.marginLeft = Math.floor(left * -1) + "px";\n    container.style.marginRight = Math.floor(top * -1) + "px";\n  })}`}class K extends s.PureComponent{static contextType=_.Z;refWebview=s.createRef();refContentBlockedToggle=s.createRef();state={leakPrevented:!1};componentDidUpdate(e){const{document:t}=this.context;if(!(0,R.Z)(e.style,this.props.style)){const e=E.ZP.createStyleRoot(this.props.style);this.refWebview.current?.executeScript({code:`\n        document.styleSheets[0].deleteRule(0);\n        document.styleSheets[0].insertRule("${e}", 0);\n        `})}const{textOrHtml:n,blockHTTPLeaks:i,bodyParts:s,isRss:o,renderingMethod:a,messageHeader:r}=this.props,{content:l,type:d}=n,c=this.refWebview.current,u=r.current?.props.listEntry.subject||"";let p=!1;if(e.textOrHtml!==n||!l&&e.inject!==this.props.inject||"html"===d&&e.blockHTTPLeaks!==i){let e,n=!1;if("raw"===a){const n=t.createTextNode(l),i=t.createElement("p");i.appendChild(n),e=`<html>${this.getDefaultStyle(!1)}<body>${i.innerHTML}</body></html>`}else if("html"===d){const t={};(s||[]).forEach((e=>{"attachment"===e.type&&e.id&&(t["cid:"+e.id]=e)}));const a=(0,B.Nw)(l,{attachments:t,blockHTTPLeaks:i});n=a.leakPrevented,e=o?this.getDefaultRssStyle()+a.sanitized:this.getDefaultStyle(!0)+this.getPrintHeaders()+a.sanitized}else e=`<html>${this.getDefaultStyle(!1)}<body>${this.getPrintHeaders()}${(0,D.Z)(l)}</body></html>`;this.setState({leakPrevented:n}),c?.executeScript&&(p=!0,c.executeScript({code:`document.open();\n          document.write(${JSON.stringify(e)});\n          document.title = ${JSON.stringify(u)};\n          document.close();`}))}(p||e.inject!==this.props.inject)&&c?.executeScript({code:$(this.props.inject)})}updateWebviewEventListeners=e=>{const t=this.refWebview.current,n=e;this.refWebview.current=n,t&&(t.removeEventListener("newwindow",this.handleNewWindow),t.removeEventListener("targeturlchanged",this.handleTargetURLChanged),t.removeEventListener("consolemessage",this.handleConsoleMessage),t.removeEventListener("fullscreen",this.handleOnFullscreen)),n&&(x.Z.zoom.getDefaultZoom((e=>n.setZoom(e))),n.addEventListener("newwindow",this.handleNewWindow),n.addEventListener("targeturlchanged",this.handleTargetURLChanged),n.addEventListener("consolemessage",this.handleConsoleMessage),n.addEventListener("fullscreen",this.handleOnFullscreen))};handleOnFullscreen=e=>{k.Z.onHTML5FullScreen(e.enterFullscreen,this.context.vivaldiWindowId)};handleNewWindow=e=>{switch(e.preventDefault(),e.windowOpenDisposition){case"current_tab":case"new_foreground_tab":e.window.accept(this.context.vivaldiWindowId+";1");break;case"new_background_tab":e.window.accept(this.context.vivaldiWindowId+";0");break;case"new_window":k.Z.openBrowserWindow(this.context.vivaldiWindowId,e.targetUrl);break;case"off_the_record":k.Z.openBrowserWindow(this.context.vivaldiWindowId,e.targetUrl,{incognito:!0})}};handleTargetURLChanged=({newUrl:e})=>{const t=(0,P.ZP)(e);Z.Z.setStatus(this.context.vivaldiWindowId,t)};handleConsoleMessage=e=>{const t=this.props.inject?.messageHandler;"function"==typeof t&&t(e)};getPrintHeaders=()=>{const e=this.props.messageHeader;if(!e.current)return"";const t=e.current.props.listEntry.subject||"",n=e.current.props.from,i=e.current.props.message?.to,s=e.current.props.message?.cc,o=e.current.props.message?.replyTo,a=e.current.props.message?.sentDate,r=e.current.state.attachments.map((e=>e.filename)).join(", ");return`<div class="print-only">\n      <table>\n        ${[[(0,N.Z)("Subject"),t],[(0,N.Z)("Date"),a?O()(a).format("LLLL (Z)"):""],[(0,N.Z)("Mail","From"),n&&(0,L.aD)(n)],[(0,N.Z)("To"),i&&(0,L.aD)(i)],[(0,N.Z)("Cc"),s&&(0,L.aD)(s)],[(0,N.Z)("Reply To"),o&&(0,F.$8)(o,n,this.props.fromAddress)&&(0,L.aD)(o)],[(0,N.Z)("Attachments"),r]].filter((e=>e)).map((([e,t])=>t?`<tr key=${e}>\n              <td>${e}</td>\n              <td>${t}</td>\n            </tr>`:"")).join("")}\n      </table>\n    </div>`};getDefaultStyle=e=>{const t=W.Z.get(U.kMailColorQuotedText);return`<style type="text/css">\n    ${E.ZP.createStyleRoot(this.props.style)}\n    html {\n      overflow-y: auto;\n    }\n    body {\n      ${e?"":"white-space: pre-wrap;"}\n      ${e?"":"overflow-wrap: break-word;"}\n      color: ${e?"black":"var(--colorFgIntense)"};\n      background-color: ${e?"white":"var(--colorBgIntense)"};\n      font-family: ${e?"sans-serif":"monospace"};\n      margin: 18px;\n      line-height: 1.3;\n      height: auto !important;\n      min-height: calc(100% - 48px);\n    }\n    .VIVcontainer {\n      all: initial;\n      display: block;\n    }\n    .blockquote {\n      border-left: 2px solid;\n      margin: 6px 0;\n      padding: 0 0 0 9px;\n      border-left-color: var(--quoteLvl1);\n      ${t?"color: var(--quoteLvl1);":""}\n    }\n    .blockquote .blockquote {\n      border-left-color: var(--quoteLvl2);\n      ${t?"color: var(--quoteLvl2);":""}\n    }\n    .blockquote .blockquote .blockquote {\n      border-left-color: var(--quoteLvl3);\n      ${t?"color: var(--quoteLvl3);":""}\n    }\n    ${e?"":"a { color: var(--colorHighlightBg); }"}\n    .print-only {display: none}\n    @media print {\n      .print-only {\n        display: block;\n        table {\n          margin-top: 6px;\n          display: flex;\n        }\n        tr {\n          td:first-child {\n            font-weight: 700;\n            white-space: nowrap;\n            display: flex;\n            align-items: flex-start;\n          }\n        }\n      }\n    }\n    </style>`};getDefaultRssStyle=()=>`<style type="text/css">\n    ${E.ZP.createStyleRoot(this.props.style)}\n    html {\n      background: var(--colorBgIntense);\n      color: var(--colorFgIntense);\n      font-family: sans-serif;\n      overflow-y: auto;\n    }\n    body {\n      margin: 24px;\n      height: auto !important;\n      min-height: calc(100% - 48px);\n    }\n    body > main {\n      font-size: initial;\n      /* feeds should not be using these variables */\n      /* prevent the feed from copying a custom theme for phishing */\n      --colorBg: white;\n      --colorFg: black;\n    }\n    body > main a {\n      color: var(--colorHighlightBg);\n    }\n    body > nav ul.mainbutton a {\n      display: inline-block;\n      padding: 0.3em 12px;\n      font-size: initial;\n      color: var(--colorHighlightFg);\n      background-color: var(--colorHighlightBg);\n      border-radius: 4px;\n    }\n    body > nav ul.mainbutton::after {\n      content: "";\n      display: block;\n      border-bottom: 1px solid var(--colorBorder);\n      height: 0.7em;\n      opacity: 0.3;\n    }\n    body > nav h2,\n    body > section h2 {\n      font-weight: normal;\n      font-size: larger;\n    }\n    body > nav h2::after,\n    body > section h2::after {\n      content: ":";\n    }\n    body > nav ul,\n    body > nav li {\n      display: block;\n      margin-left: 0;\n      padding-left: 0;\n    }\n    body > nav a {\n      color: var(--colorHighlightBg);\n      text-decoration: none;\n    }\n    body > section img,\n    body > section video,\n    main img,\n    main video,\n    main image,\n    main image,\n    main object,\n    main embed {\n      max-width: 100%;\n      /* allow default image ratio to work in cases where height has been set */\n      height: auto !important;\n    }\n    main iframe {\n      border: none;\n      max-width: 100%;\n    }\n    body > footer {\n      opacity: 0.5;\n    }\n\n    div.video-wrapper {\n      background: #111;\n      margin-left: -24px;\n      margin-top: -24px;\n      margin-right: -24px;\n      margin-bottom: 24px;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n    }\n\n    div.video-wrapper iframe {\n      --cinema-mode-height: 40vw;\n      height: var(--cinema-mode-height);\n      width: calc(var(--cinema-mode-height) / .5625);\n      min-height: 320px;\n      max-height: 100vh;\n    }\n\n    div.preformatted {\n      white-space: pre-wrap;\n    }\n\n    /* Overrides for specific feed issues */\n    main figure[style*="width"] {\n      /* WordPress hard codes a width which creates scrollbars.\n      Max-width does not fix it because of the default margin.\n      Fix it without breaking feeds that have floating figures. Assume that if\n      a figure has a style attribute with width, it is probably not well\n      styled, and width should be ignored. */\n      width: auto !important;\n    }\n    </style>`;handleLoadExternalContentClicked=()=>{const e=this.refContentBlockedToggle.current?.checked??!1;this.props.onUnblockExternalContent(e)};showOriginalHTML=()=>{b.Z.toggleRenderingMethod("prefer_html")};render(){const{fromAddress:e}=this.props,{leakPrevented:t}=this.state,{convertedFromHtml:n=!1}=this.props.textOrHtml,i=[];return this.props.shouldWarnUserFrom&&i.push((0,N.Z)('More than one "From" address detected.')),this.props.shouldWarnUserFromName&&i.push((0,N.Z)('"From" name looks like an email address.')),(0,V.jsxs)(V.Fragment,{children:[n&&H("div",{className:"mail-content-blocked"},void 0,H("div",{className:"content-blocked-text"},void 0,(0,N.Z)("This message was converted from HTML.")),H("input",{className:"content-blocked-action",type:"button",onClick:this.showOriginalHTML,value:(0,N.Z)("Show original HTML version")})),i.length>0&&H(I,{type:"danger"},void 0,H("div",{className:"content-blocked-text"},void 0,i.length>1?H("ul",{},void 0,i.map((e=>H("li",{},e,e)))):i[0]+" ",(0,N.Z)("Someone may be trying to hide their identity (spoofing) to phish for information. Be careful of links you click."))),this.props.shouldWarnUserReplyTo&&H(I,{type:"warning"},void 0,H("div",{className:"content-blocked-text"},void 0,(0,N.Z)('"Reply To" does not match the "From" address. Make sure you trust the "Reply To" address before replying.'))),t&&H("div",{className:"mail-content-blocked"},void 0,H("div",{className:"content-blocked-text"},void 0,(0,N.Z)("This message was prevented from loading external content.")),H("label",{title:(0,N.Z)("Always allow $1",[e]),className:"content-blocked-toggle-container"},void 0,(0,V.jsx)("input",{className:"content-blocked-toggle",ref:this.refContentBlockedToggle,type:"checkbox"}),H("span",{className:"content-blocked-toggle-text"},void 0,(0,N.Z)("Always allow $1",[e]))),H("input",{className:"content-blocked-action",type:"button",title:(0,N.Z)("Load External Content"),onClick:this.handleLoadExternalContentClicked,value:(0,N.Z)("Load External Content")})),H("div",{className:"mail_body"},void 0,H("section",{},void 0,(0,V.jsx)("webview",{tabIndex:"0",name:"vivaldi-mail",ref:this.updateWebviewEventListeners,src:"data:text/html,<html/>"})))]})}}const z=K;var j=n(88630),Y=n(92292),X=n(11430),Q=n(99895),q=n(82786),J=n(76257),ee=n(70611),te=n(3664);async function ne(e){const{mimeTree:t,raw:n}=await X.Z.getMimeTree(e);return new ie(t,n)}class ie{#si;constructor(e,t){this.lock=(0,q.M)(),this.mimeTree=e,this.#si=t}async getRaw(){let e;const t=await this.lock();try{e=this.#si}finally{t()}return e}async getByteString(){let e="";const t=await this.lock();try{e=(0,te.DA)(this.#si)}finally{t()}return e}async parse(e){let t=[];const n=await this.lock();try{const i=await X.Z.parseMail(this.#si,e);t=i.bodyParts,this.#si=i.raw}finally{n()}return t}#oi;async parseAttachments(){if(this.#oi)return this.#oi;const e=[],t=(0,J.Dc)(this.mimeTree);for(const n of t){(await this.parse(n.mimeTree)).forEach((t=>{"attachment"===t.type&&e.push(t)}))}return this.#oi=e,e}async getDeliveryHeaders(){let e={};const t=await this.lock();try{e=(0,J.Ao)(this.#si)}finally{t()}return e}async parseCalendar(){let e;const t=(0,J.fN)(this.mimeTree);if(t){const n=await this.parse(t.mimeTree);n.length&&(e=n[0])}return e}#ai;#ri;async parseMainPart(e){if(this.#ai&&this.#ri===e)return this.#ai;let t=(0,J.yQ)(this.mimeTree,e);0===t.length&&"plaintext"===e&&(t=(0,J.yQ)(this.mimeTree,"prefer_html"));const n=[],i=[];for(const s of t){let[t]=await this.parse(s.mimeTree);if(t)if("html"===t.type){if("plaintext"===e)t={type:"text",content:(0,ee.yy)(t.content),convertedFromHtml:!0};else{const e=(0,J.Wh)(this.mimeTree);for(const t of e){(await this.parse(t.mimeTree)).forEach((e=>{"attachment"===e.type&&i.push(e)}))}}n.push(t)}else"text"===t.type&&n.push(t)}let s;return 1===n.length?s=n[0]:n.length>1&&(s=n.every((e=>"text"===e.type))?{type:"text",content:n.map((e=>e.content)).join("\n"),convertedFromHtml:n.some((e=>"text"===e.type&&e.convertedFromHtml))}:{type:"html",content:n.map((e=>"text"===e.type?`<pre>${e.content}</pre>`:e.content)).join("\n")}),this.#ri=e,this.#ai=i.concat(s??[]),this.#ai}async parseSearchPart(){const e=(0,J.PW)(this.mimeTree);if(!e)return[];let t=[];const n=await this.lock();try{const i=await X.Z.parseMail(this.#si,e.mimeTree);t=i.bodyParts,this.#si=i.raw}finally{n()}return t}async saveAs(e){const t=await this.lock(),n=new Blob([this.#si],{type:"message/rfc822"}),i=URL.createObjectURL(n);Y.Z.downloads.download({url:i,filename:e,saveAs:!0},(()=>{URL.revokeObjectURL(i),t()}))}async writeBufferToDisk(e,t,n){const i=await this.lock();try{await Q.Z.call(e,t,n,this.#si)}finally{i()}}}var se,oe=n(50522),ae=n(51525),re=n(15800),le=n(46382),de=n(45660),ce=n(15805),ue=n(74487),pe=n(5863),he=n(25765),ge=n(34006),me=n(6142),fe=n(8336),ve=n(21788),ye=n(47995),be=n(72882),Se=n(80837),we=n(81009),Ce=n(95032),Ae=n(59322),Ie=n(18350),Te=n(47380),Ze=n(26036),Ee=n(73132),ke=n(44850);function _e(e,t,n,i){se||(se="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:se,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class Ne extends s.Component{static contextType=_.Z;winId=this.context.vivaldiWindowId;state={activeItemIndex:-1,openDropdownMenu:!1,contact:this.props.mailAddress?h.Z.getContactsWithAddress(this.props.mailAddress.address):void 0,status:""};componentDidMount(){this.props.mailAddress&&h.Z.addListener(this.contactChanged)}componentDidUpdate(e){Boolean(this.props.mailAddress)!==Boolean(e.mailAddress)&&(this.props.mailAddress?h.Z.addListener(this.contactChanged):h.Z.removeListener(this.contactChanged))}componentWillUnmount(){this.props.mailAddress&&h.Z.removeListener(this.contactChanged)}contactChanged=()=>{if(this.props.mailAddress){const e=this.props.mailAddress.address.toLowerCase(),t=this.state.contact&&h.Z.getNodeById(this.state.contact.id);t?.emailAddresses.some((t=>t.emailAddress.toLowerCase()===e))?this.setState({contact:t}):this.setState({contact:h.Z.getContactsWithAddress(e)})}};onClickDropdown=()=>{this.setState((e=>({openDropdownMenu:!e.openDropdownMenu})))};closeMenu=()=>{this.setState({activeItemIndex:-1,openDropdownMenu:!1})};handleKeyDown=e=>{switch(e.key){case"Escape":case"Tab":this.closeMenu();break;case"Enter":case"Space":if(e.stopPropagation(),e.preventDefault(),this.state.activeItemIndex>-1){const e=this.getDropdownMenuItems()[this.state.activeItemIndex];e.onSuccessText?e.handler().then((()=>this.onMenuItemClicked(e.onSuccessText)),(()=>this.onMenuItemClicked(e.onErrorText))):(e.handler(),this.closeMenu())}else this.props.onClick();break;case"ArrowUp":this.setState((e=>{const t=e.activeItemIndex-1;if(t>-1)return{activeItemIndex:t}}));break;case"ArrowDown":this.setState((e=>{const t=e.activeItemIndex+1;if(t<this.getDropdownMenuItems().length)return{openDropdownMenu:!0,activeItemIndex:t}}))}};onMenuItemClicked=e=>{this.statusTimeout&&clearTimeout(this.statusTimeout);this.setState({status:e}),this.closeMenu(),this.statusTimeout=setTimeout((()=>this.setState({status:""})),1e3)};contactOrAddressString=()=>this.props.mailAddress&&this.state.contact&&!this.state.contact.generatedFromSentMail?this.state.contact.name?this.state.contact.name+" <"+this.props.mailAddress.address+">":this.props.mailAddress.address:this.props.buttonTitle;onEditContact=e=>{if(!e)return;const t=this.context.vivaldiWindowId;Ie.Z.showContent(t,"PanelContacts",{setFocus:!0,selectId:e.id,reason:"edit"}),f.Z.selectContactById(t,e.id),Ae.ZP.openURL(t,ke.jk.internals.mailpage,{singleton:!0})};onAddContact=e=>{const t=this.context.vivaldiWindowId;Ie.Z.showContent(t,"PanelContacts"),p.Z.newContactFromMailAddress(e,!0),f.Z.selectContactByAddress(t,e.address),Ae.ZP.openURL(t,ke.jk.internals.mailpage,{singleton:!0})};getDropdownMenuItems=()=>{if(this.props.mailAddress){const e=this.props.mailAddress;return this.state.contact?[...this.props.dropdownMenuItems,{...(0,Ze.Z)("Edit contact"),handler:this.onEditContact.bind(this,this.state.contact)}]:[...this.props.dropdownMenuItems,{...(0,Ze.Z)("Add to contacts"),handler:this.onAddContact.bind(this,e)}]}return this.props.dropdownMenuItems};onContextMenu=e=>{const t=this.getDropdownMenuItems().map((e=>({label:e.label,labelEnglish:e.labelEnglish,handler:e.handler})));(0,Te.Z)(this.context,t)(e)};render(){return _e("div",{className:"button-with-dropdown-wrapper"},void 0,_e("div",{className:"button-with-dropdown-container",onMouseLeave:this.closeMenu,title:this.contactOrAddressString(),onContextMenu:this.onContextMenu},void 0,_e("button",{onKeyDown:this.handleKeyDown,tabIndex:this.props.prefValues[U.kKeyboardTabToAll],onClick:this.props.onClick},void 0,this.state.contact&&_e("img",{src:this.state.contact.avatarUrl||Ee.g}),_e("span",{},void 0,this.contactOrAddressString())),_e("button",{tabIndex:-1,onMouseDown:this.onClickDropdown,dangerouslySetInnerHTML:{__html:C.yaZ.medium}}),this.state.openDropdownMenu&&_e("ul",{className:"dropdown-menu"},void 0,this.getDropdownMenuItems().map(((e,t)=>_e("li",{onMouseUp:e.onSuccessText?()=>e.handler().then((()=>this.onMenuItemClicked(e.onSuccessText)),(()=>this.onMenuItemClicked(e.onErrorText))):()=>{e.handler&&e.handler(),this.closeMenu()},className:this.state.activeItemIndex===t?"active":void 0},e.label,e.label)))),this.state.status&&_e("div",{className:"status"},void 0,this.state.status)))}}const Pe=Ne;var De;function Me(e,t,n,i){De||(De="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:De,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class Oe extends s.PureComponent{static contextType=_.Z;nodeRef=s.createRef();state={maxShown:5};onClickAddress=e=>{e.address&&a.Z.enableCorrespondentView(this.context.vivaldiWindowId,e.address)};render(){const e=this.state.maxShown,t=this.props.mailAddresses;return(0,V.jsxs)("span",{ref:this.nodeRef,className:"detail",children:[t.slice(0,e).map(((e,t)=>{const n=(0,L.li)(e),i=[{...(0,Ze.Z)("Copy address"),handler:()=>ve.Z.copyTextToClipboard(n),onSuccessText:(0,N.Z)("Copied to clipboard",[n]),onErrorText:(0,N.Z)("Failed to copy address")},{...(0,Ze.Z)("See messages to and from address"),handler:this.onClickAddress.bind(this,e)}];return Me(Pe,{prefValues:this.props.prefValues,onClick:this.onClickAddress.bind(this,e),mailAddress:e,buttonTitle:n,dropdownMenuItems:i},n+String(t))})),t.length>this.state.maxShown&&Me("a",{tabIndex:this.props.prefValues[U.kKeyboardTabToAll],onClick:()=>this.setState({maxShown:t.length})},"more",(0,N.Z)("... $1 more","... $1 more",[t.length-this.state.maxShown,t.length-this.state.maxShown])),5!==this.state.maxShown&&Me("a",{tabIndex:this.props.prefValues[U.kKeyboardTabToAll],onClick:()=>this.setState({maxShown:5})},"Show less",(0,N.Z)("Show less"))]},"detail"+t.toString())}}const xe=Oe;var Le,Re=n(15285),Be=n(78347),Fe=n(84283),We=n(95752),Ue=n(54773),Ve=n(10124),He=n(4668),Ge=n(49168),$e=n(86461),Ke=n(59275);function ze(e,t,n,i){Le||(Le="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Le,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const je=[U.kDownloadsNotifyOnComplete,U.kDownloadsOpenPanelOnNew,U.kDownloadsStartAutomatically,U.kKeyboardTabToAll],Ye=(0,N.Z)("Reply To"),Xe=(0,N.Z)("mail","From");function Qe(e){return e?O()(e).format("LLL"):""}var qe=ze("span",{},"separator","→");function Je(e){const t=new Map,n=new Map;return e.forEach(((e,n)=>{const i=v.Z.get(n);if(!i)return;const{accountId:s,name:o}=i;let a=t.get(s);if(a||(a={internal:[],external:[]},t.set(s,a)),e.deleted&&e.internal){const e=a.internal;e.length>0&&e.push(ze("span",{},n+"nbsp",", ")),e.push(ze("span",{style:{textDecoration:"line-through"}},n,(0,Ke.e)(o)))}else{const e=a.external;e.length>0&&e.push(ze("span",{},n,", ")),e.push((0,Ke.e)(o))}})),t.forEach((({internal:e,external:t},i)=>{n.set(i,[...e,...e.length>0?[qe]:[],...0===t.length?[(0,N.Z)("Local Copy")]:[],...t])})),n}var et=ze("span",{className:"label"},void 0,Xe),tt=ze("span",{className:"label"},void 0,Ye),nt=ze("span",{className:"spacer"});class it extends s.PureComponent{static contextType=_.Z;refWebpagecontainer=s.createRef();refSubject=s.createRef();refFrom=s.createRef();refTo=s.createRef();refDate=s.createRef();constructor(e){let t;super(e);let n=[];b.Z.getActiveListEntry()===e.listEntry&&(n=b.Z.getAttachments(),t=b.Z.getRaw()),this.state={attachments:n,dialogParentElement:void 0,customData:null,maxShownAttachments:5,raw:t,deliveredTo:[]}}componentDidMount(){b.Z.addListener(this.activeMessageStoreChanged)}componentWillUnmount(){b.Z.removeListener(this.activeMessageStoreChanged)}activeMessageStoreChanged=()=>{if(b.Z.getActiveListEntry()===this.props.listEntry){const e=b.Z.getAttachments(),t=b.Z.getRaw();t&&(async()=>{const e=await(t?.getDeliveryHeaders())||{};let n=[];const i=e["delivered-to"]||e["x-delivered-to"]||e["x-resolved-to"];i&&(n=[...(0,L.D$)("string"==typeof i?i:i.join(","))]),b.Z.getActiveListEntry()===this.props.listEntry&&this.setState({deliveredTo:n})})(),this.setState({attachments:e,raw:t})}};async maybeParse(e){if("attachment"===e.type){const t=e.content;return"string"==typeof t?{...e,content:await(0,Ve.Z)(t)}:{...e,content:t}}if(this.state.raw){const[t]=await this.state.raw.parse(e.mimeTree);if(t&&"attachment"===t.type)return t}}async onClickAttachment(e,t){const n=await this.maybeParse(t),i=e.detail%2==0;if(n&&!i)if(this.props.prefValues[U.kDownloadsStartAutomatically]){if((0,He.Ve)(n),this.props.prefValues[U.kDownloadsOpenPanelOnNew]){const e=this.context.vivaldiWindowId,t="PanelDownloads";(0,$e.PK)("DownloadButton",e)?ye.Z.executeActions("event",this.context,"COMMAND_SHOW_DOWNLOADS_POPOUT"):Re.ZP.canAutoOpen(e,t)&&Ie.Z.toggleContent(e,t)}}else this.showDialog((0,He.JX)(n))}async onClickAttachmentDropdown(e,t){const n=await this.maybeParse(e);if(!n)return;(0,He.Ve)(n,t);const i=this.context.vivaldiWindowId,s="PanelDownloads";this.props.prefValues[U.kDownloadsOpenPanelOnNew]&&Re.ZP.canAutoOpen(i,s)&&Ie.Z.toggleContent(i,s)}onClickDownloadAll=async e=>{const t=e.detail%2==0;if(!this.state.raw||t)return;(await this.state.raw.parseAttachments()).forEach((e=>(0,He.Ve)(e)))};onClickSaveAll=e=>{const{raw:t}=this.state,n=e.detail%2==0;t&&!n&&this.context.chrome.fileSystem.chooseEntry({type:"openDirectory"},(e=>{const n=Y.Z.runtime.lastError;n?"User cancelled"!==n.message&&de.Z.error("Mail",["attachments"],"Error saving attachments",n.message||n):e?Y.Z.fileSystem.getWritableEntry(e,(n=>{const i={create:!0};t.parseAttachments().then((t=>{for(const e of t){const t=(0,He.up)(e);n.getFile((0,He.BZ)(e.filename),i,(e=>{e.createWriter((e=>{e.write(t)}))}))}if(this.props.prefValues[U.kDownloadsNotifyOnComplete]){const t=new Notification(this.props.fromAddress,{body:(0,N.Z)("Attachments have been saved to $1",e.name),icon:"resources/mail_notification_icon.png"});setTimeout((()=>t.close()),pe.QM)}}))})):de.Z.error("Mail",["attachments"],"Error saving attachments, directory entry missing")}))};onClickSubject=()=>{a.Z.enableThreadedView(this.context.vivaldiWindowId)};_toggleSenderAsMailingList=()=>{this.props.fromAddress&&f.Z.toggleSenderAsMailingList(this.context.vivaldiWindowId,this.props.fromAddress)};_copyHeader=()=>{const{from:e,listEntry:t,message:n}=this.props,{sentDate:i,subject:s}=t,o=n?n.to:Ue.Z.get(t.toIds),{cc:a=[],bcc:r=[]}=n||{},l=[[(0,N.Z)("mail","From"),e],[(0,N.Z)("To"),o],[(0,N.Z)("Cc"),a],[(0,N.Z)("Bcc"),r]];let d=s+"\n"+Qe(i);for(const[e,t]of l)t.length>0&&(d+=`\n${e}: ${(0,L.Rz)(t)}`);d+="\n",ve.Z.copyTextToClipboard(d)};getContextMenuItemsPromise=(e,t)=>{const n=this.context.vivaldiWindowId,i=be.Z.getOptionFunction(e);return be.Z.getNamedMenu(n,e,(async e=>{switch(e.action){case"COMMAND_PAGE_BACK":return{isVisible:()=>y.Z.canGoBack(),...i(n,e,{})};case"COMMAND_PAGE_FORWARD":return{isVisible:()=>y.Z.canGoForward(),...i(n,e,{})};case"CONTEXT_COPY":return{handler:this._copyHeader,...i(n,e,{})};case"COMMAND_TAB_VIEW_PAGE_SOURCE":return{checked:"raw"===this.props.renderingMethod,...i(n,e,{})};case"CONTEXT_SENDER_IS_MAILING_LIST":return{handler:this._toggleSenderAsMailingList,checked:v.Z.isSenderMailingList(this.props.fromAddress),...i(n,e,{})};default:return{...i(n,e,{})}}}))};handleOnCloseDialog=()=>{this.setState({dialogParentElement:void 0})};showDialog=e=>{this.setState({dialogParentElement:this.refWebpagecontainer.current,customData:e})};onHeaderContextMenu=e=>(e.persist(),e.preventDefault(),e.stopPropagation(),this.getContextMenuItemsPromise("mailheader",e).then((t=>{(0,Te.Z)(this.context,t)(e)})),!1);onAttachmentContextMenu=(e,t)=>{(0,Te.Z)(this.context,e)(t)};renderAttachmentButtons=(e,t)=>e.slice(0,t).map(((e,t)=>{const n=[{...(0,Ze.Z)("Save"),handler:()=>this.onClickAttachmentDropdown(e)},{...(0,Ze.Z)("Save As"),handler:()=>this.onClickAttachmentDropdown(e,"saveas")}];return ze("button",{className:"attachment-button",onClick:t=>this.onClickAttachment(t,e),title:e.filename,tabIndex:this.props.prefValues[U.kKeyboardTabToAll],onContextMenu:this.onAttachmentContextMenu.bind(this,n)},e.filename+String(t),e.filename)}));renderSubjectButton=e=>ze(Pe,{prefValues:this.props.prefValues,onClick:this.onClickSubject,buttonTitle:e,dropdownMenuItems:[{...(0,Ze.Z)("Copy subject"),handler:()=>ve.Z.copyTextToClipboard(e),onSuccessText:(0,N.Z)("Copied to clipboard"),onErrorText:(0,N.Z)("Failed to copy subject")},{...(0,Ze.Z)("See message thread"),handler:this.onClickSubject}]});render(){const{listEntry:e,message:t}=this.props,{sentDate:i,sources:s,subject:o}=e,{cc:a=[],bcc:r=[],replyTo:l=[]}=t||{};let d=t?t.to:Ue.Z.get(e.toIds),c=!1;0===r.length&&(2===d.length&&d[0].address.startsWith("undisclosed-recipients@")||0===d.length&&0===a.length)&&(2===d.length&&(d=[]),c=!0);const u=(0,Ge.Zr)(e.flags).toLowerCase(),p=Je(s);return ze("header",{onContextMenu:this.onHeaderContextMenu,className:w()({"mail-detail-header":!0,"is-unread":We.Z.call(s)})},void 0,this.state.dialogParentElement&&this.state.customData&&ze(Se.Z,{customData:this.state.customData,onClose:this.handleOnCloseDialog}),o&&(0,V.jsx)("h1",{className:"subject",ref:this.refSubject,children:this.renderSubjectButton(o)}),ze("div",{className:"mail-indicators"},void 0,Fe.Z.isMessageDeleted(s)&&ze("span",{className:"mail-status-indicator read-status trash",style:{display:"flex"},dangerouslySetInnerHTML:{__html:C.nre.small}}),(0,Ge.XN)(this.props.listEntry)&&ze("span",{className:"mail-status-indicator",dangerouslySetInnerHTML:{__html:C.upG.small}}),(0,Ge.B_)(this.props.listEntry)&&ze("span",{className:"mail-status-indicator",dangerouslySetInnerHTML:{__html:C.hGk.small}}),u&&ze("span",{className:`flag-color flag-${u}`,title:(0,N.Z)("Flagged"),dangerouslySetInnerHTML:{__html:C.nyn.small}})),ze("div",{className:"mail-details"},void 0,(0,V.jsxs)("div",{ref:this.refWebpagecontainer,className:"mail-detail-main",children:[et,(0,V.jsx)(xe,{ref:this.refFrom,prefValues:this.props.prefValues,mailAddresses:this.props.from}),(0,F.$8)(l,this.props.from,this.props.fromAddress)&&(0,V.jsxs)(V.Fragment,{children:[tt,ze(xe,{prefValues:this.props.prefValues,mailAddresses:l})]}),d.length>0&&(0,V.jsxs)(V.Fragment,{children:[ze("span",{className:"label"},void 0,(0,N.Z)("To")),(0,V.jsx)(xe,{ref:this.refTo,prefValues:this.props.prefValues,mailAddresses:d})]}),a.length>0&&(0,V.jsxs)(V.Fragment,{children:[ze("span",{className:"label",title:(0,N.Z)("Carbon copy")},void 0,(0,N.Z)("Cc")),ze(xe,{prefValues:this.props.prefValues,mailAddresses:a})]}),r.length>0&&(0,V.jsxs)(V.Fragment,{children:[ze("span",{className:"label",title:(0,N.Z)("Blind carbon copy")},void 0,(0,N.Z)("Bcc")),ze(xe,{prefValues:this.props.prefValues,mailAddresses:r})]}),c&&this.state.deliveredTo.length>0&&(0,V.jsxs)(V.Fragment,{children:[ze("span",{className:"label",title:(0,N.Z)("Delivered to likely means you were added as a bcc recipient")},void 0,(0,N.Z)("Delivered To")),ze(xe,{prefValues:this.props.prefValues,mailAddresses:this.state.deliveredTo})]}),(e.attachment>0||this.state.attachments.length>0)&&(0,V.jsxs)(V.Fragment,{children:[ze("span",{className:"label",title:(0,N.Z)("Attachment"),dangerouslySetInnerHTML:{__html:n(51843)}}),ze("span",{className:"detail attachments"},void 0,this.renderAttachmentButtons(this.state.attachments,this.state.maxShownAttachments),this.state.attachments.length>this.state.maxShownAttachments&&ze("a",{tabIndex:this.props.prefValues[U.kKeyboardTabToAll],onClick:()=>this.setState((e=>({maxShownAttachments:e.attachments.length})))},void 0,(0,N.Z)("... $1 more","... $1 more",[this.state.attachments.length-this.state.maxShownAttachments,this.state.attachments.length-this.state.maxShownAttachments])),this.state.attachments.length>1&&ze("button",{className:"attachment-button",href:"#",onClick:this.onClickSaveAll},void 0,(0,N.Z)("attachments","Save All")),this.state.attachments.length>1&&ze("button",{className:"attachment-button",href:"#",onClick:this.onClickDownloadAll},void 0,(0,N.Z)("attachments","Download All")))]}),(0,Ge.OK)(e.flags)&&(0,V.jsxs)(V.Fragment,{children:[ze("span",{className:"label"},void 0,(0,N.Z)("Label")),ze("div",{className:"adjustment-mail-labels"},void 0,ze(Ce.Z,{flags:e.flags}))]}),nt]}),ze("div",{className:"mail-detail-side"},void 0,!p.has(pe.u4)&&[...p.entries()].map((([e,t])=>ze("div",{className:"mail-detail-item"},e,t,Object.keys(Be.Z.getAccounts()).length>1&&ze("span",{className:"mail-detail-item-accountId"},void 0,e)))),(0,V.jsx)("div",{className:"mail-detail-item mail-detail-item-date",ref:this.refDate,children:Qe(i)}))))}}const st=(0,we.Z)(it,je);var ot=n(47543);const at={title:"",calendarId:"",is_template:!1},rt={markup:"",style:"",prepend:!1},lt=new TextDecoder("utf-8",{fatal:!0}),dt={ACCEPTED:{existing:(0,N.Z)("You have accepted the invite"),update:(0,N.Z)("You accepted the previous invite")},DECLINED:{existing:(0,N.Z)("You have declined the invite"),update:(0,N.Z)("You declined the previous invite")},TENTATIVE:{existing:(0,N.Z)("You have tentatively accepted the invite"),update:(0,N.Z)("You tentatively accepted the previous invite")},"NEEDS-ACTION":{existing:(0,N.Z)("You still have to reply to the invite"),update:(0,N.Z)("You did not reply to the previous invite")},DECLINECOUNTER:{existing:(0,N.Z)("You have declined the counter proposal"),update:""},DELEGATED:{existing:(0,N.Z)("You delegated invite to another person"),update:(0,N.Z)("You delegated previous invite to another person")}};function ct(e){return(0,B.Nw)((0,D.Z)(e).replace(/\n/g,"<br />")).sanitized}function ut(e){return E.ZP.createStyleRoot(e)+"\n  .shadowWrapper {\n    padding: 18px;\n  }\n  .Event {\n    color: var(--colorFg);\n    background-color: var(--colorBgIntense);\n    font-family: system-ui, sans-serif;\n    font-size: 13px;\n    font-weight: 400;\n    border: 1px solid var(--colorBorder);\n    border-radius: var(--radius);\n  }\n  .Event-Message {\n    padding: 12px;\n    display: flex;\n    flex-direction: row;\n    justify-content: space-between;\n    border-bottom: 1px solid var(--colorBorder);\n    align-items: center;\n  }\n  .Event-Rsvp {\n    margin-bottom: 12px;\n    padding: 6px 12px;\n    display: flex;\n    flex-direction: row;\n    justify-content: space-between;\n    align-items: center;\n    background-color: var(--colorBg);\n    border-bottom: 1px solid var(--colorBorder);\n  }\n  .Event-Error {\n    margin: 0 6px;\n    padding: 12px;\n    display: flex;\n    flex-direction: row;\n    justify-content: space-between;\n    background-color: var(--colorErrorBg);\n    border-bottom: 1px solid var(--colorBorder);\n    align-items: start;\n    font-weight: 700;\n    color: var(--colorErrorFg);\n  }\n  .Event-Title {\n    font-size: 16px;\n    margin: 12px;\n    color: var(--colorFgIntense);\n  }\n  .Event-Title--Previous {\n    font-size: 16px;\n    margin: 0;\n    font-weight: normal;\n  }\n  .Event-Title--Changed {\n    text-decoration: line-through;\n  }\n  .Event-Props {\n    display: grid;\n    grid-template-columns: max-content 1fr;\n    gap: 6px 18px;\n    margin: 12px;\n  }\n  .Event-Props--Diff {\n    grid-template-columns: max-content 1fr 1fr;\n  }\n  .Event-Props--Diff .Event-Title {\n    margin: 0;\n  }\n  .Event-Prop--Previous p {\n    text-decoration: line-through;\n  }\n  .Event-Prop--Previous p.Event-Attendee--Exists {\n    text-decoration: none;\n  }\n  span {\n    flex: 1 1 auto;\n  }\n  input[type=button] {\n    padding: 6px 18px;\n    margin-left: 6px;\n    color: var(--colorFgIntense);\n    background-color: var(--colorBgIntense);\n    border: 1px solid var(--colorBorder);\n    border-radius: var(--radius);\n    font-size: 14px;\n  }\n  input[type=button]:enabled:hover {\n    background-image: linear-gradient(var(--colorBg), var(--colorBg))\n  }\n  dd, dt, p {\n    margin: 0 0 3px 0;\n    padding: 0;\n    word-break: break-word;\n  }\n  p:last-child {\n    margin: 0;\n  }\n  dt {\n    font-weight: 600;\n  }\n  "}function pt(e,t=!1){const n=t?(0,N.Z)("Can not determine email address to reply from. Which one should be used to send your reply?"):(0,N.Z)("More than one of your email addresses are invited. Which one should be used to send your reply?");return{title:(0,N.Z)("Select Reply Mail"),body:n,actions:e.map(((e,t)=>({title:e,action:e,default:0===t}))),cancelAction:{title:(0,N.Z)("Cancel"),action:"cancel"}}}function ht(e,t,n){let i,s,o;try{const e=(0,ce.Z)(t);e.METHOD||(e.VEVENT[0]?.ORGANIZER&&e.VEVENT[0]?.ATTENDEE?e.METHOD="REQUEST":e.METHOD="PUBLISH"),s=e.METHOD;let n=e.VEVENT[0];const a=n?.EXCEPTIONS??[];if(1===a.length&&1===Object.keys(n).length&&(n=a[0]),!n)return de.Z.error("Mail",["invite"],"No event in invite"),{inviteInfo:{type:"parsing_error",message:(0,N.Z)("No event in invite")},incomingEvent:at};o=n["RECURRENCE-ID"],i=(0,ge.rP)(n,re.ZP.getDefaultCalendar()?.id||"")}catch(e){return de.Z.error("Mail",["invite"],"Error parsing iCalendar"),console.log("Mail. Error parsing iCalendar attachment.",t),{inviteInfo:{type:"parsing_error",message:e.message},incomingEvent:at}}const a=i.invites||[];let r=n.find((e=>e.uid===i.uid&&!e.trash));if(r?.rrule&&o){const e=(0,ge.Uq)(o),{event:t}=(0,fe.Km)(new Date(e),r);t&&(r=t),i.calendarId=r.calendarId}const l={incomingEvent:i,existingEvent:r,method:s},d=e?.rsvpState||"NEEDS-ACTION";if(r&&"ical"===re.ZP.getAccountAndCalendar(r.calendarId)?.account?.account_type){const e="NEEDS-ACTION"===d?{type:"invite_existing_ical_unanswered"}:{type:"invite_existing_ical_answered",state:d};return{...l,inviteInfo:e}}const c=i.sequence??0,u=r?.sequence??0;if("PUBLISH"===s)return r?u<c?{...l,inviteInfo:{type:"publish_update"}}:{...l,inviteInfo:{type:"publish_existing"}}:{...l,inviteInfo:{type:"publish_not_existing"}};if("REQUEST"===s)return r?o?"NEEDS-ACTION"===d?{...l,inviteInfo:{type:"update_single_exception_unanswered",recurrenceId:o}}:{...l,inviteInfo:{type:"update_single_exception_answered",state:d,recurrenceId:o}}:r.organizer!==i.organizer?{...l,inviteInfo:{type:"update_fraudulent"}}:u<c?"NEEDS-ACTION"===d?{...l,inviteInfo:{type:"update_unanswered",prevState:d}}:{...l,inviteInfo:{type:"update_answered",state:d}}:u===c?"NEEDS-ACTION"===d?{...l,inviteInfo:{type:"invite_existing_unanswered"}}:{...l,inviteInfo:{type:"invite_existing_answered",state:d}}:{...l,inviteInfo:{type:"invite_outdated"}}:o?{...l,inviteInfo:{type:"update_single_exception_not_existing",recurrenceId:o}}:"NEEDS-ACTION"===d?{...l,inviteInfo:{type:"invite_unanswered"}}:{...l,inviteInfo:{type:"invite_answered",state:d}};if("CANCEL"===s)return o&&function(e,t){const n=e?.recurrenceExceptions;if(n?.length){const e=(0,ge.Uq)(t);return Boolean(n.find((t=>t.cancelled&&t.date===e)))}return!1}(r,o)?{...l,inviteInfo:{type:"cancel_recurring_cancelled"}}:r?{...l,inviteInfo:{type:"cancel_existing",recurrenceId:o}}:{...l,inviteInfo:{type:"cancel_not_existing"}};if("REPLY"===s){if(1!==a.length||c>u)return{...l,inviteInfo:{type:"reply_invalid"}};const e=a[0];if(!r)return{...l,inviteInfo:{type:"reply_not_existing"}};const t=r.invites||[];if(!t.some((t=>t.address===e.address)))return{...l,inviteInfo:{type:"reply_fraudulent"}};if(c===u&&1===a.length){const{partstat:e,address:n}=a[0],i=t.find((e=>e.address===n));if(i&&i.partstat===e)return{...l,inviteInfo:{type:"reply_not_changed"}};if(i&&i.partstat!==e)return{...l,inviteInfo:{type:"reply_changed"}}}if(c<u)return{...l,inviteInfo:{type:"reply_outdated"}}}return"COUNTER"===s?c>u?{...l,inviteInfo:{type:"counter_invalid"}}:c<u?{...l,inviteInfo:{type:"counter_outdated"}}:r?d?{...l,inviteInfo:{type:"counter_existing_answered",state:d}}:{...l,inviteInfo:{type:"counter_existing_unanswered"}}:{...l,inviteInfo:{type:"counter_not_existing"}}:{...l,inviteInfo:{type:"invite_unsupported_method"}}}function gt(e){return"string"==typeof e?e:e[0]}function mt(e,t,n,i,s,o,a,r,l){if(!t||!n)return rt;const{incomingEvent:d,existingEvent:c,method:u,inviteInfo:p}=ht(t,s,o),h=W.Z.get(U.kMailAccounts),g=y.Z.getSelectedFolder(),m=Array.from(Je(n.sources).keys()),f=(d.invites||[]).map((e=>e.address));let v;i?.["delivered-to"]?v=gt(i["delivered-to"]):1===t.to.length?v=t.to[0].address:i?.["x-delivered-to"]?v=gt(i["x-delivered-to"]):i?.["x-resolved-to"]&&(v=gt(i["x-resolved-to"]));const b=v&&f.includes(v)?v:null,S=`\n    <input type="button" value="${(0,N.Z)("Accept")}" onclick="console.log('Accept')" />\n    <input type="button" value="${(0,N.Z)("Maybe")}" onclick="console.log('Maybe')" />\n    <input type="button" value="${(0,N.Z)("Decline")}" onclick="console.log('Decline')" />\n  `,w=`\n    <input type="button" value="${(0,N.Z)("Accept")}" onclick="console.log('AcceptCounter')" />\n    <input type="button" value="${(0,N.Z)("Decline")}" onclick="console.log('DeclineCounter')" />\n  `,C=`<input type="button" value="${(0,N.Z)("Add To Calendar")}" onclick="console.log('Add')" />`,A=`<input type="button" value="${(0,N.Z)("Update in Calendar")}" onclick="console.log('Update')" />`;let I,T="",Z="",E="";switch(p.type){case"invite_existing_ical_unanswered":T=(0,N.Z)("This message contains changes for an event that you have in a read only web calendar. You can reply to it here but your status will not be updated in the Calendar."),E+=S;break;case"invite_existing_ical_answered":T=(0,N.Z)("This message contains changes for an event that you have in a read only web calendar."),E+=dt[p.state].existing;break;case"publish_not_existing":T=(0,N.Z)("This message contains event data published for your information."),Z=C;break;case"publish_existing":T=(0,N.Z)("This message contains event data that you already have in your calendar.");break;case"publish_update":T=(0,N.Z)("This message contains event update published for your information."),Z=A;break;case"invite_unanswered":b?(T=(0,N.Z)("This message contains a calendar event invite."),E+=S):T=(0,N.Z)("This message contains a calendar event invite. You are not invited but you can still add it to your calendar."),Z=C;break;case"invite_answered":T=(0,N.Z)("This message contains a calendar event invite you have responded to but you don't have the event in your calendar."),Z=C,E+=dt[p.state].existing;break;case"invite_outdated":T=(0,N.Z)("This message contains a calendar event invite. You have a more recent version of the event in your calendar.");break;case"invite_existing_unanswered":T=(0,N.Z)("This message contains an invitation to an event you have in your calendar. You have not responded to the invitation."),E+=S;break;case"invite_existing_answered":T=(0,N.Z)("This message contains an existing event you have in your calendar."),E+=dt[p.state].existing;break;case"update_unanswered":T=(0,N.Z)("This message contains an update to a calendar event.")+dt[p.prevState].update,Z=A,E+=S;break;case"update_answered":T=(0,N.Z)("This message contains an update to a calendar event.")+dt[p.state].update,Z=A,E+=dt[p.state].existing;break;case"update_single_exception_answered":T=(0,N.Z)("This message contains an invite to make an exception to a recurring calendar event."),E+=dt[p.state].existing,I=p.recurrenceId;break;case"update_single_exception_unanswered":T=(0,N.Z)("This message contains an invite to make an exception to a recurring calendar event."),Z=C,E+=S,I=p.recurrenceId;break;case"update_single_exception_not_existing":T=(0,N.Z)("This message contains an invite to make an exception to a recurring calendar event that you do not have in your calendar. You can still accept this as a stand alone event."),Z=C,E+=S,I=p.recurrenceId;break;case"update_fraudulent":T=(0,N.Z)("This message contains an update to a calendar event. It does not match the event you have in your calendar. Check the event details below and if it looks correct you have to delete the existing event in your calendar before you can accept this one.");break;case"cancel_existing":T=(0,N.Z)("This message contains an event cancellation."),Z=`<input type="button" value="${(0,N.Z)("Remove from Calendar")}" onclick="console.log('Delete')" />`,I=p.recurrenceId;break;case"cancel_not_existing":T=(0,N.Z)("This message contains cancellation of an event you don’t have in your calendar.");break;case"cancel_recurring_cancelled":T=(0,N.Z)("This message contains cancellation of an event already cancelled in your calendar.");break;case"reply_not_existing":T=(0,N.Z)("This message contains an invite reply for an event you do not have in your calendar.");break;case"reply_invalid":T=(0,N.Z)("Invalid event invite reply found.");break;case"reply_fraudulent":T=(0,N.Z)("Fraudulent event invite reply found.");break;case"reply_not_changed":T=(0,N.Z)("This message contains an event invite reply which is already processed.");break;case"reply_changed":T=(0,N.Z)("This message contains an event invite reply."),Z=`<input type="button" value="${(0,N.Z)("Update Event in Calendar")}" onclick="console.log('Partstat')" />`;break;case"reply_outdated":T=(0,N.Z)("This message contains an event invite reply for an older version of the event.");break;case"counter_not_existing":T=(0,N.Z)("This message contains a counter proposal for an event which was not found. It will be ignored.");break;case"counter_existing_unanswered":T=(0,N.Z)("This message contains a counter proposal for the following event."),Z=w;break;case"counter_existing_answered":T=(0,N.Z)("This message contains a counter proposal for the following event."),T+=dt[p.state].existing;break;case"counter_outdated":T=(0,N.Z)("This message contains an outdated counter proposal. It will be ignored.");break;case"counter_invalid":T=(0,N.Z)("This message contains an invalid counter proposal. It will be ignored.");break;case"invite_unsupported_method":T=(0,N.Z)("Unsupported method parameter “$1”.",[u??""]);break;case"parsing_error":T=(0,N.Z)("Error parsing calendar data. For details see logs located in Calendar button on status bar.")}E&&(E=`<span>${(0,N.Z)("RSVP")}</span>`+E);const k="parsing_error"===p.type?"":function(e,t,n,i){const s=[],{url:o,location:a,organizer:r,invites:l,rrule:d}=t,c=O()(t.start),u=O()(t.end);t.allDay?c.isSame(u,"day")?(s.push([(0,N.Z)("Date"),c.format("LL"),""]),s.push(["","",""])):(s.push([(0,N.Z)("Starts"),c.format("LL"),""]),s.push([(0,N.Z)("Ends"),u.format("LL"),""])):(s.push([(0,N.Z)("Starts"),c.format("LLLL"),""]),s.push([(0,N.Z)("Ends"),u.format("LLLL"),""])),s.push([" ",i?(0,N.Z)("Single event exception"):d?(0,me.p)((0,ot.Qj)(d,t.timezone,t.start)):"",""]),s.push([(0,N.Z)("Organizer"),r||"",""]),s.push([(0,N.Z)("Attendees"),l&&l.map((e=>`<p>${e.address}</p>`)).join("\r\n"),""]),s.push([(0,N.Z)("other","Location"),a,""]),s.push([(0,N.Z)("URL"),o?`<a href="${o}">${o}</a>`:"",""]),s.push([(0,N.Z)("Description"),ct(t.description||""),""]);const p=parseInt(n?.sequence)||0,h=parseInt(t.sequence)||0,g=n&&("REQUEST"===e&&p<h||"COUNTER"===e&&p===h);if(g&&n){const e=O()(n.start),i=O()(n.end);if(n.allDay!==t.allDay)n.allDay?(s[0][2]=`<p>${e.format("LL")}</p>`,e.isSame(i,"day")||(s[1][2]=`<p>${i.format("LL")}</p>`)):(s[0][2]=`<p>${e.format("LLLL")}</p>`,s[1][2]=`<p>${i.format("LLLL")}</p>`);else{const o=t.allDay?"LL":"LLLL";n.start!==t.start&&(s[0][2]=`<p>${e.format(o)}</p>`),n.end!==t.end&&(s[1][2]=`<p>${i.format(o)}</p>`)}if(n.rrule!==d&&(s[2][2]=`<p>${(0,me.p)((0,ot.Qj)(n.rrule,n.timezone,n.start))}</p>`),n.organizer!==r&&(s[3][2]=`<p>${n.organizer||"&nbsp"}</p>`),(0,R.Z)((n.invites||[]).map((e=>e.address)),(l||[]).map((e=>e.address)))||(s[4][2]=n.invites&&n.invites.map((e=>`<p ${t.invites?.some((t=>t.address===e.address))?'class=" Event-Attendee--Exists"':""}>${e.address}</p>`)).join("\r\n")||"&nbsp"),a&&n.location!==a&&(s[5][2]=`<p>${n.location||"&nbsp"}</p>`),o&&n.url!==o){const e=n.url;s[6][2]=e?`<p><a href="${e}">${e}</a></p>`:"&nbsp"}t.description&&n.description!==t.description&&(s[7][2]=`<p>${ct(n.description||"")}</p>`||"&nbsp")}const m=s.filter((e=>e[1]||e[2])),f=`<h1 class="Event-Title">${t.title||he.gT}</h1>`;if(g&&n){const e=n.title||he.gT;return`\n      <dl class="Event-Props Event-Props--Diff">\n        <dt />\n        <dd>${f}</dd>\n        <dd><h2 class="${t.title===n.title?"Event-Title--Previous":"Event-Title--Previous Event-Title--Changed"}">${e}</h2></dd>\n      ${m.map((([e,t,n])=>{let s="Event-Prop--Previous";return" "===e&&i&&(s=""),`\n              <dt>${e}</dt>\n              <dd>${t||""}</dd>\n              <dd class="${s}">${n||""}</dd>`})).join("\r\n")}\n      </dl>\n    `}return`\n    ${f}\n    <dl class="Event-Props">\n    ${m.map((([e,t])=>`\n      <dt>${e}</dt>\n      <dd>${t||""}</dd>`)).join("\r\n")}\n    </dl>\n  `}(u,d,c,I);return{markup:`\n    <div class="Event">\n      <div class="Event-Message"><span>${T}</span>${Z}</div>\n      ${E?`<div class="Event-Rsvp">${E}</div>`:""}\n      ${r&&`<div class="Event-Error">${r}</div>`}\n      ${k}\n    </div>\n      `,style:ut(a),prepend:!0,messageHandler:async n=>{const{message:i}=n;let s="";if("DeclineCounter"===i)s=t?.from[0].address||"";else if(["Accept","Maybe","Decline","AcceptCounter"].includes(i)||"DeclineCounter"===i&&!s){if(1===m.length)s=m[0];else if(0===m.length){if(1===h.length)s=h[0].MAIL_EMAIL;else if(g){const{accountId:e,path:t}=g;h.some((t=>t.MAIL_EMAIL===e))?s=e:t&&e===pe.Ry&&(s=t.split("/")[0])}if(!s){const{action:t}=await le.Z.showModal(e,{modal:pt(h.map((e=>e.MAIL_EMAIL)),!0)});s=t}}else{const{action:t}=await le.Z.showModal(e,{modal:pt(m)});s=t}if("cancel"===s)return}try{switch(i){case"Accept":if(!b)throw new Error("Can not accept invite. No attendee found.");await ae.Z.replyToInvite(e,d,b,s,"ACCEPTED",I);break;case"Maybe":if(!b)throw new Error("Can not accept invite. No attendee found.");await ae.Z.replyToInvite(e,d,b,s,"TENTATIVE",I);break;case"Decline":if(!b)throw new Error("Can not decline invite. No attendee found.");await ae.Z.replyToInvite(e,d,b,s,"DECLINED",I);break;case"Add":await ae.Z.addEventToCalendar(d,I);break;case"Update":case"AcceptCounter":c&&await ae.Z.updateEventInCalendar(d,c);break;case"DeclineCounter":if(!b)throw new Error("Can not decline counter. No attendee found.");ae.Z.declineCounter(e,d,b,s);break;case"Delete":ae.Z.handleCancellation(d,I);break;case"Partstat":ae.Z.handleReply(d)}r&&l("")}catch(e){de.Z.error("Calendar",["invite"],"Error handling invite.",e),l(`Error handling invite. ${e.message}`)}}}}const ft={type:"text",content:""};const vt=s.forwardRef((function(e,t){const{windowId:n,style:i,fromAddress:o,isRss:a,isSenderTrusted:r,listEntry:l,message:d,onUnblockExternalContent:c,raw:u,renderingMethod:p,shouldWarnUserFrom:h,shouldWarnUserFromName:g,shouldWarnUserReplyTo:m}=e,f=function(e,t,n){const[i,o]=s.useState([]);return s.useMemo((()=>{if(e)if("raw"===n)if(t)t.getByteString().then((e=>o([{type:"text",content:e}])));else if(e.bodyParts&&"string"==typeof e.bodyParts[0].content){const t=e.bodyParts[0].content,n=(0,F.yN)(e.bodyParts);j.Z.build(e,t,n).then((e=>o([{type:"text",content:e}])))}else o([]);else e.bodyParts?o(e.bodyParts):t&&t.parseMainPart(n).then(o);else o([])}),[e,t,n]),i}(d,u,p),v=function(e,t){const[n,i]=s.useState(),o=s.useRef();return o.current=e,s.useEffect((()=>{const n=[];return e&&"raw"!==t?((async()=>{const t=(0,J.Dc)(e.mimeTree).filter((e=>e.mimeType&&e.mimeType.startsWith("image/")));for(const i of t){const t=await e.parse(i.mimeTree);if(1===t.length&&"attachment"===t[0].type){const{content:e,mimeType:i}=t[0],s=new Blob([e],{type:"string"==typeof i?i:""}),o=URL.createObjectURL(s);n.push(o)}}if(n.length>0&&e===o.current){const e={markup:n.map((e=>`<img src="${e}" />`)).join(""),style:"img {\n            margin-top: 12px;\n            display: inline-block;\n            vertical-align: top;\n            max-width: 100%;\n            height: auto;\n          }",prepend:!1};i(e)}else i()})(),()=>{n.forEach((e=>URL.revokeObjectURL(e)))}):i()}),[e,t]),n}(u,p),y=function(e,t,n,i,o,a){const{events:r}=(0,ue.Z)(oe.Z),[l,d]=s.useState(),[c,u]=s.useState(""),p=s.useRef();return p.current=t,s.useEffect((()=>{if(!i||"raw"===o)return u(""),d();(async()=>{let s,o={};const l=await i.parseCalendar();l&&t?.id===p.current?.id&&(o=await i.getDeliveryHeaders(),s="string"==typeof l.content?l.content:lt.decode(l.content)),s?d(mt(e,t,n,o,s,r,a,c,u)):d()})()}),[c,r,n,t,i,o,a,e]),l}(n,d,l,u,p,i);let b,S;if(u&&d&&(b=y||v),d&&(S=f.find((e=>"html"===e.type)),S||(S=f.find((e=>"text"===e.type)))),S||(S=ft),"html"===S.type||"text"===S.type){const n=!!d&&!d.trusted&&!r;return(0,V.jsx)(z,{style:i,blockHTTPLeaks:n,bodyParts:"html"===S.type?f:void 0,fromAddress:o,shouldWarnUserReplyTo:m,shouldWarnUserFrom:h,shouldWarnUserFromName:g,inject:b,messageHeader:e.messageHeader,isRss:a,onUnblockExternalContent:c,ref:t,textOrHtml:S,renderingMethod:p},"mainBody")}return null}));var yt,bt=n(75459),St=n(97698),wt=n(2431),Ct=n(96951),At=n(68247),It=n(69697),Tt=n(98102),Zt=n(36246);function Et(e,t,n,i){yt||(yt="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:yt,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function kt(e){return!!e.message&&e.message.cc.length+e.message.to.length>1}class _t extends s.PureComponent{static contextType=_.Z;state={content:"",replyAll:kt(this.props),editorHeight:W.Z.get(U.kMailQuickReplyHeight)??150,showQuickReply:W.Z.get(U.kMailShowQuickReply),shouldQuote:W.Z.get(U.kMailQuickReplyQuote)};refContent=s.createRef();componentDidMount(){u.Z.addListener("COMMAND_MAIL_SEND_MESSAGE",this.onCommandSpy)}componentWillUnmount(){u.Z.removeListener("COMMAND_MAIL_SEND_MESSAGE",this.onCommandSpy)}componentDidUpdate(e){this.props.message?.id!==e.message?.id&&this.setState({content:"",replyAll:kt(this.props),shouldQuote:W.Z.get(U.kMailQuickReplyQuote)})}onCommandSpy=(e,t)=>{Ct.ZP.getPageById(this.props.pageId)?.active&&e===this.context.vivaldiWindowId&&"COMMAND_MAIL_SEND_MESSAGE"===t&&this.quickReply()};getContent=()=>this.state.content;clear=()=>{this.setState({content:""})};onChange=({currentTarget:e})=>{this.setState({content:e.value})};toggleReplyAll=()=>{this.setState((e=>({replyAll:!e.replyAll})))};toggleShouldQuote=()=>{this.setState((e=>({shouldQuote:!e.shouldQuote})))};quickReply=async()=>{if(!this.props.message)return;const e={...this.props.message};if(this.state.shouldQuote){const t=e.bodyParts?[...e.bodyParts]:[];this.props.refBody.current&&t.push(this.props.refBody.current.props.textOrHtml),e.bodyParts=t}const t=function(e){const{attachments:t,body:n,cidAttachments:i,focusOnBody:s,fromDraft:o,plaintext:a,selectedAccount:r,replyScope:l,...d}=e;return{...d,flags:[],internal:!0,bcc:[],bodyParts:[{type:"text",content:a?n:(0,B.Nw)(n).sanitized}]}}(wt.Z.createQuickReply(e,this.state.content,this.state.replyAll)),n=await St.Z.storeMessage(t,!0);St.Z.sendSelected(this.context.vivaldiWindowId,[n]),this.clear()};onSlidebarPosition=(e,t)=>{this.setState((e=>{const n=(0,Zt.Z)(("minimize"===e.showQuickReply?0:e.editorHeight)-t,0,350);return{editorHeight:n,showQuickReply:n?"show":"minimize"}}))};onSlideBarDoubleClick=()=>{this.setState((e=>{const t="minimize"===W.Z.get(U.kMailShowQuickReply)?"show":"minimize",n=e.editorHeight<10?150:e.editorHeight;return At.Z.set(U.kMailShowQuickReply,t),At.Z.set(U.kMailQuickReplyHeight,n),{showQuickReply:t,editorHeight:n}}))};onSlideBarStop=()=>{let{editorHeight:e}=this.state;e<45?e=0:e<90&&(e=90),this.setState({editorHeight:e,showQuickReply:e?"show":"minimize"}),At.Z.set(U.kMailShowQuickReply,"minimize"===this.state.showQuickReply||0===e?"minimize":"show"),At.Z.set(U.kMailQuickReplyHeight,e)};render(){return Et("div",{id:"quick_reply",style:"minimize"===this.state.showQuickReply?{}:{height:`${this.state.editorHeight}px`}},void 0,Et("section",{className:"minimize"===this.state.showQuickReply?"minimize":""},void 0,Et(It.Z,{onStop:this.onSlideBarStop,onSlidebarPosition:this.onSlidebarPosition,onDoubleClick:this.onSlideBarDoubleClick,returnOffset:!0,position:"bottom"}),(0,V.jsx)("textarea",{rows:"1",style:"minimize"===this.state.showQuickReply?{display:"none"}:{},ref:this.refContent,placeholder:(0,N.Z)("Write a quick reply here"),title:(0,N.Z)("Write a Quick Reply"),value:this.state.content,onChange:this.onChange}),Et("div",{className:"toolbar toolbar-default",style:"minimize"===this.state.showQuickReply?{display:"none"}:{}},void 0,Et("div",{className:"toolbar toolbar-group"},void 0,Et(Tt.ZP,{tabIndex:0,title:(0,N.Z)("Send"),tooltip:this.state.replyAll?(0,N.Z)("Reply to all"):(0,N.Z)("Reply to sender"),onClick:this.quickReply,image:C.zLp.small,className:"button-mail-compose",disabled:!this.state.content})),Et("div",{},void 0,kt(this.props)&&Et("label",{},void 0,Et("input",{type:"checkbox",checked:this.state.replyAll,onChange:this.toggleReplyAll}),Et("span",{},void 0,(0,N.Z)("Reply All"))),Et("label",{},void 0,Et("input",{type:"checkbox",checked:this.state.shouldQuote,onChange:this.toggleShouldQuote}),Et("span",{title:(0,N.Z)("Append message being replied to as quotation in reply")},void 0,(0,N.Z)("Include Quoted Text")))))))}}var Nt=n(37330),Pt=n(89378),Dt=n(97823),Mt=n(28918),Ot=n(55346),xt=n(48868);const Lt={call:function(e){return xt.Z.pop.where("searchListId").equals(e).toArray()}};var Rt=n(35489);var Bt,Ft=n(57357),Wt=n(24651),Ut=n(83507),Vt=n(51877),Ht=n(13519),Gt=n(11472),$t=n(34155);function Kt(e,t,n,i){Bt||(Bt="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:Bt,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const zt=["colorHighlightFg","colorHighlightBg","colorFg","colorBg","colorBgDark","colorFgIntense","colorBgIntense","colorBorder","radius","colorErrorFg","colorErrorBg"];function jt(e){const t=String(e["--colorBg"]),n=String(e["--colorHighlightBg"]),i=c()(t).luminance(),s=i<.2?.7:i>.8?.3:.5,o=String(c()(n).set("hsl.h",c()(n).get("hsl.h")+80).luminance(s)),a=String(c()(n).set("hsl.h",c()(n).get("hsl.h")+160).luminance(s)),r=String(c()(n).set("hsl.h",c()(n).get("hsl.h")+240).luminance(s));return{...e,"--quoteLvl1":o,"--quoteLvl2":a,"--quoteLvl3":r}}async function Yt(e,t,n){const{id:i,sentDate:s}=t,{accountId:o}=n;await e.writeBufferToDisk(o,s,i),await Wt.Z.setHasRaw(o,i)}async function Xt(e,t,n){async function i(e){for(const i of e){const e=await Ut.Z.call(i.accountId,t,n);if(e){if(0!==e.byteLength)return e;de.Z.warn("Mail",["detail-view","fetch-message"],"Ignoring empty message on disk")}}}return await i(e.samePathFilters)||await i(e.sameAccountFilters)||await i(e.otherFilters)}class Qt extends s.Component{static contextType=_.Z;messageBody=s.createRef();messageHeader=s.createRef();isRssFeedMessage=!1;constructor(e,t){super(e),this.state={style:jt(Nt.Z.getBaseStylesByWindowId(t.vivaldiWindowId,zt)),message:void 0,renderingMethod:W.Z.get(U.kMailPreferredRendering),isSenderTrusted:!1,accountOfflineNoMessage:!1,netOfflineNoMessage:!1,rssNoMessage:!1,showQuickReply:W.Z.get(U.kMailShowQuickReply)}}_setIfActive=e=>{$t.nextTick((()=>{const t=this.messageBody.current?.refWebview.current,n=this.context.vivaldiWindowId;e.pageIsActive?(a.Z.setActiveMailDetail(this),t&&r.Z.setActiveWebView(n,t)):(a.Z.clearIfActive(this),t&&r.Z.clearIfActive(n,t))}))};_markSeenReadIfHasBody=()=>{f.Z.markSeenReadDebounced.cancel();const{listEntry:e}=this.props,{message:t,raw:n}=this.state;if(e&&t){const{bodyParts:i}=t;e&&(n||i)&&f.Z.markSeenReadDebounced(e)}};componentDidMount(){u.Z.addListener("COMMAND_TAB_VIEW_PAGE_SOURCE",this.onCommandSpy),u.Z.addListener("COMMAND_MAIL_SHOW_PLAINTEXT",this.onCommandSpy),u.Z.addListener("COMMAND_MAIL_SHOW_HTML",this.onCommandSpy),W.Z.addListener([U.kMailAccounts,U.kMailPreferredRendering,U.kMailColorQuotedText,U.kMailShowQuickReply],this.onPrefsChanged),Nt.Z.addListener(this.onThemeStoreChanged),m.Z.addListener(this.onConnectionChanged),this.context.addEventListener("online",this._onOnline),v.Z.getIndex().length>0?this.fetchMessage(this.props):v.Z.addListener(this.checkIfReadyToReadFromDisk),this._setIfActive(this.props)}_onOnline=()=>{this.state.netOfflineNoMessage&&this.setState({netOfflineNoMessage:!1},(()=>this.fetchMessage(this.props)))};onConnectionChanged=e=>{!1!==e.isDisconnected||this.state.raw||this.setState({netOfflineNoMessage:!1},(()=>{this.props.listEntry&&(de.Z.log("Mail",["detail-view","connnection status",e.accountId],"connection established - fetch message body"),this.fetchMessage(this.props))}))};onPrefsChanged=(e,t,n)=>{switch(n){case U.kMailAccounts:this.state.accountOfflineNoMessage&&this.setState({accountOfflineNoMessage:!1},(()=>{this.props.listEntry&&this.fetchMessage(this.props)}));break;case U.kMailPreferredRendering:this.setState({renderingMethod:t});break;case U.kMailColorQuotedText:this.fetchMessage(this.props);break;case U.kMailShowQuickReply:this.setState({showQuickReply:t})}};checkIfReadyToReadFromDisk=e=>{"finishIndexProgress"===e.target&&(v.Z.ensureRemovedListener(this.checkIfReadyToReadFromDisk),this.fetchMessage(this.props))};_isBeingActivated(e){return!this.props.pageIsActive&&e.pageIsActive}UNSAFE_componentWillReceiveProps(e){const t=e.listEntry?e.listEntry.id:void 0;(this.props.listEntry?this.props.listEntry.id:void 0)!==t?this.fetchMessage(e):this._isBeingActivated(e)&&(void 0!==t&&t===o.Z.composerSearchListId&&this.fetchMessage(e),o.Z.composerSearchListId=void 0),e.pageIsActive!==this.props.pageIsActive&&this._setIfActive(e)}shouldComponentUpdate(e,t){return e.hasNoListEntries!==this.props.hasNoListEntries||(!(0,Vt.Z)(this.state,t)||!!this.props.prefValues&&!!e.prefValues&&this.props.prefValues[U.kMailViewLayout]!==e.prefValues[U.kMailViewLayout])}componentDidUpdate(){this._markSeenReadIfHasBody()}componentWillUnmount(){u.Z.removeListener("COMMAND_TAB_VIEW_PAGE_SOURCE",this.onCommandSpy),u.Z.removeListener("COMMAND_MAIL_SHOW_PLAINTEXT",this.onCommandSpy),u.Z.removeListener("COMMAND_MAIL_SHOW_HTML",this.onCommandSpy),W.Z.removeListener([U.kMailAccounts,U.kMailPreferredRendering,U.kMailColorQuotedText,U.kMailShowQuickReply],this.onPrefsChanged),v.Z.ensureRemovedListener(this.checkIfReadyToReadFromDisk),m.Z.removeListener(this.onConnectionChanged),this.context.removeEventListener("online",this._onOnline),Nt.Z.removeListener(this.onThemeStoreChanged),this._currentId=-1,$t.nextTick((()=>{a.Z.clearIfActive(this);const e=this.messageBody.current?.refWebview.current;e&&r.Z.clearIfActive(this.context.vivaldiWindowId,e)}))}onCommandSpy=(e,t)=>{if(this.props.pageIsActive&&e===this.context.vivaldiWindowId)switch(t){case"COMMAND_TAB_VIEW_PAGE_SOURCE":this.toggleRenderingMethod("raw");break;case"COMMAND_MAIL_SHOW_PLAINTEXT":this.toggleRenderingMethod("plaintext");break;case"COMMAND_MAIL_SHOW_HTML":this.toggleRenderingMethod("prefer_html")}};onThemeStoreChanged=()=>{const e=jt(Nt.Z.getBaseStylesByWindowId(this.context.vivaldiWindowId,zt));(0,R.Z)(this.state.style,e)||this.setState({style:e})};async updateMessage(e,t,n){const i=(0,Ht.H)(n),s={searchListId:e,subject:t.subject,body:i,to:(0,Pt.Z)(t.to),cc:(0,Pt.Z)(t.cc),from:(0,Pt.Z)(t.from),replyTo:(0,Pt.Z)(t.replyTo)};if(!await x.Z.mailPrivate.updateMessage(s))throw new Error(`Failed to add body to FTS db for id ${e}`)}async updatePreview(e,t){const n=(0,Ht.Q)(t);f.Z.updateIndex({sleUpdates:[{id:e,updates:{preview:n}}]}),await(0,Ft.Z)(e,n)}fetchMessage=async e=>{const{listEntry:t}=e,n=W.Z.get(U.kMailPreferredRendering);if(this.setState({message:void 0,raw:void 0,renderingMethod:n,accountOfflineNoMessage:!1,netOfflineNoMessage:!1,rssNoMessage:!1},(()=>{$t.nextTick(a.Z.refreshActiveMessage)})),!t)return void de.Z.log("Mail",["detail-view","fetch-message"],"no listEntry");const{id:i,sentDate:s,sourceFilterIds:o,fromIds:r}=t;this._currentId=i;const d=await Ot.Z.call(i);if(!d)return void de.Z.log("Mail",["detail-view","fetch-message"],"no message");const c=d.id,u=()=>{const e=this._currentId!==d.id;return e&&de.Z.log("Mail",["detail-view","fetch-message"],"selection changed"),e};if(u())return;this.setState({message:d},a.Z.refreshActiveMessage);const p=W.Z.get(U.kMailAccounts),m=y.Z.getSelectedFolder(),b=v.Z.getByIds(o);function S(e){const t=[],n=[],i=[];for(const s of e)s.accountId!==m?.accountId||m?.path!==pe.ym&&s.path!==m?.path?s.accountId===m?.accountId?n.push(s):i.push(s):t.push(s);return{samePathFilters:t,sameAccountFilters:n,otherFilters:i}}const w=S(b);let C,A=await Xt(w,i,s);if(u())return;async function I(e){const t=p.filter((e=>e.accountType===pe.s9.IMAP&&!e.offline)),n=e.filter((e=>t.find((t=>t.MAIL_EMAIL===e.accountId))));for(const e of n){const{accountId:t}=e;try{if(A=await g.Z.fetchRawOfMessage(t,c),A)return C={accountId:t,type:"imap"},A}catch(e){de.Z.info(e)}}if(!A){const t={},n=p.filter((e=>e.accountType===pe.s9.POP));if(n.length>0){const i=await Dt.Z.loadAllAccounts(),s=e.filter((e=>n.find((t=>t.MAIL_EMAIL===e.accountId))));for(const e of s){const n=i.find((t=>t.MAIL_EMAIL===e.accountId));n&&(t[e.accountId]=n)}}if(Object.keys(t).length>0){const e=await Lt.call(i);for(const n of e){const{accountId:e,uidl:i}=n,s=t[e];try{return A=await bt.Z.getPopMessage(s,i,c),C={accountId:e,type:"pop",uidl:i},A}catch(e){de.Z.info(e)}}}}}this.isRssFeedMessage=b.some((e=>e.accountId===pe.u4));const T=b.filter((e=>{const n=t.sources.get(e.id);return n&&!n.internal}));if(!A){const e=await Rt.Z.getBySearchListId(i);if(u())return;if(!(e.length>0&&e.every((e=>!e.hasRaw)))){const e=864e5;A=await Xt(w,i,s+e)||await Xt(w,i,s-e),A&&de.Z.log("Mail",["detail-view","fetch-message"],"Message was found under wrong day folder")}}if(!A){if(T.length>0&&!navigator.onLine)return this.setState({netOfflineNoMessage:!0}),void de.Z.log("Mail",["detail-view","fetch-message"],"no network connection");const e=T.some((e=>p.find((t=>t.MAIL_EMAIL===e.accountId&&!t.offline))));if(T.length>0&&!e)return this.setState({accountOfflineNoMessage:!0}),void de.Z.log("Mail",["detail-view","fetch-message"],"account is offline");if(this.isRssFeedMessage)return this.setState({rssNoMessage:!0}),void de.Z.warn("Mail",["detail-view","fetch-message"],"Unexpected - rss messages without a raw");if(0===T.length)return void de.Z.log("Mail",["detail-view","fetch-message"],"no external source filter");const n=S(T);if(A=await I(n.samePathFilters)||await I(n.sameAccountFilters)||await I(n.otherFilters),u()){if(A&&C){const e=await ne(A),n=await e.parseSearchPart();await this.updateMessage(i,d,n),await Yt(e,d,C),t.preview||await this.updatePreview(i,n),f.Z.runStoredQueryFilters([i]),T.length>1&&(0,Mt.Z)({operation:"BUFFER_OPERATION_FETCH_RAW_FOR_ALL_SOURCES",searchListId:i}).then((()=>l.Z.flushBuffer()))}return}if(!A)return void de.Z.log("Mail",["detail-view","fetch-message"],"Failed to fetch message")}const Z=A;let E;if(this.isRssFeedMessage){const e=new TextDecoder("utf-8").decode(Z);E=(0,Gt.K)(e)}this.setState({isSenderTrusted:this.isRssFeedMessage||Ue.Z.get(r).every((e=>h.Z.isTrustedEmailAddress(e.address))),message:this.isRssFeedMessage?{...d,bodyParts:E}:d,raw:this.isRssFeedMessage?new ie({contentType:{value:"application/rss+xml",params:{}},contentID:void 0,disposition:void 0,transferEncoding:"7bit",bodyStart:0,bodyIsEmptyOrWhitespaceStub:!1,byteLength:Z.byteLength,byteOffset:Z.byteOffset},Z):await ne(Z)},(async()=>{a.Z.refreshActiveMessage(),T.length>1&&(0,Mt.Z)({operation:"BUFFER_OPERATION_FETCH_RAW_FOR_ALL_SOURCES",searchListId:i}).then((()=>l.Z.flushBuffer()));const e=this.state.raw;if(!e||!C){if(e){if(!t.preview){const t=await e.parseSearchPart();await this.updatePreview(i,t)}}else de.Z.log("Mail",["detail-view","fetch-message"],"no rawWrapper");return}const s=await e.parseMainPart(n);await this.updateMessage(i,d,s),await Yt(e,d,C),t.preview||await this.updatePreview(i,s),f.Z.runStoredQueryFilters([i])}))};toggleRenderingMethod=e=>{this.setState((t=>({renderingMethod:t.renderingMethod===e?W.Z.get(U.kMailPreferredRendering):e})))};onUnblockExternalContent=e=>{const t=this.state.message;var n;if(t)if(e){const e=t.from;e[0]&&(p.Z.putTrustedEmailAddress(e[0]),this.setState({isSenderTrusted:!0}))}else n=t.id,xt.Z.messages.update(n,{trusted:!0}),this.setState((e=>e.message?{message:{...e.message,trusted:!0}}:null))};shouldWarnUser=()=>{if(this.isRssFeedMessage)return!1;const e=this.state.message;if(e&&e.replyTo[0]&&e.from[0]){const t=e.from[0].address.split("@").pop(),n=e.replyTo[0].address.split("@").pop(),i=[/(^|\.)gmail\./,/(^|\.)yahoo\./,/(^|\.)hotmail\./,/(^|\.)aol.com/,/(^|\.)msn\./,/(^|\.)live\./,/(^|\.)office365\./,/(^|\.)outlook\./,/(^|\.)dmx.de/,/(^|\.)free.fr/,/(^|\.)icloud\./];if(e.replyTo.length>1||t!==n||i.some((e=>t.match(e)))&&e.from[0].address!==e.replyTo[0].address)return!0}return!1};shouldWarnUserFromName=()=>{const e=this.state.message;return!!e&&e.from.some((({name:e,address:t})=>e&&e!==t&&(0,L.v9)(e)&&!h.Z.hasContact(e,t)))};render(){let e=[],t="";const{listEntry:n,hasNoListEntries:i}=this.props;if(n){const{fromIds:i}=n;e=Ue.Z.get(i),t=e.length>0?e[0].address:""}const s=!this.state.accountOfflineNoMessage&&!this.state.netOfflineNoMessage&&!this.state.rssNoMessage;return Kt("div",{id:"mail_detail"},void 0,n&&(0,V.jsx)(st,{ref:this.messageHeader,message:this.state.message,listEntry:n,renderingMethod:this.state.renderingMethod,from:e,fromAddress:t},this.state.message?.id||""),s&&(0,V.jsx)("div",{...!this.props.listEntry&&{style:{display:"none"}},className:"message-body-part",children:(0,V.jsx)(vt,{ref:this.messageBody,windowId:this.context.vivaldiWindowId,isRss:this.isRssFeedMessage,style:this.state.style,message:this.state.message,listEntry:n,messageHeader:this.messageHeader,raw:this.state.raw,renderingMethod:this.state.renderingMethod,isSenderTrusted:this.state.isSenderTrusted,fromAddress:t,shouldWarnUserFrom:e.length>1,shouldWarnUserFromName:this.shouldWarnUserFromName(),shouldWarnUserReplyTo:this.shouldWarnUser(),onUnblockExternalContent:this.onUnblockExternalContent})}),s&&!n&&!i&&Kt("section",{className:"no-message-selected"},void 0,Kt("div",{dangerouslySetInnerHTML:{__html:C.Fii}}),Kt("div",{},void 0,(0,N.Z)("No message selected"))),this.state.netOfflineNoMessage&&Kt("section",{className:"no-message-selected"},void 0,Kt("div",{dangerouslySetInnerHTML:{__html:C.Fii}}),Kt("div",{},void 0,(0,N.Z)("No network connection. Unable to fetch message"))),this.state.accountOfflineNoMessage&&Kt("section",{className:"no-message-selected"},void 0,Kt("div",{dangerouslySetInnerHTML:{__html:C.Fii}}),Kt("div",{},void 0,(0,N.Z)("Account is offline. Unable to fetch message"))),this.state.rssNoMessage&&Kt("section",{className:"no-message-selected"},void 0,Kt("div",{dangerouslySetInnerHTML:{__html:C.Fii}}),Kt("div",{},void 0,(0,N.Z)("Missing feed message"))),"hide"!==this.state.showQuickReply&&n&&!this.isRssFeedMessage&&Kt(_t,{pageId:this.props.pageId,message:this.state.message,refBody:this.messageBody}))}}const qt=Qt},95032:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u});var i,s=n(67294),o=n(26395),a=n(49168),r=n(81744),l=n(48521);function d(e,t,n,s){i||(i="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=s;else if(a>1){for(var r=new Array(a),l=0;l<a;l++)r[l]=arguments[l+3];t.children=r}if(t&&o)for(var d in o)void 0===t[d]&&(t[d]=o[d]);else t||(t=o||{});return{$$typeof:i,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class c extends s.Component{mailLabelRef=s.createRef();_isMounted=!1;state={breakpoint:!1,componentMaxWidth:32,shouldDetachObserver:!1,numberOfVisibleLabelsAllowed:0,numberOfCheckedLabels:(0,a.Q3)(this.props.flags).length};componentDidMount(){this._isMounted=!0,this.state.numberOfCheckedLabels>0&&(this.setComponentMaxWidth(this.getComponentMaxWidth()),this.observerHandler())}componentWillUnmount(){this._isMounted=!1}componentDidUpdate(e,t){const n=this.mailLabelRef.current&&this.mailLabelRef.current.clientWidth;this.props.flags!==e.flags&&(this.setComponentMaxWidth(this.getComponentMaxWidth()),this.setNumberOfCheckedLabels((0,a.Q3)(this.props.flags).length),this.observerHandler(),n&&(n>this.state.componentMaxWidth&&this.setBreakpoint(!1),n<this.state.componentMaxWidth&&this.setBreakpoint(!0)))}observerHandler=()=>{0===this.state.numberOfCheckedLabels?this.setState({shouldDetachObserver:!0}):this.setState({shouldDetachObserver:!1})};observeTargetHandler=e=>{if(!this._isMounted)return;const t=e[0].target;this.setNumberOfVisibleLabelsAllowed(t.clientWidth),t.clientWidth>this.state.componentMaxWidth&&this.setBreakpoint(!1),t.clientWidth<this.state.componentMaxWidth&&this.setBreakpoint(!0)};setNumberOfVisibleLabelsAllowed=e=>{const t=e/(32+(3+3*(e/32)));this.setState({numberOfVisibleLabelsAllowed:t})};setNumberOfCheckedLabels=e=>{this.setState({numberOfCheckedLabels:e})};setBreakpoint=e=>{this.setState({breakpoint:e})};setComponentMaxWidth=e=>{this.setState({componentMaxWidth:e})};getComponentMaxWidth=()=>{const e=(0,a.Q3)(this.props.flags);return(32+3*this.state.numberOfVisibleLabelsAllowed)*e.length};render(){if(0===this.state.numberOfCheckedLabels)return null;let e,t=[];this.state.breakpoint?(t=(0,a.Q3)(this.props.flags).slice(this.state.numberOfVisibleLabelsAllowed).map((e=>(0,r.X)(e))),e=(0,a.Q3)(this.props.flags).slice(0,this.state.numberOfVisibleLabelsAllowed).map((e=>[(0,r.X)(e),(0,r.X)(e,!1)]))):e=(0,a.Q3)(this.props.flags).map((e=>[(0,r.X)(e),(0,r.X)(e,!1)]));const n=t.join("\n");return(0,l.jsx)("div",{className:this.props.className,ref:this.mailLabelRef,children:d(o.Z,{className:"MailLabels-Observer",onResize:this.observeTargetHandler,attached:this.state.shouldDetachObserver},void 0,d("ul",{className:"MailLabels-Container"},void 0,e.map((([e,t])=>d("li",{title:e,"data-label":t,className:"MailLabels-Label"},t,e))),t.length>0&&d("li",{title:n,className:"MailLabels-Label MailLabels-Tooltip"},void 0,`+${t.length}`)))})}}const u=c},36943:(e,t,n)=>{"use strict";n.d(t,{Z:()=>P});var i=n(2711),s=n(3184),o=n(99827),a=n(98611),r=n(46382),l=n(29087),d=n(15489),c=n(56371),u=n(78347),p=n(48868),h=n(51501),g=n(45709),m=n(10671),f=n(95752),v=n(45660),y=n(68906),b=n(6977),S=n(35458),w=n(5204),C=n(5863),A=n(13248),I=n(89175),T=n(8684);class Z{updatedSources=new Map;imapAddCustomFlags=new Map;imapDelete=[];imapCopy=[];addSourceUpdate(e,t,n){const i=this.updatedSources.get(t);i?i.set(e,n):this.updatedSources.set(t,new Map([[e,n]]))}addSource(e,t,n=!0){const{id:i,accountId:s,path:o}=e,a={read:n,deleted:!1,internal:!m.Z.isOnline(s,o)};this.addSourceUpdate(i,t,a)}removeSource(e,t){this.addSourceUpdate(e,t,void 0)}deleteSource(e,t){const{id:n,accountId:i,path:s}=e,o=m.Z.isOnline(i,s)?{read:true,deleted:true,internal:!0}:{read:true,deleted:true};this.addSourceUpdate(n,t,o)}undeleteSource(e,t){const{id:n,accountId:i,path:s}=e,o=m.Z.isOnline(i,s)?{deleted:false,internal:!1}:{deleted:false};this.addSourceUpdate(n,t,o)}addImapDelete(e,t,n){this.imapDelete.push({accountId:e,path:t,searchListId:n})}addImapCopy(e,t,n){const i=t.find((t=>{const n=e.sources.get(t);return n&&!n.internal}));if(i){const t=a.Z.get(i);if(!t)throw new Error("Filter not found "+i);const{accountId:s,path:o}=t;this.imapCopy.push({accountId:s,path:o,destinationPath:n,searchListId:e.id});const r=e.sources.get(i);r&&!r.read&&this.imapAddCustomFlags.set(e.id,new Map([[i,{read:!0}]]))}}}function E(e){const t=new Map;return[...e.keys()].forEach((e=>{const n=a.Z.get(e);if(!n)throw new Error("Filter not found "+e);const{accountId:i}=n,s=t.get(i);s?s.push(e):t.set(i,[e])})),t}async function k(e,t){const{updatedSources:n,imapAddCustomFlags:s,imapCopy:a,imapDelete:r}=e,l=new Set;if(n.size>0&&(l.add(p.Z.searchList),l.add(p.Z.filteringQueue),l.add(p.Z.filters),l.add(p.Z.hasRaw)),(r.length>0||a.length>0||s.size>0)&&(l.add(p.Z.imap),l.add(p.Z.buffer)),l.size>0){let e=[];await p.Z.transaction("rw",[...l],(async()=>{if(n.size>0){e=await S.Z.call(n);const i=[];n.forEach(((e,t)=>{const n=[...e.keys()],s=i.find((({filterIds:e})=>e.length===n.length&&e.every((e=>n.includes(e)))));s?s.searchListIds.push(t):i.push({filterIds:n,searchListIds:[t]})}));for(const{filterIds:e,searchListIds:n}of i)y.Z.call({type:"RE_RUN_SLES",priority:C.Un.HIGH,searchListIds:n,filterIds:e,folderIds:[[C.of,t]]})}s.size>0&&await b.Z.addSourceFlags(s),a.length>0&&await b.Z.addCopy(a),r.length>0&&await b.Z.addDelete(r)})),w.Z.filter(),i.Z.flushBuffer(),e.length>0&&o.Z.updateIndex({sleUpdates:e})}}async function _(e,t,n){const i=new Z;for(const p of e){const{id:e,sources:g}=p,m=E(g);for(const g of m){const m=g[0],f=g[1];if(!(0,A.ZA)(m)){v.Z.warn("Mail",`Can not move message to ${n} on ${m} as it is not an IMAP account`);continue}let y=u.Z.getSubscribedFoldersOfType(m,t);if((!y||0===y.length)&&t===C.hn){if(l.Z.get(I.kMailAddArchiveFolder)||await new Promise((e=>{r.Z.showCreateArchiveFolderConfirmation(d.ZP.getMailWindowId(),(t=>e(t)),(0,c.Z)("Create missing archive folder?"),(0,c.Z)("No archive folder was detected for $1. In order to archive mail an archive folder must be present. Should a new archive folder be created?",[m]))}))){if(!navigator.onLine){(0,T.c)({title:(0,c.Z)("Can not create Archive folder without a network connection"),timeout:3e4,tag:"VIVALDI_MAIL_CREATE_ARCHIVE_FOLDER"}),v.Z.log("Mail",`Can not create Archive folder without a network connection - ${m}`);continue}(0,T.c)({title:(0,c.Z)(`Creating Archive folder for ${m}`),timeout:3e4,tag:"VIVALDI_MAIL_CREATE_ARCHIVE_FOLDER"});const e=u.Z.getFoldersOfType(m,C.e9);if(0===e.length)throw new Error(`No inbox folder found on imap account ${m}`);const t=e[0];await s.Z.createMailbox(m,C.ym,C.$T),y=[{path:C.$T,name:C.$T,type:C.hn,subscribed:!0,delimiter:t.delimiter}];const n=h.ZP.getDefaultFilterForPath(m,C.$T,C.hn);await o.Z.addFilter(n,!1)}else v.Z.warn("Mail",["Move to Archive"],"No archive folder and hence nothing moved")}if(y&&y.length>0){y.length>1&&y.sort(((e,t)=>e.path.split(e.delimiter).length-t.path.split(t.delimiter).length));const t=y[0],{path:n}=t,s=a.Z.getByFolder(m,n);if(!s)throw new Error("Filter not found "+m+" "+n);const{id:o}=s,r=p.sources.get(o);r?r.internal&&i.addImapCopy(p,f,n):(i.addSource(s,e),i.addImapCopy(p,f,n)),f.forEach((t=>{if(o===t)return;const n=p.sources.get(t);if(!n)throw new Error("Source not found "+t+" on listEntry "+p.id);if(n.read||i.addSourceUpdate(t,p.id,{read:!0}),!n.internal){const n=a.Z.get(t);if(!n)throw new Error("Filter not found "+t);i.addImapDelete(m,n.path,e),i.deleteSource(n,e)}}))}}}await k(i,n)}async function N(e,t,n){const i=new Z;e.forEach((e=>{const{id:n,sources:s}=e;E(s).forEach(((o,r)=>{const l=a.Z.getByIds(o),d=l.some((({accountId:e,path:t})=>m.Z.getFolderType(e,t)===C.uT));if(d)l.forEach((({id:e,accountId:s,path:o})=>{m.Z.getFolderType(s,o)===t&&(i.removeSource(e,n),i.addImapDelete(s,o,n))}));else{let d=!1;if(l.forEach((a=>{const{id:r,accountId:l,path:c}=a;if(m.Z.getFolderType(l,c)===t)i.removeSource(r,n),i.addImapDelete(l,c,n);else{d=!0;const t=s.get(r);if(!t)throw new Error("Source not found");t.deleted&&(i.undeleteSource(a,n),i.addImapCopy(e,o,c))}})),!d){const t=u.Z.getFoldersOfType(r,C.e9);if(0===t.length)throw new Error("No inbox found on account "+r);const l=t[0].path,d=a.Z.getByFolder(r,l);if(!d)throw new Error("Inbox filter not found "+r+" "+l);const c=f.Z.call(s);i.addSource(d,n,c),i.addImapCopy(e,o,l)}}}))})),await k(i,n)}const P={moveToJunk:async function(e){g.Z.setJunk(e,!0),await _(e,C.Hd,C.rp)},restoreFromJunk:async function(e){g.Z.setJunk(e,!1),await N(e,C.Hd,C.rp)},moveToArchive:async function(e){await _(e,C.hn,C.$T)},restoreFromArchive:async function(e){await N(e,C.hn,C.$T)}}},75995:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o,o:()=>s});var i=n(95752);function s(e){delete e.isParent,delete e.parentId,delete e.isChild,delete e.children,delete e.unreadInThread}const o={getThreadsAsTree:function(e,t=!0){if(0===e.length)return[];let n;t||e.reverse();let o=[];const a=[e[0]];s(e[0]);for(let t=1;t<e.length;t++){const r=e[t-1],l=e[t];if(s(l),l.threadKey[0]===r.threadKey[0]&&l.threadKey[1]===r.threadKey[1]){if((!n||l.threadKey.length>r.threadKey.length)&&(n?o.push(n):o.push(r),n=r,r.isParent=!0),o.length>0&&l.threadKey.length<r.threadKey.length){const e=l.threadKey.length-1;o=o.slice(0,e),n=o[o.length-1]}l.parentId=n.id,l.isChild=!0,n.children=n.children||[],n.children.push(l),i.Z.call(l.sources)||n.unreadInThread||(n.unreadInThread=!0,o.forEach((e=>e.unreadInThread=!0)))}else a.push(l),n=void 0,o=[]}return t?a:a.reverse()}}},91834:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const i={updateCounterFolders:function(e,t,n,i){i.forEach((({viewIntersections:i,counter:s})=>{let o=!1,a=!1,r=!1;for(const n of t){if(!o){i.total.get(n)?.every((t=>e.has(t)))&&(o=!0)}if(!a){i.unseen.get(n)?.every((t=>e.has(t)))&&(a=!0)}if(!r){i.unread.get(n)?.every((t=>e.has(t)))&&(r=!0)}}o&&(s.total+=n),a&&(s.unseen+=n),r&&(s.unread+=n)}))}}},77312:(e,t,n)=>{"use strict";n.d(t,{MT:()=>a,TP:()=>r,fN:()=>l});var i=n(45660),s=n(9112),o=n(7064);async function a(e){const t=["attached-pending"];try{await o.Z.mailPrivate.deleteMessageFile(t,e)}catch(t){i.Z.warn("Mail",["attachment"],`Failed to delete pending attachment file ${e} - error: ${t}`)}}async function r(e){const t=[],n=await(0,s.Z)(e);for(const e of n)if(e.bodyParts)for(const n of e.bodyParts)"attachment"===n.type&&"string"==typeof n.content&&t.push(n.content);return t}async function l(e){const t=await r([e]);for(const e of t)await a(e)}},45709:(e,t,n)=>{"use strict";n.d(t,{Z:()=>g,a:()=>h});var i=n(2711),s=n(71320),o=n(10671),a=n(45660),r=(n(20244),n(48868));const l={call:async function(e){0!==e.searchListIds.length?await r.Z.flaggingQueue.add(e):a.Z.debug("Not queueing flag update request with no searchListIds",e)}};var d=n(5863),c=n(49168);function u(e,t,n,i){return p(e,{[t]:n},void 0,i)}function p(e,t,n=new Map,s){const o=e.map((e=>e.id)),r=new Map,d=[];e.forEach((e=>{const i={},s=(0,c.hY)(e.flags,t);e.flags=i.flags=s;const o=n.get(e.id);if(o&&o.size>0){const t=new Map,n=new Map;o.forEach(((s,o)=>{t.set(o,s),!0===s.read&&(e.unseen=i.unseen=!1);const a=e.sources.get(o);if(a){const e={};for(const t of Object.keys(s))s[t]!==a[t]&&(e[t]=a[t]);Object.keys(e).length>0&&n.set(o,e)}})),i.sources=t,r.set(e.id,n)}const{id:a}=e;d.push({id:a,updates:i})}));const u={searchListIds:o,sourcesPerSle:n,flagUpdates:t};if(a.Z.log("Mail",["add to flagging queue"],u),l.call(u),i.Z.updateFlags(),s){const e={};for(const n of Object.keys(t))e[n]=!t[n];const n={operation:"setFlags",searchListIds:new Set(o),updates:e,sourcesPerSle:r};return{sleUpdates:d,undoItem:n}}return{sleUpdates:d}}function h(){return[d.T4.RED,d.T4.ORANGE,d.T4.YELLOW,d.T4.GREEN,d.T4.BLUE,d.T4.PURPLE,d.T4.GRAY,d.T4.CLEAR_FLAGS]}const g={setRead:function(e,t,n=!0){const i=[],a=new Map;return e.forEach((e=>{const{id:n,sources:r}=e,l=new Map;r.forEach(((e,n)=>{const i=s.Z.get(n);if(!i)throw new Error(`filter for sourceFilterId ${n} not found!`);const a=o.Z.getFolderType(i.accountId,i.path)===d.Nz&&!t;e.read===t||a||l.set(n,{read:t})})),l.size>0&&(i.push(e),a.set(n,l))})),i.length>0?p(i,{},a,n):{sleUpdates:[]}},setFlagged:function(e,t){return u(e,d.T4.FLAGGED,t,!1)},setForwarded:function(e,t){return u(e,d.T4.FORWARDED,t,!1)},setReplied:function(e,t){return u(e,d.T4.ANSWERED,t,!1)},setCustomFlags:function(e,t,n=new Map,i=!1){return p(e,t,n,i)},getStandardFlagList:h,setJunk:function(e,t){let n={[d.T4.JUNK]:t,[d.T4.NOT_JUNK]:!t};return t&&(n={...n,NonJunk:!1,NotJunk:!1}),p(e,n,void 0,!1)}}},56887:(e,t,n)=>{"use strict";n.d(t,{O:()=>c,U:()=>d});var i=n(68247),s=n(29087),o=n(10671),a=n(5863),r=n(89175);function l(e){let t=s.Z.get(r.kMailSearchSortField);if(!e)return t;const{accountId:n,path:i}=e;return o.Z.getFolderType(n,i)===a.Nz&&(t=s.Z.get(r.kMailSearchSortFieldSent)),t}function d(e){const t=l(e);if(!e)return t;const n=s.Z.get(r.kMailSearchSortFieldPerFolder),{accountId:i,path:o}=e;if(n[i]&&n[i][o]){const s=n[i][o];return s===t&&c(e,s),s}return t}function c(e,t){const n=s.Z.get(r.kMailSearchSortFieldPerFolder),o={...n},{accountId:a,path:d}=e;n[a]?(o[a]={...n[a]},o[a][d]=t):o[a]={[d]:t},o[a][d]===l(e)&&delete o[a][d],0===Object.keys(o[a]).length&&delete o[a],i.Z.set(r.kMailSearchSortFieldPerFolder,o)}},55603:(e,t,n)=>{"use strict";n.d(t,{F7:()=>h,ME:()=>p,Ro:()=>g});var i=n(98611),s=n(54162),o=n(68131),a=n(45660),r=n(35489),l=n(24522),d=n(5863),c=n(76085),u=n(72494);async function p(e){const t=await m(e);if(t&&"string"!=typeof t){const{feeditems:e}=t,{links:n}=e[0],i=n.alternate.filter((e=>!e.url.match(/^\s*data:/i)));return(0,o.Z)(navigator.languages,i)?.url}}async function h(e){const t=await m(e);if(t&&"string"!=typeof t){const{feeditems:e}=t,{bodyimages:n}=e[0];return n}return[]}function g(e){const{sourceFilterIds:t}=e;return i.Z.getByIds(t).some((e=>e.accountId===d.u4))}async function m(e){const{id:t,sentDate:n,sourceFilterIds:o}=e,p=i.Z.getByIds(o);if(!g(e))return;const h=function(e){const t=s.Z.getSelectedFolder(),n=[],i=[],o=[];for(const s of e)s.accountId!==t?.accountId||t?.path!==d.ym&&s.path!==t?.path?s.accountId===t?.accountId?i.push(s):o.push(s):n.push(s);return{samePathFilters:n,sameAccountFilters:i,otherFilters:o}}(p);let m=await(0,u.K)(h,t,n);if(!m){const e=await r.Z.getBySearchListId(t);e.length>0&&e.every((e=>!e.hasRaw))||(m=await(0,u.K)(h,t,n+l.hd)||await(0,u.K)(h,t,n-l.hd),m&&a.Z.log("Mail",["getBestLinkFromFeed"],"Message was found under wrong day folder"))}if(!m)return void a.Z.warn("Mail",["getBestLinkFromFeed"],"Unexpected - rss messages without a raw");const f=m,v=new TextDecoder("utf-8").decode(f);return(0,c.ho)(v)}},32593:(e,t,n)=>{"use strict";n.d(t,{C7:()=>T,Gb:()=>E,KJ:()=>I,NQ:()=>Z,m6:()=>k,oN:()=>A,tP:()=>_});var i=n(39045),s=n(2711),o=n(82227),a=n(99827),r=n(29087),l=n(78347),d=n(60308),c=n(9982),u=n(92292),p=n(71320),h=n(51501),g=n(10671),m=n(45660),f=n(24651),v=n(5204),y=n(7064),b=n(99895),S=n(5863),w=n(83065),C=n(89175);async function A(e,t){const n=g.Z.getFolders();if(!("inbox"===t.toLowerCase()&&n[e]&&Object.keys(n[e]).some((e=>"inbox"===e.toLowerCase()))||n[e]&&n[e][t])){const n=T(t),s=l.Z.getAccounts(),o=s[e]?s[e].folders:{},a="/",r=t.split(a),d={name:(0,w.kF)(r[r.length-1]),path:t,delimiter:a,type:n};o[n]=o[n]||[],o[n].push(d),await i.Z.addFolders(e,o),v.Z.addFolders(e,o)}}async function I(e,t){if(!p.Z.getByFolderId([e,t])&&!await o.Z.get(e,t)){const n=T(t),i=h.ZP.getDefaultFilterForPath(e,t,n);await a.Z.addFilter(i,!1)}}function T(e){let t=S.Oi,n=e.toLowerCase();switch(n.startsWith("[gmail]/")&&(n=n.split("/")[1]),n){case"archive":t=S.hn;break;case"drafts":t=S.kY;break;case"inbox":t=S.e9;break;case"junk":case"spam":t=S.Hd;break;case"sent":case"sent mail":t=S.Nz;break;case"trash":t=S.uT}return t}function Z(e,...t){return""!==e&&"/"!==e[e.length-1]&&(e+="/"),e+t.join("/")}async function E(){return new Promise((e=>{l.Z.addListener((function t(){l.Z.removeListener(t),e()}))}))}async function k(e,t,n){r.Z.get(C.kMailAutoGenerateContacts)&&await(0,c.Z)(e,t,n);const{indexUpdates:i,slesToDisk:o}=await d.Z.call(e,t,T(t),n);a.Z.updateIndex(i);const l=[];for(const t of o){const i=n.find((e=>e.messageId===t.messageId&&(!e.sentDate&&!t.sentDate||e.sentDate===t.sentDate)&&e.subject===t.subject));if(!i)throw new Error(`Added sle not found in incoming batch, ${t.messageId}, ${t.sentDate}, ${t.subject}`);l.push(t.id),await b.Z.call(e,t.sentDate,t.id,i.raw)}l.length>0&&await f.Z.setHasRaws(e,l),v.Z.filter(),s.Z.updateThreads()}async function _(){return new Promise(((e,t)=>{try{y.Z.importData.readMessageFromThunderbirdMailbox(((t,n)=>u.Z.runtime.lastError?(m.Z.error("Mail",["import","thunderbird"],"Error reading message",u.Z.runtime.lastError),e()):t?e({message:t,seekPosition:Number(n)}):e()))}catch(t){return m.Z.error("Mail",["import","thunderbird"],"Error reading message",u.Z.runtime.lastError),e()}}))}},19842:(e,t,n)=>{"use strict";n.d(t,{Ds:()=>r,Rr:()=>l,Wm:()=>d,vE:()=>a});var i=n(39005),s=n(96951),o=n(44850);function a(e){return!!o.jk.matchUrl(o.jk.internalUrl("mailpage","composer"),e)}function r(e){return!!o.jk.matchUrl(o.jk.internalUrl("mailpage","message"),e)}function l(e){const t=s.ZP.getActivePage(e);return!!t&&r(t.url)}function d(e){return Boolean(s.ZP.getActivePage(e)?.isMailPage)&&Boolean(i.Z.getActiveMessage())}},88951:(e,t,n)=>{"use strict";function i(e){const t=e?e.substring(e.indexOf("@")+1):"vivaldi.com",n=new Uint32Array(2);return crypto.getRandomValues(n),Date.now()+"."+n.join(".")+"@"+t}n.d(t,{Z:()=>i})},59552:(e,t,n)=>{"use strict";n.d(t,{Z:()=>T});var i=n(43630),s=n(2711),o=n(3184),a=n(99827),r=n(46382),l=n(56371),d=n(48868),c=n(83204),u=n(71320),p=n(10671),h=n(45660),g=n(68906),m=n(6977),f=n(35489),v=n(24651),y=n(35458),b=n(5204),S=n(83507),w=n(99895),C=n(5863),A=n(13248);async function I(e,t){return(await f.Z.getBySearchListId(t)).sort(((t,n)=>t.accountId===e&&t.hasRaw?-1:n.hasRaw-t.hasRaw))}const T=async function(e,t,n,f,T){const{accountId:Z,path:E}=n.find((e=>e.accountId===f))||n.slice(-1)[0];h.Z.log("Mail",["move"],`${Z}/${E}->${f}${T}`);const k=Z===f;let _=Z;for(const n of t){const{id:t}=n,i=await I(Z,t);if(i[0].hasRaw)continue;let s=!1;for(const e of i)if((0,A.mq)(e.accountId)){h.Z.log("Mail",["move"],`Need to fetch source on ${e.accountId}`);if(await o.Z.fetchRawOfMessage(e.accountId,e.searchListId)){await v.Z.setHasRaw(e.accountId,e.searchListId),s=!0,k||(_=e.accountId);break}}if(!s){const t=(0,l.Z)("Aborting the move action because of failure to locate or fetch body for message with subject: $1",[n.subject]);return h.Z.warn("Mail",["move"],t),void r.Z.showModalInfo(e,{title:(0,l.Z)("No messages moved between accounts"),body:t})}}const N=u.Z.getByFolderIds(n.map((e=>[e.accountId,e.path]))),P=u.Z.getByFolderId([f,T]);if(!P)throw new Error(`Could not move messages.\n      No filter found for ${Z}/${E}\n      or ${f}/${T}\n      when trying to move ${t.length} messages`);const D=new Map;t.forEach((e=>{const t=N.filter((t=>e.sources.has(t.id))),n=(i=t).find((e=>e.accountId===f))||i.slice(-1)[0];var i;if(!n)throw new Error(`Can not move message to ${f}/${T}\n        No origin filter found for entry:\n        ${e.subject}\n        with origin filters: ${t.map((e=>`${e.accountId}/${e.path}`)).join(", ")}`);const s=e.sources.get(n.id);if(!s)throw new Error(`Can not move message from ${Z}/${E}\n        No source found for entry:\n        ${e.subject}\n        in filter: ${n.name}`);const o={...s};n.accountId===f||(0,A.mq)(f)||s.internal||(o.internal=!0);const a=new Map;N.forEach((e=>{a.set(e.id,void 0)})),a.set(P.id,o),D.set(e.id,a)}));let M=[];const O=[],x=[],L=[];t.forEach((e=>{if((0,A.mq)(f)){let t=!1;if([...e.sources].some((([n,i])=>{const s=u.Z.get(n);s&&!i.internal&&N.some((e=>e.id===s?.id))&&(s.accountId===f?(t=!0,O.push({accountId:s.accountId,path:s.path,destinationPath:T,searchListId:e.id})):L.push({accountId:s.accountId,path:s.path,searchListId:e.id}))})),!t){const t=[...e.flags].filter((e=>e!==C.T4.DELETED&&e!==C.T4.JUNK));N.some((t=>e.sources.get(t.id)?.read))&&(t.includes(C.T4.SEEN)||t.push(C.T4.SEEN)),x.push({accountId:f,path:T,searchListId:e.id,flags:t})}}}));const R=[d.Z.searchList,d.Z.filteringQueue,d.Z.filters,d.Z.hasRaw];if(O.length>0||L.length>0?R.push(d.Z.buffer,d.Z.imap,d.Z.flaggingQueue):x.length>0&&R.push(d.Z.buffer,d.Z.flaggingQueue),await d.Z.transaction("rw",R,(async()=>{if(O.length>0&&(h.Z.log("Mail",["move"],"Issuing a server side move action"),await i.Z.clearJunkFlags(e,t),await i.Z.clearDeletedFlags(e,t),await m.Z.addMove(O)),x.length>0&&(h.Z.log("Mail",["move"],"Issuing an upload to destination server",f),await m.Z.addUpload(x)),L.length>0)for(const e of N)e.accountId!==f&&(h.Z.log("Mail",["move"],"Issuing a deletion from source server",Z),await m.Z.addDelete(L));h.Z.log("Mail",["move"],"Update source data"),M=await y.Z.call(D);const n=u.Z.getByFolderIds([...N.map((e=>[C.Ry,`${e.accountId}/${e.path}`])),[C.Ry,`${f}/${T}`]]).map((e=>e.id)),s=[...N.map((e=>[e.accountId,e.path])),[f,T]],o=t.map((e=>e.id));1===N.length&&p.Z.getFolderType(Z,E)===p.Z.getFolderType(f,T)?(h.Z.log("Mail",["move"],"Requesting filtering (FILTERS_SLES)"),await g.Z.call({type:"FILTERS_SLES",priority:C.Un.HIGH,folderIds:s,filterIds:n,searchListIds:o})):(h.Z.log("Mail",["move"],"Requesting filtering (RE_RUN_SLES)"),await g.Z.call({type:"RE_RUN_SLES",priority:C.Un.HIGH,folderIds:s,filterIds:n,searchListIds:o}))})),k){h.Z.log("Mail",["move"],"Set hasRaw to true for all in-account source updates");for(const e of t)v.Z.setHasRaw(Z,e.id)}else{h.Z.log("Mail",["move"],"Writing raw files to destination account");for(const e of t){const t=await S.Z.call(_,e.id,e.sentDate);t?(await w.Z.call(f,e.sentDate,e.id,t),await v.Z.setHasRaw(f,e.id)):h.Z.error("Mail",["move"],`Failed to write raw for message ${e.id} to destination account ${f}`)}h.Z.log("Mail",["move"],"Deleting raw files from source account");for(const e of t)await c.Z.call(Z,e.id,e.sentDate)}s.Z.flushBuffer(),b.Z.filter(),M.length>0&&a.Z.updateIndex({sleUpdates:M})}},307:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var i=n(59322),s=n(44850);function o(e,t,n){var o="message/"+t.id,a=t.subject,r=s.jk.internalUrl("mailpage",o,a);n?i.ZP.openURL(e,r,n):i.ZP.openURL(e,r)}},70611:(e,t,n)=>{"use strict";n.d(t,{yy:()=>r,iT:()=>o});n(20244);var i=n(56371);var s=n(97781);async function o(e){let t;if(function(e){const t=(new DOMParser).parseFromString(e,"text/html");return Boolean(t.body&&Array.from(t.body.getElementsByTagName("*")).every((e=>e instanceof HTMLDivElement||e instanceof HTMLSpanElement||e instanceof HTMLBRElement)))}(e)){const n=document.createElement("iframe");n.setAttribute("style","position:fixed; z-index:-1"),document.body&&document.body.appendChild(n);const i=n.contentDocument.body;i?(i.innerHTML=e,t=await function(e){let t="";const n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT);let i,s=n.nextNode();for(;s;)"BR"===s.nodeName?("DIV"!==s.parentNode?.nodeName||s.parentNode?.firstChild!==s&&s.parentNode?.lastChild!==s)&&(t+="\n"):s.nodeType===Node.TEXT_NODE?("DIV"!==i?.parentNode?.nodeName||s.parentNode===i||"BR"===i?.nodeName&&i.parentNode===s.parentNode||(t+="\n"),t+=s.nodeValue):"DIV"===s.nodeName&&i&&(t+="\n"),i=s,s=n.nextNode();return t}(i)):console.warn("Could not get plain text because iframe could not be made"),n.remove()}return t?a(t):void 0}function a(e){return e.replace(/\u00A0/g," ")}function r(e){const t=document.createElement("iframe");t.setAttribute("style","position:fixed; z-index:-1"),document.body&&document.body.appendChild(t);const n=t.contentDocument.body;let o="";if(n){const{sanitized:t}=(0,s.Nw)(e,{blockHTTPLeaks:!0});n.innerHTML=t,n.innerText&&(n.querySelectorAll("a").forEach((e=>{""===e.href.trim()||((e.parentElement||e).innerText||"").includes(e.href)||e.after(document.createTextNode(` <${e.href}> `))})),n.querySelectorAll("img").forEach((e=>{e.height&&e.height<=1&&e.width&&e.width<=1||(e.hasAttribute("alt")?""!==e.alt&&e.alt.trim().length>=1&&!(n.innerText||"").includes(e.alt)&&e.after(document.createTextNode(` [${e.alt.trim()}] `)):e.after(document.createTextNode(" ["+(0,i.Z)("Unlabeled Image")+"]")))}))),o=n.innerText||""}else console.warn("Could not get innerText because iframe could not be made");return t.remove(),a(o.trim())}},10124:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var i=n(7064);async function s(e){const t=["attached-pending"];try{const n=await i.Z.mailPrivate.readMessageFileToBuffer(t,e);return new Uint8Array(n)}catch(t){throw new Error(`Failed to read attachment buffer (${e}) from disk: ${t}`)}}},67103:(e,t,n)=>{"use strict";n.d(t,{Z:()=>C});var i=n(2711),s=n(99827),o=n(98611),a=n(78347),r=n(71320),l=n(45709),d=n(10671),c=n(97823),u=n(48868),p=n(42228);const h=async function(e){const t=await(0,p.Z)(e),n=[];return await u.Z.searchList.where("id").anyOf([...e.keys()]).modify((i=>{const{id:s,sourceFilterIds:o,sources:a}=i,r=e.get(s),l={sourceFilterIds:[],sources:new Map};r&&r.forEach(((e,i)=>{if(!t.has(i))throw new Error("Can not add a source for a non-existing filter ID "+i);o.includes(i)||(o.push(i),l.sourceFilterIds.push(i)),a.has(i)||(a.set(i,{...e}),l.sources.set(i,{...e})),(l.sourceFilterIds.length>0||l.sources.size>0)&&n.push({id:s,updates:l})}))})),n};var g=n(68906),m=n(6977),f=n(35489),v=n(57488),y=n(93789),b=n(5204),S=n(5863),w=n(51501);const C=async function(e,t){const n=[],u=[],p=[],C=[],A=[],I=new Map,T=[];for(const t of e){const{sources:e}=t;e.forEach(((e,i)=>{const{accountId:s,path:a}=o.Z.get(i),r=d.Z.getFolderType(s,a);s===S.u4?A.push({sourceFilterId:i,listEntry:t}):r===S.uT?e.internal?n.push({sourceFilterId:i,listEntry:t}):u.push({sourceFilterId:i,listEntry:t}):e.internal?p.push({sourceFilterId:i,listEntry:t}):e.deleted&&C.push({sourceFilterId:i,listEntry:t})}))}const Z=new Map;if(p.length>0){const e=await c.Z.loadAllAccounts(),n=[],i=[],s=new Map;for(const o of p){const{sourceFilterId:a,listEntry:l}=o,{id:c,unseen:u,flags:p,sources:h}=l,g=r.Z.get(a),{accountId:m,path:v}=g,y=e.find((e=>e.MAIL_EMAIL===m));if(!y){console.warn("Account not found for accountId "+m);continue}if(y.accountType===S.s9.IMAP){let e=!1;for(const[n,o]of h){if(o.internal||n===a)continue;const l=r.Z.get(n);if(!l||l.accountId!==m)continue;const{path:d}=l;t?.has(c)&&s.set(c,new Map([[l.id,{read:!1}]])),i.push({accountId:m,path:d,destinationPath:v,searchListId:c}),e=!0;break}if(!e){(await f.Z.getBySearchListId(c)).some((e=>e.hasRaw))&&n.push({accountId:m,path:v,searchListId:c,flags:p})}}let b=Z.get(c);b||(b={id:c,unseen:u,flags:p,sources:h},Z.set(c,b));const w=!d.Z.isOnline(m,v),C={read:!t?.has(c)&&!!h.get(a)?.read,internal:w,deleted:!1};let A=I.get(c);A?A.set(a,C):(A=new Map([[a,C]]),I.set(c,A))}s.size>0&&await m.Z.addSourceFlags(s),i.length>0&&await m.Z.addCopy(i),n.length>0&&await m.Z.addUpload(n)}function E(e){const{sourceFilterId:n,listEntry:i}=e,{id:s,unseen:o,flags:a,sources:r}=i;let l=Z.get(s);l||(l={id:s,unseen:o,flags:a,sources:r},Z.set(s,l));const d={read:!t?.has(s)&&!!r.get(n)?.read,deleted:!1};let c=I.get(s);c?c.set(n,d):(c=new Map([[n,d]]),I.set(s,c))}if(C.length>0){const e=new Map;for(const t of C){E(t);const{sourceFilterId:n,listEntry:i}=t,{id:s}=i,o=e.get(n);o?o.push(s):e.set(n,[s])}for(const[t,n]of e){const e=o.Z.get(t);if(!e)throw new Error("Filter not found, id "+t);const{accountId:i,path:s}=e;await v.Z.deleteImapEntries(i,s,n)}}for(const e of A)E(e);const k=new Map;function _(e,t,n){const i=k.get(e);i?i.set(t,n):k.set(e,new Map([[t,n]]))}const N=new Map;function P(e,t){const n=N.get(e);n?n.push(t):N.set(e,[t])}if(u.length>0){const e=[],n=[],s=new Map;for(const i of u){const{sourceFilterId:o,listEntry:l}=i,{id:d,sourceFilterIds:c,sources:u}=l,p=r.Z.getByIds(c),h=p.find((e=>e.id===o)),g=p.filter((e=>e.accountId===h.accountId)),{accountId:m,path:f}=h;if(1===g.length){const n=a.Z.getFoldersOfType(m,S.e9)[0];if(!n)throw new Error("Can not undelete, an inbox folder was not found for "+m);const{path:i}=n,l=r.Z.getByFolderId([m,i]);if(!l)throw new Error(`Filter not found for ${m} ${i}`);t?.has(d)&&s.set(d,new Map([[l.id,{read:!1}]])),e.push({accountId:m,path:f,destinationPath:i,searchListId:d});const c=!t?.has(d)&&!!u.get(o)?.read;_(d,l.id,{read:c,deleted:!1,internal:!0})}else n.push({accountId:m,path:f,searchListId:d});P(d,o)}const o=await h(k);T.push(...o);const l=new w.RW;for(const{id:e,updates:t}of o){const{sourceFilterIds:n}=t;n&&l.add(n,e)}for(const{filterIds:e,searchListIds:t}of l.batches)g.Z.call({type:"FILTERS_SLES",priority:S.Un.NORMAL,filterIds:[...e],searchListIds:t});s.size>0&&await m.Z.addSourceFlags(s),e.length>0&&await m.Z.addMove(e),n.length>0&&await m.Z.addDelete(n),i.Z.flushBuffer()}if(n.length>0){const e=new Map;for(const t of n){const{listEntry:n,sourceFilterId:i}=t,{id:s}=n;P(s,i);const o=e.get(i);o?o.push(s):e.set(i,[s])}for(const[t,n]of e){const e=o.Z.get(t);if(!e)throw new Error("Filter not found, id "+t);const{accountId:i,path:s}=e;await v.Z.uploadEntries(i,s,new Set(n)),await v.Z.copyAndMoveEntries(i,s,n)}}if(N.size>0){const e=[];N.forEach(((t,n)=>{const i=e.find((e=>e.filterIds.size===t.length&&t.every((t=>e.filterIds.has(t)))));i?i.searchListIds.push(n):e.push({filterIds:new Set(t),searchListIds:[n]})}));for(const{searchListIds:t,filterIds:n}of e){const e=[...n],{sleUpdates:i}=await y.Z.call(t,e);T.push(...i);const s=new Map(e.map((e=>[e,void 0])));g.Z.call({type:"UPDATE_SLE",priority:S.Un.HIGH,searchListIds:t,sources:s})}}if(Z.size>0){const{sleUpdates:e}=l.Z.setCustomFlags([...Z.values()],{[S.T4.SEEN]:!1},I,!1);T.push(...e)}T.length>0&&s.Z.updateIndex({sleUpdates:T}),b.Z.filter()}},40382:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(26067),s=n(92292),o=n(7064);function a(e,t,n,a){return r=a,l=(0,i.ZP)(e,t,n),new Promise(((e,t)=>{const{pathArray:n,fileName:i}=l;o.Z.mailPrivate.writeTextToMessageFile(n,i,r,!1,(()=>{s.Z.runtime.lastError&&t({lastError:s.Z.runtime.lastError,pathArray:n,fileName:i}),e()}))})).catch((e=>{console.warn("writeToDisk %o",e)}));var r,l}},94283:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const i=(0,n(67294).createContext)(window)},80225:(e,t,n)=>{"use strict";n.d(t,{T$:()=>I,aT:()=>b});var i=n(22616),s=n(62882),o=n(56371),a=n(2497),r=n(7064),l=n(8684);const d="---",c=new RegExp("^(\ufeff)?---$"),u=new RegExp(`.(${["md","markdown","txt"].join("|")})$`,"i"),p="title",h="url",g="date",m="lastmod",f=(e,t,n="")=>{const s=""===n?t:`${t}: ${n}`;"import"===e&&i.Z.addImportError("Notes Folder","Notes",s),console.error(`Notes ${e}: ${s}`)},v=(e,t,n)=>{const{title:i="",content:s="",url:o="",dateAdded:a=0,dateModified:r=0,id:l}=n,d=[];if(""!==i&&d.push(p+`: ${i}`),""!==o&&d.push(h+`: ${o}`),a>0){const e=new Date(a).toISOString();d.push(g+`: ${e}`)}if(r>0){const e=new Date(r).toISOString();d.push(m+`: ${e}`)}const c=d.length>0?`---\n${d.join("\n")}\n---\n\n${s}\n`:`${s}\n`,u=new Blob([c]),v=`${(i||s).split("\n")[0].replace(/[/\\?%*:|"<>]/g,"_").trim().substring(0,24)}_${n.id}.md`;e.chrome.fileSystem.getWritableEntry(t,(e=>{e.getFile(v,{create:!0},(e=>{e.createWriter((e=>{let t=!1;e.onwriteend=function(e){if(!t)return t=!0,void this.truncate(u.size)},e.onerror=function(e){f("export",`Failed to export note ID "${l}"`,e.stack)},e.write(u)}))}))}))},y=(e,t,n,i)=>{i>=100?f("export","Exceeded folder recursion depth limit (100)."):n.forEach((n=>{if("folder"===n.type&&n.children&&n.children.length>0){const{title:s,id:o,children:a}=n,r=`${(s||o).split("\n")[0].replace(/[/\\?%*:|"<>]/g,"_").trim().substring(0,24)}`;e.chrome.fileSystem.getWritableEntry(t,(t=>{t.getDirectory(r,{create:!0},(t=>{y(e,t,a,i+1)}))}))}else"note"===n.type&&v(e,t,n)}))},b=async e=>{const t=(0,a.Z)(e),n=s.ZP.getFilteredTree("",{inTrash:!1}).nodes;try{const e=await S(t);if(e){const i=[{title:(0,o.Z)("Vivaldi Notes"),type:"folder",id:"-1",children:n}];y(t,e,i,0),(0,l.c)({title:(0,o.Z)("Finished Exporting Notes"),tag:"VIVALDI_NOTES_EXPORT_DONE"})}}catch(e){f("export","Folder selector problem",e)}},S=e=>new Promise(((t,n)=>{e.chrome.fileSystem.chooseEntry({type:"openDirectory"},(i=>{e.chrome.runtime.lastError?"User cancelled"===e.chrome.runtime.lastError.message?t(void 0):n(e.chrome.runtime.lastError.message):t(i||void 0)}))}));function w(e){const t={created:g,modified:m,updated:m};return t.hasOwnProperty(e)?t[e]:e}const C=(e,t)=>{t.file((n=>{const i=new FileReader;i.onerror=e=>{const n=e.currentTarget.error.message;f("import",`Failed to read file "${t.name}"`,n)},i.onload=s=>{const o=i.result;if(!o)return;const{headers:a,body:l}=(e=>{const t=e.split("\n"),n={};let i=0;for(let e=0;e<t.length&&!(e>=200);e++){const s=t[e];if(0===e){if(c.test(s))continue;break}if(/^(\w|-)+:\s*.+/i.test(s)){const e=s.match(/^(?<headerKey>(\w|-)+):\s*(?<headerValue>.+)/i);if(e&&e.groups){const{headerKey:t,headerValue:i}=e.groups,s=w(t),o=i;[p,h,g,m].includes(s)&&(n[s]=o)}}else{if(s===d){i=e+1,""===t[i+1]&&i++;break}if(""!==s)break}}return{headers:n,body:t.slice(i).join("\n").trim()}})(o);if(l){const i={parentId:e.toString(),type:"note",title:a.title||t.name.replace(/\.[^.]+$/,"")||"",url:a.url||"",content:l,date:n.lastModified,lastmod:n.lastModified};if(a.date){const e=Date.parse(a.date);!isNaN(e)&&e>0&&(i.date=e)}if(a.lastmod){const e=Date.parse(a.lastmod);!isNaN(e)&&e>0&&(i.lastmod=e)}r.Z.notes.create(i)}},i.readAsText(n)}),(e=>{f("import",`Failed to read file "${t.name}"`,e.stack)}))},A=(e,t,n)=>{if(!e)return void f("import","Could not read from the selected folder.");if(n>=100)return void f("import","Exceeded folder recursion depth limit (100).");e.createReader().readEntries((function(e){e.filter((e=>!e.name.startsWith(".")&&(e.isDirectory||e.isFile&&u.test(e.name)))).forEach((e=>{e.isDirectory?r.Z.notes.create({parentId:t.toString(),type:"folder",title:e.name}).then((t=>A(e,Number(t.id),n+1))):e.isFile&&C(t,e)}))}))},I=async e=>{const t=(0,a.Z)(e);try{const e=await S(t);if(e)try{r.Z.notes.beginImport(),i.Z.setImportProgress("Notes Folder","Notes",0,1),A(e,Number(s.R0),0)}finally{i.Z.setImportProgress("Notes Folder","Notes",1,1),r.Z.notes.endImport()}}catch(e){f("import","Folder selector problem",e)}}},37461:(e,t,n)=>{"use strict";n.d(t,{T:()=>o});var i=n(2497),s=n(7064);async function o(e){try{const t=(0,i.Z)(e);s.Z.savedpasswords.createDelegate(),t.chrome.passwordsPrivate.exportPasswords().catch((e=>{throw new Error(e)}))}catch(e){console.error("Password Export Failed.",e.message)}}},10334:(e,t,n)=>{"use strict";n.d(t,{UL:()=>Q,g2:()=>We,v$:()=>J,a5:()=>q,te:()=>X,Ff:()=>ee,hT:()=>oe,Xz:()=>Ie,hm:()=>ge,oE:()=>Ze,CD:()=>fe,$J:()=>ae,S4:()=>xe,IZ:()=>Ne,sh:()=>Oe,Dj:()=>_e,JC:()=>ke,nX:()=>Ce,pN:()=>we,jn:()=>he,s1:()=>Ae,xh:()=>Ee,Kk:()=>Pe,JQ:()=>ve,Lm:()=>me,ue:()=>le,Jg:()=>pe,bj:()=>Se,fJ:()=>be,a$:()=>ye,Gr:()=>De,vD:()=>ie,fX:()=>Le,de:()=>Te,Xf:()=>Be,lp:()=>ue,Fm:()=>ce,hV:()=>Me,AE:()=>se});var i=n(27770),s=n(59486),o=n(56284),a=n(25795),r=n(62819),l=n(62882),d=n(59322),c=n(96951),u=n(29087),p=n(80342),h=n(39206),g=n(63365),m=n(53454),f=n(56371),v=n(92292),y=n(12165),b=n.n(y),S=n(36980),w=n.n(S),C=n(11746),A=n.n(C),I=n(45454),T=n(26036),Z=n(36246);const E=(0,T.Z)("keyword zoom","reset"),k=(e,t,n)=>t.every((t=>{const i=e.label.toLowerCase(),s=e.labelEnglish.toLowerCase();return n?i.includes(t)||s.includes(t):i.includes(t)}));function _(e,t,n){const i=e.trim().toLowerCase().split(" ").filter(Boolean),s=t.filter((e=>function(e,t,n){return((e,t,n)=>{const{keyword:i}=e;if(!i)return;const{validity:s}=i;let o=!1,a=!1,r=t.find((e=>{let t=!1;return o=n&&e===E.labelEnglish||e===E.label,s&&(t=s.test(e)),isNaN(e)||(a=!0),o||a||t}));const l=t.filter((e=>!e.includes(String(r))));if(l.length&&k(e,l,n)){const{min:t,max:n,type:s,defaultValue:l}=i;return o?Object.assign(e,{foundKeyword:!0},{paramValue:l}):("number"==typeof r||a?r=(0,Z.Z)(r,t,n):"mixed"===s&&(r="string"==typeof r?{keyword:i,param:r}:void 0),Object.assign(e,{paramValue:r},{foundKeyword:Boolean(r)}))}})(e,t,n)||k(e,t,n)}(e,i,n)));return s}var N=n(7064),P=n(5422),D=n(75968),M=n(36436),O=n(29489),x=n(93196),L=n(47380),R=n(60339),B=n(721),F=n(89175),W=n(86088),U=n(13302),V=n(44850);const H={"⁰":"0","¹":"1","²":"2","³":"3","⁴":"4","⁵":"5","⁶":"6","⁷":"7","⁸":"8","⁹":"9"},G=(0,f.Z)("textselection","selection"),$=(0,f.Z)("pageurl","page url"),K=(0,f.Z)("websitelink","link url"),z=(0,f.Z)("webpagetitle","page title"),j=(0,f.Z)("elementsource","src url"),Y=e=>(e=`{${e=e.replace(/\s+/g,"_")}}`,{regex:new RegExp(e,"gi"),description:e}),X=Y(G),Q=Y(K),q=Y($),J=Y(z),ee=Y(j),te=20,ne=new D._b,ie=(e,t)=>{const n=(0,B.mT)(t),i=(0,B.Mr)(t),s=(0,I.ZP)(e,t),o=u.Z.get(F.kQuickCommandsOpenUrlInNewTab);return n?(s.inCurrent=!1,s.inBackground=!0):i&&o?s.inCurrent=!0:o&&(s.inCurrent=!1,s.inBackground=!1),s},se=e=>{if("number"==typeof e||!isNaN(e)){const{min:t,max:n}=(0,x.xU)("COMMAND_TAB_PERIODIC_RELOAD");return(0,Z.Z)(Number(e),t,n)}const{param:t}=e,{min:n,max:i,validity:s}=e.keyword,o=s.exec(t).groups,a=o.min||0,r=o.sec1||o.sec2||0,l=60*parseInt(a)+parseInt(r);return(0,Z.Z)(l,n,i)};async function oe(e,t){const n=(await a.Z.getVivDefinedCommands()).map((e=>{const t=(0,x.xU)(e.name);return{...e,...t&&{keyword:t}}})).concat(P.Y),i=await re(e.windowId,e.origin,e.menuData);for(const s of t){const{key:t,param:o}=s,a=n.find((e=>e.guid.includes(t)));if(!a){console.error(`chainedCommandExecution: Command ${t} not found`);break}const{action:r,keyword:l}=a;let d;if(l){const t=l.defaultValue;switch(d=void 0!==o?o:t,typeof d!==l.type&&"mixed"!==l.type&&"3a8efd62-4c8a-4545-8a6c-9cb65518f507"!==a.guid&&(d=l.defaultValue),typeof d){case"string":d=d.length?d.replace(X.regex,i?.selection?i.selection:"").replace(Q.regex,e.menuData?e.menuData.linkurl:"").replace(q.regex,i?.pageurl?i.pageurl:"").replace(J.regex,i?.pagetitle?i.pagetitle:"").replace(ee.regex,e.menuData?e.menuData.srcurl:""):l.defaultValue;break;case"number":d=(0,Z.Z)(d,l.min,l.max)}}delete e.param,d&&(e.param=d),await r(e)}}const ae=(e,t)=>{const{searchText:n,chains:i,shortcuts:s}=t,o=n.toLowerCase().split(" "),a=u.Z.get(F.kQuickCommandsLimitResults),r=u.Z.get(F.kQuickCommandsSearchPriority),l=(0,L.m)("qc",e);let d=i.filter((e=>o.every((t=>e.label.toLowerCase().includes(t)&&e.chain.length)))).map((e=>{const{chain:t,key:n,label:i,name:o}=e,a=s.find((e=>e.name===o));return{name:i,id:n,meta:a&&a.shortcuts?.length?a.shortcuts[0]:"",type:"commandChain",selectPriority:r.indexOf("COMMAND_CHAIN"),action:()=>oe(l,t)}}));return a&&(d=d.slice(0,te)),de({title:(0,f.Z)("Command Chains"),array:d})},re=async(e,t,n)=>{const i=c.ZP.getActivePage(e);if(!i)return;if("menu"===t||"event"===t)return n;return{selection:await N.Z.utilities.getSelectedText(i.id)??"",pageurl:i.url,pagetitle:i.title}};function le(e,t){const n=e.toLowerCase(),i=t.toLowerCase();return n.indexOf(i)}function de(e){const{title:t,array:n,subtitle:i}=e;return n.length?(n.unshift({name:t,type:"title",subtitle:i??null,count:n.length}),n):[]}function ce(e,t){return u.Z.get(F.kQuickCommandsSearchEnglish)?!0===(t.regex.test(e)||t.regexSearchEnglish.test(e)):t.regex.test(e)}function ue(e){const{label:t,initialPart:n="",endingPart:i=""}=e;return`${n}${`${t.substring(0,2)}?`}${`${t.split("").slice(2).join("?")}?`}${i}`}function pe(e,t){const n=u.Z.get(F.kQuickCommandsSearchPriority).length,{selectPriority:i=n}=e;return{priority:i,selectIndex:t}}function he(e){const{initialPart:t,endingPart:n}=e,{label:i,labelEnglish:s}=e.labelPair,o=ue({label:i,initialPart:t,endingPart:n}),a=ue({label:s,initialPart:t,endingPart:n});return{regex:new RegExp(o,"i"),regexSearchEnglish:new RegExp(a,"i")}}function ge(e){const t=s.Z.getNicknamed(e,!1).map((e=>{const{url:t=""}=e;return{folderId:e.children?e.id:void 0,type:"bookmarkNick",name:e.title,url:e.children?void 0:t,selectPriority:-1,nickname:e.nickname,faviconUrl:e.children?W._TQ.small:V.jk.getFavicon(t)}}));return de({title:(0,f.Z)("Nickname Match"),array:t})}function me(e){const t=e?p.Z.getFilter(e):[],n=u.Z.get(F.kQuickCommandsSearchPriority),i=t.map((e=>({type:"readingList",name:e.title,selectPriority:n.indexOf("READING_LIST"),url:e.url,faviconUrl:V.jk.getFavicon(e.url),read:e.read})));return de({title:(0,f.Z)("Reading List"),array:i})}function fe(e){const t=e.replace(/,/g,".").replace(/x/gi,"*").replace(/×/g,"*").replace(/÷/g,"/").replace(/−/g,"-").replace(/√/g,"sqrt").replace(/([^\s])([⁰¹²³⁴⁵⁶⁷⁸⁹]+)/gu,"$1 ^ $2 ").replace(/[⁰¹²³⁴⁵⁶⁷⁸⁹]/gu,(e=>H[e]));if(!t)return[];let n;try{n=ne.evaluate(t)}catch(e){}if(void 0===n||"function"==typeof n)return[];let i=n;const s=`${String.fromCharCode(8722)}0`,o=`${String.fromCharCode(45)}0`,a=u.Z.get(F.kQuickCommandsSearchPriority);i!==s&&i!==o||(i="0");return[{name:i.toString(),searchString:e,selectPriority:a.indexOf("CALCULATOR"),type:"calculator"}]}function ve(e){const t=e.toLowerCase().split(" "),n=u.Z.get(F.kQuickCommandsSearchPriority).indexOf("OPEN_TABS"),i=u.Z.get(F.kWorkspacesEnabled),s=c.ZP.filterPagesInAllWindows((e=>Re(e.title,e.url,t))).toArray().map((e=>{const{url:t,id:s}=e;return{name:V.jk.getDisplayTitle(e),url:(0,M.xl)(t)?"":t,type:"openTab",selectPriority:n,pageId:s,windowId:e.windowId,pageUrlForFavicon:t,faviconUrl:V.jk.getFavicon(t),workspaceId:i?e.vivExtData.workspaceId:void 0}}));return de({title:(0,f.Z)("Tabs"),array:s})}async function ye(){const e=await N.Z.tabsPrivate.getSendTabToSelfTargets();return e.valid?e.entries:[]}function be(e,t,n){let i=[];const s=c.ZP.getActivePage(e);if(s){const e=u.Z.get(F.kQuickCommandsSearchPriority),o=t.toLowerCase();i=n.map((t=>({guid:t.guid,deviceType:t.type,pageUrl:s.url,title:s.title,name:(0,f.Z)("Send to $1",[t.name]),type:"sendtabtoself",selectPriority:e.indexOf("SEND_TAB_TO_SELF")}))).filter((e=>-1!==e.name.toLowerCase().indexOf(o)))}return de({title:(0,f.Z)("Send Tab to Your Devices"),array:i})}function Se(e){return"phone"===e?w():"tablet"===e?A():b()}async function we(){return N.Z.extensionActionUtils.getToolbarExtensions()}function Ce(e,t){const n=u.Z.get(F.kQuickCommandsSearchPriority),i=u.Z.get(F.kQuickCommandsLimitResults),s=e.toLowerCase().split(" ");let o=t.filter((e=>{const t=e.name?.toLowerCase();return s.every((e=>t?.includes(e)))})).map((e=>{const t=e.enabled?e.badgeIcon:W.N_W;return{name:e.name,faviconUrl:t,id:e.id,type:"extension",enabled:e.enabled,optionsUrl:e.optionspage,selectPriority:n.indexOf("EXTENSIONS")}}));i&&(o=o.slice(0,te));const a=(0,U.$)("ctrl");return de({title:(0,f.Z)("Extensions"),array:o,subtitle:(0,f.Z)("Open Options Page with $1",[a])})}function Ae(e){const t=u.Z.get(F.kQuickCommandsSearchPriority),n=u.Z.get(F.kQuickCommandsLimitResults),{searchText:i,today:s}=e;let o=r.Z.getFilteredHistory(i,s).map((e=>{const{url:n,title:i,visitCount:s,visitTime:o}=e;return{type:"history",faviconUrl:V.jk.getFavicon(n),selectPriority:t.indexOf("HISTORY"),url:n,name:i,visitTime:o,visitCount:s}}));return n&&(o=o.slice(0,te)),de({title:(0,f.Z)("History"),array:o})}function Ie(e){const t=u.Z.get(F.kQuickCommandsSearchPriority),n=u.Z.get(F.kQuickCommandsLimitResults),i=e.toLowerCase();let o=s.Z.getFilteredFlat(i,{bookmarks:!1,folders:!0,inTrash:!1}).filter((e=>e.nickname.toLowerCase()!==i)).map((e=>({folderId:e.id,type:"bookmarkFolder",name:e.title,selectPriority:t.indexOf("BOOKMARK_ITEM_OR_FOLDER"),nickname:e.nickname,faviconUrl:W._TQ.small})));return n&&(o=o.slice(0,te)),de({title:(0,f.Z)("Open All Bookmarks in Folder"),array:o})}async function Te(e,t){const{id:n,enabled:i,optionsPage:s,optionsUrl:o}=t;i||await v.Z.management.setEnabled(n,!0),s&&o.length?d.ZP.openURL(e,o,{inCurrent:!s}):We.emitChange(n)}function Ze(e){const t=u.Z.get(F.kQuickCommandsSearchPriority),n=u.Z.get(F.kQuickCommandsLimitResults),i=e.toLowerCase();let o=s.Z.getFilteredFlat(i,{bookmarks:!0,folders:!1,inTrash:!1}).filter((e=>e.nickname.toLowerCase()!==i&&s.Z.isBookmark(e))).map((e=>{const{url:n="",nickname:i,title:s}=e;return{type:"bookmark",name:s,url:n,selectPriority:t.indexOf("BOOKMARK_ITEM_OR_FOLDER"),nickname:i,faviconUrl:V.jk.getFavicon(n)}}));return n&&(o=o.slice(0,te)),de({title:(0,f.Z)("Bookmarks"),array:o})}function Ee(e){const t=e.split(" ")[0],n=h.Z.getByKeyword(t);if(!n)return[];const i=e.substring(t.length).trim();return[{name:(0,f.Z)("Keyword Search “$1” on $2",[i,n.name]),nickname:n.keyword,type:"keywordSearch",faviconUrl:n.faviconUrl,selectPriority:-1,searchQuery:e}]}function ke(e,t){const n=u.Z.get(F.kQuickCommandsSearchPriority);return{name:(0,f.Z)("Search “$1” on $2",[e,t?.name??""]),type:"search",faviconUrl:t?t.faviconUrl:"",selectPriority:n.indexOf("KEYWORD_SEARCH"),searchQuery:e}}function _e(e){return e.length<4?[]:[{name:(0,f.Z)("Create Note “$1”",[e]),type:"noteAdd",value:e}]}function Ne(e,t){const n=a.Z.getQuickCommands(e).map((e=>{const t=(0,x.xU)(e.name);return{...e,foundKeyword:!1,...t&&{keyword:t}}})),i=u.Z.get(F.kQuickCommandsSearchEnglish),s=_(t,n,i).map((e=>{const t=a.Z.getCommandConfiguration(e.name),{label:n,foundKeyword:s,keyword:o,paramValue:r,labelEnglish:l}=e;let d=n;const c=r&&s?r:void 0;o&&(d=s?(0,f.Z)("Run $1",[n]):n+" #");const p=u.Z.get(F.kQuickCommandsSearchPriority);return{name:d,type:o?"commandKeyword":"command",meta:t?.shortcuts?t.shortcuts[0]:"",commandName:e.name,searchString:n,selectPriority:s?-1:p.indexOf("NORMAL_COMMAND"),value:c,...i&&{labelEnglish:l}}}));return de({title:(0,f.Z)("Commands"),array:s})}function Pe(e){const t=u.Z.get(F.kQuickCommandsSearchPriority),n=u.Z.get(F.kQuickCommandsLimitResults);let i=l.ZP.getFilteredFlat(e,{inTrash:!1}).map((e=>{const{id:n,title:i,children:s,content:o,url:a,type:r}=e,l="note"===r&&s&&s.length>0;return{type:"note",id:n,url:a||"",name:i||o||"",isFolder:void 0!==s?.length&&"note"!==r,selectPriority:t.indexOf("NOTES_SEARCH"),nickname:i&&o?o:"",hasAttachment:l}}));return n&&(i=i.slice(0,te)),de({title:(0,f.Z)("Notes"),array:i})}function De(e){const t=(0,M.q9)(e);if(!(0,M.C3)(e)&&!(0,M.xl)(e)||!t.length)return[];const n=u.Z.get(F.kQuickCommandsSearchPriority),i={name:t,type:"url",selectPriority:(0,M.Zj)(e)?n.indexOf("KEYWORD_SEARCH")-1:-1,pageUrlForFavicon:t,faviconUrl:V.jk.getFavicon(t)};return de({title:t.toLowerCase().startsWith("javascript:")?(0,f.Z)("Execute"):(0,f.Z)("Go to Address"),array:[i]})}async function Me(e,t){const n=s.Z.getItemById(t);if(n&&s.Z.isFolder(n)){const t=i.ZP.getBookmarksByNode(n),s={inCurrent:!u.Z.get(F.kBookmarksOpenInNewTab),inBackground:!1,inNewWindow:!1,allowOverride:!1,incognito:!1};i.ZP.open(e,t,s,!0)}}function Oe(e,t){const n=e.toLowerCase().split(" "),i=u.Z.get(F.kQuickCommandsSearchPriority),s=t.filter((e=>n.every((t=>(0,O.gD)(e).toLowerCase().includes(t))))).map((e=>({type:"contentScript",selectPriority:i.indexOf("PAGE_ACTIONS"),script:e,name:(0,O.gD)(e)})));return de({title:(0,f.Z)("Page Actions"),array:s})}function xe(e){const t=u.Z.get(F.kQuickCommandsSearchPriority),n=u.Z.get(F.kQuickCommandsLimitResults),i=e.toLowerCase().split(" ");let s=g.Z.getTrash().flatMap((e=>e.window?.tabs?e.window.tabs.flatMap((t=>({lastModified:e.lastModified,...t}))):{lastModified:e.lastModified,...e.tab})).filter((e=>Re(e.title||"",e.url||"",i))).map((e=>{const n=e.url||"";return{name:e.title||"",url:(0,M.xl)(n)?"":n,type:"closedTab",selectPriority:t.indexOf("CLOSED_TABS"),pageUrlForFavicon:n,faviconUrl:V.jk.getFavicon(n),command:e}}));return n&&(s=s.slice(0,te)),de({title:(0,f.Z)("Closed Tabs"),array:s})}function Le(e){const t=u.Z.get(F.kQuickCommandsSearchPriority),n=e.toLowerCase().split(" "),i=m.Z.getState().flatMap((e=>n.some((t=>e.name.toLowerCase().includes(t)))?{name:e.name,type:"workspace",selectPriority:t.indexOf("WORKSPACES"),workspaceId:e.id}:[]));let s;return s=n.some((e=>(0,f.Z)("This Window").toLowerCase().includes(e)))?[{name:(0,f.Z)("This Window"),type:"workspace",selectPriority:t.indexOf("WORKSPACES"),workspaceId:void 0}].concat(i):i,de({title:(0,f.Z)("Workspaces"),array:s})}function Re(e,t,n){const i=(0,M.xl)(t)?e:`${e} ${t}`;return n.every((e=>i.toLowerCase().includes(e)))}function Be(e){c.ZP.getDiscardablePages(e).filter((e=>!(0,R.ZN)(e))).forEach(d.ZP.discardPage)}class Fe extends o.Z{}const We=new Fe},21343:(e,t,n)=>{"use strict";n.d(t,{M8:()=>p,l_:()=>h});var i=n(22616),s=n(56371),o=n(2497),a=n(7064);function r(e){if(!/(^\s|[\n,"]|\s$)/.test(e))return e;return`"${e.replace(/"/g,'""')}"`}var l=n(8684);const d="URL,Title,Selection,Folder,Timestamp",c="Unread",u=(e,t,n,s="")=>{const o=""===s?n:`${n}: ${s}`;"import"===e&&i.Z.addImportError("Reading List",t,o),console.error(`Reading List ${e}: ${o}`)};async function p(e){const t=(0,o.Z)(e),n=await async function({showSaveFilePicker:e}){try{return await e({suggestedName:"Vivaldi Reading List.csv",types:[{accept:{"text/csv":[".csv"]},description:(0,s.Z)(".csv files")}]})}catch(e){return"AbortError"!==e.name&&console.warn("Failed to select file",e),Promise.resolve(void 0)}}(t);if(!n)return;const i=await async function(){let e=`${d}\r\n`;return await a.Z.readingListPrivate.getAll().then((t=>(t.sort(((e,t)=>e.lastUpdate-t.lastUpdate)).forEach((t=>{const n=r(t.url),i=r(t.title||""),s=t.read?"Archive":c,o=Math.round((t.lastUpdate||Date.now())/1e3);e+=`${n},${i},,${s},${o}\r\n`})),e)))}();try{const e=await n.createWritable();await e.write(i),await e.close(),(0,l.c)({title:(0,s.Z)("Finished Exporting Reading List"),tag:"VIVALDI_READINGLIST_EXPORT_DONE"})}catch(e){u("export","Exporting Reading List failed: ",e)}}async function h(e){const t=(0,o.Z)(e),n=await async function({showOpenFilePicker:e}){const[t]=await e({types:[{accept:{"text/csv":[".csv"]},description:(0,s.Z)(".csv files")}]});return t}(t);if(!n)return void u("import","unknown","Failed to read file.");const r=await async function(e){const t=await e.getFile();return new Promise(((e,n)=>{const i=new FileReader;i.onloadend=()=>{i.result instanceof ArrayBuffer?e(i.result):n()},i.readAsArrayBuffer(t),i.onerror=e=>{u("import","unknown","Failed to read a file.",(i.error||"").toString()),n()}}))}(n),p=new Uint8Array(r),h=new TextDecoder("utf-8").decode(p);let g;i.Z.setImportProgress("Reading List",n.name,0,1);try{g=function(e){if(""===e.trim())return null;const t=Array.from(e.trimEnd().replace(/\r\n/g,"\n"));let n=!1,i=!1,s=!1,o=!1,a="",r=[];const l=[];if(t.forEach(((e,d)=>{if(d===t.length-1){if(","===e)r.push(a),r.push("");else if(n&&'"'===e)n=!1,r.push(a);else if("\n"===e)r.push(s?a:a.trim());else{if(o)throw new Error("CSV parsing encountered an unexpected character outside an escape sequence in a cell.");a+=e,r.push(a)}l.push(r)}else switch(e){case'"':if(i&&n){a+='"',i=!1;break}if(i&&!n){n=!0,s=!0,i=!0,a="";break}i=!0;break;case",":if(!n&&i){i=!1,n=!0,s=!0,a=",";break}if(n&&!i){a+=",";break}n&&i&&(n=!1,i=!1),r.push(s?a:a.trim()),a="",s=!1,o=!1;break;case"\n":if(i&&n)n=!1,i=!1,o=!1;else{if(i&&!n){n=!0,s=!0,i=!1,a+="\n";break}if(!i&&n){a+="\n";break}}if(0===a.length&&0===r.length)break;r.push(s?a:a.trim()),l.push(r),a="",r=[],s=!1;break;default:if(i){if(!n){n=!0,s=!0,i=!1,a=e;break}if(o=!0,/ |\t/.test(e))break;throw new Error("CSV parsing encountered an unexpected character outside an escape sequence in a cell.")}o||(a+=e)}})),n)throw new Error("CSV parsing ended with an unterminated escape sequence.");return 0===l.length?null:l}(h)}catch(e){return void u("import",n.name,"Failed to parse CSV file.",e)}if(null===g||!g.shift().join(",").startsWith(d))return void u("import",n.name,`File not in the expected CSV file format. (Headers: ${d}).`);let m=0;g.forEach((async e=>{if(e.length<5)return void u("import",n.name,"Fewer than the expected minimum number of columns (5).");let t;try{t=new URL(e[0]).toString()}catch(e){return void u("import",n.name,"Invalid or missing URL.",e)}const i=e[1],s=e[3]!==c;a.Z.readingListPrivate.add(t,i).then((()=>{m++,a.Z.readingListPrivate.setReadStatus(t,s)})).catch((e=>{u("import",n.name,`Failed to import “${t}”.`,e)}))})),i.Z.setImportProgress("Reading List",n.name,m,m),(0,l.c)({title:(0,s.Z)("Finished Importing Reading List"),tag:"VIVALDI_READINGLIST_IMPORT_DONE"})}},68131:(e,t,n)=>{"use strict";function i(e,t){if(!t.length)return null;if(1===t.length)return t[0];const n=t.filter((e=>e.hreflang)).map((e=>({lang:e.hreflang?.replace(/_/g,"-").toLowerCase()??"",val:e}))),i=t.filter((e=>!e.hreflang));if(!n.length)return i[0];e=e.map((e=>e.replace(/_/g,"-").toLowerCase()));let s=!1;do{for(let t=0;t<e.length;t++){const i=n.find((n=>n.lang===e[t]));if(i)return i.val}s=!1,n.forEach((e=>{const t=e.lang.lastIndexOf("-");-1!==t&&(s=!0,e.lang=e.lang.substring(0,t))}))}while(s);e=e.map((e=>e.replace(/-[\w\W]*$/g,"").toLowerCase()));for(let t=0;t<e.length;t++){const i=n.find((n=>n.lang===e[t]));if(i)return i.val}return i.length?i[0]:n[0].val}n.d(t,{Z:()=>i})},11472:(e,t,n)=>{"use strict";n.d(t,{K:()=>h,O:()=>g});var i=n(29087),s=n(56371),o=n(68131);var a=n(85834),r=n(87422),l=n(79113),d=n(89175),c=n(76085);const u=/^\s*data:/i,p="x-vivaldi/feed-embeddable-media/youtube";function h(e){if(""===e)return[];const t=(0,c.ho)(e);if("string"==typeof t)return[{type:"html",content:`<html><body><p>${(0,s.Z)("Error: $1",[t])}</p></body></html>`}];const{feeditems:n}=t;return n.length?g(n[0]):[{type:"html",content:`<html><body><p>${(0,s.Z)("Error: $1",["NO_FEED_ITEM"])}</p></body></html>`}]}function g(e){const{htmlbody:t,htmlrights:n,links:i}=e,s=[{type:"html",content:`<main>\n      ${t}\n    </main>\n    ${b(i,t)}\n    ${m(n)}`}];return[["alternate",i.alternate],["enclosure",i.enclosure],["related",i.related],["via",i.via],["comments",i.comments],["serviceedit",i.serviceedit]].forEach((([e,t])=>{let n=1;t.filter((e=>e.url.match(u))).forEach((t=>{const i=function(e,t){let n="us-ascii",i="text/plain";if(t){const e=t.match(/;\s*charset\s*=\s*("\s*)?([^\s;"]+)/i);e&&(n=e[2]),i=t.replace(/;[\w\W]*$|\s+/g,"")||i}const s={valid:!1,protocol:"",mimeType:i,charset:n,base64:!1,data:""},o=e.match(/^\s*data:([^,]*),([\w\W]*)$/i);if(o){s.valid=!0,s.protocol="data:",s.data=o[2];const e=o[1].split(";");e.forEach(((t,n)=>{if(!n&&/^\s*[a-z]*\/[\w!#$&\-^\.\+]+\s*$/.test(t))s.mimeType=t.replace(/\s+/g,"").toLowerCase();else{let i,o;const a=t.indexOf("=");-1===a?i=t:(i=t.substring(0,a),o=t.substring(a+1).replace(/^\s+|"|\s+$/g,"")),i=i.toLowerCase().replace(/^\s+|\s+$/g,""),"charset"===i&&o?s.charset=o.toLowerCase():"base64"===i&&-1===a&&n===e.length-1&&(s.base64=!0,s.data=s.data.replace(/\s+/g,""))}}))}return s}(t.url,t.mimetype),{valid:o,mimeType:l,charset:d,base64:c}=i;let u=c?(0,a.tV)(i.data):i.data;if(o&&u){let i=t.title.replace(/[\\\/?%*:|"<>\s]/g,"")||`${e}${n++}`;const o=i.replace(/^([^\.]*$|[\w\W]*\.)/,"").toLowerCase(),a=(0,r.nv)(l,o);if(a!==o&&(i=`${i}.${a}`),!c)if("utf-8"===d)try{u=decodeURIComponent(u)}catch(e){u=unescape(u)}else if("us-ascii"===d||"iso-8859-1"===d)u=unescape(u);else{const e=u.length;let t=0;const n=[];for(;t<e;){const i=u.substring(t,t+1);if("%"===i&&e-t>=3){const e=u.substring(t+1,t+2),s=u.substring(t+2,t+3);isNaN(parseInt(e,16))||isNaN(parseInt(s,16))?n.push(i.charCodeAt(0)):(n.push(parseInt(`${e}${s}`,16)),t+=2)}else{const e=i.charCodeAt(0);if(e>255){(new TextEncoder).encode(i).forEach((e=>n.push(e)))}else n.push(e)}t++}try{u=new TextDecoder(d).decode(new Uint8Array(n))}catch(e){try{u=decodeURIComponent(u)}catch(e){u=unescape(u)}}}const p={type:"attachment",mimeType:l,filename:i,content:(new TextEncoder).encode(u),fileSize:u.length};s.push(p)}}))})),s}const m=e=>e?`<footer>${e}</footer>`:"";function f(e=""){const t=document.createElement("div");return t.textContent=e,t.innerHTML}const v=(e,t)=>{const n=e.hreflang&&"string"==typeof e.hreflang?` hreflang="${f(e.hreflang)}`:"";return`<li>\n    <a href="${f(e.url)}"${n}>\n    ${f("string"==typeof e.title&&""!==e.title?e.title:t.length?t:e.url)}\n    </a>\n    </li>`},y=(e,t)=>`<figure>\n    ${e}\n    ${t?`<figcaption>${f(t)}</figcaption>`:""}\n    </figure>`;const b=(e,t)=>{const n=[],a=e=>!e.url.match(u),r=document.createElement("video"),c=/^(image|img)\/(jpe?g|gif|a?png|svg+xml|bmp|x-icon|webp)(\b|$)/i,h=/^[^\?#]*\.(jpe?g|gif|a?png|svg|bmp|ico|cur|webp)(\?|#|$)/i,g=e.enclosure.filter(a);let m=[];/<(img|image)\s/i.test(t)||(m=g.filter((e=>e.mimetype?e.mimetype?.match(c):e.url.match(h))));const b=g.filter((e=>{const t=e.mimetype;if(t&&/^video\//i.test(t))return r.canPlayType(t);if(i.Z.get(d.kRssEmbedYoutubeAttachments)){const t=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/gi.exec(e.url);if(t&&t[1])return e.mimetype=p,e.url=t[1],!0}return!1})),S=g.filter((e=>{const t=e.mimetype;return!(!t||!/^audio\//i.test(t))&&r.canPlayType(t)})),w=g.filter((e=>!(m.includes(e)||b.includes(e)||S.includes(e))));n.push("<nav>");const C=e.alternate.filter(a),A=(0,o.Z)(navigator.languages,C);n.push('<ul class="mainbutton">'),A&&n.push(v(A,(0,s.Z)("Open article"))),n.push("</ul>"),C.length>1&&(n.push(`<h2>${(0,s.Z)("Main article")}</h2><ul>`),C.forEach((e=>{e!==A&&n.push(v(e,(0,s.Z)("Open article")))})),n.push("</ul>")),w.length&&(n.push(`<h2>${(0,s.Z)("Attachments")}</h2><ul>`),w.forEach((e=>{n.push(v(e,""))})),n.push("</ul>"));const I=e.related.filter(a);I.length&&(n.push(`<h2>${(0,s.Z)("Related content")}</h2><ul>`),I.forEach((e=>{n.push(v(e,""))})),n.push("</ul>"));const T=e.via.filter(a);T.length&&(n.push(`<h2>${(0,s.Z)("Sources")}</h2><ul>`),T.forEach((e=>{n.push(v(e,""))})),n.push("</ul>"));const Z=e.comments.filter(a);Z.length&&(n.push(`<h2>${(0,s.Z)("Comments")}</h2><ul>`),Z.forEach((e=>{n.push(v(e,""))})),n.push("</ul>"));const E=e.serviceedit.filter(a);return E.length&&(n.push(`<h2>${(0,s.Z)("Edit blog post")}</h2><ul>`),E.forEach((e=>{n.push(v(e,""))})),n.push("</ul>")),n.push("</nav>"),(m.length||b.length||S.length)&&(b.length&&(n.push(`<section><h2>${(0,s.Z)("Linked videos")}</h2>`),b.forEach((e=>{e.mimetype===p?n.push(function({url:e}){return y((0,l.w)(e))}(e)):n.push((e=>y(`<video controls src="${f(e.url)}"></video>`,e.title))(e))})),n.push("</section>")),S.length&&(n.push(`<section><h2>${(0,s.Z)("Linked audio")}</h2>`),S.forEach((e=>{n.push((e=>y(`<audio controls src="${f(e.url)}"></audio>`,e.title))(e))})),n.push("</section>")),m.length&&(n.push(`<section><h2>${(0,s.Z)("Linked images")}</h2>`),m.forEach((e=>{n.push((e=>{const t=e.title?` alt="${f(e.title)}"`:"";return y(`<img src="${f(e.url)}"${t}>`,e.title)})(e))})),n.push("</section>"))),n.join("")}},79113:(e,t,n)=>{"use strict";function i(e){const t=function(e){return`https://www.youtube-nocookie.com/embed/${e}?rel=0`}(e);return`<iframe src="${t}" frameborder="0" allowfullscreen></iframe>`}n.d(t,{w:()=>i})},18806:(e,t,n)=>{"use strict";function i(e,t){const n=e[t];return"string"==typeof n?n:""}function s(e,t){if(/^\s*#/.test(e))return e;try{return new URL(e,t).href}catch(t){return e}}function o(e){try{return new URL(e),!0}catch(e){return!1}}function a(e,t){const n=[...e.attributes].find((e=>e.nodeName.toLowerCase()===t));return n?n.nodeName:""}n.d(t,{A:()=>l,n:()=>d});const r=/^\s*(https?|ftp|file):/i;function l(e,t){if(!(t&&r.test(t)&&o(t)&&/<[a-z][\w\-:]*[\s\/][^>]*=|<style\b/i.test(e)))return e;const n=(new DOMParser).parseFromString(e,"text/html"),i=n.documentElement,s=n.head,a=n.body;if(!(n&&i instanceof Element&&s instanceof Element&&a instanceof Element))return e;const l=/<html\b/i.test(e),c=/<head\b/i.test(e),u=/<(body|frameset)\b/i.test(e),p=i.attributes.length,h=s.attributes.length,g=a.attributes.length,m=s.childNodes.length,f=a.childNodes.length;let v;if(c||h||m||!s.parentNode||s.parentNode.removeChild(s),u||g||f||!a.parentNode||a.parentNode.removeChild(a),l||p)v=n.createElement("div"),v.appendChild(i);else{if(!i.children.length)return e;v=u||g||c||h||m&&f?i:m?s:a}return d(v,t).innerHTML}function d(e,t){if(!t||!r.test(t)||!o(t))return e;const n=document.implementation.createDocument("http://www.w3.org/1999/xhtml","html",null),l=[...e.getElementsByTagName("base")].filter((e=>a(e,"href")));if(l.length){const e=l[0].getAttribute(a(l[0],"href"));if(e&&r.test(e)&&o(e))t=e;else if(e&&!/^\s*[a-z0-9\-\+\.]+:/i.test(e)){const n=s(e,t);!r.test(n)&&o(n)||(t=n)}l.forEach((e=>{e.parentNode&&e.parentNode.removeChild(e)}))}const d=n.documentElement;if(!d)return e;const c=n.createElement("base");c instanceof HTMLBaseElement&&(c.href=t,d.appendChild(c));const u=n.importNode(e,!0);d&&d.appendChild(u);const p=[{attr:"action",prop:"action",check:"",pattern:null,replacer:null},{attr:"archive",prop:"",check:"archive",pattern:/([^\s]+)/g,replacer:function(e,n){return s(n,t)}},{attr:"background",prop:"",check:"background",pattern:null,replacer:null},{attr:"cite",prop:"cite",check:"",pattern:null,replacer:null},{attr:"data",prop:"data",check:"",pattern:null,replacer:null},{attr:"formaction",prop:"formAction",check:"",pattern:null,replacer:null},{attr:"longdesc",prop:"longDesc",check:"",pattern:null,replacer:null},{attr:"href",prop:"href",check:"",pattern:null,replacer:null},{attr:"poster",prop:"poster",check:"",pattern:null,replacer:null},{attr:"src",prop:"src",check:"",pattern:null,replacer:null},{attr:"srcset",prop:"",check:"srcset",pattern:/([^,\s]+)(\s+[^,\s]+)/g,replacer:function(e,n,i){return s(n,t)+i}},{attr:"xml:link",prop:"",check:"",pattern:null,replacer:null}],h=u.getElementsByTagName("*");for(let e=0;e<h.length;e++){const o=h[e];let r;try{r=n.createElement(o.localName.toLowerCase())}catch(e){r=n.createElement(o.localName.toLowerCase().replace(/[^\w:\-].*$/,""))}d.appendChild(r);for(const{attr:e,prop:n,check:l,pattern:d,replacer:c}of p){const u=a(o,e);if(u){const a=o.getAttribute(u)||"";if(r.setAttribute(e,a),d&&c){if(l&&i(r,l)||!l){const e=a.replace(d,c);a!==e&&o.setAttribute(u,e)}}else if(n){const e=i(r,n);e&&(a===e||/^\s*#/.test(a)||o.setAttribute(u,e))}else if(l&&i(r,l)||!l){const e=s(a,t);a!==e&&o.setAttribute(u,e)}}}const l=function(e,n){return'url("'+s(n,t)+'")'},c=/\burl\("([^"]+)"\)/g,u=a(o,"style");if(u){r.setAttribute("style",o.getAttribute(u)||"");const e=r.style.cssText;if(e){const t=e.replace(c,l);e!==t&&o.setAttribute(u,t)}}if(r instanceof HTMLStyleElement&&o.textContent.length&&r.sheet instanceof CSSStyleSheet){r.textContent=o.textContent;const e=[...r.sheet.cssRules].map((e=>e.cssText)).join("\n"),t=e.replace(c,l);e!==t&&(o.textContent=t)}d.removeChild(r)}return e.ownerDocument.adoptNode(u)}},76085:(e,t,n)=>{"use strict";n.d(t,{X7:()=>R,ho:()=>x,t5:()=>L});var i=n(51540),s=n(79113),o=n(78614),a=n(18806);class r{category=[];cloud=[];people=new h;feeditems=[];generator=null;haserrors=!1;htmlrights="";htmldescription="";htmltitle="";icon=null;id="";image=null;language="";lastbuilddate="";links=new c;plaintitle="";pubdate="";publishdate="";rating="";skipdays=new y;skiphours={};textinput=[];ttl="";updated="";updatedate="";updatefrequency="";updateperiod=""}class l{category=[];people=new h;htmlbody="";htmlcontent="";htmldescription="";htmlrights="";htmlsummary="";htmltitle="";id="";links=new c;plaintitle="";pubdate="";publishdate="";published="";source=null;updated="";updatedate="";xmloriginal="";bodyimages=[]}class d{description="";height="";link="";title="";url="";width=""}class c{alternate=[];comments=[];docs=[];enclosure=[];next=[];prev=[];related=[];self=[];serviceedit=[];servicepost=[];via=[]}class u{hreflang="";bytelength="";mimetype="";title="";url=""}class p{label="";scheme="";term=""}class h{author=[];contributor=[];managingeditor=[];webmaster=[]}class g{email="";name="";url=""}class m{name="";url="";version=""}class f{domain="";path="";port="";protocol="";registerprocedure=""}class v{htmldescription="";link="";name="";title=""}class y{sunday=!1;monday=!1;tuesday=!1;wednesday=!1;thursday=!1;friday=!1;saturday=!1}class b{htmltitle="";items=[];ownername="";owneremail="";ownerurl="";plaintitle="";publishdate="";updatedate=""}class S{category="";created="";feedurl="";htmldescription="";htmltitle="";items=[];language="";pageurl="";plaintitle="";supported=!0}const w="http://www.w3.org/1999/xhtml";function C(e){return(e||"").replace(/^\s+|\s+$/g,"")}function A(e){return(e||"").replace(/^\s*[\r\n]|\s+$/g,"")}function I(e){return document.createElementNS(w,"div").appendChild(document.createTextNode(e)).parentElement?.innerHTML??""}function T(e){const t=document.implementation.createHTMLDocument().createElementNS(w,"div");return t.innerHTML=e,C(t.textContent)}function Z(e,t,n){return/&(#\d+|#x[0-9a-e]+|[a-z][0-9a-z]*);|<[a-z][a-z0-9\-]*\b[^>]*>/i.test(e)?(0,a.A)(C(e),M("",t,n)):(0,i.Z)(I(A(e)))}function E(e){return e.toLowerCase()}function k(e,t){return C(e||t).toLowerCase()}function _(e){let t="";for(let n=0;n<e.childNodes.length;n++)e.childNodes[n].nodeType!==Node.TEXT_NODE&&e.childNodes[n].nodeType!==Node.CDATA_SECTION_NODE||(t+=e.childNodes[n].nodeValue);return t}function N(e,t,n){for(let i=t.length-1;i>=0;i--)if(t[i]){if(e.hasAttributeNS(t[i],n))return e.getAttributeNS(t[i],n);if(e.namespaceURI===t[i]&&(!i||e.hasAttributeNS("",n)))return e.getAttributeNS("",n);if(!i)return null}else{if(!i&&e.namespaceURI)return null;if(!i||!e.namespaceURI&&e.hasAttributeNS("",n))return e.getAttributeNS("",n)}}function P(e,t,n){for(let i=t.length-1;i>=0;i--)if(t[i]){if(e.hasAttributeNS(t[i],n))return!0;if(e.namespaceURI===t[i]&&(!i||e.hasAttributeNS("",n)))return!!i||e.hasAttributeNS("",n);if(!i)return!1}else{if(!i&&e.namespaceURI)return!1;if(!i||!e.namespaceURI&&e.hasAttributeNS("",n))return Boolean(i||e.getAttributeNS("",n))}return!1}function D(e){try{return new URL(e),!0}catch(e){return!1}}function M(e,t,n){const i=/^[a-z0-9\-\+\.]+:/i;if(i.test(e))return e;const s=/^(https?|ftp|file):/i,o=[e];let a,r=!1;for(;!r&&t?.nodeType===Node.ELEMENT_NODE;){if(t?.hasAttribute("xml:base")&&(a=C(t?.getAttribute("xml:base")),a.length)){const e=a.match(i);r=s.test(a)&&D(a),e&&!r||(o[o.length]=a)}t=t?.parentElement}if(!r){if(!s.test(n)||!D(n))return e;o[o.length]=n}for(n=o.pop();void 0!==(a=o.pop());)try{n=new URL(a,n).href}catch(t){return e}return n||(n=e),n}const O=new RegExp("^[\\p{Ps}\\p{Pi}\"'<]+|[\\p{Pe}\\p{Pf}\"'>]+$","ug");function x(e){return L((new DOMParser).parseFromString(e,"application/xml"),e,"")}function L(e,t,n){let c=e,h=e?.documentElement;const y="http://www.w3.org/2005/Atom",b="http://www.w3.org/1999/02/22-rdf-syntax-ns#",S="http://purl.org/rss/1.0/",D="http://channel.netscape.com/rdf/simple/0.9/",x="http://purl.org/dc/elements/1.1/";function L(e,t=!1){let n="";const i=new XMLSerializer;e=e.cloneNode(!0);const s=document.createTreeWalker(e,NodeFilter.SHOW_CDATA_SECTION);for(;s.nextNode();)s.currentNode.parentNode?.replaceChild(s.currentNode.ownerDocument.createTextNode(s.currentNode.nodeValue),s.currentNode);if(t)for(let t=0;t<e.childNodes.length;t++)n+=i.serializeToString(e.childNodes[t]);else n=i.serializeToString(e).replace(/^<[^>]+>|<[^>]+>$/g,"");return n}function R(e,t,n){if(1===t.length)return e.getElementsByTagNameNS(t[0],n);const i=e.getElementsByTagName("*"),s=[];for(let e=0;e<i.length;e++)i[e].localName===n&&-1!==t.indexOf(i[e].namespaceURI)&&(s[s.length]=i[e]);return s}function B(e,t){const s=k(N(e,ne,"type"),"");if(e.children.length){if(e.children.length>1||e.children[0]!==(e.getElementsByTagNameNS(w,"div")[0]||e.getElementsByTagNameNS(e.namespaceURI??null,"div")[0])||function(e){for(let t=0;t<e.childNodes.length;t++)if(e.childNodes[t].nodeType===Node.TEXT_NODE&&e.childNodes[t].nodeValue.replace(/^\s+|\s+$/g,"")||e.childNodes[t].nodeType===Node.CDATA_SECTION_NODE)return!0;return!1}(e)){return L((0,a.n)(e,M("",e,n)))}return L((0,a.n)(e.children[0],M("",e.children[0],n)),e.children[0].namespaceURI===w)}if("html"===s||"text/html"===s||"xhtml"===s||/^application\/.*\+xml$/.test(s))return(0,a.A)(C(_(e)),M("",e,n));if(s&&"text"!==s&&!/^text\/plain$/.test(s)&&/^[\-\w]+\/[\-\w\+]+$/.test(s)){if(t){const n=new u;n.url="data:"+s+";base64,"+C(_(e)).replace(/\s+/g,""),n.mimetype=s,V(n,t)}return""}return(0,i.Z)(I(A(_(e))))}function F(e){if(e.children.length){return L((0,a.n)(e,M("",e,n)))}return Z(_(e),e,n)}function W(e){const t=new d;if(e.children.length){for(let i,s,o=0;o<e.children.length;o++)if(i=e.children[o],s=E(i.localName),-1!==ne.indexOf(i.namespaceURI))switch(s){case"url":{const e=C(_(i));e&&(t.url=M(e,i,n))}break;case"link":case"feedlink":{const e=C(_(i));e&&(t.link=M(e,i,n))}break;case"title":case"feedtitle":t.title=C(_(i));break;case"description":t.description=C(_(i));break;case"width":t.width=C(_(i));break;case"height":t.height=C(_(i))}}else{const i=C(_(e));i&&(t.url=M(i,e,n))}return t}function U(e){const t=[];if(e.links.enclosure.forEach((e=>{e instanceof u&&e.url&&(e.mimetype&&e.mimetype.match(/^image\//i)||!e.mimetype&&e.url.match(/\.(jpg|jpeg|jfif|gif|png|webp|bmp|svg|avif)($|\?)/i))&&t.push(e.url)})),!e.htmlbody)return t;return[...(new DOMParser).parseFromString(e.htmlbody,"text/html").getElementsByTagName("img")].forEach((e=>{if(e.hasAttribute("src")){const n=e.getAttribute("width");if(n&&n.match(/^\s*\d/)&&e.width<20)return;const i=e.getAttribute("height");if(i&&i.match(/^\s*\d/)&&e.height<20)return;t.push(e.src)}})),t}function V(e,t){const n=t.find((t=>t.url===e.url&&t.title===e.title&&t.hreflang===e.hreflang));n?(!n.mimetype&&e.mimetype&&(n.mimetype=e.mimetype),!n.bytelength&&e.bytelength&&(n.bytelength=e.bytelength)):t[t.length]=e}function H(e,t){let i,s;if("enclosure"===e.localName||"comments"===e.localName||"docs"===e.localName?i=e.localName:"source"===e.localName||"feedsource"===e.localName?i="via":"relation"===e.localName?i="related":(i=k(N(e,ne,"rel"),"alternate"),i=i.replace(/\W/g,"")),"source"!==e.localName&&"feedsource"!==e.localName&&e.childNodes.length?s=C(_(e)):P(e,ne,"href")?s=C(N(e,ne,"href")):P(e,ne,"url")?s=C(N(e,ne,"url")):e.namespaceURI===x&&(s=C(_(e))),s&&i&&t.links.hasOwnProperty(i)){const o=new u;switch(o.url=M(s,e,n),"source"===e.localName||"feedsource"===e.localName?o.title=C(_(e)):o.title=C(N(e,ne,"title")),o.mimetype=C(N(e,ne,"type")),o.hreflang=C(N(e,ne,"hreflang")),o.bytelength=C(N(e,ne,"length")),i){case"alternate":V(o,t.links.alternate);break;case"comments":V(o,t.links.comments);break;case"docs":V(o,t.links.docs);break;case"enclosure":V(o,t.links.enclosure);break;case"next":V(o,t.links.next);break;case"prev":V(o,t.links.prev);break;case"related":V(o,t.links.related);break;case"self":V(o,t.links.self);break;case"serviceedit":V(o,t.links.serviceedit);break;case"servicepost":V(o,t.links.servicepost);break;case"via":V(o,t.links.via)}}}function G(e){const t=new p,n=C(_(e));return n.length?(t.label=t.term=n,t.scheme=C(N(e,ne,"domain"))):(t.term=C(N(e,ne,"term")),t.label=C(N(e,ne,"label")||t.term),t.scheme=C(N(e,ne,"scheme"))),t}function $(e){const t=new m;t.name=C(_(e));const i=C(N(e,ne,"uri"));return i&&(t.url=M(i,e,n)),t.version=C(N(e,ne,"version")),t}function K(e){let t;if(e.children.length){t=new g;for(let i,s,o=0;o<e.children.length;o++)if(i=e.children[o],s=E(i.localName),-1!==ne.indexOf(i.namespaceURI)){if("name"===s)t.name=C(_(i));else if("email"===s)t.email=C(_(i));else if("uri"===s){const e=C(_(i));e&&(t.url=M(e,i,n))}}else if("http://xmlns.com/foaf/0.1"===i.namespaceURI)if("name"===s)t.name=C(_(i));else if("homepage"===s){const e=C(i.getAttributeNS(b,"resource"));e&&(t.url=M(e,i,n))}else"mbox"===s&&(t.email=C(i.getAttributeNS(b,"resource")).replace(/^[a-z]+:/i,""))}else{const n=C(_(e));(0,o.HZ)(n)?(t=new g,t.email=n):t=z(null,n)}return t}function z(e,t=""){const n=new g,i=e?_(e):t;n.name=C(i.replace(/[\s<(]*(mailto\s*:\s*)?[^\s<>():,@]+@[^\s<>():,@]+[\s>)]*/i," ")).replace(O,"");const s=i.match(/[^\s<>():,@]+@[^\s<>():,@]+/);return s&&(n.email=s[0].replace(/^"([^\"]*)"$/,"$1")),n}function j(e){const t=new f;return t.domain=C(N(e,ne,"domain")),t.port=C(N(e,ne,"port")),t.path=C(N(e,ne,"path")),t.registerprocedure=C(N(e,ne,"registerProcedure"))||C(N(e,ne,"registerprocedure")),t.protocol=C(N(e,ne,"protocol")),t}function Y(e){const t=new v;for(let i,s,o=0;o<e.children.length;o++)if(i=e.children[o],s=E(i.localName),-1!==ne.indexOf(i.namespaceURI))if("description"===s)t.htmldescription=F(i);else if("title"===s||"feedtitle"===s)t.title=C(_(i));else if("name"===s)t.name=C(_(i));else if("link"===s||"feedlink"===s){const e=C(_(i));e&&(t.link=M(e,i,n))}return t}function X(e,t){for(let n=0;n<e.children.length;n++){const i=e.children[n];if(-1!==ne.indexOf(i.namespaceURI)&&"day"===E(i.localName)){const e=C(_(i)).toLowerCase();if(t.hasOwnProperty(e))switch(e){case"sunday":t.sunday=!0;break;case"monday":t.monday=!0;break;case"tuesday":t.tuesday=!0;break;case"wednesday":t.wednesday=!0;break;case"thursday":t.thursday=!0;break;case"friday":t.friday=!0;break;case"saturday":t.saturday=!0}}}}function Q(e,t){for(let n=0;n<e.children.length;n++){const i=e.children[n];if(-1!==ne.indexOf(i.namespaceURI)&&"hour"===E(i.localName)){const e=C(_(i)).toLowerCase();/^\d+$/.test(e)&&1*Number(e).valueOf()<24&&1*Number(e).valueOf()>=0&&(t[e]=!0)}}}function q(e){const t=new XMLSerializer;let i=t.serializeToString(e);const s=/^([^>]+)\sxmlns="http:\/\/www.w3.org\/1999\/xhtml"/;if(ee&&(i=i.replace(/<(\/?)feed(source|link|image|title)\b/g,"<$1$2"),i=i.replace(s,"$1")),!ie.contains(e)){let e=t.serializeToString(ie.cloneNode(!1));ee&&(e=e.replace(s,"$1")),i=`${e}${i}`}for(;e&&e.parentElement&&e.parentNode!==c;){const o=(e=e.parentElement)?.cloneNode(!1),a=M("",e,n);o.setAttribute("xml:base",a),ee&&e!==ie&&e!==h&&e.hasAttribute("xmlns")&&o.removeAttribute("xmlns");let r=t.serializeToString(o);r=r.replace(/^<([\w\-:]+)\b([^>]*)\/>$/,"<$1$2></$1>"),ee&&(r=r.replace(s,"$1"));const[l,d]=r.split("></");i=l+">"+i+"</"+d}return i}function J(e){const t=new r;for(let n,i,s=0;s<e.children.length;s++)if(n=e.children[s],i=E(n.localName),-1!==ne.indexOf(n.namespaceURI))"id"===i?t.id=C(_(n)):"image"===i||"feedimage"===i?n.children.length&&(t.image=W(n)):"logo"===i?t.image=W(n):"icon"===i?t.icon=W(n):"generator"===i?t.generator=$(n):"title"===i||"feedtitle"===i?("channel"===e.localName?t.htmltitle=F(n):t.htmltitle=B(n),t.plaintitle=T(t.htmltitle)):"rights"===i?t.htmlrights=B(n):"subtitle"===i?t.htmldescription=B(n):"copyright"===i?t.htmlrights=F(n):"description"===i?t.htmldescription=F(n):"updated"===i?t.updated=C(_(n)):"lastbuilddate"===i?t.lastbuilddate=C(_(n)):"pubdate"===i?t.pubdate=C(_(n)):"rating"===i?t.rating=C(_(n)):"language"===i?t.language=C(_(n)):"ttl"===i?t.ttl=C(_(n)):"category"===i?t.category[t.category.length]=G(n):"link"===i||"feedlink"===i||"docs"===i?H(n,t):"cloud"===i?t.cloud[t.cloud.length]=j(n):"author"===i?t.people.author[t.people.author.length]=K(n):"contributor"===i?t.people.contributor[t.people.contributor.length]=K(n):"managingeditor"===i?t.people.managingeditor[t.people.managingeditor.length]=K(n):"webmaster"===i?t.people.webmaster[t.people.webmaster.length]=K(n):"textinput"===i?n.children.length&&(t.textinput[t.textinput.length]=Y(n)):"skipdays"===i?X(n,t.skipdays):"skiphours"===i&&Q(n,t.skiphours);else if("http://purl.org/rss/1.0/modules/syndication/"===n.namespaceURI)if("updateperiod"===i){const e=C(_(n)).toLowerCase();t.updateperiod=e}else"updatefrequency"===i&&(t.updatefrequency=C(_(n)).toLowerCase());else n.namespaceURI===x&&("title"===i?(t.htmltitle=F(n),t.plaintitle=T(t.htmltitle)):"description"===i?t.htmldescription=F(n):"date"===i?t.pubdate=C(_(n)):"language"===i?t.language=C(_(n)):"rights"===i?t.htmlrights=F(n):"subject"===i?t.category[t.category.length]=G(n):"source"===i||"relation"===i?H(n,t):"publisher"===i?t.people.managingeditor[t.people.managingeditor.length]=z(n):"creator"===i?t.people.author[t.people.author.length]=z(n):"contributor"===i&&(t.people.contributor[t.people.contributor.length]=z(n)));if(!t.language){const n=E(e.localName);"source"===n||"feedsource"===n?e.hasAttribute("xml:lang")&&(t.language=C(e.getAttribute("xml:lang"))):h?.hasAttribute("xml:lang")&&(t.language=C(h?.getAttribute("xml:lang")))}if(t.publishdate=t.pubdate||t.updated||t.lastbuilddate,t.updatedate=t.lastbuilddate||t.updated||t.pubdate,"number"==typeof t.ttl||"string"==typeof t.ttl&&/^\d+$/.test(t.ttl))t.ttl=parseInt(t.ttl)||"";else if(t.updateperiod||t.updatefrequency){let e;e=/^\d+$/.test(t.updatefrequency)&&parseInt(t.updatefrequency)||1;const n={hourly:60,daily:1440,weekly:10080,monthly:306600,yearly:3679200};if(n.hasOwnProperty(t.updateperiod)){let i;switch(t.updateperiod){case"hourly":i=n.hourly;break;case"daily":i=n.daily;break;case"weekly":i=n.weekly;break;case"monthly":i=n.monthly;break;case"yearly":i=n.yearly;break;default:i=0}t.ttl=Math.round(i/e)}else t.ttl=Math.round(n.daily/e)}else t.ttl="";return t}let ee=!1,te="";if(!c||c.getElementsByTagNameNS(w,"parsererror").length){if(t&&/^\w*</.test(t)&&(t.match(/<[\w\-:]+[^>]*>/g)||[]).length>3&&(t.match(/<\/[\w\-:]+>/g)||[]).length>3){for(;/<(source|link|image|title)\b(([^\/>]|\/[^>])*>[^<]*((?!<\1\b([^\/>]|\/[^>])*>)<[^<]*)*?)<\/\1>/i.test(t);)t=t.replace(/<(source|link|image|title)\b(([^\/>]|\/[^>])*>[^<]*((?!<\1\b([^\/>]|\/[^>])*>)<[^<]*)*?)<\/\1>/gi,"<feed$1$2</feed$1>");const e=(t=t.replace(/<(\w+:link|\w+:category|category|\w+:cloud|cloud|\w+:enclosure|enclosure|\w+:thumbnail|thumbnail)\b([^>]*)\/>/gi,"<$1$2></$1>")).substring(0,1024).match(/\bxmlns:(\w+)\s*=\s*['"]http:\/\/purl\.org\/rss\/1.0\/modules\/content\/['"]/);e&&(te=e[1]+":encoded"),t="<!doctype html><html><head><title></title></head><body>"+(t=t.replace(/<!\[CDATA\[([\w\W]*?)\]\]>/gi,((e,t)=>I(t))))+"</body></html>",c=(new DOMParser).parseFromString(t,"text/html"),ee=!0}if(!c||c.getElementsByTagNameNS(w,"parsererror").length)return"NoDocumentNode";c.body instanceof HTMLBodyElement&&(c=c.body,h=c.children[0])}if(!h)return"NoDocumentElement";const ne=void 0!==h?.namespaceURI?[h.namespaceURI]:[];let ie;if(ne[0]||"feed"!==h.localName?ne[0]===b&&(ne[1]=S,ne[2]=D):ne[1]=y,ie="feed"===h.localName?h:R(h,ne,"channel")[0],!ie)return"NoChannelElement";-1===ne.indexOf(y)&&ne.unshift(y),-1===ne.indexOf(S)&&ne.unshift(S),-1===ne.indexOf(D)&&ne.unshift(D);const se=J(ie);if(se.haserrors=ee,h!==ie&&h.children.length>1)for(let e,t,n=0;n<h.children.length;n++)e=h.children[n],t=E(e.localName),-1!==ne.indexOf(e.namespaceURI)&&("image"===t||"feedimage"===t?se.image=W(e):"textinput"===t&&(se.textinput[se.textinput.length]=Y(e)));let oe;oe="feed"===ie.localName?R(c,ne,"entry"):R(c,ne,"item");for(let e=0;e<oe.length;e++){let t=!1;se.feeditems[e]=new l;for(let n=0;n<oe[e].children.length;n++){const o=oe[e].children[n],a=E(o.localName);if(-1!==ne.indexOf(o.namespaceURI))if("link"===a||"feedlink"===a||"enclosure"===a||"comments"===a)H(o,se.feeditems[e]);else if("title"===a||"feedtitle"===a)"item"===o.parentElement?.localName?se.feeditems[e].htmltitle=F(o):se.feeditems[e].htmltitle=B(o),se.feeditems[e].plaintitle=T(se.feeditems[e].htmltitle);else if("summary"===a)se.feeditems[e].htmlsummary=B(o);else if("rights"===a)se.feeditems[e].htmlrights=B(o);else if("content"===a)se.feeditems[e].htmlcontent=B(o,se.feeditems[e].links.enclosure);else if("description"===a)t?se.feeditems[e].htmlsummary=F(o):se.feeditems[e].htmldescription=F(o);else if("author"===a)se.feeditems[e].people.author[se.feeditems[e].people.author.length]=K(o);else if("contributor"===a)se.feeditems[e].people.contributor[se.feeditems[e].people.contributor.length]=K(o);else if("category"===a)se.feeditems[e].category[se.feeditems[e].category.length]=G(o);else if("id"===a||"published"===a||"created"===a||"issued"===a||"updated"===a||"modified"===a||"pubdate"===a)switch(a){case"id":se.feeditems[e].id=C(_(o));break;case"published":case"created":case"issued":se.feeditems[e].published=C(_(o));break;case"updated":case"modified":se.feeditems[e].updated=C(_(o));break;case"pubdate":se.feeditems[e].pubdate=C(_(o))}else"guid"===a?(se.feeditems[e].id=C(_(o)),"false"!==k(N(o,ne,"isPermaLink"),"")&&"false"!==k(N(o,ne,"ispermalink"),"")&&H(o,se.feeditems[e])):"source"===a||"feedsource"===a?"item"===o.parentElement?.localName?H(o,se.feeditems[e]):se.feeditems[e].source=J(o):a===te&&(t||se.feeditems[e].htmlsummary||(se.feeditems[e].htmlsummary=se.feeditems[e].htmldescription),t=!0,se.feeditems[e].htmldescription=_(o));else if(o.namespaceURI===x)"title"===a?(se.feeditems[e].htmltitle=F(o),se.feeditems[e].plaintitle=T(se.feeditems[e].htmltitle)):"description"===a?se.feeditems[e].htmldescription=F(o):"date"===a?se.feeditems[e].pubdate=C(_(o)):"rights"===a?se.feeditems[e].htmlrights=F(o):"subject"===a?se.feeditems[e].category[se.feeditems[e].category.length]=G(o):"identifier"===a?(se.feeditems[e].id||(se.feeditems[e].id=C(_(o))),H(o,se.feeditems[e])):"source"===a||"relation"===a?H(o,se.feeditems[e]):"publisher"===a||"creator"===a?se.feeditems[e].people.author[se.feeditems[e].people.author.length]=z(o):"contributor"===a&&(se.feeditems[e].people.contributor[se.feeditems[e].people.contributor.length]=z(o));else if("http://purl.org/rss/1.0/modules/content/"===o.namespaceURI)"encoded"===a&&(t||se.feeditems[e].htmlsummary||(se.feeditems[e].htmlsummary=se.feeditems[e].htmldescription),t=!0,se.feeditems[e].htmldescription=_(o));else if("http://search.yahoo.com/mrss/"===o.namespaceURI)switch(a){case"group":{const t=o.getElementsByTagName("media:description")[0]?.innerHTML;if(t){const n=(0,i.Z)(t);se.feeditems[e].htmldescription+=`<div class="preformatted">${n}</div>`}const n=o.getElementsByTagName("media:thumbnail")[0];if(n){const t=new d;t.url=n.getAttribute("url")??"",t.width=n.getAttribute("width")??"",t.height=n.getAttribute("height")??"",se.feeditems[e].links.enclosure.push(t)}break}}else if("http://www.youtube.com/xml/schemas/2015"===o.namespaceURI){if("videoid"===a)se.feeditems[e].htmldescription+=(ae=o.innerHTML,`<div class="video-wrapper">${(0,s.w)(ae)}</div>`)}else if("http://www.itunes.com/dtds/podcast-1.0.dtd"===o.namespaceURI)switch(a){case"author":case"block":case"category":case"duration":case"email":case"explicit":case"keywords":case"name":case"new":case"owner":case"pubDate":case"subtitle":case"summary":case"episodetype":case"season":case"episode":case"title":break;case"image":{const t=new d;t.url=o.getAttribute("href")??"",se.feeditems[e].links.enclosure.push(t);break}}}se.feeditems[e].publishdate=se.feeditems[e].published||se.feeditems[e].pubdate||se.feeditems[e].updated,se.feeditems[e].updatedate=se.feeditems[e].updated||se.feeditems[e].pubdate||se.feeditems[e].published,se.feeditems[e].htmlbody=se.feeditems[e].htmlcontent||se.feeditems[e].htmldescription||se.feeditems[e].htmlsummary,se.feeditems[e].bodyimages=U(se.feeditems[e]),n&&(se.feeditems[e].xmloriginal=q(oe[e]))}var ae;return se}function R(e,t){function n(e,s){for(let o=0;o<e.children.length;o++){const a=e.children[o],r=E(a.localName);if(-1!==i.indexOf(a.namespaceURI)&&"outline"===r&&"true"!==k(N(a,i,"isComment"),"")){const e=new S;if(-1!==["rss","atom"].indexOf(k(N(a,i,"type"),""))&&(e.feedurl=C(N(a,i,"xmlUrl")),e.feedurl)){e.feedurl=M(e.feedurl,a,t),e.created=C(N(a,i,"created")),e.htmldescription=Z(N(a,i,"description")||"",a,t),e.language=C(N(a,i,"language")),e.pageurl=C(N(a,i,"htmlUrl"))||C(N(a,i,"url")),e.pageurl&&(e.pageurl=M(e.pageurl,a,t));const n=k(N(a,i,"version"),"");e.supported=!n||/^(rss\d*|atom\s*[\d\.]*)$/i.test(n)}if(P(a,i,"category")?e.category=C(N(a,i,"category")):e.category=s?.category??"",a.children.length&&n(a,e),e.feedurl||e.items.length){s.items[s.items.length]=e;const n=C(N(a,i,"text")),o=C(N(a,i,"title"));n&&o&&n!==o?(e.htmltitle=Z(n.length<=o.length?n:o,a,t),e.htmldescription||(e.htmldescription=Z(n.length<=o.length?o:n,a,t))):e.htmltitle=Z(n||o,a,t)||I(e.feedurl),e.plaintitle=T(e.htmltitle)}}}}const i=[null,"","http://opml.org/spec2"];if("string"!=typeof t)return"FeedURLNotString";if(!e||e.getElementsByTagNameNS(w,"parsererror").length)return"NoDocumentNode";if(!e.documentElement)return"NoDocumentElement";const{children:s}=e.documentElement,o=e.documentElement.namespaceURI;if("opml"!==e.documentElement.localName&&"outlineDocument"!==e.documentElement.localName||-1===i.indexOf(o))return"WrongDocumentElement";const a=new b;for(let e,r,l=0;l<s.length;l++)if(e=s[l],-1!==i.indexOf(o))if(r=E(e.localName),"head"===r){for(let n,s,o=0;o<e.children.length;o++)if(n=e.children[o],-1!==i.indexOf(n.namespaceURI))if(s=E(n.localName),"title"===s)a.htmltitle=Z(_(n),n,t),a.plaintitle=T(a.htmltitle);else if("ownername"===s)a.ownername=C(_(n));else if("owneremail"===s)a.owneremail=C(_(n));else if("datecreated"===s)a.publishdate=C(_(n));else if("datemodified"===s)a.updatedate=C(_(n));else if("ownerid"===s){const e=C(_(n));e&&(a.ownerurl=M(e,n,t))}}else"body"===r&&n(e,a);return a}},14022:(e,t,n)=>{"use strict";n.d(t,{Z:()=>m});var i=n(19789),s=n(29087),o=n(18237),a=n(56371),r=n(30381),l=n.n(r),d=n(1407),c=n(89175);const u=i.ZP.getWeekdayFormat("LL")+" LT",p={lastWeek:u,sameElse:u},h=/^\d{4}(?:-\d{2}){2}(?:_\d{2}){3}$/;function g(e){return e===o.m8||e===o.iq}const m={getLoadingWorkspaceName:function(e){const t=o.ZP.getWorkspace(e);return t?(0,a.Z)("$1 (session)",[t.name]):(0,a.Z)("Session workspace")},getTooltipString:function(e){if(o.ZP.isTrashFolder(e.id))return(0,a.Z)("Trash");let t=e.name;return e.workspaces.length>0&&(t+="\n"+(0,a.Z)("with Workspaces:")),e.workspaces.forEach((e=>{t+=d.YV+e.name})),t},getNameString:function(e){if(o.ZP.isTrashFolder(e.id))return(0,a.Z)("Trash");if(h.test(e.name)){const t=e.name.substring(0,10)+" "+e.name.substring(11,19).split("_").join(":");return l()(t).format("LLL")}return e.name},getContentString:function(e){if(o.ZP.isTrashFolder(e.id))return"";if(e.tabs-e.quarantined>0){const t=0===e.quarantined?(0,a.Z)("$1 tab","$1 tabs",[e.tabs-e.quarantined]):(0,a.Z)("$1 tab (of $2)","$1 tabs (of $2)",[e.tabs-e.quarantined,e.tabs]),n=(0,a.Z)("$1 window","$1 windows",[e.windows]);if(0===e.workspaces.length)return(0,a.Z)("$1 in $2",[t,n]);{const i=(0,a.Z)("$1 workspace","$1 workspaces",[e.workspaces.length]);return(0,a.Z)("$1, $2 in $3",[t,i,n])}}return(0,a.Z)("All tabs are quarantined")},getDateCreateString:function(e){return o.ZP.isTrashFolder(e.id)?"":s.Z.get(c.kCalendarRelativeDates)?l()(e.createDateJS).calendar(null,p):l()(e.createDateJS).format(u)},getDateModifyString:function(e){return o.ZP.isTrashFolder(e.id)?"":s.Z.get(c.kCalendarRelativeDates)?l()(e.modifyDateJS).calendar(null,p):l()(e.modifyDateJS).format(u)},getSessionData:function(e){for(const t of e.dataTransfer.types)if(g(t))return JSON.parse(e.dataTransfer.getData(t));return[]},isSessionType:g}},66777:(e,t,n)=>{"use strict";n.d(t,{C:()=>l,j:()=>d});n(67294);var i,s=n(60203),o=n(94184),a=n.n(o);function r(e,t,n,s){i||(i="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=s;else if(a>1){for(var r=new Array(a),l=0;l<a;l++)r[l]=arguments[l+3];t.children=r}if(t&&o)for(var d in o)void 0===t[d]&&(t[d]=o[d]);else t||(t=o||{});return{$$typeof:i,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function l({children:e,text:t,className:n,label:i,leadingText:s,highlight:o}){const l=o?t.split(o.regExp).reduce(((e,t,n)=>n?e.concat([r("mark",{},n,o.matches[n-1])]).concat([t]):e.concat([t])),[]):t;return r("div",{className:a()("setting-single",n,{"setting-single--LeadingText":s})},void 0,r("label",{title:i},void 0,e,r("span",{},void 0,l)))}function d({children:e,heading:t,className:n,filter:i}){return r(s.Z,{filter:i},void 0,r("div",{className:a()("setting-group",n)},void 0,t&&r("h3",{},void 0,t),e))}},72046:(e,t,n)=>{"use strict";n.d(t,{Z:()=>f});var i,s=n(67294),o=n(90718),a=n(59322),r=n(94283),l=n(56371),d=n(67074),c=n(88594),u=n(48521);function p(e,t,n,s){i||(i="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=s;else if(a>1){for(var r=new Array(a),l=0;l<a;l++)r[l]=arguments[l+3];t.children=r}if(t&&o)for(var d in o)void 0===t[d]&&(t[d]=o[d]);else t||(t=o||{});return{$$typeof:i,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const h="https://vivaldi.com/privacy/";function g(e){return Boolean(e&&"object"==typeof e&&"string"!=typeof e.type)}class m extends s.Component{static contextType=r.Z;static defaultProps={displayPrivacyLink:!1};constructor(e){super(e),this.state={children:this.searchChildren(this.props)}}hiddenWhenFilter="";componentDidMount(){this.hideCategoryIfEmpty()}componentDidUpdate(e){this.props.filter!==e.filter?this.hiddenWhenFilter?this.shouldSearchHiddenComponent(this.hiddenWhenFilter,this.props.filter)&&this.setState({children:this.searchChildren(this.props)}):this.setState({children:this.searchChildren(this.props)}):this.props.children!==e.children&&this.setState({children:this.searchChildren(this.props)}),this.hideCategoryIfEmpty()}unfilteredChildren=e=>s.Children.map(e.children,(e=>g(e)?s.cloneElement(e,{filter:""}):e));filteredChildren=e=>s.Children.map(e.children,(t=>!t||g(t)?t:(0,d.ZP)(t,e.filter)));searchChildren=e=>{if(!e.filter)return s.Children.map(e.children,(e=>e));return(0,d.zR)(e.categoryTitle,e.filter)?this.unfilteredChildren(e):this.filteredChildren(e)};shouldSearchHiddenComponent=(e,t)=>!t||e.length>=t.length||e!==t.slice(0,e.length);hideCategoryIfEmpty=()=>{this.root&&(1===this.root.children.length||!0===this.props.displayPrivacyLink&&2===this.root.children.length?(this.root.style.display="none",this.hiddenWhenFilter=this.props.filter):(this.root.style.removeProperty("display"),this.hiddenWhenFilter=""))};openPrivacyPage=()=>{a.ZP.openURL(this.context.vivaldiWindowId,h)};render(){const e=this.props.categoryTitle&&p("h2",{},void 0,this.props.categoryTitle),t=(0,d.ZP)(e,this.props.filter)||e,n=(0,c.Z)(this.props,["filter","categoryTitle","displayPrivacyLink"]);return(0,u.jsxs)("div",{ref:e=>e?this.root=e:null,...n,children:[t,e&&!0===this.props.displayPrivacyLink&&p("div",{className:"privacy-link"},void 0,p(o.Z,{title:h,onClick:this.openPrivacyPage},void 0,(0,l.Z)("Learn more about Privacy in Vivaldi"))),this.state.children]})}}const f=m},60203:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var i,s=n(67294),o=n(67074);function a(e,t,n,s){i||(i="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=s;else if(a>1){for(var r=new Array(a),l=0;l<a;l++)r[l]=arguments[l+3];t.children=r}if(t&&o)for(var d in o)void 0===t[d]&&(t[d]=o[d]);else t||(t=o||{});return{$$typeof:i,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class r extends s.PureComponent{render(){const{children:e,filter:t}=this.props;return t?Array.isArray(e)?e.map(((e,n)=>a(s.Fragment,{},n,(0,o.ZP)(e,t)))):(0,o.ZP)(e,t):e}}const l=r},37182:(e,t,n)=>{"use strict";n.d(t,{TP:()=>V,ZP:()=>ne,FI:()=>W});var i,s=n(67294),o=n(56371),a=n(94184),r=n.n(a),l=n(88594),d=n(48521);function c(e,t,n,s){i||(i="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=s;else if(a>1){for(var r=new Array(a),l=0;l<a;l++)r[l]=arguments[l+3];t.children=r}if(t&&o)for(var d in o)void 0===t[d]&&(t[d]=o[d]);else t||(t=o||{});return{$$typeof:i,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const u={auto:(0,o.Z)("theme","Auto"),light:(0,o.Z)("theme","Light"),dark:(0,o.Z)("theme","Dark")};var p=c("svg",{width:"97",height:"76",viewBox:"0 0 97 76",xmlns:"http://www.w3.org/2000/svg",className:"tab-preview"},void 0,c("rect",{width:"48",height:"76",className:"website-appearance-preview background-color"}),c("rect",{x:"48",width:"49",height:"76",className:"website-appearance-preview foreground-color"}),c("path",{d:"M48 9H77C77.5523 9 78 9.44772 78 10V16C78 16.5523 77.5523 17 77 17H48V9Z",className:"website-appearance-preview background-color"}),c("path",{d:"M8 10C8 9.44772 8.44772 9 9 9H48V17H9C8.44771 17 8 16.5523 8 16V10Z",className:"website-appearance-preview foreground-color"}),c("g",{opacity:"0.3"},void 0,c("path",{d:"M48 25H9C8.44772 25 8 25.4477 8 26V27C8 27.5523 8.44771 28 9 28H48V25Z",className:"website-appearance-preview foreground-color"}),c("path",{d:"M48 31H9C8.44772 31 8 31.4477 8 32V33C8 33.5523 8.44771 34 9 34H48V31Z",className:"website-appearance-preview foreground-color"}),c("path",{d:"M48 37H9C8.44772 37 8 37.4477 8 38V39C8 39.5523 8.44771 40 9 40H48V37Z",className:"website-appearance-preview foreground-color"}),c("path",{d:"M48 43H9C8.44772 43 8 43.4477 8 44V45C8 45.5523 8.44771 46 9 46H48V43Z",className:"website-appearance-preview foreground-color"}),c("path",{d:"M48 55H9C8.44772 55 8 55.4477 8 56V57C8 57.5523 8.44771 58 9 58H48V55Z",className:"website-appearance-preview foreground-color"}),c("path",{d:"M8 62C8 61.4477 8.44772 61 9 61H29C29.5523 61 30 61.4477 30 62V63C30 63.5523 29.5523 64 29 64H9C8.44772 64 8 63.5523 8 63V62Z",className:"website-appearance-preview foreground-color"})),c("g",{opacity:"0.3"},void 0,c("path",{d:"M48 58H74C74.5523 58 75 57.5523 75 57V56C75 55.4477 74.5523 55 74 55H48V58Z",className:"website-appearance-preview background-color"}),c("path",{d:"M48 46H60C60.5523 46 61 45.5523 61 45V44C61 43.4477 60.5523 43 60 43H48V46Z",className:"website-appearance-preview background-color"}),c("path",{d:"M48 40H60C60.5523 40 61 39.5523 61 39V38C61 37.4477 60.5523 37 60 37H48V40Z",className:"website-appearance-preview background-color"}),c("path",{d:"M48 34H60C60.5523 34 61 33.5523 61 33V32C61 31.4477 60.5523 31 60 31H48V34Z",className:"website-appearance-preview background-color"}),c("path",{d:"M48 28H74C74.5523 28 75 27.5523 75 27V26C75 25.4477 74.5523 25 74 25H48V28Z",className:"website-appearance-preview background-color"}))),h=c("svg",{width:"97",height:"76",viewBox:"0 0 97 76",xmlns:"http://www.w3.org/2000/svg",className:"tab-preview"},void 0,c("rect",{width:"97",height:"76",className:"website-appearance-preview foreground-color"}),c("g",{opacity:"0.3"},void 0,c("path",{d:"M9 25C8.44772 25 8 25.4477 8 26V27C8 27.5523 8.44771 28 9 28H74C74.5523 28 75 27.5523 75 27V26C75 25.4477 74.5523 25 74 25H9Z",className:"website-appearance-preview background-color"}),c("path",{d:"M9 55C8.44772 55 8 55.4477 8 56V57C8 57.5523 8.44771 58 9 58H74C74.5523 58 75 57.5523 75 57V56C75 55.4477 74.5523 55 74 55H9Z",className:"website-appearance-preview background-color"}),c("path",{d:"M8 32C8 31.4477 8.44772 31 9 31H60C60.5523 31 61 31.4477 61 32V33C61 33.5523 60.5523 34 60 34H9C8.44771 34 8 33.5523 8 33V32Z",className:"website-appearance-preview background-color"}),c("path",{d:"M9 61C8.44772 61 8 61.4477 8 62V63C8 63.5523 8.44772 64 9 64H41C41.5523 64 42 63.5523 42 63V62C42 61.4477 41.5523 61 41 61H9Z",className:"website-appearance-preview background-color"}),c("path",{d:"M8 44C8 43.4477 8.44772 43 9 43H60C60.5523 43 61 43.4477 61 44V45C61 45.5523 60.5523 46 60 46H9C8.44771 46 8 45.5523 8 45V44Z",className:"website-appearance-preview background-color"}),c("path",{d:"M9 37C8.44772 37 8 37.4477 8 38V39C8 39.5523 8.44771 40 9 40H60C60.5523 40 61 39.5523 61 39V38C61 37.4477 60.5523 37 60 37H9Z",className:"website-appearance-preview background-color"})),c("rect",{x:"8",y:"9",width:"70",height:"8",rx:"1",className:"website-appearance-preview background-color"})),g=c("svg",{width:"97",height:"76",viewBox:"0 0 97 76",xmlns:"http://www.w3.org/2000/svg",className:"tab-preview"},void 0,c("rect",{width:"97",height:"76",className:"website-appearance-preview background-color"}),c("g",{opacity:"0.3"},void 0,c("path",{d:"M9 25C8.44772 25 8 25.4477 8 26V27C8 27.5523 8.44771 28 9 28H74C74.5523 28 75 27.5523 75 27V26C75 25.4477 74.5523 25 74 25H9Z",className:"website-appearance-preview foreground-color"}),c("path",{d:"M9 55C8.44772 55 8 55.4477 8 56V57C8 57.5523 8.44771 58 9 58H74C74.5523 58 75 57.5523 75 57V56C75 55.4477 74.5523 55 74 55H9Z",className:"website-appearance-preview foreground-color"}),c("path",{d:"M8 32C8 31.4477 8.44772 31 9 31H60C60.5523 31 61 31.4477 61 32V33C61 33.5523 60.5523 34 60 34H9C8.44771 34 8 33.5523 8 33V32Z",className:"website-appearance-preview foreground-color"}),c("path",{d:"M9 61C8.44772 61 8 61.4477 8 62V63C8 63.5523 8.44772 64 9 64H41C41.5523 64 42 63.5523 42 63V62C42 61.4477 41.5523 61 41 61H9Z",className:"website-appearance-preview foreground-color"}),c("path",{d:"M8 44C8 43.4477 8.44772 43 9 43H60C60.5523 43 61 43.4477 61 44V45C61 45.5523 60.5523 46 60 46H9C8.44771 46 8 45.5523 8 45V44Z",className:"website-appearance-preview foreground-color"}),c("path",{d:"M9 37C8.44772 37 8 37.4477 8 38V39C8 39.5523 8.44771 40 9 40H60C60.5523 40 61 39.5523 61 39V38C61 37.4477 60.5523 37 60 37H9Z",className:"website-appearance-preview foreground-color"})),c("rect",{x:"8",y:"9",width:"70",height:"8",rx:"1",className:"website-appearance-preview foreground-color"})),m=c("svg",{xmlns:"http://www.w3.org/2000/svg",className:"selectbox-checkmark",viewBox:"0 0 15 16"},void 0,c("path",{d:"M5.3 13.3L1.5 9.5 3 8l2.3 2.5L13 2.7 14.6 4l-8 8z"}));class f extends s.Component{render(){if(!this.props.preference)return null;const e=this.props.preference,t=u[this.props.preference],n=r()({selectbox:!0,"selectbox-selected":this.props.selected}),i=(0,l.Z)(this.props,["preference","vivaldiSettings"]);return(0,d.jsxs)("button",{className:n,title:t,...i,children:[c("div",{className:"selectbox-image"},void 0,"auto"===e&&p,"light"===e&&h,"dark"===e&&g,m),c("div",{className:"selectbox-title"},void 0,t)]})}}const v=f;var y,b=n(64473),S=n(68247),w=n(4949),C=n(72046),A=n(60331),I=n(22303),T=n(37646),Z=n(47825),E=n(71828),k=n(34155);function _(e,t,n,i){y||(y="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:y,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}class N extends s.PureComponent{state={zoom:Z.Z.getUIZoom()};componentDidMount(){Z.Z.addListener(this._onZoomStoreChanged)}componentWillUnmount(){Z.Z.removeListener(this._onZoomStoreChanged)}_onZoomStoreChanged=()=>{this.setState({zoom:Z.Z.getUIZoom()})};setZoomLevel=(e,t)=>{t?this.setState({zoom:e}):I.Z.setUIZoom(e),k.nextTick((()=>{this.props.onUIZoomUpdate()}))};render(){const{zoom:e}=this.state;return _(T.Z,{inFooter:!1,zoom:e,defaultZoomLevel:E.an,scrolling:!1,maxLevel:E.OK,minLevel:E.bI,step:E.Wp,delay:!0,onZoomUpdated:this.setZoomLevel},"zoomslider")}}const P=N;var D,M=n(16716),O=n(94283),x=n(14507),L=n(7064),R=n(89175);function B(e,t,n,i){D||(D="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:D,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const F={width:400,minWidth:"unset"},W=[R.kAppearanceCssUiModsDirectory,R.kAppearanceDensity,R.kAppearanceDisableTitleBar,R.kAppearanceForceDarkModeTheme,R.kAppearanceRangeButtons,R.kMenuCompact,R.kPopupsShowInTab,R.kTabsBarPosition,R.kSettingsInTab,R.kSettingsMonoIcons,R.kStatusBarDisplay,R.kStatusBarMinimized,R.kThemeDimBlurred,R.kThemeSimpleScrollbar,R.kThemeUseAnimation,R.kVivaldiPreferredColorScheme,R.kWindowsLinuxAltControls,R.kWindowsUseNativeDecoration],U=S.Z.getEventHandler,V={auto:0,light:1,dark:2};function H(){S.Z.set(R.kVivaldiPreferredColorScheme,V.auto)}function G(){S.Z.set(R.kVivaldiPreferredColorScheme,V.light)}function $(){S.Z.set(R.kVivaldiPreferredColorScheme,V.dark)}var K=B("br",{}),z=B("input",{type:"radio",value:"on"}),j=B("input",{type:"radio",value:"overlay"}),Y=B("input",{type:"radio",value:"off"}),X=B("input",{type:"radio",value:"true"}),Q=B("input",{type:"radio",value:"false"}),q=B("br",{}),J=B("br",{}),ee=B("br",{});function te(e){const t=s.useContext(O.Z),n=(0,x.Z)(W),i=s.createRef(),[a,r]=s.useState(n[R.kAppearanceCssUiModsDirectory]),[l,c]=s.useState(!1),u=e=>{const{value:n}=e.target;S.Z.set(R.kStatusBarDisplay,n),"on"!==n&&(S.Z.set(R.kStatusBarMinimized,n),"overlay"===n&&A.Z.setStatus(t.vivaldiWindowId,(0,o.Z)("Status Info set to Overlay"),2e3))},p=()=>{c(!0)},h=()=>{c(!1)},g=()=>{c(!1),S.Z.reset(R.kToolbarsNavigation),S.Z.reset(R.kToolbarsPanel),S.Z.reset(R.kToolbarsStatus),S.Z.reset(R.kToolbarsMail),S.Z.reset(R.kToolbarsMailComposer),S.Z.reset(R.kToolbarsMailMessage)};var m=B("div",{className:"toolbar toolbar-default"},void 0,B(P,{onUIZoomUpdate:()=>{const e=i.current,{Element:n}=t;e instanceof n&&e.scrollIntoViewIfNeeded()}}));const f=()=>{L.Z.utilities.selectFile({windowId:t.vivaldiWindowId,title:(0,o.Z)("Select Folder for CSS UI Mods"),type:"folder"}).then((e=>{e&&(r(e),S.Z.set(R.kAppearanceCssUiModsDirectory,e))}))},y=e=>{r(e.target.value),S.Z.set(R.kAppearanceCssUiModsDirectory,e.target.value)};return(0,d.jsxs)(d.Fragment,{children:[B(C.Z,{categoryTitle:(0,o.Z)("Website Appearance"),filter:e.filter},void 0,function(){const e=n[R.kVivaldiPreferredColorScheme];return B("div",{className:"setting-group unlimited"},void 0,B("p",{className:"info"},void 0,(0,o.Z)("Some websites customize their color scheme according to user preferences. Choose which color scheme you would like these sites to use.")),B("div",{className:"setting-single pad-top"},void 0,B("div",{className:"selectbox-container"},void 0,B(v,{preference:"light",selected:e===V.light,onClick:G}),B(v,{preference:"dark",selected:e===V.dark,onClick:$}),B(v,{preference:"auto",selected:e===V.auto,onClick:H}))),B("div",{className:"setting-single pad-top"},void 0,B("label",{},void 0,B("input",{type:"checkbox",checked:n[R.kAppearanceForceDarkModeTheme],onChange:U(R.kAppearanceForceDarkModeTheme),disabled:e===V.light}),B("span",{},void 0,(0,o.Z)("Force a dark theme on all websites"))),B("p",{className:"info",disabled:e===V.light},void 0,(0,o.Z)("Enabling this setting may break some websites and/or images."),K,(0,o.Z)("This setting requires a restart to take full effect."))))}()),B(C.Z,{categoryTitle:(0,o.Z)("Window Appearance"),filter:e.filter},void 0,function(){const e=t.window.matchMedia("(prefers-reduced-motion: reduce)").matches;return B("div",{className:"setting-group"},void 0,B("div",{className:"setting-single"},void 0,B("label",{},void 0,B("input",{type:"checkbox",checked:n[R.kSettingsInTab],onChange:U(R.kSettingsInTab)}),B("span",{},void 0,(0,o.Z)("Open Settings in a Tab")))),B("div",{className:"setting-single"},void 0,B("label",{},void 0,B("input",{type:"checkbox",checked:n[R.kPopupsShowInTab],onChange:U(R.kPopupsShowInTab)}),B("span",{},void 0,(0,o.Z)("Open Popups in Tabs")))),B("div",{className:"setting-single pad-top"},void 0,B("label",{},void 0,B("input",{type:"checkbox",checked:n[R.kThemeUseAnimation]&&!e,onChange:U(R.kThemeUseAnimation),disabled:e}),B("span",{},void 0,(0,o.Z)("Use Animation"))),e&&B("p",{className:"info"},void 0,(0,o.Z)("Animations are disabled due to OS “Reduce Motion” accessibility setting."))),B("div",{className:"setting-single"},void 0,B("label",{},void 0,B("input",{type:"checkbox",checked:n[R.kAppearanceRangeButtons],onChange:U(R.kAppearanceRangeButtons)}),B("span",{},void 0,(0,o.Z)("Use Buttons in Range Controls")))))}(),B("div",{className:"setting-group"},void 0,B("div",{className:"setting-single"},void 0,B("label",{},void 0,B("input",{type:"checkbox",checked:n[R.kWindowsUseNativeDecoration],onChange:U(R.kWindowsUseNativeDecoration)}),B("span",{},void 0,(0,o.Z)("Use Native Window"))),B("p",{className:"info"},void 0,(0,o.Z)("This setting requires a restart to take full effect."))),B("div",{className:"setting-single"},void 0,B("label",{},void 0,B("input",{type:"checkbox",checked:!n[R.kAppearanceDisableTitleBar],onChange:U(R.kAppearanceDisableTitleBar,"inverse")}),B("span",{},void 0,(0,o.Z)("Show Title Bar"))),B("p",{className:"info"},void 0,(0,o.Z)("This setting has no effect with Tab Bar visible on top."))),B("div",{className:"setting-single"},void 0,B("label",{},void 0,B("input",{type:"checkbox",checked:n[R.kThemeDimBlurred],onChange:U(R.kThemeDimBlurred)}),B("span",{},void 0,(0,o.Z)("Fade Colors in Background Windows")))),B("div",{className:"setting-single"},void 0,B("label",{},void 0,B("input",{type:"checkbox",checked:n[R.kThemeSimpleScrollbar],onChange:U(R.kThemeSimpleScrollbar)}),B("span",{},void 0,(0,o.Z)("Use Simple Scrollbars")))),B("div",{className:"setting-single"},void 0,B("label",{},void 0,B("input",{type:"checkbox",checked:n[R.kSettingsMonoIcons],onChange:U(R.kSettingsMonoIcons)}),B("span",{},void 0,(0,o.Z)("Use Monochrome Settings Icons"))))),!1,B("div",{className:"setting-group"},void 0,B("div",{className:"setting-single"},void 0,B("h3",{},void 0,(0,o.Z)("User Interface Density")),B(w.Z,{name:"ui_density",value:n[R.kAppearanceDensity],onChange:U(R.kAppearanceDensity,"convert")},void 0,B("div",{className:"setting-single"},void 0,B("label",{},void 0,X,B("span",{},void 0,(0,o.Z)("ui_density","Regular")))),B("div",{className:"setting-single"},void 0,B("label",{},void 0,Q,B("span",{},void 0,(0,o.Z)("ui_density","Compact")))))),B("div",{className:"setting-single pad-top"},void 0,B("label",{},void 0,B("input",{type:"checkbox",checked:n[R.kMenuCompact],onChange:U(R.kMenuCompact)}),B("span",{},void 0,(0,o.Z)("Compact Menu Layout"))),B("p",{className:"info"},void 0,(0,o.Z)("This setting requires a restart to take full effect.")))),(0,d.jsx)("div",{className:"setting-group",ref:i,children:B("div",{className:"setting-single"},void 0,B("h3",{},void 0,(0,o.Z)("User Interface Zoom")),m)}),B("div",{className:"setting-group"},void 0,B("h3",{},void 0,(0,o.Z)("title","Status Bar")),B("div",{className:"setting-single"},void 0,B(w.Z,{name:"StatusBar",className:"group",value:n[R.kStatusBarDisplay],onChange:u},void 0,B("div",{className:"setting-single"},void 0,B("label",{},void 0,z,B("span",{},void 0,(0,o.Z)("verb","Show Status Bar")))),B("div",{className:"setting-single"},void 0,B("label",{},void 0,j,B("span",{},void 0,(0,o.Z)("Status Info Overlay")))),B("div",{className:"setting-single"},void 0,B("label",{},void 0,Y,B("span",{},void 0,(0,o.Z)("verb","Hide Status Bar"))))))),B("div",{className:"setting-group"},void 0,l&&B(b.Z,{style:F,onRequestClose:h,title:(0,o.Z)("Reset All Toolbars?")},void 0,B("div",{className:"dialog-restore-shortcuts"},void 0,B("div",{className:"dialog-content"},void 0,B("p",{},void 0,(0,o.Z)("All toolbars will be restored to their default layout."))),B("footer",{className:"dialog-footer"},void 0,B("input",{type:"button",className:"danger",onClick:g,value:(0,o.Z)("Reset")}),B("input",{type:"button",onClick:h,value:(0,o.Z)("Cancel"),autoFocus:!0})))),B("div",{className:"setting-single"},void 0,B("h3",{},void 0,(0,o.Z)("Toolbar Customization")),B("p",{className:"info"},void 0,(0,o.Z)("Individual toolbars may be reset or edited using the context menu.")),B("input",{type:"button",onClick:p,value:(0,o.Z)("Reset All Toolbars")})))),B(C.Z,{categoryTitle:(0,o.Z)("Custom UI Modifications"),filter:e.filter,className:"setting-group unlimited"},void 0,M.Z.isEnabled("css_mods")?B("div",{className:"setting-subgroup"},void 0,B("div",{className:"setting-single"},void 0,B("div",{className:"setting-single folder-selection"},void 0,B("input",{type:"text",value:a,title:(0,o.Z)("Enter Custom UI Modifications Path"),onChange:y}),B("input",{type:"button",value:(0,o.Z)("Select Folder..."),onClick:f})),B("p",{className:"info"},void 0,(0,o.Z)("Directory for custom CSS UI modification files."),q,(0,o.Z)("They must have a .css extension to be included."),J,(0,o.Z)("No guarantees are made that these will work in new versions of Vivaldi."),ee,(0,o.Z)("This requires a restart to apply.")))):null)]})}const ne=s.memo(te)},67074:(e,t,n)=>{"use strict";n.d(t,{CH:()=>h,ZP:()=>g,zR:()=>u});var i,s=n(67294),o=n(74117),a=n(66777);function r(e,t,n,s){i||(i="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=s;else if(a>1){for(var r=new Array(a),l=0;l<a;l++)r[l]=arguments[l+3];t.children=r}if(t&&o)for(var d in o)void 0===t[d]&&(t[d]=o[d]);else t||(t=o||{});return{$$typeof:i,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const l=new RegExp(/[‘’]/gi),d="'";const c=function(e,t){if(!e)return[!1,e];if("string"==typeof e){const n=u(e,t);return[n,n?h(e,t):e]}if(e.type===a.C){const n=u(e.props.text,t);return[n,n?h(e,t):e]}if(!("input"!==e.type&&"textarea"!==e.type||"string"!=typeof e.props.value&&"string"!=typeof e.props.defaultValue||"radio"===e.props.type||"checkbox"===e.props.type||"password"===e.props.type)){const n=u("string"==typeof e.props.value?e.props.value:e.props.defaultValue,t);return[n,n?p(e,t):e]}if("select"===e.type){let n=!1;return s.Children.forEach(e.props.children,(e=>{e?.props.children&&"string"==typeof e?.props.children&&u(e?.props.children,t)&&(n=!0)})),[n,n?p(e,t):e]}if(n=e.props?.children,Boolean(n?.forEach||Symbol.iterator in Object(n)||Object.keys(Object(n)).length)){let n=!1;const i=s.cloneElement(e,e.props,s.Children.map(e.props.children,(e=>{const[i,s]=c(e,t);return n=n||i,[n,s]})));return[n,i]}return[!1,e];var n};function u(e,t){return e.toLowerCase().replace(l,d).includes(t.toLowerCase().replace(l,d))}const p=(e,t)=>r("div",{className:"settings-text-bubble-highlight-wrapper"},void 0,e,r("mark",{className:"settings-text-bubble-highlight"},void 0,t));const h=(e,t)=>{if(!t||!e)return e;if(e.type===a.C)return function(e,t){const n=new RegExp((0,o.Z)(t),"gi"),i=e.props.text.replace(l,d).match(n)||[];return s.cloneElement(e,{highlight:{matches:i,regExp:n}})}(e,t);if("string"!=typeof e)return e;const n=new RegExp((0,o.Z)(t),"gi"),i=e.replace(l,d),c=i.match(n)||[];return r("span",{},void 0,i.split(n).reduce(((e,t,n)=>{let i=e;return n&&(i=i.concat([r("mark",{},n,c[n-1])])),i=i.concat([t]),i}),[]))};function g(e,t){if(!t)return e;const[n,i]=c(e,t);return n?i:null}},5422:(e,t,n)=>{"use strict";n.d(t,{Y:()=>j,Z:()=>oe});var i,s=n(67294),o=n(25795),a=n(69417),r=n(29087),l=n(39206),d=n(33349),c=n(56371),u=n(89175);function p(e,t,n,s){i||(i="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=s;else if(a>1){for(var r=new Array(a),l=0;l<a;l++)r[l]=arguments[l+3];t.children=r}if(t&&o)for(var d in o)void 0===t[d]&&(t[d]=o[d]);else t||(t=o||{});return{$$typeof:i,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const h=e=>{const t=t=>e.changeParameter(t.target.value,e.index);return p("div",{className:"ChainedCommand-Item--Parameter",title:(e=>{const{keyword:t}=e;if(!t)return null;const{max:n,min:i,defaultValue:s,type:o,unit:a}=t;return("number"===o||"mixed"===o?(0,c.Z)("Min: $1",[i??""])+"\n"+(0,c.Z)("Max: $1",[n??""])+"\n":"")+(0,c.Z)("Default: $1",[s])+"\n"+(0,c.Z)("Parameter Unit: $1",[a])})(e.originalCommand)},void 0,(()=>{const{command:n}=e;switch(n.name){case"COMMAND_SEARCH_SELECTION_WITH_CUSTOM_ENGINE":{const e=l.Z.get();return p("label",{className:"floating-label"},void 0,p("span",{},void 0,A.parameter),p(d.Z,{onChange:t,value:n.param},void 0,e.map((e=>{const{name:t,guid:n}=e;return p("option",{value:n},t,t)}))))}case"COMMAND_TOGGLE_INTERFACE_COLOR_BY_NAME":{const e=r.Z.get(u.kThemesSystem).concat(r.Z.get(u.kThemesUser));return p("label",{className:"floating-label"},void 0,p("span",{},void 0,A.parameter),p(d.Z,{onChange:t,value:n.param},void 0,e.map((e=>{const{name:t}=e;return p("option",{},t,t)}))))}default:return p(a.Z,{label:A.parameter,type:(i=e.command.defaultValue,"string"==typeof i?"text":"number"),placeholder:String(e.command.defaultValue),value:e.command.param,onChange:e=>t(e),draggable:"true",onDragStart:e=>e.preventDefault()})}var i})())};var g=n(92571),m=n(94283),f=n(81157),v=n(10334),y=n(47380);const b=()=>{const[e,t]=(0,s.useState)(!1);return(0,s.useEffect)((()=>(t(!0),()=>{t(!1)})),[e]),e};var S;function w(e,t,n,i){S||(S="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:S,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const C=["COMMAND_OPEN_LINK_DEFAULT","COMMAND_OPEN_LINK_CURRENT","COMMAND_OPEN_LINK_BACKGROUND"],A={name:(0,c.Z)("title","Chain Name"),emptyTitle:(0,c.Z)("Add your First Command Chain"),emptyDescription:(0,c.Z)("Press the “Add” button to the left to add a new Chain."),parameter:(0,c.Z)("chainedcommand","Command Parameter")},I="ChainedCommand-Item--Over",T="vivaldi/x-oldIndex";let Z=-1;const E=({windowId:e,chain:t,commands:n,removeFrom:i,chainOptions:o,changeParameter:r,addToChain:l,nameChange:d,name:u,shouldFocusSelector:p,moveItem:S,searchableStrings:C})=>{const A=b(),E=s.useContext(m.Z),k=e=>{(0,f.ZP)(e);const{classList:t}=e.currentTarget;t?.contains("ChainedCommand-Item")&&t.add(I)},_=e=>{(0,f.ZP)(e);const{classList:t}=e.currentTarget;t?.contains(I)&&t.remove(I)};return w("div",{className:"detail"},void 0,w("div",{className:"detail-content"},void 0,w("div",{className:"setting-group"},void 0,w("div",{className:"setting-single"},void 0,w(a.Z,{label:C.name,type:"text",value:u||"",onChange:e=>d(e.target.value)}))),w("div",{className:"ChainedCommand setting-group-unlimited",onDragOver:e=>{(0,f.ZP)(e),e.dataTransfer.dropEffect="move"}},void 0,t.map(((e,s)=>{const a=o.findIndex((t=>t.key===e.key)),d=o[a],u=n[a],m=u?{key:e.key,label:u.label,name:u.name}:void 0,v={val:d?.key,position:s+1,shouldDelete:!1},y={position:s,shouldDelete:!0},b=A&&p&&s===Z,C=`ChainedCommand-Item--${t.length}--${s}`;return w("div",{className:"ChainedCommand-Item",draggable:t.length>1,onClick:e=>e.preventDefault(),onDrop:e=>((e,t)=>{(0,f.ZP)(e);const n=e.dataTransfer.getData(T),i=parseInt(n);isNaN(i)||S(i,t),_(e)})(e,s),onDragStart:e=>((e,t)=>{e.dataTransfer.setData(T,t)})(e,s),onDragEnter:k,onDragLeave:_},C,w("div",{className:"ChainedCommand-Item--Title floating-label"},void 0,w("span",{className:"ChainedCommand-Item--Name"},void 0,`Command ${s+1}`),w(g.Z,{placeholder:(0,c.Z)("Filter Commands"),isClearable:!0,selectedCommand:m,autoFocus:b,openMenuOnFocus:!1,isMulti:!1,commands:o,setSelectedItem:e=>{Z=s+1,l({val:e.key,...y})}})),u&&void 0!==e.param&&w(h,{originalCommand:u,command:e,index:s,changeParameter:r}),w("div",{className:"ChainedCommand-Item--Controls"},void 0,w("input",{type:"button",className:"circular remove",title:(0,c.Z)("Remove Command"),disabled:1===t.length,onClick:()=>{Z=-1,i(s)}}),w("input",{type:"button",className:"circular add",title:(0,c.Z)("Add Command"),onClick:()=>{Z=s+1,l(v)}})))}))),w("input",{type:"button",value:(0,c.Z)("Test Chain"),onClick:()=>{(0,v.hT)((0,y.m)("qc",E),t)}})))};var k,_=n(76632),N=n(59322),P=n(68247),D=n(40893),M=n(60203),O=n(2699),x=n(15489),L=n(26036),R=n(14507),B=n(93196),F=n(21191),W=n(86088),U=n(93513),V=n(44850);function H(e,t,n,i){k||(k="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:k,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const G=[u.kChainedCommandsCommandList,u.kChainedCommandsDeletedCommandList],$=V.jk.settingCategories,K="https://vivaldi.com",z=(0,c.Z)("Valid URL"),j=[{name:"COMMAND_CHAINED_SLEEP",action:e=>"number"==typeof e.param?new Promise((t=>setTimeout(t,e.param))):(console.error("Parameter to action is not a number",e.param),Promise.resolve()),category:"CATEGORY_COMMAND_APPLICATION",showInQC:!1,isEnabled:()=>!0,isVisible:()=>!0,keyword:{type:"number",defaultValue:1e3,unit:(0,c.Z)("Milliseconds"),min:1,max:3e4},guid:"2eb81004-6703-46db-9933-6afcfde924e4",...(0,L.Z)("command","Delay")},{name:C[0],action:async e=>{const t="string"==typeof e.param?e.param:"";return await N.ZP.openURL(e.windowId,t,{inCurrent:!1,inBackground:!1})},category:"CATEGORY_COMMAND_APPLICATION",showInQC:!1,isEnabled:()=>!0,isVisible:()=>!0,keyword:{type:"string",defaultValue:K,unit:z},guid:"f57b8092-9426-4bc8-8e39-fcf3e315b065",...(0,L.Z)("command","Open Link in New Tab")},{name:C[1],action:async e=>{const t="string"==typeof e.param?e.param:"";return await N.ZP.openURL(e.windowId,t,{inCurrent:!0})},category:"CATEGORY_COMMAND_APPLICATION",showInQC:!1,isEnabled:()=>!0,isVisible:()=>!0,keyword:{type:"string",defaultValue:K,unit:z},guid:"0b01337b-4c13-4197-90c8-179c5c91cfff",...(0,L.Z)("command","Open Link in Current Tab")},{name:C[2],action:async e=>{const t="string"==typeof e.param?e.param:"";return await N.ZP.openURL(e.windowId,t,{inBackground:!0})},category:"CATEGORY_COMMAND_APPLICATION",showInQC:!1,isEnabled:()=>!0,isVisible:()=>!0,keyword:{type:"string",defaultValue:K,unit:z},guid:"00e0e4ad-de61-4e36-8d7e-6aead10cf1c5",...(0,L.Z)("command","Open Link in Background Tab")},{name:"COMMAND_TOGGLE_INTERFACE_COLOR_BY_NAME",action:async e=>{const t="string"==typeof e.param?e.param:"";O.Z.setThemeByNameWithFallback(t)},showInQC:!1,category:"CATEGORY_COMMAND_APPEARANCE",guid:"e12a5194-0153-439b-98f6-9dcd99ca0d7e",isEnabled:()=>!0,isVisible:()=>!0,keyword:{type:"string",unit:(0,c.Z)("Theme Name"),defaultValue:"Vivaldi"},...(0,L.Z)("Switch to Theme...")},{name:"COMMAND_SEARCH_SELECTION_WITH_CUSTOM_ENGINE",action:async e=>{const t=String(e.param),n=l.Z.getByGuid(t)??l.Z.getDefault(x.ZP.isIncognitoOrGuest(e.windowId));n&&D.Z.withPageSelection(e.windowId,n)},showInQC:!1,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"3a8efd62-4c8a-4545-8a6c-9cb65518f507",isEnabled:()=>!0,isVisible:()=>!0,keyword:{type:"string",unit:(0,c.Z)("Search Engine"),defaultValue:""},...(0,L.Z)("Search Selection with Engine...")}],Y=["b6ddaabf-d87f-4c2c-affa-ce81bb30bfca","176ff9a8-a516-4015-9b0a-14434746ce9b","1453aae1-130d-465f-98eb-cbda5061445d","172583c9-c8d5-45f7-9e4d-65cff9333679","d03d4bc8-26c4-49f6-b3ce-23980637ae76","855ad23f-900b-42bf-af4d-4ce6b419ce09","9f6124ef-e8ed-4143-b9ca-5a4beb646e3d"],X=e=>{const{keyword:t}=e;let n,i;if("COMMAND_SEARCH_SELECTION_WITH_CUSTOM_ENGINE"===e.name){const e=l.Z.getDefault(!1);n=e?.guid,i=e?.guid}return{...t&&{param:n||t.defaultValue,defaultValue:i||t.defaultValue}}},Q=e=>({name:e.name,label:e.label,key:e.guid,...X(e)});var q=H("br",{}),J=H("br",{}),ee=H("br",{}),te=H("br",{}),ne=H("br",{}),ie=H("br",{}),se=H("br",{});function oe({filter:e,category:t}){const n=(0,R.Z)(G),i=b(),a=(0,s.useContext)(m.Z),[r,l]=(0,s.useState)([]),[d,p]=(0,s.useState)(n[u.kChainedCommandsCommandList]),h=(0,s.useRef)(0),g=t!==$.all,f=r.map((e=>Q(e)));(0,s.useEffect)((()=>{S().then((e=>{const t=e.filter((e=>!(0,F.jD)(e.name)&&!(0,F.Ed)(e.name)&&!Y.includes(e.guid)&&e.isVisible(a.vivaldiWindowId))).map((e=>{const t=(0,B.xU)(e.name);return{...e,...t&&{keyword:t}}})).concat(j);l(t)}))}),[a.vivaldiWindowId]);const S=async()=>await o.Z.getVivDefinedCommands();(0,s.useEffect)((()=>{P.Z.set(u.kChainedCommandsCommandList,d)}),[d]);const w=e=>{const{val:t,position:n,shouldDelete:s}=e,o=r.find((e=>e.guid===t));if(!o||!i)return;const a=Q(o),l=(0,U.Uy)(d,(e=>{const t={...e[h.current]},i=[...t.chain];i.splice(n,Number(s),a),t.chain=i,e[h.current]=t}));p(l)},C=(e,t)=>{const n=(0,U.Uy)(d,(n=>{const i={...n[h.current]},s=[...i.chain],o=s.splice(e,1)[0];s.splice(t,0,o),i.chain=s,n[h.current]=i}));p(n)},I=(e,t)=>{const n=!isNaN(e)&&e.length?Number(e):e,i=(0,U.Uy)(d,(e=>{const i={...e[h.current]},s=[...i.chain],o={...s[t]};o.param=n,s[t]=o,i.chain=s,e[h.current]=i}));p(i)},T=e=>{const t=(0,U.Uy)(d,(t=>{const n={...t[h.current]},i=[...n.chain];i.splice(e,1),n.chain=i,t[h.current]=n}));p(t)},Z=e=>{const t=(0,U.Uy)(d,(t=>{const n={...t[h.current]};n.label=e,t[h.current]=n}));p(t)},k=()=>{const e=(0,U.Uy)(d,(e=>{const t=e[h.current],n=crypto.randomUUID(),i={...t,chain:t.chain.slice(),key:n,name:`COMMAND_${n}`,label:(0,c.Z)("$1 copy",[t.label])};e.splice(h.current+1,0,i)}));p(e)},N=d.map((e=>({key:e.key,name:e.name,isDefault:!1,label:e.label})));return H(M.Z,{filter:e},void 0,H("p",{className:"info"},void 0,(0,c.Z)("A Command Chain is a group of commands executed in a sequence. You can trigger a Chain from Quick Commands, or assign it a custom Keyboard Shortcut or Mouse Gesture."),q,J,(0,c.Z)("Some commands support parameters and placeholders. Placeholders can be used through Context Menus on websites, images and videos:"),ee,(0,c.Z)("Selected Text: $1",[v.te.description]),te,(0,c.Z)("Clicked Link: $1",[v.UL.description]),ne,(0,c.Z)("Active Page URL: $1",[v.a5.description]),ie,(0,c.Z)("Active Page Title: $1",[v.v$.description]),se,(0,c.Z)("Source Element URL: $1",[v.Ff.description])),H(_.Z,{className:"Setting--ChainedCommand",masterLayout:1,contentStrings:A,items:N,filter:e,deleteTitle:(0,c.Z)("title","Delete Command Chain"),deleteTipString:(0,c.Z)("tooltip","Delete Command Chain"),addTipString:(0,c.Z)("Add Command Chain"),onRemove:e=>{const t=(0,U.Uy)(d,(t=>{const i=t.splice(e,1)[0],{key:s}=i,o=n[u.kChainedCommandsDeletedCommandList];P.Z.set(u.kChainedCommandsDeletedCommandList,[s,...o])}));p(t)},onContextMenu:(e,t)=>{const n=[{handler:k,...(0,L.Z)("Duplicate Command Chain")}];(0,y.Z)(a,n)(t)},renderEmpty:e=>H("div",{className:"detail"},void 0,H("div",{className:"detail-content"},void 0,H("h3",{},void 0,e.emptyTitle),H("p",{},void 0,e.emptyDescription))),moveItem:(e,t)=>{const n=(0,U.Uy)(d,(n=>{const i=n.splice(e,1)[0];n.splice(t,0,i)}));p(n)},emptyListString:(0,c.Z)("Add a Chain to Start"),emptyListGraphic:W.Yaj,onCreateItem:()=>{const e=(0,c.Z)("create","New Chain"),t=crypto.randomUUID(),n={label:e,name:`COMMAND_${t}`,chain:[Q(j[0])],key:t,category:"CATEGORY_COMMAND_CHAIN"};p((e=>[...e,n]))},renderCreate:e=>{const t=d.length-1,{chain:n,label:i}=d[t];return h.current=t,H(E,{chainOptions:f,changeParameter:I,removeFrom:T,commands:r,shouldFocusSelector:g,cloneChain:k,addToChain:w,searchableStrings:e,moveItem:C,nameChange:Z,windowId:a.vivaldiWindowId,name:i,chain:n})},mimeType:"vivaldi/x-settings-chained-command-type",supportDragAndDrop:!0,renderListItem:(e,t)=>H("div",{className:"item-title"},void 0,t.label),renderContent:(e,t)=>{const{chain:n,label:i}=d[e];return h.current=e,H(E,{chainOptions:f,changeParameter:I,removeFrom:T,commands:r,shouldFocusSelector:g,cloneChain:k,addToChain:w,searchableStrings:t,moveItem:C,nameChange:Z,windowId:a.vivaldiWindowId,name:i,chain:n})}}))}},88901:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u});var i=n(67294),s=n(65792),o=n.n(s),a=n(94283),r=n(56371),l=n(48521);const d=32;class c extends i.PureComponent{static contextType=a.Z;refCanvas=i.createRef();componentDidMount(){this._isMounted=!0,this.offscreen=this.refCanvas.current.transferControlToOffscreen(),this.renderIcon(this.props.mediaState)}componentDidUpdate(e){const{mediaState:t,color:n,animated:i,active:s}=this.props;!this._isMounted||e.mediaState===t&&e.color===n&&e.animated===i&&e.active===s||this.renderIcon(this.props.mediaState)}componentWillUnmount(){this._isMounted=!1}shouldAnimate=()=>this._isMounted&&this.props.animated&&this.props.mediaState.has("playing")&&!this.props.mediaState.has("muting")&&!this.props.mediaState.has("capturing")&&!this.props.mediaState.has("pip");getInheritedColor=()=>{if(!this._isMounted)return;let e="#111111";this.props.color?e=this.props.color:this.refCanvas.current&&(e=getComputedStyle(this.refCanvas.current).getPropertyValue("color")),this._color!==e&&(this._color=e)};renderIcon=e=>{if(!this.offscreen)return;const t=this.offscreen.getContext("2d");this.getInheritedColor();let n=0;function i(e,t){return e+n*(t-e)}const s=()=>{t.beginPath(),t.moveTo(4,12),t.lineTo(10,12),t.lineTo(18,4),t.lineTo(18,28),t.lineTo(10,20),t.lineTo(4,20),t.closePath(),t.lineWidth=0,t.fillStyle=this._color,t.fill()},a=()=>{t.beginPath(),t.moveTo(2,27),t.lineTo(5,30),t.lineTo(28,7),t.lineTo(25,4),t.moveTo(4,12),t.lineTo(10,12),t.lineTo(18,4),t.lineTo(18,8),t.lineTo(6,20),t.lineTo(4,20),t.moveTo(14,24),t.lineTo(18,20),t.lineTo(18,28),t.closePath(),t.lineWidth=0,t.fillStyle=this._color,t.fill()},r=()=>{t.beginPath(),t.moveTo(6,25),t.lineTo(4,23),t.lineTo(4,8),t.lineTo(6,6),t.lineTo(26,6),t.lineTo(28,8),t.lineTo(28,23),t.lineTo(26,25),t.moveTo(26,23),t.lineTo(26,14),t.lineTo(14,14),t.lineTo(14,23),t.closePath(),t.lineWidth=0,t.fillStyle=this._color,t.fill()},l=e=>{if(!t||!this.shouldAnimate())return;this._lastTime||(this._lastTime=e);const s=e-this._lastTime;if(s<62.5)return void this.context.requestAnimationFrame(l);t.clearRect(18,0,d,d),n=n>1?0:Math.ceil(100*(n+.05))/100,t.beginPath(),t.moveTo(4,12),t.lineTo(10,12),t.lineTo(18,4),t.lineTo(18,28),t.lineTo(10,20),t.lineTo(4,20),t.moveTo(i(14,22),i(12,4)),t.quadraticCurveTo(i(18,32),16,i(14,22),i(20,28)),t.lineTo(i(16,24),i(22,30)),t.quadraticCurveTo(i(20,34),16,i(16,24),i(10,2)),t.closePath(),t.lineWidth=0;const a=n<.7?1:parseFloat((1-n)/.3);t.fillStyle=o()(this._color).alpha(a).css(),t.fill(),this.shouldAnimate()?(this.getInheritedColor(),this.context.requestAnimationFrame(l)):c(this.props.mediaState),this._lastTime=e-s%62.5},c=e=>{t.globalCompositeOperation&&(t.clearRect(0,0,d,d),e.has("pip")?r():e.has("capturing")?(t.beginPath(),t.arc(3,26,4,1.5*Math.PI,2*Math.PI,!1),t.lineWidth=2,t.stroke(),t.closePath(),t.beginPath(),t.arc(3,26,8,1.5*Math.PI,2*Math.PI,!1),t.lineWidth=2,t.stroke(),t.closePath(),t.beginPath(),t.arc(3,26,12,1.5*Math.PI,2*Math.PI,!1),t.lineWidth=2,t.stroke(),t.closePath(),t.beginPath(),t.moveTo(4,10),t.lineTo(4,8),t.lineTo(6,6),t.lineTo(26,6),t.lineTo(28,8),t.lineTo(28,23),t.lineTo(26,25),t.lineTo(20,25),t.lineWidth=2,t.stroke()):e.has("muting")?a():e.has("playing")&&this.shouldAnimate()?l(this.context.performance.now()):s())};c(e)};render(){let e="";return this.props.mediaState.has("pip")?e=(0,r.Z)("Exit Picture in Picture"):this.props.mediaState.has("muting")?e="tab"===this.props.src?(0,r.Z)("Unmute tab audio"):(0,r.Z)("Unmute panel audio"):this.props.mediaState.has("playing")&&(e="tab"===this.props.src?(0,r.Z)("Mute tab audio"):(0,r.Z)("Mute panel audio")),(0,l.jsx)("canvas",{ref:this.refCanvas,className:"audioicon",width:d,height:d,title:e})}}const u=c},93197:(e,t,n)=>{"use strict";n.d(t,{$J:()=>r,Cj:()=>l,E5:()=>d,ZP:()=>w});var i=n(65792),s=n.n(i),o=n(42568),a=n.n(o);const r=.4,l=s()("#fff"),d=s()("#000"),c=s()("#06a700"),u=s()("#FFCC00"),p=s()("#c64539");function h(e,t,n){return s().deltaE(e,t)>=n}function g(e,t,n,i=!1){return h(e,t,n)?e:e.luminance()>t.luminance()?function(e,t,n,i=!1){do{if((e=e.brighten(.1)).num()===l.num()){if(!i)return l;do{if((e=e.darken(.1)).num()===d.num())return d}while(!h(e,t,n))}}while(!h(e,t,n));return e}(e,t,n,i):function(e,t,n,i=!1){let o=s()(e.hex());do{if(o=o.darken(.1),o.num()===d.num()){if(!i)return d;let o=s()(e.hex());do{if(o=o.brighten(.1),o.num()===l.num())return l}while(!h(o,t,n));return o}}while(!h(o,t,n));return o}(e,t,n,i)}function m(e,t,n){const i=e.luminance()>r?e.brighten(.75):e.darken(.75),o=s().mix(e,t,.1),a=s().mix(e,t,.2),l=s().mix(e,t,.4);return{colorFg:e,colorFgAlpha:e.alpha(.1),colorFgIntense:g(i,t,n),colorFgFaded:g(o,t,n),colorFgFadedMore:g(a,t,n),colorFgFadedMost:g(l,t,n)}}function f(e,t,n,i,o){const a=e.luminance()>r,d=e.darken(.15),c=e.darken(.3),u=e.brighten(.1),p=e.brighten(.5),h=e.brighten(.2),m=a?e.brighten(.3):e.darken(.5),f=a?e.brighten(.5):e.darken(.7),v=a?e.darken(.1):e.brighten(.1),y=a?e.darken(.4):e.brighten(.4),b=a?e.darken(.3):e.brighten(.3),S=a?s().mix(l,e,.4).alpha(.95):f.darken(.1).alpha(.92);return{colorBg:e,colorBgAlpha:e.alpha(.9),colorBgAlphaHeavy:e.alpha(.65),colorBgAlphaHeavier:e.alpha(.25),colorBgAlphaBlur:e.alpha(i),colorBgDark:g(d,t,n),colorBgDarker:g(c,t,n),colorBgLight:g(u,t,n),colorBgLighter:g(p,t,n),colorBgLightIntense:g(h,t,n),colorBgIntense:g(m,t,n),colorBgIntenser:g(f,t,n),colorBgIntserAlpha:S,colorBgInverse:g(v,t,n),colorBgInverser:g(y,t,n),colorBgFaded:g(b,t,n),backgroundBlur:o?`blur(${o}px)`:""}}function v(e,t,n){const i=e.brighten(1),s=e.darken(.5),o=e.luminance()>r?d:l;return{colorHighlightBg:e,colorHighlightBgFaded:i,colorHighlightBgAlpha:e.alpha(.1),colorHighlightBgDark:g(s,t,n),colorHighlightFg:o,colorHighlightFgAlpha:o.alpha(.5),colorHighlightFgAlphaHeavy:o.alpha(.25)}}function y(e,t,n,i){i&&e.luminance()>.8&&(e=e.darken(.55));const o=e.luminance()>r,a=o?d:l,c=s().mix(a,e,.4),u=e.darken(.4),p=e.darken(1),h=o?e.brighten(.3).desaturate(.5):e.darken(.3).desaturate(.5),m=e.brighten(.5),f=e.brighten(1.2),v=f.luminance()>r,y=g(e,t,n,!0),b=y.darken(.25);return{colorAccentBg:e,colorAccentBgAlpha:f.alpha(v?.45:.55),colorAccentBgAlphaHeavy:f.alpha(v?.25:.35),colorAccentBgDark:u,colorAccentBgDarker:p,colorAccentBgFaded:h,colorAccentBgFadedMore:m,colorAccentBgFadedMost:f,colorAccentBorder:y,colorAccentBorderDark:b,colorAccentFg:a,colorAccentFgFaded:c,colorAccentFgAlpha:a.alpha(.15),colorAccentFgAlphaHeavy:a.alpha(.05)}}function b(e,t){const n=.003*t,i=e.luminance()<n?e.brighten(1):e.darken(.5),o=g(i,e,t),a=o.luminance()>e.luminance(),l=e.luminance()<=r?s().mix(o,e,.35):s().mix(o,e,.7),d=a?o.brighten(.4):o.darken(.4),c=g(i,e,t/2);return{colorBorder:o,colorBorderDisabled:g(l,e,t/2),colorBorderSubtle:s().mix(c,e,.25),colorBorderIntense:g(d,e,1.25*t)}}function S(e,t){const n=g(c,e,t),i=n.alpha(.1),s=n.luminance()>r?d:l,o=g(u,e,t),a=o.alpha(.1),h=o.luminance()>r?d:l,m=g(p,e,t),f=m.alpha(.1),v=m.luminance()>r?d:l;return{colorSuccessBg:n,colorSuccessBgAlpha:i,colorSuccessFg:s,colorWarningBg:o,colorWarningBgAlpha:a,colorWarningFg:h,colorErrorBg:m,colorErrorBgAlpha:f,colorErrorFg:v}}const w={forTheme:a()((e=>{const t=6*e.contrast,n=2*e.contrast,i=1.5*e.contrast,o=3*e.contrast,a=3*e.contrast,c=6*e.contrast,u=g(s()(e.colorFg),s()(e.colorBg),t),p=g(s()(e.colorBg),s()(e.colorFg),n),h=g(s()(e.colorHighlightBg),s()(e.colorBg),i),w=g(s()(e.colorAccentBg),s()(e.colorBg),o,!0),C=e.colorWindowBg?s()(e.colorWindowBg):p,A=C.luminance()>r?d:l;return{...m(u,p,t),...f(p,u,n,e.alpha,e.blur),...v(h,p,i),...y(w,p,o,!1),...b(p,a),...S(p,c),colorWindowBg:C,colorWindowFg:A}}),{maxSize:5}),accentOnly:function(e,t,n,i,s){const o=2*i,a=3*i;return t=g(t,n,6*i),n=g(n,t,o),y(e=g(e,n,a),n,a,s)},fgBgHighlight:function(e,t,n){return e=g(e,t,6),t=g(t,e,2),n=g(n,t,1.5),{...m(e,t,6),...f(t,e,2,.75,10),...v(n,t,1.5)}}}},38768:(e,t,n)=>{"use strict";n.d(t,{H:()=>a,v:()=>r});var i=n(29087),s=n(15489),o=n(89175);function a(e){return r(s.ZP.getWindowState(e))}function r(e){const t=e?.visibleUI.tabs??i.Z.get(o.kTabsVisible),n=e?.visibleUI.addressBar??i.Z.get(o.kAddressBarVisible),s="top"===i.Z.get(o.kTabsBarPosition),a="top"===i.Z.get(o.kAddressBarPosition);if(e&&e.minimalUI&&(n&&a||t&&s))return!1;const r=i.Z.get(o.kAppearanceDisableTitleBar),l="top"===i.Z.get(o.kMenuDisplay)&&!0;return!(r&&n&&a&&(!t||!s)&&!l)}},60679:(e,t,n)=>{"use strict";n.d(t,{W$:()=>d,ZP:()=>u,uu:()=>l});var i=n(94184),s=n.n(i),o=n(67294),a=n(721),r=n(48521);const l=e=>{const{draggable:t}=e;return t?{draggable:e.draggable,onDragStart:e.onDragStart,onDragLeave:e.onDragLeave,onDragEnter:e.onDragEnter,onDragOver:e.onDragOver,onDragEnd:e.onDragEnd,onDrop:e.onDrop}:{}},d=e=>{const{ctrlKey:t,altKey:n,shiftKey:i,metaKey:s}=e,o={ctrlKey:t,altKey:n,shiftKey:i,metaKey:s};return(0,a.mT)(o)};function c(e,t,n){const i=e.clientX-t.left,s=e.clientY-t.top;let o=.5;void 0!==n&&n>=0&&n<=.5&&(o=n);const a=i<t.width*o,r=i>t.width*(1-o),l=s<t.height*o,d=s>t.height*(1-o);return{horizontal:a?"left":r?"right":"center",vertical:l?"top":d?"bottom":"center"}}function u(e){return(0,o.forwardRef)(((t,n)=>{const i=(0,o.useRef)(null),a=n||i,[{buttonClasses:l,draggable:d,dragging:u,setVerticalPosition:p,setHorizontalPosition:h,dragOver:g,verticalPosition:m,horizontalPosition:f},{onDragStart:v,onDragEnd:y,onDragEnter:b,limitToDrag:S,onDrop:w,onDragLeave:C,onDragOver:A}]=function(e){const[t,n]=(0,o.useState)(!1),[i,a]=(0,o.useState)(!1),[r,l]=(0,o.useState)(null),[d,u]=(0,o.useState)(null),{draggable:p,onDragStart:h,onDragEnd:g,onDragEnter:m,onDrop:f,mimeType:v,image:y,imagePath:b,faviconPath:S,isOn:w,isPressed:C,isPopupVisible:A,name:I,edgeAmount:T}=e,Z=(0,o.useCallback)((e=>{h&&h(e),e.persist(),p?(e.dataTransfer.dropEffect="move",v&&I&&(e.dataTransfer.setData(v,I),e.dataTransfer.setData("text/plain","")),n(!0)):e.preventDefault()}),[p,h,v,I]),E=(0,o.useCallback)((e=>{e.persist(),g?.(e),n(!1),a(!1),u(null),l(null)}),[g]),k=(0,o.useCallback)((e=>{a(!0),m&&m(e)}),[m]),_=(0,o.useCallback)((e=>{if(e.dataTransfer.types.includes(v)){const t=e.currentTarget.getBoundingClientRect();e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="move";const{horizontal:n,vertical:i}=c(e,t,T);l(i),u(n)}}),[v,T]),N=(0,o.useCallback)((e=>{const t=e.currentTarget.getBoundingClientRect(),{horizontal:i,vertical:s}=c(e,t,T);if(n(!1),a(!1),u(null),l(null),e.persist(),!e.dataTransfer.types.includes(v))return e.preventDefault(),void e.stopPropagation();f?.(e,i,s)}),[f,v,T]),P=(0,o.useCallback)((e=>{p||e.preventDefault()}),[p]),D=(0,o.useCallback)((e=>{a(!1),u(null),l(null)}),[]);return[{buttonClasses:(e=>{const n="center"===r&&"center"===d;return s()(e,{"button-on":w,"button-textonly":!y&&!b&&!S,"button-pressed":C||A,"button-dragged":t,"button-dragover":i,"button-dragover-top":"top"===r,"button-dragover-bottom":"bottom"===r,"button-dragover-center":n,"button-dragover-left":"left"===d,"button-dragover-right":"right"===d})})(e.buttonClasses),draggable:p&&Boolean(Z&&e.mimeType),dragging:t,dragOver:i,setVerticalPosition:l,setHorizontalPosition:u,verticalPosition:r,horizontalPosition:d},{onDragStart:Z,onDragEnd:E,limitToDrag:P,onDragEnter:k,onDrop:N,onDragLeave:D,onDragOver:_}]}(t);return(0,r.jsx)(e,{...t,ref:a,dragging:u,draggable:d,onDragStart:v,onDragEnd:y,onDragEnter:b,dragOver:g,limitToDrag:S,onDragLeave:C,onDragOver:A,onDrop:w,buttonClasses:l,setVerticalPosition:p,setHorizontalPosition:h,verticalPosition:m,horizontalPosition:f})}))}},98102:(e,t,n)=>{"use strict";n.d(t,{f2:()=>x,ZP:()=>F});var i,s=n(67294),o=n(88901),a=n(25795),r=n(97009),l=n(60679),d=n(81009),c=n(5298),u=n(68247);function p(e,t,n,s){i||(i="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=s;else if(a>1){for(var r=new Array(a),l=0;l<a;l++)r[l]=arguments[l+3];t.children=r}if(t&&o)for(var d in o)void 0===t[d]&&(t[d]=o[d]);else t||(t=o||{});return{$$typeof:i,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const h={};function g(e){const[t,n]=(0,s.useState)(h[e.url]);return(0,s.useEffect)((()=>{(async e=>{if(h[e])return void n(h[e]);const t=new XMLHttpRequest;t.addEventListener("load",(i=>{const{response:s}=t;h[e]=s,n(s)})),t.addEventListener("error",(e=>{console.error(e)})),t.open("GET",e),t.send()})(e.url)}),[e.url]),p("span",t?{className:e.className,dangerouslySetInnerHTML:{__html:t}}:{className:e.className})}var m,f=n(37330),v=n(98528),y=n(97297),b=n(94283),S=n(15489),w=n(56371),C=n(94184),A=n.n(C),I=n(47380),T=n(4027),Z=n(81157),E=n(51877),k=n(20743),_=n(89175),N=n(86088),P=n(13302),D=n(48521),M=n(34155);function O(e,t,n,i){m||(m="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var l in s)void 0===t[l]&&(t[l]=s[l]);else t||(t=s||{});return{$$typeof:m,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const x="vivaldi/x-button-toolbar",L=[_.kKeyboardTabToAll,_.kMailCountersPanelUnseenEnabled,_.kThemesPreferCustomButtons,_.kThemesCurrentButtons,_.kToolbarButtonPopupSizes,_.kThemeUseAnimation];function R(e,t,n){switch(e){case"children":return!t.isPopupVisible&&!n.isPopupVisible||t.children===n.children;case"buttonStyle":case"style":if(t[e]&&n[e])return(0,E.Z)(t[e],n[e])}return t[e]===n[e]}class B extends s.Component{static contextType=b.Z;nodeRef=s.createRef();uuid=crypto.randomUUID();setButtonRef=e=>{this.buttonRef=e,this.buttonRef&&this.props.isPopupVisible&&this.forceUpdate()};state={isMenuVisible:!1,customButton:this.props.name?f.Z.getToolbarButtonImage(this.props.name):void 0,keyShortcut:""};componentDidMount(){this.props.name&&(f.Z.addListener(this.onThemeStoreChanged,(e=>e.theme.buttons)),a.Z.addListener(this.onCommandStoreChanged),this.setKeyshortcut())}componentDidUpdate(e,t){this.props.commandId!==e.commandId&&this.setKeyshortcut(),Boolean(this.props.name)!==Boolean(e.name)&&(this.props.name?(f.Z.addListener(this.onThemeStoreChanged,(e=>e.theme.buttons)),a.Z.addListener(this.onCommandStoreChanged)):(f.Z.removeListener(this.onThemeStoreChanged),a.Z.removeListener(this.onCommandStoreChanged)))}shouldComponentUpdate(e,t){return!(0,E.Z)(this.props,e,R)||!(0,E.Z)(this.state,t)}componentWillUnmount(){this.props.name&&(f.Z.removeListener(this.onThemeStoreChanged),a.Z.removeListener(this.onCommandStoreChanged)),this.context.removeEventListener("pointerup",this.pointerUp,!0)}onThemeStoreChanged=()=>{this.props.name&&this.setState({customButton:f.Z.getToolbarButtonImage(this.props.name)})};setKeyshortcut(){this.props.commandId&&this.setState({keyShortcut:a.Z.getShortcut(this.props.commandId,!1)})}onCommandStoreChanged=e=>{["init","shortcut"].includes(e)&&this.setKeyshortcut()};hasMenu=()=>Boolean(this.props.menu);getContextMenuHandler=e=>this.hasMenu()||Boolean(this.props.customizeMenu)?this.showCustomizeMenu(e,e.target):null;showMenu=async e=>{if(this.props.dragging)return;if(!this.props.menuOrigin)return void console.warn("ToolbarButton: showMenu called without menuOrigin");let t;const n=e||this.buttonRef;if(this.props.menu){const e=this.props.menu();t=Array.isArray(e)?e:await e}else t=[];0!==t.length?(this.context.removeEventListener("pointerup",this.pointerUp,!0),(0,I.Z)(this.context,t,this.menuVisibilityChanged,this.props.menuOrigin,n||void 0)()):console.warn("ToolbarButton: showMenu called without a menu")};showCustomizeMenu=async(e,t)=>{if(this.props.disabled&&!this.props.alwaysMenu)return;let n;if(e.persist(),(0,Z.ZP)(e),this.props.menu){const e=this.props.menu();n=Array.isArray(e)?e:await e}else n=[];this.props.customizeMenu&&(n=n.concat(this.props.customizeMenu(this.props.name))),(0,I.Z)(this.context,n,this.menuVisibilityChanged)(e)};getRect=()=>this.buttonRef?.getBoundingClientRect();hidePopup=()=>{this.props.hidePopup?.()};onBlur=e=>{this.props.onBlur?.(e)};onFocus=e=>{e.persist(),this.props.onFocus?.(e)};onDragStart=e=>{this.props.onDragStart?.(e),clearTimeout(this.menuTimer)};pointerLeave=e=>{clearTimeout(this.menuTimer),this.props.onPointerLeave&&this.props.onPointerLeave(e)};menuVisibilityChanged=e=>{e?(this.setState({isMenuVisible:!0}),this.props.onContextMenuVisibilityChanged?.(!0)):M.nextTick((()=>{this.setState({isMenuVisible:!1}),this.props.onContextMenuVisibilityChanged?.(!1)}))};onMenuIndicator=e=>{const{parentElement:t}=e.target;""===y.Z.getState()&&!(0,l.W$)(e)&&t instanceof this.context.HTMLElement&&(0,Z.ZP)(e),this.state.isMenuVisible||setTimeout((()=>this.showMenu(t)),90)};pointerDown=e=>{const t=Date.now(),n=""===y.Z.getState();if(this.pointerTimestamp&&t-this.pointerTimestamp<150)e.preventDefault();else if(e.persist(),!n||(0,l.W$)(e)&&S.ZP.isActive(this.context.vivaldiWindowId)||e.button!==T.Z.kLeft||"function"!=typeof this.props.onPointerDown){if(n){const n=e.currentTarget;let i=!0;!(0,l.W$)(e)&&e.preventDefault(),e.button===T.Z.kLeft&&this.hasMenu()?this.props.openMenuOnClick?this.showMenu(n):this.props.onClick?this.menuTimer=setTimeout((()=>this.showMenu(n)),650):this.state.isMenuVisible&&(i=!1):e.button===T.Z.kRight&&(this.hasMenu()||this.props.customizeMenu)&&(e.stopPropagation(),i=!1),i&&(this.pointerTimestamp=t,this.context.addEventListener("pointerup",this.pointerUp,!0))}}else this.props.onPointerDown(e)};pointerUp=e=>{this.context.removeEventListener("pointerup",this.pointerUp,!0),clearTimeout(this.menuTimer);const t=this.buttonRef;if(t&&(e.target===t||e.target===t.parentElement)){const t="ctrlCmd"===this.props.modifier?e.ctrlKey:e.shiftKey;if(e.button===T.Z.kCenter||t)(0,Z.ZP)(e),this.props.onMiddleClick&&this.props.onMiddleClick(e);else if(e.button===T.Z.kLeft){const t=Date.now()-this.pointerTimestamp;this.props.onClick&&("mouse"===e.pointerType||t<650)?this.props.onClick(e):this.hasMenu()&&((0,Z.ZP)(e),e.target instanceof this.context.HTMLElement&&this.showMenu(e.target))}}};onAuxClick=e=>{e.button===T.Z.kCenter&&(0,Z.ZP)(e)};keyDown=e=>{clearTimeout(this.menuTimer);const t=e.keyCode;this.props.onKeyDown?this.props.onKeyDown(e):this.hasMenu()&&e.shiftKey&&t===c.Z.KEY_DOWN?(this.showMenu(e.currentTarget),(0,Z.ZP)(e)):t!==c.Z.KEY_SPACE&&t!==c.Z.KEY_ENTER&&t!==c.Z.KEY_RETURN||(this.props.onClick?this.props.onClick(e):this.hasMenu()&&((0,Z.ZP)(e),this.showMenu(e.currentTarget)))};handleResize=e=>{if(!this.props.id)return;const t=this.props.id,n=this.props.prefValues[_.kToolbarButtonPopupSizes]??{};u.Z.set(_.kToolbarButtonPopupSizes,{...n,[t]:Math.round(e)})};renderPanelAudioIcon=()=>{const{mediaState:e,mediaStateType:t,name:n,toggleMuted:i}=this.props;return t&&"panel"===t&&void 0!==e?O("span",{className:"panel-audio",onClick:n&&i?()=>i(n):null},void 0,O(o.Z,{color:"#111",animated:!1,mediaState:new Set([e?"muting":"playing"]),src:"panel"})):null};renderWorkspaceAudioIcon=()=>{const{prefValues:e}=this.props;return O("span",{className:"button-icon audio"},void 0,O(o.Z,{animated:e[_.kThemeUseAnimation],mediaState:new Set(["playing"]),src:"tab"}))};renderBadge=()=>{const{badgeText:e,badgeColor:t,badgeBackgroundColor:n}=this.props;if(!e)return null;if("supporter"===e||"patron"===e||"advocate"===e)return O("img",{className:"Supporter-Badge",src:`/resources/badge-${e}-12@2x.png`,alt:""});return O("span",{className:"button-badge",style:t?{color:t,backgroundColor:n}:void 0},void 0,e)};_onDragEnter=e=>{const t=e.dataTransfer.types.some((e=>e===x||e===k.Z));if(t){const{onDrop:t,onDragEnter:n}=this.props;Boolean(t&&n)&&n?.(e)}else{const{onPanelButtonDragEnter:n}=this.props;n?.(e,t)}};_onDragLeave=e=>{if(e.dataTransfer.types.some((e=>e===x||e===k.Z))){const{onDrop:t,onDragLeave:n}=this.props;Boolean(t&&n)&&n?.(e)}else{const{onPanelButtonDragLeave:e}=this.props;e?.()}};#li(){return this.props.titleIsStatus?{role:"status"}:{}}#di(e){const{isPopupVisible:t=!1,hasPopup:n=!!this.props.children,roles:i,ariaControls:s}=this.props,o=this.props.ariaHaspopup?this.props.ariaHaspopup:this.props.openMenuOnClick?"menu":!!n&&"dialog",a={};return i&&(a.role=`button ${i}`),a["aria-label"]=e,o&&(a["aria-haspopup"]=o,a["aria-expanded"]=this.props.ariaExpanded||t||this.state.isMenuVisible),s&&(a["aria-controls"]=s),this.state.keyShortcut&&(a["aria-keyshortcuts"]=(0,P.$)(this.state.keyShortcut)),a}render(){const{children:e=null}=this.props,{ariaControls:t,disabled:n,buttonClasses:i,faviconPath:s,image:o,imagePath:a,imageOverride:d,title:c,style:u,buttonStyle:p,tabIndex:h,isMenuIndicatorVisible:m=!1,isMenuIndicatorDisabled:y=!1,isPopupVisible:b=!1,hidePopup:S,popupPosition:C,popupLabel:I,popupLabelledBy:T,draggable:E,label:k,tooltip:M,tooltipExtra:x="",limitToDrag:L,onDragEnd:R,onDragEnter:B,onDragOver:F,onDrop:W,onPointerEnter:U,prefValues:V,name:H,autoFocus:G,mediaState:$,mediaStateType:K,faviconLoadType:z}=this.props;if(!c&&!M)return null;const j="workspace"===K&&$,Y="number"==typeof h?h:V[_.kKeyboardTabToAll],X=Boolean(W&&B),Q=100*(this.props.progress??0),q=V[_.kToolbarButtonPopupSizes]??{},J=this.props.isPopupResizable&&this.props.id?q[this.props.id]:void 0,ee=[this.uuid,this.props.outsideClickIgnoreClass||""],te=V[_.kThemesPreferCustomButtons]?d||H:void 0,ne=te&&"none"!==te?f.Z.getToolbarButtonImage(te):null,ie=ne?.toLowerCase().endsWith(".svg"),se=`${this.uuid}__${V[_.kThemesCurrentButtons]}`;let oe;if(o&&ne&&ie?oe=O(g,{url:ne,className:"button-icon override"},se):o&&ne&&!ie?oe=O("img",{src:ne,className:"button-icon override"},se):ne||a||s||!o?!a&&s?oe=O(r.ZP,{url:s,className:"button-icon favicon",loadType:z??(0,r.D0)(s)?"faviconFromCache":"page"}):a&&(oe=O("img",{src:a,className:"button-icon",alt:""})):oe=o.startsWith("data:")?O("img",{src:o,className:"button-icon favicon"},se):O("span",{className:"button-icon",dangerouslySetInnerHTML:{__html:o}}),this.props.imageOnly&&oe)return O("div",{className:A()("button-toolbar",this.props.className)},void 0,oe);const ae=this.props.name?{...(0,l.uu)({draggable:E,onDragStart:n&&E?this.onDragStart:null,onDragEnd:E?R:null,onDragOver:X?F:null,onDrop:X?W:null}),onDragEnter:X?this._onDragEnter:null,onDragLeave:X?this._onDragLeave:null}:void 0,re=k?.trim()||M?.trim()||c,le=M?.trim()||re||c||"";let de=null;return!n&&re&&(de=this.state.keyShortcut?(0,w.Z)("$1 ($2)",[re,(0,P.$)(this.state.keyShortcut)]):le,x&&(de+="\n"+x)),(0,D.jsxs)("div",{ref:this.nodeRef,id:this.props.id,className:A()("button-toolbar",this.props.className,{[this.uuid]:e,"button-menu":m,"button-disabled-preview":n&&E}),onContextMenu:n?this.getContextMenuHandler:null,onPointerEnter:n?U:null,style:u,onPointerDown:n&&E?L:null,title:n?re:null,...ae,children:[(0,D.jsxs)("button",{name:H,ref:this.setButtonRef,disabled:n&&!E,draggable:E,onDragStart:!n&&E?this.onDragStart:null,tabIndex:0!==Y?Y:null,onKeyDown:this.keyDown,onPointerDown:this.pointerDown,onClick:Z.ZP,onAuxClick:this.onAuxClick,autoFocus:G,onPointerEnter:U,onPointerLeave:this.pointerLeave,onDoubleClick:Z.ZP,onContextMenu:this.getContextMenuHandler,onBlur:this.onBlur,onFocus:this.onFocus,onWheel:this.props.onWheel,style:p||null,title:de,type:"button",id:t?t+"_button":void 0,...this.#di(re),className:A()("ToolbarButton-Button",i),children:[oe,c&&(0,D.jsx)("span",{className:"button-title",...this.#li(),children:c}),j&&this.renderWorkspaceAudioIcon(),!j&&m&&O("span",{className:A()("button-toolbar-menu-indicator",{disabled:this.state.isMenuVisible||y}),role:"button","aria-haspopup":"menu","aria-expanded":this.state.isMenuVisible,"aria-label":(0,w.Z)("More"),onPointerDown:this.onMenuIndicator,dangerouslySetInnerHTML:{__html:N.uIM}}),this.renderBadge(),this.renderPanelAudioIcon()]}),Q>0&&Q<100&&O("div",{className:"progress",role:"progressbar","aria-valuenow":Q},void 0,O("div",{className:"loaded",style:{width:`${Q}%`}})),b&&e&&S&&C&&this.buttonRef&&O(v.Z,{outsideClickIgnoreClass:ee,hasLightArrow:this.props.hasLightArrow,hidePopup:this.hidePopup,className:this.props.className,buttonRef:this.buttonRef,width:this.props.popupWidth,popupClassName:this.props.popupClassName,popupPosition:C,isResizable:Boolean(this.props.isPopupResizable),height:J,onResize:this.handleResize,labelledBy:T,label:I,forceFocus:this.props.forceFocus},void 0,e)]},this.uuid)}}const F=(0,d.Z)((0,l.ZP)(B),L)},98528:(e,t,n)=>{"use strict";n.d(t,{Z:()=>S});var i=n(67294),s=n(63377),o=n(5298),a=n(48521);function r({verticalPosition:e,onResize:t}){const n=(0,i.useRef)();return(0,i.useEffect)((()=>{const e=n.current;return e?.addEventListener("pointerdown",t,!0),()=>{e?.removeEventListener("pointerdown",t,!0)}}),[t]),(0,a.jsx)("div",{ref:n,className:`resize resize-${e}`})}var l,d=n(73935),c=n(94283),u=n(15489),p=n(94184),h=n.n(p),g=n(4027),m=n(52250),f=n(29697);function v(e,t,n,i){l||(l="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var s=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=i;else if(o>1){for(var a=new Array(o),r=0;r<o;r++)a[r]=arguments[r+3];t.children=a}if(t&&s)for(var d in s)void 0===t[d]&&(t[d]=s[d]);else t||(t=s||{});return{$$typeof:l,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function y(e,t,n,i,s){if(!s)return{};const o={};if(i){const e=n.top-s.top-3,a=s.bottom-n.bottom-3;"above"===t?e>=i.height?o.bottom=Math.round(s.height-n.top-s.top+3)+"px":a>=i.height?o.top=Math.round(n.bottom-s.top+3)+"px":o.top="3px":"below"===t?a>=i.height?o.top=Math.round(n.bottom-s.top+3)+"px":e>=i.height?o.bottom=Math.round(s.height-n.top-s.top+3)+"px":o.bottom="3px":a>=i.height/2&&e>=i.height/2?(o["--anchorPos"]="50%",o.top=Math.round(n.top-s.top-i.height/2+12)+"px"):a>=i.height?(o["--anchorPos"]="12px",o.top=Math.round(n.top-s.top)+"px"):e>=i.height?(o["--anchorPos"]=i.height-18+"px",o.bottom=Math.round(s.height-n.bottom+3)+"px"):(o["--anchorPos"]="12px",o.bottom="3px")}else"above"===t?o.bottom=Math.round(s.height-n.top-s.top+3)+"px":"below"===t?o.top=Math.round(n.bottom-s.top+3)+"px":(o.position||(o["--anchorPos"]="12px"),o.top=Math.round(n.top)+"px");return"string"==typeof o.top?o.bottom="unset":o.top="unset","left"===e?o.right="left"===t?Math.round(Math.max(s.right-n.left+3,3))+"px":Math.round(Math.max(s.right-n.right,3))+"px":o.left="right"===e?"right"===t?Math.round(n.right+3)+"px":Math.round(Math.max(n.left,3))+"px":Math.round(n.left+n.width/2)+"px","string"==typeof o.left?o.right="unset":o.left="unset",o}class b extends i.PureComponent{static contextType=c.Z;nodeRef=i.createRef();renderInPortal=!0;horizontalPosition="center";state={height:this.props.height??400,originalHeight:this.props.height??400,originalY:0,originalMouseY:0};constructor(e,t){super(e),this.portalContainer=t.document.getElementById("browser")}componentDidMount(){this.context.addEventListener("resize",this.onWindowResize,!1),this.intersectionObserver=new IntersectionObserver(this.onIntersect,{root:this.portalContainer}),this.intersectionObserver.observe(this.props.buttonRef),this.props.isResizable&&(this.context.addEventListener("pointerup",this.stopResize,!0),this.context.addEventListener("pointercancel",this.stopResize,!0))}onIntersect=e=>{e[0].intersectionRatio<=0&&this.props.hidePopup()};componentDidUpdate(e){this.props.buttonRef!==e.buttonRef&&(this.intersectionObserver.disconnect(),this.intersectionObserver.observe(this.props.buttonRef)),this.recalculatePosition()}componentWillUnmount(){this.context.removeEventListener("resize",this.onWindowResize,!1),this.context.removeEventListener("pointerup",this.stopResize,!0),this.context.removeEventListener("pointercancel",this.stopResize,!0),this.intersectionObserver.disconnect()}recalculatePosition=()=>{const e=this.getNode();if(this.renderInPortal&&e){const t=y(this.horizontalPosition,this.props.popupPosition,this.props.buttonRef.getBoundingClientRect(),e.getBoundingClientRect(),this.context.document.body?.getBoundingClientRect());for(const n in t)e.style[n]!==t[n]&&e.style.setProperty(n,t[n])}};getNode(){return this.nodeRef.current}onWindowResize=()=>{this.forceUpdate()};getEdgeMargin=e=>{let t=Number.MAX_SAFE_INTEGER;const n=this.props.buttonRef.getBoundingClientRect();return"right"===e?t=n.left:"left"===e&&(t=this.context.innerWidth-n.right),t<=3?3-t:0};handleClickOutside=()=>{this.props.hidePopup()};keyDown=e=>{e.keyCode===o.Z.KEY_ESCAPE&&(this.props.hidePopup(),e.preventDefault(),e.stopPropagation())};resize=e=>{const{originalHeight:t,originalMouseY:n}=this.state,i="above"===this.props.popupPosition?t-(e.pageY-n):t+(e.pageY-n);e.buttons?i>=100&&this.context.requestAnimationFrame((()=>{this.setState({height:i})})):this.stopResize(e)};stopResize=e=>{e.target.releasePointerCapture(e.pointerId),g.Z.setWebviewPointerEvents(!0,this.context.document),e.target.removeEventListener("pointermove",this.resize,!0),this.props.height!==this.state.height&&this.props.onResize?.(this.state.height)};startResize=e=>{const t=this.getNode();t&&e.button===g.Z.kLeft&&(e.preventDefault(),this.setState({originalHeight:parseFloat(getComputedStyle(t).getPropertyValue("height").replace("px","")),originalY:t.getBoundingClientRect().top,originalMouseY:e.pageY}),e.target.setPointerCapture(event.pointerId),g.Z.setWebviewPointerEvents(!1,this.context.document),e.target.addEventListener("pointermove",this.resize,!0))};render(){const e=u.ZP.getVisibleUI(this.context.vivaldiWindowId).addressBar,t=Boolean(this.props.buttonRef.closest(".toolbar-mainbar"));this.renderInPortal=e||!t;const{popupClassName:n,hasLightArrow:i,popupPosition:o}=this.props,l=this.props.buttonRef.getBoundingClientRect(),c=this.props.width||200,p=this.context.document.body?.getBoundingClientRect();this.horizontalPosition=function(e,t,n,i){if(!n)return"center";const s=t.left-n.left,o=n.right-t.right,a=e/2<s+t.width/2-3,r=e/2<o+t.width/2-3,l=e-t.width<o,d=e-t.width<s;if(a&&r){if("left"===i&&l)return"right";if("right"===i&&d)return"left"}else{if(d)return"left";if(l)return"right"}return"center"}(c,l,p,this.props.popupPosition);let g={"--popupWidth":Math.round(c)+"px","--buttonWidth":Math.round(l.width)+"px","--buttonHeight":Math.round(l.height)+"px","--edgeMargin":Math.round(this.getEdgeMargin(this.horizontalPosition))+"px"};if(this.props.isResizable&&(g["--popupHeight"]=Math.round(this.state.height)+"px"),this.renderInPortal){const e=this.getNode()?.getBoundingClientRect();g={...g,...y(this.horizontalPosition,o,l,e,p)}}const m=this.props.labelledBy?{"aria-labelledby":this.props.labelledBy}:{"aria-label":this.props.label},b=(0,a.jsx)(f.Z,{classNames:"button-popup",role:"dialog",...m,in:!0,onEnter:this.recalculatePosition,appear:!0,mountOnEnter:!0,unmountOnExit:!0,timeout:{enter:300,exit:150},nodeRef:this.nodeRef,children:v(s.Z,{forwardRef:this.nodeRef,focusName:"focus-popup-area",forceTrap:this.props.forceFocus??!0,onKeyDown:this.keyDown,style:g,className:h()(n,"button-popup",`button-popup-${this.horizontalPosition}`,`button-popup-pos-${o}`,"button-popup-arrow-"+(i?"light":"dark"))},void 0,this.props.children,this.props.isResizable&&v(r,{verticalPosition:o,onResize:this.startResize}))});return this.portalContainer&&this.renderInPortal?d.createPortal(b,this.portalContainer):b}}const S=(0,m.Z)(b)},86461:(e,t,n)=>{"use strict";n.d(t,{Gt:()=>Z,LM:()=>N,Np:()=>P,PK:()=>_,VJ:()=>k,ZP:()=>D,aX:()=>A,e3:()=>p,qS:()=>T,wY:()=>I,ww:()=>C});var i=n(96951),s=n(15285),o=n(34197),a=n(29087),r=n(70864),l=n(15489),d=n(56371),c=n(89175);const u=["PanelWeb","Settings"],p=["PanelChat"],h=[{id:"Spacer",label:(0,d.Z)("Space")},{id:"FlexibleSpacer",label:(0,d.Z)("Flexible Space")},{id:"PanelWidthSpacer",label:(0,d.Z)("Panel Width Space")},{id:"Divider",label:(0,d.Z)("Separator")}],g={category:"navigation",label:(0,d.Z)("title","Address Bar"),pref:c.kToolbarsNavigation,buttons:[{id:"Back",label:(0,d.Z)("navigation","Back")},{id:"Forward",label:(0,d.Z)("navigation","Forward")},{id:"Rewind",label:(0,d.Z)("Rewind")},{id:"FastForward",label:(0,d.Z)("Fast Forward")},{id:"Reload",label:(0,d.Z)("Reload")},{id:"Stop",label:(0,d.Z)("verb","Stop")},{id:"Home",label:(0,d.Z)("Home")},{id:"AddressField",label:(0,d.Z)("Address Field")},{id:"SearchField",label:(0,d.Z)("Search Field")},{id:"DownloadButton",label:(0,d.Z)("Downloads")},{id:"ReadingList",label:(0,d.Z)("Reading List")},{id:"AccountButton",label:(0,d.Z)("Account")},{id:"UpdateButton",label:(0,d.Z)("Update Status")},{id:"Extensions",label:(0,d.Z)("Extensions")},{id:"WorkspaceButton",label:(0,d.Z)("Workspaces")},...h]},m={category:"status",label:(0,d.Z)("title","Status Bar"),pref:c.kToolbarsStatus,buttons:[{id:"BreakMode",label:(0,d.Z)("Break Mode")},{id:"MailStatus",label:(0,d.Z)("Mail Status")},{id:"CalendarStatus",label:(0,d.Z)("Calendar Status")},{id:"SyncStatus",label:(0,d.Z)("Sync Status")},{id:"StatusInfo",label:(0,d.Z)("Status Info")},{id:"VersionInfo",label:(0,d.Z)("Version Info")},{id:"CaptureImages",label:(0,d.Z)("Capture Images")},{id:"TilingToggle",label:(0,d.Z)("Page Tiling")},{id:"ImagesToggle",label:(0,d.Z)("Toggle Images")},{id:"PageActions",label:(0,d.Z)("Page Actions")},{id:"Zoom",label:(0,d.Z)("Page Zoom")},{id:"Clock",label:(0,d.Z)("Clock")},{id:"Settings",label:(0,d.Z)("Settings")},...h]},f={category:"panel",label:(0,d.Z)("toolbar","Panel"),pref:c.kToolbarsPanel,buttons:[{id:"PanelToggle",label:(0,d.Z)("Panel Toggle")},{id:"PanelBookmarks",label:(0,d.Z)("Bookmarks")},{id:"PanelReadingList",label:(0,d.Z)("Reading List")},{id:"PanelDownloads",label:(0,d.Z)("Downloads")},{id:"PanelHistory",label:(0,d.Z)("History")},{id:"PanelNotes",label:(0,d.Z)("Notes")},{id:"PanelWindow",label:(0,d.Z)("panel","Windows")},{id:"PanelTranslate",label:(0,d.Z)("panel","Translate")},{id:"PanelMail",label:(0,d.Z)("Mail")},{id:"PanelCalendar",label:(0,d.Z)("Calendar")},{id:"PanelTasks",label:(0,d.Z)("Tasks")},{id:"PanelFeeds",label:(0,d.Z)("Feeds")},{id:"PanelContacts",label:(0,d.Z)("Contacts")},{id:"PanelChat",label:(0,d.Z)("Chat")},{id:"PanelSession",label:(0,d.Z)("Sessions")},{id:"PanelWeb",label:(0,d.Z)("Add Web Panel")},...h]},v=[{id:"MailBack",label:(0,d.Z)("navigation","Back")},{id:"MailForward",label:(0,d.Z)("navigation","Forward")},{id:"MailReload",label:(0,d.Z)("Reload")}],y=[{id:"MailMsgReply",label:(0,d.Z)("Reply")},{id:"MailMsgReplyToAll",label:(0,d.Z)("Reply to All")},{id:"MailMsgForward",label:(0,d.Z)("mail","Forward")}],b={id:"MailMsgStatusRead",label:(0,d.Z)("Mark Unread")},S={id:"MailMsgStatusUnread",label:(0,d.Z)("Mark Read")},w=[b,S,{id:"MailMsgFlag",label:(0,d.Z)("Flag")},{id:"MailMsgLabel",label:(0,d.Z)("Label")},{id:"MailMsgMove",label:(0,d.Z)("Move to Folder")},{id:"MailMsgSpam",label:(0,d.Z)("Mark Message as Spam")},{id:"MailMsgSpamRestore",label:(0,d.Z)("Not Spam")},{id:"MailMsgArchive",label:(0,d.Z)("Move to Archive")},{id:"MailMsgArchiveRestore",label:(0,d.Z)("Restore from Archive")},{id:"MailMsgTrash",label:(0,d.Z)("Move to Trash")},{id:"MailMsgTrashRestore",label:(0,d.Z)("Undelete")},{id:"MailViewQuickResponse",label:(0,d.Z)("Toggle Quick Response")},{id:"MailRenderingMethod",label:(0,d.Z)("Rendering Method")},{id:"MailRenderingMethodText",label:(0,d.Z)("Rendering Method (Plain Text)")},{id:"MailViewThreading",label:(0,d.Z)("Threads")},{id:"MailViewThreadingFlat",label:(0,d.Z)("Threads (Disabled)")},{id:"MailViewLayout",label:(0,d.Z)("Toggle Layout")}],C=[{...g},{...m},{...f},{...{category:"mail",label:(0,d.Z)("Mail Bar"),pref:c.kToolbarsMail,buttons:[...v,{id:"MailSearch",label:(0,d.Z)("Mail Search")},{id:"MailCompose",label:(0,d.Z)("Compose New Mail")},{id:"MailUndo",label:(0,d.Z)("Undo The Latest Mail Actions")},{id:"MailMsgEdit",label:(0,d.Z)("mail","Edit")},...y,...w,...h]}},{...{category:"mail_composer",label:(0,d.Z)("Mail Composer Bar"),pref:c.kToolbarsMailComposer,buttons:[...v,{id:"MailMsgSend",label:(0,d.Z)("Send")},{id:"MailMsgAttach",label:(0,d.Z)("Add Attachment")},{id:"MailMsgShowHeaders",label:(0,d.Z)("Show Headers")},{id:"MailMsgDiscard",label:(0,d.Z)("Discard Draft")},b,S,...h]}},{...{category:"mail_message",label:(0,d.Z)("Mail Message Bar"),pref:c.kToolbarsMailMessage,buttons:[...v,...y,...w,...h]}}],A=["Spacer","FlexibleSpacer","PanelWidthSpacer","Divider"];function I(e){let t="";for(const n of C){const i=n.buttons.find((t=>t.id===e));if(i){t=i.label;break}}return t}function T(e){let t="";for(const n of C)if(n.pref===e){t=n.label;break}return t}function Z(e,t,n){const i=n.filter((e=>!p.includes(e)));return t?i:l.ZP.isGuest()?i.filter((e=>!u.includes(e))):i}function E(){const e=a.Z.get(c.kToolbarsNavigation),t=a.Z.get(c.kToolbarsPanel),n=a.Z.get(c.kToolbarsStatus),i=a.Z.get(c.kToolbarsMail).concat(a.Z.get(c.kToolbarsMailComposer)).concat(a.Z.get(c.kToolbarsMailMessage)),s=e.concat(t).concat(n).concat(i);return{navigationComponents:e,panelComponents:t,statusComponents:n,mailComponents:i,allToolbars:s}}function k(e,t){const{allToolbars:n}=E();return n.includes(e)}function _(e,t){const{navigationComponents:n,panelComponents:o,statusComponents:a,mailComponents:r,allToolbars:d}=E();if(!d.includes(e))return!1;const{visibleUI:c}=l.ZP.getWindowState(t)||{visibleUI:{}},{isMailPage:u}=i.ZP.getActivePage(t)||{isMailPage:!1},p=Boolean(c.addressBar),h="on"===c.statusBar,g=s.ZP.getIsBarVisible(t);return n.includes(e)&&p&&!u||o.includes(e)&&g||a.includes(e)&&h||r.includes(e)&&p&&u}function N(e,t){return[c.kToolbarsNavigation,c.kToolbarsStatus,c.kToolbarsPanel,c.kToolbarsMail].some((n=>t!==n&&a.Z.get(n).includes(e)))}function P(e,t){const n=[...a.Z.get(t)].filter((e=>o.ZP.isWebPanel(e))),i=[...a.Z.getDefault(t)].filter((e=>o.ZP.isWebPanel(e)));i.forEach((t=>{if(!n.find((e=>e===t))){const n=s.ZP.getWebPanels(e).find((e=>t.endsWith(e.id)));n||r.Z.restoreById(e,t,!1)}})),n.forEach((e=>{i.find((t=>t===e))||r.Z.removeById(e,t)}))}const D={isComponentInToolbar:k,isComponentVisible:_,isComponentPresentElsewhere:N}},58228:(e,t,n)=>{"use strict";n.d(t,{l:()=>r});var i=n(50522),s=n(68247),o=n(29087),a=n(89175);function r(e,t){if(!o.Z.get(a.kOauthRefreshTokens)[e])return;if("calendar"===t&&o.Z.get(a.kMailAccounts).some((t=>t.MAIL_EMAIL===e)))return;if("mail"===t&&i.Z.getAccounts().some((t=>t.username===e)))return;const n={...o.Z.get(a.kOauthRefreshTokens)};delete n[e.toLowerCase()],s.Z.set(a.kOauthRefreshTokens,n)}},10373:(e,t,n)=>{"use strict";function i(e,t,n,i){return e.substring(0,n)+t+e.substring(i)}n.d(t,{C:()=>a,i:()=>i});const s=/^(.*?:\/\/\/*)(.*)$/,o=/(.*?)\/*([#?].*)/;function a(e){if(e.startsWith("data:"))return{schema:"data:",host:"",postfix:"",path:e.substring("data:".length)};let t;try{t=new URL(e)}catch(e){return{schema:"",host:"",path:"",postfix:""}}const n=e.match(s),i=n&&n[1]||"",a=e.match(o),r=a&&a[2]||"",l=t.hostname+(t.port?`:${t.port}`:"");let d;try{d=decodeURI(t.pathname)}catch(e){d=t.pathname}return"vivaldi://"===i?{schema:i,host:l,path:d.startsWith("//")?d.substring(2,d.length-1):d,postfix:r}:{schema:i,host:l,path:d,postfix:r}}},39840:(e,t,n)=>{"use strict";n.d(t,{Z:()=>d});var i=n(96951),s=n(29087),o=n(33638),a=n(15489),r=n(89175),l=n(34155);const d=new class{setText(e,t){const n=i.ZP.getActivePage(e);n&&o.Z.dispatch({actionType:"SEARCH_FIELD_SET_TEXT",tabId:n.id,text:t})}addTypedSearchHistory(e,t){s.Z.get(r.kAddressBarSearchTypedHistoryEnabled)&&!a.ZP.isIncognito(e)&&l.nextTick((()=>{o.Z.dispatch({actionType:"SEARCH_FIELD_ADD_TYPED_HISTORY_DEPRECATED",query:t})}))}deleteTypedSearchHistory(e,t){o.Z.dispatch({actionType:"SEARCH_FIELD_DELETE_TYPED_HISTORY_DEPRECATED",query:e,when:t})}deleteTypedHistoryPeriod(e){o.Z.dispatch({actionType:"SEARCH_FIELD_DELETE_TYPED_HISTORY_PERIOD_DEPRECATED",since:e})}load=()=>(o.Z.dispatch({actionType:"SEARCH_FIELD_INIT_TYPED_HISTORY_DEPRECATED"}),s.Z.addListener(r.kHistoryDaysToKeepVisits,((e,t)=>{0===t?o.Z.dispatch({actionType:"SEARCH_FIELD_DELETE_TYPED_HISTORY_FROM_DATABASE_DEPRECATED"}):0===e&&t>0&&o.Z.dispatch({actionType:"SEARCH_FIELD_WRITE_TYPED_HISTORY_TO_DATABASE_DEPRECATED"})})),Promise.resolve())}},92571:(e,t,n)=>{"use strict";n.d(t,{Z:()=>d});var i=n(23157),s=n(56371),o=n(46884),a=n(67294),r=n(48521);const l={clearIndicator:()=>({}),container:()=>({}),control:()=>({}),dropdownIndicator:()=>({}),group:()=>({}),groupHeading:()=>({}),indicatorsContainer:()=>({}),indicatorSeparator:()=>({}),input:()=>({}),loadingIndicator:()=>({}),loadingMessage:()=>({}),menu:()=>({}),menuList:()=>({}),menuPortal:()=>({}),multiValue:()=>({}),multiValueLabel:()=>({}),multiValueRemove:()=>({}),noOptionsMessage:()=>({}),option:()=>({}),placeholder:()=>({}),singleValue:()=>({}),valueContainer:()=>({})};const d=function(e){const{disabled:t,tabIndex:n,commands:d,blurInputOnSelect:c,customStyles:u,selectedCommand:p,...h}=e,g=u?{...l,...u}:l,m=()=>{f.current?.blur()},f=(0,a.useRef)(null),v=(0,a.useRef)(null),y=(0,a.useCallback)((()=>v.current),[]),b=(0,a.useCallback)((()=>m),[]);return(0,o.Z)(y,b),(0,r.jsx)("div",{ref:v,children:(0,r.jsx)(i.ZP,{ref:f,className:"VivaldiSelector",classNamePrefix:"Inner",isDisabled:t??!1,tabIndex:n?.toString(),value:p,onChange:t=>{return n=t,void e.setSelectedItem(n);var n},styles:g,blurInputOnSelect:c??!0,options:d,loadingMessage:()=>(0,s.Z)("Loading..."),noOptionsMessage:()=>(0,s.Z)("No options"),"aria-labelledby":"arialabel",...h})})}},17434:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var i=n(92292),s=n(34197),o=n(37441);let a=[];const r={isPanel:function(e){try{if(!e.vivExtData)return!1;if(JSON.parse(e.vivExtData).panelId)return!0}catch(e){}return!1},offerUpdatedTab:function(e){return!!r.isPanel(e)},offerNewTab:function(e){try{if(!e.vivExtData)return!1;const t=JSON.parse(e.vivExtData);if(!t.panelId)return!1;const n=parseInt(e.id);return(0,o.V)(n,{panelId:t.panelId},!0),r.put(t.panelId,n),!0}catch(e){}return!1},find:function(e){return a.find((t=>t.panelId===e))},findTabId:function(e){return a.find((t=>t.tabId===e))},resolve:function(e){const t=r.find(e);if(t&&-1!==t.tabId)return t.tabId},resolveWebWidget:function(e,t){const n=function(e,t){return s.zs+String(e)+"_"+t}(e,t),i=r.resolve(n);return i||n},put:function(e,t=-1){let n=r.find(e);return n?(n.tabId=t,n):(n={tabId:t,panelId:e},a.push(n),n)},has:function(e){return Boolean(r.find(e))},_erase:function(e){const t=a.length;return a=a.filter((t=>t.panelId!==e)),t!==a.length},eraseTabId:function(e,t){if(void 0!==t){const t=r.findTabId(e);return t?(r._erase(t.panelId),!0):(console.error("Erase unregistered panel: ",e),!0)}return!!a.find((t=>t.tabId===e))},findAssociatedWebWidgets:e=>a.filter((t=>function(e){const[t,n]=e.split("_");return t===s.dB?Number(n):void 0}(t.panelId)===e)),closeAssociatedTabsByWidget(e){const t=a.filter((t=>function(e){const[t,,n]=e.split("_");return t===s.dB?n:void 0}(t.panelId)===e));r._closePanelTabs(t.map((e=>e.tabId)))},closeAssociatedTabs(e){const t=r.findAssociatedWebWidgets(e).map((e=>e.tabId));r._closePanelTabs(t)},_closePanelTabs(e){0!==e.length&&i.Z.tabs.remove(e)}},l=r},70864:(e,t,n)=>{"use strict";n.d(t,{Z:()=>b});var i=n(21788),s=n(59322),o=n(18350),a=n(17434),r=n(34197),l=n(14481),d=n(68247),c=n(29087),u=n(26591),p=n(7064),h=n(86461),g=n(36436),m=n(89175);const f="webpanel",v="about:blank",y={_createWebPanelItem:function(e){let t=e.id;return t&&0!==t.length||(t=y.getWebPanelId()),{activeUrl:e.activeUrl,faviconUrl:u.Z,faviconUrlValid:!0,id:t,mobileMode:!0,origin:"user",resizable:!1,title:e.title??"",url:e.url,width:-1,zoom:1,tabId:void 0,hasBeenVisible:!1}},findPanelByTabId:function(e){const t=a.Z.findTabId(e);if(t)return t.panelId},replaceTabId:function(e,t){const n=this.findPanelByTabId(t);n?a.Z.put(n,e):console.log("No panel found for tabId:",t)},makePanelId:(e,t)=>e+"_"+t,restoreById:function(e,t,n){const i=c.Z.get(m.kPanelsWebRemovedElements).findIndex((e=>e.id===t));if(-1!==i)this.recoverWebPanel(e,i,n);else{const e=c.Z.getDefault(m.kPanelsWebElements).find((e=>e.id===t));e&&y.addPanels(-1,[e],-1,n)}},isExtPanel:e=>!!e&&e.startsWith(r.j9),getWebPanelId:()=>r.J$+crypto.randomUUID(),getExtPanelIdFromExtensionId:e=>r.j9+e,getExtPanelId:function(e){if(e.sidePanel)return y.getExtPanelIdFromExtensionId(e.id)},getExtIdFromPanel:function(e){return e.replace(r.j9,"")},removeByExtension:function(e,t){const n=y.getExtPanelId(t);if(!n)return;y.removeById(n,m.kToolbarsPanel);const i=c.Z.get(m.kToolbarsPanel).slice();d.Z.set(m.kToolbarsPanel,i.filter((e=>e!==n)))},hasPanelUrl:function(e){if(!e)return!1;return c.Z.get(m.kPanelsWebElements).find((t=>{const n=new URL(t.url),i=new URL(e);return(0,g.uu)(n.toString(),i.toString())}))},hasPanelId:function(e){return a.Z.has(e)},installExtensionById:async function(e,t){const n=(await p.Z.extensionActionUtils.getToolbarExtensions()).find((e=>e.id===t.replace(r.j9,"")));n&&this.addByExtension(e,n)},addByExtension:function(e,t){const n=y.getExtPanelId(t);if(!n)return;if(this.hasPanelId(n))return;const i=t.sidePanel;if(!i)return;const s={id:n,url:i.url??"",activeUrl:i.activeUrl??v,title:t.badgeTooltip};y.addBySpec(e,s)},updateByExtension:function(e,t){const n=y.getExtPanelIdFromExtensionId(e);t.enabled?t.resourceUrl&&y.setActiveUrl(n,t.resourceUrl):y.setNoContent(n)},addBySpec:function(e,t){const n=this._createWebPanelItem(t);y.addPanels(e,[n],t.index??-1,t.showButton??!0)},addByUrl:function(e,t,n){y.addByUrls(e,[t],-1,n)},addByUrls:function(e,t,n,i){const s=t.map((e=>this._createWebPanelItem({url:e,activeUrl:e})));y.addPanels(e,s,n,i)},addPanels:function(e,t,n,i){const s=c.Z.get(m.kPanelsWebElements).slice();if(t.forEach((e=>{s.find((t=>t.id===e.id))?console.warn("Panel data already installed",e.id):s.push(e)})),d.Z.set(m.kPanelsWebElements,s),i){let i;n<0&&(n=r.ZP.getNewIndex());const s=c.Z.get(m.kToolbarsPanel).slice();t.forEach((e=>{s.find((t=>t===e.id))||(n>=s.length?s.push(e.id):s.splice(n,0,e.id)),i||(i=e.id)})),d.Z.set(m.kToolbarsPanel,s),i&&o.Z.setAddedButton(e,m.kToolbarsPanel,i,!0)}},removeById:function(e,t){if((0,h.LM)(e,t))return;const n=c.Z.get(m.kPanelsWebElements);if(0===n.length)return;const i=n.filter((t=>t.id===e))[0];if(!i)return;l.Z.destroyPeriodicAlarm({ids:[e],from:"panel"});const s=n.filter((t=>t.id!==e));d.Z.set(m.kPanelsWebElements,s);const o=c.Z.get(m.kPanelsWebRemovedElements).slice();if(o.push(i),d.Z.set(m.kPanelsWebRemovedElements,o),"bundle"===i.origin){const t=c.Z.get(m.kPanelsWebModifiedElements).slice();t.includes(e)||(t.push(e),d.Z.set(m.kPanelsWebModifiedElements,t))}},updatePanelData:function(e,t){const n=[...c.Z.get(m.kPanelsWebElements)],i=n?.findIndex((t=>t.id===e));-1!==i&&(n[i]={...n[i],...t},d.Z.set(m.kPanelsWebElements,n))},setZoom:(e,t)=>y.updatePanelData(e,{zoom:t}),setPeriodicReload:(e,t)=>y.updatePanelData(e,{interval:t}),setTitle:(e,t)=>y.updatePanelData(e,{title:t}),setUrl:(e,t)=>y.updatePanelData(e,{url:t}),setMobileMode:(e,t)=>y.updatePanelData(e,{mobileMode:t}),setActiveUrl:(e,t)=>y.updatePanelData(e,{activeUrl:t}),setNoContent:e=>{y.setActiveUrl(e,v)},setHasBeenVisible:(e,t)=>{y.updatePanelData(e,{hasBeenVisible:t})},setFaviconUrl:(e,t)=>y.updatePanelData(e,{faviconUrl:t,faviconUrlValid:!0}),recoverWebPanel:function(e,t,n){const i=c.Z.get(m.kPanelsWebRemovedElements);if(i.length>0&&t<i.length){const s=i[t];if("bundle"===s.origin){const e=c.Z.get(m.kPanelsWebModifiedElements).slice(),t=e.findIndex((e=>e===s.id));-1!==t&&(e.splice(t,1),d.Z.set(m.kPanelsWebModifiedElements,e))}y.addPanels(e,[s],-1,n);const o=i.slice();o.splice(t,1),d.Z.set(m.kPanelsWebRemovedElements,o)}},emptyTrash:function(){d.Z.set(m.kPanelsWebRemovedList,[]),d.Z.set(m.kPanelsWebRemovedItems,[]),d.Z.set(m.kPanelsWebRemovedElements,[])},copyWebPanelAdress:function(e){const t=this.getUrlById(e);t.length>0&&i.Z.copyUrlToClipboard(t)},getUrlById:function(e){const t=c.Z.get(m.kPanelsWebElements).filter((t=>t.id===e)).map((e=>e.activeUrl||e.url));return t.length>0?t[0]:""},openInTab:function(e,t,n,i){const o=this.getUrlById(t);o.length>0&&s.ZP.openURL(e,o,{inCurrent:n,inBackground:i})},openInNewWindow:function(e,t,n){const i=this.getUrlById(t);i.length>0&&s.ZP.openURL(e,i,{inNewWindow:!0,incognito:n})},getIndexByShortcut:function(e){const t=f.length,n=e.substr(0,t),i=e.substr(t).trim();return n===f&&i>="1"&&i<="9"?parseInt(i):-1},setUIContent:function(e){const t={...c.Z.get(m.kPanelsWebToolbar)};t.showToolbar=e.showToolbar,t.allControls=e.allControls??t.allControls,t.zoomControls=e.zoomControls??t.zoomControls,t.deviceControl=e.deviceControl??t.deviceControl,d.Z.set(m.kPanelsWebToolbar,t)}},b=y},37646:(e,t,n)=>{"use strict";n.d(t,{Z:()=>C});var i,s=n(67294),o=n(30626),a=n(81009),r=n(5298),l=n(98102),d=n(94283),c=n(56371),u=n(94184),p=n.n(u),h=n(47380),g=n(89175),m=n(60679),f=n(86088),v=n(22303),y=n(48521);function b(e,t,n,s){i||(i="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=s;else if(a>1){for(var r=new Array(a),l=0;l<a;l++)r[l]=arguments[l+3];t.children=r}if(t&&o)for(var d in o)void 0===t[d]&&(t[d]=o[d]);else t||(t=o||{});return{$$typeof:i,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const S=[g.kAppearanceRangeButtons,g.kKeyboardTabToAll];class w extends s.PureComponent{static contextType=d.Z;refEditZoom=s.createRef();state={editing:!1};static defaultProps={disabled:!1};setZoomLevel=(e,t,n)=>{this.props.onZoomUpdated(e,n);const i=this.refEditZoom.current,s=Math.round(100*e);i&&!isNaN(e)&&(i.value=s.toString())};resetZoom=()=>{this.setZoomLevel(this.props.defaultZoomLevel),v.Z.dispatchZoomUI(this.props.defaultZoomLevel)};updateZoomLevel=()=>{const e=parseFloat(this.props.zoom);this.setZoomLevel(e,this.props.delay)};zoomInStep=()=>{this.setZoomLevel(parseFloat((this.props.zoom+this.props.step).toFixed(2)))};zoomOutStep=()=>{this.setZoomLevel(parseFloat((this.props.zoom-this.props.step).toFixed(2)))};zoomHalf=()=>{this.setZoomLevel(parseFloat((this.props.zoom/2).toFixed(2)))};zoomDouble=()=>{this.setZoomLevel(parseFloat((2*this.props.zoom).toFixed(2)))};handleKeyDown=e=>{e.keyCode===r.Z.KEY_LEFT?(this.zoomOutStep(),e.preventDefault()):e.keyCode===r.Z.KEY_RIGHT&&(this.zoomInStep(),e.preventDefault())};rangeChanged=e=>{const{value:t}=e.target;this.setZoomLevel(parseFloat(t),this.state.editing,this.props.delay)};_onEditKeyDown=e=>{const{step:t,zoom:n}=this.props;if(e.keyCode===r.Z.KEY_ESCAPE)this._onEditZoomBlur();else if(e.keyCode===r.Z.KEY_SUBTRACT)this.setZoomLevel(n-t,!0),e.preventDefault();else if(e.keyCode===r.Z.KEY_ADD)this.setZoomLevel(n+t,!0),e.preventDefault();else if(e.keyCode===r.Z.KEY_RETURN){let e=parseFloat(this.refEditZoom.current?.value)/100;0!==e&&e===parseFloat(e)||(e=1),this.setZoomLevel(e)}};toggleEditZoom=()=>{this.props.disabled||this.setState((e=>({editing:!e.editing})),(()=>this.refEditZoom.current?.select()))};_onEditZoomBlur=()=>{this._activeElement&&(this._activeElement.focus(),delete this._activeElement),this.setState({editing:!1})};onMouseEnter=()=>{!1!==this.props.scrolling&&this.context.document.addEventListener("wheel",this.onMouseWheel,!0)};onMouseLeave=()=>{!1!==this.props.scrolling&&this.context.document.removeEventListener("wheel",this.onMouseWheel,!0)};onMouseDown=e=>{(0,m.W$)(e)?e.preventDefault():this._activeElement=this.context.document.activeElement};onMouseUp=()=>{this.props.delay&&this.updateZoomLevel(),this._activeElement&&(this._activeElement.focus(),delete this._activeElement)};onMouseWheel=e=>{e.deltaX<0?this.zoomOutStep():e.deltaX>0?this.zoomInStep():e.deltaY>0?this.zoomOutStep():e.deltaY<0&&this.zoomInStep()};incrementCount=()=>{this.setZoomLevel(this.props.zoom+this.props.step)};decrementCount=()=>{this.setZoomLevel(this.props.zoom-this.props.step)};onPageZoomUpdated=e=>{const t=o.Z.getActiveWebView(this.context.vivaldiWindowId);t&&t.setZoom(e)};showCustomizeMenu=(e,t)=>{const n=this.props.customizeMenu?.("Zoom");n&&(e.persist(),e.preventDefault(),e.stopPropagation(),(0,h.Z)(this.context,n)(e))};renderSubmit=()=>{const e=this.props.disabled||(this.props.defaultZoomLevel?this.props.defaultZoomLevel===this.props.zoom:1===this.props.zoom);return b(l.ZP,{onClick:this.resetZoom,tooltip:(0,c.Z)("Reset Zoom"),disabled:e,title:(0,c.Z)("Reset"),tabIndex:this.props.inFooter?this.props.prefValues[g.kKeyboardTabToAll]:0})};render(){const{customizeMenu:e,zoom:t}=this.props,n=this.props.prefValues[g.kAppearanceRangeButtons],i=this.state.editing?(0,y.jsx)("input",{className:"zoom-percent",type:"number",ref:this.refEditZoom,defaultValue:Math.round(100*t),onKeyDown:this._onEditKeyDown,onBlur:this._onEditZoomBlur,step:"1",disabled:this.props.disabled}):b("span",{className:p()({"zoom-percent":!0,disabled:this.props.disabled}),onMouseDown:this.onMouseDown,onClick:this.toggleEditZoom},void 0,`${Math.round(100*t)} %`),s=this.props.inFooter?this.props.prefValues[g.kKeyboardTabToAll]:0;return b("div",{onContextMenu:e?this.showCustomizeMenu:null,className:"page-zoom-controls"},void 0,this.props.inFooter&&this.renderSubmit(),!n&&(0,y.jsxs)(y.Fragment,{children:[b("input",{type:"range",min:this.props.minLevel,max:this.props.maxLevel,step:this.props.step,onChange:this.rangeChanged,onKeyDown:this.handleKeyDown,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onMouseDown:-1===s?this.onMouseDown:null,onMouseUp:this.onMouseUp,onTouchEnd:this.onMouseUp,value:t,disabled:this.props.disabled,tabIndex:s}),i]}),n&&(0,y.jsxs)(y.Fragment,{children:[b(l.ZP,{onClick:this.decrementCount,tooltip:(0,c.Z)("Zoom Out"),disabled:this.props.disabled,image:f.M2k.medium,tabIndex:s}),i,b(l.ZP,{onClick:this.incrementCount,tooltip:(0,c.Z)("Zoom In"),disabled:this.props.disabled,image:f.md4.medium,tabIndex:s})]}),!this.props.inFooter&&this.renderSubmit())}}const C=(0,a.Z)(w,S)},71828:(e,t,n)=>{"use strict";n.d(t,{OK:()=>o,VH:()=>h,Wp:()=>r,XF:()=>d,XZ:()=>p,Zh:()=>u,an:()=>i,bI:()=>s,m6:()=>f,oJ:()=>g,pL:()=>a,qt:()=>c,rM:()=>l,s5:()=>m});const i=1,s=.5,o=2,a=.25,r=.05,l=1,d=.2,c=5,u=.1,p=1,h=.5,g=2,m=.05,f=1},93196:(e,t,n)=>{"use strict";n.d(t,{FD:()=>be,CN:()=>ke,xU:()=>Se,os:()=>Ce});var i=n(54614),s=n(43630),o=n(39005),a=n(30626),r=n(15590),l=n(2934),d=n(12442),c=n(15800),u=n(84675),p=n(21788),h=n(57082),g=n(87210),m=n(5198),f=n(99827),v=n(2431),y=n(46382),b=n(21838),S=n(62882),w=n(59322),C=n(96951),A=n(18350),I=n(15285),T=n(14481),Z=n(68247),E=n(29087),k=n(92413),_=n(40893),N=n(43656),P=n(33638);const D=new class{switchTabBackBySetting(e,t){P.Z.dispatch({actionType:"TAB_SWITCH_BACK_SETTING",winId:e,event:t})}switchTabForwardBySetting(e,t){P.Z.dispatch({actionType:"TAB_SWITCH_FORWARD_SETTING",winId:e,event:t})}disbandTileGroup(e){P.Z.dispatch({actionType:"DISBAND_TILE_GROUP",winId:e})}stackCreate(e){P.Z.dispatch({actionType:"TAB_STACK_CREATE",winId:e})}stackDissolve(e){P.Z.dispatch({actionType:"TAB_STACK_DISSOLVE",winId:e})}stackRemove(e){P.Z.dispatch({actionType:"TAB_STACK_REMOVE",winId:e})}stackTileGrid(e){P.Z.dispatch({actionType:"TAB_STACK_TILE_GRID",winId:e})}stackTileHorizontal(e){P.Z.dispatch({actionType:"TAB_STACK_TILE_HORIZONTAL",winId:e})}stackTileVertical(e){P.Z.dispatch({actionType:"TAB_STACK_TILE_VERTICAL",winId:e})}viewPageSource(e){P.Z.dispatch({actionType:"TAB_VIEW_PAGE_SOURCE",winId:e})}toggleTabThumbnail(e){P.Z.dispatch({actionType:"TAB_TOGGLE_THUMBNAIL",winId:e})}};var M=n(2699),O=n(32773),x=n(54058),L=n(76501),R=n(70864),B=n(83526),F=n(57904),W=n(63153),U=n(15489),V=n(29104),H=n(22303),G=n(56371),$=n(78347),K=n(92292),z=n(26036),j=n(7064),Y=n(71828),X=n(35369),Q=n(37182),q=n(1407),J=n(19626),ee=n(80225),te=n(2497),ne=n(89175),ie=n(8684);async function se(e){const t=(0,te.Z)(e),n=await async function({showSaveFilePicker:e}){try{return await e({suggestedName:"Vivaldi Feeds.opml",types:[{accept:{"text/opml+xml":[".opml",".xml"]},description:(0,G.Z)(".opml files")}]})}catch(e){return"AbortError"!==e.name&&console.warn("Failed to select file",e),Promise.resolve(void 0)}}(t);if(n)try{const e=await n.createWritable();await e.write(function(){const e=E.Z.get(ne.kRssSettings),t=document.implementation.createDocument(null,"opml"),n=t.createProcessingInstruction("xml",'version="1.0" encoding="utf-8"'),i=t.documentElement;t.insertBefore(n,t.firstChild),i.setAttribute("version","1.0");const s=t.createElement("head");i.appendChild(s);const o=t.createElement("title");o.appendChild(t.createTextNode("Vivaldi Feed Reader Export")),s.appendChild(o);const a=t.createElement("dateCreated"),r=(new Date).toUTCString();a.appendChild(t.createTextNode(r)),s.appendChild(a);const l=t.createElement("body");if(e.length>0)e.forEach((e=>{const n=t.createElement("outline");n.setAttribute("type","rss"),n.setAttribute("text",e.title),n.setAttribute("title",e.title),n.setAttribute("xmlUrl",e.url),l.appendChild(n)}));else{const e=t.createElement("outline");e.setAttribute("type","comment"),e.setAttribute("text","No feed subscriptions to export."),l.appendChild(e)}return i.appendChild(l),(new XMLSerializer).serializeToString(t).replace(/></g,">\n<")}()),await e.close(),(0,ie.c)({title:(0,G.Z)("Finished Exporting Feeds"),tag:"VIVALDI_FEEDS_EXPORT_DONE"})}catch(e){console.error("Exporting Feeds failed: ",e)}}var oe=n(21343),ae=n(37461),re=n(69046),le=n(10334),de=n(86461),ce=n(36436),ue=n(19842),pe=n(55603),he=n(21191),ge=n(92521),me=n(6826),fe=n(44850);const ve=!1,ye=e=>"object"==typeof e&&"wheel"===e.type,be={COMMAND_OPEN_LINK:"https://www.vivaldi.com"},Se=e=>Ee[e],we=["COMMAND_CLIPBOARD_UNDO","COMMAND_CLIPBOARD_REDO","COMMAND_CLIPBOARD_CUT","COMMAND_CLIPBOARD_COPY","COMMAND_CLIPBOARD_PASTE","COMMAND_CLIPBOARD_SELECT_ALL","COMMAND_HIDE_OTHERS","COMMAND_HIDE_VIVALDI","COMMAND_SHOW_ALL"],Ce=e=>we.includes(e);function Ae(){return!U.ZP.isGuest()&&!E.Z.get(ne.kMailIsTurnedOff)}function Ie(){const e=o.Z.getActiveListEntry();return!!e&&(0,pe.Ro)(e)}function Te(e){const t=C.ZP.getActivePage(e)?.url??"";return(0,ce.xl)(t)&&t.includes("mail.html?path=composer")}function Ze(e){return!!a.Z.getActiveWebView(e)}const Ee={COMMAND_TAB_PERIODIC_RELOAD:{type:"mixed",defaultValue:60,unit:(0,G.Z)("time","Seconds"),min:60,max:31556926,validity:/^((?<min>\d+)['′m]\s*((?<sec1>\d+)["″s])?|((?<sec2>\d+)["″s])$)/i},COMMAND_MAIN_ZOOM:{type:"number",unit:(0,G.Z)("Percentage"),defaultValue:100*Y.m6,min:100*Y.XF,max:100*Y.qt},COMMAND_MAIN_UI_ZOOM:{type:"number",unit:(0,G.Z)("Percentage"),defaultValue:100*Y.m6,min:100*Y.bI,max:100*Y.OK},COMMAND_DEFAULT_MAIN_ZOOM:{type:"number",unit:(0,G.Z)("Percentage"),defaultValue:100*Y.m6,min:100*Y.bI,max:100*Y.OK}},ke=[{name:"COMMAND_OPEN_NEW_OR_REOPEN_LAST_CLOSED_WINDOW",action:async e=>{j.Z.sessionsPrivate.restoreLastClosed((t=>{if(!t)if(U.ZP.isGuest())y.Z.openGuestWindow();else{const t={focused:!0,incognito:!1};W.Z.openWindow(e.windowId,"window.html","normal",t)}}))},isEnabled:ge.Z,isVisible:e=>U.ZP.isIncognito(e),withNoWindow:!0,showInQC:!0,category:"CATEGORY_COMMAND_APPLICATION",guid:"08FE16EB-5E49-47C4-9679-A9FF4CDEA029",...(0,z.Z)("command","New Normal Window")},{name:"COMMAND_NEW_WINDOW",action:e=>{if(U.ZP.isIncognito(e.windowId))j.Z.sessionsPrivate.restoreLastClosed((t=>{if(!t)if(U.ZP.isGuest())y.Z.openGuestWindow();else{const t={focused:!0,incognito:!1};W.Z.openWindow(e.windowId,"window.html","normal",t)}}));else if(U.ZP.isGuest())y.Z.openGuestWindow();else{const t={focused:!0,incognito:!1};W.Z.openWindow(e.windowId,"window.html","normal",t)}},isEnabled:ge.Z,isVisible:ge.Z,withNoWindow:!0,showInQC:!0,category:"CATEGORY_COMMAND_APPLICATION",guid:"b6ddaabf-d87f-4c2c-affa-ce81bb30bfca",...(0,z.Z)("command","New Window")},{name:"COMMAND_NEW_PRIVATE_WINDOW",action:e=>W.Z.openIncognitoWindow(e.windowId),isEnabled:ge.Z,isVisible:e=>!U.ZP.isGuest(),withNoWindow:!0,showInQC:!0,category:"CATEGORY_COMMAND_APPLICATION",guid:"176ff9a8-a516-4015-9b0a-14434746ce9b",...(0,z.Z)("New Private Window")},{name:"COMMAND_NEW_GUEST_WINDOW",action:()=>y.Z.openGuestWindow(),isEnabled:ge.Z,isVisible:e=>!U.ZP.isIncognito(e),category:"CATEGORY_COMMAND_APPLICATION",showInQC:!0,guid:"1453aae1-130d-465f-98eb-cbda5061445d",...(0,z.Z)("New Guest Window")},{name:"COMMAND_MANAGE_PEOPLE",action:()=>y.Z.managePeople(),category:"CATEGORY_COMMAND_APPLICATION",isEnabled:ge.Z,isVisible:ge.Z,showInQC:!0,guid:"49023738-dc53-4fce-8fd8-68bcdc89be34",...(0,z.Z)("Manage Profiles")},{name:"COMMAND_CLOSE_WINDOW",action:e=>W.Z.close(e.windowId),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"172583c9-c8d5-45f7-9e4d-65cff9333679",...(0,z.Z)("command","Close Window")},{name:"COMMAND_SHOW_QUICK_COMMANDS",action:e=>y.Z.showQuickCommand(e.windowId),showInQC:!1,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"f8d653f3-1371-4cf2-ab83-b8c62ad98add",...(0,z.Z)("Quick Commands")},{name:"COMMAND_CUSTOMIZE_TOOLBAR",action:e=>O.Z.edit(ne.kToolbarsNavigation),showInQC:!0,isEnabled:ge.Z,isVisible:e=>!U.ZP.isGuest(),category:"CATEGORY_COMMAND_APPEARANCE",guid:"fd9a4bd8-25a8-4006-8e63-251f166aa862",...(0,z.Z)("Customize Toolbar")},{name:"COMMAND_FULLSCREEN",action:e=>W.Z.toggleFullscreen(e.windowId),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"7420368f-565e-409f-8eec-5b5c578429af",...(0,z.Z)("Fullscreen Mode")},{name:"COMMAND_TASK_MANAGER",action:e=>j.Z.utilities.openTaskManager(e.windowId),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"3aed82ac-e497-4f75-9f13-c5a7df0ac448",...(0,z.Z)("Task Manager")},{name:"COMMAND_SHOW_SETTINGS",action:e=>y.Z.showSettings(e.windowId),isEnabled:ge.Z,isVisible:e=>!U.ZP.isGuest(),withNoWindow:ve,showInQC:!0,category:"CATEGORY_COMMAND_APPLICATION",guid:"1e05a540-7261-427f-a902-8a75f5e81cdd",...(0,z.Z)("Settings")},{name:"COMMAND_SHOW_EXTENSIONS",action:e=>y.Z.showExtensions(e.windowId),withNoWindow:!0,showInQC:!0,isEnabled:ge.Z,isVisible:e=>!U.ZP.isGuest(),category:"CATEGORY_COMMAND_APPLICATION",guid:"ef8d7f53-627c-4286-a03e-7affc92b5ff3",...(0,z.Z)("Extensions")},{name:"COMMAND_SHOW_HISTORY",action:e=>y.Z.showHistory(e.windowId),withNoWindow:!0,isEnabled:ge.Z,isVisible:e=>!U.ZP.isGuest(),showInQC:!0,category:"CATEGORY_COMMAND_APPLICATION",guid:"dd8723f0-b05a-4d22-b55b-b1c1a6e282e2",...(0,z.Z)("History")},{name:"COMMAND_SHOW_NOTES",action:e=>y.Z.showNotes(e.windowId),withNoWindow:!0,showInQC:!0,isEnabled:ge.Z,isVisible:e=>!U.ZP.isGuest(),category:"CATEGORY_COMMAND_APPLICATION",guid:"97006589-839d-4c3e-aa37-311a864618b5",...(0,z.Z)("Notes")},{name:"COMMAND_SHOW_BOOKMARKS",action:e=>y.Z.showBookmarks(e.windowId),withNoWindow:!0,isEnabled:ge.Z,isVisible:e=>!U.ZP.isGuest(),showInQC:!0,category:"CATEGORY_COMMAND_APPLICATION",guid:"9cde01a4-9df7-4a2e-84a1-27997c6df705",...(0,z.Z)("Bookmarks")},{name:"COMMAND_SHOW_WELCOME",action:e=>y.Z.showWelcome(e.windowId),isEnabled:ge.Z,isVisible:e=>!U.ZP.isGuest(),withNoWindow:!0,showInQC:!0,category:"CATEGORY_COMMAND_APPLICATION",guid:"3e27424f-656a-48bf-85e4-01364ec27b57",...(0,z.Z)("Vivaldi Welcome Tour")},{name:"COMMAND_SHOW_CLEAR_PRIVATE_DATA",action:e=>y.Z.showClearBrowsingHistoryDialog(e.windowId),isEnabled:ge.Z,isVisible:e=>!U.ZP.isIncognitoOrGuest(e),showInQC:!0,category:"CATEGORY_COMMAND_APPLICATION",guid:"10a45d9e-c539-4c67-92fd-c2332fb41127",...(0,z.Z)("command","Delete Browsing Data")},{name:"COMMAND_SHOW_BOOKMARK_BAR",action:e=>W.Z.toggleBookmarksBar(e.windowId),behavior:"checkbox",showInQC:!0,isEnabled:ge.Z,isVisible:e=>!U.ZP.isGuest(),category:"CATEGORY_COMMAND_APPEARANCE",guid:"42b84fc2-a9c1-425d-a08f-f349dbb6e8a6",...(0,z.Z)("Bookmarks Bar")},{name:"COMMAND_TOGGLE_APPLE_EVENTS",action:()=>Z.Z.toggle(ne.kAllowJavascriptAppleEvents,!0,!1),inMenu:()=>ve,showInQC:ve,isEnabled:ge.Z,isVisible:()=>ve,platforms:["mac"],category:"CATEGORY_COMMAND_APPLICATION",guid:"c8908d2a-9b77-4eb3-bdcf-327f5d78fe60",...(0,z.Z)("Apple Events")},{name:"COMMAND_TOGGLE_MENU_POSITION",action:()=>Z.Z.toggle(ne.kMenuDisplay,"vivaldi","top"),inMenu:()=>!0,showInQC:!0,isEnabled:ge.Z,isVisible:()=>!0,platforms:["linux","windows"],behavior:"checkbox",category:"CATEGORY_COMMAND_APPEARANCE",guid:"6c186895-cfb1-4ce5-8d9b-21484a438ef6",...(0,z.Z)("command","Menu Position")},{name:"COMMAND_TOGGLE_FOOTER",action:e=>W.Z.toggleStatusBar(e.windowId),behavior:"checkbox",showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"ea570117-f29e-4fd2-b4de-649a4660a4f2",...(0,z.Z)("other","Status Bar")},{name:"COMMAND_TOGGLE_STARTPAGE_NAVIGATION",action:()=>Z.Z.toggle(ne.kStartpageNavigation,"off","on"),behavior:"checkbox",showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"a1563471-d01b-4e7f-8a40-552120443cd5",...(0,z.Z)("other","Start Page Navigation")},{name:"COMMAND_TOGGLE_PRIVACY_STATS",action:()=>Z.Z.toggle(ne.kStartpageSpeedDialPrivacyStatsShow,!1,!0),behavior:"checkbox",showInQC:!1,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"dad8a820-629c-4146-b105-9ad0b3755b25",...(0,z.Z)("other","Show Privacy Statistics")},{name:"COMMAND_SHOW_PRIVACY_STATS",action:e=>y.Z.showPrivacyStatsDialog(e.windowId),behavior:"checkbox",showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"bbe93145-cdcd-4897-880f-4c2e3f4f3029",...(0,z.Z)("other","Show Privacy Statistics")},{name:"COMMAND_TOGGLE_INTERFACE_COLOR",action:()=>M.Z.setNextTheme(),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"0a9303d7-c8b0-4b0d-b6e0-02a5ba457360",...(0,z.Z)("Next Theme")},{name:"COMMAND_EXIT",action:e=>{j.Z.runtimePrivate.exit("menu"!==e.origin&&E.Z.get(ne.kSystemShowExitConfirmationDialog))},inMenu:()=>!0,showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"842121fd-5e5a-48f3-95ad-947d37aebedb",...(0,z.Z)("verb","Exit")},{name:"COMMAND_QUIT_MAC_MAYBE_WARN",action:()=>{},inMenu:()=>ve,showInQC:!1,isEnabled:ge.Z,isVisible:()=>ve,platforms:["mac"],category:"CATEGORY_COMMAND_APPLICATION",withNoWindow:!0,guid:"ff0ac033-0fcf-4c77-b664-7f7c3e4a2044",...(0,z.Z)("Quit $1",["Vivaldi"])},{name:"COMMAND_TOGGLE_WARN_ON_QUIT",action:()=>{Z.Z.toggle(ne.kSystemShowExitConfirmationDialog,!0,!1)},behavior:"checkbox",showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"16b932e4-0a18-4c50-bcdf-089fd60fb1d8",...(0,z.Z)("Show Exit Confirmation Dialog")},{name:"COMMAND_SHOW_HELP",action:e=>w.ZP.openURL(e.windowId,"https://help.vivaldi.com/?pk_campaign=v-menu"),withNoWindow:!0,showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"643fde7b-ac28-4241-b0d0-bc221ee88785",...(0,z.Z)("browser","Vivaldi Help")},{name:"COMMAND_SHOW_KEYBOARDSHORTCUTS",action:e=>y.Z.showKeyboardShortcuts(e.windowId),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"12ab9d03-8327-4e5d-a905-609af0ab5528",...(0,z.Z)("Keyboard Cheat Sheet")},{name:"COMMAND_REPORT_BUG",action:e=>w.ZP.openURL(e.windowId,"https://help.vivaldi.com/desktop/troubleshoot/reporting-a-bug-in-vivaldi/?pk_campaign=v-menu"),withNoWindow:!0,showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"f9f6da04-7ebc-4fb4-8633-f122ca145217",...(0,z.Z)("Report a Problem")},{name:"COMMAND_SHOW_PAGE_ACCESS_KEYS",action:e=>y.Z.showPageAccessKeys(e.windowId),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"7838709a-7042-4913-b541-25ff2268f774",...(0,z.Z)("Show Webpage Access Key Shortcuts")},{name:"COMMAND_BREAKMODE_TOGGLE",action:e=>r.Z.toggleBreakMode(e.windowId),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"a3596917-8095-42e9-8efb-31ad8ad0cbaa",...(0,z.Z)("command","Break Mode")},{name:"COMMAND_START_CHROMECAST",action:e=>y.Z.startCasting(e.windowId),showInQC:!0,isEnabled:e=>Ze(e),isVisible:ge.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"8b650af8-6342-48f5-a45b-2d56933fb389",...(0,z.Z)("Cast")},{name:"COMMAND_MAIN_TOGGLE_TAB_BAR",action:e=>W.Z.toggleTabs(e.windowId),behavior:"checkbox",showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"c4bfbdc9-1e24-4b60-bbfe-a706be090f7b",...(0,z.Z)("command","Tab Bar")},{name:"COMMAND_MAIN_TOGGLE_PANEL_TOGGLE",action:e=>W.Z.togglePanelToggle(e.windowId),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"1ad09f05-6a12-41e9-9bf3-ddf58f24bea4",...(0,z.Z)("Panel Toggle")},{name:"COMMAND_MAIN_TOGGLE_ADDRESS_BAR",action:e=>W.Z.toggleAddressBar(e.windowId),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"14fc610b-d5dc-49fc-973d-4d666394948b",...(0,z.Z)("other","Address Bar")},{name:"COMMAND_MAIN_TOGGLE_UI",action:e=>W.Z.toggleMinimalUI(e.windowId),behavior:"checkbox",showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"3b773be0-6af6-47f4-807c-19ad590693a2",...(0,z.Z)("Toggle UI")},{name:"COMMAND_CAPTURE_AREA_TO_DISK",action:e=>u.Z.captureArea(e.windowId,"file"),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"6ae02ffe-8039-4689-9e73-a7cd5ae792b3",...(0,z.Z)("Capture Area to File")},{name:"COMMAND_CAPTURE_AREA_TO_CLIPBOARD",action:e=>u.Z.captureArea(e.windowId,"clipboard"),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"2c2057eb-ec79-4d9e-a8de-5bbb0c2a6249",...(0,z.Z)("Capture Area to Clipboard")},{name:"COMMAND_FOCUS_NEXT",action:e=>y.Z.stepFocus(e.context,!0),repeat:!0,showInQC:!1,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"8202e8f1-c0d1-4a85-bbab-f66a52656a30",...(0,z.Z)("Focus Next Pane")},{name:"COMMAND_FOCUS_PREVIOUS",action:e=>y.Z.stepFocus(e.context,!1),repeat:!0,showInQC:!1,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"0dc4e130-6728-46e0-a632-3a2e7d817f2a",...(0,z.Z)("Focus Previous Pane")},{name:"COMMAND_NEW_TAB",action:e=>{const t="COMMAND_NEW_TAB";if(!h.Z.hasListener(t))return w.ZP.openURL(e.windowId,"");h.Z.onCommand(e.windowId,t)},withNoWindow:!0,showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"b3515e1b-9cf2-4ba0-ba34-fac6ce308b08",...(0,z.Z)("command","New Tab")},{name:"COMMAND_NEW_TAB_OUTSIDE_GROUP",action:e=>w.ZP.openURL(e.windowId,""),withNoWindow:!0,showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"4b4d97fa-f94d-4bc1-80b6-2849a56dbe42",...(0,z.Z)("command","New Top Level Tab")},{name:"COMMAND_NEW_BACKGROUND_TAB",action:e=>w.ZP.openURL(e.windowId,"",{inBackground:!0}),withNoWindow:!0,showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"5c2631d5-69cd-4bd5-b6e2-93b8a6ca0281",...(0,z.Z)("New Background Tab")},{name:"COMMAND_CLONE_TAB",action:e=>C.ZP.isSelecting(e.windowId)?w.ZP.clonePages(C.ZP.getSelectedPages(e.windowId)):w.ZP.clonePages(X.aV.of(C.ZP.getActivePage(e.windowId)).filter(Boolean)),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"74393bfb-4c31-4b25-afc4-471cb9d621ca",...(0,z.Z)("Duplicate Selected Tabs")},{name:"COMMAND_MOVE_TAB_TO_NEW_WINDOW",action:e=>{const t=C.ZP.getActivePage(e.windowId);t&&w.ZP.detachPage(t)},showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"d03d4bc8-26c4-49f6-b3ce-23980637ae76",...(0,z.Z)("Move Tab to New Window")},{name:"COMMAND_PIN_TAB",action:e=>w.ZP.toggleSelectedPagesPinned(e.windowId),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"8b413c0e-9024-4fbe-8813-68c76096c87b",...(0,z.Z)("Pin / Unpin Tab")},{name:"COMMAND_CLOSE_TAB",action:e=>w.ZP.close(e.windowId),showInQC:!0,isEnabled:ge.Z,isVisible:e=>{const t=U.ZP.isSettings(e);if(t||"off"!==E.Z.get(ne.kTabsClosePinned))return!0;{const t=E.Z.get(ne.kTabsClosePinnedInStack),n=C.ZP.getActivePage(e);return Boolean(n&&(!n.pinned||(0,re.av)(n)&&t))}},category:"CATEGORY_COMMAND_TAB_ACTION",guid:"f0a3a628-6977-4812-ab11-96a1d1fbc08d",...(0,z.Z)("Close Tab")},{name:"COMMAND_POSITION_TAB_TOP",action:()=>Z.Z.set(ne.kTabsBarPosition,"top"),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"7be0e09e-a13a-4438-ad6b-2d43734e2a7d",...(0,z.Z)("Tabs on Top")},{name:"COMMAND_POSITION_TAB_BOTTOM",action:()=>Z.Z.set(ne.kTabsBarPosition,"bottom"),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"1585fbcb-db49-4b0c-afd0-e3abc19456fd",...(0,z.Z)("Tabs on Bottom")},{name:"COMMAND_POSITION_TAB_LEFT",action:()=>Z.Z.set(ne.kTabsBarPosition,"left"),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"35cac9b1-4c5e-433a-abbb-b69f123b26b9",...(0,z.Z)("Tabs on Left")},{name:"COMMAND_POSITION_TAB_RIGHT",action:()=>Z.Z.set(ne.kTabsBarPosition,"right"),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"f3016405-4ac9-45a2-91d4-ddc8127cd9de",...(0,z.Z)("Tabs on Right")},{name:"COMMAND_CLOSE_TAB_TO_LEFT",action:e=>{const t=C.ZP.getActivePage(e.windowId);if(t){const n=C.ZP.isGroup((0,re.av)(t),e.windowId);w.ZP.closeToLeft(t,n)}},showInQC:!0,isVisible:e=>U.ZP.isSettings(e)||U.ZP.isTabbedBrowser(e)&&!C.ZP.getActivePage(e)?.pinned,isEnabled:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"cd97956b-c939-4271-9037-1676c70e4fa4",...(0,z.Z)("Close Tabs to the Left")},{name:"COMMAND_CLOSE_TAB_TO_RIGHT",action:e=>{const t=C.ZP.getActivePage(e.windowId);if(t){const n=C.ZP.isGroup((0,re.av)(t),e.windowId);w.ZP.closeToRight(t,n)}},showInQC:!0,isVisible:e=>U.ZP.isSettings(e)||U.ZP.isTabbedBrowser(e)&&!C.ZP.getActivePage(e)?.pinned,isEnabled:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"cfb3068d-5e79-4dac-a741-50879d4e81db",...(0,z.Z)("Close Tabs to the Right")},{name:"COMMAND_CLOSE_ALL_BUT_ACTIVE_TAB",action:e=>{const t=C.ZP.getActivePage(e.windowId);if(t){const n=C.ZP.getActiveWorkspace(e.windowId);w.ZP.closeOther(t,n,!1)}},showInQC:!0,isEnabled:ge.Z,isVisible:e=>!C.ZP.getActivePage(e)?.pinned,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"275ca3f7-ecfb-4445-bf87-686cd473536e",...(0,z.Z)("Close Other Tabs")},{name:"COMMAND_TAB_THUMBNAIL",action:e=>D.toggleTabThumbnail(e.windowId),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"c46c994e-81a8-4b4b-ae15-4e64a643af7b",...(0,z.Z)("Tab Thumbnails")},{name:"COMMAND_SHOW_ABOUT",action:e=>w.ZP.openURL(e.windowId,fe.jk.internals.about),category:"CATEGORY_COMMAND_APPLICATION",withNoWindow:!0,isEnabled:ge.Z,isVisible:ge.Z,showInQC:!0,guid:"b5396606-e86b-4cca-bd74-029f3c538423",...(0,z.Z)("About")},{name:"COMMAND_CHECK_FOR_UPDATES",action:()=>j.Z.autoUpdate.checkForUpdates(!0),showInQC:e=>!U.ZP.isGuest()&&!0,isEnabled:ge.Z,isVisible:e=>!U.ZP.isGuest()&&!0,platforms:["windows","mac"],withNoWindow:!0,category:"CATEGORY_COMMAND_APPLICATION",guid:"b4ef4439-df4a-4634-95f7-509c95e42b69",...(0,z.Z)("Check for Updates")},{name:"COMMAND_SHOW_COMMUNITY",action:e=>w.ZP.openURL(e.windowId,"https://vivaldi.net/?pk_campaign=v-menu"),withNoWindow:!0,showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"cb626c77-47cd-46e3-9cf7-d976f50aadbd",...(0,z.Z)("Community Blogs")},{name:"COMMAND_SHOW_CONTRIBUTE",action:e=>w.ZP.openURL(e.windowId,"https://vivaldi.com/contribute"),withNoWindow:!0,showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"36ad2648-9c17-4061-8f7e-4db8b9742869",...(0,z.Z)("Help us Grow")},{name:"COMMAND_SHOW_DONATE",action:e=>{const t=`${q._L}#mtm_campaign=Desktop-Donate-Command`;w.ZP.openURL(e.windowId,t)},withNoWindow:!0,showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"ba38db4d-4a69-4cf2-9dc1-b87fcff57623",...(0,z.Z)("Donate")},{name:"COMMAND_TAB_SWITCH_BACK_SETTING",action:e=>D.switchTabBackBySetting(e.windowId,ye(e.param)?e.param:e.keyState),inMenu:me.Z,isEnabled:ge.Z,isVisible:ge.Z,repeat:!0,showInQC:!1,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"ee5eec5e-9ebf-4faf-b2ec-4fdba8b328d0",...(0,z.Z)("Tab Cycler Back")},{name:"COMMAND_TAB_SWITCH_FORWARD_SETTING",action:e=>D.switchTabForwardBySetting(e.windowId,ye(e.param)?e.param:e.keyState),inMenu:me.Z,repeat:!0,isEnabled:ge.Z,isVisible:ge.Z,showInQC:!1,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"7c2836f2-93e5-445f-9674-46a29759ff34",...(0,z.Z)("Tab Cycler Forward")},{name:"COMMAND_TAB_SWITCH_BACK_ORDER",action:e=>{const t=ye(e.param)?e.param:e.keyState;w.ZP.cycleByOrder(e.windowId,t,{goBack:!0})},repeat:!0,showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"9693c49b-29e0-442e-925d-d34d95f977a4",...(0,z.Z)("Previous Tab (by Order)")},{name:"COMMAND_TAB_SWITCH_FORWARD_ORDER",action:e=>{const t=ye(e.param)?e.param:e.keyState;w.ZP.cycleByOrder(e.windowId,t,{goBack:!1})},repeat:!0,showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"037d899d-b191-49c7-a932-87d8881d7037",...(0,z.Z)("Next Tab (by Order)")},{name:"COMMAND_TAB_SWITCH_FORWARD_HISTORY",action:e=>{const t=ye(e.param)?e.param:e.keyState;w.ZP.cycleByHistory(e.windowId,t,{goBack:!1})},repeat:!0,showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"a645ffdf-6235-425a-896e-3dfd8d4eebb1",...(0,z.Z)("Previous Tab (Recent)")},{name:"COMMAND_TAB_SWITCH_BACK_HISTORY",action:e=>{const t=ye(e.param)?e.param:e.keyState;w.ZP.cycleByHistory(e.windowId,t,{goBack:!0})},repeat:!0,showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"0c39ac37-1deb-4dc8-bea4-54672978af06",...(0,z.Z)("Next Tab (Recent)")},{name:"COMMAND_TAB_MOVE_FIRST",action:e=>h.Z.onCommand(e.windowId,"COMMAND_TAB_MOVE_FIRST"),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"d15338f7-43e6-4e36-b813-aaab299554df",...(0,z.Z)("Move Tabs to Beginning")},{name:"COMMAND_TAB_MOVE_END",action:e=>h.Z.onCommand(e.windowId,"COMMAND_TAB_MOVE_END"),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"478e7f24-51b6-499e-be8d-eda14148f4a7",...(0,z.Z)("Move Tabs to End")},{name:"COMMAND_TAB_MOVE_BACKWARD",action:e=>{const t=C.ZP.getActivePage(e.windowId);t&&w.ZP.stepPage(t,!1,"dotted"===E.Z.get(ne.kTabsStackingMode),e.windowId)},showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"bb5e2bde-67dd-40ff-9d87-43032f048b7a",...(0,z.Z)("Move Active Tab Backward")},{name:"COMMAND_TAB_MOVE_FORWARD",action:e=>{const t=C.ZP.getActivePage(e.windowId);t&&w.ZP.stepPage(t,!0,"dotted"===E.Z.get(ne.kTabsStackingMode),e.windowId)},showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"8338b153-b32d-4a29-962e-cb3bbc5861d0",...(0,z.Z)("Move Active Tab Forward")},{name:"COMMAND_TAB_DISABLE_ALL_RELOADS",action:e=>{"button"===e.origin?T.Z.destroyAllPanelPeriodicAlarms():T.Z.destroyTabPeriodicAlarms(e.windowId)},showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"7d40d732-b025-4722-bc23-b66ada752339",...(0,z.Z)("Disable Periodic Timers")},{name:"COMMAND_TAB_PERIODIC_RELOAD",action:async e=>{if(e.param){const t=(0,le.AE)(e.param),n=C.ZP.getActivePage(e.windowId);if(n){const e=n.vivExtData.ext_id;if(e){const n=t/60;await T.Z.createPeriodicReloadAlarm({id:e,interval:n,from:"tab"})}}}},showInQC:!0,inMenu:me.Z,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"bf7a3a4a-565a-46c7-835c-fa2a6d4b7fdf",...(0,z.Z)("tab","Periodic Reload")},{name:"COMMAND_PAGE_COPY_ALL_URLS",action:e=>w.ZP.copyAllUrls(e.windowId,C.ZP.getActiveWorkspace(e.windowId)),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"259f485f-3892-43e3-b29e-e8f4ccb29a5e",...(0,z.Z)("other","Copy All Links")},{name:"COMMAND_PAGE_SELECTION_CURRENT",action:e=>{const t=C.ZP.getActivePage(e.windowId);t&&w.ZP.setSelection(t)},showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"2cd718aa-76d4-4bd4-9c55-6117822d402e",...(0,z.Z)("other","Select Current Tab")},{name:"COMMAND_PAGE_SELECTION_EXPAND_PREVIOUS",action:e=>{const t=C.ZP.getActivePage(e.windowId);t&&w.ZP.expandSelectionPrevious(t)},showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"e245bce5-20a7-481f-910e-23bf1de86748",...(0,z.Z)("other","Select Previous Tab")},{name:"COMMAND_PAGE_SELECTION_EXPAND_NEXT",action:e=>{const t=C.ZP.getActivePage(e.windowId);t&&w.ZP.expandSelectionNext(t)},showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"23e27390-f1bf-4ec3-92b5-7634daeabc5b",...(0,z.Z)("other","Select Next Tab")},{name:"COMMAND_PAGE_SELECTION_TOGGLE_RELATED",action:e=>{const t=C.ZP.getActivePage(e.windowId);t&&w.ZP.toggleRelatedSelection(t)},showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"7ef25cfa-632f-4872-832c-ca6c9dfb5769",...(0,z.Z)("other","Select Related Tabs")},{name:"COMMAND_PAGE_SELECTION_CLEAR",action:e=>w.ZP.clearSelection(e.windowId),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"cf44c36e-ab42-4700-a80e-93f5f504c72b",...(0,z.Z)("other","Deselect Tabs")},{name:"COMMAND_RENAME_TAB",action:e=>h.Z.onCommand(e.windowId,"COMMAND_RENAME_TAB"),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"80a8d5e6-b2df-4bac-b068-4b92aef93d57",...(0,z.Z)("Rename Tab")},{name:"COMMAND_RENAME_TAB_STACK",action:e=>h.Z.onCommand(e.windowId,"COMMAND_RENAME_TAB_STACK"),showInQC:!0,isEnabled:ge.Z,isVisible:e=>{if(U.ZP.isSettings(e))return!0;{const t=C.ZP.getActivePage(e);return!!t&&C.ZP.isGroup((0,re.av)(t),e)}},category:"CATEGORY_COMMAND_TAB_ACTION",guid:"a453b19c-8c8e-48e4-8e5b-f9d494086b0d",...(0,z.Z)("Rename Tab Stack")},{name:"COMMAND_TAB_SWITCH_1",action:e=>w.ZP.activateTabByIndex(e.windowId,0),showInQC:!1,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"a4d46cc3-e258-4c20-ab39-3174ec9acbb9",...(0,z.Z)("Switch to Tab 1")},{name:"COMMAND_TAB_SWITCH_2",action:e=>w.ZP.activateTabByIndex(e.windowId,1),showInQC:!1,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"3a792281-c3a3-4501-b64c-b5173206195d",...(0,z.Z)("Switch to Tab 2")},{name:"COMMAND_TAB_SWITCH_3",action:e=>w.ZP.activateTabByIndex(e.windowId,2),showInQC:!1,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"5e570a93-4779-4266-aebe-f2abe0e081ae",...(0,z.Z)("Switch to Tab 3")},{name:"COMMAND_TAB_SWITCH_4",action:e=>w.ZP.activateTabByIndex(e.windowId,3),showInQC:!1,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"34281a36-77c7-4f3c-99e1-73529174cfb6",...(0,z.Z)("Switch to Tab 4")},{name:"COMMAND_TAB_SWITCH_5",action:e=>w.ZP.activateTabByIndex(e.windowId,4),showInQC:!1,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"71cd67b0-77bb-4cf3-a7ee-8e26462eb42e",...(0,z.Z)("Switch to Tab 5")},{name:"COMMAND_TAB_SWITCH_6",action:e=>w.ZP.activateTabByIndex(e.windowId,5),showInQC:!1,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"d8b8a23c-f47b-4341-8adc-844cc52562b1",...(0,z.Z)("Switch to Tab 6")},{name:"COMMAND_TAB_SWITCH_7",action:e=>w.ZP.activateTabByIndex(e.windowId,6),showInQC:!1,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"c537cc07-a3ff-4151-997c-40e25056e65d",...(0,z.Z)("Switch to Tab 7")},{name:"COMMAND_TAB_SWITCH_8",action:e=>w.ZP.activateTabByIndex(e.windowId,7),showInQC:!1,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"710bb550-7dea-4436-9d0c-fea152299507",...(0,z.Z)("Switch to Tab 8")},{name:"COMMAND_TAB_SWITCH_9",action:e=>w.ZP.activateTabByIndex(e.windowId,8),showInQC:!1,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"91f469f5-f527-433c-a1fa-2e3f399c7820",...(0,z.Z)("Switch to Tab 9")},{name:"COMMAND_TAB_SWITCH_LAST",action:e=>w.ZP.openLastPage(e.windowId),showInQC:!1,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"750d7779-97ec-493d-afa8-a62c179d6d82",...(0,z.Z)("Switch to the Last Tab")},{name:"COMMAND_HIBERNATE_OTHER_TABS",action:e=>(0,le.Xf)(e.windowId),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"62655c2c-509d-40f9-aec9-d4428af56884",...(0,z.Z)("Hibernate Background Tabs")},{name:"COMMAND_SHOW_CLOSED_TABS",action:e=>h.Z.onCommand(e.windowId,"COMMAND_SHOW_CLOSED_TABS"),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"ba89f260-0036-4f93-95aa-11b65790621d",...(0,z.Z)("Show Closed Tabs")},{name:"COMMAND_TAB_REOPEN_RECENTLY_CLOSED",action:()=>L.Z.undeletePreviousTab(),tweakedShortcut:"ctrl+z",withNoWindow:!0,showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"7e925f03-11a3-47b4-b092-e1c355661796",...(0,z.Z)("Reopen Closed Tab")},{name:"COMMAND_TAB_STACK_TILE_VERTICAL",action:e=>D.stackTileVertical(e.windowId),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"854f8a44-50bd-41bc-8277-acd51e719d1b",...(0,z.Z)("Tile Vertically")},{name:"COMMAND_TAB_STACK_TILE_HORIZONTAL",action:e=>D.stackTileHorizontal(e.windowId),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"2991fb16-2df8-42b5-898a-25a0d028ac41",...(0,z.Z)("Tile Horizontally")},{name:"COMMAND_TAB_STACK_TILE_GRID",action:e=>D.stackTileGrid(e.windowId),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"83c2d2d0-a53b-4521-82b5-4c2e61ed024b",...(0,z.Z)("Tile to Grid")},{name:"COMMAND_DISBAND_TILE_GROUP",action:e=>D.disbandTileGroup(e.windowId),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"a0294e45-6204-406e-b456-2664e4d23b24",...(0,z.Z)("Untile All Tabs in Set")},{name:"COMMAND_TAB_STACK_CREATE",action:e=>D.stackCreate(e.windowId),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"cdd99010-5477-4508-aa28-d671de35dcb2",...(0,z.Z)("Stack Tabs")},{name:"COMMAND_TAB_STACK_DISSOLVE",action:e=>D.stackDissolve(e.windowId),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"61ab7d82-7602-4f72-9f00-07a426ff47c1",...(0,z.Z)("Unstack Tabs")},{name:"COMMAND_TAB_STACK_REMOVE",action:e=>D.stackRemove(e.windowId),showInQC:!0,category:"CATEGORY_COMMAND_TAB_ACTION",isEnabled:ge.Z,isVisible:ge.Z,guid:"56cf9bd1-63b1-4ebf-92b0-c909e5d479c6",...(0,z.Z)("Remove from Tab Stack")},{name:"COMMAND_TAB_STACK_CLOSE",action:e=>{const t=C.ZP.getActivePage(e.windowId);t&&w.ZP.closeTabStack(t.id)},showInQC:!0,category:"CATEGORY_COMMAND_TAB_ACTION",isEnabled:ge.Z,isVisible:e=>{if(U.ZP.isSettings(e))return!0;{const t=C.ZP.getActivePage(e),n="off"!==E.Z.get(ne.kTabsClosePinned);return!!t&&((!t.pinned||n)&&C.ZP.isGroup((0,re.av)(t),e))}},guid:"44fabfe1-fd65-4e7e-a540-5e4d6c742ab8",...(0,z.Z)("Close Tab Stack")},{name:"COMMAND_TAB_STACK_RELOAD",action:e=>{const t=C.ZP.getActivePage(e.windowId);if(t){const n=C.ZP.getGroup((0,re.av)(t),e.windowId);if(n.size>1)return w.ZP.reloadPage(n.map((e=>e.id)))}},showInQC:!0,category:"CATEGORY_COMMAND_TAB_ACTION",isEnabled:ge.Z,isVisible:e=>{if(U.ZP.isSettings(e))return!0;{const t=C.ZP.getActivePage(e);return!!t&&C.ZP.isGroup((0,re.av)(t),e)}},guid:"7eef8423-ea56-4df8-bad4-e3eccd57c8b6",...(0,z.Z)("Reload Tab Stack")},{name:"COMMAND_TOGGLE_MOUSE_GESTURES",action:()=>Z.Z.toggle(ne.kMouseGesturesEnabled,!0,!1),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"01f9d07d-5ec6-41a4-927c-129cef008d65",...(0,z.Z)("Toggle Mouse Gestures")},{name:"COMMAND_TOGGLE_IMAGES",action:e=>{const t=C.ZP.getActivePage(e.windowId);t&&w.ZP.toggleImageLoading(t)},showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"6777b0a7-25d2-4e5e-a4e1-b5fcc0fcdef8",...(0,z.Z)("other","Load Images")},{name:"COMMAND_SET_LOAD_IMAGES_ALWAYS",action:e=>{const t=C.ZP.getActivePage(e.windowId);t&&w.ZP.setImageLoading(t,"always")},behavior:"radio",showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"8d1f63a0-6e3c-42dd-a1b8-9a740f65bafe",...(0,z.Z)("other","Images On")},{name:"COMMAND_SET_LOAD_IMAGES_NEVER",action:e=>{const t=C.ZP.getActivePage(e.windowId);t&&w.ZP.setImageLoading(t,"never")},behavior:"radio",showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"e346b0a7-74c6-4e69-952e-420d33e54a8e",...(0,z.Z)("other","Images Off")},{name:"COMMAND_SET_LOAD_IMAGES_CACHE",action:e=>{const t=C.ZP.getActivePage(e.windowId);t&&w.ZP.setImageLoading(t,"cache")},behavior:"radio",showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"f016e79c-a799-465f-9d01-2869a751774c",...(0,z.Z)("other","Load Images From Cache")},{name:"COMMAND_SET_ANIMATIONS_LOOP",action:()=>K.Z.accessibilityFeatures.animationPolicy.set({value:"allowed"},(()=>{})),behavior:"radio",category:"CATEGORY_COMMAND_TAB_ACTION",isEnabled:ge.Z,isVisible:ge.Z,showInQC:!0,guid:"080beb50-b815-4416-8a69-246907b2805a",...(0,z.Z)("other","Loop Animations")},{name:"COMMAND_SET_ANIMATIONS_NEVER",action:()=>K.Z.accessibilityFeatures.animationPolicy.set({value:"none"},(()=>{})),behavior:"radio",showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"1d4df136-9d8e-4541-b0b9-1a66a5b23444",...(0,z.Z)("other","No Animations")},{name:"COMMAND_SET_ANIMATIONS_ONCE",action:()=>K.Z.accessibilityFeatures.animationPolicy.set({value:"once"},(()=>{})),behavior:"radio",showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"8159b932-9a12-4cef-bf84-f046ab3a2030",...(0,z.Z)("other","Play Animations Once")},{name:"COMMAND_PAGE_TOGGLE_MUTE",action:e=>{const t=C.ZP.getActivePage(e.windowId);t&&w.ZP.toggleMuting(e.windowId,X.aV.of(t))},showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"a6f425df-46e7-48f9-8be2-3b03329fa8d0",...(0,z.Z)("Mute / Unmute Tab")},{name:"COMMAND_PAGE_MUTE_OTHER",action:e=>w.ZP.setMuting(e.windowId,"other","mute"),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"4cb148ba-cb83-4e4a-be3e-43b60a3f3982",...(0,z.Z)("Mute Other Tabs")},{name:"COMMAND_PAGE_MUTE_ALL",action:e=>w.ZP.setMuting(e.windowId,"all","mute"),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"431a57f8-a637-41e5-a4de-1b1c3be081db",...(0,z.Z)("Mute All Tabs")},{name:"COMMAND_PAGE_UNMUTE_OTHER",action:e=>w.ZP.setMuting(e.windowId,"other","unmute"),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"4dc07cbf-4c8b-42ed-8117-c123834a76c5",...(0,z.Z)("Unmute Other Tabs")},{name:"COMMAND_PAGE_UNMUTE_ALL",action:e=>w.ZP.setMuting(e.windowId,"all","unmute"),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"9badb24d-1a7b-46fd-8e95-d50f93812911",...(0,z.Z)("Unmute All Tabs")},{name:"COMMAND_CAPTURE_PAGE_TO_DISK",action:e=>u.Z.captureActivePage(e.windowId,"file"),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"2fe0abe5-421c-4d9d-83ef-16e9f9deb9bb",...(0,z.Z)("Capture Page to File")},{name:"COMMAND_CAPTURE_PAGE_TO_CLIPBOARD",action:e=>u.Z.captureActivePage(e.windowId,"clipboard"),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"2a8349df-be2b-44e8-8db9-4f349a470790",...(0,z.Z)("Capture Page to Clipboard")},{name:"COMMAND_TAB_TRANSLATE_PAGE",action:e=>{const t=C.ZP.getActivePage(e.windowId);if(t&&m.Z.canTranslatePage(t.id))return x.Z.translatePage(t.id)},isEnabled:ge.Z,isVisible:e=>{if(U.ZP.isSettings(e))return!0;{const t=C.ZP.getActivePage(e);return!!t&&m.Z.canTranslatePage(t.id)}},showInQC:!0,category:"CATEGORY_COMMAND_TAB_ACTION",guid:"8d7a4844-f2d5-4cfe-abcd-e2fd99005a41",...(0,z.Z)("tab","Translate Page")},{name:"COMMAND_IMPORT_DATA",action:e=>y.Z.showImportDataDialog(e.windowId),isEnabled:ge.Z,isVisible:e=>!U.ZP.isGuest(),showInQC:!0,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"6c851825-1e73-4ec5-ad5e-2ec9c826524c",...(0,z.Z)("command","Import from Applications or Files")},{name:"COMMAND_EXPORT_DATA",action:e=>j.Z.bookmarksPrivate.export(e.windowId),isEnabled:ge.Z,isVisible:e=>!U.ZP.isGuest(),showInQC:!0,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"fba8ba2b-f317-463a-b685-6d3fb7040845",...(0,z.Z)("Export Bookmarks")},{name:"COMMAND_EXPORT_PASSWORDS",action:e=>(0,ae.T)(e.windowId),showInQC:!0,isEnabled:ge.Z,isVisible:e=>!U.ZP.isGuest(),category:"CATEGORY_COMMAND_APPLICATION",guid:"5cb22644-38b0-4cf1-af79-e9b7ee60b26a",...(0,z.Z)("Export Passwords")},{name:"COMMAND_EXPORT_READINGLIST",action:e=>(0,oe.M8)(e.windowId),showInQC:!0,isEnabled:ge.Z,isVisible:e=>!U.ZP.isGuest(),category:"CATEGORY_COMMAND_APPLICATION",guid:"cf5461e8-938d-484c-b461-6eb9f90bdd6f",...(0,z.Z)("Export Reading List")},{name:"COMMAND_IMPORT_READINGLIST",action:e=>(0,oe.l_)(e.windowId),showInQC:!0,isEnabled:ge.Z,isVisible:e=>!U.ZP.isGuest(),category:"CATEGORY_COMMAND_APPLICATION",guid:"1652b912-2733-4b37-806a-ca935e509c8f",...(0,z.Z)("Import Reading List")},{name:"COMMAND_EXPORT_NOTES",action:e=>(0,ee.aT)(e.windowId),showInQC:!0,isEnabled:ge.Z,isVisible:e=>!U.ZP.isGuest(),category:"CATEGORY_COMMAND_APPLICATION",guid:"fe0e224c-a903-4952-ae3d-d69d8777c24a",...(0,z.Z)("Export Notes")},{name:"COMMAND_IMPORT_NOTES",action:e=>(0,ee.T$)(e.windowId),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"db20661f-37e9-4376-94c8-9aebc7a27628",...(0,z.Z)("Import Notes")},{name:"COMMAND_EXPORT_FEEDS",action:e=>se(e.windowId),showInQC:()=>Ae(),isEnabled:ge.Z,isVisible:()=>Ae(),category:"CATEGORY_COMMAND_APPLICATION",guid:"69f50b42-e844-43c4-a9b5-7feed981d431",...(0,z.Z)("Export Feeds")},{name:"COMMAND_NEW_TAB_LINK",action:e=>{"string"==typeof e.param&&w.ZP.openURL(e.windowId,e.param,{addOpenerTabId:!0})},inMenu:me.Z,isEnabled:ge.Z,isVisible:ge.Z,showInQC:!1,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"62966533-b4f6-4f86-a02c-9753948c6277",...(0,z.Z)("Open Link in New Tab (Over a Link)")},{name:"COMMAND_NEW_BACKGROUND_TAB_LINK",action:e=>{"string"==typeof e.param&&w.ZP.openURL(e.windowId,e.param,{inBackground:!0,addOpenerTabId:!0})},inMenu:me.Z,isEnabled:ge.Z,isVisible:ge.Z,showInQC:!1,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"db3df40a-0d5f-4f87-a57a-cf9640e401c3",...(0,z.Z)("Open Link in Background Tab (Over a Link)")},{name:"COMMAND_READERVIEW_TOGGLE",action:e=>{const t=C.ZP.getActivePage(e.windowId);t&&k.Z.toggleReaderMode(t)},showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"8dd47fc9-4c1f-4487-a475-f55bfa61aaf2",...(0,z.Z)("Toggle Reader View")},{name:"COMMAND_BOOKMARK_SELECTED_TABS",action:e=>h.Z.onCommand(e.windowId,"COMMAND_BOOKMARK_SELECTED_TABS"),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"12bef254-49e1-4205-b14e-acd4d3b4238b",...(0,z.Z)("Bookmark Selected Tabs")},{name:"COMMAND_SAVE_SESSION",action:e=>y.Z.showSaveSessionDialog(e.windowId,{mode:"all"}),isEnabled:ge.Z,isVisible:e=>!U.ZP.isGuest(),showInQC:!0,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"ec8eb1b8-53ef-48f8-bbdc-d0c44af2d5cd",...(0,z.Z)("command","Save All Tabs as Session")},{name:"COMMAND_SAVE_SELECTED_SESSION",action:e=>h.Z.onCommand(e.windowId,"COMMAND_SAVE_SELECTED_SESSION"),isEnabled:ge.Z,isVisible:e=>!U.ZP.isGuest(),showInQC:!0,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"0fe4c500-31cf-4d73-8dc1-281eb4259fe7",...(0,z.Z)("command","Save Selected Tabs as Session")},{name:"COMMAND_OPEN_SESSION",action:e=>y.Z.showOpenSessionDialog(e.windowId),isEnabled:ge.Z,isVisible:e=>!U.ZP.isGuest(),showInQC:!0,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"4a65bd2a-ec3c-42ca-ac7a-67040fe8cebc",...(0,z.Z)("Open Saved Session")},{name:"COMMAND_ADD_BOOKMARK",action:e=>{const t=C.ZP.getActivePage(e.windowId);t&&B.Z.doAction(e.windowId,t.id,"addBookmark")},isEnabled:ge.Z,isVisible:e=>!U.ZP.isGuest(),showInQC:!0,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"844219eb-ed35-4b17-a9f4-7789466c233c",...(0,z.Z)("Create Bookmark")},{name:"COMMAND_ADD_TO_READING_LIST",action:e=>i.Ey(e.windowId,C.ZP.getSelectedPages(e.windowId)),isEnabled:ge.Z,isVisible:e=>!U.ZP.isGuest(),showInQC:!0,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"a73687bc-ddc6-4011-9255-d2ff6a742279",...(0,z.Z)("Add Page to Reading List")},{name:"COMMAND_ADD_TO_WEB_PANEL",action:e=>{const t=C.ZP.getActivePage(e.windowId);t&&R.Z.addByUrl(e.windowId,t.url,!0)},isEnabled:ge.Z,isVisible:e=>!U.ZP.isGuest(),showInQC:!0,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"bd696db9-8c4d-47cb-9899-1f3ac3797c4c",...(0,z.Z)("Add Page to Web Panel")},{name:"COMMAND_BLOCK_TRACKING",action:e=>{const t=C.ZP.getActivePage(e.windowId);t&&(0,J.Fe)(t.id,t.url,"tracking")},isEnabled:ge.Z,isVisible:e=>!U.ZP.isGuest(),showInQC:!0,category:"CATEGORY_COMMAND_APPLICATION",guid:"9afb77f2-d3d3-4596-8a04-58ab48a345fa",...(0,z.Z)("Block / Unblock Tracking")},{name:"COMMAND_BLOCK_TRACKING_AND_ADS",action:e=>{const t=C.ZP.getActivePage(e.windowId);t&&(0,J.Fe)(t.id,t.url,"ad_blocking")},isEnabled:ge.Z,isVisible:e=>!U.ZP.isGuest(),showInQC:!0,category:"CATEGORY_COMMAND_APPLICATION",guid:"da2af162-2140-4aae-8366-3add4793ac17",...(0,z.Z)("Block / Unblock Ads and Tracking")},{name:"COMMAND_FOCUS_ADDRESSFIELD",action:e=>{const t=C.ZP.getActivePage(e.windowId);t&&B.Z.doAction(e.windowId,t.id,"focusAddressField")},showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"96a396d8-d485-4f61-926b-bdab1eddaf94",...(0,z.Z)("Focus Address Field")},{name:"COMMAND_SHOW_DOWNLOADS_POPOUT",action:e=>h.Z.onCommand(e.windowId,"COMMAND_SHOW_DOWNLOADS_POPOUT"),showInQC:!0,category:"CATEGORY_COMMAND_APPLICATION",guid:"a1244975-7c9b-465d-90cf-da919d4598bf",isEnabled:ge.Z,isVisible:e=>(0,de.PK)("DownloadButton",e),...(0,z.Z)("Open Downloads Popup")},{name:"COMMAND_PAGE_REFRESH",action:e=>{const t=C.ZP.getActivePage(e.windowId);t&&B.Z.reload(e.windowId,t.id,!1)},showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"bc31a027-870d-40ba-b3f1-20adcff8fff2",...(0,z.Z)("Reload Page")},{name:"COMMAND_PAGE_RELOAD_NOCACHE",action:e=>{const t=C.ZP.getActivePage(e.windowId);t&&B.Z.reload(e.windowId,t.id,!0)},showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"d92c060c-a9f7-490c-a4a0-8c5cccfa09dd",...(0,z.Z)("Force Page Reload")},{name:"COMMAND_PAGE_SCROLL_UP",action:e=>{const t=C.ZP.getActivePage(e.windowId);t&&B.Z.doAction(e.windowId,t.id,"pageScrollUp")},repeat:!0,showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"078f10b2-1901-4f9e-97b3-1018f7633099",...(0,z.Z)("Page Up")},{name:"COMMAND_PAGE_SCROLL_DOWN",action:e=>{const t=C.ZP.getActivePage(e.windowId);t&&B.Z.doAction(e.windowId,t.id,"pageScrollDown")},repeat:!0,showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"eae41430-4ed9-48e5-9e91-90aeefdb4b4e",...(0,z.Z)("Page Down")},{name:"COMMAND_PAGE_SCROLL_TOP",action:e=>{const t=C.ZP.getActivePage(e.windowId);t&&B.Z.doAction(e.windowId,t.id,"pageScrollTop")},showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"f74cd1f0-c90c-4a2e-8b7b-f06d88cad75a",...(0,z.Z)("Scroll Page to Top")},{name:"COMMAND_PAGE_SCROLL_BOTTOM",action:e=>{const t=C.ZP.getActivePage(e.windowId);t&&B.Z.doAction(e.windowId,t.id,"pageScrollBottom")},showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"29bbb63b-b356-4dfe-aa45-9cf39d94d279",...(0,z.Z)("Scroll Page to Bottom")},{name:"COMMAND_FOCUS_WEBVIEW",action:e=>{const t=C.ZP.getActivePage(e.windowId);t&&B.Z.doAction(e.windowId,t.id,"focusWebView")},showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"f71373d5-f966-4603-b7c5-a4a1722b3989",...(0,z.Z)("Focus Page")},{name:"COMMAND_PAGE_DISABLE_KEYBOARD_SHORTCUTS",action:()=>Z.Z.toggle(ne.kKeyboardShortcutsEnable,!0,!1),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"88d6a31d-9d50-4c8f-a9a2-207ac2b600c3",...(0,z.Z)("Disable Keyboard Shortcuts")},{name:"COMMAND_FOCUS_SEARCHFIELD",action:e=>{const t=C.ZP.getActivePage(e.windowId);t&&B.Z.doAction(e.windowId,t.id,"focusSearchField")},showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"eead069f-a0b5-4f2c-add7-051003353311",...(0,z.Z)("Focus Search Field")},{name:"COMMAND_FIND_IN_PAGE",action:e=>{const t=C.ZP.getActivePage(e.windowId);if(t){F.Z.isFindInPageOpen(t.id)?B.Z.closeFindInPageToolbar(e.windowId,t.id):B.Z.doAction(e.windowId,t.id,"findInPage")}},showInQC:!0,isEnabled:e=>Ze(e),isVisible:ge.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"3686e24b-c64b-4402-9b79-d58dc92c29a8",...(0,z.Z)("Find in Page")},{name:"COMMAND_FIND_NEXT_IN_PAGE",action:e=>{const t=C.ZP.getActivePage(e.windowId);t&&B.Z.doAction(e.windowId,t.id,"findNextInPage")},repeat:!0,showInQC:!0,isEnabled:e=>Ze(e),isVisible:ge.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"055c6e9c-2b9c-4170-aeb0-43f3caf35c3e",...(0,z.Z)("Find Next in Page")},{name:"COMMAND_FIND_PREVIOUS_IN_PAGE",action:e=>{const t=C.ZP.getActivePage(e.windowId);t&&B.Z.doAction(e.windowId,t.id,"findPreviousInPage")},repeat:!0,showInQC:!0,isEnabled:e=>Ze(e),isVisible:ge.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"ef2ad516-3e00-4e9f-9dc3-b1bccd1cc317",...(0,z.Z)("Find Previous in Page")},{name:"COMMAND_PAGE_BACK",action:e=>{const t=C.ZP.getActivePage(e.windowId);t&&B.Z.back(e.windowId,t.id)},showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"f8f93b48-b1ed-43c3-bd65-e7240fd76d3f",...(0,z.Z)("History Back")},{name:"COMMAND_PAGE_FORWARD",action:e=>{const t=C.ZP.getActivePage(e.windowId);t&&B.Z.forward(e.windowId,t.id)},showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"b00e2d3c-a9ba-49b8-bce7-1faf1894a5f3",...(0,z.Z)("History Forward")},{name:"COMMAND_PAGE_REWIND",action:e=>g.Z.navigateRewind(e.windowId),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"67c60e96-fab2-433b-a012-107daa3856ef",...(0,z.Z)("History Rewind")},{name:"COMMAND_PAGE_FAST_FORWARD",action:e=>g.Z.navigateFastforward(e.windowId),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"964655e4-0274-4e26-82a7-b15161958009",...(0,z.Z)("Fast Forward")},{name:"COMMAND_GO_TO_PARENT_DIRECTORY",action:e=>{const t=C.ZP.getActivePage(e.windowId);t&&w.ZP.gotoParentDirectory(e.windowId,t)},showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"c74300b6-635c-4471-b930-8707f29aa94c",...(0,z.Z)("Go to Parent Directory")},{name:"COMMAND_PRINT_PAGE",action:e=>{const t=C.ZP.getActivePage(e.windowId);t&&B.Z.doAction(e.windowId,t.id,"print")},showInQC:!0,isEnabled:e=>Ze(e),isVisible:ge.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"9fbbe402-d11b-479d-ab97-e7e6deb10d36",...(0,z.Z)("Print")},{name:"COMMAND_STOP_PAGE",action:e=>{const t=C.ZP.getActivePage(e.windowId);t&&B.Z.stop(e.windowId,t.id)},showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"77dfb30f-d825-4089-a042-c3f664c656b5",...(0,z.Z)("Stop Loading")},{name:"COMMAND_OPEN_PAGE",action:e=>{j.Z.utilities.openPage(e.windowId)},withNoWindow:!0,showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"e513ed70-7241-4722-83cb-4e8d10da8f02",...(0,z.Z)("a file","Open File")},{name:"COMMAND_SAVE_PAGE",action:e=>{const t=C.ZP.getActivePage(e.windowId);t&&(0,he.Jq)(e.windowId,t.id)},showInQC:!0,isEnabled:e=>Ze(e),isVisible:ge.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"a60f2f63-dd5a-46a6-b425-40e423e88fc0",...(0,z.Z)("Save Page As")},{name:"COMMAND_SEARCH_WITH_SELECTION",action:e=>_.Z.withPageSelection(e.windowId),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"1599c08b-51f2-413b-a572-dcacb43560b2",...(0,z.Z)("Search with Selection")},{name:"COMMAND_DEFAULT_MAIN_ZOOM",action:e=>{"number"==typeof e.param&&H.Z.setDefaultWebPageZoom(e.param)},category:"CATEGORY_COMMAND_APPEARANCE",isEnabled:e=>Ze(e),isVisible:ge.Z,showInQC:!0,guid:"e918fdc6-64f0-47a1-aa29-d0f057dedb60",...(0,z.Z)("Default Page Zoom")},{name:"COMMAND_MAIN_ZOOM",action:e=>{"number"==typeof e.param&&H.Z.setPageZoomPercentage(e.windowId,e.param)},category:"CATEGORY_COMMAND_APPEARANCE",isEnabled:e=>Ze(e),isVisible:ge.Z,showInQC:!0,guid:"9a6682a0-9a28-4e44-b9f9-fc554f02c363",...(0,z.Z)("Page Zoom")},{name:"COMMAND_MAIN_ZOOM_IN",action:e=>H.Z.pageZoomIn(e.windowId),isEnabled:e=>Ze(e),isVisible:ge.Z,showInQC:!0,category:"CATEGORY_COMMAND_APPEARANCE",guid:"9f04836a-e0cb-4220-93dd-57d0a606ee11",...(0,z.Z)("Page Zoom In")},{name:"COMMAND_MAIN_ZOOM_OUT",action:e=>H.Z.pageZoomOut(e.windowId),isEnabled:e=>Ze(e),isVisible:ge.Z,showInQC:e=>Ze(e),category:"CATEGORY_COMMAND_APPEARANCE",guid:"f68b5e96-3c0c-49cb-a8f9-d23b43182bc0",...(0,z.Z)("Page Zoom Out")},{name:"COMMAND_MAIN_ZOOM_HALF",action:e=>H.Z.pageZoomHalf(e.windowId),showInQC:!0,isEnabled:e=>Ze(e),isVisible:ge.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"d5959c06-f090-4f5e-8470-7871986393ab",...(0,z.Z)("Page Zoom Out Half")},{name:"COMMAND_MAIN_ZOOM_DOUBLE",action:e=>H.Z.pageZoomDouble(e.windowId),showInQC:!0,isEnabled:e=>Ze(e),isVisible:ge.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"dd72265d-01e1-483e-a50f-5b018ca20151",...(0,z.Z)("Page Zoom In Double")},{name:"COMMAND_MAIN_ZOOM_RESET",action:e=>H.Z.pageZoomReset(e.windowId),showInQC:!0,isEnabled:e=>Ze(e),isVisible:ge.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"483984bb-e647-4ed5-aae8-f82ef947b450",...(0,z.Z)("Page Zoom Reset")},{name:"COMMAND_MAIN_UI_ZOOM",action:e=>{"number"==typeof e.param&&H.Z.setUIZoomPercentage(e.param)},category:"CATEGORY_COMMAND_APPEARANCE",showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,guid:"6884b1a9-0cfc-4456-8d1b-9cb73c99703f",...(0,z.Z)("UI Zoom")},{name:"COMMAND_MAIN_UI_ZOOM_IN",action:()=>H.Z.uiZoomIn(),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"b56f4b61-eff8-4d57-af15-a19fba06c587",...(0,z.Z)("UI Zoom In")},{name:"COMMAND_MAIN_UI_ZOOM_OUT",action:()=>H.Z.uiZoomOut(),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"d62013de-e829-4454-ab03-71a864341009",...(0,z.Z)("UI Zoom Out")},{name:"COMMAND_MAIN_UI_ZOOM_RESET",action:()=>H.Z.setUIZoomPercentage(100),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"a62aaffc-305b-4892-90c3-5839c0650260",...(0,z.Z)("UI Zoom Reset")},{name:"COMMAND_TAB_VIEW_PAGE_SOURCE",action:e=>{C.ZP.getActivePage(e.windowId)?.isMailPage?h.Z.onCommand(e.windowId,"COMMAND_TAB_VIEW_PAGE_SOURCE"):D.viewPageSource(e.windowId)},showInQC:!0,isEnabled:e=>Ze(e),isVisible:ge.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"7c42ad51-fab5-46c5-acff-663947a13c96",...(0,z.Z)("View Page Source")},{name:"COMMAND_DEVELOPER_TOOLS",action:e=>j.Z.devtoolsPrivate.toggleDevtools(e.windowId,"default"),showInQC:!0,isEnabled:ge.Z,isVisible:e=>!C.ZP.isActiveInternal(e),category:"CATEGORY_COMMAND_APPLICATION",guid:"cdc3b594-d57f-417d-89ee-69be8facd3aa",...(0,z.Z)("Developer Tools")},{name:"COMMAND_DEVTOOLS_INSPECTOR",action:e=>j.Z.devtoolsPrivate.toggleDevtools(e.windowId,"inspect"),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"e6a1c7d5-21ad-4195-bc9e-95ebcb6ee2eb",...(0,z.Z)("Toggle Developer Tools")},{name:"COMMAND_DEVTOOLS_CONSOLE",action:e=>j.Z.devtoolsPrivate.toggleDevtools(e.windowId,"console"),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"1e335c06-1036-4b76-be45-20fea16ab840",...(0,z.Z)("Developer Tools Console")},{name:"COMMAND_SHOW_HOMEPAGE",action:e=>w.ZP.showHomepage(e.windowId,{inCurrent:!0}),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"51eac690-a178-4a3e-99dd-32c73f923559",...(0,z.Z)("title","Homepage")},{name:"COMMAND_TOGGLE_PANEL",action:e=>A.Z.togglePanel(e.windowId),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"5cbd037c-973a-4c3d-aa43-5454bc0ec0e4",...(0,z.Z)("command","Panel")},{name:"COMMAND_FOCUS_PANEL",action:e=>A.Z.setFocus(e.windowId),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"efaed294-3e8e-42fa-9a47-d121e6a11e5f",...(0,z.Z)("Focus Panel")},{name:"COMMAND_FOCUS_PANELBAR",action:e=>h.Z.onCommand(e.windowId,"COMMAND_FOCUS_PANELBAR"),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"454b1c03-0570-4977-99e8-337a1aafdb70",...(0,z.Z)("Focus Panel Controls")},{name:"COMMAND_FOCUS_MAINMENU",action:e=>h.Z.onCommand(e.windowId,"COMMAND_FOCUS_MAINMENU"),inMenu:()=>!0,showInQC:!0,isEnabled:ge.Z,isVisible:()=>!0,platforms:["linux","windows"],category:"CATEGORY_COMMAND_APPEARANCE",guid:"bb1fc5ee-68bd-4e4f-ae16-43269ada0f69",...(0,z.Z)("Focus Main Menu")},{name:"COMMAND_FOCUS_BOOKMARKBAR",action:e=>h.Z.onCommand(e.windowId,"COMMAND_FOCUS_BOOKMARKBAR"),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"d2c3cb39-c495-4aca-bac5-23f2db06ccca",...(0,z.Z)("Focus Bookmarks Bar")},{name:"COMMAND_FOCUS_TABBAR",action:e=>h.Z.onCommand(e.windowId,"COMMAND_FOCUS_TABBAR"),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"ab5fd96a-effc-448f-afdf-2bef8cba6527",...(0,z.Z)("Focus Tab Bar")},{name:"COMMAND_TOGGLE_FLOATING_PANEL",action:()=>A.Z.toggleFloating(),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPEARANCE",guid:"b70131d8-1022-411e-89aa-096a8528ab45",...(0,z.Z)("Toggle Floating Panel")},{name:"COMMAND_SHOW_NEXT_PANEL",action:e=>A.Z.showNextPanel(e.windowId,"next"),showInQC:!0,isEnabled:ge.Z,isVisible:e=>U.ZP.isSettings(e)||Boolean(I.ZP.getNextPanel(e,"next")),category:"CATEGORY_COMMAND_APPEARANCE",guid:"302fdcd3-d914-418f-895d-c4ede9b6c02e",...(0,z.Z)("Open Next Panel")},{name:"COMMAND_SHOW_PREVIOUS_PANEL",action:e=>A.Z.showNextPanel(e.windowId,"previous"),showInQC:!0,isEnabled:ge.Z,isVisible:e=>U.ZP.isSettings(e)||Boolean(I.ZP.getNextPanel(e,"previous")),category:"CATEGORY_COMMAND_APPEARANCE",guid:"4569302b-1f24-440c-965c-da7f9bfca097",...(0,z.Z)("Open Previous Panel")},{name:"COMMAND_TOGGLE_CURRENT_PANEL",action:e=>A.Z.toggleCurrentPanel(e.windowId),showInQC:!0,isEnabled:ge.Z,isVisible:e=>U.ZP.isSettings(e)||Boolean(I.ZP.getSelected(e)),category:"CATEGORY_COMMAND_APPEARANCE",guid:"4128d533-256b-41f1-ba47-3c435ca3f2b4",...(0,z.Z)("Toggle Current Panel")},{name:"COMMAND_SHOW_BOOKMARK_PANEL",action:e=>A.Z.toggleContent(e.windowId,"PanelBookmarks"),isEnabled:ge.Z,isVisible:e=>I.ZP.hasPanel(e,"PanelBookmarks"),showInQC:!0,category:"CATEGORY_COMMAND_APPEARANCE",guid:"48ee057a-93c3-4be5-903b-6d2e701ecb96",...(0,z.Z)("title","Bookmarks Panel")},{name:"COMMAND_SHOW_READING_LIST_PANEL",action:e=>A.Z.toggleContent(e.windowId,"PanelReadingList"),showInQC:!0,isEnabled:ge.Z,isVisible:e=>I.ZP.hasPanel(e,"PanelReadingList"),category:"CATEGORY_COMMAND_APPEARANCE",guid:"9e7b130e-f0af-40db-896d-1a29668bf694",...(0,z.Z)("title","Reading List Panel")},{name:"COMMAND_SHOW_DOWNLOADS_PANEL",action:e=>A.Z.toggleContent(e.windowId,"PanelDownloads"),showInQC:!0,isEnabled:ge.Z,isVisible:e=>I.ZP.hasPanel(e,"PanelDownloads"),category:"CATEGORY_COMMAND_APPEARANCE",guid:"4fcaed1c-c5db-42a8-b47d-7e6674ecd252",...(0,z.Z)("title","Downloads Panel")},{name:"COMMAND_SHOW_HISTORY_PANEL",action:e=>A.Z.toggleContent(e.windowId,"PanelHistory"),isEnabled:ge.Z,isVisible:e=>I.ZP.hasPanel(e,"PanelHistory"),showInQC:!0,category:"CATEGORY_COMMAND_APPEARANCE",guid:"d26038ee-d140-42c5-98b0-27f14b9a8645",...(0,z.Z)("title","History Panel")},{name:"COMMAND_SHOW_NOTES_PANEL",action:e=>A.Z.toggleContent(e.windowId,"PanelNotes"),isEnabled:ge.Z,isVisible:e=>I.ZP.hasPanel(e,"PanelNotes"),showInQC:!0,category:"CATEGORY_COMMAND_APPEARANCE",guid:"96dc03a2-7c99-49ff-9055-f03ac6eb90fe",...(0,z.Z)("title","Notes Panel")},{name:"COMMAND_SHOW_TRANSLATE_PANEL",action:e=>A.Z.toggleContent(e.windowId,"PanelTranslate"),showInQC:!0,isEnabled:ge.Z,isVisible:e=>I.ZP.hasPanel(e,"PanelTranslate"),category:"CATEGORY_COMMAND_APPEARANCE",guid:"ccba139c-9b00-42aa-88cf-6a04a8a15fa5",...(0,z.Z)("title","Translate Panel")},{name:"COMMAND_SHOW_WINDOW_PANEL",action:e=>A.Z.toggleContent(e.windowId,"PanelWindow"),showInQC:!0,isEnabled:ge.Z,isVisible:e=>I.ZP.hasPanel(e,"PanelWindow"),category:"CATEGORY_COMMAND_APPEARANCE",guid:"7dc09b96-d5f1-4999-b2da-d8dd1f1e1651",...(0,z.Z)("title","Windows Panel")},{name:"COMMAND_SHOW_SESSION_PANEL",action:e=>A.Z.toggleContent(e.windowId,"PanelSession"),showInQC:!0,isEnabled:ge.Z,isVisible:e=>I.ZP.hasPanel(e,"PanelSession"),category:"CATEGORY_COMMAND_APPEARANCE",guid:"7cc70878-1af1-4df6-af17-bf843efead3e",...(0,z.Z)("title","Session Panel")},{name:"COMMAND_SHOW_MAIL_PANEL",action:e=>A.Z.toggleContent(e.windowId,"PanelMail"),showInQC:e=>U.ZP.isMail(e),isEnabled:ge.Z,isVisible:e=>I.ZP.hasPanel(e,"PanelMail"),category:"CATEGORY_COMMAND_APPEARANCE",guid:"66a51de3-2c98-468a-ac92-0728cd798ca5",...(0,z.Z)("title","Mail Panel")},{name:"COMMAND_SHOW_CALENDAR_PANEL",action:e=>A.Z.toggleContent(e.windowId,"PanelCalendar"),isEnabled:ge.Z,isVisible:e=>I.ZP.hasPanel(e,"PanelCalendar"),showInQC:!0,category:"CATEGORY_COMMAND_APPEARANCE",guid:"a01cf36b-2f32-4919-924b-80e4e14a41b2",...(0,z.Z)("title","Calendar Panel")},{name:"COMMAND_SHOW_TASKS_PANEL",action:e=>A.Z.toggleContent(e.windowId,"PanelTasks"),isEnabled:ge.Z,isVisible:e=>I.ZP.hasPanel(e,"PanelTasks"),showInQC:!0,category:"CATEGORY_COMMAND_APPEARANCE",guid:"2a76f559-b679-40cc-b3cc-a308d65fa853",...(0,z.Z)("title","Tasks Panel")},{name:"COMMAND_SHOW_FEEDS_PANEL",action:e=>A.Z.toggleContent(e.windowId,"PanelFeeds"),showInQC:e=>U.ZP.isMail(e),isEnabled:ge.Z,isVisible:e=>I.ZP.hasPanel(e,"PanelFeeds"),category:"CATEGORY_COMMAND_APPEARANCE",guid:"9e682c56-34e8-48b8-88d4-b1f716e0bc9c",...(0,z.Z)("title","Feeds Panel")},{name:"COMMAND_SHOW_CONTACTS_PANEL",action:e=>A.Z.toggleContent(e.windowId,"PanelContacts"),showInQC:e=>U.ZP.isMail(e),isEnabled:ge.Z,isVisible:e=>I.ZP.hasPanel(e,"PanelContacts"),category:"CATEGORY_COMMAND_APPEARANCE",guid:"9492e500-30da-44fc-a28b-88c22a06c304",...(0,z.Z)("title","Contacts Panel")},{name:"COMMAND_SHOW_WEB_PANEL_1",action:e=>A.Z.toggleContent(e.windowId,"webpanel 1"),showInQC:!0,isEnabled:ge.Z,isVisible:e=>U.ZP.isSettings(e)||I.ZP.hasWebPanel(e,1),category:"CATEGORY_COMMAND_APPEARANCE",guid:"9a724d62-6b4f-4bec-affe-31a05966ccf9",...(0,z.Z)("Web Panel 1")},{name:"COMMAND_SHOW_WEB_PANEL_2",action:e=>A.Z.toggleContent(e.windowId,"webpanel 2"),showInQC:!0,isEnabled:ge.Z,isVisible:e=>U.ZP.isSettings(e)||I.ZP.hasWebPanel(e,2),category:"CATEGORY_COMMAND_APPEARANCE",guid:"a0ed3813-af8f-42af-8466-bbaf197bb5a6",...(0,z.Z)("Web Panel 2")},{name:"COMMAND_SHOW_WEB_PANEL_3",action:e=>A.Z.toggleContent(e.windowId,"webpanel 3"),showInQC:!0,isEnabled:ge.Z,isVisible:e=>U.ZP.isSettings(e)||I.ZP.hasWebPanel(e,3),category:"CATEGORY_COMMAND_APPEARANCE",guid:"a28d673c-5242-4330-aff1-b5df09dfad7c",...(0,z.Z)("Web Panel 3")},{name:"COMMAND_SHOW_WEB_PANEL_4",action:e=>A.Z.toggleContent(e.windowId,"webpanel 4"),showInQC:!0,isEnabled:ge.Z,isVisible:e=>U.ZP.isSettings(e)||I.ZP.hasWebPanel(e,4),category:"CATEGORY_COMMAND_APPEARANCE",guid:"a13f216c-d341-4057-a573-0b954dcde28f",...(0,z.Z)("Web Panel 4")},{name:"COMMAND_SHOW_WEB_PANEL_5",action:e=>A.Z.toggleContent(e.windowId,"webpanel 5"),showInQC:!0,isEnabled:ge.Z,isVisible:e=>U.ZP.isSettings(e)||I.ZP.hasWebPanel(e,5),category:"CATEGORY_COMMAND_APPEARANCE",guid:"e859c95a-52fc-4c30-87cc-768fd35cd5b9",...(0,z.Z)("Web Panel 5")},{name:"COMMAND_SHOW_WEB_PANEL_6",action:e=>A.Z.toggleContent(e.windowId,"webpanel 6"),showInQC:!0,isEnabled:ge.Z,isVisible:e=>U.ZP.isSettings(e)||I.ZP.hasWebPanel(e,6),category:"CATEGORY_COMMAND_APPEARANCE",guid:"61c088f8-a1b3-4a73-a359-08796372e33a",...(0,z.Z)("Web Panel 6")},{name:"COMMAND_SHOW_WEB_PANEL_7",action:e=>A.Z.toggleContent(e.windowId,"webpanel 7"),showInQC:!0,isEnabled:ge.Z,isVisible:e=>U.ZP.isSettings(e)||I.ZP.hasWebPanel(e,7),category:"CATEGORY_COMMAND_APPEARANCE",guid:"6fff7b4d-a154-4945-aacf-e57bc67afde8",...(0,z.Z)("Web Panel 7")},{name:"COMMAND_SHOW_WEB_PANEL_8",action:e=>A.Z.toggleContent(e.windowId,"webpanel 8"),showInQC:!0,isEnabled:ge.Z,isVisible:e=>U.ZP.isSettings(e)||I.ZP.hasWebPanel(e,9),category:"CATEGORY_COMMAND_APPEARANCE",guid:"26e5191f-7c81-4d3b-a499-e8945a9a6ec3",...(0,z.Z)("Web Panel 8")},{name:"COMMAND_SHOW_WEB_PANEL_9",action:e=>A.Z.toggleContent(e.windowId,"webpanel 9"),showInQC:!0,isEnabled:ge.Z,isVisible:e=>U.ZP.isSettings(e)||I.ZP.hasWebPanel(e,9),category:"CATEGORY_COMMAND_APPEARANCE",guid:"b0732781-fdf6-4ba8-8fcf-6d94f24edc37",...(0,z.Z)("Web Panel 9")},{name:"COMMAND_COPY_SELECTION_TO_NOTE",action:async e=>{const t=C.ZP.getActivePage(e.windowId);if(t){const n=await j.Z.utilities.getSelectedText(t.id);await b.Z.createNote(e.windowId,{content:n,url:t.url,type:"note"})}},isEnabled:ge.Z,isVisible:e=>!U.ZP.isGuest(),showInQC:!0,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"fa2d0620-4233-4d59-ab5d-e868fb52ad03",...(0,z.Z)("Copy Selected Text to Note")},{name:"COMMAND_APPEND_SELECTION_TO_NOTE",action:async e=>{const t=C.ZP.getActivePage(e.windowId);if(t){const n=await j.Z.utilities.getSelectedText(t.id);y.Z.showNoteSelectionDialog(e.windowId,{onSelected:e=>b.Z.appendToNode(e,n)})}},isEnabled:()=>S.ZP.hasNotes(),isVisible:e=>!U.ZP.isGuest(),showInQC:!0,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"1fe5dfa8-c044-4b3c-a36d-24a8d00de8be",...(0,z.Z)("Append Selected Text to Note")},{name:"COMMAND_TRANSLATE_SELECTION",action:async e=>{const t=C.ZP.getActivePage(e.windowId);if(t){const n=t.id,i=await j.Z.utilities.getSelectedText(n);i&&m.Z.canTranslateText(i,t.url,n)&&x.Z.translateSelection(e.windowId,n,i)}},isEnabled:ge.Z,isVisible:ge.Z,showInQC:!0,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"25326646-7412-4be5-b478-6e74f1190a56",...(0,z.Z)("Translate Selected Text")},{name:"COMMAND_PAGE_QR_CODE",action:e=>{const t=C.ZP.getActivePage(e.windowId);t&&j.Z.utilities.createQRCode(t.id)},showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"fef3ca9a-341e-4814-9709-d9a070263882",...(0,z.Z)("Create QR Code for Active Page")},{name:"COMMAND_SPATNAV_LEFT",action:e=>N.Z.left(e.windowId),repeat:!0,inMenu:me.Z,showInQC:!1,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"466272ae-7b00-4113-bdb3-159ae29e848c",...(0,z.Z)("Spatial Navigation Left")},{name:"COMMAND_SPATNAV_UP",action:e=>N.Z.up(e.windowId),repeat:!0,inMenu:me.Z,showInQC:!1,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"527416b5-8d0f-4d05-b251-9a1c70cbbb11",...(0,z.Z)("Spatial Navigation Up")},{name:"COMMAND_SPATNAV_RIGHT",action:e=>N.Z.right(e.windowId),repeat:!0,inMenu:me.Z,showInQC:!1,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"0a095dee-caba-457d-b119-6a9cc12c9496",...(0,z.Z)("Spatial Navigation Right")},{name:"COMMAND_SPATNAV_DOWN",action:e=>N.Z.down(e.windowId),repeat:!0,inMenu:me.Z,showInQC:!1,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_WEBPAGE_NAVIGATION",guid:"b554b968-c3b1-4522-a927-07d3d5bf74a3",...(0,z.Z)("Spatial Navigation Down")},{name:"COMMAND_CLIPBOARD_UNDO",action:e=>p.Z.undo(e.windowId),showInQC:!1,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"fb89c51c-3fe7-4bab-b9f6-27174e89b76d",...(0,z.Z)("win_linux","Undo")},{name:"COMMAND_CLIPBOARD_REDO",action:e=>p.Z.redo(e.windowId),showInQC:!1,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"cfd7113d-8501-4fee-b8e3-c776297620d5",...(0,z.Z)("win_linux","Redo")},{name:"COMMAND_CLIPBOARD_CUT",action:e=>p.Z.cut(e.windowId),showInQC:!1,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"ef5d4a31-9ca0-424e-a3af-ec9770084dca",...(0,z.Z)("win_linux","Cut")},{name:"COMMAND_CLIPBOARD_COPY",action:e=>p.Z.copy(e.windowId),showInQC:!1,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"6dae1e1a-695b-41c5-9ca9-deb1fabe9cc9",...(0,z.Z)("win_linux","Copy")},{name:"COMMAND_CLIPBOARD_PASTE",action:e=>p.Z.paste(e.windowId),showInQC:!1,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"aa12b05a-94cf-4660-8272-37da19294192",...(0,z.Z)("win_linux","Paste")},{name:"COMMAND_CLIPBOARD_SELECT_ALL",action:e=>p.Z.selectAll(e.windowId),showInQC:!1,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"ce41214f-6878-42ef-b120-3deb06cfcf2e",...(0,z.Z)("win_linux","Select All")},{name:"COMMAND_CLIPBOARD_PASTE_AS_PLAIN_TEXT",action:e=>{C.ZP.getActivePage(e.windowId)&&p.Z.pasteAsPlainText(e.windowId)},showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"bac47f7e-084f-4255-b27e-24f767aa300b",...(0,z.Z)("Paste as Plain Text")},{name:"COMMAND_CLIPBOARD_PASTE_AS_PLAIN_TEXT_OR_PASTE_AND_GO",action:e=>{const t=C.ZP.getActivePage(e.windowId);t&&p.Z.pasteAsPlainTextOrPasteAndGo(e.windowId,t.id)},category:"CATEGORY_COMMAND_APPLICATION",showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,guid:"1ca0b67d-f911-4141-949b-09c728430f2f",...(0,z.Z)("Paste and Go")},{name:"COMMAND_CLIPBOARD_PASTE_AS_NOTE",action:e=>p.Z.createNoteFromSelection(e.windowId),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"eb19c8a1-019b-4eea-a159-4e7efaa7737a",...(0,z.Z)("Paste to New Note")},{name:"COMMAND_WINDOW_MINIMIZE",action:e=>W.Z.minimize(e.windowId),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"855ad23f-900b-42bf-af4d-4ce6b419ce09",...(0,z.Z)("Minimize")},{name:"COMMAND_WINDOW_MINIMIZE_ALL",action:()=>W.Z.minimizeAll(),showInQC:!0,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"9f6124ef-e8ed-4143-b9ca-5a4beb646e3d",...(0,z.Z)("Minimize All")},{name:"COMMAND_HIDE_OTHERS",action:()=>{},showInQC:!1,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"f1a77d87-7c3c-45be-9402-91d111381491",...(0,z.Z)("Hide Others")},{name:"COMMAND_HIDE_VIVALDI",action:()=>{},showInQC:!1,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"75e245b8-1cce-44e3-87f5-2cade5e26f6a",...(0,z.Z)("Hide $1",["Vivaldi"])},{name:"COMMAND_SHOW_ALL",action:()=>{},showInQC:!1,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"776628a4-a989-4373-922b-b16477bbb811",...(0,z.Z)("mac","Show All")},{name:"COMMAND_OPEN_LINK",action:()=>{},withNoWindow:!0,inMenu:me.Z,showInQC:!1,isEnabled:ge.Z,isVisible:ge.Z,category:"CATEGORY_COMMAND_APPLICATION",guid:"e1ecbf58-47e1-4eb1-92f5-3ff610aadd53",...(0,z.Z)("Open Link")},{name:"COMMAND_SHOW_CALENDAR",action:e=>y.Z.showCalendar(e.windowId),withNoWindow:!0,isEnabled:ge.Z,isVisible:()=>Ae(),showInQC:!0,category:"CATEGORY_COMMAND_APPLICATION",guid:"67287254-750b-4dbd-b290-cdc1b4906c2c",...(0,z.Z)("Calendar")},{name:"COMMAND_ADD_CALENDAR_EVENT",action:e=>l.ZP.showAddEvent(e.windowId,"",""),isEnabled:ge.Z,isVisible:()=>Ae(),showInQC:!0,category:"CATEGORY_COMMAND_APPLICATION",guid:"594afe15-9134-49e6-9aa8-1f50b0925ef8",...(0,z.Z)("Add Calendar Event (Dialog)")},{name:"COMMAND_ADD_NEW_CALENDAR_ACCOUNT",action:e=>y.Z.showCalendarAccountDialog(e.windowId),isEnabled:ge.Z,isVisible:()=>Ae(),showInQC:!0,category:"CATEGORY_COMMAND_APPLICATION",guid:"a379c8cf-024b-49b5-94ac-9a8ac279e048",...(0,z.Z)("Add New Calendar Account")},{name:"COMMAND_CALENDAR_VIEWMODE_DAY",action:e=>{const t=c.ZP.getPageId(e.windowId);"number"==typeof t&&d.Z.setViewMode(t,"day")},isEnabled:ge.Z,isVisible:()=>Ae(),feature:"calendar",showInQC:!0,category:"CATEGORY_COMMAND_CALENDAR",guid:"34b14e6c-de7d-4b66-819f-7ab80b1bb255",...(0,z.Z)("Day View")},{name:"COMMAND_CALENDAR_VIEWMODE_WEEK",action:e=>{const t=c.ZP.getPageId(e.windowId);"number"==typeof t&&d.Z.setViewMode(t,"week")},isEnabled:ge.Z,isVisible:()=>Ae(),feature:"calendar",showInQC:!0,category:"CATEGORY_COMMAND_CALENDAR",guid:"4c6371b0-0217-4c6d-b4f7-7a5f100375c3",...(0,z.Z)("Week View")},{name:"COMMAND_CALENDAR_VIEWMODE_MULTIWEEK",action:e=>{const t=c.ZP.getPageId(e.windowId);"number"==typeof t&&d.Z.setViewMode(t,"multiweek")},isEnabled:ge.Z,isVisible:()=>Ae(),feature:"calendar",showInQC:!0,category:"CATEGORY_COMMAND_CALENDAR",guid:"0f2eaffe-fbad-452e-858e-1edcfd8a746e",...(0,z.Z)("Multi Week View")},{name:"COMMAND_CALENDAR_VIEWMODE_MONTH",action:e=>{const t=c.ZP.getPageId(e.windowId);"number"==typeof t&&d.Z.setViewMode(t,"month")},isEnabled:ge.Z,isVisible:()=>Ae(),feature:"calendar",showInQC:!0,category:"CATEGORY_COMMAND_CALENDAR",guid:"2a5db361-313a-43b6-a0e9-f51d304aec7c",...(0,z.Z)("Month View")},{name:"COMMAND_CALENDAR_VIEWMODE_YEAR",action:e=>{const t=c.ZP.getPageId(e.windowId);"number"==typeof t&&d.Z.setViewMode(t,"year")},isEnabled:ge.Z,isVisible:()=>Ae(),feature:"calendar",showInQC:!0,category:"CATEGORY_COMMAND_CALENDAR",guid:"1f261447-d1b1-473f-bb07-6139fd878ea2",...(0,z.Z)("Year View")},{name:"COMMAND_CALENDAR_VIEWMODE_AGENDA",action:e=>{const t=c.ZP.getPageId(e.windowId);"number"==typeof t&&d.Z.setViewMode(t,"agenda")},isEnabled:ge.Z,isVisible:()=>Ae(),feature:"calendar",showInQC:!0,category:"CATEGORY_COMMAND_CALENDAR",guid:"925c843d-4813-4ea5-8837-211412707dbf",...(0,z.Z)("Agenda View")},{name:"COMMAND_CALENDAR_VIEW_NEXT_PERIOD",action:e=>{const t=c.ZP.getPageId(e.windowId);"number"==typeof t&&d.Z.viewNextPeriod(t)},isEnabled:ge.Z,isVisible:()=>Ae(),feature:"calendar",showInQC:!0,category:"CATEGORY_COMMAND_CALENDAR",guid:"0f8df2a2-343b-43db-a16c-16418dc9f241",...(0,z.Z)("View Next Period")},{name:"COMMAND_CALENDAR_VIEW_PREVIOUS_PERIOD",action:e=>{const t=c.ZP.getPageId(e.windowId);"number"==typeof t&&d.Z.viewPreviousPeriod(t)},isEnabled:ge.Z,isVisible:()=>Ae(),feature:"calendar",showInQC:!0,category:"CATEGORY_COMMAND_CALENDAR",guid:"4601bd8c-4229-442c-8dec-df8171c4da1d",...(0,z.Z)("View Previous Period")},{name:"COMMAND_CALENDAR_VIEW_TODAY",action:e=>{const t=c.ZP.getPageId(e.windowId);"number"==typeof t&&d.Z.selectToday(t)},isEnabled:ge.Z,isVisible:()=>Ae(),feature:"calendar",showInQC:!0,category:"CATEGORY_COMMAND_CALENDAR",guid:"44e98ded-fa2d-4ee4-a7f6-e705ac809503",...(0,z.Z)("View Today")},{name:"COMMAND_CALENDAR_VIEW_ZOOM_IN",action:e=>{const t=c.ZP.getPageId(e.windowId);"number"==typeof t&&d.Z.zoomViewMode(t,-1)},isEnabled:ge.Z,isVisible:()=>Ae(),feature:"calendar",showInQC:!0,category:"CATEGORY_COMMAND_CALENDAR",guid:"940d0a90-6337-4d42-b317-13630fa38697",...(0,z.Z)("Zoom View In")},{name:"COMMAND_CALENDAR_VIEW_ZOOM_OUT",action:e=>{const t=c.ZP.getPageId(e.windowId);"number"==typeof t&&d.Z.zoomViewMode(t,1)},isEnabled:ge.Z,isVisible:()=>Ae(),feature:"calendar",showInQC:!0,category:"CATEGORY_COMMAND_CALENDAR",guid:"8c03403a-77fd-4920-aad9-c47ecee1a115",...(0,z.Z)("Zoom View Out")},{name:"COMMAND_CALENDAR_CREATE_EVENT",action:e=>h.Z.onCommand(e.windowId,"COMMAND_CALENDAR_CREATE_EVENT"),isEnabled:ge.Z,isVisible:()=>Ae(),showInQC:!0,feature:"calendar",category:"CATEGORY_COMMAND_CALENDAR",guid:"1559362f-6274-4590-a260-a660b71dfcd5",...(0,z.Z)("Create Event")},{name:"COMMAND_CALENDAR_GOTO_DATE",action:e=>h.Z.onCommand(e.windowId,"COMMAND_CALENDAR_GOTO_DATE"),isEnabled:ge.Z,isVisible:()=>Ae(),showInQC:!0,feature:"calendar",category:"CATEGORY_COMMAND_CALENDAR",guid:"6c6537e4-75a3-43f0-93e1-9f3765d0c686",...(0,z.Z)("Go to Date")},{name:"COMMAND_CALENDAR_SEARCH",action:e=>h.Z.onCommand(e.windowId,"COMMAND_CALENDAR_SEARCH"),isEnabled:ge.Z,isVisible:()=>Ae(),showInQC:!0,feature:"calendar",category:"CATEGORY_COMMAND_CALENDAR",guid:"55a8cf5d-e711-4ce4-a02f-55cf31ffcda8",...(0,z.Z)("Search in Calendar")},{name:"COMMAND_CALENDAR_REFRESH",action:e=>l.ZP.pollAllCalDAVAccountsWithStatus(),isVisible:()=>Ae(),isEnabled:ge.Z,showInQC:!0,feature:"calendar",category:"CATEGORY_COMMAND_CALENDAR",guid:"1d59f64f-9e47-491c-93eb-fe66fc099279",...(0,z.Z)("Refresh Calendar")},{name:"COMMAND_MAIL_COMPOSE_NEW_MESSAGE",action:()=>v.Z.createDraft(),showInQC:!0,isEnabled:()=>Object.keys($.Z.getAccounts()).length>0,isVisible:()=>Ae(),feature:"mail",guid:"1c54b411-5b73-4eba-b5bf-6787d1f377fe",category:"CATEGORY_COMMAND_MAIL",...(0,z.Z)("command","Compose New Message")},{name:"COMMAND_SHOW_MAIL",action:e=>y.Z.showMail(e.windowId),withNoWindow:!0,showInQC:!0,isEnabled:ge.Z,isVisible:()=>Ae(),guid:"670dbed7-f692-4fa4-a926-fe46183b82bb",category:"CATEGORY_COMMAND_APPLICATION",...(0,z.Z)("Mail")},{name:"COMMAND_MAIL_REPLY",action:()=>s.Z.reply(),isEnabled:e=>(0,ue.Wm)(e),isVisible:()=>Ae(),feature:"mail",showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"fa9e273b-11fd-4be9-b77e-461a1e9fcc4e",...(0,z.Z)("Reply to Message")},{name:"COMMAND_MAIL_REPLY_ALL",action:()=>s.Z.replyAll(),showInQC:!0,isEnabled:e=>(0,ue.Wm)(e),isVisible:()=>Ae(),feature:"mail",category:"CATEGORY_COMMAND_MAIL",guid:"cc59e4b7-c907-48b7-9057-f4dc2ae9c552",...(0,z.Z)("Reply All")},{name:"COMMAND_MAIL_REPLY_LIST",action:()=>s.Z.replyList(),showInQC:!0,isEnabled:e=>o.Z.isListPost(),isVisible:()=>Ae(),feature:"mail",category:"CATEGORY_COMMAND_MAIL",guid:"aa09df31-0dbc-41c9-be62-265cd2906b88",...(0,z.Z)("Reply List")},{name:"COMMAND_MAIL_FORWARD",action:()=>s.Z.forward(),isEnabled:e=>(0,ue.Wm)(e),isVisible:()=>Ae(),feature:"mail",showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"f45c60df-9ca1-444e-8108-656b0a15c68e",...(0,z.Z)("mail","Forward Message")},{name:"COMMAND_MAIL_DELETE_PERMANENTLY",action:e=>s.Z.prepareDelete(e.windowId,!0),isEnabled:e=>(0,ue.Wm)(e),isVisible:()=>Ae(),feature:"mail",showInQC:!1,category:"CATEGORY_COMMAND_MAIL",guid:"7b0de3f1-2173-4bde-96bf-f9fa1063abe7",...(0,z.Z)("Delete Permanently")},{name:"COMMAND_MAIL_MARK_READ",action:e=>s.Z.markRead(e.windowId),isEnabled:e=>(0,ue.Wm)(e),isVisible:()=>Ae(),feature:"mail",showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"02a17cf8-4e45-4d32-b06c-38edf99544da",...(0,z.Z)("mail","Mark Message as Read")},{name:"COMMAND_MAIL_MARK_JUNK",action:e=>s.Z.markAsJunk(e.windowId),isEnabled:e=>(0,ue.Wm)(e)&&!Ie(),isVisible:()=>Ae(),feature:"mail",showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"4266577c-0e3b-4237-aadd-868b122976f6",...(0,z.Z)("mail","Mark Message as Spam")},{name:"COMMAND_MAIL_MARK_NOT_JUNK",action:e=>s.Z.markAsNotJunk(e.windowId),isEnabled:e=>(0,ue.Wm)(e)&&!Ie(),isVisible:()=>Ae(),feature:"mail",showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"b0546fb8-3dbf-47d7-9265-01d5c90e53cc",...(0,z.Z)("mail","Not Spam")},{name:"COMMAND_MAIL_MOVE_TO_ARCHIVE",action:e=>s.Z.moveToArchive(e.windowId),isEnabled:e=>(0,ue.Wm)(e),isVisible:()=>Ae(),feature:"mail",showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"88b88583-3976-4f56-a906-067928fd809f",...(0,z.Z)("mail","Move Message to Archive")},{name:"COMMAND_MAIL_SHOW_QUICK_REPLY",action:()=>{const e="show";Z.Z.set(ne.kMailShowQuickReply,E.Z.get(ne.kMailShowQuickReply)===e?"hide":e)},isEnabled:e=>(0,ue.Wm)(e),isVisible:()=>Ae(),feature:"mail",showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"95168098-07a7-4662-b9cd-5409b67fdd6a",...(0,z.Z)("Quick Reply On/Off")},{name:"COMMAND_MAIL_RESTORE_FROM_ARCHIVE",action:e=>s.Z.restoreFromArchive(e.windowId),isEnabled:e=>(0,ue.Wm)(e),isVisible:()=>Ae(),feature:"mail",showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"7ff15fcb-6812-404c-8d27-f2100f585476",...(0,z.Z)("mail","Restore Message from Archive")},{name:"COMMAND_MAIL_GOTO_NEXT_UNREAD",action:e=>s.Z.goToNextUnread(e.windowId),isEnabled:e=>(0,ue.Wm)(e),isVisible:()=>Ae(),feature:"mail",showInQC:!1,category:"CATEGORY_COMMAND_MAIL",guid:"75f673af-21e8-43f2-8aa8-b96b8dbd0245",...(0,z.Z)("mail","Next Unread")},{name:"COMMAND_MAIL_GOTO_PREVIOUS_UNREAD",action:e=>s.Z.goToPreviousUnread(e.windowId),isEnabled:e=>(0,ue.Wm)(e),isVisible:()=>Ae(),feature:"mail",showInQC:!1,category:"CATEGORY_COMMAND_MAIL",guid:"24aab8e7-7bd0-470d-88f8-5ecdb1f19224",...(0,z.Z)("mail","Previous Unread")},{name:"COMMAND_MAIL_MARK_ALL_READ",action:()=>f.Z.markAllReadCmd(),isEnabled:e=>(0,ue.Wm)(e),isVisible:()=>Ae(),feature:"mail",showInQC:!1,category:"CATEGORY_COMMAND_MAIL",guid:"c929109f-99fa-45a5-80ca-9a3fdd17bd63",...(0,z.Z)("mail","Mark All as Read")},{name:"COMMAND_MAIL_MARK_THREAD_READ",action:e=>s.Z.markThreadRead(e.windowId),isEnabled:e=>(0,ue.Wm)(e),isVisible:()=>Ae(),feature:"mail",showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"3110cb8a-11eb-4643-b834-f88ee1bf0155",...(0,z.Z)("mail","Mark Message Thread as Read")},{name:"COMMAND_MAIL_MARK_THREAD_UNREAD",action:e=>s.Z.markThreadUnread(e.windowId),isEnabled:e=>(0,ue.Wm)(e),isVisible:()=>Ae(),feature:"mail",showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"655c64c3-8e8f-44ff-a7bf-a05f2c9a6115",...(0,z.Z)("mail","Mark Message Thread as Unread")},{name:"COMMAND_MAIL_MARK_UNREAD",action:e=>s.Z.markUnread(e.windowId),isEnabled:e=>(0,ue.Wm)(e),isVisible:()=>Ae(),feature:"mail",showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"6b193cc2-62ca-41a8-9a17-d311541aef54",...(0,z.Z)("mail","Mark Message as Unread")},{name:"COMMAND_MAIL_ENABLE_SENDER_VIEW",action:e=>s.Z.enableCorrespondentView(e.windowId),isEnabled:e=>(0,ue.Wm)(e),isVisible:()=>Ae(),feature:"mail",showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"61ab202a-46ad-45ce-92b9-85c3295ef801",...(0,z.Z)("mail","Show Messages for Sender")},{name:"COMMAND_MAIL_LABEL_FLAG",action:e=>y.Z.showCustomLabelDialog(e.windowId),isEnabled:e=>(0,ue.Wm)(e),isVisible:()=>Ae(),feature:"mail",showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"c17b88dc-80b2-4b8f-9887-7d184eaaeac5",...(0,z.Z)("mail","Add Labels and Flags")},{name:"COMMAND_MAIL_ENABLE_THREADED_VIEW",action:e=>s.Z.enableThreadedView(e.windowId),isEnabled:e=>(0,ue.Wm)(e),isVisible:()=>Ae(),feature:"mail",showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"5c21bfa1-f0b2-4804-a395-71243d99dad8",...(0,z.Z)("mail","Show Message Thread")},{name:"COMMAND_MAIL_MARK_READ_AND_GOTO_NEXT_UNREAD",action:e=>s.Z.markAsReadAndGoToNextUnread(e.windowId),isEnabled:e=>(0,ue.Wm)(e),isVisible:()=>Ae(),feature:"mail",showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"92f285b0-90dc-4051-940e-eefee7b4692f",...(0,z.Z)("mail","Mark Message as Read and Go to Next Unread")},{name:"COMMAND_MAIL_ADD_NEW_MAIL_ACCOUNT",action:e=>y.Z.showMailAccountDialog(e.windowId),isEnabled:ge.Z,isVisible:()=>Ae(),showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"2b65911f-8bfc-4e9b-bf43-b78bfc7c4587",...(0,z.Z)("mail","Add New Mail Account")},{name:"COMMAND_MAIL_SHOW_PLAINTEXT",action:e=>h.Z.onCommand(e.windowId,"COMMAND_MAIL_SHOW_PLAINTEXT"),isEnabled:()=>"plaintext"!==o.Z.getRenderingMethod(),isVisible:()=>Ae(),showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"ca91db92-59ae-40b6-9c69-10f7d4da2041",...(0,z.Z)("Show Message as Text")},{name:"COMMAND_MAIL_SHOW_HTML",action:e=>h.Z.onCommand(e.windowId,"COMMAND_MAIL_SHOW_HTML"),isEnabled:()=>"prefer_html"!==o.Z.getRenderingMethod(),isVisible:()=>Ae(),showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"6c080636-1fd2-41d2-826a-9652ae4de5d8",...(0,z.Z)("Show Message as HTML")},{name:"COMMAND_MAIL_SHOW_SETTINGS",action:e=>y.Z.showSettings(e.windowId,"mail"),isEnabled:ge.Z,isVisible:()=>Ae(),showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"68FEE23D-B0DB-41D1-996B-C62BA4FD5F7A",...(0,z.Z)("Mail Settings")},{name:"COMMAND_MAIL_SEND_MESSAGE",action:e=>h.Z.onCommand(e.windowId,"COMMAND_MAIL_SEND_MESSAGE"),isEnabled:()=>!E.Z.get(ne.kMailIsTurnedOff),isVisible:()=>Ae(),feature:"mail",showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"c604b094-c4a6-4825-a626-ac02dcb4f9f2",...(0,z.Z)("mail","Send Mail From Mail Composer")},{name:"COMMAND_MAIL_QUEUE_MESSAGE",action:e=>h.Z.onCommand(e.windowId,"COMMAND_MAIL_QUEUE_MESSAGE"),isEnabled:()=>!E.Z.get(ne.kMailIsTurnedOff),isVisible:e=>Te(e),feature:"mail",showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"401ded53-2b1e-4138-9730-64a3b9cb852a",...(0,z.Z)("mail","Queue Mail From Mail Composer")},{name:"COMMAND_MAIL_COMPOSER_CHOOSE_ATTACHMENTS",action:e=>h.Z.onCommand(e.windowId,"COMMAND_MAIL_COMPOSER_CHOOSE_ATTACHMENTS"),isEnabled:()=>!E.Z.get(ne.kMailIsTurnedOff),isVisible:e=>Te(e),feature:"mail",showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"83f08b2a-e622-46f2-b40a-30901428ff4a",...(0,z.Z)("mail","Add Attachment")},{name:"COMMAND_MAIL_COMPOSER_DELETE_DRAFT",action:e=>h.Z.onCommand(e.windowId,"COMMAND_MAIL_COMPOSER_DELETE_DRAFT"),isEnabled:()=>!E.Z.get(ne.kMailIsTurnedOff),isVisible:e=>Te(e),feature:"mail",showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"eb237677-b81c-453e-ab92-791f0d3db3db",...(0,z.Z)("mail","Discard Draft")},{name:"COMMAND_MAIL_SHOW_MAIL_INFO",action:e=>y.Z.showMailInfoDialog(e.windowId),isEnabled:()=>!E.Z.get(ne.kMailIsTurnedOff),isVisible:e=>!U.ZP.isGuest(),showInQC:!0,category:"CATEGORY_COMMAND_MAIL",guid:"aa72eb02-7be0-4fbb-b5fa-6cb11e850ea5",...(0,z.Z)("command","Show Advanced Mail Info")},{name:"COMMAND_WORKSPACE_SWITCH_FORWARD_ORDER",action:e=>V.Z.activateNextByOrder(e.windowId),showInQC:!0,isEnabled:()=>E.Z.get(ne.kWorkspacesEnabled),isVisible:()=>E.Z.get(ne.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"629d1445-7c11-4047-a419-e50f948d1eb6",...(0,z.Z)("Next Workspace")},{name:"COMMAND_WORKSPACE_SWITCH_BACK_ORDER",action:e=>V.Z.activatePreviousByOrder(e.windowId),showInQC:!0,isEnabled:()=>E.Z.get(ne.kWorkspacesEnabled),isVisible:()=>E.Z.get(ne.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"d0ee5c21-ba2d-4435-8f69-b6cf8a2911d2",...(0,z.Z)("Previous Workspace")},{name:"COMMAND_WORKSPACE_CREATE_NEW",action:({windowId:e})=>{y.Z.showWorkspaceDialog(e,{createInBackground:!1,withPages:C.ZP.isSelecting(e)?C.ZP.getSelectedPages(e):void 0})},isEnabled:ge.Z,isVisible:()=>E.Z.get(ne.kWorkspacesEnabled),showInQC:!0,category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"eee152db-570a-4d6c-94d0-3ce684b623cb",...(0,z.Z)("workspaces","Create New Workspace")},{name:"COMMAND_WORKSPACE_SWITCH_1",action:e=>V.Z.activateWorkspaceByIndex(e.windowId,void 0),showInQC:!1,isEnabled:ge.Z,isVisible:()=>E.Z.get(ne.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"84839d33-4378-426f-ab95-a013bda152c0",...(0,z.Z)("Switch to Window")},{name:"COMMAND_WORKSPACE_SWITCH_2",action:e=>V.Z.activateWorkspaceByIndex(e.windowId,0),showInQC:!1,isEnabled:ge.Z,isVisible:()=>E.Z.get(ne.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"0bc9d92d-05f7-4e49-8a87-c6e4f85565aa",...(0,z.Z)("Switch to Workspace 1")},{name:"COMMAND_WORKSPACE_SWITCH_3",action:e=>V.Z.activateWorkspaceByIndex(e.windowId,1),showInQC:!1,isEnabled:ge.Z,isVisible:()=>E.Z.get(ne.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"1bbf445e-1787-4af4-ac01-e0ef0fb4054d",...(0,z.Z)("Switch to Workspace 2")},{name:"COMMAND_WORKSPACE_SWITCH_4",action:e=>V.Z.activateWorkspaceByIndex(e.windowId,2),showInQC:!1,isEnabled:ge.Z,isVisible:()=>E.Z.get(ne.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"f3ba55d2-e1c1-48d2-9bf2-0464b3444499",...(0,z.Z)("Switch to Workspace 3")},{name:"COMMAND_WORKSPACE_SWITCH_5",action:e=>V.Z.activateWorkspaceByIndex(e.windowId,3),showInQC:!1,isEnabled:ge.Z,isVisible:()=>E.Z.get(ne.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"cafeffc8-984a-4c0f-a9f2-4ccf1dd5577a",...(0,z.Z)("Switch to Workspace 4")},{name:"COMMAND_WORKSPACE_SWITCH_6",action:e=>V.Z.activateWorkspaceByIndex(e.windowId,4),showInQC:!1,isEnabled:ge.Z,isVisible:()=>E.Z.get(ne.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"5ccdd631-2dcd-46b2-9b39-7720e98fa376",...(0,z.Z)("Switch to Workspace 5")},{name:"COMMAND_WORKSPACE_SWITCH_7",action:e=>V.Z.activateWorkspaceByIndex(e.windowId,5),showInQC:!1,isEnabled:ge.Z,isVisible:()=>E.Z.get(ne.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"fe8c273a-9a21-4547-8d6e-6befed835a84",...(0,z.Z)("Switch to Workspace 6")},{name:"COMMAND_WORKSPACE_SWITCH_8",action:e=>V.Z.activateWorkspaceByIndex(e.windowId,6),showInQC:!1,isEnabled:ge.Z,isVisible:()=>E.Z.get(ne.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"0be9f4ad-da3f-47aa-b03d-2b6b2aa16084",...(0,z.Z)("Switch to Workspace 7")},{name:"COMMAND_WORKSPACE_SWITCH_9",action:e=>V.Z.activateWorkspaceByIndex(e.windowId,7),showInQC:!1,isEnabled:ge.Z,isVisible:()=>E.Z.get(ne.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"cb808c2b-9b79-4914-a25c-861818dd86be",...(0,z.Z)("Switch to Workspace 8")},{name:"COMMAND_WORKSPACE_SWITCH_10",action:e=>V.Z.activateWorkspaceByIndex(e.windowId,8),showInQC:!1,isEnabled:ge.Z,isVisible:()=>E.Z.get(ne.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"e32ce875-6d68-4d49-8fdf-5586908275b4",...(0,z.Z)("Switch to Workspace 9")},{name:"COMMAND_WORKSPACE_MOVE_TABS_TO_0",action:e=>w.ZP.moveSelectionToWorkspace(e.windowId,0),showInQC:!0,isEnabled:ge.Z,isVisible:()=>E.Z.get(ne.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"174bcaf6-a722-4101-9717-5baed519a880",...(0,z.Z)("Move Selected Tabs to This Window")},{name:"COMMAND_WORKSPACE_MOVE_TABS_TO_1",action:e=>w.ZP.moveSelectionToWorkspace(e.windowId,1),showInQC:!0,isEnabled:ge.Z,isVisible:()=>E.Z.get(ne.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"69cb1752-3ce7-4d23-ac8d-f252dcb61d85",...(0,z.Z)("Move Selected Tabs to Workspace 1")},{name:"COMMAND_WORKSPACE_MOVE_TABS_TO_2",action:e=>w.ZP.moveSelectionToWorkspace(e.windowId,2),showInQC:!0,isEnabled:ge.Z,isVisible:()=>E.Z.get(ne.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"f19f65b7-5506-4e8e-84c3-fdc19a2eec07",...(0,z.Z)("Move Selected Tabs to Workspace 2")},{name:"COMMAND_WORKSPACE_MOVE_TABS_TO_3",action:e=>w.ZP.moveSelectionToWorkspace(e.windowId,3),showInQC:!0,isEnabled:ge.Z,isVisible:()=>E.Z.get(ne.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"e09eaa02-adc0-4210-b807-19208d4f11b4",...(0,z.Z)("Move Selected Tabs to Workspace 3")},{name:"COMMAND_WORKSPACE_MOVE_TABS_TO_4",action:e=>w.ZP.moveSelectionToWorkspace(e.windowId,4),showInQC:!0,isEnabled:ge.Z,isVisible:()=>E.Z.get(ne.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"8c76e51d-56c3-4781-969d-927ccfe3ea35",...(0,z.Z)("Move Selected Tabs to Workspace 4")},{name:"COMMAND_WORKSPACE_MOVE_TABS_TO_5",action:e=>w.ZP.moveSelectionToWorkspace(e.windowId,5),showInQC:!0,isEnabled:ge.Z,isVisible:()=>E.Z.get(ne.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"47659c77-702b-4fc2-be31-271b2740e129",...(0,z.Z)("Move Selected Tabs to Workspace 5")},{name:"COMMAND_WORKSPACE_MOVE_TABS_TO_6",action:e=>w.ZP.moveSelectionToWorkspace(e.windowId,6),showInQC:!0,isEnabled:ge.Z,isVisible:()=>E.Z.get(ne.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"e822d9a1-c293-4da6-a7f5-ebe7c09ce9c3",...(0,z.Z)("Move Selected Tabs to Workspace 6")},{name:"COMMAND_WORKSPACE_MOVE_TABS_TO_7",action:e=>w.ZP.moveSelectionToWorkspace(e.windowId,7),showInQC:!0,isEnabled:ge.Z,isVisible:()=>E.Z.get(ne.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"0402aaa7-7f28-47e7-a4bf-e307c6c56866",...(0,z.Z)("Move Selected Tabs to Workspace 7")},{name:"COMMAND_WORKSPACE_MOVE_TABS_TO_8",action:e=>w.ZP.moveSelectionToWorkspace(e.windowId,8),showInQC:!0,isEnabled:ge.Z,isVisible:()=>E.Z.get(ne.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"1f59c161-4d4e-4fd9-91bc-dc3bc90efd15",...(0,z.Z)("Move Selected Tabs to Workspace 8")},{name:"COMMAND_WORKSPACE_MOVE_TABS_TO_9",action:e=>w.ZP.moveSelectionToWorkspace(e.windowId,9),showInQC:!0,isEnabled:ge.Z,isVisible:()=>E.Z.get(ne.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"57626fad-3323-49e1-b461-47026639029b",...(0,z.Z)("Move Selected Tabs to Workspace 9")},{name:"COMMAND_HIBERNATE_INACTIVE_WORKSPACES",action:e=>V.Z.hibernateInactive(),showInQC:!0,isEnabled:ge.Z,isVisible:()=>E.Z.get(ne.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"d06e09c2-b95f-47fb-a3f1-c67872fdb8c4",...(0,z.Z)("workspaces","Hibernate Inactive Workspaces")},{name:"COMMAND_SHOW_WORKSPACE_MENU",action:e=>h.Z.onCommand(e.windowId,"COMMAND_SHOW_WORKSPACE_MENU"),showInQC:!0,isEnabled:ge.Z,isVisible:()=>E.Z.get(ne.kWorkspacesEnabled),category:"CATEGORY_COMMAND_WORKSPACE_ACTION",guid:"d8df3703-4bef-43a8-aebe-cf53222c9927",...(0,z.Z)("workspaces","Show Workspace Menu")},{name:"COMMAND_TOGGLE_FORCE_DARK_MODE",action:()=>Z.Z.toggle(ne.kAppearanceForceDarkModeTheme,!0,!1),showInQC:!0,isEnabled:ge.Z,isVisible:()=>function(){const e=E.Z.get(ne.kVivaldiPreferredColorScheme);return e===Q.TP.dark||e===Q.TP.auto&&"dark"===E.Z.get(ne.kSystemDesktopThemeColor)}(),category:"CATEGORY_COMMAND_APPEARANCE",guid:"eb1ba46f-ac7d-4112-86ed-fb0637dc675e",...(0,z.Z)("Toggle Force a dark theme on all websites")}]},9761:(e,t,n)=>{"use strict";n.d(t,{YI:()=>l,jq:()=>r,lE:()=>o,sK:()=>a});var i=n(70253),s=n(56371);const o=i.M.pb.map((([e,t,n])=>({key:e,value:(0,s.Z)(t),local:n}))),a=[{key:"am",value:(0,s.Z)("Amharic"),local:"amarəñña"},{key:"ar",value:(0,s.Z)("Arabic"),local:"اَلْعَرَبِيَّةُ"},{key:"bn",value:(0,s.Z)("Bengali"),local:"baɛṅlā"},{key:"bs",value:(0,s.Z)("Bosnian"),local:"bosanski"},{key:"ceb",value:(0,s.Z)("Cebuano"),local:"Sinugboanon"},{key:"co",value:(0,s.Z)("Corsican"),local:"corsu"},{key:"cy",value:(0,s.Z)("Welsh"),local:"Cymraeg"},{key:"eo",value:(0,s.Z)("Esperanto"),local:"Esperanto"},{key:"eu",value:(0,s.Z)("Basque"),local:"euskara"},{key:"ga",value:(0,s.Z)("Irish Gaelic"),local:"Gaeilge"},{key:"gu",value:(0,s.Z)("Gujarati"),local:"gujarātī"},{key:"ha",value:(0,s.Z)("Hausa"),local:"ḥawsa"},{key:"haw",value:(0,s.Z)("Hawaiian"),local:"ʻōlelo Hawaiʻi"},{key:"he",value:(0,s.Z)("Hebrew"),local:"עברית / עִבְרִית"},{key:"hi",value:(0,s.Z)("Hindi"),local:"हिन्दी"},{key:"hmn",value:(0,s.Z)("Hmong, Mong"),local:"Hmong"},{key:"ht",value:(0,s.Z)("Haitian Creole"),local:"Kreyòl ayisyen"},{key:"ig",value:(0,s.Z)("Igbo"),local:"igbo"},{key:"jv",value:(0,s.Z)("Javanese"),local:"basa Jawa"},{key:"ka",value:(0,s.Z)("Georgian"),local:"ქართული"},{key:"kk",value:(0,s.Z)("Kazakh"),local:"Қазақ тілі"},{key:"km",value:(0,s.Z)("Khmer"),local:"ភាសាខ្មែរ"},{key:"kn",value:(0,s.Z)("Kannada"),local:"ಕನ್ನಡ (kannaḍa)"},{key:"ky",value:(0,s.Z)("Kyrgyz"),local:"قىرعىز تىلى"},{key:"la",value:(0,s.Z)("Latin"),local:"Lingua Latina"},{key:"lb",value:(0,s.Z)("Luxembourgish"),local:"Lëtzebuergesch"},{key:"lo",value:(0,s.Z)("Lao"),local:"ພາສາລາວ"},{key:"lv",value:(0,s.Z)("Latvian"),local:"latviešu valoda"},{key:"mg",value:(0,s.Z)("Malagasy"),local:"Fiteny Malagasy"},{key:"mi",value:(0,s.Z)("Maori"),local:"te Reo Māori"},{key:"mk",value:(0,s.Z)("Macedonian"),local:"македонски"},{key:"ml",value:(0,s.Z)("Malayalam"),local:"മലയാളം"},{key:"mn",value:(0,s.Z)("Mongolian"),local:"монгол"},{key:"mr",value:(0,s.Z)("Marathi"),local:"मराठी"},{key:"ms",value:(0,s.Z)("Malay"),local:"Bahasa melayu"},{key:"mt",value:(0,s.Z)("Maltese"),local:"Malti"},{key:"my",value:(0,s.Z)("Burmese"),local:"ဗမာစကား"},{key:"ne",value:(0,s.Z)("Nepali"),local:"नेपाली"},{key:"ny",value:(0,s.Z)("Chichewa"),local:"Chicheŵa"},{key:"or",value:(0,s.Z)("Oriya"),local:"ଓଡ଼ିଆ"},{key:"ps",value:(0,s.Z)("Pashto"),local:"پښتو"},{key:"rw",value:(0,s.Z)("Kinyarwanda"),local:"Ikinyarwanda"},{key:"sd",value:(0,s.Z)("Sindhi"),local:"سنڌي"},{key:"si",value:(0,s.Z)("Sinhala"),local:"සිංහල"},{key:"sm",value:(0,s.Z)("Samoan"),local:"Gagana Samoa"},{key:"sn",value:(0,s.Z)("Shona"),local:"chiShona"},{key:"so",value:(0,s.Z)("Somali"),local:"af Soomaali"},{key:"st",value:(0,s.Z)("Southern Sotho"),local:"seSotho"},{key:"su",value:(0,s.Z)("Sundanese"),local:"Basa Sunda"},{key:"sw",value:(0,s.Z)("Swahili"),local:"Kiswahili"},{key:"ta",value:(0,s.Z)("Tamil"),local:"தமிழ்"},{key:"te",value:(0,s.Z)("Telugu"),local:"తెలుగు"},{key:"tg",value:(0,s.Z)("Tajik"),local:"тоҷики / toçikī / تاجيكي"},{key:"th",value:(0,s.Z)("Thai"),local:"ภาษาไทย"},{key:"tk",value:(0,s.Z)("Turkmen"),local:"түркmенче"},{key:"tl",value:(0,s.Z)("Tagalog"),local:"Tagalog"},{key:"tt",value:(0,s.Z)("Tatar"),local:"татарча / tatar tele / تاتارچا"},{key:"ug",value:(0,s.Z)("Uyghur"),local:"Уйғур /ئۇيغۇر"},{key:"ur",value:(0,s.Z)("Urdu"),local:"اُردُو"},{key:"uz",value:(0,s.Z)("Uzbek"),local:"o’zbek tili ўзбек тили"},{key:"xh",value:(0,s.Z)("Xhosa"),local:"isiXhosa"},{key:"yi",value:(0,s.Z)("Yiddish"),local:"ײִדיש"},{key:"yo",value:(0,s.Z)("Yoruba"),local:"Yorùbá"},{key:"zu",value:(0,s.Z)("Zulu"),local:"isiZulu"}],r={en:"en-US",es:"es-ES",ku:"kmr",no:"nb",pt:"pt-PT","sr-Cyrl":"sr","zh-Hans":"zh-CN","zh-Hant":"zh-TW"},l=Object.entries(r).reduce(((e,[t,n])=>(e[n]=t,e)),{"de-CH":"de","en-GB":"en","ja-KS":"ja","sr-Latn":"sr",nn:"no","pt-BR":"pt",iw:"he",me:"hr"})},33638:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});n(20244);const i=new class{_stores=new Set;register(e){const t=this._stores.size;if(this._stores.add(e),t===this._stores.size)throw new Error(`register() in ${this.constructor.name} was called with store ${e.constructor?.name} that was already registered.`)}reorderRegistrations(e){const t=this._stores.size;e.forEach((e=>{if(this._stores.delete(e),this._stores.add(e),t!==this._stores.size)throw new Error(`reorderRegistrations() in ${this.constructor.name} was called with store ${e.constructor?.name} that was not already registered.`)}))}isDispatching(){return Boolean(this._dispatching)}setLogCallback(e){this._logCallback=e}dispatch(e){if(this._dispatching){let t=`VivaldiAppDispatcher.dispatch(...): Cannot dispatch action ${e.actionType} the middle of a ${this._dispatching.actionType} dispatch.`;throw new Error(t)}this._dispatching=e;try{for(const t of this._stores)t.dispatchAction(e)}finally{this._dispatching=void 0,this._logCallback&&this._logCallback(e)}}}},30628:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var i=n(48868),s=n(5863);class o{static m3GetAll(){return i.Z.transaction("rw",[i.Z.searchList,i.Z.filters],(()=>i.Z.filters.where("[accountId+path]").equals([s.of,s.J8]).first().then((e=>{if(!e)throw new Error("Outbox filter not found");return i.Z.searchList.where("sourceFilterIds").equals(e.id).toArray()}))))}}},55346:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var i=n(48868);const s={call:function(e){return i.Z.messages.get(e)}}},93789:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var i=n(48868),s=n(71320);const o={call:async function(e,t){const n=[],o=[],a=[];return await i.Z.transaction("rw",[i.Z.searchList,i.Z.hasRaw],(async()=>{await i.Z.searchList.where("id").anyOf(e).modify((e=>{e.sourceFilterIds=e.sourceFilterIds.filter((e=>!t.includes(e))),t.forEach((t=>{e.sources.delete(t)}));const i=new Set(s.Z.getByIds([...e.sources.keys()]).map((({accountId:e})=>e))),r=new Set(s.Z.getByIds(t).map((({accountId:e})=>e)).filter((e=>!i.has(e))));for(const t of r)n.push([e.id,t]),o.push({accountId:t,searchListId:e.id,sentDate:e.sentDate});a.push({id:e.id,updates:{sourceFilterIds:e.sourceFilterIds,sources:new Map(t.map((e=>[e,void 0])))}})})),n.length>0&&i.Z.hasRaw.bulkDelete(n)})),{fileKeys:o,sleUpdates:a}}}},44850:(e,t,n)=>{"use strict";n.d(t,{$0:()=>M,CS:()=>N,D1:()=>j,Gp:()=>G,Gr:()=>$,LA:()=>I,QB:()=>W,Rf:()=>X,YC:()=>_,Z7:()=>L,cw:()=>U,d6:()=>z,jk:()=>Q,m7:()=>V,mh:()=>v,pM:()=>F,rl:()=>O,w$:()=>S,xy:()=>T,yl:()=>D});var i=n(96951),s=n(29087),o=n(16716),a=n(15489),r=n(56371),l=n(7064),d=n(1407),c=n(98010),u=n(36436),p=n(89175),h=n(86088);let g=[];function m(e,t){let n=e;if(t.displayUrl){const i=(0,u.DP)(e);n=t.displayUrl+(t.copyParams&&i.path?"/"+i.path+"/":"/")}else n="";return n}function f(e,t){const n=(t.url||"").includes("?")?"&":"?",[i,s]=e.slice(t.displayUrl.length).split("?"),o=new URLSearchParams(s);i&&"/"!==i&&o.append("path",(0,u.Iw)(i));const a=t.copyParams&&e.length>t.displayUrl.length?o.toString():"";return(t.url||"")+(a?n+a:"")}const v={general:{title:(0,r.Z)("General"),icon:h.Wt6,group:1},sync:{title:(0,r.Z)("Sync"),icon:h.FWJ,group:1},appearance:{title:(0,r.Z)("Appearance"),icon:h.Eo7,group:2},themes:{title:(0,r.Z)("Themes"),icon:h.U9f,group:2},startpage:{title:(0,r.Z)("title","Start Page"),icon:h.bMS,group:2},tabs:{title:(0,r.Z)("Tabs"),icon:h.Xt4,group:3},panel:{title:(0,r.Z)("title","Panel"),icon:h.bu$,group:3},addressbar:{title:(0,r.Z)("title","Address Bar"),icon:h.gO6,group:3},bookmarks:{title:(0,r.Z)("Bookmarks"),icon:h.Dvg,group:3},search:{title:(0,r.Z)("noun","Search"),icon:h.Hsf,group:3},qc:{title:(0,r.Z)("Quick Commands"),icon:h.f$U,group:4},keyboard:{title:(0,r.Z)("Keyboard"),icon:h.EkX,group:4},mouse:{title:(0,r.Z)("Mouse"),icon:h.j7Q,group:4},privacy:{title:(0,r.Z)("Privacy and Security"),icon:h.xGh,group:5},downloads:{title:(0,r.Z)("Downloads"),icon:h.GEU,group:5},webpages:{title:(0,r.Z)("Webpages"),icon:h.AWt,group:5},network:{title:(0,r.Z)("Network"),icon:h.f2R,group:5},mail:{title:(0,r.Z)("Mail"),icon:h.FbK,group:6},calendar:{title:(0,r.Z)("Calendar"),icon:h.a1L,group:6},rss:{title:(0,r.Z)("Feeds"),icon:h.eGc,group:6},chat:{title:(0,r.Z)("Chat"),icon:h.PyL,group:6},all:{title:(0,r.Z)("Display All"),icon:h.ih3,group:7},reset:{title:(0,r.Z)("Reset All Settings"),icon:h.NQk,group:7}},y={"vivaldi://settings/":"settings","vivaldi://startpage/":"startpage","vivaldi://bookmarks/":"bookmarks","vivaldi://history/":"history","vivaldi://calendar/":"calendar","vivaldi://chat/":"chat","vivaldi://dashboard/":"dashboard","vivaldi://mailpage/":"mailpage","vivaldi://saga/":"saga","chrome://saga/":"saga","vivaldi://guest-intro/":"guest-intro","vivaldi://private-intro/":"private-intro","vivaldi://welcome/":"welcome","vivaldi://themecolors/":"themecolors","vivaldi://experiments/":"experiments","vivaldi://actionlog/":"actionlog","vivaldi://notes/":"notes","vivaldi://session-recovery/":"session-recovery"},b={"vivaldi://settings/":h.bqs.medium,"vivaldi:settings":h.bqs.medium,"vivaldi://startpage/":h.VPD,"vivaldi:startpage":h.VPD,"vivaldi://bookmarks/":h.CLf.medium,"vivaldi:bookmarks":h.CLf.medium,"vivaldi://history/":h.hcy.medium,"vivaldi:history":h.hcy.medium,"vivaldi://calendar/":h.bcq.medium,"vivaldi:calendar":h.bcq.medium,"vivaldi://chat/":h.yt5.medium,"vivaldi:chat":h.yt5.medium,"vivaldi://dashboard/":h.cyI.medium,"vivaldi:dashboard":h.cyI.medium,"vivaldi://mailpage/":h.lvj.medium,"vivaldi:mailpage":h.lvj.medium,"vivaldi://themecolors/":h.jL_,"vivaldi:themecolors":h.jL_,"vivaldi://notes/":h.cyI.medium,"vivaldi:notes":h.cyI.medium,"vivaldi://welcome/":h.UQS,"vivaldi:welcome":h.UQS,"vivaldi://game/":"chrome://game/","vivaldi:game":"chrome://game/","vivaldi://saga/":"chrome://saga/","vivaldi:saga":"chrome://saga/"};function S(e){return e.startsWith("vivaldi:")||e.startsWith(d.u7)?b[e]||h.ZuY:e}const w=["settings","startpage","bookmarks","history","calendar","chat","notes","mailpage","dashboard","private-intro","experiments","vivaldi://flags/","chrome://flags/","session-recovery"],C=["chrome://settings/","chrome://apps/","chrome://password-manager/","chrome://password-manager-internals/","vivaldi://apps/","vivaldi://password-manager/","vivaldi://password-manager-internals/","chrome://extensions/","chrome://help/","vivaldi://extensions/"],A={settings:`${d.oP}/components/settings/settings.html`,startpage:`${d.u7}/startpage`,bookmarks:`${d.u7}/startpage?section=bookmarks`,history:`${d.u7}/startpage?section=history`,notes:`${d.u7}/startpage?section=notes`,calendar:`${d.u7}/startpage?section=calendar`,dashboard:`${d.u7}/startpage?section=dashboard`,speeddial:`${d.u7}/startpage?section=speeddial`,mailpage:`${d.oP}/components/mail/mail.html`,chat:`${d.oP}/components/mail/chat.html`,saga:`${d.oP}/saga/saga.html`,"guest-intro":`${d.oP}/components/guest-intro/guest-intro.html`,"private-intro":`${d.oP}/components/private-intro/private-intro.html`,welcome:`${d.oP}/components/welcome/welcome.html`,themecolors:`${d.oP}/components/themecolors/themecolors.html`,experiments:`${d.oP}/components/experiments/experiments.html`,actionlog:`${d.oP}/components/actionlog/actionlog.html`,"session-recovery":`${d.oP}/components/session-recovery/session-recovery.html`},I="https://vivaldi.com/bookmark/go",T={...A,about:"chrome://version","vivaldi-urls":"chrome://chrome-urls",blankpage:"about:blank",extensions:"chrome://extensions",game:"chrome://game",saga:"chrome://saga"},Z=[T.settings,T.bookmarks,T.history,T.notes,T.calendar,T.mailpage,T.chat,T.themecolors,T.experiments,T.actionlog,T.game,T.dashboard,T.speeddial,T["session-recovery"]],E=[{displayUrl:"vivaldi://history",url:T.history,copyParams:!0},{displayUrl:"vivaldi://calendar",url:T.calendar,copyParams:!0},{displayUrl:"vivaldi://dashboard",url:T.dashboard,copyParams:!0},{displayUrl:"vivaldi://notes",url:T.notes,copyParams:!0},{displayUrl:"vivaldi://bookmarks",url:T.bookmarks,copyParams:!0},{displayUrl:"vivaldi://settings",url:T.settings,copyParams:!0},{displayUrl:"",url:T.startpage,copyParams:!1},{displayUrl:"vivaldi://startpage",url:T.startpage,copyParams:!1,mapDisplayUrlToUrl:(e,t)=>i.ZP.getStartpage(a.ZP.getLastActiveBrowserWindowId())},{displayUrl:"",url:"chrome://newtab",copyParams:!1},{displayUrl:"",url:T.blankpage,copyParams:!1},{displayUrl:"vivaldi://mail",url:T.mailpage,copyParams:!0},{displayUrl:"vivaldi://saga",url:T.saga,copyParams:!0},{displayUrl:"vivaldi://chat",url:T.chat,copyParams:!0},{displayUrl:"vivaldi://about",url:T.about,copyParams:!0},{displayUrl:"vivaldi://help",url:"https://vivaldi.com/help",copyParams:!0},{displayUrl:"vivaldi://vivaldi-urls",url:T["vivaldi-urls"],copyParams:!0},{displayUrl:"vivaldi://extensions",url:"chrome://extensions",copyParams:!0},{displayUrl:"vivaldi://guest-intro",url:T["guest-intro"],copyParams:!0},{displayUrl:"",url:T["private-intro"],copyParams:!0},{displayUrl:"vivaldi://welcome",url:T.welcome,copyParams:!0},{displayUrl:"vivaldi://themecolors",url:T.themecolors,copyParams:!0},{displayUrl:"vivaldi://experiments",url:T.experiments,copyParams:!0},{displayUrl:"vivaldi://actionlog",url:T.actionlog,copyParams:!0},{displayUrl:"vivaldi://game",url:T.game,copyParams:!1},{displayUrl:"vivaldi://session-recovery",url:T["session-recovery"],copyParams:!0},{displayUrl:d.f4,url:d.f4,copyParams:!1,mapUrlToDisplayUrl:e=>e},{displayUrl:"about:about",url:T.about,copyParams:!1},{displayUrl:"chrome://history",url:T.history,copyParams:!0},{displayUrl:"chrome://bookmarks",url:T.bookmarks,copyParams:!0},{displayUrl:"chrome://newtab",mapDisplayUrlToUrl:e=>M(e)?i.ZP.getStartpage(a.ZP.getLastActiveBrowserWindowId()):e,copyParams:!1},{displayUrl:"vivaldi://",url:"chrome://",copyParams:!0,mapDisplayUrlToUrl:(e,t)=>"vivaldi://"===e?T.about:function(e,t){const n=t.copyParams&&e.length>t.displayUrl.length?(0,u.Iw)(e.slice(t.displayUrl.length)):"";return(t.url||"")+n}(e,t),mapUrlToDisplayUrl:(e,t)=>function(e,t){const n=t.copyParams&&e.length>(t.url||"").length?(0,u.Iw)(e.slice((t.url||"").length)):"";return t.displayUrl+n}(e,t)},{displayUrl:"vivaldi:",copyParams:!1,mapDisplayUrlToUrl:e=>{const t=e.indexOf("/"),n=-1===t?e.length:t,i=T[e.substring(8,n)];return i?f(e,{displayUrl:e.substring(0,n),url:i,copyParams:!0}):e}}];function k(e){let t=e;if(-1===t.indexOf("://")){const e=t.indexOf(":");e>-1&&(t=t.slice(0,e)+"://"+t.slice(e+1))}return"/"!==t[t.length-1]&&(t+="/"),t}function _(e){const t=k(e);if(!(t in y))return w.includes(t);const n=y[t];return w.includes(n)}function N(e){const t=k(e);for(let e=0;e<C.length;e++){const n=C[e];if((0,u.uu)(n,t)||t.startsWith(n))return!0}return!1}function P(e){return L(e)?h.bqs.small:e===T.history?h.hcy.small:e===T.bookmarks?h.CLf.small:e===T.calendar?h.bcq.small:e.startsWith(T.dashboard)||e.startsWith(T.notes)?h.cyI.small:e===T.welcome?h.UQS:M(e)?h.VPD:H(e)?h.lvj.small:function(e){return"string"==typeof e&&0===e.indexOf(T.chat)}(e)?"/resources/vivaldi_chat_default.png":e.startsWith(T.game)?"chrome://favicon/chrome://game/":e.startsWith(T.extensions)?"chrome://favicon/chrome://extensions/":e===T["private-intro"]?h.d7l:e===T["guest-intro"]?h.CtH.small:e===T["session-recovery"]?h.VPD:void 0}function D(e,t){if(t)return{favIconUrl:t,favIconLoadType:"faviconFromCache"};const n=e?P(e):"";return e&&U(e)&&n?{favIconUrl:n,favIconLoadType:"faviconFromCache"}:{favIconUrl:e??"",favIconLoadType:"page"}}function M(e){const t=s.Z.get(p.kExtensionURLOverrides)?.newtab?.find((e=>e.active)),n=s.Z.get(p.kTabsNewPageLink)===d.Fp.EXTENSION;return t&&n?e===t.entry:e.startsWith("chrome://newtab")||e.startsWith(T.startpage)||e.startsWith("vivaldi://startpage")}function O(e){return e.startsWith("vivaldi://startpage?section=")||e.startsWith(T.bookmarks)||e.startsWith(T.history)||e.startsWith(T.notes)||e.startsWith(T.calendar)||e.startsWith(T.mailpage)||e.startsWith(T.chat)||e.startsWith(T.dashboard)}function x(e,t){return t.length>0&&t.startsWith(e)}function L(e){return x(T.settings,e)}const R=Object.keys(T).map((e=>T[e])),B=[...Object.keys(A).map((e=>A[e])),...Object.keys(y)];function F(e){return R.some((t=>e.startsWith(t)))}function W(e){return e.startsWith(T.game)||e.startsWith(T.extensions)}function U(e){return B.some((t=>e.startsWith(t)))}function V(e){return Z.some((t=>e.url.startsWith(t)))}function H(e){return"string"==typeof e&&0===e.indexOf(T.mailpage)}function G(e){return 0===e.indexOf(T.notes)}function $(e){const t=e=e.trim();if(e=e?e.toLowerCase():e,o.Z.isEnabled("chrome_pages")&&!e.startsWith("vivaldi:"))return t;const n=E.find((t=>t.displayUrl&&x(t.displayUrl,e)));if(!n)return t;return n.mapDisplayUrlToUrl?n.mapDisplayUrlToUrl(e,n):f(e,n)}function K(e){if(""===e||e.startsWith(d.f4))return d.f4;if(Y(e))return"";if(o.Z.isEnabled("chrome_pages")&&!e.startsWith("chrome-extension:"))return e;for(let t=0;t<E.length;t++){const n=E[t];if(n.url&&x(n.url,e)){e=n.mapUrlToDisplayUrl?n.mapUrlToDisplayUrl(e,n):m(e,n);break}}return e}function z(e,t){if(e){if(t||!e.startsWith("https:")&&!e.startsWith("http:"))if(e===T.blankpage)t=(0,r.Z)("title","Blank Page");else if(e.startsWith(T.bookmarks))t=(0,r.Z)("Bookmarks");else if(e.startsWith(T.history))t=(0,r.Z)("History");else if(e.startsWith(T.calendar))t=(0,r.Z)("Calendar");else if(e.startsWith(T.dashboard))t=(0,r.Z)("Dashboard");else if(e.startsWith(T.chat)){const n=(0,u.DP)(e).path;t=n?(0,r.Z)(`Chat: ${n}`):(0,r.Z)("Chat")}else if(e.startsWith(T.mailpage)){const n=(0,u.DP)(e).title;n?t=n:t&&"Mail"!==t||(t=(0,r.Z)("Mail"))}else if(e.startsWith(T.notes))t.startsWith(T.notes)&&(t=(0,r.Z)("Notes"));else if(M(e)||M(t))t=(0,r.Z)("browser","Start Page");else if(e===T.experiments)t=(0,r.Z)("Experimental Features");else if(e===T.actionlog)t=(0,r.Z)("Action Log");else if(e===T["guest-intro"])t=(0,r.Z)("Guest Profile Introduction");else if(e===T["private-intro"])t=(0,r.Z)("Private Window Introduction");else if(e===T.welcome)t=(0,r.Z)("Welcome");else if(e.startsWith(T.settings)){const n=(0,u.DP)(e).path,i=n?n.split("/")[0]:"general";t=(0,r.Z)("$1 Settings",v[i]?[v[i].title]:[i])}else e===T["session-recovery"]&&(t=(0,r.Z)("Session Recovery"));else t=(0,c.x0)(e);t===e&&(t=(0,u.Dy)(K(e)))}return t}function j(e){let{title:t="",url:n=""}=e;if("string"!=typeof e.vivExtData){const n=e.vivExtData;n?.fixedTitle&&(t=n?.fixedTitle)}return z(n,t)}function Y(e){return e.startsWith(d.P1)||e.startsWith(d.wU)||e.startsWith(d.aI)||e.startsWith(d.Cd)||e.startsWith(d.gy)||s.Z.get(p.kExtensionURLOverrides)?.newtab?.some((t=>t.active&&t.entry===e))}function X(e){return e.startsWith(d.P1)||e.startsWith(d.wU)||e.startsWith(d.aI)||e.startsWith(d.Cd)||e.startsWith(d.gy)||e===d.f4||function(e){return s.Z.get(p.kTabsNewPageLink)===d.Fp.CUSTOM&&s.Z.get(p.kTabsNewPageCustomUrl)===e}(e)||function(e){return s.Z.get(p.kTabsNewPageLink)===d.Fp.HOMEPAGE&&s.Z.get(p.kHomepageCache)===e}(e)||Boolean(s.Z.get(p.kExtensionURLOverrides)?.newtab?.some((t=>t.active&&t.entry===e)))}const Q={internals:T,settingCategories:v,isNewTabPage:X,isBannedFromGuestMode:_,isBannedFromPrivateProfileWindows:N,getExtensionUrlFromInternalProtocolUrl:function(e){return e in y?A[y[e]]:e},getFavicon:function(e){if(e.startsWith(I)){const t=g?.find((t=>t.redirect_url===e));return t?.image_url}if(U(e)||W(e)){const t=P(e);if(t)return t}},getFaviconWithFallback:function(e,t){if(U(e)||W(e)){const n=P(e);if(n)return n;if(""===t)return"/resources/favicon@2x.png"}else if(""===t)return"/resources/default_favicon_64.png";return t},getBookmarkFavicon:D,getDisplayUrlFromMapping:K,getHoverUrl:function(e){let t=K(e);return""===t&&M(e)&&(t="vivaldi://startpage/"),t},getDisplayTitleByUrl:z,getDisplayTitle:j,hasCustomFavicon:W,removeTrailingSlashWhenNoPath:u.Dy,getUrl:$,isMailPage:H,isNotesManager:G,isStartPage:M,isInternalUrl:F,isVivaldiComponent:U,isExtensionProtocol:function(e){return e.startsWith(d.Fv)},isOurExtension:function(e){return e.startsWith(d.oP)},isInternalPage:function(e){return F(e.url||"")},isSettingsUrl:L,matchInternal:function(e,t){return x(T[e],t)},matchUrl:x,equalUrl:function(e,t,n){return n?e&&t&&(0,u.OI)(e)===(0,u.OI)(t):e&&t&&(0,u.Iw)(e)===(0,u.Iw)(t)},internalUrl:function(e,t,n,i){const s=T[e],o=s.includes("?")?"&":"?";return s+o+"path="+encodeURIComponent((0,u.Iw)(t))+(n?"&title="+encodeURIComponent(n):"")+(i?"&query="+encodeURIComponent(i):"")},getDirectMatchPopularSites:async function(){return 0!==g.length||(g=await l.Z.directMatch.getPopularSites()),g},isBlankUrl:Y}},14507:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var i=n(67294),s=n(29087);const o=function(e){const[t,n]=i.useState((()=>s.Z.getList(e)));return i.useEffect((()=>{function t(e,t,i){n((e=>({...e,[i]:t})))}return s.Z.addListener(e,t),()=>{s.Z.removeListener(e,t)}}),[e]),t}},39005:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});var i=n(65398),s=n(29087),o=n(33638),a=n(75401),r=n(84283),l=n(89165),d=n(89175),c=n(27569),u=n(76257);class p extends i.Z{#ci;getActiveMessage(){return this.#ci&&this.#ci.state.message}getActiveMessageUrl(){const e=this.getActiveMessage();return e?`vivaldi://mail/message/${e.id}`:void 0}getActiveListEntry(){return this.#ci&&this.#ci.props.listEntry}getAttachments(){return this.#ci&&this.#ci.state.message?this.#ci.state.message.bodyParts?(0,c.yN)(this.#ci.state.message.bodyParts).filter((e=>!e.inUse)):this.#ci.state.raw?(0,u.Dc)(this.#ci.state.raw.mimeTree):[]:[]}getRaw(){return this.#ci&&this.#ci.state.raw}getRenderingMethod(){return this.#ci?.state.renderingMethod??s.Z.get(d.kMailPreferredRendering)}getIsRawMode(){return Boolean("raw"===this.#ci?.state.renderingMethod)}isTrash(){return!(!this.#ci||!this.#ci.props.listEntry)&&r.Z.isMessageDeleted(this.#ci.props.listEntry.sources)}isJunk(){if(this.#ci&&this.#ci.props.listEntry){const{sources:e,flags:t}=this.#ci.props.listEntry;return(0,l.Z)(e,t)}return!1}isArchived(){return!(!this.#ci||!this.#ci.props.listEntry)&&(0,a.Z)(this.#ci.props.listEntry.sources)}isListPost(){return!!this.#ci?.state.message?.listPost}toggleRenderingMethod(e){this.#ci&&this.#ci.toggleRenderingMethod(e)}dispatchAction(e){switch(e.actionType){case"MAIL_SET_ACTIVE_COMPONENT":this.#ci!==e.mailDetail&&(this.#ci=e.mailDetail,this.emitChange());break;case"MAIL_SET_ACTIVE_MESSAGE":this.#ci&&(this.#ci.setState({message:e.message}),this.emitChange());break;case"MAIL_CLEAR_IF_ACTIVE":this.#ci===e.mailDetail&&(this.#ci=void 0,this.emitChange());break;case"MAIL_INDEX_UPDATE":{const{updates:t}=e;if(!this.#ci||!this.#ci.props.listEntry||!t.sleUpdates)return;const{id:n}=this.#ci.props.listEntry;t.sleUpdates.some((e=>e.id===n))&&this.emitChange();break}case"MAIL_REFRESH_ACTIVE_MESSAGE":this.emitChange()}}}const h=new p(o.Z)},30626:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var i=n(65398),s=n(33638);const o=new Map;class a extends i.Z{getActiveWebView(e){return o.get(e)}dispatchAction(e){switch(e.actionType){case"WEBVIEW_CLEAR_IF_ACTIVE":this.getActiveWebView(e.windowId)===e.component&&(o.delete(e.windowId),this.emitChange());break;case"WEBVIEW_SET_ACTIVE":o.set(e.windowId,e.component),this.emitChange()}}}const r=new a(s.Z)},59486:(e,t,n)=>{"use strict";n.d(t,{E:()=>f,Z:()=>Y});var i=n(65398),s=n(68247),o=n(29087),a=n(93974),r=n(33638),l=n(56371),d=n(92292),c=n(57118),u=n(30460),p=n(65741),h=n(20511),g=n(89175),m=n(44850);const f=(0,l.Z)("Bookmarks"),v="topsite-",y=new Map,b=new Map;let S,w,C,A,I,T,Z=[],E=[],k=[],_=!1,N=!1,P=!1,D=[],M=!1;const O=new Map;function x(e,t){const{url:n,title:i,description:s,nickname:o}=e;return t.toLowerCase().split(" ").every((e=>n!==u.p&&n?.toLowerCase().includes(e)||i.toLowerCase().includes(e)||s.toLowerCase().includes(e)||o.toLowerCase().includes(e)))}function L(e){I?.children&&I.children.forEach((e=>{y.delete(e.id)}));const t=e.map(((e,t)=>{const n={id:v+t,title:e.title,url:e.url,nickname:"",description:"",thumbnail:"",partner:e.partner,speeddial:!0,themeColor:"",bookmarkbar:!1,trash:!1,faviconUrl:e.faviconUrl};return y.set(n.id,n),n}));I={id:"topsite-folder",title:(0,l.Z)("Top Sites"),nickname:"",description:"",thumbnail:"",partner:"",speeddial:!0,themeColor:"",bookmarkbar:!1,trash:!1,children:t}}class R extends i.Z{isInitialized(){return M}getRootId(){return S?.id}getTopNodes(){return S?.children||[]}getLastTopNode(){const e=j.getTopNodes();if(e.length>1)return e[e.length-2]}getBookmarkBarFolderId(){return w?.id}getBookmarksBarNodes(){return Z}getSpeeddialFolders(){return E}getTopSiteFolder(){return I}getActiveGroup(e){return O.get(e)??o.Z.get(g.kStartpageSpeedDialRestorePageId)}isFailedUpgrade(){return P}getItemById(e){return y.get(e)}getItemByUrl(e){for(const t of j.iterateTree())if(t.url===e)return t}getUrlByNode(e){return e.url&&j.filterUrl(e.url)||""}filterUrl(e){return e===u.p?"":e}getDragData=(e,t)=>{const n=t.map((e=>j.getItemById(e))).filter(Boolean);if("text/plain"===e){const e=[];return n.forEach((t=>{const n=j.isFolder(t)?t.title:m.jk.getHoverUrl(j.getUrlByNode(t));e.push(n)})),e.join("\r\n")}if("text/html"===e){const e=n&&1===n.length?n[0]:void 0;if(e){const t=m.jk.getHoverUrl(j.getUrlByNode(e));if(t&&e.title)return"<a href="+t+">"+e.title+"</a>"}return""}if("vivaldi/x-title"===e)return n[0]&&n[0].title||"";if("text/uri-list"===e||"vivaldi/x-uri-list"===e){const e=[];return n.forEach((t=>{j.isFolder(t)||e.push(m.jk.getHoverUrl(j.getUrlByNode(t)))})),e.join("\r\n")}return""};getCutIds(){return k}getFilteredTree(e,t){e=e.toLowerCase();const n=[];function i(s){const o=[];for(const a of s)if(t.inTrash||!a.trash){if(a.children?.length){const e=i(a.children);if(e.length&&t.folders){o.push({...a,children:e});continue}}if(x(a,e)){const e={...a};a.children&&t.folders&&n.push(a.id),e.children&&t.folders&&o.push({...e,children:i(e.children)}),!e.children&&t.bookmarks&&o.push(e)}}return o}return{nodes:t.root?i(S?[S]:[]):i(j.getTopNodes()),collapsed:n}}getFilteredFlat(e,t){e=e.toLowerCase();const n=[],i=j.iterateTrees(j.getTopNodes(),t.inTrash);for(const s of i)(s.children&&t.folders||!s.children&&t.bookmarks)&&x(s,e)&&(s.children?n.push({...s,children:[]}):n.push({...s}));return n}treeSortComparator(e,t,n){if(e.trash)return 1;if(t.trash)return-1;if(j.isFolder(e)&&!j.isFolder(t))return-1;if(j.isFolder(t)&&!j.isFolder(e))return 1;const{sortOrder:i}=n;let{sortField:s}=n;e[s]||t[s]||(s="title",e[s]||t[s]||(s="dateAdded"));return a.Z.getDefaultComparator(i,s)(e,t)}getFoldersWithin(e,t){return e.filter((e=>!e.trash&&e.children&&!e.url)).reduce(((e,{id:n,title:i,children:s})=>(e.push({id:n,title:i,level:t}),s?e.concat(j.getFoldersWithin(s,t+1)):e)),[])}hasNickname(e){if(""===e.trim())return!1;e=e.toLowerCase();for(const t of j.iterateTree(!0))if(e===t.nickname.toLowerCase())return!0;return!1}getNicknamed(e,t){if("string"!=typeof e||e.length<1)return[];e=e.toLowerCase();const n=[];for(const i of j.iterateTree())e===i.nickname.toLowerCase()&&(i.children?t?i.children.forEach((e=>j.isBookmark(e)&&n.push(e))):n.push(i):j.isBookmark(i)&&n.push(i));return n}getDefaultFolderName(){return(0,l.Z)("title","New Folder")}isTrashed(e){return void 0!==C&&j.isDescendantOf(e,C)}isDescendantOf(e,t){for(;;){if(e.id===t)return!0;if(!e.parentId)break;const n=e.parentId?y.get(e.parentId):void 0;if(!n)break;e=n}return!1}isFolder(e){return e.children&&e.children.length>0||void 0===e.url}isPartner(e){return Boolean(e.partner)}isSeparator=e=>"---"===e.title&&"separator"===e.description;isBookmark(e){return!j.isFolder(e)&&!j.isSeparator(e)&&Boolean(e.url?.length)&&e.url!==u.p}isMobileFolder(e){return Boolean(e.id===A)}isTopSite(e){return e.startsWith(v)}validateAsBookmarkBarFolder(e){const t=j.getItemById(e);if(t&&t.children&&!j.isTrashed(t))return t}validateForClipboard=e=>e.filter((e=>e!==C&&e!==A));validateForDrag=e=>e.filter((e=>e!==C&&e!==A));validateForDeletion=e=>e.filter((e=>e!==C&&e!==A));validateForEdit=e=>{if(-1!==D.indexOf(e))return!1;const t=j.getItemById(e);return!(!t||j.isSeparator(t))};getTitle=e=>j.getItemById(e)?.title??"";*iterateTree(e=!1){yield*j.iterateTrees(S?.children||[],e)}*iterateTrees(e,t=!1){for(const n of e)n.trash&&!t||(yield n,n.children&&(yield*j.iterateTrees(n.children,t)))}findByUrl(e){for(const t of j.iterateTree())if(t.url===e)return t}emitChange(){_?N=!0:super.emitChange()}__reset(e){S=e}dispatchAction(e){switch(e.actionType){case"BOOKMARKS_INIT":!function(e,t,n,i,s){D=[],D.push(e[0].id),e[0].children.forEach((e=>{D.push(e.id)}));const o=e[0],a=o.children.find((e=>e.id===t.bookmarks));if(!a)return void console.error("Root bookmark id missing");if(t.mobile){const e=o.children.find((e=>e.id===t.mobile));e&&(A=e.id,e.parentId=a.id,e.index=a.children.length,a.children.push(e))}if(t.trash){const e=o.children.find((e=>e.id===t.trash));e&&(C=e.id,e.parentId=a.id,e.index=a.children.length,a.children.push(e))}void 0===C&&console.error("Trash folder missing");if(b.clear(),Array.isArray(s.folders))for(const e of s.folders)b.set(e.guid,e.title);y.clear(),U(a),S=a,S.parentId=void 0,L(n),H(),P=i}(e.bookmarks,e.folderIds,e.topSites,e.failedUpgrade,e.partnerDB),M=!0,this.emitChange();break;case"BOOKMARKS_SET_BATCH_MODE":e.edit?_=!0:(_=!1,N&&(this.emitChange(),N=!1));break;case"BOOKMARKS_ADD_ITEM":G(e.changes);break;case"BOOKMARKS_CHANGE_ITEM":!function(e,t){let n=y.get(e);if(!n)return;let i=!1;for(const e of Object.keys(t))if(t[e]!==n[e]){i=!0;break}if(!i)return;const s=n.bookmarkbar||t.bookmarkbar!==n.bookmarkbar,o=n.speeddial||t.speeddial!==n.speeddial;n={...n,...t},y.set(n.id,n);let a=null;n.parentId?(a=y.get(n.parentId),a&&a.children&&(void 0!==n.index?a.children[n.index]=n:(a.children[0]=n,console.error("Bookmark node not properly changed. index is missing")))):S&&(S.children=n.children||[]);a&&z(a,s,o);j.emitChange()}(e.id,e.changes);break;case"BOOKMARKS_INSTALL_TOPSITES":void 0!==T&&(L(T),T=void 0,this.emitChange());break;case"BOOKMARKS_MOVE_ITEM":!function(e,t){const n=j.getItemById(e);if(!n)return;$(e,!1),n.parentId=t.parentId,n.index=t.index,G(n)}(e.id,e.changes);break;case"BOOKMARKS_REMOVE_ITEM":$(e.id,!0);break;case"BOOKMARKS_SET_ACTIVE_GROUP":O.set(e.windowId,e.id),s.Z.set(g.kStartpageSpeedDialRestorePageId,e.id);break;case"BOOKMARKS_SET_CUT_IDS":F(e.ids),this.emitChange();break;case"BOOKMARKS_SET_TOPSITES":I?.children&&(I?.children.length>e.topSites.length||I?.children.some((t=>void 0!==e.topSites.find((e=>t.url===e.url)))))?(L(e.topSites),T=void 0,this.emitChange()):T=e.topSites;break;case"WINDOW_CLOSED":O.delete(e.windowId);break;case"WINDOW_READY":k.length>0&&W(!0)}}}function B(e){"Escape"===e.key&&F([])}function F(e){k=e,W(e.length>0),j.emitChange()}function W(e){e?d.Z.extension.getViews().forEach((e=>{e.addEventListener("keydown",B,!0)})):d.Z.extension.getViews().forEach((e=>e.removeEventListener("keydown",B,!0)))}function U(e){if(e.partner){const t=b.get(e.partner);if(t)switch(t){case"Bookmarks":e.title=f;break;case"Speed Dial":e.title=(0,l.Z)("Speed Dial");break;case"Vivaldi":e.title=(0,l.Z)("Vivaldi")}}if(y.set(e.id,e),e.children)for(const t of e.children)U(t)}function V(e){if(y.delete(e.id),e.children)for(const t of e.children)V(t)}function H(){const e=[];let t;const n=function(i){i.url||i.trash||(i.speeddial&&e.push(i),i.bookmarkbar&&(t=i),i.children&&i.children.forEach(n))};S?.children&&S.children.forEach(n),E=function(e){if(e.length<2)return e;let t=[...o.Z.get(g.kStartpageSpeedDialOrder)];if(t.length){const n=e.map((e=>e.id),[]);o.Z.get(g.kDashboardEnabled)&&n.push(c.N4),n.length&&t.length&&!(0,p.Z)([...n].sort(),[...t].sort())&&(t=t.filter((e=>n.includes(e))),t=(0,h.Z)(n,t),s.Z.set(g.kStartpageSpeedDialOrder,t))}return e}(e),w=t||S,Z=(w?.children||[]).filter((e=>!e.trash))}function G(e){const t=e.parentId?y.get(e.parentId):void 0;if(t){const n=t;void 0===e.url&&(e.children||(e.children=[])),U(e),n.children?.splice(e.index||0,0,e),K(n);z(n,!1,Boolean(e.speeddial))}j.emitChange()}function $(e,t){const n=y.get(e);if(!n)return;V(n);const i=n.parentId?y.get(n.parentId):void 0;if(i){const t=i;void 0!==n.index?t.children?.splice(n.index,1):console.error("Bookmark node not removed. index is missing"),K(t);z(t,j.getBookmarkBarFolderId()===e,Boolean(n.speeddial))}t&&j.emitChange()}function K(e){e.children&&e.children.forEach(((e,t)=>{e.index=t}))}function z(e,t,n){for(;e;){e.children=e.children?.slice(),j.getBookmarkBarFolderId()===e.id&&(t=!0),e.speeddial&&(n=!0);const i=e.parentId?y.get(e.parentId):void 0;if(!i)break;e=i}(t||n)&&H()}const j=new R(r.Z),Y=j},27508:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var i=n(24602);class s extends i.Z{getInitialState(){return{isActive:!1}}reduce(e,t){return"BREAKMODE"===t.actionType?{isActive:!e.isActive}:e}}const o=new s},50522:(e,t,n)=>{"use strict";n.d(t,{Z:()=>b});var i=n(2934),s=n(24602),o=n(42568),a=n.n(o),r=n(30381),l=n.n(r),d=n(58821),c=n(8336),u=n(93513);let p=(0,d.EP)(),h=!1;const g=new Map,m=a()((function(e,t){const n=new Map(e.map((e=>[e.id,e.account_type])));return t.filter((e=>!e.hidden&&n.has(e.accountId)&&"ical"!==n.get(e.accountId)))})),f=a()((function(e){return e.filter((e=>!e.hidden))})),v=a()((function(e,t){const n=new Set(e.map((e=>e.id)));return t.filter((e=>n.has(e.calendarId))).filter((e=>!(e.trash||e.deletePending)))}));class y extends s.Z{getInitialState(){return{accounts:[],calendars:[],events:[],tasks:[],templates:[],currentEdit:{windowId:0,pageId:0,eventId:null}}}isInitialized(){return h}reduce(e,t){switch(t.actionType){case"CALENDAR_INIT":return g.clear(),h=!0,(0,u.Uy)(e,(e=>{const{accounts:n,calendars:i,events:s}=t,o=s.filter((e=>e.task));e.accounts=n,e.calendars=i,e.events=s,e.tasks=o}));case"CALENDAR_INIT_TEMPLATES":return(0,u.Uy)(e,(e=>{const{templates:n}=t;e.templates=n}));case"CALENDAR_SET_EVENTS":return g.clear(),(0,u.Uy)(e,(n=>{const{events:i}=t;for(const t of i){const i=e.events.findIndex((e=>e.id===t.id));if(-1===i)n.events=[...n.events,t],t.task&&(n.tasks=[...n.tasks,t]);else{n.events.splice(i,1,t);const s=e.tasks.findIndex((e=>e.id===t.id));t.task&&-1!==s&&n.tasks.splice(s,1,t)}}}));case"CALENDAR_EVENT_EDIT":return(0,u.Uy)(e,(e=>{e.currentEdit=t.edit}));case"CALENDAR_ADD_TEMPLATE":return(0,u.Uy)(e,(e=>{const{template:n}=t;e.templates.push(n)}));case"CALENDAR_UPDATE_TEMPLATE":return(0,u.Uy)(e,(e=>{const{templateId:n,template:i}=t,s=e.templates.findIndex((e=>e.id===n));-1!==s&&e.templates.splice(s,1,i)}));case"CALENDAR_REMOVE_TEMPLATE":return(0,u.Uy)(e,(e=>{const{templateId:n}=t,i=e.templates.findIndex((e=>e.id===n));-1!==i&&e.templates.splice(i,1)}));default:return e}}getState(){const e=(0,d.EP)();return e!==p&&(i.ZP.loadPromise(),p=e),super.getState()}getAccounts(){return this.getState().accounts}getCalendars(){return this.getState().calendars}getEvents(){return this.getState().events}getTasks(){return this.getState().tasks}getTemplates(){return this.getState().templates}getEvent(e){const[t,n]=e.split("-")[0].split(":"),i=this.getEvents().find((e=>e.id===t));return n&&i?c.tV.call([i],l()(parseInt(n)),"day")[0]:i}getEventsPerCalendar(e){const t=g.get(e);if(t)return t;const n=(0,u.Uy)([],(t=>this.getEvents().filter((t=>t.calendarId===e&&!t.trash))));return g.set(e,n),n}getWritableCalendars(){return m(this.getAccounts(),this.getCalendars())}getVisibleCalendars(){return f(this.getCalendars())}getVisibleEvents(){return v(this.getVisibleCalendars(),this.getEvents())}}const b=new y},6320:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var i=n(24602),s=n(9126),o=n(48588);class a extends i.Z{getInitialState(){return new Map}reduce(e,t){if("CALENDAR_UPDATE_UI"===t.actionType){const{pageId:n,filter:i}=t;return(0,o.J3)(e,n,i)}return e}getStateForPage(e){return this.getState().get(e)??(0,s.l)(e)}}const r=new a},65398:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var i=n(56284);class s extends i.Z{constructor(e){super(),e.register(this)}dispatchAction(e){throw new TypeError(`dispatchAction() is not overwritten in ${this.constructor.name}`)}}const o=s},25795:(e,t,n)=>{"use strict";n.d(t,{Z:()=>Ge});var i=n(27770),s=n(48603),o=n(59486),a=n(65398),r=n(27033),l=n(45502),d=n(84451),c=n(76747),u=n(59322),p=n(96951),h=n(18350),g=n(15285),m=n(20676),f=n(29087),v=n(66971),y=n(18237),b=n(76501),S=n(63365),w=n(93974),C=n(33638),A=n(70864),I=n(63153),T=n(15489),Z=n(53454),E=n(56371);var k=n(92292);const _=function(e){if(null===e||"object"!=typeof e)return e;const t=e.constructor();for(const n in e)e.hasOwnProperty(n)&&(t[n]=_(e[n]));return t},N=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(_(e[n]));return t};var P=n(26036);var D=n(94420),M=n(1810);const O="iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABFUlEQVR4AWJwL/ChCOOUsLKy2m9tbf0fhIHs9SQbACidvK0yCGIgHGISTEj0d4D3tgPoADrgOoAOoIMt6UrQ2XhLAH3vSTzhzwRr5WZGuxpYHh4e7hwfHy80gfyXgIDn09PTpM47FxcXr7pm7q+vr9dBgU3v73SfTk5OipgAp4U5PeoqGvxCIDa3690TSW0Vt3v1xBgqHL4gigluqAyNIOKDVeT+PlLlTmlcf9IAfigfHKXv+1URWSZRFNeDPUFEUQYEua7rraZpNqkY26vj9icRBYEiBbvLkYKLSHs/EqC6izJkgML9Y5vEBMqsXsHfgr0NodX4uD1qUIAEftbWNwIZBJhtBxs0Bj9lCyqn/IU06zMNHe/UfCL6J8KbGwAAAABJRU5ErkJggg==",x="iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAVFBMVEX////ExMTFxcXExMS/v7/FxcXExMTDw8PExMTFxcXHx8e/v7/ExMTExMTFxcXFxcXDw8PGxsbKysrFxcXCwsLDw8PFxcXExMTGxsbGxsbExMTExMQtledLAAAAG3RSTlMA79+fEJ/PgN9/ICCPvzBgkG8wr1BAT18/cHDxOv8OAAAAdUlEQVR4AQXBhQHDIAAAsOBQnRv//7kEAABgn/MOAOptiQBaOS5BnuWRvrDOa98y6wgjZqQEQCp49sYZ4psWP/DY6QTqBzwrgcj+grUPzh7ejLhgKwDsBWtsoS3kS7yGBX7bK82cw3akAaDejgoA0px3AADAH03KBE7hRjloAAAAAElFTkSuQmCC";var L=n(50012),R=n(32782);var B=n(7064);var F=n(54189),W=n(70025),U=n(69046),V=n(10334),H=n(93196),G=n(29489),$=n(21191),K=n(89175),z=n(44850);let j=!1;const Y={windowId:void 0,name:"",items:[],installed:!1,radioCounter:1,radioGroup:{},hasBookmarkContainer:!1,bookmarkExtrasEdge:"below"},X=!1,Q="CONTAINER_WEBPANEL",q="CONTAINER_CLOSED_WEBPANEL",J="CONTAINER_TAB",ee="CONTAINER_PINNED_TAB",te="CONTAINER_CLOSED_TAB",ne="CONTAINER_ALL_WINDOW",ie="CONTAINER_ALL_WINDOW_LIST",se="CONTAINER_OTHER_WINDOW",oe="CONTAINER_OTHER_WINDOW_LIST",ae="CONTAINER_OTHER_WORKSPACE",re="CONTAINER_OTHER_WORKSPACE_LIST",le="CONTAINER_SESSIONS",de="CONTAINER_BOOKMARK",ce="CONTAINER_PERIODIC_RELOAD",ue="CONTAINER_MAC_SERVICES",pe="CONTAINER_SHARE_MENU",he=["COMMAND_OPEN_LINK","COMMAND_OPEN_LINK_BACKGROUND","COMMAND_OPEN_LINK_CURRENT","COMMAND_OPEN_LINK_DEFAULT","COMMAND_HIDE_OTHERS","COMMAND_HIDE_VIVALDI","COMMAND_SHOW_ALL"],ge=[{name:Q,hideInSettings:!1},{name:q,hideInSettings:!1},{name:J,hideInSettings:!1},{name:ee,hideInSettings:!1},{name:te,hideInSettings:!1},{name:ne,hideInSettings:!1},{name:ie,hideInSettings:!1},{name:se,hideInSettings:!1},{name:oe,hideInSettings:!1},{name:ae,hideInSettings:!1},{name:re,hideInSettings:!1},{name:le,hideInSettings:!1},{name:ce,hideInSettings:!1},{name:de,hideInSettings:X},{name:ue,hideInSettings:!0},{name:pe,hideInSettings:!0}];let me=[];const fe={},ve=new Map(H.CN.map((e=>[e.name,e.feature]))),ye=["COMMAND_CLOSE_TAB","COMMAND_CLOSE_WINDOW","COMMAND_EXIT","COMMAND_QUIT_MAC_MAYBE_WARN","COMMAND_NEW_WINDOW","COMMAND_NEW_PRIVATE_WINDOW","COMMAND_SHOW_HELP","COMMAND_WINDOW_MINIMIZE"],be=H.CN;let Se;function we(e){const t=Se||(Se={MENU_FILE:{...(0,P.Z)("win_linux","File")},MENU_EDIT:{...(0,P.Z)("win_linux","Edit")},MENU_VIEW:{...(0,P.Z)("win_linux","View")},MENU_BOOKMARKS:{isVisible:()=>!T.ZP.isGuest(),...(0,P.Z)("win_linux","Bookmarks")},MENU_PANELS:{...(0,P.Z)("win_linux","Panels")},MENU_TOOLS:{...(0,P.Z)("win_linux","Tools")},MENU_MAIL:{isVisible:()=>!f.Z.get(K.kMailIsTurnedOff),...(0,P.Z)("win_linux","Mail")},MENU_WINDOW:{...(0,P.Z)("win_linux","Window")},MENU_HELP:{...(0,P.Z)("win_linux","Help")},MENU_IMAGES_AND_ANIMATION:{...(0,P.Z)("win_linux","Images and Animations")},MENU_CAPTURE:{iconPNG:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAADCSURBVHgB1ZHBEcIgEEXB5JBjSsASvDFwoRMtQSvQDqwhlXiCqyXEDsydYfDvIRlEUK/5h7Cz87O8zzK2evFSU2s94hBpL8b4cM5t2S8ZY4RSaiwMfUopRd5v6YMfDpzzK8reez+hPuZGEJyaprlhkCAaeC7W2mFBLk3/RklEKV7MTURFJoqDc88+I8UlQklAPIcQdl3XMcS6ozWUfBtWVz8XyDzVTFWC+dFwe1961DfVVlRTuuo2vY1W9M+A2qpXqhfDA07BmbR5ZAAAAABJRU5ErkJggg==",iconPNGWhite:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAAXNSR0IArs4c6QAAAGRJREFUeNq9j8EVwCAIQx2FzeqmvcTnGBmBEegBq/hKjy3ckk+Mpfw5IMy3MbFPWTK0S7BahcKgOIJCWONQwI0PmVAHLGbNu+UsAOwy71JAu2xl7fkEY9kb0LeSI8s/lWzI+nQuBXxjN95EoeQAAAAASUVORK5CYII=",...(0,P.Z)("win_linux","Capture")},MENU_EXPORT:{...(0,P.Z)("win_linux","Export")},COMMAND_OPEN_PAGE:{ellipsis:!0},COMMAND_FOCUS_ADDRESSFIELD:{ellipsis:!0,...(0,P.Z)("Open Location")},COMMAND_SAVE_PAGE:{ellipsis:!0},COMMAND_PRINT_PAGE:{ellipsis:!0},COMMAND_START_CHROMECAST:{ellipsis:!0},COMMAND_IMPORT_DATA:{ellipsis:!0},COMMAND_EXPORT_DATA:{ellipsis:!0},COMMAND_EXPORT_FEEDS:{ellipsis:!0},COMMAND_EXPORT_PASSWORDS:{ellipsis:!0},COMMAND_EXPORT_READINGLIST:{ellipsis:!0},COMMAND_EXPORT_NOTES:{ellipsis:!0},COMMAND_OPEN_SESSION:{ellipsis:!0},COMMAND_SAVE_SESSION:{ellipsis:!0},COMMAND_TOGGLE_WARN_ON_QUIT:{prefs:{pref:K.kSystemShowExitConfirmationDialog,isChecked:()=>!0===f.Z.get(K.kSystemShowExitConfirmationDialog)}},COMMAND_FIND_IN_PAGE:{ellipsis:!0},COMMAND_TOGGLE_MENU_POSITION:{prefs:{pref:K.kMenuDisplay,isChecked:()=>{const e=f.Z.get(K.kMenuDisplay);return!0===e||"top"===e||"on"===e}},...(0,P.Z)("Horizontal Main Menu")},COMMAND_MAIN_TOGGLE_TAB_BAR:{prefs:{windowState:"tabs",isChecked:e=>T.ZP.getVisibleUI(e).tabs},...(0,P.Z)("command","Show Tab Bar")},COMMAND_MAIN_TOGGLE_ADDRESS_BAR:{prefs:{windowState:"addressBar",isChecked:e=>T.ZP.getVisibleUI(e).addressBar},...(0,P.Z)("command","Show Address Bar")},COMMAND_SHOW_BOOKMARK_BAR:{prefs:{windowState:"bookmarksBar",isChecked:e=>T.ZP.getVisibleUI(e).bookmarksBar},...(0,P.Z)("command","Show Bookmarks Bar")},COMMAND_TOGGLE_FOOTER:{prefs:{windowState:"statusBar",isChecked:e=>"on"===T.ZP.getVisibleUI(e).statusBar},...(0,P.Z)("command","Show Status Bar")},COMMAND_TOGGLE_STARTPAGE_NAVIGATION:{prefs:{pref:K.kStartpageNavigation,isChecked:()=>{const e=f.Z.get(K.kStartpageNavigation);return"on"===e||"speed_dial_only"===e}},...(0,P.Z)("command","Show Start Page Navigation")},COMMAND_TOGGLE_PRIVACY_STATS:{prefs:{pref:K.kStartpageSpeedDialPrivacyStatsShow,isChecked:()=>{const e=f.Z.get(K.kStartpageSpeedDialPrivacyStatsShow);return!0===e||"speed_dial_only"===e}},...(0,P.Z)("command","Show Privacy Statistics")},COMMAND_TOGGLE_PANEL:{prefs:{panelState:"SHOW_PANEL",isChecked:e=>g.ZP.getIsBarVisible(e)},...(0,P.Z)("command","Show Panel")},COMMAND_SHOW_BOOKMARK_PANEL:{iconPNG:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAACJSURBVHgB7ZKxCoAgEIavaG3wBcJGt2ZdnHurXiR6itY2X6Pew8HOUAgREaWtH0Tvzv87Dg6gUk2YEEKceNHYZ2PMpZQaISUEmCDV+xOpQQuV+gFfA6SUlDE2FAGsWWt9EEL2FKRLmXHzNhs7yJwN8GZc28XGnPMHArkjvM1W7r1CjrDbVFIr1g1wAzRdx1+LFgAAAABJRU5ErkJggg==",iconPNGWhite:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAAXNSR0IArs4c6QAAAE9JREFUeNpjYCAWHLl/5D8CHr2PqeA/hP7PC4Iw3jBVsF/hmjYeBfsVjtw/+hCkBKsCsHT90XqQEqwKQNIgFkgJVgUQaYgSLAqOGuDm4QUAABBqP/s39jMAAAAASUVORK5CYII=",persistent:!0},COMMAND_SHOW_MAIL_PANEL:{iconPNG:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAACFSURBVHgB7ZHRDYAgDETBMAhuoL8wBZOyBb+6gWyCVyOmQSAMwCWkTem7tKkQUzIn1toLQY9AKaUYQlgpV6yu8bEjejyHhpNDxphNSunR4xCPXF940ws5MiGgBpfGqhyPGgBkE/fs2YB/E9Qm6cFNA27Sg6srVEy64gYRp0xiQHRGMfXpBmxdTd/71HkZAAAAAElFTkSuQmCC",iconPNGWhite:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAATklEQVR42s3PsQ3AMAgEwB+J/ev/ORiFFAhjKxTuEqiAkwDgJ0FnvFPeIGRyWdUyuoyxAaBJjrO7gSI1HkASrlUDAGR9yQiO3+L+zY/jAaekW1uCzRxFAAAAAElFTkSuQmCC"},COMMAND_SHOW_CONTACTS_PANEL:{iconPNG:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAF0SURBVHgBtVM7boNAEOVnic72BSwiX8DpIn8UcgIfIeEEzg1QTuA6nW8Q5wZE4lcmXTrb0KTcBgnxzRuLtQhQIEUeabXLm3lvZ98IQfhniH2KFovFnSiK93TO89z3PO+D56Q+AmVZakVRqLQgpCNGPKfUCymRZdkzCJsK2g0Ggxfse+AbEiAwjmMSYK0O0jTdgjwE6QbrFtAYmGlZVozWv7q6E+u3o/jgOM64iZFgFEUa9jUu+IEHry0PqC0kWV0dN9M3S5JkKMvyOYddrXvQy0QKPOFMgg/k0yMXuQj4vn+Ew8JyudQ5Np/PZ+hKcF33pCiKxnESQcdrOv+ZAgQMEN5WqxXtjM6SJBlV6wzEeu2oJYDQiQjjPlVVpamQyAz43rZti2xp1Atyrd0nmj9ueaDnINh0On3H27eTyYSFYdg5RpmTsZmczJNcBPhO07RTEATfTQGpek+LzAOjJHMN5M2uDi4ewKQDfpquGvoXaB2Fa8QvffXhZBpebQgAAAAASUVORK5CYII=",iconPNGWhite:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAvklEQVR42pWQMQ7CMAxFMzLmBvgIjGx0ZOzIVjbGjh3bG/QIcBNL2EkkFo7gI+QIILeiTSMqgS1FSfzy429j/g/eU0ONP6wC7uRaTbTJJVrqOHLkHi1uqFEgQCp7HUrAN+6N8ccMQMtx3qF97FzrL8n7AE4mLXHbAK6lOukhB1QhQ1ioGBzsFPXl6CNUE0AFx3s5rnoaAV/PQOckAAILdd9Gc9by4AJYuFotfxD9Jh2SLGam/TwzgF/LnE3/EG8smIVnSsnf6AAAAABJRU5ErkJggg=="},COMMAND_SHOW_DOWNLOADS_PANEL:{iconPNG:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAADPSURBVHgBxZLBDYIwFIZblTtMAIYpBA51BKfwzAS6gUePzuAGvUC4OoFNF5B7k9a/Rkw1QCQQ/ZKmf1/7+t5rHyEjoV0baZpeMUVWG2NEWZZLMgRcYNr0JzMykv9fsGgEY8xXSt26Drrv4HlewDmv3zKwBkrpGlJorfOiKF4/9NQ5Ro091jhb5m4UKaWI4/iMbzuGYRhgza09y7I9bFs4r6qqurg+rX2AciKUc4LTIxIy85H2xo38FUmS7FD7gfyEvm7rOztdHwA+IAtOpuIO/nhVS2EDB78AAAAASUVORK5CYII=",iconPNGWhite:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAb0lEQVR42mNgIAUcuX/k/5H/R+/jVvAfQdJbwX4BkONAEKIAAvcLICk57HDk/rECuEkFR94fs0c3ReHI/cMNYMUNR+8fV8Digv0KR/YfXX90/ZH9KIajgqP1R/oZyADYfY4kSljBfpjfUeB+oqwHAI1/WdoNOXPUAAAAAElFTkSuQmCC"},COMMAND_SHOW_NOTES_PANEL:{iconPNG:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAACgSURBVHgB7VLBDYQgENw1FnAlWAeEGrSEK+GugrsOtAU70CKgDkuwAnBMNFHCRhM/PpwPsDPsLuwQXQRvD0qpNzPX2L5S4hDCAP5vrW3XWLbLxvyTLi98gaXZxvJIU6BK5ZzrUwmMMaX3viMJWutAB4g1GV1EfqbKCnwen0qQEj4dyIjHOMLOpSSGkarZzmIHIL+wa4MnJN0GF47gP3QrTBi9PG385uw1AAAAAElFTkSuQmCC",iconPNGWhite:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAASklEQVR42mNgIA4cTTjy/sh/BDx6/0g8ioIj95GlwfA9qoL/R/2R+Yf8j/xHU4BuKTkKkF0wRE14jxZQAUfvo8cFamC/R4sLCgAAKuF43sJZFFMAAAAASUVORK5CYII="},COMMAND_SHOW_HISTORY_PANEL:{iconPNG:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAD8SURBVHgB3VJLDoIwEG1BYMsR8Aa647fgKHAC4gn0BsQTKCfwCOCChB3eQI9QtxDAmYQmTW2NOxMnadKZad983iPk10blQJIk3jAMJ7hu4LhCis3zXE/TtGvb9sGDhuJzhw8ty1o3TUP5QZ9SejVNs/N93yMqC8PwEgRBLsXukr+PoqhSdgAVEsdxSinmib5t28dlvHcAnLmua0Y+2JJ3dQBK0878JUBpGEalA5EBGDAhUkeAgRS3DyAF+kue6QBufd/nchUEgeVleAeaU6SZ51biQ+A6Qx0AlU9g4ywvNI7jA3zOQUxbHlMqEbookFIiKRE7HMcxE5X4B/YCuLpojZ4/JTwAAAAASUVORK5CYII=",iconPNGWhite:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAf0lEQVR42rWQ3RWAIAiFHcER2jA3sFHawBF46GJjNAIj2Kn879RT4QMIH4hXqc+MBhAE4TzCbh36srAlHW8aBtIg7PwYoy16C6oASOpGyFOkBsJb1KXT20/AzNuFtEDe4UTcfQdiW31aKwVzYI0O3hQdlqnT4UDYFSVBXflP2wFyclxBF22/4AAAAABJRU5ErkJggg=="},COMMAND_SHOW_WINDOW_PANEL:{iconPNG:F.Z,iconPNGWhite:W.Z},COMMAND_SHOW_CALENDAR_PANEL:{iconPNG:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAACISURBVHgB1ZLBDYAgDEVr4wCOwBgEhnEGN3AEV3AST8whI7ABloQmmCgQ5aAvIfxC+wsEgNYopXat9Z7TKR0L2hxpWmgMhR6WxmyMWUOAvOq9nyuKAyI2OkMn8FBJmovwErxy5w53OmvwmGZv8O8rOCmlKBXHHMtxz4J+4oSIG7mLgocLufAZDrWyPsrbeWhUAAAAAElFTkSuQmCC",iconPNGWhite:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAACSSURBVHgB1ZLBDYAgDEVLwwCOwBps4wg6gW6gKziJFwhj6AgOAMFyICFR0agHfQnJb9r+hqYAb6O1nsLL6RSWNJbe+45kkRvAGJsRsZVSDiHGJNecNQdoiHDO9ZuEUsrDRdJahIfgnnuccKSzBrd5bQf//sJijBFnzaGGjmmOMY+CTrS21o7kLnIGVLNwziv4DCvpcHNLdZSTOwAAAABJRU5ErkJggg=="},COMMAND_SHOW_TASKS_PANEL:{iconPNG:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAERSURBVHgBzVLLjcIwFLQ3Th9sB3DMT5vtYLcEOoAKklRACdABdAAoykfKATqAOhIlYR6ykSXicISRLP9m5o2fzNg74LruVK25WoRhOGmaZk1Lndz3/TXP82+19zxvgWlV1/WsqqqzUBcQb0HegfxrqiyLrMDbkJjOhHY/hXjGRgDxnhJ1XZeosy/24o0Kvu/HmCaWZS3LsrwaDUjMOT9JwR1BEPyhcoQRp2m60/mPJqI5fZZlXJpEMIkxEiHERkZnejONCQggJlSNqqLbe4qOdw82d9BAN0EKEi/0dyPh5UlATxgychznZ4xrTKBQFMVx7F43OOidN0Fyzmr/+Ei2bc/pNyJeNGaAvhzatv1nH4Mbqq2RljjZ0ywAAAAASUVORK5CYII=",iconPNGWhite:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAEKSURBVHgBzVLLrcIwELQjp4+8DuCa3yMdQAl0ABWEVEAJ0AF0ACi/I3QAfeTHrJRFlojDEUaysl7vzO6sIsQ3kOf5hGPJQVmWTtM0O4QzvbjrukcQBH98z7Jshc9WSjn1PO+m+AHkA5JHJCNT577JFuGeyJRT2vsEyakYQdu2J5qoruuEc5b44JGRpukGZAdnHUXRwyhAZBRdicC5oijmsBfjbMIwPOr1ryViOZ3v+7IXiSFCHROl1J5GxxH6Mo0TELCLhLpR1963A9+Dyx0U0EWIbFnWSveNCe9vBLIwJAT//2O1xgkYrutext51gbO+eRP6mhvfXz9SVVVL27YPGC/+oHFG7UL8DJ7QEZCpKicQ5QAAAABJRU5ErkJggg=="},COMMAND_SHOW_READING_LIST_PANEL:{iconPNG:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAADUSURBVHgB3VI9DoIwFC5EAiOOMNUbOANDb+B13AgnMd6EiXALewMZbZq2vhJryrPKYmLiG6B8fd8PyUfIryeyj7quL/Ci+NIYw6NoXgneDcOw2zy+aZIk277vJ38JhE9KqW4cR+7jjLFcSnm1ZydALLmqqha7WDLGYbcD8YWTIYHBRJTOLBJ8ImAc/r0Lqq0R/z0BpTRbI7qBHmQvCYqiaMuyvPmL0ELWNM2ktc59HEr0NHMCPI7jY8gNyrQHoTyA89mEvBmISYUQB3tO0/SMa/61uQN54WmwgBUnOAAAAABJRU5ErkJggg==",iconPNGWhite:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAADGSURBVHgB3VJBDsIgEISEJh7rD+oPvPdiX+B3vDV9ifElvRS+IT+wRxMIOHvAINDUg4lJ98CSYWdnEoaxfxenQ0p599432SPnmvrSW9u2BxEGjDH7ruvmeGiapivwAbiO8XEc66qqHnQXASQynPSJkCZyikN5wPIPJc8KVViYccQ3hJKD4rY14tYd4G93a8RQNJs5QDB6EJ7xIAJ2UkrN6HWCv8VCEjWieUHP1JxzR7Q6xYlDnbOFgs1GCHGmu7X2lsb8Z/UCQg+R4phOstoAAAAASUVORK5CYII="},COMMAND_SHOW_TRANSLATE_PANEL:{iconPNG:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAE5SURBVHgB3VI7UoRAEB0QqggnNKAo9gaYAsFwAr0BG5pZnkD3BLqZmXoDPYEkfIyWGzgBB5gUKMDXyFqL5a6x21Wvunv697qBsX8hvu/fEH6LafuKgiC4G4aBj0ma5pGGX06+StP0mmx9XwMkJ1AcyS70PWFqxKfYYQYkQgi3bdtN13VnlmUx2B+wF0VRyG3OyW4B9lw6jrOxbVtVVfUupVTwT3Vdv+z7fonJD3mev+7WzFYAxfFQKLjYvpmmuSIygIcmzz9Zfq8QhqHAhDfgFo0IkWEYZdM0j1QMXyLmwk6AdZZl5YwBgjEgEaCJCvY59hUo5Jgc4eoR3ld0VCCeMcCxOB0IRYomIEFAc9BfJEmi2AEZGYAm7Uzf/AmQwAv5dV3H7A8x2NfxrqDKif4o+JG86ZhrdtzyCZCjjl4nqbGPAAAAAElFTkSuQmCC",iconPNGWhite:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAEiSURBVHgB3VDLbYNQEHxAgAsHSiAdkCtw8Ksg6YB0kKSCxBXEVGC7A3eAJeBsOjAlICFx4edZtEi25c/ZXmned2d3doR4iMiy7Jdw6U+5RkrT9F9RFJuvLu85LcMwlEEQ/NBZvVYA5G3f9zaSHWDBcOmN/u4qoIjj2NF1fadp2hvdu67bN03zKqUsLhbAnJ/oslRV9dvzvGgahUbgcTa+78+POecjjEZB5sf0gI5EmJF8FF6L81GnQ5IkM3SJgT8kE6RlWXld10sUJAUF4CB1C0RQkp8oQPUQpIIllkh+r6qKOttt20q4LuHBnE0NTxTALBtm7UEqucNIZMNKcSNGBYZh0Mxk0gooQN7Q3TTNUNyJF1pA+MKWHzsM9102MxLPHQec65fa3EMkXwAAAABJRU5ErkJggg=="},COMMAND_SHOW_SESSION_PANEL:{iconPNG:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABhmlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw1AUhU9TpSoVh3YQcchQnSyKigguWoUiVCi1QqsOJi/9gyYNSYqLo+BacPBnserg4qyrg6sgCP6AODs4KbpIifclhRYxXni8j/PuObx3HyDUy0w1O8YAVbOMVDwmZrKrYuAVPoTQjRmMSszU55LJBDzr6566qe6iPMu778/qVXImA3wi8SzTDYt4g3hq09I57xOHWVFSiM+JRwy6IPEj12WX3zgXHBZ4ZthIp+aJw8RioY3lNmZFQyWeJI4oqkb5QsZlhfMWZ7VcZc178hcGc9rKMtdpDSKORSwhCREyqiihDAtR2jVSTKToPObhH3D8SXLJ5CqBkWMBFaiQHD/4H/yerZmfGHeTgjGg88W2P4aAwC7QqNn297FtN04A/zNwpbX8lTow/Ul6raVFjoC+beDiuqXJe8DlDtD/pEuG5Eh+WkI+D7yf0TdlgdAt0LPmzq15jtMHIE2zStwAB4fAcIGy1z3e3dU+t397mvP7AcU6cshc5dfNAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH6AETCgAkeJuDiQAAAQdJREFUOMul0r1KA1EQBeAvWSFFSKkIgqLYWtgYFYtF8OcZ8jRpfQHRF/AptNfKwtpCEkXdUhCEDbGZwGXd/IAHBu6ePWfmztnlLzZxjQFKjKPK4K5CA5oV8xnuMUSOFhpRreDeQnNaN/kD++bjILQbWUJe4BY3FfEyVrGE7+CGaOO8kQgHccXnhNvFWvL8isc4b+MubVDGnqNkcrfm+g8okOEnDTFLzNCZsv+EHyFrzgjqaw6fYZQ26FWEReyskkER5y0MGzUTupH2U5JFJyYXia6Plao5x+eU8FIc4h3rdeZ8iimLT9ePn+gkfdkO83hGlXjBZXXyBEfR+dg/sGgGM7GHnUXFvzNAPn779Pc/AAAAAElFTkSuQmCC",iconPNGWhite:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAC6HpUWHRSYXcgcHJvZmlsZSB0eXBlIGV4aWYAAHja7ZdbktwgDEX/WUWWgCSExHIwmKrsIMvPBT+me2byquQnVW3KgAUW8j2Cngn7t68jfMFFJXNIap5LzhFXKqlwRcfjcZVVU0yrPh/i1Xmyh3uAYRK0cjxaPedX2PXthWsN2p7twc8R9tPR5fl0KHNlRqc/Bgk7H3ZKp6OyH51c3B5D3fho2zlxhXLe4wrLjmY+h0dDMqjUFQsJ8y4kcdV+RCDzTlLREmqSwrM3+yweVpPPSCDI0+fdAsZHgZ5Evnrhvfp37534XE+7vNMynxqh8+kA6efiL4kfFpY7In4eMLlcfSLy6D7GfnxdTRmK5jOjlth0ucHEDZLLei2jGG5F31YpKB5rbEDeY4sbSqNCDCojUKJOlQbtq23UEGLinQ0tc2NZNhfjwm0RS7PQYJMiXRywGu9BBGa+Y6G1blnrNXKs3AlTmeCM8MoPS/jZ4J+UMEabElH0WyvExTOvEcYkN2vMAhAaJzddAl/lxB8f8gepCoK6ZHZ8YI3b4WJTesstWZwF8xTtsYUoWD8dQCKsrQgGaZ8oZhKlTNGYjQg6OgBVRI59whsIkCp3BMlJBOeRsfNcG+8YrbmsnHmacTYBhEoWA5siFbBSUuSPJUcOVRVNqprV1IMWrVlyyppztjwPuWpiydSymbkVqy6eXD27uXvxWrgIzkAtuVjxUkqtHCoWqvBVMb/CsvEmW9p0y5ttvpWtNqRPS01bbta8lVY7d+k4Jnru1r2XXncKO06KPe26591238teB3JtyEhDRx42fJRRb2on1Q/lD6jRSY0XqTnPbmqwBrPLBc3jRCczEONEIG6TABKaJ7PolBJPcpNZLIxNoYwgdbIJnSYxIEw7sQ662b2R+y1uQf23uPGvyIWJ7l+QC0D3kdsn1Pr8nWuL2LELp6ZRsPswp7IH3DGi+tv25ejl6OXo5ejl6OXo5ej/dyQDfzzgn9jwHXUtnbaAnZZ1AAAAZnpUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHjaPUwxEoAwCNt5hU8oJFfb53jUwc3B/5+RwXAQSHLYdT9pW4HdMBicXI2qHxGeLbBrPRBoasYSu6ZjlptyT10OZfToI/QKlIRhL/aAF2jrZm+xAAABhmlDQ1BJQ0MgcHJvZmlsZQAAeJx9kT1Iw1AUhU9TpSoVh3YQcchQnSyKigguWoUiVCi1QqsOJi/9gyYNSYqLo+BacPBnserg4qyrg6sgCP6AODs4KbpIifclhRYxXni8j/PuObx3HyDUy0w1O8YAVbOMVDwmZrKrYuAVPoTQjRmMSszU55LJBDzr6566qe6iPMu778/qVXImA3wi8SzTDYt4g3hq09I57xOHWVFSiM+JRwy6IPEj12WX3zgXHBZ4ZthIp+aJw8RioY3lNmZFQyWeJI4oqkb5QsZlhfMWZ7VcZc178hcGc9rKMtdpDSKORSwhCREyqiihDAtR2jVSTKToPObhH3D8SXLJ5CqBkWMBFaiQHD/4H/yerZmfGHeTgjGg88W2P4aAwC7QqNn297FtN04A/zNwpbX8lTow/Ul6raVFjoC+beDiuqXJe8DlDtD/pEuG5Eh+WkI+D7yf0TdlgdAt0LPmzq15jtMHIE2zStwAB4fAcIGy1z3e3dU+t397mvP7AcU6cshZ7VMUAAAPRGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNC40LjAtRXhpdjIiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6aXB0Y0V4dD0iaHR0cDovL2lwdGMub3JnL3N0ZC9JcHRjNHhtcEV4dC8yMDA4LTAyLTI5LyIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgIHhtbG5zOnBsdXM9Imh0dHA6Ly9ucy51c2VwbHVzLm9yZy9sZGYveG1wLzEuMC8iCiAgICB4bWxuczpHSU1QPSJodHRwOi8vd3d3LmdpbXAub3JnL3htcC8iCiAgICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgICB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iCiAgIHhtcE1NOkRvY3VtZW50SUQ9ImdpbXA6ZG9jaWQ6Z2ltcDpiYjJkZWQ3Yy1lZjU2LTQwNTUtODEzNC1iNjdiMTUxNDY5ZWEiCiAgIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6Y2NkOTQ1M2EtMzZmMy00ZDYyLTgwNGMtYzkzM2E2NGVjMWE5IgogICB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6OTliOTYwYmQtYWIwYi00ZTY0LWFhZTMtY2JmZWU4YzllMDU3IgogICBHSU1QOkFQST0iMi4wIgogICBHSU1QOlBsYXRmb3JtPSJMaW51eCIKICAgR0lNUDpUaW1lU3RhbXA9IjE3MDU2NjAxMDgwMjM0MTkiCiAgIEdJTVA6VmVyc2lvbj0iMi4xMC4xOCIKICAgZGM6Rm9ybWF0PSJpbWFnZS9wbmciCiAgIHhtcDpDcmVhdG9yVG9vbD0iR0lNUCAyLjEwIj4KICAgPGlwdGNFeHQ6TG9jYXRpb25DcmVhdGVkPgogICAgPHJkZjpCYWcvPgogICA8L2lwdGNFeHQ6TG9jYXRpb25DcmVhdGVkPgogICA8aXB0Y0V4dDpMb2NhdGlvblNob3duPgogICAgPHJkZjpCYWcvPgogICA8L2lwdGNFeHQ6TG9jYXRpb25TaG93bj4KICAgPGlwdGNFeHQ6QXJ0d29ya09yT2JqZWN0PgogICAgPHJkZjpCYWcvPgogICA8L2lwdGNFeHQ6QXJ0d29ya09yT2JqZWN0PgogICA8aXB0Y0V4dDpSZWdpc3RyeUlkPgogICAgPHJkZjpCYWcvPgogICA8L2lwdGNFeHQ6UmVnaXN0cnlJZD4KICAgPHhtcE1NOkhpc3Rvcnk+CiAgICA8cmRmOlNlcT4KICAgICA8cmRmOmxpCiAgICAgIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiCiAgICAgIHN0RXZ0OmNoYW5nZWQ9Ii8iCiAgICAgIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6NzYzMWJlMDUtYTNiNy00YWJkLThjZmUtMjJmNTU1NWVmYWY5IgogICAgICBzdEV2dDpzb2Z0d2FyZUFnZW50PSJHaW1wIDIuMTAgKExpbnV4KSIKICAgICAgc3RFdnQ6d2hlbj0iKzAxOjAwIi8+CiAgICA8L3JkZjpTZXE+CiAgIDwveG1wTU06SGlzdG9yeT4KICAgPHBsdXM6SW1hZ2VTdXBwbGllcj4KICAgIDxyZGY6U2VxLz4KICAgPC9wbHVzOkltYWdlU3VwcGxpZXI+CiAgIDxwbHVzOkltYWdlQ3JlYXRvcj4KICAgIDxyZGY6U2VxLz4KICAgPC9wbHVzOkltYWdlQ3JlYXRvcj4KICAgPHBsdXM6Q29weXJpZ2h0T3duZXI+CiAgICA8cmRmOlNlcS8+CiAgIDwvcGx1czpDb3B5cmlnaHRPd25lcj4KICAgPHBsdXM6TGljZW5zb3I+CiAgICA8cmRmOlNlcS8+CiAgIDwvcGx1czpMaWNlbnNvcj4KICA8L3JkZjpEZXNjcmlwdGlvbj4KIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAKPD94cGFja2V0IGVuZD0idyI/PueZfIMAAAAGYktHRAD/AP8A/6C9p5MAAAAJcEhZcwAADdcAAA3XAUIom3gAAAAHdElNRQfoARMKHBy27mZKAAABF0lEQVQ4y5WSvUoDURCFv2SLFGKpCEJEyQvYGBWLIKjv4MsY8B3EPIy9VhbWFpIo/pQBRdjw2czG63WT6IGB3cPMOXNnBpUsNtWBOlRLv1EGdxk5qDT5iRPgGhgBPaAFNCJawT1FzjFA7vyi7tZ0lcde5G401Mp9EM7nWVcrwDIwBt4S/gxYSwWG0eJ9krQNrCf/j8BtfHeAq1SgjHdOEucuv3ETnRTAZzrEIikm2q5DxU+AoslsjBfwBTBJBU6zxLd4M9kMqkFuAaN0BhW6wDtwt2ALfWA1329PfVW7C+5gX31W23XFvRlFhdpR+3FER+r0EpeieB5K9UG9UNuVcOpwEMqHfzhl6gT+M4Np1G1hB/hItjAXX/ppnhihX/8aAAAAAElFTkSuQmCC"},COMMAND_SHOW_FEEDS_PANEL:{iconPNG:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAD5SURBVHgB7VA7DoJQEHxIoLYnIXoEOwIkPo9gZ6c30BvoDdQTSGsnN3iGTw0nwAR6KQUCOBhsUFFLEyfZ7L7Pzs4sIT8PrnmhadoZ6VSWpcfzvGlZ1qGNoNO8EAShXxTFguM4grxWVTVQFKVHPlXQBAiWIFtA0ch1Xa/5zpMnFmRZniAuYRj6iCPqBCQ7SZL2URTF7ywMMG2LcnWX7zjOBmcDO9l9ZQFqDJANRVEcVOcsywIoGdu2zV4q0HWdonFKKe1i8gwNcZqmc8ZYDLINFjtttYBPlUwjSZLbRzQYIKFVDQs+Em0lABgizvOc1YQmoldb8MgfD7gCpH9zwi7KjVoAAAAASUVORK5CYII=",iconPNGWhite:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAD1SURBVHgB7VHLDYJAFNyFAFdL0BI4Ej5CCVaAHUgH2oFYgdiBVgDhE65YgXQgZ74OBhKDEbyaOJfdN7s7b+YtIT8POiTCMLxjSSmlSVVVF03TzmMCzJAoimLBMIzVNA2ByD6Kolscx3PyrYMhILCFmAUxQ5blZFKgj8CyrC1J0qnjLCxbcCK4lExEEOu6PpRluevtK4pi48jBTI6TDl7h+76Drss8z8W25jjuhjgrVVW9jw6CINDR1XRdd4YfWONBxvP8xjCMDHOwMWBzNAIuHGHVEQTB7GoHInq7B39FPH1UAPDarrDuPTNSekE97yIk5I83PADL5XR/KpV1NwAAAABJRU5ErkJggg=="},CONTAINER_WEBPANEL:{...(0,P.Z)("Web Panels"),settingsLabel:(0,E.Z)("[All Web Panels]")},CONTAINER_CLOSED_WEBPANEL:{...(0,P.Z)("Closed Web Panels"),settingsLabel:(0,E.Z)("[All Closed Web Panels]")},COMMAND_SET_LOAD_IMAGES_ALWAYS:{prefs:{pref:K.kPageImageLoading,isChecked:e=>"always"===f.Z.get(K.kPageImageLoading)}},COMMAND_SET_LOAD_IMAGES_NEVER:{prefs:{pref:K.kPageImageLoading,isChecked:e=>"never"===f.Z.get(K.kPageImageLoading)}},COMMAND_SET_LOAD_IMAGES_CACHE:{prefs:{pref:K.kPageImageLoading,isChecked:e=>"cache"===f.Z.get(K.kPageImageLoading)},...(0,P.Z)("Load Images from Cache")},COMMAND_SET_ANIMATIONS_LOOP:{prefs:{animationPref:"allowed"}},COMMAND_SET_ANIMATIONS_NEVER:{prefs:{animationPref:"none"}},COMMAND_SET_ANIMATIONS_ONCE:{prefs:{animationPref:"once"}},COMMAND_MAIN_ZOOM_IN:{persistent:!0},COMMAND_MAIN_ZOOM_OUT:{persistent:!0},CONTAINER_BOOKMARK:{settingsLabel:(0,E.Z)("[All Bookmarks]"),settingsRename:!1,isVisible:()=>!T.ZP.isGuest()},COMMAND_MAIL_SHOW_SETTINGS:{iconPNG:O,iconPNGWhite:x,ellipsis:!0},COMMAND_SHOW_SETTINGS:{iconPNG:O,iconPNGWhite:x,ellipsis:!0},COMMAND_SHOW_QUICK_COMMANDS:{ellipsis:!0},COMMAND_CAPTURE_PAGE_TO_DISK:{...(0,P.Z)("Page to File")},COMMAND_CAPTURE_PAGE_TO_CLIPBOARD:{...(0,P.Z)("Page to Clipboard")},COMMAND_TAB_TRANSLATE_PAGE:{...(0,P.Z)("command","Translate Page")},COMMAND_CAPTURE_AREA_TO_DISK:{...(0,P.Z)("Area to File")},COMMAND_CAPTURE_AREA_TO_CLIPBOARD:{...(0,P.Z)("Area to Clipboard")},COMMAND_SHOW_CLEAR_PRIVATE_DATA:{ellipsis:!0},COMMAND_FULLSCREEN:{...(0,P.Z)("Fullscreen")},COMMAND_MAIN_TOGGLE_UI:{prefs:{windowState:"minimalUI",isChecked:e=>!T.ZP.isMinimalUI(e)},...(0,P.Z)("Show UI")},CONTAINER_PINNED_TAB:{...(0,P.Z)("title","Pinned Tabs"),settingsLabel:(0,E.Z)("[All Pinned Tabs in Window]")},CONTAINER_CLOSED_TAB:{...(0,P.Z)("title","Closed Tabs"),settingsLabel:(0,E.Z)("[All Closed Tabs]")},CONTAINER_ALL_WINDOW:{...(0,P.Z)("title","All Windows and Tabs"),settingsLabel:(0,E.Z)("[All Windows and Tabs]")},CONTAINER_ALL_WINDOW_LIST:{...(0,P.Z)("title","All Windows"),settingsLabel:(0,E.Z)("[All Windows]")},CONTAINER_OTHER_WINDOW:{...(0,P.Z)("title","Other Windows and Tabs"),settingsLabel:(0,E.Z)("[Other Windows and Tabs]")},CONTAINER_OTHER_WINDOW_LIST:{...(0,P.Z)("title","Other Windows"),settingsLabel:(0,E.Z)("[Other Windows]")},CONTAINER_OTHER_WORKSPACE:{isVisible:()=>f.Z.get(K.kWorkspacesEnabled),...(0,P.Z)("title","Other Workspaces and Tabs"),settingsLabel:(0,E.Z)("[Other Workspaces and Tabs]")},CONTAINER_OTHER_WORKSPACE_LIST:{isVisible:()=>f.Z.get(K.kWorkspacesEnabled),...(0,P.Z)("title","Other Workspaces"),settingsLabel:(0,E.Z)("[Other Workspaces]")},CONTAINER_TAB:{...(0,P.Z)("title","Tabs"),settingsLabel:(0,E.Z)("[All Tabs in Window]")},CONTAINER_PERIODIC_RELOAD:{...(0,P.Z)("title","Periodic Reload"),settingsLabel:(0,E.Z)("[Periodic Reload]")},CONTAINER_SESSIONS:{...(0,P.Z)("Sessions"),settingsLabel:(0,E.Z)("[All Sessions]")},COMMAND_CHECK_FOR_UPDATES:{ellipsis:!0},COMMAND_SHOW_ABOUT:{iconPNG:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAEySURBVHgBzVLLTcQwEHU+yjkN5EMHHPM75MgROqADditIOHKDClg6gAowUn43tgQraYAjRErCG5FFjjd7hifZ4xm9eTNjm7G/hkFbkiS54zivruv6Xde9nCLHcUycned5Wtu2nGI6bdM0ZTPnOgzDzVoyiqQwqcL/EQD4b0DXszRNbVXANM09zMfs7hcCmqbdSly77/sbVYBzTsmCzsMwXC0EiqLgaOv5EITgJggCnx3DBm/XNI1YCBAsy9pKLdqGYTzKo9BFw/jjOMrdMk12oijKUD0/+KgmaF7EfNhz+HlVVQsBXXbQxYPUBY3iY13OyQLVn5gCQ3aEEJ945y8cL1Qi3Utd129HcbYCfJh3qiqPgtbP1rj6WhDVtoqfsxMw1oL4pgKj0AsEWPdlWd6xf4tvaZVsnjSI7BsAAAAASUVORK5CYII=",iconPNGWhite:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAjUlEQVR42q1QSRGAMAysBCQgBSdYwAE4qAQkICEPtvBEAhIqYZm2FAIDvEhe2dlrYswPM3Yg+isGAccuHww7NUpSJUyxQXgpMkEKeBDLje9aFbGAc3mcbkgeJ4TV6VZSRktCUkyorfTRo91jVjcEex2nazHTbvqY2pwE1I8PC9ZJ//bR6lMfPSwIa36eDUlAgXmKiZFsAAAAAElFTkSuQmCC"}},Se);const n=t[e.action],s=n?.label??"",o=n?.labelEnglish??"",a=function(e){const t=e.parameter;if(void 0===t)return;if("COMMAND_OPEN_LINK"===e.action)return{handler:e=>{const n=i.ZP.getOpenOptionsFromDisposition(e.windowId,"setting",!1,e.keyState);u.ZP.openURL(e.windowId,t,{...n})},url:t};return}(e);return a?{...n,...a,label:s,labelEnglish:o}:{...n,label:s,labelEnglish:o}}function Ce(e,t){e.forEach((e=>{const{name:n,function:i,feature:s}=e,o={autoRepeat:e.onAutoRepeat||!1,isEnabled:e.isEnabled,isFeatureShortcut:"browser"!==e.feature,tweakedShortcut:e.tweakedShortcut,feature:e.feature};d.Z.bind(t,i,o),me.push({name:n,key:t,func:i,feature:s})}))}function Ae(e,t,n){for(let i=n.length-1;i>=0;i--)if(n[i].items)Ae(e,t,n[i].items);else if(n[i].commandName===e){t.shortcuts?n[i].shortcuts=t.shortcuts:delete n[i].shortcuts;break}}function Ie(e){const t=r.Z.getState(),n=f.Z.get(K.kActions)[0];[...t.map((e=>{const t=(0,G.IN)(e),i=n[t.name];if(i)return{key:t.name,value:{...i,feature:"browser"}}})).filter(Boolean),...e].forEach((e=>Te(e))),function(){me.forEach((e=>{d.Z.unbind(e.key,e.func)})),me=[];const e=He.getCommandsForShortcuts();Object.keys(e).forEach((t=>{Ce(e[t],t)}))}(),j=!0}function Te(e){fe[e.key]=e.value,Y.installed&&Ae(e.key,e.value,Y.items)}function Ze(e){if(fe[e]){const{shortcuts:t}=fe[e];delete fe[e],t?.length&&d.Z.unbind(t)}B.Z.menuContent.removeAction([e])}function Ee(e){return t=>{const n=f.Z.get(K.kChainedCommandsCommandList);for(let i=n.length-1;i>=0;i--)if(n[i].key===e)return void(0,V.hT)(t,n[i].chain);console.warn("No chain match for: ",e)}}function ke(e,t){const n={},i=r.Z.getScripts().map((e=>(0,G.IN)(e))),s=be.concat(f.Z.get(K.kChainedCommandsCommandList)).concat(i);for(const i in fe){const o=fe[i];if(!o)continue;const a=o[e];a&&s.filter((e=>e.name===i&&(!0===t||!(0,H.os)(e.name)))).forEach((e=>{a.forEach((t=>{n[t]=(n[t]||[]).concat({function:e.chain?Ee(e.key):e.action,label:e.label,name:e.name,onAutoRepeat:e.repeat,isEnabled:t=>"CATEGORY_COMMAND_CHAIN"===e.category||e.isVisible(t)&&e.isEnabled(t),tweakedShortcut:e.tweakedShortcut,feature:e.feature||"browser"})}))}))}return n}function _e(e,t){let n=c.Z.commandItem;const i=we(e),s=e.type;if("folder"===s)n={id:e.id,commandName:e.action,items:[],type:s,...i,withNoWindow:!0},e.children&&e.children.forEach((e=>{const i=_e(e,t);i&&n.items&&n.items.push(i)}));else if("command"===s)n={id:e.id,commandName:e.action,type:s,...i};else if("checkbox"===s)n={id:e.id,commandName:e.action,type:s,...i};else if("radio"===s){if(!e.radiogroup)return;{let t=Y.radioGroup[e.radiogroup];void 0===t&&(Y.radioGroup[e.radiogroup]=Y.radioCounter++,t=Y.radioGroup[e.radiogroup]),n={id:e.id,commandName:e.action,type:s,radiogroup:t,...i}}}else if("container"===s){if(-1!==ge.findIndex((t=>t.name===e.action))){const o={content:e.action,mode:e.containermode,edge:e.containeredge,cpp:e.action===de||e.action===pe||e.action===ue};n={id:e.id,type:s,...i,container:o,withNoWindow:!0},t&&e.action===de&&(Y.hasBookmarkContainer=!0,e.containeredge&&(Y.bookmarkExtrasEdge=e.containeredge))}}else"separator"===e.type&&(n={...c.Z.separatorItem,id:e.id});void 0!==e.title&&(n.label=e.title,n.settingsLabel&&delete n.settingsLabel,n.ellipsis=!1),void 0!==e.custom&&(n.custom=e.custom),n.showshortcut=e.showshortcut,n.feature=ve.get(e.action)||"browser";const o=fe[e.action];return n.shortcuts=o?.shortcuts,n}function Ne(e){for(const t of e){if(t.items){Ne(t.items);continue}const e=t.prefs;if(!e)continue;const{callback:n}=e;n&&(e.pref?f.Z.removeListener(e.pref,n):e.animationPref?k.Z.accessibilityFeatures.animationPolicy.onChange.removeListener(n):e.panelState?g.ZP.removeListener(n):e.windowState&&T.ZP.removeListener(n),e.callback=void 0)}}function Pe(e,t,n){const i=(e,t)=>{e.statestrings&&(e.label=e.statestrings[t?1:0].label,e.labelEnglish=e.statestrings[t?1:0].labelEnglish),e.checked=t},s=(e,t)=>{const n=()=>{if("function"==typeof t.isChecked){const n=void 0!==t.windowId&&t.isChecked(t.windowId);e.checked!==n&&(i(e,n),He.emitChange("menuState"))}};return t.callback=n,n};for(const o of t){if(o.items){Pe(e,o.items,n);continue}const t=o.prefs;if(!t)continue;t.windowId=e;const a=t.pref;if(a){if("function"==typeof t.isChecked){const e=void 0!==t.windowId&&t.isChecked(t.windowId);i(o,e),n&&f.Z.addListener(a,s(o,t))}}else if(t.animationPref){if(n){const e=function(){k.Z.accessibilityFeatures.animationPolicy.get({},(({value:e})=>{const n=e===t.animationPref;this.checked!==n&&(i(this,n),He.emitChange("menuState"))}))}.bind(o);t.callback=e,e(),k.Z.accessibilityFeatures.animationPolicy.onChange.addListener(e)}}else if(t.panelState)switch(t.panelState){case"SHOW_PANEL":case"SHOW_CONTENT":if("function"==typeof t.isChecked){const e=void 0!==t.windowId&&t.isChecked(t.windowId);i(o,e),n&&g.ZP.addListener(s(o,t))}}else if(t.windowState&&"function"==typeof t.isChecked){const e=void 0!==t.windowId&&t.isChecked(t.windowId);i(o,e),n&&T.ZP.addListener(s(o,t))}}}function De(e,t,n){const i=f.Z.get(K.kChainedCommandsCommandList),s=t=>{for(let a=0;a<t.length;a++){const r=t[a];let d=!1;if(r.commandName){for(let e=i.length-1;e>=0;e--){const t=i[e];if(t.name===r.commandName){r.handler||(r.handler=Ee(t.key)),r.label||(r.label=t.label||""),r.labelEnglish||(r.labelEnglish=t.labelEnglish||t.label||""),d=!0;break}}if(!d)for(let e=0;e<be.length;e++){const t=be[e];if(t.name===r.commandName){r.isEnabled||(r.isEnabled=t.isEnabled),r.isVisible||(r.isVisible=t.isVisible),r.handler||(r.handler=t.action),r.checkedHandler||(r.checkedHandler=t.checkedAction),r.withNoWindow=t.withNoWindow,r.label||(r.label=t.label||""),r.labelEnglish||(r.labelEnglish=t.labelEnglish||""),d=!0;break}}}if(d||"command"!==r.type||(console.warn("No match for menu item",r,r.commandName),void 0===r.label&&(r.label=r.commandName||""),void 0===r.labelEnglish&&(r.labelEnglish=r.commandName||""),r.isVisible=()=>!1,r.handler=()=>{}),Pe(e,[r],n.updateCallbacks),r.commandName){const t=fe[r.commandName]?.shortcuts;if(t){const n=l.Z.getContext(e)?.feature||"browser",i=r.feature||"browser";r.shortcuts=t.filter((e=>i===n||("browser"===i?!me.some((t=>t.key===e&&t.feature===n)):void 0)))}}if(r.items)s(r.items);else if(r.container&&n.expandContainers)if(!0===r.container.cpp)if(r.container.content===de){const e=r.container.edge||Y.bookmarkExtrasEdge,t=f.Z.get(K.kBookmarksManagerSorting),n=w.Z.toMenuSorting(t.sortOrder,t.sortField),i={id:o.Z.getRootId()??"-1",type:B.Z.menubarMenu.ContainerType.BOOKMARKS,offset:0,edge:e,groupFolders:t.sortOrder!==w.Z.NO_SORTING,sortField:n.field,sortOrder:n.order};r.container&&(r.container.details=i)}else r.container.content===ue||r.container.content;else{let n,i,s=[];if(r.container.content===Q)s=Me(e);else if(r.container.content===q)s=Oe(e);else if(r.container.content===ee){const t=p.ZP.getActiveWorkspace(e);s=We(e,!0,t,e),n=D.Z,i=M.Z}else if(r.container.content===te)s=xe();else if(r.container.content===ne)s=Re(T.Ex);else if(r.container.content===ie)s=Le(T.Ex);else if(r.container.content===se)s=Re(e);else if(r.container.content===oe)s=Le(e);else if(r.container.content===ae)s=Fe(e);else if(r.container.content===re)s=Be(e);else if(r.container.content===J){const t=p.ZP.getActiveWorkspace(e);s=We(e,!1,t,e)}else r.container.content===ce?s=m.Z.getForActivePage(e):r.container.content===le&&(s=Ue(e));"folder"===r.container?.mode?(delete r.container,r.type="folder",r.items=s,r.iconPNG=n,r.iconPNGWhite=i):(t.splice(a,1,...s),a+=s.length-1)}}},a=N(t);return s(a),a}function Me(e){return g.ZP.getOrderedWebPanels(e).map(((t,n)=>{const i=fe["COMMAND_SHOW_WEB_PANEL_"+(n+1)],s="JS_LOCAL_TOGGLE_WEBPANEL",o=t.id;return{...c.Z.makeNumberMnemonic(t.title||t.url||(0,E.Z)("Unknown Web Panel"),n),isList:!0,commandName:s,parameter:o,url:t.activeUrl,shortcuts:i?.shortcuts??[],handler:()=>He.executeLocalAction(e,s,o)}}))}function Oe(e){const t=f.Z.get(K.kPanelsWebRemovedElements).map(((t,n)=>{const i="JS_LOCAL_RESTORE_WEBPANEL",s=t.id;return{...c.Z.makeLabelPair(t.title||t.url||(0,E.Z)("Unknown Web Panel")),isList:!0,mnemonic:!1,commandName:i,parameter:s,handler:()=>He.executeLocalAction(e,i,s)}}));if(t.length){const n="JS_LOCAL_CLEAR_CLOSED_WEBPANELS",i="";t.push(c.Z.separatorItem),t.push({...(0,P.Z)("panel","Clear All"),commandName:n,parameter:i,handler:()=>He.executeLocalAction(e,n,i)})}return t}function xe(){function e(e,t){const n=(e=>e.length>70?e.substring(0,70)+"...":e)(z.jk.getDisplayTitle(e)),i="JS_LOCAL_REOPEN_CLOSED_TAB",s=e.sessionId,o=e.url;return{...c.Z.makeNumberMnemonic(n,t),isList:!0,commandName:i,parameter:s,url:o,handler:()=>He.executeLocalAction(T.Ex,i,s)}}const t=S.Z.getTrash().map(((t,n)=>t.tab?e(t.tab,n):t.window&&t.window.tabs?function(t,n){const i="JS_LOCAL_REOPEN_CLOSED_WINDOW",s=t.sessionId;return{...(0,P.Z)("Window with $1 Tab","Window with $1 Tabs",[n.length]),items:n.map(((t,n)=>e(t,n))).concat([c.Z.separatorItem,{...(0,P.Z)("Restore All"),isList:!0,commandName:i,parameter:s,handler:()=>He.executeLocalAction(T.Ex,i,s)}])}}(t.window,t.window.tabs):void 0)).filter(Boolean);if(t.length){t.push(c.Z.separatorItem);const e="JS_LOCAL_CLEAR_CLOSED_TABS",n="";t.push({...(0,P.Z)("panel","Clear All"),commandName:e,parameter:n,handler:()=>He.executeLocalAction(T.Ex,e,n)})}return t}function Le(e){return T.ZP.getIds("normal").filter((t=>t!==e)).map(((t,n)=>{const i=p.ZP.getActivePage(t),s=(0,E.Z)("title","Window")+" - "+(i?z.jk.getDisplayTitle(i):""),o="JS_LOCAL_ACTIVATE_WINDOW",a=t.toString();return{...c.Z.makeNumberMnemonic(s,n++),isList:!0,commandName:o,parameter:a,handler:()=>He.executeLocalAction(e,o,a)}}))}function Re(e){return T.ZP.getIds("normal").filter((t=>t!==e)).map(((t,n)=>{const i="JS_LOCAL_ACTIVATE_WINDOW",s=t.toString(),o=[{...c.Z.makeLabelPair((0,E.Z)("Activate")),commandName:i,parameter:s,handler:()=>He.executeLocalAction(e,i,s)},{...c.Z.separatorItem},{...c.Z.makeLabelPair((0,E.Z)("Pinned Tabs")),type:"folder",items:We(t,!0,void 0,t)},...We(t,!1,void 0,t)],a=p.ZP.getActivePage(t),r=(0,E.Z)("title","Window")+" - "+(a?z.jk.getDisplayTitle(a):"");return{...c.Z.makeNumberMnemonic(r,n),type:"folder",items:o}}))}function Be(e){const t=p.ZP.getActiveWorkspace(e);return Z.Z.getState().filter((e=>e.id!==t)).map(((t,n)=>{const i="JS_LOCAL_ACTIVATE_WORKSPACE",s=t.id.toString();return{...c.Z.makeNumberMnemonic(t.name,n),commandName:i,parameter:s,handler:()=>He.executeLocalAction(e,i,s)}}))}function Fe(e){const t=[],n=p.ZP.getActiveWorkspace(e),i=Z.Z.getState().filter((e=>e.id!==n)),s=p.ZP.getActiveWorkspaces();for(let n=0;n<i.length;n++){const o=i[n],a="JS_LOCAL_ACTIVATE_WORKSPACE",r=o.id.toString(),l=[{...c.Z.makeLabelPair((0,E.Z)("Activate")),commandName:a,parameter:r,handler:()=>He.executeLocalAction(e,a,r)},{...c.Z.separatorItem},...We(s.get(o.id)??e,!1,o.id,void 0)];t.push({...c.Z.makeNumberMnemonic(o.name,n),type:"folder",items:l})}return void 0!==n?[...t,{...c.Z.separatorItem},...We(e,!1,void 0,e)]:t}function We(e,t,n,i){return(void 0===i?p.ZP.getWorkspaceTabs(n,"off"===f.Z.get(K.kTabsStackingMode)):p.ZP.getWorkspaceTabsInWindow(i,n,"off"===f.Z.get(K.kTabsStackingMode))).filter((e=>e.page.pinned===t)).map(((t,n)=>{if("tab"===t.type){const i=t.page,s="JS_LOCAL_ACTIVATE_TAB",o=i.id.toString(),a=i.vivExtData.fixedTitle??z.jk.getDisplayTitle(i);return{...c.Z.makeNumberMnemonic(a,n),isList:!0,commandName:s,parameter:o,url:i.url,emphasized:i.active,handler:()=>He.executeLocalAction(e,s,o)}}if("group"===t.type)return{...c.Z.makeNumberMnemonic((0,U.XN)(t.page)??z.jk.getDisplayTitle(t.page),n),type:"folder",isList:!0,iconPNG:L.Z,iconPNGWhite:R.Z,items:t.pages.toArray().map(((t,n)=>{const i="JS_LOCAL_ACTIVATE_TAB",s=t.id.toString(),o=t.vivExtData.fixedTitle??z.jk.getDisplayTitle(t);return{...c.Z.makeNumberMnemonic(o,n),isList:!0,commandName:i,parameter:s,url:t.url,emphasized:t.active,handler:()=>He.executeLocalAction(e,i,s)}}))}})).filter(Boolean).toArray()}function Ue(e){return y.ZP.getAll().map(((t,n)=>{const i="JS_LOCAL_OPEN_SESSION",s=t.id.toString();return{...c.Z.makeNumberMnemonic(t.name,n),isList:!0,commandName:i,parameter:s,handler:()=>He.executeLocalAction(e,i,s)}}))}class Ve extends a.Z{getIsInitialized(){return j}getClosedTabContainer(){return xe()}getCommandsForShortcuts(){return ke("shortcuts",!1)}getCommandsForGestures(){return ke("gestures",!0)}getCommands(){return be}getShortcut(e,t=!0){const n=fe[e];if(n?.shortcuts){const i=c.Z.formatShortcut(e,n.shortcuts);return t?i?(0,E.Z)("($1)",[i]):"":i}return""}getQuickCommands(e){return this.getCommands().filter((t=>{const n=fe[t.name];n?.shortcuts&&(t.shortcuts=n.shortcuts);const i=t.isVisible(e)&&t.isEnabled(e),s=l.Z.getContext(e),o=t.feature||"browser",a="browser"===o||o===s.feature;let r;return r="function"==typeof t.showInQC?t.showInQC(e):t.showInQC,i&&a&&r}))}getCommandConfiguration(e){return fe[e]}getAllCommands(e){const t=f.Z.get(K.kChainedCommandsCommandList).map((e=>{const{shortcuts:t,gestures:n,feature:i}=fe[e.name]||{};return{...e,shortcuts:t,gestures:n,feature:i}}));return be.reduce(((t,n)=>{if(e!==T.Ex&&!n.isEnabled(e))return t;if(n.platforms&&!n.platforms.some((e=>"windows"===e)))return t;const{shortcuts:i,gestures:s,feature:o}=fe[n.name]||{};return t.push({...n,shortcuts:i,gestures:s,feature:o}),t}),[]).concat(t)}getVivDefinedCommands(){const e=this.getUserEditableCommands(),t=r.Z.getState().map((e=>({...(0,G.IN)(e),gestures:[],shortcuts:[],feature:"browser"})));return e.filter((e=>"CATEGORY_COMMAND_CHAIN"!==e.category)).concat(t)}getChainCommandsShortcuts(){return this.getUserEditableCommands().filter((e=>"CATEGORY_COMMAND_CHAIN"===e.category)).map((e=>{const t=this.getCommandConfiguration(e.name);return{name:e.name,...t&&{shortcuts:t.shortcuts}}}))}getSettingsList(e){const t=He.getUserEditableCommands(),n=r.Z.getState().map((e=>{const t=(0,G.IN)(e),n=He.getCommandConfiguration(t.name);return{...t,...n&&{shortcuts:n.shortcuts,gestures:n.gestures},feature:"browser"}}));return e?t.filter((e=>!(0,H.xU)(e.name)&&!(0,$.Ed)(e.name))).concat(n):t.filter((e=>!(0,H.xU)(e.name)&&!(0,$.jD)(e.name)&&!(0,$.Ed)(e.name))).concat(n)}isShortcutAccepted(e,t){if(T.ZP.isSettings(e)){for(const e in fe)if(void 0!==fe[e]){const n=fe[e];if(n.shortcuts&&n.shortcuts.includes(t))return ye.includes(e)}return!1}return!0}isActionAcceptedForSettings(e){return ye.includes(e)}isNamedMenuAvailable(e){return Y.name===e}getMenuContentName(){return Y.name}getNamedMenu(e,t,n){if(this.isNamedMenuAvailable(t)){const t=Y.windowId!==e;return t&&Ne(Y.items),Y.windowId=e,De(e,Y.items,{expandContainers:n,inSettings:!1,updateCallbacks:t})}return[]}getBookmarkExtrasEdge(){return Y.bookmarkExtrasEdge}makeMenuWithContent(e,t,n){const i=[];return t.forEach((e=>{const t=_e(e,!1);t&&i.push(t)})),De(e,i,n)}getMenuItem(e,t,n){let i=t;if("folder"===i.type)return{label:t.action,labelEnglish:t.action};"container"!==i.type||n||(i={...t,containermode:"folder"});const s=this.makeMenuWithContent(e,[i],{expandContainers:!n,inSettings:n,updateCallbacks:!1});return 1!==s.length||"separator"!==s[0].type&&void 0===s[0].label?{label:t.action,labelEnglish:t.action}:(Pe(e,s,!1),s[0])}executeLocalAction(e,t,n){const i=He.getHandlerByLocalAction(e,t,n);return i&&i(),Boolean(i)}getHandlerByLocalAction(e,t,n){let o;switch(t){case"JS_LOCAL_ACTIVATE_TAB":{const t=parseInt(n),i=p.ZP.getPageById(t);i&&(o=async()=>{const t=(0,U.cm)(i),n=void 0!==t?e:i.windowId;await u.ZP.setActiveWorkspace(n,t),await u.ZP.activateTab(i.id,n)});break}case"JS_LOCAL_ACTIVATE_WINDOW":o=()=>I.Z.focus(parseInt(n));break;case"JS_LOCAL_ACTIVATE_WORKSPACE":{const t=parseInt(n);o=()=>u.ZP.setActiveWorkspace(e,t);break}case"JS_LOCAL_ADD_ACTIVE_TAB_TO_BOOKMARKS":{const t=n,i=p.ZP.getActivePage(e);i&&t&&(o=()=>s.Z.bookmarkPageInFolder(i,t));break}case"JS_LOCAL_TOGGLE_WEBPANEL":{const t=n;t&&(o=()=>h.Z.toggleContent(e,t));break}case"JS_LOCAL_RESTORE_WEBPANEL":{const t=n;t&&(o=()=>A.Z.restoreById(e,t,!0));break}case"JS_LOCAL_CLEAR_CLOSED_WEBPANELS":o=()=>A.Z.emptyTrash();break;case"COMMAND_OPEN_LINK":n&&(o=()=>{const t=i.ZP.getOpenOptionsFromDisposition(e,"setting",!1,{});u.ZP.openURL(e,n,{...t})});break;case"JS_LOCAL_OPEN_SESSION":n&&(o=()=>v.Z.open(e,[Number(n)],!0));break;case"JS_LOCAL_REOPEN_CLOSED_TAB":n&&b.Z.undeleteTab(n);break;case"JS_LOCAL_REOPEN_CLOSED_WINDOW":if(n){const e=S.Z.getTrash().find((e=>e.window?.sessionId===n));e?.window&&b.Z.undeleteWindow(e.window.sessionId)}break;case"JS_LOCAL_CLEAR_CLOSED_TABS":o=()=>b.Z.emptyTrash();break;default:void 0!==n&&(o=m.Z.getHandlerByAction(e,t,n))}return o}getUserEditableCommands(){return this.getAllCommands(T.Ex).filter((e=>!he.includes(e.name)))}makeCommandList(e,t){const n=be.filter((n=>t?t===n.name:!(n.inMenu&&!n.inMenu(e,!0))));return void 0===t&&n.push(...ge.filter((e=>!(e=>!!(e.hideInSettings||e.name===de&&Y.hasBookmarkContainer))(e))).map((e=>({name:e.name,behavior:"container"})))),this.makeMenuWithContent(e,n.map((e=>{switch(e.behavior){case"checkbox":return{id:e.name,action:e.name,type:"checkbox"};case"radio":return{id:e.name,action:e.name,type:"radio"};case"container":return{id:e.name,action:e.name,containermode:"folder",type:"container"};default:return{id:e.name,action:e.name,type:"command"}}})),{expandContainers:!1,inSettings:!0,updateCallbacks:!1})}getCommandParameter(e){if(1===be.filter((t=>t.name===e)).length)return H.FD[e]}getCommandLabel(e){const t=be.filter((t=>t.name===e));if(1===t.length)return t[0].label}getOpenLinkName(){return"COMMAND_OPEN_LINK"}getCommandByGuid(e){return this.getAllCommands(T.Ex).find((t=>t.guid===e))}getIsContainer(e){return ge.some((t=>t.name===e))}dispatchAction(e){switch(e.actionType){case"COMMAND_INITIALIZE":Ie(e.items),this.emitChange("init");break;case"COMMAND_RESET":i=e.items,Object.keys(fe).forEach((e=>{delete fe[e]})),Ie(i),this.emitChange("init");break;case"COMMAND_SET_NAMED_MENU":t=e.name,n=e.content,Y.installed&&Ne(Y.items),Y.windowId=void 0,Y.name=t,Y.radioCounter=1,Y.radioGroup={},Y.items=[],Y.hasBookmarkContainer=!1,Y.bookmarkExtrasEdge="below",n?n.forEach((e=>{const t=_e(e,!0);t&&Y.items.push(t)})):console.error("No entries in menu:",t),Pe(Y.windowId,Y.items,!0),Y.installed=!0,this.emitChange("menu");break;case"COMMAND_UPDATE_COMMAND":Te(e.item),function(e){const t=He.getCommandsForShortcuts();me.map(((e,t)=>({...e,index:t}))).filter((t=>t.name===e.key)).forEach((e=>{d.Z.unbind(e.key,e.func),me.splice(e.index,1)})),e.value.shortcuts?.forEach((e=>{Ce(t[e],e)}))}(e.item),this.emitChange("shortcut");break;case"COMMAND_REMOVE_COMMAND":Ze(e.key),this.emitChange("shortcut");break;case"CONTENT_SCRIPTS_UPDATED":e.updated.forEach((e=>Ze(e))),this.emitChange("shortcut")}var t,n,i}}const He=new Ve(C.Z),Ge=He},72010:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r,s:()=>o});var i=n(65398),s=n(33638);const o=-1;class a extends i.Z{_contacts=new Map;_selectedContact;getAsArray(){return[...this._contacts.values()]}getAsTree(e){const t=e?e.toLowerCase():e;return t?this.getAsArray().filter((e=>this._hasFilter(e,t))):this.getAsArray()}getSelected(){return this._selectedContact}getNodeById(e){return this._contacts.get(e)}getAddressesById(e){return this._contacts.get(e)?.emailAddresses.map((e=>e.emailAddress))}getContactsWithAddress(e){const t=this.getAsArray().filter((t=>{if(t.emailAddresses&&t.emailAddresses.length>0)return t.emailAddresses.some((t=>t.emailAddress.toLowerCase()===e.toLowerCase()))}));if(t.length>0)return t[0]}hasContact(e,t){return this.getAsArray().some((n=>!!(n.emailAddresses&&n.emailAddresses.length>0)&&(n.emailAddresses.some((e=>e.emailAddress.toLowerCase()===t.toLowerCase()))&&n.name===e)))}isTrustedEmailAddress(e){for(const t of this.getAsArray())for(const n of t.emailAddresses)if(n.emailAddress.toLowerCase()===e.toLowerCase()&&t.trusted)return!0;return!1}getMailAddresses(){const e=new Map;for(const t of this._contacts.values())t.emailAddresses.forEach((n=>{const i=n.emailAddress.toLowerCase(),s=e.get(i);s?s.add(t.name):e.set(i,new Set([t.name]))}));return e}dispatchAction(e){switch(e.actionType){case"CONTACT_ADD_CONTACT":this._addContact(e.contact);break;case"CONTACT_ADD_CONTACTS":this._addContacts(e.contacts);break;case"CONTACT_DELETE_CONTACTS":this._delete(e.ids);break;case"CONTACT_INITIALIZE":this._initialize(e.contacts,e.newContact);break;case"CONTACT_SELECT_CONTACT":this._select(e.contact,e.focusContactView);break;case"CONTACT_UPDATE_CONTACT":this._update(e.contact)}}_update(e){this._contacts.set(e.id,e),this._selectedContact?.id===e.id&&(this._selectedContact=e),this.emitChange({reason:"updatedContact"})}_initialize(e,t){e.forEach((e=>{this._contacts.set(e.id,e)})),t?(this._selectedContact=t,this.emitChange({reason:"newContact",contact:t,focusContactView:!0})):this.emitChange({reason:"startup"})}_addContact(e){this._contacts.set(e.id,e),this.emitChange({reason:"addContacts"})}_addContacts(e){e.forEach((e=>{this._contacts.set(e.id,e)})),this.emitChange({reason:"addContacts"})}_delete(e){e.forEach((e=>{this._contacts.delete(e),this._selectedContact?.id===e&&(this._selectedContact=void 0)})),this.emitChange({reason:"deleteContact"})}_select(e,t){this._selectedContact=e,this.emitChange({reason:"selectedContact",contact:e,focusContactView:t})}_hasFilter(e,t){if(!t||0===t.length)return!0;if(e.name&&e.name.toLowerCase().indexOf(t)>-1)return!0;if(e.emailAddresses){let n=!1;if(e.emailAddresses.forEach((e=>{e.emailAddress.toLowerCase().indexOf(t)>-1&&(n=!0)})),n)return!0}return!1}}const r=new a(s.Z)},27033:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(24602),s=n(33638);class o extends i.Z{getInitialState(){return[]}getScripts(){return this.getState()}reduce(e,t){switch(t.actionType){case"CONTENT_SCRIPTS_UPDATED":case"CONTENT_SCRIPTS_INITIALIZE":return t.scripts}return e}}const a=new o(s.Z)},45502:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var i=n(24602),s=n(48588);const o={area:"content",feature:"browser"};class a extends i.Z{getInitialState(){return new Map}isBrowserFeature(e){return"browser"===(e||"browser")}getContext(e){const t=this.getState().get(e);return t||o}reduce(e,t){return"SWITCH_CONTEXT"===t.actionType?(0,s.cR)(e,t.windowId,(e=>{e.area=t.context.area,e.feature=t.context.feature}),o):e}}const r=new a},49777:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>r,mb:()=>o});var i=n(65398);var s=n(33638);const o=new class{#Ht;constructor(){this.#Ht=new Map}get(e){return this.#Ht.get(e)??[]}append(e,t){const n=this.#Ht.get(e);n?n.push(t):this.#Ht.set(e,[t])}clear(e){this.#Ht.delete(e)}};class a extends i.Z{ready=new Promise((e=>this.resolveReady=e));openAfterDownload=new Set;_downloadItems=[];_totalNumberOfDownloads=0;_totalProgress=0;_filter="";dispatchAction(e){switch(e.actionType){case"DOWNLOAD_PANEL_UPDATED":return this._downloadItems=e.downloadItems,void this.emitChange({reason:"download_panel_updated"});case"DOWNLOAD_COMPLETED":return o.clear(e.downloadItem.id),void this.emitChange({reason:"download_completed",downloadItem:e.downloadItem});case"DOWNLOAD_STARTED":return void this.emitChange({reason:"download_started",downloadItem:e.downloadItem});case"DOWNLOAD_STOPPED":return o.clear(e.downloadItem.id),void this.emitChange({reason:"download_stopped",downloadItem:e.downloadItem});case"DOWNLOAD_SET_TOTAL_PROGRESS":return this._totalProgress=e.totalProgress,this._totalNumberOfDownloads=e.totalNumberOfDownloads,void this.emitChange({reason:"download_total_progress_changed"});case"DOWNLOAD_SET_FILTER":return this._filter=e.filter,this._downloadItems=e.downloadItems,void this.emitChange({reason:"download_panel_updated"});case"DOWNLOAD_SET_ORDER_BY":return this._orderBy=e.orderBy,this._downloadItems=e.downloadItems,void this.emitChange({reason:"download_panel_updated"})}}getTotalNumberOfDownloads(){return this._totalNumberOfDownloads}hasDownloads(e){return this.getItems(e).length>0}getTotalProgress(){return this._totalProgress}getFilter(){return this._filter}getOrderBy(){return this._orderBy}getItems(e){return this._downloadItems.filter((t=>!(!e.isIncognitoWindow&&t.incognito))).filter((e=>!("interrupted"===e.state&&""===e.filename)))}}const r=new a(s.Z)},16875:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var i=n(24602),s=n(25372),o=n(48588);const a=Object.freeze({rewindHistory:[],rewindIndexes:[],forwardUrl:""});function r(e,t){const n=(0,s.Z)(e),i=(0,s.Z)(t);return n?.hostname===i?.hostname}function l(e,t,n,i){e.rewindHistory||(e.rewindHistory=[],e.rewindIndexes=[]);const s=e.prev,o=s&&s.url&&r(s.url,t.url);return n!==i.length-1&&(s&&!o&&n<i.length-1?(i.length-1-n>1&&(e.rewindHistory.length>0&&r(e.rewindHistory[e.rewindHistory.length-1].url,s.url)&&e.rewindHistory[e.rewindHistory.length-1].url!==s.url||r(i[i.length-1].url,s.url)&&i[i.length-1].url!==s.url)&&(e.rewindHistory.push(s),e.rewindIndexes.push(i.length-n-2)),e.rewindHistory.push(t),e.rewindIndexes.push(i.length-n-1)):0===n&&i.length>0&&(e.rewindHistory.push(t),e.rewindIndexes.push(i.length-n-1))),e.prev=t,e}class d extends i.Z{getInitialState(){return new Map}getStateById(e){return this.getState().get(e)||a}getFastForwardUrl(e){return this.getStateById(e).forwardUrl}getRewindRelativeIndex(e){const t=this.getState().get(e);if(t){const{rewindIndexes:e}=t;if(e.length>0)return e[0]}return 0}getRewindHistory(e){return this.getStateById(e.id).rewindHistory}getRewindIndexes(e){return this.getStateById(e.id).rewindIndexes}reduce(e,t){switch(t.actionType){case"FAST_FORWARD_SET_FORWARD_URL":const{forwardUrl:n,pageId:i}=t;return(0,o.cR)(e,i,(e=>{e.forwardUrl=n}),a);case"CHROME_TABS_UPDATED":{const{tabId:n,changeInfo:i}=t;return"loading"!==i.status?e:(0,o.cR)(e,n,(e=>{e.forwardUrl=""}),a)}case"FAST_FORWARD_SET_REWIND_INFO":{const{currentIndex:n,history:i,pageId:s}=t;return(0,o.cR)(e,s,(e=>{const{rewindHistory:t,rewindIndexes:s}=(o=n,i.slice(0,o+1).reduceRight(l,{rewindHistory:[],rewindIndexes:[]}));var o;0===e.rewindHistory.length&&0===t.length||(e.rewindHistory=t),0===e.rewindIndexes.length&&0===s.length||(e.rewindIndexes=s)}),a)}case"PAGE_CLOSE":{const{pages:n}=t;return n.some((t=>e.has(t.id)))&&(e=new Map(e),n.forEach((t=>e.delete(t.id)))),e}default:return e}}}const c=new d},62819:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h,E:()=>d});var i=n(30381),s=n.n(i),o=n(24602),a=n(93974);function r(e){const{items:t,filterText:n,titleFilter:i,urlFilter:s,shouldSearchUrl:o}=e,a=(s||i||n).toLowerCase().split(" ");let r;if(s)if(1===a.length){const e=a[0];r=({url:t})=>t.toLowerCase().includes(e)}else r=({url:e})=>(e=e.toLowerCase(),a.every((t=>e.includes(t))));else if(i||!o)if(1===a.length){const e=a[0];r=({title:t})=>t.toLowerCase().includes(e)}else r=({title:e})=>(e=e.toLowerCase(),a.every((t=>e.includes(t))));else if(1===a.length){const e=a[0];r=({title:t,url:n})=>n.toLowerCase().includes(e)||t.toLowerCase().includes(e)}else r=({title:e,url:t})=>(e=e.toLowerCase(),t=t.toLowerCase(),a.every((n=>t.includes(n)||e.includes(n))));return t.map((e=>{const t=e.children.filter(r);return{...e,children:t,visitCount:t.reduce(((e,t)=>e+t.visitCount),0)}}))}const l=(0,n(23542).extendMoment)(s());function d(e){const t=new Date(e);return`${String(t.getFullYear())}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}class c extends o.Z{getInitialState(){return{currentSortOrder:a.Z.DESCENDING_SORT,currentSortField:"visitTime",items:[],itemsAreSorted:!0,oldestHistoryDate:void 0}}getTreeNodes(e){this.#ui(e);const t=e.startTime.valueOf(),n=e.endTime.valueOf();let i=this.getState().items.filter((e=>e.visitTime>=t&&e.visitTime<=n));if(e.parsedFilter.query||e.parsedFilter.title||e.parsedFilter.url){i=r({items:i,filterText:e.parsedFilter.query.toLowerCase(),titleFilter:e.parsedFilter.title.toLowerCase(),urlFilter:e.parsedFilter.url.toLowerCase(),shouldSearchUrl:e.searchURL})}return i}getNumerOfItems(){return this.getState().items.length}getFilteredHistory(e,t){const n=r({items:t?this.getState().items.slice(0,10):this.getState().items,filterText:e,shouldSearchUrl:!0}),i=new Map;for(let e=n.length;e--;){const t=n[e].children;for(let e=t.length;e--;){const n=t[e],s=i.get(n.url);i.set(n.url,{...n,visitCount:s?s.visitCount+n.visitCount:n.visitCount,visitTime:s?Math.max(s.visitTime,n.visitTime):n.visitTime})}}return[...i.values()]}#ui(e){const t=this.getState(),{currentSortOrder:n,currentSortField:i,itemsAreSorted:s}=t;if(s&&e.sortOrder===n&&e.sortField===i)return;const{sortOrder:o,sortField:r}=e;let l;switch("visitTime"===r&&o===a.Z.ASCENDING_SORT?t.items.sort(((e,t)=>e.visitTime-t.visitTime)):t.items.sort(((e,t)=>t.visitTime-e.visitTime)),r){case"visitTime":case"visitCount":l=o===a.Z.ASCENDING_SORT?(e,t)=>e[r]-t[r]:(e,t)=>t[r]-e[r];break;case"title":case"address":l=o===a.Z.ASCENDING_SORT?(e,t)=>e[r].localeCompare(t[r]):(e,t)=>t[r].localeCompare(e[r])}if(l){const e=l;t.items.forEach((t=>t.children.sort(e)))}t.itemsAreSorted=!0,t.currentSortOrder=e.sortOrder,t.currentSortField=e.sortField}getTimeByRange(e,t){return isNaN(parseInt(e.rangePicker))?"today"===e.rangePicker?(e.startTime=l().startOf("day"),e.endTime=l().endOf("day")):"yesterday"===e.rangePicker?(e.startTime=l().subtract(1,"day").startOf("day"),e.endTime=l().subtract(1,"day").endOf("day")):"last_month"===e.rangePicker?(e.startTime=l().subtract(1,"month").startOf("month"),e.endTime=l().subtract(1,"month").endOf("month")):"all"===e.rangePicker?(t&&(e.startTime=t.startOf("day")),e.endTime=l().endOf("day")):"date_range"===e.rangePicker||console.warn("Unknown date range",e.rangePicker):(e.startTime=l().subtract(parseInt(e.rangePicker),"day").startOf("day"),e.endTime=l().endOf("day")),e}getOldestDate(){return this.getState().oldestHistoryDate??l()}reduce(e,t){switch(t.actionType){case"HISTORY_LOAD":return function(e,t,n,i){n&&u(e);const s=function(e){const t=[],n=Object.groupBy(e,(e=>e.dateKey));for(const e in n){const i=Object.groupBy(n[e],(e=>e.url)),s=Object.keys(i).map((e=>{const t=i[e],n=t[0],s=t.reduce(((e,t)=>e.visitTime>t.visitTime?e:t)).visitTime,o=t.length;return{address:n.address,title:n.title,transitionType:n.transitionType,url:e,id:n.id+"_"+s,visitCount:o,visitTime:s}}));t.push({children:s,id:e,visitCount:s.reduce(((e,t)=>e+t.visitCount),0),visitTime:l(e).valueOf()})}return t}(t);if(i){0;const t=s[0];if(t){const n=e.items.findIndex((e=>e.id===t.id));-1===n?e.items.unshift(t):e.items[n]=t,e.itemsAreSorted=p(e)}}else e.items=e.items.concat(s),e.itemsAreSorted=p(e);return e.oldestHistoryDate=l(t.reduce(((e,t)=>e<t.visitTime?e:t.visitTime),(e.oldestHistoryDate??l()).valueOf())),e}({...e},t.items,t.resetCache,t.isToday);case"HISTORY_REMOVE_AFTER":return function(e,t){if(0===t)u(e);else{let n=!1;const i=[];e.items.forEach((e=>{const s=e.children.filter((e=>e.visitTime<=t));n=n||s.length!==e.children.length,s.length>0&&(s.length!==e.children.length?i.push({...e,children:s,visitCount:s.reduce(((e,t)=>e+t.visitCount),0)}):i.push(e))})),n&&(e.items=i)}return e}({...e},t.since);case"HISTORY_REMOVE_VISITS":return function(e,t){return t.forEach((t=>{t.isFolder?function(e,t){const n=d(t.visitTime),i=e.items.findIndex((e=>e.id===n));-1!==i&&e.items.splice(i,1)}(e,t):void 0===t.url?console.error("Can not remove history element. Url missing"):function(e,t){const n=d(t.visitTime),i=[];e.items.forEach((e=>{if(e.id===n){const n=e.children.filter((e=>e.url!==t.url));if(n.length>0)if(n.length!==e.children.length){const t={...e,children:n,visitCount:n.reduce(((e,t)=>e+t.visitCount),0)};i.push(t)}else i.push(e)}else i.push(e)})),e.items=i}(e,t)})),e}({...e},t.visits)}return e}}function u(e){e.items=[],e.itemsAreSorted=!0}function p(e){const{itemsAreSorted:t,currentSortField:n,currentSortOrder:i}=e;return t&&"visitTime"===n&&i===a.Z.DESCENDING_SORT}const h=new c},65093:(e,t,n)=>{"use strict";n.d(t,{Z:()=>p});var i=n(65398),s=n(33638);const o=new Set,a=new Set,r=new Set,l=new Set,d=new Set,c=new Set;class u extends i.Z{isDisconnected(e){return!a.has(e)}isConnecting(e){return o.has(e)}isConnected(e){return!this.isConnecting(e)&&!this.isDisconnected(e)}isSyncing(e){return r.has(e)}isSyncingAny(){return r.size>0}isPreFetching(e){return l.has(e)}isPreFetchingAny(){return l.size>0}isPrefetchPaused(){return c.size>0}canResumePrefetch(e){return 1===c.size&&c.has(e)}isSyncingFlags(e){return d.has(e)}isSyncingFlagsAny(){return d.size>0}getStatus(e){return{isDisconnected:this.isDisconnected(e),isConnecting:this.isConnecting(e),isSyncing:this.isSyncing(e),isPreFetching:this.isPreFetching(e),isSyncingFlags:this.isSyncingFlags(e),isPrefetchPaused:this.isPrefetchPaused()}}dispatchAction(e){switch(e.actionType){case"MAIL_IS_DISCONNECTED":{const{accountId:t,isDisconnected:n}=e;let i=!1;n?(i=a.has(t),a.delete(t)):(i=!a.has(t),a.add(t)),i&&this.emitChange({accountId:t,isDisconnected:n});break}case"MAIL_IS_CONNECTING":{const{accountId:t,isConnecting:n}=e;let i=!1;n?(i=!o.has(t),o.add(t)):(i=o.has(t),o.delete(t)),i&&this.emitChange({accountId:t,isConnecting:n});break}case"MAIL_IS_SYNCING":{const{accountId:t,isSyncing:n}=e;let i=!1;n?(i=!r.has(t),r.add(t)):(i=r.has(t),r.delete(t)),i&&this.emitChange({accountId:t,isSyncing:n});break}case"MAIL_IS_PRE_FETCHING":{const{accountId:t,isPreFetching:n}=e;let i=!1;n?(i=!l.has(t),l.add(t)):(i=l.has(t),l.delete(t)),i&&this.emitChange({accountId:t,isPreFetching:n});break}case"MAIL_PAUSE_PRE_FETCHING":{const{requester:t,pause:n}=e;n?c.add(t):c.delete(t),this.emitChange({accountId:"",isPrefetchPaused:c.size>0});break}case"MAIL_IS_SYNCING_FLAGS":{const{accountId:t,isSyncingFlags:n}=e;let i=!1;n?(i=!d.has(t),d.add(t)):(i=d.has(t),d.delete(t)),i&&this.emitChange({accountId:t,isSyncingFlags:n});break}}}}const p=new u(s.Z)},98611:(e,t,n)=>{"use strict";n.d(t,{Z:()=>Y});var i=n(65398),s=n(99827),o=n(54162),a=n(29087),r=n(33638),l=n(47513),d=n.n(l),c=n(91834),u=n(71320),p=n(51501),h=n(10671),g=n(75401),m=n(84283),f=n(89165),v=n(95752),y=n(45660),b=n(54773),S=n(5863),w=n(51733),C=n(75995),A=n(56887),I=n(89175),T=n(34155);let Z,E,k,_,N,P,D=[],M=[],O=[],x={},L=!1,R=!1,B=[],F=[];function W(e,t){e.forEach((e=>{const{accountId:n,path:i,counter:s}=e;if(x[n]||(x[n]={}),t&&x[n][i]){const e=x[n][i];e.total+=s.total,e.unseen+=s.unseen,e.unread+=s.unread}else x[n][i]=s}))}function U(){const e=o.Z.getSelectedFolder();"threads"!==(0,A.U)(e)&&M.forEach(C.o)}function V(){U();const e=j.getListEntryComparator();O.sort(e),G(),j.emitChange({target:"listEntries",updateSelection:!0})}function H(e){const{addedSles:t,removedSles:n}=e,{sleUpdates:i}=e,s=j.getListEntryComparator();let o=!1;const a=new Set,r=[],l=[];function u(e){const t=j.createListEntry(e,[]),n=d()(M,t,w.PN);n<0&&M.splice(-n-1,0,t);const i=d()(O,t,s);i<0&&O.splice(-i-1,0,t),function(e){B.length>0&&(B=B.filter((t=>t.id!==e.id||(h(t),y.Z.log("Mail",`Doing postponed index update for ${e.id}`),!1)))),F.length>0&&(F=F.filter((({id:t,newThreadKey:n})=>t!==e.id||($(new Map([[t,n]])),y.Z.log("Mail",`Doing postponed thread key update for ${e.id}`),!1))))}(e)}function h(e){const t=j.getListEntry(e.id);if(!t)return B.push(e),void y.Z.log("Mail","Entry not found in index. Index update postponed until entry arrives.");const n=new Set([...t.viewIds]),i=new Set([...t.totalViewIds]),{updates:c}=e;void 0!==c.sentDate&&(t.sentDate=c.sentDate),Object.keys(c).includes("queued")&&(void 0===c.queued?delete t.queued:t.queued=c.queued),void 0!==c.attachment&&(t.attachment=c.attachment),void 0!==c.flags&&(t.flags=c.flags),void 0!==c.from&&(t.fromIds=c.from.map(b.Z.add)),void 0!==c.sourceFilterIds&&(t.sourceFilterIds=c.sourceFilterIds),void 0!==c.subject&&(t.subject=c.subject),void 0!==c.to&&(t.toIds=c.to.map(b.Z.add)),void 0!==c.preview&&(t.preview=c.preview);const u=c.removedViewIds||[],h=c.addedViewIds||[];if(void 0!==c.unseen)if(t.unseen=c.unseen,c.unseen)c.unseen&&y.Z.warn("Mail",["filter","store"],"updateIndex is trying to mark a message unseen",c);else{const e=[...n].filter((e=>e%S.XN===S.ZC));u.push(...e)}if(void 0!==c.sources){let e=!1,i=!1;if(c.sources.forEach(((n,s)=>{if(n){const o=t.sources.get(s);if(o){if(void 0!==n.read&&o.read!==n.read){const t=s*S.XN+S.aD;n.read?u.push(t):h.push(t),e=!0}if(void 0!==n.deleted&&o.deleted!==n.deleted&&!(0,f.Z)(t.sources,t.flags)&&!(0,g.Z)(t.sources)){const e=s*S.XN+S.IK;n.deleted?u.push(e):h.push(e),i=!0}t.sources.set(s,{...o,...n})}else{const{read:e,deleted:i,internal:o}=n;if(void 0===e||void 0===i||void 0===o)throw new Error("Cannot add invalid source "+JSON.stringify(n));t.sources.set(s,{read:e,deleted:i,internal:o})}}else t.sources.delete(s)})),e||i){const s=new Set;n.forEach((e=>{const t=Math.floor(e/S.XN);s.add(t)}));const o=[...s].filter((e=>!t.sources.has(e)));if(o.length>0){if(e){const e=o.map((e=>e*S.XN+S.aD));v.Z.call(t.sources)?u.push(...e):h.push(...e)}if(i){const e=o.map((e=>e*S.XN+S.IK));m.Z.isMessageDeleted(t.sources)?u.push(...e):h.push(...e)}}}}n.forEach((e=>a.add(e)));const w=new Set([...n]);if(u.length>0)for(const e of u)t.viewIds.delete(e),w.delete(e),a.add(e),p.ZP.isViewIdOfType(e,S.xE)&&t.totalViewIds.delete(e);if(h.length>0)for(const e of h)t.viewIds.add(e),w.add(e),a.add(e),p.ZP.isViewIdOfType(e,S.xE)&&t.totalViewIds.add(e);l.push(n),r.push(w);const C=j.isVisible({...t,viewIds:n,totalViewIds:i}),A=j.isVisible(t);if(C||A){if(!C&&A){const e=d()(D,t,s);D.splice(-e-1,0,t)}else if(C){let n=d()(D,t,s),i=!1;if(n<0&&(n=D.findIndex((e=>e===t)),i=!0),n>=0)if(A){if(i){D.splice(n,1);const e=d()(D,t,s);D.splice(-e-1,0,t)}}else D.splice(n,1);else y.Z.warn("Mail",["MailFiltersStore"],"Message not found in _listEntries",{sleUpdate:e})}o=!0;let n=d()(O,t,s);if(n<0)if(n=O.findIndex((e=>e===t)),n>=0){O.splice(n,1);const e=d()(O,t,s);O.splice(-e-1,0,t)}else y.Z.warn("Mail",["MailFiltersStore"],"Message not found in _sortedIndex",{sleUpdate:e})}}if(n&&n.forEach((e=>{!function(e){const t=d()(M,{id:e},w.PN);if(t>=0){const[e]=M.splice(t,1),n=d()(O,e,s);n>=0&&O.splice(n,1),e.viewIds.forEach((e=>a.add(e))),l.push(e.viewIds);const i=d()(D,e,s);i>=0&&(D.splice(i,1),o=!0)}}(e)})),t&&t.forEach((e=>{u(e)})),i&&i.forEach((e=>{h(e)})),o&&(D=D.slice(),j.emitChange({target:"listEntries",updateSelection:!0})),a.size>0){const e=j.getCounterFolders([...a]);e.length>0&&(l.forEach((t=>{const n=[...t].filter((e=>e%S.XN===S.xE));c.Z.updateCounterFolders(t,n,-1,e)})),r.forEach((t=>{const n=[...t].filter((e=>e%S.XN===S.xE));c.Z.updateCounterFolders(t,n,1,e)})),W(e,!0),j.emitChange({target:"counters"}))}}function G(){const e=Date.now();D=O.filter((e=>j.isVisible(e))),y.Z.log("Mail",["filter","store"],`initListEntries took ${Date.now()-e}ms.`),L=!1}function $(e){const t=o.Z.getSelectedFolder(),n=(0,A.U)(t),i=j.getListEntryComparator();let a,r=!1;if(e.forEach(((e,t)=>{const s=d()(M,{id:t},w.PN);if(s<0)return F.push({id:t,newThreadKey:e}),void y.Z.log("Mail","Entry not found in index. Thread key update postponed until entry arrives.");const l=M[s],c=l.threadKey;if("threads"===n){const t=d()(O,l,i),n=d()(D,l,i);l.threadKey=e,t>=0&&O.splice(t,1);const s=d()(O,l,i);O.splice(-s-1,0,l);if(j.isVisible(l)){n>=0&&D.splice(n,1);const e=d()(D,l,i);D.splice(-e-1,0,l),r=!0}}else l.threadKey=e;const u=o.Z.getSelectedThreadPrefix();if(u){const e=c.splice(0,2);u.every(((t,n)=>e[n]===t))&&(a=M[s])}})),a){const e=a;T.nextTick((()=>s.Z.selectThread(e)))}r&&j.emitChange({target:"listEntries"})}function K(){Z=void 0;(()=>{const e=o.Z.getSelectedFolder();if(e){const{accountId:t,path:n}=e;if(t!==S.tQ){const e=j.getByFolder(t,n);e&&(E=p.ZP.getViewIntersections(e))}}})(),G(),j.emitChange({target:"listEntries"})}class z extends i.Z{getByAccountId(e){return u.Z.getByAccountId(e)}getByFolder(e,t=S.ym){if(e)return u.Z.getByFolderId([e,t])}get(e){return u.Z.get(e)}getByIds(e){return u.Z.getByIds(e)}getByFolderId(e){return u.Z.getByFolderId(e)}getSourceFilters(e){const t=d()(M,{id:e},w.PN);if(t>=0){const{sourceFilterIds:e}=M[t];return u.Z.getByIds(e)}return[]}isLoading(){return L}isInitialized(){return R}getKnownFlags(){const e=this.getByAccountId(S.ut).map((e=>e.path)),t=Object.keys(S.T4).map((e=>S.T4[e]));return e.concat(t)}isSenderMailingList(e){const t=S.cs+"/"+e,n=S.W4+"/"+e;return void 0!==u.Z.getAll().find((e=>e.accountId===S.wC&&(e.path===t||e.path===n)))}isCounterFolder(e){return e?.accountId!==S.tQ}getCounters(e,t=S.ym){return x[e]&&x[e][t]}isCounterViewId(e,t){const n=e%S.XN,{showRead:i,showMailingLists:s,showFeeds:o,showJunk:a,showCustomFolder:r,showArchived:l}=p.ZP.getFilterOptions(t);switch(n){case S.xE:return!!i&&!!s&&!!o;case S.ZC:return!0;case S.aD:return!i;case S.EO:return!s;case S.Fz:return!o;case S.Jq:return!a;case S.js:return!r;case S.pF:return!l;default:return!1}}getCounterFolders(e){const t=new Set;for(const n of e){const e=Math.floor(n/S.XN);if(t.has(e))continue;const i=j.get(e);i&&(j.isCounterFolder(i)&&j.isCounterViewId(n,i)&&t.add(e))}if(0===t.size)return[];const n=new Map;for(const e of t){const t=j.get(e);if(!t)continue;const{id:i,accountId:s,path:o}=t,a=u.Z.getByFolderId([s,S.ym]),r=a?[a]:[];if(h.Z.getFolderType(s,o)===S.Oi){const e=u.Z.getByFolderId([S.Ry,S.ym]);e&&r.push(e)}let l=o.substring(0,o.lastIndexOf("/"));for(;l.length>0;){const e=u.Z.getByFolderId([s,l]);e&&r.push(e),l=l.substring(0,l.lastIndexOf("/"))}for(const e of r){const{id:t,filterValue:i}=e;if(i.showSubFolders&&!n.has(t)){const i=j.createCounterFolder(e);n.set(t,i)}}if(!n.has(i)){const e=j.createCounterFolder(t);n.set(i,e)}}return[...n.values()]}createCounterFolder(e){const{accountId:t,path:n}=e;return{accountId:t,path:n,viewIntersections:j.getViewIntersections(e),counter:{total:0,unseen:0,unread:0}}}getViewIntersections(e){const{showDeleted:t,showMailingLists:n,showFeeds:i,showJunk:s,showCustomFolder:o,showSubFolders:a,showArchived:r}=p.ZP.getFilterOptions(e),l=[e];if(a){const t=p.ZP.getSubFilters(e);l.push(...t)}const d={total:new Map,unseen:new Map,unread:new Map};for(const e of l){const{id:a}=e,l=a*S.XN+S.xE,c=a*S.XN+S.ZC,u=a*S.XN+S.aD,p=n?0:a*S.XN+S.EO,h=t?0:a*S.XN+S.IK,g=i?0:a*S.XN+S.Fz,m=s?0:a*S.XN+S.Jq,f=o?0:a*S.XN+S.js,v=r?0:a*S.XN+S.pF;if(p||h||g||m||f||v){const e=[];p&&e.push(p),h&&e.push(h),g&&e.push(g),m&&e.push(m),f&&e.push(f),v&&e.push(v),d.total.set(l,e),d.unseen.set(l,[c,...e]),d.unread.set(l,[u,...e])}else d.total.set(l,[l]),d.unseen.set(l,[c]),d.unread.set(l,[u])}return d}getIndex(){return M}getIndexSearchListIds(){return M.map((e=>e.id))}getListEntry(e){const t=d()(M,{id:e},w.PN);if(t>=0)return M[t]}matchesViewIntersection(e,t,n){for(const i of n||e){if(t.get(i)?.every((t=>e.has(t))))return!0}return!1}getListEntryComparator(){const e=o.Z.getSelectedFolder(),t=(0,A.U)(e);let n;switch(t){case"attachment":n=w.Qy;break;case"flag":n=w.lx;break;case"label":n=w.ye;break;case"sender":const t=!!e&&[S.Nz,S.kY,S.fZ].includes(h.Z.getFolderType(e.accountId,e.path));n=(0,w.S5)(t,b.Z.get);break;case"sentDate":n=w.rQ;break;case"size":n=w.YI;break;case"subject":n=w.Ji;break;case"threads":n=w.HT;break;case"unread":n=w.qA}if(!n)throw new Error("Comparator not found for sort field "+t);return"ascending"===a.Z.get(I.kMailSearchSortOrder)?n:(0,w.g4)(n)}isVisible(e){if(void 0!==k);else{if(!E)return!1;if(!j.matchesViewIntersection(e.viewIds,E,e.totalViewIds))return!1}if(null!=P){if(0===P&&e.attachment>0)return!1;if(P>0&&0===e.attachment)return!1}return!(_&&_>e.sentDate)&&(!(N&&N<e.sentDate)&&((!k||!k.some(((t,n)=>t!==e.threadKey[n])))&&!(Z&&d()(Z,e,w.dc)<0)))}hasNoListEntries(){return 0===D.length}createListEntry(e,t){const{id:n,messageId:i,attachment:s,flags:o,replied:a,sentDate:r,subject:l,preview:d,threadKey:c,unseen:u,queued:p,sourceFilterIds:h,sources:g,size:m}=e,f=e.to.map((e=>b.Z.add(e))),v=e.from.map((e=>b.Z.add(e))),y=new Set,w=new Set;for(const e of t)y.add(e),e%S.XN===S.xE&&w.add(e);return{id:n,messageId:i,attachment:s,flags:o,replied:a,sentDate:r,subject:l,preview:d,threadKey:c,unseen:u,queued:p,viewIds:y,totalViewIds:w,sourceFilterIds:h,sources:g,toIds:f,fromIds:v,size:m}}getListEntries(){return D}getQueryNumFound(){return Z?.length}getListEntriesByFolder(e,t){const n=this.getByFolder(e,t);if(!n)throw new Error("Filter not found "+[e,t].join());const i=p.ZP.getViewIntersections(n);return O.filter((e=>this.matchesViewIntersection(e.viewIds,i,e.totalViewIds)))}getListEntryIdsByViewIds(e){return M.filter((t=>e.some((e=>t.viewIds.has(e))))).map((e=>e.id))}getListEntriesByIds(e){const t=[];for(const n of e){const e=j.getListEntry(n);e&&t.push(e)}return t}dispatchAction(e){switch(e.actionType){case"MAIL_INIT_INDEX_FINISHED":!function(){M.sort(w.PN);const e=j.getListEntryComparator();O.sort(e),G(),R=!0,j.emitChange({target:"finishIndexProgress"}),j.emitChange({target:"listEntries",updateSelection:!0})}();break;case"MAIL_INIT_INDEX_BATCH":!function(e,t,n){const i=new Set;for(const e of t)for(const t of e.viewIds)i.add(t);const s=j.getCounterFolders([...i]);for(let n=0;n<e.length;n++){const i=e[n],{searchListId:o,viewIds:a}=t[n];if(i.id>o)throw new Error(`Database inconsistency: extra viewIds entry ${o}.`);if(i.id<o)throw new Error(`Database inconsistency: viewIds entry for SLE ${i.id} not found.`);const r=j.createListEntry(i,a);if(M.push(r),O.push(r),s.length>0){const{viewIds:e,totalViewIds:t}=r;c.Z.updateCounterFolders(e,t,1,s)}}W(s,!0),j.emitChange({target:"updateIndexProgress",indexCount:M.length,total:n})}(e.sleBatch,e.viewIdsBatch,e.total);break;case"MAIL_UPDATE_QUERY_RESULTS":{const{queryResults:t,folder:n,filterOptions:i,threadPrefix:s,attachments:o,sentDate:a,sentDateEnd:r,updateScrollPosition:l}=e;!function(e,t,n,i,s,o,a,r){if(k=i,Z=e,P=s,_=o,N=a,t){const e=j.getByFolder(t.accountId,t.path);e&&(E=p.ZP.getViewIntersections({...e,filterValue:{...e.filterValue,...n}}))}G(),j.emitChange({target:"listEntries",updateScrollPosition:r})}(t,n,i,s,o,a,r,l);break}case"MAIL_CLEAR_SEARCH":P=void 0,_=void 0,N=void 0,k=void 0,K();break;case"MAIL_CLEAR_QUERY":K();break;case"MAIL_INDEX_UPDATE":H(e.updates);break;case"MAIL_SORT_LIST_ENTRIES":V();break;case"MAIL_FILTERS_CHANGED":{const{filterIds:t}=e;!function(e){const t=o.Z.getSelectedFolder();if(t){const{accountId:n,path:i}=t;if(n!==S.tQ){const t=j.getByFolder(n,i);t&&e.includes(t.id)&&(E=p.ZP.getViewIntersections(t),G(),j.emitChange({target:"listEntries",updateSelection:!0}))}}j.emitChange({target:"filters",filterIds:e,updateSelection:!0,updateScrollPosition:!0})}(t);break}case"MAILING_LIST_GROUP_CHANGED":j.emitChange({target:"mailingLists"});break;case"MAIL_UPDATE_COUNTERS":{const{countedFolders:t,deltaValues:n}=e;W(t,n),j.emitChange({target:"counters"});break}case"MAIL_INIT_MESSAGES":e.folderIntersections?(t=e.folderIntersections,Z=void 0,k=void 0,P=void 0,_=void 0,N=void 0,E=t,V(),j.emitChange({target:"listEntries",updateSelection:!0})):function(){D=[],Z=void 0,E=void 0,k=void 0,P=void 0,_=void 0,N=void 0;const e=a.Z.get(I.kMailAccounts);L=!!e&&e.length>0,j.emitChange({target:"listEntries",isLoading:L})}();break;case"MAIL_UPDATE_THREAD_KEYS":{const{updates:t}=e;$(t);break}case"MAIL_SELECT_THREAD":const{threadPrefix:n}=e;K(),function(e){k=e,G(),j.emitChange({target:"listEntries",updateSelection:!0,updateScrollPosition:!0})}(n);break;case"MAIL_GOTO_UNREAD":j.emitChange({target:"gotoUnread"});break;case"MAIL_GOTO_NEXT_UNREAD":j.emitChange({target:"gotoNextUnread"});break;case"MAIL_GOTO_PREVIOUS_UNREAD":j.emitChange({target:"gotoPreviousUnread"});break;case"MAIL_STOP":D=[],Z=void 0,M=[],O=[],x={},L=!1,E=void 0,k=void 0,R=!1,P=void 0,_=void 0,N=void 0,j.emitChange({target:"counters"}),j.emitChange({target:"listEntries"});break;case"MAIL_SELECT_FOLDER":U()}var t}isInDraftOrOutbox(e){const t=this.getListEntry(e);if(t){const e=u.Z.getByIds(t.sourceFilterIds);return 1===e.length&&e[0].accountId===S.of&&[S.Wb,S.J8].includes(e[0].path)}return!1}}const j=new z(r.Z),Y=j},54162:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});var i=n(43630),s=n(65398),o=n(33638),a=n(96098),r=n(51501),l=n(10671),d=n(26036),c=n(5863),u=n(65741);class p extends s.Z{_selectionHistory=[];_historyIndex=-1;_optionsHistory=[];clear(){this._selectedFolder=void 0,this._selectionHistory=[],this._historyIndex=-1,this._optionsHistory=[],this.emitChange("clear")}getSelectedFolder(){return this._selectedFolder}getSelectionHistory(){return this._selectionHistory}getHistoryIndex(){return this._historyIndex}getOptions(){return this._optionsHistory[this._historyIndex]||{}}changeQuery(e){const t=this._optionsHistory[this._historyIndex];this._optionsHistory[this._historyIndex]={...t,query:e}}changeQueryAddition(e){const t=this._optionsHistory[this._historyIndex];this._optionsHistory[this._historyIndex]={...t,queryAddition:e}}getQuery(){return this._optionsHistory[this._historyIndex]?.query||""}clearQuery(){this._optionsHistory[this._historyIndex]&&delete this._optionsHistory[this._historyIndex].query}clearSearchOptions(){const e=this.getOptions();this.canGoBack()&&(r.ZP.isMailSearching(e)||r.ZP.isContactView(e)||r.ZP.isThreadedView(e))?(this._historyIndex=this._historyIndex-1,this._selectedFolder=this._selectionHistory[this._historyIndex],this._storeSelectedFolder(),this.emitChange("selectFolder")):this.emitChange("selectFolder")}toggleMailSearchOptions(){this.emitChange("toggleShowMailSearchOptions")}setOptions(e){this._optionsHistory[this._historyIndex]={...e},this.emitChange("setOptions")}getSelectedThreadPrefix(){return this.getOptions().threadPrefix}getOptionsFromHistory(e){return this._optionsHistory[e]}getFolderFromHistory(e){return this._selectionHistory[e]}isFolderAnEditMailFolder(){const e=this.getSelectedFolder(),t=e&&l.Z.getFolderType(e.accountId,e.path);return[c.kY,c.fZ,c.Nz].includes(t)}isTrashFolderSelected(){if(!this._selectedFolder)return!1;const{accountId:e,path:t,type:n=""}=this._selectedFolder;return n===c.uT||e===c.of&&t===c.cm}isSentFolderSelected(){if(!this._selectedFolder)return!1;const{accountId:e,path:t,type:n=""}=this._selectedFolder;return n===c.Nz||e===c.of&&t===c.N1}canGoBack(){return this.getSelectionHistory().length>1&&this.getHistoryIndex()>0}canGoForward(){const e=this.getSelectionHistory();return e.length>1&&this.getHistoryIndex()<e.length-1}getGoToMenuItems=(e,t)=>[{handler:()=>i.Z.goToNextUnread(e),..."list"===t?(0,d.Z)("command","Next Unread"):(0,d.Z)("Go to Next Unread")},{handler:()=>i.Z.goToPreviousUnread(e),..."list"===t?(0,d.Z)("command","Previous Unread"):(0,d.Z)("Go to Previous Unread")},{handler:()=>i.Z.markAsReadAndGoToNextUnread(e),...(0,d.Z)("Mark Read and Go to Next Unread")}];dispatchAction(e){switch(e.actionType){case"MAIL_SELECT_FOLDER":this._addToHistory(e.folder,e.options),this.emitChange("selectFolder");break;case"MAIL_FOLDER_SELECT_HISTORY_INDEX":const{historyIndex:t}=e;void 0!==t&&(this._selectFromHistory(t),this.emitChange("selectFolder"));break;case"MAIL_SEARCH_SET_OPTIONS":this.setOptions(e.options);break;case"MAIL_STOP":this.clear();break;case"MAIL_QUERY_CHANGE":this.changeQuery(e.query);break;case"MAIL_CLEAR_QUERY":this.clearQuery();break;case"MAIL_CLEAR_SEARCH":this.clearSearchOptions();break;case"SHOW_MAIL_SEARCH_OPTION":this.toggleMailSearchOptions()}}_storeSelectedFolder(){a.Z.set({FOLDER_SELECTION:this._selectedFolder},(e=>{e&&console.error("Failed to store selected folder",this._selectedFolder,e)}))}_selectFromHistory(e){e>=0&&e<this._selectionHistory.length&&(this._historyIndex=e,this._selectedFolder=this._selectionHistory[this._historyIndex],this._storeSelectedFolder())}_addToHistory(e,t){if(this._historyIndex>-1){const e=this._historyIndex+1;this._selectionHistory=this._selectionHistory.slice(0,e),this._optionsHistory=this._optionsHistory.slice(0,e)}var n,i;((n=this._selectionHistory[this._selectionHistory.length-1])===(i=e)||n&&i&&n.accountId===i.accountId&&n.path===i.path)&&(0,u.Z)(this._optionsHistory[this._optionsHistory.length-1],t)||(this._historyIndex=this._selectionHistory.length,this._selectionHistory.push(e),this._optionsHistory.push(t)),this._selectedFolder=e,this._storeSelectedFolder()}}const h=new p(o.Z)},98484:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(24602),s=n(93513);class o extends i.Z{getInitialState(){return{undoActions:new Set,maxSize:200}}reduce(e,t){switch(t.actionType){case"MAIL_UNDO_ADD_ITEM":return this.isValidItem(t.undoItem)?(0,s.Uy)(e,(e=>{const{undoActions:n}=e;if(n.add({undoItem:t.undoItem,folder:t.folder,created:Date.now()}),n.size>e.maxSize){const e=[...n][0];n.delete(e)}})):e;case"MAIL_UNDO_DELETE_ITEM":return(0,s.Uy)(e,(e=>{e.undoActions.delete(t.undoAction)}));case"MAIL_INDEX_UPDATE":const{removedSles:n}=t.updates;return n?(0,s.Uy)(e,(e=>{for(const{undoItem:t}of e.undoActions)switch(t.operation){case"setFlags":case"delete":for(const e of n)t.searchListIds.delete(e)}})):e;default:return e}}getLatestUndoAction(){const{undoActions:e}=this.getState();return[...e][e.size-1]}getUndoActions(){return this.getState().undoActions}isValidItem(e){if(0===e.searchListIds.size)return!1;if("setFlags"===e.operation){const{sourcesPerSle:t,updates:n}=e;if(0===Object.keys(n).length&&0===t.size)return!1}return!0}}const a=new o},7168:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(24602),s=n(35369);class o extends i.Z{getInitialState(){return new s.D5}reduce(e,t){switch(t.actionType){case"PAGE_SET_MEDIASTATE":const{tabId:n,mediastate:i}=t;return function(e,t,n){const i=e.get(n);if(i){const s=i.intersect(t).union(t);return e.set(n,s)}return t.length>0?e.set(n,(0,s.l4)(t)):e}(e,i,n);case"PAGE_CLOSE":return function(e,t){let n=e;return t.forEach((e=>{n.has(e.id)&&(n=n.remove(e.id))})),n}(e,t.pages);default:return e}}hasMediaState(e,t){const n=this.getState().get(e);return!!n&&n.has(t)}}const a=new o},62882:(e,t,n)=>{"use strict";n.d(t,{R0:()=>d,ZP:()=>Z,d0:()=>r,mS:()=>l});var i=n(65398),s=n(33638),o=n(92292),a=n(89555);const r="vivaldi/x-notes",l=500,d="1",c={children:[],content:"",dateAdded:0,dateModified:0,id:d,index:0,parentId:"0",title:"Notes",type:"folder"};let u=c,p={id:-1},h=[];class g extends i.Z{_resolveReady=a.Z;ready=(()=>new Promise((e=>{this._resolveReady=e})))();getRootNode(){return u}getLastTopNode(){const e=this.getRootNode(),t=e&&e.children?e.children:[];if(t.length>1)return t[t.length-2]}hasNotes(){const e=this.getRootNode();if(e&&e.children){if(e.children.length>1)return!0;const t=e.children[0];if(t&&"trash"===t.type)return Boolean(t.children&&t.children.length>0)}return!1}isFolder=e=>Boolean(e.children)&&"note"!==e.type;isSeparator=e=>"separator"===e.type;isAttachment(e){return"attachment"===e.type}isNodeEmpty(e){const t=T.getNodeById(e);return Boolean(t&&!t.title&&!t.content&&(!t.children||0===t.children.length))}hasChildren(e){return Boolean(e.children&&e.children.length>0)}getNodeById(e){const t=function(n){if(n)for(let i=0;i<n.length;i++){const s=n[i];if(s.id===e)return s;if(s.children){const e=t(s.children);if(e)return e}}};return t(u.children)}getDragData=(e,t)=>{const n=t.map((e=>T.getNodeById(e))).filter(Boolean);switch(e){case"text/plain":case"vivaldi/x-title":{const e=[];return n.forEach((t=>{e.push(T.isFolder(t)?t.title:t.content)})),e.join("\r\n")}case"text/html":{const e=n&&1===n.length?n[0]:void 0;return e&&e.url&&e.title?"<a href="+e.url+">"+e.title+"</a>":""}case"text/uri-list":case"vivaldi/x-uri-list":return n.filter((e=>!!e.url)).join("\r\n");default:return""}};getFilteredTree(e,t){const n=function(e,t,i,s,o){if(!e)return!1;let a=!1;return e.forEach((e=>{let r=!1;if(e.children&&"note"!==e.type){const l={...e,children:[]};n(e.children,l.children,i,s,o)&&(t.push(l),a=!0,r=!0)}if(!r&&"separator"!==e.type&&T._matchNode(e,s,o)){const n={...e};t.push(n),e.children&&"note"!==e.type&&i.push(e.id),a=!0}})),a},i=this.getRootNode().children,s=[],o=[];return n(i,s,o,e,t),{nodes:s,collapsed:o}}getFilteredFlat(e,t){const n=(e,t,i,s)=>{e&&e.forEach((e=>{!s.inTrash&&"trash"===e.type||"attachment"===e.type||"separator"===e.type||(T._matchNode(e,i,s)&&(e.children&&"note"!==e.type?t.push({...e,children:[]}):t.push({...e})),e.children&&"note"!==e.type&&n(e.children,t,i,s))}))},i=this.getRootNode().children,s=[];return n(i,s,e.toLowerCase(),t),s}_matchNode(e,t,n){let i=!1;const s=t.toLowerCase().split(" "),o=e.title?e.title.toLowerCase():"",a=e.content?e.content.toLowerCase():"",r=e.url?e.url.toLowerCase():"";return o.length&&(i=s.every((e=>o.includes(e)))),!i&&a&&!1!==n.content&&(i=s.every((e=>a.includes(e)))),!i&&r&&!1!==n.url&&(i=s.every((e=>r.includes(e)))),i}validateForDrag=e=>e.filter((e=>e!==p.id));validateForDeletion=e=>e.filter((e=>e!==p.id));validateForEdit=e=>e!==p.id;getTitle=e=>{const t=T.getNodeById(e);return t&&(t.title||t.content)||""};getCutIds(){return h}init=e=>{const t={...e[0],children:e[0].children??[]};u=e[0]?t:c,p=y(u)||{id:-1},T.emitChange({reason:"init",id:""}),this._resolveReady()};dispatchAction(e){switch(e.actionType){case"NOTES_INIT":this.init(e.notes);break;case"NOTES_ADD_ITEM":b(e.item,"added");break;case"NOTES_CHANGE_ITEM":!function(e,t){const n=u.children;if(u!==c&&n){!0===A(u,e,t)&&(u.children=[...n],T.emitChange({reason:"changed",id:e}))}}(e.id,e.changes);break;case"NOTES_MOVE_ITEM":!function(e,t,n){if(u!==c&&u.children){const i=T.getNodeById(e);void 0!==i&&(S(e,!0),i.parentId=t,i.index=n,b(i,"moved"))}}(e.id,e.targetFolder,e.targetIndex);break;case"NOTES_REMOVE_ITEM":S(e.id,!1);break;case"NOTES_SET_CUT_IDS":f(e.ids);break;case"WINDOW_READY":h.length>0&&v(!0)}}}function m(e){"Escape"===e.key&&f([])}function f(e){h=e,v(e.length>0),T.emitChange({reason:"cutids",id:""})}function v(e){e?o.Z.extension.getViews().forEach((e=>{e.addEventListener("keydown",m,!0)})):o.Z.extension.getViews().forEach((e=>e.removeEventListener("keydown",m,!0)))}function y(e){if(e.children)for(let t=0;t<e.children.length;t++){const n=e.children[t];if("trash"===n.type)return n;if(n.children){const e=y(n);if(void 0!==e)return e}}}function b(e,t){const n=u.children;if(u!==c&&n){!0===C(u,e)&&(u.children=[...n],T.emitChange({reason:t,id:e.id}))}}function S(e,t){const n=u.children;if(u!==c&&n){!0===I(u,e)&&(u.children=[...n],t||T.emitChange({reason:"removed",id:e}))}}function w(e){if(e.children)for(let t=0;t<e.children.length;t++){e.children[t].index=t}}function C(e,t){if(e.id===t.parentId)return e.children&&e.children.splice(t.index||0,0,t),w(e),!0;if(e.children)for(let n=0;n<e.children.length;n++){const i=e.children[n],s=i.children;if(s){if(C(i,t))return i.children=[...s],!0}}return!1}function A(e,t,n){if(!e.children)return!1;for(let i=0;i<e.children.length;i++){const s=e.children[i];if(s.id===t&&(s.title!==n.title||void 0!==n.content&&s.content!==n.content||void 0!==n.url&&s.url!==n.url||void 0!==n.dateModified&&s.dateModified!==n.dateModified)){const t={...e.children[i],...n};return e.children.splice(i,1,t),!0}if(s.children){const e=s.children;if(!0===A(s,t,n))return s.children=[...e],!0}}return!1}function I(e,t){if(!e.children)return!1;for(let n=0;n<e.children.length;n++){const i=e.children[n];if(i.id===t)return e.children.splice(n,1),w(e),!0;if(i.children){const e=i.children;if(!0===I(i,t))return i.children=[...e],!0}}return!1}const T=new g(s.Z),Z=T},17673:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var i=n(24602);function s(e){return t=>t.id!==e}function o(e,t){return e.when-t.when}class a extends i.Z{getInitialState(){return{notifications:[],activeNotifications:[]}}reduce(e,t){switch(t.actionType){case"NOTIFICATIONS_INIT":return{...e,notifications:t.notifications};case"NOTIFICATIONS_FOR_EVENT":const n=e.notifications.filter((e=>e.event_id!==t.event.id));return n.push(...t.event.notifications??[]),{...e,notifications:n};case"MAIN_SHOW_CALENDAR_ALARM":return{...e,activeNotifications:e.activeNotifications.filter(s(t.options.reminder.id)).concat(t.options.reminder).sort(o)};case"MAIN_HIDE_CALENDAR_ALARM":return{...e,activeNotifications:e.activeNotifications.filter(s(t.notificationId))}}return e}}const r=new a},96951:(e,t,n)=>{"use strict";n.d(t,{NK:()=>P,ZP:()=>ae,uU:()=>I,yz:()=>Y});var i=n(59486),s=n(7065),o=n(29087),a=n(24602),r=n(37330),l=n(9304),d=n(15489),c=n(92292),u=n(42568),p=n.n(u),h=n(7064),g=n(1407),m=n(35369),f=n(69046),v=n(16152),y=n(42578),b=n(36436),S=n(44850),w=n(89175),C=n(48588),A=n(14789);function I(e){return{type:"tab",id:e.id,page:e}}function T(e){const t=new Map;return t.set(void 0,[]),Object.freeze({windowId:e,list:(0,m.aV)(),history:[],minimizeHistory:null,lastHistory:null,isSelecting:!1,selection:(0,m.l4)(),selectionAnchor:null,selectionLead:null,cycleByHistory:t,cycledByHistoryPageId:null})}class Z extends a.Z{getInitialState(){return new Map}getPages(e,t){const n=k(e).list;return t?n.filter((e=>(0,f.cm)(e)===t.workspaceId)):n}getWorkspacePages(e){if(!e)return(0,m.aV)();const t=[];for(const[,n]of this.getState())t.push(n.list.filter((t=>(0,f.cm)(t)===e)));return(0,m.aV)(t).flatten()}getPinnedCount(e){return k(e).list.count((e=>e.pinned))}findPageInAllWindows(e){let t;const n=n=>{!t&&e(n)&&(t=n)};return this.getState().forEach((e=>{e.list.forEach(n)})),t}findRecentPageInAllWindows(e){let t;const n=n=>{!t&&e(n)&&(t=n)};return this.getState().forEach((e=>{for(let t=e.history.length-1;t>=0;t--){const i=e.history[t],s=e.list.find((e=>e.id===i));s&&n(s)}})),t}filterPagesInAllWindows(e){const t=[],n=n=>{e(n)&&t.push(n)};return this.getState().forEach((e=>{e.list.forEach(n)})),(0,m.aV)(t)}getTabs(e){const t=k(e);return N(t.list,t.history)}getWorkspaceTabsInWindow(e,t,n){if(n)return this.getPages(e,{workspaceId:t}).map(I);return this.getTabs(e).filter((e=>(0,f.cm)(e.page)===t))}getWorkspaceTabs(e,t){for(const n of d.ZP.getIds("normal")){const i=this.getWorkspaceTabsInWindow(n,e,t);if(i.size>0)return i}return(0,m.aV)()}getPageById(e){return this.findPageInAllWindows((t=>t.id===e))}getPagesByUrl(e,t){return this.getPages(e).filter((e=>e.url===t))}getPageInWindow(e,t){return k(e).list.find((e=>e.id===t))}getPageByReloadId(e){return this.findPageInAllWindows((t=>t.vivExtData.ext_id===e))}getPageHistory(e){return k(e).history}getActiveWorkspace(e){const t=this.getActivePage(e);return t?(0,f.cm)(t):void 0}getActiveWorkspaces(){const e=new Map;for(const[t,{list:n}]of this.getState()){const i=D(n);if(i){const n=(0,f.cm)(i);n&&e.set(n,t)}}return e}unsafeGetActivePage(e){return D(k(e).list)??(0,f.SJ)()}getActivePage(e){return D(k(e).list)}getLastVisited(e){const t=k(e),n=t.history[t.history.length-2];return t.list.find((e=>e.id===n))}isActivePage(e,t){return this.getActivePage(e)?.id===t}isUnread(e){return e.unread&&!e.discarded}getGroup(e,t){const n=k(t);return e?M(n.list,e):(0,m.aV)()}getExistingHostGroups(e,t){return oe.getPages(e,{workspaceId:t}).filter((e=>!e.pinned)).groupBy(f.av).reduce(((e,t,n)=>{const i=(0,y.q)(t.first());return n&&t.size>1&&t.rest().every((e=>(0,y.q)(e)===i))&&e.set(n,{hostname:i,pages:t}),e}),new Map)}getGroupsForHosts(e,t){const n=[],i=new Map;for(const[,{hostname:s,pages:o}]of oe.getExistingHostGroups(e,t)){const e=i.get(s);e?(i.set(s,e.concat(o)),n.push(s)):i.set(s,o)}const s=oe.getPages(e,{workspaceId:t}).filter((t=>{const n=(0,f.av)(t);return!(t.pinned||n&&oe.isGroup(n,e))})).groupBy(y.q).reduce(((e,t,n)=>{const s=i.get(n);return s?e.set(n,s.concat(t)):t.size>1&&e.set(n,t),e}),new Map);return n.forEach((e=>{s.has(e)||s.set(e,i.get(e))})),s}isDisplayingImage(e){const t=this.getPageById(e);return!!t&&["image/avif","image/jpeg","image/pjpeg","image/jpg","image/webp","image/png","image/gif","image/bmp","image/vnd.microsoft.icon","image/x-icon","image/x-xbitmap","image/x-png"].includes(t.mimeType)}isGroup(e,t){if(!e)return!1;if("off"===o.Z.get(w.kTabsStackingMode))return!1;const n=k(t);return!!e&&O(n.list,e)>1}isPinnedGroup(e,t){return this.isGroup(e,t)&&this.getGroup(e,t).some((e=>e.pinned))}getGroupHighlightId(e,t){const n=k(t);return x(n.list,n.history,e)?.id}getTiles(e,t){const n=k(t);return L(n.list,e)}isSelecting(e){return k(e).isSelecting}getSelection(e){return k(e).selection}getSelectedPages(e){const t=oe.getActiveWorkspace(e),n=k(e),i=n.selection.reduce(((e,i)=>{const s=n.list.find((e=>e.id===i));return s&&(0,f.cm)(s)===t?[...e,s]:e}),[]);return(0,m.aV)(i).sortBy((e=>e.index))}getSelectionOrActivePage(e){if(oe.isSelecting(e)){const t=oe.getSelectedPages(e);if(!t.isEmpty())return t}const t=oe.getActivePage(e);return t?m.aV.of(t):(0,m.aV)()}getReloadingPages(){return this.filterPagesInAllWindows((e=>Number(e.vivExtData.interval)>0))}getDiscardablePages(e){const t=k(e);return this._getDiscardablePages(e,t.list)}getNewGroupId(){return crypto.randomUUID()}getUnreadCount(e){let t=0;return k(e).list.forEach((e=>{this.isUnread(e)&&t++})),t}getHistoryManagerState(e){return this.getPageById(e)?.vivExtData.historyManagerState}canClosePage(e){if(e.pinned&&(!(0,f.av)(e)||!o.Z.get(w.kTabsClosePinnedInStack))&&"on"!==o.Z.get(w.kTabsClosePinned))return!1;return!(o.Z.get(w.kTabsNeverCloseLast)&&(0,S.Rf)(e.url)&&oe.isLastPage(e))}isLastPage(e){const t=(0,f.cm)(e);return this.getPages(e.windowId,{workspaceId:t}).size<2}getStepInfo(e,t,n,i){const s=(0,f.cm)(e),o=this.getPages(i,{workspaceId:s}),a=(0,f.av)(e);if(a&&!n){const n=o.flatMap(((e,t)=>(0,f.av)(e)===a?[t]:[])),i=n.first()??0,s=n.last()??0;let r;return r=t?e.index+1>s?s:e.index+1:e.index-1<i?i:e.index-1,{pages:m.aV.of(e),index:r}}{const s=a&&n?this.getGroup(a,i):m.aV.of(e);if(t){const t=a&&n?s.last().index:e.index,r=o.last().index;if(t===r)return;const l=o.indexOf(o.find((e=>e.index===t))),d=o.get(l+1);if(!d)return;const c=(0,f.av)(d);let u;if(c){u=this.getGroup(c,i).last().index}else u=d.index;return{pages:s,index:u}}{const t=a&&n?s.first().index:e.index,r=o.find((e=>!e?.pinned))?.index||0;if(t===r)return;const l=o.indexOf(o.find((e=>e.index===t))),d=o.get(l-1);if(!d)return;const c=(0,f.av)(d);let u;if(c){u=this.getGroup(c,i).first().index}else u=d.index;return{pages:s,index:u}}}}isActiveInternal(e){const t=this.getActivePage(e)?.url??"";return S.jk.isInternalUrl(t)}isActiveExternal(e){const t=this.getActivePage(e)?.url??"";return!S.jk.isInternalUrl(t)}getStartpage(e){const t=d.ZP.isIncognito(e),n=0===oe.getPages(e).size,i=t&&o.Z.get(w.kIncognitoShowIntro)&&n?S.jk.internals["private-intro"]:`${S.jk.internals.startpage}?section=Speed-dials`,s=l.ZP.getWindowBackgroundColor(r.Z.getBaseStylesByWindowId(e,["colorBg"]));return s&&!t?i+"&background-color="+s.toString():i}getDefaultStartpage(e){if(d.ZP.isGuest())return S.jk.internals["guest-intro"];let t=o.Z.get(w.kTabsNewPageLink);if(t===g.Fp.EXTENSION){const e=o.Z.get(w.kExtensionURLOverrides).newtab?.some((e=>e.active));e||(t=g.Fp.STARTPAGE)}switch(t){case g.Fp.EXTENSION:return g.P1;case g.Fp.BLANKPAGE:return S.jk.internals.blankpage;case g.Fp.HOMEPAGE:const t=o.Z.get(w.kHomepage);return t===g.QG?this.getStartpage(e):t;case g.Fp.CUSTOM:const n=o.Z.get(w.kTabsNewPageCustomUrl);return(0,b.C3)(n)||(0,b.xl)(n)?S.jk.getUrl(n):S.jk.internals.blankpage;case g.Fp.STARTPAGE:default:return this.getStartpage(e)}}canUseForMenu(e,t){const n=k(e).list;return n.size===t.size&&!t.some(((e,t)=>{const i=n.get(t);return e!==i&&(e.title!==i?.title||e.url!==i?.url)}))}getCyclePageByOrder(e,t,n){const i=oe.getPages(e,{workspaceId:t}),s=((i.findIndex((e=>e.active))+(n?-1:1))%i.size+i.size)%i.size;return i.get(s)?.id??-1}reduce(e,t){switch(t.actionType){case"PAGE_CLEAR":return oe.getInitialState();case"CHROME_TABS_INIT":return _(E,e,t.windowId,t.tabs);case"WINDOW_CLOSED":return(0,C.u4)(e,t.windowId);case"CHROME_TABS_CREATE":return _(U,e,t.page.windowId,t.page,t.tabActivationHistory,t.deactivatePageId,t.openerMissingGroupId);case"NAVIGATION_SET_STATE":return _(F,e,t.windowId,t.pageId,t.navigationState);case"CHROME_TABS_REMOVED":return _(V,e,t.removeInfo.windowId,t.tabId);case"CHROME_TABS_REPLACED":{const n=oe.getPageById(t.removedTabId);return n?_(G,e,n.windowId,t):e}case"CHROME_TABS_UPDATED":return _(H,e,t.windowId,t.tabId,t.changeInfo);case"CHROME_TABS_MOVED":return _($,e,t.windowId,t.tabId,t.index);case"PAGE_OPEN_URL":return _(X,e,t.windowId,t.pageId,t.url,t.postParams,t.headers,t.transition,t.fromUrlField,t.bookmarkId);case"PAGE_OPEN":return _(z,e,t.windowId,t.pageId,t.activatedByChrome??!1,t.selectGroup);case"PAGE_MINIMIZE":return _(j,e,t.windowId,t.workspaceId);case"PAGE_SET_IS_INSPECTED":return _(B,e,t.windowId,t.pageId,"isInspected",t.inspected);case"PAGE_TABSTACK_CREATE":return _(J,e,t.pages.first().windowId);case"PAGE_SET_TITLE":return _(B,e,t.windowId,t.pageId,"title",t.title);case"PAGE_SET_IMAGE_INSPECTOR":return _(B,e,t.windowId,t.pageId,"showImageInspector",t.showImageInspector);case"READERMODE":return _(B,e,t.windowId,t.pageId,"supportsReaderMode",t.supportsReaderMode);case"VIVALDI_TABS_UPDATED":return _(K,e,t.windowId,t.pageId,t.tabInfo);case"VIVALDI_TABRESOURCE_INFO_UPDATED":{const n=oe.getPageById(t.memoryInfo.tabId);return n?_(B,e,n.windowId,t.memoryInfo.tabId,"memoryUsage",t.memoryInfo.memoryUsage):e}case"PAGE_SELECTION_SET":return _(ne,e,t.page.windowId,t.page,t.multiSelect,t.addGroup,t.excludeActive);case"PAGE_SELECTION_TOGGLE_RELATED":return _(ee,e,t.page.windowId,t.page);case"PAGE_SELECTION_EXPAND_PREVIOUS":return _(te,e,t.page.windowId,t.page,"previous");case"PAGE_SELECTION_EXPAND_NEXT":return _(te,e,t.page.windowId,t.page,"next");case"PAGE_SELECTION_CLEAR":return _(J,e,t.windowId);case"PAGE_CYCLE_HISTORY_MODIFIER_UP":return _(se,e,t.windowId,t.workspaceId);case"PAGE_SET_CYCLE_BY_HISTORY":return _(ie,e,t.windowId,t.goBack,t.activateEventModifierUp,t.workspaceId);default:return e}}_getDiscardablePages(e,t){return t.filter((t=>!t.discarded&&!t.active&&!t.isInspected&&t.url!==this.getDefaultStartpage(e)))}}function E(e,t){const n=(0,m.aV)(t.map((e=>(e.favIconUrl||(e.favIconUrl=function(e){if(!e.favIconUrl||e.favIconUrl.startsWith("file://"))return"chrome://favicon/size/16@2x/"+(e.url||"");return e.favIconUrl}(e)),s.ZP.tabToPage(e)))));R(e.windowId),e.list=n,e.history=function(e){e.sort(((e,t)=>e.lastAccessed-t.lastAccessed));const t=e.findIndex((e=>e.active));if(-1!==t&&t!==e.length-1){const[n]=e.splice(t,1);e.push(n)}return e.map((e=>e.id)).filter(Boolean)}(t),J(e)}function k(e){return oe.getState().get(e)??T(e)}function _(e,t,n,i,s,o,a,r,l,d){if("number"!=typeof n)return t;const c=t.get(n)??T(n),u={...c};if(e(u,i,s,o,a,r,l,d),!function(e,t){let n=!1;for(const i of Object.keys(t)){const s=t[i];s!==e[i]&&(Array.isArray(s)&&Object.freeze(s),n=!0)}return!!n&&(Object.freeze(t),!0)}(c,u))return t;const p=new Map(t);return p.set(n,u),p}const N=p()(((e,t)=>e.groupBy((e=>(0,f.av)(e)||e.id)).map(((n,i,s)=>n.size>1?{type:"group",id:String(i),pages:n,page:x(e,t,`${i}`)??n.first()}:{type:"tab",page:n.first(),id:n.first().id})).toList()));function P(e){const t=k(e.first().windowId);return N(e,t.history)}const D=p()((e=>e.find((e=>e.active))));const M=p()((function(e,t){return t?e.filter((e=>(0,f.av)(e)===t)):(0,m.aV)()}),{maxSize:10}),O=p()(((e,t)=>e.count((e=>(0,f.av)(e)===t))),{maxSize:10}),x=p()(((e,t,n)=>{const i=M(e,n);if(!i.isEmpty()){for(let e=t.length-1;e>=0;e--){const n=t[e],s=i.find((e=>e.id===n));if(s)return s}return i.first()}console.warn(`No pages in stack ${n}.`)}),{maxSize:10});const L=p()((function(e,t){return t?e.filter((e=>(0,f.jA)(e)===t)):(0,m.aV)()}),{maxSize:10});const R=(0,v.Z)((e=>c.Z.tabs.query({windowId:e},(e=>e.forEach((e=>{const t=oe.getPageById(e.id?e.id:-1);if(t){let n;try{n=JSON.parse(e.vivExtData||"{}")}catch(e){n={}}const i=(0,m.D5)(n);(0,m.is)(i,t.vivExtData)||c.Z.tabs.update(t.id,{vivExtData:JSON.stringify(n)},(()=>{c.Z.runtime.lastError}))}}))))),160);function B(e,t,n,i){const s=e.list.findIndex((e=>e.id===t));-1!==s&&(e.list=e.list.setIn([s,n],i))}function F(e,t,n){if("stop"!==n.trigger&&"abort"!==n.trigger)return;const i=e.list.findIndex((e=>e.id===t));if(-1===i)return;const s=e.list.get(i);if(!s||!s.target)return;const{target:o}=s;e.list=e.list.set(i,{...s,url:o.committedUrl,target:void 0})}function W(e,t){return e.index!==t?{...e,index:t}:e}function U(e,t,n,i,s){e.list=e.list.splice(t.index,0,t).map(((e,n)=>(e.id===i&&(e={...e,active:!1}),e.id===s&&(e={...e,vivExtData:{...e.vivExtData,group:t.vivExtData.group}}),W(e,n)))),e.history=n,J(e)}function V(e,t){const[n,i]=e.list.partition((e=>e.id===t));e.list=n.map(W);const s=i.first()?.id,o=s?e.history.indexOf(s):-1;if(-1!==o){const t=[...e.history];t.splice(o,1),e.history=t}J(e)}function H(e,t,n){e.list=s.ZP.updatePage(e.list,t,n)}function G(e,t){const{removedTabId:n,addedTabId:i}=t;B(e,n,"id",i),e.history=e.history.map((e=>e===n?i:e))}function $(e,t,n){const i=e.list.find((e=>e.id===t));i&&(J(e),function(e,t,n){const i=e.list.findIndex((e=>e.id===t.id));n===i&&t.index===n||(e.list=e.list.delete(i).splice(n,0,t).map(W))}(e,i,n))}function K(e,t,n){n.hasOwnProperty("mimeType")&&B(e,t,"mimeType",n.mimeType)}function z(e,t,n=!1,i=!0){const s=e.list;if(function(e,t){const n=e.list.findIndex((e=>e.id===t));if(-1===n)return void console.warn("PageStore.activatePage: page to activate not found");const i=e.list.findIndex((e=>e.active));-1!==i&&i!==n&&(e.list=e.list.setIn([i,"active"],!1)),e.list=e.list.mergeIn([n],{unread:!1,active:!0})}(e,t),e.list===s)return;J(e,i),n||c.Z.tabs.update(t,{active:!0},(()=>{c.Z.runtime.lastError}));const o=[...e.history];(0,A.AL)(o,t),e.history=o}function j(e,t){let n=e.minimizeHistory?.get(t);n&&(0,m.is)(e.lastHistory,e.history)||(n=e.history.filter((n=>{const i=e.list.find((e=>e.id===n));return i&&(0,f.cm)(i)===t}))),n=(0,A.JA)(n,!0);const i=e.minimizeHistory??new Map;i.set(t,n),e.minimizeHistory=i;const s=n[n.length-1],o=e.list.find((e=>e.id===s))?.id;o?z(e,o):console.warn(`Page with id ${s} not found.`),e.lastHistory=e.history}function Y(e){const t=e instanceof m.aV?e:m.aV.of(e),n=t.first().windowId;let i;if(o.Z.get(w.kTabsActivationPreferRelated)){if(i=function(e,t){const n=(0,f.cm)(e),i=oe.getPages(e.windowId),s=t.map((e=>e.id));let a;if(e.openerTabId){const t=o.Z.get(w.kTabsActivationOnClose);if("activation_order"===t){const t=i.filter((t=>t.id!==e.id&&(t.openerTabId===e.openerTabId||t.id===e.openerTabId)&&(0,f.cm)(t)===n&&!s.includes(t.id))).map((e=>e.id)),o=k(e.windowId).history.findLast((e=>t.includes(e)));a=o?i.find((e=>e.id===o)):void 0}else{const o=()=>i.takeUntil((t=>t.id===e.id)).filter((t=>(t.openerTabId===e.openerTabId||t.id===e.openerTabId)&&(0,f.cm)(t)===n&&!s.includes(t.id))).reverse(),r=()=>i.slice(e.index+1).filter((t=>(t.openerTabId===e.openerTabId||t.id===e.openerTabId)&&(0,f.cm)(t)===n&&!s.includes(t.id)));a="right"===t?r().first()||o().first():o().first()||r().first()}}return a||(a=i.skipUntil((t=>t.id===e.id)).filter((e=>!s.includes(e.id))).find((t=>t.openerTabId===e.id&&(0,f.cm)(t)===n))),a}(t.find((e=>e.active))??t.first(),t),i)return i}const s=o.Z.get(w.kTabsActivationOnClose),a=(0,f.cm)(t.first()),r=t.map((e=>e.id)),l=oe.getPages(n,{workspaceId:a});switch(s){case"left":{const e=l.findIndex((e=>r.includes(e.id)))-1;i=e<0?l.find((e=>!r.includes(e.id))):l.get(e);break}case"right":{const e=l.findLastIndex((e=>r.includes(e.id)))+1;i=e<l.size?l.get(e):l.findLast((e=>!r.includes(e.id)));break}case"activation_order":i=void 0;break;default:0,i=void 0}if(!i){const e=k(n).history,s=1===t.size?t.first()?.vivExtData?.group:null;for(let n=e.length-1;n>=0;n--){const o=e[n],a=l.find((e=>e.id===o));if(a){if(!i&&!t.includes(a)&&(i=a,!s))break;if(!(s&&a.vivExtData?.group!==s||t.includes(a))){i=a;break}}}i||(i=l.findLast((e=>!r.includes(e.id))))}return i}function X(e,t,n,s,o="",a=h.Z.historyPrivate.TransitionType.LINK,r=!1,l){const d=e.list.findIndex((e=>e.id===t));if(-1===d)return;const c=e.list.get(d);if(!c)return;const u={committedUrl:c.url,postParams:s,headers:o,transition:a,fromUrlField:r};l&&!i.Z.isTopSite(l)&&(c.context.bookmarkThumbnailQueue={bookmarkId:l,url:n}),e.list=e.list.set(d,{...c,target:u,url:n,mimeType:"text/html"})}function Q(e,t,n){if(n){const n=e.windowId,i=(0,f.av)(t);let s=(0,m.aV)();oe.isGroup(i,n)?s=oe.getGroup(i,n):e.selection=e.selection.add(t.id);const o=oe.getActivePage(e.windowId),a=o?(0,f.av)(o):void 0;if(a!==i&&oe.isGroup(a,n)&&(s=s.concat(oe.getGroup(a,n))),s.size>1)return void(e.selection=e.selection.union(s.map((e=>e.id))))}else e.selection=e.selection.add(t.id)}function q(e,t){const n=e.toList().filter((e=>e!==t.id)).map((e=>{const t=oe.getPageById(e);return t?t.index:-1}));if(!n.isEmpty()){const e=n.insert(0,t.index).toArray();c.Z.tabs.highlight({tabs:e,windowId:t.windowId})}}function J(e,t=!0){e.isSelecting=!1;const n=D(e.list);e.selectionAnchor=n??null,e.selectionLead=n??null,0!==e.selection.size&&(e.selection=(0,m.l4)());o.Z.get(w.kTabsSelectionIncludeActive)&&n&&Q(e,n,t)}function ee(e,t){e.isSelecting||J(e),e.selectionLead=t;if(oe.isGroup((0,f.av)(t),e.windowId)){Q(e,t,!0)}else{const n=oe.getTabs(e.windowId),[,i]=(0,y.d)(t,n);e.selection=i.reduce(((e,t)=>e.add(t.id)),e.selection),e.isSelecting=!0}}function te(e,t,n){const i=t=>{const i="next"===n?t.index+1:t.index-1;return e.list.get(i)},s=e.windowId,a=o.Z.get(w.kTabsStackingMode),r=(0,f.av)(t),l=oe.isGroup(r,s),d=l&&"accordion"===a&&o.Z.get(w.kTabsStackingOpenAccordions).includes(r);if(e.isSelecting){const t=e.selection.map((t=>{const n=e.list.find((e=>e.id===t));return n&&"number"==typeof n.index?n.index:-1})).filter((e=>e>-1)).sort(),o="next"===n,l=o?t.last():t.first(),c=o?l+1:l-1,u=e.selectionLead,p=oe.getActivePage(s);if(u&&p){const n=e.selection.size>1&&!(p.index<=u.index&&u.index<=c&&o||p.index>=u.index&&u.index>=c&&!o);if(!n&&(c<0||c>e.list.size))return;if(n){const n=e.list.get(o?t.first():t.last());if(!n)return;if(n!==p){const t=!(("substrip"===a||d)&&r===(0,f.av)(n));ne(e,n,!1,t)}else{const n=e.list.get(o?t.last():t.first()),s=n&&i(n);if(s){const t=!(("substrip"===a||d)&&r===(0,f.av)(s));ne(e,s,!1,t)}}}else{const t=e.list.get(c);if(t){const n=r!==(0,f.av)(t)||"substrip"!==a&&"accordion"!==a;ne(e,t,!1,n)}}}}else if(l&&!d&&"substrip"!==a&&o.Z.get(w.kTabsSelectionIncludeActive))ne(e,t,!1,!0);else{const n=i(t);if(n){const t=!l||r!==(0,f.av)(n)&&("substrip"===a||"accordion"===a);return void ne(e,n,!1,t)}}}function ne(e,t,n,i,s=!1){e.isSelecting||(s?(e.selectionAnchor=oe.unsafeGetActivePage(e.windowId),e.selectionLead=e.selectionAnchor,e.selection=(0,m.l4)()):J(e,i)),n?function(e,t,n){const i=e.selectionAnchor,s=e.selectionLead;if(!i||!s)return;const a=s.index,r=i.index,l=e.windowId,d=e.list.filter((e=>e.index>=Math.min(r,a)&&e.index<=Math.max(r,a))).flatMap((e=>{const t=(0,f.av)(e);return oe.isGroup(t,l)?oe.getGroup(t,l):[e]})).map((e=>e.id)),c=t.index,u=!o.Z.get(w.kTabsSelectionIncludeActive),p=e.list.filter((e=>e.index>=Math.min(r,c)&&e.index<=Math.max(r,c)&&!(u&&e.active))).flatMap((e=>{const t=(0,f.av)(e);return n&&oe.isGroup(t,l)?oe.getGroup(t,l):[e]})).map((e=>e.id)),h=e.selection.subtract(d).union(p);e.selection=h,e.selectionLead=t,q(e.selection,oe.unsafeGetActivePage(l)),e.isSelecting=!0}(e,t,i):function(e,t,n){e.selectionLead=t,e.isSelecting||(e.selectionAnchor=t);!e.isSelecting&&t.active||!e.selection.contains(t.id)?Q(e,t,n):function(e,t,n){if(n&&oe.isGroup((0,f.av)(t),e.windowId)){const n=oe.getGroup((0,f.av)(t),e.windowId).map((e=>e.id));e.selection=e.selection.subtract(n)}else e.selection=e.selection.remove(t.id)}(e,t,n);q(e.selection,oe.unsafeGetActivePage(e.windowId)),e.isSelecting=!0}(e,t,i)}function ie(e,t,n,i){const s=e.history.filter((t=>{const n=e.list.find((e=>e.id===t));return n&&(0,f.cm)(n)===i}));let o;if(n){let n=e.cycleByHistory?.get(i);n?n=function(e,t){if(e===t)return t;const n=new Set(e),i=new Set;for(let e=0;e<t.length;++e)n.has(t[e])&&i.add(t[e]);if(i.size===n.size&&i.size===t.length)return t;for(const t of e)i.add(t);return Array.from(i)}(s,n):(n=s,e.cycledByHistoryPageId=n[n.length-1]),n=(0,A.JA)(n,!1===t),e.cycleByHistory||(e.cycleByHistory=new Map,e.cycleByHistory.set(void 0,[])),e.cycleByHistory?.set(i,n),o=n[n.length-1]}else{const n=s.length>0;do{e.history=(0,A.JA)(e.history,!1===t),o=e.history[e.history.length-1]}while(n&&!s.includes(o))}o?z(e,o,!1,!0):console.warn(`Page with extId ${o} not found.`)}function se(e,t){const n=e.cycleByHistory?.get(t),i=e.cycledByHistoryPageId,s=n&&n[n.length-1];if(i&&s){const t=e.history.filter((e=>e!==i&&e!==s));t.push(i),i!==s&&t.push(s),e.history=t}e.cycleByHistory?.set(t,null),e.cycledByHistoryPageId=null}const oe=new Z,ae=oe},15285:(e,t,n)=>{"use strict";n.d(t,{Pv:()=>f,ZP:()=>M,fG:()=>v,jM:()=>b,ut:()=>S});var i=n(96951),s=n(34197),o=n(68247),a=n(29087),r=n(24602),l=n(16716),d=n(15489),c=n(34540),u=n(86461),p=n(16152),h=n(9304),g=n(89175),m=n(93513);const f=35,v=10,y=["PanelDownloads","PanelWindow"],b=["PanelMail","PanelContacts","PanelFeeds"],S=["PanelCalendar","PanelTasks"],w=u.e3,C=(0,p.Z)(c.Z,500);function A(e){const{draft:t,winId:n,visible:i}=e,s=t.windowData.get(n);s&&(i?(s.barVisible=!0,s.contentVisible=!0,s.selectedPanel=s.selectedPanel||P.getFirstAvailablePanel(n)):(t.previousPanelBarVisible=s.barVisible,s.contentVisible=!1),t.changeReason="")}function I(e,t){const n=e.windowData.get(t);if(!n)return;const{contentVisible:i}=n;i?e.changeReason="setFocus":(n.barVisible=!0,n.contentVisible=!0,n.selectedPanel=n.selectedPanel||P.getFirstAvailablePanel(t),e.changeReason="")}function T(e){const{setFocus:t,selectId:n,panelId:i,draft:s,reason:o,winId:a}=e,r=s.windowData.get(a);if(!r)return;const{contentVisible:l,selectedPanel:d,expandedWidth:c}=r,u=r.transitionMap.get(i);l&&d===i&&u?.selectId===n||P.canRender({windowData:r,winId:r.winId,panelId:i})&&(r.transitionMap.set(i,{...u,setFocus:t,selectId:n,reason:o}),r.barVisible=!0,r.contentVisible=!0,r.expandedWidth=0===c?400:c,r.focusContent=t,r.selectedPanel=i,s.changeReason="display",D(s,a))}function Z(e,t){const n=e.windowData.get(t);if(!n)return;const{contentVisible:i,lastFocused:s,expandedWidth:o,barVisible:a}=n;i?(s?.focus(),n.barVisible=!1,n.contentVisible=!1,n.lastFocused=null,n.expandedWidth=0===o?400:o):a?(n.barVisible=!1,n.selectedPanel=void 0):(n.barVisible=!0,n.selectedPanel&&_({draft:e,winId:t,panelId:n.selectedPanel})),n.contentVisible||(e.previousPanelBarVisible=n.barVisible??!1),e.changeReason=""}function E(e){const{draft:t,windowId:n,leavePage:i,enterPage:s}=e,o=i?.isMailPage,a=s?.isMailPage,r=t.windowData.get(n)?.selectedPanel;!o&&a&&"PanelFeeds"!==r&&"PanelContacts"!==r?function(e,t){const n=e.windowData.get(t);if(!n)return e;e.previousMailPanel={selectedPanel:n.selectedPanel??"PanelMail",barVisible:n.barVisible??!1,contentVisible:n.contentVisible??!1},T({draft:e,winId:t,setFocus:!1,panelId:"PanelMail",selectId:"",reason:""}),e.changeReason="layout"}(t,n):P.shouldRestorePrevPanelState({draft:t,winId:n,isEnterPageMail:a,isLeavePageMail:o})&&(!function(e,t){const n=e.previousMailPanel;n&&(n.selectedPanel&&T({draft:e,winId:t,setFocus:!1,panelId:n.selectedPanel,selectId:"",reason:""}),A({draft:e,winId:t,visible:n.contentVisible}),n.barVisible||(Z(e,t),D(e,t)),e.changeReason="")}(t,n),t.changeReason="layout")}function k(e){const{draft:t,winId:n,minimal:i}=e,s=t.windowData?.get(n);if(!s)return;const o=P.getIsBarVisible(n);(i?o:o!==s.visibilityBeforeMinimalUI)&&(Z(t,n),t.changeReason=""),i&&(s.visibilityBeforeMinimalUI=o)}function _(e){const{draft:t,winId:n,panelId:i}=e,s=t.windowData?.get(n);if(!P.canRender({windowData:s,winId:n,panelId:i})||!s)return;const o=!s?.contentVisible,{contentVisible:a,selectedPanel:r,lastFocused:l}=s,d=!a;i===r?(d||l?.focus(),s.barVisible=!0,s.contentVisible=d,s.focusContent=d,s.lastFocused=d?document.activeElement:null):(s.barVisible=!0,s.contentVisible=!0,s.selectedPanel=i,s.lastFocused=d?document.activeElement:null,s.focusContent=!0),o||(t.previousPanelBarVisible=s?.barVisible??!1),t.changeReason=""}class N extends r.Z{getInitialState(){return{windowData:new Map,webPanelList:[],regPanelList:[],webPanelMap:new Map,previousPanelBarVisible:!1,previousMailPanel:void 0,changeReason:""}}reduce(e,t){switch(t.actionType){case"PANEL_INIT_COMMON":return(0,m.Uy)(e,(e=>{!function(e,t){const{regPanels:n,webPanels:i,barVisible:s}=t,o=i.map((e=>({...e}))),a=new Map(o.map((e=>[e.id,!0])));e.regPanelList=n.map((e=>({...e}))),e.webPanelList=o,e.webPanelMap=a,e.previousPanelBarVisible=s,e.changeReason=""}(e,t.state)}));case"PANEL_ADDED":if(t.showContent&&s.ZP.isWebPanel(t.panelId)){const n=(0,m.Uy)(e,(e=>{!function(e,t,n){e.windowData.get(t)&&(_({draft:e,winId:t,panelId:n}),e.changeReason="")}(e,t.winId,t.panelId)}));return D(n,t.winId),n}break;case"PANEL_TAB_REPLACED":return(0,m.Uy)(e,(e=>{const n=e.webPanelList.findIndex((e=>e.id===t.panelId));if(-1===n)return;const i=e.webPanelList[n];i.tabId=t.addedTabId,e.webPanelList[n]=i,e.changeReason="tabIdReplaced"}));case"PANEL_REMOVED":{const n=(0,m.Uy)(e,(e=>{!function(e,t,n){e.windowData.forEach((i=>{if(i.selectedPanel===n){const o=s.ZP.getPanelList().filter((e=>{P.canRender({winId:t,panelId:e})}));let a;if(o.length>1){const e=o.findIndex((e=>e===n));-1!==e&&(a=o[e+(e===o.length-1?-1:1)])}a?i.contentVisible?_({draft:e,winId:t,panelId:n}):i.selectedPanel=a:(i.selectedPanel=void 0,i.contentVisible=!1,e.previousPanelBarVisible=i.barVisible)}e.changeReason=""}))}(e,t.winId,t.panelId)}));return D(n,t.winId),n}case"PANEL_SET_CONTENT_VISIBLE":{const{winId:n,visible:i}=t,s=(0,m.Uy)(e,(e=>{A({draft:e,winId:n,visible:i})}));return D(s,n),s}case"PANEL_SET_FOCUS":return(0,m.Uy)(e,(e=>{I(e,t.winId)}));case"PANEL_TOGGLE_CURRENT":{const n=(0,m.Uy)(e,(e=>{!function(e,t){const n=e.windowData.get(t)?.selectedPanel||P.getFirstAvailablePanel(t);n&&(_({draft:e,winId:t,panelId:n}),e.changeReason="")}(e,t.winId)}));return D(n,t.winId),n}case"PANEL_TOGGLE_FLOATING":o.Z.toggle(g.kPanelsAsOverlayEnabled,!0,!1);break;case"PANEL_SET_MUTED":return(0,m.Uy)(e,(e=>{!function(e){const{draft:t,winId:n,panelId:i,muted:s}=e,o=t.windowData.get(n);o&&(o.mutedMap.set(i,s),t.changeReason="")}({draft:e,winId:t.winId,panelId:t.panelId,muted:t.muted})}));case"PANEL_SET_RESIZABLE":{const{panelId:n,resizable:i}=t,s=(0,m.Uy)(e,(e=>{!function(e){const{draft:t,panelId:n,resizable:i}=e;if(P.getIsWebPanel(n)){const e=t.webPanelList.findIndex((e=>e.id===n));if(-1!==e){const n=t.webPanelList[e];n.resizable=i,n.resizable||(n.width=-1),t.webPanelList[e]=n}}else{const e=t.regPanelList.findIndex((e=>e.id===n));if(-1!==e){const n=t.regPanelList[e];n.resizable=i,n.resizable||(n.width=-1),t.regPanelList[e]=n}}t.changeReason=""}({draft:e,panelId:n,resizable:i})}));return this.getIsWebPanel(n)?o.Z.set(g.kPanelsWebElements,s.webPanelList):o.Z.set(g.kPanelsElements,s.regPanelList),s}case"PANEL_SET_REG_PANELS":return function(e,t){let n=e.previousPanelBarVisible;const i=new Map(Array.from(e.windowData).map((([e,t])=>(t.selectedPanel&&!P.canRender({winId:e,windowData:t,panelId:t.selectedPanel})&&(t.selectedPanel=void 0,t.contentVisible=!1,n=t.barVisible),[e,t]))));return{...e,regPanelList:t,windowData:i,changeReason:"",previousPanelBarVisible:n}}(e,t.list);case"PANEL_SET_WEB_PANELS":return function(e,t){const n=new Map(t.map((e=>[e.id,!0])));let i=e.previousPanelBarVisible;const s=new Map(Array.from(e.windowData).map((([e,t])=>(t.selectedPanel&&!P.canRender({windowData:t,panelId:t.selectedPanel,winId:e})&&(t.selectedPanel=void 0,t.contentVisible=!1,i=t.barVisible),[e,t]))));return{...e,changeReason:"",webPanelList:t,webPanelMap:n,previousPanelBarVisible:i,windowData:s}}(e,t.list);case"PANEL_SET_WIDTH":{const{winId:n,panelId:i,width:s}=t,a=(0,m.Uy)(e,(e=>{!function(e){const{winId:t,panelId:n,width:i,draft:s}=e;if(P.getIsWebPanel(n)){const e=s.webPanelList.find((e=>e.id===n));e&&e?.width!==i&&(e.width=i)}else{const e=s.regPanelList.find((e=>e.id===n));e&&e?.width!==i&&(e.width=i)}if(!P.getResizableByPanel(n)){const e=s.windowData.get(t);if(!e)return;e.expandedWidth=i}s.changeReason=""}({draft:e,winId:n,panelId:i,width:s})}));return D(a,n),P.getIsWebPanel(i)?o.Z.set(g.kPanelsWebElements,a.webPanelList):o.Z.set(g.kPanelsElements,a.regPanelList),a}case"PANEL_REMOVE_FOCUS":return(0,m.Uy)(e,(e=>{const n=e.windowData.get(t.winId);n&&(n.focusContent=!1,e.changeReason="")}));case"PANEL_SHOW_NEXT":{const{winId:n,direction:i}=t,s=(0,m.Uy)(e,(e=>{!function(e){const{draft:t,winId:n,direction:i}=e,s=t.windowData?.get(n);if(!s)return;if(!s.contentVisible)return void I(t,s.winId);const o=P.getNextPanel(n,i);o&&(_({draft:t,winId:n,panelId:o}),t.changeReason="")}({draft:e,winId:n,direction:i})}));return D(s,n),s}case"PANEL_SHOW_CONTENT":{const{setFocus:n,selectId:i,panelId:s,winId:o,reason:a}=t;return(0,m.Uy)(e,(e=>{T({draft:e,setFocus:n,selectId:i,panelId:s,winId:o,reason:a})}))}case"PANEL_TOGGLE_CONTENT":{const{winId:n,panelId:i}=t,s=(0,m.Uy)(e,(e=>{_({draft:e,winId:n,panelId:i})}));return D(s,n),s}case"PANEL_CLEAR_TRANSITION_STATE":{const{winId:n,panelId:i}=t;return(0,m.Uy)(e,(e=>{!function(e){const{draft:t,winId:n,panelId:i}=e,s=t.windowData.get(n);s&&(s.transitionMap.has(i)&&s.transitionMap.delete(i),t.changeReason="")}({draft:e,winId:n,panelId:i})}))}case"PANEL_TOGGLE_PANEL":{const n=(0,m.Uy)(e,(e=>{Z(e,t.winId)}));return D(n,t.winId),n}case"WINDOW_STATE_CHANGED":{const{oldState:n,change:i,windowId:s}=t;if("fullscreen"===n.state||"fullscreen"===i){const t=(0,d.TF)(n),o=(0,d.TF)({...n,state:i});if(t!==o){const t=(0,m.Uy)(e,(e=>{k({draft:e,winId:s,minimal:o})}));return a.Z.get(g.kStartupRememberFullScreen)&&D(t,s),t}}return e}case"WINDOW_MINIMAL_UI":{const n=(0,m.Uy)(e,(e=>{k({draft:e,winId:t.windowId,minimal:t.minimalUI})}));return D(n,t.windowId),n}case"WINDOW_SET_STATE":return e.windowData.has(t.windowId)?e:(0,m.Uy)(e,(e=>{!function(e,t){t.forEach((t=>{const n=s.ZP.panelInitWindow(t);n.selectedPanel&&!P.canRender({windowData:n,winId:n.winId,panelId:n.selectedPanel})&&(n.selectedPanel=P.getFirstAvailablePanel(n.winId,n)),e.windowData.set(n.winId,n)})),e.changeReason=""}(e,[s.ZP.getNewWindowSettings(t.windowId,t.windowExtData)]),e.changeReason=""}));case"WINDOW_CLOSED":return(0,m.Uy)(e,(e=>{e.windowData.delete(t.windowId),e.changeReason=""}));case"PAGE_OPEN":{const n=t.windowId;if(!t.activatedByChrome)return e;const s=i.ZP.getLastVisited(n),o=i.ZP.getActivePage(n);if(n&&s&&o&&function(e,t){const{windowData:n}=e,i=Boolean(n.get(t)?.contentVisible)||!n.get(t)?.contentVisible&&a.Z.get(g.kMailOpenPanelAutomaticallyViewingMail),s=a.Z.get(g.kPanelsAsOverlayEnabled)&&(!a.Z.get(g.kPanelsAsOverlayAutoClose)||!1===P.getSeparateFloating("PanelMail",t));return a.Z.get(g.kMailDisplayMailPanelViewingMail)&&(s&&i||!a.Z.get(g.kPanelsAsOverlayEnabled)&&i)}(e,n)){const t=(0,m.Uy)(e,(e=>{E({draft:e,windowId:n,leavePage:s,enterPage:o})}));return D(t,n),t}return e}case"PANEL_CLOSE":{const{panelId:n,winId:i}=t;if(e.previousPanelBarVisible){const t=(0,m.Uy)(e,(e=>{_({draft:e,winId:i,panelId:n})}));return D(t,i),t}{const t=(0,m.Uy)(e,(e=>{Z(e,i)}));return D(t,i),t}}}return e}getIsMuted(e,t){return Boolean(this.getWindowData(e)?.mutedMap?.get(t))}shouldRestorePrevPanelState(e){const{draft:t=this.getState(),winId:n,isEnterPageMail:i,isLeavePageMail:s}=e,o=t.windowData.get(n);return s&&!i&&Boolean("PanelMail"===o?.selectedPanel&&o?.contentVisible&&o?.barVisible)}getWidth(e){const t=f+2*(0,h.mM)(),n=this.getWindowData(e);if(!n)return t+v;const i=d.ZP.getVisibleUI(e).panelToggle;if(!i||n.barVisible||n.contentVisible){if(i&&n.barVisible&&!n.contentVisible)return t+v;if(n.barVisible&&!n.contentVisible)return t;if(n.barVisible&&n.contentVisible){let e=n.expandedWidth;const t=n.selectedPanel;if(t&&this.getResizableByPanel(t)){const n=this.getWidthByPanel(t);n>0&&(e=n)}return e<=0?400:e}return 0}return v}getWidthByPanel(e){const{regPanelList:t,webPanelList:n}=this.getState();return[...t,...n].find((t=>t.id===e))?.width??-1}getFocusContent(e){return Boolean(this.getWindowData(e)?.focusContent)}getIsVisible(e,t){return Boolean(this.getWindowData(e)?.contentVisible)&&this.getWindowData(e)?.selectedPanel===t}getIsBarVisible(e){return Boolean(this.getWindowData(e)?.barVisible)}getFirstAvailablePanel(e,t=P.getWindowData(e)){const n=s.ZP.getPanelList();for(let i=0;i<n.length;i++){const s=n[i];if(P.canRender({windowData:t,winId:e,panelId:s}))return s}}getIsContentVisible(e){return Boolean(this.getWindowData(e)?.contentVisible)}getSelected(e){return this.getWindowData(e)?.selectedPanel}getSeparateFloating(e,t){return[...this.getWebPanels(t),...this.getRegPanels(t)].find((t=>t.id===e))?.floating??void 0}getOrderedWebPanels(e){const t=a.Z.get(g.kToolbarsPanel).filter((e=>s.ZP.isWebPanel(e))),n=P.getWebPanels(e),i=t.map((e=>n.find((t=>t.id===e)))).filter(Boolean);return n.forEach((e=>{i.some((t=>t.id===e.id))||(0,u.LM)(e.id,g.kToolbarsPanel)&&i.push(e)})),i}getNextPanel(e,t){const n=this.getWindowData(e);if(n){if(n.selectedPanel){const i=s.ZP.getPanelList().filter((t=>P.canRender({winId:e,panelId:t})));let o=i.indexOf(n.selectedPanel);if(-1!==o)return o+="next"===t?1:-1,i[(o+i.length)%i.length]}return P.getFirstAvailablePanel(e)}}getRegPanels(e){return this.getState().regPanelList.filter((t=>P.canRender({winId:e,panelId:t.id})))}getWebPanels(e){return this.getState().webPanelList.filter((t=>P.canRender({winId:e,panelId:t.id})))}getWebPanel(e,t){return P.getWebPanels(e).find((e=>e.id===t))}getIsWebPanel(e){return this.getState().webPanelMap.has(e)}hasWebPanel(e,t){return Boolean(P.getOrderedWebPanels(e)[t-1])}canRender(e){const{winId:t,windowData:n,panelId:i}=e;if(d.ZP.isGuest()&&!y.includes(i))return!1;if(s.ZP.isWebPanel(i))return(0,u.VJ)(i,t);if(b.includes(i)){if(!d.ZP.isMail(t)||a.Z.get(g.kMailIsTurnedOff))return!1}else if(S.includes(i)){if(a.Z.get(g.kMailIsTurnedOff))return!1}else if(w.includes(i)){"PanelChat"===i&&l.Z.isEnabled("chat");return!1}return Boolean(n||this.getWindowData(t)||d.ZP.isSettings(t))}hasPanel(e,t){return!!P.canRender({winId:e,panelId:t})&&Boolean(a.Z.get(g.kToolbarsPanel).find((e=>e===t))||a.Z.get(g.kToolbarsNavigation).find((e=>e===t))||a.Z.get(g.kToolbarsStatus).find((e=>e===t))||a.Z.get(g.kToolbarsMail).find((e=>e===t)))}getChangeReason(){return this.getState().changeReason}getWindowData(e){return this.getState().windowData.get(e)}getMutedMap(e){return this.getWindowData(e)?.mutedMap}getResizableByPanel(e){const{regPanelList:t,webPanelList:n}=this.getState();for(let n=0;n<t.length;n++)if(t[n].id===e)return t[n].resizable;for(let t=0;t<n.length;t++)if(n[t].id===e)return n[t].resizable;return!1}canAutoOpen(e,t){return!(this.getSelected(e)===t&&this.getWidth(e)>50)}getTransitionState(e,t){return this.getWindowData(e)?.transitionMap.get(t)}}const P=new N;function D(e,t){const n=e.windowData.get(t);n&&(o.Z.set(g.kPanelsWindowDefaults,{barVisible:n.barVisible,panelVisible:n.contentVisible,selectedPanel:n.selectedPanel?n.selectedPanel:void 0,width:n.expandedWidth}),C(n.winId,{SHOW_PANEL:n.barVisible,SELECTED_PANEL:n.selectedPanel?n.selectedPanel:void 0,PANEL_WIDTH:n.expandedWidth,SHOW_PANEL_CONTENT:n.contentVisible}))}const M=P},32921:(e,t,n)=>{"use strict";n.d(t,{Z:()=>v,d:()=>r});var i=n(65398),s=n(14481),o=n(33638),a=n(93513);const r=e=>{const{lastAlarmTime:t,periodInMinutes:n,currentTime:i=Date.now()}=e,s=6e4*n;if(t){return t+s*Math.ceil((i-t)/s)}return i+s};let l,d=new Map;class c extends i.Z{getAlarmFromReloadId(e){return d.get(e)}existingAlarms(){return Boolean(d.size)}getPanelAlarms(){const e=[];for(const[t,n]of d)"panel"===n.from&&e.push([t,n]);return new Map(e)}dispatchAction(e){switch(e.actionType){case"PERIODIC_RELOAD_ALL":u(e.alarms);break;case"PERIODIC_RELOAD_CREATE":p(e.alarm);break;case"PAGE_CLOSE":e.pages.forEach((e=>{const t=e.vivExtData.ext_id;t&&h([t])}));break;case"PERIODIC_RELOAD_DESTROY":h(e.alarmIds);break;case"PERIODIC_RELOAD_UPDATE":d=(0,a.Uy)(d,(t=>{t.set(e.alarm.alarmId,e.alarm.alarm)}))}}}const u=e=>{d=(0,a.Uy)(d,(t=>{e.forEach(((e,n)=>{t.set(n,e)}))})),!l&&d.size&&(g(),m())},p=e=>{d=(0,a.Uy)(d,(t=>{t.set(e.alarmId,e.alarm)})),l||(g(),m())},h=e=>{d=(0,a.Uy)(d,(t=>{e.forEach((e=>t.delete(e)))}))},g=()=>{const e=Date.now(),t=[];d.forEach(((n,i)=>{const{scheduledTime:o,periodInMinutes:a,id:l,from:d}=n,c=(o-e)/6e4/a;if(c<=0){const n={id:l,scheduledTime:r({periodInMinutes:a,lastAlarmTime:o,currentTime:e}),periodInMinutes:a,from:d};t.push({type:"RELOAD",periodInMinutes:a,id:i}),s.Z.updateRunningAlarm(i,n)}else t.push({type:"TIME_CHANGED",periodInMinutes:a,remainingTime:c,id:i,from:d})})),f.emitChange(t)},m=()=>l=setInterval((()=>{if(0===d.size)return clearInterval(l),l=void 0,void f.emitChange([]);g()}),1e3),f=new c(o.Z),v=f},80342:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var i=n(24602);class s extends i.Z{getInitialState(){return[]}getList(){return this.getState()}getUnreadCount(){return this.getState().filter((e=>!e.read)).length}getFilter(e){return this.getState().filter((t=>{const n=e.split(" "),{title:i,url:s}=t;return s.toLowerCase().includes(e.toLowerCase())||n.every((e=>i.toLowerCase().includes(e.toLowerCase())))}))}reduce(e,t){return"READING_LIST_UPDATE"===t.actionType?t.entries:e}}const o=new s},24602:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(65398),s=n(33638);class o extends i.Z{constructor(e){super(e??s.Z),this._state=this.getInitialState(),this._wrappedListeners=new Map}getState(){return this._state}getInitialState(){throw new TypeError(`getInitialState() is not overwritten in ${this.constructor.name}`)}addListener(e,t){if(t){if(this._wrappedListeners.has(e))throw new Error(`addListener() in ${this.constructor.name} was called with a listener that was already added as a callback. Use ensureAddedListener() if this was intentional.`);let n;const i=()=>{const i=t(this.getState());i!==n&&e(),n=i};this._wrappedListeners.set(e,i),super.addListener(i)}else super.addListener(e)}removeListener(e){const t=this._wrappedListeners.get(e);t?(this._wrappedListeners.delete(e),super.removeListener(t)):super.removeListener(e)}ensureRemovedListener(e){const t=this._wrappedListeners.get(e);t?(this._wrappedListeners.delete(e),super.ensureRemovedListener(t)):super.ensureRemovedListener(e)}reduce(e,t){throw new TypeError(`reduce() is not overwritten in ${this.constructor.name}`)}dispatchAction(e){const t=this._state,n=this.reduce(t,e);if(void 0===n)throw new Error(`reduce() in ${this.constructor.name} returned undefined, did you forget to return the state in the default case?`);n!==t&&(this._state=n,this.emitChange())}}const a=o},81538:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const i=new Map},18237:(e,t,n)=>{"use strict";n.d(t,{AP:()=>l,ZP:()=>g,iq:()=>r,m8:()=>a});var i=n(65398),s=n(33638),o=n(93513);const a="vivaldi/x-session",r="vivaldi/x-session-history",l="vivaldi/x-session-content",d=3e5;let c={items:[],rootId:0,autosaveId:0,trashId:0},u={opening:!1,workspaceAsTabs:!1,persistentTabs:!1,workspaceMap:new Map,groupIdMap:new Map,groupNameMap:new Map};class p extends i.Z{backupId=null;backupSumTick=0;sessionRecovery=!1;getAll(){return c.items}hasSessions(){const e=h.getAll();return e.length>1||Boolean(e[0]?.children?.length)}getFiltered(e){const t=e.toLowerCase().trim();if(!t)return h.getAll();const n=t.toLowerCase().split(" "),i=[];return h.getAll().forEach((e=>{let t=!1;if(e.name){const i=e.name.toLowerCase();t=n.every((e=>i.includes(e)))}t&&i.push(e)})),i}getById(e){const t=function(n){for(let i=0;i<n.length;i++){const s=n[i];if(s.id===e)return{index:i,item:s};if(s.children){const e=t(s.children);if(e)return e}}};return t(c.items)}isTrash(e,t){if(e===c.trashId)return t;let n=h.getById(e);for(;n;){if(n.item.id===c.trashId)return!0;n=h.getById(n.item.parentId)}return!1}isTrashFolder(e){return e===c.trashId}isAutoSaveNode(e){return e===c.autosaveId}isHistoryParent(e){const t=h.getById(e);return"node"===t?.item.type&&Boolean(t?.item.children)}isHistoryChild(e){return"history"===h.getById(e)?.item.type}inSessionRecovery(){return this.sessionRecovery}getRootId(){return c.rootId}getAutoSaveId(){return c.autosaveId}getTrashId(){return c.trashId}getTitle=e=>h.getById(e)?.item.name??"";getWorkspace(e){const t=function(n){for(let i=0;i<n.length;i++){const s=n[i],o=s.workspaces.find((t=>t.id===e));if(o)return o;if(s.children){const e=t(s.children);if(e)return e}}};return t(c.items)}getIsLoading(){return u.opening}getLoadWorkspaceId(e){return u.workspaceMap.get(e)}getLoadGroup(e,t){if(u.opening){let n="";if(u.groupIdMap.has(t)?n=u.groupIdMap.get(t)??"":(n=crypto.randomUUID(),u.groupIdMap.set(t,n)),u.groupNameMap.has(t)){const i=u.groupNameMap.get(t)?.name??"";u.groupNameMap.set(n,{windowId:e,name:i}),u.groupNameMap.delete(t)}return n}return""}getLoadGroupNameMap(){return u.groupNameMap}getLoadWorkspaceAsTabs(){return u.workspaceAsTabs}getLoadPersistentTabs(){return u.persistentTabs}dispatchAction(e){function t(e,t,n){const i=(e,t,n)=>{for(let s=0;s<e.length;s++)if(e[s].children){if(e[s].id===t)return n>e[s].children.length?void 0:{items:e[s].children,index:n,id:t};const o=i(e[s].children,t,n);if(o)return o}};return t===c.rootId?n>e.length?void 0:{items:e,index:n,id:t}:i(e,t,n)}const n=(e,t,n)=>{const i=(e,t,n)=>{for(let s=0;s<e.length;s++){if(e[s].id===t&&"node"===e[s].type)return n&&void 0===e[s].children?e[s].children=[]:n||void 0===e[s].children||delete e[s].children,!0;if(e[s].children){const o=i(e[s].children,t,n);if(o)return o}}return!1};return t===c.rootId?void 0:i(e,t,n)},i=e=>{e&&null===this.backupId?(this.backupSumTick=0,this.backupId=setTimeout(a,d)):null!==this.backupId&&(clearTimeout(this.backupId),this.backupSumTick=0,this.backupId=null)},s=e=>{this.sessionRecovery=e},a=()=>{this.backupSumTick+=d,this.backupSumTick>=36e5?(this.backupSumTick=0,h.emitChange({reason:"autosave"})):h.emitChange({reason:"backup"}),this.backupId=setTimeout(a,d)};switch(e.actionType){case"SESSION_INIT":c=(0,o.Uy)(c,(t=>{t.rootId=e.model.rootId,t.autosaveId=e.model.autosaveId,t.trashId=e.model.trashId,e.model.items.forEach((e=>{t.items.push(e)}))})),e.backup&&i(!0),h.emitChange({reason:"init"});break;case"SESSION_ADDED":{let i;c=(0,o.Uy)(c,(s=>{n(s.items,e.parentId,!0);const o=t(s.items,e.parentId,e.index);o&&(o.items.splice(o.index,0,e.item),i={index:o.index,item:o.items[o.index]})})),i&&h.emitChange({reason:"added",info:i,owner:e.owner});break}case"SESSION_CHANGED":{const n=h.getById(e.id);if(n){let i;c=(0,o.Uy)(c,(s=>{const o=t(s.items,n.item.parentId,n.index);if(o){const t={...e.item,content:o.items[o.index].content};o.items.splice(o.index,1,t),i={index:o.index,item:o.items[o.index]}}})),i&&h.emitChange({reason:"changed",info:i})}break}case"SESSION_CONTENT":const a=h.getById(e.id);if(a){let n;c=(0,o.Uy)(c,(i=>{const s=t(i.items,a.item.parentId,a.index);if(s){const t={...s.items[s.index],content:e.content};s.items.splice(s.index,1,t),n={index:s.index,item:s.items[s.index]}}})),n&&h.emitChange({reason:"content",info:n,owner:e.owner})}break;case"SESSION_DELETED":{const n=h.getById(e.id);if(n){let e;c=(0,o.Uy)(c,(i=>{const s=t(i.items,n.item.parentId,n.index);s&&(e={index:s.index,item:{...s.items[s.index]}},s.items.splice(s.index,1))})),e&&h.emitChange({reason:"deleted",info:e})}break}case"SESSION_MOVED":{const i=h.getById(e.id);if(i){let s;c=(0,o.Uy)(c,(o=>{n(o.items,e.parentId,!0);const a=t(o.items,i.item.parentId,i.index),r=t(o.items,e.parentId,e.index);r&&a&&(s={index:r.index,item:e.item},a.items.splice(a.index,1),r.items.splice(r.index,0,s.item),0===a.items.length&&n(o.items,i.item.parentId,!1))})),s&&h.emitChange({reason:"moved",info:s})}break}case"SESSION_SET_TIMED_BACKUP":i(e.backup);break;case"SESSION_SET_LOADING_PARAMETERS":u={opening:e.opening,workspaceAsTabs:e.workspaceAsTabs,persistentTabs:e.persistentTabs,workspaceMap:new Map(e.workspaceMap),groupIdMap:new Map,groupNameMap:new Map(e.groupNameMap)};break;case"SESSION_RECOVERY_DONE":s(!1);break;case"SESSION_RECOVERY_START":s(!0)}}}const h=new p(s.Z),g=h},37330:(e,t,n)=>{"use strict";n.d(t,{Z:()=>T});var i=n(65792),s=n.n(i),o=n(93197),a=n(96951),r=n(29087),l=n(24602),d=n(2699),c=n(9304),u=n(15489),p=n(25372),h=n(25356),g=n(89175),m=n(93513),f=n(44850);const v=new Map,y=[],b=new Set,S=["colorFg","colorBg","colorHighlightBg","colorAccentBg"];function w(e){if(e.preferSystemAccent&&s().valid(r.Z.get(g.kSystemAccentColor))){const t={...e};return t.colorHighlightBg=r.Z.get(g.kSystemAccentColor),c.ZP.createStyle(t)}return c.ZP.createStyle(e)}function C(e,t,n){const i=s().contrast(e,t)>n?50:0,o=e.get("lch.l")>5&&e.get("lch.l")<95?50:0;let a=e.get("lch.c")>10?50:0;return(e.get("lch.l")<20||e.get("lch.l")>75)&&(a=e.get("lch.c")>50?a:0),i+o+a}function A(e,t,n,i,r=!1){const l=s()(n.colorFg),d=s()(n.colorBg),c=function(e,t,n){let i;if(t.accentFromPage&&e){i=function(e,t){const n=t?.favIconUrl||"",i=t?.url||"";if(!t||b.has(i)||f.jk.isInternalPage(t)||n.startsWith("chrome://favicon/"))return s()(e.colorAccentBg);const o=e.accentSaturationLimit,a=new Map,r=y.find((e=>e.favIconUrl===n))||y.find((e=>i.includes(e.hostname))),l=v.get(t.id);l&&a.set(l,3),r?.colors.forEach(((e,t)=>{switch(t){case 0:a.set(e,2.25);break;case 1:a.set(e,1.5);break;case 2:a.set(e,1.25);break;default:a.set(e,1)}}));const d=[...a.keys()];a.size>2&&d[0].get("lch.c")<1&&d.forEach((e=>{e.get("lch.c")>1&&a.set(e,2)}));const c=s()(e.colorBg),u=[...a].sort(((t,n)=>C(n[0],c,e.contrast)*n[1]-C(t[0],c,e.contrast)*t[1]));return u.length>0&&o<1&&u[0][0].get("hsl.s")>o&&(u[0][0]=u[0][0].set("hsl.s",o)),u[0]&&u[0][0]||s()(e.colorAccentBg)}(t,n||a.ZP.getActivePage(e))}else i=s()(t.colorAccentBg);if(t.accentSaturationLimit<1){const e=i.get("hsl.s");i=i.set("hsl.s",e*t.accentSaturationLimit)}return i}(t,n,i),u=r&&c!==n.colorAccentBg,p={...o.ZP.accentOnly(c,l,d,n.contrast,u)};Object.keys(p).forEach((t=>{e[`--${t}`]=p[t].toString()}))}class I extends l.Z{getInitialState(){return{windowStyles:new Map,theme:{engineVersion:1,version:1,id:"Vivaldi1",url:"",name:"Vivaldi",accentFromPage:!0,accentOnWindow:!0,accentSaturationLimit:1,backgroundImage:"",backgroundPosition:"stretch",radius:4,colorAccentBg:"#ef3939",colorBg:"#f6f6f6",colorFg:"#222222",colorHighlightBg:"#4c70f0",colorWindowBg:"#EDEEF2",contrast:0,preferSystemAccent:!1,alpha:.92,blur:5,transparencyTabs:!1,transparencyTabBar:!1}}}getBaseStylesByWindowId=(e,t)=>{const n=this.getState().windowStyles.get(e)||c.ZP.getFallbackStyle();return n?this.getBaseStylesByStyle(n,t):{}};getReaderThemeColor(e){let t;switch(r.Z.get(g.kWebpagesReaderStyle).themeStyle){case"light":t="Vivaldi1";break;case"dark":t="Vivaldi2";break;default:t=void 0}return t?this.getBaseStylesByThemeId(t):this.getBaseStylesByWindowId(e)}getBaseStylesByThemeId=(e,t)=>{const n=c.ZP.getTheme(e),i=n?c.ZP.createStyle(n):null;return i?this.getBaseStylesByStyle(i,t):{}};getBaseStylesByStyle=(e,t)=>{const n=t&&t.length>0?t:S,i={};for(const[t,s]of Object.entries(e))n.includes(t.replace("--",""))&&s&&(i[t]=s);return t?.includes("backgroundBlur")&&void 0===i["--backgroundBlur"]&&(i["--backgroundBlur"]="none"),i};getThemeImageSet=e=>{if(e){const t=c.ZP.getTheme(e)?.buttons;if(t)return t}return this.getState().theme.buttons};getToolbarButtonImage=e=>{if(!r.Z.get(g.kThemesPreferCustomButtons))return null;const t=r.Z.get(g.kThemesPreview)[0]?"":r.Z.get(g.kThemesCurrentButtons),n=this.getThemeImageSet(t);return n&&n[e]?"string"==typeof n[e]?n[e]:n[e].large:null};hasDarkBackground=e=>{const t=this.getBaseStylesByWindowId(e,["colorBg"]);return c.ZP.isThemeDark(t)};reduce(e,t){if("THEME_WINDOW_CREATED"===t.actionType)return(0,m.Uy)(e,(n=>{const{windowId:i}=t,{theme:s}=e,o=w(s);Object.assign(o,t.style),A(o,i,s),n.windowStyles.set(i,o)}));if("WINDOW_CLOSED"===t.actionType)return(0,m.Uy)(e,(e=>{e.windowStyles.delete(t.windowId)}));if("THEME_SET"===t.actionType)return(0,m.Uy)(e,(e=>{const{theme:n,init:i}=t;e.theme=n,i&&(e.windowStyles=new Map(Array.from(u.ZP.getState()).map((([e])=>[e,{}]))));const s=w(n);e.windowStyles.forEach(((e,i)=>{Object.assign(e,s),Object.keys(e).forEach((t=>{s.hasOwnProperty(t)||delete e[t]})),Object.assign(e,t.style),A(e,i,n)}))}));if("PAGE_OPEN"===t.actionType||"PAGE_OPEN_URL"===t.actionType||"NAVIGATION_SET_STATE"===t.actionType){const{windowId:n,pageId:i}=t,s=a.ZP.getPageById(i);return s?.active?(0,m.Uy)(e,(t=>{const{theme:i}=e,o=t.windowStyles.get(n);if(o&&s){const e=i.accentFromPage&&i.accentOnWindow;A(o,n,i,s,e)}})):e}if("THEME_SET_META"===t.actionType)return v.get(t.tabId)?.hex()!==t.color.hex()&&v.set(t.tabId,t.color),(0,m.Uy)(e,(t=>{t.windowStyles.forEach(((t,n)=>{const{theme:i}=e;A(t,n,i,null,!0)}))}));if("THEME_SET_FAILED_FAVICON_URL"===t.actionType)return b.has(t.url)||b.add(t.url),(0,m.Uy)(e,(t=>{t.windowStyles.forEach(((t,n)=>{const{theme:i}=e;A(t,n,i)}))}));if("THEME_SET_PAGE_PALETTE"===t.actionType){const{windowId:n,favIconUrl:i,hostname:s,colors:o}=t;return y.push({favIconUrl:i,hostname:s,colors:o}),(0,m.Uy)(e,(t=>{const i=t.windowStyles.get(n),{theme:s}=e;i&&A(i,n,s,null,!0)}))}if("CHROME_TABS_CREATE"===t.actionType||"CHROME_TABS_UPDATED"===t.actionType){const n="CHROME_TABS_CREATE"===t.actionType?t.page:a.ZP.getPageById(t.tabId),i=n?.windowId,s=n?.favIconUrl,o=n?.url,r=Boolean(s&&!s.startsWith("chrome://favicon/")&&y.find((e=>e.favIconUrl===s)));if(!Boolean(!n||!o||b.has(o)||f.jk.isInternalPage(n)||r||n.incognito)&&n&&o){const t=(0,p.Z)((0,h.Z)(o))?.hostname;if(t&&i&&s){if(y.find((e=>e.hostname===t)))return d.Z.loadFavicon(n,t),(0,m.Uy)(e,(t=>{const n=t.windowStyles.get(i),{theme:s}=e;n&&A(n,i,s)}));d.Z.loadFavicon(n,t)}}}return"ZOOM_SET_UI"===t.actionType?(0,m.Uy)(e,(e=>{e.windowStyles.forEach(((n,i)=>{n["--uiZoomLevel"]=t.zoomData,e.windowStyles.set(i,n)}))})):e}}const T=new I},97297:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var i=n(24602);class s extends i.Z{getInitialState(){return""}reduce(e,t){switch(t.actionType){case"TOOLBAR_EDIT_MODE":return t.toolbar;case"TOOLBAR_STOP_EDIT_MODE":return"";default:return e}}}const o=new s},85374:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>l});var i=n(24602),s=n(48588);const o=Object.freeze({pageLanguage:"",translateStep:"idle"});class a extends i.Z{getInitialState(){return new Map}getPageState(e){return this.getState().get(e)??o}reduce(e,t){switch(t.actionType){case"VIVALDI_TABS_LANGUAGE_DETERMINED":{const{tabId:n,pageLanguage:i}=t;return r(e,n,{pageLanguage:i})}case"VIVALDI_TABS_PAGE_TRANSLATED":{const{tabId:n}=t;let{isTranslated:i,originalLang:s,translatedLang:o,error:a}=t.message;return i&&"no_error"!==a&&(i=!1),r(e,n,{isTranslated:i,originalLang:s,translatedLang:o,error:a})}case"PAGE_CLOSE":{const n=t.pages;return n.some((t=>e.has(t.id)))&&(e=new Map(e),n.forEach((t=>e.delete(t.id)))),e}case"PAGE_RESET_TRANSLATION_PARAMETERS":return(0,s.u4)(e,t.tabId);case"VIVALDI_TABS_PAGE_TRANSLATED_REVERT":{const{tabId:n}=t;return r(e,n,{isTranslated:!1})}case"VIVALDI_TABS_TRANSLATION_PROGRESS":{const{tabId:n,translateStep:i,error:s,autoTranslate:o}=t;return r(e,n,{translateStep:i,error:s,autoTranslate:o})}default:return e}}}function r(e,t,n){return(0,s.cR)(e,t,(e=>{Object.assign(e,n)}),o)}const l=new a},63365:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(65398),s=n(33638);class o extends i.Z{_trash=[];getTrash(){return this._trash}dispatchAction(e){if("CHROME_SET_SESSION"===e.actionType)this._trash=e.session,this.emitChange()}}const a=new o(s.Z)},57904:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var i=n(65398),s=n(33638);const o={},a={};class r extends i.Z{isFindInPageOpen(e){return!0===o[e]}getFindResultsForPage(e){let t=a[e];return void 0===t&&(t={activeMatchOrdinal:0,numberOfMatches:0,searchText:"",canceled:!1,matchCase:!1,isFindInPageToolbarOpen:!1,selectionRect:{left:0,top:0,width:0,height:0}}),t.isFindInPageToolbarOpen=!0===o[e],t}dispatchAction(e){switch(e.actionType){case"WEBPAGEVIEW_ACTIONS":switch(e.subAction){case"findInPage":o[e.pageId]=!0,this.emitChange({type:"WEBPAGEVIEW_ACTIONS",action:"findInPage",winId:e.windowId,pageId:e.pageId});break;case"findNextInPage":case"findPreviousInPage":{const{subAction:t}=e;!0!==o[e.pageId]&&(o[e.pageId]=!0,this.emitChange({type:"WEBPAGEVIEW_ACTIONS",action:"findInPage",winId:e.windowId,pageId:e.pageId})),this.emitChange({type:"WEBPAGEVIEW_ACTIONS",action:t,winId:e.windowId,pageId:e.pageId});break}case"addBookmark":case"focusAddressField":case"pageScrollBottom":case"pageScrollDown":case"pageScrollTop":case"pageScrollUp":case"print":this.emitChange({type:"WEBPAGEVIEW_ACTIONS",action:e.subAction,winId:e.windowId,pageId:e.pageId});break;case"focusSearchField":this.emitChange({type:"WEBPAGEVIEW_URLFIELD_BLUR",winId:e.windowId}),this.emitChange({type:"WEBPAGEVIEW_ACTIONS",action:"focusSearchField",winId:e.windowId,pageId:e.pageId});break;case"focusWebView":this.emitChange({type:"WEBPAGEVIEW_URLFIELD_BLUR",winId:e.windowId}),this.emitChange({type:"WEBPAGEVIEW_ACTIONS",action:"focusWebView",winId:e.windowId,pageId:e.pageId});break;case"searchPasteAndGo":case"urlPasteAndGo":case"qcPasteAndGo":e.payload&&this.emitChange({type:"WEBPAGEVIEW_ACTIONS",action:e.subAction,winId:e.windowId,pageId:e.pageId,payload:e.payload})}break;case"WEBPAGEVIEW_BACK":case"WEBPAGEVIEW_FORWARD":case"WEBPAGEVIEW_STOP":this.emitChange({type:e.actionType,winId:e.windowId,pageId:e.pageId});break;case"WEBPAGEVIEW_CLOSE_FIND_IN_PAGE":o[e.pageId]&&(o[e.pageId]=!1,this.emitChange({type:"WEBPAGEVIEW_CLOSE_FIND_IN_PAGE",winId:e.windowId,pageId:e.pageId}));break;case"WEBPAGEVIEW_GET_HISTORY":this.emitChange({type:"WEBPAGEVIEW_GET_HISTORY",winId:e.windowId,pageId:e.pageId,callback:e.callback});break;case"WEBPAGEVIEW_GO":this.emitChange({type:"WEBPAGEVIEW_GO",winId:e.windowId,pageId:e.pageId,index:e.index});break;case"WEBPAGEVIEW_RELOAD":this.emitChange({type:e.actionType,winId:e.windowId,pageId:e.pageId,bypassCache:e.bypassCache});break;case"WEBPAGEVIEW_RESULTS_FROM_FIND_IN_PAGE":o[e.pageId]&&(a[e.pageId]={...e.results,matchCase:e.matchCase,searchText:e.searchText,isFindInPageToolbarOpen:!1},this.emitChange({type:"WEBPAGEVIEW_RESULTS_FROM_FIND_IN_PAGE",winId:e.windowId,pageId:e.pageId}));break;case"MAIN_SHOW_QUICKCOMMANDS":case"PANEL_SET_FOCUS":this.emitChange({type:"WEBPAGEVIEW_URLFIELD_BLUR",winId:e.winId})}}}const l=new r(s.Z)},15489:(e,t,n)=>{"use strict";n.d(t,{Ex:()=>c,TF:()=>p,WV:()=>v,ZP:()=>f});var i=n(29087),s=n(24602),o=n(33638),a=n(34540),r=(n(7064),n(89175)),l=n(48588),d=n(93513);n(38768);const c=-1,u=[];function p(e){if(!e)return!1;const{state:t,minimalUI:n}=e;return n||"fullscreen"===t}class h extends s.Z{settingsCategory="general&";getInitialState(){return new Map}_updateUIState(e,t){const n=p(this.getState().get(e)),s=p(t);n&&!s?t.visibleUI=this.getUIFromPrefs():!n&&s&&(t.visibleUI={bookmarksBar:!1,addressBar:!1,panelToggle:!1,tabs:!1,statusBar:i.Z.get(r.kStatusBarMinimized)}),this.ensureControlButtonsInProperPosition(e,t)}reduce(e,t){switch(t.actionType){case"WINDOW_SET_STATE":return(0,d.Uy)(e,(e=>{const{windowId:n,windowState:i}=t;e.set(n,i),this.ensureControlButtonsInProperPosition(n,i)}));case"WINDOW_CLOSED":return(0,l.u4)(e,t.windowId);case"WINDOW_UPDATE_FROM_PREFS":{const{windowId:n}=t,i=e.get(t.windowId);return p(i)?(i&&this.ensureControlButtonsInProperPosition(n,i),e):(0,l.cR)(e,n,(e=>{e.visibleUI=this.getUIFromPrefs(),this.ensureControlButtonsInProperPosition(n,e)}))}case"WINDOW_ACTIVATED":{const{windowId:n,activated:i}=t;i&&this.initializingWindowId&&(this.initializingWindowId=void 0);const s=e.get(n);return s&&s.active!==i?new Map(e).set(n,{...s,active:i}):e}case"WINDOW_STATE_CHANGED":return(0,l.cR)(e,t.windowId,(e=>{const{windowId:n,change:i}=t;"fullscreen"===e.state&&"fullscreen"!==i&&(e.html5FullScreen=!1),e.state&&"fullscreen"!==e.state&&"fullscreen"===i&&(e.restoreStateFullscreen=e.state),e.state=i,this._updateUIState(n,e)}));case"WINDOW_HTML5_FULL_SCREEN":return(0,l.cR)(e,t.windowId,(e=>{const{windowId:n,html5FullScreen:i}=t;i?(e.restoreStateHtml5Fullscreen=e.state?e.state:"normal",e.state="fullscreen"):e.state=e.restoreStateHtml5Fullscreen,e.html5FullScreen=i,this._updateUIState(n,e)}));case"WINDOW_MINIMAL_UI":return(0,l.cR)(e,t.windowId,(e=>{e.minimalUI=t.minimalUI,this._updateUIState(t.windowId,e)}));case"WINDOW_TOGGLE_BOOKMARKS_BAR":return p(e.get(t.windowId))?(0,l.cR)(e,t.windowId,(e=>{e.visibleUI.bookmarksBar=!e.visibleUI.bookmarksBar,this.ensureControlButtonsInProperPosition(t.windowId,e)})):(console.warn("Attempting to toggle toolbars for a window without minimal UI"),e);case"WINDOW_TOGGLE_ADDRESS_BAR":return p(e.get(t.windowId))?(0,l.cR)(e,t.windowId,(e=>{e.visibleUI.addressBar=!e.visibleUI.addressBar,this.ensureControlButtonsInProperPosition(t.windowId,e)})):(console.warn("Attempting to toggle toolbars for a window without minimal UI"),e);case"WINDOW_TOGGLE_TABS":return p(e.get(t.windowId))?(0,l.cR)(e,t.windowId,(e=>{e.visibleUI.tabs=!e.visibleUI.tabs,this.ensureControlButtonsInProperPosition(t.windowId,e)})):(console.warn("Attempting to toggle toolbars for a window without minimal UI"),e);case"WINDOW_TOGGLE_PANEL_TOGGLE":return p(e.get(t.windowId))?(0,l.cR)(e,t.windowId,(e=>{e.visibleUI.panelToggle=!e.visibleUI.panelToggle})):(console.warn("Attempting to toggle toolbars for a window without minimal UI"),e);case"WINDOW_TOGGLE_STATUS_BAR":return p(e.get(t.windowId))?(0,l.cR)(e,t.windowId,(e=>{e.visibleUI.statusBar="on"===e.visibleUI.statusBar?i.Z.get(r.kStatusBarMinimized):"on"})):(console.warn("Attempting to toggle toolbars for a window without minimal UI"),e);case"WINDOW_SET_INERT":const n=t.inert||!1;return(0,l.cR)(e,t.windowId,(e=>{e.inert=n}))}return e}getWindowState(e){return this.getState().get(e)}getActiveWindowId(){for(const[e,t]of this.getState())if(t.active)return e;return c}getIds(e){const t=[];for(const[n,i]of this.getState())i.type===e&&t.push(n);return t}getLastActiveBrowserWindowId(){return 0===u.length?c:u[0]}isFullscreen(e){return"fullscreen"===this.getState().get(e)?.state}isHTML5Fullscreen(e){return this.getState().get(e)?.html5FullScreen||!1}isIncognito(e){return this.getState().get(e)?.incognito||!1}isMaximized(e){return"maximized"===this.getState().get(e)?.state}isMinimized(e){return"minimized"===this.getState().get(e)?.state}isActive(e){return this.getState().get(e)?.active||!1}isInert(e){return this.getState().get(e)?.inert||!1}isPopup(e){return"popup"===this.getState().get(e)?.type}isSettings(e){return"settings"===this.getState().get(e)?.type}isTabbedBrowser(e){return"normal"===this.getState().get(e)?.type}isMinimalUI(e){return p(this.getState().get(e))}getMailWindowId(){let e=c;for(const[t]of this.getState())(e===c||t<e)&&this.isTabbedBrowser(t)&&!this.isIncognitoOrGuest(t)&&(e=t);return e}isMail(e){return this.getMailWindowId()===e}isGuest(){if(void 0===window.isGuestSession)throw new Error("WindowStore.isGuest() called before guest information has been set up");return window.isGuestSession}getVisibleUI(e){const t=this.getState().get(e);return t?t.visibleUI:this.getUIFromPrefs()}isIncognitoOrGuest(e){return this.isIncognito(e)||this.isGuest()}getRestoreStateFullscreen(e){const t=this.getState().get(e);if(!t)throw new Error("WindowStore.getRestoreStateFullscreen: Expected a valid windowId");return t.restoreStateFullscreen}getRestoreStateHtml5Fullscreen(e){const t=this.getState().get(e);if(!t)throw new Error("WindowStore.getRestoreStateHtml5Fullscreen: Expected a valid windowId");return t.restoreStateHtml5Fullscreen}getUIFromPrefs(){return{bookmarksBar:i.Z.get(r.kBookmarksBarVisible),addressBar:i.Z.get(r.kAddressBarVisible),panelToggle:i.Z.get(r.kPanelsShowToggle),tabs:i.Z.get(r.kTabsVisible),statusBar:i.Z.get(r.kStatusBarDisplay)}}ensureControlButtonsInProperPosition(e,t){}}const g=new h(o.Z),m={_oldState:g.getState(),updateLastActiveBrowserWindowStack(e){m.removeFromLastActiveBrowserWindowStack(e),g.isTabbedBrowser(e)&&u.unshift(e)},removeFromLastActiveBrowserWindowStack(e){const t=u.indexOf(e);-1!==t&&u.splice(t,1)},recordState(){const e=m._oldState,t=g.getState();m._oldState=t;for(const[n]of e)t.has(n)||m.removeFromLastActiveBrowserWindowStack(n);for(const[n,i]of t){const t=e.get(n);(i.active&&!t?.active||0===u.length)&&m.updateLastActiveBrowserWindowStack(n),i.html5FullScreen||t&&i!==t&&(p(t)===p(i)&&("fullscreen"===t.state&&"fullscreen"===i.state||"fullscreen"!==t.state&&"fullscreen"!==i.state)&&t.visibleUI===i.visibleUI||(0,a.Z)(n,{minimalUI:i.minimalUI,fullScreen:"fullscreen"===i.state,visibleUI:i.visibleUI}))}}};g.addListener(m.recordState.bind(m));const f=g;function v(e){return e.html5FullScreen?"fullscreen inner":"fullscreen"===e.state?"fullscreen":"maximized"===e.state?"maximized":"normal"}},92:(e,t,n)=>{"use strict";n.d(t,{Z:()=>d});var i=n(68247),s=n(29087),o=n(24602),a=n(89175),r=n(93513);class l extends o.Z{getInitialState(){return[]}getRules(){return this.getState()}getRuleById(e){return this.getState().find((t=>t.id===e))}getWorkspaceRules(e){return this.getState().filter((t=>t.workspaceId===e))}reduce(e,t){switch(t.actionType){case"WORKSPACE_LINK_ROUTES_INIT":return t.rules;case"CREATE_WORKSPACE_LINK_ROUTE":{const n=(0,r.Uy)(e,(e=>{e.push({id:t.id,type:t.type,expression:t.expression,workspaceId:t.workspaceId})}));return i.Z.set(a.kWorkspacesLinkRoutes,n),n}case"REMOVE_WORKSPACE_LINK_ROUTES":{const{ids:n}=t,s=e.filter((e=>!n.includes(e.id)));return i.Z.set(a.kWorkspacesLinkRoutes,s),s}case"UPDATE_WORKSPACE_LINK_ROUTE":{const n=(0,r.Uy)(e,(e=>{const n=e.findIndex((e=>e.id===t.id));n>-1&&e.splice(n,1,{id:t.id,type:t.type,expression:t.expression,workspaceId:t.workspaceId})}));return i.Z.set(a.kWorkspacesLinkRoutes,n),n}case"CREATE_WORKSPACE":{const n=(0,r.Uy)(e,(e=>{for(let n=0;n<e.length;n++)void 0===e[n].workspaceId&&(e[n].workspaceId=t.id)}));return i.Z.set(a.kWorkspacesLinkRoutes,n),n}case"REORDER_WORKSPACE_LINK_ROUTES":{const n=t.ids.map((t=>e.find((e=>e.id===t)))).filter(Boolean);return n.length===e.length?(i.Z.set(a.kWorkspacesLinkRoutes,n),n):(console.error("Sanity check failed after reordering workspace rules."),e)}case"UPDATE_LINK_ROUTES_FROM_PREFS":return s.Z.get(a.kWorkspacesLinkRoutes)}return e}}const d=new l},53454:(e,t,n)=>{"use strict";n.d(t,{S:()=>l,Z:()=>c});var i=n(96951),s=n(24602),o=n(69046),a=n(86088),r=n(93513);const l=[a.xwB,a.T6H,a.Gyd,a.eTI,a.Bi0,a.S0Y,a.efb,a.XyR,a.gYX,a.b_H,a.$6R,a.o_8,a.V3h,a.LXK,a.rR8,a.onV,a.XkM,a.IrQ,a.mhq,a.BmN];class d extends s.Z{getInitialState(){return[]}getWorkspaceById(e){return this.getState().find((t=>t.id===e))}getWindowId(e){return i.ZP.getWorkspacePages(e).first()?.windowId}getWorkspacePageCounts(){const e=this.getState(),t=new Map(e.map((e=>[e.id,0])));for(const[,e]of i.ZP.getState())e.list.groupBy(o.cm).forEach(((e,n)=>{n&&t.set(n,e.size)}));return t}getDefaultIcon(){return a.BmN}reduce(e,t){switch(t.actionType){case"WORKSPACES_INIT":return t.workspaces;case"CREATE_WORKSPACE":return(0,r.Uy)(e,(e=>{e.push({id:t.id,name:t.name,icon:t.icon,emoji:t.emoji})}));case"SET_WORKSPACE_NAME":return(0,r.Uy)(e,(e=>{const n=e.findIndex((e=>e.id===t.id));n>-1&&(e[n]={...e[n],name:t.name})}));case"REMOVE_WORKSPACE":return(0,r.Uy)(e,(e=>{const n=e.findIndex((e=>e.id===t.id));n>-1&&e.splice(n,1)}));case"SET_WORKSPACE_ICON":return(0,r.Uy)(e,(e=>{const n=e.findIndex((e=>e.id===t.id));n>-1&&(e[n]={...e[n],icon:l[t.icon],iconId:t.icon,emoji:void 0})}));case"SET_WORKSPACE_EMOJI":return(0,r.Uy)(e,(e=>{const n=e.findIndex((e=>e.id===t.id));n>-1&&(e[n]={...e[n],emoji:t.emoji})}));case"REORDER_WORKSPACES":{const n=t.ids.map((t=>e.find((e=>e.id===t)))).filter(Boolean);return n.length===e.length?n:e}}return e}}const c=new d},47825:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(24602),s=n(71828);class o extends i.Z{getInitialState(){return{zoom:s.rM,defaultPageZoom:s.rM,uiZoom:s.an,notesZoom:s.rM}}getZoom(){return this.getState().zoom}getDefaultPageZoom(){return this.getState().defaultPageZoom}getUIZoom(){return this.getState().uiZoom}getNotesZoom(){return this.getState().notesZoom}reduce(e,t){switch(t.actionType){case"ZOOM_PAGE":return{...e,zoom:t.zoomData};case"ZOOM_NOTES":return{...e,notesZoom:t.zoomData};case"ZOOM_SET_UI":return{...e,uiZoom:t.zoomData};case"ZOOM_PAGE_DEFAULT":return{...e,defaultPageZoom:t.zoomData}}return e}}const a=new o},44147:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var i=n(27770),s=n(48603),o=n(59486),a=n(46382),r=n(96951),l=n(60331),d=n(44850);const c={onAction:function(e,t){const n=function(e,t){s.Z.copy(t,[e])},i=function(e,t){s.Z.cut(t,[e])},l=function(e,t){s.Z.paste(t,e,!0)},d=o.Z.getItemById(t.id);if(d){const c=void 0!==d.index?d.index+1:-1;switch(t.command){case"addactivetab":{const t=r.ZP.getActivePage(e);t&&(o.Z.isFolder(d)?s.Z.bookmarkPageInFolder(t,d.id):s.Z.bookmarkPageInFolder(t,d.parentId||"",c));break}case"edit":a.Z.showBookmarkDialog(e,{mode:t.command,id:t.id,index:-1});break;case"addfolder":case"addbookmark":a.Z.showBookmarkDialog(e,{mode:t.command,id:t.id,index:c});break;case"addseparator":o.Z.isFolder(d)?s.Z.createSeparator(t.id,d.children?d.children.length:0):d.parentId&&s.Z.createSeparator(d.parentId,c);break;case"cut":const u=i.bind(null,t.id);document.addEventListener("cut",u),document.execCommand("cut"),document.removeEventListener("cut",u);break;case"copy":const p=n.bind(null,t.id);document.addEventListener("copy",p),document.execCommand("copy"),document.removeEventListener("copy",p);break;case"paste":const h=l.bind(null,t.id);document.addEventListener("paste",h),document.execCommand("paste"),document.removeEventListener("paste",h)}}},onHover:function(e,t){l.Z.setStatus(e,0===t.length?"":d.jk.getHoverUrl(o.Z.filterUrl(t)))},onOpen:function(e,t){const n=o.Z.getItemById(t.id);if(n){const s=i.ZP.getOpenOptionsFromDisposition(e,t.disposition,t.background,i.ZP.makeEventFlagsFromApiResponse(t.state));i.ZP.open(e,i.ZP.getBookmarksByNode(n),s,!0)}}}},57082:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var i=n(34155);const s=Array();function o(e,t){-1===s.findIndex((n=>n.name===e&&n.callback===t))&&s.push({name:e,callback:t})}function a(e,t){const n=s.findIndex((n=>n.name===e&&n.callback===t));-1!==n&&s.splice(n,1)}const r={onCommand:function(e,t){i.nextTick((()=>{s.forEach((n=>{n.name===t&&n.callback(e,t)}))}))},hasListener:function(e){return s.filter((t=>t.name===e)).length>0},addListener:o,addListeners:function(e,t){for(const n of e)o(n,t)},removeListener:a,removeListeners:function(e,t){for(const n of e)a(n,t)}}},84451:(e,t,n)=>{"use strict";n.d(t,{Z:()=>T});var i=n(45502),s=n(96951),o=n(29087),a=n(15489),r=n(49550),l=n(7064),d=n(89175);const c=!1;let u="off";let p=[];var h=["f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11","f12","f13","f14","f15","f16","f17","f18","f19"],g={delete:"del",option:"alt",command:"meta",return:"enter",escape:"esc",comma:",",period:".",del:"del",mod:"ctrl"},m=["left","right","shift+left","shift+right","shift+up","shift+down","enter","shift+enter"];m=m.concat(["ctrl+a","ctrl+z","ctrl+y","ctrl+u","ctrl+left","ctrl+right","ctrl+backspace","ctrl+delete","ctrl+home","ctrl+end","ctrl+shift+left","ctrl+shift+right","shift+home","shift+end"]);const f={};function v(e){var t=e.split("+");t=t.map((e=>g[e]||e));var n="";function i(e){t.indexOf(e)>-1&&(n+=e+"+",t.splice(t.indexOf(e),1))}return i("ctrl"),i("alt"),i("shift"),i("meta"),t.sort(),t.forEach(((e,i)=>{n+=e,i+1<t.length&&(n+="+")})),n.toLowerCase()}function y(e){return{ctrlKey:-1!==e.indexOf("ctrl"),altKey:-1!==e.indexOf("alt"),metaKey:-1!==e.indexOf("meta"),shiftKey:-1!==e.indexOf("shift"),key:e.split("+").pop()}}function b(e,t,n,i){i({origin:"shortcut",context:e,windowId:t,keyState:n})}function S(e){return 1===e.length||e.startsWith("numpad")}function w(e){var t=y(e),n=e.split("+").pop();if(-1!==m.indexOf(e))return!1;if("esc"===n||"down"===n||"up"===n||"home"===n||"end"===n||"pagedown"===n||"pageup"===n)return!0;if(h.indexOf(n)>-1)return!0;if(t.ctrlKey||t.altKey||t.shiftKey||t.metaKey){if("backspace"===n||"del"===n)return!0;if(t.ctrlKey||t.metaKey||t.altKey)return!0}return!1}const C=["INPUT","FRAME","IFRAME","SELECT","TEXTAREA"],A=["submit","button","reset","radio","checkbox"],I=["chrome://game/","docs.google.com"];const T={bind:function(e,t,n){const{autoRepeat:i,isFeatureShortcut:s,isEnabled:o,feature:a,tweakedShortcut:r}=n??{};return[].concat(e).filter(Boolean).map((e=>e.trim())).forEach((e=>function(e,t,n,i,s,o,a){const r=v(e),l=f[r]||[];l.push({callback:i,onAutoRepeat:Boolean(t),isFeatureShortcut:Boolean(n),isEnabled:s||(e=>!0),feature:o||"browser",tweakedShortcut:a}),f[r]=l}(e,i,s,t,o,a,r))),this},unbind:function(e,t){return[].concat(e).forEach((e=>function(e,t){if(e){const n=v(e);f[n]&&(t?f[n]=f[n].filter((e=>e.callback!==t)):delete f[n])}}(e,t))),this},keyComboFromEvent:function(e){if(!(["Alt","Shift","Control","Meta","CapsLock","NumLock","AltGraph"].indexOf(e.key)>-1)&&"keydown"===e.type){const t=function(e){if(e.code.startsWith("Numpad")){var t=r.Z[e.keyCode].substr(6);if(t>="0"&&t<="9")return e.code}return r.Z[e.keyCode]}(e);if("None"===t)return"";{let n=function(e){var t="";return e.metaKey&&(t+="meta+"),e.altKey&&(t+="alt+"),e.ctrlKey&&(t+="ctrl+"),e.shiftKey&&(t+="shift+"),t}(e);return n+=t,v(n.toLowerCase())}}return""},shortcutAllowedInText:w,isSingleKeyShortcut:S,setDevToolsDockingState:function(e){u=e},handleShortcut:function(e,t,r,u,p){const h=e.vivaldiWindowId;let g=t.toLowerCase().replace(" ","");g.endsWith("arrow")&&(g=g.substring(0,g.length-5)),g=v(g);const m=i.Z.getContext(h).feature,T=function(e,t){const n=f[e];if(n?.length)return n.reduce(((e,n)=>e||"browser"!==n.feature?n.feature===t?n:e:n),null)}(g,m);if(T){if(!T.isEnabled(h))return;if(!0===r&&!1===T.onAutoRepeat)return;c,async function(e,t,r,c,u,p){const h=e.vivaldiWindowId;if(S(r)){if(c){if(!o.Z.get(d.kKeyboardShortcutsEnableSingleKeyForMail))return;if("browser"===i.Z.getContext(h).feature)return}else if(!o.Z.get(d.kKeyboardShortcutsEnableSingleKey))return;const e=s.ZP.getActivePage(h);if(e)for(const t of I)if(e.url.includes(t))return}if(a.ZP.isSettings(h)&&!n(25795).Z.isShortcutAccepted(h,r))return;if(!o.Z.get(d.kKeyboardShortcutsEnable)){const e=(await n(25795).Z.getAllCommands(h)).find((e=>"COMMAND_PAGE_DISABLE_KEYBOARD_SHORTCUTS"===e.name));if(!e)return;const t=n(25795).Z.getCommandConfiguration(e.name);if(!Array.isArray(t.shortcuts)||!t.shortcuts.some((e=>e===r)))return}const g=u?u.tagName:"",m=u instanceof e.HTMLInputElement?u.type:"",f=!!u&&u.isContentEditable;C.includes(g)&&!A.includes(m)||f?w(r)&&b(e,h,y(r),t):"WEBVIEW"===g?l.Z.windowPrivate.getFocusedElementInfo(h).then((({tagName:n,editable:i,role:s})=>{if(!i||w(r)){const i="SELECT"===n,o="SPAN"===n&&"spinbutton"===s;(!i&&!o||i&&w(r))&&b(e,h,y(r),t)}})):b(e,h,y(r),t)}(e,T.callback,g,T.isFeatureShortcut,p)}},setBlockedShortcuts:function(e){p=e}}},5198:(e,t,n)=>{"use strict";n.d(t,{Z:()=>m,k:()=>p});var i=n(9761),s=n(19789),o=n(68247),a=n(29087),r=n(85374),l=n(56371),d=n(7064),c=n(36436),u=n(89175);const p=2e3;let h=[];const g={canTranslateText:(e,t="",n=-1)=>!(n>=0&&!a.Z.get(u.kPanelsTranslateRedirect)&&!g.canTranslatePage(n,!0))&&(e.length>0&&!(0,c.xl)(t)),canTranslatePage(e,t=!1){const n=r.ZP.getPageState(e);return t?Boolean(n.pageLanguage):Boolean(n.pageLanguage)&&!n.isTranslated},getTranslationCode:(e=s.ZP.UI_LANGUAGE)=>i.YI[e]||e,getTargetTranslationCode:()=>a.Z.get(u.kTranslateTargetLanguage)||g.getTranslationCode(),setTargetTranslationCode(e){o.Z.set(u.kTranslateTargetLanguage,e)},getTranslationLocales(){if(!h.length){const e=a.Z.get(u.kVivaldiTranslateLanguageList);h=e.map((e=>{"es-ES"===(e=i.jq[e]??e)&&(e="es");let t=i.lE.find((t=>t.key===e));return t||(t=i.sK.find((t=>t.key===e))),t})).filter(Boolean).sort(((e,t)=>e.value.localeCompare(t.value)))}return h},getHumanReadableLanguageFromCode(e){const t=g.getTranslationLocales().find((t=>{const n=g.getTranslationCode(t.key);return t.key===e||n===e}));return t?t.value:(0,l.Z)("Unknown ($1)",[e])},async detectTextLanguage(e,t){let n=await d.Z.tabsPrivate.determineTextLanguage(e,t);return"und"===n&&(n=""),n}},m=g},76747:(e,t,n)=>{"use strict";n.d(t,{Z:()=>T});var i=n(25795),s=n(45502),o=n(84451),a=n(29087),r=n(56371),l=n(7064),d=n(13302),c=n(89175);let u,p="";function h(){return(0,r.Z)("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefhiklmnorstuvwxz")}function g(){return void 0===u&&(u=["zh-CN","zh-TW","ja","ko"].indexOf(p)>-1),u}function m(e){const t=e.indexOf("&");if(-1===t||" "===e[t+1])return-1===t?-1:-2;if("&"!==e[t+1])return t;let n=1;for(let i=t+1;i<e.length&&"&"===e[i];i++)n++;return n%2==0?-1:t}function f(e,t,n,i,s){let o=0;for(;-1!==o;){const s=t.charAt(o),a=s.toUpperCase();if(-1!==i.indexOf(s)&&-1===e.indexOf(a)&&(0!==o&&!0!==n||s===a))return o;o=t.indexOf(" ",o+1),-1!==o&&o++}for(let n=0;n<t.length;n++){const s=t.charAt(n);if(-1!==i.indexOf(s)&&-1===e.indexOf(s.toUpperCase()))return n}return s?-1:f("",t,n,i,!0)}function v(e){return!!s.Z.isBrowserFeature(e.feature)||!e.commandName}function y(){return{enabled:a.Z.get(c.kKeyboardShortcutsEnable),singleKey:a.Z.get(c.kKeyboardShortcutsEnableSingleKey),mailSingleKey:a.Z.get(c.kKeyboardShortcutsEnableSingleKeyForMail)}}function b(e,t){const{shortcuts:n}=e;if(t.enabled&&n&&!1!==e.showshortcut)for(let i=0;i<n.length;i++){const s=n[i];let a=!1;if(o.Z.isSingleKeyShortcut(s)){if(v(e)){if(!1===t.singleKey)continue}else if(!1===t.mailSingleKey)continue;a=!0}if(0!==s.length)return{value:(0,d.G)(s),singleKey:a}}return{value:"",singleKey:!1}}function S(e){return"separator"===e.type}function w(e){return"folder"===e.type}function C(e){return{label:e,labelEnglish:e}}function A(){return(0,r.Z)("...")}const I={commandItem:{type:"command",label:"",labelEnglish:""},ellipsisString:A,hasBrowserFeature:v,formatShortcut:function(e,t){return b({commandName:e,shortcuts:t,...C("")},y()).value},getDisplayName:function(e){if(S(e))return"";let t=e.labelWithMnemonic||e.label||"";return e.emphasized&&(t=`• ${t}`),e.ellipsis?t+A():t},getMenuBarString:function(e,t){if(!e.label)return{name:"",offset:-1};let n=e.label;const i=void 0===t.offset?-1:t.offset,s=m(n);if(s>=0&&(n=n.substring(0,s)+n.substring(s+1)),g()&&-1!==i){let t=e.labelEnglish;const s=m(t);s>=0&&(t=t.substring(0,s)+t.substring(s+1)),n=n+" ("+t.charAt(i).toUpperCase()+")"}return{name:n,offset:i}},getShortcut:b,getShortcutSettings:y,getShortcutsForSubMenus:function(e){const t=Object.keys(i.Z.getCommandsForShortcuts()).filter((e=>e.includes("alt+")&&5===e.length)),n=h(),s=a.Z.get(c.kKeyboardShortcutsAltOpensMenu),o=[],r=[];e.forEach((e=>{if(!1!==e.mnemonic&&e.label&&!S(e)){const t=e.label.indexOf("&");if(-1!==t&&t+1<e.label.length){const n=e.label.toUpperCase().charCodeAt(t+1);-1===o.indexOf(n)&&o.push(n)}}}));for(let i=0;i<e.length;i++){const a=e[i];if(!a.label||!w(a)||!1===s||!1===a.mnemonic){r.push({index:i});continue}const l=g()?a.labelEnglish:a.label;if(void 0===l){r.push({index:i});continue}if(o.length>0){const e=l.indexOf("&");if(-1!==e&&e+1<l.length){const n=l.toUpperCase().charCodeAt(e+1),s=String.fromCharCode(n).toLowerCase(),o="alt+"+s;t.includes(o)?r.push({index:i,key:s,offset:e}):(r.push({index:i,shortcut:o,key:s,offset:e}),t.push(o));continue}}let d=!1;for(let e=0;e+1<l.length&&!d;e++){const s=l.toUpperCase().charCodeAt(e);if(-1!==o.indexOf(s))continue;const a=String.fromCharCode(s).toLowerCase();if(-1===n.indexOf(a))continue;const c="alt+"+a;t.includes(c)||(r.push({index:i,shortcut:c,key:a,offset:e}),t.push(c),d=!0)}d||r.push({index:i})}return r},installMnemonics:function e(t,n){const i=h(),s=0===p.indexOf("en"),o=g();let a="";for(let e=0;e<t.length;e++){const i=t[e];if(i.label)if(S(i)||!1===i.mnemonic){if(!1===i.mnemonic){const e=m(i.label);(e>=0||-2===e)&&(i.labelWithMnemonic=i.label.replace(/\&/g,"&&"))}}else if(n.length>e){const t=o?i.labelEnglish:i.label;let s=n[e].offset;void 0!==s&&s+1<=i.label.length?("&"===i.label[s]?i.labelWithMnemonic=i.label:i.labelWithMnemonic=o?i.label+" (&"+t.charAt(s).toUpperCase()+")":i.label.slice(0,s)+"&"+i.label.slice(s),a+=i.label.charAt(s+1).toUpperCase()):(s=i.label.indexOf("&"),i.labelWithMnemonic=-1!==s?i.label:void 0)}else{const e=m(i.label);e>=0&&e+1<i.label.length?(i.labelWithMnemonic=i.label,a+=i.label.charAt(e+1).toUpperCase()):i.labelWithMnemonic=-2===e?i.label.replace(/\&/g,"&&"):void 0}}for(let n=0;n<t.length;n++){const r=t[n];if(!r.label)continue;const l=o?r.labelEnglish:r.label;if(void 0!==l&&!S(r)&&!1!==r.mnemonic&&void 0===r.labelWithMnemonic){const e=f(a,l,s,i,!1);e>=0&&(a+=l.charAt(e).toUpperCase(),r.labelWithMnemonic=o?r.label+" (&"+l.charAt(e).toUpperCase()+")":r.label.slice(0,e)+"&"+r.label.slice(e))}r.items&&e(r.items,[])}},isSeparator:S,loadPromise:function(){return new Promise((e=>{l.Z.utilities.getLanguage((t=>{p=t,e()}))}))},makeLabelPair:C,makeNumberMnemonic:function(e,t){const n=t<9&&!0;if(n){return{...C("&"+(t+1)+" "+e.replace(/\&/g,"&&")),mnemonic:n}}return{...C(e),mnemonic:n}},separatorItem:{type:"separator",label:"",labelEnglish:""}},T=I},40893:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u});var i=n(96951),s=n(29087),o=n(39206),a=n(2004),r=n(15489),l=n(7064),d=n(89175);const c={withPageSelection:async function(e,t){const n=i.ZP.unsafeGetActivePage(e).id,s=await l.Z.utilities.getSelectedText(n),a=t?t.guid:o.Z.getDefault(r.ZP.isIncognito(e))?.guid;a&&await c.withTextAndEngine(e,s,a)},withTextAndEngine:async function(e,t,n){const i=o.Z.getByGuid(n);if(t&&i){const n=s.Z.get(d.kPageSearchInBackground);await a.Z.goSearchUrl(e,t,{inCurrent:r.ZP.isPopup(e),inBackground:n,useSearchEngine:i,addOpenerTabId:!0})}}},u=c},9304:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>A,mM:()=>y,np:()=>v,tc:()=>b});var i=n(65792),s=n.n(i),o=n(93197);const a=(e,t,n)=>({densityGap:`${n}px`,radiusRound:e>-1?"100px":0,radiusRounded:e>-1?"2px":0,radiusRoundedLess:e>0?e-1+"px":0,radius:`${e}px`,radiusHalf:`${Math.round(e/2)}px`,radiusCap:`${Math.min(e,8)}px`,scrollbarWidth:`${t}px`});var r=n(27856),l=n.n(r),d=n(29087),c=n(47825),u=n(42568),p=n.n(u),h=n(65741),g=n(89175),m=n(93513);const f=["center","top","right","bottom","left"];function v(){return d.Z.get(g.kThemeSimpleScrollbar)?12:16}function y(){return d.Z.get(g.kAppearanceDensity)?3:0}function b(e){const t=(new TextDecoder).decode(e),n=l().sanitize(t,{USE_PROFILES:{svg:!0,svgFilters:!0},FORBID_TAGS:["style"],ADD_TAGS:["feDropShadow"],ADD_ATTR:["from","to"]});if(!n.startsWith("<svg "))throw new Error("ThemeUtils: Malformed SVG file");return(new TextEncoder).encode(n)}function S(e,t,n,i,s){let o;for(let a=0;a<e[t].length;a++){const r=e[t][a];if(n===r[0]&&i===r[1]&&s===r[2]){o=a;break}}"number"!=typeof o?e[t].push([n,i,s,1]):e[t][o][3]++}function w(e){return 60*e.hours+e.minutes}const C={getDefaultTheme:()=>d.Z.getDefault(g.kThemesSystem)[0],getFallbackStyle:()=>C.createStyle(C.getDefaultTheme()),getTheme:e=>{const t=d.Z.get(g.kThemesPreview),n=C.getSystemThemes(),i=d.Z.get(g.kThemesUser);return t.concat(n.concat(i)).find((t=>t?.id===e))},getThemeWithFallback:e=>e&&C.getTheme(e)||C.getDefaultTheme(),getPreview:()=>d.Z.get(g.kThemesPreview)&&d.Z.get(g.kThemesPreview)[0],getSystemThemes:()=>(0,m.Uy)(d.Z.get(g.kThemesSystem),(e=>{const t=d.Z.get(g.kThemesSystem);e.forEach(((n,i)=>{const s=t.find((e=>e.id===n.id));s&&(e[i]=s)}))})),getThemesWithButtons:()=>C.getSystemThemes().concat(d.Z.get(g.kThemesUser)).filter((e=>e.buttons&&(e.url&&Object.keys(e.buttons).some((e=>!e.startsWith("COMMAND_")))||!e.url))),getWindowBackgroundColor:e=>{const t=String(e["--colorBg"]);if(s().valid(t))return s()(t);console.warn(`getWindowBackgroundColor: Unable to find style for ${t}`)},getImageVars:p()((async(e,t)=>{const n={backgroundImage:"unset"};if(e)try{const i=await async function(e){const t=document.createElement("img"),n=new Promise(((e,n)=>{t.addEventListener("load",e,{once:!0}),t.addEventListener("error",n,{once:!0})}));return t.src=e,await n,t}(e),a=i.naturalHeight,r=i.naturalWidth,l=function(e){const t=document.createElement("canvas"),n=t.getContext("2d"),i=16,o=[15,31,47,63,79,95,111,127,143,159,175,191,207,223,239,255],a={center:[],top:[],right:[],bottom:[],left:[]};t.width=i,t.height=i,n.imageSmoothingEnabled=!1,n.drawImage(e,0,0,i,i);const r=n.getImageData(0,0,i,i).data;for(let e=0;e<r.length/4;e++){const t=4*e,n=r[t],s=r[t+1],l=r[t+2],d=o.includes(e),c=e>240,u=!d&&e%i==0;S(a,!c&&e<i?"top":c?"bottom":d?"right":u?"left":"center",n,s,l)}return f.reduce(((e,t)=>{a[t].sort(((e,t)=>t[3]-e[3]));const n=a[t][0];return e[t]=s()(n[0],n[1],n[2]),e}),{})}(i);switch(Object.assign(n,function(e){return Object.entries(e).reduce(((e,[t,n])=>{const i=t[0].toUpperCase()+t.slice(1),a=n.luminance()>o.$J,r=s().mix(n,a?o.Cj:o.E5),l=a?o.E5:o.Cj;return e[`--colorImage${i}Fg`]=l.css(),e[`--colorImage${i}FgAlpha`]=l.alpha(.6).css(),e[`--colorImage${i}FgAlphaHeavy`]=l.alpha(.05).css(),e[`--colorImage${i}Bg`]=r.css(),e[`--colorImage${i}BgAlpha`]=a?r.alpha(.55).css():r.alpha(.55).brighten(1).css(),e[`--colorImage${i}BgAlphaHeavy`]=a?r.alpha(.35).css():r.alpha(.35).brighten(1).css(),e}),{})}(l)),n.backgroundImage=`url("${e}")`,t){case"stretch":n.backgroundSize="cover";break;case"center":n.backgroundSize=`${r}px ${a}px`,n.backgroundRepeat="no-repeat";break;case"repeat":n.backgroundSize=`${r}px ${a}px`,n.backgroundPosition="50% 0"}}catch(t){console.error("Error loading background image",e)}return n}),{maxSize:40}),createStyleRoot:e=>":root {"+Object.entries(e).filter((([e,t])=>e.startsWith("--"))).map((([e,t])=>`${e}:${String(t)}`)).join(";")+";}",getPalette:(e,t)=>{const n=document.createElement("canvas"),i=t||16,s=n.getContext("2d"),o=[],a=[];n.width=i,n.height=i,s.imageSmoothingEnabled=!1,s.drawImage(e,0,0,i,i);const r=s.getImageData(0,0,i,i).data;for(let e=0;e<r.length/4;e++){const t=4*e,n=r[t],i=r[t+1],s=r[t+2];let a;if(!(0===r[t+3]||n>240&&s>240&&i>240)){for(let e=0;e<o.length;e++)if(n===o[e][0]&&i===o[e][1]&&s===o[e][2]){a=e;break}void 0===a?o.push([n,i,s,1]):o[a][3]++}}o.sort(((e,t)=>t[3]-e[3]));for(let e=0;e<Math.min(10,o.length);e++)a.push([o[e][0],o[e][1],o[e][2]]);return a},getTimerByDate:(e,t)=>{const n=60*e.getHours()+e.getMinutes(),i=d.Z.get(g.kThemeScheduleTimeline),s="next"===t?i.reduce(((e,t)=>[...e,t,{...t,hours:t.hours+24}]),[]).sort(((e,t)=>w(e)-w(t))).find((({hours:e,minutes:t})=>60*e+t>n)):i.reduce(((e,t)=>[...e,t,{...t,hours:t.hours-24}]),[]).sort(((e,t)=>w(t)-w(e))).find((({hours:e,minutes:t})=>60*e+t<=n));if(!s)throw new Error("ThemeUtilities: Error getting theme schedule.");return s},convertColorsToVariables:e=>{const t={};return Object.keys(e).forEach((n=>{t[`--${n}`]=e[n]})),t},createStyle:e=>{const t={...o.ZP.forTheme(e),...a(e.radius,v(),y())},n={};return e.transparencyTabBar?n["--colorTabBar"]="transparent":e.accentOnWindow?n["--colorTabBar"]="var(--colorAccentBg)":e.accentOnWindow||(n["--colorTabBar"]="var(--colorBg)"),Object.keys(t).forEach((e=>{n[`--${e}`]=t[e].toString()})),n["--uiZoomLevel"]=c.Z.getUIZoom(),n},isThemeDark:e=>{const t=e["--colorBg"];return"string"==typeof t?s()(t).luminance()<=o.$J:(console.warn("Unable to determine if theme is dark",{style:e}),!1)},isThemeHighlightDark:e=>{const t=e["--colorHighlightBg"];return"string"==typeof t?s()(t).luminance()<=o.$J:(console.warn("Unable to determine if theme highlight is dark",{style:e}),!0)},isThemeAccentDark:(e,t,n)=>{const i=e["--colorAccentBg"],a=e["--colorImageTopBg"]||e["--colorWindowBg"];return"string"==typeof a&&"string"==typeof i&&(n&&t&&(s().blend(a,i,"multiply").luminance(),o.$J),s()(i).luminance()<=o.$J)},isThemeBackgroundImageDark:(e,t,n)=>{const i=e["--colorImageTopBg"]||e["--colorWindowBg"],a=e["--colorAccentBg"];return"string"==typeof i&&"string"==typeof a&&(n&&t?s().blend(i,a,"multiply").luminance()<=o.$J:s()(i).luminance()<=o.$J)},isSystemThemeModified:e=>{const t=d.Z.getDefault(g.kThemesSystem).find((t=>t.id===e.id));return t||console.warn(e.id,"is not a valid system theme"),(0,h.Z)(e,t)},createClassnames:(e,t)=>{let n,i,s;return t?(n=C.isThemeDark(t),i=C.isThemeAccentDark(t,e.accentFromPage,e.transparencyTabBar),s=C.isThemeBackgroundImageDark(t,e.accentFromPage,e.transparencyTabBar)):(n=!1,i=!1,s=!1),{"theme-light":!n,"theme-dark":n,"acc-light":!i,"acc-dark":i,"bg-light":!s,"bg-dark":s,"color-behind-tabs-on":e.accentOnWindow,"color-behind-tabs-off":!e.accentOnWindow,"color-accent-from-page":e.accentFromPage,"ui-transparent-tabs":e.transparencyTabs,"transparent-tabbar":e.transparencyTabBar,[`theme-id-${e.id}`]:!0}}},A=C},93974:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var i=n(7064),s=n(77398);const o=(e=2,t)=>(n,i)=>{if(e<=1)return 0;if(t&&(n=(0,s.Z)(n,t),i=(0,s.Z)(i,t)),!n&&!i)return 0;if(!n&&0!==n)return 2===e?1:-1;if(!i&&0!==i)return 2===e?-1:1;if("number"==typeof n&&"number"==typeof i)return 2===e?n-i:i-n;const o=n.toString().localeCompare(i.toString());return o>0?2===e?1:-1:o<0?2===e?-1:1:0},a={treeSort:function(e,t=o(),n="children"){const i=e=>{for(const t of e){const e=t[n];Array.isArray(e)&&i(e)}e.sort(t)};i(e)},getDefaultComparator:o,toMenuSorting:function(e,t){let n,s;if(e===a.ASCENDING_SORT?n=i.Z.menubarMenu.SortOrder.ASCENDING:e===a.DESCENDING_SORT&&(n=i.Z.menubarMenu.SortOrder.DESCENDING),void 0!==n)switch(t){case"title":s=i.Z.menubarMenu.SortField.TITLE;break;case"url":s=i.Z.menubarMenu.SortField.URL;break;case"nickname":s=i.Z.menubarMenu.SortField.NICKNAME;break;case"description":s=i.Z.menubarMenu.SortField.DESCRIPTION;break;case"dateAdded":s=i.Z.menubarMenu.SortField.DATE_ADDED}return{order:n,field:s}},NO_SORTING:1,ASCENDING_SORT:2,DESCENDING_SORT:3},r=a},19626:(e,t,n)=>{"use strict";n.d(t,{Fe:()=>l,fs:()=>r,pg:()=>d});var i=n(59322),s=n(7064),o=n(36436);const a=["ad_blocking","tracking"],r=(e,t,n,s)=>{const o={tracking:{process:!1,exempt:!1},ad_blocking:{process:!1,exempt:!1}};if(parseInt(t)!==s)switch(t){case"0":o.tracking.exempt=!0,o.ad_blocking.exempt=!0;break;case"1":o.tracking.process=!0,o.ad_blocking.exempt=!0;break;case"2":o.tracking.process=!0,o.ad_blocking.process=!0}Object.keys(o).forEach((t=>{o[t].process?c(e,t,"process_list"):u(e,t,"process_list"),o[t].exempt?c(e,t,"exempt_list"):u(e,t,"exempt_list")})),"number"==typeof n&&i.ZP.reloadPage(n)},l=(e,t,n)=>{if((0,o.xl)(t))return;const{hostname:i}=new URL(t);s.Z.contentBlocking.getAllExceptionLists((t=>{let s=0;a.forEach((e=>{t[e].process_list.find((e=>{i.includes(e)&&s++}))}));let o="0";switch(n){case"ad_blocking":o=0===s||1===s?"2":"0";break;case"tracking":o=2===s||0===s?"1":"0";break;default:return}r(i,o,e)}))},d=(e,t)=>{s.Z.contentBlocking.getActiveExceptionsList(e,(n=>{t({["tracking"===e?"trackerBlockingEnabled":"adBlockingEnabled"]:"exempt_list"===n})}))},c=(e,t,n)=>{s.Z.contentBlocking.addExceptionForDomain(t,n,e)},u=(e,t,n)=>{s.Z.contentBlocking.removeExceptionForDomain(t,n,e)}},84675:(e,t,n)=>{"use strict";n.d(t,{Z:()=>v});var i=n(29717),s=n(21838),o=n(96951),a=n(68247),r=n(29087),l=n(56371),d=n(7064),c=n(16152),u=n(89175),p=n(89555),h=n(8684);const g="VIVALDI_CAPTURE_IMAGE_TO_CLIPBOARD";let m;const f={captureActivePage:async(e,t)=>{const n=o.ZP.getActivePage(e);if(n){const e=r.Z.get(u.kWebpagesCaptureCompressionFormat),{success:i}=await f.captureFullpage(n.id,e,t);i&&"clipboard"===t&&(0,h.c)({title:(0,l.Z)("Page Captured"),body:(0,l.Z)("Image stored in the clipboard."),tag:g})}},captureArea:async(e,t)=>{i.Z.enableCapture(e);try{return a.Z.set(u.kWebpagesCaptureSaveLocation,t),await f.beginCaptureArea()}catch(e){return""}},captureFullpage:(e,t,n)=>{const i={encodeFormat:t,encodeQuality:85,fullPage:!0,height:3e4,saveToDisk:"file"===n,showFileInPath:"file"===n,copyToClipboard:"clipboard"===n,saveFilePattern:r.Z.get(u.kWebpagesCaptureSaveFilePattern)};return new Promise((t=>{d.Z.thumbnails.captureTab(e,i,((e,n)=>{t({success:e,image:n})}))}))},beginCaptureArea:()=>new Promise(((e,t)=>{m?t("Capture in Progress"):m=(n,i)=>{n&&t("Capture Cancelled"),e(i)}})),performCapture:(0,c.Z)((e=>{const{windowId:t,mode:n,opts:s,noteId:o}=e;f.beginCaptureArea().then((e=>{f.handleCaptureLocation({windowId:t,mode:n,base64:e,noteId:o})})).catch(p.Z),i.Z.disableCapture(t),f.doCapture(t,s)}),25),doCapture:(e,t)=>{const{x:n,y:i,width:s,height:o}=t,a=r.Z.get(u.kWebpagesCaptureSaveLocation),l=r.Z.get(u.kWebpagesCaptureCompressionFormat),c=r.Z.get(u.kWebpagesCaptureSaveFilePattern),p="note"===a,h="clipboard"===a;d.Z.thumbnails.captureUI({windowId:e,posX:n,posY:i,width:s,height:o,encodeFormat:l,encodeQuality:85,saveToDisk:!0!==p,showFileInPath:!0!==p,copyToClipboard:h,saveFilePattern:c},((e,t)=>{m&&(m(!e,t),m=void 0)}))},handleCaptureLocation:async e=>{const{windowId:t,mode:n,base64:i,noteId:o}=e,a=r.Z.get(u.kWebpagesCaptureSaveLocation);if("clipboard"===a){const e="area"===n?(0,l.Z)("Area Captured"):(0,l.Z)("Page Captured");(0,h.c)({title:e,body:(0,l.Z)("Image Stored in the Clipboard"),tag:g})}else"note"===a&&i&&(o?(s.Z.addScreenshotToNote(t,o,i),f.cancelCallback(t)):await s.Z.createNoteFromCapture(t,i))},cancelCallback:e=>{i.Z.disableCapture(e),m&&(m(!0,""),m=void 0)},captureFromNote:async(e,t)=>{i.Z.enableCapture(e,t),a.Z.set(u.kWebpagesCaptureSaveLocation,"note")}},v=f},21191:(e,t,n)=>{"use strict";n.d(t,{Ed:()=>c,Jq:()=>r,jD:()=>d});var i=n(39005),s=n(30626),o=n(7064),a=n(4668);function r(e,t){const n=i.Z.getRaw();if(n){const e=i.Z.getActiveListEntry(),t=e?(0,a.BZ)(e.subject):"message";n.saveAs(t+".eml")}else s.Z.getActiveWebView(e)&&o.Z.utilities.savePage(t)}const l=["COMMAND_NEW_BACKGROUND_TAB_LINK","COMMAND_NEW_TAB_LINK"];function d(e){return l.includes(e)}function c(e){return false}},47380:(e,t,n)=>{"use strict";n.d(t,{Z:()=>C,m:()=>f});var i=n(65810),s=n(44147),o=n(76747),a=n(60331),r=n(62077),l=n(72536),d=n(92292),c=n(26591),u=n(86635),p=n(68551),h=n(13253),g=n(89661),m=n(7064);const f=(e,t)=>({origin:e,context:t,windowId:t.vivaldiWindowId,keyState:{ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,key:""}});let v={x:0,y:0,width:0,height:0},y="topLeft",b=!1,S="none",w=null;const C=function(e,t,n,f="pointer",C,A=-1,I){const T=o.Z.getShortcutSettings(),Z=e.vivaldiWindowId;let E,k=0;const _=new Map,N=new Map,P=async function(t){const n={origin:"menu",context:e,windowId:Z,keyState:{shiftKey:t.state.shift,ctrlKey:t.state.ctrl,altKey:t.state.alt,metaKey:t.state.command,key:""},menuData:I};if(t.state.left?n.button=0:t.state.right?n.button=2:t.state.center&&(n.button=1),t.persistent){let e=N.get(t.id);if(e){const i=[];let s=await e.handler(n,!0);const o={id:t.id,checked:s};e.statestrings&&(o.name=e.statestrings[s?1:0].label),i.push(o);const a=Array.from(N.keys());for(let o=0;o<a.length;o++){const r=a[o];if(r!==t.id&&(e=N.get(r),e)){s=await e.handler(n,!1);const t={id:r,checked:s};e.statestrings&&(t.name=e.statestrings[s?1:0].label),i.push(t)}}m.Z.contextMenu.update(i)}}else{const e=_.get(t.id);e&&e(n)}},D=function(e){S="none",a.Z.setStatus(Z,""),m.Z.menubarMenu.onOpen.removeListener(M),m.Z.menubarMenu.onClose.removeListener(O),m.Z.menubarMenu.onHover.removeListener(s.Z.onHover),m.Z.menubarMenu.onAction.removeListener(P),clearInterval(E);const t=w;t&&(w=null,e||t())},M=function(){S="shown",E=setInterval((()=>{m.Z.utilities.emulateUserInput(Z)}),2e3),"function"==typeof n&&n(!0)},O=function(){"function"==typeof n&&n(!1),D(!1)},x=function(e){return e.filter((e=>!e.isVisible||e.isVisible(Z,!1))).map((e=>{const t={};if(o.Z.isSeparator(e))t.separator={};else if("container"===e.type){if(e.container)switch(e.container.content){case"extensions":case"imageinprofile":case"linkinprofile":case"linktohighlight":case"notes":case"pwa":case"linkinpwa":case"sendpagetodevices":case"sendlinktodevices":case"sendimagetodevices":case"speech":case"spellcheck":case"spellcheckoptions":const n=k++;t.container={id:n,content:e.container.content,icons:e.container.icons??[],mode:e.container.mode||"folder",name:o.Z.getDisplayName(e)};break;default:console.warn("Unknown container content",e.container.content)}}else{const n=k++,i=o.Z.getDisplayName(e);let s,a,r=e.persistent;if(e.handler&&(i||e.url)&&_.set(n,e.handler),e.checkedHandler&&(i||e.url)){r=!0;const t={handler:e.checkedHandler,statestrings:e.statestrings};N.set(n,t)}switch(e.commandName&&0===e.commandName.indexOf("DOCUMENT_")&&(s=e.commandName),(e.iconPNG||e.iconPNGWhite)&&(a=[e.iconPNG||"",e.iconPNGWhite||""]),r&&(b=!0),e.type){case"checkbox":case"radio":t.item={id:n,action:s,name:i,type:e.type,radiogroup:e.radiogroup?e.radiogroup:-1,checked:!(!e.checked||e.statestrings)&&e.checked,shortcut:o.Z.getShortcut(e,T).value,showshortcut:e.showshortcut,url:e.url,enabled:!e.isEnabled||e.isEnabled(Z),persistent:r,icons:a};break;default:t.item={id:n,action:s,name:i,type:e.items?"folder":"command",shortcut:o.Z.getShortcut(e,T).value,showshortcut:e.showshortcut,url:e.url,enabled:!e.isEnabled||e.isEnabled(Z),persistent:r,icons:a},e.items&&(t.children=x(e.items))}}return t}))},L=function(e){if("none"!==S)return void("shown"===S?w=L.bind(null,e):console.error("Attempt to show another context menu while one is initializing"));const n="function"==typeof t?t():t;if(0!==n.length){S="initializing",o.Z.installMnemonics(n,[]),m.Z.menubarMenu.onOpen.addListener(M),m.Z.menubarMenu.onClose.addListener(O),m.Z.menubarMenu.onHover.addListener(s.Z.onHover),m.Z.menubarMenu.onAction.addListener(P);try{b="pointer"!==f;const e=x(n);m.Z.contextMenu.show({windowId:Z,documentId:A,forceViews:b,rect:v,origin:y,icons:[c.Z,u.Z,p.Z,h.Z,g.Z,r.Z,l.Z],children:e},(()=>{const e=d.Z.runtime.lastError;e&&(console.error(e.message),D(!0))}))}catch(e){console.error(e)}}};return function(e){e&&e?.nativeEvent?.path?.find((e=>"vivaldi-tooltip"===e.id))||i.i(),e&&(e.persist(),e.preventDefault(),e.stopPropagation());if(v={x:0,y:0,width:0,height:0},y=f,"pointer"===f)v.x=e?e.clientX:0,v.y=e?e.clientY:0;else{let t=C?C.getBoundingClientRect():null;!t&&e&&(t=e.nativeEvent.srcElement.getBoundingClientRect()),t&&(v.x=t.left+1,v.y=t.top,v.width=t.width,v.height=t.height)}L(e)}}},82313:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(56371);const s=[(0,i.Z)("B"),(0,i.Z)("kB"),(0,i.Z)("MB"),(0,i.Z)("GB"),(0,i.Z)("TB"),(0,i.Z)("PB"),(0,i.Z)("EB"),(0,i.Z)("ZB"),(0,i.Z)("YB")],o=(0,i.Z)("bytes");function a(e,t,n=!0,i=!1){if(isNaN(e))return e?e.toString():"";if(e<=0)return"0 "+(n?o:s[0]);const a=i?1024:1e3,r=t??(e<a?0:2);let l=s.length-1;for(var d=0;d<s.length;d++)if(e<Math.pow(a,d+1)){l=d;break}let c=(e/Math.pow(a,l)).toLocaleString(void 0,{maximumFractionDigits:r});if(r>0){const e="."+"0".repeat(r);c.endsWith(e)&&(c=c.substring(0,c.length-e.length))}const u=0===l&&n?o:s[l];return c+(u?" "+u:"")}},81814:(e,t,n)=>{"use strict";function i(e,t){return!!t&&t.contains(e.activeElement)}function s(e){return e.querySelectorAll("a[href]:not([tabindex='-1']),\n    button:not([disabled]):not([tabindex='-1']),\n    input:not([disabled]):not([tabindex='-1']),\n    select:not([disabled]):not([tabindex='-1']),\n    textarea:not([disabled]):not([tabindex='-1']),\n    [contenteditable]:not([tabindex='-1']),\n    [tabindex]:not([disabled]):not([tabindex='-1'])")}function o(e,t){const n=[...s(t||e)],i=n.findIndex((t=>t===e.activeElement));n[(i+1)%n.length].focus()}n.d(t,{Ng:()=>s,pf:()=>o,sT:()=>i})},2497:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var i=n(92292);function s(e){const t=i.Z.extension.getViews({windowId:e});if(!t||0===t.length)throw new Error(`chrome.extension.getViews ( ${e} ) returned no views. `);return t[0]}},26036:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var i=n(56371);const s="Ð";function o(e,t,n){const o=Array.from(arguments);o[0]=s+o[0];let a=(0,i.Z)(...o);return a.startsWith(s)&&(a=a.substr(1)),{label:(0,i.Z)(...arguments),labelEnglish:a}}},97781:(e,t,n)=>{"use strict";n.d(t,{Gx:()=>d,Nw:()=>y,ZR:()=>l,o6:()=>A});var i=n(27856),s=n.n(i);const o="https://240.0.0.0/?url=",a=/(url\("?)(?!data:)/gim,r="lang",l="type",d="name";function c(e,t){for(let n=t.length-1;n>=0;n--){if(t[t[n]]){const e=t[t[n]].replace(a,"$1"+o);t[t[n]]=e}t[t[n]]&&e.push(t[n]+":"+t[t[n]]+";")}}function u(e,t){for(let n=t.length-1;n>=0;n--){const i=t[n];if(1===i.type&&i.selectorText)e.push(i.selectorText+"{"),i.style&&c(e,i.style),e.push("}");else if(i.type===i.MEDIA_RULE)e.push("@media "+i.media.mediaText+"{"),u(e,i.cssRules),e.push("}");else if(i.type===i.FONT_FACE_RULE)e.push("@font-face {"),i.style&&c(e,i.style),e.push("}");else if(i.type===i.KEYFRAMES_RULE){e.push("@keyframes "+i.name+"{");for(let t=i.cssRules.length-1;t>=0;t--){const n=i.cssRules[t];8===n.type&&n.keyText&&(e.push(n.keyText+"{"),n.style&&c(e,n.style),e.push("}"))}e.push("}")}}}const p=function(e,t){if("style"===t.tagName){const t=[];e.sheet&&u(t,e.sheet.cssRules),e.textContent=t.join("\n")}},h=["action","background","href","poster","src","srcset","xlink:href"];let g=!1;const m=function(e){if(h.forEach((t=>{!e.hasAttribute(t)||"href"===t&&"A"===e.tagName||/^(data|blob):(?!image\/svg)/i.test(e.getAttribute(t))||(g=!0,e.removeAttribute(t))})),e.hasAttribute("style")){const t=e.style,n=[];for(let i=t.length-1;i>=0;i--){if(e.style[t[i]]&&a.test(e.style[t[i]])){const n=e.style[t[i]].replace(a,"$1"+o);e.style[t[i]]=n}n.push(t[i]+":"+e.style[t[i]]+";")}n.length?e.setAttribute("style",n.join("")):e.removeAttribute("style")}},f=function(e){"target"in e&&e.setAttribute("target","_blank"),e.hasAttribute("target")||!e.hasAttribute("xlink:href")&&!e.hasAttribute("href")||e.setAttribute("xlink:show","new")},v=function(e,t){const n=e[t.src];if(n){const e=new Blob([n.content],{type:n.mimeType});t.setAttribute(r,t.src),t.setAttribute("src",URL.createObjectURL(e)),n.inUse=!0}};function y(e,t){const n=t?.attachments??{},i=t?.blockHTTPLeaks??!0;s().addHook("afterSanitizeAttributes",f),s().addHook("afterSanitizeAttributes",v.bind(void 0,n)),i&&(s().addHook("afterSanitizeAttributes",m),s().addHook("uponSanitizeElement",p)),g=!1;const o=s().sanitize(e,{ADD_TAGS:i?[]:["iframe"],ADD_ATTR:i?[]:["allowfullscreen"],ALLOW_UNKNOWN_PROTOCOLS:!0,FORBID_TAGS:i?["svg"]:[],WHOLE_DOCUMENT:!0});return s().removeHooks("afterSanitizeAttributes"),s().removeHooks("uponSanitizeElement"),{sanitized:o,leakPrevented:g}}function b(){return Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString()}let S=[],w=[];function C(e){if("string"==typeof e.src)if(e.src.startsWith("blob:")){const t=e.getAttribute(r);if(t)S.push(t),e.removeAttribute(r),e.setAttribute("src",t);else{const t=b();w.push({dataOrBlobUrl:e.src,cid:t,mimeType:e.getAttribute(l),filename:e.getAttribute(d)}),e.setAttribute("src","cid:"+t),e.removeAttribute(l),e.removeAttribute(d)}}else if(e.src.startsWith("data:image/")){const t=b(),n=e.src.match(/^data:([^,;]+)/)[1];w.push({dataOrBlobUrl:e.src,cid:t,mimeType:n,filename:""}),e.setAttribute("src","cid:"+t)}}function A(e){s().addHook("afterSanitizeAttributes",C);const t={blobFreeHTML:s().sanitize(e,{ALLOW_UNKNOWN_PROTOCOLS:!0,WHOLE_DOCUMENT:!0}),cidsInUse:S,newImages:w};return s().removeHooks("afterSanitizeAttributes"),S=[],w=[],t}},48588:(e,t,n)=>{"use strict";n.d(t,{J3:()=>r,cR:()=>a,kz:()=>d,u4:()=>l});var i=n(68247),s=n(29087),o=n(93513);function a(e,t,n,i){const s=e.get(t)??i;if(void 0===s)return e;const a=(0,o.Uy)(s,n);if(s===a)return e;const r=new Map(e);return r.set(t,a),(0,o.vV)(r)}function r(e,t,n){return e.get(t)===n?e:(0,o.vV)(new Map(e).set(t,n))}function l(e,t){if(e.has(t)){const n=new Map(e);return n.delete(t),(0,o.vV)(n)}return e}function d(e,t){const n=s.Z.get(e),a=(0,o.Uy)(n,t);return n!==a&&(i.Z.set(e,a),!0)}},721:(e,t,n)=>{"use strict";n.d(t,{Kz:()=>c,Mr:()=>r,Np:()=>l,S2:()=>a,VV:()=>o,mT:()=>d});var i=n(84847),s=n(7064);function o(e){return!(e.altKey||e.shiftKey||e.ctrlKey||e.metaKey)}function a(e){return e.altKey&&!e.shiftKey&&!e.ctrlKey&&!e.metaKey}function r(e){return!e.altKey&&e.shiftKey&&!e.ctrlKey&&!e.metaKey}function l(e){return!e.altKey&&!e.shiftKey&&e.ctrlKey&&!e.metaKey}function d(e){const{altKey:t,shiftKey:n,ctrlKey:i,metaKey:s}=e;return!t&&!n&&i&&!s}const c=function(){let e=!1;return function(t,n){(0,i.Z)(t)?!0!==e&&(e=!0,s.Z.tabsPrivate.onKeyboardChanged.addListener((function i(o,a,r,l){!a&&function(e,t){const n={ctrlKey:[17],altKey:[18],metaKey:[91,93]};return Object.keys(n).filter((t=>e)).filter((e=>-1!==n[e].indexOf(t))).some(Boolean)}(t,l)&&(e=!1,n(),s.Z.tabsPrivate.onKeyboardChanged.removeListener(i))}))):n()}}()},49550:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const i=Object.freeze({3:"Break",8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"Capslock",27:"Escape",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",41:"Select",42:"Print",43:"Execute",44:"PrintScreen",45:"Insert",46:"Del",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",58:":",59:"None",60:"<",61:"=",63:"ß",64:"@",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",91:"Meta",92:"None",93:"Meta",96:"Numpad0",97:"Numpad1",98:"Numpad2",99:"Numpad3",100:"Numpad4",101:"Numpad5",102:"Numpad6",103:"Numpad7",104:"Numpad8",105:"Numpad9",106:"*",107:"+",108:",",109:"-",110:".",111:"/",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",124:"F13",125:"F14",126:"F15",127:"F16",128:"F17",129:"F18",130:"F19",131:"F20",132:"F21",133:"F22",134:"F23",135:"F24",144:"NumLock",145:"Scrolllock",160:"^",161:"!",163:"#",164:"$",165:"None",166:"BrowserBack",167:"BrowserForward",169:")",170:"*",171:"+",173:"None",174:"None",175:"None",176:"Next",177:"Previous",178:"Stop",179:"None",180:"None",181:"None",182:"None",183:"None",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"None",193:"None",194:".",219:"[",220:"\\",221:"]",222:"'",223:"`",224:"Meta",225:"AltGraph",226:"None",230:"None",233:"None",234:"None",255:"None"})},13302:(e,t,n)=>{"use strict";function i(e){return Array.isArray(e)&&(e=e.join(", ")),e&&(e=(e=e.replace(/left/gi,"←").replace(/right/gi,"→").replace(/up/gi,"↑").replace(/down/gi,"↓")).replace(/(^|\+)(\w)/g,(e=>e.toUpperCase()))),e}function s(e){return Array.isArray(e)&&(e=e.join(", ")),e&&(e=e.replace(/(^|\+)(\w)/g,(e=>e.toUpperCase()))),e}n.d(t,{$:()=>i,G:()=>s})},51540:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});const i=/\b(?:https?:\/\/|ftp:\/\/|www\.)\S+/gi;function s(e,t,n){let i="";for(;e.endsWith(".")||e.endsWith(":");)i=e[e.length-1]+i,e=e.substr(0,e.length-1);"&lt;"===n.substr(t-4,4)&&e.endsWith("&gt;")?(i="&gt;"+i,e=e.substr(0,e.length-4)):[["(",")"],["[","]"]].forEach((([s,o])=>{n[t-1]===s&&e.endsWith(o)&&(i=o+i,e=e.substr(0,e.length-1))}));return`<a href="${e.startsWith("www.")?"http://"+e:e}" target="_blank">${e}</a>${i}`}let o=0,a=0;const r=/\n((?:&gt;\ ?)*)([^\n]*)/g;function l(e,t,n,i,s){let r=0,l=0;for(;;){const e=t.indexOf(";",l);if(-1===e)break;l=e+1,r++}const d=Math.min(r,o+1);let c=`\n${n}`;if(d>o)a++,c=`\n<blockquote class="indent-${d} blockquote">${n}`;else if(d<o){const e=o-d;a-=e;c=`\n${"</blockquote>".repeat(e)}${n}`}return o=d,c}function d(e,t,n){return":"===n[t-1]||"?"===n[t-1]||"/"===n[t-1]||"&"===n[t-1]||"="===n[t-1]?e:`<a href="mailto:${e}">${e}</a>`}function c(e){let t=e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/[A-Z0-9\-\_\.]+@(?:[A-Z\_-]+\.)+[A-Z]+/gi,d).replace(i,s).replace(r,l);return o=0,a>0&&(t+="</blockquote>".repeat(a),a=0),t}},45660:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});n(20244);var i=n(17751);const s=new(n(52821).Y)(i.Z)},60007:e=>{let t=!0;const n=(e,t)=>{const n=e[t].level-1;for(let i=t-1;i>=0;i--)if(e[i].level===n)return i;return-1};e.exports=(e,i)=>{i&&(t=!0===i.enabled),e.block.ruler.after("list","todo",((e,t,n)=>{const i=((e,t)=>{const n=e.bMarks[t]+e.blkIndent,i=e.eMarks[t];return e.src.substr(n,i-n)})(e,t);return"list"===e.parentType&&("[ ]"===i.substring(0,3)||"[x]"===i.substring(0,3).toLowerCase())&&(e.tokens.push({type:"todo",content:i,block:!0,lines:[t],level:e.level}),e.line=t+1,!0)}),{}),e.renderer.rules.todo=(e,i,s)=>((e,i,s)=>{const o=e[i],a=e[i-1],r=e[n(e,i-1)];let l=o.content;if(a&&"list_item_open"===a.type&&r&&"bullet_list_open"===r.type){const e=1===l.toLowerCase().indexOf("x");return l=l.slice(3).trim(),'<input type="checkbox"'+(e?" checked":"")+(t?"":" disabled")+" />"+l}return l})(e,i);const s=e.renderer.rules.list_item_open;e.renderer.rules.list_item_open=(e,t,i,o)=>{const a=e[t+1],r=e[n(e,t)];return r&&"bullet_list_open"===r.type&&a&&"todo"===a.type?'<li class="todo">':s(e,t,i,o)}}},4027:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const i={kNone:-1,kLeft:0,kCenter:1,kRight:2,kBack:3,kForward:4,isContextMenuButton:e=>2===e,isNavigationButton:e=>3===e||4===e,isNoModifierPressed:e=>!(e.altKey||e.shiftKey||e.ctrlKey||e.metaKey),setWebviewPointerEvents:(e,t)=>{const n=e?"":"none";for(const e of t.getElementsByTagName("WEBVIEW"))e.style.pointerEvents=n}}},81157:(e,t,n)=>{"use strict";function i(e){e.preventDefault(),e.stopPropagation()}function s(e){e.stopPropagation()}function o(e){e.preventDefault()}n.d(t,{PF:()=>o,UW:()=>s,ZP:()=>i})},8684:(e,t,n)=>{"use strict";n.d(t,{c:()=>i});function i(e){const t=new Notification(e.title,{body:e.body,icon:e.icon?e.icon:"/resources/icon_notifications.png",silent:Boolean(e.silent),tag:e.tag,renotify:!0});t.onclick=()=>{e.onClick&&e.onClick(),t.close()},setTimeout((()=>t.close()),e.timeout||18e4)}},26219:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var i=n(56371);async function s(e,t){const{chrome:n}=e;return new Promise(((e,s)=>{n.fileSystem.chooseEntry({type:"openFile",acceptsMultiple:!0,accepts:[{mimeTypes:["text/*"],extensions:t,description:(0,i.Z)("files of type $1",[t.join(", ")])}]},(t=>{n.runtime.lastError||!t?s(n.runtime.lastError||"Cancelled opening files"):e(t)}))}))}},51370:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(85834),s=n(78614);function o(e){try{return decodeURIComponent(e)}catch(e){return""}}function a(e){const[,t]=e.split(":",2),[n,a=""]=t.split("?",2),r={to:(0,s.D$)((0,i.Mf)(o(n)))};return a.split("&").forEach((e=>{const t=["cc","bcc","body","subject"].find((t=>e.startsWith(t+"=")));if(t){const n=o(e.substr(t.length+1));switch(t){case"cc":case"bcc":r[t]=(0,s.D$)((0,i.Mf)(n));break;case"subject":r[t]=(0,i.Mf)(n);break;case"body":r[t]=n}}})),r}},94595:(e,t,n)=>{"use strict";n.d(t,{M:()=>l,Z:()=>r});var i=n(29087),s=n(89175),o=n(10373);const a=/^(\s*javascript:)+/i;function r(e){const{textToStrip:t,caretPosition:n,selectionEnd:a,currentValue:r=""}=e,d=i.Z.get(s.kAddressBarStripJavascriptOnPaste),c=(0,o.i)(r,t,n,a);return d&&l(c)?c.replace(/javascript:/gi,""):c}function l(e){return a.test(e)}},80419:(e,t,n)=>{"use strict";n.d(t,{g:()=>o});var i=n(7064);let s=!1;function o(e,t,n){function o(e){s=!1,n.removeEventListener("mouseup",l),n.removeEventListener("mousedown",l),i.Z.tabsPrivate.onKeyboardChanged.removeListener(a),i.Z.tabsPrivate.onTabSwitchEnd.removeListener(r),t(e)}function a(e,t,n,i){!0===t?27===i&&o(!0):!1===t&&(17!==i&&18!==i&&13!==i||o(!1))}function r(){o(!1)}function l(e){if(e.target){const t=e.target.classList;if("mousedown"===e.type&&0===e.button&&t&&["visual-tab","visual-list","visual-list-preview"].includes(t)||"audioicon"===e.target.className)return}(2===e.button||e.button<=1&&e.buttons<=2)&&(e.preventDefault(),e.stopPropagation(),o(!1))}!0!==s&&(s=!0,n.addEventListener("mouseup",l),n.addEventListener("mousedown",l),i.Z.tabsPrivate.onKeyboardChanged.addListener(a),i.Z.tabsPrivate.onTabSwitchEnd.addListener(r))}},751:(e,t,n)=>{"use strict";n.d(t,{IY:()=>i,RT:()=>a,gR:()=>o,i6:()=>r,x0:()=>s});n(94283);const i="urlFieldInput";function s(e,t){const n=e.document.getElementById(t??i);n&&n.focus()}function o(e,t){const n=e.document.getElementById(t??i);n&&n.blur()}function a(e,t){return e.document.activeElement?.id===(t??i)}function r(e,t){const n=e.document.getElementById(t??i);n instanceof e.HTMLInputElement&&n.select()}},84749:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});const i=":";function s(e){return(e=e.replace(/[^0-9a-z]+([a-z]|$)/gi,((e,t)=>t.toUpperCase())))||(e=i),e}function o(e,t,n,a){let r="",l="";for(let d=0;d<e.childNodes.length;d++){const c=e.childNodes[d];if(c instanceof Element){let l=s(c.localName);const d=e.nodeType===Node.DOCUMENT_NODE||n.simplify.some((e=>c.parentNode instanceof Element&&(e.parentns===(c.parentNode.namespaceURI||"")&&e.parent===c.parentNode.localName&&e.elementns===(c.namespaceURI||"")&&e.element===c.localName))),u=c.namespaceURI||i,p=c.namespaceURI||"";l=n.prefixes&&n.prefixes.hasOwnProperty(u)?n.prefixes[u]+"_"+l:p+":"+l,r=l;const h={attributes:{}};for(let e=0;e<c.attributes.length;e++){const t=c.attributes[e];let o=s(t.localName);const a=t.namespaceURI||i,r=t.namespaceURI||"";o=n.prefixes&&n.prefixes.hasOwnProperty(a)?n.prefixes[a]+"_"+o:r+":"+o,h.attributes[o]=t.nodeValue}o(c,h,n,a),d?t[l]?(a.simplifyerror=!0,t.simplifyerror||(t.simplifyerror={}),t.simplifyerror[l]instanceof Array||(t.simplifyerror[l]=[]),t.simplifyerror[l].push(h)):t[l]=h:(t[l]instanceof Array||(t[l]=[]),t[l].push(h))}else c.nodeType!==Node.TEXT_NODE&&c.nodeType!==Node.CDATA_SECTION_NODE||(l+=c.nodeValue)}return e.nodeType===Node.ELEMENT_NODE&&(t.content=l.replace(/^\s+$/,"")),r}function a(e,t){const n=(new DOMParser).parseFromString(e,"text/xml");if(!n||n.getElementsByTagNameNS("http://www.w3.org/1999/xhtml","parsererror").length)return{parsererror:!0,root:"",simplifyerror:!1};const s={prefixes:(t||{}).prefixes||{[i]:""},simplify:(t||{}).simplify||[]},a={parsererror:!1,root:"",simplifyerror:!1};return a.root=o(n,a,s,a),a.root||(a.parsererror=!0),a}},7065:(e,t,n)=>{"use strict";n.d(t,{OK:()=>d,ZP:()=>u});var i=n(29087),s=n(44850),o=n(35369),a=n(69046),r=n(65741),l=n(89175);function d(e){const t=e.id;if(void 0===t)throw new Error("Chrome.tabToPage: tab ID missing");let n=(0,a.SJ)({id:t});var r;return n=c(o.aV.of(n),t,e).first(),n.context.isUrlFieldFocused=(r=n.url,!i.Z.get(l.kTabsFocusWebview)&&((0,s.Rf)(r)||r===s.xy["private-intro"])),n}function c(e,t,n){const i=e.findIndex((e=>e.id===t));if(-1===i)return e;for(const[t,a]of Object.entries(n))switch(t){case"vivExtData":if("string"!=typeof a)continue;try{const t=e.getIn([i,"vivExtData"]);if(!t)throw new Error("updatePage: Expected existing extData");const n=JSON.parse(a);"string"==typeof n.tiling&&delete n.tiling,(0,r.Z)(t,n)||(e=e.setIn([i,"vivExtData"],n))}catch(e){}break;case"active":if("boolean"!=typeof a)continue;e=e.setIn([i,"active"],a),a&&(e=e.setIn([i,"unread"],!1));break;case"pendingUrl":case"url":if("string"!=typeof a)continue;if("url"===t&&n.pendingUrl)continue;e=(e=(e=e.setIn([i,"isMailPage"],s.jk.isMailPage(a))).setIn([i,"url"],(o=a).startsWith("vivaldi://")?s.jk.getUrl(o):o)).setIn([i,"target"],void 0);break;case"favIconUrl":if("string"!=typeof a)continue;e=e.setIn([i,"favIconUrl"],a);break;case"index":case"windowId":case"openerTabId":case"pinned":case"audible":case"title":case"incognito":case"sessionId":case"discarded":e=e.setIn([i,t],a)}var o;return e}const u={tabToPage:d,updatePage:c}},26395:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var i=n(67294),s=n(94283),o=n(88594),a=n(48521);class r extends i.PureComponent{static contextType=s.Z;nodeRef=i.createRef();componentDidMount=()=>{this._attachObserver()};componentWillUnmount=()=>{this._detachObserver()};componentDidUpdate(e){this.props.attached&&!e.attached&&this._detachObserver(),!this.props.attached&&e.attached&&this._attachObserver()}_attachObserver=()=>{const{Element:e,ResizeObserver:t}=this.context,n=this.nodeRef.current;if(n instanceof e)try{this._observer=new t(this.props.onResize),this._observer.observe(n)}catch(e){console.warn(e)}};_detachObserver=()=>{const{Element:e}=this.context,t=this.nodeRef.current;t instanceof e&&this._observer.unobserve(t)};render(){const e=(0,o.Z)(this.props,["ref","onResize","component","children","attached"]);return(0,a.jsx)("div",{ref:this.nodeRef,...e,children:this.props.children})}}const l=r},69046:(e,t,n)=>{"use strict";function i(e){return e.vivExtData.ext_id}function s(e){return e.vivExtData.fixedGroupTitle}function o(e){return e.vivExtData.group}function a(e){return e.vivExtData.tiling?.id}function r(e){return e.vivExtData.workspaceId}function l(e){return{id:0,index:-1,windowId:-1,openerTabId:void 0,active:!1,pinned:!1,audible:!1,discarded:!1,url:"",title:"",favIconUrl:"",incognito:!1,sessionId:"",vivExtData:{ext_id:""},context:{},target:void 0,favIcon:"",showImageInspector:!1,mimeType:"text/html",unread:!0,isInspected:!1,isMailPage:!1,supportsReaderMode:!1,memoryUsage:0,...e}}n.d(t,{SJ:()=>l,XN:()=>s,_o:()=>i,av:()=>o,cm:()=>r,jA:()=>a})},39206:(e,t,n)=>{"use strict";n.d(t,{A:()=>d,Z:()=>h});var i=n(68247),s=n(29087),o=n(96098),a=n(25372),r=n(7064),l=n(89175);const d=1,c=new Set;let u={templateUrls:[],defaultSearch:"",defaultPrivate:"",defaultSearchField:"",defaultSearchFieldPrivate:"",defaultSpeeddials:"",defaultSpeeddialsPrivate:"",defaultImage:"",systemDefaultSearchChanged:!1};const p={load:async()=>{r.Z.searchEngines.onTemplateUrlsChanged.addListener(p._onTemplateUrlsChanged),await p._onTemplateUrlsChanged(),await p._migrateOldSearches()},_onTemplateUrlsChanged:async()=>{try{u=await r.Z.searchEngines.getTemplateUrls()}catch(e){console.log("Failed loading template URLs:"+e)}c.forEach((e=>e()))},systemDefaultEngineChanged:()=>u.systemDefaultSearchChanged,get:()=>u.templateUrls,getByKeyword:e=>u.templateUrls.find((t=>t.keyword===e)),getByQuery:e=>u.templateUrls.find((t=>e.toLowerCase().startsWith(t.keyword+" "))),isDefault:(e,t)=>t?u.defaultPrivate===e:u.defaultSearch===e,isRemovable:e=>u.defaultSearch!==e&&u.defaultPrivate!==e&&u.defaultImage!==e,getDefault:e=>p.getByGuid(e?u.defaultPrivate:u.defaultSearch),getSearchField:e=>p.getByGuid(e?u.defaultSearchFieldPrivate:u.defaultSearchField),getSpeeddialsSearch:e=>p.getByGuid(e?u.defaultSpeeddialsPrivate:u.defaultSpeeddials),getImageSearch:()=>p.getByGuid(u.defaultImage),getByGuid:e=>u.templateUrls.find((t=>t.guid===e)),getByPrepopulateId:e=>u.templateUrls.find((t=>t.prepopulateId===e)),addListener:e=>{c.add(e)},removeListener:e=>{c.delete(e)},_migrateOldSearches:async()=>{const e={Google:1,"Yahoo!":2,Bing:3,Ecosia:4,"Startpage.com":5,Wikipedia:6,DuckDuckGo:7,Яндекс:8,Neeva:9,"Wolfram|Alpha":10,OZON:11,Amazon:12,eBay:13,"Поиск Mail.ru":14,Qwant:15};async function t(e){const[t,n]=e.post?function(e){const t=(0,a.Z)(e);if(!t)return["",""];const n=t.href.replace(t.search||"",""),i=t.search?.startsWith("?")?t.search.replace("?",""):t.search;return[n||"",i?i.replace("&",","):""]}(e.url):[e.url,""];if(""===t)return"";const i={guid:"",extensionId:"",readOnly:!1,name:e.name,keyword:e.keyword?e.keyword:await r.Z.searchEngines.getKeywordForUrl(t),faviconUrl:e.faviconUrl,url:t,postParams:n,suggestUrl:e.suggestUrl??"",suggestPostParams:"",imageUrl:"",imagePostParams:"",prepopulateId:0},s=p.getByKeyword(e.keyword);if(s){if(i.url===s.url&&i.postParams===s.postParams&&i.suggestUrl===s.suggestUrl)return s.guid;let t=1;const n=e.keyword;let o="";do{o=`${n}${t}`,t++}while(p.getByKeyword(o));0!==s.prepopulateId?(s.keyword=o,r.Z.searchEngines.updateTemplateUrl(s)):i.keyword=o}return await r.Z.searchEngines.addTemplateUrl(i)}let n=[...s.Z.get(l.kChainedCommandsCommandList)];function d(e,t,i){var s,o;s=t,o=i,n=n.map((e=>{const t=e.chain.map((e=>{const{key:t,param:n}=e;return"3a8efd62-4c8a-4545-8a6c-9cb65518f507"===t&&n===s?{...e,param:o}:{...e}}));return{...e,chain:[...t]}}));const a=e.default===t,l=e.defaultPrivate===t;a&&r.Z.searchEngines.setDefault("defaultSearch",i),l&&(r.Z.searchEngines.setDefault("defaultPrivate",i),r.Z.searchEngines.setDefault("defaultSpeeddialsPrivate",i)),(!e.current&&a||e.current===t)&&r.Z.searchEngines.setDefault("defaultSearchField",i),(!e.currentSD&&a||e.currentSD===t)&&r.Z.searchEngines.setDefault("defaultSpeeddials",i),(!e.currentPrivate&&l||e.currentPrivate===t)&&r.Z.searchEngines.setDefault("defaultSearchFieldPrivate",i)}const c=o.Z.getSync("SEARCH_ENGINE_COLLECTION"),u=o.Z.getDefaultSearchEngines();if(void 0===c)return;for await(const n of u.engines){const i=c.engines.find((e=>e.id===n.id));if(!i)continue;const s=e[i.name],o=p.getByPrepopulateId(s);if(!0===i.removed)o&&r.Z.searchEngines.removeTemplateUrl(o.guid);else{if(i.custom&&o){if(i.url!==(n.url||"")||i.suggestUrl!==(n.suggestUrl||"")||i.name!==(n.name||"")||i.post!==Boolean(n.post)){const e=await t(i);""!==e&&d(c,i.id,e);continue}o.keyword=i.keyword,r.Z.searchEngines.updateTemplateUrl(o)}c.defaultChanged&&o&&d(c,i.id,o.guid)}}const h=c.engines.map((e=>(-1!==u.engines.findIndex((t=>t.id===e.id))||!1!==Boolean(e.custom)||c.default!==e.id&&c.defaultPrivate!==e.id||(e.custom=!0),e))).filter((e=>-1===u.engines.findIndex((t=>t.id===e.id))&&!1!==Boolean(e.custom)&&!0!==Boolean(e.removed)));for await(const e of h){const n=await t(e);""!==n&&d(c,e.id,n)}await new Promise((e=>{o.Z.remove("SEARCH_ENGINE_COLLECTION",(()=>{i.Z.set(l.kChainedCommandsCommandList,n),e()}))}))}},h=p},20244:(e,t,n)=>{"use strict";n(89907)},98010:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>h,gC:()=>p,x0:()=>g});var i=n(29087),s=n(25372),o=n(99498);const a=function(e){try{return decodeURI((0,o.Z)(e))}catch(t){return e}};var r=n(1407),l=n(50503),d=n(89175),c=n(36436),u=n(44850);function p(e){const t=(0,l.ME)(e,["scheme","host","tld","port","path","query","ref"]);return(0,l.Aq)(t).substring(0,r.RL)}function h(e){if(!e)return"";const t=(0,s.Z)(e);t&&"view-source:"!==t.protocol&&"mailto:"!==t.protocol&&(t.username="",t.password="",e=t.href);const n=i.Z.get(d.kAddressBarShowFullUrl)?u.jk.getDisplayUrlFromMapping(e):(0,c.Dy)(u.jk.getDisplayUrlFromMapping(e));return a(n)}function g(e){const t=(0,s.Z)(e);return t&&t.hostname?t.hostname.replace(/^(www\.)/,""):""}},42578:(e,t,n)=>{"use strict";n.d(t,{d:()=>r,q:()=>a});var i=n(25356),s=n(44850),o=n(25372);function a(e){if(s.jk.isInternalUrl(e.url)){if(Object.keys(s.jk.internals).find((t=>e.url.startsWith(s.jk.internals[t]))))return s.jk.getDisplayTitle(e)}return(0,o.Z)((0,i.Z)(e.url))?.hostname||""}function r(e,t){const n=a(e),i=t.filter((e=>"tab"===e.type&&!e.page.pinned&&a(e.page)===n)).map((e=>e.page));return[n,i]}},45454:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>a,ke:()=>o,wJ:()=>r});var i=n(15489),s=n(4027);const o={openInBackgroundTab:{inCurrent:!1,inBackground:!0,inNewWindow:!1,allowOverride:!1,incognito:!1}};function a(e,t){const n={ctrl:Boolean(t.ctrlKey),alt:Boolean(t.altKey),shift:Boolean(t.shiftKey),command:!1},o=n.ctrl,a=!n.shift&&!o&&!n.alt,r={inCurrent:!0,inBackground:!1,inNewWindow:!1,allowOverride:!1,incognito:!1};return n.shift&&o&&n.alt?(r.inNewWindow=!0,r.incognito=!0):n.shift&&o&&!n.alt?(r.inNewWindow=!0,r.incognito=i.ZP.isIncognito(e)):!n.shift||o||n.alt?n.shift||!o||n.alt?a&&t.button===s.Z.kCenter?(r.inCurrent=!1,r.inBackground=!0):a&&t.button===s.Z.kRight?r.inCurrent=!1:a&&(r.allowOverride=!0):(r.inCurrent=!1,r.inBackground=!0):r.inCurrent=!1,r}function r(e,t){const n="number"==typeof t.button?t.button:s.Z.kNone;if(!s.Z.isContextMenuButton(n)&&!s.Z.isNavigationButton(n))return a(e,{ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,button:"number"==typeof t.button?t.button:s.Z.kNone})}},84847:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const i=e=>Boolean(e&&(e.ctrlKey||e.altKey||e.metaKey||e.shiftKey))},60339:(e,t,n)=>{"use strict";n.d(t,{Qz:()=>a,ZN:()=>l,gO:()=>r,kG:()=>d,xz:()=>u});var i=n(96951),s=n(35369),o=n(69046);function a(e){const t=i.ZP.getPageById(e);return!!t&&r(t)}function r(e){const t=(0,o.jA)(e);if(!t)return!1;return i.ZP.getPages(e.windowId).count((e=>e.vivExtData.tiling?.id===t))>1}function l(e){if(e.active)return!0;const t=c(e);return!!t&&t.some((e=>e.active))}function d(e){if(!i.ZP.getPages(e))return(0,s.aV)();const t=i.ZP.getActivePage(e);return t?c(t)||s.aV.of(t):(0,s.aV)()}function c(e){const t=(0,o.jA)(e);return r(e)&&t?i.ZP.getTiles(t,e.windowId):null}function u(e){return!!e&&i.ZP.isGroup(e.vivExtData.group,e.windowId)}},29489:(e,t,n)=>{"use strict";n.d(t,{IN:()=>l,gD:()=>r});var i=n(96951),s=n(26036),o=n(7064);const a=[(0,s.Z)("Transitions Forced"),(0,s.Z)("Filter Obscure"),(0,s.Z)("Filter Grayscale"),(0,s.Z)("Filter Black and White"),(0,s.Z)("Fonts Monospace"),(0,s.Z)("Transform 3D"),(0,s.Z)("Highlight Hover"),(0,s.Z)("CSS Debugger"),(0,s.Z)("Filter Sepia"),(0,s.Z)("Filter Intensify"),(0,s.Z)("Skewed Images"),(0,s.Z)("Highlight Focus"),(0,s.Z)("Transitions Removed"),(0,s.Z)("Filter Invert"),(0,s.Z)("Inline Access Keys"),(0,s.Z)("Page Minimap")];function r(e){const t=e.lastIndexOf("\\"),n=-1===t?e:e.substr(t+1),i=n.lastIndexOf("."),s=n.substr(0,i).replace(/_/g," "),o=a.findIndex((e=>e.labelEnglish===s));return-1===o?s:a[o].label}function l(e){const t=r(e),n=`COMMAND_${t}`.toUpperCase().replace(/\s+/,"_");return{name:n,action:t=>async function(e,t){const n=i.ZP.getActivePage(e);if(n){const e="enabled"===(await o.Z.pageActions.getScriptOverridesForTab(n.id)).find((e=>e.script===t))?.override?"no_override":"enabled";await o.Z.pageActions.setScriptOverrideForTab(t,n.id,e)}}(t.windowId,e),guid:n,showInQC:!1,isEnabled:()=>!0,isVisible:()=>!0,category:"CATEGORY_COMMAND_TAB_ACTION",...(0,s.Z)(t)}}},25356:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var i=n(60910);const s=function(e,t){try{return(0,i.Z)(e,t)}catch(t){return e}}},51877:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var i=n(52373);function s(e,t,n=((e,t,n)=>(0,i.Z)(t[e],n[e]))){if(e===t)return!0;const s=Object.keys(e),o=Object.keys(t);if(s.length!==o.length)return!1;for(let i=0;i<s.length;i++)if(!t.hasOwnProperty(s[i])||!n(s[i],e,t))return!1;return!0}},14789:(e,t,n)=>{"use strict";function i(e,t){const n=e.indexOf(t);if(n<0)return void e.push(t);const i=e[n];e.copyWithin(n,n+1),e[e.length-1]=i}function s(e,t){const n=e.indexOf(t);if(n<0)return void e.unshift(t);const i=e[n];e.copyWithin(1,0,n),e[0]=i}function o(e,t=!1){if(e.length<=1)return e;const n=[...e];if(!0===t){const e=n[n.length-1];n.copyWithin(1,0,n.length-1),n[0]=e}else{const e=n[0];n.copyWithin(0,1),n[n.length-1]=e}return n}n.d(t,{AL:()=>i,EQ:()=>s,JA:()=>o})},50503:(e,t,n)=>{"use strict";n.d(t,{Aq:()=>p,Lk:()=>y,ME:()=>g,dO:()=>f,gC:()=>v,gG:()=>h,kG:()=>u});var i=n(29087),s=n(29526),o=n(7064),a=n(36436),r=n(88778),l=n(42941),d=n(89175),c=n(44850);function u(){return{scheme:null,username:null,password:null,host:null,path:null,ref:null,query:null,port:null,tld:null}}function p(e){const t=e.scheme&&!a.kO.includes(`${e.scheme}:`)&&"vivaldi"!==e.scheme,n=e.path&&"/"!==e.path||e.query||e.ref?e.path:"",i=null!==e.query?`?${e.query}`:"",s=null!==e.ref?`#${e.ref}`:"";return(e.scheme?`${e.scheme}:${t?"//":""}`:"")+(e.username?e.username:"")+(e.password?`:${e.password}`:"")+(e.username||e.password?"@":"")+(e.host?e.host:"")+(e.port?`:${e.port}`:"")+(n||"")+(i||"")+(s||"")}function h(e){const t=i.Z.get(d.kAddressBarShowFullUrl),n=g(e,["tld","host","port","path",...t?["scheme"]:[],...t?["ref"]:[],...t?["query"]:[]]),s=n.path&&"/"!==n.path||n.query?n.path:"";return{...n,path:s}}function g(e,t){const n=t.includes("username"),i=t.includes("password"),s=t.includes("tld"),o=t.includes("host"),a=t.includes("port"),r=t.includes("path"),l=t.includes("scheme"),d=t.includes("ref"),c=t.includes("query");return{scheme:l?e.scheme:"",username:n?e.username:"",password:i?e.password:"",host:o?e.host:"",path:r?e.path:"",ref:d?e.ref:"",query:c?e.query:"",port:a?e.port:"",tld:s?e.tld:""}}function m(e){return void 0===e?null:e}function f(e){const t=c.jk.getDisplayUrlFromMapping(e);if(!t)return{scheme:null,username:null,password:null,host:null,path:null,ref:null,query:null,port:null,tld:null};const n=o.Z.utilities.getUrlFragments(t),i=n.hostForSecurityDisplay?.length?n.hostForSecurityDisplay:n.host,a=n.tldForSecurityDisplay?.length?n.tldForSecurityDisplay:n.tld,r=n.pathForSecurityDisplay??(0,s.Z)(n.path??""),l=n.queryForSecurityDisplay??n.query,d=n.refForSecurityDisplay??(0,s.Z)(n.ref??"");return{scheme:m(n.scheme),username:m(n.username),password:m(n.password),host:m(i),path:m(r),ref:d?m(d):null,query:l?m(l):null,port:m(n.port),tld:m(a)}}function v(e,t){if(!e)return null;if(!t){if(n=(n=e).replace(/\[|\]/g,""),/(?:^(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}$)|(?:^(?:(?:[a-fA-F\d]{1,4}:){7}(?:[a-fA-F\d]{1,4}|:)|(?:[a-fA-F\d]{1,4}:){6}(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|:[a-fA-F\d]{1,4}|:)|(?:[a-fA-F\d]{1,4}:){5}(?::(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,2}|:)|(?:[a-fA-F\d]{1,4}:){4}(?:(?::[a-fA-F\d]{1,4}){0,1}:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,3}|:)|(?:[a-fA-F\d]{1,4}:){3}(?:(?::[a-fA-F\d]{1,4}){0,2}:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,4}|:)|(?:[a-fA-F\d]{1,4}:){2}(?:(?::[a-fA-F\d]{1,4}){0,3}:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,5}|:)|(?:[a-fA-F\d]{1,4}:){1}(?:(?::[a-fA-F\d]{1,4}){0,4}:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,6}|:)|(?::(?:(?::[a-fA-F\d]{1,4}){0,5}:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,7}|:)))(?:%[0-9a-zA-Z]{1,})?$)/gm.test(n)||/(^|\.)localhost(\.localdomain)?\.?$/.test(e))return{basedomain:e,subdomain:"",hostTld:""};if(-1===e.indexOf("."))return null;const t=e.split("."),i=t.splice(-1).join();return{basedomain:t.splice(-1).join(),subdomain:t.join("."),hostTld:i}}var n;const i=e.substring(0,e.length-t.length).split(".").filter(Boolean),s=(0,r.Z)(i).join(".");return{basedomain:(0,l.Z)(i),subdomain:s,hostTld:t}}function y(e){const{path:t}=f((0,a.q9)(e));return!("/"===t&&!e.endsWith("/"))&&(null!==t&&t?.length>0)}},2711:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});n(20244);var i=n(1407);const s=new Map;let o=0;function a(e,t){return new Promise(((n,i)=>{const a=o++;s.set(a,{resolve:n,reject:i});const r={promiseId:a,func:e,args:t};navigator.serviceWorker?.ready.then((e=>e.active?.postMessage({background:r})))}))}function r(e){if(e.origin!==i.oP)return;const{background:t}=e.data;if(!t)return;const{promiseId:n,results:o,error:a}=t,r=s.get(n);if(!r)return void console.error("BackgroundActions: Missing promise ",n);const{resolve:l,reject:d}=r;s.delete(n),a?d(a):l(o)}const l=new class{updateThreads(){return a("updateThreads",[])}stop(){return a("stop",[])}start(){return a("start",[])}addAccount(e){return a("addAccount",[e])}flushBuffer(){return a("flushBuffer",[])}updateFlags(){return a("updateFlags",[])}runSystemTasks(){return a("runSystemTasks",[])}getOAuthAccessToken(e,t){return a("getOAuthAccessToken",[e,t])}fetchAccessTokenAndRefreshToken(e,t){return a("fetchAccessTokenAndRefreshToken",[e,t])}verify(e){return a("verify",[e])}autofill(e){return a("autofill",[e])}signIn(e){return a("signIn",[e])}startBackgroundActions(){navigator.serviceWorker?.addEventListener("message",r,!1)}}},3184:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});n(20244);var i=n(45660),s=n(1407);const o=new Map;let a=0;function r(e,t){return new Promise(((n,i)=>{const s=a++;o.set(s,{resolve:n,reject:i});const r={promiseId:s,func:e,args:t};navigator.serviceWorker?.ready.then((e=>e.active?.postMessage({imap:r})))}))}navigator.serviceWorker?.addEventListener("message",(function(e){if(e.origin!==s.oP)return;const{imap:t}=e.data;if(!t)return;const{promiseId:n,results:a,error:r}=t,l=o.get(n);if(!l)return void i.Z.error("Mail",["ImapActions"],"Missing promise ",n);const{resolve:d,reject:c}=l;o.delete(n),r?c(r):d(a)}),!1);const l={fetchRawOfMessage:function(e,t){return r("fetchRawOfMessage",[e,t])},connectIMAPClient:function(e){return r("connectIMAPClient",[e])},connectIMAPClients:function(){return r("connectIMAPClients",[])},disconnectIMAPClient:function(e){return r("disconnectIMAPClient",[e])},reconnectIMAPClient:function(e){return r("reconnectIMAPClient",[e])},reconnectIMAPClients:function(){return r("reconnectIMAPClients",[])},disconnectIMAPClients:function(){return r("disconnectIMAPClients",[])},checkNewDeletedModified:function(e,t){return r("checkNewDeletedModified",[e,t])},rescanUnreadFlags:function(e,t){return r("rescanUnreadFlags",[e,t])},checkForMail:function(e){return r("checkForMail",[e])},setCheckInterval:function(e,t){return r("setCheckInterval",[e,t])},preFetch:function(e){return r("preFetch",[e])},subscribeMailbox:function(e){return r("subscribeMailbox",[e])},unsubscribeMailbox:function(e,t){return r("unsubscribeMailbox",[e,t])},createMailbox:function(e,t,n){return r("createMailbox",[e,t,n])},deleteMailbox:function(e,t){return r("deleteMailbox",[e,t])},reSyncFolder:function(e,t){return r("reSyncFolder",[e,t])},reSyncAccount:function(e){return r("reSyncAccount",[e])},pausePrefetching:function(e){return r("pausePrefetching",[e])},startAddtoSearchDb:function(){return r("startAddtoSearchDb",[])},getSelectedMailboxes:function(){return r("getSelectedMailboxes",[])}}},75459:(e,t,n)=>{"use strict";n.d(t,{Z:()=>d});n(20244);var i=n(45660),s=n(1407);const o=new Map;let a=0;function r(e,t){return new Promise(((n,i)=>{const s=a++;o.set(s,{resolve:n,reject:i});const r={promiseId:s,func:e,args:t};navigator.serviceWorker?.ready.then((e=>e.active?.postMessage({pop:r})))}))}function l(e){if(e.origin!==s.oP)return;const{pop:t}=e.data;if(!t)return;const{promiseId:n,results:a,error:r}=t,l=o.get(n);if(!l)return void i.Z.error("Mail",["PopActions"],"Missing promise ",n);const{resolve:d,reject:c}=l;o.delete(n),r?c(new Error(r)):d(a)}const d=new class{constructor(){navigator.serviceWorker?.addEventListener("message",l,!1)}checkForMail(e){return r("checkForMail",[e])}deletePopMail(e,t){return r("deletePopMail",[e,t])}getPopMessage(e,t,n){return r("getPopMessage",[e,t,n])}setCheckInterval(e,t){return r("setCheckInterval",[e,t])}}},24325:e=>{e.exports='<svg class="bookmarklet" width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">\n    <path fill-rule="evenodd" clip-rule="evenodd" d="M3 13V2C3 1.44772 3.44772 1 4 1H8.79289C8.9255 1 9.05268 1.05268 9.14645 1.14645L12.8536 4.85355C12.9473 4.94732 13 5.0745 13 5.20711V13C13 13.5523 12.5523 14 12 14H4C3.44772 14 3 13.5523 3 13ZM7.53033 4.96967C7.23744 4.67678 6.76256 4.67678 6.46967 4.96967C6.17678 5.26256 6.17678 5.73744 6.46967 6.03033L8.43934 8L6.46967 9.96967C6.17678 10.2626 6.17678 10.7374 6.46967 11.0303C6.76256 11.3232 7.23744 11.3232 7.53033 11.0303L10.0303 8.53033L10.5607 8L10.0303 7.46967L7.53033 4.96967Z"/>\n</svg>\n'},87922:e=>{e.exports='<svg class="onboarding-illustration" fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 220 164">\n  <g clip-path="url(#clip-0-calendar-density)">\n    <rect class="bg-fill" width="220" height="164" rx="3"/>\n    <g clip-path="url(#clip-1-calendar-density)" class="highlight-fill">\n      <path opacity=".32" fill-rule="evenodd" clip-rule="evenodd" d="M52 0v164h1V0h-1zm113 0v164h1V0h-1z" fill-opacity=".25"/>\n      <path opacity=".3" fill-rule="evenodd" clip-rule="evenodd" d="M-50 19a3 3 0 00-3 3v62a3 3 0 003 3h93a3 3 0 003-3V22a3 3 0 00-3-3h-93zm223 3a3 3 0 013-3h93a3 3 0 013 3v6a3 3 0 01-3 3h-93a3 3 0 01-3-3v-6zM60 78a3 3 0 013-3h93a3 3 0 013 3v62a3 3 0 01-3 3H63a3 3 0 01-3-3V78zm113-28a3 3 0 013-3h93a3 3 0 013 3v34a3 3 0 01-3 3h-93a3 3 0 01-3-3V50zm3 53a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3h-93zm-229 3a3 3 0 013-3h93a3 3 0 013 3v6a3 3 0 01-3 3h-93a3 3 0 01-3-3v-6zm229 25a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3h-93z"/>\n      <rect x="60" y="19" width="99" height="40" rx="3"/>\n    </g>\n  </g>\n  <defs>\n    <clipPath id="clip-0-calendar-density">\n      <rect class="bg-fill" width="220" height="164" rx="3"/>\n    </clipPath>\n    <clipPath id="clip-1-calendar-density">\n      <path class="bg-fill" d="M0 0h220v164H0z" rx="3"/>\n    </clipPath>\n  </defs>\n</svg>\n'},18767:e=>{e.exports='<svg class="onboarding-illustration" fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 220 164">\n  <rect width="220" height="164" rx="3" class="bg-fill"/>\n  <g clip-path="url(#clip-0-calendar-density)" class="highlight-fill">\n    <path opacity=".32" fill-rule="evenodd" clip-rule="evenodd" d="M52 0v164h1V0h-1zm113 0v164h1V0h-1z" fill-opacity=".25"/>\n    <path opacity=".3" fill-rule="evenodd" clip-rule="evenodd" d="M-50 19a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3h-93zm110 3a3 3 0 013-3h93a3 3 0 013 3v6a3 3 0 01-3 3H63a3 3 0 01-3-3v-6zm0 84a3 3 0 013-3h93a3 3 0 013 3v6a3 3 0 01-3 3H63a3 3 0 01-3-3v-6zm3 25a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3H63zM173 22a3 3 0 013-3h93a3 3 0 013 3v6a3 3 0 01-3 3h-93a3 3 0 01-3-3v-6zm0 28a3 3 0 013-3h93a3 3 0 013 3v6a3 3 0 01-3 3h-93a3 3 0 01-3-3v-6zm-223-3a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3h-93zm-3 31a3 3 0 013-3h93a3 3 0 013 3v6a3 3 0 01-3 3h-93a3 3 0 01-3-3v-6zm229 25a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3h-93zm-229 3a3 3 0 013-3h93a3 3 0 013 3v6a3 3 0 01-3 3h-93a3 3 0 01-3-3v-6zm229 25a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3h-93z"/>\n    <rect x="60" y="75" width="99" height="12" rx="3"/>\n  </g>\n  <defs>\n    <clipPath id="clip-0-calendar-density">\n      <path class="bg-fill" d="M0 0h220v164H0z" rx="3"/>\n    </clipPath>\n  </defs>\n</svg>\n'},36502:e=>{e.exports='<svg class="onboarding-illustration" fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 220 164">\n  <g clip-path="url(#clip-calendar-inline-editor)">\n    <rect class="bg-fill" width="220" height="164" rx="3"/>\n    <rect class="highlight-stroke" x="62" y="40" width="97" height="83" rx="3" stroke-width="2"/>\n    <path class="highlight-stroke" opacity=".32" stroke-opacity=".25" d="M53.5 0v164"/>\n    <path class="highlight-stroke" opacity=".32" stroke-opacity=".25" d="M166.5 0v164"/>\n    <path class="highlight-fill" opacity=".1" fill-rule="evenodd" clip-rule="evenodd" d="M-49 19a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3h-93zm113 0a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3H64zm0 112a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3H64zM174 22a3 3 0 013-3h93a3 3 0 013 3v6a3 3 0 01-3 3h-93a3 3 0 01-3-3v-6zm0 28a3 3 0 013-3h93a3 3 0 013 3v6a3 3 0 01-3 3h-93a3 3 0 01-3-3v-6zm-223-3a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3h-93zm223 31a3 3 0 013-3h93a3 3 0 013 3v6a3 3 0 01-3 3h-93a3 3 0 01-3-3v-6zm-223-3a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3h-93zm223 31a3 3 0 013-3h93a3 3 0 013 3v6a3 3 0 01-3 3h-93a3 3 0 01-3-3v-6zm-223-3a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3h-93zm223 31a3 3 0 013-3h93a3 3 0 013 3v6a3 3 0 01-3 3h-93a3 3 0 01-3-3v-6zm-223-3a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3h-93z"/>\n    <path class="highlight-stroke" stroke-opacity=".25" d="M69 54.5h83"/>\n    <path class="highlight-stroke" stroke-opacity=".25" d="M69 67.5h83"/>\n    <path class="highlight-stroke" stroke-opacity=".25" d="M69 80.5h83"/>\n    <path class="highlight-stroke" stroke-opacity=".25" d="M69 93.5h83"/>\n    <rect class="highlight-fill" x="69" y="102" width="41" height="14" rx="2"/>\n    <rect class="highlight-stroke" opacity=".5" x="117" y="103" width="34" height="12" rx="1" stroke-width="2"/>\n  </g>\n  <defs>\n    <clipPath id="clip-calendar-inline-editor">\n      <path class="bg-fill" d="M0 0h220v164H0z"/>\n    </clipPath>\n  </defs>\n</svg>\n'},46647:e=>{e.exports='<svg class="onboarding-illustration" fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 220 164">\n  <rect class="bg-fill" width="220" height="164" rx="3"/>\n  <g clip-path="url(#clip-calendar-popup-editor)">\n    <path class="highlight-stroke" opacity=".32" stroke-opacity=".25" d="M52.5 0v164"/>\n    <path class="highlight-stroke" opacity=".32" stroke-opacity=".25" d="M165.5 0v164"/>\n    <path class="highlight-fill" opacity=".1" fill-rule="evenodd" clip-rule="evenodd" d="M-50 19a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3h-93zm113 0a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3H63zm0 112a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3H63zM173 22a3 3 0 013-3h93a3 3 0 013 3v6a3 3 0 01-3 3h-93a3 3 0 01-3-3v-6zm0 28a3 3 0 013-3h93a3 3 0 013 3v6a3 3 0 01-3 3h-93a3 3 0 01-3-3v-6zm-223-3a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3h-93zm223 31a3 3 0 013-3h93a3 3 0 013 3v6a3 3 0 01-3 3h-93a3 3 0 01-3-3v-6zm-223-3a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3h-93zm223 31a3 3 0 013-3h93a3 3 0 013 3v6a3 3 0 01-3 3h-93a3 3 0 01-3-3v-6zm-223-3a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3h-93zm223 31a3 3 0 013-3h93a3 3 0 013 3v6a3 3 0 01-3 3h-93a3 3 0 01-3-3v-6zm-223-3a3 3 0 00-3 3v6a3 3 0 003 3h93a3 3 0 003-3v-6a3 3 0 00-3-3h-93z"/>\n  </g>\n  <path class="bg-fill" fill-rule="evenodd" clip-rule="evenodd" d="M32 25a3 3 0 00-3 3v102a3 3 0 003 3h74l4.5 4.5 4.5-4.5h74a3 3 0 003-3V28a3 3 0 00-3-3H32z"/>\n  <path class="highlight-fill" d="M106 133l.7-.7-.29-.3H106v1zm4.5 4.5l-.7.7.7.71.7-.7-.7-.71zm4.5-4.5v-1h-.41l-.3.3.71.7zM30 28c0-1.1.9-2 2-2v-2a4 4 0 00-4 4h2zm0 102V28h-2v102h2zm2 2a2 2 0 01-2-2h-2a4 4 0 004 4v-2zm74 0H32v2h74v-2zm5.2 4.8l-4.5-4.5-1.4 1.4 4.5 4.5 1.4-1.4zm3.1-4.5l-4.5 4.5 1.4 1.4 4.5-4.5-1.4-1.4zm74.7-.3h-74v2h74v-2zm2-2a2 2 0 01-2 2v2a4 4 0 004-4h-2zm0-102v102h2V28h-2zm-2-2a2 2 0 012 2h2a4 4 0 00-4-4v2zM32 26h157v-2H32v2z"/>\n  <rect class="highlight-fill" x="41" y="108" width="46" height="14" rx="2"/>\n  <rect class="highlight-stroke" opacity=".5" x="94" y="109" width="44" height="12" rx="1" stroke-width="2"/>\n  <path class="highlight-fill" fill-rule="evenodd" clip-rule="evenodd" d="M41 46h134v-1H41v1zm0 14h134v-1H41v1zm134 14H41v-1h134v1zM41 88h134v-1H41v1z" fill-opacity=".25"/>\n  <defs>\n    <clipPath id="clip-calendar-popup-editor">\n      <path class="bg-fill" d="M0 0h220v164H0z"/>\n    </clipPath>\n  </defs>\n</svg>\n'},9371:e=>{e.exports='<svg width="140" height="96" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <rect x=".5" y=".5" width="139" height="95" rx="1.5" class="border" opacity=".5"/>\n  <g opacity=".3">\n    <path d="M35 0v96h1V0h-1ZM104 0v96h1V0h-1ZM109 9a3 3 0 0 1 3-3h28v12h-28a3 3 0 0 1-3-3V9ZM0 6v12h28a3 3 0 0 0 3-3V9a3 3 0 0 0-3-3H0ZM40 9a3 3 0 0 1 3-3h54a3 3 0 0 1 3 3v6a3 3 0 0 1-3 3H43a3 3 0 0 1-3-3V9ZM112 24a3 3 0 0 0-3 3v6a3 3 0 0 0 3 3h28V24h-28ZM0 24h28a3 3 0 0 1 3 3v6a3 3 0 0 1-3 3H0V24ZM112 42a3 3 0 0 0-3 3v6a3 3 0 0 0 3 3h28V42h-28ZM0 42h28a3 3 0 0 1 3 3v6a3 3 0 0 1-3 3H0V42ZM112 60a3 3 0 0 0-3 3v6a3 3 0 0 0 3 3h28V60h-28ZM0 60h28a3 3 0 0 1 3 3v6a3 3 0 0 1-3 3H0V60ZM112 78a3 3 0 0 0-3 3v6a3 3 0 0 0 3 3h28V78h-28ZM0 78h28a3 3 0 0 1 3 3v6a3 3 0 0 1-3 3H0V78ZM42 78a3 3 0 0 0-3 3v6a3 3 0 0 0 3 3h54a3 3 0 0 0 3-3v-6a3 3 0 0 0-3-3H42Z"/>\n  </g>\n  <rect class="background-intenser" x="40" y="24" width="60" height="48" rx="3"/>\n  <path class="highlight" fill-rule="evenodd" clip-rule="evenodd" d="M43 24a3 3 0 0 0-3 3v42a3 3 0 0 0 3 3h54a3 3 0 0 0 3-3V27a3 3 0 0 0-3-3H43Zm54 1H43a2 2 0 0 0-2 2v42a2 2 0 0 0 2 2h54a2 2 0 0 0 2-2V27a2 2 0 0 0-2-2Z"/>\n  <g class="highlight" opacity=".2">\n    <path d="M49 35h42v-1H49v1ZM49 43h42v-1H49v1ZM91 51H49v-1h42v1Z"/>\n    <path fill-rule="evenodd" clip-rule="evenodd" d="M72 59a1 1 0 0 1 1-1h17a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H73a1 1 0 0 1-1-1v-6Zm1 0h17v6H73v-6Z"/>\n  </g>\n  <rect class="highlight" x="49" y="58" width="21" height="8" rx="1"/>\n</svg>\n'},97487:e=>{e.exports='<svg width="140" height="96" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <rect x=".5" y=".5" width="139" height="95" rx="1.5" class="border" opacity=".5"/>\n  <g opacity=".3">\n    <path d="M35 0v96h1V0h-1ZM104 0v96h1V0h-1ZM109 9a3 3 0 0 1 3-3h28v12h-28a3 3 0 0 1-3-3V9ZM0 6v12h28a3 3 0 0 0 3-3V9a3 3 0 0 0-3-3H0ZM40 9a3 3 0 0 1 3-3h54a3 3 0 0 1 3 3v6a3 3 0 0 1-3 3H43a3 3 0 0 1-3-3V9ZM112 24a3 3 0 0 0-3 3v6a3 3 0 0 0 3 3h28V24h-28ZM0 24h28a3 3 0 0 1 3 3v6a3 3 0 0 1-3 3H0V24ZM112 42a3 3 0 0 0-3 3v6a3 3 0 0 0 3 3h28V42h-28ZM0 42h28a3 3 0 0 1 3 3v6a3 3 0 0 1-3 3H0V42ZM112 60a3 3 0 0 0-3 3v6a3 3 0 0 0 3 3h28V60h-28ZM0 60h28a3 3 0 0 1 3 3v6a3 3 0 0 1-3 3H0V60ZM112 78a3 3 0 0 0-3 3v6a3 3 0 0 0 3 3h28V78h-28ZM0 78h28a3 3 0 0 1 3 3v6a3 3 0 0 1-3 3H0V78ZM42 78a3 3 0 0 0-3 3v6a3 3 0 0 0 3 3h54a3 3 0 0 0 3-3v-6a3 3 0 0 0-3-3H42Z"/>\n  </g>\n  <path class="background-intenser" d="M27 13a3 3 0 0 0-3 3v62a3 3 0 0 0 3 3h40l2.75 2.75L72.5 81H113a3 3 0 0 0 3-3V16a3 3 0 0 0-3-3H27Z"/>\n  <path class="highlight" fill-rule="evenodd" clip-rule="evenodd" d="M23.5 16a3.5 3.5 0 0 1 3.5-3.5h86a3.5 3.5 0 0 1 3.5 3.5v62a3.5 3.5 0 0 1-3.5 3.5H72.707l-2.957 2.957-2.957-2.957H27a3.5 3.5 0 0 1-3.5-3.5V16Zm3.5-2.5a2.5 2.5 0 0 0-2.5 2.5v62a2.5 2.5 0 0 0 2.5 2.5h40.207l2.543 2.543 2.543-2.543H113a2.5 2.5 0 0 0 2.5-2.5V16a2.5 2.5 0 0 0-2.5-2.5H27Z"/>\n  <g class="highlight" opacity=".2">\n    <path d="M105 25H35v-1h70v1ZM105 34H35v-1h70v1ZM35 43h70v-1H35v1ZM105 52H35v-1h70v1Z"/>\n    <path fill-rule="evenodd" clip-rule="evenodd" d="M58 65a1 1 0 0 1 1-1h18a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H59a1 1 0 0 1-1-1v-6Zm1 0h18v6H59v-6Z"/>\n  </g>\n  <rect class="highlight" x="35" y="64" width="21" height="8" rx="1"/>\n</svg>\n'},28888:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 72">\n  <path fill-rule="evenodd" d="M66.27 66.27C60.55 72 51.77 72 36 72c-15.78 0-24.55 0-30.27-5.73C0 60.54 0 51.77 0 36S0 11.46 5.73 5.73C11.45 0 20.23 0 36 0c15.78 0 24.55 0 30.27 5.73C72 11.46 72 20.23 72 36s0 24.54-5.73 30.27zM51.16 20.21c2.79 0 5.05 2.26 5.05 5.05v25.27c0 2.79-2.26 5.05-5.05 5.05H20.84a5.05 5.05 0 01-5.05-5.05V25.26c0-2.79 2.26-5.05 5.05-5.05h2.53v-2.53a2.53 2.53 0 015.05 0v2.53h5.05v-2.53a2.53 2.53 0 015.06 0v2.53h5.05v-2.53a2.53 2.53 0 015.05 0v2.53h2.53zm-2.53 30.32c1.4 0 2.53-1.13 2.53-2.53V30.32c0-1.4-1.13-2.53-2.53-2.53H23.37a2.53 2.53 0 00-2.53 2.53V48c0 1.4 1.13 2.53 2.53 2.53h25.26zM30.95 32.84h-5.06v5.05h5.06v-5.05zm7.58 5.05v-5.05h-5.06v5.05h5.06zm-7.58 2.53h-5.06v5.05h5.06v-5.05zm7.58 5.05v-5.05h-5.06v5.05h5.06zm7.58-12.63h-5.06v5.05h5.06v-5.05zm0 7.58h-5.06v5.05h5.06v-5.05z" opacity=".3"/>\n  <path fill-rule="evenodd" d="M24.9 31.84h7.05v7.05h-7.06v-7.05zm14.63 0v7.05h-7.06v-7.05h7.06zm-14.64 7.58h7.06v7.05h-7.06v-7.05zm14.64 0v7.05h-7.06v-7.05h7.06zm.52-7.58h7.06v7.05h-7.06v-7.05zm0 7.58h7.06v7.05h-7.06v-7.05zM54.76 70.3c4.76-.7 8.15-2.07 10.8-4.73 2.66-2.65 4.04-6.04 4.73-10.8.7-4.8.71-10.84.71-18.76 0-7.92 0-13.97-.7-18.76-.7-4.76-2.08-8.15-4.73-10.8C62.9 3.78 59.52 2.4 54.76 1.7 49.96 1 43.92 1 36 1c-7.92 0-13.97 0-18.76.7-4.76.7-8.15 2.08-10.8 4.74-2.66 2.65-4.04 6.04-4.73 10.8C1 22.04 1 28.08 1 36c0 7.92 0 13.97.7 18.76.7 4.76 2.08 8.15 4.73 10.8 2.66 2.66 6.05 4.04 10.81 4.73 4.8.7 10.84.71 18.76.71 7.92 0 13.97 0 18.76-.7zm-3.6-51.08a6.05 6.05 0 016.05 6.05v25.27a6.05 6.05 0 01-6.05 6.05H20.84a6.05 6.05 0 01-6.05-6.05V25.26a6.05 6.05 0 016.05-6.05h1.53v-1.53a3.53 3.53 0 017.05 0v1.53h3.05v-1.53a3.53 3.53 0 017.06 0v1.53h3.05v-1.53a3.53 3.53 0 017.05 0v1.53h1.53zm-2.53 30.32c.84 0 1.53-.69 1.53-1.53V30.32c0-.85-.69-1.53-1.53-1.53H23.37c-.84 0-1.53.68-1.53 1.53V48c0 .84.69 1.53 1.53 1.53h25.26zM36 72c15.78 0 24.55 0 30.27-5.73C72 60.54 72 51.77 72 36s0-24.54-5.73-30.27C60.55 0 51.77 0 36 0 20.22 0 11.45 0 5.73 5.73 0 11.46 0 20.23 0 36s0 24.54 5.73 30.27C11.45 72 20.23 72 36 72zm20.21-46.74a5.05 5.05 0 00-5.05-5.05h-2.53v-2.53a2.53 2.53 0 00-5.05 0v2.53h-5.05v-2.53a2.53 2.53 0 00-5.06 0v2.53h-5.05v-2.53a2.53 2.53 0 00-5.05 0v2.53h-2.53a5.05 5.05 0 00-5.05 5.05v25.27c0 2.79 2.26 5.05 5.05 5.05h30.32c2.79 0 5.05-2.26 5.05-5.05V25.26zM51.16 48c0 1.4-1.13 2.53-2.53 2.53H23.37A2.53 2.53 0 0120.84 48V30.32c0-1.4 1.13-2.53 2.53-2.53h25.26c1.4 0 2.53 1.13 2.53 2.53V48zM30.95 32.84v5.05h-5.06v-5.05h5.06zm7.58 5.05h-5.06v-5.05h5.06v5.05zm-7.58 2.53v5.05h-5.06v-5.05h5.06zm7.58 5.05h-5.06v-5.05h5.06v5.05zm7.58-12.63v5.05h-5.06v-5.05h5.06zm0 7.58v5.05h-5.06v-5.05h5.06z"/>\n</svg>\n'},46639:e=>{e.exports='\x3c!--  Mask definitions for SVG icons --\x3e\n<defs>\n  \x3c!-- shared paths --\x3e\n  <path id="sync-cloud"\n    d="M13.996 7.172C15.164 7.585 16 8.697 16 10c0 1.657-1.337 3-3.01 3H3.01C1.346 13 0 11.653 0 10c0-1.314.84-2.43 2.022-2.836C2.187 5.942 3.232 5 4.5 5c.667 0 1.272.26 1.72.686C6.765 4.123 8.25 3 10 3c2.21 0 4 1.79 4 4 0 .058 0 .115-.004.172z"/>\n\n  \x3c!-- content blocker --\x3e\n  <path id="shield-shadow" d="M8 14.5c2.432-1.085 4.601-3.009 5.5-5v-7L8 1.5v13z" fill-opacity=".1"/>\n  <path id="shield-outline" d="m8 1.5-5.5 1v7C4 12 5 13 8 14.5c3-1.5 4-2.5 5.5-5v-7L8 1.5z" stroke="currentColor" fill="none"/>\n  <mask id="shield-mask">\n    <path d="M2 11 12 1H2v10zm12-6L4 15h10V5z" fill="#fff"/>\n  </mask>\n\n  \x3c!-- gradients --\x3e\n  <linearGradient id="border-gradient" x1="0" y1="0" x2="0" y2="1">\n    <stop stop-color="#fff" stop-opacity="0.3" offset="0"/>\n    <stop stop-color="#fff" stop-opacity="0.6" offset="1"/>\n  </linearGradient>\n\n  <linearGradient x1="0.15" y1="0.3" x2="0.3" y2="0.5" id="guest-intro-bg-gradient">\n    <stop offset="0" stop-color="var(--colorFg)" stop-opacity="0.03" />\n    <stop offset="1" stop-color="var(--colorFg)" stop-opacity="0.003" />\n  </linearGradient>\n\n  <linearGradient id="private-ghost-gradient" x1="35" y1="0" x2="35" y2="80" gradientUnits="userSpaceOnUse">\n    <stop stop-color="var(--colorFg)" stop-opacity=".8"/>\n    <stop stop-color="var(--colorFg)" offset="1" stop-opacity=".2"/>\n  </linearGradient>\n\n\n  \x3c!-- masks --\x3e\n  <mask id="icon-mask">\n    <path d="M4 14v-12h7v12l-3.5-2.8-3.5 2.8z"\n      stroke="url(#border-gradient)"\n      stroke-width="2"\n      stroke-opacity="1"/>\n  </mask>\n\n  \x3c!-- patterns --\x3e\n  <pattern id="diagonalLinePattern" x="4" y="4" width="8" height="8" patternUnits="userSpaceOnUse" patternTransform="rotate(45)">\n    <rect x="0" y="0" width="4" height="8" style="stroke: none; fill: var(--colorHighlightBg)" />\n  </pattern>\n\n</defs>\n'},12165:e=>{e.exports='<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M13 12C14.1046 12 15 11.1046 15 10V4C15 2.89543 14.1046 2 13 2H3C1.89543 2 1 2.89543 1 4V10C1 11.1046 1.89543 12 3 12H13Z" stroke="currentColor"/>\n<path d="M4 14L12 14" stroke="currentColor" stroke-linecap="round"/>\n<rect opacity="0.5" x="6" y="12" width="4" height="2" fill="currentColor"/>\n<path d="M1 10H15C15 11.1046 14.1046 12 13 12H3C1.89543 12 1 11.1046 1 10Z" fill="currentColor"/>\n</svg>'},36980:e=>{e.exports='<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M10 15C11.1046 15 12 14.1046 12 13V3C12 1.89543 11.1046 1 10 1H6C4.89543 1 4 1.89543 4 3V13C4 14.1046 4.89543 15 6 15H10Z" stroke="currentColor"/>\n<path d="M4 13H12C12 14.1046 11.1046 15 10 15H6C4.89543 15 4 14.1046 4 13Z" fill="currentColor"/>\n<circle cx="8" cy="3.25" r="0.75" fill="currentColor"/>\n</svg>'},11746:e=>{e.exports='<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M11 15C12.1046 15 13 14.1046 13 13V3C13 1.89543 12.1046 1 11 1H5C3.89543 1 3 1.89543 3 3V13C3 14.1046 3.89543 15 5 15H11Z" stroke="currentColor"/>\n<path d="M3 2C3 1.44772 3.44772 1 4 1H12C12.5523 1 13 1.44772 13 2V3H3V2Z" fill="currentColor"/>\n<path d="M3 14C3 14.5523 3.44772 15 4 15H12C12.5523 15 13 14.5523 13 14V13H3V14Z" fill="currentColor"/>\n</svg>\n'},70942:e=>{e.exports='<svg width="12" height="12" xmlns="http://www.w3.org/2000/svg">\n  <path fill-rule="evenodd" clip-rule="evenodd" d="M10.146 5.146 8.854 3.854l-3 3a.5.5 0 1 1-.708-.708l3-3-1.292-1.292A.5.5 0 0 1 7.207 1H11v3.793a.5.5 0 0 1-.854.353ZM1.5 2A1.5 1.5 0 0 0 0 3.5v7A1.5 1.5 0 0 0 1.5 12h7a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0v2a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1-.5-.5v-7a.5.5 0 0 1 .5-.5h3a.5.5 0 0 0 0-1h-3Z"/>\n</svg>\n'},89182:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 72">\n  <path fill-opacity=".3" fill-rule="evenodd" d="M66.27 66.27C60.55 72 51.77 72 36 72c-15.78 0-24.55 0-30.27-5.73C0 60.54 0 51.77 0 36S0 11.46 5.73 5.73C11.45 0 20.23 0 36 0c15.78 0 24.55 0 30.27 5.73C72 11.46 72 20.23 72 36s0 24.54-5.73 30.27zm-7.6-13.73H13.19a3.8 3.8 0 01-3.79-3.79V27.57l26.22 14.9 26.84-15.41v21.7a3.8 3.8 0 01-3.8 3.78zM13.19 19.07a3.8 3.8 0 00-3.66 2.82L35.61 36.7l26.57-15.26a3.8 3.8 0 00-3.51-2.38H13.19z"/>\n  <path fill-rule="evenodd" d="M8.4 25.85l27.22 15.47 27.84-16v23.43a4.8 4.8 0 01-4.8 4.8H13.2a4.8 4.8 0 01-4.79-4.8v-22.9zm27.22 16.62L9.4 27.57v21.18a3.8 3.8 0 003.8 3.8h45.47a3.8 3.8 0 003.79-3.8v-21.7L35.62 42.48zM8.37 22.37l.2-.74a4.8 4.8 0 014.62-3.56h45.48a4.8 4.8 0 014.44 3l.33.81L35.6 37.87 8.37 22.37zM54.76 70.3c4.76-.7 8.15-2.07 10.8-4.73 2.66-2.65 4.04-6.04 4.73-10.8.7-4.8.71-10.84.71-18.76 0-7.92 0-13.97-.7-18.76-.7-4.76-2.08-8.15-4.73-10.8C62.9 3.78 59.52 2.4 54.76 1.7 49.96 1 43.92 1 36 1c-7.92 0-13.97 0-18.76.7-4.76.7-8.15 2.08-10.8 4.74-2.66 2.65-4.04 6.04-4.73 10.8C1 22.04 1 28.08 1 36c0 7.92 0 13.97.7 18.76.7 4.76 2.08 8.15 4.73 10.8 2.66 2.66 6.05 4.04 10.81 4.73 4.8.7 10.84.71 18.76.71 7.92 0 13.97 0 18.76-.7zM35.61 36.71L9.53 21.9a3.8 3.8 0 013.66-2.82h45.48a3.8 3.8 0 013.51 2.38L35.61 36.7zM36 72c15.78 0 24.55 0 30.27-5.73C72 60.54 72 51.77 72 36s0-24.54-5.73-30.27C60.55 0 51.77 0 36 0 20.22 0 11.45 0 5.73 5.73 0 11.46 0 20.23 0 36s0 24.54 5.73 30.27C11.45 72 20.23 72 36 72z"/>\n</svg>\n'},51491:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 70 80">\n  <path d="M35.002 0c-.772 0-1.549.028-2.33.083-8.999.87-17.366 5.457-23.425 12.843C3.188 20.312-.113 29.951.003 39.91v33.27c-.001.482.084.96.252 1.406.167.446.414.851.724 1.192.31.34.679.61 1.084.792a3.045 3.045 0 002.535-.01 3.25 3.25 0 001.061-.797c.82-.905 1.933-1.413 3.093-1.413s2.273.508 3.094 1.413l2.563 2.825c.82.905 1.933 1.413 3.093 1.413s2.273-.508 3.094-1.413l2.562-2.825c.82-.905 1.933-1.413 3.094-1.413 1.16 0 2.273.508 3.093 1.413l2.563 2.825C32.728 79.492 33.84 80 35 80s2.273-.508 3.094-1.413l2.563-2.825c.82-.905 1.933-1.413 3.093-1.413s2.273.508 3.093 1.413l2.563 2.825c.82.905 1.933 1.413 3.094 1.413 1.16 0 2.273-.508 3.093-1.413l2.563-2.825c.82-.905 1.933-1.413 3.093-1.413s2.273.508 3.094 1.413c.302.34.662.611 1.06.796a3.042 3.042 0 002.535.01 3.305 3.305 0 001.085-.791c.31-.34.557-.746.724-1.192.168-.445.253-.924.252-1.406V38.587c0-10.234-3.688-20.048-10.251-27.285C53.185 4.066 44.284 0 35 0zm-8.75 36.176c0 1.43-.385 2.83-1.106 4.02-.721 1.189-1.746 2.116-2.945 2.664-1.2.547-2.519.69-3.792.412-1.272-.28-2.442-.969-3.36-1.98-.917-1.012-1.542-2.302-1.795-3.705a7.927 7.927 0 01.373-4.18c.497-1.322 1.338-2.452 2.417-3.247a6.137 6.137 0 013.646-1.22c1.74 0 3.41.763 4.64 2.12 1.23 1.356 1.922 3.197 1.922 5.116zm30.624 0c0 1.43-.385 2.83-1.106 4.02-.722 1.189-1.746 2.116-2.945 2.664-1.2.547-2.519.69-3.792.412-1.273-.28-2.442-.969-3.36-1.98-.918-1.012-1.543-2.302-1.796-3.705a7.928 7.928 0 01.374-4.18c.496-1.322 1.337-2.452 2.417-3.247a6.137 6.137 0 013.645-1.22c1.74 0 3.41.763 4.64 2.12 1.231 1.356 1.923 3.197 1.923 5.116z" fill="url(#private-ghost-gradient)"/>\n</svg>\n'},48783:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12">\n  <path d="M10 0H2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zM5 9H3V3h2zm4 0H7V3h2z"/>\n</svg>'},55592:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 72">\n  <path fill-rule="evenodd" d="M66.27 66.27C60.55 72 51.77 72 36 72c-15.78 0-24.55 0-30.27-5.73C0 60.54 0 51.77 0 36S0 11.46 5.73 5.73C11.45 0 20.23 0 36 0c15.78 0 24.55 0 30.27 5.73C72 11.46 72 20.23 72 36s0 24.54-5.73 30.27zM52.71 54.32a2.8 2.8 0 002.86-2.97A38.63 38.63 0 0020.02 15.8a2.8 2.8 0 00-2.97 2.86v.3a3.2 3.2 0 002.97 3.1A32.38 32.38 0 0149.3 51.36a3.2 3.2 0 003.1 2.97h.31zm-23.77-5.95a5.94 5.94 0 11-11.89 0 5.94 5.94 0 0111.89 0zm14.7 2.98c.18 1.63-1.17 2.97-2.81 2.97h-.25c-1.64 0-2.95-1.34-3.19-2.97a20.55 20.55 0 00-17.38-17.37c-1.62-.24-2.96-1.55-2.96-3.19v-.25c0-1.64 1.34-2.99 2.97-2.8a26.74 26.74 0 0123.61 23.61z" opacity=".3"/>\n  <path fill-rule="evenodd" d="M54.76 70.3c4.76-.7 8.15-2.08 10.8-4.73 2.66-2.66 4.04-6.05 4.73-10.81.7-4.8.71-10.84.71-18.76 0-7.92 0-13.97-.7-18.76-.7-4.76-2.08-8.15-4.73-10.8C62.9 3.78 59.52 2.4 54.76 1.7 49.96 1 43.92 1 36 1c-7.92 0-13.97 0-18.76.7-4.76.7-8.15 2.08-10.8 4.74-2.66 2.65-4.04 6.04-4.73 10.8C1 22.04 1 28.08 1 36c0 7.92 0 13.97.7 18.76.7 4.76 2.08 8.15 4.73 10.8 2.66 2.66 6.05 4.04 10.81 4.73 4.8.7 10.84.71 18.76.71 7.92 0 13.97 0 18.76-.7zm1.8-19.03a3.8 3.8 0 01-3.85 4.05h-.3a4.2 4.2 0 01-4.1-3.88 31.38 31.38 0 00-28.38-28.38 4.2 4.2 0 01-3.88-4.1v-.3a3.8 3.8 0 014.05-3.86 39.63 39.63 0 0136.47 36.47zm-26.62-2.9a6.94 6.94 0 11-13.89 0 6.94 6.94 0 0113.89 0zm14.69 2.87c.25 2.3-1.64 4.08-3.8 4.08h-.25c-2.22 0-3.88-1.8-4.18-3.82a19.55 19.55 0 00-16.53-16.53c-2.03-.3-3.82-1.96-3.82-4.18v-.25c0-2.16 1.78-4.05 4.08-3.8a27.75 27.75 0 0124.5 24.5zM36 72c15.78 0 24.55 0 30.27-5.73C72 60.54 72 51.77 72 36s0-24.54-5.73-30.27C60.55 0 51.77 0 36 0 20.22 0 11.45 0 5.73 5.73 0 11.46 0 20.23 0 36s0 24.54 5.73 30.27C11.45 72 20.23 72 36 72zm19.57-20.65a2.8 2.8 0 01-2.86 2.97h-.3a3.2 3.2 0 01-3.1-2.97 32.38 32.38 0 00-29.29-29.28 3.2 3.2 0 01-2.97-3.11v-.3a2.8 2.8 0 012.97-2.86 38.63 38.63 0 0135.55 35.55zM23 54.32a5.94 5.94 0 100-11.9 5.94 5.94 0 000 11.9zm17.83 0c1.64 0 2.99-1.34 2.8-2.97a26.75 26.75 0 00-23.61-23.61c-1.63-.19-2.97 1.16-2.97 2.8v.25c0 1.64 1.34 2.95 2.96 3.19A20.55 20.55 0 0137.4 51.35c.24 1.63 1.55 2.97 3.19 2.97h.25z"/>\n</svg>\n'},71665:e=>{e.exports='<svg opacity=".7" fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 140 126" width="140" height="126">\n  <circle opacity=".2" cx="67" cy="63" r="55" fill="var(--colorFgFadedMost)"/>\n  <circle opacity=".2" cx="67" cy="63" r="59" stroke="var(--colorFgFadedMost)" stroke-width="2" stroke-dasharray="6 6"/>\n  <rect x="12" y="21" width="111" height="77" rx="4" fill="var(--colorBg)" stroke="var(--colorFgFadedMost)" stroke-width="2"/>\n  <path d="M4 98h128v1a6 6 0 0 1-6 6H10a6 6 0 0 1-6-6v-1Z" fill="var(--colorBgDark)" stroke="var(--colorFgFadedMost)" stroke-width="2"/>\n  <rect x="100" y="42" width="36" height="70" rx="4" fill="var(--colorBgDarker)" stroke="var(--colorFgFadedMost)" stroke-width="2"/>\n  <rect x="111" y="45" width="15" height="3" rx="1.5" fill="var(--colorFgFadedMost)"/>\n  <path d="M31.25 79.005V68.25a2 2 0 0 1 2-2h5.5a2 2 0 0 1 2 2v10.755a.25.25 0 0 1-.398.202L36 76l-4.352 3.207a.25.25 0 0 1-.398-.202Z" stroke="var(--colorFgFadedMore)" stroke-width="1.5"/>\n  <path d="M67.75 66.25h-6.5a2 2 0 0 0-2 2v9.5a2 2 0 0 0 2 2h5.5a2 2 0 0 0 2-2v-.25" stroke="var(--colorFgFadedMore)" stroke-width="1.5" stroke-linecap="round"/>\n  <path d="M63.75 76.25v-2l5.74-5.74a1.427 1.427 0 0 1 2.038 2L66 76.25h-2.25Z" stroke="var(--colorFgFadedMore)" stroke-width="1.5"/>\n  <path stroke="var(--colorFgFadedMore)" d="m68.354 70.646 2 2"/>\n  <path d="M29.75 38.75h4.75a1.5 1.5 0 0 1 1.5 1.5v9a1 1 0 0 1-1 1h-5.25a1 1 0 0 1-1-1v-9.5a1 1 0 0 1 1-1ZM37.5 38.752h4.75a1 1 0 0 1 1 1v9.498a1 1 0 0 1-1 1H37a1 1 0 0 1-1-1v-8.998a1.5 1.5 0 0 1 1.5-1.5ZM35 50.25c.333.566 1.2 1.358 2 0" stroke="var(--colorFgFadedMore)" stroke-width="1.5"/>\n  <path opacity=".35" stroke="var(--colorFgFadedMore)" stroke-linecap="round" d="M31 41.5h3M38 41.5h3M31 43.5h3M38 43.5h3M31 45.5h3M38 45.5h3M31 47.5h3M38 47.5h3"/>\n  <path d="M64.5 39.25h-4.25a2 2 0 0 0-2 2v7.5a2 2 0 0 0 2 2h7.5a2 2 0 0 0 2-2V46.5" stroke="var(--colorFgFadedMore)" stroke-width="1.5" stroke-linecap="round"/>\n  <path d="m61.5 43.5 3 3 6-8" stroke="var(--colorFgFadedMore)" stroke-width="1.5" stroke-linecap="round"/>\n  <path d="M123.996 72.172A2.998 2.998 0 0 1 122.99 78h-9.98a3.006 3.006 0 0 1-3.01-3c0-1.314.84-2.43 2.022-2.836a2.5 2.5 0 0 1 4.198-1.478A4.004 4.004 0 0 1 120 68c2.21 0 4 1.79 4 4l-.004.172Z" fill="var(--colorFg)"/>\n</svg>\n'},86484:e=>{e.exports='<svg width="196" height="32" xmlns="http://www.w3.org/2000/svg">\n  <rect class="border" x=".5" y=".5" width="195" height="31" rx="1.5" />\n  <path class="highlight" fill-rule="evenodd" d="M109 13h-8v8h8v-8zm-9-1v10h10V12h-10z"/>\n  <path fill-rule="evenodd" d="M9 9H1v16h8V9zM0 8v18h10V8H0z" class="border"/>\n  <path class="highlight" d="M12 25V6h1v19z"/>\n  <path class="highlight" fill-rule="evenodd" d="M177 25V7H12V6h173v19h10v1H93V9H15v17H1v-1h13V8h80v17h2V8h80v17h1zM97 9h78v16H97V9zm-79 4h8v8h-8v-8zm-1 9V12h10v10H17zm165-8.598L179 16l3 2.598v-5.196z"/>\n</svg>\n'},18998:e=>{e.exports='<svg width="196" height="32" xmlns="http://www.w3.org/2000/svg">\n  <rect x=".5" y=".5" width="195" height="31" rx="1.5" class="border"/>\n  <path fill-rule="evenodd" clip-rule="evenodd" d="M1 9h8v16H1V9zM0 26V8h10v18H0zM177 9H97v16h80V9zM96 8v18h82V8H96zm13 5h-8v8h8v-8zm-9-1v10h10V12h-10z"/>\n  <path class="highlight" fill-rule="evenodd" clip-rule="evenodd" d="M25 13h-8v8h8v-8zm-9-1v10h10V12H16z"/>\n  <path class="highlight" fill-rule="evenodd" clip-rule="evenodd" d="M13 9h80v17h1V8H12v18h1V9z"/>\n  <path class="highlight" d="M94 25h101v1H94zM1 25h11v1H1zM13 5h26v3H13zM40 5h26v2H40zM67 5h26v2H67z"/>\n</svg>\n'},86681:e=>{e.exports='<svg width="196" height="48" xmlns="http://www.w3.org/2000/svg">\n  <path class="border" d="M2 .5h192a1.5 1.5 0 011.5 1.5v44a1.5 1.5 0 01-1.5 1.5H2A1.5 1.5 0 01.5 46V2A1.5 1.5 0 012 .5z"/>\n  <path fill-rule="evenodd" clip-rule="evenodd" d="M4 28h80v16H4V28zM3 45V27h82v18H3zm5-13h8v8H8v-8zm-1 9V31h10v10H7zm161-13H88v16h80V28zm-81-1v18h82V27H87zm5 5h8v8h-8v-8zm-1 9V31h10v10H91zm93-9h-8v8h8v-8zm-9-1v10h10V31h-10zm-4-4h24v1h-23v16h23v1h-24V27z" class="highlight"/>\n  <path fill-rule="evenodd" clip-rule="evenodd" d="M9 8H1v16h8V8zM0 7v18h10V7H0z"/>\n  <path fill-rule="evenodd" clip-rule="evenodd" d="M25 12h-8v8h8v-8zm-9-1v10h10V11H16z" class="highlight"/>\n  <path fill-rule="evenodd" clip-rule="evenodd" d="M97 8h80v16H97V8zm-1 17V7h82v18H96zm5-13h8v8h-8v-8zm-1 9V11h10v10h-10z"/>\n  <path class="highlight" d="M93 24h103v1H93z"/>\n  <path class="highlight" d="M1 24h12v1H1z"/>\n  <g class="default-style">\n    <path fill-rule="evenodd" clip-rule="evenodd" class="highlight" d="M92 9H14v14h78V9zM14 7a2 2 0 00-2 2v14a2 2 0 002 2h78a2 2 0 002-2V9a2 2 0 00-2-2H14z"/>\n    <path opacity=".25" d="M90 11H80v10h10V11z" class="highlight"/>\n  </g>\n  <g class="dotted-style">\n    <path d="M39 4H13V7H12V25H13V8H93V25H94V7H39V4Z" class="highlight"/>\n    <path d="M66 4H40V6H66V4Z" class="highlight"/>\n    <path d="M67 4H93V6H67V4Z" class="highlight"/>\n  </g>\n</svg>\n'},85382:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">\n  <path fill-rule="evenodd" clip-rule="evenodd" d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8Zm2.5-4a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0Z"/>\n</svg>'},33271:e=>{e.exports='<svg width="196" height="32" xmlns="http://www.w3.org/2000/svg">\n  <path class="border" d="M2 .5h192a1.5 1.5 0 011.5 1.5v28a1.5 1.5 0 01-1.5 1.5H2A1.5 1.5 0 01.5 30V2A1.5 1.5 0 012 .5z"/>\n  <path d="M1 24h12v1H1z"/>\n  <path fill-rule="evenodd" clip-rule="evenodd" d="M0 25V7h10v18H0zM1 8h8v16H1V8zM100 11v10h10V11h-10zm9 1h-8v8h8v-8z"/>\n  <path fill-rule="evenodd" clip-rule="evenodd" d="M13 8h80v17h102v-1h-17V7H96v17h-2V7H12v18h1V8zm84 16h80V8H97v16z"/>\n  <path fill-rule="evenodd" clip-rule="evenodd" d="M16 11v10h10V11H16zm9 1h-8v8h8v-8z"/>\n  <path fill="var(--colorBg)" d="M166 6a2 2 0 012-2h11a2 2 0 012 2v11a2 2 0 01-2 2h-11a2 2 0 01-2-2V6z"/>\n  <path class="highlight" fill-rule="evenodd" clip-rule="evenodd" d="M179 5h-11a1 1 0 00-1 1v11a1 1 0 001 1h11a1 1 0 001-1V6a1 1 0 00-1-1zm-11-1a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2V6a2 2 0 00-2-2h-11z"/>\n  <path class="highlight" d="M170 7h8v8l-8-8z"/>\n</svg>\n'},38151:e=>{e.exports='<svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">\n  <path d="M16 32c7.011 0 10.91 0 13.454-2.546C32 26.91 32 23.011 32 16c0-7.011 0-10.909-2.546-13.454C26.91 0 23.011 0 16 0 8.989 0 5.091 0 2.546 2.546 0 5.09 0 8.989 0 16c0 7.01 0 10.909 2.546 13.454C5.09 32 8.989 32 16 32" fill="#4c70f0"/>\n  <path d="M23.547 12.942c-1.957 3.406-3.917 6.81-5.87 10.217-.364.633-.892 1.016-1.616 1.068-.811.06-1.448-.283-1.857-.987-1.239-2.135-2.463-4.278-3.693-6.417-.748-1.302-1.499-2.602-2.243-3.905-.752-1.315.096-2.913 1.603-2.99.796-.042 1.41.325 1.814 1.018.552.947 1.094 1.9 1.64 2.85.395.684.78 1.374 1.186 2.05.586.984 1.449 1.538 2.597 1.607a3.163 3.163 0 0 0 3.328-2.812c.015-.13.024-.259.03-.325-.009-.56-.113-1.033-.335-1.478-.607-1.217.04-2.581 1.358-2.874 1.074-.238 2.186.553 2.328 1.645.062.48-.032.92-.27 1.333m.71-5.463c-4.634-4.639-12.147-4.639-16.781 0-4.635 4.638-4.635 12.158 0 16.795 4.634 4.638 12.147 4.638 16.782 0 4.634-4.637 4.634-12.157 0-16.795" fill="#fff"/>\n</svg>\n'},34511:e=>{e.exports='<svg width="220" height="140" viewBox="0 0 220 140" xmlns="http://www.w3.org/2000/svg">\n  <path fill="var(--colorBg)" d="M0 0H220V140H0V0Z"/>\n  <path class="active-tab-preview" d="M0 114H220V140H0V114Z"/>\n  <path fill="var(--colorAccentFg)" d="M6 120H75V134H6V120Z"/>\n  <path fill="var(--colorAccentFgAlpha)" d="M76 120H144V134H76V120ZM145 120H214V134H145V120Z"/>\n</svg>\n'},31614:e=>{e.exports='<svg width="220" height="140" viewBox="0 0 220 140" xmlns="http://www.w3.org/2000/svg">\n  <path fill="var(--colorBg)" d="M3 0H217C217.796 0 218.559 0.283653 219.121 0.788559C219.684 1.29346 220 1.97826 220 2.69231V140H0V2.69231C0 1.97826 0.31607 1.29346 0.87868 0.788559C1.44129 0.283653 2.20435 0 3 0V0Z"/>\n  <path class="active-tab-preview" d="M0 0H81V140H0V0Z" rx="10px" ry="10px"/>\n  <path fill="var(--colorAccentFg)" d="M6 6H75V20H6V6Z"/>\n  <path fill="var(--colorAccentFgAlpha)" d="M6 21H75V35H6V21ZM6 36H75V50H6V36Z"/>\n</svg>\n'},76201:e=>{e.exports='<svg width="220" height="140" viewBox="0 0 220 140" xmlns="http://www.w3.org/2000/svg">\n  <path fill="var(--colorBg)" d="M3 0H217C217.796 0 218.559 0.283653 219.121 0.788559C219.684 1.29346 220 1.97826 220 2.69231V140H0V2.69231C0 1.97826 0.31607 1.29346 0.87868 0.788559C1.44129 0.283653 2.20435 0 3 0V0Z"/>\n  <path class="active-tab-preview" d="M139 0H220V140H139V0Z"/>\n  <path fill="var(--colorAccentFg)" d="M145 6H214V20H145V6Z"/>\n  <path fill="var(--colorAccentFgAlpha)" d="M145 21H214V35H145V21ZM145 36H214V50H145V36Z"/>\n</svg>\n'},48753:e=>{e.exports='<svg width="220" height="140" viewBox="0 0 220 140" xmlns="http://www.w3.org/2000/svg">\n  <path fill="var(--colorBg)" d="M3 0h214a3.18 3.18 0 0 1 2.121.789c.563.504.879 1.19.879 1.903V140H0V2.692C0 1.978.316 1.293.879.79A3.183 3.183 0 0 1 3 0Z"/>\n  <path class="active-tab-preview" d="M0 0h220v26H0V0Z"/>\n  <path fill="var(--colorAccentFg)" d="M6 6h69v14H6V6Z"/>\n  <path fill="var(--colorAccentFgAlpha)" d="M76 6h68v14H76V6Zm69 0h69v14h-69V6Z"/>\n</svg>\n'},76259:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 116 116">\n  <path fill="#ef3939" d="M58 115c25 0 38.9 0 47.9-9.1C115 96.9 115 83 115 58s0-38.9-9.1-47.9C96.9 1 83 1 58 1s-38.9 0-47.9 9.1C1 19.1 1 33 1 58s0 38.9 9.1 47.9C19.1 115 33 115 58 115z"/>\n  <linearGradient id="a" x1="36.55" x2="91.02" y1="21.06" y2="115.39" gradientUnits="userSpaceOnUse">\n    <stop offset="0" stop-opacity=".2"/>\n    <stop offset=".79" stop-opacity=".05"/>\n  </linearGradient>\n  <path fill="url(#a)" d="M95.1 36.9A42.7 42.7 0 1 0 21.2 80l20.1 34.8 10.8.1h5.7c11.1 0 20 0 27.3-.8 9.1-1 15.6-3.2 20.7-8.3 7.3-7.3 8.7-17.9 9-34.9a3101.9 3101.9 0 0 1-19.7-34z"/>\n  <path fill="#fff" d="M88 27.8a42.7 42.7 0 1 0-60.3 60.5A42.7 42.7 0 1 0 88 27.8zm-2.5 19.7L64.4 84.2c-1.3 2.3-3.2 3.7-5.8 3.8-2.9.2-5.2-1-6.7-3.6L38.6 61.3l-8.1-14a7.1 7.1 0 0 1 5.8-10.8 6.8 6.8 0 0 1 6.5 3.7l5.9 10.3 4.3 7.4c2.1 3.5 5.2 5.5 9.3 5.8 5.8.3 11.3-3.9 12-10.1l.1-1.2c0-2-.4-3.7-1.2-5.3a7 7 0 0 1 4.9-10.3 7 7 0 0 1 8.4 5.9 8 8 0 0 1-1 4.8z"/>\n</svg>\n'},51759:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 10 10">\n  <path d="M10.2.5l-.7-.7L5 4.3.5-.2l-.7.7L4.3 5-.2 9.5l.7.7L5 5.7l4.5 4.5.7-.7L5.7 5"/>\n</svg>\n'},9592:e=>{e.exports='<svg class="window-maximize" xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 10 10">\n\n  <g class="window-maximize-glyph">\n    <path fill-rule="evenodd" d="M8.5 1h-7a.5.5 0 0 0-.5.5v7a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.5-.5zm-7-1A1.5 1.5 0 0 0 0 1.5v7A1.5 1.5 0 0 0 1.5 10h7A1.5 1.5 0 0 0 10 8.5v-7A1.5 1.5 0 0 0 8.5 0h-7z"/>\n  </g>\n\n  <g class="window-restore-glyph">\n    <path d="M3.618 0C2.933 0 2.306.387 2 1h5a2 2 0 0 1 2 2v5c.613-.306 1-.933 1-1.618V3a3 3 0 0 0-3-3H3.618z"/>\n    <path fill-rule="evenodd" d="M6.5 10A1.5 1.5 0 0 0 8 8.5v-5A1.5 1.5 0 0 0 6.5 2h-5A1.5 1.5 0 0 0 0 3.5v5A1.5 1.5 0 0 0 1.5 10h5zM7 8.5a.5.5 0 0 1-.5.5h-5a.5.5 0 0 1-.5-.5v-5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 .5.5v5z"/>\n  </g>\n</svg>\n'},96375:e=>{e.exports='<svg width="10" height="10" viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg">\n  <path d="M0 5H10V6H0V5Z"/>\n</svg>\n'},62077:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const i="iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAACfSURBVHgBvZIxCgMhEEXHkEZPscex1s7LZHMWwU5bvU1yCW3NuoEQwoy6BPY1Mvh9OirAn7Dvwhjz2IYFya3OuTsmuPzUC+Csm/w2I+iBSo4IUAkpkFKC1hqVTAkaSilK8uFKTaSUQAixC0opEGNEc90TMPZ+Zc45mSEFbefWgvceQgikgGwh5wzW2r2VHt07mOHoPxgKnqMFtdZh5lxeJo4r4FiF0c8AAAAASUVORK5CYII="},72536:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const i="iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAACfSURBVHgBvZIxCgMhEEXHkEZPscex1s7LZHMWwU5bvU1yCW3NuoEQwoy6BPY1Mvh9OirAn7Dvwhjz2IYFya3OuTsmuPzUC+Csm/w2I+iBSo4IUAkpkFKC1hqVTAkaSilK8uFKTaSUQAixC0opEGNEc90TMPZ+Zc45mSEFbefWgvceQgikgGwh5wzW2r2VHt07mOHoPxgKnqMFtdZh5lxeJo4r4FiF0c8AAAAASUVORK5CYII="},26591:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const i="iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAyUlEQVR42q3TvQrCMBDAcV+ro7vvURx9AXVyaUGwuzinfsw66OYD+AJ2K21DUlooDaXEXOGki7mCDfy4G5L/lslsvvjLuAFz1j9MBwe01queped5F8dxthAZGti0bfvFGHsIISRGyEDTNDsjAEqpAALanH7EGqjr+tDnuu4+DMM78H3/DHesgaqqjhYnMlCW5bUoihuAHSciA+bBM8/zDuw4cScDUsqXDRngnL9RlmURTtzJQJIkPE3TDuw4ERmI41jZkIEhRv2NH2DDzUU+EiSYAAAAAElFTkSuQmCC"},86635:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const i="iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAqUlEQVR4AWP4z4gfElbAYMNQw9AAhSkMzBgKgNIiDOxQGMXgg6mgQYVdBSgJwgx8DLkMtUiwgsEXqKCBBwGTeKP5ENBbkKEBpEAAAftBGEKC+WAFlaK4IVhBjhQCFkiCMAKCFYTKIWCELAhHyMbJgXCcHFiBk7KTsicYI6CLEgi7KIEV6KnrqauDMAJARIAQpKCWz1RQBzvkMgWGBYMjkGjADoEyjpTHJgCRpZrxxM2tswAAAABJRU5ErkJggg=="},68551:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const i="iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAZElEQVR42mNgoBj8if/9/vd/MHz/ux6Lgl/3//j+NwbBP76/n/2u/y+ApuD3f4g0VMlmqGlg+Of+n3gUBejwj+/v93gV/Df+/X+IKHgPCyhs3vxzn+FXwq/7yIGDAt//SqA8MgF9hfa1XsQ+LgAAAABJRU5ErkJggg=="},13253:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const i="iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfiAxMIBBzsKlp7AAAA6klEQVQoz42RP04CURDGf8MObmyk8QSElhtQYGdBYSgJhhvABTCEI+AFJJGaUEDiRewojKEBJWGzBXlRGQoWeKsJOJN5k5l8b/59YsJJyXBGhBJlNIlmPNnmN6TNNWGiNSomaVW0EMOUAlMY05C29/mLV4V69pDYvPedN/QqmLQUDhMARSJyQESOCGyCgjtWYJHY/gWF2AOofYuav4PC3GsR2I+MeoDcNUePQF5hmYUQR5iALAMQXexurPCp4AhxKcCb7rzwcPUSrP2uR3bc5fpWuKFEkLptFYAhVYwP+cumDAA6993nf7G5BYxPRUIY3xtuAAAAAElFTkSuQmCC"},89661:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const i="iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAbElEQVR42mNgoBj8if/9/vd/MHz/ux6Lgl/3//j+NwbBP76/n/2u/y+ApuD3f4g0VMlmqGlg+Of+n3gUBejwj+/v93gV/Df+/Z90BRi+wFQAcSCcpoKC97CAwuGGXwm/7iMHDoYJDFicTZICAK40+w1CznHyAAAAAElFTkSuQmCC"},94420:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const i="iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAD5SURBVHgBtVHBDYJAEOTQvz59WoJvIPFKwA6kEqES7UCtAPwQflqCDwrgSUIAZ8iRXIAE0DjJZfcuO3O7s4bxIxZziqWU6w2QpmnWvpkzyNuiKJ6maYaWZe1mC4B8ruv6gvSAc2U3kwUcx/EZ4zgO0IHLPM/zRkAMFMuqqvbtXQixxs8uiB7iiW9lWXpJkryZL7sCJIMkURzxjkjDAsRmBHah1/cEgDsKj4wofvEBpvHnW5dM9DxQpMYo3W3ViTEqQA9U2hMZFeCuOSs8CHURejJJgLtGoEiGs2rHoaHYwmNIQGit+2pNkb6mSWDrtm3Xyu3vMGbW3/ABNRKFPPHD6XUAAAAASUVORK5CYII="},1810:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const i="iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAMFBMVEX///+/v7/Hx8e/v7/ExMTFxcXFxcXExMTFxcXDw8PDw8PExMTFxcXExMTExMTGxsbQpf+eAAAAEHRSTlMAECAg398wv3+AQI9g7/8/FKJcHQAAAFFJREFUeAFjQAWMClCGSRiUUZEqAKY5C6aC5FZ0bF1eBOK3d/R4gCVSEzg2gBlsYRwNYMay1Awwg9k3LRzMYH/6IWMBiDEPqBUs8wJmYQKaAwANFhLITP6v6wAAAABJRU5ErkJggg=="},50012:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const i="iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAABtSURBVHgBvZJLCsAgDERj8SD2Gnp+vYbeJDXQRQlNiB98C7NweAwkAIs4elJKtY8ghRCxlVJu0dIFCAra/wVGSBJjrNOCnLPrhGmB1GRYwJsMCzjLAv/Opq2K7gAsWO/hm/Msc7bJX4O9TY7wAFQ4MpFfIoDNAAAAAElFTkSuQmCC"},32782:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const i="iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAPElEQVR42mNgIAyO3D/yHxkevY+u4D9+PhYFaKZgMwFFDLsCJFNwmQAXp4ICLOFApEMJhCYRAUZqnJAJALGlehnFYWcIAAAAAElFTkSuQmCC"},54189:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const i="iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAABYSURBVHgB7ZLdCcAgDIQvpYO0c2T+ZI26SWofCgriDwqC+L3kOMiFkACzoV8w8+PLVdNkZk5V78j0AVbSKe9AJ5SblENEKDJaAoausAOAM9Cu9hLfJ2IdXuDHHKAeH9NrAAAAAElFTkSuQmCC"},70025:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const i="iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAALElEQVR42mNgoAo4cv/If0x49D5CwX90EpVFjALskAGLWmSXDTUFhEKStgAAWEdiK3NU7WoAAAAASUVORK5CYII="},57049:e=>{"use strict";e.exports=JSON.parse('{"t":[{"title":"Vivaldi Browser Help Center","url":"https://help.vivaldi.com/","faviconUrl":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAKQ2lDQ1BJQ0MgcHJvZmlsZQAAeNqdU3dYk/cWPt/3ZQ9WQtjwsZdsgQAiI6wIyBBZohCSAGGEEBJAxYWIClYUFRGcSFXEgtUKSJ2I4qAouGdBiohai1VcOO4f3Ke1fXrv7e371/u855zn/M55zw+AERImkeaiagA5UoU8Otgfj09IxMm9gAIVSOAEIBDmy8JnBcUAAPADeXh+dLA//AGvbwACAHDVLiQSx+H/g7pQJlcAIJEA4CIS5wsBkFIAyC5UyBQAyBgAsFOzZAoAlAAAbHl8QiIAqg0A7PRJPgUA2KmT3BcA2KIcqQgAjQEAmShHJAJAuwBgVYFSLALAwgCgrEAiLgTArgGAWbYyRwKAvQUAdo5YkA9AYACAmUIszAAgOAIAQx4TzQMgTAOgMNK/4KlfcIW4SAEAwMuVzZdL0jMUuJXQGnfy8ODiIeLCbLFCYRcpEGYJ5CKcl5sjE0jnA0zODAAAGvnRwf44P5Dn5uTh5mbnbO/0xaL+a/BvIj4h8d/+vIwCBAAQTs/v2l/l5dYDcMcBsHW/a6lbANpWAGjf+V0z2wmgWgrQevmLeTj8QB6eoVDIPB0cCgsL7SViob0w44s+/zPhb+CLfvb8QB7+23rwAHGaQJmtwKOD/XFhbnauUo7nywRCMW735yP+x4V//Y4p0eI0sVwsFYrxWIm4UCJNx3m5UpFEIcmV4hLpfzLxH5b9CZN3DQCshk/ATrYHtctswH7uAQKLDljSdgBAfvMtjBoLkQAQZzQyefcAAJO/+Y9AKwEAzZek4wAAvOgYXKiUF0zGCAAARKCBKrBBBwzBFKzADpzBHbzAFwJhBkRADCTAPBBCBuSAHAqhGJZBGVTAOtgEtbADGqARmuEQtMExOA3n4BJcgetwFwZgGJ7CGLyGCQRByAgTYSE6iBFijtgizggXmY4EImFINJKApCDpiBRRIsXIcqQCqUJqkV1II/ItchQ5jVxA+pDbyCAyivyKvEcxlIGyUQPUAnVAuagfGorGoHPRdDQPXYCWomvRGrQePYC2oqfRS+h1dAB9io5jgNExDmaM2WFcjIdFYIlYGibHFmPlWDVWjzVjHVg3dhUbwJ5h7wgkAouAE+wIXoQQwmyCkJBHWExYQ6gl7CO0EroIVwmDhDHCJyKTqE+0JXoS+cR4YjqxkFhGrCbuIR4hniVeJw4TX5NIJA7JkuROCiElkDJJC0lrSNtILaRTpD7SEGmcTCbrkG3J3uQIsoCsIJeRt5APkE+S+8nD5LcUOsWI4kwJoiRSpJQSSjVlP+UEpZ8yQpmgqlHNqZ7UCKqIOp9aSW2gdlAvU4epEzR1miXNmxZDy6Qto9XQmmlnafdoL+l0ugndgx5Fl9CX0mvoB+nn6YP0dwwNhg2Dx0hiKBlrGXsZpxi3GS+ZTKYF05eZyFQw1zIbmWeYD5hvVVgq9ip8FZHKEpU6lVaVfpXnqlRVc1U/1XmqC1SrVQ+rXlZ9pkZVs1DjqQnUFqvVqR1Vu6k2rs5Sd1KPUM9RX6O+X/2C+mMNsoaFRqCGSKNUY7fGGY0hFsYyZfFYQtZyVgPrLGuYTWJbsvnsTHYF+xt2L3tMU0NzqmasZpFmneZxzQEOxrHg8DnZnErOIc4NznstAy0/LbHWaq1mrX6tN9p62r7aYu1y7Rbt69rvdXCdQJ0snfU6bTr3dQm6NrpRuoW623XP6j7TY+t56Qn1yvUO6d3RR/Vt9KP1F+rv1u/RHzcwNAg2kBlsMThj8MyQY+hrmGm40fCE4agRy2i6kcRoo9FJoye4Ju6HZ+M1eBc+ZqxvHGKsNN5l3Gs8YWJpMtukxKTF5L4pzZRrmma60bTTdMzMyCzcrNisyeyOOdWca55hvtm82/yNhaVFnMVKizaLx5balnzLBZZNlvesmFY+VnlW9VbXrEnWXOss623WV2xQG1ebDJs6m8u2qK2brcR2m23fFOIUjynSKfVTbtox7PzsCuya7AbtOfZh9iX2bfbPHcwcEh3WO3Q7fHJ0dcx2bHC866ThNMOpxKnD6VdnG2ehc53zNRemS5DLEpd2lxdTbaeKp26fesuV5RruutK10/Wjm7ub3K3ZbdTdzD3Ffav7TS6bG8ldwz3vQfTw91jicczjnaebp8LzkOcvXnZeWV77vR5Ps5wmntYwbcjbxFvgvct7YDo+PWX6zukDPsY+Ap96n4e+pr4i3z2+I37Wfpl+B/ye+zv6y/2P+L/hefIW8U4FYAHBAeUBvYEagbMDawMfBJkEpQc1BY0FuwYvDD4VQgwJDVkfcpNvwBfyG/ljM9xnLJrRFcoInRVaG/owzCZMHtYRjobPCN8Qfm+m+UzpzLYIiOBHbIi4H2kZmRf5fRQpKjKqLupRtFN0cXT3LNas5Fn7Z72O8Y+pjLk722q2cnZnrGpsUmxj7Ju4gLiquIF4h/hF8ZcSdBMkCe2J5MTYxD2J43MC52yaM5zkmlSWdGOu5dyiuRfm6c7Lnnc8WTVZkHw4hZgSl7I/5YMgQlAvGE/lp25NHRPyhJuFT0W+oo2iUbG3uEo8kuadVpX2ON07fUP6aIZPRnXGMwlPUit5kRmSuSPzTVZE1t6sz9lx2S05lJyUnKNSDWmWtCvXMLcot09mKyuTDeR55m3KG5OHyvfkI/lz89sVbIVM0aO0Uq5QDhZML6greFsYW3i4SL1IWtQz32b+6vkjC4IWfL2QsFC4sLPYuHhZ8eAiv0W7FiOLUxd3LjFdUrpkeGnw0n3LaMuylv1Q4lhSVfJqedzyjlKD0qWlQyuCVzSVqZTJy26u9Fq5YxVhlWRV72qX1VtWfyoXlV+scKyorviwRrjm4ldOX9V89Xlt2treSrfK7etI66Trbqz3Wb+vSr1qQdXQhvANrRvxjeUbX21K3nShemr1js20zcrNAzVhNe1bzLas2/KhNqP2ep1/XctW/a2rt77ZJtrWv913e/MOgx0VO97vlOy8tSt4V2u9RX31btLugt2PGmIbur/mft24R3dPxZ6Pe6V7B/ZF7+tqdG9s3K+/v7IJbVI2jR5IOnDlm4Bv2pvtmne1cFoqDsJB5cEn36Z8e+NQ6KHOw9zDzd+Zf7f1COtIeSvSOr91rC2jbaA9ob3v6IyjnR1eHUe+t/9+7zHjY3XHNY9XnqCdKD3x+eSCk+OnZKeenU4/PdSZ3Hn3TPyZa11RXb1nQ8+ePxd07ky3X/fJ897nj13wvHD0Ivdi2yW3S609rj1HfnD94UivW2/rZffL7Vc8rnT0Tes70e/Tf/pqwNVz1/jXLl2feb3vxuwbt24m3Ry4Jbr1+Hb27Rd3Cu5M3F16j3iv/L7a/eoH+g/qf7T+sWXAbeD4YMBgz8NZD+8OCYee/pT/04fh0kfMR9UjRiONj50fHxsNGr3yZM6T4aeypxPPyn5W/3nrc6vn3/3i+0vPWPzY8Av5i8+/rnmp83Lvq6mvOscjxx+8znk98ab8rc7bfe+477rfx70fmSj8QP5Q89H6Y8en0E/3Pud8/vwv94Tz+4A5JREAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAADKGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDAgNzkuMTYwNDUxLCAyMDE3LzA1LzA2LTAxOjA4OjIxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOCAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozNjMzMzk4REEzQ0UxMUU4OEQxNUUwM0EyM0ZDRkY5NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozNjMzMzk4RUEzQ0UxMUU4OEQxNUUwM0EyM0ZDRkY5NyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjM2MzMzOThCQTNDRTExRTg4RDE1RTAzQTIzRkNGRjk3IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjM2MzMzOThDQTNDRTExRTg4RDE1RTAzQTIzRkNGRjk3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+CzB6ggAABmJJREFUeNrEV1loVGcU/u4yk0xWs5hJE2PERNCKcX9QhBZR1Iii9UERRNFaRdu+iBL3uiDigj5UQaQPFeuCiMQNKxTy4Ip7K6iYxKhxS2LWyTYz995+/507mTszd9rSFjxwQubOnf98/znn+/7zS4Zh4FOaKv60TpwY+zyJXk6fRB9Cz6f3o6fQ3XSFLjmsp9ED9B56O72B/oJ+l/4r/ZX95X43boQAxNh39Ap6wf+40W8scEfp31sgIxmw2U/0pQmXkbhplszo7obR1cV99oSeu92QUlIgeTzMjWK+42AiayvpX9DH0btiAXydMLgsE3MA+ps3MDQNckEB1KFDIeXmmqCMtjbo9fWmG3xPKSxksVgtTXNabRi9kj7VDsBF/9Fxx9yR/vKluZhr6lS4Z86EOm4clIEDQ8As09+/R/DRI/ivXIH/8mUYBKuUlITW0PXYladY/XUtDKDcary4dGuPH5sBPevWwT1lSsLqyPn5cAufNg3BpUvRtXcv/BcuQB08OFE2RMavhbcw2TH4kydIWrAAmdzRXwWPo9aIEcg4dgwpmzZBq6sDOjujsmXZBBO49aEktuba06dIWrgQaYcPc0X1X7V+ypo18OzYgWBtrVMGiuwAvJFeDdVcHT0aaYcO/Wf+paxahaRFi6A9fx5iSMR0O4DMvsd+Pwx66oEDfY/a791D9fr18LEf/s6C7e2o37kTTSdP9j1L3b0bsmBGS0scgHBuPeHaa69eIWnuXKhlZeYj38OHeDR9OnqamtDw8zGMvXsHSQXOGiUoWMMGbDh71iS9RjDeFSsgp6bCtXw5erdsgZKZGaUTso2GIbrQ3QQQNt/vfyDI4LmTJiHY0oyX235IuHudwtTNLGUMHw7V5YLv+vVIZefMQdDrhdzbG91uNpUyFU4ZNAjq+PF9L+SUz0DG2LHwv36NtM+Ho/GXk2i/dcsRgJKejqzycgSpASp3nbdkSeRwGTAAwZFl0JqbHQGYB4vh80EmADkrq+8FF9WumPUPvHsHxaXCRU6/3ro1YRbSJ0xAT2srcubPR/rkyVGB9JJS+BhDlaQ4ACFjCmUhrzGWO28esikwPdXVSC4tQXtVFZpOnHAE0HX7tnlcFmzeHPedKzsbvmAQOntAcgQQ1n0HKyafTS4TpIcyXM8A3dQKu3WSLW/370fR9u1wia6PFSiuHWDwTvaZYmUhOhpPNSOaKhEqjRwJ7+LF6Hn2zJRccTjVUCU/HDyIljNn8H7PHlRTLVOp//kbNzo3KVnhYuBuAghYTAjT0PwksXF00tCgdIr/Y62wogIt586ZrEgqKoL28SPecbeSlTWdtS86fjxhFgMvXkBNTjZLIEBk2TKghwFolE1xqjmZizsvoLwGamogsRyi65O5Y8/gEpNGWbNnI4OnpZNpzGzvgwdQ2QcuqxT2EgTCMmyQp/6LFxN2uXf1aqSOGYMAqSZzIbGA4e81+8O7bVvC3/kuXUKQGVDS0szfyDFNGBptiEphantPn4b+9q3zSgRZQBrqjY2QmEaJB5WfOp9NzntGjUoIoO3oUZPSssX5WBa0R7ot1dSDjoqKhItlzJiBzFmz0H3/PgIsmYvy6t2wIeH7Lfv2IUCGiBLaZFiyA2iMFIu1LS1F4Px5tNoOpLiG5KJpVEyFTVV45AiU/v2ddeHqVbTs2gW3mI6iJyPVzoK62IFE/MDHDu+mcHy2dm18QxYXo4SSrHd0QGYzOgavrETDypVQc3LMA8mwZgKRA+rAB3sGrkcTVodOyc3gONVJELU84fxiLnQaxRyC66RxMxvyw7Jl5vdKXl5f8DDlGPiOuVdxM+LFRMwDrfGiKMMgmHqOZgqPYFPfWftk0WxS/L0kwGYUKfedOoVeUtnFDUgO86DQgVRFmZNz82ZlGIB4Tq3FpqjzXaSagbrozRQfcPIV6XQPG4Yk9onKrhYiJARIUMxPoJqgJ98RuzZrHnNH0EJrPkuT5aEZvBnZAQirsi4OsLeqTACt7AVxkiuclnTeA8xBU9BQHCykpsxLiUw2mJcTi9JO9zYKVkeaopSxBHUZDlezL637wWp7FszZTqiXuJTwvBAdLwl3HIuiAxu2NdySVOWR5WUiuJ7gaibsW7qYRr+yRuchmmHkuWVZETfTHnGS/bN51CDANmavlgEfcAa4SAC/9el+OMOf+nr+pwADAAZ5culxNH/mAAAAAElFTkSuQmCC"},{"title":"Wikipedia","url":"https://wikipedia.org/","faviconUrl":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QAAKqNIzIAAAAJcEhZcwAACxIAAAsSAdLdfvwAAAAHdElNRQfhBAwKMAfiL115AAACxklEQVRIx6WVX2jVZRjHP7/T8c9pg2nhv2yDXWg4gqGsQGci68J/FRhq4IUohISpiQpeRoi48DJML0yCukpEiV0oIuaIqTSmUtREFCdhjTTFnTPP9Jz308X57efZ2aJ19vyu3ud9ns/zfX/P+ycKANN4mxZ2MH77gm7O8wgIhEzoClbxdYVMgDA3XKwq3WC4GOamaGHZ/5A+0pbRkmJx1ekAi6PghACkyUU11aebS0OWIhleAOAZQ2QYJEMagCcEppBnKmngCTKJPLVEQI4UNaQjTnGYQWYSUeAeb/Iph7jCS6R4Ro4NtPEZfzCNPJNZSyu7GaSOAaayk/chZPP2+KGIuNc7Fu33c1Piy54ya8FeV4jLvWzWor+6VFxjjwVDlpBVzbtWrPWaw7ZVnGlvPNrpfG8lc3t81b9US4BgUM9YJx4qudVuZ4j7VP3TBR5TS5EDtnkwjisD5HxXbPBxDNBPxDpvqvtsNZcATjrPO/EoAQT1WxGPJoE91op77LPe7xNvcIXbLA5v5nLAY5vFRQ4kGraI9ba5wacJ4Lr1/jRcvxwQ1HYx8rskuMuM+KJXE49ud/Xw+kcDbtsovmUh0bBRnG5vAvjdVzz3PN2QTZVtSxpZBXTxQzyGVuAhXwIRAF8zv/LwPlcQ1J+dJG52KO7MEueIc/xF1Uc2eby8/kgFAK/zDtDBb0TAV8gxaujnGwBOIB9UnqdyBUHtdIq4S+23yQ51vTjLG+pCj4ysP/InlgBDrhIb/NuDvmdBvWBaPOBZm73/X4CgnhbxIxf5o6Vzsk58zTfcX5k+NuCBzSJ+bDFu52kz4mzvjg+gh8V6byXdH3SluLd8A/1bF0rdX0MDm2jE2JNhI9NZH89WdmHUba8FO+wrq6b3PWF+dH2DhPaxEJViHUu+wdCe5tIYd+04PLFdStFNZ9W3eifdE35co4k+7/8AeaKDkPxRJzsAAAAASUVORK5CYII="}]}')},70253:e=>{"use strict";e.exports=JSON.parse('{"M":{"pb":[["af","Afrikaans","Afrikaans"],["az","Azerbaijani","Azərbaycanca"],["be","Belarusian","Беларуская"],["bg","Bulgarian","български"],["ca","Catalan","Català"],["ca-valencia","Valencian","Valencià"],["cs","Czech","Čeština"],["da","Danish","Dansk"],["de","German","Deutsch"],["de-CH","German (Switzerland)","Deutsch (Schweiz)"],["el","Greek","Ελληνικά"],["en-US","English (US)","English (US)"],["en-GB","English (UK)","English (UK)"],["es","Spanish","Español"],["et","Estonian","Eesti keel"],["fa","Persian","فارسی"],["fi","Finnish","Suomi"],["fr","French","Français"],["fy","Frisian","Frysk"],["gd","Scots Gaelic","Gàidhlig"],["gl","Galician","Galego"],["hu","Hungarian","Magyar"],["hr","Croatian","Hrvatski"],["hy","Armenian","Հայերեն"],["id","Indonesian","Bahasa Indonesia"],["is","Icelandic","Íslenska"],["it","Italian","Italiano"],["ja-KS","Japanese (Kansai)","関西弁"],["ja","Japanese","日本語"],["ka","Georgian","ქართული"],["kab","Kabyle","Taqbaylit"],["ko","Korean","한국어"],["kmr","Kurdish (Kurmanji)","Kurdî"],["lt","Lithuanian","Lietuvių"],["nb","Norwegian (Bokmål)","Norsk (bokmål)"],["nn","Norwegian (Nynorsk)","Norsk (nynorsk)"],["nl","Dutch","Nederlands"],["pa","Punjabi","ਪੰਜਾਬੀ"],["pl","Polish","Polski"],["pt-BR","Portuguese (Brazil)","Português (Brasil)"],["pt-PT","Portuguese (Portugal)","Português (Europeu)"],["ro","Romanian","Română"],["ru","Russian","Русский"],["si","Sinhala","සිංහල"],["sk","Slovak","Slovenčina"],["sl","Slovenian","Slovenščina"],["sq","Albanian","Shqip"],["sr","Serbian","Српски"],["sr-Latn","Serbian (Latin)","Srpski"],["sv","Swedish","Svenska"],["tr","Turkish","Türkçe"],["uk","Ukrainian","Українська"],["vi","Vietnamese","Tiếng Việt"],["zh-CN","Chinese (Simplified)","简体中文"],["zh-TW","Chinese (Traditional)","正體中文"]]}}')}},s={};function o(e){var t=s[e];if(void 0!==t)return t.exports;var n=s[e]={id:e,loaded:!1,exports:{}};return i[e].call(n.exports,n,n.exports,o),n.loaded=!0,n.exports}o.m=i,e=[],o.O=(t,n,i,s)=>{if(!n){var a=1/0;for(c=0;c<e.length;c++){for(var[n,i,s]=e[c],r=!0,l=0;l<n.length;l++)(!1&s||a>=s)&&Object.keys(o.O).every((e=>o.O[e](n[l])))?n.splice(l--,1):(r=!1,s<a&&(a=s));if(r){e.splice(c--,1);var d=i();void 0!==d&&(t=d)}}return t}s=s||0;for(var c=e.length;c>0&&e[c-1][2]>s;c--)e[c]=e[c-1];e[c]=[n,i,s]},o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},n=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,o.t=function(e,i){if(1&i&&(e=this(e)),8&i)return e;if("object"==typeof e&&e){if(4&i&&e.__esModule)return e;if(16&i&&"function"==typeof e.then)return e}var s=Object.create(null);o.r(s);var a={};t=t||[null,n({}),n([]),n(n)];for(var r=2&i&&e;"object"==typeof r&&!~t.indexOf(r);r=n(r))Object.getOwnPropertyNames(r).forEach((t=>a[t]=()=>e[t]));return a.default=()=>e,o.d(s,a),s},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),o.j=296,(()=>{var e={296:0};o.O.j=t=>0===e[t];var t=(t,n)=>{var i,s,[a,r,l]=n,d=0;if(a.some((t=>0!==e[t]))){for(i in r)o.o(r,i)&&(o.m[i]=r[i]);if(l)var c=l(o)}for(t&&t(n);d<a.length;d++)s=a[d],o.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return o.O(c)},n=self.webpackChunkgapp_browser_react=self.webpackChunkgapp_browser_react||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var a=o.O(void 0,[739,277],(()=>o(75344)));a=o.O(a)})();