(()=>{var e,t={43771:(e,t,n)=>{"use strict";var a=n(29087),s=n(16716),i=n(45226);n(89907);self.jasmine;var r=n(39045),o=n(82227),c=n(90864),l=n(24367),d=n(82786);var u=n(56371),h=n(78347),f=n(84321),p=n(47513),g=n.n(p),m=n(48868),w=n(71320);const _={call:async function(e){return m.Z.imap.where("[accountId+path+searchListId]").equals(e).toArray()}};var b=n(88212),y=n(21285),v=n(20570),I=n(12382),E=n(10671),k=n(68906),x=n(31857),A=n(97823),S=n(37002),M=n(9112),O=n(35489),L=n(57357),Z=n(24651),N=n(11430),T=n(68247),R=n(7064),P=n(87155),C=n(89175);function F(e,t){const n=a.Z.get(C.kMailAccounts).slice(),s=n.findIndex((t=>t.MAIL_EMAIL===e));if(-1===s)throw new Error(`Account to be removed, ${e}, was not found in settings`);const i=n.splice(s,1);T.Z.set(C.kMailAccounts,n);const r=i[0];t&&(R.Z.savedpasswords.delete(!0,(0,P.B)(r)),R.Z.savedpasswords.delete(!0,(0,P.Y)(r)))}var U=n(99895),D=n(5863),z=n(25051),B=n(16152),$=n(16504),j=n(61839);const Q={call:async function(e,t){let n=[];const a=Date.now(),s=await m.Z.transaction("rw",y.E.concat([m.Z.pop,m.Z.filters]),(async()=>{const s=await f.Z.findMatchingSles(e,D.Gf,t),{newMessageGroups:i,duplicates:r}=f.Z.findDuplicates(s),o=[];for(const t of r){const{message:n,searchListEntry:s}=t,i={accountId:e,uidl:n.uidl||"",createdTimestamp:a,searchListId:s.id};o.push(i)}const c=i.map((e=>e[0])),l=await(0,y.Z)(e,D.Gf,D.e9,c),d=l.addedSles;return n=l.forSearchDb,d.forEach(((t,n)=>{i[n].forEach((n=>{o.push({accountId:e,uidl:n.uidl,createdTimestamp:a,searchListId:t.id})}))})),m.Z.pop.bulkPut(o),r.length>0&&await f.Z.addSourceFilters(e,D.Gf,D.e9,r,!1),d}));return(0,j.Z)(n),s}};var V=n(51501),q=n(75401),H=n(84283),K=n(89165),W=n(95752),G=n(49168),Y=n(34198);function X(e,t,n,a){return n.some((n=>0!==n.length&&n.every((n=>function(e,t,n,a){if(n.accountId||n.path||n.hasOwnProperty("folder")){const t=w.Z.getByIds(e.sourceFilterIds);let s;if(n.accountId?s=t.some((e=>e.accountId===n.accountId)):n.path&&(s=t.some((e=>e.path===n.path))),n.hasOwnProperty("folder")&&(s=n.folder===D.uT?H.Z.isMessageDeleted(e.sources,a):n.folder===D.Hd?(0,K.Z)(e.sources,e.flags):n.folder===D.hn?(0,q.Z)(e.sources):n.folder===D.Z3?!t.some((t=>{if(E.Z.getFolderType(t.accountId,t.path)===D.Nz){return e.sources.get(t.id)?.internal}return!1})):t.some((e=>{const t=E.Z.getFolderType(e.accountId,e.path);return n.folder&&n.folder===t}))),!s)return!1}if(n.listId&&n.listId!==(0,Y.P7)(t.listId))return!1;if(n.flag){let t;if((0,G.R7)(n.flag))if(n.flag===D.T4.DELETED)t=H.Z.isMessageDeleted(e.sources,a);else{if(n.flag!==D.T4.SEEN)throw new Error("Unhandled source flag "+n.flag);t=W.Z.call(e.sources,a)}else t=e.flags.includes(n.flag);if(!t)return!1}if(n.senderIsMailingList&&(!e.from[0]||n.senderIsMailingList!==e.from[0].address))return!1;return!0}(e,t,n,a)))))}const J={searchAddresses:function(e,t){const n=t.map((e=>e.address)),a=e.address;return n.some((e=>e.toLowerCase()===a))},filterMessage:function(e,t,n){let a=!1;const{filterValue:s}=e,{include:i,exclude:r,attachments:o,sentDate:c,sentDateEnd:l}=s;if("number"==typeof o){if(0===o&&t.attachment>0)return!1;if(o>0&&0===t.attachment)return!1}if(c&&c>t.sentDate)return!1;if(l&&l<t.sentDate)return!1;if(r||i)if(r&&i){const s=X(t,n,r,e),o=X(t,n,i,e);!s&&o&&(a=!0)}else i?a=X(t,n,i,e):r&&(a=!X(t,n,r,e));else a=!0;return a}},ee={mergeFilteringQueueItems:function(e){const t=new Map,n=new Set;if(e.length<=1)return{updatedItems:t,deletedItemIds:n};let a,s,i=0;for(;i<e.length;){let r=1;if(a){const s=e[i],r=a.id;a=ee.mergeItems(a,s),a&&(a.id===r?n.add(s.id):(n.add(r),t.delete(r)),t.set(a.id,a))}if(!a&&i<e.length-1){if(s){const a=[e[i],e[i+1]],o=s.map((({id:e})=>e));if(s=ee.mergeItemPairs(s,a),s){for(let e=0;e<2;e++){const i=s[e],r=o[e],c=a[e];i.id===r?n.add(c.id):(n.add(r),t.delete(r)),t.set(i.id,i)}r=2}}if(!s){const o=e[i],c=e[i+1];if(a=ee.mergeItems(o,c),a){const e=a.id===o.id?c.id:o.id;n.add(e),t.set(a.id,a),r=2}else if(i<e.length-3){const a=[o,c],l=[e[i+2],e[i+3]];if(s=ee.mergeItemPairs(a,l),s){for(let e=0;e<2;e++){const i=s[e],r=a[e],o=l[e];n.add(i.id===r.id?o.id:r.id),t.set(i.id,i)}r=4}}}}i+=r}return{updatedItems:t,deletedItemIds:n}},mergeItems:function(e,t){if(e.priority!==t.priority)return;if("FILTERS_SLES"===e.type&&"FILTERS_SLES"===t.type)return ee.mergeFiltersSles(e,t);if("UPDATE_SLE"===e.type&&"UPDATE_SLE"===t.type)return ee.mergeUpdateSle(e,t)},mergeItemPairs:function(e,t){if(ee.numberArraysMatch(t[0].searchListIds||void 0,t[1].searchListIds||void 0)){const n=ee.mergeItems(e[0],t[0]);if(n){const a=ee.mergeItems(e[1],t[1]);if(a)return[n,a]}}},mergeFiltersSles:function(e,t){if(!ee.numberArraysMatch(e.filterIds,t.filterIds))return;if(!ee.folderIdsMatch(e.folderIds,t.folderIds))return;if(e.runAllMessages!==t.runAllMessages)return;if(e.runMailingLists!==t.runMailingLists)return;if(e.runCustomFolders!==t.runCustomFolders)return;if(e.runFlagFolders!==t.runFlagFolders)return;if(e.runLabels!==t.runLabels)return;if(e.runQueries!==t.runQueries)return;if(e.runSingleThread!==t.runSingleThread)return;const n=new Set([...e.searchListIds,...t.searchListIds]);return{...e,searchListIds:[...n]}},mergeUpdateSle:function(e,t){if(void 0!==e.currentSearchListId||void 0!==t.currentSearchListId)return;if(e.unread!==t.unread)return;if(e.unseen!==t.unseen)return;if(!ee.viewIdSetsMatch(e.removeViewIds,t.removeViewIds))return;if(!ee.sourcesMatch(e.sources,t.sources))return;if(e.reRunUpdated!==t.reRunUpdated)return;if(e.searchListIds&&t.searchListIds){const n=new Set([...e.searchListIds,...t.searchListIds]);return{...e,searchListIds:[...n]}}return t.searchListIds?{...e}:e.searchListIds?{...t}:{...e}},numberArraysMatch:function(e,t){return ee.arraysMatch(e,t,(function(e,t){const n=new Set(t);return!e.some((e=>!n.has(e)))}))},folderIdsMatch:function(e,t){return ee.arraysMatch(e,t,(function(e,t){return!e.some((e=>!t.find((t=>e[0]===t[0]&&e[1]===t[1]))))}))},viewIdSetsMatch:function(e,t){if(!e&&!t)return!0;if(!e||!t)return!1;if(e.size!==t.size)return!1;return![...e].some((e=>!t.has(e)))},sourcesMatch:function(e,t){if(!e&&!t)return!0;if(!e||!t)return!1;if(e.size!==t.size)return!1;return![...e.keys()].some((n=>{const a=e.get(n),s=t.get(n);if(!a&&!s)return!1;if(!a||!s)return!0;const i=Object.keys(a),r=Object.keys(s);if(i.length!==r.length)return!0;for(const e of i)if(a[e]!==s[e])return!0;return!1}))},arraysMatch:function(e,t,n){if(void 0===e&&void 0===t)return!0;if(void 0===e||void 0===t)return!1;if(e.length!==t.length)return!1;return n(e,t)}};const te=ee;const ne=function(e,t){return[...e.entries()].some((([e,n])=>{if(n.deleted)return!1;const a=w.Z.get(e);if(!a)throw new Error("Source filter not found "+e);const{accountId:s,path:i}=a;return E.Z.getFolderType(s,i)===t}))};var ae=n(5204),se=n(95538),ie=n(81830),re=n(1407),oe=n(51733);const ce={filter:fe,filterUpdateSle:async function(e){const{priority:t,searchListIds:n,currentSearchListId:a=0,unread:s,unseen:i,sources:r,removeViewIds:o=new Set,batchSize:c=ue,reRunUpdated:l}=e,d=[],u=Date.now();let h,f;if(n){const e=n.splice(0,c);[h,f]=await m.Z.transaction("rw",[m.Z.searchList,m.Z.viewIds],(()=>Promise.all([m.Z.searchList.where("id").anyOf(e).toArray(),m.Z.viewIds.where("searchListId").anyOf(e).toArray()])))}else{if([h,f]=await m.Z.transaction("rw",[m.Z.searchList,m.Z.viewIds],(()=>Promise.all([m.Z.searchList.where("id").above(a).limit(c).toArray(),m.Z.viewIds.where("searchListId").above(a).limit(c).toArray()]))),0===h.length)return!0;e.currentSearchListId=h[h.length-1].id}const p=new Map(f.map((({searchListId:e,viewIds:t})=>[e,t])));for(const e of h){const t=new Set,n=new Set([...o]),{id:a}=e,c=p.get(a);if(!c)throw new Error("viewIds not found "+a);const l=new Set;if(c.forEach((e=>{const t=Math.floor(e/D.XN);l.add(t)})),l.forEach((a=>{if(void 0!==s){const e=a*D.XN+D.aD;s?t.add(e):n.add(e)}if(void 0!==i){const e=a*D.XN+D.ZC;i?t.add(e):n.add(e)}if(void 0!==r){const s=a*D.XN+D.IK,i=a*D.XN+D.aD;r.forEach(((r,o)=>{a===o?r?(void 0!==r.deleted&&(r.deleted?(0,K.Z)(e.sources,e.flags)||n.add(s):t.add(s)),void 0!==r.read&&(r.read?n.add(i):t.add(i))):V.ZP.getAllViewTypes().forEach((e=>{n.add(a*D.XN+e)})):e.sources.has(a)||(H.Z.isMessageDeleted(e.sources)?n.add(s):t.add(s),W.Z.call(e.sources)?n.add(i):t.add(i))}))}})),c.forEach((e=>{t.delete(e)})),[...n].forEach((e=>{c.includes(e)||n.delete(e)})),t.size>0||n.size>0){const e={id:a,updates:{}};t.size>0&&(e.updates.addedViewIds=[...t],t.forEach((e=>{c.push(e)}))),n.size>0&&(e.updates.removedViewIds=[...n],n.forEach((e=>{const t=c.indexOf(e);t>=0&&c.splice(t,1)}))),d.push(e)}else p.delete(a)}if(p.size>0&&(await m.Z.viewIds.where("searchListId").anyOf([...p.keys()]).modify((e=>{const t=p.get(e.searchListId);t&&(e.viewIds=t)})),l)){const e=[...p.keys()];await k.Z.call({type:"RE_RUN_SLES",priority:t,searchListIds:e})}d.length>0&&z.QO.updateIndex({sleUpdates:d});if(n&&0===n.length)return!0;{const t=Date.now();return e.batchSize=he(c,t-u),!1}},filterSles:async function(e,t,n,a,s){const i=[],r=[],o=[],c=[],l=[],d=new Set,u=new Map,f=new Map,p=new Map,g=function(e){const t=new Set,n=[];for(const{accountId:a,path:s}of e)h.Z.isMailAccount(a)&&(s===D.ym?n.push(a):t.add(a));for(const e of n)t.delete(e);if(0===t.size)return[];const a=[...t].map((e=>[e,D.ym]));return w.Z.getByFolderIds(a)}(a),_=[...a,...g];for(let a=0;a<e.length;a++){const i=e[a],r=t[a],o=new Map;for(const e of _){if(J.filterMessage(e,i,r)){const{query:t}=e.filterValue;if(!n.get(i.id))throw new Error("viewIds not found in viewIdsBySleId for "+i.id);if(t&&!s?.skipQueries){const t=p.get(e);t?t.push(i):p.set(e,[i])}else o.set(e,!0)}else o.set(e,!1)}f.set(i,o)}if(p.size>0)for(const[e,t]of p){const{query:n}=e.filterValue;if(n){const a=await(0,ie.Z)(n),s=new Set(a);for(const n of t){let t=f.get(n);t||(t=new Map,f.set(n,t)),s.has(n.id)?t.set(e,!0):t.set(e,!1)}}}for(const e of _){const t=V.ZP.getViewIdsByFilterId(e.id);for(const e of t)d.add(e)}for(let a=0;a<e.length;a++){const h=e[a],p=t[a],g=f.get(h);if(!g)continue;const m=ce.getMatchResults(h,p,g,s?.triggerFilterIdCandidates),{id:w}=h,{addedViewIds:_,removedViewIds:b,runTriggerFilterIds:y,isOnMailingList:v}=m,I=n.get(w);if(!I)throw new Error("viewIds not found in viewIdsBySleId for "+w);if(v){[...I,..._].filter((e=>(e-D.EO)%D.XN==0)).forEach((e=>{_.delete(e),b.add(e)}))}const E=I.filter((e=>d.has(e))),k=E.filter((e=>!b.has(e))).concat([..._]);let x;if(!(k.length===E.length&&k.every((e=>E.includes(e))))){const e=I.filter((e=>!b.has(e))).concat([..._]);u.set(w,e),x={addedViewIds:[..._].filter((e=>!I.includes(e))),removedViewIds:I.filter((e=>b.has(e)&&!_.has(e)))},n.set(w,e)}y.size>0&&(x={...x||{},runTriggerFilterIds:[...y]}),x&&i.push({id:w,updates:x}),(0,Y.P7)(p.listId)&&(r.push(h),o.push(p)),(0,G.OK)(h.flags)&&(c.push(h),l.push(p))}u.size>0&&await m.Z.viewIds.where("searchListId").anyOf([...u.keys()]).modify((e=>{const t=u.get(e.searchListId);t&&(e.viewIds=t)}));return{sleUpdates:i,mailingListCandidateSles:r,mailingListCandidateMessages:o,labelsCandidateSles:c,labelsCandidateMessages:l}},getMatchResults:function(e,t,n,a){const s=new Set,i=new Set,r=new Set,o=w.Z.getByIds(e.sourceFilterIds);let c=!1;for(const[l,d]of n){const n=V.ZP.getViewIdsByFilterId(l.id);for(const e of n)i.add(e);d&&(a?.includes(l.id)&&r.add(l.id),n.forEach((n=>{switch(V.ZP.getViewType(n)){case D.xE:s.add(n);break;case D.ZC:e.unseen&&s.add(n);break;case D.aD:W.Z.call(e.sources,l)||s.add(n);break;case D.EO:const a=(0,Y.P7)(t.listId);if(a){const e=se.Z.getMailingListGroup(a);e&&e.isIgnored?s.add(n):c=!0}else be(e.from)?c=!0:s.add(n);break;case D.IK:H.Z.isMessageDeleted(e.sources,l)||s.add(n);break;case D.Fz:o.some((e=>e.accountId!==D.u4))&&s.add(n);break;case D.Jq:(0,K.Z)(e.sources,e.flags)||s.add(n);break;case D.js:const i=ne(e.sources,D.Oi),r=ne(e.sources,D.e9);i&&!r||s.add(n);break;case D.pF:(0,q.Z)(e.sources)||s.add(n)}})))}return{addedViewIds:s,removedViewIds:i,runTriggerFilterIds:r,isOnMailingList:c}},updateFilteringQueue:async function(){return m.Z.transaction("rw",[m.Z.filteringQueue],(async()=>{const e=pe.reduce(((e,{id:t})=>Math.max(e,t)),0),t=await m.Z.filteringQueue.where("id").above(e).toArray();pe.push(...t),pe.sort(oe.Hc);const{updatedItems:n,deletedItemIds:a}=te.mergeFilteringQueueItems(pe);if(0===n.size&&0===a.size)return pe;const s=[];for(const e of pe){const t=n.get(e.id);t?s.push(t):a.has(e.id)||s.push(e)}return pe=s,m.Z.filteringQueue.bulkPut([...n.values()]),m.Z.filteringQueue.bulkDelete([...a]),s}))},clearQueue:function(){pe=[]},deleteFilteringItem:async function(e){await m.Z.filteringQueue.delete(e.id);const t=pe.indexOf(e);t>=0&&pe.splice(t,1)}};let le=!1;const de=100,ue=2e3,he=x.Z.adjustBatchSize.bind(void 0,de,2e4,1e3);async function fe(){if(le)return b.Z.log("Mail",["filtering"],"Already filtering."),Promise.resolve();le=!0;try{z.U.setPersistentStatus(re.A4,"MAIL_FILTERING",(0,u.Z)("Running mail filters..."));let e=await ce.updateFilteringQueue();for(;e.length>0;){const t=e[0];let n=!0;try{switch(t.type){case"FILTERS_SLES":n=await ge(t);break;case"UPDATE_SLE":n=await ce.filterUpdateSle(t);break;case"MOVE_SLE":await me(t);break;case"RUN_FILTERS":n=await we(t);break;case"RE_RUN_SLES":n=await _e(t);break;default:b.Z.warn("Mail",["filtering"],"Invalid filtering queue item type",t.type)}n&&await ce.deleteFilteringItem(t)}catch(e){b.Z.error("Mail",["filtering"],"Filtering failed",JSON.stringify(t),e),await ce.deleteFilteringItem(t)}e=await ce.updateFilteringQueue()}}catch(e){b.Z.error("Mail",["filtering"],e)}finally{le=!1,z.U.clearPersistentStatus(re.A4,"MAIL_FILTERING")}}let pe=[];async function ge(e){const{filterIds:t,folderIds:n=[],searchListIds:a,runAllMessages:s=!1,runMailingLists:i=!1,runCustomFolders:r=!1,runLabels:o=!1,runFlagFolders:c=!1,runQueries:l=!1,runSingleThread:d=!1,batchSize:u=ue}=e,h=w.Z.getAll().filter((e=>{const{id:a,accountId:u,path:h}=e;if(!!n.find((e=>{const[t,n]=e;return t===u&&n===h})))return!0;if(t&&t.includes(a))return!0;switch(u){case D.of:return s&&[D.ym,D.tB,D.ik,D.rp,D.N1,D.cm,D.$T].includes(h);case D.wC:return i;case D.MN:return c;case D.Ry:return r;case D.ut:return o;case D.Kz:return l;case D.tQ:return d}}));if(0===h.length)return!0;const f=Date.now(),p=a.splice(0,u),[g,_,b]=await m.Z.transaction("rw",[m.Z.searchList,m.Z.messages,m.Z.viewIds],(()=>Promise.all([m.Z.searchList.where("id").anyOf(p).toArray(),m.Z.messages.where("id").anyOf(p).toArray(),m.Z.viewIds.where("searchListId").anyOf(p).toArray()])));if(0===g.length)return!0;const y=new Map(b.map((e=>[e.searchListId,e.viewIds]))),v=await ce.filterSles(g,_,y,h),{sleUpdates:I,mailingListCandidateSles:E,mailingListCandidateMessages:k,labelsCandidateSles:x,labelsCandidateMessages:A}=v;if(I.length>0&&z.QO.updateIndex({sleUpdates:I}),E.length>0){const e=await Y.ZP.createMailingListFilters(k);if(e.length>0){await w.Z.updateFilters(e.map((({id:e})=>e)));const t=await ce.filterSles(E,k,y,e),{sleUpdates:n}=t;n.length>0&&z.QO.updateIndex({sleUpdates:n})}}if(x.length>0){const e=await(0,G.uR)(x);await w.Z.updateFilters(e);const t=w.Z.getByIds(e),n=await ce.filterSles(x,A,y,t),{sleUpdates:a}=n;a.length>0&&z.QO.updateIndex({sleUpdates:a})}if(a.length>0){const t=Date.now();e.batchSize=he(u,t-f)}return 0===a.length}async function me(e){const{searchListIds:t,fromFolderId:n,toFolderId:a}=e,s=w.Z.getByFolderId(n),i=w.Z.getByFolderId(a);if(!s||!i)throw new Error("Either from- or to-filter not found");const r=[],[o,c]=await m.Z.transaction("rw",[m.Z.searchList,m.Z.viewIds],(()=>Promise.all([m.Z.searchList.where("id").anyOf(t).toArray(),m.Z.viewIds.where("searchListId").anyOf(t).toArray()]))),l=new Map(c.map((e=>[e.searchListId,e.viewIds]))),d=new Set,u=new Set;for(const e of o){const{id:t}=e,n=l.get(t);if(!n)throw new Error("viewIds not found "+t);const a={id:t,updates:{}};for(const e of V.ZP.getAllViewTypes()){const t=s.id*D.XN+e;if(n.includes(t)){const n=i.id*D.XN+e;u.add(t),d.add(n)}}a.updates.addedViewIds=[...d],a.updates.removedViewIds=[...u],r.push(a),u.forEach((e=>{const t=n.indexOf(e);t>=0&&n.splice(t,1)})),d.forEach((e=>{n.push(e)}))}await m.Z.viewIds.where("searchListId").anyOf([...l.keys()]).modify((e=>{const t=l.get(e.searchListId);t&&(e.viewIds=t)})),z.QO.updateIndex({sleUpdates:r})}async function we(e){const t=[],{filterIds:n,folderIds:a,currentSearchListId:s=0,batchSize:i=ue,triggerFilterIdCandidates:r}=e;if(n){const e=w.Z.getByIds(n);t.push(...e)}if(a){const e=w.Z.getByFolderIds(a);t.push(...e)}if(0===t.length)throw new Error("No valid filters in filtering request");const o=Date.now(),[c,l,d]=await m.Z.transaction("rw",[m.Z.searchList,m.Z.messages,m.Z.viewIds],(()=>Promise.all([m.Z.searchList.where("id").above(s).limit(i).toArray(),m.Z.viewIds.where("searchListId").above(s).limit(i).toArray(),m.Z.messages.where("id").above(s).limit(i).toArray()])));if(0===c.length)return!0;const u=new Map(l.map((e=>[e.searchListId,e.viewIds])));e.currentSearchListId=c[c.length-1].id;const h=await ce.filterSles(c,d,u,t,{triggerFilterIdCandidates:r}),{sleUpdates:f}=h;f.length>0&&z.QO.updateIndex({sleUpdates:f});const p=Date.now();return e.batchSize=he(i,p-o),!1}async function _e(e){const{filterIds:t,folderIds:n,batchSize:a=de,currentSearchListId:s=0,runMailingLists:i=!1}=e,r=[];if(t&&r.push(...t),n){const e=w.Z.getByFolderIds(n);r.push(...e.map((e=>e.id)))}const o=Date.now(),c=[],l=[],[d,u,h]=e.searchListIds?await async function(e,t){const n=e.splice(0,t);return await m.Z.transaction("rw",[m.Z.searchList,m.Z.messages,m.Z.viewIds],(()=>Promise.all([m.Z.searchList.where("id").anyOf(n).toArray(),m.Z.messages.where("id").anyOf(n).toArray(),m.Z.viewIds.where("searchListId").anyOf(n).toArray()])))}(e.searchListIds,a):await async function(e,t){return m.Z.transaction("rw",[m.Z.searchList,m.Z.messages,m.Z.viewIds],(()=>Promise.all([m.Z.searchList.where("id").above(e).limit(t).toArray(),m.Z.messages.where("id").above(e).limit(t).toArray(),m.Z.viewIds.where("searchListId").above(e).limit(t).toArray()])))}(s,a);if(0===d.length)return!0;void 0===e.searchListIds&&(e.currentSearchListId=d[d.length-1].id);const f=w.Z.getAll(),p=new Map(h.map((e=>[e.searchListId,e.viewIds]))),g=[];for(let e=0;e<d.length;e++){const t=d[e],n=p.get(t.id),a=g.find((e=>{const[t]=e;if(n.length!==t.length)return!1;for(let e=0;e<t.length;e++)if(n[e]!==t[e])return!1;return!0})),s=u[e];if(a){const[,[e,n]]=a;e.push(t),n.push(s)}else g.push([n,[[t],[s]]])}const _=[];for(const t of g){const[n,[a,s]]=t,o=new Set([...r,..._]);n.forEach((e=>{const t=Math.floor(e/D.XN);o.add(t)}));const d=f.filter((e=>o.has(e.id)));if(0===d.length)continue;const{skipQueries:u}=e,h=await ce.filterSles(a,s,p,d,{skipQueries:u}),{mailingListCandidateSles:g,mailingListCandidateMessages:m}=h;if(c.push(...h.sleUpdates),i&&g.length>0){const t=await Y.ZP.createMailingListFilters(m);if(t.length>0){const n=t.map((({id:e})=>e));await w.Z.updateFilters(n);const{filterIds:a=[]}=e;e.filterIds=[...a,...n],_.push(...n);const s=await ce.filterSles(g,m,p,t,{skipQueries:u}),{sleUpdates:i}=s;l.push(...i)}}}c.length>0&&z.QO.updateIndex({sleUpdates:c}),l.length>0&&z.QO.updateIndex({sleUpdates:l});const b=Date.now();return e.batchSize=he(a,b-o),!1}function be(e){const t=e[0]?.address;return!!t&&!!w.Z.getByAddress(t)}ae.Z.addListener((async function(e){if("filter"===e.func)await fe()}));const ye=ce;var ve=n(77150),Ie=n.n(ve),Ee=n(16445),ke=n(16888);let xe={level:0,children:new Map};const Ae={data:new Map,add:e=>{void 0!==e.id&&Ae.data.set(e.id,e)},async get(e){const t=Ae.data.get(e);if(t)return t;{const t=await m.Z.threading.get(e);if(!t)return;const n={id:t.id,messageId:t.messageId};return Ae.add(n),n}},clear:()=>{Ae.data.clear()}};function Se(){Ae.clear()}function Me(e){e.forEach((e=>{const{id:t,messageId:n}=e,a={id:t,messageId:n};Ae.add(a)}))}async function Oe(){const e=await m.Z.threading.toArray();for(const t of e){const{id:e,messageId:n}=t,a={id:e,messageId:n};Ae.add(a),await Le(t)}Se()}function Le(e){const t=function(e){const{messageId:t,inReplyTo:n,references:a}=e;if(n===t||a.includes(t))return[];if(n){const e=a.indexOf(n);if(e<0)return[...a,n];if(e<a.length-1)return[n]}return[...a]}(e);return t.reduce(((e,t)=>e.then((e=>Re(t).then((n=>{if(n)return n;{const n={messageId:t},a=Te(void 0,e);return Ze(n,a).then((()=>a))}}))))),Promise.resolve()).then((t=>{const{id:n,sentDate:a,messageId:s,outbound:i}=e,r={id:n,messageId:s};return Re(s).then((e=>{if(e)return Promise.resolve().then((()=>e.sentDateById.has(n)?(e.sentDateById.set(n,a),e):(e.sentDateById.set(n,a),Ze(r,e).then((()=>e))))).then((e=>(t&&(e.children.includes(t)||t.parent===e||(e.parent!==t&&(e.parent=t),t.children.includes(e)||t.children.push(e))),e)));{const e=Te({id:n,sentDate:a,outbound:i},t);return Ze(r,e).then((()=>e))}}))}))}function Ze(e,t,n=xe){if(n.threadNode)return Promise.resolve().then((()=>{if(void 0!==n.id)return Ae.get(n.id).then((t=>{if(t&&t.messageId!==e.messageId)return{id:t.id,messageId:t.messageId}}));if(void 0!==n.messageId){if(n.messageId!==e.messageId)return{messageId:n.messageId};void 0!==e.id&&(n.id=e.id,delete n.messageId)}})).then((a=>{if(!a)return;const s=n.parent,i={children:new Map,level:s.level+1},r=2*s.level,o=r+2,c=e.messageId.substring(r,o);s.children.set(c,i);const l=n.threadNode,d=2*i.level,u=d+2,h=a.messageId.substring(d,u),f=e.messageId.substring(d,u);if(h!==f)return Ne(a,i,l),Ne(e,i,t),Promise.resolve();{const n={level:i.level+1,children:new Map};return i.children.set(f,n),Promise.all([Ze(a,l,n),Ze(e,t,n)])}}));{const a=2*n.level,s=a+2,i=e.messageId.substring(a,s),r=n.children.get(i);return r?Ze(e,t,r):(Ne(e,n,t),Promise.resolve())}}function Ne(e,t,n){const a={parent:t,threadNode:n},{id:s,messageId:i}=e;void 0!==s?a.id=s:a.messageId=i;const r=2*t.level,o=r+2,c=e.messageId.substring(r,o);t.children.set(c,a)}function Te(e,t){const n={sentDateById:new Map,children:[],outbound:!1};if(e){const{id:t,sentDate:a}=e;n.sentDateById.set(t,a),n.outbound=e.outbound}return t&&(t.children.push(n),n.parent=t),n}function Re(e,t=xe){if(!e)return Promise.resolve();if(t.threadNode){if(void 0!==t.messageId)return t.messageId===e?Promise.resolve(t.threadNode):Promise.resolve();if(void 0!==t.id)return Ae.get(t.id).then((n=>n&&n.messageId===e?t.threadNode:Promise.resolve()));throw new Error("Missing messageId and id: "+JSON.stringify(t))}{const n=2*t.level,a=e.substring(n,n+2),s=t.children.get(a);return s?Re(e,s):Promise.resolve()}}function Pe(e){const t=new Map,n=[...e.keys()];return m.Z.searchList.where("id").anyOf(n).modify((n=>{const{id:a}=n,s=e.get(a);s&&(t.set(a,s),n.threadKey=s)})).then((()=>t))}var Ce=n(13617);let Fe=!1;function Ue(e){return Le(e).then((e=>{if(!e.parent&&0===e.children.length)return[];let n=e;const a=new Set;for(;n.parent;){const{parent:e}=n;if(a.has(n))throw new Error("Cyclic thread detected");a.add(n),n=e}return t(n)}));function t(e,s){const{sentDateById:i,children:r}=e;let o,c=[];if(void 0===s){let t=n(e);t||(t=n(e,!1));let s=e.sentDateById.keys().next().value;s||(s=a(e,[0,Number.MAX_SAFE_INTEGER])[0]),o=(0,Ce._)(t,s),i.forEach(((e,t)=>{c.push({id:t,newThreadKey:o})}))}else i.size>0?i.forEach(((e,t)=>{o=[...s,e],c.push({id:t,newThreadKey:o})})):o=s;return r.forEach((e=>{const n=t(e,o);c=[...c,...n]})),c}function n(e,t=!0){const a=t&&e.outbound;let s=[...e.sentDateById.values()].reduce(((e,t)=>Math.max(e,a?0:t)),0);return e.children.forEach((e=>{s=Math.max(s,n(e,t))})),s}function a(e,t){return t=[...e.sentDateById.entries()].reduce(((e,t)=>e[1]<t[1]?e:t),t),e.children.forEach((e=>{t=a(e,t)})),t}}const De={updateThreads:async function(){if(!Fe)for(Fe=!0;Fe;)try{const e=await m.Z.threadingQueue.toCollection().first();if(!e)return b.Z.log("Mail",["Threading"],"Queue is empty, cleaning up"),Se(),void(Fe=!1);if(0===e.threadingIds.length){b.Z.log("Mail",["Threading"],"Deleting empty threading request"),await m.Z.threadingQueue.delete(e.id);continue}const{id:t,threadingIds:n}=e;let a=2e3;const s=new x.Z.BatchSizeOptimizer(a,2e3);b.Z.log("Mail",["Threading"],`Processing threading request #${t} with ${n.length} entries`);const i=n.length;for(;n.length>0;){const r=n.splice(0,a);b.Z.log("Mail",["Threading"],`Processing threading request #${t}, entries ${r.length}/${i}`),await m.Z.transaction("rw",[m.Z.threadingQueue,m.Z.threading,m.Z.searchList],(async()=>{const t=Date.now(),i=await m.Z.threading.where("id").anyOf(r).toArray(),o=new Map;Me(i);for(const e of i)try{(await Ue(e)).forEach((e=>{const{id:t,newThreadKey:n}=e;o.set(t,n)}))}catch(e){b.Z.error("Mail",["Threading"],e)}if(o.size>0){const e=await Pe(o);z.QO.updateThreadKeys(e)}if(n.length>0){await m.Z.threadingQueue.put(e);const n=Date.now();a=s.optimize(r.length,n-t)}else await m.Z.threadingQueue.delete(e.id)}))}}catch(e){throw Fe=!1,b.Z.error("Mail",["Threading"],e),z.U.setStatus(re.A4,(0,u.Z)("Error during threading"),5e3),e}}};var ze=n(3664),Be=n(76257),$e=n(13519),je=n(27950);const Qe=1048576;class Ve extends Error{constructor(e,t,n){super(t),this.code=e,this.socket=n}}function qe(e){return(0,ze.vi)(e,[43,79,75])}function He(e){return 0===e.indexOf("PASS")?"PASS":0===e.indexOf("APOP")?e.replace(/\w+\s*$/,"the_md5_hash"):e}async function Ke(e,t,n){const a=[];return new Promise(((s,i)=>{let r=setTimeout((function(){i(new Ve("SOCKET_TIMEOUT",(0,u.Z)("Failed to connect to POP server after $1 ms",[n]),o))}),n);const o=$.Z.open(e,t,{useSecureTransport:110!==t});if("connecting"!==o.readyState)return clearTimeout(r),void i(new Ve("NO_SOCKET",(0,u.Z)('POP socket did not switch to "connecting" when trying to connect to $1:$2',[e,t]),o));o.onerror=e=>{clearTimeout(r),i(new Ve("NO_SOCKET",(0,u.Z)("POP socket generated unknown error when connecting. Response message: $1",[e.data?.message||e.message||""]),o))},o.ondata=e=>{clearTimeout(r);const t=new Uint8Array(e.data);a.push(...t),(0,ze.MF)(a,[13,10])?s({socket:o,response:new Uint8Array(a)}):r=setTimeout((function(){i(new Ve("SOCKET_TIMEOUT",(0,u.Z)("POP server failed to send connection chunk after $1 ms",[n]),o))}),n)}}))}async function We(e,t,n=!1,a=3e4){if(!e)throw new Ve("NO_SOCKET",(0,u.Z)('No POP socket when sending "$1"',[He(t)]),e);if(await!Ye(e))throw new Ve("SOCKET_CLOSED",(0,u.Z)('POP socket unexpectedly closed before "$1" command could be sent',[He(t)]),e);const s=[];return new Promise(((i,r)=>{let o=setTimeout((function(){clearTimeout(o),r(new Ve("SOCKET_TIMEOUT",(0,u.Z)('POP server did not reply to command "$1" after $2 ms',[He(t),a]),e))}),a);e.onerror=n=>{clearTimeout(o),r(new Ve("SEND_ERROR",(0,u.Z)('POP socket generated unknown error when sending command "$1"',[He(t)]),e))};let c=Date.now();e.ondata=l=>{clearTimeout(o);const d=new Uint8Array(l.data);if(s.push(...d),Date.now()-c>1e3){const e=Math.round(s.length/Qe*10)/10;z.U.setStatus(re.A4,(0,u.Z)("Fetching message: $1 MB",[e])),c=Date.now()}(0,ze.MF)(s,[13,10,46,13,10])||!n&&(0,ze.MF)(s,[13,10])?(n?s.splice(-5):s.splice(-2),(0,ze.Xh)(s,[13,10,46],[13,10]),i(new Uint8Array(s))):o=setTimeout((function(){r(new Ve("SOCKET_TIMEOUT",(0,u.Z)('POP server failed to send additional chunk for command "$1" after $2 ms',[He(t),a]),e))}),a)};const l=`${t}\r\n`,d=(0,ze.sy)(l);e.send(d)}))}async function Ge(e,t,n){const a=await We(e,`USER ${t}`);if(!qe(a))throw new Ve("AUTH_FAIL",(0,u.Z)("Invalid username for POP, server responded with: $1",[(0,ze.DA)(a)]),e);const s=(0,ze.DA)((new TextEncoder).encode(n)),i=await We(e,`PASS ${s}`);if(!qe(i))throw new Ve("AUTH_FAIL",(0,u.Z)("Login to POP server failed, server responded with: $1",[(0,ze.DA)(i)]),e)}function Ye(e){return new Promise((t=>{setTimeout((()=>{t("open"===e.readyState)}),0)}))}async function Xe(e,t,n,a,s=6e4,i=!1){const{socket:r,response:o}=await Ke(e,t,s);if(!qe(o))throw new Ve("CONNECT_ERROR",(0,u.Z)("POP server $1:$2 responded with an error after connection",[e,t]),r);const c=Je(o);if(!c||i)return await Ge(r,n,a),r;try{return await async function(e,t,n,a){const s=(0,ze.DA)((new TextEncoder).encode(n)),i=Ie()(`${a}${s}`),r=await We(e,`APOP ${t} ${i}`);if(!qe(r))throw new Ve("AUTH_FAIL",(0,u.Z)("APOP authentication failed: $1",[(0,ze.DA)(r)]),e)}(r,n,a,c),r}catch(i){if("AUTH_FAIL"===i.message){return await Ye(r)?(await Ge(r,n,a),r):Xe(e,t,n,a,s,!0)}throw i}}function Je(e){const t=e.lastIndexOf(60);if(-1!==t){const n=e.indexOf(62,t);if(-1!==n){const a=e.subarray(t,n+1);return(0,ze.DA)(a)}}}async function et(e,t){const n=await We(e,`TOP ${t.index} 0`,!0);if(qe(n))return{...t,headersOnly:!0,message:st(n)};throw new Ve("TOP_ERROR",(0,u.Z)("POP server did not respond correctly to TOP command. Response: $1",[(0,ze.DA)(n)]))}async function tt(e,t){const n=await We(e,`RETR ${t.index}`,!0);if(qe(n))return{...t,headersOnly:!1,message:st(n)};throw new Ve("RETR_ERROR",(0,u.Z)("POP server did not respond correctly to RETR command. Response: $1",[(0,ze.DA)(n)]),e)}function nt(e){const t=[...e],n=new Map;let a=(0,ze.L2)(t,[13,10]);for(;-1!==a;){const e=(0,ze.L2)(t,[13,10],a+1),s=-1!==e?t.slice(a+2,e):t.slice(a+2),i=s.indexOf(32);if(-1===i){a=e;continue}const r=s.slice(0,i),o=s.slice(i+1),c=Number(String.fromCharCode(...r)),l=String.fromCharCode(...o);n.set(l,c),a=e}return n}function at(e){const t=[...e],n=new Map;let a=(0,ze.L2)(t,[13,10]);for(;-1!==a;){const e=(0,ze.L2)(t,[13,10],a+1),s=-1!==e?t.slice(a+2,e):t.slice(a+2),i=s.indexOf(32);if(-1===i){a=e;continue}const r=s.slice(0,i),o=s.slice(i+1),c=Number(String.fromCharCode(...r)),l=parseInt(String.fromCharCode(...o));n.set(c,l),a=e}return n}function st(e){const t=(0,ze.L2)(e,[13,10]);if(-1===t)throw new Error("parseRetrResponse: Expected end of line");return e.subarray(t+2)}async function it(e,t,n){const a=[];for(const e of n){const t=Ee.Z.call(e.message),n=(0,Be.Zp)(e.message),s=(0,Be.Dc)(n),i={to:t.to,from:t.from,cc:t.cc,inReplyTo:t.inReplyTo,replyTo:t.replyTo,subject:t.subject,sentDate:t.sentDate,messageId:t.messageId,listId:t.listId,listPost:t.listPost,references:t.references,flags:[],uidl:e.uidl||"",attachment:s.length,size:e.size};i.messageId||(i.messageId=""),a.push(i)}const s=await Q.call(t,a).catch((n=>{throw new Ve("STORE_ERROR",(0,u.Z)("Unable to store POP message in mail store.",[t]),e)}));if(s.length>0){const i=[];for(const r of s){const s=a.findIndex((e=>f.Z.messageEqualsSle(e,r))),o=a[s],c=n[s];if(!c.headersOnly){const{sentDate:n,id:a}=r;try{const s=await(0,ke.Z)(a,o,c.message);s&&(c.message=s.raw,r.preview=(0,$e.Qe)(s.bodyParts),await(0,L.Z)(a,r.preview)),await rt(e,t,c,n,a),i.push(a)}catch(e){b.Z.error("Mail",["pop",t,a],"Failed to process mail: ",e)}}}i.length>0&&await Z.Z.setHasRaws(t,i)}return s}async function rt(e,t,n,a,s){try{await U.Z.call(t,a,s,n.message)}catch(n){throw new Ve("STORE_ERROR",(0,u.Z)("Unable to store POP message as writing to disk failed.",[t]),e)}}async function ot(e,t){switch(e.message){case"SOCKET_TIMEOUT":case"SEND_ERROR":case"CONNECT_ERROR":case"DELETE_ERROR":case"NO_UIDL":case"NO_SOCKET":e.socket&&e.socket.close();break;case"MISCONFIGURED_ACCOUNT":case"SOCKET_CLOSED":break;default:if(e.socket){const{socket:n}=e;ct(t,n,!1)}}throw e.socket&&(e.socket.onerror=null),z.KU.set(t,"POP",e,e.code),e}async function ct(e,t,n=!0){try{await We(t,"QUIT"),t.close()}catch(t){if(n)throw t;b.Z.error("Mail",["pop-client",e],t)}}async function lt(e,t){const n=await We(e,"UIDL",!0);if(!qe(n))throw new Ve("NO_UIDL",(0,u.Z)("POP server $1 does not support UIDL",[t]),e);const a=nt(n);z.U.setStatus(re.A4,(0,u.Z)("$1 message exists on POP account $2","$1 messages exist on POP account $2",[a.size,t]));const s=await We(e,"LIST",!0);if(!qe(s))throw new Ve("NO_LIST",(0,u.Z)("POP server $1 does not support LIST",[t]),e);return{uidlMap:a,sizeMap:at(s)}}async function dt(e){try{const t=e.MAIL_USER,n=e.MAIL_PASSWORD,a=e.MAIL_SERVER,s=e.MAIL_PORT;if(!(t&&n&&a&&s))throw new Ve("MISCONFIGURED_ACCOUNT",(0,u.Z)("Incoming POP server attributes missing for $1",[e.MAIL_EMAIL]));const i=await Xe(a,s,t,n);return z.KU.remove(e.MAIL_EMAIL,"POP"),i}catch(t){throw z.KU.set(e.MAIL_EMAIL,"POP",t,t.code),t}}function ut(e){return e.popDeletion||{when:D.qd,howManyDays:0}}async function ht(e){const t=(await A.Z.loadPopAccounts()).find((({MAIL_EMAIL:t})=>t===e));if(t)return t;throw new Error("Account not found "+e)}async function ft(e,t,n){const a=[],s=[];let i=!0;const r=ut(e),o=function(e){const t=e.popMaxSize||{limited:!1,limit:0};return t.limited?t.limit*Qe:0}(e);for(const c of t){const{index:t,size:l}=c;let d;if(i&&o&&void 0!==l&&l>o)try{d=await et(n,c)}catch(t){i=!1,b.Z.warn("Mail",["pop-client",e.MAIL_EMAIL],"Error using TOP to fetch mail, using RETR instead.",t)}d||(d=await tt(n,c),r.when===D.eQ&&s.push(t)),a.push(d)}return{popMails:a,safeToDelete:s}}async function pt(e,t){for(const n of t){if(!qe(await We(e,`DELE ${n}`)))throw new Ve("DELETE_ERROR",(0,u.Z)("Failed to delete mail with index $1",[n]),e)}}const gt={verifyLogin:async function(e){const{MAIL_SERVER:t,MAIL_PORT:n,MAIL_USER:a,MAIL_PASSWORD:s,MAIL_EMAIL:i}=e;if(!(t&&n&&(a&&s||e.useOAuth)))throw new Ve("MISCONFIGURED_ACCOUNT",(0,u.Z)("Incoming server attributes missing for $1",[i]));try{const e=await Xe(t,n,a,s,1e4);await ct(i,e)}catch(e){await ot(e,i)}},deleteMail:async function(e,t){if(!e.popDeletion||e.popDeletion.when!==D.Qp)return;const n=e.MAIL_EMAIL;try{const a=await dt(e),s=await We(a,"UIDL",!0);if(!qe(s))throw new Ve("NO_UIDL",(0,u.Z)("POP server $1 does not support UIDL",[n]),a);const i=(await m.Z.pop.where("searchListId").anyOf(t).toArray()).filter((e=>e.accountId===n)).map((e=>e.uidl)),r=nt(s),o=[];for(const e of i)r.has(e)&&o.push(e);await pt(a,o),await We(a,"QUIT"),await a.close()}catch(e){await ot(e,n)}},getMail:async function(e){const t=await dt(e),n=e.MAIL_EMAIL;z.U.setStatus(re.A4,(0,u.Z)("Checking for new mail on POP account $1",[n]));try{const{uidlMap:a,sizeMap:s}=await lt(t,n),i=await async function(e,t,n){const a=e.MAIL_EMAIL,s=[...t.keys()],i=await async function(e,t){const n=t.map((t=>[e,t]));return await m.Z.pop.where("[accountId+uidl]").anyOf(n).toArray()}(a,s),r=new Map,o=new Set;for(const e of i){const{uidl:t,searchListId:n}=e,a=r.get(t);a?a.push(e):r.set(t,[e]),o.add(n)}const c=await O.Z.getBySearchListIdsAccountId([...o],a),l=new Map;for(const e of c)if(e){const{searchListId:t,hasRaw:n}=e;l.set(t,1===n)}const d=[],u=new Set,h=ut(e);for(const[e,s]of t){if(!e){b.Z.warn("Mail",["pop-client",a],"POP message does not have UIDL: "+a+" index: "+s);continue}const t=r.get(e);if(t&&0!==t.length){const[{searchListId:e,createdTimestamp:n}]=t;!1!==l.get(e)&&(h.when===D.eQ||h.when===D.kA&&n+24*h.howManyDays*60*60*1e3<Date.now())&&u.add(s)}else{const t={index:s,uidl:e,size:n.get(s)||0};d.push(t)}}return{toFetch:d,safeToDelete:u}}(e,a,s),{toFetch:r}=i,o=r.length;let c=0;z.U.setStatus(re.A4,(0,u.Z)("Need to fetch $1 message - $2","Need to fetch $1 messages - $2",[o,n]));let l=123;const d=new x.Z.BatchSizeOptimizer(123,5e3);for(;r.length>0;){const a=Date.now(),s=r.splice(0,l),h=await ht(n);if((0,je.OM)(e,h))break;const f=await ft(h,s,t),{popMails:p,safeToDelete:g}=f;if(p.length>0){const e=await it(t,n,p);e.length>0&&z.QO.updateIndex({addedSles:e}),ye.filter(),De.updateThreads()}if(g.length>0){await pt(t,g);for(const e of g)i.safeToDelete.delete(e)}const m=Date.now();c+=s.length,l=d.optimize(s.length,m-a),z.U.setStatus(re.A4,(0,u.Z)("Indexing mail $1 $2/$3",[n,c,o]))}i.safeToDelete.size>0&&await pt(t,[...i.safeToDelete]),await ct(n,t)}catch(e){await ot(e,n)}},getMessage:async function(e,t,n){const a=e.MAIL_EMAIL,s=await dt(e),{uidlMap:i,sizeMap:r}=await lt(s,a),o=i.get(t);if(void 0===o)throw new Error("Message not listed on POP server "+t);const c={index:o,uidl:t,size:r.get(o)||0},{message:l}=await tt(s,c);z.QO.runStoredFiltersForMessages([n]);const d=(0,Be.Zp)(l),u=(0,Be.Dc)(d).length;return u>0&&(await m.Z.searchList.update(n,{attachment:u}),z.QO.updateIndex({sleUpdates:[{id:n,updates:{attachment:u}}]})),l},repliedOK:qe,openPOP:Ke,sendAndReceive:We,parseUidlResponse:nt,parseListResponse:at,parseRetrResponse:st,arrayEndsWith:ze.MF,getNonce:Je};let mt;const wt={};async function _t(e){if(e.isDeleted)return;const t=e.MAIL_EMAIL;if(navigator.onLine)if(e.offline)z.U.setStatus(re.A4,(0,u.Z)("Account $1 has been set as an offline account. Check settings.",[t]));else{if(!e.MAIL_PORT||e.MAIL_PORT<=0)throw new Error(`Port missing or invalid: ${e.MAIL_PORT||""}`);if(!wt[t]){wt[t]=!0,z.U.setStatus(re.A4,(0,u.Z)("Indexing - $1 $2",[t,D.Gf]));try{await gt.getMail(e),z.U.setStatus(re.A4,(0,u.Z)("Finished indexing - $1",[t]),D.QM)}catch(t){!function(e,t){b.Z.error("Mail",["pop",e.MAIL_EMAIL],t);const n=`${e.MAIL_SERVER||""} / ${e.MAIL_USER||""}: ${t.name} `;t.message=n+t.message,z.U.setStatus(re.A4,t.message)}(e,t)}finally{wt[t]=!1,z.QO.removePathIndicator(t,D.Gf)}}}else z.U.setStatus(re.A4,(0,u.Z)("No network connection"))}async function bt(e){let t=await A.Z.loadPopAccounts();if(t=t.filter((e=>!e.offline)),!t)return;if((await m.Z.systemTasks.toArray()).some((e=>"restore_mail_db"===e.taskName)))b.Z.warn("Mail",["pop",e||"all accounts"],"Not connecting while restoration in progress");else if(e){const n=t.find((t=>t.MAIL_EMAIL===e));n&&await _t(n)}else for(let e=0;e<t.length;e++)await _t(t[e])}function yt(e,t){return gt.deleteMail(e,t)}function vt(e,t,n){return gt.getMessage(e,t,n)}const It={checkForMail:bt,deletePopMail:yt,getPopMessage:vt,setCheckInterval:function(e,t){mt&&clearInterval(mt),mt=e?setInterval(bt,6e4*t):void 0}};self.addEventListener("message",(async function({origin:e,data:t,source:n}){if(e!==re.oP||!t||!t.pop)return;const{promiseId:a,func:s,args:i=[]}=t.pop;if(s)try{const e=await It[s](...i),t=e&&"getPopMessage"===s?[e.buffer]:void 0;n.postMessage({pop:{promiseId:a,results:e}},{transfer:t})}catch(e){n.postMessage({pop:{promiseId:a,error:e.message||e}})}}),!1);var Et=n(35874),kt=n(13248),xt=n(83204),At=n(92292),St=n(26067);function Mt(e,t,n){const{pathArray:a,fileName:s}=(0,St.ZP)(e,t,n);return new Promise((e=>{R.Z.mailPrivate.messageFileExists(a,s,(t=>{At.Z.runtime.lastError?e(!1):e(t)}))}))}const Ot={runSystemTask:async function(e){const{fileKeys:t}=e,n=t.length;let a=0,s=111;const i=new x.Z.BatchSizeOptimizer(s,2e3);for(;t.length>0;){z.U.setStatus(re.A4,(0,u.Z)("Checking raw email files $1/$2",[a,n]));const r=Date.now(),o=t.splice(0,s),c=[];for(const e of o){const{accountId:t,searchListId:n,sentDate:a}=e,s=await Mt(t,a,n)?1:0;c.push({accountId:t,searchListId:n,hasRaw:s,sentDate:a})}await m.Z.transaction("rw",[m.Z.hasRaw,m.Z.systemTasks],(()=>{m.Z.hasRaw.bulkPut(c),m.Z.systemTasks.update(e.id,{fileKeys:t})})),a+=s;const l=Date.now();s=i.optimize(o.length,l-r)}await m.Z.systemTasks.delete(e.id),z.U.setStatus(re.A4,(0,u.Z)("Done checking $1 raw email files",[n]))},isRawOnDisk:Mt};var Lt=n(89378),Zt=n(83507);var Nt=n(5267);var Tt=n(57654),Rt=n(19789);var Pt=n(60308),Ct=n(9982),Ft=n(25100),Ut=n(40348);async function Dt(e,t,n,a,s){const i={added:0,failed:0,dups:0,renamed:0};if(e.from.length+e.to.length+e.cc.length===0&&!e.subject){b.Z.warn("Mail",["restoreMailDb",t,n,a],"Selected file does not seem to be a mail file");const e=(0,u.Z)("Selected file does not seem to be a mail file: $1",[a]);return z.U.setStatus(re.A4,e,D.QM),i}const r=E.Z.getFolderType(t,n),{indexUpdates:o}=await Pt.Z.call(t,n,r,[e]),{addedSles:c=[],sleUpdates:l=[]}=o,d=c[0];if(!(d||l&&0!==l.length))return b.Z.info("Mail",["restoreMailDb",t,n,a],"Message already exists."),i.dups+=1,i;if(d&&s){const n=E.Z.getFolderType(t,D.N1),a=await f.Z.addSourceFilters(t,D.N1,n,[{message:e,searchListEntry:d}],!0);l.push(...a)}z.QO.updateIndex(o),i.added+=c.length;const{id:h}=d||l[0],{relativePathParts:p,fileName:g}=(0,St.xh)(a);try{await R.Z.mailPrivate.renameMessageFile(p,g,`_${h}.eml`),At.Z.runtime.lastError&&b.Z.error("Mail",["restoreMailDb","renameMessageFile",g],At.Z.runtime.lastError.message||"")}catch(e){return b.Z.error("Mail",["restoreMailDb",...p,g,h],e),i.failed+=1,i}return i.renamed+=1,await Z.Z.setHasRaw(t,h),await(0,Ct.Z)(t,n,[e]),ae.Z.filter(),De.updateThreads(),i}async function zt(e){try{const t=(0,St.sz)(e),n=await R.Z.mailPrivate.getFilePaths(t);At.Z.runtime.lastError&&b.Z.error("Mail",["restoreMailDb","getFilePaths",t],At.Z.runtime.lastError.message||"");for(const e of n){const{fileName:t,relativePathParts:n}=(0,St.xh)(e);if("_"===t[0]){const e=t.slice(1);await R.Z.mailPrivate.renameMessageFile(n,t,e),At.Z.runtime.lastError&&b.Z.error("Mail",["restoreMailDb","renameMessageFile",t,e],At.Z.runtime.lastError.message||"")}}}catch(e){b.Z.error("Mail",["restoreMailDb"],e)}}async function Bt(e,t,n){if(!n.includes(e)){if(t.find((t=>t.MAIL_EMAIL===e))){b.Z.warn("Mail",["restoreMailDb"],`Account ${e} missing and being added`);const t=c.Z.getDefaultFolders(),n=await r.Z.add(e,t);await h.Z.addAccounts({[e]:n});const a=await o.Z.foldersToFilters(e,t);w.Z.updateFilters(a)}}}async function $t(e){try{"restore_mail_db"===e.taskName?await async function(e){let t=0,n=0,a=0,s=0,i=0,o=0,c=0,l=0,d=0;try{const h=await R.Z.mailPrivate.getMailFilePaths();At.Z.runtime.lastError&&b.Z.error("Mail",["restoreMailDb","getMailFilePaths"],At.Z.runtime.lastError.message||""),h.sort();const f=await A.Z.loadAllAccounts(),p=f.map((e=>e.MAIL_EMAIL)),g={};for(const e of p)g[(0,St.BB)(e)]=e;const w=(0,St.BB)(D.u4);let _=[],y=0;if(e.currentFilePath)for(;y<h.length;y++){const t=h[y];if(t.slice(0,t.lastIndexOf("/"))===e.currentFilePath.slice(0,e.currentFilePath.lastIndexOf("/")))break}for(let p=y;p<h.length;p++){p%20==0&&z.U.setStatus(re.A4,(0,u.Z)("Rebuilding database: $1/$2",[p,h.length]));const y=h[p];try{const{relativePathParts:d,fullPathParts:u}=(0,St.xh)(y),[h]=d;if(h===w)continue;_.length>0&&u.slice(0,u.length-1).some(((e,t)=>_[t]!==e))&&(await zt(_),await m.Z.systemTasks.update(e.id,{currentFilePath:y})),_=u;const p=u[u.length-1];let[v,I]=p.split(".");if("_"===v[0]&&(v=v.slice(1)),!I||"eml"!==I.toLowerCase()){b.Z.warn("Mail",["restoreMailDb"],"file name does not have an eml extension",y);continue}if(!Number(v)){b.Z.warn("Mail",["restoreMailDb"],"file does not have a numeric file name",y);continue}if(h===w){b.Z.warn("Mail",["restoreMailDb"],"Not able to restore Feed items yet!");continue}const E=await(0,Ut.Z)(y);if(0===E.length){b.Z.warn("Mail",["restoreMailDb"],"file is empty",y);continue}t+=1;const k=Ee.Z.call(E),x=await(0,Ft.Z)(k,[],E),A=g[h],S=x.to.find((e=>e.address===A)),M=x.from.find((e=>e.address===A));let O=S?.address;const L=M?.address;let Z;O||L||(O=A);const N=O===L,T=(await r.Z.getAll()).map((e=>e.accountId));if(O){await Bt(O,f,T);const{added:e,failed:t,dups:s,renamed:r}=await Dt(x,O,D.Gf,y,N);N?i+=e:a+=e,o+=t,l+=s,n+=r,n>0&&(Z=y.replace(/([0-9]+\.eml)$/,"_$1"))}if(L&&!N){await Bt(L,f,T);const e=Z||y,{added:t,failed:a,dups:i,renamed:r}=await Dt(x,L,D.N1,e,!1);s+=t,c+=a,l+=i,n+=r}}catch(e){d+=1,b.Z.error("Mail",["restoreMailDb"],e)}}_.length>0&&await zt(_),await m.Z.systemTasks.delete(e.id)}catch(e){d+=1,b.Z.error("Mail",["restoreMailDb"],e)}b.Z.warn("Mail",["restoreMailDb"],"Message files read",t),b.Z.warn("Mail",["restoreMailDb"],"Message files renamed",n),b.Z.warn("Mail",["restoreMailDb"],"Duplicates",l),b.Z.warn("Mail",["restoreMailDb"],"Added to Inbox",a),b.Z.warn("Mail",["restoreMailDb"],"Added to Inbox and Sent",i),b.Z.warn("Mail",["restoreMailDb"],"Added to Sent",s),b.Z.warn("Mail",["restoreMailDb"],"Failed adding to Inbox",o),b.Z.warn("Mail",["restoreMailDb"],"Failed adding to Sent",c),b.Z.warn("Mail",["restoreMailDb"],"Errors",d)}(e):"restore_full_text_search_db"===e.taskName?await async function(e){const t=await m.Z.searchList.toCollection().last();if(t){z.QO.pausePrefetching("restoreFullTextSearchDb",!0);try{let{currentPosition:n}=e;for(;n<=t.id;){if(!l.Z.isFeedsOn()){z.U.setStatus(re.A4,(0,u.Z)("Mail client turned off - Stopped building text-search database"),3e3);break}z.U.setStatus(re.A4,(0,u.Z)("Building text-search database: $1/$2",[(0,Rt.uf)(n),(0,Rt.uf)(t.id)]));const a=await m.Z.messages.where("id").between(n,t.id+1).limit(20).toArray();if(0===a.length)break;const s=await m.Z.searchList.where("id").between(n,a[a.length-1].id+1).toArray(),i=[];for(let e=0;e<a.length;e++){const t=a[e],n=s[e],{subject:r,to:o,cc:c,from:l,replyTo:d}=t;let u=(0,$e.Hg)(t.bodyParts);if(!u)for(const e of new Set(n.sourceFilterIds.map((e=>w.Z.get(e))).filter(Boolean).map((e=>e.accountId)))){const t=await Zt.Z.call(e,n.id,n.sentDate);if(t){if(e===D.u4){const e=new TextDecoder("utf-8").decode(t);u=(0,Tt.Z)(e)}else{const e=(0,Be.PW)((0,Be.Zp)(t));if(!e)break;const n=await N.Z.parseMail(t,e.mimeTree);u=(0,$e.Hg)(n.bodyParts)}break}}i.push({searchListId:n.id,subject:r,body:u,to:(0,Lt.Z)(o),cc:(0,Lt.Z)(c),from:(0,Lt.Z)(l),replyTo:(0,Lt.Z)(d)})}await(0,j.Z)(i),n=a[a.length-1].id+1,await m.Z.systemTasks.update(e.id,{currentPosition:n})}l.Z.isFeedsOn()&&(await m.Z.systemTasks.delete(e.id),z.U.setStatus(re.A4,(0,u.Z)("Building text-search database finished"),D.QM)),z.QO.runStoredFilters()}finally{z.QO.pausePrefetching("restoreFullTextSearchDb",!1)}}else await m.Z.systemTasks.delete(e.id)}(e):"copy_raw"===e.taskName?await async function(e){const{sourceId:t,targetId:n}=e;let a=await m.Z.hasRaw.where("searchListId").equals(n).toArray();if(a=a.filter((e=>e.hasRaw)),0===a.length)return void await m.Z.systemTasks.delete(e.id);const s=a[0],i=s.accountId,r=s.sentDate,o=await Zt.Z.call(i,n,r);if(!o)return void await m.Z.systemTasks.delete(e.id);const c=await m.Z.messages.get(t),l=c.from[0].address;await U.Z.call(l,c.sentDate,t,o),await m.Z.hasRaw.update([t,l],{hasRaw:1});const d=(0,Be.PW)((0,Be.Zp)(o));let u="";if(d){const e=await N.Z.parseMail(o,d.mimeTree);u=(0,$e.Hg)(e.bodyParts)}const h={searchListId:t,subject:c.subject,body:u,to:(0,Lt.Z)(c.to),cc:(0,Lt.Z)(c.cc),from:(0,Lt.Z)(c.from),replyTo:(0,Lt.Z)(c.replyTo)};await(0,j.Z)([h]),await m.Z.systemTasks.delete(e.id)}(e):"delete_full_text_search_entries"===e.taskName?await Nt.Z.systemTaskDelete(e):"check_disk_for_raw"===e.taskName?await Ot.runSystemTask(e):"delete_raw_from_disk"===e.taskName?await xt.Z.runSystemTask(e):"generate_missing_previews"===e.taskName?await async function(e){const t=e.currentId||0;let n=128;const a=new x.Z.BatchSizeOptimizer(n,2e3),s=await m.Z.searchList.toCollection().primaryKeys(),i=s[s.length-1]??-1;!async function t(s){if(s>=i)return void m.Z.systemTasks.delete(e.id);const r=Date.now(),o=await m.Z.searchList.where("id").between(s,i+1).limit(n).toArray();if(z.U.setStatus(re.A4,(0,u.Z)("Generate previews: $1/$2",[s,i]),D.QM),0===o.length)return void m.Z.systemTasks.delete(e.id);const c=o.map((e=>e.id)),l=new Map;o.forEach((e=>l.set(e.id,e)));const d=(await m.Z.hasRaw.where("searchListId").anyOf(c).toArray()).filter((e=>e.hasRaw)),h=[];for(const e of d){const{accountId:t,searchListId:n}=e,a=l.get(n);if(a){const e=await Zt.Z.call(t,n,a.sentDate);if(e){const t=(0,Be.PW)((0,Be.Zp)(e));if(t){const a=await N.Z.parseMail(e,t.mimeTree),s=(0,$e.Qe)(a.bodyParts);h.push({id:n,updates:{preview:s}})}}}}s=c[c.length-1]+1,await m.Z.transaction("rw",[m.Z.searchList,m.Z.systemTasks],(async()=>{await Promise.all(h.map((e=>m.Z.searchList.update(e.id,e.updates)))),await m.Z.systemTasks.update(e.id,{currentId:s})})),z.QO.updateIndex({sleUpdates:h});const f=Date.now();n=a.optimize(o.length,f-r),t(s)}(t)}(e):"migrate_feed_paths"===e.taskName?await async function(e){const t=[],n=[...a.Z.get(C.kRssSettings)];if(0===n.length)return;const s=[];for(const e of n){const n=crypto.randomUUID();if(e.feedId!==e.url){s.push({...e});continue}s.push({...e,feedId:n});const a=await m.Z.filters.where("[accountId+path]").equals([D.u4,e.feedId]).first();if(!a)continue;t.push(a.id),a.path=n;const i=a.filterValue.include;if(i)for(const t of i)for(const a of t)a.path&&a.path===e.feedId&&(a.path=n);await m.Z.filters.update(a.id,a)}T.Z.set(C.kRssSettings,s),await m.Z.systemTasks.delete(e.id),t.length>0&&w.Z.updateFilters(t)}(e):console.error("task not supported",e.taskName)}catch(t){const n=(0,u.Z)("Failed to run system task $1: $2",[e.taskName,t.message||t]);console.error(n),z.U.setStatus(re.A4,n)}}const jt=["EXPAND_MAIL_SEARCH_","SCROLL_TOP_MAIL_SEARCH_","SEARCH_STYLE_MAIL_SEARCH_","ON_ROWS_RENDERED_OPTIONS_MAIL_SEARCH_"];async function Qt(e,t,n){z.U.setStatus(re.A4,(0,u.Z)("Removing data from $1 in $2",[t,e]));const s=[e,t,0],r=[e,t,Number.MAX_VALUE];await m.Z.imap.where("[accountId+path+uid]").between(s,r).delete(),await m.Z.mailboxCache.where("[accountId+path]").equals([e,t]).delete();const o=await m.Z.filters.where("[accountId+path]").equals([e,t]).first(),c=await m.Z.filters.toCollection().filter((n=>n.accountId===e&&n.path===t||n.selectedAccountId===e&&n.selectedName===o.name)).primaryKeys(),l=await Kt(e,c);if(e===D.u4){const e=a.Z.get(C.kRssSettings).find((e=>t.endsWith(e.feedId)));e&&await m.Z.deletedFeedItems.where("feedId").equals(e.feedId).delete()}n&&await Ht(e,l),await m.Z.buffer.where("[accountId+path]").equals([e,t]).delete();const d=i.Z.getSync("FOLDER_SELECTION");if(d?.accountId===e)if(d?.path===t)i.Z.remove("FOLDER_SELECTION");else if(d?.children)for(const e of d.children)e.path===t&&i.Z.remove("FOLDER_SELECTION");qt(e,t),jt.forEach((n=>i.Z.remove(n+e+t))),z.U.setStatus(re.A4,(0,u.Z)("Finshed removing data from $1 in $2",[t,e]))}async function Vt(e,t){z.U.setStatus(re.A4,(0,u.Z)("Removing data for $1",[e]));const n=[e,""],a=[e,"￿"];await m.Z.imap.where("accountId").equals(e).delete(),await m.Z.hasRaw.where("accountId").equals(e).delete(),await m.Z.pop.where("accountId").equals(e).delete(),await m.Z.mailboxCache.where("accountId").equals(e).delete();const s=(await m.Z.filters.where("[accountId+path]").between(n,a).toArray()).map((e=>e.id)),r=await Kt(e,s);t&&await Ht(e,r),await m.Z.buffer.where("accountId").equals(e).delete();i.Z.getSync("FOLDER_SELECTION")?.accountId===e&&i.Z.remove("FOLDER_SELECTION"),qt(e),jt.forEach((t=>i.Z.removeAllStartingWith(t+e)))}function qt(e,t){const n={...a.Z.get(C.kListSelections)};if(delete n.MAIL_PANEL,delete n.FEEDS_PANEL,t)delete n[D.QQ+e+t];else{const t=D.QQ+e;for(const e in n)e.startsWith(t)&&delete n[e]}T.Z.set(C.kListSelections,n)}async function Ht(e,t){z.U.setStatus(re.A4,(0,u.Z)("Removing raw message files for $1",[e])),await Promise.all(t.map((t=>xt.Z.call(e,t.id,t.sentDate).catch((n=>console.debug(`Error deleting file for ${e}/${t.id}. May not exist! ${n}`))))))}async function Kt(e,t){const n=[],a=[],s=new Set;let i;t.forEach((e=>{for(let t=0;t<D.XN;t++)s.add(e*D.XN+t)}));let r=[];const o=[];await m.Z.transaction("rw",[m.Z.messages,m.Z.searchList,m.Z.threading,m.Z.filters,m.Z.viewIds,m.Z.systemTasks,m.Z.hasRaw],(async()=>{z.U.setStatus(re.A4,(0,u.Z)("Updating database...")),await m.Z.searchList.where("sourceFilterIds").anyOf(t).distinct().modify(((e,s)=>{if(t.forEach((t=>{e.sources.delete(t)})),e.sources.size>0){const a=new Set(t);e.sourceFilterIds=e.sourceFilterIds.filter((e=>!a.has(e))),n.push(e);const s=new Set(w.Z.getByIds([...e.sources.keys()]).map((({accountId:e})=>e))),i=new Set(w.Z.getByIds(t).map((({accountId:e})=>e)).filter((e=>!s.has(e))));for(const t of i)o.push([e.id,t])}else a.push(e),delete s.value})),r=a.map((e=>e.id)),z.U.setStatus(re.A4,(0,u.Z)("Removing messages...")),await Promise.all([m.Z.messages.where("id").anyOf(r).delete().then((()=>z.U.setStatus(re.A4,(0,u.Z)("Removing threading info...")))),m.Z.threading.where("id").anyOf(r).delete().then((()=>z.U.setStatus(re.A4,(0,u.Z)("Removing header info...")))),m.Z.viewIds.where("searchListId").anyOf(r).delete().then((()=>z.U.setStatus(re.A4,(0,u.Z)("Updating view indices...")))),m.Z.viewIds.where("searchListId").anyOf(n.map((e=>e.id))).modify((e=>{e.viewIds=e.viewIds.filter((e=>!s.has(e)))})).then((()=>z.U.setStatus(re.A4,(0,u.Z)("Removing raw indicators...")))),m.Z.hasRaw.where("searchListId").anyOf(r).delete().then((()=>z.U.setStatus(re.A4,(0,u.Z)("Removing raw indicators...")))),m.Z.hasRaw.bulkDelete(o).then((()=>z.U.setStatus(re.A4,(0,u.Z)("Removing message filters...")))),m.Z.filters.where("id").anyOf(t).delete().then((()=>z.U.setStatus(re.A4,(0,u.Z)("Finished updating database"))))]);const e={taskName:"delete_full_text_search_entries",currentPosition:0,searchListIds:r},c=await m.Z.systemTasks.add(e);i={id:c,...e}})),i?$t(i):console.warn("removeBySourceFilterIds: Expected task to be added"),w.Z.updateFilters(t);const c=n.map((e=>{const n=new Map([...t.map((e=>[e,void 0]))]);for(const[t,a]of e.sources)n.set(t,{...a});return{id:e.id,updates:{sources:n,sourceFilterIds:e.sourceFilterIds,removedViewIds:[...s]}}}));for(;r.length>0;){const e={removedSles:r.splice(0,1e4)};z.QO.updateIndex(e)}for(;c.length>0;){const e={sleUpdates:c.splice(0,1e4)};z.QO.updateIndex(e)}return a}const Wt=new Set;function Gt(e,t,n){switch(z.QO.setAccountIndicator(e.MAIL_EMAIL,"INDICATOR_TYPE_FLUSHING",n.current,n.total),t.operation){case"BUFFER_OPERATION_CUSTOM_FLAG":return Ra.updateFlags(e.MAIL_EMAIL,t.path,t.uids,t.flagUpdates);case"BUFFER_OPERATION_DELETE_IMAP":return Ra.deleteMessages(e.MAIL_EMAIL,t.path,t.uids);case"BUFFER_OPERATION_DELETE_POP":return yt(e,t.searchListIds);case"BUFFER_OPERATION_MOVE":return Ra.moveMessages(t.accountId,t.path,t.uids,t.destinationPath);case"BUFFER_OPERATION_COPY":return Ra.copyMessages(e.MAIL_EMAIL,t.path,t.uids,t.destinationPath);case"BUFFER_OPERATION_UPLOAD_MESSAGE":return Ra.uploadMessage(e.MAIL_EMAIL,t.path,t.searchListId,t.flags);default:return Promise.reject("Unknown batch operation '"+t.operation+"'")}}async function Yt(){const e=await m.Z.buffer.where("operation").equals("BUFFER_OPERATION_FETCH_RAW_FOR_ALL_SOURCES").toArray();if(e.length>0){const t=e.map((({searchListId:e})=>e));await async function(e){const t=await O.Z.getBySearchListIdsHasRaw(e,!1);if(0===t.length)return;const n=new Map,a=new Map,s=new Set;for(const{searchListId:e,accountId:i}of t)if((0,kt.mq)(i)){const t=n.get(i);t?t.push(e):n.set(i,[e]),s.add(e)}else if((0,kt.Vd)(i)){const t=a.get(i);t?t.push(e):a.set(i,[e]),s.add(e)}if(0===s.size)return;b.Z.info("Mail",["flushBuffer","fetchRawForAllSources"],`Fetching ${s.size} messages`);const i=await(0,M.Z)([...s]),r=new Map(i.map((e=>[e.id,e]))),o=new Map,c=[],l=new Map,d=new Map,u=[];async function h(e,t,n){const a=r.get(e);if(!a)return void b.Z.error("Mail",["flushBuffer","fetchRawForAllSources",t,e],"Message not found");const s=(0,Be.PW)((0,Be.Zp)(n));if(!s)return;const i=await N.Z.parseMail(n,s.mimeTree),h=(0,$e.Qe)(i.bodyParts);u.push({id:e,updates:{preview:h}}),o.has(e)||o.set(e,[a,i]),c.push([e,t,a.sentDate,i.raw]),l.has(e)||l.set(e,h);const f=d.get(t);f?f.push(e):d.set(t,[e])}for(const[e,t]of n)try{const n=await Ra.fetchRawOfMessages(e,t);for(const[t,a]of n)await h(t,e,a)}catch(t){b.Z.error("Mail",["flushBuffer","fetchRawForAllSources",e],t)}for(const[e,t]of a)try{const n=await m.Z.pop.where("searchListId").anyOf(t).filter((t=>t.accountId===e)).toArray(),a=await A.Z.loadAccount(e);for(const{accountId:e,searchListId:t,uidl:s}of n){if(!r.get(t)){b.Z.error("Mail",["flushBuffer","fetchRawForAllSources",e,t],"Message not found");continue}const n=await vt(a,s,t);n&&await h(t,e,n)}}catch(t){b.Z.error("Mail",["flushBuffer","fetchRawForAllSources",e],t)}z.QO.updateIndex({sleUpdates:u}),await Promise.all([...o].map((([e,[t,n]])=>{const a=(0,$e.Hg)(n.bodyParts);return(0,ke.K)(e,t,a).catch((t=>b.Z.error("Mail",["fetchRawForAllSources",e],t)))}))),await Promise.all(c.map((([e,t,n,a])=>U.Z.call(t,n,e,a)))),await Promise.all([...l].map((([e,t])=>(0,L.Z)(e,t)))),await Promise.all([...d].map((([e,t])=>Z.Z.setHasRaws(e,t))))}(t),z.QO.runStoredFiltersForMessages(t),await S.Z.byIds(e.map((({_id:e})=>e)))}}async function Xt(e,t){if(e.accountType===D.s9.IMAP&&!e.offline){for(const n of t)if("Inbox"!==n)try{await Ra.selectMailbox(e.MAIL_EMAIL,n)}catch(t){b.Z.error("Mail",["syncAndPark",e.MAIL_EMAIL,n],t)}Ra.park(e.MAIL_EMAIL)}}const Jt=new Map;function en(e,t){return x.Z.adjustBatchSize(100,1e3,500,e,t)}const tn=(0,B.Z)((async()=>{await Yt(),await async function(){const e=await m.Z.buffer.where("operation").equals("BUFFER_OPERATION_REMOVE_ACCOUNT").toArray();for(const t of e){const{accountId:e,deleteFiles:n,deletePasswords:a}=t;try{await Vt(e,n),F(e,a)}catch(t){console.error(`Error removing account ${e}`,t)}}}(),await async function(){const e=await m.Z.buffer.where("operation").equals("BUFFER_OPERATION_REMOVE_ACCOUNT_PATH").toArray();for(const t of e){const{accountId:e,path:n,deleteFiles:a}=t;try{await Qt(e,n,a)}catch(t){console.error(`Error removing path ${e}/${n}`,t)}}}();(await A.Z.loadAllAccounts()).forEach((e=>{const{MAIL_EMAIL:t}=e;Wt.has(t)||async function(e){const{MAIL_EMAIL:t}=e;Wt.add(t);const n=new Set;for(;Wt.has(t);){let a;try{if(await m.Z.buffer.where("accountId").equals(t).until((e=>{const t="BUFFER_OPERATION_CUSTOM_FLAG"===e.operation;return a&&!t||(a=e),t})).count(),!a){Wt.delete(t),z.QO.removeAccountIndicator(t,"INDICATOR_TYPE_FLUSHING"),await Xt(e,n),Jt.delete(t);break}if(await m.Z.buffer.update(a._id,{isFlushing:!0}),e.offline){await m.Z.buffer.delete(a._id);continue}const s="BUFFER_OPERATION_DELETE_POP"===a.operation?D.Gf:a.path,i=await r.Z.getFolderByPath(t,s);if(!i||e.accountType===D.s9.IMAP&&!i.subscribed){b.Z.info("Mail",["flushBuffer",t,s],"Removing batch for a path that no longer exist or is not subscribed"),await m.Z.buffer.delete(a._id);continue}n.add(s),a.destinationPath&&n.add(a.destinationPath);const o=Jt.get(t)||en(100,500);if(void 0!==a.uids&&a.uids.length>o){const{uids:n}=a,{current:s=0,total:i=n.length}=a,r={current:s,total:i},c=n.slice(0,o),l={...a,uids:c},d=Date.now();await Gt(e,l,r);const u=new Set(c);await m.Z.buffer.where("_id").equals(a._id).modify((function(e){e.uids=e.uids.filter((e=>!u.has(e))),e.uids.length>0?(e.current=s+c.length,e.total=i,e.isFlushing=!1):delete this.value}));const h=en(o,Date.now()-d);Jt.set(t,h)}else{let t;if(t="BUFFER_OPERATION_DELETE_POP"===a.operation?{current:a.searchListIds.length,total:a.searchListIds.length}:{current:1,total:1},await Gt(e,a,t),void 0!==a.uids){const e=new Set(a.uids);await m.Z.buffer.where("_id").equals(a._id).modify((function(t){t.isFlushing=!1,t.uids=t.uids.filter((t=>!e.has(t))),0===t.uids.length&&delete this.value}))}else await m.Z.buffer.delete(a._id)}}catch(e){if(b.Z.error("Mail",["flushBuffer",t],e),b.Z.debug(JSON.stringify(a)),a){if((0,Et.I)(e.code)||(0,Et.b)(e.message)){await m.Z.buffer.update(a._id,{isFlushing:!1}),Wt.delete(t),z.QO.removeAccountIndicator(t,"INDICATOR_TYPE_FLUSHING");break}await m.Z.buffer.delete(a._id);continue}Wt.delete(t),z.QO.removeAccountIndicator(t,"INDICATOR_TYPE_FLUSHING");break}}}(e)}))}),1e3);const nn={call:function(){navigator.onLine&&tn()}};async function an(e,t,n){const a=[],s=[],i=new Map,r=w.Z.getByFolderId([e,t]);return n.forEach((n=>{const{uid:a}=n;s.push([e,t,a]),i.set(a,n)})),await m.Z.transaction("rw",[m.Z.imap,m.Z.searchList,m.Z.filteringQueue,m.Z.buffer],(async()=>{const n=await m.Z.imap.where("[accountId+path+uid]").anyOf(s).toArray(),o=new Map;n.forEach((e=>{const{searchListId:t,uid:n}=e,a=i.get(n);if(!a)throw new Error("imapMessage not found");o.set(t,a)}));const c=new I.Z.FilteringUpdatesSorter,l=[],d=[],u=[];await m.Z.searchList.where("id").anyOf([...o.keys()]).modify((n=>{const s=n.sources.get(r.id);if(!s||s.internal)return void b.Z.info("Mail",["imapUpdateFlags"],s?`Source for ${e}, ${t} is internal`:`Source not found for ${e}, ${t}`);const{id:i,unseen:h,flags:f}=n,p=o.get(i),g={},m={sources:new Map},_=(0,G.jw)(p.flags);g.sources=new Map;const y=(0,G.QE)(f,_);Object.keys(y).length>0&&(!function(e,t){delete t[D.T4.RECENT];const n=u.find((e=>(0,G.ui)(e.imapFlagUpdates,t)));n?n.searchListIds.push(e):u.push({searchListIds:[e],imapFlagUpdates:t})}(i,y),g.flags=n.flags=_,(0,G.wh)(f,p.flags,i,d),(0,G.Oj)(f,p.flags,i,l));const v=!(0,G.FL)(p),I={};s.read!==v&&(h&&v&&(n.unseen=g.unseen=m.unseen=!1),s.read=I.read=v);for(const[t,a]of n.sources)if(a.internal){const n=w.Z.get(t)?.accountId;t!==r.id&&n===e&&v!==a.read&&(a.read=v,g.sources?.set(t,{read:v}))}const k=(0,G.uY)(p);if(s.deleted!==k&&(s.deleted=I.deleted=k),Object.keys(I).length>0&&(g.sources?.set(r.id,I),m.sources.set(r.id,I)),!k){const a=E.Z.getFolderType(e,t);if(![D.uT,D.Hd,D.hn].includes(a)){[...n.sources.keys()].forEach((t=>{const a=n.sources.get(t);if(!a)throw new Error("Source not found "+t);if(a.internal&&a.deleted){const a=w.Z.get(t);if(!a)throw new Error("Filter not found "+t);a.accountId===e&&(n.sources.delete(t),g.sources?.set(t,void 0),m.sources.set(t,void 0))}}))}}(Object.keys(g).length>1||Boolean(g.sources?.size))&&a.push({id:i,updates:g}),(Object.keys(m).length>1||m.sources.size>0)&&c.add(i,m)}));for(const e of c.getSorted()){const{searchListIds:t,updates:n}=e;if(n.sources.size>0){const e=[[D.of,D.cm],[D.of,D.tB],[D.of,D.rp],[D.of,D.$T]];await k.Z.call({type:"FILTERS_SLES",priority:D.Un.HIGH,folderIds:e,searchListIds:t})}}for(const e of d){const{searchListIds:t,oldStandardFlag:n,newStandardFlag:a}=e,s=[];n&&s.push([D.MN,n]),a&&s.push([D.MN,a]),s.length>0&&await k.Z.call({type:"FILTERS_SLES",priority:D.Un.HIGH,folderIds:s,searchListIds:[...t]})}for(const e of l){const{searchListIds:t,flag:n}=e,a=[[D.ut,n]];await k.Z.call({type:"FILTERS_SLES",priority:D.Un.HIGH,folderIds:a,searchListIds:[...t],runLabels:!0})}for(const e of c.getSorted()){const{searchListIds:t,updates:n}=e;await k.Z.call({type:"UPDATE_SLE",priority:D.Un.HIGH,searchListIds:t,...n})}if(u.length>0){for(const{searchListIds:t,imapFlagUpdates:n}of u)await v.Z.addImapFlags(t,n,e);nn.call()}})),a}var sn=n(89846);async function rn(e,t){return await m.Z.transaction("rw",[m.Z.searchList,m.Z.messages,m.Z.threading],(async()=>{const n=(await m.Z.searchList.where("messageId").equals(e).toArray()).map((e=>e.id));await m.Z.searchList.where("id").anyOf(n).modify((e=>e.messageId=t)),await m.Z.messages.where("id").anyOf(n).modify((e=>e.messageId=t)),await m.Z.threading.where("id").anyOf(n).modify((e=>e.messageId=t))}))}async function on(e,t,n,a){let s=[];const i=await m.Z.transaction("rw",y.E.concat([m.Z.imap,m.Z.accounts,m.Z.filters,m.Z.searchList,m.Z.filteringQueue,m.Z.buffer]),(async()=>{const i=[],o=[],c=[],l={};for(const e of a)if(e.originalMessageId){const t=e.originalMessageId;l[t]=e.messageId,await rn(t,e.messageId)}if(Object.keys(l).length>0)for(const e of a)l[e.messageId]&&(e.messageId=l[e.messageId]);const d=await f.Z.findMatchingSles(e,t,a),u=await async function(e,t,n){if(e.every((({searchListEntry:e})=>!e)))return{intact:e,newImapEntries:[],sleUpdates:[]};const a=await r.Z.getFolderByPath(t,n);if(!a)throw new Error(`${n} not found in db.accounts table for ${t}`);const s=a.type,i=w.Z.getByFolderId([t,n]);if(!i)throw new Error(`Filter not found for ${t} ${n}`);const o=[],c=[],l=[];for(const a of e){const{message:e,searchListEntry:r}=a;if(!r||e.sentDate!==r.sentDate||e.subject!==r.subject){l.push(a);continue}const{sourceFilterIds:d,sources:u}=r,h=u.get(i.id);if(!h||!h.internal){l.push(a);continue}const f=w.Z.getByIds(d);let p,g;for(const e of f){const{accountId:a,path:i}=e,r=a===t&&i===n;if(a===D.of&&i===D.N1&&s===D.Nz||r){p=a,g=i;break}}if(!p){l.push(a);continue}if(!g){l.push(a);continue}const{sleUpdate:m}=await(0,sn.Z)(r.id,p,g,t,n,{addedProperties:{searchListSource:{internal:!1}}});o.push(m),c.push({accountId:t,path:n,uid:e.uid,searchListId:m.id})}return{intact:l,newImapEntries:c,sleUpdates:o}}(d,e,t),{intact:h,newImapEntries:p,sleUpdates:v}=u;if(i.push(...p),c.push(...v),0===h.length){await m.Z.imap.bulkPut(i);const n=await an(e,t,a);return c.push(...n),{sleUpdates:c}}const I=w.Z.getByFolderId([e,t]);if(!I)throw new Error(`Filter not found for ${e} ${t}`);const{newMessageGroups:E,duplicates:k}=f.Z.findDuplicates(h);for(const n of k){const{message:a,searchListEntry:s}=n;if(s.sources.get(I.id)){(await _.call([e,t,s.id])).some((({uid:e})=>e===a.uid))||i.push({accountId:e,path:t,uid:a.uid,searchListId:s.id})}else i.push({accountId:e,path:t,uid:a.uid,searchListId:s.id})}const x=E.map((e=>e[0])),A=await(0,y.Z)(e,t,n,x),S=A.addedSles;if(s=A.forSearchDb,S.forEach(((n,a)=>{E[a].forEach((a=>{i.push({accountId:e,path:t,uid:a.uid,searchListId:n.id})})),o.push(n)})),i.length)try{await m.Z.imap.bulkAdd(i)}catch(n){b.Z.info("Mail",["addImap"],"bulkAdd to imap table failed, checking individual items",n);const s=await m.Z.imap.where("[accountId+path+uid]").anyOf(a.map((({uid:n})=>[e,t,n]))).toArray();for(const e of i){const t=g()(s,e,oe.gE);try{if(t<0)await m.Z.imap.add(e);else{const n=s[t];n.searchListId!==e.searchListId?(b.Z.debug("Mail",["addImap"],"searchListId mismatch, the imap entry will be updated",{newImapEntry:e,existingImapEntry:n}),await m.Z.imap.put(e)):b.Z.debug("Mail",["addImap"],"imap entry already exists, not adding",n)}}catch(e){b.Z.error("Mail",["addImap"],e)}}}const M=new Set(p.map((e=>e.uid))),O=a.filter((e=>M.has(e.uid))),L=await an(e,t,O);if(c.push(...L),k.length>0){const a=await f.Z.addSourceFilters(e,t,n,k,!1);c.push(...a)}return{addedSles:o,sleUpdates:c}}));return(0,j.Z)(s),i}var cn=n(78444),ln=n.n(cn),dn=n(31355);const un={debug:e=>{a.Z.get(C.kMailImapLogsOn)&&b.Z.info("Mail",["imap-client"],...e())},info:e=>{a.Z.get(C.kMailImapLogsOn)&&b.Z.info("Mail",["imap-client"],...e())},warn:e=>{a.Z.get(C.kMailImapLogsOn)&&b.Z.warn("Mail",["imap-client"],...e())},error:e=>{a.Z.get(C.kMailImapLogsOn)&&b.Z.error("Mail",["imap-client"],...e())}};function hn(e,t){const n=t||{user:e.MAIL_USER,pass:(0,ze.DA)((new TextEncoder).encode(e.MAIL_PASSWORD))},s=new(ln())({host:e.MAIL_SERVER,port:Number(e.MAIL_PORT),auth:n,secure:!0,ignoreTLS:!1,id:{name:`Vivaldi Mail/${R.Z.utilities.getVersion().vivaldiVersion}`},logger:un});return s._client.logLevel=a.Z.get(C.kMailImapLogsOn)?dn.lw:dn.jF,s._client.timeoutConnection=1e4,s._client._enableCompression=!1,s}const fn=async function(e,t){const n=[],a=e.map((e=>e.searchListId));return m.Z.imap.bulkAdd(e),await m.Z.searchList.where("id").anyOf(a).modify((e=>{const{id:a}=e,s={sources:new Map},i=e.sources.get(t.id);if(i)i.internal=!1,s.sources.set(t.id,{...i});else{const n={read:!1,deleted:!1,internal:!1};e.sources.set(t.id,n),s.sources.set(t.id,{...n})}n.push({id:a,updates:s})})),n};const pn=async function(e,t,n){await m.Z.buffer.where("[accountId+path+operation]").equals([e,t,"BUFFER_OPERATION_CUSTOM_FLAG"]).modify((function(e){const{uids:t,flagUpdates:a}=e,s=new Set(t);n.forEach((e=>{Object.keys(a).every((t=>a[t]?e.flags.includes(t):!e.flags.includes(t)))&&s.delete(e.uid)})),0===s.size?delete this.value:e.uids=[...s]}))};var gn=n(93818),mn=n(57207),wn=n(30381),_n=n.n(wn);var bn=n(89555);let yn,vn,In,En={};function kn(){b.Z.info("Mail",["imapCache"],"Resetting init promise"),yn=new Promise(((e,t)=>{vn=()=>{b.Z.info("Mail",["imapCache"],"Resolving init promise"),e()},In=e=>{b.Z.info("Mail",["imapCache"],"Rejecting init promise"),t(e)}})),yn.catch(bn.Z)}function xn(){return b.Z.info("Mail",["imapCache"],"Initializing UID lists"),m.Z.imap.orderBy("[accountId+path+uid]").primaryKeys().then((e=>{e.forEach((e=>{const[t,n,a]=e;En[t]||(En[t]={}),En[t][n]||(En[t][n]=new Set),En[t][n].add(a)})),vn()})).catch((e=>{throw In(e),e}))}function An(e,t){delete En[e][t]}async function Sn(e){await yn;const t=await async function(e){const t=new Set,n=await r.Z.getFolder(e);for(const e of Object.keys(n)){const a=n[e];for(const e of a)t.add(e.path)}return t}(e),n=await m.Z.mailboxCache.where("accountId").equals(e).toArray(),a=En[e]||{},s={};for(const e of n){const{path:n}=e,i=Array.from(a[n]||[]);s[n]={...e,uidlist:i,exists:i.length,highestModseq:e.highestModseq||"0",noModseq:e.noModseq||!1},t.delete(n)}for(const e of t){const t=Array.from(a[e]||[]),n=t.length>0?t[t.length-1]+1:0;s[e]={uidlist:t,uidNext:n,exists:t.length}}return s}kn();var Mn=n(90305),On=n(6271);async function Ln(e){const{accessToken:t}=await(0,Mn.$z)(e.MAIL_EMAIL,(0,On.dn)(e),!0);return{user:e.MAIL_EMAIL,xoauth2:t}}var Zn=n(83065);function Nn(e){const t=e.split(","),n=[];return t.forEach((e=>{if(e.indexOf(":")>=0){const[t,a]=e.split(":"),s=Number.parseInt(t),i=Number.parseInt(a);if(s<i)for(let e=s;e<=i;e++)n.push(e);else for(let e=i;e<=s;e++)n.push(e)}else{const t=Number.parseInt(e);n.push(t)}})),n}var Tn=n(34155);const Rn=new Map,Pn=new Map,Cn=new Set,Fn=new Set,Un=new Map,Dn=new Map,zn=18e5,Bn=9e5,$n={},jn={},Qn=new Set;let Vn=!1,qn=!1;const Hn=new Map;let Kn,Wn=0,Gn=0,Yn=!1,Xn=0,Jn=0,ea=50;const ta=new x.Z.BatchSizeOptimizer(ea,1e3),na=new class{constructor(e){this.lock=(0,d.M)(),this._priorityQueue=[];for(let t=0;t<e;t++)this._priorityQueue.push([])}queue(e,t,...n){return new Promise(((a,s)=>{this._priorityQueue[t].push({func:e,resolve:a,reject:s,params:n}),this._processQueue()}))}async _processQueue(){const e=await this.lock();try{await this._runNextInLine()}finally{e()}}async _runNextInLine(){for(const e of this._priorityQueue){const t=e.shift();if(t){const{func:e,resolve:n,reject:a,params:s}=t;try{n(await e(...s))}catch(e){a(e)}return!0}}return!1}hasFunc(e){for(const t of this._priorityQueue)for(const n of t)if(n.func===e)return!0;return!1}}(Object.keys(D.NB).length);let aa;async function sa(e){if(!navigator.onLine)throw new Error("No network connection");if(Fn.has(e))throw new Error("Authentication error. User action is required");if(!l.Z.isMailOn())throw new Error("Mail has been turned off");const t=(a.Z.get(C.kMailAccounts)||[]).find((t=>t.MAIL_EMAIL===e));if(!t)throw new Error("Account has been deleted");if(t.offline)throw new Error("Account is offline");const n=Rn.get(e);if(n)return n;const s=Pn.get(e);if(s)return b.Z.info("Mail",["_getClient",e],"Connecting..."),s.promise;throw z.U.setStatus(re.A4,(0,u.Z)("Reconnecting $1",[e])),Ia(e),new Error("Not connected - Attempting to connect "+e)}function ia(e){e!==D.of&&(Cn.add(e),ra())}const ra=(0,B.Z)((async()=>{const e=[...Cn];Cn.clear();for(const t of e){const[e]=E.Z.getPathsByType(t,D.e9);if(!e)return void b.Z.warn("Mail",["imap",t],"No inbox found to park in");if(Rn.has(t))try{await oa(t,e,!0)}catch(n){wa(n,t,e)}}}),2e3);function oa(e,t,n=!1){if(!navigator.onLine)return Promise.reject("No network connection");$n[e]||($n[e]=[]);const a=$n[e];return new Promise(((i,r)=>{n?0!==a.length&&a[0].path===t||a.unshift({path:t,resolve:i,reject:r}):a.find((e=>e.path===t))||a.push({path:t,resolve:i,reject:r}),jn[e]||(jn[e]=!0,Tn.nextTick(s))}));async function s(){const t=$n[e];if(!t||t.length<=0)return void(jn[e]=!1);const{path:n,resolve:a,reject:i}=t.pop();try{const t=await sa(e);await t.selectMailbox({path:n}),a()}catch(e){i(e)}finally{z.QO.removePathIndicator(e,n),Tn.nextTick(s)}}}async function ca(e,t){const n=await m.Z.imap.where("searchListId").anyOf(t).filter((t=>t.accountId===e)).toArray();if(0===n.length)return new Map;const a=new Map;for(const{searchListId:e,path:t,uid:s}of n){const n=a.get(e);n?n.set(t,s):a.set(e,new Map([[t,s]]))}const s=[];for(const[t,n]of a)s.push({accountId:e,pathToUid:n,size:0,searchListId:t});return await na.queue(la,D.NB.FETCH_RAW,e,s)}async function la(e,t){const n=new Map;if(0===t.length)return n;if(!navigator.onLine)throw new Error("No network connection");const a=new Set;for(const{pathToUid:e}of t)for(const t of e.keys())a.add(t);try{for(const s of[...a]){const a=new Map;for(const{searchListId:e,pathToUid:i}of t){if(n.has(e))continue;const t=i.get(s);void 0!==t&&a.set(t,e)}if(0===a.size)continue;const i=[...a.keys()],r=await sa(e),o=await r.getMessages({path:s,uids:i});Object.keys(o).forEach((t=>{const i=a.get(parseInt(t));i?o[t]?n.set(i,o[t]):b.Z.error("Mail",["fetchRaw",e],`Expected to find raw for ${e}/${s}/${t}`):b.Z.error("Mail",["fetchRaw",e],`Un-expected uid ${e}/${s}/${t}`)}))}return ia(e),n}catch(t){throw z.U.setStatus(re.A4,(0,u.Z)("Failed to get message body - $1",[t])),b.Z.warn("Mail",["imap",e],"Fetch raw",t),t}}async function da(e,t,n,s,i,r){if(!navigator.onLine)throw new Error("No network connection");const o=function(e){const t=[...e];let n;t.sort(((e,t)=>e-t));const a=[];for(const e of t)n&&n[n.length-1]===e-1?n.push(e):(n=[e],a.push(n));const s=a.map((e=>1===e.length?e[0]:e[0]+":"+e[e.length-1]));return s.join(",")}(n),c=await r.listMessages({path:t,sequence:o});a.Z.get(C.kMailAutoGenerateContacts)&&await(0,Ct.Z)(e,t,c);const l=E.Z.getFolderType(e,t),d=await on(e,t,l,c);z.QO.updateIndex(d),ye.filter(),De.updateThreads();const{addedSles:h,sleUpdates:f}=d;(h&&h.length>0||f&&f.length>0)&&(z.U.setStatus(re.A4,(0,u.Z)("Indexing mail $1 $2 $3/$4",[e,t,i,s])),z.QO.setPathIndicator(e,t,"INDICATOR_TYPE_FETCHING",D.NB.SYNC_NEW_DELETED,i,s));!function(e,t,n){if(En[e]||(En[e]={}),En[e][t]){const a=[...En[e][t],...n].sort(((e,t)=>e-t));En[e][t]=new Set(a)}else En[e][t]=new Set(n)}(e,t,c.map((e=>e.uid)))}function ua(e){if(!l.Z.isMailOn())return!1;const t=(a.Z.get(C.kMailAccounts)||[]).find((t=>t.MAIL_EMAIL===e));return!!t&&!t.offline}function ha(e){if(!l.Z.isMailOn()||qn)return!1;const t=(a.Z.get(C.kMailAccounts)||[]).find((t=>t.MAIL_EMAIL===e));return!!t&&!t.offline&&"none"!==fa(e)}function fa(e){const t=(a.Z.get(C.kMailAccounts)||[]).find((t=>t.MAIL_EMAIL===e));if(t)return t.preFetch;throw new Error("Account not found "+e)}function pa(e){switch(fa(e)){case"day":return _n()().subtract(1,"d").startOf("day").valueOf();case"week":return _n()().subtract(1,"w").startOf("day").valueOf();case"month":return _n()().subtract(1,"M").startOf("day").valueOf();case"year":return _n()().subtract(1,"y").startOf("day").valueOf();default:return 0}}async function ga(e,t,n,a){let s=100,i=0;const r=new x.Z.BatchSizeOptimizer(100,2e3);return new Promise(((o,c)=>{na.queue((async function l(){if(!ua(e))return void o();const d=t.slice(i,i+s);if(0===d.length)return void o();const u=Date.now();try{await a(d,t.length,i),i+=s}catch(e){return void c(e)}const h=Date.now();s=r.optimize(d.length,h-u),Vn===e&&(Kn=void 0,Wn=await Za(e));na.queue(l,n).catch(c)}),n).catch(c)}))}async function ma(e,t){if(!navigator.onLine)throw new Error("No network connection");z.U.setStatus(re.A4,(0,u.Z)("Indexing - $1 $2",[e,t.path]));const{list:n,path:a,type:s}=t;try{if("new"===s){b.Z.log("Mail",["imap",e],"new messages received",a,n.length),n.reverse();try{const t=await sa(e);z.QO.setSyncing(e,!0),await ga(e,n,D.NB.SYNC_NEW_DELETED,(async(n,s,i)=>{await da(e,a,n,s,i,t)}))}finally{z.QO.setSyncing(e,!1)}await Ma(e)}else if("deleted"===s){if(b.Z.log("Mail",["imap",e],"messages deleted on server",a,n.length),await ga(e,n,D.NB.SYNC_NEW_DELETED,(async t=>{await mn.Z.deleteFromFolder(e,a,t)})),E.Z.getFolderType(e,a)!==D.uT){const t=E.Z.getPathsByType(e,D.uT);for(const n of t)Aa(e,n),ia(e)}}else if("messages"===s){b.Z.log("Mail",["imap",e],"flag updates from server",a,n.length);try{z.QO.setSyncingFlags(e,!0),await ga(e,n,D.NB.SYNC_FLAGS,(async(t,n,s)=>{await async function(e,t,n,a,s){await pn(e,t,n);const i=await an(e,t,n);z.QO.updateIndex({sleUpdates:i}),z.U.setStatus(re.A4,(0,u.Z)("Updating flags $1 $2 $3/$4",[e,t,s,a])),z.QO.setPathIndicator(e,t,"INDICATOR_TYPE_FLAGS",D.NB.SYNC_FLAGS,s,a)}(e,a,t,n,s)}))}finally{z.QO.setSyncingFlags(e,!1)}}if(ua(e)){const t=await sa(e);!function(e,t,n){"inbox"===t.toLowerCase()&&(t=D.Gf),yn.then((()=>m.Z.transaction("rw",m.Z.mailboxCache,(()=>{Object.keys(n).forEach((a=>{const s=n[a];a!==t&&0!==s.exists||m.Z.mailboxCache.put({accountId:e,path:a,uidNext:s.uidNext,highestModseq:s.highestModseq||"0",noModseq:s.noModseq||!1})}))}))))}(e,a,t.mailboxCache)}z.U.setStatus(re.A4,(0,u.Z)("Finished indexing - $1 $2",[e,a]),D.QM)}catch(t){wa(t,e,"indexing")}z.QO.removePathIndicator(e,a),z.QO.removePathIndicator(e,a),ye.filter()}function wa(e,t,n,...a){const s=["imap",t,...a];if((0,Et.I)(e.code)||(0,kt.dS)(t)&&"The user did not approve access."===e.message)return z.KU.set(t,"IMAP",e,e.code),b.Z.error("Mail",s,"Authentication failed"),Fn.add(t),Hn.delete(t),void z.QO.setDisconnected(t,!0);const i=e.code?`[${e.code}] ${e.message||e}`:`${e.message||e}`;if((0,Et.b)(i)){z.KU.set(t,"IMAP",e,e.code),b.Z.info("Mail",s,i);const n=function(e){let t=Hn.get(e)||0;if(++t<=5)return Hn.set(e,t),2e3*t;let n=Un.get(e);n=void 0===n?6e4:Math.min(n+Bn,zn),Un.set(e,n);const a=Math.floor(1e3*Math.random()*6-3e3);return n+a}(t);Ia(t,n,e)}else i.startsWith("Mailbox doesn't exist")&&n?(b.Z.info("Mail",[t,n],"Mailbox no longer exists on server, internalizing/deleting folder"),async function(e,t){await mn.Z.deleteFolder(e,t),await r.Z.removeFolder(e,t),await h.Z.removeFolder(e,t)}(t,n)):(z.KU.set(t,"IMAP",e,e.code),b.Z.error("Mail",s,i),z.U.setStatus(re.A4,i))}async function _a(){const e=await A.Z.loadImapAccounts();if(e)for(const t of e)await ba(t);else b.Z.warn("Mail",["imap"],"No IMAP accounts found!")}async function ba(e){const t=e.MAIL_EMAIL;if(b.Z.info("Mail",["imap",t],"connectImapclient"),e.isDeleted||e.offline)return void b.Z.info("Mail",["imap",t],"deleted or offline",e.isDeleted?"deleted":e.offline?"offline":"");if(!navigator.onLine)return b.Z.info("Mail",["imap",t],"No network connection"),void z.QO.setDisconnected(t,!0);if(!e.MAIL_PORT||e.MAIL_PORT<=0)throw new Error(`Port missing or invalid: ${e.MAIL_PORT||""}`);if((await m.Z.systemTasks.toArray()).some((e=>"restore_mail_db"===e.taskName)))return void b.Z.warn("Mail",["imap",t],"Not connecting while restoration in progress");if(Rn.has(t))return void b.Z.info("Mail",["imap",t],"Already connected");if(Pn.has(t))return void b.Z.info("Mail",["imap",t],"Currently being connected");let n,a;try{let s;Pn.set(t,{promise:new Promise(((e,t)=>{n=e,a=t}))}),e.useOAuth&&(s=await Ln(e));let i=!1;const c=setTimeout((()=>{Pn.delete(t),i=!0,a&&a("Client initialization timed out")}),1e4);b.Z.info("Mail",["imap",t],"Creating client");const l=s?hn(e,s):hn(e);l.onSyncUpdate=ma.bind(null,t),l.onError=e=>{wa(e,t)},b.Z.info("Mail",["imap",t],"Fetching mailbox cache");const d=await Sn(t);if(l.mailboxCache=d||{},i)return;clearTimeout(c);const f=Pn.get(t);if(!f)return void(a&&a("Client initialization cancelled"));if(f.client=l,z.QO.setAccountIndicator(t,"INDICATOR_TYPE_CONNECTING"),z.QO.setConnecting(t,!0),b.Z.info("Mail",["imap",t],"Connecting"),await l.login(),Fn.delete(t),!Pn.has(t))return void(a&&a("Client initialization cancelled"));b.Z.info("Mail",["imap",t],"Connected"),z.U.setStatus(re.A4,(0,u.Z)("Connected to $1",[t]),D.QM);const p=h.Z.get(t);p&&0===Object.keys(p.folders).length&&await async function(e){const t=await e.listWellKnownFolders();for(const n of[D.e9,D.Nz,D.uT])if(Array.isArray(t[n])&&t[n].length>0){const{path:a,subscribed:s}=t[n][0];s||await e.subscribeMailbox({path:a})}}(l);const g=await l.listWellKnownFolders();if(!Pn.has(t))return void(a&&a("Client initialization cancelled"));g.Inbox&&g.Inbox.forEach((e=>{"inbox"===e.path.toLowerCase()&&(e.path=D.Gf)}));const m=await r.Z.updateFolders(t,g);await h.Z.updateAccount(t,m);const _=await o.Z.foldersToFilters(t,m);w.Z.updateFilters(_),ae.Z.addFolders(t,m),b.Z.info("Mail",["imap",t],"Clean up after connection"),Un.delete(t),Ea(t),Hn.delete(t),Pn.has(t)?(Rn.set(t,l),n&&n(l),z.QO.setDisconnected(t,!1),z.KU.remove(t,"IMAP"),nn.call()):a&&a("Client initialization cancelled")}catch(e){a&&a(e),wa(e,t)}finally{Pn.delete(t),z.QO.setConnecting(t,!1),z.QO.removeAccountIndicator(t,"INDICATOR_TYPE_CONNECTING")}if(Rn.has(t))try{await xa(t),Ma(t)}catch(e){wa(e,t)}}async function ya(){for(const e of[...Pn.keys(),...Rn.keys()])await va(e)}async function va(e,t){const n=Rn.get(e)||Pn.get(e)?.client;if(b.Z.info("Mail",["imap",e],"Should disconnect?",n?"Yes":"No"),delete $n[e],delete jn[e],Ea(e),Pn.has(e)&&(b.Z.info("Mail",["imap",e],"Client initialization cancelled"),Pn.delete(e)),Rn.has(e)&&(b.Z.info("Mail",["imap",e],"Client disconnected"),Rn.delete(e)),z.QO.setDisconnected(e,!0),z.QO.removeAllIndicators(e),t&&z.KU.set(e,"IMAP",t,t.code),n)try{n.onSyncUpdate=!1,n.onError=bn.Z,await n.logout()}catch(t){b.Z.error("Mail",[e],"Failed to log out",t)}finally{b.Z.info("Mail",["imap",e],"Logged out")}}async function Ia(e,t,n){async function a(){if(!navigator.onLine)return void b.Z.info("Mail",["imap",e],"No network. Skip reconnection attempt");const t=(await A.Z.loadImapAccounts()).find((t=>t.MAIL_EMAIL===e));b.Z.info("Mail",["imap",e],"Reconnect"),t&&await ba(t)}l.Z.isMailOn()?(await va(e,n),t?function(e,t,n){if(Dn.has(n))return void b.Z.info("Mail",["imap",n],"Has reconnect timeout");b.Z.info("Mail",["imap",n],"Set reconnect timeout");const a=setTimeout(e,t);Dn.set(n,a)}(a,t,e):await a()):b.Z.info("Mail",["imap",e],"Mail was turned off")}function Ea(e){const t=Dn.get(e);void 0!==t&&(clearTimeout(t),Dn.delete(e))}function ka(){return 0===Rn.size}async function xa(e){if(ka()||e&&!Rn.has(e))return;let t;if(e)t=await r.Z.getFolder(e).then((t=>({[e]:{folders:t}})));else{const e=await A.Z.loadImapAccounts();t=await r.Z.getAll().then((t=>{const n={};for(let a=0;a<e.length;a++){const s=e[a],i=t.find((e=>s.MAIL_EMAIL===e.accountId));i&&(n[i.accountId]={folders:i.folders})}return n}))}const n=c.Z.getFolders(t,!1),a=new Set;for(const e of n){const t=e.accountId,n=e.children;!n||n.length<=0||(n.sort(((e,t)=>e.type===t.type?0:"Inbox"===e.type?1:"Inbox"===t.type||"All"===e.type?-1:"All"===t.type?1:0)),s(t,n),a.add(t))}for(const e of a)ia(e);function s(e,t){for(const n of t)n.subscribed&&Aa(e,n.path),n.children&&s(e,n.children)}}async function Aa(e,t){try{await oa(e,t)}catch(n){wa(n,e,t,"selectMailbox")}}async function Sa(e){ka()||e&&!Rn.has(e)?await _a():xa(e)}function Ma(e){Qn.add(e),La()}function Oa(e){if(b.Z.log("Mail",["imap","prefetch"],e?"pause possible prefetching":"resume possible prefetching"),qn=e,!e){const e=(a.Z.get(C.kMailAccounts)||[]).filter((e=>!e.offline));for(const t of e)Ma(t.MAIL_EMAIL)}}function La(){if(Vn||qn)return;const e=[...Qn];Qn.clear();let t=!1;e.reduce(((e,n)=>e.then((()=>(Vn=n,async function(e){if(!ha(e))return void ia(e);b.Z.log("Mail",["imap","prefetch",e],"starting"),t=!1;let n=pa(e),a=fa(e);const s=[],i=2e3;let r;Gn=0,Wn=await Za(e),Kn=void 0;try{r=setTimeout((()=>{Wn>0&&z.QO.setPreFetching(e,!0),r=void 0}),5e3);let t=!0;for(;t;)t=await na.queue(o,D.NB.PRE_FETCH)}finally{r?clearTimeout(r):z.QO.setPreFetching(e,!1),ia(e)}t&&z.QO.removeAccountIndicator(e,"INDICATOR_TYPE_PRE_FETCHING");async function o(){if(!ha(e))return t&&(b.Z.log("Mail",["imap","prefetch",e],qn?"paused":"stopped"),z.U.setStatus(re.A4,qn?(0,u.Z)("Prefetching paused - $1",[e]):(0,u.Z)("Stopped prefetching - $1",[e]))),!1;const r=fa(e);r!==a&&(Wn=await Za(e),a=r);const o=pa(e);if(o>n){let e,t=s.length-1;for(;t>0&&(s[t]?.sentDate??0)<o;)e=t,t--;void 0!==e&&s.splice(e),n=o}if(s.length<i&&await m.Z.transaction("r",[m.Z.hasRaw,m.Z.imap,m.Z.searchList],(async()=>{const t=await O.Z.getByAccountIdHasRaw(e,!1,5*i,n,Kn);if(0===t.length)return;const a=t[t.length-1];Kn=[0,e,a.sentDate,a.searchListId];const r=t.map((({searchListId:e})=>e)),o=await m.Z.imap.where("searchListId").anyOf(r).filter((t=>t.accountId===e)).toArray(),c=await m.Z.searchList.bulkGet(r),l=new Map;for(const e of c)e&&l.set(e.id,e);let d;for(const t of o){const{searchListId:n,path:a,uid:i}=t;if(d&&d.searchListId===n)d.pathToUid.set(a,i);else{const t=l.get(n);if(!t){b.Z.error("Mail",["imap","prefetch",e,a,n],"SearchList entry not found");continue}d={accountId:e,pathToUid:new Map([[a,i]]),size:t.size,searchListId:n,sentDate:t.sentDate},s.push(d)}}})),0===s.length)return b.Z.log("Mail",["imap","prefetch",e],"done"),t&&z.U.setStatus(re.A4,(0,u.Z)("Finished prefetching - $1",[e])),!1;s.sort(oe.CB);const c=s.shift();if(!c)return!1;let l=c.size;const d=5242880,h=2347,f=[c],p=[...c.pathToUid.keys()][0];let g=0;for(;s.length>0&&g<s.length&&l<d&&f.length<h;){if(!s[g].pathToUid.has(p)){g++;continue}const[e]=s.splice(g,1);f.push(e),e.size&&(l+=e.size)}qn?z.U.setStatus(re.A4,(0,u.Z)("Prefetching paused - $1",[e])):z.U.setStatus(re.A4,Wn>0?(0,u.Z)("Prefetching - $1 $2/$3",[e,Gn,Wn]):(0,u.Z)("Prefetching - $1 ...",[e])),z.QO.setAccountIndicator(e,"INDICATOR_TYPE_PRE_FETCHING",D.NB.PRE_FETCH,Gn,Wn),b.Z.log("Mail",["imap","prefetch",e],"fetching batch",f.length,l);const w=await async function(e,t){const n=await la(e,t),a=new Map;for(const{searchListId:e,sentDate:n}of t)a.set(e,n);const s=[],i=[],r=[];for(const[o,c]of n){const n=a.get(o);if(void 0!==n)try{await U.Z.call(e,n,o,c),r.push([o,n]);const t=(0,Be.PW)((0,Be.Zp)(c));if(t){const e=await N.Z.parseMail(c,t.mimeTree),n=(0,$e.Qe)(e.bodyParts);i.push([o,n]),s.push({id:o,updates:{preview:n}})}}catch(t){b.Z.error("Mail",["imap",e,o],"Failed to process mail: ",t)}else{const n=t.find((e=>e.searchListId===o));if(n){const t=[];for(const[a,s]of n.pathToUid)t.push([e,a,s]),b.Z.warn("Mail",["imap",e],`fetchRawFromImapEntries: Expected message ${o} to exist, deleting imap entry ${a}/${s}`);await m.Z.imap.bulkDelete(t);const a=[n.searchListId,n.accountId];await m.Z.hasRaw.delete(a)}}}return z.QO.updateIndex({sleUpdates:s}),await m.Z.transaction("rw",[m.Z.hasRaw,m.Z.searchDbQueue,m.Z.searchList],(()=>{r.length>0&&(Z.Z.setHasRaws(e,r.map((([e])=>e))),m.Z.searchDbQueue.bulkAdd(r.map((([t,n])=>({accountId:e,searchListId:t,sentDate:n})))));for(const[e,t]of i)(0,L.Z)(e,t)})),Xn=0,Jn=0,na.hasFunc(Na)||na.queue(Na,D.NB.ADD_TO_SEARCH_DB),r.length}(e,f);return t=!0,Gn+=w,z.QO.runStoredFiltersForMessages(f.map((e=>e.searchListId))),!0}}(n).catch((e=>{z.QO.removeAllIndicators(n),wa(e,n,void 0,"prefetch")})))))),Promise.resolve()).then((()=>{Vn=!1,Qn.size>0&&La()}))}async function Za(e){try{const t=pa(e);return await m.Z.hasRaw.where("[hasRaw+accountId+sentDate+searchListId]").between([0,e,t,0],[0,e,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER]).count()+Gn}catch(t){return b.Z.error("Mail",["imap",e,"countWithNoRaw"],t),0}}async function Na(){if(!Yn){Yn=!0;try{const e=await m.Z.searchDbQueue.orderBy("sentDate").reverse().limit(ea).toArray();if(0===e.length)return Yn=!1,Xn=0,Jn=0,z.U.setStatus(re.A4,(0,u.Z)("All downloaded messages are available for a full text search")),void b.Z.info("Mail",["iterateSearchDbQueue"],"Finished indexing message content for search");0===Xn&&(Xn=await m.Z.searchDbQueue.count()),z.U.setStatus(re.A4,(0,u.Z)("Preparing downloaded messages for a full text search - $1/$2",[Jn,Xn])),b.Z.info("Mail",["iterateSearchDbQueue"],"Indexing message contents for search",Jn,Xn);const t=Date.now(),n=await(0,M.Z)(e.map((({searchListId:e})=>e))),a=new Map(n.map((e=>[e.id,e])));await Promise.all(e.map((async e=>{try{const{accountId:t,searchListId:n,sentDate:s}=e,i=a.get(n),r=await Zt.Z.call(t,n,s);if(!r||!i)return void b.Z.info("Mail",["iterateSearchDbQueue",t],"Ignoring deleted message",JSON.stringify({request:e}));const o=(0,Be.PW)((0,Be.Zp)(r));if(o){const e=await N.Z.parseMail(r,o.mimeTree),t=(0,$e.Hg)(e.bodyParts);await(0,ke.K)(n,i,t)}}catch(t){b.Z.error("Mail",["iterateSearchDbQueue"],"Error processing request",JSON.stringify({request:e}),t)}}))),await m.Z.searchDbQueue.bulkDelete(e.map((({id:e})=>e))),Jn+=e.length,Yn=!1,ea=ta.optimize(e.length,Date.now()-t),na.queue(Na,D.NB.ADD_TO_SEARCH_DB)}catch(e){Yn=!1,Xn=0,Jn=0,z.U.setStatus(re.A4,(0,u.Z)("Error when preparing downloaded messages for search")),b.Z.error("Mail",["iterateSearchDbQueue"],"Error iterating the Search DB Queue",e)}}}const Ta={setCheckInterval:function(e,t){aa&&clearInterval(aa),aa=e?setInterval(xa,6e4*t):void 0},fetchRawOfMessage:async function(e,t,n){return(await ca(e,[t])).get(t)},connectIMAPClient:ba,connectIMAPClients:_a,disconnectIMAPClient:va,reconnectIMAPClient:Ia,reconnectIMAPClients:async function(){l.Z.isMailOn()&&(await ya(),await _a())},disconnectIMAPClients:ya,checkNewDeletedModified:function(e,t){oa(e,t).catch((n=>wa(n,e,t))).then((()=>ia(e)))},rescanUnreadFlags:async function(e,t){const n=(await sa(e)).mailboxCache[t];n&&(n.highestModseq="0",oa(e,t).catch((n=>wa(n,e,t))).then((()=>ia(e))))},checkForMail:Sa,preFetch:Ma,subscribeMailbox:async function(e){const{accountId:t,path:n}=e,a=await sa(t);await a.subscribeMailbox({path:n}),Ia(t)},unsubscribeMailbox:async function(e,t){if(!c.Z.isUnsubscribable(e))throw new Error(`Folder ${e.accountId}/${e.path} can not be unsubscribed.`);const{accountId:n,path:a}=e,s=await sa(n);await s.unsubscribeMailbox({path:a}),t&&An(n,a),Ia(n)},createMailbox:async function(e,t,n){try{const a=h.Z.getFolder(e,t)?.delimiter||".",s=t.split(a).filter((e=>e!==D.ym));s.push((0,Zn.y3)(n));const i=await sa(e),r=await i.createFolder({path:s});await i.subscribeMailbox({path:r}),Ia(e)}catch(a){b.Z.error("Mail",["imap",e,t,n,"create mailbox"],a.message||a)}},deleteMailbox:async function(e,t){try{const n=await sa(e),a=async()=>{await n.unsubscribeMailbox({path:t}),await Qt(e,t,!0),await n.deleteFolder({path:t})};await a(),Ia(e)}catch(n){b.Z.error("Mail",["imap",e,t,"delete mailbox"],n.message||n)}},reSyncFolder:async function(e,t){An(e,t),await Ia(e)},reSyncAccount:async function(e){!function(e){delete En[e]}(e),await Ia(e)},pausePrefetching:Oa,startAddtoSearchDb:function(){na.queue(Na,D.NB.ADD_TO_SEARCH_DB)},getSelectedMailboxes:function(){const e=new Map;for(const[t,n]of Rn)e.set(t,n._client._selectedMailbox);return e},unblockAccount:async function(e){Fn.delete(e)}};self.addEventListener("message",(async function({origin:e,data:t,source:n}){if(e!==re.oP||!t||!t.imap)return;const{promiseId:a,func:s,args:i=[]}=t.imap;if(s)try{const e=await Ta[s](...i),t=e&&"fetchRawOfMessage"===s?[e.buffer]:void 0;n.postMessage({imap:{promiseId:a,results:e}},{transfer:t})}catch(e){const t=e.message||e;n.postMessage({imap:{promiseId:a,error:t}})}}),!1);const Ra={checkForMail:Sa,copyMessages:async function(e,t,n,a){const s={path:t,uids:n,destination:a},i=[e,a],r=w.Z.getByFolderId(i);if(!r)throw new Error("Destination filter not found for "+i.join(", "));const o=await m.Z.imap.where("[accountId+path+uid]").anyOf(n.map((n=>[e,t,n]))).toArray(),c=new Map(o.map((e=>[e.uid,e]))),l=await sa(e),d=await l.copyMessages(s);if(!d)return void b.Z.warn("Mail",["imap",e],"UIDPLUS not supported, cannot create imap entries");const{srcSeqSet:u,destSeqSet:h}=d,f=Nn(u),p=Nn(h);let g;await m.Z.transaction("rw",[m.Z.imap,m.Z.searchList],(async()=>{const n=[];f.forEach(((s,i)=>{const r=p[i],o=c.get(s);o?n.push({...o,path:a,uid:r}):b.Z.warn("Mail",["imap",e],"cannot create imap entry for "+JSON.stringify([t,s]))})),g=await fn(n,r)})),g&&z.QO.updateIndex({sleUpdates:g})},deleteMessages:async function(e,t,n){const a={path:t,uids:n};return(await sa(e)).deleteMessages(a)},disconnectIMAPClient:va,fetchRawOfMessages:ca,moveMessages:async function(e,t,n,a){const s={path:t,uids:n,destination:a};return(await sa(e)).moveMessages(s)},park:ia,selectMailbox:oa,updateFlags:async function(e,t,n,a){const s=[],i=[];for(const[e,t]of Object.entries(a))t?s.push(e):i.push(e);const r={path:t,uids:n,add:s,remove:i};return(await sa(e)).updateFlags(r)},uploadMessage:async function(e,t,n,a){const s=await(0,gn.Z)(n);if(!s)throw new Error(`Entry ${n} not found in searchList table`);const{sentDate:i}=s,r=await Zt.Z.call(e,n,i);if(!r)throw new Error(`Can not upload message ${n} as raw file was not found on disk`);(await O.Z.getBySearchListId(n)).find((e=>e.hasRaw))||b.Z.warn("Mail",["imap",e,t,n],"imap.js: Data inconsistency, raw file found on disk contrary to hasRaw table");const o=(0,ze.DA)(r),c=[e,t],l=w.Z.getByFolderId(c);if(!l)throw new Error("Destination filter not found for "+c.join(", "));const d=await sa(e),u=a.indexOf(D.T4.RECENT);u>-1&&a.splice(u,1);const h=await d.uploadMessage({path:t,message:o,flags:a});if(ia(e),!h)return void b.Z.warn("Mail",["imap",e],"UIDPLUS not supported, cannot create imap entry");const f=Number.parseInt(h);let p;await m.Z.transaction("rw",[m.Z.imap,m.Z.searchList,m.Z.hasRaw],(async()=>{const a={accountId:e,path:t,uid:f,searchListId:n};p=await fn([a],l);const s={searchListId:n,accountId:e,hasRaw:1,sentDate:i};await m.Z.hasRaw.put(s)})),p&&z.QO.updateIndex({sleUpdates:p})},pausePrefetching:Oa,toggleImapLogging:function(){const e=[...Rn.values()];for(const{client:t}of Pn.values())t&&e.push(t);for(const t of e)t._client.logLevel=a.Z.get(C.kMailImapLogsOn)?dn.lw:dn.jF}};var Pa=n(78134),Ca=n(85834),Fa=n(95064);const Ua=[{listId:"meetup.com",name:"meetup.com",parentFolderType:"endsWith",subFolderType:"title",isIgnored:!1},{listId:"facebook.com",name:"facebook.com",parentFolderType:"endsWith",subFolderType:"title",isIgnored:!1},{listId:"github.com",name:"github.com",parentFolderType:"endsWith",subFolderType:"title",isIgnored:!1},{listId:"google.com",name:"google.com",parentFolderType:"endsWith",subFolderType:"senderName",isIgnored:!1},{listId:"googlegroups.com",name:"googlegroups.com",parentFolderType:"endsWith",subFolderType:"title",isIgnored:!1},{listId:"groupon",name:"groupon",parentFolderType:"endsWith",subFolderType:"senderName",isIgnored:!1},{listId:"xt.local",name:"xt.local",parentFolderType:"endsWith",subFolderType:"host",isIgnored:!1},{listId:"sparkpostmail.com",name:"sparkpostmail.com",parentFolderType:"endsWith",subFolderType:"host",isIgnored:!1},{listId:"substack.com",name:"substack.com",parentFolderType:"endsWith",subFolderType:"senderName",isIgnored:!1},{listId:"list-id.mcsv.net",name:"list-id.mcsv.net",parentFolderType:"endsWith",subFolderType:"host",isIgnored:!1},{listId:"spc-",name:"sparkpostmail.com (spc-)",parentFolderType:"startsWith",subFolderType:"host",isIgnored:!1},{listId:"MAILING_LIST_GROUPS_UNCATEGORIZED",name:"",parentFolderType:"uncategorized",subFolderType:"host",isIgnored:!1}];var Da=n(65741),za=n(95617);const Ba="Contacts";class $a{count=0;constructor(e,t){this.version=e,this.interval=setInterval((()=>this.total&&z.U.setStatus(re.A4,`Upgrade v${e} mail: ${t} ${this.count} / ${this.total}`)),1e3),b.Z.info("Mail",["upgrade"],"Started: ",e)}stop(){clearInterval(this.interval),z.U.setStatus(re.A4,`Upgrade v${this.version} mail: Finalizing...`,5e3),b.Z.info("Mail",["upgrade"],"Finished: ",this.version)}}m.Z.on("populate",(()=>{m.Z.filters.bulkAdd(Fa.j),m.Z.mailingList.bulkAdd(Ua),m.Z._upgrades.add({version:m.Z.verno})})),m.Z.version(136).stores({messages:"++id",searchList:["++id","messageId","*sourceFilterIds"].join(","),threading:["++id","*references","inReplyTo","messageId"].join(","),accounts:"accountId",mailboxCache:"[accountId+path],accountId",filters:"++id,&[accountId+path]",buffer:["++_id","[accountId+path+operation]","accountId","[accountId+path]","operation","[accountId+destinationPath+operation]"].join(","),views:"++id,filterId",imap:["[accountId+path+uid]","searchListId","[hasRaw+accountId+searchListId]","[accountId+path+searchListId]","accountId"].join(","),pop:"[accountId+uidl],searchListId,accountId",filteringQueue:"++id,priority",threadingQueue:"++id",viewIds:"searchListId,*viewIds",flaggingQueue:"++id",drafts:null,tokens:null,folders:null}).upgrade((e=>{e.messages.clear(),e.searchList.clear(),e.threading.clear(),e.accounts.clear(),e.mailboxCache.clear(),e.filters.clear(),e.buffer.clear(),e.views.clear(),e.imap.clear(),e.pop.clear(),e.filteringQueue.clear(),e.threadingQueue.clear(),e.viewIds.clear(),e.flaggingQueue.clear()}));const ja=new Map;m.Z.version(137).stores({_upgrades:"version"}),ja.set(137,(async e=>{new $a(137,"Upgrade v137 mail").stop()})),ja.set(138,(async e=>{const t=new $a(138,"Upgrade v138 mail: Run Custom Folder");await e.filteringQueue.add({priority:D.Un.LOW,type:"RUN_FILTERS",folderIds:[[D.Ry,D.ym]],updateFilters:!0}),t.stop()})),ja.set(139,(async e=>{const t=new $a(139,"Upgrade v139 mail: Repair default filters"),n=[],a=["total","unseen","unread","excludeMailingLists","excludeDeleted","excludeRssFeeds","excludeJunk","excludeCustomFolders"];for(const t of Fa.j){const{accountId:s,path:i}=t,r=await e.filters.where("[accountId+path]").equals([s,i]).first();if(r){const{id:s}=r,i={id:s,...t};await e.filters.put(i);const o=await e.views.where("filterId").equals(s).toArray(),c=new Set(o.map((e=>e.type)));for(const t of a)if(!c.has(t)){const n={filterId:s,type:t};e.views.add(n)}n.push(s)}else{const s=await e.filters.add(t);for(const t of a)await e.views.add({filterId:s,type:t});n.push(s)}}if(n.length>0){const t={priority:D.Un.LOW,type:"RUN_FILTERS",filterIds:n};e.filteringQueue.add(t)}t.stop()})),ja.set(140,(async e=>{const t=new $a(140,"Map viewIds to new format");t.total=await e.viewIds.count()+await e.views.count();const n=new Map,a=["total","unseen","unread","excludeMailingLists","excludeDeleted","excludeRssFeeds","excludeJunk","excludeCustomFolders"];await e.views.each((e=>{const s=a.indexOf(e.type);-1!==s&&n.set(e.id,100*e.filterId+s),t.count++})),await e.viewIds.toCollection().modify((e=>{const a=new Set;e.viewIds.forEach((e=>{const t=n.get(e);"number"==typeof t&&a.add(t)})),e.viewIds=[...a],t.count++})),e.views.clear(),t.stop()})),m.Z.version(141).stores({deletedFeedItems:"++id,path"}),ja.set(142,(async e=>{const t=new $a(142,"Fixing default parent filters");let n,a,s,i,r,o;function c(e,t){const{include:n}=e.filterValue;for(const e of t){n.some((t=>(0,Da.Z)(t,e)))||n.push(e)}}o=[D.wC,""],r=[D.wC,"￿"];const l=await e.filters.where("[accountId+path]").between(o,r).toArray(),d=[],u=[];for(const e of l){const{path:t,filterValue:i}=e;if(t===D.ym)n=e;else if(t===D.W4)a=e;else if(t===D.cs)s=e;else{const e=i.include.filter((e=>1===e.length&&(e[0].listId||e[0].senderIsMailingList)));t.startsWith(D.W4)?d.push(...e):t.startsWith(D.cs)&&u.push(...e)}}if(!n)throw new Error("Mailing list root folder not found");if(!a)throw new Error("Mailing list Important folder not found");if(!s)throw new Error("Mailing list Other folder not found");c(n,d),c(n,u),c(a,d),c(s,u),o=[D.ut,""],r=[D.ut,"￿"];const h=await e.filters.where("[accountId+path]").between(o,r).toArray(),f=[];for(const e of h){const{path:t,filterValue:n}=e;if(t===D.ym)i=e;else{const e=n.include.filter((e=>1===e.length&&e[0].flag));f.push(...e)}}if(!i)throw new Error("Labels root folder not found");c(i,f),await e.filters.bulkPut([n,a,s,i]);const p=[n.id,a.id,s.id,i.id];await w.Z.updateFilters(p),await k.Z.call({type:"RUN_FILTERS",priority:D.Un.LOW,filterIds:p}),t.stop()})),ja.set(143,(async e=>{const t=new $a(143,"Fixing database inconsistency"),n=await e.searchList.toCollection().primaryKeys(),a=await e.viewIds.toCollection().primaryKeys(),s=new Set(n),i=a.filter((e=>!s.has(e)));await e.viewIds.where("searchListId").anyOf(i).delete(),t.stop()})),m.Z.version(144).stores({viewIds:"searchListId"}),ja.set(146,(async e=>{const t=new $a(146,"Fixing state of show-read button in received folder");await e.filters.where("[accountId+path]").equals([D.of,D.ik]).modify((e=>{e.filterValue={...e.filterValue,showReadButton:!0}})),t.stop()})),m.Z.version(147).stores({mailingList:"listId"}),ja.set(147,(async e=>{const t=new $a(147,"Group mailing lists providers (like xt.local and sparkpostmail.com)");await e.mailingList.bulkAdd(Ua);const n=D.wC,a=[n,""],s=[n,"￿"],i=await e.filters.where("[accountId+path]").between(a,s).toArray(),r=[];if(i.forEach((e=>{(e.path.endsWith(".xt.local")||e.path.endsWith(".sparkpostmail.com")||e.path.endsWith("list-id.mcsv.net")||e.path.startsWith(D.cs+"/spc-")||e.path.startsWith(D.W4+"/spc-"))&&r.push(e.id)})),r.length>0){const n=r.map((e=>100*e));await e.filters.where("id").anyOf(r).delete();const a=new Set,s=8;t.total=n.length,n.forEach((e=>{for(let t=0;t<s;t++)a.add(e+t)}));const i=[];await e.viewIds.toCollection().modify((e=>{const n=e.viewIds.filter((e=>!a.has(e)));n.length!==e.viewIds&&(i.push(e.searchListId),e.viewIds=n),t.count++})),await e.filteringQueue.add({priority:D.Un.LOW,type:"RE_RUN_SLES",searchListIds:i,runMailingLists:!0,updateFilters:!0})}t.stop()})),ja.set(148,(async e=>{const t=new $a(148,"VB-78846: Rerun views for flags and labels"),n=[D.ut,""],a=[D.ut,"￿"],s=await e.filters.where("[accountId+path]").between(n,a).primaryKeys(),i=[D.MN,""],r=[D.MN,"￿"],o=await e.filters.where("[accountId+path]").between(i,r).primaryKeys();await e.filteringQueue.add({priority:D.Un.LOW,type:"RUN_FILTERS",filterIds:[...s,...o]}),t.stop()})),m.Z.version(149).stores({systemTasks:"++id",tokens:null}),ja.set(149,(async e=>{const t=new $a(149,"Clear tokens table and prepare for transition to new search db ...");await e.systemTasks.add({taskName:"restore_full_text_search_db",currentPosition:0}),t.stop()})),ja.set(150,(async e=>{const t=new $a(150,"VB-79158: [Mail] Unseen/Read status does not always match changes done with external server"),n=await e.accounts.toArray(),a=[];for(const e of n){const{accountId:t,folders:n}=e;for(const e in n)n[e].forEach((e=>{a.push([t,e.path])}))}const s=await e.filters.where("[accountId+path]").anyOf(a).toArray(),i=new Set;await e.searchList.toCollection().modify((e=>{const t=[...e.sources].filter((([e,t])=>t.internal)),n=[...e.sources].filter((([e,t])=>!t.internal));t&&0!==t.length&&n&&0!==n.length&&n.forEach((([n,a])=>{const r=s.find((e=>e.id===n))?.accountId;r&&t.forEach((([t,n])=>{const o=s.find((e=>e.id===t))?.accountId;if(o&&o===r){const n=e.sources.get(t);n&&n.read!==a.read&&(n.read=a.read,i.add(e.id),n.read&&(e.unseen=!1))}}))}))})),await e.filteringQueue.add({priority:D.Un.LOW,type:"RE_RUN_SLES",searchListIds:[...i]}),t.stop()})),ja.set(151,(async e=>{const t=new $a(151,"Removing orphan source-filter IDs");t.total=await e.searchList.count();const n=await e.filters.toCollection().primaryKeys(),a=new Set(n);await e.searchList.toCollection().modify((e=>{e.sourceFilterIds=e.sourceFilterIds.filter((e=>a.has(e)));const n=new Map;for(const[t,s]of e.sources)a.has(t)&&n.set(t,s);e.sources=n,t.count++})),t.stop()})),ja.set(152,(async e=>{const t=new $a(152,"Resetting feed data for updating paths"),n=await Pa.Z.waitFor((()=>R.Z.prefs.get(C.kRssSettings)));if(0===n.length)return void t.stop();const a={},s=[];t.total=n.length;for(const i of n){const n=i.feedId||i.path,r=await e.filters.where("[accountId+path]").equals([D.u4,n]).first(),o=crypto.randomUUID();if(a[n])try{const t={accountId:D.u4,filterValue:{exclude:a[n].filterValue.exclude.slice(),include:[[{accountId:D.u4},{path:o}]],showCustomFolderButton:!1,showFeedsButton:!1,showJunkButton:!1,showMailingListsButton:!1},name:i.title,path:o},r=await e.filters.add(t);s.push(r)}catch(e){console.error(e)}else if(r){a[n]=r;const t={...r.filterValue,include:[[{accountId:D.u4},{path:o}]]};await e.filters.update(r.id,{path:o,filterValue:t}),s.push(r.id)}else console.error("Filter not found for feedId",n);i.feedId=i.url,delete i.path,t.count++}R.Z.prefs.set({path:"vivaldi.rss.settings",value:n}),await k.Z.call({type:"RUN_FILTERS",priority:D.Un.LOW,filterIds:s}),t.stop()})),ja.set(153,(async e=>{const t=new $a(153,"Re-run sender is a mailing list filters"),n=await e.filters.where("[accountId+path]").between([D.wC,""],[D.wC,"￿"]).filter((e=>e.filterValue.include?.some((e=>e.some((e=>!!e.senderIsMailingList)))))).primaryKeys();await k.Z.call({type:"RUN_FILTERS",priority:D.Un.LOW,filterIds:n}),t.stop()})),ja.set(154,(async e=>{const t=new $a(154,"Fix unseen counters");t.total=await e.searchList.count();const n=[];await w.Z.initFilters(),await e.searchList.toCollection().modify((e=>{e.unseen&&W.Z.call(e.sources)&&(e.unseen=!1,n.push(e.id)),t.count++})),await e.filteringQueue.add({priority:D.Un.LOW,type:"RE_RUN_SLES",searchListIds:n}),t.stop()})),ja.set(158,(async e=>{const t=new $a(158,"Update thread key");t.total=await e.searchList.count(),await e.searchList.toCollection().modify((e=>{0===e.threadKey[1]&&(e.threadKey[1]=e.id),t.count++})),t.stop()})),ja.set(159,(async e=>{const t=new $a(159,"Update old filter rules and delete contact filters"),n=await e.filters.where("[accountId+path]").between([D.wC,""],[D.wC,"￿"]).count()+await e.filters.where("[accountId+path]").between([D.Kz,""],[D.Kz,"￿"]).count(),a=[Ba,""],s=[Ba,"￿"],i=await e.filters.where("[accountId+path]").between(a,s).primaryKeys(),r=await e.filters.where("[accountId+path]").equals([D.Kz,D.ym]).primaryKeys();if(i.push(...r),i.length>0){const a=100,s=i.map((e=>e*a));await e.filters.where("id").anyOf(i).delete();const r=new Set,o=8;s.forEach((e=>{for(let t=0;t<o;t++)r.add(e+t)})),t.total=await e.viewIds.count()+n,await e.viewIds.toCollection().modify((e=>{const n=e.viewIds.filter((e=>!r.has(e)));n.length!==e.viewIds&&(e.viewIds=n),t.count++}))}else t.total=n;function o(e,t,n,a,s){e||(e="");let i=n;return a.includes("equal")&&["subject"].includes(t)&&(i=`"${i}"`),"anywhere"!==t&&(i=`${t}:${i}`),s&&e&&(i=`${e?" ":""}${s} `+i),e?e+i:i}const c=(e,t)=>{const n=[...e.filterValue[t]].filter(((n,a)=>{const s=[...n].filter(((n,a)=>{for(const s in n){let i="";const r="exclude"===t?"NOT":a?"AND":"OR";return"subject"!==s&&"to"!==s&&"from"!==s&&"cc"!==s||(i="subject"===s?n[s]:n[s].address,e.filterValue.query=o(e.filterValue.query,s,i,"equal",r),!1)}}));return e.filterValue[t][a]=s,0!==s.length}));0===n.length?delete e.filterValue[t]:e.filterValue[t]=n},l=e=>{e.filterValue.include&&c(e,"include"),e.filterValue.exclude&&c(e,"exclude")};await e.filters.where("[accountId+path]").between([D.wC,""],[D.wC,"￿"]).modify((e=>{l(e),t.count++})),await e.filters.where("[accountId+path]").between([D.Kz,""],[D.Kz,"￿"]).modify((e=>{e.path===D.ym?(e.filterValue.include=[],e.filterValue.exclude&&delete e.filterValue.exclude):l(e),t.count++})),t.stop()})),ja.set(160,(async e=>{const t=new $a(160,"Update viewIds of messages that have too many unseen counters"),n=[];await e.searchList.toArray().then((e=>{e.forEach((e=>{e.unseen||n.push(e.id)}))})),t.total=n.length,await e.viewIds.where("searchListId").anyOf(n).modify((e=>{e.viewIds=e.viewIds.filter((e=>!function(e){return e%100==1}(e))),t.count++})),t.stop()})),ja.set(161,(async e=>{const t=new $a(161,"Update Received folder to include send to self"),n={name:D.ik,accountId:D.of,path:D.ik,filterValue:{include:[[{folder:"Archive"}],[{folder:"Flagged"}],[{folder:D.Oi}],[{folder:D.e9}],[{folder:D.Hd}],[{folder:D.uT},{folder:"Not Sent Internal"}]],...V.ZP.getSearchListButtons(D.HM)}};n&&(await e.filters.where("[accountId+path]").equals([n.accountId,n.path]).modify((e=>{e.filterValue.include=n.filterValue.include,e.filterValue.exclude=e.filterValue.exclude.filter((e=>!e.some((e=>e.folder===D.Nz))))})),await k.Z.call({priority:D.Un.LOW,type:"RUN_FILTERS",folderIds:[[D.of,D.ik]]})),t.stop()})),m.Z.version(162).stores({filteringQueue:"++id"}),ja.set(163,(async e=>{const t=new $a(163,"Adding support for Archive folders"),n="Archive",a="Archive",s=new Map;await e.accounts.toCollection().modify((({accountId:e,folders:t})=>{const i=t.Other;if(!i)return;const r=[];if(t.Other=i.filter((e=>{const{name:t,path:s}=e;return t!==a&&s!==a||(r.push({...e,type:n}),!1)})),r.length>0){const e=t.Archive;e?e.push(...r):t.Archive=r}const o=new Map;s.set(e,o);Object.keys(t).forEach((e=>{t[e].forEach((t=>{o.set(t.path,e)}))}))}));let i=!1;await e.filters.toCollection().modify((e=>{const{accountId:t,path:n,filterValue:a}=e;"All Messages"===t&&"Archive"===n&&(i=!0);const r=function(e,t){const n=s.get(e)?.get(t);return n||(e===D.of&&t===D.rp?D.Hd:t)}(t,n);if((["Sent","Drafts","Outbox"].includes(r)||["Single thread","Feeds"].includes(t))&&(a.showArchivedButton=!1),"Archive"===r){const e=[{accountId:t},{folder:"Archive"}];a.include?a.include.push(e):a.include=[e],a.showCustomFolderButton=!1,a.showJunkButton=!1,a.showArchivedButton=!1}})),i||(await e.filters.add({name:"Archive",accountId:"All Messages",path:"Archive",filterValue:{include:[[{folder:"Archive"}]],exclude:[[{flag:"\\Deleted"}],[{folder:"Trash"}]],showCustomFolderButton:!1,showJunkButton:!1,showArchivedButton:!1}}),await e.filteringQueue.add({priority:15,type:"RE_RUN_SLES",folderIds:[["All Messages","Archive"]],runMailingLists:!0})),t.stop()})),ja.set(164,(async e=>{const t=new $a(164,"Update names for filters");e.filters.toCollection().modify((e=>{e.name===D.ym&&(e.name=e.accountId)})),t.stop()})),ja.set(165,(async e=>{const t=new $a(165,"Fix Archive status in filters"),n=new Map;function a(e,t){return e.some((e=>1===e.length&&e[0]?.folder===t))}await e.accounts.each((({accountId:e,folders:t})=>{const a=new Map;n.set(e,a);Object.keys(t).forEach((e=>{t[e].forEach((t=>{a.set(t.path,e)}))}))})),await e.filters.toCollection().modify((e=>{const{accountId:t,path:s,filterValue:i}=e,r=function(e,t){const a=n.get(e)?.get(t);return a||(e===D.of&&t===D.rp?D.Hd:t)}(t,s);if("Archive"===r){delete i.showJunkButton;const e=[{folder:"Junk"}];i.exclude?a(i.exclude,"Junk")||i.exclude.push(e):i.exclude=[e]}else if(!1!==i.showArchivedButton){const e=[{folder:"Archive"}];i.exclude?a(i.exclude,"Archive")||i.exclude.push(e):i.exclude=[e]}})),t.stop()})),ja.set(166,(async e=>{const t=new $a(166,"Apply default showSubFolders and clear related include rules"),n=new Set(["Custom Folders","Mailing Lists","Filters","Labels","Flags","Feeds"]),a=new Set(["Other Mailing Lists","Important Mailing Lists"]),s=await e.accounts.toCollection().primaryKeys(),i=new Map,r=new Set;await e.filters.toCollection().modify((e=>{const{id:t,accountId:o,path:c,filterValue:l}=e;"VIVALDI_RESERVED_DUMMY_ROOT_PLACEHOLDER_PATH"===c&&(n.has(o)||s.includes(o))?(l.include=[],l.showSubFolders=!0,r.add(t)):"Mailing Lists"===o&&(a.has(c)?(l.include=[],l.showSubFolders=!0,r.add(t)):i.set(c,e))}));for(const e of[...i.values()]){const{include:t}=e.filterValue;if(!t||0===t.length)continue;const n=new Set;for(const e of t)for(const t of e)t.listId&&n.add(t.listId);if(0===n.size)continue;let a=e.path.substring(0,e.path.lastIndexOf("/")),s=i.get(a);for(;s;){const{id:e,filterValue:t}=s;if(t.include?.length>0){const a=t.include.length;t.include=t.include.filter((e=>!e.some((e=>n.has(e.listId))))),t.include.length<a&&r.add(e)}t.showSubFolders=!0,a=a.substring(0,a.lastIndexOf("/")),s=i.get(a)}}i.size>0&&await e.filters.bulkPut([...i.values()]),r.size>0&&await e.filteringQueue.add({priority:D.Un.LOW,type:"RUN_FILTERS",filterIds:[...r]}),t.stop()})),ja.set(167,(async e=>{const t=new $a(167,"Fix filter include rules"),n=[],a=new Set(["Flags","Custom Folders","All Accounts"]),s=await e.accounts.toCollection().primaryKeys(),i=new Set(s);await e.filters.toCollection().modify((e=>{const{id:t,accountId:s,path:r,filterValue:o}=e;"VIVALDI_RESERVED_DUMMY_ROOT_PLACEHOLDER_PATH"===r&&(a.has(s)&&(!o.include||o.include.length>0)&&(o.include=[],n.push(t)),!o.include&&i.has(s)&&(o.include=[],n.push(t)))})),n.length>0&&await e.filteringQueue.add({priority:15,type:"RUN_FILTERS",filterIds:n}),t.stop()})),ja.set(170,(async e=>e.buffer.where("operation").equals("BUFFER_OPERATION_REMOVE_ACCOUNT_PATH").filter((e=>void 0===e.path)).delete())),ja.set(171,(async e=>{await e.filteringQueue.toCollection().modify((e=>{if(e.folderIds){Array.isArray(e.folderIds[0])||(e.folderIds=[e.folderIds]);for(const t of e.folderIds)t[1]=t[1]||"VIVALDI_RESERVED_DUMMY_ROOT_PLACEHOLDER_PATH"}}))})),ja.set(173,(async e=>{const t=new $a(173,"Fix casing of inbox and remove duplicates if found"),n=await e.accounts.toArray();for(const t of n){if(t.accountId===D.of){await e.accounts.delete(D.of);continue}const n=t.folders.Inbox||[];for(const a of n)"inbox"===a.path.toLowerCase()&&"Inbox"!==a.path&&(a.path="Inbox",await e.accounts.update(t.accountId,t))}function a(e){let t=!1;"inbox"===e.path.toLowerCase()&&"Inbox"!==e.path&&(e.path="Inbox",t=!0);for(const n of["include","exclude"])if(e.filterValue[n])for(const a of e.filterValue[n])for(const e of a)e.path&&"inbox"===e.path.toLowerCase()&&"Inbox"!==e.path&&(e.path="Inbox",t=!0);return t}const s=await e.filters.toArray(),i=s.filter((e=>"inbox"===e.path.toLowerCase())),r={};for(const e of i)r[e.accountId]?r[e.accountId].push(e):r[e.accountId]=[e];for(const n in r){const s=(await e.imap.where("accountId").equals(n).toArray()).filter((e=>"inbox"===e.path.toLowerCase())),i=new Map;t.total=s.length,t.count=0;for(const n of s){t.count++;const{accountId:a,path:s,uid:r}=n,o=i.get(r);o?0===o.hasRaw&&1===n.hasRaw&&(o.hasRaw=1):i.set(r,{...n,path:"Inbox"}),"Inbox"!==s&&await e.imap.delete([a,s,r])}await e.imap.bulkPut(Array.from(i.values()));const o=(await e.mailboxCache.where("accountId").equals(n).toArray()).filter((e=>"inbox"===e.path.toLowerCase())),c=new Map;t.total=o.length,t.count=0;for(const n of o){t.count++;const{accountId:a,path:s}=n,i=c.get(s);i?(Number(n.highestModseq)>Number(i.highestModseq)&&(i.highestModseq=n.highestModseq),n.uidNext>i.uidNext&&(i.uidNext=n.uidNext),n.exists>i.exists&&(i.exists=n.exists)):c.set(s,{...n,path:"Inbox"}),await e.mailboxCache.delete([a,s])}await e.mailboxCache.bulkPut(Array.from(c.values()));const l=await e.buffer.where("accountId").equals(n).toArray();t.total=l.length,t.count=0;for(const n of l){t.count++;const{_id:a,path:s="",destinationPath:i=""}=n;"inbox"===s.toLowerCase()&&"Inbox"!==s&&await e.buffer.update(a,{path:"Inbox"}),i&&"inbox"===i.toLowerCase()&&"Inbox"!==i&&await e.buffer.update(a,{destinationPath:"Inbox"})}const d=await e.filteringQueue.toArray();t.total=d.length,t.count=0;for(const n of d){t.count++;let a=!1;const{id:s,folderIds:i,fromFolderId:r,toFolderId:o}=n;if(i)for(const e of i)"inbox"===e[1].toLowerCase()&&"Inbox"!==e[1]&&(e[1]="Inbox",a=!0);r&&"inbox"===r[1].toLowerCase()&&"Inbox"!==r[1]&&(r[1]="Inbox",a=!0),o&&"inbox"===o[1].toLowerCase()&&"Inbox"!==o[1]&&(o[1]="Inbox",a=!0),a&&await e.filteringQueue.update(s,n)}const u=r[n];if(1===u.length){const t=u[0];a(t)&&await e.filters.update(t.id,t)}else if(u.length>1){let n=u.find((e=>"Inbox"===e.path));n||(n=u[0],a(n)&&await e.filters.update(n.id,n));const s=u.filter((e=>e.id!==n?.id)),i=s.map((e=>e.id)),r=s.map((e=>100*e.id));await e.filters.where("id").anyOf(i).delete();const o=new Set,c=9;t.total=r.length,t.count=0,r.forEach((e=>{for(let t=0;t<c;t++)o.add(e+t)})),await e.viewIds.toCollection().modify((e=>{const n=e.viewIds.filter((e=>!o.has(e)));n.length!==e.viewIds&&(e.viewIds=n),t.count++}))}}const o=s.filter((e=>"inbox"!==e.path.toLowerCase()));t.total=o.length,t.count=0;for(const n of o)t.count++,a(n)&&await e.filters.update(n.id,n);t.stop()})),ja.set(174,(async e=>{const t=new $a(174,"Delete empty label if there is one"),n=await e.filters.where("[accountId+path]").equals([D.ut,""]).primaryKeys(),a=[0,1,2,3,4,5,6,7,8];if(n.length>0)for(const s of n){t.total=await e.viewIds.count();const n=100,i=new Set(a.map((e=>s*n+e)));await e.viewIds.toCollection().modify((e=>{const n=e.viewIds.filter((e=>!i.has(e)));n.length!==e.viewIds&&(e.viewIds=n),t.count++})),e.filters.delete(s)}t.stop()})),ja.set(175,(async e=>{const t=new $a(175,"Re-run filtering"),n=new Map;await e.searchList.each((({id:e,sourceFilterIds:a})=>{for(const t of a){const a=n.get(t);a?a.push(e):n.set(t,[e])}t.count++}));for(const[t,a]of n)await e.filteringQueue.add({type:"FILTERS_SLES",priority:20,searchListIds:a,filterIds:[t],runAllMessages:!0,runMailingLists:!0,runCustomFolders:!0,runFlagFolders:!0,runLabels:!0,runQueries:!0,runSingleThread:!0})})),ja.set(176,(async e=>{const t=new $a(176,"Fix grouped mailing lists"),n=await e.mailingList.toArray(),a=await e.filters.where("[accountId+path]").between(["Mailing Lists",""],["Mailing Lists","￿"]).filter((e=>{const{path:t}=e,a=t.indexOf("/");if(a<0)return!1;const s=t.substring(a+1);return!s.includes("/")&&n.some((({listId:e,parentFolderType:t})=>{switch(t){case"endsWith":return s.endsWith(e);case"startsWith":return s.startsWith(e);case"matches":return s===e}}))})).primaryKeys();if(0===a.length)return;await e.filters.bulkDelete(a);const s=new Set;for(const e of a)for(let t=0;t<9;t++)s.add(100*e+t);t.total=await e.viewIds.count(),await e.viewIds.toCollection().modify((e=>{const n=e.viewIds.filter((e=>!s.has(e)));n.length<e.viewIds.length&&(e.viewIds=n),t.count++})),await e.filteringQueue.add({priority:20,type:"RE_RUN_SLES",runMailingLists:!0}),t.stop()})),ja.set(177,(async e=>{const t=new $a(177,"Add default labels"),n=structuredClone(Fa.j).filter((e=>e.accountId===D.ut)),a=await e.filters.where("[accountId+path]").between([D.ut,""],[D.ut,"￿"]).toArray(),s=n.filter((e=>!a.some((t=>t.path===e.path))));s.length>0&&await e.filters.bulkAdd(s),t.stop()})),ja.set(178,(async e=>{const t=new $a(178,"Delete empty label actions");await e.filters.where("[accountId+path]").between([D.Kz,""],[D.ut,"￿"]).modify((e=>{e.triggers&&(e.triggers=e.triggers.filter((e=>void 0===e.label||""!==e.label)))})),t.stop()})),ja.set(179,(async e=>{const t=new $a(179,"Fixing saved searches"),n=["Filters",""],a=["Filters","￿"],s=await e.accounts.toCollection().primaryKeys();if(s.length>0){const t="VIVALDI_RESERVED_DUMMY_ROOT_PLACEHOLDER_PATH",i=s.map((e=>[e,t])),r=(e,t)=>{const{filterValue:n}=e;if(n.showSubFolders){delete n.showSubFolders;const e=n.include||[];n.include=[...e,[{accountId:t}]]}};await e.filters.where("[accountId+path]").anyOf(i).modify((e=>r(e,e.accountId))),await e.filters.where("[accountId+path]").between(n,a).filter((e=>{const{selectedAccountId:t,selectedName:n}=e;return t===n&&s.includes(t)})).modify((e=>{const{selectedAccountId:t,accountId:n,path:a}=e;r(e,t),i.push([n,a])})),await e.filteringQueue.add({type:"RUN_FILTERS",priority:15,folderIds:i})}const i=await e.filters.toArray(),r=await e.filters.where("[accountId+path]").between(n,a).filter((({filterValue:e,selectedAccountId:t,selectedName:n})=>{if(e.showSubFolders)return!0;if(t&&n){if(!i.some((e=>e.accountId===t&&e.name===n)))return!0}return!1})).primaryKeys();if(r.length>0){await e.filters.bulkDelete(r);const n=new Set;for(const e of r)for(let t=0;t<9;t++)n.add(100*e+t);t.total=await e.viewIds.count(),await e.viewIds.toCollection().modify((e=>{const a=e.viewIds.filter((e=>!n.has(e)));a.length<e.viewIds.length&&(e.viewIds=a),t.count++}))}t.stop()})),ja.set(180,(async e=>{const t=new $a(180,"Decode imap folder filter names"),n=await e.accounts.toCollection().primaryKeys();await e.filters.toCollection().modify((e=>{n.includes(e.accountId)&&(e.name=(0,Zn.kF)(e.name))})),t.stop()})),ja.set(181,(async e=>{const t=new $a(181,"Adding labels made from webmail");const n=[D.ut,""],a=[D.ut,"￿"],s=(await e.filters.where("[accountId+path]").between(n,a).toArray()).map((e=>e.path)),i=new Set,r=new Set,o=await e.searchList.toArray();if(t.total=o.length,o.forEach((e=>{e.flags.forEach((t=>{!s.includes(t)&&function(e){const t=e.toLowerCase();return t.startsWith("$label")||"$"!==t[0]&&"\\"!==t[0]&&!["mdnsent","forwarded","submitpending","submitted","junk","notjunk","nonjunk","phishing","important","draft","seen","flagged","answered","recent"].includes(t)}(t)&&(i.add(t),r.add(e))})),t.count++})),[...i].length>0){const t=[...i].map((e=>{const t=[{flag:e}];return{name:e,accountId:D.ut,path:e,filterValue:{include:[t],...V.ZP.getSearchListButtons(D.ut)}}})),n=await e.filters.bulkAdd(t,{allKeys:!0});k.Z.call({type:"RE_RUN_SLES",priority:D.Un.LOW,folderIds:[[D.ut,D.ym]],filterIds:n,searchListIds:[...r].map((e=>e.id))})}t.stop()})),ja.set(182,(async e=>{const t=new $a(182,"Refactor filter view toggles");t.total=await e.filters.count(),await e.filters.toCollection().modify((e=>{const{accountId:n,path:a,filterValue:s}=e;s.exclude&&(s.exclude=s.exclude.filter((t=>{for(const s of t)return s.flag===D.T4.SEEN?(e.filterValue.showRead=!1,n===D.of&&a===D.tB):s.flag===D.T4.DELETED||s.folder===D.uT?(e.filterValue.showDeleted=!1,!1):s.folder===D.Hd?(e.filterValue.showJunk=!1,!1):s.folder===D.Oi?(e.filterValue.showCustomFolder=!1,!1):s.folder!==D.hn||(e.filterValue.showArchived=!1,!1)})),0===s.exclude.length&&delete s.exclude),s.include&&(s.include=s.include.filter((t=>{let a=!1,s=!1,i=!1;return 2!==t.length||(t.forEach((e=>{a=e.accountId===n||a,s=e.folder===D.Hd||s,i=e.folder===D.hn||i})),a&&s?(e.filterValue.showJunk=!0,!1):!a||!i||(e.filterValue.showArchived=!0,!1))}))),t.count++})),t.stop()})),m.Z.version(183).stores({importStatus:null,importProgress:"path"}),ja.set(184,(async e=>{const t=new $a(184,"Make feed-sources internal"),n=[D.u4,""],a=[D.u4,"￿"],s=await e.filters.where("[accountId+path]").between(n,a).primaryKeys();t.total=await e.searchList.where("sourceFilterIds").anyOf(s).count(),await e.searchList.where("sourceFilterIds").anyOf(s).modify((e=>{t.count++;for(const[t,n]of e.sources)s.includes(t)&&!n.internal&&(n.internal=!0)})),t.stop()})),ja.set(185,(async e=>{const t=new $a(185,"Removing custom folder filters"),n=await e.filters.toCollection().filter((({accountId:e,path:t})=>"Custom Folders"===e&&"VIVALDI_RESERVED_DUMMY_ROOT_PLACEHOLDER_PATH"!==t)).primaryKeys();if(n.length>0){await e.filters.bulkDelete(n);const a=new Set;for(const e of n)for(let t=0;t<9;t++)a.add(100*e+t);t.total=await e.viewIds.count(),await e.viewIds.toCollection().modify((e=>{const n=e.viewIds.filter((e=>!a.has(e)));n.length<e.viewIds.length&&(e.viewIds=n),t.count++}))}t.stop()})),m.Z.version(186).stores({hasRaw:"[searchListId+accountId],[hasRaw+accountId+searchListId],accountId,searchListId"}),ja.set(186,(async e=>{const t=new $a(186,"Processing raw data"),n=await e.searchList.count(),a=await e.imap.count(),s=await e.pop.count();t.total=n+a+s;const i=new Map;await e.imap.toCollection().modify((e=>{const{searchListId:n,accountId:a,hasRaw:s}=e;let r=i.get(n);r||(r=new Map,i.set(n,r)),r.set(a,1===s),delete e.hasRaw,t.count++})),await e.pop.toCollection().modify((e=>{const{searchListId:n,accountId:a,headersOnly:s}=e;let r=i.get(n);r||(r=new Map,i.set(n,r)),r.set(a,!s),delete e.headersOnly,t.count++}));const r=await e.filters.toArray(),o=new Map(r.map((e=>[e.id,e]))),c=[],l=[];for(await e.searchList.each((e=>{const n=new Set;let a=!0;for(const[t,s]of e.sources){const e=o.get(t);e?(n.add(e.accountId),s.internal||(a=!1)):b.Z.error("Mail",["Upgrade","186"],"Filter not found "+t)}for(const s of n){const n=i.get(e.id)?.get(s);let r;if(void 0!==n)r=n?1:0;else if(a)r=1;else{const{id:t,sentDate:n}=e;l.push({accountId:s,searchListId:t,sentDate:n}),r=1}c.push({searchListId:e.id,accountId:s,hasRaw:r}),t.total++}t.count++}));c.length>0;){const n=c.splice(0,1e4);await e.hasRaw.bulkAdd(n),t.count+=n.length}l.length>0&&await e.systemTasks.add({taskName:"check_disk_for_raw",fileKeys:l}),t.stop()})),m.Z.version(187).stores({hasRaw:"[searchListId+accountId],accountId,searchListId,[hasRaw+accountId]"}),m.Z.version(188).stores({hasRaw:"[searchListId+accountId],accountId,searchListId,[hasRaw+accountId+searchListId]"}),ja.set(189,(async e=>{const t=new $a(189,"Upgrade pending upload entries in buffer");t.total=await e.buffer.count();const n=await e.buffer.toArray();for(const a of n)"BUFFER_OPERATION_UPLOAD_MESSAGE"!==a.operation||a.flags?"BUFFER_OPERATION_MOVE"===a.operation&&a.destinationAccountId&&(await e.buffer.delete(a._id),b.Z.warn("Mail",["Upgrade","189"],"An old, broken buffer action for moving between accounts was removed")):(await e.buffer.update(a._id,{flags:[]}),b.Z.info("Mail",["Upgrade","189"],"An old buffer action for uploading was modified to include an empty flags array")),t.count++;t.stop()})),ja.set(191,(async e=>{const t=new $a(191,"Converting draft attachments");t.total=await e.messages.count();const n=new TextEncoder;await e.messages.toCollection().modify((e=>{e.bodyParts?.forEach((e=>{if("attachment"===e.type&&"string"==typeof e.content){const t=(0,Ca.tV)(e.content);if(e.content=n.encode(t),"application/ics"===e.mimeType){const n=t.match(/METHOD:\s*(\w+)/);n&&(e.method=n[1])}}})),t.count++})),t.stop()})),ja.set(192,(async e=>{const t=new $a(192,"Remove buffer entries for moving that have an empty uid list");t.total=await e.buffer.count();const n=await e.buffer.toArray();for(const a of n)"BUFFER_OPERATION_MOVE"!==a.operation||a.uids&&0!==a.uids.length||(await e.buffer.delete(a._id),b.Z.info("Mail",["Upgrade","192"],"Removed an unwanted buffer entry for moving an internal message")),t.count++;t.stop()})),ja.set(193,(async e=>{const t=new $a(193,"Preparing to re-run threading..."),n=await e.threading.toCollection().primaryKeys();await e.threadingQueue.add({threadingIds:n}),t.stop()})),ja.set(194,(async e=>{const t=new $a(194,"Moving size from imap table to searchList table...");t.total=await e.imap.count(),await e.imap.toCollection().modify((async n=>{const{searchListId:a,size:s}=n;await e.searchList.update(a,{size:s}),delete n.size,t.count++})),t.stop()})),ja.set(195,(async e=>{const t=new $a(195,"Clearing capabilities from accounts table");t.total=await e.accounts.count(),await e.accounts.toCollection().modify((async e=>{delete e.capability,t.count++})),t.stop()})),ja.set(196,(async e=>{const t=new $a(196,"Clearing unused gmailId from messages table");t.total=await e.messages.count(),await e.messages.toCollection().modify((e=>{delete e.gmailId,t.count++})),t.stop()})),ja.set(197,(async e=>{const t=new $a(197,"Clearing lastNotificaton from accounts table");t.total=await e.accounts.count(),await e.accounts.toCollection().modify((e=>{delete e.lastNotification,t.count++})),t.stop()})),ja.set(198,(async e=>{const t=await e.filters.get({"[accountId+path]":[D.of,D.rp]});let n=!1;if(t){const a=t.filterValue;a.include&&2===a.include.length&&a.include.find((e=>e.find((e=>e.flag&&e.flag===D.T4.JUNK))&&e.find((e=>e.folder&&e.folder===D.Hd))))||(a.include=[[{folder:D.Hd}],[{flag:D.T4.JUNK}]],await e.filters.update(t.id,{filterValue:a}),n=!0)}else{const t={name:D.rp,accountId:D.of,path:D.rp,filterValue:{include:[[{folder:D.Hd}],[{flag:D.T4.JUNK}]],...V.ZP.getSearchListButtons(D.Hd)}};await e.filters.add(t),n=!0}n&&e.filteringQueue.add({type:"RUN_FILTERS",priority:D.Un.LOW,folderIds:[[D.of,D.rp]]})})),ja.set(201,(async e=>{const t=new $a(201,"Update Received folder so Feeds filter button works");await e.filters.where("[accountId+path]").equals([D.of,D.ik]).modify((e=>{e.filterValue.include=[...e.filterValue.include,[{accountId:D.u4}]],e.filterValue={...e.filterValue,showFeeds:!1}})),await k.Z.call({priority:D.Un.LOW,type:"RUN_FILTERS",folderIds:[[D.of,D.ik]]}),t.stop()})),ja.set(202,(async e=>{const t=new $a(202,"Setting new listPost attribute to empty string");t.total=await e.messages.count(),await e.messages.toCollection().modify((e=>{e.listPost="",t.count++})),t.stop()})),ja.set(203,(async e=>{const t=new $a(203,"Make sure All Messages Unread has the exclude seen rule"),n=["All Messages","Unread"];let a=!0;await e.filters.where("[accountId+path]").equals(n).modify((e=>{e.filterValue.exclude||(e.filterValue.exclude=[]),a=e.filterValue.exclude.some((e=>1===e.length&&e[0]?.flag===D.T4.SEEN)),a||e.filterValue.exclude.push([{flag:D.T4.SEEN}])})),a||await e.filteringQueue.add({priority:D.Un.LOW,type:"RUN_FILTERS",folderIds:[n]}),t.stop()})),ja.set(204,(async e=>{const t=new $a(204,"Generate missing previews");await e.systemTasks.add({taskName:"generate_missing_previews",currentId:0}),t.stop()})),ja.set(205,(async e=>{const t=new $a(205,"Fixing mailing lists"),n=await e.filters.where("[accountId+path]").between(["Mailing Lists",""],["Mailing Lists","￿"]).primaryKeys();0!==n.length&&(await e.filteringQueue.add({priority:20,type:"RE_RUN_SLES",filterIds:n,runMailingLists:!0}),t.stop())})),m.Z.version(206).stores({hasRaw:["[searchListId+accountId]","accountId","searchListId","[hasRaw+accountId+sentDate+searchListId]"].join(",")}),ja.set(206,(async e=>{const t=new $a(206,"Updating raw status");t.total=2*await e.searchList.count();const n=new Map;await e.searchList.each((({id:e,sentDate:a})=>{n.set(e,a),t.count++})),await e.hasRaw.toCollection().modify((e=>{e.sentDate=n.get(e.searchListId),t.count++})),t.stop()})),ja.set(208,(async e=>{const t=new $a(208,"Update account root filter");await e.filters.toCollection().modify((e=>{e.path===D.ym&&([D.Sp,D.of,D.Ry,D.u4,D.MN,D.ut,D.wC,D.Kz].includes(e.accountId)||["showReadButton","showCustomFolderButton","showMailingListsButton","showArchivedButton","showJunkButton","showDeletedButton"].forEach((t=>{delete e.filterValue[t]})))})),t.stop()})),ja.set(210,(async e=>{const t=new $a(210,"Fixing message sources");t.total=await e.searchList.count(),await e.searchList.toCollection().modify((e=>{e.sourceFilterIds=[...e.sources.keys()],t.count++})),t.stop()})),ja.set(211,(async e=>{const t=new $a(211,"Migrate Feed Paths");await e.systemTasks.add({taskName:"migrate_feed_paths"}),t.stop()})),ja.set(212,(async e=>{const t=new $a(212,"Removing internal folders from accounts");await e.accounts.toCollection().modify((e=>{for(const t in e.folders)e.folders[t]=e.folders[t].filter((e=>!0!==e.internal&&(delete e.internal,!0)))})),t.stop()})),ja.set(213,(async e=>{const t=new $a(213,"Cleaning up IMAP folders that have been deleted on the server"),n=new Map;await e.accounts.each((({accountId:e,folders:t})=>{const a=new Set;for(const e in t){const n=t[e];for(const{path:e}of n)a.add(e)}n.set(e,a)}));const a=new Map,s=[],i=[];if(await e.filters.each((e=>{const{id:t,accountId:r,path:o}=e;if("VIVALDI_RESERVED_DUMMY_ROOT_PLACEHOLDER_PATH"===o)return;const c=n.get(r);c&&(a.set(t,e),c.has(o)||(s.push(t),i.push(e)))})),0===s.length)return void t.stop();const r=[],o=new Set,c=[],l=new Set(s),d=new Map,u=[],h=await e.searchList.where("sourceFilterIds").anyOf(s).toArray();if(0===h.length)return void t.stop();const f=new Set;await e.hasRaw.where("searchListId").anyOf(h.map((({id:e})=>e))).each((({searchListId:e,hasRaw:t})=>{1===t&&f.add(e)}));for(const{id:e,sources:t}of h){const n=i.filter((({id:e})=>t.has(e)));if(n.length===t.size)if(f.has(e)){for(const{id:a,accountId:s,path:i}of n)t.get(a).internal=!0,l.delete(a),c.push([s,i,e]);d.set(e,t)}else r.push(e);else{for(const s of n){const{id:n,accountId:i,path:r}=s;t.delete(n),c.push([i,r,e]),[...t.keys()].some((e=>a.get(e)?.accountId===i))||u.push([e,i])}d.set(e,t),o.add(e)}}t.total=d.size+r.length+c.length+u.length+o.size,d.size>0&&await e.searchList.where("id").anyOf([...d.keys()]).modify((e=>{const n=d.get(e.id);n&&(e.sources=n,e.sourceFilterIds=[...n.keys()]),t.count++})),r.length>0&&(e.searchList.where("id").anyOf(r).delete(),e.messages.where("id").anyOf(r).delete(),e.threading.where("id").anyOf(r).delete(),e.imap.where("searchListId").anyOf(r).delete(),e.hasRaw.where("searchListId").anyOf(r).delete(),e.viewIds.where("searchListId").anyOf(r).delete(),e.systemTasks.add({taskName:"delete_full_text_search_entries",currentPosition:0,searchListIds:r}),t.count+=r.length),c.length>0&&(await e.imap.where("[accountId+path+searchListId]").anyOf(c).delete(),t.count+=c.length);const p=[];if(u.length>0&&await e.hasRaw.where("[searchListId+accountId]").anyOf(u).modify((function(e){const{hasRaw:n,searchListId:a,accountId:s,sentDate:i}=e;1===n&&p.push({searchListId:a,accountId:s,sentDate:i}),delete this.value,t.count++})),p.length>0&&e.systemTasks.add({taskName:"delete_raw_from_disk",fileKeys:p}),l.size>0&&(await e.filters.where("id").anyOf(l).delete(),o.size>0)){const n=new Set,a=[0,1,2,3,4,5,6,7,8],s=100;for(const e of l)for(const t of a)n.add(e*s+t);await e.viewIds.where("searchListId").anyOf([...o]).modify((e=>{e.viewIds=e.viewIds.filter((e=>!n.has(e))),t.count++}))}t.stop()})),ja.set(214,(async e=>{const t=new $a(214,"Fix dangling entries in deletedFeedItems table");await e.deletedFeedItems.toCollection().modify((e=>{if(e.path){const t=e.path.lastIndexOf("/");t>-1&&(e.path=e.path.substring(t+1))}})),t.stop()})),ja.set(215,(async e=>{const t=new $a(215,"Clear extra feed filters from filters table"),n=await Pa.Z.waitFor((()=>R.Z.prefs.get(C.kRssSettings))),a=await e.filters.where("[accountId+path]").between([D.u4,""],[D.u4,"￿"]).toArray(),s=[];for(const e of a){const t=e.path.match(D.pG);if(t){const a=t[0];if(e.path===a||e.path.endsWith("/"+a)){n.some((e=>e.path===a||e.feedId===a))||s.push(e.id)}}}s.length>0&&await e.filters.bulkDelete(s),t.stop()})),ja.set(216,(async e=>{const t=new $a(216,"Move values in path attribute of deletedFeedItems to feedId attribute");await e.deletedFeedItems.toCollection().modify((e=>{e.path&&(e.feedId=e.path,delete e.path)})),t.stop()})),ja.set(217,(async e=>{const t=new $a(217,"Initialize label order based on current label filters");function n(e){return e.startsWith("$label")&&!e.startsWith("$labelviv")}function a(e,t){const n=e.toLowerCase(),a=t.toLowerCase();return n<a?-1:n>a?1:0}const s=await Pa.Z.waitFor((()=>R.Z.prefs.get(C.kMailLabelItemsOrder)))||[],i=[D.ut,""],r=[D.ut,"￿"],o=(await e.filters.where("[accountId+path]").between(i,r).toArray()).filter((e=>e.path!==D.ym));if(!s||s.length!==o.length){const e=o.sort((function(e,t){return n(e.path)&&n(t.path)?a((0,Zn.kF)(e.path),(0,Zn.kF)(t.path)):n(e.path)?-1:n(t.path)?1:function(e,t){return a(e.name,t.name)}(e,t)})).map((e=>e.path)),t=[];e.forEach((e=>{s.includes(e)||t.push(e)})),await Pa.Z.waitFor((()=>R.Z.prefs.set({path:C.kMailLabelItemsOrder,value:[...s,...t]})))}t.stop()})),ja.set(218,(async e=>{const t=new $a(218,"Split up messages sent to self into Received and Sent copies"),n=await e.accounts.toArray(),a=[];for(const e of n)for(const t of e.folders.Sent)a.push({accountId:e.accountId,path:t.path});const s=(await e.filters.toArray()).filter((e=>a.some((t=>t.accountId===e.accountId&&t.path===e.path)))),i=s.map((e=>e.id)),r=await e.searchList.where("sourceFilterIds").anyOf(i).toArray();t.total=r.length;const o=[];for(const n of r)if(t.count++,n.sourceFilterIds.length>1){const t=n.sourceFilterIds.filter((e=>i.includes(e)));if(n.sourceFilterIds.length>t.length){const a=await e.messages.get(n.id),i=await e.threading.get(n.id),r=await e.viewIds.get(n.id),c=await e.imap.where("searchListId").equals(n.id).toArray();for(const l of t){const t=s.find((e=>e.id===l));if(!t)continue;const d=n.sources.get(l);if(!d)continue;const u=new Map;u.set(l,d),n.sources.delete(l);const h=n.sourceFilterIds.indexOf(l);h>-1&&n.sourceFilterIds.splice(h,1);const f={...(0,za.Z)(n,"id"),sourceFilterIds:[l],sources:u},p=(0,za.Z)(a,"id"),g=(0,za.Z)(i,"id"),m=await e.searchList.add(f);await e.messages.add(p),await e.threading.add(g),await e.searchList.update(n.id,n);const w=c.filter((e=>e.accountId===t.accountId&&e.path===t.path));for(const t of w)await e.imap.update([t.accountId,t.path,t.uid],{searchListId:m});const _={searchListId:m,accountId:t.accountId,hasRaw:0,sentDate:n.sentDate};await e.hasRaw.add(_);const b={searchListId:m,viewIds:r.viewIds};await e.viewIds.add(b),o.push(n.id),o.push(m),await e.systemTasks.add({taskName:"copy_raw",sourceId:m,targetId:n.id})}}}o.length>0&&await e.filteringQueue.add({type:"RE_RUN_SLES",priority:D.Un.HIGH,searchListIds:o}),t.stop()})),ja.set(222,(async e=>{const t=[D.ut,""],n=[D.ut,"￿"],a=await e.filters.where("[accountId+path]").between(t,n).toArray();if(a!==await Pa.Z.waitFor((()=>R.Z.prefs.get(C.kMailLabelItemsOrder)))){const e=a.sort((function(e,t){if(s(e.path)&&s(t.path))return i((0,Zn.kF)(e.path),(0,Zn.kF)(t.path));if(s(e.path))return-1;if(s(t.path))return 1;return function(e,t){return i(e.name,t.name)}(e,t)})).map((({path:e})=>e)).filter((e=>e!==D.ym));await Pa.Z.waitFor((()=>R.Z.prefs.set({path:C.kMailLabelItemsOrder,value:e})))}function s(e){return e.startsWith("$label")&&!e.startsWith("$labelviv")}function i(e,t){const n=e.toLowerCase(),a=t.toLowerCase();return n<a?-1:n>a?1:0}})),ja.set(223,(async e=>{const t=new $a(223,"Add filter entry for Trash folder under Feeds"),n={name:D.cm,accountId:D.u4,path:D.cm,filterValue:{include:[[{accountId:D.u4},{folder:D.uT}]],showReadButton:!1,showDeletedButton:!1,showMailingListsButton:!1,showJunkButton:!1,showFeedsButton:!1,showCustomFolderButton:!1,showArchivedButton:!1}};e.filters.add(n),t.stop()})),ja.set(224,(async e=>{const t=new $a(224,"Modify filter for All Accounts root folder");e.filters.where("[accountId+path]").equals(["All Accounts","VIVALDI_RESERVED_DUMMY_ROOT_PLACEHOLDER_PATH"]).modify((e=>e.filterValue.showSubFolders=!0)),t.stop()})),ja.forEach(((e,t)=>m.Z.version(t).upgrade((async n=>{try{await e(n),await n._upgrades.add({version:t})}catch(e){throw b.Z.error("Mail",["Upgrade",""+t],e),e}})))),m.Z.on("ready",(async()=>{const e=await m.Z._upgrades.toCollection().last();let t=[...ja.keys()];e&&(t=t.filter((t=>t>e.version))),t.sort(((e,t)=>e-t));for(const e of t){const t=ja.get(e);t&&await m.Z.transaction("rw",m.Z.tables,(n=>t(n).then((()=>n._upgrades.add({version:e})))))}}));const Qa=m.Z;var Va=n(87192),qa=n(24600);function Ha(e){if(0===e.length)throw new Error("raceToResolve: Need an array with at least one Promise.");let t;return new Promise(((n,a)=>Promise.all(e.map((e=>e.then(n).catch((e=>t=e))))).then((()=>a(t)))))}var Ka=n(16932);const{OK:Wa,ERROR:Ga,OFFLINE:Ya}=D.In;async function Xa(e){try{let t;if(e.useOAuth){const n=await Ln(e);t=hn(e,n)}else t=hn(e);await new Promise(((e,n)=>{t.onError=n,t.login().then((()=>t.logout())).then(e).catch(n)}))}catch(t){throw new Error((0,u.Z)("Login for $1 failed. $2",[e.MAIL_SERVER,t.message]))}}async function Ja(e){try{await gt.verifyLogin(e)}catch(t){throw new Error((0,u.Z)("Login for $1 failed.",[e.MAIL_SERVER]))}}async function es(e){try{let t;if(e.useOAuth){const n=await Ln(e);t=(0,qa.Z)(e,n)}else t=(0,qa.Z)(e);await new Promise(((e,n)=>{t.onidle=t.quit,t.onerror=n,t.onclose=e,t.connect()}))}catch(t){throw e.useOAuth&&await(0,Mn.oy)(e.MAIL_EMAIL,(0,On.dn)(e),!0),new Error((0,u.Z)("Login for $1 failed.",[e.MAIL_SMTP_SERVER]))}}const ts=(e,t=!1)=>{const[n,a,s,i]=t?[e.MAIL_SMTP_PORT,e.MAIL_SMTP_SERVER,e.MAIL_SMTP_USER,e.MAIL_SMTP_PASSWORD]:[e.MAIL_PORT,e.MAIL_SERVER,e.MAIL_USER,e.MAIL_PASSWORD];if(!n||"number"!=typeof n)throw new Error(t?(0,u.Z)("Outgoing port is missing or not a number"):(0,u.Z)("Incoming port is missing or not a number"));if(!a)throw new Error(t?(0,u.Z)("Outgoing server information is missing"):(0,u.Z)("Incoming server information is missing"));if(!e.useOAuth){if(!s)throw new Error(t?(0,u.Z)("Outgoing username is missing"):(0,u.Z)("Incoming username is missing"));if(!i)throw new Error(t?(0,u.Z)("Outgoing password is missing"):(0,u.Z)("Incoming password is missing"))}},ns=(e,t,n,a,s)=>new Promise(((s,i)=>{const r=$.Z.open(e,t,{useSecureTransport:"ssl"===n});r.onerror=i,r.onopen=()=>{r.close(),s("MAIL_SMTP_SERVER"===a?{MAIL_SMTP_SERVER:e,MAIL_SMTP_PORT:t,MAIL_SMTP_SOCKET_TYPE:n}:{MAIL_SERVER:e,MAIL_PORT:t})}})),as=(e,t)=>{const n={...e,MAIL_SMTP_USER:t};return es(n).then((()=>[Wa,"Outgoing connection success",n])).catch((t=>{throw[Ga,t.message,e]}))},ss=async(e,t,n)=>{const a=await rs(t);return a?is(e,a,n):Promise.reject(`No MX record found for ${t}`)},is=(e,t,n)=>{const a=[`https://autoconfig.${t}/mail/config-v1.1.xml?emailaddress=${e.MAIL_EMAIL}`,`https://autoconfig.vivaldi.net/v1.1/${t}`,`https://${t}/.well-known/autoconfig/mail/config-v1.1.xml?emailaddress=${e.MAIL_EMAIL}`],s="pop"===n?"pop3":n;return Ha(a.map((t=>os(e,s,t))))},rs=async e=>{const t=await fetch(`https://autoconfig.vivaldi.net/mxlookup?domain=${e}`);if(t.ok){const e=await t.json();if(e&&e[0]?.target){return ds(e[0]?.target)}}},os=async(e,t,n)=>{const a=await fetch(n);if(!a.ok)throw new Error("autodiscover: Error looking up in autoconfig");try{const n=await a.text(),s=new Ka.XMLParser({ignoreAttributes:!1}).parse(n),{emailProvider:i}=s.clientConfig,{outgoingServer:r,incomingServer:o}=i,c=Array.isArray(o)?o:[o],l=Array.isArray(r)?r:[r];let d,u,h,f,p;for(const e of c)if("protonmail.com"===i.domain&&(e.socketType="ssl"),e["@_type"]===t&&"ssl"===e.socketType.toLowerCase()){d=e.hostname,u=e.port;break}for(const e of l){"protonmail.com"===i.domain&&(e.socketType="ssl");const t=e.socketType.toLowerCase();if("smtp"===e["@_type"]&&"plain"!==t){("ssl"===t||"starttls"===t&&!h)&&(h=e.hostname),f=e.port,p=t;break}}if(!(d&&u&&h&&f&&p))throw new Error("autodiscover: Missing Outgoing or Incoming Server/Port information");const g={...e,MAIL_SERVER:d,MAIL_PORT:Number(u),MAIL_SMTP_SERVER:h,MAIL_SMTP_PORT:Number(f),MAIL_SMTP_SOCKET_TYPE:"ssl"===p?"ssl":"starttls"};return[Wa,g]}catch(e){throw new Error(`autodiscover: ${e}`)}},cs=async(e,t,n,a)=>{const s=await rs(t);return s?ls(e,s,n,a):[Ga,e]},ls=(e,t,n,a)=>{const s=[`${n}.${t}`,`mail.${t}`,`${n}.mail.${t}`],i=[`smtp.${t}`,`mail.${t}`,`smtp.mail.${t}`];let r,o;return Promise.race([new Promise((e=>setTimeout(e,1e4))),Promise.allSettled([Ha([...s.map((e=>ns(e,a,"ssl","MAIL_SERVER")))]).then((e=>{r=e})),new Promise((e=>Promise.allSettled([Ha([...i.map((e=>ns(e,465,"ssl","MAIL_SMTP_SERVER")))]).then((t=>{o=t,e()})),Ha([...i.map((e=>ns(e,587,"starttls","MAIL_SMTP_SERVER")))]).then((e=>{o||(o=e)}))]).then(e)))])]).then((()=>{const t={...e,...r,...o};return[["MAIL_SERVER","MAIL_PORT","MAIL_SMTP_SERVER","MAIL_SMTP_PORT","MAIL_SMTP_SOCKET_TYPE"].every((e=>t[e]))?Wa:Ga,t]}))},ds=e=>{let t=e;if(null!=e){var n=e.split(".").reverse();null!=n&&n.length>1&&(t=n[1]+"."+n[0],-1!==e.toLowerCase().indexOf(".co.uk")&&n.length>2&&(t=n[2]+"."+t))}return t.toLowerCase()};var us=n(47482);let hs=!1;const fs=x.Z.adjustBatchSize.bind(void 0,100,1e3,500);let ps=100;async function gs(){const e=await m.Z.flaggingQueue.toCollection().first();if(!e)return;let{id:t,searchListIds:n,sourcesPerSle:a,flagUpdates:s}=e;for(a instanceof Map||(console.warn("flagging.js: Invalid entry in flaggingQueue table"),a=new Map);n.length>0;){const e=n.splice(0,ps),i=Date.now(),r=e.map((e=>({searchListId:e,sources:a.get(e)||new Map})));await m.Z.transaction("rw",[m.Z.searchList,m.Z.filteringQueue,m.Z.flaggingQueue,m.Z.buffer,m.Z.imap],(async()=>{const i=await us.Z.call(r,s);z.QO.updateIndex({sleUpdates:i}),await v.Z.addCustomFlags(e,a,s),nn.call();const o={id:t,searchListIds:n,sourcesPerSle:a,flagUpdates:s};await m.Z.flaggingQueue.put(o)}));const o=Date.now();ps=fs(ps,o-i),ye.filter()}await m.Z.flaggingQueue.delete(t),await gs()}Qa.open();const ms={updateThreads:De.updateThreads,start:async function(){await Promise.all([xn(),w.Z.initFilters(),E.Z.initFolders(),Oe(),se.Z.initMailingLists()]),a.Z.addListener(C.kMailImapLogsOn,Ra.toggleImapLogging)},stop:function(){a.Z.removeListener(C.kMailImapLogsOn,Ra.toggleImapLogging),void 0!==In&&In("Clearing UID sequence sets."),kn(),En={},w.Z.clear(),se.Z.clear(),Se(),xe={level:0,children:new Map},h.Z.clear()},addAccount:async function(e){const t=e.MAIL_EMAIL,{accountType:n,offline:a}=e,s=n===D.s9.POP,i=n===D.s9.IMAP;if(!s&&!i)throw new Error(`Trying to add account ${t} of unsupported type ${n}`);const l=s||a?c.Z.getDefaultFolders():{},d=await r.Z.add(t,l);await h.Z.addAccounts({[t]:d});const u=await o.Z.foldersToFilters(t,l);w.Z.updateFilters(u)},flushBuffer:nn.call,updateFlags:async function(){if(!hs){hs=!0;try{await gs()}finally{hs=!1}}},runSystemTasks:async function(){const e=await m.Z.systemTasks.toArray();for(const t of e)await $t(t)},getOAuthAccessToken:Mn.$z,fetchAccessTokenAndRefreshToken:Mn.oy,verify:async function(e){await(async e=>(ts(e,!0),es(e)))(e),await(async e=>{ts(e,!1),e.accountType===D.s9.IMAP?await Xa(e):await Ja(e)})(e)},autofill:async function(e){if(!Va.Z.isValidEmail(e))return[Ga,e];const t=e.MAIL_EMAIL,n=e.MAIL_EMAIL&&t.split("@")[1];let a="imap",s=993;return e.accountType===D.s9.POP&&(a="pop",s=995),Ha([is(e,n,a),ss(e,n,a)]).catch((()=>{let t;return new Promise((i=>Promise.allSettled([ls(e,n,a,s).then((e=>{e[0]===Wa&&i(e),t||(t=e)})),cs(e,n,a,s).then((e=>{e[0]===Wa&&i(e),t||(t=e)}))]).then((()=>i(t)))))})).then((e=>e))},signIn:async function(e){if(e.offline)return[Ya,"offline",e];e.MAIL_PORT||(e.MAIL_PORT=e.accountType===D.s9.IMAP?993:995),e.MAIL_SMTP_PORT||(e.MAIL_SMTP_PORT=465);try{ts(e,!1),ts(e,!0)}catch(t){return[Ga,t.message,e]}if(e.useOAuth)try{return await as(e,e.MAIL_EMAIL)}catch(e){return e}const t=[e.MAIL_USER],n=[e.MAIL_SMTP_USER];if(e.MAIL_EMAIL===e.MAIL_USER&&e.MAIL_EMAIL===e.MAIL_SMTP_USER&&e.MAIL_EMAIL.includes("@")){const a=e.MAIL_EMAIL.split("@")[0];t.push(a),n.push(a)}const a=await Promise.allSettled([Ha(n.map((t=>as(e,t)))),Ha(t.map((t=>(async(e,t)=>{const n={...e,MAIL_USER:t};try{return e.accountType===D.s9.IMAP?(await Xa(n),[Wa,"Incoming connection success",n]):(await Ja(e),[Wa,"Incoming connection success",n])}catch(t){throw[Ga,t.message,e,[]]}})(e,t))))]);let s={...e},i=Wa,r="";for(const e of a)e.reason?(i=Ga,r=e.reason[1],s={...s,...e.reason[2]}):e.value&&(s={...s,...e.value[2]});return[i,r,s]}};function ws(e){if(e.origin!==re.oP)return;const{background:t}=e.data;if(t){const{promiseId:n,func:a,args:s=[]}=t;Promise.resolve().then((()=>ms[a](...s))).then((t=>{e.source.postMessage({background:{promiseId:n,results:t}})})).catch((t=>{t=t.message||t,e.source.postMessage({background:{promiseId:n,error:t}})}))}}self.addEventListener("install",(e=>{self.skipWaiting()}));let _s=!1;!async function(){_s||(_s=!0,self.addEventListener("message",ws,!1),await Promise.all([a.Z.loadPromise(),s.Z.loadPromise(),i.Z.loadPromise()]))}()},44983:()=>{!function(e){var t={};function n(a){if(t[a])return t[a].exports;var s=t[a]={i:a,l:!1,exports:{}};return e[a].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(a,s,function(t){return e[t]}.bind(null,s));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=11)}([function(e,t,n){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t,n){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t,n){"use strict";var a="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function s(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var a in n)s(n,a)&&(e[a]=n[a])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={arraySet:function(e,t,n,a,s){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+a),s);else for(var i=0;i<a;i++)e[s+i]=t[n+i]},flattenChunks:function(e){var t,n,a,s,i,r;for(a=0,t=0,n=e.length;t<n;t++)a+=e[t].length;for(r=new Uint8Array(a),s=0,t=0,n=e.length;t<n;t++)i=e[t],r.set(i,s),s+=i.length;return r}},r={arraySet:function(e,t,n,a,s){for(var i=0;i<a;i++)e[s+i]=t[n+i]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,i)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,r))},t.setTyped(a)},function(e,t,n){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t,n){"use strict";var a,s=n(2),i=n(8),r=n(6),o=n(7),c=n(1),l=-2,d=258,u=262,h=103,f=113,p=666;function g(e,t){return e.msg=c[t],t}function m(e){return(e<<1)-(e>4?9:0)}function w(e){for(var t=e.length;--t>=0;)e[t]=0}function _(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(s.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function b(e,t){i._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,_(e.strm)}function y(e,t){e.pending_buf[e.pending++]=t}function v(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function I(e,t){var n,a,s=e.max_chain_length,i=e.strstart,r=e.prev_length,o=e.nice_match,c=e.strstart>e.w_size-u?e.strstart-(e.w_size-u):0,l=e.window,h=e.w_mask,f=e.prev,p=e.strstart+d,g=l[i+r-1],m=l[i+r];e.prev_length>=e.good_match&&(s>>=2),o>e.lookahead&&(o=e.lookahead);do{if(l[(n=t)+r]===m&&l[n+r-1]===g&&l[n]===l[i]&&l[++n]===l[i+1]){i+=2,n++;do{}while(l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&i<p);if(a=d-(p-i),i=p-d,a>r){if(e.match_start=t,r=a,a>=o)break;g=l[i+r-1],m=l[i+r]}}}while((t=f[t&h])>c&&0!=--s);return r<=e.lookahead?r:e.lookahead}function E(e){var t,n,a,i,c,l,d,h,f,p,g=e.w_size;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=g+(g-u)){s.arraySet(e.window,e.window,g,g,0),e.match_start-=g,e.strstart-=g,e.block_start-=g,t=n=e.hash_size;do{a=e.head[--t],e.head[t]=a>=g?a-g:0}while(--n);t=n=g;do{a=e.prev[--t],e.prev[t]=a>=g?a-g:0}while(--n);i+=g}if(0===e.strm.avail_in)break;if(l=e.strm,d=e.window,h=e.strstart+e.lookahead,f=i,p=void 0,(p=l.avail_in)>f&&(p=f),n=0===p?0:(l.avail_in-=p,s.arraySet(d,l.input,l.next_in,p,h),1===l.state.wrap?l.adler=r(l.adler,d,p,h):2===l.state.wrap&&(l.adler=o(l.adler,d,p,h)),l.next_in+=p,l.total_in+=p,p),e.lookahead+=n,e.lookahead+e.insert>=3)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=(e.ins_h<<e.hash_shift^e.window[c+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[c+3-1])&e.hash_mask,e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<u&&0!==e.strm.avail_in)}function k(e,t){for(var n,a;;){if(e.lookahead<u){if(E(e),e.lookahead<u&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-u&&(e.match_length=I(e,n)),e.match_length>=3)if(a=i._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else a=i._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(a&&(b(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(b(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(b(e,!1),0===e.strm.avail_out)?1:2}function x(e,t){for(var n,a,s;;){if(e.lookahead<u){if(E(e),e.lookahead<u&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-u&&(e.match_length=I(e,n),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-3,a=i._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=s&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,a&&(b(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((a=i._tr_tally(e,0,e.window[e.strstart-1]))&&b(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(a=i._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(b(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(b(e,!1),0===e.strm.avail_out)?1:2}function A(e,t,n,a,s){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=a,this.func=s}function S(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(1146),this.dyn_dtree=new s.Buf16(122),this.bl_tree=new s.Buf16(78),w(this.dyn_ltree),w(this.dyn_dtree),w(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(16),this.heap=new s.Buf16(573),w(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(573),w(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function M(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:f,e.adler=2===t.wrap?0:1,t.last_flush=0,i._tr_init(t),0):g(e,l)}function O(e){var t,n=M(e);return 0===n&&((t=e.state).window_size=2*t.w_size,w(t.head),t.max_lazy_match=a[t.level].max_lazy,t.good_match=a[t.level].good_length,t.nice_match=a[t.level].nice_length,t.max_chain_length=a[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),n}function L(e,t,n,a,i,r){if(!e)return l;var o=1;if(-1===t&&(t=6),a<0?(o=0,a=-a):a>15&&(o=2,a-=16),i<1||i>9||8!==n||a<8||a>15||t<0||t>9||r<0||r>4)return g(e,l);8===a&&(a=9);var c=new S;return e.state=c,c.strm=e,c.wrap=o,c.gzhead=null,c.w_bits=a,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=i+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+3-1)/3),c.window=new s.Buf8(2*c.w_size),c.head=new s.Buf16(c.hash_size),c.prev=new s.Buf16(c.w_size),c.lit_bufsize=1<<i+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new s.Buf8(c.pending_buf_size),c.d_buf=1*c.lit_bufsize,c.l_buf=3*c.lit_bufsize,c.level=t,c.strategy=r,c.method=n,O(e)}a=[new A(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(E(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var a=e.block_start+n;if((0===e.strstart||e.strstart>=a)&&(e.lookahead=e.strstart-a,e.strstart=a,b(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-u&&(b(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(b(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(b(e,!1),e.strm.avail_out),1)})),new A(4,4,8,4,k),new A(4,5,16,8,k),new A(4,6,32,32,k),new A(4,4,16,16,x),new A(8,16,32,32,x),new A(8,16,128,128,x),new A(8,32,128,256,x),new A(32,128,258,1024,x),new A(32,258,258,4096,x)],t.deflateInit=function(e,t){return L(e,t,8,15,8,0)},t.deflateInit2=L,t.deflateReset=O,t.deflateResetKeep=M,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?l:(e.state.gzhead=t,0):l},t.deflate=function(e,t){var n,s,r,c;if(!e||!e.state||t>5||t<0)return e?g(e,l):l;if(s=e.state,!e.output||!e.input&&0!==e.avail_in||s.status===p&&4!==t)return g(e,0===e.avail_out?-5:l);if(s.strm=e,n=s.last_flush,s.last_flush=t,42===s.status)if(2===s.wrap)e.adler=0,y(s,31),y(s,139),y(s,8),s.gzhead?(y(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),y(s,255&s.gzhead.time),y(s,s.gzhead.time>>8&255),y(s,s.gzhead.time>>16&255),y(s,s.gzhead.time>>24&255),y(s,9===s.level?2:s.strategy>=2||s.level<2?4:0),y(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(y(s,255&s.gzhead.extra.length),y(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=o(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69):(y(s,0),y(s,0),y(s,0),y(s,0),y(s,0),y(s,9===s.level?2:s.strategy>=2||s.level<2?4:0),y(s,3),s.status=f);else{var u=8+(s.w_bits-8<<4)<<8;u|=(s.strategy>=2||s.level<2?0:s.level<6?1:6===s.level?2:3)<<6,0!==s.strstart&&(u|=32),u+=31-u%31,s.status=f,v(s,u),0!==s.strstart&&(v(s,e.adler>>>16),v(s,65535&e.adler)),e.adler=1}if(69===s.status)if(s.gzhead.extra){for(r=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>r&&(e.adler=o(e.adler,s.pending_buf,s.pending-r,r)),_(e),r=s.pending,s.pending!==s.pending_buf_size));)y(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>r&&(e.adler=o(e.adler,s.pending_buf,s.pending-r,r)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=73)}else s.status=73;if(73===s.status)if(s.gzhead.name){r=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>r&&(e.adler=o(e.adler,s.pending_buf,s.pending-r,r)),_(e),r=s.pending,s.pending===s.pending_buf_size)){c=1;break}c=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,y(s,c)}while(0!==c);s.gzhead.hcrc&&s.pending>r&&(e.adler=o(e.adler,s.pending_buf,s.pending-r,r)),0===c&&(s.gzindex=0,s.status=91)}else s.status=91;if(91===s.status)if(s.gzhead.comment){r=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>r&&(e.adler=o(e.adler,s.pending_buf,s.pending-r,r)),_(e),r=s.pending,s.pending===s.pending_buf_size)){c=1;break}c=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,y(s,c)}while(0!==c);s.gzhead.hcrc&&s.pending>r&&(e.adler=o(e.adler,s.pending_buf,s.pending-r,r)),0===c&&(s.status=h)}else s.status=h;if(s.status===h&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&_(e),s.pending+2<=s.pending_buf_size&&(y(s,255&e.adler),y(s,e.adler>>8&255),e.adler=0,s.status=f)):s.status=f),0!==s.pending){if(_(e),0===e.avail_out)return s.last_flush=-1,0}else if(0===e.avail_in&&m(t)<=m(n)&&4!==t)return g(e,-5);if(s.status===p&&0!==e.avail_in)return g(e,-5);if(0!==e.avail_in||0!==s.lookahead||0!==t&&s.status!==p){var I=2===s.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(E(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,n=i._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(b(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(b(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(b(e,!1),0===e.strm.avail_out)?1:2}(s,t):3===s.strategy?function(e,t){for(var n,a,s,r,o=e.window;;){if(e.lookahead<=d){if(E(e),e.lookahead<=d&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(a=o[s=e.strstart-1])===o[++s]&&a===o[++s]&&a===o[++s]){r=e.strstart+d;do{}while(a===o[++s]&&a===o[++s]&&a===o[++s]&&a===o[++s]&&a===o[++s]&&a===o[++s]&&a===o[++s]&&a===o[++s]&&s<r);e.match_length=d-(r-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=i._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=i._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(b(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(b(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(b(e,!1),0===e.strm.avail_out)?1:2}(s,t):a[s.level].func(s,t);if(3!==I&&4!==I||(s.status=p),1===I||3===I)return 0===e.avail_out&&(s.last_flush=-1),0;if(2===I&&(1===t?i._tr_align(s):5!==t&&(i._tr_stored_block(s,0,0,!1),3===t&&(w(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),_(e),0===e.avail_out))return s.last_flush=-1,0}return 4!==t?0:s.wrap<=0?1:(2===s.wrap?(y(s,255&e.adler),y(s,e.adler>>8&255),y(s,e.adler>>16&255),y(s,e.adler>>24&255),y(s,255&e.total_in),y(s,e.total_in>>8&255),y(s,e.total_in>>16&255),y(s,e.total_in>>24&255)):(v(s,e.adler>>>16),v(s,65535&e.adler)),_(e),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?0:1)},t.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&t!==h&&t!==f&&t!==p?g(e,l):(e.state=null,t===f?g(e,-3):0):l},t.deflateSetDictionary=function(e,t){var n,a,i,o,c,d,u,h,f=t.length;if(!e||!e.state)return l;if(2===(o=(n=e.state).wrap)||1===o&&42!==n.status||n.lookahead)return l;for(1===o&&(e.adler=r(e.adler,t,f,0)),n.wrap=0,f>=n.w_size&&(0===o&&(w(n.head),n.strstart=0,n.block_start=0,n.insert=0),h=new s.Buf8(n.w_size),s.arraySet(h,t,f-n.w_size,n.w_size,0),t=h,f=n.w_size),c=e.avail_in,d=e.next_in,u=e.input,e.avail_in=f,e.next_in=0,e.input=t,E(n);n.lookahead>=3;){a=n.strstart,i=n.lookahead-2;do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[a+3-1])&n.hash_mask,n.prev[a&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=a,a++}while(--i);n.strstart=a,n.lookahead=2,E(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=d,e.input=u,e.avail_in=c,n.wrap=o,0},t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t,n){"use strict";var a=n(2),s=n(6),i=n(7),r=n(9),o=n(10),c=-2,l=12,d=30;function u(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function h(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new a.Buf16(320),this.work=new a.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function f(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new a.Buf32(852),t.distcode=t.distdyn=new a.Buf32(592),t.sane=1,t.back=-1,0):c}function p(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,f(e)):c}function g(e,t){var n,a;return e&&e.state?(a=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?c:(null!==a.window&&a.wbits!==t&&(a.window=null),a.wrap=n,a.wbits=t,p(e))):c}function m(e,t){var n,a;return e?(a=new h,e.state=a,a.window=null,0!==(n=g(e,t))&&(e.state=null),n):c}var w,_,b=!0;function y(e){if(b){var t;for(w=new a.Buf32(512),_=new a.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(o(1,e.lens,0,288,w,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;o(2,e.lens,0,32,_,0,e.work,{bits:5}),b=!1}e.lencode=w,e.lenbits=9,e.distcode=_,e.distbits=5}function v(e,t,n,s){var i,r=e.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new a.Buf8(r.wsize)),s>=r.wsize?(a.arraySet(r.window,t,n-r.wsize,r.wsize,0),r.wnext=0,r.whave=r.wsize):((i=r.wsize-r.wnext)>s&&(i=s),a.arraySet(r.window,t,n-s,i,r.wnext),(s-=i)?(a.arraySet(r.window,t,n-s,s,0),r.wnext=s,r.whave=r.wsize):(r.wnext+=i,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=i))),0}t.inflateReset=p,t.inflateReset2=g,t.inflateResetKeep=f,t.inflateInit=function(e){return m(e,15)},t.inflateInit2=m,t.inflate=function(e,t){var n,h,f,p,g,m,w,_,b,I,E,k,x,A,S,M,O,L,Z,N,T,R,P,C,F=0,U=new a.Buf8(4),D=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return c;(n=e.state).mode===l&&(n.mode=13),g=e.next_out,f=e.output,w=e.avail_out,p=e.next_in,h=e.input,m=e.avail_in,_=n.hold,b=n.bits,I=m,E=w,R=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;b<16;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(2&n.wrap&&35615===_){n.check=0,U[0]=255&_,U[1]=_>>>8&255,n.check=i(n.check,U,2,0),_=0,b=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&_)<<8)+(_>>8))%31){e.msg="incorrect header check",n.mode=d;break}if(8!=(15&_)){e.msg="unknown compression method",n.mode=d;break}if(b-=4,T=8+(15&(_>>>=4)),0===n.wbits)n.wbits=T;else if(T>n.wbits){e.msg="invalid window size",n.mode=d;break}n.dmax=1<<T,e.adler=n.check=1,n.mode=512&_?10:l,_=0,b=0;break;case 2:for(;b<16;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(n.flags=_,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=d;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=d;break}n.head&&(n.head.text=_>>8&1),512&n.flags&&(U[0]=255&_,U[1]=_>>>8&255,n.check=i(n.check,U,2,0)),_=0,b=0,n.mode=3;case 3:for(;b<32;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}n.head&&(n.head.time=_),512&n.flags&&(U[0]=255&_,U[1]=_>>>8&255,U[2]=_>>>16&255,U[3]=_>>>24&255,n.check=i(n.check,U,4,0)),_=0,b=0,n.mode=4;case 4:for(;b<16;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}n.head&&(n.head.xflags=255&_,n.head.os=_>>8),512&n.flags&&(U[0]=255&_,U[1]=_>>>8&255,n.check=i(n.check,U,2,0)),_=0,b=0,n.mode=5;case 5:if(1024&n.flags){for(;b<16;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}n.length=_,n.head&&(n.head.extra_len=_),512&n.flags&&(U[0]=255&_,U[1]=_>>>8&255,n.check=i(n.check,U,2,0)),_=0,b=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((k=n.length)>m&&(k=m),k&&(n.head&&(T=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),a.arraySet(n.head.extra,h,p,k,T)),512&n.flags&&(n.check=i(n.check,h,k,p)),m-=k,p+=k,n.length-=k),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===m)break e;k=0;do{T=h[p+k++],n.head&&T&&n.length<65536&&(n.head.name+=String.fromCharCode(T))}while(T&&k<m);if(512&n.flags&&(n.check=i(n.check,h,k,p)),m-=k,p+=k,T)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===m)break e;k=0;do{T=h[p+k++],n.head&&T&&n.length<65536&&(n.head.comment+=String.fromCharCode(T))}while(T&&k<m);if(512&n.flags&&(n.check=i(n.check,h,k,p)),m-=k,p+=k,T)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;b<16;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(_!==(65535&n.check)){e.msg="header crc mismatch",n.mode=d;break}_=0,b=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=l;break;case 10:for(;b<32;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}e.adler=n.check=u(_),_=0,b=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=g,e.avail_out=w,e.next_in=p,e.avail_in=m,n.hold=_,n.bits=b,2;e.adler=n.check=1,n.mode=l;case l:if(5===t||6===t)break e;case 13:if(n.last){_>>>=7&b,b-=7&b,n.mode=27;break}for(;b<3;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}switch(n.last=1&_,b-=1,3&(_>>>=1)){case 0:n.mode=14;break;case 1:if(y(n),n.mode=20,6===t){_>>>=2,b-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=d}_>>>=2,b-=2;break;case 14:for(_>>>=7&b,b-=7&b;b<32;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if((65535&_)!=(_>>>16^65535)){e.msg="invalid stored block lengths",n.mode=d;break}if(n.length=65535&_,_=0,b=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(k=n.length){if(k>m&&(k=m),k>w&&(k=w),0===k)break e;a.arraySet(f,h,p,k,g),m-=k,p+=k,w-=k,g+=k,n.length-=k;break}n.mode=l;break;case 17:for(;b<14;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(n.nlen=257+(31&_),_>>>=5,b-=5,n.ndist=1+(31&_),_>>>=5,b-=5,n.ncode=4+(15&_),_>>>=4,b-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=d;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;b<3;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}n.lens[D[n.have++]]=7&_,_>>>=3,b-=3}for(;n.have<19;)n.lens[D[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,P={bits:n.lenbits},R=o(0,n.lens,0,19,n.lencode,0,n.work,P),n.lenbits=P.bits,R){e.msg="invalid code lengths set",n.mode=d;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;M=(F=n.lencode[_&(1<<n.lenbits)-1])>>>16&255,O=65535&F,!((S=F>>>24)<=b);){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(O<16)_>>>=S,b-=S,n.lens[n.have++]=O;else{if(16===O){for(C=S+2;b<C;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(_>>>=S,b-=S,0===n.have){e.msg="invalid bit length repeat",n.mode=d;break}T=n.lens[n.have-1],k=3+(3&_),_>>>=2,b-=2}else if(17===O){for(C=S+3;b<C;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}b-=S,T=0,k=3+(7&(_>>>=S)),_>>>=3,b-=3}else{for(C=S+7;b<C;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}b-=S,T=0,k=11+(127&(_>>>=S)),_>>>=7,b-=7}if(n.have+k>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=d;break}for(;k--;)n.lens[n.have++]=T}}if(n.mode===d)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=d;break}if(n.lenbits=9,P={bits:n.lenbits},R=o(1,n.lens,0,n.nlen,n.lencode,0,n.work,P),n.lenbits=P.bits,R){e.msg="invalid literal/lengths set",n.mode=d;break}if(n.distbits=6,n.distcode=n.distdyn,P={bits:n.distbits},R=o(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,P),n.distbits=P.bits,R){e.msg="invalid distances set",n.mode=d;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(m>=6&&w>=258){e.next_out=g,e.avail_out=w,e.next_in=p,e.avail_in=m,n.hold=_,n.bits=b,r(e,E),g=e.next_out,f=e.output,w=e.avail_out,p=e.next_in,h=e.input,m=e.avail_in,_=n.hold,b=n.bits,n.mode===l&&(n.back=-1);break}for(n.back=0;M=(F=n.lencode[_&(1<<n.lenbits)-1])>>>16&255,O=65535&F,!((S=F>>>24)<=b);){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(M&&0==(240&M)){for(L=S,Z=M,N=O;M=(F=n.lencode[N+((_&(1<<L+Z)-1)>>L)])>>>16&255,O=65535&F,!(L+(S=F>>>24)<=b);){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}_>>>=L,b-=L,n.back+=L}if(_>>>=S,b-=S,n.back+=S,n.length=O,0===M){n.mode=26;break}if(32&M){n.back=-1,n.mode=l;break}if(64&M){e.msg="invalid literal/length code",n.mode=d;break}n.extra=15&M,n.mode=22;case 22:if(n.extra){for(C=n.extra;b<C;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}n.length+=_&(1<<n.extra)-1,_>>>=n.extra,b-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;M=(F=n.distcode[_&(1<<n.distbits)-1])>>>16&255,O=65535&F,!((S=F>>>24)<=b);){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(0==(240&M)){for(L=S,Z=M,N=O;M=(F=n.distcode[N+((_&(1<<L+Z)-1)>>L)])>>>16&255,O=65535&F,!(L+(S=F>>>24)<=b);){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}_>>>=L,b-=L,n.back+=L}if(_>>>=S,b-=S,n.back+=S,64&M){e.msg="invalid distance code",n.mode=d;break}n.offset=O,n.extra=15&M,n.mode=24;case 24:if(n.extra){for(C=n.extra;b<C;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}n.offset+=_&(1<<n.extra)-1,_>>>=n.extra,b-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=d;break}n.mode=25;case 25:if(0===w)break e;if(k=E-w,n.offset>k){if((k=n.offset-k)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=d;break}k>n.wnext?(k-=n.wnext,x=n.wsize-k):x=n.wnext-k,k>n.length&&(k=n.length),A=n.window}else A=f,x=g-n.offset,k=n.length;k>w&&(k=w),w-=k,n.length-=k;do{f[g++]=A[x++]}while(--k);0===n.length&&(n.mode=21);break;case 26:if(0===w)break e;f[g++]=n.length,w--,n.mode=21;break;case 27:if(n.wrap){for(;b<32;){if(0===m)break e;m--,_|=h[p++]<<b,b+=8}if(E-=w,e.total_out+=E,n.total+=E,E&&(e.adler=n.check=n.flags?i(n.check,f,E,g-E):s(n.check,f,E,g-E)),E=w,(n.flags?_:u(_))!==n.check){e.msg="incorrect data check",n.mode=d;break}_=0,b=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;b<32;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(_!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=d;break}_=0,b=0}n.mode=29;case 29:R=1;break e;case d:R=-3;break e;case 31:return-4;default:return c}return e.next_out=g,e.avail_out=w,e.next_in=p,e.avail_in=m,n.hold=_,n.bits=b,(n.wsize||E!==e.avail_out&&n.mode<d&&(n.mode<27||4!==t))&&v(e,e.output,e.next_out,E-e.avail_out)?(n.mode=31,-4):(I-=e.avail_in,E-=e.avail_out,e.total_in+=I,e.total_out+=E,n.total+=E,n.wrap&&E&&(e.adler=n.check=n.flags?i(n.check,f,E,e.next_out-E):s(n.check,f,E,e.next_out-E)),e.data_type=n.bits+(n.last?64:0)+(n.mode===l?128:0)+(20===n.mode||15===n.mode?256:0),(0===I&&0===E||4===t)&&0===R&&(R=-5),R)},t.inflateEnd=function(e){if(!e||!e.state)return c;var t=e.state;return t.window&&(t.window=null),e.state=null,0},t.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?c:(n.head=t,t.done=!1,0):c},t.inflateSetDictionary=function(e,t){var n,a=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?c:11===n.mode&&s(1,t,a,0)!==n.check?-3:v(e,t,a,a)?(n.mode=31,-4):(n.havedict=1,0):c},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t,n){"use strict";e.exports=function(e,t,n,a){for(var s=65535&e|0,i=e>>>16&65535|0,r=0;0!==n;){n-=r=n>2e3?2e3:n;do{i=i+(s=s+t[a++]|0)|0}while(--r);s%=65521,i%=65521}return s|i<<16|0}},function(e,t,n){"use strict";var a=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var a=0;a<8;a++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();e.exports=function(e,t,n,s){var i=a,r=s+n;e^=-1;for(var o=s;o<r;o++)e=e>>>8^i[255&(e^t[o])];return-1^e}},function(e,t,n){"use strict";var a=n(2);function s(e){for(var t=e.length;--t>=0;)e[t]=0}var i=256,r=286,o=30,c=15,l=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],d=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],h=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],f=new Array(576);s(f);var p=new Array(60);s(p);var g=new Array(512);s(g);var m=new Array(256);s(m);var w=new Array(29);s(w);var _,b,y,v=new Array(o);function I(e,t,n,a,s){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=a,this.max_length=s,this.has_stree=e&&e.length}function E(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function k(e){return e<256?g[e]:g[256+(e>>>7)]}function x(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function A(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,x(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function S(e,t,n){A(e,n[2*t],n[2*t+1])}function M(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function O(e,t,n){var a,s,i=new Array(16),r=0;for(a=1;a<=c;a++)i[a]=r=r+n[a-1]<<1;for(s=0;s<=t;s++){var o=e[2*s+1];0!==o&&(e[2*s]=M(i[o]++,o))}}function L(e){var t;for(t=0;t<r;t++)e.dyn_ltree[2*t]=0;for(t=0;t<o;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function Z(e){e.bi_valid>8?x(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function N(e,t,n,a){var s=2*t,i=2*n;return e[s]<e[i]||e[s]===e[i]&&a[t]<=a[n]}function T(e,t,n){for(var a=e.heap[n],s=n<<1;s<=e.heap_len&&(s<e.heap_len&&N(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!N(t,a,e.heap[s],e.depth));)e.heap[n]=e.heap[s],n=s,s<<=1;e.heap[n]=a}function R(e,t,n){var a,s,r,o,c=0;if(0!==e.last_lit)do{a=e.pending_buf[e.d_buf+2*c]<<8|e.pending_buf[e.d_buf+2*c+1],s=e.pending_buf[e.l_buf+c],c++,0===a?S(e,s,t):(S(e,(r=m[s])+i+1,t),0!==(o=l[r])&&A(e,s-=w[r],o),S(e,r=k(--a),n),0!==(o=d[r])&&A(e,a-=v[r],o))}while(c<e.last_lit);S(e,256,t)}function P(e,t){var n,a,s,i=t.dyn_tree,r=t.stat_desc.static_tree,o=t.stat_desc.has_stree,l=t.stat_desc.elems,d=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<l;n++)0!==i[2*n]?(e.heap[++e.heap_len]=d=n,e.depth[n]=0):i[2*n+1]=0;for(;e.heap_len<2;)i[2*(s=e.heap[++e.heap_len]=d<2?++d:0)]=1,e.depth[s]=0,e.opt_len--,o&&(e.static_len-=r[2*s+1]);for(t.max_code=d,n=e.heap_len>>1;n>=1;n--)T(e,i,n);s=l;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],T(e,i,1),a=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=a,i[2*s]=i[2*n]+i[2*a],e.depth[s]=(e.depth[n]>=e.depth[a]?e.depth[n]:e.depth[a])+1,i[2*n+1]=i[2*a+1]=s,e.heap[1]=s++,T(e,i,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,a,s,i,r,o,l=t.dyn_tree,d=t.max_code,u=t.stat_desc.static_tree,h=t.stat_desc.has_stree,f=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,g=t.stat_desc.max_length,m=0;for(i=0;i<=c;i++)e.bl_count[i]=0;for(l[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(i=l[2*l[2*(a=e.heap[n])+1]+1]+1)>g&&(i=g,m++),l[2*a+1]=i,a>d||(e.bl_count[i]++,r=0,a>=p&&(r=f[a-p]),o=l[2*a],e.opt_len+=o*(i+r),h&&(e.static_len+=o*(u[2*a+1]+r)));if(0!==m){do{for(i=g-1;0===e.bl_count[i];)i--;e.bl_count[i]--,e.bl_count[i+1]+=2,e.bl_count[g]--,m-=2}while(m>0);for(i=g;0!==i;i--)for(a=e.bl_count[i];0!==a;)(s=e.heap[--n])>d||(l[2*s+1]!==i&&(e.opt_len+=(i-l[2*s+1])*l[2*s],l[2*s+1]=i),a--)}}(e,t),O(i,d,e.bl_count)}function C(e,t,n){var a,s,i=-1,r=t[1],o=0,c=7,l=4;for(0===r&&(c=138,l=3),t[2*(n+1)+1]=65535,a=0;a<=n;a++)s=r,r=t[2*(a+1)+1],++o<c&&s===r||(o<l?e.bl_tree[2*s]+=o:0!==s?(s!==i&&e.bl_tree[2*s]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,i=s,0===r?(c=138,l=3):s===r?(c=6,l=3):(c=7,l=4))}function F(e,t,n){var a,s,i=-1,r=t[1],o=0,c=7,l=4;for(0===r&&(c=138,l=3),a=0;a<=n;a++)if(s=r,r=t[2*(a+1)+1],!(++o<c&&s===r)){if(o<l)do{S(e,s,e.bl_tree)}while(0!=--o);else 0!==s?(s!==i&&(S(e,s,e.bl_tree),o--),S(e,16,e.bl_tree),A(e,o-3,2)):o<=10?(S(e,17,e.bl_tree),A(e,o-3,3)):(S(e,18,e.bl_tree),A(e,o-11,7));o=0,i=s,0===r?(c=138,l=3):s===r?(c=6,l=3):(c=7,l=4)}}s(v);var U=!1;function D(e,t,n,s){A(e,0+(s?1:0),3),function(e,t,n,s){Z(e),x(e,n),x(e,~n),a.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n)}t._tr_init=function(e){U||(function(){var e,t,n,a,s,i=new Array(16);for(n=0,a=0;a<28;a++)for(w[a]=n,e=0;e<1<<l[a];e++)m[n++]=a;for(m[n-1]=a,s=0,a=0;a<16;a++)for(v[a]=s,e=0;e<1<<d[a];e++)g[s++]=a;for(s>>=7;a<o;a++)for(v[a]=s<<7,e=0;e<1<<d[a]-7;e++)g[256+s++]=a;for(t=0;t<=c;t++)i[t]=0;for(e=0;e<=143;)f[2*e+1]=8,e++,i[8]++;for(;e<=255;)f[2*e+1]=9,e++,i[9]++;for(;e<=279;)f[2*e+1]=7,e++,i[7]++;for(;e<=287;)f[2*e+1]=8,e++,i[8]++;for(O(f,287,i),e=0;e<o;e++)p[2*e+1]=5,p[2*e]=M(e,5);_=new I(f,l,257,r,c),b=new I(p,d,0,o,c),y=new I(new Array(0),u,0,19,7)}(),U=!0),e.l_desc=new E(e.dyn_ltree,_),e.d_desc=new E(e.dyn_dtree,b),e.bl_desc=new E(e.bl_tree,y),e.bi_buf=0,e.bi_valid=0,L(e)},t._tr_stored_block=D,t._tr_flush_block=function(e,t,n,a){var s,r,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<i;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),P(e,e.l_desc),P(e,e.d_desc),o=function(e){var t;for(C(e,e.dyn_ltree,e.l_desc.max_code),C(e,e.dyn_dtree,e.d_desc.max_code),P(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*h[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),s=e.opt_len+3+7>>>3,(r=e.static_len+3+7>>>3)<=s&&(s=r)):s=r=n+5,n+4<=s&&-1!==t?D(e,t,n,a):4===e.strategy||r===s?(A(e,2+(a?1:0),3),R(e,f,p)):(A(e,4+(a?1:0),3),function(e,t,n,a){var s;for(A(e,t-257,5),A(e,n-1,5),A(e,a-4,4),s=0;s<a;s++)A(e,e.bl_tree[2*h[s]+1],3);F(e,e.dyn_ltree,t-1),F(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),R(e,e.dyn_ltree,e.dyn_dtree)),L(e),a&&Z(e)},t._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(m[n]+i+1)]++,e.dyn_dtree[2*k(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){A(e,2,3),S(e,256,f),function(e){16===e.bi_valid?(x(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},function(e,t,n){"use strict";e.exports=function(e,t){var n,a,s,i,r,o,c,l,d,u,h,f,p,g,m,w,_,b,y,v,I,E,k,x,A;n=e.state,a=e.next_in,x=e.input,s=a+(e.avail_in-5),i=e.next_out,A=e.output,r=i-(t-e.avail_out),o=i+(e.avail_out-257),c=n.dmax,l=n.wsize,d=n.whave,u=n.wnext,h=n.window,f=n.hold,p=n.bits,g=n.lencode,m=n.distcode,w=(1<<n.lenbits)-1,_=(1<<n.distbits)-1;e:do{p<15&&(f+=x[a++]<<p,p+=8,f+=x[a++]<<p,p+=8),b=g[f&w];t:for(;;){if(f>>>=y=b>>>24,p-=y,0==(y=b>>>16&255))A[i++]=65535&b;else{if(!(16&y)){if(0==(64&y)){b=g[(65535&b)+(f&(1<<y)-1)];continue t}if(32&y){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}v=65535&b,(y&=15)&&(p<y&&(f+=x[a++]<<p,p+=8),v+=f&(1<<y)-1,f>>>=y,p-=y),p<15&&(f+=x[a++]<<p,p+=8,f+=x[a++]<<p,p+=8),b=m[f&_];n:for(;;){if(f>>>=y=b>>>24,p-=y,!(16&(y=b>>>16&255))){if(0==(64&y)){b=m[(65535&b)+(f&(1<<y)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(I=65535&b,p<(y&=15)&&(f+=x[a++]<<p,(p+=8)<y&&(f+=x[a++]<<p,p+=8)),(I+=f&(1<<y)-1)>c){e.msg="invalid distance too far back",n.mode=30;break e}if(f>>>=y,p-=y,I>(y=i-r)){if((y=I-y)>d&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(E=0,k=h,0===u){if(E+=l-y,y<v){v-=y;do{A[i++]=h[E++]}while(--y);E=i-I,k=A}}else if(u<y){if(E+=l+u-y,(y-=u)<v){v-=y;do{A[i++]=h[E++]}while(--y);if(E=0,u<v){v-=y=u;do{A[i++]=h[E++]}while(--y);E=i-I,k=A}}}else if(E+=u-y,y<v){v-=y;do{A[i++]=h[E++]}while(--y);E=i-I,k=A}for(;v>2;)A[i++]=k[E++],A[i++]=k[E++],A[i++]=k[E++],v-=3;v&&(A[i++]=k[E++],v>1&&(A[i++]=k[E++]))}else{E=i-I;do{A[i++]=A[E++],A[i++]=A[E++],A[i++]=A[E++],v-=3}while(v>2);v&&(A[i++]=A[E++],v>1&&(A[i++]=A[E++]))}break}}break}}while(a<s&&i<o);a-=v=p>>3,f&=(1<<(p-=v<<3))-1,e.next_in=a,e.next_out=i,e.avail_in=a<s?s-a+5:5-(a-s),e.avail_out=i<o?o-i+257:257-(i-o),n.hold=f,n.bits=p}},function(e,t,n){"use strict";var a=n(2),s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],i=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],r=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],o=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,n,c,l,d,u,h){var f,p,g,m,w,_,b,y,v,I=h.bits,E=0,k=0,x=0,A=0,S=0,M=0,O=0,L=0,Z=0,N=0,T=null,R=0,P=new a.Buf16(16),C=new a.Buf16(16),F=null,U=0;for(E=0;E<=15;E++)P[E]=0;for(k=0;k<c;k++)P[t[n+k]]++;for(S=I,A=15;A>=1&&0===P[A];A--);if(S>A&&(S=A),0===A)return l[d++]=20971520,l[d++]=20971520,h.bits=1,0;for(x=1;x<A&&0===P[x];x++);for(S<x&&(S=x),L=1,E=1;E<=15;E++)if(L<<=1,(L-=P[E])<0)return-1;if(L>0&&(0===e||1!==A))return-1;for(C[1]=0,E=1;E<15;E++)C[E+1]=C[E]+P[E];for(k=0;k<c;k++)0!==t[n+k]&&(u[C[t[n+k]]++]=k);if(0===e?(T=F=u,_=19):1===e?(T=s,R-=257,F=i,U-=257,_=256):(T=r,F=o,_=-1),N=0,k=0,E=x,w=d,M=S,O=0,g=-1,m=(Z=1<<S)-1,1===e&&Z>852||2===e&&Z>592)return 1;for(;;){b=E-O,u[k]<_?(y=0,v=u[k]):u[k]>_?(y=F[U+u[k]],v=T[R+u[k]]):(y=96,v=0),f=1<<E-O,x=p=1<<M;do{l[w+(N>>O)+(p-=f)]=b<<24|y<<16|v|0}while(0!==p);for(f=1<<E-1;N&f;)f>>=1;if(0!==f?(N&=f-1,N+=f):N=0,k++,0==--P[E]){if(E===A)break;E=t[n+u[k]]}if(E>S&&(N&m)!==g){for(0===O&&(O=S),w+=x,L=1<<(M=E-O);M+O<A&&!((L-=P[M+O])<=0);)M++,L<<=1;if(Z+=1<<M,1===e&&Z>852||2===e&&Z>592)return 1;l[g=N&m]=S<<24|M<<16|w-d|0}}return 0!==N&&(l[w+N]=E-O<<24|64<<16|0),h.bits=S,0}},function(e,t,n){"use strict";n.r(t);var a=n(3),s=n.n(a),i=n(4),r=n(5),o=n(1),c=n.n(o),l=n(0),d=16384;function u(e,t){var n=this;this.inflatedReady=e,this.deflatedReady=t,this._inflate=function(e){var t=new s.a,n=Object(r.inflateInit2)(t,15);if(n!==l.Z_OK)throw new Error("Problem initializing inflate stream: "+c.a[n]);return function(n){if(void 0===n)return e();var a,s,i;t.input=n,t.next_in=0,t.avail_in=t.input.length;var o=!0;do{if(0===t.avail_out&&(t.output=new Uint8Array(d),a=t.next_out=0,t.avail_out=d),(s=Object(r.inflate)(t,l.Z_NO_FLUSH))!==l.Z_STREAM_END&&s!==l.Z_OK)throw new Error("inflate problem: "+c.a[s]);t.next_out&&(0!==t.avail_out&&s!==l.Z_STREAM_END||(i=t.output.subarray(a,a=t.next_out),o=e(i)))}while(t.avail_in>0&&s!==l.Z_STREAM_END);return t.next_out>a&&(i=t.output.subarray(a,a=t.next_out),o=e(i)),o}}((function(e){return n.inflatedReady(e.buffer.slice(e.byteOffset,e.byteOffset+e.length))})),this._deflate=function(e){var t=new s.a,n=Object(i.deflateInit2)(t,l.Z_DEFAULT_COMPRESSION,l.Z_DEFLATED,15,8,l.Z_DEFAULT_STRATEGY);if(n!==l.Z_OK)throw new Error("Problem initializing deflate stream: "+c.a[n]);return function(n){if(void 0===n)return e();var a,s,r;t.input=n,t.next_in=0,t.avail_in=t.input.length;var o=!0;do{if(0===t.avail_out&&(t.output=new Uint8Array(d),r=t.next_out=0,t.avail_out=d),(a=Object(i.deflate)(t,l.Z_SYNC_FLUSH))!==l.Z_STREAM_END&&a!==l.Z_OK)throw new Error("Deflate problem: "+c.a[a]);0===t.avail_out&&t.next_out>r&&(s=t.output.subarray(r,r=t.next_out),o=e(s))}while((t.avail_in>0||0===t.avail_out)&&a!==l.Z_STREAM_END);return t.next_out>r&&(s=t.output.subarray(r,r=t.next_out),o=e(s)),o}}((function(e){return n.deflatedReady(e.buffer.slice(e.byteOffset,e.byteOffset+e.length))}))}u.prototype.inflate=function(e){this._inflate(new Uint8Array(e))},u.prototype.deflate=function(e){this._deflate(new Uint8Array(e))};var h=function(e,t){return{message:e,buffer:t}},f=new u((function(e){return self.postMessage(h("inflated_ready",e),[e])}),(function(e){return self.postMessage(h("deflated_ready",e),[e])}));self.onmessage=function(e){var t=e.data.message,n=e.data.buffer;switch(t){case"start":break;case"inflate":f.inflate(n);break;case"deflate":f.deflate(n)}}}])},9673:(e,t,n)=>{"use strict";function a(e){return null!=e&&"object"==typeof e&&!0===e["@@functional/placeholder"]}function s(e){return function t(n){return 0===arguments.length||a(n)?t:e.apply(this,arguments)}}function i(e){return function t(n,i){switch(arguments.length){case 0:return t;case 1:return a(n)?t:s((function(t){return e(n,t)}));default:return a(n)&&a(i)?t:a(n)?s((function(t){return e(t,i)})):a(i)?s((function(t){return e(n,t)})):e(n,i)}}}function r(e){return function t(n,r,o){switch(arguments.length){case 0:return t;case 1:return a(n)?t:i((function(t,a){return e(n,t,a)}));case 2:return a(n)&&a(r)?t:a(n)?i((function(t,n){return e(t,r,n)})):a(r)?i((function(t,a){return e(n,t,a)})):s((function(t){return e(n,r,t)}));default:return a(n)&&a(r)&&a(o)?t:a(n)&&a(r)?i((function(t,n){return e(t,n,o)})):a(n)&&a(o)?i((function(t,n){return e(t,r,n)})):a(r)&&a(o)?i((function(t,a){return e(n,t,a)})):a(n)?s((function(t){return e(t,r,o)})):a(r)?s((function(t){return e(n,t,o)})):a(o)?s((function(t){return e(n,r,t)})):e(n,r,o)}}}n.d(t,{ZP:()=>xt});const o=i((function(e,t){return null==t||t!=t?e:t}));const c=i((function(e,t){for(var n=t,a=0;a<e.length;){if(null==n)return;n=n[e[a]],a+=1}return n}));const l=r((function(e,t,n){return o(e,c(t,n))}));const d=r((function(e,t,n){return l(e,[t],n)})),u=Array.isArray||function(e){return null!=e&&e.length>=0&&"[object Array]"===Object.prototype.toString.call(e)};function h(e){return"[object String]"===Object.prototype.toString.call(e)}const f=s((function(e){return!!u(e)||!!e&&("object"==typeof e&&(!h(e)&&(1===e.nodeType?!!e.length:0===e.length||e.length>0&&(e.hasOwnProperty(0)&&e.hasOwnProperty(e.length-1)))))}));function p(e){return function t(n){for(var a,s,i,r=[],o=0,c=n.length;o<c;){if(f(n[o]))for(i=0,s=(a=e?t(n[o]):n[o]).length;i<s;)r[r.length]=a[i],i+=1;else r[r.length]=n[o];o+=1}return r}}const g=s(p(!0));const m=s((function(e){for(var t={},n=0;n<e.length;)t[e[n][0]]=e[n][1],n+=1;return t}));const w=i((function(e,t){for(var n=[],a=0,s=Math.min(e.length,t.length);a<s;)n[a]=[e[a],t[a]],a+=1;return n}));function _(e,t){var n;t=t||[];var a=(e=e||[]).length,s=t.length,i=[];for(n=0;n<a;)i[i.length]=e[n],n+=1;for(n=0;n<s;)i[i.length]=t[n],n+=1;return i}function b(e,t){switch(e){case 0:return function(){return t.apply(this,arguments)};case 1:return function(e){return t.apply(this,arguments)};case 2:return function(e,n){return t.apply(this,arguments)};case 3:return function(e,n,a){return t.apply(this,arguments)};case 4:return function(e,n,a,s){return t.apply(this,arguments)};case 5:return function(e,n,a,s,i){return t.apply(this,arguments)};case 6:return function(e,n,a,s,i,r){return t.apply(this,arguments)};case 7:return function(e,n,a,s,i,r,o){return t.apply(this,arguments)};case 8:return function(e,n,a,s,i,r,o,c){return t.apply(this,arguments)};case 9:return function(e,n,a,s,i,r,o,c,l){return t.apply(this,arguments)};case 10:return function(e,n,a,s,i,r,o,c,l,d){return t.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}}function y(e,t){return function(){return t.call(this,e.apply(this,arguments))}}var v=function(){function e(e){this.f=e}return e.prototype["@@transducer/init"]=function(){throw new Error("init not implemented on XWrap")},e.prototype["@@transducer/result"]=function(e){return e},e.prototype["@@transducer/step"]=function(e,t){return this.f(e,t)},e}();const I=i((function(e,t){return b(e.length,(function(){return e.apply(t,arguments)}))}));function E(e,t,n){for(var a=n.next();!a.done;){if((t=e["@@transducer/step"](t,a.value))&&t["@@transducer/reduced"]){t=t["@@transducer/value"];break}a=n.next()}return e["@@transducer/result"](t)}function k(e,t,n,a){return e["@@transducer/result"](n[a](I(e["@@transducer/step"],e),t))}var x="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator";function A(e,t,n){if("function"==typeof e&&(e=function(e){return new v(e)}(e)),f(n))return function(e,t,n){for(var a=0,s=n.length;a<s;){if((t=e["@@transducer/step"](t,n[a]))&&t["@@transducer/reduced"]){t=t["@@transducer/value"];break}a+=1}return e["@@transducer/result"](t)}(e,t,n);if("function"==typeof n["fantasy-land/reduce"])return k(e,t,n,"fantasy-land/reduce");if(null!=n[x])return E(e,t,n[x]());if("function"==typeof n.next)return E(e,t,n);if("function"==typeof n.reduce)return k(e,t,n,"reduce");throw new TypeError("reduce: list must be array or iterable")}const S=r(A);function M(e,t){return function(){var n=arguments.length;if(0===n)return t();var a=arguments[n-1];return u(a)||"function"!=typeof a[e]?t.apply(this,arguments):a[e].apply(a,Array.prototype.slice.call(arguments,0,n-1))}}const O=s(M("tail",r(M("slice",(function(e,t,n){return Array.prototype.slice.call(n,e,t)})))(1,1/0)));function L(){if(0===arguments.length)throw new Error("pipe requires at least one argument");return b(arguments[0].length,S(y,arguments[0],O(arguments)))}const Z=s((function(e){return h(e)?e.split("").reverse().join(""):Array.prototype.slice.call(e,0).reverse()}));function N(){if(0===arguments.length)throw new Error("compose requires at least one argument");return L.apply(this,Z(arguments))}function T(e){return e}const R=s(T);function P(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n}function C(e,t,n){for(var a=0,s=n.length;a<s;){if(e(t,n[a]))return!0;a+=1}return!1}function F(e,t){return Object.prototype.hasOwnProperty.call(t,e)}const U="function"==typeof Object.is?Object.is:function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t};var D=Object.prototype.toString;const z=function(){return"[object Arguments]"===D.call(arguments)?function(e){return"[object Arguments]"===D.call(e)}:function(e){return F("callee",e)}}();var B=!{toString:null}.propertyIsEnumerable("toString"),$=["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],j=function(){return arguments.propertyIsEnumerable("length")}(),Q=function(e,t){for(var n=0;n<e.length;){if(e[n]===t)return!0;n+=1}return!1},V="function"!=typeof Object.keys||j?s((function(e){if(Object(e)!==e)return[];var t,n,a=[],s=j&&z(e);for(t in e)!F(t,e)||s&&"length"===t||(a[a.length]=t);if(B)for(n=$.length-1;n>=0;)F(t=$[n],e)&&!Q(a,t)&&(a[a.length]=t),n-=1;return a})):s((function(e){return Object(e)!==e?[]:Object.keys(e)}));const q=V;const H=s((function(e){return null===e?"Null":void 0===e?"Undefined":Object.prototype.toString.call(e).slice(8,-1)}));function K(e,t,n,a){var s=P(e);function i(e,t){return W(e,t,n.slice(),a.slice())}return!C((function(e,t){return!C(i,t,e)}),P(t),s)}function W(e,t,n,a){if(U(e,t))return!0;var s,i,r=H(e);if(r!==H(t))return!1;if(null==e||null==t)return!1;if("function"==typeof e["fantasy-land/equals"]||"function"==typeof t["fantasy-land/equals"])return"function"==typeof e["fantasy-land/equals"]&&e["fantasy-land/equals"](t)&&"function"==typeof t["fantasy-land/equals"]&&t["fantasy-land/equals"](e);if("function"==typeof e.equals||"function"==typeof t.equals)return"function"==typeof e.equals&&e.equals(t)&&"function"==typeof t.equals&&t.equals(e);switch(r){case"Arguments":case"Array":case"Object":if("function"==typeof e.constructor&&"Promise"===(s=e.constructor,null==(i=String(s).match(/^function (\w*)/))?"":i[1]))return e===t;break;case"Boolean":case"Number":case"String":if(typeof e!=typeof t||!U(e.valueOf(),t.valueOf()))return!1;break;case"Date":if(!U(e.valueOf(),t.valueOf()))return!1;break;case"Error":return e.name===t.name&&e.message===t.message;case"RegExp":if(e.source!==t.source||e.global!==t.global||e.ignoreCase!==t.ignoreCase||e.multiline!==t.multiline||e.sticky!==t.sticky||e.unicode!==t.unicode)return!1}for(var o=n.length-1;o>=0;){if(n[o]===e)return a[o]===t;o-=1}switch(r){case"Map":return e.size===t.size&&K(e.entries(),t.entries(),n.concat([e]),a.concat([t]));case"Set":return e.size===t.size&&K(e.values(),t.values(),n.concat([e]),a.concat([t]));case"Arguments":case"Array":case"Object":case"Boolean":case"Number":case"String":case"Date":case"Error":case"RegExp":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"ArrayBuffer":break;default:return!1}var c=q(e);if(c.length!==q(t).length)return!1;var l=n.concat([e]),d=a.concat([t]);for(o=c.length-1;o>=0;){var u=c[o];if(!F(u,t)||!W(t[u],e[u],l,d))return!1;o-=1}return!0}const G=i((function(e,t){return W(e,t,[],[])}));function Y(e,t){return function(e,t,n){var a,s;if("function"==typeof e.indexOf)switch(typeof t){case"number":if(0===t){for(a=1/t;n<e.length;){if(0===(s=e[n])&&1/s===a)return n;n+=1}return-1}if(t!=t){for(;n<e.length;){if("number"==typeof(s=e[n])&&s!=s)return n;n+=1}return-1}return e.indexOf(t,n);case"string":case"boolean":case"function":case"undefined":return e.indexOf(t,n);case"object":if(null===t)return e.indexOf(t,n)}for(;n<e.length;){if(G(e[n],t))return n;n+=1}return-1}(t,e,0)>=0}function X(e,t,n){var a,s=typeof e;switch(s){case"string":case"number":return 0===e&&1/e==-1/0?!!n._items["-0"]||(t&&(n._items["-0"]=!0),!1):null!==n._nativeSet?t?(a=n._nativeSet.size,n._nativeSet.add(e),n._nativeSet.size===a):n._nativeSet.has(e):s in n._items?e in n._items[s]||(t&&(n._items[s][e]=!0),!1):(t&&(n._items[s]={},n._items[s][e]=!0),!1);case"boolean":if(s in n._items){var i=e?1:0;return!!n._items[s][i]||(t&&(n._items[s][i]=!0),!1)}return t&&(n._items[s]=e?[!1,!0]:[!0,!1]),!1;case"function":return null!==n._nativeSet?t?(a=n._nativeSet.size,n._nativeSet.add(e),n._nativeSet.size===a):n._nativeSet.has(e):s in n._items?!!Y(e,n._items[s])||(t&&n._items[s].push(e),!1):(t&&(n._items[s]=[e]),!1);case"undefined":return!!n._items[s]||(t&&(n._items[s]=!0),!1);case"object":if(null===e)return!!n._items.null||(t&&(n._items.null=!0),!1);default:return(s=Object.prototype.toString.call(e))in n._items?!!Y(e,n._items[s])||(t&&n._items[s].push(e),!1):(t&&(n._items[s]=[e]),!1)}}const J=function(){function e(){this._nativeSet="function"==typeof Set?new Set:null,this._items={}}return e.prototype.add=function(e){return!X(e,!0,this)},e.prototype.has=function(e){return X(e,!1,this)},e}();const ee=i(N(i((function(e,t){for(var n,a,s=new J,i=[],r=0;r<t.length;)n=e(a=t[r]),s.add(n)&&i.push(a),r+=1;return i}))(R),_));function te(e){return null!=e&&"function"==typeof e["@@transducer/step"]}function ne(e,t,n){return function(){if(0===arguments.length)return n();var a=Array.prototype.slice.call(arguments,0),s=a.pop();if(!u(s)){for(var i=0;i<e.length;){if("function"==typeof s[e[i]])return s[e[i]].apply(s,a);i+=1}if(te(s)){var r=t.apply(null,a);return r(s)}}return n.apply(this,arguments)}}function ae(e,t){for(var n=0,a=t.length,s=Array(a);n<a;)s[n]=e(t[n]),n+=1;return s}const se=function(){return this.xf["@@transducer/init"]()},ie=function(e){return this.xf["@@transducer/result"](e)};var re=function(){function e(e,t){this.xf=t,this.f=e}return e.prototype["@@transducer/init"]=se,e.prototype["@@transducer/result"]=ie,e.prototype["@@transducer/step"]=function(e,t){return this.xf["@@transducer/step"](e,this.f(t))},e}();const oe=i((function(e,t){return new re(e,t)}));function ce(e,t,n){return function(){for(var s=[],i=0,r=e,o=0;o<t.length||i<arguments.length;){var c;o<t.length&&(!a(t[o])||i>=arguments.length)?c=t[o]:(c=arguments[i],i+=1),s[o]=c,a(c)||(r-=1),o+=1}return r<=0?n.apply(this,s):b(r,ce(e,s,n))}}const le=i((function(e,t){return 1===e?s(t):b(e,ce(e,[],t))}));const de=i(ne(["fantasy-land/map","map"],oe,(function(e,t){switch(Object.prototype.toString.call(t)){case"[object Function]":return le(t.length,(function(){return e.call(this,t.apply(this,arguments))}));case"[object Object]":return A((function(n,a){return n[a]=e(t[a]),n}),{},q(t));default:return ae(e,t)}})));var ue=n(83065),he=n(84846);const fe=32,pe=93,ge=e=>(e=>e>=1&&e<=127)(e)&&!me(e),me=e=>40===e||41===e||123===e||e===fe||we(e)||_e(e)||be(e)||ye(e),we=e=>e>=0&&e<=31||127===e,_e=e=>37===e||42===e,be=e=>34===e||92===e,ye=e=>e===pe,ve=e=>e>=48&&e<=57,Ie=e=>(e=>e>=65&&e<=90||e>=97&&e<=122)(e)||ve(e),Ee=e=>ge(e)||ye(e);function ke(e,t,n){let a=[],s=(e.tag||"")+(e.command?" "+e.command:""),i=!0,r=function(e){if(s.length>0&&i&&(s+=" "),Array.isArray(e))return i=!1,s+="(",e.forEach(r),void(s+=")");if(i=!0,e||"string"==typeof e||"number"==typeof e)if("string"!=typeof e)if("number"!=typeof e)if(n&&e.sensitive)s+='"(* value hidden *)"';else switch(e.type.toUpperCase()){case"LITERAL":n?s+='"(* '+e.value.length+'B literal *)"':(e.value?s+="{"+e.value.length+"}\r\n":s+="{0}\r\n",a.push(s),s=e.value||"");break;case"STRING":n&&e.value.length>20?s+='"(* '+e.value.length+'B string *)"':s+=JSON.stringify(e.value||"");break;case"TEXT":case"SEQUENCE":s+=e.value||"";break;case"NUMBER":s+=e.value||0;break;case"ATOM":case"SECTION":let t=e.value||"";for(let e=92===t.charCodeAt(0)?1:0;e<t.length;e++)if(!ge(t.charCodeAt(e))){t=JSON.stringify(t);break}s+=t,e.section&&(s+="[",e.section.length&&(i=!1,e.section.forEach(r)),s+="]"),e.partial&&(s+="<"+e.partial.join(".")+">")}else s+=Math.round(e)||0;else n&&e.length>20?s+='"(* '+e.length+'B string *)"':s+=JSON.stringify(e);else s+="NIL"};return[].concat(e.attributes||[]).forEach(r),s.length&&a.push(s),t?a:a.join("")}function xe(e){return"[object Function]"===Object.prototype.toString.call(e)}function Ae(e){return'"'+e.replace(/\\/g,"\\\\").replace(/[\b]/g,"\\b").replace(/\f/g,"\\f").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t").replace(/\v/g,"\\v").replace(/\0/g,"\\0").replace(/"/g,'\\"')+'"'}var Se=function(e){return(e<10?"0":"")+e};const Me="function"==typeof Date.prototype.toISOString?function(e){return e.toISOString()}:function(e){return e.getUTCFullYear()+"-"+Se(e.getUTCMonth()+1)+"-"+Se(e.getUTCDate())+"T"+Se(e.getUTCHours())+":"+Se(e.getUTCMinutes())+":"+Se(e.getUTCSeconds())+"."+(e.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"};var Oe=function(){function e(e,t){this.xf=t,this.f=e}return e.prototype["@@transducer/init"]=se,e.prototype["@@transducer/result"]=ie,e.prototype["@@transducer/step"]=function(e,t){return this.f(t)?this.xf["@@transducer/step"](e,t):e},e}();const Le=i(ne(["filter"],i((function(e,t){return new Oe(e,t)})),(function(e,t){return n=t,"[object Object]"===Object.prototype.toString.call(n)?A((function(n,a){return e(t[a])&&(n[a]=t[a]),n}),{},q(t)):function(e,t){for(var n=0,a=t.length,s=[];n<a;)e(t[n])&&(s[s.length]=t[n]),n+=1;return s}(e,t);var n})));const Ze=i((function(e,t){return Le((n=e,function(){return!n.apply(this,arguments)}),t);var n}));function Ne(e,t){var n=function(n){var a=t.concat([e]);return Y(n,a)?"<Circular>":Ne(n,a)},a=function(e,t){return ae((function(t){return Ae(t)+": "+n(e[t])}),t.slice().sort())};switch(Object.prototype.toString.call(e)){case"[object Arguments]":return"(function() { return arguments; }("+ae(n,e).join(", ")+"))";case"[object Array]":return"["+ae(n,e).concat(a(e,Ze((function(e){return/^\d+$/.test(e)}),q(e)))).join(", ")+"]";case"[object Boolean]":return"object"==typeof e?"new Boolean("+n(e.valueOf())+")":e.toString();case"[object Date]":return"new Date("+(isNaN(e.valueOf())?n(NaN):Ae(Me(e)))+")";case"[object Null]":return"null";case"[object Number]":return"object"==typeof e?"new Number("+n(e.valueOf())+")":1/e==-1/0?"-0":e.toString(10);case"[object String]":return"object"==typeof e?"new String("+n(e.valueOf())+")":Ae(e);case"[object Undefined]":return"undefined";default:if("function"==typeof e.toString){var s=e.toString();if("[object Object]"!==s)return s}return"{"+a(e,q(e)).join(", ")+"}"}}const Te=s((function(e){return Ne(e,[])}));const Re=i((function(e,t){return le(e+1,(function(){var n=arguments[e];if(null!=n&&xe(n[t]))return n[t].apply(n,Array.prototype.slice.call(arguments,0,e));throw new TypeError(Te(n)+' does not have a method named "'+t+'"')}))}))(0,"toLowerCase");const Pe=i((function(e,t){return c([e],t)}));var Ce=n(85834);function Fe(e){return!!e&&(e=[].concat(e||[])).map((e=>!(!e||!e.length)&&{prefix:e[0].value,delimiter:e[1]&&e[1].value}))}function Ue(e){const t={};return e[0]&&e[0].value&&(t.date=e[0].value),e[1]&&e[1].value&&(t.subject=(0,Ce.Mf)(e[1]&&e[1].value)),e[2]&&e[2].length&&(t.from=De(e[2])),e[3]&&e[3].length&&(t.sender=De(e[3])),e[4]&&e[4].length&&(t["reply-to"]=De(e[4])),e[5]&&e[5].length&&(t.to=De(e[5])),e[6]&&e[6].length&&(t.cc=De(e[6])),e[7]&&e[7].length&&(t.bcc=De(e[7])),e[8]&&e[8].value&&(t["in-reply-to"]=e[8].value),e[9]&&e[9].value&&(t["message-id"]=e[9].value),t}function De(e=[]){return e.map((e=>{const t=l("",["0","value"],e).trim(),n=l("",["2","value"],e)+"@"+l("",["3","value"],e),a=t?function(e){if(!/^[\w ']*$/.test(e))return/^[\x20-\x7e]*$/.test(e)?JSON.stringify(e):(0,Ce.KR)(e,"Q",52);return e}(t)+" <"+n+">":n,s=(0,he.Z)(a).shift();return s.name=(0,Ce.Mf)(s.name),s}))}function ze(e,t=[]){const n={};let a=0,s=0;if(t.length&&(n.part=t.join(".")),Array.isArray(e[0])){for(n.childNodes=[];Array.isArray(e[a]);)n.childNodes.push(ze(e[a],t.concat(++s))),a++;n.type="multipart/"+((e[a++]||{}).value||"").toString().toLowerCase(),a<e.length-1&&(e[a]&&(n.parameters=Be(e[a])),a++)}else n.type=[((e[a++]||{}).value||"").toString().toLowerCase(),((e[a++]||{}).value||"").toString().toLowerCase()].join("/"),e[a]&&(n.parameters=Be(e[a])),a++,e[a]&&(n.id=((e[a]||{}).value||"").toString()),a++,e[a]&&(n.description=((e[a]||{}).value||"").toString()),a++,e[a]&&(n.encoding=((e[a]||{}).value||"").toString().toLowerCase()),a++,e[a]&&(n.size=Number((e[a]||{}).value||0)||0),a++,"message/rfc822"===n.type?(e[a]&&(n.envelope=Ue([].concat(e[a]||[]))),a++,e[a]&&(n.childNodes=[ze(e[a],t)]),a++,e[a]&&(n.lineCount=Number((e[a]||{}).value||0)||0),a++):/^text\//.test(n.type)&&(e[a]&&(n.lineCount=Number((e[a]||{}).value||0)||0),a++),a<e.length-1&&(e[a]&&(n.md5=((e[a]||{}).value||"").toString().toLowerCase()),a++);return a<e.length-1&&(Array.isArray(e[a])&&e[a].length&&(n.disposition=((e[a][0]||{}).value||"").toString().toLowerCase(),Array.isArray(e[a][1])&&(n.dispositionParameters=Be(e[a][1]))),a++),a<e.length-1&&(e[a]&&(n.language=[].concat(e[a]).map((e=>d("","value",e).toLowerCase()))),a++),a<e.length-1&&(e[a]&&(n.location=((e[a]||{}).value||"").toString()),a++),n}function Be(e=[],t=Re,n=Ce.Mf){const a=e.map(Pe("value")),s=a.filter(((e,t)=>t%2==0)).map(t),i=a.filter(((e,t)=>t%2==1)).map(n);return m(w(s,i))}function $e(e){if(!(e&&e.payload&&e.payload.FETCH&&e.payload.FETCH.length))return[];const t=[],n={};return e.payload.FETCH.forEach((e=>{const a=[].concat([].concat(e.attributes||[])[0]||[]);let s,i,r,o;for(n[e.nr]?s=n[e.nr]:(n[e.nr]=s={"#":e.nr},t.push(s)),i=0,r=a.length;i<r;i++)i%2!=0?s[o]=je(o,a[i]):o=ke({attributes:[a[i]]}).toLowerCase().replace(/<\d+>$/,"")})),t}function je(e,t){if(!t)return null;if(!Array.isArray(t)){switch(e){case"uid":case"rfc822.size":return Number(t.value)||0;case"modseq":return t.value||"0"}return t.value}switch(e){case"flags":case"x-gm-labels":t=[].concat(t).map((e=>e.value||""));break;case"envelope":t=Ue([].concat(t||[]));break;case"bodystructure":t=ze([].concat(t||[]));break;case"modseq":t=(t.shift()||{}).value||"0"}return t}function Qe(e){for(var t=[],n=0;n<e.length;n+=10240){const a=n,s=Math.min(n+10240,e.length);t.push(String.fromCharCode.apply(null,e.subarray(a,s)))}return t.join("")}function Ve(e){let t=0,n=e.length;for(;e[t]===fe;)t++;for(;e[n-1]===fe;)n--;return 0===t&&n===e.length||(e=e.subarray(t,n)),Qe(e)}class qe{constructor(e,t){this.remainder=new Uint8Array(e||0),this.options=t||{},this.pos=0}getTag(){if(!this.tag){const e=e=>(e=>Ee(e)&&43!==e)(e)||42===e||43===e;this.tag=this.getElement(e)}return this.tag}getCommand(){switch(this.command||(this.command=this.getElement(Ie)),(this.command||"").toString().toUpperCase()){case"OK":case"NO":case"BAD":case"PREAUTH":case"BYE":let e=this.remainder.lastIndexOf(pe);91===this.remainder[1]&&e>1?(this.humanReadable=Ve(this.remainder.subarray(e+1)),this.remainder=this.remainder.subarray(0,e+1)):(this.humanReadable=Ve(this.remainder),this.remainder=new Uint8Array(0))}return this.command}getElement(e){let t;if(this.remainder[0]===fe)throw new Error("Unexpected whitespace at position "+this.pos);let n=this.remainder.indexOf(fe);if(!(this.remainder.length>0&&0!==n))throw new Error("Unexpected end of input at position "+this.pos);t=-1===n?this.remainder:this.remainder.subarray(0,n);for(let n=0;n<t.length;n++)if(!e(t[n]))throw new Error("Unexpected char at position "+(this.pos+n));return this.pos+=t.length,this.remainder=this.remainder.subarray(t.length),Qe(t)}getSpace(){if(!this.remainder.length)throw new Error("Unexpected end of input at position "+this.pos);if(this.remainder[0]!==fe)throw new Error("Unexpected char at position "+this.pos);this.pos++,this.remainder=this.remainder.subarray(1)}getAttributes(){if(!this.remainder.length)throw new Error("Unexpected end of input at position "+this.pos);if(this.remainder[0]===fe)throw new Error("Unexpected whitespace at position "+this.pos);return new Ke(this,this.pos,this.remainder.subarray(),this.options).getAttributes()}}class He{constructor(e,t,n){this.uint8Array=e,this.childNodes=[],this.type=!1,this.closed=!0,this.valueSkip=[],this.startPos=n,this.valueStart=this.valueEnd="number"==typeof n?n+1:0,t&&(this.parentNode=t,t.childNodes.push(this))}getValue(){let e=Qe(this.getValueArray());return this.valueToUpperCase?e.toUpperCase():e}getValueLength(){return this.valueEnd-this.valueStart-this.valueSkip.length}getValueArray(){const e=this.uint8Array.subarray(this.valueStart,this.valueEnd);if(0===this.valueSkip.length)return e;let t=new Uint8Array(e.length-this.valueSkip.length),n=0,a=0,s=this.valueSkip.slice();return s.push(e.length),s.forEach((function(s){if(s>n){var i=e.subarray(n,s);t.set(i,a),a+=i.length}n=s+1})),t}equals(e,t){return this.getValueLength()===e.length&&this.equalsAt(e,0,t)}equalsAt(e,t,n){if(n="boolean"!=typeof n||n,t<0)for(t=this.valueEnd+t;this.valueSkip.indexOf(this.valueStart+t)>=0;)t--;else t=this.valueStart+t;for(let a=0;a<e.length;a++){for(;this.valueSkip.indexOf(t-this.valueStart)>=0;)t++;if(t>=this.valueEnd)return!1;let s=String.fromCharCode(this.uint8Array[t]),i=e[a];if(n||(s=s.toUpperCase(),i=i.toUpperCase()),s!==i)return!1;t++}return!0}isNumber(){for(let e=0;e<this.valueEnd-this.valueStart;e++)if(!(this.valueSkip.indexOf(e)>=0||this.isDigit(e)))return!1;return!0}isDigit(e){if(e<0)for(e=this.valueEnd+e;this.valueSkip.indexOf(this.valueStart+e)>=0;)e--;else for(e=this.valueStart+e;this.valueSkip.indexOf(this.valueStart+e)>=0;)e++;return ve(this.uint8Array[e])}containsChar(e){let t=e.charCodeAt(0);for(let e=this.valueStart;e<this.valueEnd;e++)if(!(this.valueSkip.indexOf(e-this.valueStart)>=0)&&this.uint8Array[e]===t)return!0;return!1}}class Ke{constructor(e,t,n,a={}){this.uint8Array=n,this.options=a,this.parent=e,this.tree=this.currentNode=this.createNode(),this.pos=t||0,this.currentNode.type="TREE",this.state="NORMAL",void 0===this.options.valueAsString&&(this.options.valueAsString=!0),this.processString()}getAttributes(){let e=[],t=e,n=e=>{let a,s,i=t;if(!e.closed&&"SEQUENCE"===e.type&&e.equals("*")&&(e.closed=!0,e.type="ATOM"),!e.closed)throw new Error("Unexpected end of input at position "+(this.pos+this.uint8Array.length-1));switch(e.type.toUpperCase()){case"LITERAL":case"STRING":a={type:e.type.toUpperCase(),value:this.options.valueAsString?e.getValue():e.getValueArray()},t.push(a);break;case"SEQUENCE":a={type:e.type.toUpperCase(),value:e.getValue()},t.push(a);break;case"ATOM":if(e.equals("NIL",!0)){t.push(null);break}a={type:e.type.toUpperCase(),value:e.getValue()},t.push(a);break;case"SECTION":t=t[t.length-1].section=[];break;case"LIST":a=[],t.push(a),t=a;break;case"PARTIAL":s=e.getValue().split(".").map(Number),t[t.length-1].partial=s}e.childNodes.forEach((function(e){n(e)})),t=i};return n(this.tree),e}createNode(e,t){return new He(this.uint8Array,e,t)}processString(){let e,t;const n=t=>{for(;this.uint8Array[e+1]===fe;)e++};for(e=0,t=this.uint8Array.length;e<t;e++){let a=this.uint8Array[e];switch(this.state){case"NORMAL":switch(a){case 34:this.currentNode=this.createNode(this.currentNode,e),this.currentNode.type="string",this.state="STRING",this.currentNode.closed=!1;break;case 40:this.currentNode=this.createNode(this.currentNode,e),this.currentNode.type="LIST",this.currentNode.closed=!1;break;case 41:if("LIST"!==this.currentNode.type)throw new Error("Unexpected list terminator ) at position "+(this.pos+e));this.currentNode.closed=!0,this.currentNode.endPos=this.pos+e,this.currentNode=this.currentNode.parentNode,n();break;case pe:if("SECTION"!==this.currentNode.type)throw new Error("Unexpected section terminator ] at position "+(this.pos+e));this.currentNode.closed=!0,this.currentNode.endPos=this.pos+e,this.currentNode=this.currentNode.parentNode,n();break;case 60:this.uint8Array[e-1]!==pe?(this.currentNode=this.createNode(this.currentNode,e),this.currentNode.type="ATOM",this.currentNode.valueStart=e,this.currentNode.valueEnd=e+1,this.state="ATOM"):(this.currentNode=this.createNode(this.currentNode,e),this.currentNode.type="PARTIAL",this.state="PARTIAL",this.currentNode.closed=!1);break;case 123:this.currentNode=this.createNode(this.currentNode,e),this.currentNode.type="LITERAL",this.state="LITERAL",this.currentNode.closed=!1;break;case 42:this.currentNode=this.createNode(this.currentNode,e),this.currentNode.type="SEQUENCE",this.currentNode.valueStart=e,this.currentNode.valueEnd=e+1,this.currentNode.closed=!1,this.state="SEQUENCE";break;case fe:case 126:break;case 91:if(["OK","NO","BAD","BYE","PREAUTH"].indexOf(this.parent.command.toUpperCase())>=0&&this.currentNode===this.tree){this.currentNode.endPos=this.pos+e,this.currentNode=this.createNode(this.currentNode,e),this.currentNode.type="ATOM",this.currentNode=this.createNode(this.currentNode,e),this.currentNode.type="SECTION",this.currentNode.closed=!1,this.state="NORMAL","REFERRAL "===Qe(this.uint8Array.subarray(e+1,e+10)).toUpperCase()&&(this.currentNode=this.createNode(this.currentNode,this.pos+e+1),this.currentNode.type="ATOM",this.currentNode.endPos=this.pos+e+8,this.currentNode.valueStart=e+1,this.currentNode.valueEnd=e+9,this.currentNode.valueToUpperCase=!0,this.currentNode=this.currentNode.parentNode,this.currentNode=this.createNode(this.currentNode,this.pos+e+10),this.currentNode.type="ATOM",e=this.uint8Array.indexOf(pe,e+10),this.currentNode.endPos=this.pos+e-1,this.currentNode.valueStart=this.currentNode.startPos-this.pos,this.currentNode.valueEnd=this.currentNode.endPos-this.pos+1,this.currentNode=this.currentNode.parentNode,this.currentNode.closed=!0,this.currentNode=this.currentNode.parentNode,n());break}default:if(!ge(a)&&92!==a&&37!==a)throw new Error("Unexpected char at position "+(this.pos+e));this.currentNode=this.createNode(this.currentNode,e),this.currentNode.type="ATOM",this.currentNode.valueStart=e,this.currentNode.valueEnd=e+1,this.state="ATOM"}break;case"ATOM":if(a===fe){this.currentNode.endPos=this.pos+e-1,this.currentNode=this.currentNode.parentNode,this.state="NORMAL";break}if(this.currentNode.parentNode&&(41===a&&"LIST"===this.currentNode.parentNode.type||a===pe&&"SECTION"===this.currentNode.parentNode.type)){this.currentNode.endPos=this.pos+e-1,this.currentNode=this.currentNode.parentNode,this.currentNode.closed=!0,this.currentNode.endPos=this.pos+e,this.currentNode=this.currentNode.parentNode,this.state="NORMAL",n();break}if(44!==a&&58!==a||!this.currentNode.isNumber()||(this.currentNode.type="SEQUENCE",this.currentNode.closed=!0,this.state="SEQUENCE"),91===a&&(this.currentNode.equals("BODY",!1)||this.currentNode.equals("BODY.PEEK",!1))){this.currentNode.endPos=this.pos+e,this.currentNode=this.createNode(this.currentNode.parentNode,this.pos+e),this.currentNode.type="SECTION",this.currentNode.closed=!1,this.state="NORMAL";break}if(60===a)throw new Error("Unexpected start of partial at position "+this.pos);if(!(ge(a)||a===pe||42===a&&this.currentNode.equals("\\")))throw new Error("Unexpected char at position "+(this.pos+e));if(this.currentNode.equals("\\*"))throw new Error("Unexpected char at position "+(this.pos+e));this.currentNode.valueEnd=e+1;break;case"STRING":if(34===a){this.currentNode.endPos=this.pos+e,this.currentNode.closed=!0,this.currentNode=this.currentNode.parentNode,this.state="NORMAL",n();break}if(92===a){if(this.currentNode.valueSkip.push(e-this.currentNode.valueStart),e++,e>=t)throw new Error("Unexpected end of input at position "+(this.pos+e));a=this.uint8Array[e]}this.currentNode.valueEnd=e+1;break;case"PARTIAL":if(62===a){if(this.currentNode.equalsAt(".",-1))throw new Error("Unexpected end of partial at position "+this.pos);this.currentNode.endPos=this.pos+e,this.currentNode.closed=!0,this.currentNode=this.currentNode.parentNode,this.state="NORMAL",n();break}if(46===a&&(!this.currentNode.getValueLength()||this.currentNode.containsChar(".")))throw new Error("Unexpected partial separator . at position "+this.pos);if(!ve(a)&&46!==a)throw new Error("Unexpected char at position "+(this.pos+e));if(46!==a&&(this.currentNode.equals("0")||this.currentNode.equalsAt(".0",-2)))throw new Error("Invalid partial at position "+(this.pos+e));this.currentNode.valueEnd=e+1;break;case"LITERAL":if(this.currentNode.started){this.currentNode.valueEnd=e+1,this.currentNode.getValueLength()>=this.currentNode.literalLength&&(this.currentNode.endPos=this.pos+e,this.currentNode.closed=!0,this.currentNode=this.currentNode.parentNode,this.state="NORMAL",n());break}if(43===a){this.currentNode.literalPlus=!0;break}if(125===a){if(!("literalLength"in this.currentNode))throw new Error("Unexpected literal prefix end char } at position "+(this.pos+e));if(10===this.uint8Array[e+1])e++;else{if(13!==this.uint8Array[e+1]||10!==this.uint8Array[e+2])throw new Error("Unexpected char at position "+(this.pos+e));e+=2}this.currentNode.valueStart=e+1,this.currentNode.literalLength=Number(this.currentNode.literalLength),this.currentNode.started=!0,this.currentNode.literalLength||(this.currentNode.endPos=this.pos+e,this.currentNode.closed=!0,this.currentNode=this.currentNode.parentNode,this.state="NORMAL",n());break}if(!ve(a))throw new Error("Unexpected char at position "+(this.pos+e));if("0"===this.currentNode.literalLength)throw new Error("Invalid literal at position "+(this.pos+e));this.currentNode.literalLength=(this.currentNode.literalLength||"")+String.fromCharCode(a);break;case"SEQUENCE":if(a===fe){if(!this.currentNode.isDigit(-1)&&!this.currentNode.equalsAt("*",-1))throw new Error("Unexpected whitespace at position "+(this.pos+e));if(this.currentNode.equalsAt("*",-1)&&!this.currentNode.equalsAt(":",-2))throw new Error("Unexpected whitespace at position "+(this.pos+e));this.currentNode.closed=!0,this.currentNode.endPos=this.pos+e-1,this.currentNode=this.currentNode.parentNode,this.state="NORMAL";break}if(this.currentNode.parentNode&&a===pe&&"SECTION"===this.currentNode.parentNode.type){this.currentNode.endPos=this.pos+e-1,this.currentNode=this.currentNode.parentNode,this.currentNode.closed=!0,this.currentNode.endPos=this.pos+e,this.currentNode=this.currentNode.parentNode,this.state="NORMAL",n();break}if(58===a){if(!this.currentNode.isDigit(-1)&&!this.currentNode.equalsAt("*",-1))throw new Error("Unexpected range separator : at position "+(this.pos+e))}else if(42===a){if(!this.currentNode.equalsAt(",",-1)&&!this.currentNode.equalsAt(":",-1))throw new Error("Unexpected range wildcard at position "+(this.pos+e))}else if(44===a){if(!this.currentNode.isDigit(-1)&&!this.currentNode.equalsAt("*",-1))throw new Error("Unexpected sequence separator , at position "+(this.pos+e));if(this.currentNode.equalsAt("*",-1)&&!this.currentNode.equalsAt(":",-2))throw new Error("Unexpected sequence separator , at position "+(this.pos+e))}else if(!ve(a))throw new Error("Unexpected char at position "+(this.pos+e));if(ve(a)&&this.currentNode.equalsAt("*",-1))throw new Error("Unexpected number at position "+(this.pos+e));this.currentNode.valueEnd=e+1}}}}function We(e,t={}){let n=new qe(e,t),a={};return a.tag=n.getTag(),n.getSpace(),a.command=n.getCommand(),["UID","AUTHENTICATE"].indexOf((a.command||"").toUpperCase())>=0&&(n.getSpace(),a.command+=" "+n.getElement(Ie)),function(e){for(let t=0;t<e.length;t++)if(e[t]!==fe)return!1;return!0}(n.remainder)||(n.getSpace(),a.attributes=n.getAttributes()),n.humanReadable&&(a.attributes=(a.attributes||[]).concat({type:"TEXT",value:n.humanReadable})),a}var Ge=n(65546);const Ye=e=>new Uint8Array(e.split("").map((e=>e.charCodeAt(0)))),Xe=e=>String.fromCharCode.apply(null,e);function Je(e="",t){const n=[`user=${e}`,`auth=Bearer ${t}`,"",""];return(0,Ge.cv)(n.join(""))}let et=0;var tt=n(16504),nt=n(62292),at=n.n(nt),st=n(77617),it=n(27948),rt=n(48898),ot=n.n(rt),ct=n(71619);const lt=16384;function dt(e,t){this.inflatedReady=e,this.deflatedReady=t,this._inflate=function(e){const t=new(at()),n=(0,it.Ul)(t,15);if(n!==ct.Z_OK)throw new Error("Problem initializing inflate stream: "+ot()[n]);return function(n){if(void 0===n)return e();let a,s,i;t.input=n,t.next_in=0,t.avail_in=t.input.length;let r=!0;do{if(0===t.avail_out&&(t.output=new Uint8Array(lt),a=t.next_out=0,t.avail_out=lt),s=(0,it.rr)(t,ct.Z_NO_FLUSH),s!==ct.Z_STREAM_END&&s!==ct.Z_OK)throw new Error("inflate problem: "+ot()[s]);t.next_out&&(0!==t.avail_out&&s!==ct.Z_STREAM_END||(i=t.output.subarray(a,a=t.next_out),r=e(i)))}while(t.avail_in>0&&s!==ct.Z_STREAM_END);return t.next_out>a&&(i=t.output.subarray(a,a=t.next_out),r=e(i)),r}}((e=>this.inflatedReady(e.buffer.slice(e.byteOffset,e.byteOffset+e.length)))),this._deflate=function(e){const t=new(at()),n=(0,st.Ue)(t,ct.Z_DEFAULT_COMPRESSION,ct.Z_DEFLATED,15,8,ct.Z_DEFAULT_STRATEGY);if(n!==ct.Z_OK)throw new Error("Problem initializing deflate stream: "+ot()[n]);return function(n){if(void 0===n)return e();let a,s,i;t.input=n,t.next_in=0,t.avail_in=t.input.length;let r=!0;do{if(0===t.avail_out&&(t.output=new Uint8Array(lt),i=t.next_out=0,t.avail_out=lt),a=(0,st.Wt)(t,ct.Z_SYNC_FLUSH),a!==ct.Z_STREAM_END&&a!==ct.Z_OK)throw new Error("Deflate problem: "+ot()[a]);0===t.avail_out&&t.next_out>i&&(s=t.output.subarray(i,i=t.next_out),r=e(s))}while((t.avail_in>0||0===t.avail_out)&&a!==ct.Z_STREAM_END);return t.next_out>i&&(s=t.output.subarray(i,i=t.next_out),r=e(s)),r}}((e=>this.deflatedReady(e.buffer.slice(e.byteOffset,e.byteOffset+e.length))))}dt.prototype.inflate=function(e){this._inflate(new Uint8Array(e))},dt.prototype.deflate=function(e){this._deflate(new Uint8Array(e))};var ut=n(44983),ht=n.n(ut);const ft="\r\n",pt="literal",gt="literal_length_1",mt="literal_length_2",wt="default";class _t{constructor(e,t,n={}){this.timeoutEnterIdle=1e3,this.timeoutSocketLowerBound=1e4,this.timeoutSocketMultiplier=.1,this.options=n,this.port=t||(this.options.useSecureTransport?993:143),this.host=e||"localhost",this.options.useSecureTransport="useSecureTransport"in this.options?!!this.options.useSecureTransport:993===this.port,this.secureMode=!!this.options.useSecureTransport,this._connectionReady=!1,this._globalAcceptUntagged={},this._clientQueue=[],this._canSend=!1,this._tagCounter=0,this._currentCommand=!1,this._idleTimer=!1,this._socketTimeoutTimer=!1,this.compressed=!1,this._incomingBuffers=[],this._bufferState=wt,this._literalRemaining=0,this.oncert=null,this.onerror=null,this.onready=null,this.onidle=null}connect(e=tt.Z){return new Promise(((t,n)=>{this.socket=e.open(this.host,this.port,{binaryType:"arraybuffer",useSecureTransport:this.secureMode,ca:this.options.ca});try{this.socket.oncert=e=>{this.oncert&&this.oncert(e)}}catch(e){}this.socket.onclose=()=>this._onError(new Error("Socket closed unexpectedly!")),this.socket.ondata=e=>{try{this._onData(e)}catch(e){this._onError(e)}},this.socket.onerror=e=>{n(new Error("Could not open socket: "+e.data.message))},this.socket.onopen=()=>{this.socket.onerror=e=>this._onError(e),t()}}))}close(e){return new Promise((t=>{var n=()=>{if(this._clientQueue.forEach((t=>t.callback(e))),this._currentCommand&&this._currentCommand.callback(e),this._clientQueue=[],this._currentCommand=!1,clearTimeout(this._idleTimer),this._idleTimer=null,clearTimeout(this._socketTimeoutTimer),this._socketTimeoutTimer=null,this.socket){this.socket.onopen=null,this.socket.onclose=null,this.socket.ondata=null,this.socket.onerror=null;try{this.socket.oncert=null}catch(e){}this.socket=null}t()};if(this._disableCompression(),!this.socket||"open"!==this.socket.readyState)return n();this.socket.onclose=this.socket.onerror=n,this.socket.close()}))}logout(){return new Promise(((e,t)=>{this.socket.onclose=this.socket.onerror=()=>{this.close("Client logging out").then(e).catch(t)},this.enqueueCommand("LOGOUT")}))}upgrade(){this.secureMode=!0,this.socket.upgradeToSecure()}enqueueCommand(e,t,n){"string"==typeof e&&(e={command:e}),t=[].concat(t||[]).map((e=>(e||"").toString().toUpperCase().trim()));var a="W"+ ++this._tagCounter;return e.tag=a,new Promise(((s,i)=>{var r={tag:a,request:e,payload:t.length?{}:void 0,callback:e=>{if(this.isError(e))return i(e);{const n=d("","command",e).toUpperCase().trim();if(["NO","BAD"].includes(n)){var t=new Error(e.humanReadable||"Error");return t.command=n,e.code&&(t.code=e.code),i(t)}}s(e)}};Object.keys(n||{}).forEach((e=>{r[e]=n[e]})),t.forEach((e=>{r.payload[e]=[]}));var o=r.ctx?this._clientQueue.indexOf(r.ctx):-1;o>=0?(r.tag+=".p",r.request.tag+=".p",this._clientQueue.splice(o,0,r)):this._clientQueue.push(r),this._canSend&&this._sendRequest()}))}getPreviouslyQueued(e,t){for(let e=this._clientQueue.indexOf(t)-1;e>=0;e--)if(n(this._clientQueue[e]))return this._clientQueue[e];return!!n(this._currentCommand)&&this._currentCommand;function n(t){return t&&t.request&&e.indexOf(t.request.command)>=0}}send(e){const t=Ye(e).buffer;this._resetSocketTimeout(t.byteLength),this.compressed?this._sendCompressed(t):this.socket.send(t)}setHandler(e,t){this._globalAcceptUntagged[e.toUpperCase().trim()]=t}_onError(e){var t;t=this.isError(e)?e:e&&this.isError(e.data)?e.data:new Error(e&&e.data&&e.data.message||e.data||e||"Error"),this.onerror||this.logger.error(t),this.close(t).then((()=>{this.onerror&&this.onerror(t)}),(()=>{this.onerror&&this.onerror(t)}))}_onData(e){this._resetSocketTimeout(),this._incomingBuffers.push(new Uint8Array(e.data)),this._parseIncomingCommands(this._iterateIncomingBuffer())}*_iterateIncomingBuffer(){let e=this._incomingBuffers[this._incomingBuffers.length-1]||[],t=0;for(;t<e.length;)switch(this._bufferState){case pt:const n=Math.min(e.length-t,this._literalRemaining);this._literalRemaining-=n,t+=n,0===this._literalRemaining&&(this._bufferState=wt);continue;case mt:t<e.length&&(13===e[t]?(this._literalRemaining=Number(Xe(this._lengthBuffer))+2,this._bufferState=pt):this._bufferState=wt,delete this._lengthBuffer);continue;case gt:const a=t;for(;t<e.length&&e[t]>=48&&e[t]<=57;)t++;if(a!==t){const n=e.subarray(a,t),s=this._lengthBuffer;this._lengthBuffer=new Uint8Array(s.length+n.length),this._lengthBuffer.set(s),this._lengthBuffer.set(n,s.length)}t<e.length&&(this._lengthBuffer.length>0&&125===e[t]?this._bufferState=mt:(delete this._lengthBuffer,this._bufferState=wt),t++);continue;default:const s=e.indexOf(123,t);if(s>-1){if(-1===new Uint8Array(e.buffer,t,s-t).indexOf(10)){t=s+1,this._lengthBuffer=new Uint8Array(0),this._bufferState=gt;continue}}const i=e.indexOf(10,t);if(!(i>-1))return;{i<e.length-1&&(this._incomingBuffers[this._incomingBuffers.length-1]=new Uint8Array(e.buffer,0,i+1));const n=this._incomingBuffers.reduce(((e,t)=>e+t.length),0)-2,a=new Uint8Array(n);let s=0;for(;this._incomingBuffers.length>0;){let e=this._incomingBuffers.shift();const t=n-s;if(e.length>t){const n=e.length-t;e=e.subarray(0,-n),this._incomingBuffers.length>0&&(this._incomingBuffers=[])}a.set(e,s),s+=e.length}if(yield a,!(i<e.length-1))return clearTimeout(this._socketTimeoutTimer),void(this._socketTimeoutTimer=null);e=new Uint8Array(e.subarray(i+1)),this._incomingBuffers.push(e),t=0}}}_parseIncomingCommands(e){for(var t of e)if(this._clearIdle(),43!==t[0]){var n;try{const e=this._currentCommand.request&&this._currentCommand.request.valueAsString;n=We(t,{valueAsString:e}),this.logger.debug("S:",(()=>ke(n,!1,!0)))}catch(e){return this.logger.error("Error parsing imap command!",n),this._onError(e)}this._processResponse(n),this._handleResponse(n),this._connectionReady||(this._connectionReady=!0,this.onready&&this.onready())}else if(this._currentCommand.data.length){var a=this._currentCommand.data.shift();a+=this._currentCommand.data.length?"":ft,this.send(a)}else this._currentCommand.errorResponseExpectsEmptyLine&&this.send(ft)}_handleResponse(e){var t=d("","command",e).toUpperCase().trim();this._currentCommand?this._currentCommand.payload&&"*"===e.tag&&t in this._currentCommand.payload?(this._currentCommand.payload[t].push(e),this._resetSocketTimeout()):"*"===e.tag&&t in this._globalAcceptUntagged?(this._globalAcceptUntagged[t](e),this._resetSocketTimeout()):e.tag===this._currentCommand.tag&&(this._currentCommand.payload&&Object.keys(this._currentCommand.payload).length&&(e.payload=this._currentCommand.payload),this._currentCommand.callback(e),this._canSend=!0,this._sendRequest()):"*"===e.tag&&t in this._globalAcceptUntagged&&(this._globalAcceptUntagged[t](e),this._canSend=!0,this._sendRequest())}_sendRequest(){if(!this._clientQueue.length)return this._currentCommand=!1,this._enterIdle();this._clearIdle(),this._restartQueue=!1;var e=this._clientQueue[0];if("function"==typeof e.precheck){var t=e,n=t.precheck;return delete t.precheck,this._restartQueue=!0,void n(t).then((()=>{this._restartQueue&&this._sendRequest()})).catch((e=>{let n;const a=this._clientQueue.indexOf(t);a>=0&&(n=this._clientQueue.splice(a,1)[0]),n&&n.callback&&(n.callback(e),this._canSend=!0,this._parseIncomingCommands(this._iterateIncomingBuffer()),this._sendRequest())}))}this._canSend=!1,this._currentCommand=this._clientQueue.shift();try{this._currentCommand.data=ke(this._currentCommand.request,!0),this.logger.debug("C:",(()=>ke(this._currentCommand.request,!1,!0)))}catch(e){return this.logger.error("Error compiling imap command!",this._currentCommand.request),this._onError(new Error("Error compiling imap command!"))}var a=this._currentCommand.data.shift();return this.send(a+(this._currentCommand.data.length?"":ft)),this.waitDrain}_enterIdle(){clearTimeout(this._idleTimer),this._idleTimer=setTimeout((()=>this.onidle&&this.onidle()),this.timeoutEnterIdle)}_clearIdle(){clearTimeout(this._idleTimer),this._idleTimer=null}_processResponse(e){const t=d("","command",e).toUpperCase().trim();if(e&&e.attributes&&e.attributes.length&&("*"===e.tag&&/^\d+$/.test(e.command)&&"ATOM"===e.attributes[0].type&&(e.nr=Number(e.command),e.command=(e.attributes.shift().value||"").toString().toUpperCase().trim()),!(["OK","NO","BAD","BYE","PREAUTH"].indexOf(t)<0)&&("TEXT"===e.attributes[e.attributes.length-1].type&&(e.humanReadable=e.attributes[e.attributes.length-1].value),"ATOM"===e.attributes[0].type&&e.attributes[0].section))){const t=e.attributes[0].section.map((e=>{if(e)return Array.isArray(e)?e.map((e=>(e.value||"").toString().trim())):(e.value||"").toString().toUpperCase().trim()})),n=t.shift();e.code=n,1===t.length?e[n.toLowerCase()]=t[0]:t.length>1&&(e[n.toLowerCase()]=t)}}isError(e){return!!Object.prototype.toString.call(e).match(/Error\]$/)}enableCompression(){if(this._socketOnData=this.socket.ondata,this.compressed=!0,"undefined"!=typeof window&&window.Worker)this._compressionWorker=new Worker(URL.createObjectURL(new Blob([ht()]))),this._compressionWorker.onmessage=e=>{var t=e.data.message,n=e.data.buffer;switch(t){case"inflated_ready":this._socketOnData({data:n});break;case"deflated_ready":this.waitDrain=this.socket.send(n)}},this._compressionWorker.onerror=e=>{this._onError(new Error("Error handling compression web worker: "+e.message))},this._compressionWorker.postMessage(bt("start"));else{const e=e=>{this._socketOnData({data:e})},t=e=>{this.waitDrain=this.socket.send(e)};this._compression=new dt(e,t)}this.socket.ondata=e=>{this.compressed&&(this._compressionWorker?this._compressionWorker.postMessage(bt("inflate",e.data),[e.data]):this._compression.inflate(e.data))}}_disableCompression(){this.compressed&&(this.compressed=!1,this.socket.ondata=this._socketOnData,this._socketOnData=null,this._compressionWorker&&(this._compressionWorker.terminate(),this._compressionWorker=null))}_sendCompressed(e){this._compressionWorker?this._compressionWorker.postMessage(bt("deflate",e),[e]):this._compression.deflate(e)}_resetSocketTimeout(e){clearTimeout(this._socketTimeoutTimer);const t=this.timeoutSocketLowerBound+Math.floor((e||4096)*this.timeoutSocketMultiplier);this._socketTimeoutTimer=setTimeout((()=>this._onError(new Error(" Socket timed out!"))),t)}}const bt=(e,t)=>({message:e,buffer:t}),yt=["\\All","\\Archive","\\Drafts","\\Flagged","\\Junk","\\Sent","\\Trash"],vt={"\\Sent":["aika","bidaliak","bidalita","dihantar","e rometsweng","e tindami","elküldött","elküldöttek","enviadas","enviadas","enviados","enviats","envoyés","ethunyelweyo","expediate","ezipuru","gesendete","gestuur","gönderilmiş öğeler","göndərilənlər","iberilen","inviati","išsiųstieji","kuthunyelwe","lasa","lähetetyt","messages envoyés","naipadala","nalefa","napadala","nosūtītās ziņas","odeslané","padala","poslane","poslano","poslano","poslané","poslato","saadetud","saadetud kirjad","sendt","sendt","sent","sent items","sent messages","sända poster","sänt","terkirim","ti fi ranṣẹ","të dërguara","verzonden","vilivyotumwa","wysłane","đã gửi","σταλθέντα","жиберилген","жіберілгендер","изпратени","илгээсэн","ирсол шуд","испратено","надіслані","отправленные","пасланыя","юборилган","ուղարկված","נשלחו","פריטים שנשלחו","المرسلة","بھیجے گئے","سوزمژہ","لېګل شوی","موارد ارسال شده","पाठविले","पाठविलेले","प्रेषित","भेजा गया","প্রেরিত","প্রেরিত","প্ৰেৰিত","ਭੇਜੇ","મોકલેલા","ପଠାଗଲା","அனுப்பியவை","పంపించబడింది","ಕಳುಹಿಸಲಾದ","അയച്ചു","යැවු පණිවුඩ","ส่งแล้ว","გაგზავნილი","የተላኩ","បាន​ផ្ញើ","寄件備份","寄件備份","已发信息","送信済みﾒｰﾙ","발신 메시지","보낸 편지함"],"\\Trash":["articole șterse","bin","borttagna objekt","deleted","deleted items","deleted messages","elementi eliminati","elementos borrados","elementos eliminados","gelöschte objekte","item dipadam","itens apagados","itens excluídos","mục đã xóa","odstraněné položky","pesan terhapus","poistetut","praht","prügikast","silinmiş öğeler","slettede beskeder","slettede elementer","trash","törölt elemek","usunięte wiadomości","verwijderde items","vymazané správy","éléments supprimés","видалені","жойылғандар","удаленные","פריטים שנמחקו","العناصر المحذوفة","موارد حذف شده","รายการที่ลบ","已删除邮件","已刪除項目","已刪除項目"],"\\Junk":["bulk mail","correo no deseado","courrier indésirable","istenmeyen","istenmeyen e-posta","junk","levélszemét","nevyžiadaná pošta","nevyžádaná pošta","no deseado","posta indesiderata","pourriel","roskaposti","skräppost","spam","spam","spamowanie","søppelpost","thư rác","спам","דואר זבל","الرسائل العشوائية","هرزنامه","สแปม","‎垃圾郵件","垃圾邮件","垃圾電郵"],"\\Drafts":["ba brouillon","borrador","borrador","borradores","bozze","brouillons","bản thảo","ciorne","concepten","draf","drafts","drög","entwürfe","esborranys","garalamalar","ihe edeturu","iidrafti","izinhlaka","juodraščiai","kladd","kladder","koncepty","koncepty","konsep","konsepte","kopie robocze","layihələr","luonnokset","melnraksti","meralo","mesazhe të padërguara","mga draft","mustandid","nacrti","nacrti","osnutki","piszkozatok","rascunhos","rasimu","skice","taslaklar","tsararrun saƙonni","utkast","vakiraoka","vázlatok","zirriborroak","àwọn àkọpamọ́","πρόχειρα","жобалар","нацрти","нооргууд","сиёҳнавис","хомаки хатлар","чарнавікі","чернетки","чернови","черновики","черновиктер","սևագրեր","טיוטות","مسودات","مسودات","موسودې","پیش نویسها","ڈرافٹ/","ड्राफ़्ट","प्रारूप","খসড়া","খসড়া","ড্ৰাফ্ট","ਡ੍ਰਾਫਟ","ડ્રાફ્ટસ","ଡ୍ରାଫ୍ଟ","வரைவுகள்","చిత్తు ప్రతులు","ಕರಡುಗಳು","കരടുകള്‍","කෙටුම් පත්","ฉบับร่าง","მონახაზები","ረቂቆች","សារព្រាង","下書き","草稿","草稿","草稿","임시 보관함"],"\\Archive":["archive","archives"]},It=Object.keys(vt);function Et(e){if(e.flags)for(let t=0;t<yt.length;t++){const n=yt[t];if((e.flags||[]).indexOf(n)>=0)return e.specialUse=n,e.specialUseFlag=n,n}return function(e){const t=d("","name",e).toLowerCase().trim();for(let n=0;n<It.length;n++){const a=It[n];if(vt[a].indexOf(t)>=0)return e.specialUse=a,a}return!1}(e)}const kt={name:"emailjs-imap-client"};const xt=class{constructor(e,t,n={}){this.timeoutConnection=9e4,this.timeoutNoop=6e4,this.timeoutIdle=6e4,this.serverId=!1,this.oncert=null,this.onupdate=null,this.onselectmailbox=null,this.onclosemailbox=null,this._host=e,this._clientId=d(kt,"id",n),this._state=!1,this._authenticated=!1,this._capability=[],this._humanReadable="",this._okGreeting="",this._selectedMailbox=!1,this._enteredIdle=!1,this._idleTimeout=!1,this._enableCompression=!!n.enableCompression,this._auth=n.auth,this._requireTLS=!!n.requireTLS,this._ignoreTLS=!!n.ignoreTLS,this.client=new _t(e,t,n),this.client.onerror=this._onError.bind(this),this.client.oncert=e=>this.oncert&&this.oncert(e),this.client.onidle=()=>this._onIdle(),this.client.setHandler("capability",(e=>this._untaggedCapabilityHandler(e))),this.client.setHandler("ok",(e=>this._untaggedOkHandler(e))),this.client.setHandler("exists",(e=>this._untaggedExistsHandler(e))),this.client.setHandler("expunge",(e=>this._untaggedExpungeHandler(e))),this.client.setHandler("fetch",(e=>this._untaggedFetchHandler(e))),this.createLogger(n.logger),this.logLevel=d(0,"logLevel",n)}_onError(e){clearTimeout(this._idleTimeout),this.onerror&&this.onerror(e)}async connect(){try{await this.openConnection(),await this.upgradeConnection();try{await this.updateId(this._clientId)}catch(e){if("BAD"!==e.command)throw e;this.logger.warn("Failed to update server id!",e.message)}await this.login(this._auth),await this.compressConnection(),this.logger.debug("Connection established, ready to roll!"),this.client.onerror=this._onError.bind(this)}catch(e){throw this.logger.error("Could not connect to server",e),this.close(e),e}}openConnection(){return new Promise(((e,t)=>{const n=setTimeout((()=>t(new Error("Timeout connecting to server"))),this.timeoutConnection);this.logger.debug("Connecting to",this.client.host,":",this.client.port),this._changeState(1),this.client.connect().then((()=>{this.logger.debug("Socket opened, waiting for greeting from the server..."),this.client.onready=()=>{clearTimeout(n),this._changeState(2),this._okGreeting=this._humanReadable,this.updateCapability().then((()=>e(this._capability)))},this.client.onerror=e=>{clearTimeout(n),t(e)}})).catch(t)}))}async logout(){this._changeState(5),this.logger.debug("Logging out..."),await this.client.logout(),clearTimeout(this._idleTimeout)}async close(e){this._changeState(5),clearTimeout(this._idleTimeout),this.logger.debug("Closing connection..."),await this.client.close(e),clearTimeout(this._idleTimeout)}async updateId(e){if(this._capability.indexOf("ID")<0)return;this.logger.debug("Updating id...");const t=e?[g(Object.entries(e))]:[null],n=await this.exec({command:"ID",attributes:t},"ID"),a=g(l([],["payload","ID","0","attributes","0"],n).map(Object.values)),s=a.filter(((e,t)=>t%2==0)),i=a.filter(((e,t)=>t%2==1));this.serverId=m(w(s,i)),this.logger.debug("Server id updated!",this.serverId)}_shouldSelectMailbox(e,t){if(!t)return!0;const n=this.client.getPreviouslyQueued(["SELECT","EXAMINE"],t);if(n&&n.request.attributes){const t=n.request.attributes.find((e=>"STRING"===e.type));if(t)return t.value!==e}return this._selectedMailbox!==e}async selectMailbox(e,t={}){const n={command:t.readOnly?"EXAMINE":"SELECT",attributes:[{type:"STRING",value:e}]};t.condstore&&this._capability.indexOf("CONDSTORE")>=0&&n.attributes.push([{type:"ATOM",value:"CONDSTORE"}]),this.logger.debug("Opening",e,"...");const a=function(e){if(!e||!e.payload)return;const t={readOnly:"READ-ONLY"===e.code},n=e.payload.EXISTS&&e.payload.EXISTS.pop(),a=e.payload.FLAGS&&e.payload.FLAGS.pop(),s=e.payload.OK;return n&&(t.exists=n.nr||0),a&&a.attributes&&a.attributes.length&&(t.flags=a.attributes[0].map((e=>(e.value||"").toString().trim()))),[].concat(s||[]).forEach((e=>{switch(e&&e.code){case"PERMANENTFLAGS":t.permanentFlags=[].concat(e.permanentflags||[]);break;case"UIDVALIDITY":t.uidValidity=Number(e.uidvalidity)||0;break;case"UIDNEXT":t.uidNext=Number(e.uidnext)||0;break;case"HIGHESTMODSEQ":t.highestModseq=e.highestmodseq||"0";break;case"NOMODSEQ":t.noModseq=!0}})),t}(await this.exec(n,["EXISTS","FLAGS","OK"],{ctx:t.ctx}));return this._changeState(4),this._selectedMailbox!==e&&this.onclosemailbox&&await this.onclosemailbox(this._selectedMailbox),this._selectedMailbox=e,this.onselectmailbox&&await this.onselectmailbox(e,a),a}async subscribeMailbox(e){return this.logger.debug("Subscribing to mailbox",e,"..."),this.exec({command:"SUBSCRIBE",attributes:[e]})}async unsubscribeMailbox(e){return this.logger.debug("Unsubscribing to mailbox",e,"..."),this.exec({command:"UNSUBSCRIBE",attributes:[e]})}async listNamespaces(){if(this._capability.indexOf("NAMESPACE")<0)return!1;this.logger.debug("Listing namespaces...");return function(e){if(!e.payload||!e.payload.NAMESPACE||!e.payload.NAMESPACE.length)return!1;const t=[].concat(e.payload.NAMESPACE.pop().attributes||[]);return!!t.length&&{personal:Fe(t[0]),users:Fe(t[1]),shared:Fe(t[2])}}(await this.exec("NAMESPACE","NAMESPACE"))}async listMailboxes(){const e={root:!0,children:[]};this.logger.debug("Listing mailboxes...");const t=await this.exec({command:"LIST",attributes:["","*"]},"LIST");let n;if(l([],["payload","LIST"],t).forEach((t=>{const n=d([],"attributes",t);if(n.length<3)return;const a=l("",["2","value"],n),s=l("/",["1","value"],n),i=this._ensurePath(e,a,s);i.flags=d([],"0",n).map((({value:e})=>e||"")),i.listed=!0,Et(i)})),this._capability.indexOf("LIST-EXTENDED")>-1){const e=await this.exec({command:"LIST (SUBSCRIBED)",attributes:["","*"]},"LIST");n=l([],["payload","LIST"],e)}else{const e=await this.exec({command:"LSUB",attributes:["","*"]},"LSUB");n=l([],["payload","LSUB"],e)}return n.forEach((t=>{const n=d([],"attributes",t);if(n.length<3)return;const a=l("",["2","value"],n),s=l("/",["1","value"],n),i=this._ensurePath(e,a,s);d([],"0",n).map(((e="")=>{i.flags=ee(i.flags,[e])})),i.subscribed=!0})),e}async createMailbox(e){this.logger.debug("Creating mailbox",e,"...");try{await this.exec({command:"CREATE",attributes:[e]})}catch(e){if(e&&"ALREADYEXISTS"===e.code)return;throw e}}deleteMailbox(e){return this.logger.debug("Deleting mailbox",e,"..."),this.exec({command:"DELETE",attributes:[e]})}async listMessages(e,t,n=[{fast:!0}],a={}){this.logger.debug("Fetching messages",t,"from",e,"...");const s=function(e,t,n){const a={command:n.byUid?"UID FETCH":"FETCH",attributes:[{type:"SEQUENCE",value:e}]};void 0!==n.valueAsString&&(a.valueAsString=n.valueAsString);let s=[];return t.forEach((e=>{if(e=e.toUpperCase().trim(),/^\w+$/.test(e))s.push({type:"ATOM",value:e});else if(e)try{const t=We(Ye("* Z "+e));s=s.concat(t.attributes||[])}catch(t){s.push({type:"ATOM",value:e})}})),1===s.length&&(s=s.pop()),a.attributes.push(s),n.changedSince&&a.attributes.push([{type:"ATOM",value:"CHANGEDSINCE"},{type:"ATOM",value:n.changedSince}]),a}(t,n,a);return $e(await this.exec(s,"FETCH",{precheck:t=>this._shouldSelectMailbox(e,t)?this.selectMailbox(e,{ctx:t}):Promise.resolve()}))}async search(e,t,n={}){this.logger.debug("Searching in",e,"...");const a=function(e={},t={}){const n={command:t.byUid?"UID SEARCH":"SEARCH"};let a=!0;const s=e=>{let t=[];return Object.keys(e).forEach((n=>{let i=[];const r=e=>{return"number"==typeof e?{type:"number",value:e}:"string"==typeof e?/[\u0080-\uFFFF]/.test(e)?(a=!1,{type:"literal",value:Xe((0,Ce.cv)(e))}):{type:"string",value:e}:"[object Date]"===Object.prototype.toString.call(e)?{type:"atom",value:(t=e,t.toUTCString().replace(/^\w+, 0?(\d+) (\w+) (\d+).*/,"$1-$2-$3"))}:Array.isArray(e)?e.map(r):"object"==typeof e?s(e):void 0;var t};i.push({type:"atom",value:n.toUpperCase()}),[].concat(e[n]||[]).forEach((e=>{switch(n.toLowerCase()){case"uid":e={type:"sequence",value:e};break;case"x-gm-thrid":case"x-gm-msgid":e={type:"number",value:e};break;default:e=r(e)}e&&(i=i.concat(e||[]))})),t=t.concat(i||[])})),t};return n.attributes=s(e),a||(n.attributes.unshift({type:"atom",value:"UTF-8"}),n.attributes.unshift({type:"atom",value:"CHARSET"})),n}(t,n);return function(e){const t=[];if(!e)throw new Error("parseSEARCH can not parse undefined response");return e.payload&&e.payload.SEARCH&&e.payload.SEARCH.length?(e.payload.SEARCH.forEach((e=>(e.attributes||[]).forEach((e=>{e=Number(e&&e.value||e)||0;const n=function(e,t,n=((e,t)=>e-t)){for(var a,s,i=0,r=e.length-1;i<=r;)if((s=+n(e[a=i+(r-i>>1)],t))<0)i=a+1;else{if(!(s>0))return a;r=a-1}return~i}(t,e);n<0&&t.splice(-n-1,0,e)})))),t):t}(await this.exec(a,"SEARCH",{precheck:t=>this._shouldSelectMailbox(e,t)?this.selectMailbox(e,{ctx:t}):Promise.resolve()}))}setFlags(e,t,n,a){let s="",i=[];return Array.isArray(n)||"object"!=typeof n?(i=[].concat(n||[]),s=""):n.add?(i=[].concat(n.add||[]),s="+"):n.set?(s="",i=[].concat(n.set||[])):n.remove&&(s="-",i=[].concat(n.remove||[])),this.logger.debug("Setting flags on",t,"in",e,"..."),this.store(e,t,s+"FLAGS",i,a)}async store(e,t,n,a,s={}){const i=function(e,t="",n=[],a={}){const s={command:a.byUid?"UID STORE":"STORE",attributes:[{type:"sequence",value:e}]};return s.attributes.push({type:"atom",value:t.toUpperCase()+(a.silent?".SILENT":"")}),s.attributes.push(n.map((e=>({type:"atom",value:e})))),s}(t,n,a,s);return $e(await this.exec(i,"FETCH",{precheck:t=>this._shouldSelectMailbox(e,t)?this.selectMailbox(e,{ctx:t}):Promise.resolve()}))}async upload(e,t,n={}){const a={command:"APPEND",attributes:[{type:"atom",value:e},d(["\\Seen"],"flags",n).map((e=>({type:"atom",value:e}))),{type:"literal",value:t}]};this.logger.debug("Uploading message to",e,"...");return function(e){return e&&e.appenduid&&e.appenduid[1]}(await this.exec(a))}async deleteMessages(e,t,n={}){this.logger.debug("Deleting messages",t,"in",e,"...");const a=n.byUid&&this._capability.indexOf("UIDPLUS")>=0,s={command:"UID EXPUNGE",attributes:[{type:"sequence",value:t}]};await this.setFlags(e,t,{add:"\\Deleted"},n);const i=a?s:"EXPUNGE";return this.exec(i,null,{precheck:t=>this._shouldSelectMailbox(e,t)?this.selectMailbox(e,{ctx:t}):Promise.resolve()})}async copyMessages(e,t,n,a={}){this.logger.debug("Copying messages",t,"from",e,"to",n,"...");return function(e){const t=e&&e.copyuid;if(t)return{srcSeqSet:t[1],destSeqSet:t[2]}}(await this.exec({command:a.byUid?"UID COPY":"COPY",attributes:[{type:"sequence",value:t},{type:"atom",value:n}]},null,{precheck:t=>this._shouldSelectMailbox(e,t)?this.selectMailbox(e,{ctx:t}):Promise.resolve()}))}async moveMessages(e,t,n,a={}){return this.logger.debug("Moving messages",t,"from",e,"to",n,"..."),-1===this._capability.indexOf("MOVE")?(await this.copyMessages(e,t,n,a),this.deleteMessages(e,t,a)):this.exec({command:a.byUid?"UID MOVE":"MOVE",attributes:[{type:"sequence",value:t},{type:"atom",value:n}]},["OK"],{precheck:t=>this._shouldSelectMailbox(e,t)?this.selectMailbox(e,{ctx:t}):Promise.resolve()})}async compressConnection(){if(!this._enableCompression||this._capability.indexOf("COMPRESS=DEFLATE")<0||this.client.compressed)return!1;this.logger.debug("Enabling compression..."),await this.exec({command:"COMPRESS",attributes:[{type:"ATOM",value:"DEFLATE"}]}),this.client.enableCompression(),this.logger.debug("Compression enabled, all data sent and received is deflated!")}async login(e){let t;const n={};if(!e)throw new Error("Authentication information not provided");this._capability.indexOf("AUTH=XOAUTH2")>=0&&e&&e.xoauth2?(t={command:"AUTHENTICATE",attributes:[{type:"ATOM",value:"XOAUTH2"},{type:"ATOM",value:Je(e.user,e.xoauth2),sensitive:!0}]},n.errorResponseExpectsEmptyLine=!0):t={command:"login",attributes:[{type:"STRING",value:e.user||""},{type:"STRING",value:e.pass||"",sensitive:!0}]},this.logger.debug("Logging in...");const a=await this.exec(t,"capability",n);a.capability&&a.capability.length?this._capability=a.capability:a.payload&&a.payload.CAPABILITY&&a.payload.CAPABILITY.length?this._capability=a.payload.CAPABILITY.pop().attributes.map(((e="")=>e.value.toUpperCase().trim())):await this.updateCapability(!0),this._changeState(3),this._authenticated=!0,this.logger.debug("Login successful, post-auth capabilites updated!",this._capability)}async exec(e,t,n){this.breakIdle();const a=await this.client.enqueueCommand(e,t,n);return a&&a.capability&&(this._capability=a.capability),a}enterIdle(){if(this._enteredIdle)return;const e=this._capability.indexOf("IDLE")>=0;this._enteredIdle=e&&this._selectedMailbox?"IDLE":"NOOP",this.logger.debug("Entering idle with "+this._enteredIdle),"NOOP"===this._enteredIdle?this._idleTimeout=setTimeout((()=>{this.logger.debug("Sending NOOP"),this.exec("NOOP").catch((e=>this.logger.error("Could not idle (NOOP)",e)))}),this.timeoutNoop):"IDLE"===this._enteredIdle&&(this.client.enqueueCommand({command:"IDLE"}).catch((e=>this.logger.error("Could not idle (IDLE)",e))),this._idleTimeout=setTimeout((()=>{this.client.send("DONE\r\n"),this._enteredIdle=!1,this.logger.debug("Idle terminated")}),this.timeoutIdle))}breakIdle(){this._enteredIdle&&(clearTimeout(this._idleTimeout),"IDLE"===this._enteredIdle&&(this.client.send("DONE\r\n"),this.logger.debug("Idle terminated")),this._enteredIdle=!1)}async upgradeConnection(){return!this.client.secureMode&&(!((this._capability.indexOf("STARTTLS")<0||this._ignoreTLS)&&!this._requireTLS)&&(this.logger.debug("Encrypting connection..."),await this.exec("STARTTLS"),this._capability=[],this.client.upgrade(),this.updateCapability()))}async updateCapability(e){if((e||!this._capability.length)&&(this.client.secureMode||!this._requireTLS))return this.logger.debug("Updating capability..."),this.exec("CAPABILITY")}hasCapability(e=""){return this._capability.indexOf(e.toUpperCase().trim())>=0}getOkGreeting(){return this._okGreeting}_untaggedOkHandler(e){e&&(e.capability&&(this._capability=e.capability),this._humanReadable=e.humanReadable)}_untaggedCapabilityHandler(e){this._capability=L(d([],"attributes"),de((({value:e})=>(e||"").toUpperCase().trim())))(e)}_untaggedExistsHandler(e){e&&Object.prototype.hasOwnProperty.call(e,"nr")&&this.onupdate&&this.onupdate(this._selectedMailbox,"exists",e.nr)}_untaggedExpungeHandler(e){e&&Object.prototype.hasOwnProperty.call(e,"nr")&&this.onupdate&&this.onupdate(this._selectedMailbox,"expunge",e.nr)}_untaggedFetchHandler(e){this.onupdate&&this.onupdate(this._selectedMailbox,"fetch",[].concat($e({payload:{FETCH:[e]}})||[]).shift())}_onIdle(){this._authenticated&&!this._enteredIdle&&(this.logger.debug("Client started idling"),this.enterIdle())}_changeState(e){e!==this._state&&(this.logger.debug("Entering state: "+e),4===this._state&&this._selectedMailbox&&(this.onclosemailbox&&this.onclosemailbox(this._selectedMailbox),this._selectedMailbox=!1),this._state=e)}_ensurePath(e,t,n){const a=t.split(n);let s=e;for(let e=0;e<a.length;e++){let t=!1;for(let n=0;n<s.children.length;n++)if(this._compareMailboxNames(s.children[n].name,(0,ue.kF)(a[e]))){s=s.children[n],t=!0;break}t||(s.children.push({name:(0,ue.kF)(a[e]),delimiter:n,path:a.slice(0,e+1).join(n),children:[]}),s=s.children[s.children.length-1])}return s}_compareMailboxNames(e,t){return("INBOX"===e.toUpperCase()?"INBOX":e)===("INBOX"===t.toUpperCase()?"INBOX":t)}createLogger(e){const t=function(e,t,n=console){const a=++et,s=(s,i)=>{i=i.map((e=>"function"==typeof e?e():e));const r=`[${(new Date).toISOString()}][${a}][${e}][${t}] ${i.join(" ")}`;10===s?n.debug(r):20===s?n.info(r):30===s?n.warn(r):40===s&&n.error(r)};return{debug:e=>s(10,e),info:e=>s(20,e),warn:e=>s(30,e),error:e=>s(40,e)}}((this._auth||{}).user||"",this._host,e);this.logger=this.client.logger={debug:(...e)=>{10>=this.logLevel&&t.debug(e)},info:(...e)=>{20>=this.logLevel&&t.info(e)},warn:(...e)=>{30>=this.logLevel&&t.warn(e)},error:(...e)=>{40>=this.logLevel&&t.error(e)}}}}},16932:(e,t,n)=>{"use strict";const a=n(78501),s=n(58844),i=n(41192);e.exports={XMLParser:s,XMLValidator:a,XMLBuilder:i}},17849:(e,t)=>{"use strict";const n=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",a="["+n+"][:A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*",s=new RegExp("^"+a+"$");t.isExist=function(e){return void 0!==e},t.isEmptyObject=function(e){return 0===Object.keys(e).length},t.merge=function(e,t,n){if(t){const a=Object.keys(t),s=a.length;for(let i=0;i<s;i++)e[a[i]]="strict"===n?[t[a[i]]]:t[a[i]]}},t.getValue=function(e){return t.isExist(e)?e:""},t.isName=function(e){const t=s.exec(e);return!(null==t)},t.getAllMatches=function(e,t){const n=[];let a=t.exec(e);for(;a;){const s=[];s.startIndex=t.lastIndex-a[0].length;const i=a.length;for(let e=0;e<i;e++)s.push(a[e]);n.push(s),a=t.exec(e)}return n},t.nameRegexp=a},78501:(e,t,n)=>{"use strict";const a=n(17849),s={allowBooleanAttributes:!1,unpairedTags:[]};function i(e){return" "===e||"\t"===e||"\n"===e||"\r"===e}function r(e,t){const n=t;for(;t<e.length;t++)if("?"!=e[t]&&" "!=e[t]);else{const a=e.substr(n,t-n);if(t>5&&"xml"===a)return h("InvalidXml","XML declaration allowed only at the start of the document.",p(e,t));if("?"==e[t]&&">"==e[t+1]){t++;break}}return t}function o(e,t){if(e.length>t+5&&"-"===e[t+1]&&"-"===e[t+2]){for(t+=3;t<e.length;t++)if("-"===e[t]&&"-"===e[t+1]&&">"===e[t+2]){t+=2;break}}else if(e.length>t+8&&"D"===e[t+1]&&"O"===e[t+2]&&"C"===e[t+3]&&"T"===e[t+4]&&"Y"===e[t+5]&&"P"===e[t+6]&&"E"===e[t+7]){let n=1;for(t+=8;t<e.length;t++)if("<"===e[t])n++;else if(">"===e[t]&&(n--,0===n))break}else if(e.length>t+9&&"["===e[t+1]&&"C"===e[t+2]&&"D"===e[t+3]&&"A"===e[t+4]&&"T"===e[t+5]&&"A"===e[t+6]&&"["===e[t+7])for(t+=8;t<e.length;t++)if("]"===e[t]&&"]"===e[t+1]&&">"===e[t+2]){t+=2;break}return t}t.validate=function(e,t){t=Object.assign({},s,t);const n=[];let l=!1,f=!1;"\ufeff"===e[0]&&(e=e.substr(1));for(let s=0;s<e.length;s++)if("<"===e[s]&&"?"===e[s+1]){if(s+=2,s=r(e,s),s.err)return s}else{if("<"!==e[s]){if(i(e[s]))continue;return h("InvalidChar","char '"+e[s]+"' is not expected.",p(e,s))}{let m=s;if(s++,"!"===e[s]){s=o(e,s);continue}{let w=!1;"/"===e[s]&&(w=!0,s++);let _="";for(;s<e.length&&">"!==e[s]&&" "!==e[s]&&"\t"!==e[s]&&"\n"!==e[s]&&"\r"!==e[s];s++)_+=e[s];if(_=_.trim(),"/"===_[_.length-1]&&(_=_.substring(0,_.length-1),s--),g=_,!a.isName(g)){let t;return t=0===_.trim().length?"Invalid space after '<'.":"Tag '"+_+"' is an invalid name.",h("InvalidTag",t,p(e,s))}const b=c(e,s);if(!1===b)return h("InvalidAttr","Attributes for '"+_+"' have open quote.",p(e,s));let y=b.value;if(s=b.index,"/"===y[y.length-1]){const n=s-y.length;y=y.substring(0,y.length-1);const a=d(y,t);if(!0!==a)return h(a.err.code,a.err.msg,p(e,n+a.err.line));l=!0}else if(w){if(!b.tagClosed)return h("InvalidTag","Closing tag '"+_+"' doesn't have proper closing.",p(e,s));if(y.trim().length>0)return h("InvalidTag","Closing tag '"+_+"' can't have attributes or invalid starting.",p(e,m));{const t=n.pop();if(_!==t.tagName){let n=p(e,t.tagStartPos);return h("InvalidTag","Expected closing tag '"+t.tagName+"' (opened in line "+n.line+", col "+n.col+") instead of closing tag '"+_+"'.",p(e,m))}0==n.length&&(f=!0)}}else{const a=d(y,t);if(!0!==a)return h(a.err.code,a.err.msg,p(e,s-y.length+a.err.line));if(!0===f)return h("InvalidXml","Multiple possible root nodes found.",p(e,s));-1!==t.unpairedTags.indexOf(_)||n.push({tagName:_,tagStartPos:m}),l=!0}for(s++;s<e.length;s++)if("<"===e[s]){if("!"===e[s+1]){s++,s=o(e,s);continue}if("?"!==e[s+1])break;if(s=r(e,++s),s.err)return s}else if("&"===e[s]){const t=u(e,s);if(-1==t)return h("InvalidChar","char '&' is not expected.",p(e,s));s=t}else if(!0===f&&!i(e[s]))return h("InvalidXml","Extra text at the end",p(e,s));"<"===e[s]&&s--}}}var g;return l?1==n.length?h("InvalidTag","Unclosed tag '"+n[0].tagName+"'.",p(e,n[0].tagStartPos)):!(n.length>0)||h("InvalidXml","Invalid '"+JSON.stringify(n.map((e=>e.tagName)),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1}):h("InvalidXml","Start tag expected.",1)};function c(e,t){let n="",a="",s=!1;for(;t<e.length;t++){if('"'===e[t]||"'"===e[t])""===a?a=e[t]:a!==e[t]||(a="");else if(">"===e[t]&&""===a){s=!0;break}n+=e[t]}return""===a&&{value:n,index:t,tagClosed:s}}const l=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function d(e,t){const n=a.getAllMatches(e,l),s={};for(let e=0;e<n.length;e++){if(0===n[e][1].length)return h("InvalidAttr","Attribute '"+n[e][2]+"' has no space in starting.",g(n[e]));if(void 0!==n[e][3]&&void 0===n[e][4])return h("InvalidAttr","Attribute '"+n[e][2]+"' is without value.",g(n[e]));if(void 0===n[e][3]&&!t.allowBooleanAttributes)return h("InvalidAttr","boolean attribute '"+n[e][2]+"' is not allowed.",g(n[e]));const a=n[e][2];if(!f(a))return h("InvalidAttr","Attribute '"+a+"' is an invalid name.",g(n[e]));if(s.hasOwnProperty(a))return h("InvalidAttr","Attribute '"+a+"' is repeated.",g(n[e]));s[a]=1}return!0}function u(e,t){if(";"===e[++t])return-1;if("#"===e[t])return function(e,t){let n=/\d/;for("x"===e[t]&&(t++,n=/[\da-fA-F]/);t<e.length;t++){if(";"===e[t])return t;if(!e[t].match(n))break}return-1}(e,++t);let n=0;for(;t<e.length;t++,n++)if(!(e[t].match(/\w/)&&n<20)){if(";"===e[t])break;return-1}return t}function h(e,t,n){return{err:{code:e,msg:t,line:n.line||n,col:n.col}}}function f(e){return a.isName(e)}function p(e,t){const n=e.substring(0,t).split(/\r?\n/);return{line:n.length,col:n[n.length-1].length+1}}function g(e){return e.startIndex+e[1].length}},41192:(e,t,n)=>{"use strict";const a=n(82592),s={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function i(e){this.options=Object.assign({},s,e),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=c),this.processTextOrObjNode=r,this.options.format?(this.indentate=o,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}function r(e,t,n){const a=this.j2x(e,n+1);return void 0!==e[this.options.textNodeName]&&1===Object.keys(e).length?this.buildTextValNode(e[this.options.textNodeName],t,a.attrStr,n):this.buildObjectNode(a.val,t,a.attrStr,n)}function o(e){return this.options.indentBy.repeat(e)}function c(e){return!(!e.startsWith(this.options.attributeNamePrefix)||e===this.options.textNodeName)&&e.substr(this.attrPrefixLen)}i.prototype.build=function(e){return this.options.preserveOrder?a(e,this.options):(Array.isArray(e)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(e={[this.options.arrayNodeName]:e}),this.j2x(e,0).val)},i.prototype.j2x=function(e,t){let n="",a="";for(let s in e)if(Object.prototype.hasOwnProperty.call(e,s))if(void 0===e[s])this.isAttribute(s)&&(a+="");else if(null===e[s])this.isAttribute(s)?a+="":"?"===s[0]?a+=this.indentate(t)+"<"+s+"?"+this.tagEndChar:a+=this.indentate(t)+"<"+s+"/"+this.tagEndChar;else if(e[s]instanceof Date)a+=this.buildTextValNode(e[s],s,"",t);else if("object"!=typeof e[s]){const i=this.isAttribute(s);if(i)n+=this.buildAttrPairStr(i,""+e[s]);else if(s===this.options.textNodeName){let t=this.options.tagValueProcessor(s,""+e[s]);a+=this.replaceEntitiesValue(t)}else a+=this.buildTextValNode(e[s],s,"",t)}else if(Array.isArray(e[s])){const n=e[s].length;let i="";for(let r=0;r<n;r++){const n=e[s][r];void 0===n||(null===n?"?"===s[0]?a+=this.indentate(t)+"<"+s+"?"+this.tagEndChar:a+=this.indentate(t)+"<"+s+"/"+this.tagEndChar:"object"==typeof n?this.options.oneListGroup?i+=this.j2x(n,t+1).val:i+=this.processTextOrObjNode(n,s,t):i+=this.buildTextValNode(n,s,"",t))}this.options.oneListGroup&&(i=this.buildObjectNode(i,s,"",t)),a+=i}else if(this.options.attributesGroupName&&s===this.options.attributesGroupName){const t=Object.keys(e[s]),a=t.length;for(let i=0;i<a;i++)n+=this.buildAttrPairStr(t[i],""+e[s][t[i]])}else a+=this.processTextOrObjNode(e[s],s,t);return{attrStr:n,val:a}},i.prototype.buildAttrPairStr=function(e,t){return t=this.options.attributeValueProcessor(e,""+t),t=this.replaceEntitiesValue(t),this.options.suppressBooleanAttributes&&"true"===t?" "+e:" "+e+'="'+t+'"'},i.prototype.buildObjectNode=function(e,t,n,a){if(""===e)return"?"===t[0]?this.indentate(a)+"<"+t+n+"?"+this.tagEndChar:this.indentate(a)+"<"+t+n+this.closeTag(t)+this.tagEndChar;{let s="</"+t+this.tagEndChar,i="";return"?"===t[0]&&(i="?",s=""),!n&&""!==n||-1!==e.indexOf("<")?!1!==this.options.commentPropName&&t===this.options.commentPropName&&0===i.length?this.indentate(a)+`\x3c!--${e}--\x3e`+this.newLine:this.indentate(a)+"<"+t+n+i+this.tagEndChar+e+this.indentate(a)+s:this.indentate(a)+"<"+t+n+i+">"+e+s}},i.prototype.closeTag=function(e){let t="";return-1!==this.options.unpairedTags.indexOf(e)?this.options.suppressUnpairedNode||(t="/"):t=this.options.suppressEmptyNode?"/":`></${e}`,t},i.prototype.buildTextValNode=function(e,t,n,a){if(!1!==this.options.cdataPropName&&t===this.options.cdataPropName)return this.indentate(a)+`<![CDATA[${e}]]>`+this.newLine;if(!1!==this.options.commentPropName&&t===this.options.commentPropName)return this.indentate(a)+`\x3c!--${e}--\x3e`+this.newLine;if("?"===t[0])return this.indentate(a)+"<"+t+n+"?"+this.tagEndChar;{let s=this.options.tagValueProcessor(t,e);return s=this.replaceEntitiesValue(s),""===s?this.indentate(a)+"<"+t+n+this.closeTag(t)+this.tagEndChar:this.indentate(a)+"<"+t+n+">"+s+"</"+t+this.tagEndChar}},i.prototype.replaceEntitiesValue=function(e){if(e&&e.length>0&&this.options.processEntities)for(let t=0;t<this.options.entities.length;t++){const n=this.options.entities[t];e=e.replace(n.regex,n.val)}return e},e.exports=i},82592:e=>{function t(e,r,o,c){let l="",d=!1;for(let u=0;u<e.length;u++){const h=e[u],f=n(h);if(void 0===f)continue;let p="";if(p=0===o.length?f:`${o}.${f}`,f===r.textNodeName){let e=h[f];s(p,r)||(e=r.tagValueProcessor(f,e),e=i(e,r)),d&&(l+=c),l+=e,d=!1;continue}if(f===r.cdataPropName){d&&(l+=c),l+=`<![CDATA[${h[f][0][r.textNodeName]}]]>`,d=!1;continue}if(f===r.commentPropName){l+=c+`\x3c!--${h[f][0][r.textNodeName]}--\x3e`,d=!0;continue}if("?"===f[0]){const e=a(h[":@"],r),t="?xml"===f?"":c;let n=h[f][0][r.textNodeName];n=0!==n.length?" "+n:"",l+=t+`<${f}${n}${e}?>`,d=!0;continue}let g=c;""!==g&&(g+=r.indentBy);const m=c+`<${f}${a(h[":@"],r)}`,w=t(h[f],r,p,g);-1!==r.unpairedTags.indexOf(f)?r.suppressUnpairedNode?l+=m+">":l+=m+"/>":w&&0!==w.length||!r.suppressEmptyNode?w&&w.endsWith(">")?l+=m+`>${w}${c}</${f}>`:(l+=m+">",w&&""!==c&&(w.includes("/>")||w.includes("</"))?l+=c+r.indentBy+w+c:l+=w,l+=`</${f}>`):l+=m+"/>",d=!0}return l}function n(e){const t=Object.keys(e);for(let n=0;n<t.length;n++){const a=t[n];if(e.hasOwnProperty(a)&&":@"!==a)return a}}function a(e,t){let n="";if(e&&!t.ignoreAttributes)for(let a in e){if(!e.hasOwnProperty(a))continue;let s=t.attributeValueProcessor(a,e[a]);s=i(s,t),!0===s&&t.suppressBooleanAttributes?n+=` ${a.substr(t.attributeNamePrefix.length)}`:n+=` ${a.substr(t.attributeNamePrefix.length)}="${s}"`}return n}function s(e,t){let n=(e=e.substr(0,e.length-t.textNodeName.length-1)).substr(e.lastIndexOf(".")+1);for(let a in t.stopNodes)if(t.stopNodes[a]===e||t.stopNodes[a]==="*."+n)return!0;return!1}function i(e,t){if(e&&e.length>0&&t.processEntities)for(let n=0;n<t.entities.length;n++){const a=t.entities[n];e=e.replace(a.regex,a.val)}return e}e.exports=function(e,n){let a="";return n.format&&n.indentBy.length>0&&(a="\n"),t(e,n,"",a)}},74780:(e,t,n)=>{const a=n(17849);function s(e,t){let n="";for(;t<e.length&&"'"!==e[t]&&'"'!==e[t];t++)n+=e[t];if(n=n.trim(),-1!==n.indexOf(" "))throw new Error("External entites are not supported");const a=e[t++];let s="";for(;t<e.length&&e[t]!==a;t++)s+=e[t];return[n,s,t]}function i(e,t){return"!"===e[t+1]&&"-"===e[t+2]&&"-"===e[t+3]}function r(e,t){return"!"===e[t+1]&&"E"===e[t+2]&&"N"===e[t+3]&&"T"===e[t+4]&&"I"===e[t+5]&&"T"===e[t+6]&&"Y"===e[t+7]}function o(e,t){return"!"===e[t+1]&&"E"===e[t+2]&&"L"===e[t+3]&&"E"===e[t+4]&&"M"===e[t+5]&&"E"===e[t+6]&&"N"===e[t+7]&&"T"===e[t+8]}function c(e,t){return"!"===e[t+1]&&"A"===e[t+2]&&"T"===e[t+3]&&"T"===e[t+4]&&"L"===e[t+5]&&"I"===e[t+6]&&"S"===e[t+7]&&"T"===e[t+8]}function l(e,t){return"!"===e[t+1]&&"N"===e[t+2]&&"O"===e[t+3]&&"T"===e[t+4]&&"A"===e[t+5]&&"T"===e[t+6]&&"I"===e[t+7]&&"O"===e[t+8]&&"N"===e[t+9]}function d(e){if(a.isName(e))return e;throw new Error(`Invalid entity name ${e}`)}e.exports=function(e,t){const n={};if("O"!==e[t+3]||"C"!==e[t+4]||"T"!==e[t+5]||"Y"!==e[t+6]||"P"!==e[t+7]||"E"!==e[t+8])throw new Error("Invalid Tag instead of DOCTYPE");{t+=9;let a=1,u=!1,h=!1,f="";for(;t<e.length;t++)if("<"!==e[t]||h)if(">"===e[t]){if(h?"-"===e[t-1]&&"-"===e[t-2]&&(h=!1,a--):a--,0===a)break}else"["===e[t]?u=!0:f+=e[t];else{if(u&&r(e,t))t+=7,[entityName,val,t]=s(e,t+1),-1===val.indexOf("&")&&(n[d(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(u&&o(e,t))t+=8;else if(u&&c(e,t))t+=8;else if(u&&l(e,t))t+=9;else{if(!i)throw new Error("Invalid DOCTYPE");h=!0}a++,f=""}if(0!==a)throw new Error("Unclosed DOCTYPE")}return{entities:n,i:t}}},66745:(e,t)=>{const n={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(e,t,n){return e}};t.buildOptions=function(e){return Object.assign({},n,e)},t.defaultOptions=n},81078:(e,t,n)=>{"use strict";const a=n(17849),s=n(36311),i=n(74780),r=n(14153);function o(e){const t=Object.keys(e);for(let n=0;n<t.length;n++){const a=t[n];this.lastEntities[a]={regex:new RegExp("&"+a+";","g"),val:e[a]}}}function c(e,t,n,a,s,i,r){if(void 0!==e&&(this.options.trimValues&&!a&&(e=e.trim()),e.length>0)){r||(e=this.replaceEntitiesValue(e));const a=this.options.tagValueProcessor(t,e,n,s,i);if(null==a)return e;if(typeof a!=typeof e||a!==e)return a;if(this.options.trimValues)return y(e,this.options.parseTagValue,this.options.numberParseOptions);return e.trim()===e?y(e,this.options.parseTagValue,this.options.numberParseOptions):e}}function l(e){if(this.options.removeNSPrefix){const t=e.split(":"),n="/"===e.charAt(0)?"/":"";if("xmlns"===t[0])return"";2===t.length&&(e=n+t[1])}return e}const d=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");function u(e,t,n){if(!this.options.ignoreAttributes&&"string"==typeof e){const n=a.getAllMatches(e,d),s=n.length,i={};for(let e=0;e<s;e++){const a=this.resolveNameSpace(n[e][1]);let s=n[e][4],r=this.options.attributeNamePrefix+a;if(a.length)if(this.options.transformAttributeName&&(r=this.options.transformAttributeName(r)),"__proto__"===r&&(r="#__proto__"),void 0!==s){this.options.trimValues&&(s=s.trim()),s=this.replaceEntitiesValue(s);const e=this.options.attributeValueProcessor(a,s,t);i[r]=null==e?s:typeof e!=typeof s||e!==s?e:y(s,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(i[r]=!0)}if(!Object.keys(i).length)return;if(this.options.attributesGroupName){const e={};return e[this.options.attributesGroupName]=i,e}return i}}const h=function(e){e=e.replace(/\r\n?/g,"\n");const t=new s("!xml");let n=t,a="",r="";for(let o=0;o<e.length;o++){if("<"===e[o])if("/"===e[o+1]){const t=w(e,">",o,"Closing Tag is not closed.");let s=e.substring(o+2,t).trim();if(this.options.removeNSPrefix){const e=s.indexOf(":");-1!==e&&(s=s.substr(e+1))}this.options.transformTagName&&(s=this.options.transformTagName(s)),n&&(a=this.saveTextToParentTag(a,n,r));const i=r.substring(r.lastIndexOf(".")+1);if(s&&-1!==this.options.unpairedTags.indexOf(s))throw new Error(`Unpaired tag can not be used as closing tag: </${s}>`);let c=0;i&&-1!==this.options.unpairedTags.indexOf(i)?(c=r.lastIndexOf(".",r.lastIndexOf(".")-1),this.tagsNodeStack.pop()):c=r.lastIndexOf("."),r=r.substring(0,c),n=this.tagsNodeStack.pop(),a="",o=t}else if("?"===e[o+1]){let t=_(e,o,!1,"?>");if(!t)throw new Error("Pi Tag is not closed.");if(a=this.saveTextToParentTag(a,n,r),this.options.ignoreDeclaration&&"?xml"===t.tagName||this.options.ignorePiTags);else{const e=new s(t.tagName);e.add(this.options.textNodeName,""),t.tagName!==t.tagExp&&t.attrExpPresent&&(e[":@"]=this.buildAttributesMap(t.tagExp,r,t.tagName)),this.addChild(n,e,r)}o=t.closeIndex+1}else if("!--"===e.substr(o+1,3)){const t=w(e,"--\x3e",o+4,"Comment is not closed.");if(this.options.commentPropName){const s=e.substring(o+4,t-2);a=this.saveTextToParentTag(a,n,r),n.add(this.options.commentPropName,[{[this.options.textNodeName]:s}])}o=t}else if("!D"===e.substr(o+1,2)){const t=i(e,o);this.docTypeEntities=t.entities,o=t.i}else if("!["===e.substr(o+1,2)){const t=w(e,"]]>",o,"CDATA is not closed.")-2,s=e.substring(o+9,t);a=this.saveTextToParentTag(a,n,r);let i=this.parseTextData(s,n.tagname,r,!0,!1,!0,!0);null==i&&(i=""),this.options.cdataPropName?n.add(this.options.cdataPropName,[{[this.options.textNodeName]:s}]):n.add(this.options.textNodeName,i),o=t+2}else{let i=_(e,o,this.options.removeNSPrefix),c=i.tagName;const l=i.rawTagName;let d=i.tagExp,u=i.attrExpPresent,h=i.closeIndex;this.options.transformTagName&&(c=this.options.transformTagName(c)),n&&a&&"!xml"!==n.tagname&&(a=this.saveTextToParentTag(a,n,r,!1));const f=n;if(f&&-1!==this.options.unpairedTags.indexOf(f.tagname)&&(n=this.tagsNodeStack.pop(),r=r.substring(0,r.lastIndexOf("."))),c!==t.tagname&&(r+=r?"."+c:c),this.isItStopNode(this.options.stopNodes,r,c)){let t="";if(d.length>0&&d.lastIndexOf("/")===d.length-1)o=i.closeIndex;else if(-1!==this.options.unpairedTags.indexOf(c))o=i.closeIndex;else{const n=this.readStopNodeData(e,l,h+1);if(!n)throw new Error(`Unexpected end of ${l}`);o=n.i,t=n.tagContent}const a=new s(c);c!==d&&u&&(a[":@"]=this.buildAttributesMap(d,r,c)),t&&(t=this.parseTextData(t,c,r,!0,u,!0,!0)),r=r.substr(0,r.lastIndexOf(".")),a.add(this.options.textNodeName,t),this.addChild(n,a,r)}else{if(d.length>0&&d.lastIndexOf("/")===d.length-1){"/"===c[c.length-1]?(c=c.substr(0,c.length-1),r=r.substr(0,r.length-1),d=c):d=d.substr(0,d.length-1),this.options.transformTagName&&(c=this.options.transformTagName(c));const e=new s(c);c!==d&&u&&(e[":@"]=this.buildAttributesMap(d,r,c)),this.addChild(n,e,r),r=r.substr(0,r.lastIndexOf("."))}else{const e=new s(c);this.tagsNodeStack.push(n),c!==d&&u&&(e[":@"]=this.buildAttributesMap(d,r,c)),this.addChild(n,e,r),n=e}a="",o=h}}else a+=e[o]}return t.child};function f(e,t,n){const a=this.options.updateTag(t.tagname,n,t[":@"]);!1===a||("string"==typeof a?(t.tagname=a,e.addChild(t)):e.addChild(t))}const p=function(e){if(this.options.processEntities){for(let t in this.docTypeEntities){const n=this.docTypeEntities[t];e=e.replace(n.regx,n.val)}for(let t in this.lastEntities){const n=this.lastEntities[t];e=e.replace(n.regex,n.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){const n=this.htmlEntities[t];e=e.replace(n.regex,n.val)}e=e.replace(this.ampEntity.regex,this.ampEntity.val)}return e};function g(e,t,n,a){return e&&(void 0===a&&(a=0===Object.keys(t.child).length),void 0!==(e=this.parseTextData(e,t.tagname,n,!1,!!t[":@"]&&0!==Object.keys(t[":@"]).length,a))&&""!==e&&t.add(this.options.textNodeName,e),e=""),e}function m(e,t,n){const a="*."+n;for(const n in e){const s=e[n];if(a===s||t===s)return!0}return!1}function w(e,t,n,a){const s=e.indexOf(t,n);if(-1===s)throw new Error(a);return s+t.length-1}function _(e,t,n,a=">"){const s=function(e,t,n=">"){let a,s="";for(let i=t;i<e.length;i++){let t=e[i];if(a)t===a&&(a="");else if('"'===t||"'"===t)a=t;else if(t===n[0]){if(!n[1])return{data:s,index:i};if(e[i+1]===n[1])return{data:s,index:i}}else"\t"===t&&(t=" ");s+=t}}(e,t+1,a);if(!s)return;let i=s.data;const r=s.index,o=i.search(/\s/);let c=i,l=!0;-1!==o&&(c=i.substring(0,o),i=i.substring(o+1).trimStart());const d=c;if(n){const e=c.indexOf(":");-1!==e&&(c=c.substr(e+1),l=c!==s.data.substr(e+1))}return{tagName:c,tagExp:i,closeIndex:r,attrExpPresent:l,rawTagName:d}}function b(e,t,n){const a=n;let s=1;for(;n<e.length;n++)if("<"===e[n])if("/"===e[n+1]){const i=w(e,">",n,`${t} is not closed`);if(e.substring(n+2,i).trim()===t&&(s--,0===s))return{tagContent:e.substring(a,n),i};n=i}else if("?"===e[n+1]){n=w(e,"?>",n+1,"StopNode is not closed.")}else if("!--"===e.substr(n+1,3)){n=w(e,"--\x3e",n+3,"StopNode is not closed.")}else if("!["===e.substr(n+1,2)){n=w(e,"]]>",n,"StopNode is not closed.")-2}else{const a=_(e,n,">");if(a){(a&&a.tagName)===t&&"/"!==a.tagExp[a.tagExp.length-1]&&s++,n=a.closeIndex}}}function y(e,t,n){if(t&&"string"==typeof e){const t=e.trim();return"true"===t||"false"!==t&&r(e,n)}return a.isExist(e)?e:""}e.exports=class{constructor(e){this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"}},this.addExternalEntities=o,this.parseXml=h,this.parseTextData=c,this.resolveNameSpace=l,this.buildAttributesMap=u,this.isItStopNode=m,this.replaceEntitiesValue=p,this.readStopNodeData=b,this.saveTextToParentTag=g,this.addChild=f}}},58844:(e,t,n)=>{const{buildOptions:a}=n(66745),s=n(81078),{prettify:i}=n(16997),r=n(78501);e.exports=class{constructor(e){this.externalEntities={},this.options=a(e)}parse(e,t){if("string"==typeof e);else{if(!e.toString)throw new Error("XML data is accepted in String or Bytes[] form.");e=e.toString()}if(t){!0===t&&(t={});const n=r.validate(e,t);if(!0!==n)throw Error(`${n.err.msg}:${n.err.line}:${n.err.col}`)}const n=new s(this.options);n.addExternalEntities(this.externalEntities);const a=n.parseXml(e);return this.options.preserveOrder||void 0===a?a:i(a,this.options)}addEntity(e,t){if(-1!==t.indexOf("&"))throw new Error("Entity value can't have '&'");if(-1!==e.indexOf("&")||-1!==e.indexOf(";"))throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if("&"===t)throw new Error("An entity with value '&' is not permitted");this.externalEntities[e]=t}}},16997:(e,t)=>{"use strict";function n(e,t,r){let o;const c={};for(let l=0;l<e.length;l++){const d=e[l],u=a(d);let h="";if(h=void 0===r?u:r+"."+u,u===t.textNodeName)void 0===o?o=d[u]:o+=""+d[u];else{if(void 0===u)continue;if(d[u]){let e=n(d[u],t,h);const a=i(e,t);d[":@"]?s(e,d[":@"],h,t):1!==Object.keys(e).length||void 0===e[t.textNodeName]||t.alwaysCreateTextNode?0===Object.keys(e).length&&(t.alwaysCreateTextNode?e[t.textNodeName]="":e=""):e=e[t.textNodeName],void 0!==c[u]&&c.hasOwnProperty(u)?(Array.isArray(c[u])||(c[u]=[c[u]]),c[u].push(e)):t.isArray(u,h,a)?c[u]=[e]:c[u]=e}}}return"string"==typeof o?o.length>0&&(c[t.textNodeName]=o):void 0!==o&&(c[t.textNodeName]=o),c}function a(e){const t=Object.keys(e);for(let e=0;e<t.length;e++){const n=t[e];if(":@"!==n)return n}}function s(e,t,n,a){if(t){const s=Object.keys(t),i=s.length;for(let r=0;r<i;r++){const i=s[r];a.isArray(i,n+"."+i,!0,!0)?e[i]=[t[i]]:e[i]=t[i]}}}function i(e,t){const{textNodeName:n}=t,a=Object.keys(e).length;return 0===a||!(1!==a||!e[n]&&"boolean"!=typeof e[n]&&0!==e[n])}t.prettify=function(e,t){return n(e,t)}},36311:e=>{"use strict";e.exports=class{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){"__proto__"===e&&(e="#__proto__"),this.child.push({[e]:t})}addChild(e){"__proto__"===e.tagname&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}}},78444:(e,t,n)=>{!function(t){"use strict";e.exports=function(e,t){let n;const a={debug:()=>{},info:()=>{},error:()=>{}};var s=function(t,s){var i=this;n=t.logger||a;const r={debug:(...e)=>{n.debug((()=>e))},info:(...e)=>{n.info((()=>e))},warn:(...e)=>{n.warn((()=>e))},error:(...e)=>{n.error((()=>e))}};if(i._loggedIn=!1,i._loggingIn=!1,i._shouldLogOut=!1,s)i._client=s;else{var o={useSecureTransport:t.secure,ignoreTLS:t.ignoreTLS,requireTLS:t.requireTLS,auth:t.auth,ca:t.ca,tlsWorkerPath:t.tlsWorkerPath,enableCompression:!0,compressionWorkerPath:t.compressionWorkerPath,id:t.id,logger:r};i._client=new e(t.host,t.port,o)}i._client.oncert=function(e){i.onCert(e)},i.mailboxCache={},i._registerEventHandlers(i._client)};function i(e){return e.childNodes?e.childNodes.some((e=>i(e))):/^text\/html/i.test(e.type)}function r(e,t,n){if(e.size&&(t.size+=e.size),e.childNodes)e.childNodes.forEach((function(e){r(e,t,n)}));else{n&&e.id&&e.disposition?.startsWith("inline")||!e.disposition?.startsWith("attachment")&&/^text\/(plain|html)/i.test(e.type)||(t.attachment+=1)}}function o(e,t){return e-t}function c(e,t){for(var n=0,a=0,s=[],i=[];n<e.length&&a<t.length;)e[n]<t[a]?(s.push(e[n]),n++):e[n]>t[a]?(i.push(t[a]),a++):(n++,a++);return n===e.length?i=i.concat(t.slice(a)):a===t.length&&(s=s.concat(e.slice(n))),[s,i]}function l(e){const t=10240,n=[];for(var a=0;a<e.length;a+=t){const s=a,i=Math.min(a+t,e.length);n.push(String.fromCharCode.apply(null,e.subarray(s,i)))}return n.join("")}return s.prototype._registerEventHandlers=function(e){e.onselectmailbox=this._onSelectMailbox.bind(this,e),e.onupdate=this._onUpdate.bind(this,e),e.onerror=this._onError.bind(this,e)},s.prototype._onError=function(e,t){var a="IMAP connection encountered an error! "+t;e===this._client&&(this._loggedIn=!1,n.error((()=>[new Error(a)])),this.onError(new Error(a)))},s.prototype._onSelectMailbox=function(e,t,a){var s,i=this;if(i.onSyncUpdate){if(n.debug((()=>["selected mailbox "+t])),i.mailboxCache[t]||(n.debug((()=>["populating cache object for mailbox "+t])),i.mailboxCache[t]={exists:0,uidNext:0,uidlist:[],highestModseq:"0"}),(s=i.mailboxCache[t]).noModseq=a.noModseq||!1,s.exists!==a.exists||s.uidNext!==a.uidNext){n.debug((()=>["possible updates available in "+t+". exists: "+a.exists+", uidNext: "+a.uidNext]));var r=0===s.exists;return s.exists=a.exists,s.uidNext=a.uidNext,i.search({path:t,client:e}).then((function(l){s.uidlist=s.uidlist||[];var d=0;for(var u of l){if(u<d){n.debug((()=>["imapUidList not sorted"])),l.sort(o);break}d=u}var h=c(s.uidlist,l),f=h[0],p=h[1];return s.uidlist=l,Promise.resolve().then((function(){if(f.length)return n.debug((()=>["onSyncUpdate for deleted uids in "+t+": "+f])),i.onSyncUpdate({type:"deleted",path:t,list:f})})).then((function(){if(p.length)return n.debug((()=>["onSyncUpdate for new uids in "+t+": "+p])),i.onSyncUpdate({type:"new",path:t,list:p})})).then((function(){if(!r)return n.debug((()=>["no changes in message count in "+t+". exists: "+a.exists+", uidNext: "+a.uidNext])),i._checkFlags({path:t,highestModseq:a.highestModseq,noModseq:a.noModseq,client:e}).catch((function(e){n.error((()=>["error checking modseq: "+e+"\n"+e.stack]))}))}))}))}return n.debug((()=>["no changes in message count in "+t+". exists: "+a.exists+", uidNext: "+a.uidNext])),i._checkFlags({path:t,highestModseq:a.highestModseq,noModseq:a.noModseq,client:e}).catch((function(e){n.error((()=>["error checking modseq: "+e+"\n"+e.stack]))}))}},s.prototype._onUpdate=function(e,t,a,s){var i=this,r=i.mailboxCache[t];if(i.onSyncUpdate&&r)if("expunge"===a){n.debug((()=>["expunge notice received for "+t+" with sequence number: "+s]));var c=r.uidlist[s-1];r.uidlist.splice(s-1,1),c&&(n.debug((()=>["deleted uid in "+t+": "+c])),i.onSyncUpdate({type:"deleted",path:t,list:[c]}))}else"exists"===a?(n.debug((()=>["exists notice received for "+t+", checking for updates"])),r.exists=s,i.search({path:t,uid:r.uidNext+":*",client:e}).then((function(e){!e.length||1===e.length&&r.uidlist.indexOf(e[0])>=0||(e.sort(o),n.debug((()=>["new uids in "+t+": "+e])),r.uidlist=r.uidlist.concat(e),r.uidNext=r.uidlist[r.uidlist.length-1]+1,n.debug((()=>["new uids in "+t+": "+e])),i.onSyncUpdate({type:"new",path:t,list:e}))})).catch((function(e){n.error((()=>["error handling exists notice: "+e+"\n"+e.stack]))}))):"fetch"===a&&(n.debug((()=>["fetch notice received for "+t])),i.onSyncUpdate({type:"messages",path:t,list:[s].map((function(e){return!e.uid&&r.uidlist&&(e.uid=r.uidlist[e["#"]-1]),e}))}))},s.prototype._checkFlags=function(e){var t=this,a=e.highestModseq,s=e.noModseq,i=e.client||t._client,r=e.path;if(s)return n.info((()=>["can not check MODSEQ, mailbox has NOMODSEQ directive"])),new Promise((function(e){e([])}));if(!i.hasCapability("CONDSTORE")||!a||!r)return n.info((()=>["can not check MODSEQ, server does not support CONDSTORE extension"])),new Promise((function(e){e([])}));var o=t.mailboxCache[r];if(!o||!o.highestModseq||o.highestModseq===a)return new Promise((function(e){e([])}));var c=o.uidNext>1?o.uidNext-1:1;return n.debug((()=>["listing changes since MODSEQ "+a+" for "+r])),i.listMessages(r,"1:"+c,["uid","flags","modseq"],{byUid:!0,changedSince:o.highestModseq}).then((function(e){return o.highestModseq=a,e&&e.length?(n.debug((()=>["changes since MODSEQ "+a+" for "+r+" available!"])),t.onSyncUpdate({type:"messages",path:r,list:e})):[]})).catch((function(e){n.error((()=>["error handling exists notice: "+e+"\n"+e.stack]))}))},s.prototype.onSyncUpdate=!1,s.prototype.login=function(){var e=this;return e._loggedIn||e._loggingIn?(n.debug((()=>["refusing login while logged/logging in!"])),Promise.resolve()):(e._loggingIn=!0,e._client.connect().then((function(){if(n.debug((()=>["login completed, ready to roll!"])),e._loggedIn=!0,e._shouldLogOut)return e.logout()})).finally((function(){e._loggingIn=!1})))},s.prototype.logout=function(){var e=this;return e._loggingIn?(n.debug((()=>["currently logging in, will log right back out!"])),e._shouldLogOut=!0,Promise.resolve()):e._loggedIn?(e._loggedIn=!1,e._shouldLogOut=!1,e._client.close().then((function(){n.debug((()=>["logout completed, kthxbye!"]))}))):(n.debug((()=>["refusing logout while already logged out!"])),Promise.resolve())},s.prototype.selectMailbox=function(e){return n.debug((()=>["selecting mailbox "+e.path])),this._client.selectMailbox(e.path)},s.prototype.subscribeMailbox=function(e){return n.debug((()=>["subscribing to mailbox "+e.path])),this._client.subscribeMailbox(e.path)},s.prototype.unsubscribeMailbox=function(e){return n.debug((()=>["unsubscribing to mailbox "+e.path])),this._client.unsubscribeMailbox(e.path)},s.prototype.listWellKnownFolders=function(){var e=this,t={Inbox:[],Drafts:[],All:[],Flagged:[],Sent:[],Trash:[],Junk:[],Archive:[],Other:[]};n.debug((()=>["listing folders"]));var a=[];return e._checkOnline().then((function(){return e._client.listMailboxes()})).then((function(e){return a=e.children?.filter((e=>!!e.specialUseFlag)).map((e=>e.specialUseFlag)),n.debug((()=>["folder list received!"])),i(e),t})).catch((function(e){throw n.error((()=>["error listing folders: "+e+"\n"+e.stack])),e}));function s(e){return e.specialUseFlag||e.specialUse&&!a.includes(e.specialUse)}function i(a){if(a.path&&-1===(a.flags||[]).indexOf("\\Noselect")){n.debug((()=>["name: "+a.name+", path: "+a.path+(a.flags?", flags: "+a.flags:"")+(a.specialUse?", special use: "+a.specialUse:"")]));var r={name:a.name||a.path,path:a.path,subscribed:a.subscribed,delimiter:a.delimiter};"INBOX"===r.name.toUpperCase()?(r.type="Inbox",e._delimiter=a.delimiter,t.Inbox.push(r)):"\\Drafts"===a.specialUse&&s(a)?(r.type="Drafts",t.Drafts.push(r)):"\\All"===a.specialUse&&s(a)?(r.type="All",t.All.push(r)):"\\Flagged"===a.specialUse&&s(a)?(r.type="Flagged",t.Flagged.push(r)):"\\Sent"===a.specialUse&&s(a)?(r.type="Sent",t.Sent.push(r)):"\\Trash"===a.specialUse&&s(a)?(r.type="Trash",t.Trash.push(r)):"\\Junk"===a.specialUse&&s(a)?(r.type="Junk",t.Junk.push(r)):"\\Archive"===a.specialUse&&s(a)?(r.type="Archive",t.Archive.push(r)):(r.type="Other",t.Other.push(r))}a.children&&a.children.forEach(i)}},s.prototype.deleteFolder=function(e){var t=this;return t._checkOnline().then((function(){return t._client.deleteMailbox(e.path)})).catch((function(t){throw n.error((()=>["error deleting folder"+e.path+": "+t+"\n"+t.stack])),t}))},s.prototype.createFolder=function(e){var t,a=this,s=e.path;return Array.isArray(s)||(s=[s]),a._checkOnline().then((function(){if(void 0===a._delimiter||void 0===a._prefix)return a._client.listNamespaces().then((function(e){return e&&e.personal&&e.personal[0]?(a._delimiter=e.personal[0].delimiter,void(a._prefix=e.personal[0].prefix.split(a._delimiter).shift())):(a._prefix="",a._delimiter?void 0:a._client.listMailboxes().then((function(e){i(e)})))}))})).then((function(){if(!a._delimiter)throw new Error("Could not determine delimiter for mailbox hierarchy");return a._prefix&&s.unshift(a._prefix),t=s.join(a._delimiter),a._client.createMailbox(t)})).then((function(){return t})).catch((function(t){throw n.error((()=>["error creating folder "+e.path+": "+t+"\n"+t.stack])),t}));function i(e){"INBOX"!==(e.path||"").toUpperCase()?e.children&&e.children.forEach(i):a._delimiter=e.delimiter}},s.prototype.search=function(e){var t=this,a=e.client||t._client,s={},i={byUid:!0};return s.all=!0,!0===e.unread?s.unseen=!0:!1===e.unread&&(s.seen=!0),!0===e.answered?s.answered=!0:!1===e.answered&&(s.unanswered=!0),e.header&&(s.header=e.header),e.uid&&(s.uid=e.uid),n.debug((()=>["searching in "+e.path+" for "+Object.keys(s).join(",")])),t._checkOnline().then((function(){return a.search(e.path,s,i)})).then((function(t){return n.debug((()=>["searched in "+e.path+" for "+Object.keys(s).join(",")+" ("+t.length+" uids)"])),t})).catch((function(t){throw n.error((()=>["error searching "+e.path+": "+t+"\n"+t.stack])),t}))},s.prototype.listMessages=function(e){var t,a=this,s=["uid","bodystructure","flags","envelope","body.peek[header.fields (references list-id x-microsoft-original-message-id from list-post)]"],o={byUid:!0};this._client.hasCapability("X-GM-EXT-1")&&s.push("x-gm-msgid"),this._client.hasCapability("PREVIEW")&&s.push("preview"),t=e.uids?e.uids.join(","):e.sequence?e.sequence:(e.firstUid||1)+":"+(e.lastUid||"*");let c=a.mailboxCache[e.path];const l=c&&c.noModseq;return this._client.hasCapability("CONDSTORE")&&!l&&s.push("modseq"),n.debug((()=>["listing messages in "+e.path+" for interval "+t])),a._checkOnline().then((function(){return a._client.listMessages(e.path,t,s,o)})).then((function(e){var t=[];return e.forEach((function(e){if(!e.envelope||!e.uid)return void n.debug((()=>["message is malformed: "+JSON.stringify(e)]));var s=e["body[header.fields (references list-id x-microsoft-original-message-id from list-post)]"];s&&(s=s.replace(/\r?\n([ \t])/g,"$1"));var o=/References:\s*((?:<\S+>\s*)+)/.exec(s),c=/list-id *: *(.*(?:\r?\n[\t ].+)*)/i.exec(s),l=/list-post *: *(.*(?:\r?\n[\t ].+)*)/i.exec(s),d=/X-Microsoft-Original-Message-ID:\s*\S*\s<(\S+)>/.exec(s);const u=e.envelope.from||[];a._addFromHeaderAddresses(u,s);var h=Date.now(),f=Date.parse(e.envelope.date)||h;f>h&&(f=h);let p="";Array.isArray(e.preview)?p=e.preview[1].value:"string"==typeof e.preview?p=e.preview:e.preview&&n.debug((()=>["Message preview of unexpected type:",e.preview,typeof e.preview]));var g={uid:e.uid,messageId:(e.envelope["message-id"]||"").replace(/[<>]/g,"").trim(),originalMessageId:d?d[1]:"",listId:c?c[1]:"",listPost:l?l[1]:"",gmailId:e["x-gm-msgid"]||"",from:u,replyTo:e.envelope["reply-to"]||[],to:e.envelope.to||[],cc:e.envelope.cc||[],bcc:e.envelope.bcc||[],modseq:e.modseq||"0",subject:e.envelope.subject||"(no subject)",preview:p,inReplyTo:(e.envelope["in-reply-to"]||"").replace(/[<>]/g,"").trim(),references:o?o[1].split(/\s+/).filter((function(e){return""!==e})).map((function(e){return e.replace(/[<>]/g,"")})):[],sentDate:f,flags:e.flags||[],attachment:0,size:0};const m=e.bodystructure||{};r(m,g,i(m)),n.debug((()=>["listing message: [uid: "+g.uid+"]"])),t.push(g)})),t})).catch((function(t){throw n.error((()=>["error listing messages in "+e.path+": "+t+"\n"+t.stack])),t}))},s.prototype.getMessages=function(e){var t=this,a=["body.peek[]"],s={byUid:!0,valueAsString:!1},i=e.uids.join(",");return n.debug((()=>["retrieving body parts for uid(s) "+i+" in folder "+e.path+": "+a])),t._checkOnline().then((function(){return t._client.listMessages(e.path,i,a,s)})).then((function(e){const t={};return e.forEach((function(e){t[e.uid]=e["body[]"]})),t})).catch((function(t){throw n.error((()=>["error fetching message for uid(s) "+i+" in folder "+e.path+": "+t+"\n"+t.stack])),t}))},s.prototype.updateFlags=function(e){const t=e.uids.sort(o);let a=t[0],s=[];function i(e){e===a?s.push(a):s.push(a+":"+e)}for(let e=1;e<t.length;e++)t[e]-t[e-1]!=1&&(i(t[e-1]),a=t[e]);i(t[t.length-1]);const r=s.join(",");var c=this,l={byUid:!0},d=e.add||[],u=e.remove||[];return n.debug((()=>["updating flags for uids "+r+" in folder "+e.path+": "+(u.length>0?" removing "+u:"")+(d.length>0?" adding "+d:"")])),c._checkOnline().then((function(){if(d.length>0)return c._client.setFlags(e.path,r,{add:d},l)})).then((function(){if(u.length>0)return c._client.setFlags(e.path,r,{remove:u},l)})).then((function(){n.debug((()=>["successfully updated flags for uids "+r+" in folder "+e.path+": added "+d+" and removed "+u]))})).catch((function(t){throw n.error((()=>["error updating flags for uids "+r+" in folder "+e.path+" : "+t+"\n"+t.stack])),t}))},s.prototype.copyMessages=function(e){var t=this;return n.debug((()=>["copying uids "+e.uids+" from "+e.path+" to "+e.destination])),t._checkOnline().then((function(){var n=e.uids.join(","),a={byUid:!0};return t._client.copyMessages(e.path,n,e.destination,a)})).then((function(t){return n.debug((()=>["successfully copied uids "+e.uids+" from "+e.path+" to "+e.destination])),t})).catch((function(t){throw n.error((()=>["error copying uids "+e.uids+" from "+e.path+" to "+e.destination+" : "+t+"\n"+t.stack])),t}))},s.prototype.moveMessages=function(e){var t=this;return n.debug((()=>["moving uids "+e.uids+" from "+e.path+" to "+e.destination])),t._checkOnline().then((function(){var n=e.uids.join(","),a={byUid:!0};return t._client.moveMessages(e.path,n,e.destination,a)})).then((function(){n.debug((()=>["successfully moved uids "+e.uids+" from "+e.path+" to "+e.destination]))})).catch((function(t){throw n.error((()=>["error moving uids "+e.uids+" from "+e.path+" to "+e.destination+" : "+t+"\n"+t.stack])),t}))},s.prototype.uploadMessage=function(e){var t=this,a=e.message instanceof Uint8Array?l(e.message):e.message,s=Array.isArray(e.flags)&&e.flags.length>0?{flags:e.flags}:{};return n.debug((()=>["uploading a message of "+a.length+" bytes to "+e.path])),t._checkOnline().then((function(){return t._client.upload(e.path,a,s)})).then((function(t){return n.debug((()=>["successfully uploaded message to "+e.path])),t})).catch((function(t){throw n.error((()=>["error uploading <"+a.length+"> bytes to "+e.path+" : "+t+"\n"+t.stack])),t}))},s.prototype.deleteMessages=function(e){var t=this;return n.debug((()=>["deleting uid "+e.uid+" from "+e.path])),t._checkOnline().then((function(){var n=e.uids.join(","),a={byUid:!0};return t._client.deleteMessages(e.path,n,a)})).then((function(){n.debug((()=>["successfully deleted uid "+e.uid+" from "+e.path]))})).catch((function(t){throw n.error((()=>["error deleting uid "+e.uid+" from "+e.path+" : "+t+"\n"+t.stack])),t}))},s.prototype._addFromHeaderAddresses=function(e,n){if(n)for(const a of n.matchAll(/from\s*:\s*([^\n\r]+)/gi))if(a.length>1&&a[1]){const n=t(a[1])||[];for(const t of n){const n=e.find((e=>e.address===t.address));n?n.name||(n.name=t.name):e.push(t)}}},s.prototype._checkOnline=function(){var e=this;return new Promise((function(t){if(!e._loggedIn)throw new Error("Not logged in!");t()}))},s}(n(9673).ZP,n(84846).Z)}()},24236:(e,t)=>{"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function a(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var s in n)a(n,s)&&(e[s]=n[s])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var s={arraySet:function(e,t,n,a,s){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+a),s);else for(var i=0;i<a;i++)e[s+i]=t[n+i]},flattenChunks:function(e){var t,n,a,s,i,r;for(a=0,t=0,n=e.length;t<n;t++)a+=e[t].length;for(r=new Uint8Array(a),s=0,t=0,n=e.length;t<n;t++)i=e[t],r.set(i,s),s+=i.length;return r}},i={arraySet:function(e,t,n,a,s){for(var i=0;i<a;i++)e[s+i]=t[n+i]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,s)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,i))},t.setTyped(n)},66069:e=>{"use strict";e.exports=function(e,t,n,a){for(var s=65535&e|0,i=e>>>16&65535|0,r=0;0!==n;){n-=r=n>2e3?2e3:n;do{i=i+(s=s+t[a++]|0)|0}while(--r);s%=65521,i%=65521}return s|i<<16|0}},71619:e=>{"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},2869:e=>{"use strict";var t=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var a=0;a<8;a++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();e.exports=function(e,n,a,s){var i=t,r=s+a;e^=-1;for(var o=s;o<r;o++)e=e>>>8^i[255&(e^n[o])];return-1^e}},77617:(e,t,n)=>{"use strict";var a,s=n(24236),i=n(10342),r=n(66069),o=n(2869),c=n(48898),l=-2,d=258,u=262,h=103,f=113,p=666;function g(e,t){return e.msg=c[t],t}function m(e){return(e<<1)-(e>4?9:0)}function w(e){for(var t=e.length;--t>=0;)e[t]=0}function _(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(s.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function b(e,t){i._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,_(e.strm)}function y(e,t){e.pending_buf[e.pending++]=t}function v(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function I(e,t){var n,a,s=e.max_chain_length,i=e.strstart,r=e.prev_length,o=e.nice_match,c=e.strstart>e.w_size-u?e.strstart-(e.w_size-u):0,l=e.window,h=e.w_mask,f=e.prev,p=e.strstart+d,g=l[i+r-1],m=l[i+r];e.prev_length>=e.good_match&&(s>>=2),o>e.lookahead&&(o=e.lookahead);do{if(l[(n=t)+r]===m&&l[n+r-1]===g&&l[n]===l[i]&&l[++n]===l[i+1]){i+=2,n++;do{}while(l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&i<p);if(a=d-(p-i),i=p-d,a>r){if(e.match_start=t,r=a,a>=o)break;g=l[i+r-1],m=l[i+r]}}}while((t=f[t&h])>c&&0!=--s);return r<=e.lookahead?r:e.lookahead}function E(e){var t,n,a,i,c,l,d,h,f,p,g=e.w_size;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=g+(g-u)){s.arraySet(e.window,e.window,g,g,0),e.match_start-=g,e.strstart-=g,e.block_start-=g,t=n=e.hash_size;do{a=e.head[--t],e.head[t]=a>=g?a-g:0}while(--n);t=n=g;do{a=e.prev[--t],e.prev[t]=a>=g?a-g:0}while(--n);i+=g}if(0===e.strm.avail_in)break;if(l=e.strm,d=e.window,h=e.strstart+e.lookahead,f=i,p=void 0,(p=l.avail_in)>f&&(p=f),n=0===p?0:(l.avail_in-=p,s.arraySet(d,l.input,l.next_in,p,h),1===l.state.wrap?l.adler=r(l.adler,d,p,h):2===l.state.wrap&&(l.adler=o(l.adler,d,p,h)),l.next_in+=p,l.total_in+=p,p),e.lookahead+=n,e.lookahead+e.insert>=3)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=(e.ins_h<<e.hash_shift^e.window[c+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[c+3-1])&e.hash_mask,e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<u&&0!==e.strm.avail_in)}function k(e,t){for(var n,a;;){if(e.lookahead<u){if(E(e),e.lookahead<u&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-u&&(e.match_length=I(e,n)),e.match_length>=3)if(a=i._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else a=i._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(a&&(b(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(b(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(b(e,!1),0===e.strm.avail_out)?1:2}function x(e,t){for(var n,a,s;;){if(e.lookahead<u){if(E(e),e.lookahead<u&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-u&&(e.match_length=I(e,n),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-3,a=i._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=s&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,a&&(b(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((a=i._tr_tally(e,0,e.window[e.strstart-1]))&&b(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(a=i._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(b(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(b(e,!1),0===e.strm.avail_out)?1:2}function A(e,t,n,a,s){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=a,this.func=s}function S(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(1146),this.dyn_dtree=new s.Buf16(122),this.bl_tree=new s.Buf16(78),w(this.dyn_ltree),w(this.dyn_dtree),w(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(16),this.heap=new s.Buf16(573),w(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(573),w(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function M(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:f,e.adler=2===t.wrap?0:1,t.last_flush=0,i._tr_init(t),0):g(e,l)}function O(e){var t,n=M(e);return 0===n&&((t=e.state).window_size=2*t.w_size,w(t.head),t.max_lazy_match=a[t.level].max_lazy,t.good_match=a[t.level].good_length,t.nice_match=a[t.level].nice_length,t.max_chain_length=a[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),n}function L(e,t,n,a,i,r){if(!e)return l;var o=1;if(-1===t&&(t=6),a<0?(o=0,a=-a):a>15&&(o=2,a-=16),i<1||i>9||8!==n||a<8||a>15||t<0||t>9||r<0||r>4)return g(e,l);8===a&&(a=9);var c=new S;return e.state=c,c.strm=e,c.wrap=o,c.gzhead=null,c.w_bits=a,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=i+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+3-1)/3),c.window=new s.Buf8(2*c.w_size),c.head=new s.Buf16(c.hash_size),c.prev=new s.Buf16(c.w_size),c.lit_bufsize=1<<i+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new s.Buf8(c.pending_buf_size),c.d_buf=1*c.lit_bufsize,c.l_buf=3*c.lit_bufsize,c.level=t,c.strategy=r,c.method=n,O(e)}a=[new A(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(E(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var a=e.block_start+n;if((0===e.strstart||e.strstart>=a)&&(e.lookahead=e.strstart-a,e.strstart=a,b(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-u&&(b(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(b(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(b(e,!1),e.strm.avail_out),1)})),new A(4,4,8,4,k),new A(4,5,16,8,k),new A(4,6,32,32,k),new A(4,4,16,16,x),new A(8,16,32,32,x),new A(8,16,128,128,x),new A(8,32,128,256,x),new A(32,128,258,1024,x),new A(32,258,258,4096,x)],t.Ue=L,t.Wt=function(e,t){var n,s,r,c;if(!e||!e.state||t>5||t<0)return e?g(e,l):l;if(s=e.state,!e.output||!e.input&&0!==e.avail_in||s.status===p&&4!==t)return g(e,0===e.avail_out?-5:l);if(s.strm=e,n=s.last_flush,s.last_flush=t,42===s.status)if(2===s.wrap)e.adler=0,y(s,31),y(s,139),y(s,8),s.gzhead?(y(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),y(s,255&s.gzhead.time),y(s,s.gzhead.time>>8&255),y(s,s.gzhead.time>>16&255),y(s,s.gzhead.time>>24&255),y(s,9===s.level?2:s.strategy>=2||s.level<2?4:0),y(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(y(s,255&s.gzhead.extra.length),y(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=o(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69):(y(s,0),y(s,0),y(s,0),y(s,0),y(s,0),y(s,9===s.level?2:s.strategy>=2||s.level<2?4:0),y(s,3),s.status=f);else{var u=8+(s.w_bits-8<<4)<<8;u|=(s.strategy>=2||s.level<2?0:s.level<6?1:6===s.level?2:3)<<6,0!==s.strstart&&(u|=32),u+=31-u%31,s.status=f,v(s,u),0!==s.strstart&&(v(s,e.adler>>>16),v(s,65535&e.adler)),e.adler=1}if(69===s.status)if(s.gzhead.extra){for(r=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>r&&(e.adler=o(e.adler,s.pending_buf,s.pending-r,r)),_(e),r=s.pending,s.pending!==s.pending_buf_size));)y(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>r&&(e.adler=o(e.adler,s.pending_buf,s.pending-r,r)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=73)}else s.status=73;if(73===s.status)if(s.gzhead.name){r=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>r&&(e.adler=o(e.adler,s.pending_buf,s.pending-r,r)),_(e),r=s.pending,s.pending===s.pending_buf_size)){c=1;break}c=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,y(s,c)}while(0!==c);s.gzhead.hcrc&&s.pending>r&&(e.adler=o(e.adler,s.pending_buf,s.pending-r,r)),0===c&&(s.gzindex=0,s.status=91)}else s.status=91;if(91===s.status)if(s.gzhead.comment){r=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>r&&(e.adler=o(e.adler,s.pending_buf,s.pending-r,r)),_(e),r=s.pending,s.pending===s.pending_buf_size)){c=1;break}c=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,y(s,c)}while(0!==c);s.gzhead.hcrc&&s.pending>r&&(e.adler=o(e.adler,s.pending_buf,s.pending-r,r)),0===c&&(s.status=h)}else s.status=h;if(s.status===h&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&_(e),s.pending+2<=s.pending_buf_size&&(y(s,255&e.adler),y(s,e.adler>>8&255),e.adler=0,s.status=f)):s.status=f),0!==s.pending){if(_(e),0===e.avail_out)return s.last_flush=-1,0}else if(0===e.avail_in&&m(t)<=m(n)&&4!==t)return g(e,-5);if(s.status===p&&0!==e.avail_in)return g(e,-5);if(0!==e.avail_in||0!==s.lookahead||0!==t&&s.status!==p){var I=2===s.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(E(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,n=i._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(b(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(b(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(b(e,!1),0===e.strm.avail_out)?1:2}(s,t):3===s.strategy?function(e,t){for(var n,a,s,r,o=e.window;;){if(e.lookahead<=d){if(E(e),e.lookahead<=d&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(a=o[s=e.strstart-1])===o[++s]&&a===o[++s]&&a===o[++s]){r=e.strstart+d;do{}while(a===o[++s]&&a===o[++s]&&a===o[++s]&&a===o[++s]&&a===o[++s]&&a===o[++s]&&a===o[++s]&&a===o[++s]&&s<r);e.match_length=d-(r-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=i._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=i._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(b(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(b(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(b(e,!1),0===e.strm.avail_out)?1:2}(s,t):a[s.level].func(s,t);if(3!==I&&4!==I||(s.status=p),1===I||3===I)return 0===e.avail_out&&(s.last_flush=-1),0;if(2===I&&(1===t?i._tr_align(s):5!==t&&(i._tr_stored_block(s,0,0,!1),3===t&&(w(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),_(e),0===e.avail_out))return s.last_flush=-1,0}return 4!==t?0:s.wrap<=0?1:(2===s.wrap?(y(s,255&e.adler),y(s,e.adler>>8&255),y(s,e.adler>>16&255),y(s,e.adler>>24&255),y(s,255&e.total_in),y(s,e.total_in>>8&255),y(s,e.total_in>>16&255),y(s,e.total_in>>24&255)):(v(s,e.adler>>>16),v(s,65535&e.adler)),_(e),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?0:1)}},94264:e=>{"use strict";e.exports=function(e,t){var n,a,s,i,r,o,c,l,d,u,h,f,p,g,m,w,_,b,y,v,I,E,k,x,A;n=e.state,a=e.next_in,x=e.input,s=a+(e.avail_in-5),i=e.next_out,A=e.output,r=i-(t-e.avail_out),o=i+(e.avail_out-257),c=n.dmax,l=n.wsize,d=n.whave,u=n.wnext,h=n.window,f=n.hold,p=n.bits,g=n.lencode,m=n.distcode,w=(1<<n.lenbits)-1,_=(1<<n.distbits)-1;e:do{p<15&&(f+=x[a++]<<p,p+=8,f+=x[a++]<<p,p+=8),b=g[f&w];t:for(;;){if(f>>>=y=b>>>24,p-=y,0===(y=b>>>16&255))A[i++]=65535&b;else{if(!(16&y)){if(0==(64&y)){b=g[(65535&b)+(f&(1<<y)-1)];continue t}if(32&y){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}v=65535&b,(y&=15)&&(p<y&&(f+=x[a++]<<p,p+=8),v+=f&(1<<y)-1,f>>>=y,p-=y),p<15&&(f+=x[a++]<<p,p+=8,f+=x[a++]<<p,p+=8),b=m[f&_];n:for(;;){if(f>>>=y=b>>>24,p-=y,!(16&(y=b>>>16&255))){if(0==(64&y)){b=m[(65535&b)+(f&(1<<y)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(I=65535&b,p<(y&=15)&&(f+=x[a++]<<p,(p+=8)<y&&(f+=x[a++]<<p,p+=8)),(I+=f&(1<<y)-1)>c){e.msg="invalid distance too far back",n.mode=30;break e}if(f>>>=y,p-=y,I>(y=i-r)){if((y=I-y)>d&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(E=0,k=h,0===u){if(E+=l-y,y<v){v-=y;do{A[i++]=h[E++]}while(--y);E=i-I,k=A}}else if(u<y){if(E+=l+u-y,(y-=u)<v){v-=y;do{A[i++]=h[E++]}while(--y);if(E=0,u<v){v-=y=u;do{A[i++]=h[E++]}while(--y);E=i-I,k=A}}}else if(E+=u-y,y<v){v-=y;do{A[i++]=h[E++]}while(--y);E=i-I,k=A}for(;v>2;)A[i++]=k[E++],A[i++]=k[E++],A[i++]=k[E++],v-=3;v&&(A[i++]=k[E++],v>1&&(A[i++]=k[E++]))}else{E=i-I;do{A[i++]=A[E++],A[i++]=A[E++],A[i++]=A[E++],v-=3}while(v>2);v&&(A[i++]=A[E++],v>1&&(A[i++]=A[E++]))}break}}break}}while(a<s&&i<o);a-=v=p>>3,f&=(1<<(p-=v<<3))-1,e.next_in=a,e.next_out=i,e.avail_in=a<s?s-a+5:5-(a-s),e.avail_out=i<o?o-i+257:257-(i-o),n.hold=f,n.bits=p}},27948:(e,t,n)=>{"use strict";var a=n(24236),s=n(66069),i=n(2869),r=n(94264),o=n(9241),c=-2,l=12,d=30;function u(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function h(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new a.Buf16(320),this.work=new a.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function f(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new a.Buf32(852),t.distcode=t.distdyn=new a.Buf32(592),t.sane=1,t.back=-1,0):c}function p(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,f(e)):c}function g(e,t){var n,a;return e&&e.state?(a=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?c:(null!==a.window&&a.wbits!==t&&(a.window=null),a.wrap=n,a.wbits=t,p(e))):c}function m(e,t){var n,a;return e?(a=new h,e.state=a,a.window=null,0!==(n=g(e,t))&&(e.state=null),n):c}var w,_,b=!0;function y(e){if(b){var t;for(w=new a.Buf32(512),_=new a.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(o(1,e.lens,0,288,w,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;o(2,e.lens,0,32,_,0,e.work,{bits:5}),b=!1}e.lencode=w,e.lenbits=9,e.distcode=_,e.distbits=5}function v(e,t,n,s){var i,r=e.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new a.Buf8(r.wsize)),s>=r.wsize?(a.arraySet(r.window,t,n-r.wsize,r.wsize,0),r.wnext=0,r.whave=r.wsize):((i=r.wsize-r.wnext)>s&&(i=s),a.arraySet(r.window,t,n-s,i,r.wnext),(s-=i)?(a.arraySet(r.window,t,n-s,s,0),r.wnext=s,r.whave=r.wsize):(r.wnext+=i,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=i))),0}t.Ul=m,t.rr=function(e,t){var n,h,f,p,g,m,w,_,b,I,E,k,x,A,S,M,O,L,Z,N,T,R,P,C,F=0,U=new a.Buf8(4),D=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return c;(n=e.state).mode===l&&(n.mode=13),g=e.next_out,f=e.output,w=e.avail_out,p=e.next_in,h=e.input,m=e.avail_in,_=n.hold,b=n.bits,I=m,E=w,R=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;b<16;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(2&n.wrap&&35615===_){n.check=0,U[0]=255&_,U[1]=_>>>8&255,n.check=i(n.check,U,2,0),_=0,b=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&_)<<8)+(_>>8))%31){e.msg="incorrect header check",n.mode=d;break}if(8!=(15&_)){e.msg="unknown compression method",n.mode=d;break}if(b-=4,T=8+(15&(_>>>=4)),0===n.wbits)n.wbits=T;else if(T>n.wbits){e.msg="invalid window size",n.mode=d;break}n.dmax=1<<T,e.adler=n.check=1,n.mode=512&_?10:l,_=0,b=0;break;case 2:for(;b<16;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(n.flags=_,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=d;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=d;break}n.head&&(n.head.text=_>>8&1),512&n.flags&&(U[0]=255&_,U[1]=_>>>8&255,n.check=i(n.check,U,2,0)),_=0,b=0,n.mode=3;case 3:for(;b<32;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}n.head&&(n.head.time=_),512&n.flags&&(U[0]=255&_,U[1]=_>>>8&255,U[2]=_>>>16&255,U[3]=_>>>24&255,n.check=i(n.check,U,4,0)),_=0,b=0,n.mode=4;case 4:for(;b<16;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}n.head&&(n.head.xflags=255&_,n.head.os=_>>8),512&n.flags&&(U[0]=255&_,U[1]=_>>>8&255,n.check=i(n.check,U,2,0)),_=0,b=0,n.mode=5;case 5:if(1024&n.flags){for(;b<16;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}n.length=_,n.head&&(n.head.extra_len=_),512&n.flags&&(U[0]=255&_,U[1]=_>>>8&255,n.check=i(n.check,U,2,0)),_=0,b=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((k=n.length)>m&&(k=m),k&&(n.head&&(T=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),a.arraySet(n.head.extra,h,p,k,T)),512&n.flags&&(n.check=i(n.check,h,k,p)),m-=k,p+=k,n.length-=k),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===m)break e;k=0;do{T=h[p+k++],n.head&&T&&n.length<65536&&(n.head.name+=String.fromCharCode(T))}while(T&&k<m);if(512&n.flags&&(n.check=i(n.check,h,k,p)),m-=k,p+=k,T)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===m)break e;k=0;do{T=h[p+k++],n.head&&T&&n.length<65536&&(n.head.comment+=String.fromCharCode(T))}while(T&&k<m);if(512&n.flags&&(n.check=i(n.check,h,k,p)),m-=k,p+=k,T)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;b<16;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(_!==(65535&n.check)){e.msg="header crc mismatch",n.mode=d;break}_=0,b=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=l;break;case 10:for(;b<32;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}e.adler=n.check=u(_),_=0,b=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=g,e.avail_out=w,e.next_in=p,e.avail_in=m,n.hold=_,n.bits=b,2;e.adler=n.check=1,n.mode=l;case l:if(5===t||6===t)break e;case 13:if(n.last){_>>>=7&b,b-=7&b,n.mode=27;break}for(;b<3;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}switch(n.last=1&_,b-=1,3&(_>>>=1)){case 0:n.mode=14;break;case 1:if(y(n),n.mode=20,6===t){_>>>=2,b-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=d}_>>>=2,b-=2;break;case 14:for(_>>>=7&b,b-=7&b;b<32;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if((65535&_)!=(_>>>16^65535)){e.msg="invalid stored block lengths",n.mode=d;break}if(n.length=65535&_,_=0,b=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(k=n.length){if(k>m&&(k=m),k>w&&(k=w),0===k)break e;a.arraySet(f,h,p,k,g),m-=k,p+=k,w-=k,g+=k,n.length-=k;break}n.mode=l;break;case 17:for(;b<14;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(n.nlen=257+(31&_),_>>>=5,b-=5,n.ndist=1+(31&_),_>>>=5,b-=5,n.ncode=4+(15&_),_>>>=4,b-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=d;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;b<3;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}n.lens[D[n.have++]]=7&_,_>>>=3,b-=3}for(;n.have<19;)n.lens[D[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,P={bits:n.lenbits},R=o(0,n.lens,0,19,n.lencode,0,n.work,P),n.lenbits=P.bits,R){e.msg="invalid code lengths set",n.mode=d;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;M=(F=n.lencode[_&(1<<n.lenbits)-1])>>>16&255,O=65535&F,!((S=F>>>24)<=b);){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(O<16)_>>>=S,b-=S,n.lens[n.have++]=O;else{if(16===O){for(C=S+2;b<C;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(_>>>=S,b-=S,0===n.have){e.msg="invalid bit length repeat",n.mode=d;break}T=n.lens[n.have-1],k=3+(3&_),_>>>=2,b-=2}else if(17===O){for(C=S+3;b<C;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}b-=S,T=0,k=3+(7&(_>>>=S)),_>>>=3,b-=3}else{for(C=S+7;b<C;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}b-=S,T=0,k=11+(127&(_>>>=S)),_>>>=7,b-=7}if(n.have+k>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=d;break}for(;k--;)n.lens[n.have++]=T}}if(n.mode===d)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=d;break}if(n.lenbits=9,P={bits:n.lenbits},R=o(1,n.lens,0,n.nlen,n.lencode,0,n.work,P),n.lenbits=P.bits,R){e.msg="invalid literal/lengths set",n.mode=d;break}if(n.distbits=6,n.distcode=n.distdyn,P={bits:n.distbits},R=o(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,P),n.distbits=P.bits,R){e.msg="invalid distances set",n.mode=d;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(m>=6&&w>=258){e.next_out=g,e.avail_out=w,e.next_in=p,e.avail_in=m,n.hold=_,n.bits=b,r(e,E),g=e.next_out,f=e.output,w=e.avail_out,p=e.next_in,h=e.input,m=e.avail_in,_=n.hold,b=n.bits,n.mode===l&&(n.back=-1);break}for(n.back=0;M=(F=n.lencode[_&(1<<n.lenbits)-1])>>>16&255,O=65535&F,!((S=F>>>24)<=b);){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(M&&0==(240&M)){for(L=S,Z=M,N=O;M=(F=n.lencode[N+((_&(1<<L+Z)-1)>>L)])>>>16&255,O=65535&F,!(L+(S=F>>>24)<=b);){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}_>>>=L,b-=L,n.back+=L}if(_>>>=S,b-=S,n.back+=S,n.length=O,0===M){n.mode=26;break}if(32&M){n.back=-1,n.mode=l;break}if(64&M){e.msg="invalid literal/length code",n.mode=d;break}n.extra=15&M,n.mode=22;case 22:if(n.extra){for(C=n.extra;b<C;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}n.length+=_&(1<<n.extra)-1,_>>>=n.extra,b-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;M=(F=n.distcode[_&(1<<n.distbits)-1])>>>16&255,O=65535&F,!((S=F>>>24)<=b);){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(0==(240&M)){for(L=S,Z=M,N=O;M=(F=n.distcode[N+((_&(1<<L+Z)-1)>>L)])>>>16&255,O=65535&F,!(L+(S=F>>>24)<=b);){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}_>>>=L,b-=L,n.back+=L}if(_>>>=S,b-=S,n.back+=S,64&M){e.msg="invalid distance code",n.mode=d;break}n.offset=O,n.extra=15&M,n.mode=24;case 24:if(n.extra){for(C=n.extra;b<C;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}n.offset+=_&(1<<n.extra)-1,_>>>=n.extra,b-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=d;break}n.mode=25;case 25:if(0===w)break e;if(k=E-w,n.offset>k){if((k=n.offset-k)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=d;break}k>n.wnext?(k-=n.wnext,x=n.wsize-k):x=n.wnext-k,k>n.length&&(k=n.length),A=n.window}else A=f,x=g-n.offset,k=n.length;k>w&&(k=w),w-=k,n.length-=k;do{f[g++]=A[x++]}while(--k);0===n.length&&(n.mode=21);break;case 26:if(0===w)break e;f[g++]=n.length,w--,n.mode=21;break;case 27:if(n.wrap){for(;b<32;){if(0===m)break e;m--,_|=h[p++]<<b,b+=8}if(E-=w,e.total_out+=E,n.total+=E,E&&(e.adler=n.check=n.flags?i(n.check,f,E,g-E):s(n.check,f,E,g-E)),E=w,(n.flags?_:u(_))!==n.check){e.msg="incorrect data check",n.mode=d;break}_=0,b=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;b<32;){if(0===m)break e;m--,_+=h[p++]<<b,b+=8}if(_!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=d;break}_=0,b=0}n.mode=29;case 29:R=1;break e;case d:R=-3;break e;case 31:return-4;default:return c}return e.next_out=g,e.avail_out=w,e.next_in=p,e.avail_in=m,n.hold=_,n.bits=b,(n.wsize||E!==e.avail_out&&n.mode<d&&(n.mode<27||4!==t))&&v(e,e.output,e.next_out,E-e.avail_out)?(n.mode=31,-4):(I-=e.avail_in,E-=e.avail_out,e.total_in+=I,e.total_out+=E,n.total+=E,n.wrap&&E&&(e.adler=n.check=n.flags?i(n.check,f,E,e.next_out-E):s(n.check,f,E,e.next_out-E)),e.data_type=n.bits+(n.last?64:0)+(n.mode===l?128:0)+(20===n.mode||15===n.mode?256:0),(0===I&&0===E||4===t)&&0===R&&(R=-5),R)}},9241:(e,t,n)=>{"use strict";var a=n(24236),s=15,i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],r=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,n,l,d,u,h,f){var p,g,m,w,_,b,y,v,I,E=f.bits,k=0,x=0,A=0,S=0,M=0,O=0,L=0,Z=0,N=0,T=0,R=null,P=0,C=new a.Buf16(16),F=new a.Buf16(16),U=null,D=0;for(k=0;k<=s;k++)C[k]=0;for(x=0;x<l;x++)C[t[n+x]]++;for(M=E,S=s;S>=1&&0===C[S];S--);if(M>S&&(M=S),0===S)return d[u++]=20971520,d[u++]=20971520,f.bits=1,0;for(A=1;A<S&&0===C[A];A++);for(M<A&&(M=A),Z=1,k=1;k<=s;k++)if(Z<<=1,(Z-=C[k])<0)return-1;if(Z>0&&(0===e||1!==S))return-1;for(F[1]=0,k=1;k<s;k++)F[k+1]=F[k]+C[k];for(x=0;x<l;x++)0!==t[n+x]&&(h[F[t[n+x]]++]=x);if(0===e?(R=U=h,b=19):1===e?(R=i,P-=257,U=r,D-=257,b=256):(R=o,U=c,b=-1),T=0,x=0,k=A,_=u,O=M,L=0,m=-1,w=(N=1<<M)-1,1===e&&N>852||2===e&&N>592)return 1;for(;;){y=k-L,h[x]<b?(v=0,I=h[x]):h[x]>b?(v=U[D+h[x]],I=R[P+h[x]]):(v=96,I=0),p=1<<k-L,A=g=1<<O;do{d[_+(T>>L)+(g-=p)]=y<<24|v<<16|I|0}while(0!==g);for(p=1<<k-1;T&p;)p>>=1;if(0!==p?(T&=p-1,T+=p):T=0,x++,0==--C[k]){if(k===S)break;k=t[n+h[x]]}if(k>M&&(T&w)!==m){for(0===L&&(L=M),_+=A,Z=1<<(O=k-L);O+L<S&&!((Z-=C[O+L])<=0);)O++,Z<<=1;if(N+=1<<O,1===e&&N>852||2===e&&N>592)return 1;d[m=T&w]=M<<24|O<<16|_-u|0}}return 0!==T&&(d[_+T]=k-L<<24|64<<16|0),f.bits=M,0}},48898:e=>{"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},10342:(e,t,n)=>{"use strict";var a=n(24236);function s(e){for(var t=e.length;--t>=0;)e[t]=0}var i=256,r=286,o=30,c=15,l=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],d=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],h=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],f=new Array(576);s(f);var p=new Array(60);s(p);var g=new Array(512);s(g);var m=new Array(256);s(m);var w=new Array(29);s(w);var _,b,y,v=new Array(o);function I(e,t,n,a,s){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=a,this.max_length=s,this.has_stree=e&&e.length}function E(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function k(e){return e<256?g[e]:g[256+(e>>>7)]}function x(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function A(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,x(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function S(e,t,n){A(e,n[2*t],n[2*t+1])}function M(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function O(e,t,n){var a,s,i=new Array(16),r=0;for(a=1;a<=c;a++)i[a]=r=r+n[a-1]<<1;for(s=0;s<=t;s++){var o=e[2*s+1];0!==o&&(e[2*s]=M(i[o]++,o))}}function L(e){var t;for(t=0;t<r;t++)e.dyn_ltree[2*t]=0;for(t=0;t<o;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function Z(e){e.bi_valid>8?x(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function N(e,t,n,a){var s=2*t,i=2*n;return e[s]<e[i]||e[s]===e[i]&&a[t]<=a[n]}function T(e,t,n){for(var a=e.heap[n],s=n<<1;s<=e.heap_len&&(s<e.heap_len&&N(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!N(t,a,e.heap[s],e.depth));)e.heap[n]=e.heap[s],n=s,s<<=1;e.heap[n]=a}function R(e,t,n){var a,s,r,o,c=0;if(0!==e.last_lit)do{a=e.pending_buf[e.d_buf+2*c]<<8|e.pending_buf[e.d_buf+2*c+1],s=e.pending_buf[e.l_buf+c],c++,0===a?S(e,s,t):(S(e,(r=m[s])+i+1,t),0!==(o=l[r])&&A(e,s-=w[r],o),S(e,r=k(--a),n),0!==(o=d[r])&&A(e,a-=v[r],o))}while(c<e.last_lit);S(e,256,t)}function P(e,t){var n,a,s,i=t.dyn_tree,r=t.stat_desc.static_tree,o=t.stat_desc.has_stree,l=t.stat_desc.elems,d=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<l;n++)0!==i[2*n]?(e.heap[++e.heap_len]=d=n,e.depth[n]=0):i[2*n+1]=0;for(;e.heap_len<2;)i[2*(s=e.heap[++e.heap_len]=d<2?++d:0)]=1,e.depth[s]=0,e.opt_len--,o&&(e.static_len-=r[2*s+1]);for(t.max_code=d,n=e.heap_len>>1;n>=1;n--)T(e,i,n);s=l;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],T(e,i,1),a=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=a,i[2*s]=i[2*n]+i[2*a],e.depth[s]=(e.depth[n]>=e.depth[a]?e.depth[n]:e.depth[a])+1,i[2*n+1]=i[2*a+1]=s,e.heap[1]=s++,T(e,i,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,a,s,i,r,o,l=t.dyn_tree,d=t.max_code,u=t.stat_desc.static_tree,h=t.stat_desc.has_stree,f=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,g=t.stat_desc.max_length,m=0;for(i=0;i<=c;i++)e.bl_count[i]=0;for(l[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(i=l[2*l[2*(a=e.heap[n])+1]+1]+1)>g&&(i=g,m++),l[2*a+1]=i,a>d||(e.bl_count[i]++,r=0,a>=p&&(r=f[a-p]),o=l[2*a],e.opt_len+=o*(i+r),h&&(e.static_len+=o*(u[2*a+1]+r)));if(0!==m){do{for(i=g-1;0===e.bl_count[i];)i--;e.bl_count[i]--,e.bl_count[i+1]+=2,e.bl_count[g]--,m-=2}while(m>0);for(i=g;0!==i;i--)for(a=e.bl_count[i];0!==a;)(s=e.heap[--n])>d||(l[2*s+1]!==i&&(e.opt_len+=(i-l[2*s+1])*l[2*s],l[2*s+1]=i),a--)}}(e,t),O(i,d,e.bl_count)}function C(e,t,n){var a,s,i=-1,r=t[1],o=0,c=7,l=4;for(0===r&&(c=138,l=3),t[2*(n+1)+1]=65535,a=0;a<=n;a++)s=r,r=t[2*(a+1)+1],++o<c&&s===r||(o<l?e.bl_tree[2*s]+=o:0!==s?(s!==i&&e.bl_tree[2*s]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,i=s,0===r?(c=138,l=3):s===r?(c=6,l=3):(c=7,l=4))}function F(e,t,n){var a,s,i=-1,r=t[1],o=0,c=7,l=4;for(0===r&&(c=138,l=3),a=0;a<=n;a++)if(s=r,r=t[2*(a+1)+1],!(++o<c&&s===r)){if(o<l)do{S(e,s,e.bl_tree)}while(0!=--o);else 0!==s?(s!==i&&(S(e,s,e.bl_tree),o--),S(e,16,e.bl_tree),A(e,o-3,2)):o<=10?(S(e,17,e.bl_tree),A(e,o-3,3)):(S(e,18,e.bl_tree),A(e,o-11,7));o=0,i=s,0===r?(c=138,l=3):s===r?(c=6,l=3):(c=7,l=4)}}s(v);var U=!1;function D(e,t,n,s){A(e,0+(s?1:0),3),function(e,t,n,s){Z(e),s&&(x(e,n),x(e,~n)),a.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n,!0)}t._tr_init=function(e){U||(!function(){var e,t,n,a,s,i=new Array(16);for(n=0,a=0;a<28;a++)for(w[a]=n,e=0;e<1<<l[a];e++)m[n++]=a;for(m[n-1]=a,s=0,a=0;a<16;a++)for(v[a]=s,e=0;e<1<<d[a];e++)g[s++]=a;for(s>>=7;a<o;a++)for(v[a]=s<<7,e=0;e<1<<d[a]-7;e++)g[256+s++]=a;for(t=0;t<=c;t++)i[t]=0;for(e=0;e<=143;)f[2*e+1]=8,e++,i[8]++;for(;e<=255;)f[2*e+1]=9,e++,i[9]++;for(;e<=279;)f[2*e+1]=7,e++,i[7]++;for(;e<=287;)f[2*e+1]=8,e++,i[8]++;for(O(f,287,i),e=0;e<o;e++)p[2*e+1]=5,p[2*e]=M(e,5);_=new I(f,l,257,r,c),b=new I(p,d,0,o,c),y=new I(new Array(0),u,0,19,7)}(),U=!0),e.l_desc=new E(e.dyn_ltree,_),e.d_desc=new E(e.dyn_dtree,b),e.bl_desc=new E(e.bl_tree,y),e.bi_buf=0,e.bi_valid=0,L(e)},t._tr_stored_block=D,t._tr_flush_block=function(e,t,n,a){var s,r,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<i;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),P(e,e.l_desc),P(e,e.d_desc),o=function(e){var t;for(C(e,e.dyn_ltree,e.l_desc.max_code),C(e,e.dyn_dtree,e.d_desc.max_code),P(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*h[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),s=e.opt_len+3+7>>>3,(r=e.static_len+3+7>>>3)<=s&&(s=r)):s=r=n+5,n+4<=s&&-1!==t?D(e,t,n,a):4===e.strategy||r===s?(A(e,2+(a?1:0),3),R(e,f,p)):(A(e,4+(a?1:0),3),function(e,t,n,a){var s;for(A(e,t-257,5),A(e,n-1,5),A(e,a-4,4),s=0;s<a;s++)A(e,e.bl_tree[2*h[s]+1],3);F(e,e.dyn_ltree,t-1),F(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),R(e,e.dyn_ltree,e.dyn_dtree)),L(e),a&&Z(e)},t._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(m[n]+i+1)]++,e.dyn_dtree[2*k(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){A(e,2,3),S(e,256,f),function(e){16===e.bi_valid?(x(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},62292:e=>{"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},14153:e=>{const t=/^[-+]?0x[a-fA-F0-9]+$/,n=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const a={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};e.exports=function(e,s={}){if(s=Object.assign({},a,s),!e||"string"!=typeof e)return e;let i=e.trim();if(void 0!==s.skipLike&&s.skipLike.test(i))return e;if(s.hex&&t.test(i))return Number.parseInt(i,16);{const t=n.exec(i);if(t){const n=t[1],a=t[2];let r=function(e){if(e&&-1!==e.indexOf("."))return"."===(e=e.replace(/0+$/,""))?e="0":"."===e[0]?e="0"+e:"."===e[e.length-1]&&(e=e.substr(0,e.length-1)),e;return e}(t[3]);const o=t[4]||t[6];if(!s.leadingZeros&&a.length>0&&n&&"."!==i[2])return e;if(!s.leadingZeros&&a.length>0&&!n&&"."!==i[1])return e;{const t=Number(i),c=""+t;return-1!==c.search(/[eE]/)||o?s.eNotation?t:e:-1!==i.indexOf(".")?"0"===c&&""===r||c===r||n&&c==="-"+r?t:e:a?r===c||n+r===c?t:e:i===c||i===n+c?t:e}}return e}}}},n={};function a(e){var s=n[e];if(void 0!==s)return s.exports;var i=n[e]={id:e,loaded:!1,exports:{}};return t[e].call(i.exports,i,i.exports,a),i.loaded=!0,i.exports}a.m=t,e=[],a.O=(t,n,s,i)=>{if(!n){var r=1/0;for(d=0;d<e.length;d++){for(var[n,s,i]=e[d],o=!0,c=0;c<n.length;c++)(!1&i||r>=i)&&Object.keys(a.O).every((e=>a.O[e](n[c])))?n.splice(c--,1):(o=!1,i<r&&(r=i));if(o){e.splice(d--,1);var l=s();void 0!==l&&(t=l)}}return t}i=i||0;for(var d=e.length;d>0&&e[d-1][2]>i;d--)e[d]=e[d-1];e[d]=[n,s,i]},a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),a.j=670,(()=>{var e={670:0};a.O.j=t=>0===e[t];var t=(t,n)=>{var s,i,[r,o,c]=n,l=0;if(r.some((t=>0!==e[t]))){for(s in o)a.o(o,s)&&(a.m[s]=o[s]);if(c)var d=c(a)}for(t&&t(n);l<r.length;l++)i=r[l],a.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return a.O(d)},n=self.webpackChunkgapp_browser_react=self.webpackChunkgapp_browser_react||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var s=a.O(void 0,[739],(()=>a(43771)));s=a.O(s)})();